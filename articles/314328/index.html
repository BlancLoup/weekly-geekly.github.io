<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Comparing objects by value - 1: Beginning</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is well known that in the .NET object model, as in many other software platforms, you can compare objects by reference and by value. 
 By default, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Comparing objects by value - 1: Beginning</h1><div class="post__text post__text-html js-mediator-article"><h4>  It is well known that in the <a href="https://www.microsoft.com/net">.NET</a> object model, as in many other software platforms, you can compare objects by reference and by value. </h4><br>  By default, two objects are considered equal if the corresponding variables contain the same reference.  Otherwise, objects are considered unequal. <br><br>  However, a situation may arise when it is necessary to consider objects of a certain class as equal if they are in some way the same in content. <br><br><h4>  Let there is a class Person, containing personal data - the name, surname, and date of birth of the person. </h4><br>  Using this class as an example, consider: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  the minimum required set of class modifications so that objects of this class are compared by value using the standard <a href="https://www.microsoft.com/net">.NET</a> infrastructure; </li><li>  the minimum necessary and sufficient set of improvements so that objects of this class are always compared by value using the standard <a href="https://www.microsoft.com/net">.NET</a> infrastructure - unless it is explicitly stated that the comparison should be made by reference. </li></ol><br>  For each case, we will consider in what way it is better to implement a comparison of objects by value in order to get a consistent and, as far as possible, compact, copy-paste free, productive code. <br><br>  The task is not as trivial as it may seem at first glance. <br><br>  And also consider what improvements could be made to the platform in order to simplify the implementation of this task. <br><a name="habracut"></a><br>  Person class: <br><div class="spoiler">  <b class="spoiler_title">class Person</b> <div class="spoiler_text"><pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloEquatable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Person</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NormalizeName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> =&gt; name?.Trim() ?? <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> DateTime? NormalizeDate(DateTime? date) =&gt; date?.Date; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTime? BirthDate { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Person</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> firstName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lastName, DateTime? birthDate</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FirstName = NormalizeName(firstName); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LastName = NormalizeName(lastName); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.BirthDate = NormalizeDate(birthDate); } } }</code> </pre> </div></div><br>  If two objects of class Person are compared in any way: <br><ul><li>  method <a href="https://msdn.microsoft.com/library/system.object.referenceequals.aspx">Object.ReferenceEquals (Object, Object)</a> , </li><li>  method <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">Object.Equals (Object)</a> , </li><li>  method <a href="https://msdn.microsoft.com/library/w4hkze5k.aspx">Object.Equals (Object, Object)</a> , </li><li>  operators <a href="https://msdn.microsoft.com/library/53k8ybth.aspx">==</a> or <a href="https://msdn.microsoft.com/library/3tz250sf.aspx">! =</a> , </li></ul>  then objects will be considered equal only if the variables pointing to them contain the same reference. <br><br>  When placed in <a href="https://msdn.microsoft.com/library/bb359438.aspx">hash sets (hash cards)</a> and <a href="https://msdn.microsoft.com/library/xfhwa508.aspx">dictionaries</a> , objects will also be considered equal only if the links match. <br><br>  To compare objects by value in the client code, you need to write lines like this: <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person(<span class="hljs-string"><span class="hljs-string">"John"</span></span>, <span class="hljs-string"><span class="hljs-string">"Smith"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">1990</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person(<span class="hljs-string"><span class="hljs-string">"John"</span></span>, <span class="hljs-string"><span class="hljs-string">"Smith"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">1990</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isSamePerson = p1.BirthDate == p2.BirthDate &amp;&amp; p1.FirstName == p2.FirstName &amp;&amp; p1.LastName == p2.LastName;</code> </pre></div></div><br>  Notes: <br><br><ol><li>  The Person class is implemented in such a way that the FirstName and LastName string properties are not always <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> . <br>  If FirstName or LastName are unknown (not set), then an <a href="https://msdn.microsoft.com/library/system.string.empty.aspx">empty string is</a> appropriate as a sign of the absence of a value. <br>  This will avoid avoiding <a href="https://msdn.microsoft.com/library/system.nullreferenceexception.aspx">NullReferenceException</a> when accessing the properties and methods of the FirstName and LastName fields, as well as collisions when comparing <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> and <a href="https://msdn.microsoft.com/library/system.string.empty.aspx">empty string</a> (do FirstName equal to two objects if the first FirstName object is <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> and the other <a href="https://msdn.microsoft.com/library/system.string.empty.aspx">empty string</a> ?) . </li><li>  The BirthDate property, in contrast, is implemented as a <a href="https://msdn.microsoft.com/library/b3h38hb0.aspx">Nullable (Of T)</a> structure, since  If the date of birth is unknown (not specified), then it is advisable to keep the property exactly the indefinite value, and not the special value of the form 01/01/1900, 01/01/1970, 01/01/0001 or <a href="https://msdn.microsoft.com/library/system.datetime.minvalue.aspx">MinValue</a> . </li><li>  When comparing objects by value, date comparison is first implemented, since  comparison of date-time type variables will generally be faster than string comparisons. </li><li>  Comparing dates and strings is implemented using the equality operator, since  the equality operator compares structures by value, and for rows, the equality operator is overloaded and also compares rows by value. </li></ol><br>  So that objects of the Person class can be compared by value in the following ways: <br><br><ul><li>  method <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">Object.Equals (Object)</a> , </li><li>  method <a href="https://msdn.microsoft.com/library/w4hkze5k.aspx">Object.Equals (Object, Object)</a> , </li><li>  when placed in <a href="https://msdn.microsoft.com/library/bb359438.aspx">hash sets (hash cards)</a> and <a href="https://msdn.microsoft.com/library/xfhwa508.aspx">dictionaries</a> , </li></ul><br>  for the Person class, you must <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">override the</a> <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">Object.Equals (Object)</a> and <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">Object.GetHashCode ()</a> methods as follows: <br><br><ul><li>  The <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">Equals (Object)</a> method compares those class fields whose combination of values ‚Äã‚Äãforms the value of an object. </li><li>  The <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">GetHashCode ()</a> method must return the same hash values ‚Äã‚Äãfor equal objects (i.e., for objects whose comparison with <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">Equals (Object)</a> returns <a href="https://msdn.microsoft.com/library/6x6y6z4d.aspx">true</a> ). <br>  It follows that if objects have different hash codes, then objects are not equal;  at the same time, unequal objects can have the same hash codes. <br>  (To get the hash code, the result of the operation of <a href="https://msdn.microsoft.com/library/zkacc7k1.aspx">‚Äúexclusive or‚Äù</a> values ‚Äã‚Äãof <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">GetHashCode ()</a> fields, which are used in <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">Equals</a> to compare objects by value, is usually used; <br>  if a field is a 32-bit integer, the field value can be used instead of the hash code of this field; <br>  Various optimizations are also possible to minimize the likelihood of collisions when two unequal objects have the same hash code.) </li></ul><br>  It is worth paying special attention that the <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">documentation</a> for the <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">Equals (Object)</a> method contains special requirements: <br><br><ul><li>  x.Equals (y) returns the same value as y.Equals (x). </li><li>  If (x.Equals (y) &amp;&amp; y.Equals (z)) returns true, then x.Equals (z) returns true. </li><li>  x.Equals (null) returns false. </li><li>  Returns the same value as the objects. </li><li>  And a number of others, in particular, concerning the rules for comparing floating-point values. </li></ul><br>  It is also worth noting that the <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">documentation</a> for the <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">GetHashCode ()</a> method gives a warning that the value returned by the method is not a constant value and therefore should not be saved to disk or database, used as a key, and also that it is not should be used to compare objects (unequal objects can have the same hash codes), etc. <br><br>  Person class with overlapped <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">Equals (Object)</a> and <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">GetHashCode ()</a> methods: <br><div class="spoiler">  <b class="spoiler_title">class Person</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">HelloEquatable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Person</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NormalizeName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> =&gt; name?.Trim() ?? <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> DateTime? NormalizeDate(DateTime? date) =&gt; date?.Date; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTime? BirthDate { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Person</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> firstName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lastName, DateTime? birthDate</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FirstName = NormalizeName(firstName); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LastName = NormalizeName(lastName); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.BirthDate = NormalizeDate(birthDate); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHashCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FirstName.GetHashCode() ^ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LastName.GetHashCode() ^ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.BirthDate.GetHashCode(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EqualsHelper</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Person first, Person second</span></span></span><span class="hljs-function">)</span></span> =&gt; first.BirthDate == second.BirthDate &amp;&amp; first.FirstName == second.FirstName &amp;&amp; first.LastName == second.LastName; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> == obj) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> other = obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Person; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>)other == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EqualsHelper(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, other); } } }</code> </pre> </div></div><br>  Notes to the <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">GetHashCode ()</a> method: <br><br><ul><li>  If any of the used fields contains <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> , then instead of the value <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">GetHashCode ()</a> , zero is usually used. </li><li>  The Person class is implemented in such a way that the FirstName and LastName reference fields cannot be <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> , and the BirthDate field is a <a href="https://msdn.microsoft.com/library/b3h38hb0.aspx">Nullable (Of T)</a> structure for which, in the case of an undefined value, <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">GetHashCode ()</a> returns zero, and the <a href="https://msdn.microsoft.com/library/system.nullreferenceexception.aspx">NullReferenceException</a> when the <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">GetHashCode ()</a> call <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">is</a> not arises. </li><li>  If the fields of the Person class could contain <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> , then the <a href="https://msdn.microsoft.com/library/system.object.gethashcode.aspx">GetHashCode ()</a> method would be implemented as follows: <br><div class="spoiler">  <b class="spoiler_title">GetHashCode ()</b> <div class="spoiler_text"><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> int GetHashCode() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FirstName?.GetHashCode() ?? <span class="hljs-number"><span class="hljs-number">0</span></span> ^ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LastName?.GetHashCode() ?? <span class="hljs-number"><span class="hljs-number">0</span></span> ^ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.BirthDate?.GetHashCode() ?? <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre></div></div></li></ul><br>  Let us consider in detail exactly how the <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">Equals (Object)</a> method is implemented: <br><br><ol><li>  First, the reference to the current object ( <a href="https://msdn.microsoft.com/library/dk1507sz.aspx">this</a> ) is compared with the reference to the incoming object, and if the links are equal, <a href="https://msdn.microsoft.com/library/6x6y6z4d.aspx">true is</a> returned (this is the same object, and comparison by value does not make sense, including for performance reasons). </li><li>  Then, the input object is cast to the Person type using the <a href="https://msdn.microsoft.com/library/cscsdfbt.aspx">as</a> operator.  If the result of the cast is <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> , then <a href="https://msdn.microsoft.com/library/67bxt5ee.aspx">false is</a> returned (either the incoming link was initially <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> , or the incoming object is incompatible with the Person class, and is certainly not equal to the current object). </li><li>  Then the fields of the two objects of the Person class are compared by value, and the corresponding result is returned. <br>  For readability of the code and possible reuse, the comparison of objects directly by value is made in the auxiliary EqualsHelper method. </li></ol><br><h4>  So far we have implemented only the minimum necessary functionality for comparing objects by value, but questions are already emerging. </h4><br><h4>  The first question is more theoretical. </h4><br>  Pay attention to the requirement for the <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">Equals (Object)</a> method: <br><pre> <code class="hljs pgsql">x.Equals(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>.</code> </pre> <br>  Once I wondered why some instance methods in the standard .NET library check <a href="https://msdn.microsoft.com/library/dk1507sz.aspx">this</a> for <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> - for example, the <a href="https://msdn.microsoft.com/library/fkfd9eh8.aspx">String.Equals (Object)</a> method is implemented like this: <br><div class="spoiler">  <b class="spoiler_title">String.Equals (Object)</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> override <span class="hljs-type"><span class="hljs-type">bool</span></span> Equals(<span class="hljs-keyword"><span class="hljs-keyword">Object</span></span> obj) { //this <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> necessary <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> guard against <span class="hljs-keyword"><span class="hljs-keyword">reverse</span></span>-pinvokes <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> //other callers who <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> use the callvirt instruction <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> NullReferenceException(); String str = obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> String; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Object</span></span>.ReferenceEquals(this, obj)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this.Length != str.Length) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EqualsHelper(this, str); }</code> </pre></div></div><br>  First of all, the method checks <a href="https://msdn.microsoft.com/library/dk1507sz.aspx">this</a> for <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> and, in the case of a positive test result, throws a <a href="https://msdn.microsoft.com/library/system.nullreferenceexception.aspx">NullReferenceException</a> . <br><br>  The comment indicates in which cases <a href="https://msdn.microsoft.com/library/dk1507sz.aspx">this</a> may take a <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> value. <br><br>  (By the way, <a href="https://msdn.microsoft.com/library/dk1507sz.aspx">this is</a> compared to <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> using the <a href="https://msdn.microsoft.com/library/53k8ybth.aspx">==</a> operator, which is <a href="https://msdn.microsoft.com/library/system.string.op_equality.aspx">overloaded</a> in the <a href="https://msdn.microsoft.com/library/system.string.aspx">String</a> class, so from a performance point of view, it is better to check it by explicitly casting <a href="https://msdn.microsoft.com/library/dk1507sz.aspx">this</a> to <a href="https://msdn.microsoft.com/library/9kkx3h3c.aspx">object</a> : (object) this == null, or use the <a href="https://msdn.microsoft.com/library/system.object.referenceequals.aspx">Object.ReferenceEquals</a> method <a href="https://msdn.microsoft.com/library/system.object.referenceequals.aspx">(Object, Object)</a> , as is done in the second comparison in the same method.) <br><br>  And then there was an article where you can read more about this: <a href="https://habrahabr.ru/company/enterra/blog/252249/">When this == null: a true story from the world of the CLR</a> . <br><br>  However, in this case, if you call the overloaded method Person.Equals (Object) without creating an instance, passing <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> as an input parameter, then the very first line of the method (if ((object) this == obj) return true;) returns <a href="https://msdn.microsoft.com/library/6x6y6z4d.aspx">true</a> , which will actually be correct, but it will formally contradict the requirements for implementing the method. <br><br>  In this case, the <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">documentation</a> for the method does not indicate that the first thing to do is to check <a href="https://msdn.microsoft.com/library/dk1507sz.aspx">this</a> for <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> and throw an exception if the check is successful. <br><br>  In this case, in general, in all the instance methods of all classes, the first line should be to check <a href="https://msdn.microsoft.com/library/dk1507sz.aspx">this</a> for <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> , which is absurd. <br><br>  Therefore, it seems that the official requirements for the implementation of the <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">Equals (Object)</a> method should be clarified as follows: <br><br><ul><li>  (for classes, not structures) if the references to the current and incoming objects are equal, then <a href="https://msdn.microsoft.com/library/6x6y6z4d.aspx">true is</a> returned; </li><li>  and already the second requirement - if the reference to the incoming object is <a href="https://msdn.microsoft.com/library/edakx9da.aspx">null</a> , then <a href="https://msdn.microsoft.com/library/67bxt5ee.aspx">false is</a> returned. </li></ul><br><h4>  But the second question on the implementation of the <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">Equals (Object)</a> method is more interesting and has practical significance. </h4><br>  It concerns how to most correctly implement the requirement: <br><pre> <code class="hljs pgsql">x.Equals(y) <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> the same <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> y.Equals(x).</code> </pre>  Moreover, are the requirements and examples for the implementation of the method in this part set forth fully and consistently in the <a href="https://msdn.microsoft.com/library/bsc2ak47.aspx">documentation</a> , and are there alternative approaches to the implementation of this requirement. <br><br><h4>  About this, as well as questions of the implementation of a complete set of class improvements to compare its objects by value, let's talk in the <a href="https://habrahabr.ru/post/314500/">following publications</a> . </h4></div><p>Source: <a href="https://habr.com/ru/post/314328/">https://habr.com/ru/post/314328/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314312/index.html">We draw, code under libGDX and other small joys from the life of an indi-developer</a></li>
<li><a href="../314314/index.html">Console commands with PHPixie Console</a></li>
<li><a href="../314318/index.html">How we distinguished a trolley from a foreman - video analytics for the hypermarket checkout zone (and a continuation about the cat terminator)</a></li>
<li><a href="../314324/index.html">Aidra boosted botnet infected 3,500 devices in less than a week</a></li>
<li><a href="../314326/index.html">Firefox 52 will remove the battery level API to preserve user data privacy</a></li>
<li><a href="../314330/index.html">Analysis of the class of non-stationary processes with stationary increments in stock markets</a></li>
<li><a href="../314332/index.html">Casual Theory of Inventive Problem Solving</a></li>
<li><a href="../314334/index.html">IoT devices - the favorite target of DDoS attacks</a></li>
<li><a href="../314336/index.html">Theory of Inventive Problem Solving on Fingers</a></li>
<li><a href="../314338/index.html">A few simple steps to help avoid problems with creating and restoring backup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>