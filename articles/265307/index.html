<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing a Labyrinth on XNA 4.0 C #</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I will share my experience of the game "Maze". In this game, the DFS algorithm is implemented. The other day I was assigned to do coursework on ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing a Labyrinth on XNA 4.0 C #</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/2ce/202/1a4/2ce2021a464246b27bc6465eab5a0048.png" alt="image" align="left"><br>  Today I will share my experience of the game "Maze".  In this game, the DFS algorithm is implemented.  The other day I was assigned to do coursework on Algorithms, namely on DFS in the mazes.  It was impossible to refuse.  He came home, drank a cup of strong coffee and began to create. <br><a name="habracut"></a><br>  Before I opened Visual Studio, I decided to look for ready-made mazes.  As I thought, I found a bunch of stuff.  All labyrinths (I was looking only for different and interesting ones) were written in different languages, platforms, but they had something in common, namely, they were all C-like. <br><br>  It was hard to decide between a number of platforms on which such an idea could be developed (for a freshman).  All below listed platforms have their own advantages and disadvantages. <br><ul><li>  Windows Form </li><li>  WPF </li><li>  Direct x </li><li>  XNA </li></ul><br><h4>  Windows Form </h4><br>  I opened the studio, threw a button on the panel and thought: ‚ÄúWhere will I draw my labyrinth and how will it look?‚Äù.  Having found the necessary material on the Internet, I realized that there must be some kind of matrix that stores the coordinates of the cells and their types. <br><br>  In WF, I decided to go the lame way and created a grid of components.  Then he began to create (dynamically) ordinary panels.  At first everything was cool, until I ran into a problem: with a large expansion of the maze, the program just hung.  Then I decided to retreat from my idea and find a new platform. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  WPF </h4><br>  WPF I always liked its functionality.  WPF provided a bunch of ways to draw a maze - do not try everything.  I decided to draw an array of cells using Path.  But ran into a rake: the project again turned out to be costly in resources.  And I did not find a way to refer to the drawn cell.  Time was running out, and there was no way to find a drawing platform. <br><br><h4>  Direct x </h4><br>  Direct X technology is incredibly huge, and I would 100% have found a way to create your own maze and the algorithm for creating it.  But learning that <br>  Mostly with DX you will work with the language with ++, I was very distressed.  I have not had the opportunity to work and create programs in the C ++ language, so I rejected this idea. <br><br><h4>  XNA </h4><br>  A classmate told me about XNA technology and presented his created snake.  And then I realized: this is what I need.  After watching a couple of lessons on how to work with XNA, I began to create my own game!  Having come across <a href="http://habrahabr.ru/post/262345/">this article</a> , I decided to go according to the <a href="http://habrahabr.ru/users/mersinvald/" class="user_link">mersinvald</a> plan. <br><br>  Sketching a plan, I rushed into battle! <br><ul><li>  Create matrix </li><li>  Implement DFS Algorithm </li><li>  Draw the maze </li></ul><br><div class="spoiler">  <b class="spoiler_title">I selected creation of a matrix in a separate class.</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Matrix</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Size <span class="hljs-comment"><span class="hljs-comment">//      -          . public int Width { get; set; } public int Height { get; set; } } readonly Size _size; //   readonly Texture2D[,] _maze; //     public Matrix(Maze.Cells size , Texture2D[,] cell2D) { _maze = cell2D; _size.Width = size.X; _size.Height = size.Y; } public void Draw(SpriteBatch spriteBatch) //     { for (var i = 0; i &lt; _size.Height; i++) { for (var j = 0; j &lt; _size.Width; j++) { if ((i % 2 != 0 &amp;&amp; j % 2 != 0) &amp;&amp; (i &lt; _size.Height - 1 &amp;&amp; j &lt; _size.Width - 1)) //    x  y,       { spriteBatch.Draw(_maze[i, j], new Rectangle(i * 10, j * 10, 10, 10), Color.White); //    } else { spriteBatch.Draw(_maze[i, j], new Rectangle(i * 10, j * 10, 10, 10), Color.White); //      } } } } }</span></span></code> </pre> <br></div></div><br>  The matrix is ‚Äã‚Äãgenerated, or rather an array of cells is created.  Now each cell (wall and floor) must have its own texture.  Go to the main class and create all the necessary variables. <br><div class="spoiler">  <b class="spoiler_title">Start of the main project</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Cells { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> X; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Y; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cells</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newY</span></span></span><span class="hljs-function">)</span></span> { X = newX; Y = newY; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteBatch _spriteBatch; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Texture2D[,] _maze; <span class="hljs-comment"><span class="hljs-comment">//   private Cells _size; //   private readonly Cells _start; private readonly Cells _finish; private int _cell; //  private int _wall; //  private int _visited; //   private readonly List&lt;Cells&gt; _neighbours; //   private readonly Stack&lt;Cells&gt; _path; //    private int _status; //    public Maze(List&lt;Cells&gt; neighbours, Stack&lt;Cells&gt; path) { _neighbours = neighbours; _path = path; var graphics = new GraphicsDeviceManager(this); Content.RootDirectory = "Content"; var winWidth = graphics.PreferredBackBufferWidth = 210; var winHeight = graphics.PreferredBackBufferHeight = 210; _size = new Cells(winWidth/10, winHeight/10); _start = new Cells(1, 1); _finish = new Cells(_size.X - 2, _size.Y - 2); _maze = new Texture2D[_size.X, _size.Y]; _path.Push(_start); IsMouseVisible = true; }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Texture loading</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadContent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _spriteBatch = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpriteBatch(GraphicsDevice); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; _size.Y; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; _size.X; j++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((i%<span class="hljs-number"><span class="hljs-number">2</span></span> != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; j%<span class="hljs-number"><span class="hljs-number">2</span></span> != <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; (i &lt; _size.Y - <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; j &lt; _size.X - <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-comment"><span class="hljs-comment">//     .     x  y,       { _maze[i, j] = Content.Load&lt;Texture2D&gt;("flat"); //   _cell = _maze[i, j].GetHashCode(); //     . } else { _maze[i, j] = Content.Load&lt;Texture2D&gt;("wall");//   _wall = _maze[i, j].GetHashCode(); } } } }</span></span></code> </pre><br>  Not finding a way to recognize the type of cell and switched to cunning.  Loaded into the Hash Code variable of cell resources. <br><pre> <code class="cs hljs">_wall = _maze[i, j].GetHashCode(); _cell = _maze[i, j].GetHashCode();</code> </pre><br></div></div><br>  Our matrix is ‚Äã‚Äãready and displayed on the screen.  Now it's small, creating branches of the maze.  Create 3 VOIDs: <br><ul><li>  <b>DrawMaze</b> - Draw a maze </li><li>  <b>GetNeighbours</b> - <b>Get the</b> current cell neighbors </li><li>  <b>RemoteWall</b> - Remove Walls </li></ul><br><div class="spoiler">  <b class="spoiler_title">private void DrawMaze ()</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawMaze</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_path.Count != <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">//     ,    { GetNeighbours(_path.Peek()); //     ,   if (_neighbours.Count != 0) //    ,   () { var a = _neighbours[new Random().Next(0, _neighbours.Count)]; //    RemoteWall(_path.Peek(), a); //        _path.Push(a); //          _neighbours.Clear(); //    } else { _path.Pop(); //    ,     } } else //        { MainPoint(); //      _status = 1; //     } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">private void GetNeighbours ()</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetNeighbours</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Cells localcell</span></span></span><span class="hljs-function">) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//     { var x = localcell.X; var y = localcell.Y; const int distance = 2; var d = new[] //     { new Cells(x, y - distance), // Up new Cells(x + distance, y), // Right new Cells(x, y + distance), // Down new Cells(x - distance, y) // Left }; for (var i = 0; i &lt; 4; i++) //   4  { var s = d[i]; if (sX &lt;= 0 || sX &gt;= _size.X || sY &lt;= 0 || sY &gt;= _size.Y) continue; //        if (_maze[sX, sY].GetHashCode() == _wall || _maze[sX, sY].GetHashCode() == _visited) continue; //         _neighbours.Add(s); //      } }</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">private void RemoteWall ()</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoteWall</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Cells first, Cells second</span></span></span><span class="hljs-function">) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//    2  { var xDiff = second.X - first.X; var yDiff = second.Y - first.Y; Cells target; Cells newCells; var addX = (xDiff != 0) ? xDiff/Math.Abs(xDiff) : 0; //     var addY = (yDiff != 0) ? yDiff/Math.Abs(yDiff) : 0; target.X = first.X + addX; //    target.Y = first.Y + addY; _maze[target.X, target.Y] = Content.Load&lt;Texture2D&gt;("visited"); //      -   _maze[_path.Peek().X, _path.Peek().Y] = Content.Load&lt;Texture2D&gt;("visited"); //     -   _visited = _maze[target.X, target.Y].GetHashCode(); //  Hash Code   newCells.X = first.X + 2*addX; newCells.Y = first.Y + 2*addY; _path.Push(newCells); //      _maze[_path.Peek().X, _path.Peek().Y] = Content.Load&lt;Texture2D&gt;("visited"); //     -   }</span></span></span></span></code> </pre><br></div></div><br>  Well, the code for drawing the starting points: <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _maze[_start.X, _start.Y] = Content.Load&lt;Texture2D&gt;(<span class="hljs-string"><span class="hljs-string">"start"</span></span>); _starter = _maze[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>].GetHashCode(); _maze[_finish.X, _finish.Y] = Content.Load&lt;Texture2D&gt;(<span class="hljs-string"><span class="hljs-string">"finish"</span></span>); _finisher = _maze[_finish.X, _finish.Y].GetHashCode(); }</code> </pre><br>  <a href="https://yadi.sk/d/j78v3ZUMikdPM">Dowload</a> <br>  Generation works, now it‚Äôs small: to find a way out in such a labyrinth.  We draw a way out in the same way as we drew a maze.  But everything is simplified, since it is not necessary to remove the walls.  That's all I have, in the next article will be described a way to find a way out. </div><p>Source: <a href="https://habr.com/ru/post/265307/">https://habr.com/ru/post/265307/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265293/index.html">Frontend Union Conf conference this Saturday</a></li>
<li><a href="../265295/index.html">PostgreSQL support in Meteor</a></li>
<li><a href="../265301/index.html">Single-layer perceptron for beginners</a></li>
<li><a href="../265303/index.html">Work with a SQLite database using SQLitePCL wrapper</a></li>
<li><a href="../265305/index.html">Wake on Lan Telegram bot</a></li>
<li><a href="../265309/index.html">Python cryptography: encrypting information and creating digital signatures with the PyCrypto package</a></li>
<li><a href="../265311/index.html">Safe as in a safe</a></li>
<li><a href="../265313/index.html">How to configure the iOS device and RAD Studio XE8 (Delphi, C ++ Builder)</a></li>
<li><a href="../265315/index.html">Who is a designer?</a></li>
<li><a href="../265317/index.html">HP and Microsoft - a symbiosis of progress</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>