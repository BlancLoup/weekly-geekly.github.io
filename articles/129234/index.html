<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write a simple application using GoogleMap and pumped SimpleCursorAdapter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Application development for the Android platform is becoming more and more popular. So, I recently happened to be engaged in the development of the cl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write a simple application using GoogleMap and pumped SimpleCursorAdapter</h1><div class="post__text post__text-html js-mediator-article">  Application development for the Android platform is becoming more and more popular.  So, I recently happened to be engaged in the development of the client part of such an application, actually understanding the intricacies of this business from scratch, relying only on the basic knowledge of Java. <br><br>  Here, using the example of a simple application that allows you to select a metro station from the list and display it on a map, shows some useful features of working with the adapter for ListView, the simplest work of the Google Map and the interaction with the embedded database are implemented. <br>  The entire project can be downloaded on github via the link at the end of the article. <a name="habracut"></a><br><br>  Actually, the list looks like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/1e2/50e/fa3/1e250efa325e16185cd149581bdde64f.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It includes the list of stations and the search string by stations.  The tooltip in the search is implemented - when typing a sequence of letters in the list, only those stations whose name begins with this sequence remain. <br>  Tap on the station Belarus, we get: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0d3/8af/410/0d38af41015fe17dda1f33d1983c1b56.gif" alt="image"><br>  Now let's see what happens there. <br>  It is easy to see that a Google Map is used here (MapView).  Accordingly, it is important to remember that you need to specify Google APIs as a target when creating a project. <br><br>  Now the points: <br><br><h5>  1. AndroidManifest </h5><br><br>  This is the base file, which describes the settings of the application and indicates what it has access to.  Accordingly, in this file it is necessary to register access to the Internet, indicate that the com.google.android.maps library is used, and indicate our activations: in this case, SearchDialog, which appears at startup, and Map - activate with the map. <br><br><h5>  2. Database </h5><br><br>  For convenient work with the database, you need to create a database helper that implements the methods we need to work with the database, such as filtering by first letters and searching by id. <br>  The file RecordsDbHelper.java, as already mentioned, can be viewed at the link below.  Here it is worth noting that we have implemented the methods of searching by id and by text filter, which we will use in the future. <br><br><pre> <code class="hljs pgsql"><code class="java"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Cursor</span></span> getById(long id) { <span class="hljs-keyword"><span class="hljs-keyword">Cursor</span></span> ccc = mDb.query(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, DATABASE_TABLE, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> String[] { KEY_ROWID, KEY_NAME, KEY_X, KEY_Y, KEY_LINES }, KEY_ROWID + "=" + Long.toString(id), <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ccc; } synchronized <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Cursor</span></span> fetchRecordsByQuery(String query) { <span class="hljs-keyword"><span class="hljs-keyword">Cursor</span></span> ccc = mDb.query(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, DATABASE_TABLE, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> String[] { KEY_ROWID, KEY_NAME, KEY_LINES }, KEY_NAME + " LIKE" + "'" + query + "%'", <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, KEY_NAME, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ccc; }‚Äã</code> <br></code> </pre> <code><code class="java">public Cursor getById(long id) { Cursor ccc = mDb.query(true, DATABASE_TABLE, new String[] { KEY_ROWID, KEY_NAME, KEY_X, KEY_Y, KEY_LINES }, KEY_ROWID + "=" + Long.toString(id), null, null, null, null, null); return ccc; } synchronized public Cursor fetchRecordsByQuery(String query) { Cursor ccc = mDb.query(true, DATABASE_TABLE, new String[] { KEY_ROWID, KEY_NAME, KEY_LINES }, KEY_NAME + " LIKE" + "'" + query + "%'", null, null, null, KEY_NAME, null); return ccc; }‚Äã</code> <br></code> <br>  In general, everything is as usual, no wisdom. <br><br><h5>  3. Adapter </h5><br><br>  This is the class that implements the association of the list with the database.  As a result of a query to the database, we get the table cursor.  The adapter takes the cursor, the list, the names of the table fields and the id elements from item.xml (see below) that need to be correlated with each other, and fills the ListView.  Inheriting from the standard SimpleCursorAdapter, in which all this is implemented, and overriding the getView method in it. <br><br>  Adapter.java <br><pre> <code class="hljs pgsql"><code class="java"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Adapter extends SimpleCursorAdapter{ <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Adapter(Context context, <span class="hljs-type"><span class="hljs-type">int</span></span> layout, <span class="hljs-keyword"><span class="hljs-keyword">Cursor</span></span> c, String[] <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, <span class="hljs-type"><span class="hljs-type">int</span></span>[] <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>) { super(context, layout, c, <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>); } @Override <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">View</span></span> getView(<span class="hljs-type"><span class="hljs-type">int</span></span> position, <span class="hljs-keyword"><span class="hljs-keyword">View</span></span> convertView, ViewGroup parent) { <span class="hljs-keyword"><span class="hljs-keyword">View</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> = super.getView(position, convertView, parent); long id=getItemId(position); <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.setTag(id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>; } }</code> <br></code> </pre> <code><code class="java">public class Adapter extends SimpleCursorAdapter{ public Adapter(Context context, int layout, Cursor c, String[] from, int[] to) { super(context, layout, c, from, to); } @Override public View getView(int position, View convertView, ViewGroup parent) { View view = super.getView(position, convertView, parent); long id=getItemId(position); view.setTag(id); return view; } }</code> <br></code> <br>  In the getView method, a ready-made View of a list item (ie, a list line with the station name and a colored circle) places the id of the database table row to which the element corresponds to the tag (which each View object has).  This id will be subsequently transmitted to the activit with a map with a tap on the list item. <br><br><h5>  4. List </h5><br><br>  First you need to set its Layout - namely, the frame of the visual representation of the elements we need: <br><br>  search.xml <br><br><pre> <code class="hljs xml"><code class="xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EditText</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/search_text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:hint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/search_hint"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:id/android:list"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> <br></code> </pre> <code><code class="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt; &lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:orientation="vertical" android:layout_width="fill_parent" android:layout_height="wrap_content" &gt; &lt;EditText android:id="@+id/search_text" android:layout_width="fill_parent" android:layout_height="wrap_content" android:hint="@string/search_hint" /&gt; &lt;ListView android:id="@android:id/android:list" android:layout_width="fill_parent" android:layout_height="wrap_content" /&gt; &lt;/LinearLayout&gt;</code> <br></code> <br><br>  Layout of a separate element of the list (picture - a circle with the color of the metro line and the name of the station) <br><br>  item.xml <br><br><pre> <code class="hljs xml"><code class="xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"horizontal"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/line_image"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageView</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TextView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/text1"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> <br></code> </pre> <code><code class="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt; &lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android" android:layout_width="fill_parent" android:layout_height="fill_parent" android:orientation="horizontal" &gt; &lt;ImageView android:layout_width="wrap_content" android:layout_height="wrap_content" android:id="@+id/line_image" &gt; &lt;/ImageView&gt; &lt;TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="TextView" android:id="@+id/text1" &gt; &lt;/TextView&gt; &lt;/LinearLayout&gt;</code> <br></code> <br><br>  Now, finally, the class Search, which describes the activity with the search.  It is implemented using the inheritance from ListActivity - a special activation for lists.  Data on the stations (name, coordinates and number of the metro line) are taken from the above reviewed database. <br><br><pre> <code class="hljs pgsql"><code class="java"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Search</span></span> extends ListActivity { //  private EditText searchText; private RecordsDbHelper recordsDBHelper; private ListView list; private Adapter notes; //  Binder   private Binder binder; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.<span class="hljs-keyword"><span class="hljs-keyword">search</span></span>); binder = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Binder(); list = getListView(); //        , //     intent  id ,     //(. ),         . list.setClickable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); list.setOnItemClickListener(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> AdapterView.OnItemClickListener() { @Override <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onItemClick(AdapterView&lt;?&gt; av, <span class="hljs-keyword"><span class="hljs-keyword">View</span></span> v, <span class="hljs-type"><span class="hljs-type">int</span></span> pos, long id) { Intent intent = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Intent(); intent.putExtra("ID", (Long) v.getTag()); intent.setClass(<span class="hljs-keyword"><span class="hljs-keyword">Search</span></span>.this, Map.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>); startActivity(intent); } }); searchText = (EditText) findViewById(R.id.search_text); //       ,   //   updateList(),      searchText.addTextChangedListener(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> TextWatcher() { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> afterTextChanged(Editable s) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> beforeTextChanged(CharSequence s, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">start</span></span>, <span class="hljs-type"><span class="hljs-type">int</span></span> count, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span>) { } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onTextChanged(CharSequence s, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">start</span></span>, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">before</span></span>, <span class="hljs-type"><span class="hljs-type">int</span></span> count) { updateList(searchText.getText().toString()); } }); //    <span class="hljs-keyword"><span class="hljs-keyword">Database</span></span> Helper<span class="hljs-string"><span class="hljs-string">',     //  .     ,  //     . list.post(new Runnable() { @Override public void run() { recordsDBHelper = new RecordsDbHelper(Search.this); recordsDBHelper.open(); updateList(searchText.getText().toString()); } }); } //  Binder,   SimpleCursorAdapter.ViewBinder. //    . ,       //      . private static class Binder implements Adapter.ViewBinder { public boolean setViewValue(View view, Cursor c, int i) { if (view.getId() == R.id.line_image) { Integer line = c.getInt(i); switch (line) { case 0: ((ImageView) view).setImageResource(R.drawable.line0); break; case 1: ((ImageView) view).setImageResource(R.drawable.line1); break; ‚Ä¶ ‚Ä¶ } return true; } return false; } } //           // . private void updateList(String s) { if (recordsDBHelper.isReady()) { //       Cursor c = recordsDBHelper.fetchRecordsByQuery(s); startManagingCursor(c); //   ,       String[] from = new String[] { RecordsDbHelper.KEY_NAME, RecordsDbHelper.KEY_LINES }; //  id   (.. ImageView,    // ,  TextView,     ) int[] to = new int[] { R.id.text1, R.id.line_image }; //      notes = new Adapter(Search.this, R.layout.item, c, from, to); notes.setViewBinder(binder); setListAdapter(notes); } } }</span></span></code></code> </pre> <br><br>  The most interesting thing here, I think, is Binder.  It allows you to determine how to bind a value from a database table to a list line item, that is, for example, how to bind a branch number that is stored in a table to the corresponding picture with a circle of the desired color.  The setViewValue method is called for each view specified in the cursor constructor.  If the returned result is true, then the data is bound, everything is fine.  If false, the system realizes that the wrong method has been called and is looking for the right one among the standard binder.  In this example, it is checked whether the view passed as a parameter is the ImageView in which there should be a circle.  If this is so, then we transfer the corresponding picture there, otherwise we return false, making it clear that you need to use a standard binder (since this is not a picture, and here we process only pictures). <br><br>  When you activate the activation, the onCreate () method is called first, in which all the displayed elements are initialized.  This is where the handler for clicks on the elements of the list is installed, which pulls the tag from the record id and passes this tag to the activation with the map (well, it actually causes this activation).  A text change handler is also installed in the EditText (filter string).  When the text is changed, the updateList () function is called, in which, using the helper described above, a query is thrown into the base, pulling out the filtered data, and an adapter is created for the list. <br><br><h5>  5. Map </h5><br><br>  Finally go to the cards themselves.  Let's start with the Layout: <br><br>  map.xml <br><br><pre> <code class="hljs django"><code class="xml"><span class="xml"><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">com.google.android.maps.MapView</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"@+id/mapview"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">android:clickable</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">android:apiKey</span></span></span></span><span class="xml"><span class="hljs-tag">=&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">u</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  GoogleMaps API</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">u</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">b</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> /&gt;</span></span></code><span class="xml"><span class="xml"> </span></span><br></code> </pre> <code><code class="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt; &lt;com.google.android.maps.MapView xmlns:android="http://schemas.android.com/apk/res/android" android:id="@+id/mapview" android:layout_width="fill_parent" android:layout_height="fill_parent" android:clickable="true" android:apiKey=&lt;b&gt;&lt;u&gt;  GoogleMaps API&lt;/u&gt;&lt;/b&gt; /&gt;</code> <br></code> <br><br>  Here you need to specify the key to the GoogleMaps API.  I did not shine my own :) You can read about how to get it <a href="http://code.google.com/android/add-ons/google-apis/mapkey.html">here</a> . <br>  Well, actually activate the card: <br><br>  Map.java <br><br><pre> <code class="hljs pgsql"><code class="java"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Map extends MapActivity { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> MapView mapView; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> MapController mapController; private RecordsDbHelper mDbHelper; @Override <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.map); //  mapView = (MapView) findViewById(R.id.mapview); //    mapView.setBuiltInZoomControls(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); mapController = mapView.getController(); //        mapView.post(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Runnable() { @Override <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> run() { //  mDbHelper = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> RecordsDbHelper(Map.this); mDbHelper.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span>(); // . ,   id   ,      Bundle extras = Map.this.getIntent().getExtras(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (extras != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { long str = extras.getLong("ID"); //  id      <span class="hljs-keyword"><span class="hljs-keyword">Cursor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">cursor</span></span> = mDbHelper.getById(str); startManagingCursor(<span class="hljs-keyword"><span class="hljs-keyword">cursor</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">cursor</span></span>.moveToFirst(); <span class="hljs-type"><span class="hljs-type">double</span></span> x = <span class="hljs-keyword"><span class="hljs-keyword">cursor</span></span>.getDouble(<span class="hljs-keyword"><span class="hljs-keyword">cursor</span></span>.getColumnIndex(RecordsDbHelper.KEY_X)); <span class="hljs-type"><span class="hljs-type">double</span></span> y = <span class="hljs-keyword"><span class="hljs-keyword">cursor</span></span>.getDouble(<span class="hljs-keyword"><span class="hljs-keyword">cursor</span></span>.getColumnIndex(RecordsDbHelper.KEY_Y)); // GeoPoint       //  GeoPoint <span class="hljs-type"><span class="hljs-type">point</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> GeoPoint((<span class="hljs-type"><span class="hljs-type">int</span></span>) (x * <span class="hljs-number"><span class="hljs-number">1E6</span></span>), (<span class="hljs-type"><span class="hljs-type">int</span></span>) (y * <span class="hljs-number"><span class="hljs-number">1E6</span></span>)); //      mapController.animateTo(<span class="hljs-type"><span class="hljs-type">point</span></span>); mapController.setZoom(<span class="hljs-number"><span class="hljs-number">16</span></span>); } } }); } }</code></code> </pre> <br><br>  Here: <br>  1. Standard ZoomIn and ZoomOut buttons are installed on the map (using setBuiltInZoomControls ()) <br>  2. Our DB opens. <br>  3. From the intent that caused this activation, the id of the record that was passed in the click handler to the list item (I wrote about this above) is pulled out, and the id from the base gets the necessary line from which we need the coordinates of the station. <br>  4. The coordinates are pulled using the getDouble method obtained as a result of the query. <br>  5. Next, GeoPoint is created and coordinate transformations are performed (fractional data are stored in the database, and Google needs integer numbers. For this, you need to multiply 10 ^ 6 from the database and round it). <br>  6. animateTo () and setZoom () shift the map to the right place and set the zoom level. <br><br>  Fuh, in general, everything.  As you can see, quite simple things are behind quite trivial things, which are not so easy for a beginner to deal with.  Therefore, I really hope that the experience I shared will help someone not to lose enthusiasm because of problems at the start, and high-quality applications that optimize our lives will be more! <br><br>  The entire project can be found at the <a href="https://github.com/LaGenteEstaMuyLoca/MetroLookup">link</a> . </div><p>Source: <a href="https://habr.com/ru/post/129234/">https://habr.com/ru/post/129234/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129228/index.html">There are already 43 million users on Google+</a></li>
<li><a href="../129229/index.html">Prices for PlayBook tablets reduced by 100-200 dollars</a></li>
<li><a href="../129231/index.html">3D technologies of the future: Sony's Personal 3D Viewer HMZ-T1</a></li>
<li><a href="../129232/index.html">The unique scheme of hacking mobile phones in Russia - how it worked</a></li>
<li><a href="../129233/index.html">We write a bot, or "The Tale of the Good Bot"</a></li>
<li><a href="../129235/index.html">Haskell in the real world</a></li>
<li><a href="../129236/index.html">Interfaces: Simplify the search engine (or why we don‚Äôt)</a></li>
<li><a href="../129237/index.html">Dojo-do-it-yourself widget</a></li>
<li><a href="../129239/index.html">Start Motivate Clock: ‚ÄúDo not think about seconds down‚Äù</a></li>
<li><a href="../129240/index.html">Tuning for the Public folder in Dropbox</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>