<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SIEM depths: out-of-box correlations. Part 1: Pure marketing or unsolvable problem?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How often do you hear the statement that the correlation rules supplied by the SIEM manufacturer do not work and are deleted, or are turned off immedi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SIEM depths: out-of-box correlations. Part 1: Pure marketing or unsolvable problem?</h1><div class="post__text post__text-html js-mediator-article">  How often do you hear the statement that the correlation rules supplied by the <abbr>SIEM</abbr> manufacturer do not work and are deleted, or are turned off immediately after installing the product?  At information security events, any section dedicated to SIEM, in one way or another, addresses this issue. <br><br>  Let's take a chance and try to find a solution to the problem. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gh/bb/09/ghbb09df50z6lbyh9ozgsb96ppo.jpeg" alt="SIEM rules out of the box"></div><br><a name="habracut"></a><br>  Most often, the main problem is that the correlation rules of the manufacturer SIEM are not initially adapted to the particular infrastructure of a particular customer. <br>  Analyzing the problems voiced at different sites, it seems that the problem has no solution.  Introducing SIEM, you still have to either very much refine what the manufacturer supplies, or throw out all the rules and write your own from scratch, and this problem is inherent in all solutions from any part of the Gartner quadrant. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Unwittingly you ask yourself: is it really that bad and is this Gordian knot impossible to cut?  Is the expression ‚ÄúCorrelation rules working out of the box‚Äù really just a marketing slogan for which there is nothing worth? <br><br>  The article may interest you if: <br><br><ul><li>  You are already working with some kind of SIEM solution. </li><li>  Only plan its implementation. </li><li>  Gathered to build your SIEM with blackjack and correlations based on the ELK stack, or something else. </li></ul><br><h1>  What will the articles be about? </h1><br>  In this series of articles we will list the main problems that hinder the implementation of the concept of ‚ÄúCorrelation Rules Working Out of the Box‚Äù, and also try to describe a systematic approach to solve them. <br><br>  At once I will make a reservation that by technical experts this article can be characterized as: ‚Äúwater‚Äù, ‚Äúabout nothing‚Äù.  All it is, but not quite.  Before you deal with a difficult task, you want to first find out why it originated and what its solution gives us. <br><br>  For a better understanding of the whole range of issues that will be presented, I will give the general structure of the whole cycle of articles: <br><br><ul><li>  <b>Article 1:</b> This article.  Let's talk about the formulation of the problem and try to understand why we generally need the rules "Correlation rules that work out of the box."  The article will be ideological in nature and, if it becomes completely boring, you can skip it.  But I do not advise doing this, because  in the following articles I will refer to it often.  Here we will discuss the main problems that stand in our way, and methods for their solution. </li><li>  <b>Article 2:</b> Hooray!  It is here that we get to the first details of the proposed approach to solving the problem.  We describe how our protected information system SIEM should ‚Äúsee‚Äù.  Let's talk about what should be a set of fields necessary for the normalization of events. </li><li>  <b>Article 3:</b> We describe the role of categorizing events and how the methodology of event normalization is built on its basis.  We show how IT events differ from IS events and why they should have different categorization principles.  Let us give living examples of the work of this methodology. </li><li>  <b>Article 4: We will</b> closely look at the assets of which our automated system is composed and see how they affect the performance of the rules.  Make sure that with them, too, is not so simple: they must be identified and constantly maintained up to date. </li><li>  <b>Article 5:</b> That for which everything was started.  We describe an approach to writing correlation rules, based on all that was described in previous articles. </li></ul><br><h1>  Task setting and why it is important </h1><br>  Let's try to formulate our task in general terms: ‚ÄúI, as a customer who bought the SIEM solution, subscribe to update the rule base and pay the manufacturer (and sometimes the integrator) for support, I want the correlation rules to be promptly supplied to me would be in my SIEM and immediately benefited. "  As for me, I‚Äôm quite sober a wish that is not burdened with some kind of architectural or structural technical limitations. <br><br>  And now, attention, let's say that we have already solved all the problems and our task has already been completed.  What does this give us? <br><br><ul><li>  <b>First</b> , we save labor costs of our specialists.  Now they do not need to spend time studying the logic of each new rule and adapting it to the realities of a particular automated system. </li><li>  <b>Secondly</b> , we save the budget, because  We do not ask the integrator, or someone else for a separate money to write or adapt the rules for us. </li><li>  <b>Thirdly</b> , all significant players in the SIEM market have research departments and departments that are purposefully engaged in analyzing information security threats.  It is important to use their experience, especially if we pay for it. </li><li>  <b>Fourth</b> , we reduce the time of our reaction to new threats.  I will not write about the eternity that passes between the appearance of a threat, the development of correlation rules for its detection and the implementation of a specific product from a specific customer, many articles have already been written on this topic. </li><li>  <b>Fifth</b> , it brings us all closer to the possibility of sharing among ourselves the unified rules that will work for any customer, within the framework of a specific SIEM solution, of course. </li></ul><br>  Many technical specialists who came across the solution of the task and finished reading this place will immediately object: "Yes, of course there are pluses, but this is technically unrealizable."  Personally, I think that the task is quite ‚Äúlift-up‚Äù and already now, both in the western and Russian markets, there are SIEM, which contain all the elements necessary to solve it.  I want to focus your attention on this - the products allow us not to solve the problem, but only contain all the necessary blocks, from which, as a designer, we can assemble the solution we are looking for. <br><br>  I think this is very important, because  Everything that will be described later can be implemented in almost any existing and mature SIEM. <br><br>  Quite lyric, then we will talk in more detail about the problems that arise in the way of solving our problem. <br><br><h1>  The challenges we face </h1><br>  In search of a solution to the above problem, let's see what problems we have to face.  Allocation of the main problems will allow a better understanding of the issues, as well as develop a systematic approach to solve them. <br>  The problems that we face are a snowball, each of which dramatically aggravates the situation.  The set of all these problems leads to the fact that creating ‚ÄúCorrelation Rules that work out of the box‚Äù is extremely difficult. <br><br>  In general, problems are divided into the following four large blocks: <br><br><ol><li>  Data loss during normalization associated with the transformation of the models of the "world". </li><li>  The lack of clear and generally accepted rules for the normalization of events. </li><li>  Permanent "mutation" of the object of protection - our automated system. </li><li>  Lack of rules for writing correlation rules. </li></ol><br><a name="Problems"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n3/1x/1t/n31x1tes6efryi7eb9qb2to5zhs.png" alt="SIEM problems of correlations"></div><br><br>  Let's now look at these issues in more detail. <br><a name="ModelTransform"></a><br><h2>  Transformation of the world model </h2><br>  This problem is easiest to describe using the following analogy. <br>  The world around us is diverse and multifaceted, but our hearing and vision captures only a limited range of radiations.  Having seen or heard some phenomenon, we build in our head the image of this event, operating with its already trimmed model.  For example, our eye does not see in the infrared spectrum, and the ear does not detect vibrations below 16 Hz.  This is the first transformation of the original phenomenon.  In our model, our fantasy happens to bring what was not in the original phenomenon.  We can tell the interlocutor about this phenomenon, using oral speech with all its limitations and peculiarities.  This is the second transformation of the model.  Finally, the interlocutor, in our words, decides to write about this phenomenon to his colleague in the messenger.  This is the third and most likely the most dramatic transformation of the model in terms of information loss. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pp/in/ag/ppinag98coxnzjuoonjin83tfcm.png" alt="SIEM model transformation"></div><br>  In the example described above, we observe a classical problem, to which the original ‚Äúconceptual model‚Äù ( <i>Boards B. Ya., Yakovlev S. A., System modeling</i> ), by simplification, is transformed into another model while losing in detail. <br>  Exactly the same thing happens in the world of events generated by software or hardware. <br><br>  The explanation can serve this simplified picture already from our subject area: <br><br><ul><li>  <b>The first</b> transformation of the model.  An executable file was loaded into RAM, the OS began to carry out the instructions described in it.  The operating system sends part of the information to the daemon / logging service (auditd, eventlog, etc.).  If you do not include an extended audit of actions, then some of the information is not included in this daemon.  But even with an extended audit, some of the information will still be discarded, because  OS developers have decided that just this amount of information is enough to understand what is happening. </li><li>  <b>The second</b> transformation of the model.  And now the daemon / service creates an event, writes information to the disk and here we understand that the length of the event string can be limited to a certain number of bytes.  If the daemon / service maintains a structured log, then it contains some event schema with certain fields.  What to do if there is so much information that it doesn‚Äôt fit in the ‚Äúwired‚Äù scheme?  That's right, most likely this information will be simply discarded. </li></ul><br>  Now what it looks like within our task. <br>  We already have a simplified model (which has already lost a lot of details) of some phenomenon represented by a record in the log file ‚Äî an event.  SIEM reads this event, normalizes it by distributing data across the fields of its scheme.  The number of fields in the scheme a priori cannot contain as many as is necessary to cover all possible semantics of all events from all sources, that is, at this step, the model is also transformed and data is lost. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ud/2r/us/ud2rushwrs4ocz7d7dfhr7bdjty.png"></div><br>  It is important to understand that due to the presence of this problem, the expert, analyzing the logs in the SIEM or describing the correlation rule, sees not the initial event itself, but its at least twice distorted model, which has lost quite a lot of information.  And, if the lost information is extremely important in investigating the incident and, as a result of writing the rule, it will have to be retrieved from somewhere.  Finding the missing information to an expert is possible either by referring to the original source (raw event, memory dump, etc.), or by modeling the missing data in your head based on your experience, which is impossible to do directly from the correlation rules. <br><br>  A good indicator of this problem is, if not strange, fields such as Customer device string, Datafield, or something else.  These fields represent a kind of "dump" where, put the data that do not know where to put, or when all other suitable fields are simply filled. <br><br>  The set of taxonomy fields, as a rule, reflects the model of the "world" as the SIEM developer sees the subject area.  If the model is very ‚Äúnarrow‚Äù, then there will be a small number of fields in it and when normalizing some of the events, they will simply be missed.  This problem often has a SIEM with an initially fixed and dynamically non-expandable set of fields. <br><br>  On the other hand, if there are too many fields, there are problems associated with a lack of understanding in which field it is necessary to put certain data of the original event.  This situation entails the possibility of the emergence of semantic duplication, when semantically the same data of the original event fits immediately under several fields.  This is often observed in solutions where the set of scheme fields can be dynamically expanded with any normalization module supported by a new source. <br><br>  If there is a ‚Äúcombat‚Äù SIEM on hand, look at your events.  How often do you use reserved additional fields (Custom device string, Datafield, etc.) during normalization?  Many types of events with additional fields filled in indicate that you are observing the first problem.  Now remember, or ask your colleagues, how often with the support of a new source, they had to add a new field, because the reserved ones were not enough?  The answer to this question is an indicator of the second problem. <br><br><h2>  Event Normalization Methodology </h2><br>  It is important to remember who and how normalizes events, because  It plays an important role.  Some sources are supported directly by the developer of the SIEM solution, part of the integrator who implemented the SIEM for you, and part by yourself.  It is here that the following problem awaits us: Each of the participants interprets the meaning of the fields of the event map in their own way and therefore normalizes differently.  Thus, semantically identical given different participants can decompose into different fields.  Of course, there are a number of fields, the name of which does not allow for a dual interpretation.  Suppose src_ip or dst_ip, but even with them there are difficulties.  For example, in network events, is it necessary to change src_ip to dst_ip when normalizing incoming and outgoing connections within one session? <br><br>  Based on the above, it is necessary to create a clear methodology for supporting sources, within which it would be explicitly stated: <br><br><ol><li>  What fields of the scheme are needed for. </li><li>  What data types to which fields correspond. </li><li>  What information is important to us within each type of event. </li><li>  What are the rules for filling the fields. </li></ol><br><h2>  The object model of protection and its mutation </h2><br>  As part of the solution of the task, the object of protection is our automated system (AS).  Yes, it is the AU in the definition of <a href="http://protect.gost.ru/document.aspx%3Fcontrol%3D7%26id%3D137473">GOST 34.003-90</a> , with all its processes, people and technology.  This is an important note, we will return to it later in the following articles. <br><br>  The word "mutation" is not chosen here by chance.  Let's remember that in biology, mutation is understood as persistent changes in the genome.  What is the AU genome?  As part of this series of articles under the AU genome, I will understand its architecture and structure.  A "lasting change" - nothing more than the result of the daily work of system administrators, network engineers, information security engineers.  Under the actions of these changes, the AU every minute passes from one state to another.  Some states are characterized by a greater level of security, some less.  But now for us it does not matter. <br><br>  It is important to understand that the AU model is not static, all parameters of which are described in the technical and working documentation, but a living, constantly mutated object.  SIEM, when building a model of the object of protection within itself, must take this into account and be able to update it promptly and promptly, keeping up with the rate of mutation.  And, if we want to make the correlation rules ‚Äúwork out of the box‚Äù, it is necessary that they take into account these mutations and always operate with the most actual picture of the ‚Äúworld‚Äù. <br><br><h2>  Methodology for developing correlation rules </h2><br>  From the above <a href="https://habr.com/ru/company/pt/blog/423431/">‚Äúpyramid‚Äù</a> it is clear that in developing the rules of correlation, we are forced to fight about all the problems that lie at lower levels.  In the fight against these problems, the rules impart superfluous logic: additional filtering of events, checking for null values, converting data types and transforming this data (for example, extracting the domain name from the full domain user name), isolating information about who interacts with whom and within the event. <br><br>  After all this, the rules are overgrown with such a number of sensible expressions, the search for substrings and regular expressions, that the logic of their work becomes clear only to their authors and that until the moment of their closest leave.  Moreover, the constant changes of the automated system - mutations require regular updating of the rules to combat falls.  Familiar picture? <br><br><h1>  Eventually </h1><br>  As part of this series of articles, we will try to understand how to make the correlation rules work out of the box. <br><br>  To solve the problem we have to face the following problems: <br><br><ol><li>  Data loss during the transformation of the ‚Äúworld‚Äù model at the stage of normalization. </li><li>  The lack of rosary defined methodology normalization. </li><li>  Constant mutation of the object of protection under the influence of people and processes. </li><li>  Lack of methodology for writing correlation rules. </li></ol><br>  Many of these problems lie in the plane of constructing the correct event scheme ‚Äî the set of fields and the process of normalizing events ‚Äî the foundation of the correlation rules.  Another part of the problem is solved by organizational and methodological methods.  If we manage to find a solution to these problems, then the concept of working out-of-the-box rules will give a wide positive effect and raise the expertise that manufacturers put at SIEM to a new level. <br><br>  What's next?  In the next article we will try to deal with the loss of data when transforming the ‚Äúworld‚Äù model and think about what the required set of fields for the problem - the scheme should look like. <br><br><hr><br>  <b>Cycle of articles:</b> <br><br>  SIEM depths: out-of-box correlations.  Part 1: Pure marketing or unsolvable problem?  ( <i>This article</i> ) <br><br>  <a href="https://habr.com/company/pt/blog/424975">SIEM depths: out-of-box correlations.</a>  <a href="https://habr.com/company/pt/blog/424975">Part 2. Data schema as a reflection of the ‚Äúworld‚Äù model</a> <br><br>  <a href="https://habr.com/company/pt/blog/432352/">SIEM depths: out-of-box correlations.</a>  <a href="https://habr.com/company/pt/blog/432352/">Part 3.1.</a>  <a href="https://habr.com/company/pt/blog/432352/">Event categorization</a> <br><br>  <a href="https://habr.com/company/pt/blog/433606/">SIEM depths: out-of-box correlations.</a>  <a href="https://habr.com/company/pt/blog/433606/">Part 3.2.</a>  <a href="https://habr.com/company/pt/blog/433606/">Event Normalization Methodology</a> <br><br>  <a href="https://habr.com/ru/company/pt/blog/441098/">SIEM depths: out-of-box correlations.</a>  <a href="https://habr.com/ru/company/pt/blog/441098/">Part 4. System model as a context of correlation rules</a> </div><p>Source: <a href="https://habr.com/ru/post/423431/">https://habr.com/ru/post/423431/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../423421/index.html">Why for indie before the grass was greener</a></li>
<li><a href="../423423/index.html">MIT course "Computer Systems Security". Lecture 8: "Model of network security", part 3</a></li>
<li><a href="../423425/index.html">Old school: what were the games on - we are discussing unusual carriers</a></li>
<li><a href="../423427/index.html">IndieVisible - an online community of indie developers built on an open source platform.</a></li>
<li><a href="../423429/index.html">Database update and zero-downtime deployment</a></li>
<li><a href="../423437/index.html">The digest of interesting materials for mobile developer # 270 (September 10 - 16)</a></li>
<li><a href="../423439/index.html">Report of the Club of Rome 2018, Chapter 2.6: ‚ÄúPhilosophical Errors of Market Doctrine‚Äù</a></li>
<li><a href="../423441/index.html">Exonum first buyding: why we chose Java</a></li>
<li><a href="../423445/index.html">Creating an online store structure: category map</a></li>
<li><a href="../423447/index.html">GLPH: New Content Marketing Podcast</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>