<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Easy way to write iOS apps on the web</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. Not so long ago, Gabriel gave us the game 2048 . This is the most amazing case when a clone of the game becomes more popular than the original....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Easy way to write iOS apps on the web</h1><div class="post__text post__text-html js-mediator-article">  Hello.  Not so long ago, Gabriel gave us the game <a href="http://habrahabr.ru/post/215291/">2048</a> .  This is the most amazing case when a clone of the game becomes more popular than the original.  Not a small part of the success of Gabriel - open source and, voila, MIT license.  Having scored a little more than 20k points, I wanted to share the result with friends, except how to take a screenshot did not work.  The appstor looked at the presence of a clone with a game center or something similar - empty.  And then I thought, why not? <br>  Looking ahead, it took 4 days to create the application and all the ‚Äúnishtyakov‚Äù.  The output is a universal code that works partly on the web and is easily ported to iOS and Android.  However, let's go in order. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/085/274/2c4/0852742c40835b3320b99e1b6875bb32.png"><br><a name="habracut"></a><br>  As you already understood, the discussion will deal with the development of native applications on web technologies.  For those who are in the tank, everything works quite simply.  A project is created with native SDKs, the purpose of which is to place the WebView full screen and open a specific html in it.  Those.  it turns out that the entire application is reduced to the browser with a wired address bar.  You can argue long, good or bad.  In a network of heaps of holivars about this, someone prefers html5, someone has a native code.  I am writing this way and that, but here, having the source code for 2048 on the web, it would be foolish to rewrite everything to a native objc.  And then, if we are talking about a small application, the main task of which is front-end + working with the server, again it‚Äôs stupid to fence objc when you can get by with html5. <br>  Let's just say <a href="https://itunes.apple.com/ru/app/wunderlist-to-do-task-list/id406644151%3Fmt%3D8">wunderlist</a> works great on web technologies.  Like the official <a href="https://itunes.apple.com/ru/app/gmail/id422689480%3Fmt%3D8">gmail</a> client. <br><br>  Our team in the main workplace does b2b projects.  These are projects where a good ebida is done with minimal attendance.  So it is with us, the minimum values ‚Äã‚Äãare unique per day.  Therefore, we can "play" technology.  While some are building up for ie8, we told our customers that only firefox or chrome, and they unconditionally set these browsers to the employees.  Therefore, we have been using all sorts of html5 for quite a long time and are happy.  However, when the idea to make such a project came to mind, I could not even imagine how interesting and new it would be, despite the fact that in general I knew and partially applied almost all the technologies described below. <br>  Let's start with the environment, then we will go through the technologies and discuss the mistakes, draw conclusions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/ed8/07a/7ac/ed807a7ac675c4733699fef60d78d8c2.png" alt="image"><br><br><h4>  1. Environment. </h4>  The father of WebView for cell phones, of course, is <a href="http://phonegap.com/">phoneGap</a> .  It is not badly documented (what is there to document it?) And is quite simple.  What does he do?  Like other frameworks that allow you to create native web-based applications, phonegap pushes native capabilities into JS code and back.  Those.  you write as written before, adapt the design for a mobile device + have JS calls, allowing you to work with the camera, notifications, contacts, SMS and other things.  The list of features and platforms is available on a <a href="http://phonegap.com/about/feature/">special page</a> .  It was built on the basis of <a href="http://cordova.apache.org/">Cordova</a> . <br>  I also advise you to look in the direction of <a href="http://www.sencha.com/">Sencha</a> , the guys went a little further and make it possible not only to get access to native phone / tablet chips via JS, but also give native UI.  Those.  while making one application, it will look like native in both android and ios.  However, sencha is extjs with all that it implies.  It's like cilantro, there are people who are crazy about her and people who can not stand her) However, for general information, I advise you to look at it. <br>  I would also like to elaborate on <a href="http://cordova.apache.org/">Cordova</a> .  Fongap is more surroundings.  There is paid support, cloud services for generating applications, etc., etc.  Cordova is a platform.  Directly native modules and JS binding. <br><br>  In this case, we will not use any of the above.  First, I wanted to try to do everything from scratch.  For myself, I decided, further applications only Cordova, the ideal ratio of flexibility and speed.  Secondly, I did not manage to quickly deal with the environment of Phongap or Cord.  Not to mention sencha.  All of them offered to make applications with embedded html, and we now consider the situation when the code lies on an external server. <br>  Why an external server?  I wanted to make an application that I could update not when it was moderated in the appstore (usually takes a week), but when I find bugs in it.  Let's take it in order. <br><br><h5>  1.1 <a href="http://topcoat.io/">TopCoat</a> </h5>  There are many frameworks for creating mobile UIs in the network, including those with ala-native UI.  Already talked about sencha, just pay attention to <a href="http://phonejs.devexpress.com/">PhoneJS</a> , <a href="http://jquerymobile.com/">JQ Mobile</a> , <a href="http://app-framework-software.intel.com/">Intel AF</a> and many others.  Google will tell) <br>  In this case, I chose topcoat.  I have already met him on another project and I really liked him.  Firstly, these are not bad custom UIs that look great on both android and ios.  Secondly, the topcoat is very simple, hence flexible.  After Bootstrap it was a little uncomfortable, due to the lack of a grid, naprmer, etc.  But you get used to it quickly) <br>  Topcoat has a branch with icons icomatic, I do not recommend.  <a href="http://fortawesome.github.io/Font-Awesome/">Font awesome</a> best. <br><br><h5>  <s>1.2 <a href="https://github.com/cubiq/iscroll">iScroll</a></s> </h5>  <b>UPD:</b> Habrapamer <a href="https://habrahabr.ru/users/radist2s/" class="user_link">radist2s</a> <a href="http://habrahabr.ru/post/216697/">suggested</a> that iScroll as a whole is not needed if you want to implement close to native scrolling.  It turns out enough zayuzat <br><pre><code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">-webkit-overflow-scrolling</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">touch</span></span>;</code> </pre>  Undoubtedly, swipe and scrolling are the calling card of mobile solutions.  iScroll gives you very close to native scrolling.  Online iScroll4 is not less distributed than the latest iScroll5.  Accordingly, the new more advanced and reckless.  There are many examples on offsite, in general, everything is clear. <br><br><h5>  1.3 <a href="http://zeptojs.com/">Zepto</a> </h5>  Replacing jQuery, faster selectors and for mobile applications is the most.  In large projects, we use jQuery due to the huge number of plugins, all we need is selectors) <br><br><h5>  1.4 <a href="http://lodash.com/">Lodash</a> </h5>  Just an auxiliary add-on over JS.  We often use backbonejs in projects, lodash is de facto required.  Well, in practice, it is not much slower than the native code.  Sometimes faster. <br><br><h5>  1.5 <a href="http://momentjs.com/">Moment</a> </h5>  Work with dates / times in JS.  Without comments, without this library, a headache would be many times more. <br><br>  I did not use Backbone in the project, although he asks very much here.  Again, save on matches.  Backbone is convenient and indispensable in more or less complex applications, but here it is useless.  At least I thought so) <br>  I can not fail to note <a href="http://rad-js.com/">rad-js</a> , these are custom backbone objects ground for the development of mobile applications.  Nice stuff, but pretty sophisticated.  It is also very unfortunate that RAD largely uses the old code.  For example, it hooks the old iScroll and undercore, instead of lodash.  Again, in this project its use seemed redundant. <br>  Deal with the environment.  We do not have MVC or similar framework, all the functionality of the application is put into a simple js object.  We have a ready css framework and the necessary set of JS libraries for quick development. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/78a/89e/a34/78a89ea3428dcbec6f87fe8ef4ecee89.png" alt="image"><br><br><h4>  2. Technology </h4>  It's amazing how in the last 2 years technologies and browsers have grown.  2 years ago I chose between web technologies and native code.  Under the big project, I chose the native code.  And that was the right decision.  Now, for good, to rewrite everything on the web and develop further the web.  But it‚Äôs already a pity, thousands of lines of native obj-c, whether it is not fine.  I'm silent about it. <br><br><h5>  2.1 LocalStorage </h5>  Well, everything is clear, storage.  5 meters more than, especially since we need it for text / js-objects.  Those who have worked at least once with memokes / radishes will be happy.  If 5 meters is not enough, you can bind through the native UserData, for example.  There are many solutions online.  Someone suggests adding a cache to files, someone via UserData, someone recommends WebSQL, which, by the way, is also convenient.  We have enough localStorage. <br><br><h5>  2.2 AppCache </h5>  Perhaps it is only thanks to this technology that we make an application with external code.  Once again, our application is not hosted in local html files, but on a remote server.  It is logical that if you do not have Internet at the moment, external sites will not open.  This is where appCache will save us.  About <a href="http://habrahabr.ru/search/%3Fq%3Dapplication%2Bcache">Application cache</a> there were many articles, who have not come across this technology, I advise you to read.  The meaning is quite simple.  Using a special manifest file, we indicate to the browser all the files that need to be placed in the cache.  The beauty is that files placed in the cache will work even if there is no Internet in the device.  The logic of the app work in the application is simple. <br>  The client starts the application for the first time, it sucks the content into the webview, the webview caches the application.  Next, each time you start the application, the change manifest file is checked.  If it has changed, the cache is completely overwritten.  If there are no changes, the work continues.  Accordingly, if the user does not have the Internet, it just clings to the cache without updates. <br>  Thus, we can do not just native web-based applications, but also place the code directly on our server.  For what it is necessary, I wrote above - instant bugfix and fast publishing of new chips. <br><br><h5>  2.3 CSS3 </h5>  And, of course, it is foolish to ignore all the possibilities of a webcam.  In general, making a mobile application on the web should always remember that we do it with one or two browsers, which are super modern and more often support new technologies than ignore them.  Those.  it will be good practice to use flexbox, freely use the animation and forget about pngfix) <br>  In this application, almost all the animation is based on css3.  First, it is easier and faster than writing kilometers of JS code.  Secondly, it works super fast due to hardware acceleration, which can be enabled in the webcam for animation. <br><br>  Perhaps this is enough) Next, you need to prepare a project in XCode. <br>  As already said, everything is quite simple, we need only a UIWebView on the whole screen and nothing more.  I connected to the project <a href="https://github.com/johnezang/JSONKit">JSONKit</a> , because  it is faster than the native parser + VK-SDK, Facebook-SDK for integration with social networks.  Of course, it was possible to do the integration on the web, but for attractiveness, I wanted to do native support for vk + facebook.  Do not forget about the capabilities of ios sdk.  Those.  Web technologies are cool and powerful, but there are tasks that are best implemented natively.  Integration with social networks is one of these tasks, I think. <br>  All that remains for us to do is to establish a connection between our html code and the application.  Here, too, everything is quite simple.  WebView, what we have placed, you need to make in our controller. <br>  Messages from the application to the web are very simple, from any place we pull: <br><pre> <code class="objectivec hljs">[webView stringByEvaluatingJavaScriptFromString:<span class="hljs-string"><span class="hljs-string">@"alert(123);"</span></span>]</code> </pre><br>  Messages from the web to the application work as follows.  The done WebView sniffs all transitions, we can make the links we need and intercept them in the shouldStartLoadWithRequest method: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ontouchend</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"window.location='vk:auth';"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="objectivec hljs">- (<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>)webView:(<span class="hljs-built_in"><span class="hljs-built_in">UIWebView</span></span> *)webView shouldStartLoadWithRequest:(<span class="hljs-built_in"><span class="hljs-built_in">NSMutableURLRequest</span></span> *)request navigationType:(<span class="hljs-built_in"><span class="hljs-built_in">UIWebViewNavigationType</span></span>)navigationType { <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *requestString = [[request URL] absoluteString]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([requestString isEqualToString:<span class="hljs-string"><span class="hljs-string">@"vk:auth"</span></span>]) { [VKSdk authorize:@[VK_PER_FRIENDS, VK_PER_WALL] revokeAccess:<span class="hljs-literal"><span class="hljs-literal">YES</span></span> forceOAuth:<span class="hljs-literal"><span class="hljs-literal">YES</span></span> inApp:<span class="hljs-literal"><span class="hljs-literal">YES</span></span> display:VK_DISPLAY_IOS]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NO</span></span>; } }</code> </pre><br>  Accordingly, if we intercept the address we need, do not forget to make return NO, otherwise the web version will try to go to the address vk: auth. <br>  In general, that's all, we have a web muzzle that is able to hard cache and work offline and communicate with the native application.  What else is needed for happiness?  ) <br><br><h4>  Errors and notes for the future </h4><br>  In the next article I will describe how to use Cordova with external code.  Undoubtedly, error # 1 was the decision to write its shell on xcode.  But again, the task was to study the process in order to understand the whole story.  Therefore, it is not entirely a mistake.  I do not recommend using their shells, except for reference.  In any other projects there is nothing better than Cordova.  And all that she does not know how, you can implement in the form of plug-ins for it. <br>  Also, ignoring the backbone was a mistake.  The application is already beginning to grow, further refinement would be much simpler and clearer if the mbc backbone framework were used immediately. <br>  Among other things, I was hard fucked with the setting of NSURLRequest.  This is the request object for WebView, which, in fact, opens the URL we need.  One of the parameters of which is cachePolicy, where you need to transfer the caching policy.  For example, you can use the standard policy (approximately corresponds to the browser), or, for example, indicate that the request should never be cached at all, or vice versa, taken only from the cache, regardless of the headers.  After reading about the NSURLRequestReloadIgnoringLocalAndRemoteCacheData flag, I decided to use it.  The application worked obviously, I left it.  And only then it turned out that this flag is not implemented in ios sdk))) <br><br>  As for the game itself, at the time of sending the binary for moderation, there were no 2048 games in the appstore. At the time of publication there were more than 60 of them. First, I embedded mobile adsense code in the html code.  However, before the publication itself, I removed it and made the application a paid one, since  All these 60+ games were free with ads inside.  It seems like some kind of custom) method of replacing a variable.  It should be understood that I have no task to make money on this game, but there is no sense in supporting it for free either.  The main difference from competitors is integration not with GameCenter, but with social networks.  It is personally more interesting for me to see who I have overtaken among my friends on VK than on the unfilled GameCenter profile.  Well, it's easier to follow the "hackers", because  base on your server.  If such things seem to a group of users more interesting and people will not mind spending 33 rubles per game, it can be developed further.  There were ideas to build global rankings, who are gaining more.  For example, men or women, adults or teenagers.  MGU or MGIMO itp.  All this data is collected from social networks. <br><br>  In any case, this is only a "first attempt at writing."  Most of all hemorrhoids I earned by drawing icons in different sizes.  A total of 18 icons of different sizes + 13 starting screens. <br><br>  <b>UPD:</b> Regarding the legality of such applications in the AppStore, I recommend <a href="http://habrahabr.ru/post/216697/">reading the</a> @mifki <a href="http://habrahabr.ru/post/216697/">comments</a> , if everything is as it says, then the application just needs to go through the review and it will not be removed for using the code on the side.  However, <a href="https://habrahabr.ru/users/alamantrah/" class="user_link">alamantrah</a> <a href="http://habrahabr.ru/post/216697/">claims</a> that his application was removed for external lua. <br>  Also on <a href="http://stackoverflow.com/questions/6349848/phonegap-application-with-remote-java-scripts">StackOverlow,</a> a confirmation was found that earlier the application was not allowed for external scripts, but now the security policy has changed and everything is ok. </div><p>Source: <a href="https://habr.com/ru/post/216697/">https://habr.com/ru/post/216697/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../216685/index.html">Questions to Jeffrey Richter</a></li>
<li><a href="../216687/index.html">Exchange Mt. Gox announced the discovery of more than $ 100 million in user funds in its own wallet</a></li>
<li><a href="../216689/index.html">Five things to consider when thinking about the architecture of an online store</a></li>
<li><a href="../216691/index.html">How to plant a neighbor on Linux, or a little bit about tangerines in the context of OS</a></li>
<li><a href="../216695/index.html">About patriotism and realism</a></li>
<li><a href="../216701/index.html">One! = The only one? Registry of banned sites</a></li>
<li><a href="../216711/index.html">Techniques for character development in games: Part 1 - Tarot</a></li>
<li><a href="../216713/index.html">Long Polling for Android</a></li>
<li><a href="../216715/index.html">Broccoli: first beta release</a></li>
<li><a href="../216719/index.html">As a single prosecution, Microsoft destroyed the trust of customers in the integrity of their data in the "cloud" services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>