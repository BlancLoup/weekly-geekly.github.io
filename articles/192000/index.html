<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bootstrap, or application statistics with almost no formulas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the institutes, students are taught to integrate analytically, and then it is found that in practice almost all integrals are considered numerical ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bootstrap, or application statistics with almost no formulas</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage3/b95/684/067/b956840675c4d065e81c435c2ce91bf3.jpg" align="left" alt="Bootstrap">  At the institutes, students are taught to integrate analytically, and then it is found that in practice almost all integrals are considered numerical methods.  Well, or at least check the analytical solution in this way. <br><br>  In statistics, there is also a dishonest method that allows you to get an approximate answer to many practical questions without analysis, with brute computer force: bootstrap.  Invented and published it in 1979 by Bradley Efron. <br><a name="habracut"></a><br>  Suppose we have an online store where we trade in all sorts of things and attract customers in various ways.  It is clear that we are constantly testing something - the arrangement of pictures and buttons on a page, advertising text, AdWords, banners on partner sites, and so on.  And here are the latest results - in the test group of 893 who came from us bought something 34, and in the control group of 923 who came came bought 28. <br><br>  The question arises - go to the authorities and say ‚Äúin the test group the conversion is 3.81%, in the control group 3.03%, there is an improvement of 26%, where is my premium?‚Äù Or continue collecting data, because the difference of 6 people is not yet statistics? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This problem is easy to solve analytically.  We see two random variables (the percentage of conversion in the test and control groups).  With a large number of observations, the binomial distribution is similar to the normal one.  We are interested in the difference.  The normal distribution is infinitely divisible, we subtract the expectations and add up the variances, we get the expectation of 34 / 893-28 / 923 = 0.77% and the variance (34/893) * (1-34 / 893) / 893 + (28/923) * (1- 28/923) / 923.  The standard deviation is equal to the root of the variance, in our case 0.85%.  The true value with a 95% probability lies within plus or minus two standard deviations from the expectation, that is, between -0.93% and 2.48%. <br><br>  So the premium does not shine yet, it is necessary to continue collecting data. <br><br>  Now let's solve the same problem with bootstrap.  The basic idea is this: it would be good to repeat our experiment many times and look at the distribution of results.  But we can‚Äôt do this, so we‚Äôll act unfairly - we pull samples from the available data and pretend that each of them is the result of repeating our experiment. <br><br><h5>  Algorithm: </h5><br><br><ol><li>  We choose at random one observation from the available. </li><li>  We repeat point 1 as many times as we have observations.  However, we will select some of them several times, some we will not choose at all - this is normal. </li><li>  We consider the metrics we are interested in for this new sample.  Remember the result. </li><li>  Repeat steps 1-3 many times.  For example, 10 thousand.  It is possible less, but the accuracy will be worse.  It is possible more, but it will take a long time. </li></ol><br><br>  Now we have a distribution that we can look at or calculate something from.  For example, confidence interval, median or standard deviation. <br><br>  Please note that we do not make any assumptions about the distribution of something.  Distributions can be asymmetric, with thick tails and generally have a fancy shape.  The algorithm does not change. <br><br>  Miracles, however, does not happen.  If the distribution does not have mathematical expectations (such occur), the bootstrap will not find it.  Well, that is, he will find the expectation of the sample, but not the general population.  The same applies to the situation when the sample is unrepresentative or just small. <br><br>  Bootstrap is easy to implement.  The following example is written in C (it doesn't get any simpler) and besides I / O, it uses only two library functions: a pseudo-random number generator and sorting.  We analyze it in parts. <br><br>  Prologue does not require special comments.  In C, there is no <code>bool</code> ; we will store the data in an <code>int</code> . <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; typedef int Data_t; #define ARRAY_SIZE(x) sizeof(x)/sizeof(x[0])</span></span></span></span></code> </pre><br><br>  A function that makes a selection on the fly and calculates the conversion percentage from it. <br>  It would be more correct to use a more accurate algorithm for calculating the average value <br>  but for our example it is not important. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootstrap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Data_t* data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; n; i++) { sum += data[rand() % n]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sum / n; }</code> </pre><br><br>  Compare function to sort results <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>*)a &gt; *(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>*)b) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>*)a &lt; *(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>*)b) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br><br>  Initial data <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* argv[])</span></span></span><span class="hljs-function"> </span></span>{ Data_t test[<span class="hljs-number"><span class="hljs-number">893</span></span>] = { <span class="hljs-number"><span class="hljs-number">0</span></span> }; Data_t control[<span class="hljs-number"><span class="hljs-number">923</span></span>] = { <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">34</span></span>; i++) { test[i] = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">28</span></span>; i++) { control[i] = <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre><br><br>  Initialize the pseudo-random number generator with the parameter from the command line.  If we <br>  did everything right, the results should not swim much when changing this <br>  parameter. <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (argc == <span class="hljs-number"><span class="hljs-number">2</span></span>) { srand(atoi(argv[<span class="hljs-number"><span class="hljs-number">1</span></span>])); }</code> </pre><br><br>  Here we will add the results <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> t_minus_c[<span class="hljs-number"><span class="hljs-number">10000</span></span>];</code> </pre><br><br>  Main loop <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; ARRAY_SIZE(t_minus_c); i++) { t_minus_c[i] = bootstrap(test, ARRAY_SIZE(test)) - bootstrap(control, ARRAY_SIZE(control)); }</code> </pre><br><br>  We determine the 95% confidence interval: we sort the results, discard 2.5% from the bottom and the same from above, show the result. <br><br><pre> <code class="cpp hljs"> qsort(t_minus_c, ARRAY_SIZE(t_minus_c), <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>), compare); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"LCL=%g%%\n"</span></span>, <span class="hljs-number"><span class="hljs-number">100.</span></span> * t_minus_c[<span class="hljs-number"><span class="hljs-number">250</span></span>]); <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"UCL=%g%%\n"</span></span>, <span class="hljs-number"><span class="hljs-number">100.</span></span> * t_minus_c[<span class="hljs-number"><span class="hljs-number">9750</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br><br>  Checking: <br><br><pre>  $ gcc -Wall -o bootstrap bootstrap.c
 $ ./bootstrap
 LCL = -0.891368%
 UCL = 2.43898%
</pre><br><br>  A couple more times with other pseudo-random numbers: <br><br><pre>  $ ./bootstrap 42
 LCL = -0.86589%
 UCL = 2.43898%
 $ ./bootstrap 2013
 LCL = -0.959673%
 UCL = 2.52184%
</pre><br><br>  It looks like a theoretical result (from -0.93% to 2.48%). <br><br><h5>  And why was the garden fuss? </h5><br><br>  This problem has a simple analytical solution, but many real problems have it or not at all, or there is one, but it is very difficult.  Imagine that instead of a percentage of conversion, we are interested in the ratio of profit from a client to the cost of attracting it.  The distribution of such a metric is unlikely to be normal, and the formulas will no longer fit into a couple of lines.  But the bootstrap will work in the same way, it is enough to change <code>Data_t</code> to <code>double</code> and put new data there. <br><br><h5>  Primary sources </h5><br><br><ol><li>  Efron B (1979).  Bootstrap methods: Another look at the jackknife.  Ann.  Statist.  7 1‚Äì26 </li><li>  Donald E. Knuth.  Seminumerical Algorithms, volume 2 of The Art of Computer Programming, chapter 4.2.2, page 232. Addison-Wesley, Boston, third edition, 1998. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/192000/">https://habr.com/ru/post/192000/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../191988/index.html">How not to overpay for Arduino and modules for it</a></li>
<li><a href="../191990/index.html">OpenWRT, or What else can you do with your router?</a></li>
<li><a href="../191994/index.html">Basics of Irrlicht Engine for newbies</a></li>
<li><a href="../191996/index.html">We draw electronic money</a></li>
<li><a href="../191998/index.html">Zaovnil, stuck, gash: dictionary IT-Schnick</a></li>
<li><a href="../192002/index.html">Development of a new professional standard in the field of information technology</a></li>
<li><a href="../192004/index.html">Watching the vote on "Russia 10"</a></li>
<li><a href="../192006/index.html">Bitcoin Foundation representatives met with US government agencies</a></li>
<li><a href="../192008/index.html">Yammer Tutorial: Registration Conversion</a></li>
<li><a href="../192010/index.html">RailsClub'Moscow 2013 (September 28). Conference news</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>