<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>6 lines of deep learning</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! Such a thing as ‚Äúdeep learning‚Äù has existed since 1986, when it was first used by Rina Dechter. Technology developed in 2006 after the publi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>6 lines of deep learning</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  Such a thing as ‚Äúdeep learning‚Äù has existed since 1986, when it was first used by Rina Dechter.  Technology developed in 2006 after the publication of Jeffrey Hinton‚Äôs publication on effective pre-training of a multilayered neural network.  Today, deep learning often lives in conjunction with speech recognition, language understanding and computer vision.  Under the cat you will learn about the use of deep learning algorithms in SQL.  Drop in! <br><br><img src="https://habrastorage.org/webt/x0/cv/n1/x0cvn1mbjgpvtv-zmlxkpuxmxc4.jpeg"><a name="habracut"></a><br><br><h2>  What to add? </h2><br>  The use of deep learning has reached such proportions that the new mantra ‚ÄúDeep learning in every application‚Äù may well become a reality in the coming decade.  The venerable <b>SQL Server DBMS</b> did not stand aside.  To the question ‚ÄúIs it possible to use deep learning algorithms in SQL Server?‚Äù We confidently answer ‚ÄúYes!‚Äù In the <a href="https://blogs.technet.microsoft.com/dataplatforminsider/2016/11/16/announcing-the-next-generation-of-databases-and-data-lakes-from-microsoft/">public</a> preview version of the new release of SQL Server, we significantly improved <a href="https://msdn.microsoft.com/en-us/library/mt604885.aspx">R Services within SQL Server</a> and added a powerful set of machine learning tools used by developers and Microsoft itself.  Due to this, DBMS applications created on the basis of SQL Server receive means for increasing the speed of work, productivity and scaling, as well as access to other new features of machine learning and a deep neural network.  Most recently, we <a href="https://blogs.technet.microsoft.com/dataplatforminsider/2016/10/11/1000000-predictions-per-second/">demonstrated</a> how SQL Server performs over a million R-predictions per second when using it as a machine-based model management system, and now we invite you to evaluate the R code examples and machine learning patterns for <a href="https://github.com/Microsoft/SQL-Server-R-Services-Samples">SQL Server on GitHub.</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this blog, I would like to elaborate on <i>what</i> , <i>why,</i> and <i>how</i> questions regarding deep learning in SQL Server.  Having clarified this, it will be easier for us to see the perspectives of data-driven artificial intelligence using such a powerful data processing platform as SQL Server. <br><br><h2>  Why add? </h2><br>  To date, all companies and all applications work with data. <br><br>  Any application can be called intellectual if it combines data storage and intelligence (whether it is artificial intelligence, machine learning system or any other intellectual system).  SQL Server helps developers and users to realize the very essence of deep learning in their applications by writing only a few lines of code.  In addition, with its help, database developers can deploy critical operating systems with built-in deep learning models.  In this article, we have gathered ten reasons why SQL Server needs deep learning opportunities. <br><br>  <b>Ten reasons</b> why SQL Server needs deep learning. <br><br><ol><li>  Using machine intelligence with storage systems (for example, SQL Server), you get security, compliance, privacy, encryption, <a href="https://msdn.microsoft.com/en-us/library/ff487003.aspx">core data management services</a> , accessibility groups, advanced business intelligence tools, in-memory data processing technologies, virtualization, geospatial, temporary, graphical and other awesome features. </li><li>  You can work in "real time" or "batch processing" by analogy with real-time transaction processing (OLTP) and interactive analytical processing (OLAP), but with respect to deep learning and machine intelligence. </li><li>  To take full advantage of deep learning, you don‚Äôt have to change your SQL Server based applications.  In addition, many mobile, IoT, and web applications can use the same deep learning model without having to duplicate code. </li><li>  You can use the functions of machine learning libraries (for example, MicrosoftML) to increase the efficiency of data processing specialists, developers, database administrators, as well as your entire business.  It is much faster and more efficient than doing the same on your own. </li><li>  You will be able to develop predictable solutions to deploy or scale them according to current requirements.  In the latest SQL Server update package, many features previously available only in the Enterprise Edition are now supported in other editions of SQL Server, including Standard / Express / Web Edition.  This means that you can use deep learning even in the standard version of SQL Server at no additional cost. </li><li>  You can use disparate external data sources (using PolyBase) to train and extract information from deep-seated models. </li><li>  You can simulate different situations and create ‚Äúwhat if‚Äù scripts inside SQL Server, and then use them for a variety of deep learning models.  Thus, you can get an intelligent solution even with a very limited amount of data for training. </li><li>  You can easily and quickly use deep learning models using stored procedures and triggers. </li><li>  You will get all the necessary tools, monitoring and debugging tools, as well as the SQL Server ecosystem applicable to machine intelligence.  SQL Server will truly become your <a href="https://blogs.technet.microsoft.com/dataplatforminsider/2016/10/17/sql-server-as-a-machine-learning-model-management-system/">machine learning management system</a> to monitor the entire life cycle of DNN models along with the data. </li><li>  You will be able to create new data and receive analytics from stored data without increasing the transactional workload (using <a href="http://blogs.microsoft.com/blog/2016/03/10/sql-server-2016-the-database-for-mission-critical-intelligence/">the HTAP template</a> ). </li></ol><br>  In truth, hardly anyone will buy a DBMS just for the sake of managing the database.  Buyer important opportunities that it provides.  By endowing SQL Server with deep learning capabilities, we can scale AI and machine learning both in the traditional sense (data scaling, throughput, latency), and in terms of productivity (simplified implementation and a flatter learning curve).  This brings valuable results immediately in many ways, be it time, user interaction, productivity, cost reduction and profit growth, new opportunities, business prospects, ideological leadership in the industry, etc. <br><br>  In practice, deep learning technologies in SQL Server can be used in banking and finance, as well as in healthcare, manufacturing, retail, e-commerce, and the Internet of Things (IoT) systems.  And the use of these technologies to detect fraud, predict morbidity, predict energy consumption or analyze personal information will improve existing industries and applications.  It also means that no matter what loads are running on SQL Server, be it customer relationship management (CRM), enterprise resource planning (ERP), data storage (DW), real-time transaction processing (OLTP), and others, you you can effortlessly use deep learning technology in them.  This is about using it not separately, but in combination with all kinds of data and analytics that SQL Server is famous for (for example, processing structured, geospatial, graphical, external, temporal data, as well as JSON data).  And you need to add here only ... your ideas. <br><br><img src="https://habrastorage.org/webt/oa/2a/9n/oa2a9ndee1itjtvxomsj7h7ofcy.png"><br><br><h2>  How to add? </h2><br>  Here I will show how to put all this into practice.  As an example, let's take an experiment on forecasting classes of galaxies from images using the powerful Microsoft R programming language and its new <a href="https://msdn.microsoft.com/en-us/microsoft-r/microsoftml-introduction">MicrosoftML</a> package for machine learning (created by our specialists in the field of algorithm development, data processing and analysis).  And we will do this in SQL Server <a href="https://msdn.microsoft.com/en-us/library/mt604845.aspx">with connected R Services services</a> on a shared <a href="https://azure.microsoft.com/en-us/blog/azure-n-series-general-availability-on-december-1/">Azure NC virtual machine</a> .  I am going to distribute images of galaxies and other space objects into 13 classes based on the classification adopted in astronomy - mostly elliptical and spiral galaxies and their varieties.  The shape and other visual characteristics of galaxies change as they develop.  Studying the forms of galaxies and their classification help scientists better understand the processes of the development of the Universe.  Having examined these images, it will not be difficult for a person to distribute them into the correct classes.  But in order to do this with 2 trillions of known galaxies, it will be difficult to do without the help of machine learning and intelligent technologies such as deep neural networks, so I‚Äôm going to use them.  It is easy to imagine that instead of astronomical data we have medical, financial or IoT data, and that we need to make predictions using them. <br><br><h3>  application </h3><br>  Imagine a simple web application that loads images of galaxies from a folder and then distributes them into various classes ‚Äî spiral and elliptical, and then re-distributes them into classes inside these classes (for example, this is a normal spiral galaxy or galaxy with type of handle). <br><br><img src="https://habrastorage.org/webt/lm/gx/it/lmgxitv5spe8fns1kfg8wj7la0a.png"><br><br>  And it can classify a huge number of images incredibly fast.  Sample output: <br><br><img src="https://habrastorage.org/webt/d0/rm/db/d0rmdbvxqe3tabysim-_ze7tsh8.png"><br><br>  The first two columns contain elliptical-type galaxies, and the rest contain various spiral galaxies. <br><br><h3>  So how can a simple application make such a complex classification? </h3><br>  The code of such an application actually performs not so many actions, it only prescribes the paths to new files for their distribution into classes in the database table (the rest of the program code consists of the distribution of the resulting data, page layout, etc.). <br><br><pre><code class="sql hljs">SqlCommand Cmd = new SqlCommand("<span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> [dbo].[GalaxiesToScore] ([<span class="hljs-keyword"><span class="hljs-keyword">path</span></span>] ,[PredictedLabel]) <span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/np/ix/z3/npixz3v3hhlfoshou4aq896evey.png"><br><br><h3>  What happens in the database? </h3><br><h4>  The part responsible for forecasting and operationalization </h4><br>  Take a look at the table where the application prescribes the paths to the image files.  It contains a column with paths to images of galaxies and a column for storing the expected classes of galaxies.  As soon as a new data line is written to the table, the trigger fires: <br><br><img src="https://habrastorage.org/webt/2x/o6/ng/2xo6ngjxy17pvt7jlc0baipr0j8.png"><br><br>  In turn, the trigger calls the stored procedure - PredictGalaxiesNN, as shown below (with the part of the R script embedded in the stored procedure): <br><br><img src="https://habrastorage.org/webt/vy/19/3a/vy193a1xauipz-rrmtjhktuyi7a.png"><br><br>  It is here, in a few lines of the R code, magic happens.  This R script accepts new data lines (which have not yet received a rating) and a model stored as varbinary (max) in the table.  A little later, I will return to the question of how this model turned out to be there.  Inside the script, the model is deserialized and is used by the calculation function (rxPredict) already familiar to us in the next line in order to evaluate the new lines and then write the final output data. <br><br><pre> <code class="sql hljs">scores &lt;- rxPredict(modelObject = model_un, data = InputDataSet, extraVarsToWrite="path")</code> </pre> <br>  This is a new version of the rxPredict function that understands the machine learning algorithms included in the MicrosoftML package.  The next line downloads a package containing new MicrosoftML machine learning algorithms. <br><br><pre> <code class="sql hljs"> [ library("MicrosoftML") ]</code> </pre> <br>  In addition to the deep neural network (DNN), the main topic of this blog, the package contains five more powerful machine learning algorithms: fast linear, fast tree-based, fast forest-based, single-class method for detecting SVM anomalies, regularized logistic regression (with support for L1 regularization and L2) and neural networks.  Thus, with just 6‚Äì7 lines of the R language, any application can become intelligent thanks to a model based on a deep neural network.  The application will only need to connect to SQL Server.  By the way, using the sqlrutils package, it became easy to create a stored procedure for code R. <br><br><h4>  What about the training model? </h4><br>  Where was the model trained?  And she also studied in SQL Server.  However, it was not necessary to teach it specifically in SQL Server, it can be done on a separate machine with a standalone R Server solution, working locally or through the cloud.  Today, all these new machine learning algorithms are available in the R Server version for Windows, and support will soon come from other platforms.  It was more convenient for me to do the training in the SQL Server field, but I could do it outside of it.  Take a look at the stored procedure with the code for learning. <br><br>  <b>Code for learning</b> <br><br>  The model is trained in these lines of code: <br><br><img src="https://habrastorage.org/webt/xb/o5/au/xbo5auqgkxyhc_oowl8_n99uu-o.png"><br><br>  This is a new feature rxNeuralNet from MicrosoftML for deep neural network training.  This code is similar to other functions R and rx - it also contains the formula, the input data set and some other parameters.  One of the parameters we see here is the string netDefinition = netDefinition.  It is in it that the neural network is determined. <br><br>  <b>Network definition</b> <br><br>  The deep neural network is defined in this part of the code: <br><br><img src="https://habrastorage.org/webt/pu/rn/kk/purnkkycfbvkevbtigg2tz7gygc.png"><br><br>  Here is the definition of a deep neural network using the specification language Net #, created specifically for this.  The neural network contains 1 input, 1 output and 8 hidden layers.  It starts with an input layer size of 50 √ó 50 pixels and image data in the RGB format (3 color depth).  The first hidden layer is a convolutional layer, where we specify the size of the nucleus (a small part of the image) and how many times the nucleus should be compared with the other nuclei (to roll).  There are other layers for other types of convolutions, as well as for normalizing and regulating the number of requests that help stabilize this neural network.  And finally, the output layer, associating it with one of 13 classes.  With about 50 lines of the Net # specification, I determined a complex neural network.  <a href="https://msdn.microsoft.com/en-us/library/azure/dn906030.aspx">The Net # guide is</a> in the MSDN section. <br><br>  <b>The size of the trained data / GPU</b> <br><br>  Here is the R code for learning the model: <br><br><img src="https://habrastorage.org/webt/ss/wu/3c/sswu3cjp0i5ji2vukjozytt3nf4.png"><br><br>  I would like to tell you about several more lines - training_rows = 238000. This model was trained on 238,000 images obtained from the database of the <a href="https://blogs.technet.microsoft.com/dataplatforminsider/2016/03/10/mapping-the-universe-with-sql-server/">Sloan Digital Sky Survey</a> project.  Then we created two variants of each image, turning them 45 and 90 degrees.  Thus, a total of about 700,000 images for training.  This is a very large amount of data for training, so the question is, how long did it take to process it?  Answer: we were able to train this model in 4 hours, using a not-too-large machine with a 6-core processor and 56 GB of RAM, as well as a powerful graphics accelerator Nvidia Tesla K80.  This is the new NC-based Azure graphical virtual machine, available to anyone who has signed up for an Azure subscription.  We were able to optimize the computation speed due to the use of a graphics processor (GPU) by setting one simple parameter: acceleration = ‚Äúgpu‚Äù.  Without a GPU, learning takes about 10 times longer. <br><br><h2>  Summarizing </h2><br>  With just a few lines of R code and MicrosoftML algorithms, I managed to train a deep neural network on an impressive amount of image data and use the trained model in SQL using R services that allow any application connected to SQL to easily get these intelligent technologies.  This is the power of Microsoft R and MicrosoftML combined with SQL Server.  And this is only the beginning, because we are working on the creation of other algorithms so that the power of artificial intelligence and machine learning becomes available to all.  To select the appropriate machine learning algorithm for the predictive analytical model, you can download the MicrosoftML: Algorithm Cheat Sheet <a href="https://msdn.microsoft.com/en-us/microsoft-r/microsoftml-algorithm-cheat-sheet">here</a> . <br><br><img src="https://habrastorage.org/webt/k1/fb/em/k1fbemr2qdiuc6iwuixzk4yq3vk.png"></div><p>Source: <a href="https://habr.com/ru/post/342788/">https://habr.com/ru/post/342788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342776/index.html">Drone CI in AWS Cloud for DevExtreme</a></li>
<li><a href="../342778/index.html">10 techniques for creating beautiful business presentations from 2017</a></li>
<li><a href="../342780/index.html">When should I move to test automation</a></li>
<li><a href="../342782/index.html">SensioLabs closed multiple vulnerabilities in all supported symfony versions</a></li>
<li><a href="../342786/index.html">Hedgehogs on wheels: how do we maintain the quality of communication in Moscow</a></li>
<li><a href="../342790/index.html">Spring WebSocket. How it works?</a></li>
<li><a href="../342792/index.html">United company Yandex.Taxi and Uber plans to hold an IPO in 2019</a></li>
<li><a href="../342794/index.html">Example of implementation of a general performance indicator of MS SQL Server</a></li>
<li><a href="../342796/index.html">Machine learning do-it-yourself (part 2). Service for the classification of calls to those. support</a></li>
<li><a href="../342798/index.html">JBreak 2018 Java Conference Announcement: Connecting the Dots</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>