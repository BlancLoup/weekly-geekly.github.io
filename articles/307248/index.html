<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with PGPool + ORM Yii2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today there will be a small ‚Äúhack‚Äù for ORM Yii2 if you use PGPool. 
 Yes, these are again some crutches (as in my first article), but it seems to me t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with PGPool + ORM Yii2</h1><div class="post__text post__text-html js-mediator-article">  Today there will be a small ‚Äúhack‚Äù for ORM Yii2 if you use PGPool. <br>  Yes, these are again some crutches (as in my first article), but it seems to me that these (taking into account the victorious march of PostgreSQL) may be useful to even more people. <br><br>  All those who work with PGPool in Master-Slave mode will sooner or later face the task of when to make selections without fail from the wizard.  Fortunately, the developers took care of us and gave us this opportunity.  Who saw the scheme of work of PGPool will understand me: we write a simple line / * NO LOAD BALANCE * / before the select and our PGpool request will be sent to the master database. <br><br>  Problems begin when we need to use ORM. <br><a name="habracut"></a><br>  On the example of Yii2, we have so far decided this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Overriding the ActiveQuery class and, most importantly, its createCommand () method <br><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveQuery</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">yii</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">db</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveQuery</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_noLoadBalance = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *     ,     * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> $this */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">noBalance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_noLoadBalance = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritdoc</span></span></span><span class="hljs-comment"> */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($db = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $modelClass ActiveRecord */</span></span> $modelClass = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modelClass; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($db === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { $db = $modelClass::getDb(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sql === <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">list</span></span> ($sql, $params) = $db-&gt;getQueryBuilder()-&gt;build(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $sql = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sql; $params = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;params; } $comment = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> === <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_noLoadBalance) { $comment = <span class="hljs-string"><span class="hljs-string">'/*NO LOAD BALANCE*/'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $db-&gt;createCommand($comment . $sql, $params); } }</code> </pre> <br><br>  And we use it this way: <br><br><pre> <code class="php hljs">$user = User::find()-&gt;where([ User::ATTR_ID =&gt; $userid, ]) -&gt;noBalance() -&gt;one();</code> </pre><br><br>  And I really want the Yii developers to somehow somehow do it ‚Äúinside‚Äù out of the box. </div><p>Source: <a href="https://habr.com/ru/post/307248/">https://habr.com/ru/post/307248/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307228/index.html">Sensor of absolute pressure BMP180</a></li>
<li><a href="../307232/index.html">We force FFMPEG to change HLS flows depending on the current throughput</a></li>
<li><a href="../307234/index.html">Migrating Xenserver 7 to linux raid</a></li>
<li><a href="../307236/index.html">Approximation of Pi by Mandelbrot Set</a></li>
<li><a href="../307242/index.html">Pattern recognition in R using convolutional neural networks from the MXNet package</a></li>
<li><a href="../307250/index.html">The intersection of the muzzles of top domains 1,000,000 by N-grams</a></li>
<li><a href="../307252/index.html">Basics of computer networks. Subject number 1. Basic network terms and network models</a></li>
<li><a href="../307256/index.html">Interface calculations (and a couple of small tips, how not to screw up, choosing a product)</a></li>
<li><a href="../307258/index.html">Pro shops and introverts: a number of implicit things</a></li>
<li><a href="../307260/index.html">The most important thing about neural networks. Lecture in Yandex</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>