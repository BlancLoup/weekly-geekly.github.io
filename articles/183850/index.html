<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Musical rehearsals: now and through the Internet</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article briefly describes several similar programs, and also describes the experience of developing its own software in this area, since available...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Musical rehearsals: now and through the Internet</h1><div class="post__text post__text-html js-mediator-article">  The article briefly describes several similar programs, and also describes the experience of developing its own software in this area, since  available programs did not have all the necessary features at the same time. <br><br><h4>  Foreword </h4><br>  In early 2012, on the New Year holidays, I came across a curious movie: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/rxpdYm6FacE&amp;xid=17259,15700023,15700043,15700186,15700190,15700253&amp;usg=ALkJrhhyw2urJ3lL-IaF6uWpzIYC4prUUQ" frameborder="0" allowfullscreen=""></iframe><br><br>  The video shows that people are singing live, as written in the comments, located in different studios.  It became interesting what kind of technology.  The only clue was the word NETDUETTO. <a name="habracut"></a>  It turned out that <a href="http%253A%252F%252Fwww.y2lab.com%252Fproject%252Fnetduetto%252F">there is such software</a> produced by one of the laboratories of the Japanese company Yamaha.  But the trouble is, the program is installed only on the Japanese locale.  After searching the network, an unofficial distribution was found that installs on any locale.  But now the executable file itself did not start.  Included with the distribution was a patch, but I did not like it, and I decided to make my patch.  Having found the locale definition code through IDA and patched it with the substitution of nops in the HEX editor, the program started, but the interface was not displayed.  For it was made under the Japanese locale.  Having tinker in Restorator, I taught the program an English-language interface (which, by the way, was in the .exe file itself, was simply inactive) and it was possible to start conducting experiments ( <a href="http://rghost.ru/36658167">link</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Netduetto </h4><br><img src="https://habrastorage.org/storage2/1ea/35b/fd2/1ea35bfd2a2399047c652f9a73c700d8.jpg"><br><br>  The program works fine, up to 4 participants of online music rehearsal are supported.  Yes, that's bad luck.  The maximum audio quality is 44.1 kHz / mono.  Mono to me, as a keyboard player (and at keyboard instruments, stereo effects are sometimes harshly necessary), I definitely didn‚Äôt like it and the search for analogues began. <br><br><div class="spoiler">  <b class="spoiler_title">By the way, in one of the beta versions of Netduetto there was support for stereo mode.</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/546/13e/5d8/54613e5d8b42ae9a97be1cff466d8990.jpg"><br></div></div><br><br><h4>  Ninjam </h4><br><img src="https://habrastorage.org/storage2/0ee/0a1/8da/0ee0a18da30afa791f08b6b58641992e.gif"><br><br>  The only adequate counterpart was Ninjam.  But he used the computer of one of the participants of the online rehearsal as a server, so the sound from one participant to another goes through this server, rather than indirectly.  Taking into account the specifics, when milliseconds are important for a well-coordinated game, such an intermediate link is unacceptable (Netduetto works directly, each participant in the online rehearsal exchanges audio data with each).  And, even without testing this tool, I began to write my program with support for both stereo mode and working without an intermediate server. <br><br><h4>  Steinberg VST Connect SE </h4><br><img src="https://habrastorage.org/storage2/feb/b4d/c2a/febb4dc2aea99fe8366daa2c53cede60.png"><br>  But first I will mention another serious program with similar functionality.  It differs from the rest in two parts.  One is for the sound engineer, and is launched from under the DAW (Digital Audio Workstation - the general name of professional programs for working with sound), and the other for the performer is a separate executable file.  Another limitation is that unlike other programs, this connects only two people and is positioned not as a rehearsal, but as a remote recording without the need to visit the studio.  But at the moment it can only be tested by owners of Cubase 7, to whom, unfortunately, I can not count it. <br><br><h4>  Music Over The World Tool </h4><br><img src="https://habrastorage.org/storage2/75c/0b2/60a/75c0b260acd2250188c09e34ceb304ae.png"><br><br>  So, <a href="http://rghost.ru/46846686">my development</a> .  Using long-term observations of the mTorrent torrent client, as well as experience with UDP, this program was written.  Next, I want to talk about some things that seemed interesting to me in the process of developing a program. <br><br>  The program is written in pure Winapi.  This is due to the fact that I needed to make an executable file that would run without any installation of myself this time.  And also without installing any third-party software or libraries (such as, for example, .NET) these are two.  As a result, the file size of just over 100 kB is fully functional and works even on Windows XP SP2. <br><br>  Finding your own ip-address from within the program in the absence of its servers on the Internet (which are, for example, Yamaha and which are used in Netduetto to store information about the so-called ‚Äúrooms‚Äù with musicians) was not obvious.  After all, the Internet can be either direct or behind a router (roughly speaking, of course).  And it is necessary to determine the external ip-address, and not the address of the end LAN, returned by the regular functions of determining the interface address.  Therefore, a site was found that responds with a small page with your external ip-address.  Since there are a huge number of such sites on the Internet, the one that was chosen was <a href="http://www.myip.ru/">the</a> minimum size and page design of which has not changed for several years. <br><br>  Buffering, or struggle with excess signal delays.  Here you took a guitar, connected to the microphone input of a computer sound card, took a chord, and then what?  And then the signal is digitized by the ADC of the sound card, and n samples (where n is a multiple of 2; usually 128, 256 or 512) are transmitted to the <a href="http://ru.wikipedia.org/wiki/Audio_Stream_Input/Output">ASIO driver</a> .  The program (for example, both Netduetto and Music Over The World Tool) has access to this driver, which signals that n data samples are updated in this buffer (ASIO driver input buffer).  Total periodically in the program are data on n samples of the audio signal.  Also, periodically, the Netduetto and Music Over The World Tool programs (I am comparing them now, because there is one important difference in terms of buffering) over the network receive data from other online rehearsal participants in the form of network packets containing m audio samples from each remote member.  So, there are two events in the program - new n audio samples were received from the sound card input, and new m audio signal samples were received from the remote participant over the network.  N samples: are transmitted to the output ASIO-buffer (so that you yourself hear what you are playing), and are also sent to the rest of the participants in the online rehearsal.  M counts: here we are waiting for the main difference between the program Netduetto Music Over The World Tool.  In Netduetto, data from a remote participant get into an intermediate buffer, which has a dynamically adjustable size, depending on the ping between the participants, the size of the input and output buffers of the ASIO driver, and the settings for compressing the audio streams of the participants.  Thus, in Netduetto, the scheme for receiving audio samples from remote participants looks like this: <br><br>  (m samples taken over the network) -&gt; (intermediate buffer) -&gt; (output buffer of the ASIO driver) -&gt; (sound card DAC) <br><br>  Whereas in the program Music Over The World Tool this scheme looks like this: <br><br>  (m samples taken over the network) -&gt; (output buffer of the ASIO driver) -&gt; (sound card DAC) <br><br>  And what does the lack of buffer mean?  This means that the other person will hear your chord a few milliseconds earlier.  And what is a few milliseconds?  Many or few?  And the context of a specific task is quite noticeable.  Without this buffer in Music Over The World Tool, you can easily play at a 120-140 tempo.  Of course, there are no miracles, and you have to pay for everything - you need to install the same size of the input and output buffers of the ASIO drivers on all the participants' computers.  Also, with this approach, only raw uncompressed data can be transferred.  But it's worth it. <br><br>  Further, since Music Over The World Tool works on the basis of p2p technologies, we had to tinker while the mechanism was debugged whereby the UDP packets with the readings of the other participants were sent to the ip-address of the disconnected peer.  On the service channel (a separate UDP port), a list of ip-addresses with which it is currently connected is transmitted to each participant in the online rehearsal once a second.  And if one of the participants disconnected (closed the program), then a hail from the UDP packets of the main channel of audio signal samples (a separate UDP port for each participant) continued to fall on his ip-address.  To avoid this, we had to introduce control of data exchange on the main channel.  As well as storing a table of all ip-addresses that have ever been connected and not sending packets with audio samples to the addresses from which data has not been received for several seconds. <br><br>  Another important difference from other programs is integrated <a href="http://ru.wikipedia.org/wiki/Virtual_Studio_Technology">VST</a> support, and even VSTi (which is connected indirectly, via VST FLStudio).  Those.  From this program, you can hang up a handler, and, for example, your played chord will sound like on an overloaded electric guitar.  You can also connect a MIDI keyboard and play VSTi-instruments.  And all without the need to think of routing audio signals or run third-party programs (except for the need for a VST version of FLStudio to support VSTi). <br><br>  Speaking of audio routing.  Netduetto comes with a great driver that can replace <a href="http://en.wikipedia.org/wiki/Virtual_Audio_Cable">VAC</a> that has gotten blunt (in VAC, switching the input to the input occurs at the top level of abstraction through a separate Windows application, which takes more resources and less efficiently and elegantly than in the Yamaha driver, where the output switching to input occurs inside the driver kernel).  In addition to its main purpose (in Netduetto, the entire output of the ASIO driver is duplicated to it, which is useful, for example, when broadcasting this audio to the Internet) you can connect the DAW output to the input of at least Netduetto or Music Over The World Tool. <br><div class="spoiler">  <b class="spoiler_title">It is done this way.</b> <div class="spoiler_text">  DAW starts, ASIO4ALL is selected.  In the settings ASIO4ALL for DAW set: <br>  - input channel - input channel of the sound card; <br>  - output channel ‚Äî the output channel of the Yamaha virtual audio device. <br>  In the settings of Netduetto or Music Over The World Tool, ASIO4ALL is selected with the settings: <br>  - input channel ‚Äî the input channel of the Yamaha virtual audio device; <br>  - output channel - output channel of the sound card. </div></div>  In addition, you can install more than one copy of these virtual audio drivers. <br><br>  If someone has read this far, but at the same time he hardly imagines what it is and why.  These are the implementations of technologies that make distances invisible.  You can sit at home in front of a computer and play music with friends who are many kilometers away as if they were in the same room with you.  With CD-audio quality. <br><br>  PS: History.  Long times ago ... Several years ago, our compatriots had already created a similar program.  But then there was neither ASIO, nor the modern Internet.  Initially, the program was called <a href="http://www.youtube.com/watch%3Fv%3DSJ13pJAxNxs">Omnimusic</a> , then it became the <a href="http://thesound.ru/musigycom-socialnaya-set-dlya-muzykantov-ot-russkix-druzej-billa-gejtsa/">Musigy</a> project.  At the moment, no trace of that project was found on the Internet. </div><p>Source: <a href="https://habr.com/ru/post/183850/">https://habr.com/ru/post/183850/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../183838/index.html">What would happen if Hemingway wrote in JavaScript</a></li>
<li><a href="../183842/index.html">Call Center from birth to death</a></li>
<li><a href="../183844/index.html">Work with sound in Adobe Premiere Pro CS 6</a></li>
<li><a href="../183846/index.html">We use a component from a standard Android application in our project.</a></li>
<li><a href="../183848/index.html">Beautiful CSS3 menu</a></li>
<li><a href="../183852/index.html">Convenient music download from vkontakte</a></li>
<li><a href="../183854/index.html">Introduction to Spring Frameworks: Spring MVC</a></li>
<li><a href="../183856/index.html">STM32F3DISCOVERY, accelerometers, stepper motors and a bit of magic</a></li>
<li><a href="../183858/index.html">Keyboard input using IME</a></li>
<li><a href="../183862/index.html">SCO resumes litigation against IBM over UNIX rights</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>