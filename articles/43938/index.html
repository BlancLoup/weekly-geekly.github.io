<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New features in C # 4.0. Part 3: Covariance of generalizations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When generic came to us with C # 2.0, they became one of the best features in this language. Those who have ever created classes of strongly typed col...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New features in C # 4.0. Part 3: Covariance of generalizations</h1><div class="post__text post__text-html js-mediator-article">  When generic came to us with C # 2.0, they became one of the best features in this language.  Those who have ever created classes of strongly typed collections in C # 1.0 know how much they simplified our lives and reduced the amount of code.  The only problem was that generic types did not follow the same inheritance rules that were valid for ordinary types. <a name="habracut"></a><br><br>  Let's start with the definition of two simple classes that we will use in this article: <blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> Shape { } <font color="#0000ff">public</font> <font color="#0000ff">class</font> Circle : Shape { }</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Shape { } <font color="#0000ff">public</font> <font color="#0000ff">class</font> Circle : Shape { } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Shape { } <font color="#0000ff">public</font> <font color="#0000ff">class</font> Circle : Shape { } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Shape { } <font color="#0000ff">public</font> <font color="#0000ff">class</font> Circle : Shape { } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Shape { } <font color="#0000ff">public</font> <font color="#0000ff">class</font> Circle : Shape { } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Shape { } <font color="#0000ff">public</font> <font color="#0000ff">class</font> Circle : Shape { } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Shape { } <font color="#0000ff">public</font> <font color="#0000ff">class</font> Circle : Shape { } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> Shape { } <font color="#0000ff">public</font> <font color="#0000ff">class</font> Circle : Shape { }</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  This is a classical class hierarchy, which so far does not do anything concrete, but we don‚Äôt need it now.  Now we define a dummy class, which can be a container for any type. <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">public</font> <font color="#0000ff">interface</font> IContainer &lt;T&gt; </li><li>  { </li><li>  T GetItem (); </li><li>  } </li><li></li><li>  <font color="#0000ff">public</font> <font color="#0000ff">class</font> Container &lt;T&gt;: IContainer &lt;T&gt; </li><li>  { </li><li>  <font color="#0000ff">private</font> T item; </li><li></li><li>  <font color="#0000ff">public</font> Container (T item) </li><li>  { </li><li>  <font color="#0000ff">this</font> .item = item; </li><li>  } </li><li></li><li>  <font color="#0000ff">public</font> T GetItem () </li><li>  { </li><li>  <font color="#0000ff">return</font> item; </li><li>  } </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  We have a hierarchy and a container.  Now let's take a look at what we can‚Äôt do in the current version of C # - 3.0. <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main ( <font color="#0000ff">string</font> [] args) </li><li>  { </li><li>  IContainer &lt;Shape&gt; list = GetList (); </li><li>  } </li><li></li><li>  <font color="#0000ff">public</font> <font color="#0000ff">static</font> IContainer &lt;Shape&gt; GetList () </li><li>  { </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">new</font> Container &lt;Circle&gt; ( <font color="#0000ff">new</font> Circle ()); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  We have a GetList method, in which the return type is defined as IContainer &lt;Shape&gt;, and it returns the Container &lt;Circle&gt;.  Since Circle is inherited from Shape, and Container implements the IContainer interface, this may seem to work.  But, you guessed it, C # 3.0 is not capable of this. <br><br>  In C # 4.0, we have a way to make it work ‚Äî we just need to add the out keyword to the type parameter in our IContainer interface definition (note that covariance in C # 4.0 is limited to interfaces and delegates). <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">public</font> <font color="#0000ff">interface</font> IContainer &lt; <font color="#0000ff">out</font> T&gt; </li><li>  { </li><li>  T GetItem (); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  This construct tells the compiler that type T is covariant, which means that any IContainer &lt;T&gt; will accept any type equivalent or more specific than T. As we saw above, the return value type was IContainer &lt;Shape&gt;, but if we put the out parameter to our interface, we can easily return IContainer &lt;Circle&gt; as well. So why did you decide to use the out keyword?  This is because when you define a parameter-type as covariant you can only return this type from the interface.  For example, such a construction is not allowed: <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">public</font> <font color="#0000ff">interface</font> IContainer &lt; <font color="#0000ff">out</font> T&gt; </li><li>  { </li><li>  <font color="#0000ff">void</font> SetItem (T item); </li><li>  T GetItem (); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  But why won't it work?  The answer is really very simple - type safety.  Let's look at the consequences of what we did: <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main ( <font color="#0000ff">string</font> [] args) </li><li>  { </li><li>  IContainer &lt;Shape&gt; container = <font color="#0000ff">new</font> Container &lt;Circle&gt; (); </li><li>  SetItem (container); </li><li>  } </li><li></li><li>  <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SetItem (IContainer &lt;Shape&gt; container) </li><li>  { </li><li>  container.SetItem ( <font color="#0000ff">new</font> Square ());  <font color="#008000">// BOOM !!!</font> </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  Since T is covariant and, therefore, we can assign a Container &lt;Circle&gt; to a variable of type IContainer &lt;Shape&gt;, passing it further to our static method SetItem, which accepts a parameter of type IContainer &lt;Shape&gt; and then we take this parameter and try to add variable of type Square into it.  It seems that everything is correct - the type of the IContainer &lt;Shape&gt; parameter and this gives us the right to add Square to it.  Wrong.  This expression will ‚Äúexplode‚Äù as we try to add Square to the container that the Circle holds.  Therefore, with the out keyword, they limited the covariance to only one direction. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      You are probably wondering how this is all implemented in CLR 4.0?  There is no need for implementation.  Generic types worked in CLR 2.0 and they already allowed this behavior.  Since C # tried to preserve type safety, we were not allowed to do that, but the CLR does it on time.  And, a small remark - arrays in C # allow this behavior, so try.  I hope you enjoyed this article and new in this series is just around the corner! <br><br>  <strong>Translation of article</strong> <a href="http://www.codethinked.com/post/2008/10/31/C-40-New-Features-Part-3-Generic-Covariance.aspx"><strong>C # 4.0 New Features Part 3 - Generic Covariance</strong></a> <br><br>  <strong>Crosspost from my</strong> <a href="http://netartdev.blogspot.com/"><strong>blog</strong></a> <br><br></div><p>Source: <a href="https://habr.com/ru/post/43938/">https://habr.com/ru/post/43938/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../43930/index.html">issue number 3</a></li>
<li><a href="../43933/index.html">Song of Habr√©</a></li>
<li><a href="../43934/index.html">Windows 7 Taskbar - what's new and how to enable it in Windows 7 build 6801.</a></li>
<li><a href="../43935/index.html">Ultimate benchmark five and a half ways to check for an object attribute in Python</a></li>
<li><a href="../43936/index.html">Futurama - Bender Game</a></li>
<li><a href="../43939/index.html">Boy and starfish</a></li>
<li><a href="../43941/index.html">How to call a company?</a></li>
<li><a href="../43944/index.html">About the squiggles in the heads of admins</a></li>
<li><a href="../43947/index.html">Offline Paradoxes</a></li>
<li><a href="../43948/index.html">We write an accordion plugin in 618 bytes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>