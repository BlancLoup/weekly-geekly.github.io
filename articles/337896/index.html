<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Playfully BASH'im further</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The first article I. BASH'im top 



 Inspired by the reviews on the first article, I continued developing piu-piu. Intro \ menu appeared in the game,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Playfully BASH'im further</h1><div class="post__text post__text-html js-mediator-article">  The first article <a href="https://habrahabr.ru/post/335960">I. BASH'im top</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ed/c0c/1fe/4edc0c1fe18d8841e72feb454090673e.png" alt="image"><br><br>  Inspired by the reviews on the first article, I continued developing piu-piu.  Intro \ menu appeared in the game, character-by-character appearance of objects was implemented, the color scheme was changed.  The palette is now determined by the time of year, however, due to the lack of colors, we had to limit ourselves to 3 options: winter - the beginning of spring, spring - summer and autumn.  Changes can be estimated by downloading the game <a href="https://github.com/vaniacer/piu-piu-SH">here</a> .  Next, a few letters how it all happened. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Gif with new gameplay</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/70a/fc6/252/70afc6252b770f7e9d8b66320ea059ad.gif" alt="image"><br></div></div><br>  I started with the implementation of character-by-character output.  What could be easier?  Just cut the sprite element, but ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/e81/fe7/b0e/e81fe7b0ed0358ea9871a08448842229.jpg" alt="image"><br><br>  The control codes (color) will be cut off, and instead of a color symbol you will get porridge.  It is necessary to reassemble the element of the sprite character by inserting the necessary control codes before each character.  Having scored a fair amount of time with slices, I finally developed a similar algorithm.  Test script: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #      . ~/SCR/color #   sprite=( '/¬Ø¬Ø¬Ø¬Ø¬Ø\' '| 0 |' '\_____/' ) #    sprite_color=( "$RED" "$GRN" "$BLU" ) #        function bye () { stty echo printf "${CON}${DEF}" clear ls --color=auto exit } function get_dimensions { size=($(stty size)) endx=${size[1]} endy=${size[0]} } #  get_dimensions X=$endx Y=$[$endy/2] sn=${#sprite[@]} #    sl=${#sprite[0]} #  ,     trap bye INT; stty -echo; printf "${COF}"; clear #  while true; do sleep 0.1; get_dimensions for (( p=0; p&lt;${sn}; p++ )); do #     end=$[1-(${X}-${endx})] if [ $X -gt 0 ]; then bgn=0 XY ${X} $(($Y + $p)) \ #  |   "${sprite_color[$p]}${sprite[$p]:${bgn}:${end}} ${DEF}" else bgn=$[1-$X] XY 1 $(($Y + $p)) \ "${sprite_color[$p]}${sprite[$p]:${bgn}:${end}} ${DEF}" fi done ((X--)); [ $X -lt -${sl} ] &amp;&amp; X=$endx done</span></span></code> </pre> <br>  It turned out like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b1/4b5/567/9b14b5567ab9102015ccb4edc5444da7.gif" alt="image"><br><br>  But this algorithm allows you to "paint" only the entire line, it was not the ultimate dream and did not match the existing coloring of the sprites.  I had to sit still.  The color table has expanded, each character has its own color.  Each element of the color array is converted into a separate array, the indices of which coincide with the indices of the element of the sprite.  Then the color element and the sprite element are drawn in the right place at the right time. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash . ~/SCR/color #    sprite=( ' /¬Ø¬Ø¬Ø¬Ø¬Ø\ ' '-----|12345|-------- ' ' --|12345|--- ' ' ----|12345|---- ' ' \_____/ ' ) #   ,      C01=$UND$BLU; C02=$UND$BLD$BLU C03=$DEF$MGN sprite_color=( "$DEF $DEF $DEF $DEF $DEF $DEF $DEF" "$DEF $RED $GRN $C01 $C03 $YLW $DEF $RED $DEF $DEF $DEF $BLU $DEF" "$DEF $RED $GRN $C02 $C03 $YLW $DEF $DEF $GRN $DEF $DEF $DEF $DEF" "$DEF $RED $GRN $C01 $C03 $YLW $DEF $DEF $DEF $BLU $DEF $DEF $DEF" "$DEF $DEF $DEF $DEF $DEF $DEF $DEF" ) function bye () { stty echo printf "${CON}${DEF}" clear ls --color=auto exit } function get_dimensions { size=($(stty size)) endx=${size[1]} endy=${size[0]} } get_dimensions X=$endx Y=$[$endy/2] L=1 sn=${#sprite[@]} sl=${#sprite[1]} trap bye INT; stty -echo; printf "${COF}"; clear while true; do sleep 0.1; get_dimensions ((L++)); ((X--)); [ $X -lt -${sl} ] &amp;&amp; { X=$endx; L=1; } for (( p=0; p&lt;${sn}; p++ )); do color=(${sprite_color[p]}); YY=$[$Y+${p}] #       if [ $X -gt 1 ]; then for (( k=0; k&lt;${L}; k++ )); do XY $[${k}+${X}] ${YY} \ "${color[$k]}${sprite[$p]:$k:1}" done else for (( k=1; k&lt;${sl}; k++ )); do XY ${k} ${YY} \ "${color[$[$k-$X]]}${sprite[$p]:$[$k-$X]}" done fi done done</span></span></code> </pre><br>  Now all characters can be multi-colored: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e3b/d9c/a44/e3bd9ca443065cb963072d7b03a2ee83.gif" alt="image"><br><br>  Fine!  I decided to test how it would be drawn on top of another sprite.  Added static sprite to main loop: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (( p=0; p&lt;<span class="hljs-variable"><span class="hljs-variable">${sn}</span></span>; p++ )); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> XY 3 $[<span class="hljs-variable"><span class="hljs-variable">${endy}</span></span>/2+<span class="hljs-variable"><span class="hljs-variable">${p}</span></span>] <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${sprite[$p]}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br>  And checked: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/af7/59b/2cf/af759b2cf7e55125a2d03490ebe0cf1d.gif" alt="image"><br><br>  Normally, but if the back ‚Äúmask‚Äù turns out by itself, then the front part is drawn by a square, rubbing everything, again squatting. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash . ~/SCR/color #      sprite=( 5' /¬Ø¬Ø¬Ø¬Ø¬Ø\ ' 0' -----|12345|-------- ' 3' --|12345|--- ' 1' ----|12345|---- ' 5' \_____/ ' ) #     sprite_color=( "$DEF" "$DEF $DEF $DEF $DEF $DEF $DEF $DEF $MGN $YLW $grn $RED $MGN $DEF" "$DEF $DEF $DEF $DEF $DEF $DEF $DEF $BLU $GRN $cyn $ylw $blu $DEF" "$DEF $DEF $DEF $DEF $DEF $DEF $DEF $YLW $RED $BLU $grn $YLW $DEF" "$DEF" ) function bye { stty echo printf "${CON}${DEF}" clear ls --color=auto exit } function get_dimensions { size=($(stty size)) endx=${size[1]} endy=${size[0]} } get_dimensions X=$endx Y=$[$endy/2] L=1 sn=${#sprite[@]} sl=${#sprite[1]} trap bye INT; stty -echo; printf "${COF}"; clear while true; do sleep 0.1; get_dimensions #   for (( p=0; p&lt;${sn}; p++ )); do XY 3 $[${endy}/2+${p}] "${sprite[$p]}" done #   ((L++)); ((X--)) [ $X -lt -${sl} ] &amp;&amp; { X=$endx; L=1; } for (( p=0; p&lt;${sn}; p++ )); do #   color=(${sprite_color[p]}) #  Y YY=$[$Y+${p}] #   stp=${sprite[$p]:0:1} #   spr=${sprite[$p]:1} if [ $X -gt 1 ]; then for (( k=0; k&lt;${L}; k++ )); do if [ $k -ge $stp ]; then XY $[${k}+${X}] ${YY} \ "${DEF}${color[$k]}${spr:$k:1}" fi done else for (( k=1; k&lt;${sl}; k++ )); do XY ${k} ${YY} \ "${color[$[$k-$X]]}${spr:$[$k-$X]}" done fi done done</span></span></code> </pre><br>  Beauty! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0c/249/bf1/f0c249bf1821a9d2690e0d5790749fda.gif" alt="image"><br><br><div class="spoiler">  <b class="spoiler_title">Small lyrical digression</b> <div class="spoiler_text">  The mechanics of character output is built on slices.  Sections are generally very convenient.  They can be used for all sorts of cool pieces when working with text. <br><br>  Bash allows you to make cuts of both variables and arrays.  Example, variable slice: <br><br><pre> <code class="bash hljs">a=1234567890 <span class="hljs-comment"><span class="hljs-comment">#  3   echo ${a:3} 4567890 #  3    echo ${a:3:3} 456 #       ,    echo ${a:(-4)} 123456 echo ${a:(-5):(-2)} 678</span></span></code> </pre><br>  And now the array slice: <br><pre> <code class="bash hljs">a=( 1 2 3 4 5 6 7 8 9 0 ) <span class="hljs-comment"><span class="hljs-comment">#  3   echo ${a[*]:3} 4 5 6 7 8 9 0 #  3    echo ${a[*]:3:3} #    echo ${a[@]:(-5)} 6 7 8 9 0 #   -  echo ${a[@]:(-5):(-1)} bash: (-1):   &lt; 0</span></span></code> </pre><br>  I remember in the days of the Spectrum you could not be called a cool coder, if you did not make a cool scroller.  And all the cool guys did them (we too).  In all demos there were scrollers with endless gatings, mats, jokes, jokes.  It was a good time.  Let's try to scroll the scroller on BASH using sections of course: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #      XY . ~/SCR/color # ,    text=${1:-'Hello Wo00000o0000000o000orld! '}; N=${#text} #    function bye { stty echo printf "${CON}${DEF}" clear ls --color=auto exit } function get_dimensions { size=($(stty size)) endx=${size[1]} endy=${size[0]} } #  get_dimensions trap bye INT stty -echo printf "${COF}" X=$[$endx+1] Y=$[$endy/2] L=0; clear #  while true; do sleep 0.05; get_dimensions [ $X -gt 1 ] \ &amp;&amp; XY $X $Y "${text:0:$L}" \ || XY 1 $Y "${text:$[1-$X]:$L}" [ $X -lt -$N ] &amp;&amp; { X=$endx; L=0; } || ((X--)) [ $L -lt $endx ] &amp;&amp; ((L++)) done</span></span></code> </pre><br>  Hello World! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/243/b66/fa2/243b66fa2b069d9e1183905dcdeced02.gif" alt="image"><br><br>  And if you screw a <i>figlet</i> here, it will turn out generally good: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash . ~/SCR/color text=${1:-'Hello Wo00000o0000000o000orld! '}; N=${#text} function bye { stty echo printf "${CON}${DEF}" clear ls --color=auto exit } function get_dimensions { size=($(stty size)) endx=${size[1]} endy=${size[0]} } get_dimensions trap bye INT stty -echo printf "${COF}" IFSOLD=$IFS IFS=$'\n' #   figlet_text=( $(figlet -w$[$N*10] "${text}") ) IFS=$IFSOLD NF=${#figlet_text[1]} NFL=${#figlet_text[*]} X=$[$endx+1] Y=$[$endy/2-$NFL/2] L=0; clear while true; do sleep 0.05; get_dimensions if [ $X -gt 1 ]; then #      for ((i=0; i&lt;$NFL; i++)); do XY $X $[$Y+$i] "${figlet_text[$i]:0:$L}" done else for ((i=0; i&lt;$NFL; i++)); do XY 1 $[$Y+$i] "${figlet_text[$i]:$[1-$X]:$L}" done fi [ $X -lt -$NF ] &amp;&amp; { X=$endx; L=0; } || ((X--)) [ $L -lt $endx ] &amp;&amp; ((L++)) done</span></span></code> </pre><br>  There is one subtlety.  I redefine the delimiter character.  The default delimiters are: space, tab, line break.  All this is stored in the system variable <i>IFS</i> .  I remember the old meaning: <br><br><pre> <code class="bash hljs">IFSOLD=<span class="hljs-variable"><span class="hljs-variable">$IFS</span></span></code> </pre><br>  Then I set the delimiter only the line break <i>\ n</i> : <br><br><pre> <code class="bash hljs">IFS=$<span class="hljs-string"><span class="hljs-string">'\n'</span></span></code> </pre><br>  I drop the text into the array <i>figlet_text with the</i> command: <br><br><pre> <code class="bash hljs">figlet_text=( $(figlet -w$[<span class="hljs-variable"><span class="hljs-variable">$N</span></span>*10] <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${text}</span></span></span><span class="hljs-string">"</span></span>) )</code> </pre><br>  The -w switch sets the width of the string because  by default, it writes text to the screen.  This adds unnecessary transitions to the string, and the miracle does not occur.  Well, I return the old value of the separator: <br><br><pre> <code class="bash hljs">IFS=<span class="hljs-variable"><span class="hljs-variable">$IFSOLD</span></span></code> </pre><br>  A scroller scroller! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d4/333/29a/4d433329aeb4c2e022fb5d9be413665b.gif" alt="image"><br></div></div><br>  So, sprites are cut, rather push this algorithm into the game!  I tried and oh ... very much upset.  The speed, to put it mildly, left much to be desired: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/19f/356/db0/19f356db0a949615d45d23bc37f9e308.gif" alt="image"><br><br>  Multiple nested loops have a negative effect on speed (suddenly).  But I tried without trees, clouds and other tinsel, mda. <br><br>  But after so many squattings, I didn‚Äôt want to throw the idea out into the dustbin.  Mosk started working.  A solution was found.  Use both methods!  Juha!  The appearance / disappearance of the characters and the flight on the screen "fast" method.  The loop of objects now looks like this: <br><br><pre> <code class="bash hljs">NO=<span class="hljs-variable"><span class="hljs-variable">${#OBJ[@]}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (( i=0; i&lt;<span class="hljs-variable"><span class="hljs-variable">$NO</span></span>; i++ )); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> OI=(<span class="hljs-variable"><span class="hljs-variable">${OBJ[$i]}</span></span>) OX=<span class="hljs-variable"><span class="hljs-variable">${OI[0]}</span></span> OY=<span class="hljs-variable"><span class="hljs-variable">${OI[1]}</span></span> cuter=<span class="hljs-variable"><span class="hljs-variable">${OI[2]}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-variable"><span class="hljs-variable">${OI[3]}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-comment"><span class="hljs-comment">#    (\) #  1   "tree1" ) sprite=("${tree1[@]}") #    sprite_color=("${tree1_color[@]}") #   sprite_fast=("${tree12[@]}") #  -  # +---------+------+------+------+ # |  |||| # +---------+------+------+------+ mover $Q 4 4;; #  2 "tree2" ) sprite=("${tree2[@]}") sprite_color=("${tree2_color[@]}") sprite_fast=("${tree22[@]}") mover $W 6 6;; #  3 "tree3" ) sprite=("${tree3[@]}") sprite_color=("${tree3_color[@]}") sprite_fast=("${tree32[@]}") mover $E 9 10;; #  1 "cloud1") sprite=("${cloud1[@]}") sprite_color=("${cloud1_color[@]}") sprite_fast=("${cloud12[@]}") mover $Q 3 7;; #  2 "cloud2") sprite=("${cloud2[@]}") sprite_color=("${cloud2_color[@]}") sprite_fast=("${cloud22[@]}") mover $W 3 9;; #  3 "cloud3") sprite=("${cloud3[@]}") sprite_color=("${cloud3_color[@]}") sprite_fast=("${cloud32[@]}") mover $E 3 12;; #  "alien" ) sprite=("${alien[@]}") sprite_color=("${alien_color[@]}") sprite_fast=("${alien2[@]}") mover 0 3 5;; #      #   #   "bfire" ) sprite=("${bfire[@]}") #  -  # +---------+------+------+------+ # |  |||| # +---------+------+------+------+ mover 0 6 4;; #  -  "ammo" ) sprite=("${ammob[@]}") mover 0 3 4;; #  -  "life" ) sprite=("${lifep[@]}") mover 0 3 4;; #  -   "gunup" ) sprite=("${gunup[@]}") mover 0 3 4;; # ,  ,  1  "boom" ) er=${boomC} for part in "${boom[@]:$B:$boomC}"; do stp=${part:0:1} spr=${part:1} XY $[${OX} + $stp] ${OY} "${spr}"; ((OY++)) done [ ${E} = 0 ] &amp;&amp; { ((B+=${boomC})) [ $B -gt ${boomN} ] &amp;&amp; { B=0; erase_obj ${i}; }; };; esac; done</span></span></code> </pre><br>  But the <i>mover</i> function: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mover</span></span></span></span> () { er=<span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-comment"><span class="hljs-comment"># -   width=$3 #   #   [ ${1} = 0 ] &amp;&amp; { ((OX--)) ((cuter++)) OBJ[$i]="$OX $OY $cuter $type" } #     case ${type} in 'alien'|'tree'[1-3]|'cloud'[1-3]) [ $OX -lt -$width ] &amp;&amp; { remove_obj ${i} case ${type} in "alien") ((enumber--));; esac; return };; *) [ $OX -lt 1 ] &amp;&amp; { erase_obj ${i} case ${type} in "alien") ((enumber--));; esac; return; };; esac #  for (( p=0; p&lt;${er}; p++ )); do case ${type} in # \  'alien'|'tree'[1-3]|'cloud'[1-3]) color=(${sprite_color[$p]}) YY=$[$OY+${p}] stp=${sprite[$p]:0:1} spr=${sprite[$p]:1} # \ if [ $OX -gt 1 ]; then if [ $cuter -lt $width ]; then # ,   for (( k=0; k&lt;${cuter}; k++ )); do if [ $k -ge $stp ]; then XY $[$k+$OX] $YY \ "${color[$k]}${spr:$k:1}" fi done else # ,     stp=${sprite_fast[$p]:0:1} spr=${sprite_fast[$p]:1} XY $[${OX} + $stp] $[$OY + $p] "${spr}" fi #  else #   for (( k=1; k&lt;${width}; k++ )); do x=$[$k-$OX] XY $k $YY "${color[$x]}${spr:$x}" done fi;; #    *) XY ${OX} $[$OY + $p] "${sprite[$p]}";; esac #   case ${type} in "gunup" ) case "$[$OY + $p] $OX" in "$HY $HX") [ ${G} -lt 4 ] &amp;&amp; ((G++)) erase_obj ${i} break;; esac;; "life" ) case "$[$OY + $p] $OX" in "$HY $HX") ((life++)) erase_obj ${i} break;; esac;; "ammo" ) case "$[$OY + $p] $OX" in "$HY $HX") ((ammo+=100)) erase_obj ${i} break;; esac;; "bfire" ) case "$OY $OX" in "$HY $HX") ((life--)) erase_obj ${i} break;; esac;; "alien" ) #    for (( t=0; t&lt;${NP}; t++ )); do case "$[$OY + 1] $[$OX + $p]" in "${PIU[$t]}") #  ? if [ $[RANDOM % $rnd] -eq 0 ]; then OBJ+=("$OX $OY 0 ${bonuses[$[RANDOM % \ ${#bonuses[@]}]]}") ((frags++)) ((enumber--)) remove_obj ${i} remove_piu ${t} OBJ+=("${OX} ${OY} 0 boom") break fi;; esac done #    case "$[$OY + 1] $[$OX + $p]" in "$HY $HX") ((life--)) ((frags++)) ((enumber--)) remove_obj ${i} OBJ+=("${OX} ${OY} 0 boom") break;; esac;; esac done }</span></span></code> </pre><br>  I had to draw 2 sets of sprites for both methods of withdrawal.  And limit the number of simultaneously departing objects.  For others, I added timing to the appearance condition.  And trees \ clouds reduced the likelihood of occurrence.  Here are the sprites turned out, for example, a tree: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ""  tree3=( 3' _._ ' 2' / \ ' 1' _\ | / ' 0'/ \‚ïë/__ ' 0'\_\/‚ïë/ \ ' 3' \‚ïë|/_/ ' 4' ‚ïë/ ' 4' ‚ïë ' 4' ‚ïë ') #         case $month in 0[1-4]|12) CLR=${cyn} ;; #  0[5-8] ) CLR=${BLD}${GRN};; #  09|1[0-1]) CLR=${DIM}${red};; #  esac CM1=${SKY}${BLK} tree3_color=( "${SKY} ${SKY} ${SKY} ${CLR} ${CLR} ${CLR} ${SKY}" "${SKY} ${SKY} ${CLR} ${SKY} ${SKY} ${SKY} ${CLR} ${SKY}" "${SKY} ${CLR} ${CLR} ${SKY} ${CM1} ${SKY} ${CLR} ${SKY}" "${CLR} ${SKY} ${SKY} ${CLR} ${CM1} ${CLR} ${CLR} ${CLR} ${SKY}" "${CLR} ${CLR} ${CM1} ${CLR} ${CM1} ${CLR} ${SKY} ${SKY} ${CLR} ${SKY}" "${SKY} ${SKY} ${SKY} ${CM1} ${CM1} ${CLR} ${CM1} ${CLR} ${CLR} ${SKY}" "${SKY} ${SKY} ${SKY} ${SKY} ${CM1} ${CM1} ${SKY}" "${SKY} ${SKY} ${SKY} ${SKY} ${CM1} ${SKY}" "${SKY} ${SKY} ${SKY} ${SKY} ${CM1} ${SKY}") # ""  tree32=( 3${CLR}'_._ '${SKY} 2${CLR}'/ \ '${SKY} 1${CLR}'_\ '${CM1}'|'${CLR}' / '${SKY} 0${CLR}'/ \\'${CM1}'‚ïë'${CLR}'/__ '${SKY} 0${CLR}'\_'${CM1}'\\'${CLR}'/'${CM1}'‚ïë'${CLR}'/ \ '${SKY} 3${BLK}'\‚ïë'${CLR}'|'${CM1}'/'${CLR}'_/ '${SKY} 4${BLK}'‚ïë/ '${SKY} 4${BLK}'‚ïë '${SKY} 4${BLK}'‚ïë '${SKY})</span></span></code> </pre><br>  And here we smoothly move on to the next feature.  The main color of trees, clouds and background varies with the seasons.  The time of year is determined by the month.  The month is determined by the <i>date</i> : <br><pre> <code class="bash hljs">month=$(date +<span class="hljs-string"><span class="hljs-string">'%m'</span></span>)</code> </pre><br>  At different times of the year the game will look different.  Now, autumn: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/70a/fc6/252/70afc6252b770f7e9d8b66320ea059ad.gif" alt="image"><br><br>  And soon it will be so, winter - the beginning of spring: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ac1/df0/be5/ac1df0be55abb0b342ec11cf2c3cdbf0.gif" alt="image"><br><br>  And it will not be so soon.  Spring Summer: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d36/bf3/b22/d36bf3b22a92b8956fa420022a9c72e0.gif" alt="image"><br><br>  But cheaters can do this: <br><br><pre> <code class="bash hljs">month=07</code> </pre><br>  Yes, the bullet can increase to x5, and the boss has grown a bit. <br>  But this intro \ menu appeared in the game: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a37/5b9/bfb/a375b9bfb9da07077281d21efc8a9e3f.gif" alt="image"><br><br>  But here, too, not everything was smooth in terms of speed.  Large sprites, even one by one, were terribly slowed down in the character-by-character output mode.  I had to do squats again, yes. <br>  I decided to cut the sprites into pieces of 3 characters each and display them in the ‚Äúfast‚Äù method: <br><br><pre> <code class="bash hljs">D=<span class="hljs-variable"><span class="hljs-variable">$DEF</span></span>; C1=<span class="hljs-variable"><span class="hljs-variable">$BLU</span></span>; C2=<span class="hljs-variable"><span class="hljs-variable">$RED</span></span>; C3=<span class="hljs-variable"><span class="hljs-variable">$YLW</span></span>; C4=<span class="hljs-variable"><span class="hljs-variable">$red</span></span> C5=<span class="hljs-variable"><span class="hljs-variable">$BLD</span></span><span class="hljs-variable"><span class="hljs-variable">$YLW</span></span>; C6=<span class="hljs-variable"><span class="hljs-variable">$BLD</span></span><span class="hljs-variable"><span class="hljs-variable">$GRN</span></span>; C7=<span class="hljs-variable"><span class="hljs-variable">$blu</span></span>; C8=<span class="hljs-variable"><span class="hljs-variable">$BLD</span></span><span class="hljs-variable"><span class="hljs-variable">$RED</span></span> <span class="hljs-comment"><span class="hljs-comment"># ‚ñë ‚ñë‚ñë‚ñë ‚ñë‚ñë ‚ñë ‚ñë‚ñë ‚ñë‚ñë ‚ñë‚ñë ‚ñë # ‚ñë ‚ñë ‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñë‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñí‚ñà‚ñà‚ñë ‚ñí‚ñà‚ñà # ‚ñë ‚ñë‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà ‚ñì‚ñì‚ñì‚ñà‚ñà‚ñì ‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñë‚ñë ‚ñë #‚ñë ‚ñë ‚ñë‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà ‚ñí‚ñí‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñë # ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë ‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñë‚ñí‚ñì‚ñà‚ñà‚ñë‚ñë ‚ñë ‚ñë # ‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñì‚ñì‚ñì‚ñì ‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñë ‚ñí‚ñì‚ñà‚ñà‚ñë‚ñë‚ñí‚ñì‚ñà‚ñà ‚ñë # ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñí‚ñë ‚ñë ‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë ‚ñë #‚ñë ‚ñë‚ñí‚ñì‚ñì‚ñì‚ñì ‚ñë ‚ñë‚ñë‚ñí‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì ‚ñë ‚ñí‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë # ‚ñë ‚ñí‚ñí ‚ñë ‚ñë ‚ñë ‚ñë‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí ‚ñë ‚ñë‚ñë‚ñí‚ñí‚ñí‚ñí‚ñë ‚ñë piu=( "$C1 " "‚ñë " " ‚ñë‚ñë" "‚ñë ‚ñë" "‚ñë " " " "‚ñë " "‚ñë‚ñë " " " " ‚ñë" "‚ñë " "‚ñë‚ñë " "‚ñë$D " " " "$C1 ‚ñë " " ‚ñë" " $C2‚ñí" "$C3‚ñà‚ñà‚ñà" "‚ñà‚ñà‚ñà" " $C1‚ñë$C2‚ñí" "$C3‚ñà‚ñà‚ñà" "‚ñà‚ñà‚ñà" " $C2‚ñí$C3‚ñà" "‚ñà$C1‚ñë " " $C2‚ñí$C3‚ñà" "‚ñà$D " " " " " "$C1 " "‚ñë ‚ñë" "‚ñë$C2‚ñí$C4‚ñì" "$C3‚ñà‚ñà " "$C2‚ñí$C4‚ñì$C3‚ñà" "‚ñà $C4‚ñì" "‚ñì‚ñì$C3‚ñà" "‚ñà$C4‚ñì " "$C1‚ñí$C4‚ñì$C3‚ñà" "‚ñà $C1‚ñë" "$C2‚ñí$C4‚ñì$C3‚ñà" "‚ñà$C1‚ñë‚ñë" " ‚ñë$D " " " "$C1‚ñë ‚ñë" " ‚ñë‚ñë" "$C2‚ñí$C4‚ñì$C3‚ñà" "‚ñà $C2‚ñí" "$C4‚ñì$C3‚ñà‚ñà" " $C2‚ñí‚ñí" "‚ñí$C4‚ñì$C3‚ñà" "‚ñà $C2‚ñë" "‚ñí$C4‚ñì$C3‚ñà" "‚ñà$C1‚ñë " "$C2‚ñí$C4‚ñì$C3‚ñà" "‚ñà$C1‚ñë$D " " " " " "$C1 " " " "$C2‚ñí$C4‚ñì$C5‚ñà" "‚ñà‚ñà‚ñà" "‚ñà‚ñà$C1‚ñë" " ‚ñë$C2‚ñí" "$C4‚ñì$C3‚ñà‚ñà" " $C1‚ñë$C2‚ñí" "$C4‚ñì$C3‚ñà‚ñà" " $C1‚ñë$C2‚ñí" "$C4‚ñì$C3‚ñà‚ñà" "$C1‚ñë‚ñë " "‚ñë ‚ñë$D" " " "$C1 ‚ñë" " $C2‚ñí" "$C4‚ñì$C3‚ñà‚ñà" "$C4‚ñì‚ñì‚ñì" "‚ñì " "$C1‚ñë $C2‚ñí" "$C4‚ñì$C3‚ñà‚ñà" "$C1‚ñë $C2‚ñí" "$C4‚ñì$C3‚ñà‚ñà" "$C1‚ñë‚ñë$C2‚ñí" "$C4‚ñì$C3‚ñà‚ñà" " $C1‚ñë$D " " " " " "$C2 " "‚ñí$C4‚ñì$C3‚ñà" "‚ñà‚ñà‚ñà" "$C2‚ñí‚ñí‚ñí" "$C1‚ñë ‚ñë" " $C4‚ñì$C3‚ñà" "‚ñà‚ñà‚ñà" "‚ñà‚ñà " "$C1‚ñí$C4‚ñì$C3‚ñà" "‚ñà‚ñà‚ñà" "‚ñà‚ñà$C1‚ñë" "‚ñë ‚ñë$D" " " " " "$C1‚ñë ‚ñë" "$C2‚ñí$C4‚ñì‚ñì" "‚ñì‚ñì " "$C1‚ñë ‚ñë" "‚ñë$C2‚ñí$C4‚ñì" "‚ñì‚ñì‚ñì" "‚ñì‚ñì " "$C1‚ñë $C2‚ñí" "$C4‚ñì‚ñì‚ñì" "‚ñì‚ñì$C1‚ñë$D" " " " " " " " " "$C1 ‚ñë " "‚ñí‚ñí " "‚ñë ‚ñë" " ‚ñë " "‚ñë‚ñí‚ñí" "‚ñí‚ñí‚ñí" "‚ñí ‚ñë" " ‚ñë‚ñë" "‚ñí‚ñí‚ñí" "‚ñí‚ñë " " ‚ñë " " " " " "$D ") piuN=${#piu[*]}; piuC=14 # ‚ñë‚ñë ‚ñí‚ñí‚ñà‚ñà‚ñà‚ñë # ‚ñë‚ñë‚ñë ‚ñí‚ñà‚ñà‚ñà‚ñà ‚ñí‚ñì‚ñà‚ñà‚ñà‚ñë # ‚ñë ‚ñí‚ñà‚ñà‚ñà‚ñà‚ñí‚ñì‚ñì‚ñì‚ñì ‚ñë‚ñë‚ñí‚ñì‚ñì‚ñà‚ñà‚ñà ‚ñë‚ñë ‚ñë #‚ñë ‚ñí‚ñì‚ñì‚ñì‚ñì ‚ñí‚ñà‚ñà‚ñà‚ñà‚ñë‚ñí‚ñì‚ñà‚ñà‚ñà‚ñë‚ñë # ‚ñí ‚ñí‚ñí ‚ñí‚ñì‚ñì‚ñì‚ñì‚ñí‚ñì‚ñà‚ñà‚ñà‚ñë # ‚ñë‚ñë‚ñë ‚ñí‚ñí‚ñí ‚ñë‚ñë‚ñí‚ñí‚ñë arr=( " " " " " " " " " $C7‚ñë‚ñë" " $C3‚ñí‚ñí" "$C6‚ñà‚ñà‚ñà" "$C7‚ñë$D " "" "" " " " " " $C7‚ñë" "‚ñë‚ñë " "$C2‚ñí$C8‚ñà‚ñà" "‚ñà‚ñà " "$C7‚ñí$C3‚ñì$C6‚ñà" "‚ñà‚ñà$C7‚ñë$D" "" "" " " " $C7‚ñë " "‚ñí$C8‚ñà‚ñà" "‚ñà‚ñà$D$C2‚ñí" "$C3‚ñì‚ñì‚ñì" "‚ñì $C7‚ñë" "‚ñë$C7‚ñí$C3‚ñì" "‚ñì$C6‚ñà‚ñà" "‚ñà $C7‚ñë" "‚ñë ‚ñë$D" " " "$C7‚ñë $C2‚ñí" "$C3‚ñì‚ñì‚ñì" "‚ñì $C2‚ñí" "$C8‚ñà‚ñà‚ñà" "‚ñà$D$C7‚ñë$C3‚ñí" "$C3‚ñì$C6‚ñà‚ñà" "‚ñà$C7‚ñë‚ñë$D" " " "" " " " $C7‚ñí " "‚ñí‚ñí " " $C2‚ñí$C3‚ñì" "‚ñì‚ñì‚ñì" "$C7‚ñí$C3‚ñì$C6‚ñà" "‚ñà‚ñà$C7‚ñë$D" " " "" "" " " " " " $C7‚ñë‚ñë" "‚ñë ‚ñí" "‚ñí‚ñí " "‚ñë‚ñë‚ñí" "‚ñí‚ñë$D " " " "" "") arrN=${#arr[*]}; arrC=10</span></span></code> </pre><br>  All this beauty is drawn with its <i>left</i> , <i>right</i> and <i>intro</i> functions: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span></span> () { N=<span class="hljs-variable"><span class="hljs-variable">$1</span></span>; C=<span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-comment"><span class="hljs-comment"># move [ $OX -ge $end ] &amp;&amp; { ((OX-=3)); [ $cuter -ne $C ] &amp;&amp; ((cuter++)) for ((j=0; j&lt;$N; j+=$C)); do line=("${sprite[@]:$j:$cuter}") YY=$[$OY+$j/$C]; spr= for part in "${line[@]}"; dospr+="${part}"; done XY $OX $YY "${spr}" done; OBJ[$i]="$OX $OY $cuter $end $type $pause" } || { remove_obj $i; ((Q++)); OBJ+=("${scenario[$Q]}"); } } function right () { N=$1; C=$2 # move [ $OX -le $end ] &amp;&amp; { [ $cuter -ne $C ] &amp;&amp; ((cuter++)) || ((OX+=3)) for ((j=0; j&lt;$N; j+=$C)); do line=("${sprite[@]:$j:$C}") YY=$[$OY+$j/$C]; spr= for ((k=$[$C-$cuter]; k&lt;$C; k++)); do spr+="${line[k]}"; done XY $OX $YY "${spr}" done; OBJ[$i]="$OX $OY $cuter $end $type $pause" } || { remove_obj $i; ((Q++)); OBJ+=("${scenario[$Q]}"); } } function intro { get_dimensions; Q=0 scenario=( #    #----------+-------+-----+------------+----+ #  X | Y||  X | | #----------+-------+-----+------------+----+ "$[$endx+1] 3 0 $[endx/2-34] piu" "$[$endx+1] 3 0 $[endx/2+2] piu" "-2 12 0 $[endx/2-16] arr" "0 0 0 0 end") OBJ=("${scenario[$Q]}") while true; do sleep 0.005; NO=${#OBJ[@]} for (( i=0; i&lt;$NO; i++ )); do OI=(${OBJ[$i]}); OX=${OI[0]}; OY=${OI[1]} cuter=${OI[2]}; end=${OI[3]}; type=${OI[4]} case $type in #-----+-------------------+------+------+------+ # |  |.||| #-----+-------------------+------+------+------+ "arr") sprite=("${arr[@]}"); right $arrN $arrC;; "piu") sprite=("${piu[@]}"); left $piuN $piuC;; "end") return ;; esac done done }</span></span></code> </pre><br>  The sequence of the appearance of objects is specified in the <i>scenario</i> array.  The menu item <i>conf</i> allows customization of the (small) airplane.  You can change the color of the airplane and the symbol on the tail (and its color). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dcf/a5b/ece/dcfa5beced24a4d47448236c7a8e773f.gif" alt="image"><br><br>  And a handful of minor improvements \ corrections in the course of writing two articles (to the word about the benefits of articles).  Then I want to work on optimization, raise the FPS and try to implement a cooperative network, to be continued.  That's all for now (I heard it somewhere). <br><br>  Continued <a href="https://habrahabr.ru/post/339268">I. BASH'im together</a> <br><br>  Piu, piu, piu!  :) </div><p>Source: <a href="https://habr.com/ru/post/337896/">https://habr.com/ru/post/337896/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337880/index.html">"Patterns" of functional programming</a></li>
<li><a href="../337882/index.html">Oh, the very long-awaited release of Sublime Text 3.0</a></li>
<li><a href="../337888/index.html">Using different metrics to cluster key queries</a></li>
<li><a href="../337890/index.html">HPE ProLiant Gen8 and Gen9 vs. Servers Gen10</a></li>
<li><a href="../337892/index.html">Just about the complex: what you need to know about bioinformatics</a></li>
<li><a href="../337898/index.html">China made a new move in the race supercomputers</a></li>
<li><a href="../337900/index.html">The right choice of SrZI: from flyers to use case</a></li>
<li><a href="../337902/index.html">Robots in human society</a></li>
<li><a href="../337906/index.html">Talk about hosting security: how could I hack tens of thousands of sites</a></li>
<li><a href="../337908/index.html">We invite to the Azov Developers Meetup conference - September 23 in Taganrog</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>