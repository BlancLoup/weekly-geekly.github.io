<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MS SQL backup: a couple of useful Commvault functions that not everyone knows about</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I‚Äôll tell you about two Commvault possibilities for MS SQL backup, which are unfairly avoided: granular recovery and the Commvault plugin for SQ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MS SQL backup: a couple of useful Commvault functions that not everyone knows about</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/az/g6/3f/azg63fgl1r4cfr9t0_1-vfrebxo.png"><br><br>  Today I‚Äôll tell you about two Commvault possibilities for MS SQL backup, which are unfairly avoided: granular recovery and the Commvault plugin for SQL Management Studio.  The basic moments of the settings will not be considered.  The post is more likely for those who already know how to install an agent, set up a schedule, policies, etc. On how Commvault works and what it can do, I told in this <a href="https://habr.com/ru/company/dataline/blog/318188/">post</a> . <br><a name="habracut"></a><br><h3>  Granular restoration </h3><br>  The <b>table level restore</b> option has appeared in the Subclient properties relatively recently.  It allows you to enable the ability to restore tables from the database, while not restoring the entire database from the backup.  This is useful when you know exactly where the error or data loss is.  At the same time, the base itself is large and it will take a lot of time to restore it. <br><br><img src="https://habrastorage.org/webt/e9/r-/5m/e9r-5mcu7hen0f9x3txq1rxsuw8.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This option has limitations: <br><br><ul><li>  Tables cannot be restored to the original database, only to another. </li><li>  All tables are restored to the dbo schema.  The table cannot be restored to the user schema. </li><li>  Only local SQL Server account with system administrator rights is supported. </li><li>  The target server to restore the table should work on Windows. </li><li>  On the target server, in addition to the SQL Agent, the Media Agent and Java Runtime Environment must be installed. </li><li>  The database must use the Recovery model in Full mode. </li><li>  If the granular database recovery option is enabled, the ability to run differential backup jobs is lost. </li></ul><br><img src="https://habrastorage.org/webt/de/88/wt/de88wtsschuzzmp-dcmm1pms7-s.jpeg"><br>  <i>The table-level-restore option is disabled.</i> <br><br><img src="https://habrastorage.org/webt/5d/ea/e5/5deae5vhqzy1jw_8xhwppaldjia.jpeg"><br>  <i>The table-level-restore option is disabled.</i> <br><br>  In my practice there was a case when the client for the SQL server was configured with the following schedule: one full backup once a week and 6 differential backups on weekdays.  He enabled the table-level-restore function, and the tasks for the differential backup were performed with an error. <br><br>  Let's see what the recovery will look like. <br><br>  1. We start recovery on the necessary agent. <br><br><img src="https://habrastorage.org/webt/e2/p9/wa/e2p9wab_8tnblg6giokx7vnhhuq.jpeg"><br><br>  2. In the window that appears, go to the <b>Advanced Options</b> tab.  Select <b>SQL Granular Browse - View Content.</b> <br><br><img src="https://habrastorage.org/webt/ak/vf/o1/akvfo1b1qes9sgvnft5hbozu86m.jpeg"><br><br>  3. In the list that opens, select the database from which we will restore the table, and click <b>Restore Granular</b> . <br><br><img src="https://habrastorage.org/webt/e5/zp/wo/e5zpwokavkwqhieszf1towlmkm8.jpeg"><br><br>  4. In the dialog box, set up a database mount point from backup files (something like Instant Recovery technology). <br><br>  Specify: <br><br><ul><li>  name for the temporary database; </li><li>  how long to keep this recovery point in days; </li><li>  server where we will mount the database.  Only servers that fulfill all the necessary conditions mentioned above will be available in the list: with the Windows operating system, the installed Media Agent and the Java Runtime Environment, etc. </li></ul><br>  Click OK. <br><br><img src="https://habrastorage.org/webt/vd/rm/0s/vdrm0s597zro1cduudlfkabs83w.jpeg"><br><br>  5. In the new window, click on List Recovery Points. <br><br><img src="https://habrastorage.org/webt/dr/rh/ey/drrheytr4et_xletdcpojpwbmlm.jpeg"><br><br>  6. A list of mounted recovery points will open.  If the database is large, you will have to wait.  Then click <b>Browse</b> .  A window will appear to view the tables from the selected database. <br><br><img src="https://habrastorage.org/webt/nx/0r/0z/nx0r0zja78oa0jhbbjw7y60xquk.jpeg"><br><br>  While the list is being formed, often the Recovery Points dialog box is closed, and then they cannot return there again.  It's simple: right-click on the instance of the SQL server where the restore point mount process was started.  Go to All Tasks and select List Recovery Points. <br><br><img src="https://habrastorage.org/webt/_l/b1/5y/_lb15ylva1vqhh82ffp8_mveg2y.jpeg"><br><br>  7. If there are many tables, it will take some time to display them.  For example, for a 40 GB database, the list is formed in about ten minutes.  Select the desired table, click Recover All Selected. <br><br><img src="https://habrastorage.org/webt/7q/rf/jl/7qrfjlvm3e3pyccdaipcozmssqc.jpeg"><br><br>  8. In the new window, select the database where we will restore the table (s).  In our case, this is the base GPI TEST. <br><br><img src="https://habrastorage.org/webt/md/46/i2/md46i29vzypakjqlj-vtskacliq.jpeg"><br><br>  9. After the recovery is completed, the selected tables will appear in the GPI TEST database. <br><br><img src="https://habrastorage.org/webt/ue/0h/wq/ue0hwqzoktno-_lh1k2d8ux7zrs.jpeg"><br><br>  After the table is restored to a temporary database, it can be transferred to the original database using Management Studio. <br><br><h3>  Commvault Plug-in for SQL Management Studio </h3><br>  Database administrators do not always have access to the backup system (RMS).  Sometimes you need to do something urgently, but the administrator of the RMS is not in place.  Using the Commvault plugin for SQL Management Studio, the DBA will be able to perform basic backup and restore operations. <br><table><tbody><tr><td>  <b>QL Management Studio Version</b> <br></td><td>  <b>Command</b> <br></td></tr><tr><td>  SQL 2008 R2 <br></td><td>  CvSQLAddInConfig.exe / i 10 / r <br></td></tr><tr><td>  SQL 2012 <br></td><td>  CvSQLAddInConfig.exe / i 11 / r <br></td></tr><tr><td>  SQL 2014 <br></td><td>  CvSQLAddInConfig.exe / i 12 / r <br></td></tr><tr><td>  SQL 2016 <br></td><td>  CvSQLAddInConfig.exe / i 13 / r <br></td></tr><tr><td>  SQL 2017 <br></td><td>  CvSQLAddInConfig.exe / i 14 / r <br></td></tr></tbody></table><br>  <i>Versions of SQL servers that support Commvault Plug-in and commands that activate the plug-in.</i>  <i>The plugin is supported only on the 64-bit version of Windows.</i> <br><br>  1. Execute the command that corresponds to our version of SQL server: <br><br><img src="https://habrastorage.org/webt/go/qy/zh/goqyzhsrhqzci0buz1zo8biha3e.jpeg"><br><br>  2. Now backup and restore options are available in Management Studio.  To do this, right-click on the desired database. <br>  Thus, the administrator has the opportunity to directly interact with the backup copies of this database without the Commvault console and calls to the administrator of the RMS. <br><br><img src="https://habrastorage.org/webt/pa/5s/b-/pa5sb-xjzyxss86vfzkwgbjmagy.jpeg"><br><br>  3. When starting any of the available functions of this menu, a window will appear asking for the login and password.  To connect to CommServe, use SSO or any other account from the Security section of Commserve (Commcell login). <br><br><img src="https://habrastorage.org/webt/8y/th/8_/8yth8_gnlkmjc_ypieqwua8kof4.jpeg"><br><br><img src="https://habrastorage.org/webt/zy/2o/8m/zy2o8mg49z284ozv5o5pqyqupei.png"><br><br>  4. If the credentials have been entered correctly and access rights are sufficient, the DBA may: <br><br><ul><li>  run an extraordinary backup (Backup); </li><li>  restore the database from the backup (Restore); </li><li>  view the history of completed tasks (View History) and the progress of tasks in the process of execution (Job monitor). </li></ul><br><img src="https://habrastorage.org/webt/lv/dr/qf/lvdrqfvjvnvyim_rmicorvcdjlo.jpeg"><br>  <i>This is how the history of completed backup tasks for the selected database looks in Management Studio.</i> <br><br><img src="https://habrastorage.org/webt/if/f9/mq/iff9mqi1zhjpidawfpfhr3l3bk4.jpeg"><br>  <i>Menu to restore the database.</i>  <i>It does not even differ from the console menu.</i> <br><br>  That's all about these two features of the SQL Agent from Commvault.  I will add that backing up with Commvault means will be more suitable for those who have dozens of servers serviced, with several instances and databases, all this is possible at different sites and requires setting different schedules, depths, etc. If you have a couple of servers, then there is enough backup and regular MS SQL tools. <br><br>  <a href="http://documentation.commvault.com/commvault/v11/article%3Fp%3D18110.htm">A source</a> </div><p>Source: <a href="https://habr.com/ru/post/447666/">https://habr.com/ru/post/447666/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447656/index.html">The inconstancy of evolution: live birth and egg-laying simultaneously in lizards of the species Saiphos equalis</a></li>
<li><a href="../447658/index.html">Action programming games - fun or a way to introduce children to algorithms and robotics</a></li>
<li><a href="../447660/index.html">What to expect from the new Xeon E. Compare with E3 and draw conclusions</a></li>
<li><a href="../447662/index.html">Grand Express: the first private train in Russia</a></li>
<li><a href="../447664/index.html">Sales based on end-to-end business analytics</a></li>
<li><a href="../447668/index.html">MSH Interpreter</a></li>
<li><a href="../447670/index.html">Import substitution in practice. Part 2. Start. Hypervisor</a></li>
<li><a href="../447672/index.html">Catalog of IT systems of the company</a></li>
<li><a href="../447674/index.html">The code is alive and dead. Part two. Actions and properties</a></li>
<li><a href="../447676/index.html">New Mail Mail.ru and what's the octopus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>