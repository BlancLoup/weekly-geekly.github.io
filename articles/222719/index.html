<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As we wrote the URL filtering Rostelecom</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, Habr√© had an article about the introduction of URL filtering by Rostelecom (RTK). It so happened that we offered them to solve this problem ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As we wrote the URL filtering Rostelecom</h1><div class="post__text post__text-html js-mediator-article">  Recently, Habr√© had <a href="http://habrahabr.ru/post/222455/">an article</a> about the introduction of URL filtering by Rostelecom (RTK).  It so happened that we offered them to solve this problem a year and a half ago and a year ago they made a solution that passed all the tests and which Rostelecom was ready to include.  By the time our shop fell out of mercy, well, yes it is not a question of technology.  Therefore, all of the following is the details of our proposed solution.  What exactly is implemented, God knows. <br><a name="habracut"></a><br><h4>  DPI and IP blocking </h4><br>  Apparently start with DPI.  They are in some quantity on the network, but putting them on all traffic would have cost RTC several tens of millions of dollars and would constantly require new investments due to the growth in consumption by the bored population.  Neither the previous nor the current leaders have decided on this (perhaps only for now), because the introduction of DPI does not promise any new services with tangible amounts of income. <br><br>  Since the RTK should have blocked various resources before (the courts decide without regard to the laws), I did it by IP address.  Accordingly, the simplest filtering at the boundaries solved the problem.  Similarly, they began to solve the problem with the registry of prohibited resources: a specially trained person unloaded the registry, there is both a URL and IP and then added entries to the list, and an access list rules script. <br><br><h4>  Filter management software </h4><br>  We have automated communication with the registry, and here, as everyone understands, there is no magic (there‚Äôs no much of it anymore).  Recorded changes in the registry and the implementation of censorship on the network.  Added small ryushechki associated with a distributed structure of responsibility on the network of RTK, exclusion from the filter of the part of subscribers (in particular, of the most extreme operators).  Well, the courts have not been canceled, so it is possible to make any resource from the court decision.  In addition, the management software configures traffic redirection to filtering nodes, prepares reports on user search queries, monitors filtering nodes, and logs all activities. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/9d5/c71/34d/9d5c7134df39936c55bb8743b8a51368.jpg"><br><br><h4>  Traffic rotation and filtering </h4><br>  Traffic sent by subscribers to IP addresses corresponding to blocked URLs on PE was turned into a special VPN, where defult looks at a pair of routers in the center.  Using SCU / DCU (similar functionality seems to be on pussies), at the border, at the source addresses, traffic from subscribers who are not subject to filtering was excluded.  The management software formed / 32 routes according to the IP addresses of the registry, the rules of the config on the central router and the changes took effect.  I remember the refusal of sending BGP updates, because it is not good. <br><br>  Two central routers were configured to copy passing traffic based on the ports.  Accordingly, for the entire RTK, several megabits were obtained from strength.  It was possible to copy either to an external server or to MS-DPC.  And there and there the principle of further processing was the same.  The filtering software catches the packet, if in it get with the URL from the list, then in the direction of the server the helmet is reset, and in the direction of the browser redirect to the site with a story about how important moral principles are for modern Russian society. <br><br>  The minimum response time from the servers included in the registry a year ago exceeded 100 ms, and the software analyzing the URL produced a response 5-6 ms with a load of 3 Gb / s.  Therefore, it was decided that to fence a proxy, to ensure its reliability and so on in the same spirit does not make sense.  If the filtering software fails, everything will work, except for filtering.  True, at the request of RTK, they still designed a couple of filtering servers. <br><br>  Now it is clear that it was possible and a little easier to do, use a small DPI in the center instead of your filtering software.  But we have already done so to another operator.  It may be that the selected implementers will combine their registry software with a regular DPI, through which only the selected traffic will go.  At the time, we wanted to understand whether there was at least some task that would be worth implementing on the service modules in the router, and not outside.  The fact that Juniper has closed access to modules for external developers gives a clear answer to this question, but we were then still tormented by doubts. <br><br>  As for the cost, of the million in question, more than half were servers, so it was not planned to make a big profit on the software. </div><p>Source: <a href="https://habr.com/ru/post/222719/">https://habr.com/ru/post/222719/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222709/index.html">Pathological matrix of the project</a></li>
<li><a href="../222711/index.html">Choose your Storage at DevConf 2014 - June 14 or as we embraced the immense</a></li>
<li><a href="../222713/index.html">IStick - compact flash drive for IOS devices</a></li>
<li><a href="../222715/index.html">400 Mbps over normal twisted pair for regular apartments</a></li>
<li><a href="../222717/index.html">Lunokhod-1. The first track on the moon</a></li>
<li><a href="../222725/index.html">Auto Layout and UIScrollView. How to cook it?</a></li>
<li><a href="../222727/index.html">About novice developers and how to work with them</a></li>
<li><a href="../222729/index.html">FLAC.JS Web Player (HTML5)</a></li>
<li><a href="../222731/index.html">Automatic placement of search tags</a></li>
<li><a href="../222737/index.html">As I wrote a web application using only clojure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>