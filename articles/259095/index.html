<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sexy primes, "slow python" or how I fought against the wall of misunderstanding</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many developers, especially those who are actively involved in the design of the system, probably faced a similar situation: a colleague comes (razrab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sexy primes, "slow python" or how I fought against the wall of misunderstanding</h1><div class="post__text post__text-html js-mediator-article">  Many developers, especially those who are actively involved in the design of the system, probably faced a similar situation: a colleague comes (razrab, project or salesman does not matter) with another fixed idea: let's rewrite everything to java, scala, etc.  (favorite substitute). <br><br>  So I once again "lowered" such an idea in a rather big-legacy project.  Not completely rewritten, not quite everything (well, in the future).  In general, go from the python (and we also have a tickle modularly present there) to scala.  It was about the development of new modules and services, i.e.  start with the middle-level and front-nearby API's least attached.  As I understood in perspective, it is possible entirely. <br><br>  A person is not a developer, like an initial project and a little sales person (for a specific client) in one person. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I am not that opposed.  And I respect the rock and in my own love.  Usually I am generally open to everything new.  For example, in some places besides tickle and python, we have services or modules in other languages.  So, for example, we moved from cvs to svn, and then to git (and earlier, a long time ago, in general, MS-VSS was).  There are actually a lot of examples, one thing unites them - the developers themselves decided so or at least (collectively, or there was a group of initiators - it does not matter).  And the point is generally in the arguments for and against. <br><br>  The problem is that sometimes for a reasoned discussion ‚ÄúDeveloper vs.  Anybody-Else ‚Äùin the latter does not reach the level of knowledge of‚Äú matter ‚Äùor it is simply incredibly difficult to convey a thought - that is,  as it were, a conversation in different languages.  And it's good if this is someone like software architect.  Worse, if we have a ‚Äúconversation,‚Äù for example, with a pure sales person, who announced, for example, sudden customer requirements. <br><br>  Why no one prescribes, for example, a tiler - what kind of trowel to work for him (such as with 10mm glue teeth will go away more, let's still have 5mm. And the fact that there are curved walls doesn‚Äôt bother anyone).  And theoretically, the screw can also be ‚Äútwisted‚Äù with a hammer, but for this there is a screwdriver, and later a screwdriver was invented.  I exaggerate of course, but sometimes it really reminds me of such absurdity. <br><br>  This is me to the fact that the developer should ideally choose the developer himself or have at least the last word in it - to work with him <s>or suffer</s> from this instrument. <br><br>  But something I digress.  In my particular history of arguments - for scala, the man, as always, has almost none. <br>  Although I could talk for a long time about things, such as the presence of developers, ready-made developments, a well-honed and debugged system, etc.  etc.  But caught on his "Python is very slow."  As an example, he threw a link at <a href="http://stackoverflow.com/questions/11641098/interpreting-a-benchmark-in-c-clojure-python-ruby-scala-and-others">Interpreting a benchmark in C, Clojure, Python, Ruby, Scala and others - Stack Overflow</a> to me, which he didn‚Äôt even read to the end (for there is almost direct text - everything is not so bad with python) . <br><br>  It was meant exactly this (the time is indicated in seconds): <br><pre><code class="bash hljs">Sexy primes up to: 10k 20k 30k 100k --------------------------------------------------------- Python2.7 1.49 5.20 11.00 119 Scala2.9.2 0.93 1.41 2.73 20.84 Scala2.9.2 (optimized) 0.32 0.79 1.46 12.01</code> </pre> <br><a name="habracut"></a><br>  Talking with him at the level of a purely technical side, there is not the slightest desire.  Those.  about memory allocation / object pool, GC (we do not have pure CPython, more like RPython or pypy with its own Jit, MemMgr, GC), about any sugar with which the person writing Bench has gone a little too far, etc. <br><br>  My answer was ‚Äúthey don‚Äôt like to develop on python for this‚Äù and ‚Äúthey don‚Äôt write it that way, at least the speed-critical code‚Äù.  I was a little deceitful and naturally understand that this benchmark example is artificial, that is,  Means purely to measure speed.  But the sores that, with such a test, increase in CPython, are also known to me. <br>  Therefore, I still tried on this particular example to show why this test is not expedient, well, or why it is not completely objective or something. <br><br>  I started by showing him this test and the results of execution (marked with a star) in PyMNg (which is our build), pypy2, pypy3 and python3 (which was the same slow for the same understandable reasons).  Iron, of course, is different, but the order, I think, is about the same. <br><pre> <code class="bash hljs"> Sexy primes up to: 10k 20k 30k 100k --------------------------------------------------------- PyMNg * 0.10 - - 2.46 pypy2 * 0.13 - - 5.44 pypy3 * 0.12 - - 5.69 --------------------------------------------------------- scala 2.10.4 (warmed up) * - - 6.57 scala 2.10.4 (cold) * - - 7.11 --------------------------------------------------------- Python3.4 * 1.41 - - 117.69 --------------------------------------------------------- Python2.7 1.49 5.20 11.00 119.00 Scala2.9.2 0.93 1.41 2.73 20.84 Scala2.9.2 (optimized) 0.32 0.79 1.46 12.01</code> </pre><br>  Further, in principle, it was possible not to continue; I just wanted to make an attempt to explain to a person what he was wrong in that the choice of language is not evaluated by benchmarks like ‚ÄúHello, world‚Äù, etc. <br><br>  So, the task is to look for ‚Äúsexy‚Äù pairs of prime numbers on python.  A lot and fast. <br><br>  For those who are not interested in debriefing, a <a href="https://github.com/sebres/misc/blob/master/python/sexy-primes-test.py">link to the script on github</a> , if there is a desire to play. <br><br>  The results of the performance of each option under the spoiler, respectively. <br>  <b>100K</b> for all options. <br><div class="spoiler">  <b class="spoiler_title">pypy3 sexy-primes-test.py 100K</b> <div class="spoiler_text"><pre> <code class="python hljs"> org = <span class="hljs-number"><span class="hljs-number">5.69000</span></span> s = <span class="hljs-number"><span class="hljs-number">5690.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] mod1 = <span class="hljs-number"><span class="hljs-number">2.45500</span></span> s = <span class="hljs-number"><span class="hljs-number">2455.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] mod2 = <span class="hljs-number"><span class="hljs-number">1.24300</span></span> s = <span class="hljs-number"><span class="hljs-number">1243.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] org2 = <span class="hljs-number"><span class="hljs-number">3.46800</span></span> s = <span class="hljs-number"><span class="hljs-number">3468.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] max = <span class="hljs-number"><span class="hljs-number">0.03200</span></span> s = <span class="hljs-number"><span class="hljs-number">32.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] orgm = <span class="hljs-number"><span class="hljs-number">0.13000</span></span> s = <span class="hljs-number"><span class="hljs-number">130.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] siev1 = <span class="hljs-number"><span class="hljs-number">0.01200</span></span> s = <span class="hljs-number"><span class="hljs-number">12.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] siev2 = <span class="hljs-number"><span class="hljs-number">0.01000</span></span> s = <span class="hljs-number"><span class="hljs-number">10.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] osie1 = <span class="hljs-number"><span class="hljs-number">0.01200</span></span> s = <span class="hljs-number"><span class="hljs-number">12.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] osie2 = <span class="hljs-number"><span class="hljs-number">0.00200</span></span> s = <span class="hljs-number"><span class="hljs-number">2.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>]</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">python34 sexy-primes-test.py 100K</b> <div class="spoiler_text"><pre> <code class="python hljs"> org = <span class="hljs-number"><span class="hljs-number">120.75802</span></span> s = <span class="hljs-number"><span class="hljs-number">120758.02</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] mod1 = <span class="hljs-number"><span class="hljs-number">132.99282</span></span> s = <span class="hljs-number"><span class="hljs-number">132992.82</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] mod2 = <span class="hljs-number"><span class="hljs-number">76.65101</span></span> s = <span class="hljs-number"><span class="hljs-number">76651.01</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] org2 = <span class="hljs-number"><span class="hljs-number">53.42527</span></span> s = <span class="hljs-number"><span class="hljs-number">53425.27</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] max = <span class="hljs-number"><span class="hljs-number">0.44004</span></span> s = <span class="hljs-number"><span class="hljs-number">440.04</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] orgm = <span class="hljs-number"><span class="hljs-number">0.39003</span></span> s = <span class="hljs-number"><span class="hljs-number">390.03</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] siev1 = <span class="hljs-number"><span class="hljs-number">0.04000</span></span> s = <span class="hljs-number"><span class="hljs-number">40.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] siev2 = <span class="hljs-number"><span class="hljs-number">0.04250</span></span> s = <span class="hljs-number"><span class="hljs-number">42.50</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] osie1 = <span class="hljs-number"><span class="hljs-number">0.04500</span></span> s = <span class="hljs-number"><span class="hljs-number">45.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>] osie2 = <span class="hljs-number"><span class="hljs-number">0.04250</span></span> s = <span class="hljs-number"><span class="hljs-number">42.50</span></span> mils | <span class="hljs-number"><span class="hljs-number">2447</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99901</span></span>, <span class="hljs-number"><span class="hljs-number">99907</span></span>], [<span class="hljs-number"><span class="hljs-number">99923</span></span>, <span class="hljs-number"><span class="hljs-number">99929</span></span>]</code> </pre></div></div><br>  <b>10M</b> starting from <code>max</code> (the rest are just slow on such an array). <br><div class="spoiler">  <b class="spoiler_title">pypy3 sexy-primes-test.py 10M max</b> <div class="spoiler_text"><pre> <code class="python hljs"> max = <span class="hljs-number"><span class="hljs-number">5.28500</span></span> s = <span class="hljs-number"><span class="hljs-number">5285.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">117207</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">9999931</span></span>, <span class="hljs-number"><span class="hljs-number">9999937</span></span>], [<span class="hljs-number"><span class="hljs-number">9999937</span></span>, <span class="hljs-number"><span class="hljs-number">9999943</span></span>] orgm = <span class="hljs-number"><span class="hljs-number">12.65600</span></span> s = <span class="hljs-number"><span class="hljs-number">12656.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">117207</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">9999931</span></span>, <span class="hljs-number"><span class="hljs-number">9999937</span></span>], [<span class="hljs-number"><span class="hljs-number">9999937</span></span>, <span class="hljs-number"><span class="hljs-number">9999943</span></span>] siev1 = <span class="hljs-number"><span class="hljs-number">0.51800</span></span> s = <span class="hljs-number"><span class="hljs-number">518.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">117207</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">9999931</span></span>, <span class="hljs-number"><span class="hljs-number">9999937</span></span>], [<span class="hljs-number"><span class="hljs-number">9999937</span></span>, <span class="hljs-number"><span class="hljs-number">9999943</span></span>] siev2 = <span class="hljs-number"><span class="hljs-number">0.23200</span></span> s = <span class="hljs-number"><span class="hljs-number">232.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">117207</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">9999931</span></span>, <span class="hljs-number"><span class="hljs-number">9999937</span></span>], [<span class="hljs-number"><span class="hljs-number">9999937</span></span>, <span class="hljs-number"><span class="hljs-number">9999943</span></span>] osie1 = <span class="hljs-number"><span class="hljs-number">0.26800</span></span> s = <span class="hljs-number"><span class="hljs-number">268.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">117207</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">9999931</span></span>, <span class="hljs-number"><span class="hljs-number">9999937</span></span>], [<span class="hljs-number"><span class="hljs-number">9999937</span></span>, <span class="hljs-number"><span class="hljs-number">9999943</span></span>] osie2 = <span class="hljs-number"><span class="hljs-number">0.22700</span></span> s = <span class="hljs-number"><span class="hljs-number">227.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">117207</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">9999931</span></span>, <span class="hljs-number"><span class="hljs-number">9999937</span></span>], [<span class="hljs-number"><span class="hljs-number">9999937</span></span>, <span class="hljs-number"><span class="hljs-number">9999943</span></span>]</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">python34 sexy-primes-test.py 10M max</b> <div class="spoiler_text"><pre> <code class="python hljs"> max = <span class="hljs-number"><span class="hljs-number">288.81855</span></span> s = <span class="hljs-number"><span class="hljs-number">288818.55</span></span> mils | <span class="hljs-number"><span class="hljs-number">117207</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">9999931</span></span>, <span class="hljs-number"><span class="hljs-number">9999937</span></span>], [<span class="hljs-number"><span class="hljs-number">9999937</span></span>, <span class="hljs-number"><span class="hljs-number">9999943</span></span>] orgm = <span class="hljs-number"><span class="hljs-number">691.96458</span></span> s = <span class="hljs-number"><span class="hljs-number">691964.58</span></span> mils | <span class="hljs-number"><span class="hljs-number">117207</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">9999931</span></span>, <span class="hljs-number"><span class="hljs-number">9999937</span></span>], [<span class="hljs-number"><span class="hljs-number">9999937</span></span>, <span class="hljs-number"><span class="hljs-number">9999943</span></span>] siev1 = <span class="hljs-number"><span class="hljs-number">4.02766</span></span> s = <span class="hljs-number"><span class="hljs-number">4027.66</span></span> mils | <span class="hljs-number"><span class="hljs-number">117207</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">9999931</span></span>, <span class="hljs-number"><span class="hljs-number">9999937</span></span>], [<span class="hljs-number"><span class="hljs-number">9999937</span></span>, <span class="hljs-number"><span class="hljs-number">9999943</span></span>] siev2 = <span class="hljs-number"><span class="hljs-number">4.05016</span></span> s = <span class="hljs-number"><span class="hljs-number">4050.16</span></span> mils | <span class="hljs-number"><span class="hljs-number">117207</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">9999931</span></span>, <span class="hljs-number"><span class="hljs-number">9999937</span></span>], [<span class="hljs-number"><span class="hljs-number">9999937</span></span>, <span class="hljs-number"><span class="hljs-number">9999943</span></span>] osie1 = <span class="hljs-number"><span class="hljs-number">4.69519</span></span> s = <span class="hljs-number"><span class="hljs-number">4695.19</span></span> mils | <span class="hljs-number"><span class="hljs-number">117207</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">9999931</span></span>, <span class="hljs-number"><span class="hljs-number">9999937</span></span>], [<span class="hljs-number"><span class="hljs-number">9999937</span></span>, <span class="hljs-number"><span class="hljs-number">9999943</span></span>] osie2 = <span class="hljs-number"><span class="hljs-number">4.43018</span></span> s = <span class="hljs-number"><span class="hljs-number">4430.18</span></span> mils | <span class="hljs-number"><span class="hljs-number">117207</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">9999931</span></span>, <span class="hljs-number"><span class="hljs-number">9999937</span></span>], [<span class="hljs-number"><span class="hljs-number">9999937</span></span>, <span class="hljs-number"><span class="hljs-number">9999943</span></span>]</code> </pre></div></div><br>  <b>100M</b> starting with version <code>siev1</code> (for the same reason). <br><div class="spoiler">  <b class="spoiler_title">pypy3 sexy-primes-test.py 100M siev1</b> <div class="spoiler_text"><pre> <code class="python hljs">siev1 = <span class="hljs-number"><span class="hljs-number">7.39800</span></span> s = <span class="hljs-number"><span class="hljs-number">7398.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">879908</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99999617</span></span>, <span class="hljs-number"><span class="hljs-number">99999623</span></span>], [<span class="hljs-number"><span class="hljs-number">99999821</span></span>, <span class="hljs-number"><span class="hljs-number">99999827</span></span>] siev2 = <span class="hljs-number"><span class="hljs-number">2.24500</span></span> s = <span class="hljs-number"><span class="hljs-number">2245.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">879908</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99999617</span></span>, <span class="hljs-number"><span class="hljs-number">99999623</span></span>], [<span class="hljs-number"><span class="hljs-number">99999821</span></span>, <span class="hljs-number"><span class="hljs-number">99999827</span></span>] osie1 = <span class="hljs-number"><span class="hljs-number">2.53500</span></span> s = <span class="hljs-number"><span class="hljs-number">2535.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">879908</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99999617</span></span>, <span class="hljs-number"><span class="hljs-number">99999623</span></span>], [<span class="hljs-number"><span class="hljs-number">99999821</span></span>, <span class="hljs-number"><span class="hljs-number">99999827</span></span>] osie2 = <span class="hljs-number"><span class="hljs-number">2.31000</span></span> s = <span class="hljs-number"><span class="hljs-number">2310.00</span></span> mils | <span class="hljs-number"><span class="hljs-number">879908</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99999617</span></span>, <span class="hljs-number"><span class="hljs-number">99999623</span></span>], [<span class="hljs-number"><span class="hljs-number">99999821</span></span>, <span class="hljs-number"><span class="hljs-number">99999827</span></span>]</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">python34 sexy-primes-test.py 100M siev1</b> <div class="spoiler_text"><pre> <code class="python hljs">siev1 = <span class="hljs-number"><span class="hljs-number">41.87118</span></span> s = <span class="hljs-number"><span class="hljs-number">41871.18</span></span> mils | <span class="hljs-number"><span class="hljs-number">879908</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99999617</span></span>, <span class="hljs-number"><span class="hljs-number">99999623</span></span>], [<span class="hljs-number"><span class="hljs-number">99999821</span></span>, <span class="hljs-number"><span class="hljs-number">99999827</span></span>] siev2 = <span class="hljs-number"><span class="hljs-number">40.71163</span></span> s = <span class="hljs-number"><span class="hljs-number">40711.63</span></span> mils | <span class="hljs-number"><span class="hljs-number">879908</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99999617</span></span>, <span class="hljs-number"><span class="hljs-number">99999623</span></span>], [<span class="hljs-number"><span class="hljs-number">99999821</span></span>, <span class="hljs-number"><span class="hljs-number">99999827</span></span>] osie1 = <span class="hljs-number"><span class="hljs-number">48.08692</span></span> s = <span class="hljs-number"><span class="hljs-number">48086.92</span></span> mils | <span class="hljs-number"><span class="hljs-number">879908</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99999617</span></span>, <span class="hljs-number"><span class="hljs-number">99999623</span></span>], [<span class="hljs-number"><span class="hljs-number">99999821</span></span>, <span class="hljs-number"><span class="hljs-number">99999827</span></span>] osie2 = <span class="hljs-number"><span class="hljs-number">44.05426</span></span> s = <span class="hljs-number"><span class="hljs-number">44054.26</span></span> mils | <span class="hljs-number"><span class="hljs-number">879908</span></span> sp: [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>], [<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>], ... [<span class="hljs-number"><span class="hljs-number">99999617</span></span>, <span class="hljs-number"><span class="hljs-number">99999623</span></span>], [<span class="hljs-number"><span class="hljs-number">99999821</span></span>, <span class="hljs-number"><span class="hljs-number">99999827</span></span>]</code> </pre></div></div><br>  By the way, such a spread between CPython and PyPy is often one of the reasons why people switch to PyPy, write their own alokators, memory managers, GC, stackless and others like them, use third-party modules (for example, NumPy) and build their own assemblies.  For example, when execution speed is important and like here, we have an ‚Äúaggressive‚Äù use of a pool of objects / multiple calls, etc.  It was the same long ago and in our case, when we moved from pure python.  There was still a lot of things, and braking multithreding, and refcounting, etc.  But the move itself was a deliberate decision of the whole team, and not a fad "lowered" from above.  If there is interest and find time, you can try to squeeze about this article. <br><br>  For this particular ‚Äútask‚Äù one could write our own C-binding, use numpy type modules, etc.  I tried to convince a colleague that it is solved on the knee for a short time almost ‚Äúalgorithmically,‚Äù if you know how the python is ticking inside. <br><br>  So, let's start proving to a person that a python can ‚Äúrun‚Äù quickly, if the set task is solved, not an artificial test. <br><br>  The original script, slightly modified by me for readability and third python support, this option is called <code>org</code> in my example script.  <sub>(Only, plz, it is not necessary here about the "xrange vs range" - I perfectly imagine what the difference is, and here it is not particularly important, especially in the 3rd python, moreover, the iteration is as though ‚Äúcompleted‚Äù ).</sub> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_prime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> all((n % i &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">2</span></span>, n)) <span class="hljs-comment"><span class="hljs-comment"># def sexy_primes_below(n): # return [[j-6, j] for j in range(9, n+1) if is_prime(j) and is_prime(j-6)] def sexy_primes_below(n): l = [] for j in range(9, n+1): if is_prime(j-6) and is_prime(j): l.append([j-6, j]) return l</span></span></code> </pre><br>  Since  even at 10M we have only 100K sexy pairs, the change of the original <code>primes_below</code> to my version with a direct cycle does not greatly affect the execution time, it is just clearer for changes in subsequent versions (for example, a sieve).  All tsimes in the implementation of <code>is_prime</code> , at least for now. <br><br>  1. Firstly, the use of such a ‚Äúsugar‚Äù as in the original (especially in ‚Äúassemblies‚Äù such as PyPy, or our PyMNg) is not encouraged, or at least, as in this case, it hurts as a result in the form of a reduction in speed .  Rewrite it as <b><code>mod1</code></b> option <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_prime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> n % i: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> i += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i &gt;= n: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre><br>  Already faster, at least in PyPy.  But it's not that‚Ä¶ <br><br>  2. The code became immediately clearer and it is clear that it can be rewritten as <b><code>mod2</code></b> in half faster if you do not check the even numbers (which, except for the two, were not initially prime). <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_prime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> n % <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> i = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> n % i == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> i += <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i &gt;= n: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre><br>  Let's fix it in the original - <b><code>org2</code></b> is the same as <b><code>mod2</code></b> , but using ‚Äúsugar‚Äù in one line. <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_prime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n % <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> all(n % i <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">3</span></span>, n, <span class="hljs-number"><span class="hljs-number">2</span></span>))</code> </pre><br>  3. If we check the dividers to the square root value (it would be correct to rounded, but we will make it easier - it's just a test), then everything can be done much faster, we get the <b><code>max</code></b> option: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_prime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> n &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> i = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> n % i: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i * i &gt; n: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> i += <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre>  Much faster, really. <br><br>  Again we rule it in the original - <b><code>orgm</code></b> . <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_prime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#return ((n &amp; 1) and all(n % i for i in range(3, int(math.sqrt(n))+1, 2))) return ((n &amp; 1) and all(n % i for i in range(3, int(n**0.5)+1, 2)))</span></span></code> </pre><br>  And we see that, at least in PyPy, it again runs slower (although partially, possibly, because of the direct calculation of the ‚Äúroot‚Äù, which is in range). <br><br>  4. Here, a colleague's eyes light up, and he is like in that cartoon (in my opinion, ‚ÄúThe Greedy Rich Man‚Äù) about furrier and 7 caps: ‚ÄúCan you be even faster?‚Äù.  Since  from memory there is no limit (not emdedded, etc.) I decided to quickly redo it using a ‚Äúhalf‚Äù sieve - half sieve, that there is a prepared array of flags for offset for odd numbers, i.e.  divided by 2. Moreover, on the python to organize such a sieve for one or two. <br>  Well, at once we modify <code>sexy_primes_below</code> , causing generation of a sieve in it, and in order not to edit <code>is_prime</code> and not to call it in a loop, we ask immediately <code>sieve</code> . <br>  We <b><code>siev1</code></b> option <b><code>siev1</code></b> . <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">primes_sieve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" temporary "half" mask sieve for primes &lt; n (using bool) """</span></span> sieve = [<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>] * (n//<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">3</span></span>, int(n**<span class="hljs-number"><span class="hljs-number">0.5</span></span>)+<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sieve[i//<span class="hljs-number"><span class="hljs-number">2</span></span>]: sieve[i*i//<span class="hljs-number"><span class="hljs-number">2</span></span>::i] = [<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>] * ((ni*i<span class="hljs-number"><span class="hljs-number">-1</span></span>)//(<span class="hljs-number"><span class="hljs-number">2</span></span>*i)+<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sieve <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sexy_primes_below</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> l = [] sieve = primes_sieve(n+<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">#is_prime = lambda j: (j &amp; 1) and sieve[int(j/2)] for j in range(9, n+1): i = j-6 #if (i &amp; 1) and is_prime(i) and is_prime(j): if (i &amp; 1) and sieve[int(i/2)] and sieve[int(j/2)]: l.append([i, j]) return l</span></span></code> </pre>  This option is so fast that in PyPy, for example, it gives out at 100M almost the same time as the original at 100K.  Those.  testing 2,000 times more numbers and generating a larger list of sexually simple couples several orders of magnitude. <br><br>  Immediately rewrote the version of <b><code>siev2</code></b> , because I remembered about the somewhat "stupid" processing bool in PyPy.  Those.  replacing the boolean flags with 0/1.  This example works out at 100M already twice or three times faster than the original at 100K! <br><br>  5. The variants <b><code>osiev1</code></b> and <b><code>osiev2</code></b> wrote so that in the future it was possible to replace the sieve for all numbers with a lot of shorter ones, i.e.  to be able to search for pairs incrementally or blockwise. <br><br>  For this, I changed the sieve offsets to a direct sieve storing not the flags, but the values ‚Äã‚Äãthemselves: <br><pre> <code class="python hljs">sieve = [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> ...]; <span class="hljs-comment"><span class="hljs-comment">#  3, 5, 7, 9, 11, 13 ... osieve = [3, 5, 7, 0, 11, 13, ...]; #  3, 5, 7, 9, 11, 13 ...</span></span></code> </pre><br>  Option <b><code>osiev1</code></b> . <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">primes_sieve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" temporary odd direct sieve for primes &lt; n """</span></span> sieve = list(range(<span class="hljs-number"><span class="hljs-number">3</span></span>, n, <span class="hljs-number"><span class="hljs-number">2</span></span>)) l = len(sieve) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sieve: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i: f = (i*i<span class="hljs-number"><span class="hljs-number">-3</span></span>) // <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> f &gt;= l: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> sieve[f::i] = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * -((fl) // i) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sieve <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sexy_primes_below</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> l = [] sieve = primes_sieve(n+<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">#is_prime = lambda j: (j &amp; 1) and sieve[int((j-2)/2)] for j in range(9, n+1): i = j-6 #if (i &amp; 1) and is_prime(i) and is_prime(j): if (i &amp; 1) and sieve[int((i-2)/2)] and sieve[int((j-2)/2)]: l.append([i, j]) return l</span></span></code> </pre><br>  Well, the second option <b><code>osiev2</code></b> just a little bit faster, because  initiates a sieve much more optimally. <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">primes_sieve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" temporary odd direct sieve for primes &lt; n """</span></span> <span class="hljs-comment"><span class="hljs-comment">#sieve = list(range(3, n, 2)) l = ((n-3)//2) sieve = [-1] * l for k in range(3, n, 2): o = (k-3)//2 i = sieve[o] if i == -1: i = sieve[(k-3)//2] = k if i: f = (i*i-3) // 2 if f &gt;= l: break sieve[f::i] = [0] * -((fl) // i) return sieve</span></span></code> </pre><br>  These two methods could be converted to an iterative sieve (for example, search for pairs of 10K or 100K blocks).  This would significantly save memory when counting.  For example, if you now try both osieve versions with 1G or 10G, we are almost guaranteed to immediately get a MemoryError exception (well, or you are rich in Buratino - and you have a lot of memory and 64-bit python. <br><br>  I did not finish the block method (it is not in the example script, let it be a ‚Äúhomework‚Äù, if someone suddenly wants.), Because  My colleague has already repented, bowing in admiration, and I hope at least there will be no more hammering my head (and the team) with such nonsense. <br><br>  And on the original 100K the execution time of the latter could no longer be calculated - 0.00 mils (I calculated it only by increasing the number of iterations of the execution times to 10). <br><br>  What I'm pretty sure about is that it is unlikely to be able to increase the speed by another order not only on scala, but also on pure C. If only algorithmically again ... <br><br>  The <a href="https://github.com/sebres/misc/blob/master/python/sexy-primes-test.py">script</a> itself, if anyone is going to experiment, you can ask for help, for example, like this: <pre> <code class="bash hljs">sexy-primes-test.py --<span class="hljs-built_in"><span class="hljs-built_in">help</span></span></code> </pre><br>  If anything, about primes is pretty well written <a href="http://ru.wikihow.com/%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B5%25D1%2580%25D0%25B8%25D1%2582%25D1%258C,-%25D1%258F%25D0%25B2%25D0%25BB%25D1%258F%25D0%25B5%25D1%2582%25D1%2581%25D1%258F-%25D0%25BB%25D0%25B8-%25D1%2587%25D0%25B8%25D1%2581%25D0%25BB%25D0%25BE-%25D0%25BF%25D1%2580%25D0%25BE%25D1%2581%25D1%2582%25D1%258B%25D0%25BC">in wikihow in</a> great detail. <br><br>  At the request of workers added a poll ... </div><p>Source: <a href="https://habr.com/ru/post/259095/">https://habr.com/ru/post/259095/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259083/index.html">Online development event for Windows 10, June 10, from industry veterans</a></li>
<li><a href="../259085/index.html">John Forbes Nash died</a></li>
<li><a href="../259087/index.html">Basic troubleshooting in VMware vSphere or what to do if VM slows down</a></li>
<li><a href="../259089/index.html">How large companies organize the Common Customer Service Center (SSC)</a></li>
<li><a href="../259093/index.html">How we modernized the portal yota.ru</a></li>
<li><a href="../259099/index.html">Visualization of sound on a 6E1P lamp</a></li>
<li><a href="../259101/index.html">Yandex research - true or fiction?</a></li>
<li><a href="../259103/index.html">Launch BIGIP Trial Edition for Oracle VirtualBox</a></li>
<li><a href="../259105/index.html">Cones on matryoshka</a></li>
<li><a href="../259107/index.html">Centos-admin.ru: learn Ansible</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>