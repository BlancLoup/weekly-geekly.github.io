<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>256-byte assembler driven gradient helix (k29)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is devoted to the creation of a graphics application weighing several hundred bytes on an assembler. After creating a full working versio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>256-byte assembler driven gradient helix (k29)</h1><div class="post__text post__text-html js-mediator-article">  This article is devoted to the creation of a graphics application weighing several hundred bytes on an assembler.  After creating a full working version of 420 bytes, I had to sweat to stuff all this stuff into 256 bytes.  You can see the result on the video.  The article describes the process of creation and general principles of operation. <br><br>  Warning: If you are suffering from epilepsy, DO NOT LOOK. <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/YXoDaHSbBPk%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhgWxMumHeH2fxuH-s0rhDI-X9Ldkg" frameborder="0" allowfullscreen=""></iframe><br><br>  In Win7 and Vista will not work.  Need Windows XP / 2000/98. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Download executable file: <a href="">k29.com in DropBox</a> (256 bytes) <br>  Download source code: <a href="">k29.asm in DropBox</a> (Compile with FASM) <br><br>  Control keys: <br>  1. R, G, B - enable and disable color components <br>  2. &lt;-, SPACE, -&gt; - change the direction and speed of rotation <br>  3. UP, DOWN - change the scale of the spiral <br>  4. 0,1,2,3,4,5,6,7,8,9 - change the number of branches at the spiral <br>  5. ESC - exit <a name="habracut"></a><br><br><h2>  Epilogue </h2><br>  For quite a while this article has been lying around in my drafts.  More in the drafts on Blogger-e.  And today I decided that if I didn‚Äôt add it now, it would never happen.  I finished, at the end I cut off a bit and finished) Hooray !!! <br><br><h2>  1. The plot </h2><br>  I have always been interested in working with demoparty, especially categories in hundreds of bytes.  It's one thing to write a 64 kilo prog program using DirectX / OpenGL, and quite another in 512/256/128 bytes, using video memory directly, etc.  It requires the knowledge and understanding of the assembler is already on an intuitive level.  It is necessary to be able to optimize the code in terms of volume, and therefore to understand and take into account all the subtleties of the machine programming language.  We will try to do something similar.  I have never written in assembler before, but it worked out to understand the existing code.  We assume that this <b>article is aimed at newcomers to an assembler</b> like me.  Because I do not pretend to be the perfect solution to the problem. <br><br><h2>  2. Choosing a goal </h2><br>  Now you need to come up with a task and implement it.  Immediately, a small program written in school years in the Pascal language came to mind.  The program was simple to disgrace (2 screens of code - 50 lines), but at the same time it delivered.  The program drew in a graphic mode (320x200x256) a rotating spiral in full screen.  All 256 colors were used for a smooth color change.  It was surprising that the spiral moves without visible redrawing.  This could be explained by the use of several video pages, if not for the speed of rotation.  Obviously, to draw a spiral, calculations with real numbers are necessary, which also introduces a significant delay.  The spiral rotated at a speed of 3-5 revolutions per second (see. Fig. 2.1). <br><br><div style="text-align:center;"><img src="http://habrastorage.org/storage/3ed46133/9fc51ac1/3f98d3f4/8ded82ca.png"></div><br>  <i>[Fig.</i>  <i>2.1.</i>  <i>A snapshot of a three-handed helix]</i> <br><br>  And the whole point was that the spiral was drawn only once - when the program was started.  After drawing the spiral, the program cyclically shifted the colors in the palette, which was immediately displayed on the screen.  In addition to the main function, the program supported a change in the color of the spiral and a change in the direction of rotation.  Only eight colors: <br><table border="1"><tbody><tr><td>  0 </td><td>  # 000000 </td><td>  Black (helix not visible) </td></tr><tr><td>  one </td><td>  # 0000FF </td><td>  Blue </td></tr><tr><td>  2 </td><td>  # 00FF00 </td><td>  Bright green </td></tr><tr><td>  3 </td><td>  # 00FFFF </td><td>  Turquoise </td></tr><tr><td>  four </td><td>  # FF0000 </td><td>  Red </td></tr><tr><td>  five </td><td>  # FF00FF </td><td>  Purple </td></tr><tr><td>  6 </td><td>  # FFFF00 </td><td>  Yellow </td></tr><tr><td>  7 </td><td>  #FFFFFF </td><td>  White </td></tr></tbody></table><br>  Since the RGB color model is used for display on the screen, these eight colors can be obtained by combining the corresponding color components (3 data bits can encode 8 different values).  The program used the 'R', 'G' and 'B' keys to enable / disable the corresponding color components. <br><br>  The program was written in Pascal in the Turbo Pascal 7.0 development environment.  Some functions of the program were implemented in the form of assembler inserts.  For example, the function of setting the RGB value to a specific element from the palette.  The code of school times (formatting is changed so as not to traumatize the psyche draw): <br><br><pre><code class="hljs delphi"><span class="hljs-keyword"><span class="hljs-keyword">program</span></span> P_16_B_4; <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> crt,graph,MUSE_OTH,MT_MAIN; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> koef1=<span class="hljs-number"><span class="hljs-number">3</span></span>;<span class="hljs-comment"><span class="hljs-comment">{   }</span></span> koef2=<span class="hljs-number"><span class="hljs-number">3</span></span>;<span class="hljs-comment"><span class="hljs-comment">{   }</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gd,gm,gmx,gmy,i,flag,x0,y0,x,y:integer; r,alpha:extended; k,int:longint; key:char;rr,gg,bb:byte; ints:<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; mas:<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>..<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>..<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> byte; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> gd:=installuserdriver(<span class="hljs-string"><span class="hljs-string">'SVGA256m.BGI'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">NIL</span></span>);gm:=<span class="hljs-number"><span class="hljs-number">2</span></span>; initgraph(gd,gm,<span class="hljs-string"><span class="hljs-string">''</span></span>); gmx:=getmaxx; gmy:=getmaxy; flag:=<span class="hljs-number"><span class="hljs-number">1</span></span>;k:=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i:=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> setRGBpalette(i,k,k,k); mas[i,<span class="hljs-number"><span class="hljs-number">1</span></span>]:=k;mas[i,<span class="hljs-number"><span class="hljs-number">2</span></span>]:=k;mas[i,<span class="hljs-number"><span class="hljs-number">3</span></span>]:=k; k:=k+flag; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> k=<span class="hljs-number"><span class="hljs-number">63</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> flag:=-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> k=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> flag:=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; setcolor(<span class="hljs-number"><span class="hljs-number">63</span></span>); settextstyle(<span class="hljs-number"><span class="hljs-number">1</span></span>,horizdir,<span class="hljs-number"><span class="hljs-number">2</span></span>); settextjustify(centertext,centertext); outtextxy(gmx <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>,gmy <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>-textheight(<span class="hljs-string"><span class="hljs-string">'!&lt;06@'</span></span>)*<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'!&lt;06@ freeware'</span></span>); outtextxy(gmx <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>,gmy <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>+textheight(<span class="hljs-string"><span class="hljs-string">'!&lt;06@'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'! ! ! Press "R", "G", "B", " " or "Esc" ! ! !'</span></span>); x0:=gmx <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; y0:=gmy <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; r:=<span class="hljs-number"><span class="hljs-number">400</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">repeat</span></span> alpha:=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">repeat</span></span> x:=round(x0+r*cos(alpha/<span class="hljs-number"><span class="hljs-number">180</span></span>*Pi)); y:=round(y0-r*sin(alpha/<span class="hljs-number"><span class="hljs-number">180</span></span>*Pi)); putpixel(x,y,round(r*koef2+alpha*<span class="hljs-number"><span class="hljs-number">256</span></span>/<span class="hljs-number"><span class="hljs-number">360</span></span>*koef1/<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">128</span></span>); alpha:=alpha+<span class="hljs-number"><span class="hljs-number">20</span></span>/(r+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">until</span></span> alpha&gt;=<span class="hljs-number"><span class="hljs-number">360</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> keypressed <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> halt; r:=r-<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">until</span></span> r&lt;=<span class="hljs-number"><span class="hljs-number">0</span></span>; k:=<span class="hljs-number"><span class="hljs-number">1</span></span>;flag:=-<span class="hljs-number"><span class="hljs-number">1</span></span>;rr:=<span class="hljs-number"><span class="hljs-number">1</span></span>;gg:=<span class="hljs-number"><span class="hljs-number">1</span></span>;bb:=<span class="hljs-number"><span class="hljs-number">1</span></span>;int:=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">repeat</span></span> str(int <span class="hljs-keyword"><span class="hljs-keyword">SHR</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>,ints); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> byte(ints[<span class="hljs-number"><span class="hljs-number">0</span></span>])&lt;<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> insert(<span class="hljs-string"><span class="hljs-string">'0'</span></span>,ints,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> int <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> SAVE_MONITOR((gmx+<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>-<span class="hljs-number"><span class="hljs-number">75</span></span>,(gmy+<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>-<span class="hljs-number"><span class="hljs-number">75</span></span>,(gmx+<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">74</span></span>, (gmy+<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">74</span></span>,<span class="hljs-string"><span class="hljs-string">'c:\AVATAR\'</span></span>+ints+<span class="hljs-string"><span class="hljs-string">'.bmp'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> keypressed <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> key:=readkey; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> key=<span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> flag:=-flag <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> upcase(key)=<span class="hljs-string"><span class="hljs-string">'R'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> rr:=<span class="hljs-keyword"><span class="hljs-keyword">not</span></span>(rr) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> upcase(key)=<span class="hljs-string"><span class="hljs-string">'G'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> gg:=<span class="hljs-keyword"><span class="hljs-keyword">not</span></span>(gg) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> upcase(key)=<span class="hljs-string"><span class="hljs-string">'B'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> bb:=<span class="hljs-keyword"><span class="hljs-keyword">not</span></span>(bb) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> key=<span class="hljs-string"><span class="hljs-string">#27</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i:=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">127</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> setRGBpalette(i,mas[(i+k+<span class="hljs-number"><span class="hljs-number">512</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>]*rr, mas[(i+k+<span class="hljs-number"><span class="hljs-number">512</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>]*gg, mas[(i+k+<span class="hljs-number"><span class="hljs-number">512</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>]*bb); inc(k,flag);k:=k <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span>; inc(int); <span class="hljs-keyword"><span class="hljs-keyword">until</span></span> false; closegraph; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>.</code> </pre> <br><br><h2>  3. Algorithm Development </h2><br>  First, let's look at how the program works and what functions we need to write.  The formal description of the algorithm: <br><br>  1) Initial filling of the palette with the following values: (0,0,0) ... (63,63,63) ... (0,0,0).  In other words, throughout the 256 elements of the palette, the color smoothly changes from black to white and returns to black again.  In this graphic mode, up to 256 colors are supported, each of the colors consists of three color components.  Each of the color components is given in six bits (a number from 0 to 63).  White color corresponds to the vector of color components (63,63,63), and black, respectively - (0,0,0). <br><br>  2) Drawing a spiral involves traversing all the pixels on the screen and filling them with data.  The formula of the spiral is quite simple - it depends only on the vector (a pair of values: distance and angle) indicating a specific pixel from the center of the screen.  In other words, color depends only on the length of the vector and the angle of the vector with selected coefficients.  Looking through various coefficients, one can get both a different number of ‚Äúbranches‚Äù of a spiral and a different degree of its twisting. <br><br>  3) Cyclic shift of the palette by one position.  This gives the illusion of rotation of the spiral.  That is, by changing 256 color elements, we get a shift of the helix by 1 / (256 * k) full rotation.  Where k is the number of "branches" of the spiral.  Thus, we avoided redrawing all pixels of the screen to rotate the spiral.  In fact, we will not shift to a ‚Äúone‚Äù position, the magnitude and direction of the shift are stored in a special integer variable.  This will allow us to dynamically change the direction and speed of rotation of the spiral. <br><br>  4) Check keystrokes.  Pressing the R, G and B keys leads to the activation or deactivation of the color component assigned to each of the keys.  Pressing the "right" / "left" keys increases / decreases the value of a variable that is explicitly used when the palette is shifted.  Go to point 3. <br><br><h2>  4. Implementation of the algorithm </h2><br>  Well, now we define what functions we need to write in assembly language.  Obviously, these will be: the initial filling function of the palette, the spiral drawing function, the cyclic shift function of the palette and the main function of the program, which, in addition to calling the above functions, will ensure that the control keys are pressed on the keyboard.  The flowchart of the algorithm: <br><br><img src="https://habrastorage.org/storage/47dff71e/52c82dcf/64148556/4ae4abb8.png"><br>  <i>[Fig.</i>  <i>4.1.</i>  <i>Algorithm block diagram]</i> <br><br>  After reading about the available assembler language compilers in Wikipedia and the book ‚ÄúThe Art of Disassembling‚Äù by Chris Kaspersky and Eva Rocco, I made my choice in favor of the FASM compiler.  I will write the code in Notepad ++, and from it I will export to an article with syntax highlighting. <br><br>  Well, let's get started. <br><br><h4>  4.1.  Initial fill function </h4><br>  We are going to fill the palette with the following values: (0,0,0), ... (63,63,63), ... (0,0,0).  It is easy to calculate that there are a total of 127, to uniformly fill all 256 elements, we will fill in 2 identical elements: (0,0,0), (0,0,0), ... (63,63,63), (63 , 63.63), ... (0,0,0), (0,0,0).  We write the algorithm in a formal high level language: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt;= <span class="hljs-number"><span class="hljs-number">127</span></span>; i++) { setPalette(i, i/<span class="hljs-number"><span class="hljs-number">2</span></span>, i/<span class="hljs-number"><span class="hljs-number">2</span></span>, i/<span class="hljs-number"><span class="hljs-number">2</span></span>); setPalette(<span class="hljs-number"><span class="hljs-number">255</span></span>-i, i/<span class="hljs-number"><span class="hljs-number">2</span></span>, i/<span class="hljs-number"><span class="hljs-number">2</span></span>, i/<span class="hljs-number"><span class="hljs-number">2</span></span>); }</code> </pre><br>  Now the assembler code with comments: <br><table><tbody><tr><td>  A </td><td>  B </td><td>  C </td><td>  D </td></tr><tr><td><img src="http://habrastorage.org/storage/7d7ca004/c5f9565d/ad92540a/f31d4a31.png"></td><td><img src="http://habrastorage.org/storage/5ef6210d/04ac46ee/6bf92bf7/72c24ac7.png"></td><td><img src="http://habrastorage.org/storage/ad8a2f1c/caae17fd/a72b6564/463681d0.png"></td><td><img src="http://habrastorage.org/storage/112504e8/556dd9ff/f3eac51a/969328bf.png"></td></tr></tbody></table>  <b>A. We</b> save in the stack and restore from the stack the registers that are used in the function. <br>  <b>B.</b> The CX register runs in a loop from 0 to 127, inclusive. <br>  <b>C.</b> Form the parameters and call the setPalette function.  In AL, we load a color index, in AH, we load a brightness value equal to half the index. <br>  <b>D.</b> Change the index to (255-i) using the operation of inverting all bits and calling the function setPalette. <br><br><h4>  4.2.  Helix draw function </h4><br><br>  Consider the description function of the gradient spiral. <br>  The function depending only on the radius gives gradient circles: <br><br><pre> <code class="cpp hljs">pixel[x][y] = k1*<span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(x*x + y*y);</code> </pre> <br><div style="text-align:center;"><img src="http://habrastorage.org/storage/ab3a6d8f/dfe188cf/5712a878/c2dd977c.png"></div><br>  <i>[Fig.</i>  <i>4.1.</i>  <i>Gradient Circles]</i> <br><br>  The function depending only on the angle gives the gradient rays from the center: <br><br><pre> <code class="cpp hljs">pixel[x][y] = k1*arctan(x/y);</code> </pre> <br><div style="text-align:center;"><img src="http://habrastorage.org/storage/3cb5d355/3a53a2b4/b7fcd244/571c86f3.png"></div><br>  <i>[Fig.</i>  <i>4.2.</i>  <i>Gradient Rays]</i> <br><br>  The function, which is linearly dependent on the radius and angle, will give us the desired gradient spiral: <br><pre> <code class="cpp hljs">pixel[x][y] = k1*<span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(x*x + y*y) + k2*k3*arctan(x/y));</code> </pre> <br><div style="text-align:center;"><img src="http://habrastorage.org/storage/c39a504a/9801cd7b/91aad93a/a0749734.png"></div><br>  <i>[Fig.</i>  <i>4.3.</i>  <i>Gradient Spiral]</i> <br><br>  It is only necessary to choose the necessary coefficients for a 360-degree regular drawing of the spiral.  The coefficient k1 affects only the degree of spiral twisting.  For the correct filling of 360 degrees, choose the coefficient k3 as follows: <br><br><pre> <code class="cpp hljs">k3 = <span class="hljs-number"><span class="hljs-number">128</span></span> / <span class="hljs-number"><span class="hljs-number">3.1415927</span></span>;</code> </pre> <br><div style="text-align:center;"><img src="http://habrastorage.org/storage/3ed46133/9fc51ac1/3f98d3f4/8ded82ca.png"></div><br>  <i>[Fig.</i>  <i>4.4.</i>  <i>Correct 360 Gradient Spiral]</i> <br><br>  The k2 coefficient will take integer values: 1, 2, 3, 4 ... Changing this coefficient, we get the corresponding number of branches at the helix.  Examples of gradient spirals with k2 equal to one, two and five are presented in Fig.  4.5, 4.6 and 4.7: <br><br><div style="text-align:center;"><img src="http://habrastorage.org/storage/558cb445/ca1c9cf4/0cd30277/364e2825.png"></div><br>  <i>[Fig.</i>  <i>4.5.</i>  <i>Spiral with one branch]</i> <br><br><div style="text-align:center;"><img src="http://habrastorage.org/storage/fd4c2e64/410bbd51/cb41c6d2/e54ba5ae.png"></div><br>  <i>[Fig.</i>  <i>4.6.</i>  <i>Spiral with two branches]</i> <br><br><div style="text-align:center;"><img src="http://habrastorage.org/storage/05963e11/daf66115/a150bb37/3e7987a4.png"></div><br>  <i>[Fig.</i>  <i>4.7.</i>  <i>Spiral with five branches]</i> <br><br>  Spiral drawing code in pseudo-language: <br>  (Without taking into account possible errors, including division by zero) <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; <span class="hljs-number"><span class="hljs-number">200</span></span>; y++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; <span class="hljs-number"><span class="hljs-number">320</span></span>; x++) { y -= <span class="hljs-number"><span class="hljs-number">100</span></span>; x -= <span class="hljs-number"><span class="hljs-number">160</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> color = k1*<span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(x*x + y*y) + k2*<span class="hljs-number"><span class="hljs-number">128</span></span>/<span class="hljs-number"><span class="hljs-number">3.1415927</span></span>*arctan(x/y); y += <span class="hljs-number"><span class="hljs-number">100</span></span>; x += <span class="hljs-number"><span class="hljs-number">160</span></span>; pixel[x][y] = color; }</code> </pre><br><br>  Now we implement the algorithm in assembler. <br><br><table><tbody><tr><td>  A </td><td>  B </td><td>  C </td><td>  D </td><td>  E </td></tr><tr><td><img src="http://habrastorage.org/storage/c84b913e/ca61f832/286ccbdf/32b6472b.png"></td><td><img src="http://habrastorage.org/storage/988f9f79/51102a31/9be83fd4/6e116845.png"></td><td><img src="http://habrastorage.org/storage/77d003a5/866f5107/ba66940f/5aebaca7.png"></td><td><img src="http://habrastorage.org/storage/6f5555d4/febb2dc3/7b37bc5c/bf742303.png"></td><td><img src="http://habrastorage.org/storage/0b0c4e93/4b6ea486/9417bd9e/2c2523e1.png"></td></tr></tbody></table>  <b>A. We</b> save in the stack and restore from the stack the registers that are used in the function. <br>  <b>B. The</b> register AX runs in a loop from 0 to 199 inclusive. <br>  <b>C.</b> The BX register runs in a loop from 0 to 319 inclusive. <br>  <b>D.</b> Store AX and BX on the stack.  Align the coordinates of the center of the spiral on the screen, for a resolution of 320x200 we shift the center by the middle - (160, 100).  Recover AX and BX from the stack. <br>  <b>E.</b> We build AX in a square, we swap the value of registers AX and BX, once again we build AX in a square.  We have in the registers AX and BX square coordinates.  Add the register values ‚Äã‚Äãand load the result into the DX. <br><br>  Calculating the root is quite possible to sacrifice in favor of reducing the size of the application code.  It would be good to save the AX and BX registers on the stack and restore them back when calculating the length of a vector: <br><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ax <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> bx ; dx = ax^<span class="hljs-number"><span class="hljs-number">2</span></span> + bx^<span class="hljs-number"><span class="hljs-number">2</span></span> mul ax, ax xchg ax, bx mul ax, ax add ax, bx mov dx, ax <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> bx <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> ax</code> </pre><br>  Now the code that calculates the angle angle for given sin and cos: <br><br><pre> <code class="hljs matlab">;    * k2 ; dx += arctan(alpha * k2) mov [<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>], ax mov [<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>], bx finit fild word [<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>] fild word [<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>] fpatan fimul word [k2] fimul word [glad1] fidiv word [glad2] fist word [tmp] add dx, [tmp]</code> </pre><br><br><h4>  4.3.  Keystroke Test </h4><br><br><pre> <code class="hljs go">;     mov ah, <span class="hljs-number"><span class="hljs-number">0</span></span>Bh ; AX := <span class="hljs-number"><span class="hljs-number">0</span></span>B00h <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>h cmp al, <span class="hljs-number"><span class="hljs-number">0f</span></span>fh jmp_loop_pal_exit: jne loop_pal_out ;     mov ah, <span class="hljs-number"><span class="hljs-number">08</span></span>h <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>h label_push_space: cmp al, <span class="hljs-string"><span class="hljs-string">' '</span></span> jne label_push_left mov ch, <span class="hljs-number"><span class="hljs-number">0</span></span> label_push_left: cmp al, <span class="hljs-number"><span class="hljs-number">75</span></span> jne label_push_right dec ch .......</code> </pre><br><br>  I think the code has already got everyone)) This is where it lies entirely: <a href="http://codepad.org/mEDX1Z2X">http://codepad.org/mEDX1Z2X</a> <br><br>  You can also reduce the amount of code by removing the extra control keys.  I think if you throw out all the controls you can easily keep within 128 bytes.  But without control is not so interesting. </div><p>Source: <a href="https://habr.com/ru/post/121999/">https://habr.com/ru/post/121999/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121991/index.html">Touch Shooting in Video Games: A PlayStation Move Weapon Review</a></li>
<li><a href="../121992/index.html">What if the giant wants to eat your lunch</a></li>
<li><a href="../121993/index.html">Transparent Page Sharing in ESX 4.1 - following the last year‚Äôs article</a></li>
<li><a href="../121995/index.html">Copyrights to non-creative works</a></li>
<li><a href="../121997/index.html">Flash vs JavaScript, V8 Benchmark Suite</a></li>
<li><a href="../122001/index.html">A unique opportunity to meet with gurus working with startups from the American office of Microsoft</a></li>
<li><a href="../122002/index.html">jQuery.waterfall. Small health</a></li>
<li><a href="../122003/index.html">Appendix "Book Exchange"</a></li>
<li><a href="../122004/index.html">Smartphone with two cores. LG Optimus 2X video review</a></li>
<li><a href="../122006/index.html">Tips for successfully dumping a project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>