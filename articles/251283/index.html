<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>BattleGIS - JavaScript engine for playing Tanchiki</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dandy Tanchiki is a classic example of duck syndrome in the plane of video games. Modern games are so cool that it is difficult to distinguish a scree...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>BattleGIS - JavaScript engine for playing Tanchiki</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/731/e4b/008/731e4b00867d467dbdf48e04eb0c2492.png"><br><br>  Dandy Tanchiki is a classic example of duck syndrome in the plane of video games.  Modern games are so cool that it is difficult to distinguish a screenshot from a photo.  However, adult guys can spend eight-bit pixels on the screen for hours, recalling a happy childhood. <br><br>  I wanted to do something like that, so that you could get together with your colleagues in a big meeting and have different kinds of drinks and have fun.  This had to be related to professional activity: JavaScript or layout, because in order to plow to Kwaku or go to kebabs, it is not necessary to be a frontend developer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So the idea was born to make JavaScript AI-challenges. <br><a name="habracut"></a><br>  Alas, but most of these platforms did not suit us: the real condition, the observed competitiveness and the low threshold of entry were imperative.  That is, artificial intelligence should be written from 5 minutes to 3 hours by a JavaScript programmer of any level, and not several weeks by a group of sishnikov, such as, for example, in AI Cup `s from Mail or Google. <br><br>  I wanted a battle, code writing and competition. <br><br><h4>  Project </h4><br>  Based on the above, the implementation had to satisfy some requirements. <br><br><ul><li>  Maximizing the fun of the game, </li><li>  and from the use of new technologies in the course of the project. </li><li>  The lowest threshold for entering the writing of AI. </li><li>  Realtime battle on the big screen. </li><li>  Update the "brains" on the fly. </li><li>  Cross-browser support for the latest version of chrome. </li></ul><br>  From the point of view of the fan, there were no alternatives to the tanks: this is a spectacular realtime game with simple and familiar mechanics.  The choice of the tanks was partly satisfied with the second requirement: you only have five buttons on the dandy: the cross and the shoot.  Exactly so many basic methods should have been in the prototype of the AI: it radically lowered the threshold for entry, and the first thing that most participants did was write a random bot: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.move([<span class="hljs-string"><span class="hljs-string">'left'</span></span>, <span class="hljs-string"><span class="hljs-string">'up'</span></span>, <span class="hljs-string"><span class="hljs-string">'right'</span></span>, <span class="hljs-string"><span class="hljs-string">'down'</span></span>][<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * <span class="hljs-number"><span class="hljs-number">4</span></span>)]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fire();</code> </pre> <br>  You can only ride in a straight line, shoot only where you are going - these are the determining rules of the game.  Everything else (acceleration, drifts, recoil from shooting, accumulation of ammunition) was introduced gradually and with the main condition: the impact on the gameplay and the result of each new feature should be minimal. <br><br><h4>  Implementation </h4><br>  To calculate all the mathematics (position, collisions, hits), the <a href="https://github.com/2gis/Battlegis">engine</a> was written on Node.js.  The debugging problem quickly arose, the solution of which was the client Browserify build, which is perfectly debugged in DevTools Chrome. <br><br>  At an early stage, a thin client made for visualizing fights, ajax, requested the last N frames of the battle and rendered them with dom elements (no kidding!).  It was very funny when the dom-projectile, hitting the target, flew diagonally to another tank and fired again ... well, together with the noise of fans of sweating laptops, we quickly came to understand that we can't do without the Canvas (thanks to the PIXI library) . <br><br>  For networking, we used Socket.io.  When you use web sockets, you understand that the 21st century has come.  Trigger events on one machine, listening to this event on another, streams ... on the server, we simply write frames to the stream, and listen to these frames on the client.  No buffering, problems with memory and out of sync. <br><br>  By the way, we wanted to write something on the Meteor framework.  "Something" was our client part.  Modularity, high-level APIs, packages, isomorphism, Live Reload - albeit redundant in our case, but very nice things. <br><br>  From the point of view of technology, the most interesting requirement was to replace players ‚Äúon the fly‚Äù: the battle is on, the tank shoots and drives, and its ‚Äúbrains‚Äù at any moment can completely change at the request of the author.  There can be no pre-moderation: the code within a second after sending should start executing on the server. <br><br>  At first we trusted each other, so new Function () was quite enough.  But one good person wrote process.kill () in his bot, and it became clear that such multiplayer should not be given to OpenSource.  Effectively catching all sorts of horrors like setTimeout (while (true)) with regulars is not possible, and here an absolutely safe sandbox could come to our aid, but we wanted to touch the new-fashioned virtual machine. <br><br>  With the Node.js virtual machine, everything turned out to be simple, but interesting: for example, in the current really stable node of version 0.10.36, the prototype falls off in the context object passed to the virtual machine (and there is suddenly no MAX_SAFE_INTEGER).  At 0.12.0, <a href="https://github.com/joyent/node/issues/9219">all is not well</a> either, plus our work projects, such as <a href="http://2gis.ru/">2gis.ru</a> , are not yet working on it, due to problems with building some npm packages.  In this regard, we now use the wonderful npm package <a href="https://www.npmjs.com/package/n">‚Äún‚Äù</a> to quickly switch the node version. <br><br>  The work with the virtual machine itself is simple: we run the prepared eval script in the context of the js object we have chosen.  And this object has no setTimeout, console.log and other things that are in the global object.  In addition, the virtual machine allows you to limit the execution of the code by time: if the code runs for a long time, it is killed, and its last breath catches the closest catch in the stack. <br><br><h4>  Eventually </h4><br>  We studied the websockets and Node.js virtual machine, poked Meteor and PIXI with our wand, signed the AI, for many the first in my life, and, most importantly, fought with each other and got a lot of fun. <br><br>  A side effect of Browserify-build was a single player, which you can go now: <a href="http://battle.2gis.ru/">battle.2gis.ru</a> .  Look at the engine itself, you can here: <a href="https://github.com/2gis/Battlegis">github.com/2gis/Battlegis</a> . <br><br>  In the near future, we plan to make a dedicated server with a full-fledged multiplayer, where everyone will be able to compete with other JavaScript-programmers;  and, of course, do bugfixes and cross-browser compatibility.  Follow the news! </div><p>Source: <a href="https://habr.com/ru/post/251283/">https://habr.com/ru/post/251283/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251263/index.html">About some aspects of repairing a hard drive electronics board</a></li>
<li><a href="../251267/index.html">Lock-free data structures. Concurrent maps: trees</a></li>
<li><a href="../251269/index.html">(Video) HP Helion Presentation</a></li>
<li><a href="../251271/index.html">Reduced overhead for utilities on golang</a></li>
<li><a href="../251277/index.html">Static JavaScript analyzers and errors that they can help you to unlearn (Part 1)</a></li>
<li><a href="../251285/index.html">Overview of Microsoft Azure platform updates for February</a></li>
<li><a href="../251289/index.html">Corporate and unincorporated IaaS: how not to get lost in the cloud market</a></li>
<li><a href="../251291/index.html">Data Owners - Thoughts on, Pros and Cons</a></li>
<li><a href="../251293/index.html">What bugs did LibreOffce find in PVS-Studio?</a></li>
<li><a href="../251295/index.html">Data compression methods</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>