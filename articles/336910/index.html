<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple work with Steamworks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unity, C #, Steamworks.NET and Facepunch.Steamworks 
 Introduction 
 Like most game developers, I really want to post my game on Steam. 

 Like most i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple work with Steamworks</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/c02/883/681/c028836817e1c74b5e7c54f6fe2d9a08.png"><br><br><h1>  Unity, C #, Steamworks.NET and Facepunch.Steamworks </h1><br><h2>  Introduction </h2><br>  Like most game developers, I really want to post <a href="https://twitter.com/isotacticsgame">my game</a> on Steam. <br><br>  Like most <em>indie</em> game developers, I lack access to resources / knowledge that would give me a clear understanding of what it really means to be on Steam. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is difficult to fill this gap in knowledge, because, despite the <a href="https://partner.steamgames.com/doc/home">detailed documentation of</a> Steam's capabilities, it is difficult to know where to start in this huge repository of documents and how its parts are interconnected.  In addition, the main discussions of the Steam platform are held in a closed forum, accessible only to platform-confirmed via Steam Direct or Valve developers' referral link.  That is, for beginners, finding answers to simple questions can be a difficult task. <br><br>  So I decided to write a high-level review for people who are just starting to figure out how to make Steam work with their games.  In particular, I will look in detail at <a href="https://partner.steamgames.com/">Steamworks SDK</a> , the Valve software library, which provides access to such aspects as a workshop (Workshop), leaderboards (Leaderboards), achievements (Achievements), and so on. <br><br>  Steamworks is <a href="https://partner.steamgames.com/doc/home">well documented</a> by Valve, but the documentation is written from the point of view of a person using the native C ++ library and already having an idea of ‚Äã‚Äãhow all these functions intersect.  If this is not your case, then it is even better!  Below is an explanation for another person who writes the game in a higher level language and just wants to provide easy integration with Steamworks (and this is possible, I guarantee!).  More specifically, this post is intended for people using C # in one form or another, and ideally working in the Unity game engine. <br><a name="habracut"></a><br><h2>  Steamworks </h2><br>  Steamworks consists of two parts.  Firstly, this is a developer portal designed to manage everything related to the existence of the game on Steam, from changing game banners to sales management and a list of supported controllers.  Secondly, this is the SDK provided by Valve so that the developer can interact with everything <em>else</em> on Steam, including the workshop, leaderboards, servers, achievements, etc.  Do not forget about this system!  The SDK is " <a href="https://partner.steamgames.com/doc/sdk">only required to download content to Steam</a> ".  This means that you can completely refrain from messing around with all the above SDK features and focus only on how to download the game to Steam.  However, the SDK provides many other useful features, so let's configure it and make it work! <br><br>  If you are writing in C ++, you can simply add the library to your game by <a href="https://partner.steamgames.com/doc/sdk/api">following these instructions</a> . <br><br>  But if you are a developer on C # / in Unity, you will have to work a little.  Native C ++ headers / sources are incompatible with Unity, you need to use a wrapper library that allows you to integrate the functions of the SDK.  Such a wrapper will allow us to use high-level C # functions to call low-level C ++ functions.  In the past, such a wrapper library was <a href="">Steamworks.NET</a> , which fully corresponds to its name: this is Steamworks, implemented on .NET.  However, this is <em>exactly</em> what she does, and nothing more. <br><br>  Steamworks.NET provides a one-to-one transformation of Steamworks functions into C # functions, but this means that in order to work you will need a <em>complete understanding of</em> Steamworks as a library.  For beginners who want to get rid of simple work, this may be too much.  If you want to do something more complicated, for Steamworks.NET you will have to write your own wrapper <em>on top of</em> its wrapper, which deprives the wrap idea itself. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffc/a3f/97d/ffca3f97ddd3d20821ce4ea5d7e0578e.png"><br><br><h2>  Facepunch.Steamworks </h2><br>  Due to these limitations and <a href="https://github.com/Facepunch/Facepunch.Steamworks">for other reasons</a> , Facepunch Studios (known for Rust and Garry's Mod games) wanted to write a more convenient Steamworks library for C # / Unity. <br><br>  It eliminates the need to write a bunch of code to implement simple (and complex) tasks in Steamworks, allowing you to focus on the ‚Äúwork‚Äù with Steam itself.  The library is used in Rust, that is, its work is tested on the game with one of the largest communities of players on Steam.  Difficult tasks are abstracted into simple function calls, the library itself consists of only three files, that is, it does not really inflate the project.  I can not express how useful it is for beginners, this is a real find.  The creator of Steamworks.NET even said that Facepunch.Steamworks is " <a href="https://www.reddit.com/r/gamedev/comments/68mndv/garry_newman_releases_a_cfriendly_mit_licensed/dgzvzwh/">exactly what I wanted to turn Steamworks.NET into</a> " and that " <a href="https://www.reddit.com/r/gamedev/comments/68mndv/garry_newman_releases_a_cfriendly_mit_licensed/dgzvzwh/">for most developers it should be the default choice</a> ".  Steamworks.NET <a href="https://steamworks.github.io/">is still available</a> for those who want to implement their own version of Facepunch.Steamworks, but, in my opinion, what is good for Rust is good enough for me.  How does the library work and what is special about it?  Let's start to understand. <br><br><h2>  Beginning of work </h2><br>  First, you might think that to start working with Steamworks you need to be a confirmed developer of Steamworks, but in fact, you <em>can</em> use the SDK <em>right away</em> without going through the registration process.  Valve provided developers with a test ‚ÄúAppID‚Äù 480, for which you can program. <br><br><h3>  AppID </h3><br>  AppID is a unique game identifier on Steam (and Steamworks).  You get it in immediately after registering the game.  It "takes" you a place on Steam / Steamworks and allows you to fully dispose of everything related to this AppID.  AppID 480 corresponds to SpaceWar, a demo game created by Valve.  It has open source and shows some of the features of Steamworks ( <a href="https://partner.steamgames.com/doc/sdk/api/example">be sure to learn it</a> !). <br><br>  Unique AppID - this is convenient and obviously necessary for your game at a certain stage, while the test AppID (480) allows you to work with Steam services <em>as if</em> your game is ready.  When you get a real AppID, then substitute it, but for now, 480 is fine. That is, you should not create a server called ‚ÄúServer with the name of my game awaiting registration as a trademark.‚Äù <br><br><h3>  Download and import Facepunch.Steamworks </h3><br>  So, let's download the Facepunch.Steamworks library (hereinafter I will call it FP), already knowing that we will be able to test it with AppID 480. <a href="https://github.com/Facepunch/Facepunch.Steamworks/releases">Go to the releases section on the Github page</a> (the library has a completely open source code and MIT license) and download the latest release.  Unzip the .zip file to get several folders.  In README, everything is detailed, but, in essence, it is enough just to copy a small set of these files into your Unity project (details depend on the platform).  Facepunch.Steamworks files are the library itself, steam_api files and platform-specific files containing the Steamworks SDK itself.  After importing, the Unity folder should look something like this (in the case of Windows x86 / x64): <br><br><pre><code class="1c hljs">Unity Project Folder <span class="hljs-string"><span class="hljs-string">|‚Äî Assets |‚Äî Plugins |‚Äî Facepunch.Steamworks |‚Äî Facepunch.Steamworks.dll |‚Äî Facepunch.Steamworks.pdb |‚Äî Facepunch.Steamworks.xml |‚Äî steam_api.dll (Windows x86) |‚Äî steam_api64.dll (Windows x64) |‚Äî steam_appid.txt</span></span></code> </pre> <br><br>  The ‚Äústeam_appid.txt‚Äù file is a text file that contains only your AppID, so we will use a text file with ‚Äú480‚Äù (without quotes).  The files ".dll", ".pdb" and ".xml" are copied from the Release folder of the downloaded .zip file of the appropriate version ".NET".  For Unity, 3.5 is suitable.  If you start from scratch, Facepunch generously <a href="https://github.com/Facepunch/Facepunch.Steamworks.Unity">provides a small test project</a> that does most of the work for you.  With it, you can start your project. <br><br><h2>  Unity </h2><br>  By copying all the library files into the appropriate directories, you are almost done setting up!  The only thing we need is to write some code to integrate everything.  I will copy the test file from the <a href="https://github.com/Facepunch/Facepunch.Steamworks.Unity">test project</a> and just cut it for clarity. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Facepunch.Steamworks; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SteamTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//       DontDestroyOnLoad( gameObject ); //   Unity //    -       Facepunch.Steamworks.Config.ForUnity( Application.platform.ToString() ); //   steam    AppID (  AppID) new Facepunch.Steamworks.Client( 480 ); // ,     if ( Client.Instance == null ) { Debug.LogError( "Error starting Steam!" ); return; } //    Debug.Log("My Steam ID: " + Client.Instance.SteamId); Debug.Log("My Steam Username: " + Client.Instance.Username ); Debug.Log("My Friend Count: " + Client.Instance.Friends.AllFriends.Count() ); } private void OnDestroy() { if ( Client.Instance != null ) { //     ,     Client.Instance.Dispose(); } } void Update() { if ( Client.Instance != null ) { //    Update     Client.Instance.Update(); } } }</span></span></code> </pre> <br>  And that is all!  If you attach this script to the ‚ÄúGameObject‚Äù in the scene and go into game mode, then you will see that on Steam you are playing ‚ÄúSpacewar‚Äù and the basic Steam information about you is displayed in the console (if it didn‚Äôt work out, check whether Steam). <br><br><h2>  Life with Facepunch.Steamworks </h2><br><h3>  Opportunities </h3><br>  Once set up, access to the deeper Steam functions becomes quite simple, because the FP library processes and wraps almost all parts of the standard Steamworks SDK.  However, the question still remains: <i>what</i> are these parts?  Here is a small list with descriptions of what you can work with (in the FP library): <br><br>  1. Servers - the creation of servers using a player's client or launching a "headless" server in any other place.  Used for ping-sensitive games with high network requirements (such as Dota 2, Overwatch, etc.) <br><br>  2. The lobby is the ‚Äúmeeting place‚Äù of players used to share SteamID or other user information. <br><br>  3. Friends - you and your friends are players on Steam. <br><br>  4. Workshop - upload / download content to and from the Steam Workshop. <br><br>  5. Leaderboards ‚Äî create and store global leaderboards for the game. <br><br>  6. Achievements - the creation and issuance of achievements. <br><br>  7. Network - sending P2P data to clients. <br><br>  8. Steam Cloud - saving data to the cloud Steam Cloud!  Very useful for saving games. <br><br>  9. Voice - interaction with the Steam voice API for in-game chat. <br><br>  10. Statistics - setting statistics on the Steam side for a given player. <br><br>  The best way to learn how to use the necessary functions is to see if there is a working example of it in the <a href="">test project</a> Facepunch.Steamworks (NOTE: this is <em>not a</em> test Unity project), and simulate its implementation in your game. <br><br>  Most of the features are documented in <a href="https://github.com/Facepunch/Facepunch.Steamworks/wiki/Facepunch.Steamworks">the FP library wiki</a> , but in fact several classes have a sufficient description.  If you cannot find an example, examine the library code and see if the function is implemented at all.  If not, then see how far you can go into its implementation for your part, or simply send an error message to the library.  Usually, Facepunch developers are very responsive, they can tell you whether they are working on something or not, and can even help you in helping the community if you decide to implement something yourself. <br><br><h3>  Subscribers and Callbacks </h3><br>  When working with the FP library (or even with the native API), you will notice that it is not always easy to work with the usual call of something like <code>Client.Instance.SteamId</code> .  The reason is that Steamworks SDK (and therefore the FP library) makes extensive use of asynchronous functions so that the game does not ‚Äúhang‚Äù every time you need to perform a non-trivial interaction with Steam.  Without asynchronous calls, you would have to wait for a response from the main Steam server before running <strong>your</strong> code, which would obviously become a source of errors and annoyance during the game.  Therefore, to use the library you need to get used to the concept of <strong>delegation</strong> and <strong>callbacks</strong> .  For a beginner, this may seem complicated, but these concepts are easy to understand if you understand the basic idea.  I will give an example. <br><br>  If you need to get a list of all the lobbies in the game using the FP library, you will write the following: <br><br><pre> <code class="cs hljs">client.LobbyList.Refresh();</code> </pre> <br>  Note that no return or assignment is performed here.  But in that case, how do we <em>get</em> what we request?  After calling a function in Steamworks, the Steam backend prepares everything you need, and then sends you data through a ‚Äúcallback‚Äù.  Steam almost literally "calls you" to report: "Hey, your data is ready!". <br><br>  To receive a call, we need to ‚Äúpick up the phone‚Äù, or, as it is usually called, ‚Äúsubscribe‚Äù to the callback.  This is implemented by defining the function that <em>the</em> callback data <em>receives</em> .  Sometimes it does not transmit data, then the callback is used primarily as a ‚Äúhandler‚Äù or as a way to communicate what can be continued.  When you are inside a callback handler, you can safely continue working.  Here is an example: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    ,  ,   ,  Steam  OnLobbyJoined. client.Lobby.OnLobbyJoined += OnLobbyJoinedCallback; //   Native.Lobby.Join(LobbyID); } void OnLobbyJoinedCallback(bool success) { //   ,     ! //      ,    "success",  Steam    true  false if(success) { //   ,      ,    // ,   id   Debug.Log(client.Lobby.Owner); } }</span></span></code> </pre> <br>  Understanding this pattern will be very useful when using the library.  It is also very helpful to understand what Steamworks actually does, so it‚Äôs worth exploring its documentation.  If you want to learn more about how it works, I recommend reading the <a href="https://partner.steamgames.com/doc/sdk/api">Valve documentation on this topic</a> , as well as some sections <a href="https://steamworks.github.io/gettingstarted/">of the Steamworks.NET website</a> . <br><br><h2>  Moving on </h2><br>  From now on you can do anything!  Valve does not set any requirements, but if you are on the platform, it is obvious that it is first of all interesting for you to contact it and its community in the ways provided by Valve.  After registering with Steam Direct, you simply replace AppID and transfer all Steam functions that you have implemented for the test AppID. <br><br>  I hope this article will be useful for those who want to start working with Steam, and I highly recommend everyone to explore <a href="https://github.com/Facepunch/Facepunch.Steamworks">Facepunch.Steamworks on Github</a> .  If you are ready for more, try to make a modest contribution, for example, filling in the gaps in the documentation or sending requests.  If you have any questions about the article, you can contact me on Twitter: <a href="https://twitter.com/kkukshtel">@kkukshtel</a> .  I will be glad if you read the news about my game on Twitter <a href="https://twitter.com/isotacticsgame">@isotacticsgame</a> or <a href="http://tinyletter.com/isotactics">subscribe to the newsletter</a> .  If you want to read more on similar topics, <a href="http://blog.kylekukshtel.com/">I recently created my own blog</a> in which this article was originally published. </div><p>Source: <a href="https://habr.com/ru/post/336910/">https://habr.com/ru/post/336910/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336898/index.html">To increase the reliability and security of banking software, use PVS-Studio</a></li>
<li><a href="../336900/index.html">Disguise UDP traffic in TCP / ICMP using udp2raw</a></li>
<li><a href="../336902/index.html">Nuxt.js: Framework for the Vue.js framework</a></li>
<li><a href="../336906/index.html">Friday JS: reqyire.js and ochepyatko-oriented programming</a></li>
<li><a href="../336908/index.html">Create your own physical 2D engine. Part 1: fundamentals and resolution of impulses of force</a></li>
<li><a href="../336912/index.html">PCI DSS in version 3.2 - what's new and how to respond?</a></li>
<li><a href="../336916/index.html">Reviving Dinosaurs: TDD vs Test-Last</a></li>
<li><a href="../336918/index.html">Product design digest, August 2017</a></li>
<li><a href="../336920/index.html">SYSTIMAX Structured Cabling Systems - High Performance Innovation Based Infrastructure</a></li>
<li><a href="../336922/index.html">Azure Monitor: features and limitations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>