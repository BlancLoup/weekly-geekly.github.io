<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nakapcha Mail.Ru - captcha, which is not shown</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! Today I want to tell you about our relatively recently created captcha service. This service differs from similar ones in that our captcha n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nakapcha Mail.Ru - captcha, which is not shown</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  Today I want to tell you about our relatively recently created captcha service.  This service differs from similar ones in that our captcha <s>never</s> more often needs to be solved at all.  As you know, captcha negatively affects the conversion - not everyone can quickly solve it, especially if it is unreasonably complex, and some users leave the resource.  And I do not know such people who love to break their eyes and enjoy the process of solving.  Therefore, if you save the user from having to enter another additional field, this will make him a little more loyal. <br><br><img src="https://habrastorage.org/files/92a/2a7/a10/92a2a7a10a3e4ed7b5dfb4ba22663ff5.png"><br>  <sup>Hardly anyone will be able to unravel this captcha :)</sup> <br><br>  In a nutshell, Nekapcha is an intellectual captcha service that does not require a person to undergo an inspection.  Naturally, without additional information, the service cannot say anything about the user.  Where do you get it from?  The fact is that Mail.Ru has more than 100 million users, and most of them are authorized.  And this means that with a request for our domains, session cookies are transmitted, by which we identify the user, and then we retrieve his profile, statistics, spam rating, etc.  All this information is fed to the input of the classifier algorithm, and at the output we get an assumption about whether the user is a human or a spam bot. <br><a name="habracut"></a><br>  We submitted an application for PCT invention in December 2013, the service itself was launched in the spring of 2014 (by the way, long before the launch of the updated reCAPTCHA - <a href="http://top.mail.ru/visits%3Fid%3D2487623%26days%3D730">proof</a> and, for example, <a href="http://monoray.ru/forum/viewtopic.php%3Ff%3D6%26t%3D938">proof</a> ).  To be sure that the service is working properly, we had to keep it in beta status for a long time and run a small advertisement.  But now the time has come to introduce Nekapchu to the general public.  The service was created to protect the forms on any sites, it is available for free to all users and has been successfully used by some of our projects for almost a year. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  What it looks like for the user </h1><br>  The service was conceived with the intention that a person had to introduce captcha as seldom as possible, ideally never.  For the user, Nekapcha is presented in the form of a widget, which can be located anywhere in the form.  A widget can be in one of two states: verified and unverified. <br><br><img src="https://habrastorage.org/files/9db/f70/13b/9dbf7013b8024b08acdbb6dad3115850.png"><br>  Unverified state, you need to enter captcha. <br><br>  The widget will be in an unverified state if the algorithm deems that the user is an automated script.  In this case, you must correctly enter the captcha.  If the picture is not readable, then it can be updated.  In the captcha drawing, we tried to achieve a balance of readability and complexity. <br><br><img src="https://habrastorage.org/files/190/15f/3c5/19015f3c56264265adb05b8d8071ad3b.png"><br>  The verified state, captcha checking is not needed. <br><br>  If the Nekapchi algorithm most likely determined that the user is a human, the widget will be in a verified state. <br><br><h1>  What it looks like for webmasters </h1><br>  Embedding Nekapchu usually not a big deal.  First you need to register your domain on the Necapci site ( <a href="https://ru.wikipedia.org/wiki/IDN">IDNs are</a> supported).  The domain is assigned two keys: public and secret.  The public key is needed for captcha generation, and the secret key is for verification. <br><br>  The service API is very simple and consists of two calls: <br><ul><li> <code>/captcha</code> - captcha generation </li><li>  <code>/check</code> - captcha check </li></ul><br>  A link to the script is added to the page: <br><br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"https://api-nocaptcha.mail.ru/captcha?public_key=KEY"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  And inside the div form with the nocaptcha identifier, in which the widget will be drawn: <br><br><pre> <code class="javascript hljs">&lt;div id=<span class="hljs-string"><span class="hljs-string">"nocaptcha"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  The widget adds two new fields to the form: <br><br><pre> <code class="javascript hljs">&lt;input type=<span class="hljs-string"><span class="hljs-string">"text"</span></span> name=<span class="hljs-string"><span class="hljs-string">"captcha_value"</span></span> value=<span class="hljs-string"><span class="hljs-string">""</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"captcha_id"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"CAPTCHA_ID"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  These fields are passed among the form parameters to the handler.  If captcha was not displayed, then the <code>captcha_value</code> field will remain empty.  On the server side in the handler, you need to pull out the values ‚Äã‚Äãof these fields and pass them to the request to check the captcha.  This is how a form handler can look like before embedding Nekapchi: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expand_template</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($file, $vars = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($vars !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) extract($vars, EXTR_OVERWRITE); <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $file; } $vars = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_SERVER[<span class="hljs-string"><span class="hljs-string">'REQUEST_METHOD'</span></span>] == <span class="hljs-string"><span class="hljs-string">'POST'</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//     $vars['result'] = 'ok'; } else { //    $vars['form'] = true; } expand_template('template.html', $vars);</span></span></code> </pre><br>  Depending on the request method, either the form is drawn or the submitted form is processed.  After embedding, the handler changes slightly: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//    ,   https://nocaptcha.mail.ru define('PUBLIC_KEY', 'ed64110f3e3ef4c2aad78446fdfe63a5'); define('PRIVATE_KEY', 'da9d56871519a43eba63a9a394f8fd53'); //  PHP-  require_once('../../Package/nocaptcha/captcha.php'); function expand_template($file, $vars = null) { if ($vars !== null) extract($vars, EXTR_OVERWRITE); include $file; } $vars = array(); if ($_SERVER['REQUEST_METHOD'] == 'POST') { $result = check_captcha(PRIVATE_KEY, $_POST['captcha_id'], $_POST['captcha_value']); if ($result === true) { //     $result = 'ok'; } else { //     , //      } $vars['result'] = $result; } else { //    $vars['form'] = true; $vars['nocaptcha_script'] = display_captcha(PUBLIC_KEY); } expand_template('template.html', $vars);</span></span></code> </pre><br>  Added key constants that are used to display the form and check the captcha.  Before displaying the form, a tag is generated with reference to the Non-Captcha script to which the public key is transmitted.  Before processing the form fields, a request is made to check the captcha.  Depending on the response of the service, the handler can either continue the work, or inform the user about the failed anti-bot check and ask to repeat the input.  This example uses helper functions from a PHP module, which will be described in more detail below. <br><br>  The service responds to the request for captcha checking in JSON format.  If captcha is entered correctly, then true is returned, otherwise false.  For the handler, the procedure for checking the hidden and shown captcha is the same and transparent.  On a request to check a hidden captcha, it always returns true regardless of the <code>captcha_value</code> value. <br><br> <code>{"status": "ok", "is_correct": true/false}</code> <br> <br>  This is how a diagram of messages looks like schematically when a user visits a page with a form that uses Nekapchu: <br><br><img src="//habrastorage.org/files/aee/4d9/863/aee4d9863a0d4fcf9e286012784f4b6e.png"><br><br>  And this is what the message diagram looks like when the user has submitted the completed form: <br><br><img src="//habrastorage.org/files/ab7/a22/567/ab7a2256743b4907924809df9967c242.png"><br><br><h1>  Widget customization </h1><br>  The widget has a number of display options.  They are set using the javascript nocaptchaSettings object, which must be created on the page with the form. <br><br>  Widget supports localization.  Using the lang parameter, one of the two available languages ‚Äã‚Äãis set: Russian or English.  The default language is Russian. <br><br>  If there are several forms on the page, and each of them needs to be protected by Nekapchey, then you can set unique identifiers of containers in which widgets will be drawn.  For this there is a parameter containers, which takes an array of strings.  Naturally, it is necessary to add the corresponding div to each form.  By default, a container with the nocaptcha identifier is searched. <br><br>  You can also set tabindex fields for captcha input to ensure continuous data entry and correct TAB switching between form fields.  To do this, use the tabindex parameter. <br><br><h1>  Documentation and auxiliary modules </h1><br>  We tried to compile good and complete documentation on how to embed Nekapchu, how it works and how to use its API.  It is available <a href="https://nocaptcha.mail.ru/docs">at</a> . <br><br>  In addition, small auxiliary modules for two languages ‚Äã‚Äãwere implemented - <a href="https://github.com/mailru/nocaptcha-php">PHP</a> and <a href="https://github.com/mailru/nocaptcha-python">Python</a> .  They are located on github, available for download, study and use in any projects.  There are several examples in these modules that will help you understand how to use their functions.  Also, based on the source code of the modules, you can easily write your own libraries for other frameworks. <br><br>  I hope our new service will suit your taste, and your users will appreciate its benefits.  :) <br><br>  We are waiting on our site <a href="https://nocaptcha.mail.ru/">https://nocaptcha.mail.ru</a> . </div><p>Source: <a href="https://habr.com/ru/post/255633/">https://habr.com/ru/post/255633/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255623/index.html">Comparison of technical support of the largest software vendors in the field of network security</a></li>
<li><a href="../255625/index.html">Features of creating programs in NODEMCU ESP8266 for the ‚ÄúInternet of Things‚Äù</a></li>
<li><a href="../255627/index.html">Building signs and comparing images: global signs. Lectures from Yandex</a></li>
<li><a href="../255629/index.html">Reports and competitions for NeoQUEST-2015</a></li>
<li><a href="../255631/index.html">"Operator Overloading" in Scala</a></li>
<li><a href="../255637/index.html">Is there a USB in this MK?</a></li>
<li><a href="../255643/index.html">Online streaming. Monitoring: from server to application. System Center Operations Manager 2012 R2</a></li>
<li><a href="../255645/index.html">Again about AUTO_INCREMENT</a></li>
<li><a href="../255647/index.html">Levitron on Arduino</a></li>
<li><a href="../255649/index.html">Best approaches to moving a MATLAB code to a fixed point</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>