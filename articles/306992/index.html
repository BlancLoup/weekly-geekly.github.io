<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wordpress multisite with different databases</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How did I even get to the multisite mode? The thing is that if you create some more complex functionality on the engine using plug-ins, which will inc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wordpress multisite with different databases</h1><div class="post__text post__text-html js-mediator-article">  How did I even get to the multisite mode?  The thing is that if you create some more complex functionality on the engine using plug-ins, which will include the possibility of several diverse sites, its performance will be terrible. <br><a name="habracut"></a><br><blockquote>  The second method with shardb is more preferable, added below. </blockquote><br>  Everywhere they add their js / css and where they are not needed.  Thus, if you install several powerful heavy plug-ins and another + 10-15 additional smaller ones, you can see a huge number of scripts and styles everywhere on almost every page. <br><br>  The solution to this was found - <a href="https://codex.wordpress.org/%25D0%25A1%25D0%25BE%25D0%25B7%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D1%2581%25D0%25B5%25D1%2582%25D0%25B8">the multisite mode</a> . <br><br>  Connect it is not difficult and you can start using it in a couple of minutes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To do this, add a line in <b>wp-config.php</b> <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/*  ,   . ! */</span></span> define(<span class="hljs-string"><span class="hljs-string">'WP_ALLOW_MULTISITE'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre> <br>  After that, go to Tools -&gt; Network Installation. <br><br>  It must be performed with plugins turned off. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c15/02b/626/c1502b6262bcb6b49c50cc91bb66ff99.png" alt="image"><br><br>  You will be prompted to replace the data in wp-config and .htaccess and log in again on the site. <br><br><h4>  Multisite system </h4><br>  Site Modes only 2 - this is either a folder / or subdomains. <br><br>  site.ru / site2 <br>  website2.site.ru <br><br>  One table of general users - when registering for any of them, they will be able to enter all the rest as well, so they will not have to register several times. <br><br>  Manage plugins and themes for all sites from the panel.  You can add the necessary for all in one place and further activate them only on those where they are needed separately.  It is also possible to activate them at once for the entire network. <br><br>  Thus, it is possible to reduce the consumption of plug-ins by 50% or more.  It seems to be all right, everything is already in order with the front-end, but the trouble is: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/824/dc6/afc/824dc6afc95f6c65d9b2e9071e64068c.png" alt="image"><br><br>  multisite uses one base for all sites - creating separate tables for each of them. <br><br>  wp_ <br>  wp_2 <br>  wp_3 <br><br>  Now one base will increase several times from each new site. <br><br><h4>  Multisite c separate database for each site </h4><br>  For this we will use the <b>multi-db</b> plugin.  Of course, there are others, such as HyperDB, SharDB, but I have not found any information about them.  You can download multi-db from any link below. <br><br>  <a href="https://cloud.mail.ru/public/KMNr/WDpoUeyUV">cloud.mail.ru/public/KMNr/WDpoUeyUV</a> <br>  <a href="https://drive.google.com/open%3Fid%3D0Bw4XcI3lCfQSUWZWLUUyUHZFVTA">drive.google.com/open?id=0Bw4XcI3lCfQSUWZWLUUyUHZFVTA</a> <br><br>  He himself offers to first decide how many bases you need (16, 256, 4096). <br><br>  I'll start with 16. Important sequence.  First install multisite, I will start sharing databases, having 3 sites created - in order to test it afterwards. <br><br><h4>  Creating vip databases </h4><br>  This option allows you to place a specific site in a specific database.  I don't need it.  I will not touch it.  It does not matter to me, in which, the main thing is that in any other, and not in one. <br><br><h4>  The first step is to prepare new bases. </h4><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_0`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_1`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_2`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_3`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_4`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_5`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_6`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_7`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_8`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_9`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_a`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_b`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_c`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_d`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_e`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_f`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`dbname_global`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CHARACTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> utf8 <span class="hljs-keyword"><span class="hljs-keyword">COLLATE</span></span> utf8_general_ci;</code> </pre><br>  Run this sql query and then you will see them. <br><br><img src="https://habrastorage.org/files/e97/427/e76/e97427e767104b649faa53962d879974.png" alt="image"><br><br><h4>  Creating users and passwords in phpMyAdmin </h4><br>  Since I'm on Localhoste, I don't need this.  It will be suitable for root, but you may need to create new names and passwords, as well as give the necessary privileges if you make the site not for yourself alone, but, for example, for several people.  Therefore, I will skip this paragraph. <br><br><h4>  Unpacking files </h4><br>  db-config.php, db.php need to be placed in <b>wp-content</b> <br><br>  move-blogs.php in any folder after wp-content, for example in the new <b>/ wp-content / scripts /</b> <br><br><h4>  Configuring Plugins </h4><br>  <b>DB-config.php</b> <br><br><pre> <code class="php hljs">define (<span class="hljs-string"><span class="hljs-string">'DB_SCALING'</span></span>, <span class="hljs-string"><span class="hljs-string">'16'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//------------------------------------------------------------------------// //---DC IPs---------------------------------------------------------------// //------------------------------------------------------------------------// // Usage: add_dc_ip(IP, DC) // EX: add_dc_ip('123.123.123.', 'dc1'); add_dc_ip('127.0.0.', 'dc1');</span></span></code> </pre><br>  Here you need to specify the number of databases, <b>16</b> in this case and server ip.  At the end instead of the last digits put the point 127.0.0. <br><br>  Further below in the first place we will add the global table add_global_table ('dbname_global'); <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//------------------------------------------------------------------------// //---Global Tables--------------------------------------------------------// //------------------------------------------------------------------------// // Do not include default global tables // Leave off base prefix (eg: wp_) // You don't really have to register these, they will work fine without. // However registering at least your busiest ones might shave a few milliseconds off by avoiding some regexes. // // Usage: add_global_table(TABLE_NAME) // EX: add_global_table('something'); add_global_table('dbname_global'); add_global_table('affiliatedata'); add_global_table('affiliatereferrers'); add_global_table('am_actions'); add_global_table('am_queue'); add_global_table('am_schedule'); add_global_table('autoblog'); add_global_table('bp_activity'); add_global_table('bp_activity_meta'); add_global_table('bp_friends'); add_global_table('bp_groups'); add_global_table('bp_groups_groupmeta'); add_global_table('bp_groups_members'); add_global_table('bp_messages_messages'); add_global_table('bp_messages_notices'); add_global_table('bp_messages_recipients'); add_global_table('bp_notifications'); add_global_table('bp_user_blogs'); add_global_table('bp_user_blogs_blogmeta'); add_global_table('bp_xprofile_data'); add_global_table('bp_xprofile_fields'); add_global_table('bp_xprofile_groups'); add_global_table('domain_mapping');</span></span></code> </pre><br>  After that, it will remain to set the login and password to log into mysql: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//------------------------------------------------------------------------// //---DB Servers-----------------------------------------------------------// //------------------------------------------------------------------------// // Database servers grouped by dataset. // R can be 0 (no reads) or a positive integer indicating the order // in which to attempt communication (all locals, then all remotes) // // Usage: add_db_server(DS, DC, READ, WRITE, HOST, LAN_HOST, NAME, USER, PASS) // EX: add_db_server('global', 'dc1', 1, 1,'global.mysql.example.com:3509','global.mysql.example.lan:3509', 'global-db', 'globaluser', 'globalpassword'); // // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">Note:</span></span></span><span class="hljs-comment"> you can also place this section in a file called db-list.php in wp-content // EX: add_db_server('global', 'dc1', 1, 1,'global.mysql.example.com:3509','global.mysql.example.lan:3509', 'global-db', 'globaluser', 'globalpassword'); add_db_server('global', 'dc1', 1, 1,'localhost','localhost', 'dbname_global', 'root', '1'); add_db_server('0', 'dc1', 1, 1,'localhost','localhost', 'dbname_0', 'root', '1'); add_db_server('1', 'dc1', 1, 1,'localhost','localhost', 'dbname_1', 'root', '1'); add_db_server('2', 'dc1', 1, 1,'localhost','localhost', 'dbname_2', 'root', '1'); add_db_server('3', 'dc1', 1, 1,'localhost','localhost', 'dbname_3', 'root', '1'); add_db_server('4', 'dc1', 1, 1,'localhost','localhost', 'dbname_4', 'root', '1'); add_db_server('5', 'dc1', 1, 1,'localhost','localhost', 'dbname_5', 'root', '1'); add_db_server('6', 'dc1', 1, 1,'localhost','localhost', 'dbname_6', 'root', '1'); add_db_server('7', 'dc1', 1, 1,'localhost','localhost', 'dbname_7', 'root', '1'); add_db_server('8', 'dc1', 1, 1,'localhost','localhost', 'dbname_8', 'root', '1'); add_db_server('9', 'dc1', 1, 1,'localhost','localhost', 'dbname_9', 'root', '1'); add_db_server('a', 'dc1', 1, 1,'localhost','localhost', 'dbname_a', 'root', '1'); add_db_server('b', 'dc1', 1, 1,'localhost','localhost', 'dbname_b', 'root', '1'); add_db_server('c', 'dc1', 1, 1,'localhost','localhost', 'dbname_c', 'root', '1'); add_db_server('d', 'dc1', 1, 1,'localhost','localhost', 'dbname_d', 'root', '1'); add_db_server('e', 'dc1', 1, 1,'localhost','localhost', 'dbname_e', 'root', '1'); add_db_server('f', 'dc1', 1, 1,'localhost','localhost', 'dbname_f', 'root', '1');</span></span></code> </pre><br>  login root, password 1. Also here you need to specify these names that we registered at the beginning: dbname_0, dbname_1 ... <br><br><h4>  Configuring move-blogs.php </h4><br>  This is the most important part.  It also forms the output of various errors. <br><br><pre> <code class="php hljs">$dbname = <span class="hljs-string"><span class="hljs-string">"multi"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//This is your current database $blog_table_prefix = 'wp_'; //Prefix of your wpmu blog tables, most likely this won't need to be changed $newdb_prefix = 'dbname_'; //This is the prefix of the db's you're moving your tables into - we assume they are all the same, if not, you're in trouble //We need info to connect to the databases $dbhost = 'localhost'; $dbuname = 'root'; $dbpass = '1'; //How many db's are you moving into (16, 256, or 4096)? $db_scaling = '16';</span></span></code> </pre><br>  $ dbname = "multi";  // multi is the name of my shared database that I want to split into pieces, I need to write without a prefix <br><br>  $ blog_table_prefix = 'wp_';  // this is a prefix in the common database <br><br>  $ newdb_prefix = 'dbname_';  //new name <br><br>  Login, server and password, as well as the number of databases. <br><br>  $ dbhost = 'localhost'; <br>  $ dbuname = 'root'; <br>  $ dbpass = '1'; <br>  $ db_scaling = '16'; <br><br>  Now it‚Äôs worth going to: <a href="http://localhost/wp-content/scripts/move-blogs.php">localhost / wp-content / scripts / move-blogs.php</a> <br><br><img src="https://habrastorage.org/files/bec/3ba/9f3/bec3ba9f388b48e5a726153956abd8d9.png" alt="image"><br><br>  <u>Click Click here</u> . <br><br>  We are waiting for the process to end, the link in the address bar should change.  After that click <u>clicking here</u> to update the page.  Status updated. <br><br><img src="https://habrastorage.org/files/b30/134/1dc/b301341dc2d643e1b6da4d645ee7cc13.png" alt="image"><br><br>  Now you can see that one global database has been created, which contains wp_users, etc. <br><br><img src="https://habrastorage.org/files/14b/b2a/bbe/14bb2abbee0f43cf88f069ad7c8a54f4.png" alt="image"><br><br>  The other two sites besides the main one scattered around other databases in a random order, for example, the second site got into dbname_c, and the third got into dbname_e. <br><br><img src="https://habrastorage.org/files/f62/663/eb9/f62663eb9c704a77b85cbad8acf75a8e.png" alt="image"><br><img src="https://habrastorage.org/files/188/1e0/04f/1881e004f457481d981493e0df4697ed.png" alt="image"><br><br>  Now you need to check what happened.  You can try, for example, write a post to several sites and check where they will be displayed.  And indeed, in the new and global entries appear. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a0d/7cf/a9c/a0d7cfa9ce9f2212e9a1729924a20824.png" alt="image"><br><img src="https://habrastorage.org/files/e3c/53a/205/e3c53a205e314836afb71e3dc2e7c593.png" alt="image"><br><br>  Nothing is added to the old multi.  Then, probably, that's all.  So far, these are only the first opinions about this system; it is still early to draw conclusions. <br><br><h4>  Nuances of multisite </h4><br>  The first is the inability to define roles for new registered participants.  But for this <a href="https://wordpress.org/plugins/multisite-user-management/">there is a plugin</a> .  In addition, let us imagine a situation, you have two sites - site 1 (main) and site 2. A person registers on site 2 and he can now enter and be displayed on site 1, but you don‚Äôt see it from site console 1, despite that he is.  You can see it either in the general network or on site 2, from which it made the registration. <br><br><h5>  Registration Redirect </h5><br>  If you want to register via wp-login, wp-admin, wp-register from site 2, then you will be transferred to site 1. As the multisite developers say, this is logical, since the account is created one for the entire network.  But it can be inconvenient and not at all what you need.  WooCommerce with its My Account page and shortcode [woocommerce_my_account] helps with normal registration, you can also use Login With Ajax. <br><br><h4>  More on topic </h4><br>  Ps It turns out you can easily and combine styles / scripts in plug-ins and include only on certain pages.  Multi-db laid out on githaba, did not immediately see. <br><br>  <a href="https://premium.wpmudev.org/forums/topic/multi-db-plugin-conlict-with-woocomerce">premium.wpmudev.org/forums/topic/multi-db-plugin-conlict-with-woocomerce</a> <br>  <a href="https://premium.wpmudev.org/forums/topic/db-error-could-not-list-tables-1">premium.wpmudev.org/forums/topic/db-error-could-not-list-tables-1</a> <br>  <a href="https://github.com/wpmudev/multi-db">github.com/wpmudev/multi-db</a> <br>  <a href="https://premium.wpmudev.org/forums/topic/re-multi-db-plugin">premium.wpmudev.org/forums/topic/re-multi-db-plugin</a> <br><br>  <a href="http://maxtop.org/wordpress-otklyuchenie-skriptov/">maxtop.org/wordpress-otklyuchenie-skriptov</a> <br>  <a href="http://maxtop.org/wordpress-obedinenie-css-fajlov-stilej-otklyuchenie-zagruzki-lishnix-css-fajlov/">maxtop.org/wordpress-obedinenie-css-fajlov-stilej-otklyuchenie-zagruzki-lishnix-css-fajlov</a> <br><br>  <a href="http://bavatuesdays.com/wpmu-multi-db-tutorial/">bavatuesdays.com/wpmu-multi-db-tutorial</a> <br>  <a href="http://www.inmotionhosting.com/support/website/wordpress/heartbeat-ajax-php-usage">www.inmotionhosting.com/support/website/wordpress/heartbeat-ajax-php-usage</a> <br><br><h4>  Answers on questions </h4><br>  Maybe someone else will have questions the same. <br><blockquote>  By consumption is meant the consumption of space?  Why only 50%? </blockquote><br>  In the literal sense of consumption of plug-ins.  Suppose you have one site that uses 20-30 plug-ins. <br><br>  With multisite, you divide it into 2 pieces.  Thus, each of its parts uses 10-15 plug-ins separately.  For example: <br><br>  site.ru is a bulletin board or catalog <br>  site.ru / shop / or shop.sayt.ru is a shop inside the site. <br><br>  site.ru uses some 10-15 plugins <br>  site.ru / shop / uses other 10-15 plugins <br><br>  At the same time, you do not need to worry about users and about the admin panel, since you manage these sites through the same admin panel and users are also shared. <br><blockquote>  (16, 256, 4096) Brad. </blockquote><br>  This is a valid number of databases in the plugin.  If you have a million sites in the multisite network - then they will be filled evenly across these databases, in this case it would be better to choose 4096 of course. For this, read the wp-forums.  I have not tested a million sites. <br><br>  But without this plugin, all these million sites will be contained in one single database. <br><blockquote>  define ('DB_SCALING', '16');  - And if then there will be 32 bases, then everything will go?  :) </blockquote><br>  The answer is above.  You need to initially figure out how much you need them depending on the number of sites.  Using multi-db is a step in optimizing the database for those who already have a lot of sites in multisite mode. <br><blockquote>  Saved on css / js, and took the cut base.  I do not see the logic.  :) </blockquote><br>  In order to save js / css to cut the base - there is no logic.  The base slice is the second stage after js / css optimization.  He has no relation to them. <br><br>  When there are a lot of plug-ins on the site (considering that there is a lot of them in the site itself, there is a lot of template) then the question arises of how to differentiate all of this for different parts of the site.  A large number of them acts badly on the admin panel, it begins to slow down. <br><br>  Multisite and without a cut in the base solves the question of the plugins themselves so that there are fewer of them on each site or piece of the site. <br><br><h4>  More good way </h4><br>  Since the multi-db plugin itself is written off and is not supported - there is still another, the best solution and convenient - this is <a href="https://wordpress.org/plugins/shardb/installation/">SharDB</a> <br><br>  Working with him is much easier than multi-db.  And after a more thorough check, I discovered that multi-db is buggy with some plugins, and this shar-db does not cause any problems with them. <br><br>  First you need to unpack the <b>db-settings.php</b> file to the root of the site so that wp-config.php is at the same level with it and connect it to it <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/*  ,   . ! */</span></span> ... ... ... ... ... ... <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>(<span class="hljs-string"><span class="hljs-string">'db-settings.php'</span></span>);</code> </pre><br><br>  <b>Its settings</b> <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// If you have multiple datacenters you can come up with your own datacenter // detection logic (php_uname?). This helps ensure the web servers try to // connect to the nearest database servers first, then distant ones. define( 'DATACENTER', '' ); function add_slave($read, $host, $lhost = '', $user = DB_USER, $password = DB_PASSWORD) { global $slaves; $slaves[] = compact('read', 'host', 'lhost', 'user', 'password'); } /* Add your configuration here */ // how many characters of hexidecimal hash $shardb_hash_length = 2; // what is the prefix of your blog database shards (everything before the hexidecimal hash) //    $shardb_prefix = 'set'; // set a string to be used as an internal identifier for the dataset $shardb_dataset = 'abc'; // do you want to put your primary blog (blog_id 1) in its own 'home' database? $enable_home_db = true; // how many, if any, VIP databases do you have? $num_vipdbs = 5; // add this to set the write master read priority (default 1) $shardb_master_read = 99; // add this if all of your databases are on a local server //  ,         $shardb_local_db = true; // use this function to add a read slave host add_slave($read_priority, $hostname, $local_hostname, $user, $password); // instructions for adding vip blogs at the bottom of this confg filei /* That's all, stop editing! Happy blogging. */</span></span></code> </pre><br>  <b>set</b> is the name of the database containing all sites. <br><br>  Next, copy the file shardb-admin.php to the folder with plugins, as usual, activate this plugin for the network. <br><br>  Then in the admin go to the settings of the plugin.  Network Management ---&gt; Settings ---&gt; SharDB Migration. <br><img src="https://habrastorage.org/files/ce2/105/35e/ce210535e2484f6eae86f1409aa73d7f.png" alt="image"><br><br>  And here the first step is Migrate Global Tables.  He will offer to write it in a separate table - in setglobal <br><br><img src="https://habrastorage.org/getpro/habr/post_images/223/95e/f4d/22395ef4db3980a9c9f4eb99f6f14c6f.png" alt="image"><br><br>  Next, the first site <br><br><img src="https://habrastorage.org/files/d31/521/b4d/d31521b4d98d4a6ca64bb0654991e24f.png" alt="image"><br><br>  If the base was called ‚Äúset‚Äù, then it offers to move it to sethome <br><br><img src="https://habrastorage.org/files/51a/9eb/9fb/51a9eb9fbe2d48f3bb8716ac8d779c9c.png" alt="image"><br><br>  Everything is copied normally, you can copy further all sites, "Migrate Sites" <br><br><img src="https://habrastorage.org/files/f32/1db/b87/f321dbb8776945bab74ebb0708be3a4f.png" alt="image"><br><br>  And so on ... the numbering of sites and theirs tables are displayed on the screen.  The names of the tables in which the plugin wants to write are also visible. <br><br><img src="https://habrastorage.org/files/b6b/285/0f8/b6b2850f846b4dbdb9e0160d1ce2883a.png" alt="image"><br><br>  After everything is in place, you need to unpack the <b>db.php</b> file in the <b>wp-content</b> folder <br><br>  Now, in the admin panel, you can see the status of those sites that I, for example, have not copied, and the desired tables with new names for each of them are visible there. <br><br><img src="https://habrastorage.org/files/c6c/3c7/f3c/c6c3c7f3cc544ff2a5510f02a3cfe663.png" alt="image"><br><br>  Connection failed - this message displays db.php.  If this file is in your wp-content, by default it tries to connect to different databases separately, and not to one common one.  If you move all other sites on the same principle - they will also work. <br><br>  To copy the databases, you should not have the db.php file, otherwise the settings item in the admin panel (SharDB Migration) will not be available, after copying, you need to load it last.  It serves as a simple link. <br><br>  When creating a new subsite, you need to delete it for this time or rename the db.php file and then optionally separate it into another database using the same method. <br><br>  This measure may not matter to you if you have a few sites.  But the base of the engine itself tends to become clogged over time, and slow down the response from the site.  If this happens for one site and one base, then having multisite mode it will be tenfold + in size since all these site tables will be in one place. <br><br>  This is another possibility of the engine which in some cases can be used. </div><p>Source: <a href="https://habr.com/ru/post/306992/">https://habr.com/ru/post/306992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306978/index.html">PipelineDB: working with data streams</a></li>
<li><a href="../306982/index.html">New edition of the popular free textbook of electronics, computer architecture and low-level programming</a></li>
<li><a href="../306984/index.html">What happened when I freed my house from unnecessary things</a></li>
<li><a href="../306988/index.html">Recommendations for the promotion of the project in the US</a></li>
<li><a href="../306990/index.html">AWS Server-less API in 15 minutes</a></li>
<li><a href="../306996/index.html">Conditional dependency injection in ASP.NET Core. Part 1</a></li>
<li><a href="../306998/index.html">15 Things You Should Know About Ansible</a></li>
<li><a href="../307002/index.html">From registration to showcase: how to put a mobile app in the App Store and Google Play (part 2)</a></li>
<li><a href="../307004/index.html">Mathematics for artificial neural networks for beginners, part 1 - linear regression</a></li>
<li><a href="../307006/index.html">OneBox opened an official office in Kiev</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>