<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Awesomium for C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Awesomium is a library for integrating a Chromium-based browser into your application. The beauty of Awesomium is that it can be integrated into almos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Awesomium for C ++</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/010/9f9/8b8/0109f98b8b35e5bcab1f0743b248a45f.png" align="left">  <b>Awesomium</b> is a library for integrating a Chromium-based browser into your application.  The beauty of Awesomium is that it can be integrated into almost any type of application (there are examples of integration into 3D games based on Unity3D), it has a wide range of features for the developer and, frankly, it's just a pleasure to work with it. <br><br>  But, unfortunately, the library has rather modest documentation, there are practically no examples and communities (this applies to C ++ development, and more to the dotnetchikam).  I had to collect some moments bit by bit from various sources, while others came to understanding after a series of trial and error. <br><br>  And having accumulated some knowledge, I decided to share them.  I am sure that I am not the first and not the last who will pass this way. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>I just want to warn you: maybe in some places I misunderstood or misunderstood, you should not judge strictly, just point the correct way, I will be very grateful.</i> <br><br><h4>  Window and windowless awesomium </h4><br><br>  First of all, it should be said that applications using Awesomium can be of 2 types: <br><br><ul><li>  <b>Offscreen</b> - without displaying the browser window (the entire rendering and scripts operation on the page occurs in the background and is not displayed to the user) or with the display of the browser, but the programmer is engaged in drawing and processing messages </li><li>  <b>Windowed</b> - Awesomium ‚Äúclings‚Äù to some window and is displayed on it.  Drawing, processing of mouse and keyboard messages is carried out by means of the library </li></ul><br><br>  The first is interesting because it allows you to work with a browser without a window.  You can even work with a console application, for example, to create screenshots of pages.  We will not dwell on this type, because there are good examples on it and I actually did not work with it.  I was interested in the second mode - Windowed. <br><br>  Windowed Awesomium is used when you need a full browser in a windowed application.  In this case, the library will take care of the main thing - user interaction.  But do not think that adding a couple of lines in the program you get a full browser, it is not.  The lion's part of the work lies on the programmers' shoulders, for example: file upload / upload dialogs (yes, all dialogs in principle), pop-up menus, drop-down lists, the creation of new tabs, etc. <br><br><h4>  Library structure </h4><br><br>  The structure of the library is very simple (although at first it was not at all obvious): <br><br>  The core of the browser is the core ( <b>WebCore</b> ).  Each application can have only one core and this in turn imposes some restrictions.  For example, if you want a tab to be canceled by other User Agents, then you will not succeed, because the User Agent value is stored in the kernel settings. <br><br>  Next in the hierarchy is <b>WebView</b> - this is a browser window.  When creating each WebView, a separate Chromium process is launched.  When you no longer need WebView - do not forget to clean it up, otherwise the process will hang until we destroy WebCore. <br><br>  Each WebView can use a session ( <b>WebSession</b> ).  Session is user data (cookies, caches, certificates, local databases, etc.).  One WebSession can be connected to different WebView.  Also in the WebSession are stored important settings for browsers (those that use this session), such as a proxy. <br><br>  Well, the last thing (from what I had to work with) is Listeners - interfaces for interacting with the browser.  Listeners are several and each of them solves certain problems.  For example, WebViewListener :: Dialog contains implementation of methods for working with dialog boxes, and WebViewListener :: Download contains methods for informing about the progress of file downloads. <br><br><h4>  Birth </h4><br><br>  With the theory of done, go to the practice.  First of all, let's consider the process of creating and initializing the kernel and browser tabs in Windowed mode. <br><br>  First you need to initialize the kernel: <br><pre><code class="hljs lua">WebCore* core = <span class="hljs-number"><span class="hljs-number">0</span></span>; WebConfig <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>; core = WebCore::Initialize(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>);</code> </pre> <br><br>  Next, create a session (and for the example, in the session settings, write the proxy used) <br><pre> <code class="hljs pgsql">WebPreferences prefs; prefs.proxy_config = WSLit("198.1.99.26:3128"); WebSession * <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> = core-&gt;CreateWebSession(WSLit(""), prefs);</code> </pre><br><br>  And of course, create a WebView object. <br><pre> <code class="hljs pgsql">WebView* <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> = core-&gt;CreateWebView(WIN_WIDTH, WIN_HEIGHT, <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>, kWebViewType_Window); <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>-&gt;set_parent_window(hwnd);</code> </pre><br><br>  At the last step we will dwell in more detail: <br><br><ul><li>  First of all, it is worth noting that it is necessary to specify the initial width and height of the browser window.  You can later change them (for example, when you resize the parent window) </li><li>  The third parameter is the session.  The session during the work of the tab can not be changed, but access to it remains, so theoretically (I did not check), you can change the settings and they will take effect </li><li>  The last parameter of the browser tab creation method is WebViewType.  It can be either kWebViewType_Offscreen (the default) or kWebViewType_Window.  We specify the second, since we create an ok browser </li><li>  An obligatory step after creating a WebView with type kWebViewType_Window is the handle of the parent window.  Handle does not have to have windows of the same process in which Awesomium is used, I have it, for example, a handle panel in the Delphi program and everything works fine </li></ul><br><br><h4>  A life </h4><br><br>  Depending on the purpose for which Awesomium is used - its ‚Äúlife‚Äù may differ significantly.  I will only focus on the main points when working with the Windowed tabs. <br><br>  First, despite the fact that Windowed Awesomium partially lives its life, it is still necessary to periodically push it to work.  The kernel <b>Update</b> method is <b>pushing</b> .  It is recommended to call it in a timer, like this: <br><br><pre> <code class="hljs haskell">// <span class="hljs-type"><span class="hljs-type">Create</span></span> our <span class="hljs-type"><span class="hljs-type">WebCore</span></span> <span class="hljs-type"><span class="hljs-type">Update</span></span> timer, renders at a max <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span> <span class="hljs-type"><span class="hljs-type">FPS</span></span> <span class="hljs-type"><span class="hljs-type">UINT</span></span> myTimer = <span class="hljs-type"><span class="hljs-type">SetTimer</span></span> ( hwnd, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-type"><span class="hljs-type">NULL</span></span> ); ... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">WM_TIMER</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (core) { core-&gt;<span class="hljs-type"><span class="hljs-type">Update</span></span>(); } } ...</code> </pre> <br><br>  It is also recommended to do kernel updates after destroying WebView. <br><br>  Secondly, if you want the browser window to change its size along with the parent window, you must process the WM_SIZE message of the parent window and report the new sizes to the browser.  This is done quite simply: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> WM_SIZE: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>) { <span class="hljs-type"><span class="hljs-type">int</span></span> nWidth = LOWORD(lParam); //    <span class="hljs-type"><span class="hljs-type">int</span></span> nHeight = HIWORD(lParam); //    <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>-&gt;Resize(nWidth, nHeight); } }</code> </pre> <br><br>  And thirdly, for the full operation of the browser, you need to implement the Listeners interfaces and connect them to each of the WebView.  There should be no problems with the implementation of interfaces, they are well documented.  All necessary hints can be found in the <b>WebViewListener.h</b> file.  Well, it's not difficult to connect them: <br><br><pre> <code class="hljs pgsql">DialogListener * dialog_lis = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> DialogListener(); <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>-&gt;set_dialog_listener(dialog_lis);</code> </pre> <br><br>  As I said before, when working in Windowed mode, the library will worry about a lot of things: drawing the loaded page on the parent window, handling keyboard and mouse keystrokes, changing mouse cursors, etc. <br><br>  Well, at the end of this chapter is a small example of opening the page and waiting for it to load: <br><br><pre> <code class="hljs pgsql">//   <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>-&gt;LoadURL(WebURL(WSLit("http://google.com/"))); //    <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>-&gt;IsLoading()) { Sleep(<span class="hljs-number"><span class="hljs-number">50</span></span>); core-&gt;<span class="hljs-keyword"><span class="hljs-keyword">Update</span></span>(); } //   (     ) <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>-&gt;Focus();</code> </pre><br><br><h4>  Death </h4><br><br>  With the cleaning after work, the greatest problems arose.  Information about this in the official documentation and on Google for work in Windowed mode is slightly more than zero.  Through trial and error, I came to the following: <br><br>  1. Before destroying WebView, you first need to destroy the parent window (the reverse order will cause the application to crash). <br><br>  2. If you want the session data to be saved (if it is not an in-memmory session), you need to call the <b>Release</b> method for the session instance. <br><br>  3. WebView is destroyed by calling the <b>Destroy</b> method (and nothing else) <br><br>  4. The kernel is destroyed by calling the <b>Shutdown</b> method, which by the way is able to clean up and behind the incorrectly destroyed WebView (but it‚Äôs better still to control the process itself) <br><br>  Approximately, it looks like this: <br><br><pre> <code class="hljs erlang-repl">// -     ... //    (     ,      ,    ) view-&gt;Stop(); //      view-&gt;session()-&gt;Release(); //  WebView (    Chromium       ) view-&gt;Destroy(); //   (      ,      ) core-&gt;Update(); //   core-&gt;Shutdown();</code> </pre><br><br>  It is necessary to destroy the kernel only before shutting down the program.  If you just need to close one browser tab, then you only need to delete it and WebView, which was located on this tab. <br><br><h4>  useful links </h4><br><br>  When studying Awesomium, the comments in the header files in the <u>\ Awesomium SDK \ 1.7.1.0 \ include \ Awesomium \</u> and the following Internet pages helped me a lot. <br><br>  - <a href="http://wiki.awesomium.com/general-use/">wiki.awesomium.com/general-use</a> - modest examples of use from the creators of Awesomium.  There is also a description of how to create a project using this library and which files are necessary for the application to work. <br><br>  - <a href="http://awesomium.com/docs/1_7_0/cpp_api/index.html">awesomium.com/docs/1_7_0/cpp_api/index.html#intro_sec</a> - official documentation (essentially duplicates the comments in the connected header files) <br><br>  - <a href="https://gist.github.com/khrona">gist.github.com/khrona</a> - the work of the user khrona on github.  He helped me a lot to create the first test application, in particular this example of <a href="https://gist.github.com/khrona/1093798">Example of using Awesomium r148 API with GDI / WinForms / WinAPI</a> .  True, he is trying to do in Offscreen mode a similarity to the Windowed mode, because of which he has scanty functionality (for example, the scrolling does not work and the mouse cursor does not change when hovering over the link), as well as a lot of excess when. <br><br>  - <a href="http://answers.awesomium.com/index.html">answers.awesomium.com/index.html</a> - answers to users' questions.  Unfortunately, not all questions get answers, so there is not very much useful information, but it is </div><p>Source: <a href="https://habr.com/ru/post/183826/">https://habr.com/ru/post/183826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../183814/index.html">Oracle fixes 40 vulnerabilities in java</a></li>
<li><a href="../183816/index.html">Intel + STMicroelectronics. Space Sight Deal</a></li>
<li><a href="../183818/index.html">TypeScript 0.9 released</a></li>
<li><a href="../183820/index.html">Habrakamp # 7 about freelance and freelancers</a></li>
<li><a href="../183824/index.html">GitRec: Personal GitHub Recommendations</a></li>
<li><a href="../183828/index.html">How we created a cloud PBX Sipuni.com</a></li>
<li><a href="../183830/index.html">Argument numbering of the variadic template, or what the modest pair hides</a></li>
<li><a href="../183832/index.html">NETMAP (by Luigi Rizzo). Simple and convenient opensource framework for processing traffic at speeds of 10Gbit / s or 14 Mpps</a></li>
<li><a href="../183834/index.html">Cache in multiprocessor systems. Cache coherence MESI protocol</a></li>
<li><a href="../183836/index.html">Integration of mobile application design. Part 1: Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>