<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About C language and performance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If a programmer is familiar only with high-level languages, such as PHP, then it is not so easy for him to master some ideas typical of low-level lang...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About C language and performance</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/cb5/a2b/007/cb5a2b00719a45b784986117015c9079.jpg"><br><br>  If a programmer is familiar only with high-level languages, such as PHP, then it is not so easy for him to master some ideas typical of low-level languages ‚Äã‚Äãand critical for understanding the capabilities of information and computing processes.  For the most part, the reason is that in low and high level languages ‚Äã‚Äãwe solve different problems. <br><br>  But how can you consider yourself a professional in any (high-level) language, if you don‚Äôt even know how a processor works, how it performs calculations, in an effective way?  Today, automatic memory management is becoming a major problem in most high-level languages, and many programmers approach it without a sufficient theoretical basis.  I am sure that knowledge of low-level processes helps a lot in developing effective high-level programs. <br><a name="habracut"></a><br>  The programs of many school programming courses still begin with mastering the basics of assembler and C. This is extremely important for future programmers who will find this knowledge very useful in their future career.  High-level languages ‚Äã‚Äãare constantly and strongly changing, and the intensity and frequency of changes in low-level languages ‚Äã‚Äãis an order of magnitude lower. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I believe that in the future there will be a lot of applications for low-level programming.  Since everything starts with the basics, the need for the people who create these bases will not disappear, so that others can build new levels on them, as a result creating whole, useful and effective products. <br><br>  Do you really think that the Internet of things will be developed in high-level languages?  And what about future video codecs?  VR apps?  Network?  Operating Systems?  Games?  Car systems like auto pilots, collision warning systems?  All this, like many other products, is written in low-level languages ‚Äã‚Äãlike C or immediately in assembly language. <br><br>  You can observe the development of ‚Äúnew‚Äù architectures, for example, very interesting ARM processors, which cost 98% of smartphones.  If today you use Java to create Android applications, it is only because Android itself is written in Java and C ++.  And the Java language - like 80% of modern high-level languages ‚Äã‚Äã- is written in C (or C ++). <br><br>  Language C intersects with some related languages.  But they use the imperative paradigm, and therefore are not very common or less developed.  For example, Fortran, belonging to the same ‚Äúage group‚Äù as C, is more productive in some specific tasks.  A number of specialized languages ‚Äã‚Äãcan be faster than C when solving purely mathematical problems.  But still, C remains one of the most popular, universal, and effective low-level languages ‚Äã‚Äãin the world. <br><br><h3>  Let's get started </h3><br>  For this article, I will use a machine with an X86_64 processor running Linux.  We will look at a very simple C program that sums up 1 billion bytes from a file in less than 0.5 seconds.  Try doing this in any of the high-level languages ‚Äã‚Äã‚Äî you won't get close to C in performance. Even in Java, using JIT, with parallel computing and a good model of memory usage in user space.  If programming languages ‚Äã‚Äãdo not refer directly to machine instructions, but are some kind of intermediate form (definition of high-level languages), then they will not be compared in performance with C (even with the help of JIT).  In some areas, the gap can be reduced, but in general C leaves rivals far behind. <br><br>  First, we will analyze the task in detail using C, then consider the instructions X86_64 and optimize the program using SIMD, a type of instruction in modern processors that allows processing large amounts of data in one instruction in several cycles (several nanoseconds). <br><br><h1>  Simple C program </h1><br>  To demonstrate the capabilities of the language, I will give a simple example: open the file, read all the bytes from it, summarize them, and compress the resulting amount into one unsigned byte (that is, overflow several times).  And that's all.  Oh yeah, and we will try to do all this as efficiently as possible - faster. <br><br>  Go: <br><br><pre><code class="cpp">#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;
#include &lt;string.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;unistd.h&gt;

#define BUF_SIZE 1024

int main(int argc, char **argv)
{
    int f, i;
    ssize_t readed;

    unsigned char result = 0;
    unsigned char buf[BUF_SIZE] = {0};

    if (argc != 2) {
        fprintf(stderr, ": %s \n", argv[0]);
        exit(-1);
    }

    f = open(argv[1], O_RDONLY);

    if (f == -1) {
        perror("   ");
    }

    while ((readed = read(f, buf, sizeof(buf))) &gt; 0) {
        for (i=0; i &lt; readed; i++) {
            result += buf[i];
        }
    }

    close(f);

    printf(" ,   %u \n", result);

    return 0;
}</code></pre><br>
      1 .       ,   <code>dd</code>:<br>
<br>
<pre><code class="bash">&gt; dd if=/dev/urandom of=/tmp/test count=1 bs=1G iflag=fullblock</code></pre><br>
      (  file_sum)   :<br>
<br>
<pre><code class="bash">&gt; file_sum /tmp/file
Read finished, sum is 186</code></pre><br>
     .     :<br>
<br>
<ul>
<li>  CPU     (   ).</li>
<li>    (kernel).</li>
</ul><br>
:         ,     .<br>
<br>
<h1>  </h1><br>
       .  ,         ,     .   ,    2016 ,         ().    ,         .      (  , , ,    ),    <a href="https://filippo.io/linux-syscall-table/"> </a>       .   ‚Äî   ,   .     ,      ,    ,  ,          .        .         ,      ¬´ ¬ª ‚Äî  ,  .<br>
<br>
 ?     <a href="http://jpauli.github.io/2015/04/16/segmentation-fault.html"> </a>.  ,       ,          .   .       <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BB%25D1%258C%25D1%2586%25D0%25B0_%25D0%25B7%25D0%25B0%25D1%2589%25D0%25B8%25D1%2582%25D1%258B">   </a>.             (hardware mapped memory).        ,            .          (Exception code).             -  (, SIGBUS).<br>
<br>
   ‚Äî     .      .   ,     CS-   X86-:<br>
<br>
<pre><code class="bash">gdb my_file
(gdb) p /t $cs
$1 = 110011</code></pre><br>
   ()     .    ‚Äî .<br>
<br>
       ,  ,       ( ).        .   ,    ,     .         .<br>
<br>
   .        ,     ,      .    <code>open()/read()</code>  <code>close()</code>.       libC (<code>fopen()</code>, <code>fread()</code>, <code>fclose()</code>),   ,       .     ,     :    ,            . LibC ‚Äî  <a href="https://sourceware.org/git/%3Fp%3Dglibc.git%3Ba%3Dtree%3Bhb%3DHEAD">    </a> (      ),     ¬´-¬ª  ,    ,       read().      ,       .<br>
<br>
        <code>read()</code>  ,     /.        Linux-,  <a href="http://www.brendangregg.com/perf.html">perf</a>.     ,     <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B5%25D1%2580%25D0%25B5%25D0%25BA%25D0%25BB%25D1%258E%25D1%2587%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25BA%25D0%25BE%25D0%25BD%25D1%2582%25D0%25B5%25D0%25BA%25D1%2581%25D1%2582%25D0%25B0"> </a> ‚Äî       .   ,        .     !     ‚Äî <code>read()</code>.   ,         CPU      /.   ,      .       <a href="http://man7.org/linux/man-pages/man2/open.2.html">,   open()</a>.<br>
<br>
   ,   <a href="http://www.tldp.org/LDP/sag/html/buffer-cache.html"> </a>,           .  ,        ,         ,       /,    .          , ,      .      . <br>
<br>
<h1>     </h1><br>
,  ,          : <code>open()</code>, <code>read()</code>  <code>close()</code>.       .  ,    SSD-,        ,       .<br>
<br>
   ?<br>
<br>
  .  ,       .   :  ,      .<br>
    ,  ,   :<br>
<br>
<pre><code class="bash">&gt; gcc -Wall -g -O0 -o file_sum file_sum.c</code></pre><br>
<br>
     <code>time</code>:<br>
<br>
<pre><code class="bash">&gt; time ./file_sum /tmp/big_1Gb_file
Read finished, sum is 186 

real    0m3.191s
user    0m2.924s
sys     0m0.264s</code></pre><br>
    ,     .          SSD  3,1 .   ‚Äî Intel Core i5-3337U @ 1,80 ,  ‚Äî Linux 3.16.0-4-amd64.  ,   X86_64-.     GCC 4.9.2.<br>
<br>
  <code>time</code>,    (90 %)     . ,   -    , ‚Äî     .   :  ,   .  , ?<br>
<br>
 :      .  ,       <code>read()</code> 1024*1024 = 1 048 576 .    ,    ?  1 ,      1024 .  , ,   , :<br>
<br>
<pre><code class="bash">#define BUF_SIZE 1024*1024
.
&gt; gcc -Wall -g -O0 -o file_sum file_sum.c
&gt; time ./file_sum /tmp/big_1Gb_file
Read finished, sum is 186 

real    0m3.340s
user    0m3.156s
sys     0m0.180s</code></pre><br>
,    264  180 .     :   <code>read()</code>   ,     .  ,       Linux-   8  ( ).<br>
<br>
     . ,    ,    /   /  /   .<br>
<br>
<h1>,  (    )</h1><br>
     ?   ,         .     ,    .<br>
<br>
  ‚Äî   .        .    -    ,  .              ,               .    1972    .<br>
<br>
 ,     ‚Äî  .           .        ,    ,   Fortran‚Äô.<br>
<br>
   ,       <i> </i>.           -.<br>
<br>
  .    ,          X86 ( 2016  ‚Äî X86_64).<br>
<br>
  X86_64    .      .        ( <a href="https://en.wikipedia.org/wiki/Freescale_68HC11">Freescale 68HC11</a>),     .   X86_64   .       ,  :   .   PDF   ,       . <br>
<br>
,  , <a href="https://software.intel.com/en-us/articles/intel-sdm"> Intel  X86_64</a>.  .           .   ,       -  PHP?<br>
<br>
 ,           .    80/20 ‚Äî 80 %      20 %   .<br>
<br>
 -   ,    (   while()),      GCC 4.9.2:<br>
<br>
<pre><code class="cpp">#define BUF_SIZE 1024

int main(int argc, char **argv)
{
    int f, i;
    ssize_t readed;

    unsigned char result = 0;
    unsigned char buf[BUF_SIZE] = {0};

    if (argc != 2) {
        fprintf(stderr, ": %s \n", argv[0]);
        exit(-1);
    }

    f = open(argv[1], O_RDONLY);

    if (f == -1) {
        perror("   ");
    }

    while ((readed = read(f, buf, sizeof(buf))) &gt; 0) {
        for (i=0; i &lt; readed; i++) {
            result += buf[i];
        }
    }

    close(f);

    printf(" ,   %u \n", result);

    return 0;
}

00400afc:   jmp 0x400b26 &lt; main+198&gt;
00400afe:   movl $0x0,-0x4(%rbp)
00400b05:   jmp 0x400b1b &lt; main+187&gt;
00400b07:   mov -0x4(%rbp),%eax
00400b0a:   cltq 
00400b0c:   movzbl -0x420(%rbp,%rax,1),%eax
00400b14:   add %al,-0x5(%rbp)
00400b17:   addl $0x1,-0x4(%rbp)
00400b1b:   mov -0x4(%rbp),%eax
00400b1e:   cltq 
00400b20:   cmp -0x18(%rbp),%rax
00400b24:   jl 0x400b07 &lt; main+167&gt;
00400b26:   lea -0x420(%rbp),%rcx
00400b2d:   mov -0xc(%rbp),%eax
00400b30:   mov $0x400,%edx
00400b35:   mov %rcx,%rsi
00400b38:   mov %eax,%edi
00400b3a:   callq 0x4005d0 &lt; read@plt&gt;
00400b3f:   mov %rax,-0x18(%rbp)
00400b43:   cmpq $0x0,-0x18(%rbp)
00400b48:   jg 0x400afe &lt; main+158&gt;
00400b4a:   mov -0xc(%rbp),%eax
00400b4d:   mov %eax,%edi
00400b4f:   callq 0x4005c0 &lt; close@plt&gt;</code></pre><br>
,   ?  ,          X86_64     .<br>
<br>
<h3>   X86_64</h3><br>
    ,       <a href="http://www.cs.virginia.edu/~evans/cs216/guides/x86.html"></a>, <a href="https://www.lri.fr/~filliatr/ens/compil/x86-64.pdf"></a>  <a href="http://www.agner.org/optimize/calling_conventions.pdf"></a>.<br>
<br>
      2  16.<br>
<br>
<ul>
<li>       ,    .</li>
<li>      (): LEA ‚Äî MOV ‚Äî JMP   .    X86_64    .</li>
<li>X86_64 ‚Äî  <a href="https://ru.wikipedia.org/wiki/CISC">CISC</a>-.           ,           (clock cycles) (1  != 1 ).</li>
<li>     0, 1, 2  3 .   1  2.</li>
<li>    : AT&amp;T (  GAS)  Intel. <br>
<ul>
<li> AT&amp;T   INSTR SRC DEST.</li>
<li> Intel   INSTR DEST SRC.</li>
<li>    .    ,           .    ,  .</li>
<li>  AT&amp;T, -  Intel.   X86   AT&amp;T    GDB. <a href="https://en.wikibooks.org/wiki/X86_Assembly/GAS_Syntax">   AT&amp;T</a>. </li>
</ul> </li>
<li> X86_64         (little-endian),        .   .</li>
<li> X86_64    ¬´-¬ª.      - .</li>
<li>$     (, $1 ‚Äî   '1').</li>
<li>%     (%eax ‚Äî    EAX).</li>
<li>  ‚Äî   ,      ( (%eax)     ,      EAX).</li>
</ul><br>
<h3></h3><br>
 ‚Äî        .    !     RAM.      <a href="https://people.eecs.berkeley.edu/~rcs/research/interactive_latency.html">  100 </a> (    ),     ‚Äî  0 .      ‚Äî   ,     :<br>
<br>
<ul>
<li>      :   ¬´¬ª .</li>
<li>   - (,     3).</li>
<li>      .</li>
<li> ,            .</li>
</ul><br>
 ,   X86_64    ¬´-¬ª:      . <br>
<br>
  .     ¬´ ¬ª ‚Äî  .   X86_64   ¬´¬ª : a, b, c, d, di, si, 8, 9, 10, 11, 12, 13, 14  15 ( 32- X86  ).<br>
<br>
  64- (8 ),        : 64-, 32-, 16-  8-.     .<br>
<br>
 A ‚Äî 64- . RAX ‚Äî 64-. EAX ‚Äî 32-. AX ‚Äî 16-.  : AL,  : AH.<br>
<br>
<img src="https://habrastorage.org/files/8af/866/2f0/8af8662f01a24f02958282273ef703d0.png"><br>
 <br>
  .  ‚Äî    ,         .         ,   .  :<br>
<br>
<ul>
<li>  = 8 ,     .   BYTE.</li>
<li>  = 16 ,   WORD.</li>
<li>   = 32 ,   DWORD ( WORD).</li>
<li>8   = 64 ,   QWORD ( WORD).</li>
<li>16   = 128 ,   DQWORD (  WORD).</li>
</ul><br>
    X86    <a href="http://sandpile.org/">http://sandpile.org/</a>   Intel/AMD/Microsoft. : X86_64   ,  X86 (32- ).       Intel.<br>
<br>
<h3>  X86_64</h3><br>
<pre><code>00400afc:   jmp 0x400b26 </code></pre><br>
<b>JMP</b> ‚Äî    (unconditional jump).    0x400b26:<br>
<br>
<pre><code>00400b26:   lea -0x420(%rbp),%rcx
00400b2d:   mov -0xc(%rbp),%eax
00400b30:   mov $0x400,%edx
00400b35:   mov %rcx,%rsi
00400b38:   mov %eax,%edi
00400b3a:   callq 0x4005d0 &lt; read@plt&gt;</code></pre><br>
      <code>read()</code>.    <a href="https://en.wikipedia.org/wiki/X86_calling_conventions">   X86_64</a>,  ,      ,  .        X86_64 Linux    32- ,      .<br>
<br>
 <a href="https://www.cs.utexas.edu/~bismith/test/syscalls/syscalls64_orig.html">   </a>,  <code>read(int fd, char *buf, size_t buf_size)</code>   ( )     RDI,  (  ) ‚Äî  RSI,   (   ) ‚Äî  RDX.<br>
<br>
  .   RBP (Register Base Pointer,   ). RBP      ,     RSP (Register Stack Pointer,   )    ,  ,       - .  ‚Äî     ,   .     ,  <code>alloca()</code>,  ,    ,    .<br>
<br>
      <code>main()</code>,     :<br>
<br>
<pre><code>00400b26:   lea -0x420(%rbp),%rcx</code></pre><br>
<br>
<b>LEA</b> (Load Effective Address)   RBP  0x420,   RCX.     ‚Äî <code>buf</code>.  ,  LEA     ,   .  GDB        :<br>
<br>
<pre><code>&gt; (gdb) p $rbp - 0x420
$2 = (void *) 0x7fffffffddc0</code></pre><br>
  <code>info registers</code>    :<br>
<br>
<pre><code>&gt; (gdb) info registers
rax            0x400a60 4196960
rbx            0x0      0
rcx            0x0      0
rdx            0x7fffffffe2e0   140737488347872
rsi            0x7fffffffe2c8   140737488347848
... ...</code></pre><br>
:<br>
<br>
<pre><code class="cpp">00400b2d:   mov -0xc(%rbp),%eax</code></pre><br>
   ,   RBP  0xc ‚Äî  EAX.  ,    <code>f </code>.    :<br>
<br>
<pre><code class="bash">&gt; (gdb) p $rbp - 0xc
$1 = (void *) 0x7fffffffe854
&gt; (gdb) p &amp;f
$3 = (int *) 0x7fffffffe854</code></pre><br>
 :<br>
<br>
<pre><code>00400b30:   mov $0x400,%edx</code></pre><br>
  EDX  0x400 (1024   ).  <code>sizeof(buf)</code>: 1024,   <code>read()</code>.<br>
<br>
<pre><code>00400b35:   mov %rcx,%rsi
00400b38:   mov %eax,%edi
00400b3a:   callq 0x4005d0 &lt; read@plt&gt;</code></pre><br>
  RCX  RSI,   <code>read()</code>.   EAX  EDI,   <code>read()</code>.    <code>read()</code>.<br>
<br>
         A (    D). <code>read()</code>   <code>ssize_t</code>,   64 . ,          A.    RAX (64-   A):<br>
<br>
<pre><code>00400b3f:   mov %rax,-0x18(%rbp)
00400b43:   cmpq $0x0,-0x18(%rbp)
00400b48:   jg 0x400afe &lt; main+158&gt;</code></pre><br>
   <code>read()</code>  RAX  ,   RBP  0x18.   ,     <code>readed</code>  -.<br>
<br>
<b>CMPQ</b> (Compare Quad-Word,   WORD).   <code>readed</code>   0.<br>
<br>
<b>JG</b> (Jump if greater,    ¬´¬ª).    0x400AFE.       <code>while()</code>   -. <br>
<br>
       0x400AFE,      <code>for()</code>.<br>
<br>
<pre><code>00400afe:   movl $0x0,-0x4(%rbp)
00400b05:   jmp 0x400b1b &lt; main+187&gt;</code></pre><br>
<b>MOVL</b> (Move a Long,   ).  LONG (32 )  0  ,   RBP  4.  <code>i</code> ‚Äî    C-, 32 ,   4 .            <code>main()</code> ( RBP).<br>
<br>
   0x400B1B,      <code>for()</code>.<br>
<br>
<pre><code>00400b1b:   mov -0x4(%rbp),%eax
00400b1e:   cltq 
00400b20:   cmp -0x18(%rbp),%rax
00400b24:   jl 0x400b07 </code></pre><br>
  EAX ,   RBP  4 (,  ). <br>
<br>
<b>CLTQ</b> (Convert Long To Quad). CLTQ    A.   EAX  64-  ,  RAX.<br>
<br>
<b>CMP</b> (Compare value,  ).    RAX  ,       RBP  0x18.     <code>i</code>   <code>for()</code>   <code>readed</code>.<br>
<br>
<b>JL</b> (Jump if Lower,    ¬´¬ª).    0x400B07.      <code>for()</code>,   , .<br>
<br>
<pre><code>00400b07:   mov -0x4(%rbp),%eax
00400b0a:   cltq 
00400b0c:   movzbl -0x420(%rbp,%rax,1),%eax
00400b14:   add %al,-0x5(%rbp)
00400b17:   addl $0x1,-0x4(%rbp)
00400b1b:   mov -0x4(%rbp),%eax
00400b1e:   cltq 
00400b20:   cmp -0x18(%rbp),%rax
00400b24:   jl 0x400b07 &lt; main+167&gt;</code></pre><br>
   .<br>
<br>
 (MOV) <code>i</code>  EAX (  , <code>i</code> ‚Äî  ‚Äì0x4(%rbp)).   CLTQ:   64 .<br>
<br>
<b>MOVZBL</b> (MOV Zero-extend Byte to Long).      ,    (1*RAX+RBP)  0x420,    EAX.  ,     ;-)   <code>buf[i]</code>    .        C: <code>buf[i] ‚Äî  buf + i*sizeof(buf[0])</code> .      ,      ,    .<br>
<br>
   EAX,     <code>result</code>:<br>
<br>
<pre><code>00400b14:   add %al,-0x5(%rbp)</code></pre><br>
: AL ‚Äî   8- RAX (RAX  AL    A) ‚Äî  <code>buf[i]</code>,  <code>buf</code>    char    . <code>result</code>    ‚Äì0x5(%rbp):    <code>i</code>,    0x4  RBP.  ,  <code>result</code> ‚Äî  char,   .<br>
<br>
<pre><code>00400b17:   addl $0x1,-0x4(%rbp)</code></pre><br>
<br>
<b>ADDL</b> (Add a long,    ‚Äî 32 ).  1  <code>i</code><br>
<br>
     00400b1b:  <code>for()</code>.<br>
<br>
<h3> </h3><br>
?  ,       .    ,   ‚Äî        : , , , . ,  ,   .    ¬´¬ª  ¬´¬ª?<br>
<br>
  ,      ,              10.        .       ,         ,  2, 8  16.      <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B1%25D0%25B0%25D0%25BD"></a>.<br>
<br>
        ,   ,           10.   10  2 ,      .    2  16  8 . ,       .<br>
<br>
,   <code>for()</code>    .        C-:   <b>  </b>   .       0x40000000 ,   1 073 741 824.<br>
<br>
  2  ( CISC   !=  )   1 073 741 824    .      3 ,         .<br>
<br>
<h1>     SIMD</h1><br>
<b>SIMD</b> ‚Äî Single Instruction Multiple Data,  ,   .   . SIMD    ,       ,  WORD,  DWORD,   <b>  </b>    .<br>
<br>
 SSE ‚Äî Streaming SIMD Extensions,  SIMD-.     ,  SSE, SSE2, SSE4, SSE4.2, MMX  3DNow.  , SSE ‚Äî  SIMD-.        ,   <b></b>    . <br>
<br>
<img src="https://habrastorage.org/files/53c/177/2a4/53c1772a4c4e4100a31de99fc62796c9.png"><br>
 <br>
         ,     .     .   :          8   8   ?<br>
<br>
SIMD-       .   ,     .    :<br>
<br>
<ul>
<li> ,     ( GPU     ).</li>
<li> ,        ( LZ, GZ, MP3, Divx, H264/5, JPEG FFT   ).</li>
<li>.</li>
<li>   .</li>
</ul><br>
,  , <a href="https://software.intel.com/en-us/articles/motion-estimation-with-intel-streaming-simd-extensions-4-intel-sse4">   (Motion Estimation)   Intel SSE 4</a>.         .      ,     F,   F+1.            ,     .   ‚Äî   H264  H265,     ,    (    MPEG).<br>
<br>
 :<br>
<br>
<pre><code class="bash">&gt; cat /proc/cpuinfo
processor  : 2
vendor_id  : GenuineIntel
cpu family : 6
model      : 58
model name : Intel(R) Core(TM) i5-3337U CPU @ 1.80GHz
(...)
flags      : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm pcid sse4_1 sse4_2 x2apic popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm ida arat epb xsaveopt pln pts dtherm tpr_shadow vnmi flexpriority ept vpid fsgsbase smep erms</code></pre><br>
   ‚Äî          .<br>
<br>
   sse, sse2, sse4_1, sse4_2, aes, avx.<br>
<br>
AES    AES-!   CPU,     .<br>
<br>
SSE4.2       CRC32,      ‚Äî   .   <code>str()</code>   libC <a href="">  SSE4.2</a>,          .<br>
<br>
<h3>SIMD  </h3><br>
    -   SIMD  ,    .<br>
<br>
    MMX,   8  64- ,  MM0  MM7. MMX    1990-,   -  Pentium 2  Pentium 3   .     .<br>
<br>
  SSE,    SSE4.2,      2000-  2010-.      .<br>
<br>
<img src="https://habrastorage.org/files/278/3b8/5e0/2783b85e005a46e9abcec68397107f8d.png"><br>
 <br>
    ‚Äî SSE4.2.    16  128-  ( X86_64):  XMM0  XMM15. 128  = 16 .  ,  SSE-     - ,    16 .<br>
<br>
<img src="https://habrastorage.org/files/b69/7ae/577/b697ae57708e4714b771e65518966e8b.png"><br>
 <br>
    SSE-,    32   .  .<br>
<br>
 16       ( LP64):<br>
<br>
<ul>
<li>16 :  C-.</li>
<li> 8- :            (double precision float).</li>
<li> 4- :         (single precision float).</li>
<li> 2- :     C.</li>
</ul><br>
:<br>
<br>
<img src="https://habrastorage.org/files/82a/e2b/ae2/82ae2bae28814ea48714a338211a8716.png"><br>
 <br>
SIMD   ¬´¬ª ,      ¬´¬ª ‚Äî ,    .      ,       ‚Äî    .<br>
<br>
     SIMD  :<br>
<br>
<ul>
<li>   ,    .</li>
<li> Intel Intrinsics ‚Äî API,   C-,      SSE-.</li>
</ul><br>
    ,       .<br>
<br>
  :<br>
<br>
<pre><code class="cpp">#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;
#include &lt;string.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;unistd.h&gt;
#include &lt;tmmintrin.h&gt;

#define BUF_SIZE 1024

int main(int argc, char **argv)
{
    int f, i;
    ssize_t readed;
    __m128i r  = _mm_set1_epi8(0);

    unsigned char result = 0;
    unsigned char buf[BUF_SIZE] __attribute__ ((aligned (16))) = {0};

    if (argc != 2) {
        fprintf(stderr, ": %s \n", argv[0]);
        exit(-1);
    }

    f = open(argv[1], O_RDONLY);

    if (f == -1) {
        perror("   ");
    }

    while ((readed = read(f, buf, sizeof(buf))) &gt; 0) {
        for (i=0; i &lt; readed; i+=16) {
            __m128i a = _mm_load_si128((const __m128i *)(buf+i));
            r = _mm_add_epi8(a, r);
        }
        memset(buf, 0, sizeof(buf));
    }

    for (i=0; i&lt;16; i++) {
        result += ((unsigned char *)&amp;r)[i];
    }

    close(f);

    printf(" ,   %u \n", result);

    return 0;
}
</code></pre><br>
   <i>tmmintrin.h</i>?   API.     <a href="https://software.intel.com/sites/landingpage/IntrinsicsGuide/"></a>.<br>
<br>
    ()      SSE-      .    . ,   4  (  ),      256   16  :D<br>
  SSE-?   ‚Äî  <b></b>.  ,       16  .   ,  ,      ¬´¬ª  ¬´¬ª   .    .       16   8 WORD  4 DWORD.     .    SIMD    ,     .<br>
<br>
,         16 .<br>
<br>
       .<br>
<br>
<pre><code class="cpp">__m128i r  = _mm_set1_epi8(0);</code></pre><br>
<br>
   XMM- (16 )    .<br>
<br>
<pre><code class="cpp">for (i=0; i &lt; readed; i+=16) {
    __m128i a = _mm_load_si128((const __m128i *)(buf+i));
    r = _mm_add_epi8(a, r);
}</code></pre><br>
  <code>for()</code>       1 ,   16.   <code>i+=16</code>.<br>
<br>
     <code>buf+i</code>      <code>__m128i*</code>.         16 .   <code>_mm_load_si128()</code>   16    <code>a</code>.     XMM-  ¬´16* ¬ª.<br>
<br>
   <code>_mm_add_epi8()</code>  16-     <code>r</code>.       16 .<br>
<br>
       .  ,      .     WORD, DWORD   ,    !  ,   <code>_mm_hadd_epi16()</code>.<br>
<br>
    :<br>
<br>
<pre><code class="cpp">for (i=0; i&lt;16; i++) {
    result += ((unsigned char *)&amp;r)[i];
}</code></pre><br>
.<br>
<br>
  :<br>
<br>
<pre><code class="bash">&gt; gcc -Wall -g -O0 -o file_sum file_sum.c
&gt; time ./file_sum /tmp/test 
Read finished, sum is 186 

real    0m0.693s
user    0m0.360s
sys 0m0.328s</code></pre><br>
 700 . C 3000         700    16 .<br>
<br>
    <code>while()</code>,     :<br>
<br>
<pre><code>00400957:   mov -0x34(%rbp),%eax
0040095a:   cltq 
0040095c:   lea -0x4d0(%rbp),%rdx
00400963:   add %rdx,%rax
00400966:   mov %rax,-0x98(%rbp)
0040096d:   mov -0x98(%rbp),%rax
00400974:   movdqa (%rax),%xmm0
00400978:   movaps %xmm0,-0x60(%rbp)
0040097c:   movdqa -0xd0(%rbp),%xmm0
00400984:   movdqa -0x60(%rbp),%xmm1
00400989:   movaps %xmm1,-0xb0(%rbp)
00400990:   movaps %xmm0,-0xc0(%rbp)
00400997:   movdqa -0xc0(%rbp),%xmm0
0040099f:   movdqa -0xb0(%rbp),%xmm1
004009a7:   paddb %xmm1,%xmm0
004009ab:   movaps %xmm0,-0xd0(%rbp)
004009b2:   addl $0x10,-0x34(%rbp)
004009b6:   mov -0x34(%rbp),%eax
004009b9:   cltq 
004009bb:   cmp -0x48(%rbp),%rax
004009bf:   jl 0x400957</code></pre> <br>
 ?  <code>%xmm0</code>  <code>%xmm1</code>?   SSE-.     ?<br>
<br>
  <b>MOVDQA</b> (MOV Double Quad-word Aligned)  <b>MOVAPS</b> (MOV Aligned Packed Single-Precision).       :  128  (16 ).     ?          CISC,     .<br>
<br>
   <b>PADDB</b> (Packed Add Bytes):      128-    !<br>
<br>
 .<br>
<br>
<h3> AVX</h3><br>
AVX (Advanced Vector eXtension) ‚Äî   SSE.   AVX -  SSE++,  SSE5  SSE6.<br>
<br>
   2011-    Intel Sandy Bridge.   SSE  MMX,   AVX  SSE,    ¬´¬ª ,  ,   2000‚Äî2010. <br>
<br>
AVX   SIMD,  XMM-  256 ,   32 . ,   XMM0     YMM0.      ,   .<br>
<br>
<img src="https://habrastorage.org/files/f81/92f/b94/f8192fb9497d41b09d0b88e13cf02a03.png"><br>
 <br>
AVX-    XMM-  SSE,       128   YMM-.       SSE  AVX.<br>
<br>
  AVX   :           .      ,      SSE     ,    ¬´¬ª  (         ,     ,      ). :<br>
<br>
<pre><code class="cpp">VADDPD %ymm0 %ymm1 %ymm2  :          ymm1  ymm2     ymm0</code></pre><br>
<br>
 AVX    MNEMONIC DST SRC1 SRC2 SRC3       SRC  DST (  ). ,  AVX- ( )     ,      ,       ,    .<br>
<br>
,  AVX   FMA-. FMA (<a href="https://ru.wikipedia.org/wiki/%25D0%25A3%25D0%25BC%25D0%25BD%25D0%25BE%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5-%25D1%2581%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">Fused Multiply Add</a>)      : A = (B * C) + D.<br>
<br>
<h3> AVX2</h3><br>
 2013     Haswell   AVX2.      256- .   ,     .  ,  AVX1  .    256-  AVX          ( ,    )   .     !<br>
<br>
  ,   AVX2    VPADDB,    YMM- (   32 ).   ,          AVX2. <br>
  AVX  AVX2   <a href="https://software.intel.com/en-us/file/36945"></a>.<br>
<br>
<h3> AVX-512</h3><br>
    2016   AVX-512   ¬´¬ª  Xeon-Phi.  ,   2018       .<br>
<br>
AVX-512   AVX-,  256  512 ,   64 .   15  SIMD-,       32 512- .    256     ZMM-,     YMM-  AVX,    YMM-  XMM-  SSE.<br>
<br>
<a href="https://software.intel.com/en-us/blogs/2013/avx-512-instructions">  Intel</a>.<br>
<br>
      15      <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D1%2580%25D0%25BE%25D1%2586%25D0%25B5%25D1%2581%25D1%2581%25D0%25BE%25D1%2580"> </a>.<br>
<br>
<h3>SIMD ?</h3><br>
 SIMD  :<br>
<br>
<ul>
<li>      .</li>
<li>     .</li>
</ul><br>
  .          16 ,      16?   (    MOV).<br>
<br>
 Lego         .<br>
<br>
<img src="https://habrastorage.org/files/143/7e6/1be/1437e61bee2a45778a7523b32d67ccf1.jpg"><br>
 <br>
 ?     -:<br>
<br>
<pre><code class="cpp">unsigned char buf[BUF_SIZE] __attribute__ ((aligned (16))) = {0};</code></pre><br>
   <code>buf</code>    ,    16.<br>
<br>
SIMD      ,       ,       SIMD.        ,    Y,     ,   Y,      .      .<br>
<br>
  : <br>
<br>
<ul>
<li><a href="http://www.songho.ca/misc/alignment/dataalign.html">www.songho.ca/misc/alignment/dataalign.html</a></li>
<li><a href="https://www.ibm.com/developerworks/library/pa-dalign/">www.ibm.com/developerworks/library/pa-dalign</a></li>
</ul><br>
 ,           ¬´¬ª .       PHP.    -           .    ¬´¬ª   ,        (),     ,          .      -.<br>
<br>
 ,   SIMD, ‚Äî       .         .         ,   SIMD.       . <br>
<br>
 ,  SIMD    ,     .<br>
<br>
<h1>  :    </h1><br>
          .     700 ,    500!<br>
<br>
  .<br>
<br>
,     -.   .       ,      PHP   <a href="http://jpauli.github.io/2015/03/05/opcache.html"></a>,   OPCache    PHP-       .<br>
<br>
    ,    .   ,   .       .<br>
:      ,       .       (   ‚Äî )  .<br>
<br>
-   1970- .    50 .  -         ,   .     <b></b>   .<br>
<br>
  ,   ,  ,     .   ,       .    <a href="http://www.agner.org/optimize/"></a>.<br>
<br>
     ‚Äî     Intrinsics ‚Äî   :<br>
<br>
<pre><code class="bash">&gt; gcc -Wall -g -O3 -o file_sum file_sum.c
&gt; time ./file_sum /tmp/test 
Read finished, sum is 186 

real    0m0.416s
user    0m0.084s
sys     0m0.316s</code></pre><br>
   416 ,      84 ,            316 .<br>
<br>
.<br>
<br>
.     <a href="https://godbolt.org/g/Hir2bF"></a>.<br>
<br>
 :<br>
<br>
<pre><code class="bash">00400688:   mov %rcx,%rdi
0040068b:   add $0x1,%rcx
0040068f:   shl $0x4,%rdi
00400693:   cmp %rcx,%rdx
00400696:   paddb 0x0(%rbp,%rdi,1),%xmm0
0040069c:   ja 0x400688 
0040069e:   movdqa %xmm0,%xmm1
004006a2:   psrldq $0x8,%xmm1
004006a7:   paddb %xmm1,%xmm0
004006ab:   movdqa %xmm0,%xmm1
004006af:   psrldq $0x4,%xmm1
004006b4:   paddb %xmm1,%xmm0
004006b8:   movdqa %xmm0,%xmm1
004006bc:   psrldq $0x2,%xmm1
004006c1:   paddb %xmm1,%xmm0
004006c5:   movdqa %xmm0,%xmm1
004006c9:   psrldq $0x1,%xmm1
004006ce:   paddb %xmm1,%xmm0
004006d2:   movaps %xmm0,(%rsp)
004006d6:   movzbl (%rsp),%edx
(...) (...)     (...) (...)</code></pre><br>
  .     ,    . ,   (unroll) ,      ,      .<br>
    SIMD-,     ¬´¬ª ‚Äî     SIMD.<br>
<br>
    ,   ,       .     .     ,    . <a href="https://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html"></a>     ,  GCC   .<br>
<br>
   ‚Äî O3,   ¬´  ‚Äî ¬ª, ¬´  ‚Äî slp¬ª,   <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25B7%25D0%25BC%25D1%258B%25D0%25BA%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D1%2586%25D0%25B8%25D0%25BA%25D0%25BB%25D0%25B0"> </a>.<br>
<br>
    O2,   -     O3     .     ,    <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2588%25D0%25B8%25D0%25B1%25D0%25BA%25D0%25B0_Pentium_FDIV"></a>.            ,   2016 .     ,      GCC 4.9.2,   PHP  -O2.   <a href="http://www.exploringbinary.com/why-volatile-fixes-the-2-2250738585072011e-308-bug/">   FPU</a>. <br>
<br>
    PHP.     (-O0)   .    -O2  -O3.     -  .<br>
<br>
 -O2   .    -O2 GCC    SIMD.  ,      Linux-     -O2.      ,      .    .  ,   Linux-    ,       ,   ?    ,    IBM  Oracle.<br>
<br>
        ,  -O3  -O2   .   -march=native      ,  ,   .     ,        .<br>
<br>
 GCC,    ,  LLVM  ICC ( Intel).  <a href="http://gcc.godbolt.org/">gcc.godbolt.org</a>      .  Intel      Intel.  GCC  LLVM  ,             ,     .<br>
<br>
   ,  .  :     .<br>
<br>
     ,    ,    ,     ,      .      ? .<br>
<br>
<h3>PHP?</h3><br>
     PHP?    PHP  .        ,   ,         ,    -.<br>
<br>
      ,      :<br>
<br>
<ul>
<li>    PHP .  ,   ,      . <a href=""></a>.</li>
<li>  <a href="http://man7.org/linux/man-pages/man3/alloca.3.html">alloca()</a>  ,     .   ,   alloca(),    <a href=""> </a>.</li>
<li>    GCC. , __builtin_alloca(), __builtin_expect()  __builtin_clz().</li>
<li>  ,         Zend Virtual. <a href=""></a>.</li>
</ul><br>
 PHP    JIT (  ).  . JIT ‚Äî      ¬´ ¬ª,      . JIT    ,    PHP (Zend),         .      ,   JIT.   PHP-      PHP-, JIT    ,          .   PHP   ,            ¬´¬ª    ().   PHP     JIT,   ,    Java.   ,   -,      CLI. CLI-  ,    Web PHP.<br>
<br>
  PHP        .     ,    ¬´ ¬ª,    .      .<br>
<br>
    <a href="https://github.com/krakjoe/SIMD">SIMD-   PHP</a>.   :   ,    .<br>
<br>
      PHP-,   SIMD. ,       <a href="https://github.com/markrogoyski/math-php"> math-php</a>   SIMD.      ,  PHP-  SIMD    . ,   -     PHP.<br>
<br>
<h1></h1><br>
,        . ,             GDB  ,    .       GCC    ,  ,   SIMD-.   -O3 GCC        SIMD.<br>
<br>
  ,    SIMD ‚Äî    .          AVX    .          mmap(),         .<br>
<br>
   ,     ,       .   .  -                  API Intel Intrinsics.     ¬´¬ª   ,     . <a href="https://gcc.gnu.org/onlinedocs/gcc/C-Extensions.html"> GCC-</a>.<br>
<br>
-   Intel Intrinsics, -      ,   .       -,     .        ,   . <br>
<br>
  ‚Äî   .       45 ,    ,  ,      .    ,       .      ,    . ,     ,        NUMA.   -   ,   ,      Intel  AMD    :       ,    .<br>
<br>
   ,      ,  <b></b>  ,   .  ,         .        ,    .<br>
<br>
   ,  ,           -    . ,      ,     .    ,           ,         ,     .<br>
<br>
 :<br>
<br>
<ul>
<li><a href="http://www.polyhedron.com/web_images/intel/productbriefs/3a_SIMD.pdf">Intel: The significance of SIMD, SSE and AVX</a></li>
<li><a href="http://www.nasm.us/">NASM</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc-4.9.2/gcc/i386-and-x86-64-Options.html">GCC SIMD switches</a></li>
<li><a href="http://gcc.godbolt.org/">Online JS based X86 compilers</a></li>
<li><a href="https://www.arm.com/products/processors/instruction-set-architectures/index.php">ARM Processor Architecture</a></li>
<li><a href="https://www.amazon.com/Modern-X86-Assembly-Language-Programming/dp/1484200659">Modern X86 Assembly Language Programming: 32-bit, 64-bit, SSE, and AVX</a></li>
<li><a href="http://ref.x86asm.net/index.html">X86 Opcode and Instruction Reference</a></li>
<li><a href="https://www.amazon.com/Compilers-Principles-Techniques-Tools-2nd/dp/0321486811">Dragon Book</a></li>
<li><a href="http://git.videolan.org/%3Fp%3Dx264.git%3Ba%3Dtree%3Bf%3Dcommon/x86%3Bh%3D844b5cdfe4326c51783a74b06c37c334e4d7dfd8%3Bhb%3DHEAD">X264 Assembly with SIMD</a></li>
<li><a href="">LAME MP3 quantizer SIMD</a></li>
<li><a href="http://nullprogram.com/blog/2015/07/10/">Mandelbrot Set with SIMD Intrinsics</a></li>
<li><a href="https://github.com/dherman/asm.js/">ASM.js</a></li>
<li><a href="https://github.com/krakjoe/SIMD">Joe's PHP SIMD</a></li>
</ul></div><p>Source: <a href="https://habr.com/ru/post/317180/">https://habr.com/ru/post/317180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../317170/index.html">How the company is headed by a general director-programmer - opinions and experience of experts</a></li>
<li><a href="../317172/index.html">Inkscape: the beginning (translation)</a></li>
<li><a href="../317174/index.html">Recovering virtualized Active Directory deleted objects from tombstone objects</a></li>
<li><a href="../317176/index.html">Where is the Internet of Things going?</a></li>
<li><a href="../317178/index.html">Why not write bots for Skype</a></li>
<li><a href="../317182/index.html">Remote logging in journald or Still ‚Äúyou don't need this‚Äù?</a></li>
<li><a href="../317184/index.html">Why to achieve the goal is enough notebook</a></li>
<li><a href="../317188/index.html">Experience in building Infrastructure-as-Code in VMware. Part 1: Problem Identification</a></li>
<li><a href="../317192/index.html">Software patents must survive: American practice</a></li>
<li><a href="../317194/index.html">Implementation of PCI Express v3.0 x16 on FPGA Virtex 7</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>