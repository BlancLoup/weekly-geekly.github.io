<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The evolution of extension language: the story of Lua</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="from the lane The source material dates back to 2001, so some things may seem funny. Also, all references to "today", "at the moment", etc. refer to t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The evolution of extension language: the story of Lua</h1><div class="post__text post__text-html js-mediator-article">  <i>from the lane</i>  <i>The source material dates back to 2001, so some things may seem funny.</i>  <i>Also, all references to "today", "at the moment", etc.</i>  <i>refer to that period.</i> <i><br></i>  <i>The presentation is conducted on behalf of the author, as in the original.</i> <i><br></i>  <i>All links are added by me.</i> <br><br>  The presentation is organized in chronological order.  We begin with our experiments, which formed the basis for the creation of Lua in 1993, and go through eight years of discussion, decisions, work, and entertainment. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  There is an old joke: ‚Äúa camel is a horse developed by a committee‚Äù.  Among developers of programming languages, this joke is almost as popular as the legend about the languages ‚Äã‚Äãdeveloped by the committees.  The legend is supported by languages ‚Äã‚Äãsuch as Algol 68, PL / I and Ada, developed by committees and not meeting the expectations. <br>  However, apart from the committees, there is an alternative explanation for the partial failure of these languages: they were all born large.  Each of them followed the downstream design process, in which the language is fully described before the programmer can try it out, and even before the appearance of the first compiler. <br><br>  On the other hand, many successful languages ‚Äã‚Äãhave manifested themselves before their full study.  They followed an upward design process, appearing as small languages ‚Äã‚Äãwith modest goals.  When people began to use an underdeveloped language, new possibilities were added to it (or, sometimes, deleted), ambiguous places were clarified (or, on the contrary, everything was even more complicated).  Therefore, the path of development is an important topic when learning a programming language.  For example, <a href="http://www.sigplan.org/">SIGPLAN</a> has already sponsored two conferences on the history of programming languages. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This document describes the history of the Lua programming language.  Since its introduction as a language for a couple of its own specific ‚Äúhome‚Äù projects, Lua has gone beyond our most optimistic expectations.  In our opinion, the main reasons for this success lie in our approach to designing a language: keep the language itself simple and compact, and its implementation is simple, compact, fast, portable and free. <br><br>  Lua was developed (or, more precisely, nominated) by the committee;  albeit small - with only three members - but a committee.  In hindsight, we understand that the initial development of the language by a small committee had a positive effect on the language.  We added a new feature only by unanimous agreement, otherwise it was postponed for the future.  It is much easier to add new features later than to delete them.  This development process kept the language simple;  and simplicity of language is our most valuable contribution.  Other most important qualities of Lua - speed, compactness and portability, derived from its simplicity. <br><br>  From the first versions, Lua had ‚Äúreal‚Äù users, not just us alone.  They made important contributions to the language with discussions, complaints, user reports and questions.  On the other hand, our small committee played an important role: its structure gave us enough inertness to listen to users without following all their suggestions. <br><br><h2>  Start </h2><br>  Our first experience at <a href="http://www.tecgraf.puc-rio.br/en/">TeCGraf</a> ( <i>from the translation of the Computer Graphics Technology Group of the Catholic University of Rio de Janeiro in Brazil</i> ), related to the development of its PL, occurred in an application for data entry.  The engineers of PETROBRAS (a Brazilian oil company) several times a day required the preparation of source data files for simulators.  It was a boring and error-prone process, since the simulation programs required strictly formatted source files, usually consisting of simple columns of numbers without any indication what number it meant.  Of course, each number had a definite meaning, understood by the engineers at first glance at the diagram of a specific simulation.  PETROBRAS turned to TeCGraf for the creation of a graphical frontend for similar source data.  Numbers could be entered interactively after a simple click into the appropriate part of the diagram - and this was a much simpler and more visual task than editing numeric columns.  Moreover, it made it possible to add verification and calculation of dependent values ‚Äã‚Äãfrom the source data, thereby reducing the amount of data required from the user, and at the same time increasing the reliability of the whole process. <br>  To simplify the development of this application in TeCGraf, we decided to program everything in a uniform way, developing a simple declarative language for describing all the tasks for the input data.  Here is an example of a typical program section in this language, which we called DEL (data entry language): <br><pre><code class="lua hljs">:e gasket <span class="hljs-string"><span class="hljs-string">"gasket properties"</span></span> mat s # material mf <span class="hljs-number"><span class="hljs-number">0</span></span> # factor m yf <span class="hljs-number"><span class="hljs-number">0</span></span> # settlement stress ti <span class="hljs-number"><span class="hljs-number">1</span></span> # facing <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> :p gasket.m&gt;<span class="hljs-number"><span class="hljs-number">30</span></span> gasket.m&lt;<span class="hljs-number"><span class="hljs-number">3000</span></span> gasket.y&gt;<span class="hljs-number"><span class="hljs-number">335.8</span></span> gasket.y&lt;<span class="hljs-number"><span class="hljs-number">2576.8</span></span></code> </pre> <br>  Expression <b>: e</b> declares an entity (named in the example ‚Äúgasket‚Äù), which has several fields with default values.  Expression <b>: p</b> imposes some restrictions on the values ‚Äã‚Äãin the gasket, thus implementing data validation.  DEL also has expressions for describing input and output data. <br>  An entity in a DEL is, in general, a structure or entry in traditional PL.  The difference is that its name also appears in a graphical metafile containing a diagram with which engineers enter data as previously described. <br><br>  This simple language has proved its success both in TeCGraf, simplifying development, and among users by the ease of adapting data entry applications.  Soon, users needed more features from the DEL, such as boolean expressions to control the entity's readiness to enter data, and the DEL became heavier.  When users started asking about conditional blocks and cycles, it became clear that we needed a full-fledged programming language. <br><br>  At about the same time, we started working on another project for PETROBRAS called PGM: a customizable report generator for lithologic profiles.  As the name implies, the reports created by this program should have been well tuned: the user could create and position tracks, choose colors, fonts and texts;  each track could have a grid that has its own settings (logarithmic / linear, with vertical and horizontal cutoffs, etc.);  each curve had its own automatic scale;  and much more. <br><br>  All these settings were set by end users, usually geologists or engineers, and the program had to work on small machines, such as a PC with MS-DOS.  We considered that the best way to customize the application is possible through a specialized description language, which we called Sol: an acronym for Simple Object Language (Simple Object Language), and at the same time it was translated from Portuguese as ‚Äúsun‚Äù. <br><br>  As the report generator used many different objects with many attributes for each, we decided not to introduce these objects and attributes into the language.  Instead, the language allowed to describe types.  The main task of the interpreter was to read the description, check the correctness of the description of objects and attributes, and transfer the information to the main program.  To implement the interaction between the main program and the interpreter, the latter was implemented as a C library linked to the main program.  Thus, the main program had full access to all configuration information through the library API.  Moreover, the program could register a callback-function for each described data type caused by the interpreter when creating an object of this type. <br><br>  Here is a typical example of Sol code: <br><pre> <code class="lua hljs">-   <span class="hljs-string"><span class="hljs-string">'track'</span></span>,    <span class="hljs-string"><span class="hljs-string">'x'</span></span>  <span class="hljs-string"><span class="hljs-string">'y'</span></span>, -    <span class="hljs-string"><span class="hljs-string">'z'</span></span>.  <span class="hljs-string"><span class="hljs-string">'y'</span></span>  <span class="hljs-string"><span class="hljs-string">'z'</span></span>    . <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> @track { x:number,y:number= <span class="hljs-number"><span class="hljs-number">23</span></span>, z=<span class="hljs-number"><span class="hljs-number">0</span></span>} -   <span class="hljs-string"><span class="hljs-string">'line'</span></span>,   <span class="hljs-string"><span class="hljs-string">'t'</span></span> () -  <span class="hljs-string"><span class="hljs-string">'z'</span></span> ( ). -  <span class="hljs-string"><span class="hljs-string">'t'</span></span>     -  ( <span class="hljs-string"><span class="hljs-string">'track'</span></span>)   x=<span class="hljs-number"><span class="hljs-number">8</span></span>, y=<span class="hljs-number"><span class="hljs-number">23</span></span>,  z=<span class="hljs-number"><span class="hljs-number">0.</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> @line { t:@track=@track{x=<span class="hljs-number"><span class="hljs-number">8</span></span>},z:number*} -   <span class="hljs-string"><span class="hljs-string">'t1'</span></span>  <span class="hljs-string"><span class="hljs-string">'track'</span></span> t1 = @track { y = <span class="hljs-number"><span class="hljs-number">9</span></span>, x = <span class="hljs-number"><span class="hljs-number">10</span></span>, z=<span class="hljs-string"><span class="hljs-string">"hi!"</span></span>} -   ( <span class="hljs-string"><span class="hljs-string">'line'</span></span>) <span class="hljs-string"><span class="hljs-string">'l'</span></span>  t=@track{x=<span class="hljs-number"><span class="hljs-number">9</span></span>, y=<span class="hljs-number"><span class="hljs-number">10</span></span>} -  z=[<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>] () l = @line { t= @track{x=t1.y, y=t1.x}, z=[<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>] }</code> </pre><br>  Sol syntax was strongly influenced by <a href="http://ru.wikipedia.org/wiki/BibTeX">BiBTeX</a> and <a href="http://oreilly.com/catalog/motifref2/vol6a/Vol6a_html/ch22.html">UIL (User Interface Language)</a> , a Motif user interface description language. <br>  In March 1993, we completed the first implementation of the Sol language, but never represented it.  In mid-1993, we realized that DEL and Sol can be combined into one more powerful language.  The lithologic profile visualization program soon demanded support for procedural programming to create more complex layers.  On the other hand, data entry programs also required descriptive means for programming their user interface. <br><br>  So, we decided that we need a complete programming language with assignments, control structures, procedures, and all that.  Also in the language needed a means of describing data by analogy with Sol.  Moreover, since many potential users of the language were not professional programmers, the language should avoid complex syntax (and semantics).  Finally, the implementation of the new language was supposed to be well portable. <br><br>  The requirement of portability turned out to be one of the main advantages: for those two applications ( <i>from the lane, apparently, DEL and Sol are meant</i> ) should have been portable, and the language should have been the same.  PETROBRAS, as a state-owned company, could not choose specific hardware, since it was purchased with very strict restrictions on spending public money.  Because of this, PETROBRAS had a very diverse collection of computers, each of which had to run software created by TeCGraf for PETROBRAS: this included PC DOS, Windows (3.1 at the time), Macintosh and all possible Unix. <br><br>  At this point, we could take the existing language, rather than create another new one.  The main candidates were Tcl and, with a big lag, Forth and Perl.  Perl is not an extension language.  Plus, in 1993, Tcl and Perl worked only on Unix platforms.  All three languages ‚Äã‚Äãalso have complex syntax.  And none of them had good data description support.  So we started work on a new language. <br><br>  Soon we realized that for our purposes in the language there is no need to declare data types.  Instead, we could use the language itself to write type-checking functions based on the basic language capabilities of reflection (such as type information at runtime ( <i>from the first talk about <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D0%25BD%25D0%25B0%25D0%25BC%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25B8%25D0%25B4%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2584%25D0%25B8%25D0%25BA%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25B0_%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D1%2585">RTTI</a></i> )).  View assignment <br><pre> <code class="lua hljs">t1 = @track {y = <span class="hljs-number"><span class="hljs-number">9</span></span>, x = <span class="hljs-number"><span class="hljs-number">10</span></span>, z=<span class="hljs-string"><span class="hljs-string">"hi!"</span></span>}</code> </pre><br>  permissible in Sol is also permissible in a new language, but with a different meaning: it creates an object (in this case, an associative table) with the specified fields, and then calls the <b>track</b> function to check the object (and, sometimes, to set default values). <br>  Since the language was a modified version of Sol ("sun"), a friend at TeCGraf suggested the name Lua ("moon" in Portuguese), and so the language Lua was born. <br><br>  Lua inherited the syntax of records and list construction from Sol, but combined their implementation using associative tables: the records used strings (field names) as indices;  lists used integer indices.  In addition to these data description capabilities in Lua, there were no new concepts, since we needed an easy language of general application.  So, we started with a small set of control structures, the syntax of which was borrowed from <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D0%25B0">Modula</a> (while, if, repeat until).  From <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BB%25D1%2583">CLU,</a> we took multiple assignments and returns multiple values ‚Äã‚Äãas a result of a function call (a much clearer approach than in-out parameters or passing by reference).  From C ++, we took the idea of ‚Äã‚Äãlocality of the scope of variables in the place of their declaration. <br><br>  One of the small (even minor) innovations was the syntax of string concatenation.  Since the language allowed implicit coercion of strings to numbers, using the "+" operator would be ambiguous, we added the syntax ".." (two dots) for such an operation. <br><br>  Disputes caused the use of ";"  (semicolons).  We thought that the requirement of using a semicolon would somewhat confuse engineers who know FORTRAN; on the other hand, not using it will confuse those who know C or Pascal.  In the end, we came to the decision of the optional use of a semicolon (a typical committee decision). <br><br>  Initially, the Lua language had seven data types: numbers (stored in floating point format), rows, (associative) tables, nil (data type with a unique value also called nil), userdata (a simple C's pointer to represent C data structures inside Lua), Lua functions and C functions.  (After eight years of language evolution, the only change in this list was only the unification of Lua and C functions into a single type).  To preserve the compactness of the language, we did not include a boolean data type.  Similar to Lisp, nil is set to false, while all other values ‚Äã‚Äãare set to true.  This is one of the few savings we now sometimes regret. <br><br>  Lua also borrowed from Sol an implementation approach as a library.  The implementation followed the principle now supported by Extreme Programming: ‚ÄúThe simplest implementation that can work.‚Äù  We used <a href="http://ru.wikipedia.org/wiki/Lex">lex</a> for the lexical scanner and <a href="http://ru.wikipedia.org/wiki/Yacc">yacc</a> for the syntax parser.  The parser translated the program into bytecode, which was then executed by a simple stack interpreter.  The language had a very small standard library and it was very easy to add new functions to C. <br><br>  Despite the simple implementation ‚Äî or perhaps because of it ‚Äî Lua exceeded our expectations.  Both projects (PGM and ED) successfully used Lua (and PGM is still in use).  In the end, and other projects in TeCGraf began to use Lua. <br><br><h2>  Early years (1994‚Äì1996) </h2><br>  New users create new requests.  Not surprisingly, one of the first requests was an increase in Lua performance.  Using Lua to describe the data posed an atypical problem for a regular scripting language. <br>  Soon after we started using Lua, we noticed its potential for use as a language for graphic metafiles.  The ability to describe the data in Lua allowed to use it as a graphic format.  Comparing with other programmable metafiles, using Lua gave all the advantages of a full-fledged procedural language.  The <a href="http://ru.wikipedia.org/wiki/VRML">VRML</a> format, for example, uses Javascript to model procedural objects, which leads to non-uniformity (and, therefore, ambiguity) of the code.  With Lua, combining procedural objects in a scene description is natural.  Fragments of a procedural code can be combined with declarative expressions to model complex objects while maintaining overall clarity. <br><br>  The data entry program (ED) was the first to use Lua for its graphic metafiles.  It was common to have diagrams with thousands of parts, described by thousands of elements in Lua in a file of hundreds of kilobytes.  This meant that from a programming point of view, Lua handles huge programs and expressions.  And the fact that Lua compiled such programs "on the fly" (like the "just-in-time" compiler) meant, and so, the very high speed of the Lua compiler itself.  The first victim of the pursuit of the manufacturer has become a lex.  Replacing the scanner generated by lex with self-written code almost doubled the speed of the Lua compiler. <br>  We also created new opcodes for designers.  The source code for the list designer looked like this: <br><pre> <code class="lua hljs">@[<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>]</code> </pre><br>  what turned into similar baytkod: <br><pre> <code class="lua hljs">CREATETABLE PUSHNUMBER <span class="hljs-number"><span class="hljs-number">1</span></span> #  PUSHNUMBER <span class="hljs-number"><span class="hljs-number">30</span></span> #  SETTABLE PUSHNUMBER <span class="hljs-number"><span class="hljs-number">2</span></span> #  PUSHNUMBER <span class="hljs-number"><span class="hljs-number">40</span></span> #  SETTABLE PUSHNUMBER <span class="hljs-number"><span class="hljs-number">3</span></span> #  PUSHNUMBER <span class="hljs-number"><span class="hljs-number">50</span></span> #  SETTABLE</code> </pre><br>  With the new scheme, the code began to look like this: <br><pre> <code class="lua hljs">CREATETABLE PUSHNUMBER <span class="hljs-number"><span class="hljs-number">30</span></span> #  PUSHNUMBER <span class="hljs-number"><span class="hljs-number">40</span></span> #  PUSHNUMBER <span class="hljs-number"><span class="hljs-number">50</span></span> #  SETTABLE <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> #      <span class="hljs-number"><span class="hljs-number">1</span></span>  <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br>  For long designers it was not possible to put all their elements in a stack before saving.  Because of this, the code generator from time to time issued a SETTABLE opcode to reset the stack. <br>  (Since then, we have always tried to improve compile time. Now Lua compiles a program with 30,000 assignments six times faster than Perl, and eight times faster than Python). <br><br>  We released a new version of Lua with these optimizations in July 1994 as Lua 1.1.  The version was available for download via ftp.  The previous version of Lua 1.0 was never publicly available.  After some time, we also released the first documentation describing Lua. <br><br>  Lua 1.1 had a limited user license.  The language could be freely used for academic purposes, but not for commercial use.  (Despite the license, the language itself has always been open source).  But this license did not work.  Most competitors, such as Perl and Tcl, were free.  Moreover, restrictions on commercial use prevented even academic use, since some academic projects planned to enter the market later.  So the release of the next version of the language, Lua 2.1, was free. <br><br><h3>  Lua version 2 </h3><br>  Lua 2.1 (released in 1995) brought many important changes.  One of them was not in the language itself, but in the development process: we believed that we should always try to improve the language, even if at the cost of a slight inverse incompatibility. <br>  In version 2.1, we introduced many incompatibilities with version 1.1 (but provided tools to assist in code migration).  We removed the @ syntax from table constructors and unified the use of curly braces for both records and lists.  Throwing out @ was a trivial change, but it changed the perception of the language, not only its appearance. <br><br>  More importantly, we simplified the semanik of designers.  In Lua 1.1 design <pre> <code class="lua hljs">@track{x=<span class="hljs-number"><span class="hljs-number">1</span></span>, y=<span class="hljs-number"><span class="hljs-number">10</span></span>}</code> </pre>  had a special meaning.  In Lua 2.1 design <pre> <code class="lua hljs">track{x=<span class="hljs-number"><span class="hljs-number">1</span></span>, y=<span class="hljs-number"><span class="hljs-number">10</span></span>}</code> </pre>  is syntactic sugar for <pre> <code class="lua hljs">track({x=<span class="hljs-number"><span class="hljs-number">1</span></span>, y=<span class="hljs-number"><span class="hljs-number">10</span></span>})</code> </pre>  that is, it creates a new table and passes it with a single parameter to the track function. <br><br>  From the very beginning, we developed Lua as an extension language, and therefore C programs could register their own functions, transparently called from Lua.  With this approach, it was easy to extend Lua with object-oriented primitives, which allowed the end user to adapt the language for specific tasks. <br><br>  In version 2.1, we introduced the concept of fallbacks: user-defined functions that are called by Lua in case of uncertain situations.  ( <i>from Lane. This approach is a kind of superset of operator overloading. The principle is similar, but there are more possibilities</i> ).  Lua becomes a language that can be extended in two ways: expanding the set of ‚Äúprimitive‚Äù functions and expanding their semantics through fallbacks.  That is why we now call Lua extensible extension language. <br><br>  We have declared fallbacks for arithmetic, comparison of operators, string concatenation, access to tables, etc.  ( <i>from the lane. more <a href="http://www.lua.org/manual/2.4/node11.html">here</a> and a little ahead <a href="http://lua-users.org/wiki/MetatableEvents">here</a></i> ).  After the user specifies, a similar function is called whenever the operands of this operation are not suitable for their types.  For example, when adding two values, one of which is not a number, a fallback is called, and the result of its call is used as the total amount. <br><br>  Of particular interest is (and is the main reason for the appearance of fallbacks) the access operation to the table: if, when performing x = a [i], the value of a [i] is nil ( <i>from the first page, that is, table <b>a</b> does not contain the field <b>i</b></i> ) , then the fallback function is called (if specified), whose result is used as a value for a [i].  This simple new functionality allowed programmers to implement various access table semantics.  In particular, you can implement some kind of inheritance through delegation: <br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a,i)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i == <span class="hljs-string"><span class="hljs-string">"parent"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-comment"><span class="hljs-comment">--    return nil end local p = a.parent if type(p) == "table" then return p[i] --     Index else return nil end end setfallback("index", Index)</span></span></code> </pre><br>  This code goes up the ‚Äúparents‚Äù chain until it finds the required field or reaches the end.  With this code, the following example will display ‚Äúred‚Äù even if <b>b</b> does not have a color field. <br><pre> <code class="lua hljs">a = Window{x=<span class="hljs-number"><span class="hljs-number">100</span></span>, y=<span class="hljs-number"><span class="hljs-number">200</span></span>, color=<span class="hljs-string"><span class="hljs-string">"red"</span></span>} b = Window{x=<span class="hljs-number"><span class="hljs-number">300</span></span>, y=<span class="hljs-number"><span class="hljs-number">400</span></span>, parent=a} <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(b.color)</code> </pre><br>  There is no magic or hard-coded behavior in the delegation through the "parent" field.  This is the choice of the developer.  It can use a different name for the field, or implement more complex multiple inheritance, allowing the ‚Äúparent‚Äù field to be a table itself, sequentially traversed, or something else. <br><br>  Another fallback will be called for the expression a [i] if a is not a table at all.  These are fallback ‚Äúgettable‚Äù, triggered to get the value of a [i] in a situation like x = a [i], and fallback ‚Äúsettable‚Äù, triggered when writing to a [i] in a situation like a [i] = x. <br><br>  There are many possibilities for using these table fallbacks.  Interlanguage interaction is a very powerful feature: when <b>a</b> stores a value of type userdata (a pointer to something in the C code), fallback implements transparent access to the values ‚Äã‚Äãinside the data structures of the main program. <br><br>  Our decision not to sew rigidly similar behaviors in the implementation of the language led to one of the main concepts of Lua: meta-mechanisms.  Instead of littering the language with many possibilities, we have provided ways for those opportunities to be implemented for those and only to those who need it. <br><br>  The fallback meta-mechanism allows Lua to support OOP in the context of some of the implemented types of inheritance and operator overloading.  We even added some syntactic sugar to describe and use ‚Äúmethods‚Äù: functions can be declared in the format a: f (x, y, z), in which case the hidden parameter self is added to the call, making the call a: f (10.20 , 30) equivalent to af (a, 10,20,30). <br><br>  In May 1996, we released Lua 2.4.  The main innovation of this new version was an external compiler, called luac.  This program compiled Lua code and saved the bytecode and string tables in a binary file.  The format of such a file was chosen for easy download and portability between different platforms.  With luac, programs could avoid parsing and code generation during startup, which was expensive, especially for large static programs, such as graphical metafiles. <br><br>  Our first publication on Lua was already considering the possibility of an external compiler, but we only needed it after the wide distribution of Lua in TeCGraf and the huge graphical metafiles with Lua code created by graphic editors. <br><br>  In addition to speeding up the load, luac also allows you to perform syntax checking during compilation and protect the source code from changes by the user.  However, precompilation does not speed up the execution, since Lua always precompiles the source code before execution. <br><br> luac   ¬´ ¬ª,     ,  Lua    ,     ,           ,  .         Lua    .  ,      (,   ),  40%   Lua 4.0,         .         Lua           ( , Crazy Ivan,    RoboCup  2000  2001  ,  ¬´¬ª   Lua). <br><br><h2>   (1996‚Äì2000) </h2><br>   1996      Lua  <a href="">Software: Practice &amp; Experience</a> ( <i> .     .    <a href="http://citeseerx.ist.psu.edu/viewdoc/summary%3Fdoi%3D10.1.1.54.6432"></a>         <a href="http://ater.me/static/Lua_an_extensible_extension_language.pdf">  pdf</a> ,   </i> ).   1996  Dr. Dobb's  <a href="http://www.drdobbs.com/open-source/lua-an-extensible-embedded-language/184410014">  Lua</a> .  ,    ,     Lua. <br><br>     Dr. Dobb's      Lua.      : <br><pre>From: Bret Mogilefsky &lt;mogul@lucasarts.com&gt;<font></font>
To: "'lua@icad.puc-rio.br'" &lt;lua@icad.puc-rio.br&gt;<font></font>
Subject: LUA rocks! Question, too.<font></font>
Date: Thu, 9 Jan 1997 13:21:41 -0800<font></font>
<font></font>
...<font></font>
<font></font>
  Dr. Dobbs  Lua,     ,<font></font>
      !<font></font>
     .   <font></font>
    .<font></font>
<font></font>
 :      LucasArts Entertainment Co.<font></font>
        SCUMM  Lua.<font></font>
<font></font>
 [...]
</pre><br> ,  <a href="http://www.linkedin.com/pub/bret-mogilefsky/0/a63/591">Bret Mogilefsky</a>    <a href="http://ru.wikipedia.org/wiki/Grim_Fandango">Grim Fandango</a> ,   LucasArts  1997 .      ,  ¬´     Lua¬ª ( ).    Lua            .    Lua          <a href="https://groups.google.com/forum/">rec.games.programmer</a>  <a href="https://groups.google.com/forum/">comp.ai.games</a> . <br>   ,  ,     Lua       .        Lua (  LucasArts, BioWare, Slingshot Game Technology  Loewen Entertainment)   Lua         .      Lua    ,     -     .  ,  Bret Mogilefsky   Lua  Grim Fandango,     . <br><br>        .          ,  AI  ,        .  ,        ,  ¬´¬ª, ¬´¬ª, ¬´¬ª,  ..         .      ,        .          . <br><br>   ,  2000, LucasArts   ,  Lua, <a href="http://ru.wikipedia.org/wiki/Escape_from_Monkey_Island">Escape from Monkey Island</a> ,       Monkey Island.       Lua      SCUMM (    )   Lua. <br><br>       ( , Grim Fandango, Baldur's Gate, MDK2, Escape from Monkey Island) Lua        . <br><br>      Lua  PUC-Rio ( <i> .     --,    TeCGraf</i> )  <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BC%25D0%25B8%25D1%2582%25D1%2581%25D0%25BE%25D0%25BD%25D0%25BE%25D0%25B2%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25B0%25D1%2581%25D1%2582%25D1%2580%25D0%25BE%25D1%2584%25D0%25B8%25D0%25B7%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25BE%25D0%25B1%25D1%2581%25D0%25B5%25D1%2580%25D0%25B2%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580%25D0%25B8%25D1%258F">  </a> .   <a href="http://adass.org/adass/proceedings/adass96/nguyend.html">  </a>        .         <a href="http://ru.wikipedia.org/wiki/%25D0%25A7%25D0%25B0%25D0%25BD%25D0%25B4%25D1%2580%25D0%25B0_(%25D1%2582%25D0%25B5%25D0%25BB%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25BF)">AXAF (   )</a> ‚Äî       NASA. <br><br> Performance Technologies  Lua       CPC4400 ‚Äî ethernet     .  Lua      CPC4400,      (   ,  ,  RMON)    Lua. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tollgrade Communications used Lua in their new generation product to test the DigiTest telephone network. Lua was used for user interface, automated test scripts and analysis results. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lua is also used at the </font></font><a href="http://en.wikipedia.org/wiki/Instituto_do_Cora%25C3%25A7%25C3%25A3o_da_Universidade_de_S%25C3%25A3o_Paulo"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InCor Heart Institute</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (Instituto do Cora√ß√£o, S√£o Paulo) in Brazil, at </font></font><a href="http://en.wikipedia.org/wiki/Eletrobras_Cepel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CEPEL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (research center of the state electric power company ELETROBRAS) also in Brazil, at the </font></font><a href="http://www.wias-berlin.de/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Weierstrass Institute</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> in Berlin, at the </font></font><a href="http://www.tu-berlin.de/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berlin Technical University</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and in many other places . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In 1998, Cameron Laird and Kathryn Soraiz in </font></font><a href="http://sunsite.uakom.sk/sunworldonline/swol-08-1998/swol-08-regex.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">their column about scripting languages</font></font></a>   SunWorld ,  ¬´  -     Lua ¬ª.     ¬´  ¬ª,          . <br><br><h3> Lua  3 </h3><br> Lua 3.0 ( 1997)  fallback'      . Fallback'     :        ,           .    Lua , ,  ,      .        fallback ,        ,    -    . <br>   Lua 3.0           userdata.   ‚Äî ,  ,   fallback',    .        ( userdata)    fallback    . <br><br>    Lua   .  ,    ,   .       ,          :  ( )      . <br><br>    fallback',      Lua   ,             .    ,  fallback' ‚Äî     .    , fallback' (   )        ,     ,           . <br><br>     ,                  .                 . Lua 4.1            (      ). <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In Lua 3.0, there is also support for conditional compilation in a format similar to the C preprocessor. Like any language feature, it was very easy to add this (although this complicated the lexer), and soon programmers began to use it (programmers use any language features). When a new functional appears, the demand for its further development immediately grows. One of the most frequent requests was the addition of macros, but a lengthy discussion never resulted in a clear suggestion either on the mailing list or between us. Each of the proposals required huge changes in the lexer and parser, without showing any clear benefits. So the preprocessor remained static with Lua 3.0 and until version 3.2 (for two years).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the end, we decided that the preprocessor did more harm than good, making the code cumbersome and luring users into endless discussions, and removed it in Lua 4.0. </font><font style="vertical-align: inherit;">And without a preprocessor, Lua has become cleaner. </font><font style="vertical-align: inherit;">Over the years, we have been trying to make Lua easier and remove the dark corners of the language, which we once considered new features, but which were used only by rare programmers, and later became considered errors in general.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lua version 4 </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Before version 3.2, only one ‚Äústate‚Äù of a Lua machine could be active at one time. We had an API for changing the state, but it was somewhat inconvenient to use. To simplify the development of the API, we did not include an explicit state parameter in the function ‚Äî there was only one global state. Now it is clear that this was a mistake. By the time Lua 3.2 was released, it became clear that many applications would be easier if they could conveniently work with several Lua states. For example, we made a special version of Lua 3.2, included in </font></font><a href="http://keplerproject.github.io/cgilua/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CGILua</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äî an extension of browsers for uploading dynamic pages ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from the lane, it means server side</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) and CGI programming on Lua. Earlier, LucasArts did something similar for Lua 3.1.</font></font><br>      Lua 3.3     API   . ,     .   , -     API   ,   Lua 4.0.  API     ,        .  ,     API    ,          API   Lua 1.1.       ,        .  Lua      API,       ,   ,     . <br><br>   Lua 4.0   2000.   API,       ,  . <br><br>      ,   ¬´ ¬ª   .      ,    ,   .  ,         ,    .    , ,  ,         ,    .               .          ,       ‚Äî     . <br><br>   1.1  <b>for</b>      Lua.             <b>while</b> ,    . <br><br>      . ,          for,          .      Pascal ( Modula)  ,             .  ,   <b>to</b>          .   ,  for   C    Lua. <br><br>         3.1 ( 1998)        . (  ,   for          Lua). Lua 3.1       : <br><pre> <code class="lua hljs"><span class="hljs-built_in"><span class="hljs-built_in">foreach</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">table</span></span>, f) <span class="hljs-built_in"><span class="hljs-built_in">foreachi</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">table</span></span>, f)</code> </pre><br>  foreach  f    -,       .  foreachi ,      ( ):            .         ,     . <br>       ,           .                 .   ,   ,             .  ,       ,     .   ,       for:       . <br><br>  for           .  ,       ,           while.  , -          ,                 while. <br><br><h2>  Conclusion </h2><br>   Lua   .      500     30   .   (www.lua.org)  500     50 .        -       Ethernet . <br>  ftp     Lua,          ,   DLL  Windows, SIS  EPOC, RPM  Linux,   RISC OS,  ..  ,    Lua   CD  (  Dr. Dobb's, Linux Magazine France   C Magazine). <br><br>   Lua      -  .  Lua      ,     ,   Lua    ,     palm', ,    . Cameron Laird  Kathryn Soraiz <a href="http://sunsite.uakom.sk/sunworldonline/swol-08-1998/swol-08-regex.html">  1998</a> ,  ¬´      (   , ,   )      Lua¬ª.        ,    . <br><br>  Lua              ,      . <br><br>    .          .   ,       ‚Äî       (   )    . <br><br> ,   ‚Äî   ,    .        :  ,        ,       . <br><br><h3>  Thanks </h3><br> Lua        .   TeCGraf  - :  ,  ,    TeCGraf.   Marcelo Gattass,  TeCGraf,              . Lua     TeCGraf,         . <br>   Lua      .     ‚Äî     .       ,  ,    .        ,  ,  ,         . <br><br> <i> .    ,         Lua,      luajit. <br> ,   :)</i> </div><p>Source: <a href="https://habr.com/ru/post/229269/">https://habr.com/ru/post/229269/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229257/index.html">IT Distribution, a member of the group of companies MUK, received the status: "Oracle Platinum Partner"</a></li>
<li><a href="../229259/index.html">7 problems in the design of SaaS products, and how we solved them</a></li>
<li><a href="../229261/index.html">GUI in the game World of Tanks. Part Two: GUI Structure Overview and Future Plans</a></li>
<li><a href="../229263/index.html">Login to a web application using face recognition</a></li>
<li><a href="../229267/index.html">JBrainfuck - Writing a Brainfuck compiler for Java VM</a></li>
<li><a href="../229273/index.html">Tarantool User Group Meetup in Moscow</a></li>
<li><a href="../229279/index.html">How the SMSDirect system works</a></li>
<li><a href="../229285/index.html">IBM Watson will help cooks to create new recipes using the new application</a></li>
<li><a href="../229287/index.html">Theme for night reading Habrahabr</a></li>
<li><a href="../229289/index.html">The mode of resetting the smartphone to the factory state is not a guarantee of deleting personal information</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>