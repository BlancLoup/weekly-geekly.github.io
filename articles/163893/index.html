<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Solar system on LibCanvas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yesterday there was a great topic, ‚Äú The Story of One Habraspor, ‚Äù about creating a ‚Äúgalaxy‚Äù on HTML5 Canvas, which in itself and its comments inspire...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Solar system on LibCanvas</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/0ca/509/cef/0ca509cefec818b4d5b6bbce9b694c6e.jpg"><br><br>  Yesterday there was a great topic, ‚Äú <a href="http://habrahabr.ru/post/163703/">The Story of One Habraspor,</a> ‚Äù about creating a ‚Äúgalaxy‚Äù on HTML5 Canvas, which in itself and its comments inspired me to the response code.  I thought, before the end of the documentation, not to write new things on Habra, but, as you can see, it failed) Thanks to <a href="https://habrahabr.ru/users/kibizoidus/" class="user_link">kibizoidus</a> for this. <br><br>  In the topic you will see a description of the process of creating a star system on the <a href="https://github.com/theshock/libcanvas">latest version of LibCanvas</a> .  Fast, optimized, briefly. <br><a name="habracut"></a><br>  I must say that the TZ is not fully implemented.  The reason is very simple - having arrived yesterday at 3 am from the Hobbit, I set myself a clear deadline - <b>no more than an hour</b> for everything.  Honestly, I considered adding the cursor change in the morning at breakfast, but these are the details) At the hour I did it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Unlike the previous author, I didn‚Äôt have to create ‚ÄúVirtualhost in my dev-environment, git-repository‚Äù and everything else - all this is always in my battle for <a href="http://libcanvas.github.com/">libcanvas.github.com</a> .  Because I took the standard template and immediately rushed into battle, setting the <a href="">sky</a> as the background, so as not to look at the lonely blackness: <br><br><pre><code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>LibCanvas :: Solar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/files/styles.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">html</span></span></span><span class="css">, </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">body</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">background</span></span></span><span class="css">: </span><span class="hljs-built_in"><span class="css"><span class="hljs-built_in">url</span></span></span><span class="css">(im/sky.png) } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/files/js/atom.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/files/js/libcanvas.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span>Return to index<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">new</span></span></span><span class="actionscript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ LibCanvas.extract(); atom.dom(</span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">new</span></span></span><span class="actionscript"> Solar.Controller(); }); }; </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/controller.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br><h2>  The first steps </h2><br>  First of all, we need to add the application itself.  I‚Äôll say right away that the term was very limited, so I didn‚Äôt bother with architecture and magic numbers and wrong decisions were scattered all over the code, but it would work as an implementation idea.  In addition to creating the application, we immediately add the preloading of two pictures - the <a href="">image of the Sun</a> and the cutting with <a href="">images of all the planets</a> .  We add pictures to the application's resources so that you can always easily reach them. <br><pre> <code class="hljs actionscript"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Controller */</span></span> atom.declare(<span class="hljs-string"><span class="hljs-string">'Solar.Controller'</span></span>, { initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Size(<span class="hljs-number"><span class="hljs-number">840</span></span>, <span class="hljs-number"><span class="hljs-number">840</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.app = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> App({ size: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size }); atom.ImagePreloader.run({ planets: <span class="hljs-string"><span class="hljs-string">'im/planets.png'</span></span>, sun : <span class="hljs-string"><span class="hljs-string">'im/sun.png'</span></span> }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.start.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); }, start: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(images)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// images ready this.app.resources.set( 'images', images ); } });</span></span></code> </pre><br><br>  All astronomical objects we will have on a special layer.  Their peculiarity is that each of them is updated every frame and there is no sense in solving something special with redrawing.  Just set <code>intersection: all</code> so that they all redrawn and <code>invoke: true</code> so that each of them <code>onUpdate</code> method <br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Controller */</span></span> // .. initialize: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> () { // .. this.geoLayer = this.app.createLayer({ <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'geo'</span></span>, invoke: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, intersection: <span class="hljs-string"><span class="hljs-string">'all'</span></span>, zIndex: <span class="hljs-number"><span class="hljs-number">2</span></span> }); // ..</code> </pre><br><br>  The simplest thing we can do is add a drawing of the sun.  It is static and corny in the center of the frame.  Create a class for it that will draw the necessary image to a point, inherit from <code>App.Element</code> so that you can add to the application: <br><pre> <code class="hljs php"><span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@class</span></span></span><span class="hljs-comment"> Solar.Sun */</span></span> atom.<span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(<span class="hljs-string"><span class="hljs-string">'Solar.Sun'</span></span>, App.Element, { renderTo: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx, resources)</span></span></span><span class="hljs-function"> </span></span>{ ctx.drawImage({ image : resources.get(<span class="hljs-string"><span class="hljs-string">'images'</span></span>).get(<span class="hljs-string"><span class="hljs-string">'sun'</span></span>), center: this.shape.center }); } });</code> </pre><br><br>  After that in our controller we create our Sun: <br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Controller */</span></span> // .. <span class="hljs-keyword"><span class="hljs-keyword">start</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (images) { // .. this.sun = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Solar.Sun(this.geoLayer, { shape: <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Circle(this.app.rectangle.center, <span class="hljs-number"><span class="hljs-number">50</span></span>) }); // ..</code> </pre><br><br>  Now we have a lonely Sun in the system: <br><img src="https://habrastorage.org/storage2/a29/722/024/a29722024a9154128547bb68fc107e77.png"><br><br><h2>  Planets </h2><br>  The next target is the planets.  We have 12 planets.  The first will be at a distance of 90 pixels from the center of the system, each next 26 pixels further.  The first passes a circle in 40 seconds, each following for 20 seconds longer.  And every planet has a name <br><br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Controller */</span></span> atom.<span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(<span class="hljs-string"><span class="hljs-string">'Solar.Controller'</span></span>, { names : <span class="hljs-string"><span class="hljs-string">'Selene Mimas Ares Enceladus Tethys Dione Zeus Rhea Titan Janus Hyperion Iapetus'</span></span> .split(<span class="hljs-string"><span class="hljs-string">' '</span></span>), // .. <span class="hljs-keyword"><span class="hljs-keyword">start</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (images) { // .. <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (var i = <span class="hljs-number"><span class="hljs-number">12</span></span>; i<span class="hljs-comment"><span class="hljs-comment">--;) { var planet = new Solar.Planet(this.geoLayer, { sun : this.sun, radius: 90 + i * 26, time : 40 + i * 20, image : i, zIndex: 0, name : this.names[i] }); } // ..</span></span></code> </pre><br><br>  We take the planet into orbit very easily - first we place it in the center of the system, and then we shift it to the right by the radius of the orbit. <br><br><pre> <code class="hljs kotlin"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.center = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.solarCenter.clone(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.center.move([ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius, <span class="hljs-number"><span class="hljs-number">0</span></span> ]);</code> </pre><br><br>  The rotation speed is not more difficult to find - we need to fly 360 degrees in <code>'time'</code> in seconds or 360/1000 in time in milliseconds: <br><br><pre> <code class="hljs kotlin"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rotatePerMs = (<span class="hljs-number"><span class="hljs-number">360</span></span>).degree() / <span class="hljs-number"><span class="hljs-number">1000</span></span> / <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.settings.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'time'</span></span>);</code> </pre><br><br>  The necessary picture from sprites is cut out very simply - we shift to the right by the planet index: <br><br><pre> <code class="hljs kotlin"> getImagePart: function () { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.settings.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'image'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.layer.app.resources.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'images'</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'planets'</span></span>) .sprite(new Rectangle([ x*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size.width,<span class="hljs-number"><span class="hljs-number">0</span></span> ],<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size)); },</code> </pre><br><br>  The process of rotation of the planet itself - simply rotate the center of the planet around the center of the system using the <code>LibCanvas.Point.rotate</code> method.  <code>normalizeAngle</code> needed so that the angle is always between 0 and 360 degrees. <br><br><pre> <code class="hljs kotlin"> rotate: function (angle) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (angle == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) angle = Number.random(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">360</span></span>).degree(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle + angle).normalizeAngle(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.center.rotate(angle, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.solarCenter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; },</code> </pre><br><br>  <code>onUpdate</code> add interactivity - every call to the <code>onUpdate</code> method <code>onUpdate</code> planet, not forgetting to make an amendment for the time that has passed since the previous call.  <code>onUpdate</code> , like <code>onUpdate</code> , are <code>renderTo</code> built into the LibCanvas framework that can be overridden and changed behavior. <br><pre> <code class="hljs actionscript"> onUpdate: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(time)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rotate(time * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rotatePerMs); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redraw(); },</code> </pre><br><br>  And most importantly - add image rendering: <br><br><pre> <code class="hljs actionscript"> renderTo: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx)</span></span></span><span class="hljs-function"> </span></span>{ ctx.drawImage({ image : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.image, center: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.center, angle : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle }); }</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs kotlin"><span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@class</span></span></span><span class="hljs-comment"> Solar.Planet */</span></span> atom.declare(<span class="hljs-string"><span class="hljs-string">'Solar.Planet'</span></span>, App.Element, { angle: <span class="hljs-number"><span class="hljs-number">0</span></span>, configure: function () { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size = new Size(<span class="hljs-number"><span class="hljs-number">26</span></span>, <span class="hljs-number"><span class="hljs-number">26</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.center = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.solarCenter.clone(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.center.move([ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.radius, <span class="hljs-number"><span class="hljs-number">0</span></span> ]); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rotatePerMs = (<span class="hljs-number"><span class="hljs-number">360</span></span>).degree() / <span class="hljs-number"><span class="hljs-number">1000</span></span> / <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.settings.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'time'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape = new Circle(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.center, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size.width/<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.image = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getImagePart(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rotate(); }, getImagePart: function () { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.settings.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'image'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.layer.app.resources.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'images'</span></span>) .<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'planets'</span></span>) .sprite(new Rectangle([x*<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size.width,<span class="hljs-number"><span class="hljs-number">0</span></span>],<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.size)); }, <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> radius () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.settings.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'radius'</span></span>); }, <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> solarCenter () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.settings.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'sun'</span></span>).shape.center; }, rotate: function (angle) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (angle == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) angle = Number.random(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">360</span></span>).degree(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle = (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle + angle).normalizeAngle(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.center.rotate(angle, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.solarCenter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }, onUpdate: function (time) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rotate(time * <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rotatePerMs); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redraw(); }, renderTo: function (ctx) { ctx.drawImage({ image : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.image, center: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.center, angle : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.angle }); } });</code> </pre><br></div></div><br><br>  Now we have planets in the system: <br><img src="https://habrastorage.org/storage2/cc7/45e/6d8/cc745e6d85909691c6a69ec2bb7da260.png"><br><br><h2>  Orbits </h2><br>  The next task is to add orbits.  They have significant differences from the planets, because we will use a different approach and a separate layer. <br>  First, they are static.  Unlike planets, they do not change, or they change very rarely.  In addition to this - they are much larger than the planets and their rendering is resource-intensive, therefore we will produce it as little as possible. <br><br>  Create a layer.  We don‚Äôt need an <code>onUpdate</code> call here, and we will manage the intersections manually.  All the same, these intersections of objects with each other, as we see, especially and no.  In addition, in order not to return, immediately add a method to create an orbit on the planet <br><pre> <code class="hljs lua">/** @class Solar.Controller */ // .. initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { // .. this.orbitLayer = this.app.createLayer({ name: <span class="hljs-string"><span class="hljs-string">'orbit'</span></span>, intersection: <span class="hljs-string"><span class="hljs-string">'manual'</span></span>, zIndex: <span class="hljs-number"><span class="hljs-number">1</span></span> }); // .. start: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(images)</span></span></span></span> { // .. <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (var i = <span class="hljs-number"><span class="hljs-number">12</span></span>; i<span class="hljs-comment"><span class="hljs-comment">--;) { var planet = new Solar.Planet(this.geoLayer, { // .. }); planet.createOrbit(this.orbitLayer, i); // &lt;=== // .. } // ..</span></span></code> </pre><br><br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Planet */</span></span> // .. createOrbit: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (layer, z) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> this.orbit = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Solar.Orbit(layer, { planet: this, zIndex: z }); }, // ..</code> </pre><br><br>  The original orbit code is fairly simple.  Create a <code>Circle</code> , which will be the basis of our drawing, in the <code>renderTo</code> method <code>renderTo</code> simply stroke this circle.  The only thing that has now been added is the <code>clearPrevious</code> method, which changes the principle of cleaning the layer from this object - we do not roughly clear the contents of the BoundingRectangle, but carefully draw the circle stroke using the inverted <code>ctx.clear(this.shape, true)</code> : <br><pre> <code class="hljs actionscript"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Orbit */</span></span> atom.declare(<span class="hljs-string"><span class="hljs-string">'Solar.Orbit'</span></span>, App.Element, { configure: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Circle(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.planet.solarCenter, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.planet.radius); }, <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> planet () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.settings.get(<span class="hljs-string"><span class="hljs-string">'planet'</span></span>); }, clearPrevious: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx)</span></span></span><span class="hljs-function"> </span></span>{ ctx.clear(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); }, renderTo: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx, resources)</span></span></span><span class="hljs-function"> </span></span>{ ctx.stroke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape, <span class="hljs-string"><span class="hljs-string">'rgba(0,192,255,0.5)'</span></span>); } });</code> </pre><br><br>  Now our application has acquired a view close to the final one and it remains to add user interaction. <br><img src="http://habrastorage.org/storage2/671/3cc/022/6713cc02218b1c5ccc509a4e388f3dde.png"><br><br><h2>  Subscribe to the mouse </h2><br>  Create a <code>LibCanvas.Mouse</code> object that catches mouse events of a specific dom element and a <code>LibCanvas.App.MouseHandler</code> object that will process these events and redirect to the corresponding application element. <br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Controller */</span></span> // .. <span class="hljs-keyword"><span class="hljs-keyword">start</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (images) { var mouse, mouseHandler; mouse = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Mouse(this.app.container.bounds); mouseHandler = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> App.MouseHandler({ mouse: mouse, app: this.app }); this.app.resources.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>({ images: images, mouse : mouse, mouseHandler: mouseHandler }); // .. <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (var i = <span class="hljs-number"><span class="hljs-number">12</span></span>; i<span class="hljs-comment"><span class="hljs-comment">--;) { var planet = new Solar.Planet(this.geoLayer, { // .. }); planet.createOrbit(this.orbitLayer, i); mouseHandler.subscribe( planet ); mouseHandler.subscribe( planet.orbit ); } } // ..</span></span></code> </pre><br><br>  The mouse is already caught, but so far we can not notice it.  Let's start with the orbits.  Now she is caught simply if she is inside her.  THOSE.  Any place between the sun and the planet is considered a trigger for the orbit to trigger.  We will change this by overriding the <code>isTriggerPoint</code> method.  Now mouse events will fire into orbit only within 13 pixels from it. <br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Orbit */</span></span> // .. isTriggerPoint: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (<span class="hljs-type"><span class="hljs-type">point</span></span>) { var distance = this.planet.solarCenter.distanceTo(<span class="hljs-type"><span class="hljs-type">point</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (this.planet.radius - distance).abs() &lt; <span class="hljs-number"><span class="hljs-number">13</span></span>; }, // ..</code> </pre><br><br>  Immediately, to check how it works, we activate the hover event using the <code>Clickable</code> behavior and slightly modify the rendering method: <br><br><pre> <code class="hljs lua">/** @class Solar.Orbit */ // .. configure: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { // .. new App.Clickable( this, this.redraw ).start(); }, // .. renderTo: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx, resources)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this.hover) { ctx.stroke(this.shape, <span class="hljs-string"><span class="hljs-string">'rgba(255,64,64,0.8)'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ctx.stroke(this.shape, <span class="hljs-string"><span class="hljs-string">'rgba(0,192,255,0.5)'</span></span>); } } // ..</code> </pre><br><br><img src="http://habrastorage.org/storage2/70a/ad4/7df/70aad47dfbfdaf7d84454e51232ee904.png"><br><br>  Now we see that the orbits change when you hover the mouse.  But when you hover on a planet, the mouse is blocked and no longer reaches the orbit.  Slightly change this behavior by adding a hover to the planet and checking both of these states: <br><br><pre> <code class="hljs lua">/** @class Solar.Orbit */ // .. isHover: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> this.hover || this.planet.hover; }, renderTo: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx, resources)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this.isHover()) { // .. } // ..</code> </pre><br><br>  And since  when hovering over the planet, we still need to redraw the orbit every frame (the circle around the planet is shifted) - add <code>redraw</code> to <code>onUpdate</code> <br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Planet */</span></span> // .. configure: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> () { // .. <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> App.Clickable( this, this.redraw ).<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>(); }, // .. onUpdate: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (<span class="hljs-type"><span class="hljs-type">time</span></span>) { // .. <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this.orbit.isHover()) this.orbit.redraw(); }, // ..</code> </pre><br><br>  Now the planet does not block the hover and we can do orbit styling.  We will perform the task very easily.  First draw the orbit.  Then erase the shape of the planet, and then trace the shape of the planet.  Thus it will turn out quickly and relaxed to achieve the result: <br><br><pre> <code class="hljs lua">/** @class Solar.Orbit */ // .. renderTo: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx, resources)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this.isHover()) { ctx.save(); ctx.set({ strokeStyle: <span class="hljs-string"><span class="hljs-string">'rgb(0,192,255)'</span></span>, lineWidth: <span class="hljs-number"><span class="hljs-number">3</span></span> }); ctx.stroke(this.shape); ctx.clear(this.planet.shape); ctx.stroke(this.planet.shape); ctx.restore(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ctx.stroke(this.shape, <span class="hljs-string"><span class="hljs-string">'rgba(0,192,255,0.5)'</span></span>); } }</code> </pre><br><br>  But here we will be in trouble - our "cleaner" knows nothing about the thickness of the orbit, especially, that it still has a "hernia" from the planet.  We redefine the next LibCanvas method, <code>saveCurrentBoundingShape</code> , which will save exactly where the hernia was last, if any, at all.  It will also be called when necessary automatically: <br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Orbit */</span></span> // .. saveCurrentBoundingShape: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> () { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this.isHover()) { this.previousBoundingShape = this.planet.shape.clone().grow(<span class="hljs-number"><span class="hljs-number">6</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { this.previousBoundingShape = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> this; },</code> </pre><br><br>  Now we can inform our cleaner about new conditions.  If there was no hernia, we clean it old.  Otherwise, we increase the thickness in order to erase well, clean the hernia and then restore the canvas settings: <br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Orbit */</span></span> // .. clearPrevious: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (ctx) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this.previousBoundingShape) { ctx.save(); ctx.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>({ lineWidth: <span class="hljs-number"><span class="hljs-number">4</span></span> }); ctx.clear(this.previousBoundingShape); ctx.clear(this.shape, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); ctx.restore(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ctx.clear(this.shape, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } },</code> </pre><br><br>  The result is exactly expected: <br><img src="http://habrastorage.org/storage2/e12/1b8/8e9/e121b88e96e98eae834b189e09b50140.png"><br><br><h2>  Information about the planet </h2><br>  The last thing to add is a pop-up window with the name of the planet.  We could subscribe to the mouse over and <code>mouseout</code> on <code>Solar.Planet</code> , but they only work when the mouse is moving, i.e.  if the planet leaves the stationary mouse, the <code>mouseout</code> will not work.  Therefore, we take the point of the mouse and every frame we check if it is located above our planet. <br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Planet */</span></span> // .. configure: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> () { // .. this.mousePoint = this.layer.app.resources.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'mouse'</span></span>).point; this.<span class="hljs-keyword"><span class="hljs-keyword">info</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Solar.<span class="hljs-keyword"><span class="hljs-keyword">Info</span></span>(this.layer, { planet: this, zIndex: <span class="hljs-number"><span class="hljs-number">1</span></span> }); }, checkStatus: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (visible) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this.<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>.isVisible() != visible) { this.<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>[visible ? <span class="hljs-string"><span class="hljs-string">'show'</span></span> : <span class="hljs-string"><span class="hljs-string">'hide'</span></span>](); } }, onUpdate: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (<span class="hljs-type"><span class="hljs-type">time</span></span>) { // .. this.checkStatus(this.isTriggerPoint(this.mousePoint)); //        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this.<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>.isVisible()) this.<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>.updateShape(this.shape.center); }, // ..</code> </pre><br><br>  <code>settings: { hidden: true }</code> is one of the LibCanvas settings.  This element will not participate in drawing in any way, but it still catches mouse events if it is signed.  Therefore, we create a simple and logical class <code>Solar.Info</code> using this feature. <br><br><pre> <code class="hljs actionscript"><span class="hljs-comment"><span class="hljs-comment">/** @class Solar.Info */</span></span> atom.declare(<span class="hljs-string"><span class="hljs-string">'Solar.Info'</span></span>, App.Element, { settings: { hidden: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> planet () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.settings.get(<span class="hljs-string"><span class="hljs-string">'planet'</span></span>); }, configure: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>); }, updateShape: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape.moveTo(from).move([<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>]) }, show: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.settings.set({ hidden: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redraw(); }, hide: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.settings.set({ hidden: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.redraw(); }, renderTo: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx)</span></span></span><span class="hljs-function"> </span></span>{ ctx.fill(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape, <span class="hljs-string"><span class="hljs-string">'#002244'</span></span>); ctx.text({ to : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape, text : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.planet.settings.get(<span class="hljs-string"><span class="hljs-string">'name'</span></span>), color: <span class="hljs-string"><span class="hljs-string">'#0ff'</span></span>, align: <span class="hljs-string"><span class="hljs-string">'center'</span></span>, optimize: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, padding: <span class="hljs-number"><span class="hljs-number">3</span></span> }) } });</code> </pre><br><br>  And we get a predictable result: <br><img src="http://habrastorage.org/storage2/9d5/1b8/a2f/9d51b8a2faab4ee691f6f94102336f70.png"><br>  The only thing that remains is to add a change in the mouse cursor when hovering over the planet: <br><pre> <code class="hljs markdown">/<span class="hljs-emphasis"><span class="hljs-emphasis">** @class Solar.Planet *</span></span>/ // .. checkStatus: function (visible) { if (this.info.isVisible() != visible) { this.info[<span class="hljs-string"><span class="hljs-string">visible ? 'show' : 'hide'</span></span>](<span class="hljs-link"></span><span class="hljs-link"></span>); this.layer.dom.element.css('cursor', visible ? 'pointer' : 'default'); } }, // ..</code> </pre><br><br><h2>  Result </h2><br>  We watch <a href="http://libcanvas.github.com/games/solar/"><b>result on GitHub</b></a> , and also <a href="https://github.com/libcanvas/libcanvas.github.com/blob/master/games/solar/">source codes</a> . <br><br>  Also comparable to the solution from the previous topic: <br>  1. Significantly less code <br>  2. Significantly higher performance <br><br>  Check in profile.  The higher the percentage <code>(program)</code> - the better.  On an empty application, it reaches 100%. <br><br>  Original version: <br><img src="http://funkyimg.com/u2/2832/173/456065default-solar-profile.png"><br><br>  Version on LibCanvas: <br><img src="http://funkyimg.com/u2/2832/175/960663libcanvas-solar-profile.png"><br><br>  Blank tab: <br><img src="http://habrastorage.org/storage2/e05/164/c7c/e05164c7c24b25df8479e83276352af2.png"><br><br>  I also checked the actual performance on a weak laptop (FPS / load of one core of the kernel): <br><br>  Original version - download up to 100%, 44 fps: <br><img src="http://funkyimg.com/u2/2832/172/184318default-solar-fps.png"><br><br>  LibCanvas version - download up to 40%, stable 60 fps: <br><img src="http://funkyimg.com/u2/2832/174/315660libcanvas-solar-fps.png"><br><br>  Write code in pleasure, use good tools, enjoy.  If you have questions, but you do not have the opportunity to ask on Habr√© - write to email shocksilien@gmail.com </div><p>Source: <a href="https://habr.com/ru/post/163893/">https://habr.com/ru/post/163893/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../163881/index.html">CORE Design Technique</a></li>
<li><a href="../163883/index.html">Read more about Sikuli in test automation</a></li>
<li><a href="../163885/index.html">Using Filters from Box2D in Libgdx</a></li>
<li><a href="../163889/index.html">The authorities of one of the lands of Germany obliged Facebook to allow users to use pseudonyms</a></li>
<li><a href="../163891/index.html">Opened catalog of applications for Raspberry Pi</a></li>
<li><a href="../163895/index.html">Automatic analysis of code coverage using OpenCover + buns</a></li>
<li><a href="../163897/index.html">Offline informer for online business</a></li>
<li><a href="../163899/index.html">PyCon in Russia: let it be</a></li>
<li><a href="../163901/index.html">China tightens Internet access rules</a></li>
<li><a href="../163903/index.html">Latency when loading web pages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>