<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We rule bug without source codes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article, we discussed how reverse engineering can help in gaining any advantages over other users. Today we will talk about one more a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We rule bug without source codes</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/96c/cfb/9b6/96ccfb9b6c80f0aac8a5a460de064f04.png" alt="image"><br><br>  In the <a href="http://habrahabr.ru/post/257125/">previous article,</a> we discussed how reverse engineering can help in gaining any advantages over other users.  Today we will talk about one more application of reverse engineering - fixing bugs in the absence of application source codes.  The reasons for doing such things can be the whole sea - the development of the program has long been abandoned, and the author has not provided the public with it. The development is carried out in a completely different way, and the authors do not care about your bug / etc, but they are united by a common The goal is to fix broken functionality that constantly annoys you. <br><br>  Well, more to the point.  There is such a widely known program in narrow circles called <a href="http://www.vector-ski.ru/vecs/govorilka/">‚ÄúGovorilka‚Äù</a> .  As the author explains, this is nothing more than a ‚Äúvoice reading program‚Äù.  In fact, the way it is.  With the help of it, a lot of popular and not-so-wide videos were distributed throughout the network.  The program has a console version called <a href="http://www.vector-ski.ru/vecs/govorilka/govorilka_cp.htm">‚ÄúGovorilka_cp‚Äù</a> , which is convenient to call from your own applications, which, in fact, I did in one of my projects. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Unfortunately, in the process of distributing my software, a rather strange moment was discovered - on some machines a talker falls absolutely on any phrases, and the fall was caused not by my interaction with this program, but by the talker itself.  In an attempt to find out as much detail as possible about the error that was occurring, I discovered that on two seemingly completely identical systems, the talker behaves in the opposite way ‚Äî on the one it works stably without any errors, and on the other it falls on every report sent to it. as an argument to the phrase.  This situation was pretty much bothering me, and I decided to deal with this problem at all costs. <br><br>  Considering that the speaker has not been updated for several years, and the author himself left this ‚Äúmessage‚Äù on his website <br><br><img src="https://habrastorage.org/getpro/habr/post_images/296/9f7/89c/2969f789c5ffd6d98a21111d20e0a032.png" alt="image"><br><br>  , I realized that I had no hope in anyone, and I would have to solve the problem myself. <br><br>  How was the process, and what came of it, read under the cut (carefully, a <b>lot of screenshots</b> ). <br><a name="habracut"></a><br>  Before loading the speaker to <a href="http://www.ollydbg.de/">OllyDbg</a> , let's see if it is protected by some protector.  We take in the hands of <a href="https://tuts4you.com/download.php%3Fview.3518">DiE</a> and see the following picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a3/8c6/d54/5a38c6d54a52ffb824eaab7a0964b3c6.png" alt="image"><br><br>  Judging by his conclusion, the program is packed with <a href="http://www.aspack.com/">ASPack</a> .  For credibility, we will use another analyzer - <a href="https://tuts4you.com/download.php%3Fview.398">PEiD</a> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f6d/8f7/de9/f6d8f7de997c04ff803e269e5cd45473.png" alt="image"><br><br>  Hoping that two analyzers cannot be wrong at the same time, we come to the conclusion that the talker is really covered with ASPack.  Well, nothing, let's take it off. <br><br>  Getting rid of an executable file from ASPack can be divided into three main stages: <br><ul><li>  Search OEP (Original Entry Point - the address from which the program would start if it were not packed) </li><li>  Dumping </li><li>  <a href="http://sandsprite.com/CodeStuff/Understanding_imports.html">IAT</a> Recovery </li></ul><br>  We begin, of course, with the OEP search.  One of the easiest ways to find the original entry point is to put a hardware breakpoint on <b>ESP-4</b> , because most of the packers restore the stack after their work.  We start the talker in OllyDbg, open the Command Line with Alt-F1 (the window of the standard plug-in that comes with the debugger itself), enter the command <b>hr esp-4</b> , press F9 and stop at this place: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/48a/c29/34f/48ac2934fb4c6c2d5a5661bbe4374897.png" alt="image"><br><br>  Now we need to go to the nearest return using Ctrl-F9, press F8 and ... find ourselves in OEP, which in this case is located at <b>0x0045A210</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f5/f5d/3f5/2f5f5d3f5c5260ca5f8c912da0ea6c00.png" alt="image"><br><br>  It's time to take a dump.  Download and install a plugin for OllyDbg called <a href="https://tuts4you.com/download.php%3Fview.88">OllyDump</a> , restart debugging with Ctrl-F2, stop at OEP again and select the menu item ‚ÄúDump debugged process‚Äù located in Plugins -&gt; OllyDump: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57c/42d/79c/57c42d79cd8404e1dc32adea90c59ec8.png" alt="image"><br><br>  Press the "Dump" button, select the name of the output executable file and ... we get this when trying to start it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bdc/cc3/f48/bdccc3f48716f0de1ad0e809eaf6a90a.png" alt="image"><br><br>  It means that something is wrong with imports.  Nothing, restore them manually. <br><br>  Dump the talker process again, but this time we remove the checkmark from the Rebuild Import Checkbox.  Download <a href="http://www.woodmann.com/collaborative/tools/index.php/ImpREC">ImpREC</a> , select the talk process from the list, enter the address <b>5A210</b> in the field for OEP - <b>0x0045A210</b> - image base ( <b>0x400000</b> ) = <b>0x5A210</b> and click on the "IAT AutoSearch" button: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2df/4d3/8ac/2df4d38ace48ab692f91dc471d58cad1.png" alt="image"><br><br>  We do, as they said, and see the following picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/53a/5a0/6ad/53a5a06ad251e5587f082ccd198b8832.png" alt="image"><br><br>  Obviously, this is not normal.  We try to specify the RVA and size, which the program itself offered us to use in case of failure, and click on the ‚ÄúGet Imports‚Äù button again: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae9/39d/057/ae939d05709c8a30ed8ba4fcc140e96e.png" alt="image"><br><br>  Something is clearly not going as expected.  Let's try to find the boundaries of IAT manually.  We are looking for a call to any WinAPI function in the disassembled listing.  For example, this one: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d7f/549/13a/d7f54913a0ebc302644de15a09b45ca4.png" alt="image"><br><br>  Jump on it (left click -&gt; Enter) and see where all the JMPs are going: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a16/f9e/3ad/a16f9e3adc3fbf1d2b9eae9b99e8eca4.png" alt="image"><br><br>  Go to any of the addresses specified in this place (right-click -&gt; Follow in Dump -&gt; Memory address), select the appropriate view (right-click on the Memory Dump window -&gt; Long -&gt; Address) and see the following: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6cf/71b/5d4/6cf71b5d43fe22497d117765ffc50380.png" alt="image"><br><br>  We run our eyes to the beginning of the list of addresses of functions: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fe8/cf1/e00/fe8cf1e0038046733cd99fdbf8e916bc.png" alt="image"><br><br>  Double-click on <b>ntdll.RtlDeleteCriticalSection</b> and look for the end of the list: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/787/921/4f3/7879214f35d731bbc470def174a0e7ce.png" alt="image"><br><br>  Specify the start address of IAT ( <b>0005F168</b> ) and size ( <b>0000066C</b> ), again click on the ‚ÄúGet Imports‚Äù button and get the following result: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/40d/48c/abb/40d48cabbfb3e2d948702dbc08cf8b58.png" alt="image"><br><br>  Already better, but still there are invalid imports, and the strangest thing is that we seem to have done everything correctly ... Let's use another application for IAT rebuilding - <a href="https://tuts4you.com/download.php%3Fview.3503">Scylla</a> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/af9/39e/123/af939e123598711b3948d673e5a7b867.png" alt="image"><br><br>  What is going on?  And let's try to do the same thing on another system - for example, in Windows 7 x32 (before this, experiments were conducted in Windows 8 x64). <br><br>  In a miraculous way, we got valid imports: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/94e/1ad/20c/94e1ad20c545faa4dff831affba70289.png" alt="image"><br><br>  Honestly, I'm not sure that this is a bug of ImpRec and Scylla, a feature of Windows 8 x64 or something else, but the main thing is that we restored the IAT.  More precisely, for this we need to click on the ‚ÄúFix Dump‚Äù button, select the dump made earlier and try to run the resulting executable file.  Yes, when launching a speaker without arguments, it works as it should be, but in the case of the transfer of any phrases for dubbing, it falls, as in the packed version. <br><br>  So ASPack is filmed.  What's next?  And then, in fact, we have to deal with a bug arising on some computers. <br><br>  First of all, let's take a look at the standard Windows window, which reports that the application is more beautiful: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed0/f43/4a8/ed0f434a8a2b8aa6a9381c77531a158e.png" alt="image"><br><br>  You should notice that Exception Offset is <b>0x000591D4</b> .  We load the govorilka into OllyDbg, put the software breakpoint on this address (more precisely, on the image base + <b>0x000591D4</b> - in my case it is <b>0x004591D4</b> ), press F9 and we get the following: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/636/fd6/b47/636fd6b474999103f10ec0f9466655f0.png" alt="image"><br><br>  As you can see, the value of the <b>ESI</b> register at the time of the read operation at <b>ESI + 38</b> is zero, which, of course, causes the application to crash.  Two instructions above noticeably that the value in <b>ESI</b> falls from the <b>EAX</b> register.  The value of the <b>EAX</b> register before this procedure does not change, so we look at the Call Stack, from where we were called: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fcc/936/b49/fcc936b49189048eeb357b5439f45011.png" alt="image"><br><br>  Jump there (right click -&gt; Show Call) and see that just before the procedure call is the command <b>MOV EAX, DWORD PTR DS: [45EC5C]</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/63a/822/60f/63a82260f589c47bc1f639e1a23d6094.png" alt="image"><br><br>  As can be seen from the previous screenshot, at the address <b>0x45EC5C is</b> also zero.  We put a hardlock breakpoint on the record at this address (right click -&gt; Breakpoint -&gt; Hardware, on write -&gt; Dword), run the application again and find that no entry is made at this address.  Let's analyze how an application behaves if it is successful in another system.  The entry at <b>0x45EC5C</b> in this case does occur: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2fb/1bc/5b3/2fb1bc5b373263fd36847b130a52de3d.png" alt="image"><br><br>  , with the result that <b>ESI + 38</b> gives some meaningful meaning.  Let's find out how we got to this place.  Call Stack at the time of execution of this instruction is empty, so I had the impression that this is the main procedure of the program.  To understand exactly where the application began to behave differently, let's run Trace over (Ctrl-F12) on both systems (where the application crashes and where it works). <br><br>  In the case of a system where the application is constantly falling, it reached a bang on access to <b>ESI + 38</b> , where it fell.  The last line of code in the trace log was <b>CALL</b> at <b>0x004597C8</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd7/af9/ad2/fd7af9ad288ccae42b639c70b0dd59eb.png" alt="image"><br><br>  while in the system where the application is working normally, after calling this procedure ( <b>0x004597C8</b> ), other instructions are executed, on one of which the hardware breakpoint is triggered at the address <b>0x45EC5C</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d4/89c/c28/6d489cc28c81b3ca4555444456c24a8c.png" alt="image"><br><br>  Perhaps something goes wrong in the procedure <b>0x004597C8</b> .  We put a software breakpoint on its call ( <b>0x0045AD5B</b> ) and find that installing it leads to the fact that on the system where everything worked fine, the hardware breakpoint does not work at the address <b>0x45EC5C</b> , as a result of which the application crashes, as in the case another system.  With hardware breyk to perform everything is the same. <br><br>  It was experimentally found that installing breakpoints on several preceding <b>0x0045AD5B</b> instructions leads to the same result.  Install the breakpoint with the subsequent normal operation of the application was obtained only on this instruction: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f3/547/44a/1f354744a93f0ec9edd218234c846982.png" alt="image"><br><br>  Perhaps, by installing breakpoints in these places, we interfered with the measurement of time, which is exactly what is done with the help of calls to the <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms724408(v%3Dvs.85).aspx">GetTickCount</a> function. <br><br>  We start Trace into (Ctrl-F11), starting with this instruction, and we find out that the differences in execution start from this place: <br><br><pre><code class="hljs objectivec">;     ,    <span class="hljs-number"><span class="hljs-number">004597</span></span>EC Main MOV EAX,DWORD PTR DS:[<span class="hljs-number"><span class="hljs-number">45</span></span>EC98] ; EAX=F2B47801 <span class="hljs-number"><span class="hljs-number">004597</span></span>F1 Main ADD EAX,<span class="hljs-number"><span class="hljs-number">64</span></span> ; EAX=F2B47865 <span class="hljs-number"><span class="hljs-number">004597</span></span>F4 Main CDQ ; EDX=FFFFFFFF <span class="hljs-number"><span class="hljs-number">004597</span></span>F5 Main <span class="hljs-built_in"><span class="hljs-built_in">CMP</span></span> EDX,DWORD PTR SS:[ESP+<span class="hljs-number"><span class="hljs-number">4</span></span>] <span class="hljs-number"><span class="hljs-number">004597</span></span>F9 Main JNZ SHORT Govorilk<span class="hljs-number"><span class="hljs-number">.00459807</span></span> <span class="hljs-number"><span class="hljs-number">00459807</span></span> Main POP EDX ; EDX=F2B47802</code> </pre> <br><pre> <code class="hljs objectivec">;     ,     <span class="hljs-number"><span class="hljs-number">004597</span></span>EC Main MOV EAX,DWORD PTR DS:[<span class="hljs-number"><span class="hljs-number">45</span></span>EC98] <span class="hljs-number"><span class="hljs-number">004597</span></span>F1 Main ADD EAX,<span class="hljs-number"><span class="hljs-number">64</span></span> ; EAX=<span class="hljs-number"><span class="hljs-number">064</span></span>A1501 <span class="hljs-number"><span class="hljs-number">004597</span></span>F4 Main CDQ <span class="hljs-number"><span class="hljs-number">004597</span></span>F5 Main <span class="hljs-built_in"><span class="hljs-built_in">CMP</span></span> EDX,DWORD PTR SS:[ESP+<span class="hljs-number"><span class="hljs-number">4</span></span>] <span class="hljs-number"><span class="hljs-number">004597</span></span>F9 Main JNZ SHORT Govorilk<span class="hljs-number"><span class="hljs-number">.00459807</span></span> <span class="hljs-number"><span class="hljs-number">004597</span></span>FB Main <span class="hljs-built_in"><span class="hljs-built_in">CMP</span></span> EAX,DWORD PTR SS:[ESP]</code> </pre><br>  Hence, it is noticeable that the result of executing the instruction <b>CMP EDX, DWORD PTR SS: [ESP + 4]</b> influences the further work of the procedure.  In the case of the system where it works, the flag register flag Z was set at the time of execution of this instruction, while in the case of the system where the application crashes, this flag was not set: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/28d/a3f/77a/28da3f77a042e58b9733a3eac3a3cd65.png" alt="image"><br><br>  Let's see what affects it.  So, what is happening here? <br><br><ul><li>  The <b>GetTickCount</b> function is <b>called</b> , the result of its call is written to the <b>EAX</b> register. </li><li>  <b>EDX</b> register contents reset </li><li>  The contents of the <b>EDX</b> ( <b>0x0</b> ) and <b>EAX</b> registers (the result of the <b>GetTickCount</b> function) are <b>pushed</b> onto the stack. </li><li>  <b>EAX</b> registers the value from address <b>0x45EC98</b> </li><li>  <b>0x64 is</b> added to <b>it.</b> </li><li>  <a href="http://web.itu.edu.tr/kesgin/mul06/intel/instr/cdq.html">CDQ</a> instruction in <a href="http://web.itu.edu.tr/kesgin/mul06/intel/instr/cdq.html">progress</a> </li><li>  Finally, the content of the <b>EDX</b> register is compared with the value at the <b>ESP-4</b> address where the previous value of this register is stored, i.e.  <b>0x0</b> </li></ul><br>  Putting the hardware breakpoint on the record at <b>0x45EC98</b> , you can see that the result of the <b>GetTickCount</b> function is also placed <b>there</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/750/7bb/30d/7507bb30de5963d2865c8414c0147607.png" alt="image"><br><br>  By the way, why does <b>GetTickCount</b> return so much value?  After all, the system was turned off by me even this morning.  In fact, hybrid boot and shutdown play a role here in Windows 8. You can read more about it, for example, <a href="http://www.techopedia.com/definition/29080/hybrid-boot-windows-8">here</a> . <br><br>  But back to the main topic of our discussion.  What is the problem then?  Let's take a closer look at the contents of general registers in this piece of code on both systems.  You should notice that after executing the <b>CDQ</b> instruction on the system where the application is working correctly, the <b>EDX</b> register takes the value <b>0x0</b> , and in the system where the program crashes, <b>0xFFFFFFFF</b> , as can be seen, for example, in the previous screenshot.  Carefully read the description of the instructions <b>CDQ</b> : <br><br><blockquote>  Converts a <b>signed</b> word in EDX: EAX by EAX through EDX </blockquote><br>  And now let's take a look at the signature of the GetTickCount function: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">DWORD WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTickCount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  As you can see, it returns a <b>DWORD</b> that is ‚Äúexpanded‚Äù in an unsigned long, i.e.  <b>unsigned</b> type <br><br>  I don‚Äôt know if the bug is a developer or compiler, but the author obviously didn‚Äôt count on such behavior, because in the current situation, the talk will fall on systems that run longer than 24.8 and less than 49.7 days.  Why so?  The lower limit is determined by the maximum value that can fit in the signed 4-byte variable - 2147483647: <br><br>  2147483647/1000/60/60/24 = 24.8551348032 <br><br>  The upper bound is determined by the <b>GetTickCount</b> function <b>itself</b> , which is described in the documentation (in fact, it is determined by the maximum value that can fit into an unsigned 4-byte variable): <br><br><blockquote>  The elapsed time is stored as a DWORD value.  Therefore, the system will run continuously for 49.7 days. </blockquote><br>  Well, it's time to fix this assumption.  One of the ways to correct the problem is to somehow ‚Äúreplace‚Äù the call to the <b>GetTickCount</b> function <b>with</b> our code, in which we will ‚Äúreduce‚Äù the value returned from it so that it fits into a significant 4-byte variable. <br><br>  There are several options for solving this problem, but let's write a code cave.  We are looking for free space (the easiest way is to find it at the ‚Äúend‚Äù of the CPU window) and put the following code there: <br><br><pre> <code class="hljs 1c">;  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>      <span class="hljs-number"><span class="hljs-number">0045</span></span>BAAA <span class="hljs-number"><span class="hljs-number">60</span></span> PUSHAD ;  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>     <span class="hljs-number"><span class="hljs-number">0045</span></span>BAAB <span class="hljs-number"><span class="hljs-number">9</span></span>C PUSHFD ;   EIP <span class="hljs-number"><span class="hljs-number">0045</span></span>BAAC E8 <span class="hljs-number"><span class="hljs-number">00000000</span></span> CALL Govorilk.<span class="hljs-number"><span class="hljs-number">0045</span></span>BAB1 <span class="hljs-number"><span class="hljs-number">0045</span></span>BAB1 <span class="hljs-number"><span class="hljs-number">5</span></span>E POP ESI ;   GetTickCount <span class="hljs-number"><span class="hljs-number">0045</span></span>BAB2 FF96 <span class="hljs-number"><span class="hljs-number">2</span></span>F380000 CALL DWORD PTR DS:[ESI+<span class="hljs-number"><span class="hljs-number">382</span></span>F] ;      <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  ESP-<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0045</span></span>BAB8 <span class="hljs-number"><span class="hljs-number">894424</span></span> FC MOV DWORD PTR SS:[ESP-<span class="hljs-number"><span class="hljs-number">4</span></span>],EAX ;  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>   <span class="hljs-number"><span class="hljs-number">0045</span></span>BABC <span class="hljs-number"><span class="hljs-number">9</span></span>D POPFD ;  <span class="hljs-built_in"><span class="hljs-built_in"></span></span>    <span class="hljs-number"><span class="hljs-number">0045</span></span>BABD <span class="hljs-number"><span class="hljs-number">61</span></span> POPAD ;    EAX    GetTickCount <span class="hljs-number"><span class="hljs-number">0045</span></span>BABE <span class="hljs-number"><span class="hljs-number">8</span></span>B4424 D8 MOV EAX,DWORD PTR SS:[ESP-<span class="hljs-number"><span class="hljs-number">28</span></span>] ;    <span class="hljs-string"><span class="hljs-string">"AND"</span></span>  ,    EAX <span class="hljs-number"><span class="hljs-number">0045</span></span>BAC2 <span class="hljs-number"><span class="hljs-number">25</span></span> FFFFFF0F AND EAX,<span class="hljs-number"><span class="hljs-number">0</span></span>FFFFFFF <span class="hljs-number"><span class="hljs-number">0045</span></span>BAC7 C3 RETN</code> </pre><br>  The value of <b>382F</b> was obtained by calculating the difference between the address in the IAT, which stores the address of the <b>GetTickCount</b> function ( <b>0x0045F2E0</b> ), and the current address ( <b>0x0045BAB1</b> ). <br><br>  To get the value of the <b>EIP</b> register directly will not work - it can not be accessed either for reading or writing. <br><br>  Now go to the place where <b>JMP is</b> implemented on the function <b>GetTickCount</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/18f/79e/feb/18f79efebb83179826b9ca6cad0cb54a.png" alt="image"><br><br>  and replace the address to which the <b>JMP</b> jumps to the start address of our code cave (in my case it is <b>0x0045BAAA</b> ): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/848/bc0/866/848bc086621e65b2b2e954437449c1b0.png" alt="image"><br><br>  Save the modified executable file (right-click on the CPU window -&gt; Copy to executable -&gt; All modifications -&gt; Copy all -&gt; right-click on the appeared window -&gt; Save file) and check its performance.  Yes, it does work, but when you start talking, the UAC window, familiar to almost all Windows users, is now displayed.  Why this is happening can be read, for example, <a href="http://reverseengineering.stackexchange.com/questions/4381/ollydbg-causes-executables-saved-by-it-to-ask-for-administrator-privileges-when">here</a> , and to solve the problem in our case, it is enough just to give our executable file the original name - ‚ÄúGovorilka_cp.exe‚Äù. <br><br><h3>  Afterword </h3><br>  As you can see, reverse engineering can be used not only for cheating or searching for vulnerabilities, but also for quite useful purposes.  Try to correct the problems, and not to score on them - it is quite possible that in the process of correcting the next mistake you will discover something new.  And I, in turn, again hope that the article was useful to someone. <br><br>  I also express my <b>deep</b> gratitude to the person with the nickname <b>tihiy_grom</b> - without him this article simply would not exist. </div><p>Source: <a href="https://habr.com/ru/post/257591/">https://habr.com/ru/post/257591/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257581/index.html">The ‚ÄúLedger‚Äù of Nutanix Bible is now available in Russian.</a></li>
<li><a href="../257583/index.html">Ways to Improve Reference Profile Performance</a></li>
<li><a href="../257585/index.html">PushAll - platform for sending instant notifications</a></li>
<li><a href="../257587/index.html">Simple quadcopter repair (with microscope)</a></li>
<li><a href="../257589/index.html">User videos: MacOS inside ReactOS</a></li>
<li><a href="../257593/index.html">ExpvarMon - console monitoring of services on Go</a></li>
<li><a href="../257603/index.html">Dizdok, or writing project documentation</a></li>
<li><a href="../257605/index.html">EMCSSL - WWW user identification system based on the NVS cryptocurrency subsystem EmerCoin and decentralized client SSL certificates</a></li>
<li><a href="../257607/index.html">Layered menu for Arduino and not only</a></li>
<li><a href="../257609/index.html">How to translate an entire site to permanent HTTPS for all</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>