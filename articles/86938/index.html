<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ActiveModel: let any Ruby object feel like ActiveRecord</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yehuda Katz posted this entry on his blog on January 10, 2010. 

 A huge amount of really good functionality of Rails 2.3 is hidden in its monolithic ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ActiveModel: let any Ruby object feel like ActiveRecord</h1><div class="post__text post__text-html js-mediator-article">  <i>Yehuda Katz posted this entry on his blog on January 10, 2010.</i> <br><br>  A huge amount of really good functionality of Rails 2.3 is hidden in its monolithic components.  I have already published several messages about how we have simplified the code of the router, the dispatcher and some parts of the ActionController, partially reorganizing the functionality of the ActionPack.  ActiveModel is another module that appeared in Rails 3 after the reorganization of useful functionality. <br><a name="habracut"></a><br><br><h4>  For starters, the ActiveModel API </h4><br>  ActiveModel has two main elements.  The first is an API, an interface to which models must conform to for compatibility with ActionPack helpers.  Then I will tell you more about it, but first an important detail: your model can be made similar to ActiveModel without a single line of Rails-code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To make sure that your models are suitable for this, ActiveModel offers the <code>ActiveModel::Lint</code> module for testing compatibility with the API - you just need to plug it in (to tackle) the test: <br><br><blockquote> <code><a href="http://s-c.me/5954/s"></a> <a href="http://s-c.me/5954/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">LintTest</font> &lt; ActiveModel::TestCase&lt;br/&gt; <font color="#0000ff">include</font> ActiveModel::Lint::Tests&lt;br/&gt; &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">CompliantModel</font> &lt;br/&gt;    extend ActiveModel::Naming&lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">to_model</font> &lt;br/&gt; <font color="#0000ff">self</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">valid</font> ?() <font color="#0000ff">true end</font> &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">new_record</font> ?() <font color="#0000ff">true end</font> &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">destroyed</font> ?() <font color="#0000ff">true end</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">errors</font> &lt;br/&gt; <font color="#cc6633">obj</font> = <font color="#cc6633">Object</font> .new&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">obj</font> .[](key) [] <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">obj</font> .full_messages() [] <font color="#0000ff">end</font> &lt;br/&gt; <font color="#cc6633">obj</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">setup</font> &lt;br/&gt;    @model = <font color="#cc6633">CompliantModel</font> .new&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote> <br>  Tests of the <code>ActiveModel::Lint::Tests</code> module check compatibility of the <code>@model</code> object. <br><br><h4>  ActiveModel Modules </h4><br>  The second interesting part of ActiveModel is a set of modules for implementing standard functionality in your own models.  The code for them was removed from ActiveRecord, and now they are separately included in it by themselves. <br><br>  Since we ourselves use these modules, you can be sure that the API functions that you add to your models will remain compatible with ActiveRecord, and that they will be supported in future releases of Rails. <br><br>  The built-in internationalization in ActiveModel gives the community ample opportunity to work on translating error messages and the like. <br><br><h4>  Validation system </h4><br>  Validation was probably one of the most disappointing places for ActiveRecord because people who wrote libraries, for example, for CouchDB, had to choose between literal rewriting of the API with the ability to introduce different inconsistencies in the rewriting process and inventing a completely new API. <br><br>  There are several new elements in validation. <br><br>  First, the declaration of the validation itself.  Do you remember how it was before in ActiveRecord: <br><blockquote> <code><a href="http://s-c.me/5955/s"></a> <a href="http://s-c.me/5955/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Person</font> &lt; <font color="#cc6633">ActiveRecord::Base</font> &lt;br/&gt;  validates_presence_of :first_name, :last_name&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;        Ruby,   :&lt;br/&gt; &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Person</font> &lt;br/&gt; <font color="#0000ff">include</font> ActiveModel::Validations&lt;br/&gt; &lt;br/&gt;  validates_presence_of :first_name, :last_name&lt;br/&gt; &lt;br/&gt;  attr_accessor :first_name, :last_name&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">initialize</font> (first_name, last_name)&lt;br/&gt;    @first_name, @last_name = first_name, last_name&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote> <br>  The validation system calls <code>read_attribute_for_validation</code> to get the attribute, but by default it‚Äôs just an alias for <code>send</code> that supports the standard Ruby attribute system via <code>attr_accessor</code> . <br><br>  To change the attribute search method, you can override <code>read_attribute_for_validation</code> : <br><blockquote> <code><a href="http://s-c.me/5957/s"></a> <a href="http://s-c.me/5957/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Person</font> &lt;br/&gt; <font color="#0000ff">include</font> ActiveModel::Validations&lt;br/&gt; &lt;br/&gt;  validates_presence_of :first_name, :last_name&lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">initialize</font> (attributes = {})&lt;br/&gt;    @attributes = attributes&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">read_attribute_for_validation</font> (key)&lt;br/&gt;    @attributes[key]&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote> <br>  Let's see what a validator is.  First of all, the <code>validates_presence_of</code> method: <br><blockquote> <code><a href="http://s-c.me/5958/s"></a> <a href="http://s-c.me/5958/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">validates_presence_of</font> (*attr_names)&lt;br/&gt;  validates_with PresenceValidator, _merge_attributes(attr_names)&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote> <br>  As you can see, <code>validates_presence_of</code> uses the more primitive <code>validates_with</code> , passing it the class of the validator and adding the key <code>{:attributes =&gt; attribute_names}</code> to <code>attr_names</code> .  Next is the validator class itself: <br><blockquote> <code><a href="http://s-c.me/5959/s"></a> <a href="http://s-c.me/5959/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">PresenceValidator</font> &lt; EachValidator&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">validate</font> (record)&lt;br/&gt;    record. <b>errors</b> .add_on_blank(attributes, options[:message])&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote> <br>  The <code>validate</code> method in the <code>EachValidator</code> class validates each attribute.  In this case, it is redefined and adds an error message to the object only if the attribute is empty. <br><br>  The <code>add_on_blank</code> method calls <code>add(attribute, :blank, :default =&gt; custom_message)</code> <code>add_on_blank</code> <code>add(attribute, :blank, :default =&gt; custom_message)</code> if <code>value.blank?</code>  (among other things), which adds a localized <code>:blank</code> message to the object.  The built-in localization file for the English <code>locale/en.yml</code> as follows: <br><br><blockquote> <code><a href="http://s-c.me/5960/s"></a> <a href="http://s-c.me/5960/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;en:&lt;br/&gt;  errors:&lt;br/&gt; <font color="#696969">#       .</font> &lt;br/&gt; <font color="#0000ff">format</font> : <font color="#008000">"{{attribute}} {{message}}"</font> &lt;br/&gt; &lt;br/&gt; <font color="#696969">#  :model, :attribute  :value    </font> &lt;br/&gt; <font color="#696969">#  :count    .      .</font> &lt;br/&gt;    messages:&lt;br/&gt;      inclusion: <font color="#008000">"is not included in the list"</font> &lt;br/&gt;      exclusion: <font color="#008000">"is reserved"</font> &lt;br/&gt;      invalid: <font color="#008000">"is invalid"</font> &lt;br/&gt;      confirmation: <font color="#008000">"doesn't match confirmation"</font> &lt;br/&gt;      accepted: <font color="#008000">"must be accepted"</font> &lt;br/&gt;      empty: <font color="#008000">"can't be empty"</font> &lt;br/&gt;      blank: <font color="#008000">"can't be blank"</font> &lt;br/&gt;      too_long: <font color="#008000">"is too long (maximum is {{count}} characters)"</font> &lt;br/&gt;      too_short: <font color="#008000">"is too short (minimum is {{count}} characters)"</font> &lt;br/&gt;      wrong_length: <font color="#008000">"is the wrong length (should be {{count}} characters)"</font> &lt;br/&gt;      not_a_number: <font color="#008000">"is not a number"</font> &lt;br/&gt;      greater_than: <font color="#008000">"must be greater than {{count}}"</font> &lt;br/&gt;      greater_than_or_equal_to: <font color="#008000">"must be greater than or equal to {{count}}"</font> &lt;br/&gt;      equal_to: <font color="#008000">"must be equal to {{count}}"</font> &lt;br/&gt;      less_than: <font color="#008000">"must be less than {{count}}"</font> &lt;br/&gt;      less_than_or_equal_to: <font color="#008000">"must be less than or equal to {{count}}"</font> &lt;br/&gt;      odd: <font color="#008000">"must be odd"</font> &lt;br/&gt;      even: <font color="#008000">"must be even"</font> &lt;br/&gt;</font></code> </blockquote> <br>  As a result, the error message will look like <code>first_name can't be blank</code> . <br><br>  The Error object is also part of the ActiveModel. <br><br><h4>  Serialization </h4><br>  ActiveRecord also includes serialization for JSON and XML, allowing you to do things like <code>@person.to_json(:except =&gt; :comment)</code> . <br><br>  The most important thing for serialization is to support a common set of attributes accepted by all serializers.  That is, you can do <code>@person.to_xml(:except =&gt; :comment)</code> . <br><br>  To add serialization support to your own model, you need to add (inject) the serialization module and the implementation of the <code>attributes</code> method.  See: <br><blockquote> <code><a href="http://s-c.me/5961/s"></a> <a href="http://s-c.me/5961/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Person</font> &lt;br/&gt; <font color="#0000ff">include</font> ActiveModel::Serialization&lt;br/&gt; &lt;br/&gt;  attr_accessor :attributes&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">initialize</font> (attributes)&lt;br/&gt;    @attributes = attributes&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">p</font> = <font color="#cc6633">Person</font> . <b>new</b> (:first_name =&gt; <font color="#008000">"Yukihiro"</font> , :last_name =&gt; <font color="#008000">"Matsumoto"</font> )&lt;br/&gt; <font color="#0000ff">p</font> .to_json <font color="#696969">#=&gt; %|{"first_name": "Yukihiro", "last_name": "Matsumoto"}|</font> &lt;br/&gt; <font color="#0000ff">p</font> .to_json(:only =&gt; :first_name) <font color="#696969">#=&gt; %|{"first_name": "Yukihiro"}|</font> &lt;br/&gt;</font></code> </blockquote> <br>  In order for specific attributes to be converted by some methods, you can pass the option <code>:methods</code> ;  these methods will then be invoked dynamically. <br><br>  Here is the Person model with validation and serialization: <br><blockquote> <code><a href="http://s-c.me/5962/s"></a> <a href="http://s-c.me/5962/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Person</font> &lt;br/&gt; <font color="#0000ff">include</font> ActiveModel::Validations&lt;br/&gt; <font color="#0000ff">include</font> ActiveModel::Serialization&lt;br/&gt; &lt;br/&gt;  validates_presence_of :first_name, :last_name&lt;br/&gt; &lt;br/&gt;  attr_accessor :attributes&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">initialize</font> (attributes = {})&lt;br/&gt;    @attributes = attributes&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">read_attribute_for_validation</font> (key)&lt;br/&gt;    @attributes[key]&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote> <br><h4>  Other modules </h4><br>  We met only two ActiveModel modules.  Briefly about the rest: <br><br>  <code>AttributeMethods</code> : Simplifies adding class methods to control attributes of the type <code>table_name :foo</code> . <br>  <code>Callbacks</code> : ActiveRecord style object life cycle callbacks. <br>  <code>Dirty</code> : Support for dirty objects. <br>  <code>Naming</code> : Default implementations of <code>model.model_name</code> used by ActionPack (for example, for <code>render :partial =&gt; model</code> ). <br>  <code>Observing</code> : ActiveRecord Observers (Observers). <br>  <code>StateMachine</code> : A simple implementation of a state machine. <br>  <code>Translation</code> : Basic support for translations into other languages ‚Äã‚Äã(integration with the I18n internationalization framework). <br>  Josh Peek reorganized the methods from ActiveRecord into separate modules as part of his project for Google Summer of Code last summer, and this is only the first step of the whole process.  Over time, I expect to see more things highlighted from ActiveRecord and more abstractions around ActiveModel. <br><br>  I also expect from the community validators, translations, serializers, etc., especially now that they can be used not only in ActiveRecord, but also in MongoMapper, Cassandra Object and other ORMs using ActiveModel modules. </div><p>Source: <a href="https://habr.com/ru/post/86938/">https://habr.com/ru/post/86938/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../86930/index.html">Development of the Ribbon, the Dusty Museum of the Office's Past (Interface Why, Part 2)</a></li>
<li><a href="../86932/index.html">Smoke in the flask</a></li>
<li><a href="../86933/index.html">Proxeterium. Chapter 1. Part 2: Street</a></li>
<li><a href="../86935/index.html">Technologies of choice - 2010: psi-emitter tower)</a></li>
<li><a href="../86936/index.html">How to create an application on iPhone without Mac OS X and SDK?</a></li>
<li><a href="../86939/index.html">About hackers, cadabra and TM</a></li>
<li><a href="../86940/index.html">Last.fm Scrobbling</a></li>
<li><a href="../86941/index.html">Three mobile games that turned my ideas about mobile games in general</a></li>
<li><a href="../86942/index.html">Leak hunt</a></li>
<li><a href="../86944/index.html">SuperTux 0.3.3 released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>