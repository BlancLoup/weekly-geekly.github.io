<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Running multiple node.js sites on the same server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When there are several sites running at the same time on the same server, node.js requires a common launch mechanism. The simplest option, as well as ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Running multiple node.js sites on the same server</h1><div class="post__text post__text-html js-mediator-article">  When there are several sites running at the same time on the same server, node.js requires a common launch mechanism.  The simplest option, as well as the most productive one, is launching a single application that connects all the necessary sites.  The connection mechanism should be unlimited for the created sites, and as simple as possible.  It should be stable, with a critical error on one of the sites, others should still continue their work. <br>  All connected web applications should be easily portable to a separate hosting.  Support is needed for both individual domain names and subdomains for a specific domain name. <br><br>  Suppose there are two directories in which web applications are located: <br><br>  - <i>/ var / www / domains /</i> , with site.ru, othersite2.ru and so on. <br>  - <i>/ var / www / subdomains /</i> , with site3, othersite4 and so on. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order for the sites to be available at the corresponding addresses (site.ru, othersite2.ru, site3.example.com, othersite4.example.com), you will need to run this command: <br><br><pre><code class="bash hljs">$ vhoster -n example.com -s /var/www/subdomains/ -d /var/www/domains/ --port 80 --host 0.0.0.0 vhost: site.ru vhost: othersite2.ru vhost: site3.example.com vhost: othersite4.example.com</code> </pre> <br>  For those who need <i>vhoster</i> and its implementation is interesting, I ask under cat. <br><a name="habracut"></a><br>  The program scans directories for the presence of directories, and in each found file includes an .index.js file, if it exists.  The root .index.js file may contain routing paths for the site, usually it is from him that all server logic begins.  When connected, it must export the app object, this is the un-launched http-server of the application, which is then passed to the <a href="http://www.senchalabs.org/connect/middleware-vhost.html">connect.vhost</a> library.  Using connect.vhost, routing for domain names is performed. <br><br>  The standard template content of the .index.js file can be: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); exports.app = http.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ res.writeHead(<span class="hljs-number"><span class="hljs-number">200</span></span>, {<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>: <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>}); res.end(<span class="hljs-string"><span class="hljs-string">'Hello World\n'</span></span>); });</code> </pre><br>  Similarly, this will work with <a href="http://expressjs.com/">express</a> or <a href="http://www.senchalabs.org/connect/">connect</a> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> connect = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'connect'</span></span>); exports.app = connect().use(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ res.end(<span class="hljs-string"><span class="hljs-string">'hello world\n'</span></span>); });</code> </pre><br>  If an error is not intercepted from any site, the process will not end for everyone thanks to the universal design: <br><br><pre> <code class="javascript hljs">process.on(<span class="hljs-string"><span class="hljs-string">'uncaughtException'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Caught exception: '</span></span> + err); });</code> </pre><br>  Thus, we have the ability to run a set of web applications written in node.js.  Each site itself makes routing itself and is as independent as possible.  In addition, there are no problems running the site on a separate hosting without the help of vhoster, adding the following condition to the .index.js code: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.main === <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//  -     exports.app.listen(80); //   }</span></span></code> </pre><br>  Before using this technology, you need to understand its main drawback.  All sites will have a common global area and the same rights.  If this is unacceptable for connected web applications, then they should be launched as separate new programs on behalf of different users. <br><br>  Source code and a small test program can be found at <a href="http://github.com/dkiyatkin/node-vhoster/">https://github.com/dkiyatkin/node-vhoster</a> .  Or you can install it using <a href="http://npmjs.org/">npm</a> : <br><br><pre> <code class="bash hljs">$ npm install vhoster $ vhoster --<span class="hljs-built_in"><span class="hljs-built_in">help</span></span></code> </pre><br>  Any suggestions and wishes on the code are welcome. </div><p>Source: <a href="https://habr.com/ru/post/139433/">https://habr.com/ru/post/139433/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139426/index.html">CodeFest. New season. March 31 ‚Äî April 1, Novosibirsk</a></li>
<li><a href="../139427/index.html">Google Chrome Extension: We are printing articles with habrahabr</a></li>
<li><a href="../139428/index.html">Implementation of the RGB-algorithm for changing the image contrast</a></li>
<li><a href="../139429/index.html">2D-> 3D in Augmented reality</a></li>
<li><a href="../139432/index.html">AIDL (Android Interface Definition Language) and Inter-Process Communication (IPC)</a></li>
<li><a href="../139434/index.html">MIT opened Google App Inventor in beta</a></li>
<li><a href="../139435/index.html">Documentation for Grab - library for parsing sites</a></li>
<li><a href="../139438/index.html">Common work space for home and office</a></li>
<li><a href="../139439/index.html">Download without haste</a></li>
<li><a href="../139443/index.html">Interface Inheritance and Contracts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>