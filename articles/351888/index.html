<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Espresso: ‚ÄúCute little animals or dangerous predators?‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, readers Habra! Today we will test Recyclerview on Android together: in my opinion, this topic is quite interesting. 



 What is Recyclervie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Espresso: ‚ÄúCute little animals or dangerous predators?‚Äù</h1><div class="post__text post__text-html js-mediator-article">  Good day, readers Habra!  Today we will test Recyclerview on Android together: in my opinion, this topic is quite interesting. <br><br><img src="https://habrastorage.org/webt/8q/cr/yh/8qcryhopm6qd4cp2kmg3xmdagxi.png"><br><br>  What is Recyclerview?  This is the component with which lists are created.  Each list can be scrolled, add items to it, delete them or change them.  An element is any functional unit.  For example, we make a list of users with a field for entering a comment and a button.  As soon as the comment is entered and the button is pressed, it is sent to the server.  The system can now upgrade or delete an item. <br>  Elements can contain many controls (such as buttons), so all the capabilities of the elements must be covered with tests.  Now I will share with you useful utilities for Recyclerview. <br><a name="habracut"></a><br><h3>  Example </h3><br>  As an example, take a simple application that displays a list of animals.  List data is an array of similar objects.  So what do we see? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs perl">[ ... { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"PREDATOR"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"image_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://www.myplanet-ua.com/wp-content/uploads/2017/05/%D0%B2%D0%B8%D0%B4%D1%8B-%D1%82%D0%B8%D0%B3%D1%80%D0%BE%D0%B2.jpg"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"HERBIVORE"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"image_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://cs2.livemaster.ru/storage/b2/40/b9d72365ffc02131ea60420cdc0s--kukly-i-igrushki-suslik-bejli-igrushka-iz-shersti.jpg"</span></span> }, .... ]</code> </pre> <br>  Element consists of: <br><br><ol><li>  Animal species - PREDATOR (predator) and HERBIVORE (herbivore).  Depending on it, one or another icon is assigned to the animal. </li><li>  Animal names (tiger, gopher, etc.). </li><li>  Links to the image of the animal. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Users see the following:</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/yt/jx/jl/ytjxjljmen-egwev3xyk-i5sx9s.png"></div><br></div></div><br>  When you click on the "Delete" button, the picture disappears from the list.  Clicking on the animal itself opens a more detailed description of it. <br><br>  We proceed to testing: <br><br><ol><li>  Let's see how the item is deleted. </li><li>  Check if the icon matches the animal‚Äôs species (green smiley - herbivore, red smiley - predator). </li><li>  Check if the name matches the given one. </li></ol><br>  For convenience, I mark the test areas in the image below: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_n/c_/x1/_nc_x174ri0l_-4lzevhprxijcw.png"></div><br><br>  So, we start writing auxiliary classes. <br><br><h3>  DrawableMatcher </h3><br>  The first important auxiliary class will be checking for compliance with an image with a local resource.  The correspondence of the type field (response from the server) and the name of the local resource is as follows: <br><br>  PREDATOR - ic_sentiment_very_dissatisfied_red_24dp <br>  HERBIVORE - ic_sentiment_very_satisfied_green_24dp <br><br>  Example: in our task we are sure that the capybara is a herbivore, and therefore in the imageView element with the identifier ivAnimalType, the value ic_sentiment_very_satisfied_green_24dp should be set. <br><br>  In fact, it is necessary to verify the compliance of the established resource depending on the type of animal.  Since for this I did not find the standard tools, I had to write my Matcher, which checks the background properties of the imageView element for compliance with the transmitted identifier. <br><br><h3>  Slight reservation </h3><br>  Matcher is most often used to check the specific properties of a custom view against the parameters passed. <br><br>  Example: we wrote our own custom view representing the door.  It can be in two states: open and closed.  To check the door manipulations, we can write our own Matcher.  Having agreed that after the handle is turned, the door goes from closed to open, in our test we pull the handle and, using our own matcher, check that it is really open. <br><br>  To write this kind of matcher, I use the standard class of the org.hamcrest package - TypeSafeMatcher.  More information about him can be found <a href="http://hamcrest.org/JavaHamcrest/javadoc/1.3/org/hamcrest/TypeSafeMatcher.html">here.</a> <br><br>  This class is a generic class with a custom view type (imageView, view, or others).  It provides 2 basic methods: <br><br><ol><li>  matchesSafely is the root method in which the match is checked.  This parameter is passed an object of type generic class. </li><li>  describeTo is a function for the ability of an object to describe itself.  Called when the match is not found and, preferably, contains the name of what we are trying to find, and what we have actually met. </li></ol><br>  In this case, it seems to me, it is advisable to transfer the resource identifier, which we will further check, to the constructor of our class. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawableMatcher</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resourceId)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(View.class); mResDrawableId = resourceId; }</code> </pre><br>  The description method is very convenient when debugging a test.  For example, if there is a discrepancy between the images, it displays a message stating that the installed resource does not match the scanned resource, and gives some data from both resources. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">describeTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Description description)</span></span></span><span class="hljs-function"> </span></span>{ description.appendText(<span class="hljs-string"><span class="hljs-string">"with drawable from resource id: "</span></span>); description.appendValue(mResDrawableId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resourceName != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { description.appendText(<span class="hljs-string"><span class="hljs-string">"["</span></span>); description.appendText(resourceName); description.appendText(<span class="hljs-string"><span class="hljs-string">"]"</span></span>); } }</code> </pre><br>  In the root method of compliance checking, the standard asAs method of the Bitmap class is checked.  That is, we create a bitmap using the passed identifier and compare it with the one set in the background field. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matchesSafely</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View target)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(target <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ImageView)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ImageView imageView = (ImageView) target; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mResDrawableId &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> imageView.getBackground() == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Resources resources = target.getContext().getResources(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Drawable expectedDrawable = resources.getDrawable(mResDrawableId); resourceName = resources.getResourceEntryName(mResDrawableId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (expectedDrawable == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Bitmap bitmap = getBitmap(imageView.getBackground()) <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Bitmap otherBitmap = getBitmap(expectedDrawable); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bitmap.sameAs(otherBitmap); }</code> </pre> <br>  That's all, as for checking the compliance of the image with the specified resource. <br><br><h3>  Internal element events </h3><br>  Since, according to the task, we will need to click on the ‚Äúdelete‚Äù button, we need to write an additional implementation of ViewAction.  It was convenient for me to make a certain class of utilities called CustomRecyclerViewActions.  It contains many static methods that return a ViewAction implementation.  In our example, we will use clickChildViewWithId. <br>  First, let's look at the ViewAction interface in more detail.  It consists of the following methods: <br><br><ol><li>  Matcher getConstraints () - some preconditions for execution.  For example, it may be necessary for the element on which the action will be performed to be visible. </li><li>  String getDescription () - description of the view action.  Required to create a readable display of messages in the log. </li><li>  void perform (UiController uiController, View view) is the action itself that we will perform. </li></ol><br>  So let's go back to writing the clickChildViewWithId method.  In the parameters, I pass the ID of the custom view on which I will execute the click event.  Full implementation of this method can be viewed. <div class="spoiler">  <b class="spoiler_title">here</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ViewAction </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clickChildViewWithId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewAction() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Matcher&lt;View&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getConstraints</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDescription</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"     id"</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> UiController uiController, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View view)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> View v = view.findViewById(id); v.performClick(); } }; }</code> </pre><br></div></div><br><h3>  Checking the number of items inside the adapter </h3><br>  We also need to check the number of items inside the Recyclerview.  To do this, we need our own implementing ViewAssertion interface.  Let's call it RecyclerViewItemCountAssertion. <br><br>  The ViewAssertion interface is one method: <br> <code>void check(View view, NoMatchingViewException noViewFoundException);</code> <br> <br>  Consider the check method in more detail.  This method of verifying user assertions takes 2 parameters: <br><br><ol><li>  View - an element of the custom view that will be asserted (for example, <code>assertThat(0,is(view.getId())</code> ); for identifier verification). </li><li>  NoMatchingViewException - an exception that occurs when a given resolver is not a member of the view hierarchy; in other words, it is not a View.  Such an exception contains information about the presentation and compliance, which is very convenient when debugging. </li></ol><br>  The implementation of this class is simple.  You can see the full class code. <div class="spoiler">  <b class="spoiler_title">here</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerViewItemCountAssertion</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewAssertion</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mExpectedCount; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RecyclerViewItemCountAssertion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> expectedCount)</span></span></span><span class="hljs-function"> </span></span>{ mExpectedCount = expectedCount; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View view, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> NoMatchingViewException noViewFoundException)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (noViewFoundException != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> noViewFoundException; } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RecyclerView recyclerView = (RecyclerView) view; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RecyclerView.Adapter adapter = recyclerView.getAdapter(); assertThat(adapter.getItemCount(), is(expectedCount)); } }</code> </pre> <br></div></div><br><h3>  Check internal element views </h3><br>  We now turn to the study of the class for checking the elements inside the list.  This class I called RecyclerViewItemSpecificityView.  The class constructor takes 2 parameters: the element identifier and the Matcher.  With the identifier, everything is more or less clear: we will subsequently check this element.  And the second parameter answers the question what exactly we are going to check.  Let's move on to the example of animals. <br><br>  We need to check that the 6th item in the list is capybara, herbivore.  In order to verify this, you need to check the tvName field for compliance with the text ‚Äúcapybara‚Äù.  How can I get to the 6th element?  The espresso.contrib package has a class called RecyclerViewActions.  It helps with testing RecyclerView, contains many different useful methods that are perfectly combined with the standard methods of the espresso library.  This allows you to achieve a higher percentage of coverage.  Unfortunately, RecyclerViewUtils does not support the full range of functionality.  For example, you cannot directly check items inside a list card in an explicit form. <br><br>  Consider the RecyclerViewItemSpecificityView class.  It is an implementation of the ViewAssertion interface.  Accordingly, it operates according to the same scheme as RecyclerViewItemCountAssertion, but has a different purpose. <br><br>  The constructor of the RecyclerViewItemSpecificityView class, as mentioned earlier, takes 2 parameters and represents the following construction: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RecyclerViewItemSpecificityView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> specificallyId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Matcher&lt;View&gt; matcher)</span></span></span><span class="hljs-function"> </span></span>{ mSpecificallyId = specificallyId; mMatcher = matcher; }</code> </pre> <br>  The check method happens like this: <br><br><ol><li>  Search for the corresponding item by mSpecificallyId.  Here we will pass the identifiers of the element Recyclerview. </li><li>  MMatcher compliance check.  This check is the main task of the class. </li><li>  Formation of readable conclusions in the absence of compliance. </li></ol><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> View view, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> NoMatchingViewException noViewFoundException)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> StringDescription description = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringDescription(); description.appendText(<span class="hljs-string"><span class="hljs-string">"'"</span></span>); mMatcher.describeTo(description); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ViewGroup itemRoot = (ViewGroup) view; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> View typeIUsage = itemRoot.findViewById(mSpecificallyId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (noViewFoundException != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { description.appendText( String.format( <span class="hljs-string"><span class="hljs-string">"' check could not be performed because view with id '%s' was not found.\n"</span></span>, mSpecificallyId)); Log.e(<span class="hljs-string"><span class="hljs-string">"RecyclerViewItemSpecificityView"</span></span>, description.toString()); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> noViewFoundException; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { description.appendText(<span class="hljs-string"><span class="hljs-string">"' doesn't match the selected view."</span></span>); assertThat(description.toString(), typeIUsage, mMatcher); } }</code> </pre><br><h3>  ‚ÄúWell, is it still a capybara?‚Äù </h3><br>  All elements are ready, now let's try to check our capybara.  To begin with, we will write a test that checks whether an element is a herbivorous capybara. <br><br><pre> <code class="java hljs">onView(withId(R.id.rvAnimals)) .perform(scrollToPosition(capybaraPosition)) .check(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RecyclerViewItemSpecificityView(R.id.tvName, withText(<span class="hljs-string"><span class="hljs-string">""</span></span>))) .check(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RecyclerViewItemSpecificityView(R.id.ivAnimalType, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DrawableMatcher(R.drawable.ic_sentiment_very_satisfied_black_24dp)));</code> </pre><br>  ScrollToPosition is a method of the RecyclerViewActions class.  It is needed to scroll the list to the selected position.  If the list item is not visible, then test it will not work.  Next, we check that the item to which we scrolled the list in the tvName field contains the string "Capybara".  Also, the element under test is ‚Äúherbivorous,‚Äù so we have to check that the icon (ivAnimalType) is ic_sentiment_very_satisfied_black_24dp. <br><br>  Now we write a test to delete the item.  I think you have already guessed how we can use the CustomRecyclerViewActions class clickChildViewWithId static method and verify that the number of items has decreased using RecyclerViewItemCountAssertion. <br><br><pre> <code class="java hljs">onView(withId(R.id.rvAnimals)).check(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RecyclerViewItemCountAssertion(<span class="hljs-number"><span class="hljs-number">8</span></span>)); onView(withId(R.id.rvAnimals)).perform( RecyclerViewActions.actionOnItemAtPosition(<span class="hljs-number"><span class="hljs-number">0</span></span>, MyRecyclerViewActions.clickChildViewWithId(R.id.btnRemove))); onView(withId(R.id.rvAnimals)).check(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RecyclerViewItemCountAssertion(<span class="hljs-number"><span class="hljs-number">7</span></span>));</code> </pre><br>  I specifically used the actionOnItemAtPosition method of the RecyclerViewActions class.  He scrolls the list to the current position and thus gives us the opportunity to manipulate the list item. <br><br><h3>  Conclusion </h3><br>  Testing is a very important process. <blockquote>  ‚ÄúThe task cannot be completed until it is covered by at least 70% of the test‚Äù </blockquote>  - So the boss told me when I just got acquainted with the wonderful world of programming.  In my opinion, an important test criterion is the coverage area.  In the first place - checking the main functionality of the tested part of the software, then - trying to introduce the application in some emergency situations.  This improves the quality of the software product, its sustainability and, most importantly, understanding.  Yes, and what a sin to confess: if the program is covered with tests, sleep much more easily. <br><br>  Today we talked about how to get closer to creating a ‚Äútester's suitcase,‚Äù and I hope you found something useful for yourself to complement your set.  You can read the full example <a href="https://github.com/morkovkin/EspressoRecyclerView">here.</a> </div><p>Source: <a href="https://habr.com/ru/post/351888/">https://habr.com/ru/post/351888/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351878/index.html">Terraform: a new approach to Infrastructure as code</a></li>
<li><a href="../351880/index.html">As a result of the toxic manual, Telltale Games lost the best developers.</a></li>
<li><a href="../351882/index.html">Vue.js and how to understand it</a></li>
<li><a href="../351884/index.html">This is not ‚Äúa real job, but a better job‚Äù: as a hiring policy, Crossover allows you to pay employees above the market</a></li>
<li><a href="../351886/index.html">Controller for Lego</a></li>
<li><a href="../351890/index.html">REST API Best Practices</a></li>
<li><a href="../351894/index.html">Spread S3 Buckets across different pools in Ceph Luminous</a></li>
<li><a href="../351896/index.html">Issue # 15: IT training - current issues and challenges from leading companies</a></li>
<li><a href="../351898/index.html">Hackathon and game jam in Yekaterinburg</a></li>
<li><a href="../351900/index.html">Flask Mega-Tutorial, Part XVI: Full-Text Search</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>