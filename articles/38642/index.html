<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JavaScript closures</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you are using JavaScript, but you haven‚Äôt figured out that way, what a wonderful thing this is - closures , and why it is needed - this article is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JavaScript closures</h1><div class="post__text post__text-html js-mediator-article">  If you are using JavaScript, but you haven‚Äôt figured out that way, what a wonderful thing this is - <a href="http://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BC%25D1%258B%25D0%25BA%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)">closures</a> , and why it is needed - this article is for you. <br><br><a name="habracut"></a>  As is known, in JavaScript, the scope of local variables (declared by the word var) is the body of the function within which they are defined. <br><br>  If you declare a function inside another function, the first one accesses the variables and arguments of the latter: <br><blockquote>  <font color="black"><font color="#0000ff">function</font> outerFn (myArg) {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> myVar;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">function</font> innerFn () {</font> <font color="black"><br></font>  <font color="black"><font color="#008000">// has access to myVar and myArg</font></font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> </blockquote>  At the same time, such variables <i>continue to exist and remain accessible by an internal function</i> even after the external function in which they are defined has been executed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider an example - a function that returns the number of own calls: <br><blockquote>  <font color="black"><font color="#0000ff">function</font> createCounter () {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> numberOfCalls = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> ++ numberOfCalls;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> fn = createCounter ();</font> <font color="black"><br></font>  <font color="black">fn ();</font>  <font color="black"><font color="#008000">//one</font></font> <font color="black"><br></font>  <font color="black">fn ();</font>  <font color="black"><font color="#008000">// 2</font></font> <font color="black"><br></font>  <font color="black">fn ();</font>  <font color="black"><font color="#008000">// 3</font></font> </blockquote>  In this example, the function returned by createCounter uses the variable numberOfCalls, which stores the desired value between its calls (instead of immediately ending its existence with the return of createCounter). <br><br>  It is for these properties that such ‚Äúnested‚Äù functions in JavaScript are called <i>closures</i> (a term that comes from functional programming languages) - they ‚Äúclose‚Äù to themselves the variables and arguments of the function within which they are defined. <br><br><h4>  Application closures </h4><br>  Let's simplify the example above a little bit - remove the need to separately call the createCounter function, make it anomimous and call immediately after its declaration: <br><blockquote>  <font color="black"><font color="#0000ff">var</font> fn = ( <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> numberOfCalls = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> ++ numberOfCalls;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}) ();</font> </blockquote>  Such a construction allowed us to bind data to a function that persists between its calls ‚Äî this is one of the uses of closures.  In other words, with the help of them we can create functions that have their changing state. <br><br>  Another good use of closures is the creation of functions, which in turn also create functions, something that some would call a so-called trick.  metaprogramming.  For example: <br><blockquote>  <font color="#aaa"><font color="#0000ff">var</font> createHelloFunction = <font color="#0000ff">function</font> (name) {</font> <font color="#aaa"><br></font>  <font color="#aaa"><font color="#0000ff">return</font> <font color="#0000ff">function</font> () {</font> <font color="#aaa"><br></font>  <font color="#aaa">alert ( <font color="#A31515">'Hello,'</font> + name);</font> <font color="#aaa"><br></font>  <font color="#aaa">}</font> <font color="#aaa"><br></font>  <font color="#aaa">}</font> <font color="#aaa"><br></font>  <font color="#aaa"><font color="#0000ff">var</font> sayHelloHabrahabr = createHelloFunction ( <font color="#A31515">'Habrahabr'</font> );</font> <font color="#aaa"><br></font>  <font color="#aaa">sayHelloHabrahabr ();</font>  <font color="#aaa"><font color="#008000">// alerts ‚ÄúHello, Habrahabr‚Äù</font></font> </blockquote>  Due to the closure, the <i>returned function</i> ‚Äúremembers‚Äù the parameters passed to the <i>function creating</i> what we need for this kind of things. <br><br>  A similar situation arises when we do not return the internal function, but hang it on an event - since the event occurs after the function has completed, the closure again helps not to lose the data transmitted during the creation of the handler. <br><br>  Consider a slightly more complicated example - a method that binds a function to a specific context (that is, an object that the word this will point to in it). <br><blockquote>  <font color="black">Function.prototype.bind = <font color="#0000ff">function</font> (context) {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> fn = <font color="#0000ff">this</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> fn.apply (context, arguments);</font> <font color="black"><br></font>  <font color="black">};</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> HelloPage = {</font> <font color="black"><br></font>  <font color="black">name: <font color="#A31515">'Habrahabr'</font> ,</font> <font color="black"><br></font>  <font color="black">init: <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black">alert ( <font color="#A31515">'Hello,'</font> + <font color="#0000ff">this</font> .name);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#008000">//window.onload = HelloPage.init;</font></font>  <font color="black"><font color="#008000">// alert would be undefined, tk</font></font>  <font color="black"><font color="#008000">this would point to a window</font></font> <font color="black"><br></font>  <font color="black">window.onload = HelloPage.init.bind (HelloPage);</font>  <font color="black"><font color="#008000">// now everything works</font></font> </blockquote>  In this example, with the help of closures, a function bossed by the bind remembers the initial function and the context assigned to it. <br><br>  The next, fundamentally different application of closures is data protection (encapsulation).  Consider the following construction: <br><blockquote>  <font color="black">( <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black">...</font> <font color="black"><br></font>  <font color="black">}) ();</font> </blockquote>  Obviously, inside the closure, we have access to all external data, but it also has its own.  Due to this, we can surround parts of the code with a similar construction in order to close local variables that have fallen inside from access outside.  (One of the examples of its use you can see in the source code of the jQuery library, which surrounds all its code with a closure, so as not to output the variables necessary only for it). <br><br>  There is, however, one trap associated with such an application - inside the closure the meaning of the word this is lost outside of it.  It is solved as follows: <br><blockquote>  <font color="black">( <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black"><font color="#008000">// the higher this will be saved</font></font> <font color="black"><br></font>  <font color="black">}). call ( <font color="#0000ff">this</font> );</font> </blockquote><br>  Consider another trick from the same series.  Everywhere it was popularized by the developers of the Yahoo UI framework, calling it ‚ÄúModule Pattern‚Äù and writing an <a href="http://yuiblog.com/blog/2007/06/12/module-pattern/">entire article</a> about it <a href="http://yuiblog.com/blog/2007/06/12/module-pattern/">in the official blog</a> . <br><br>  Let us have an object ( <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D0%25BD%25D0%25B3%25D0%25BB%25D1%2582%25D0%25BE%25D0%25BD">singleton</a> ) containing any methods and properties: <br><blockquote>  <font color="black"><font color="#0000ff">var</font> MyModule = {</font> <font color="black"><br></font>  <font color="black">name: <font color="#A31515">'Habrahabr'</font> ,</font> <font color="black"><br></font>  <font color="black">sayPreved: <font color="#0000ff">function</font> (name) {</font> <font color="black"><br></font>  <font color="black">alert ( <font color="#A31515">'PREVED'</font> + name.toUpperCase ())</font> <font color="black"><br></font>  <font color="black">},</font> <font color="black"><br></font>  <font color="black">sayPrevedToHabrahabr: <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">this</font> .sayPreved ( <font color="#0000ff">this</font> .name);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">MyModule.sayPrevedToHabrahabr ();</font> <font color="black"><br></font> </blockquote>  With the help of a closure, we can make methods and properties that are not used outside the object private (i.e., accessible only to it): <br><blockquote>  <font color="black"><font color="#0000ff">var</font> MyModule = ( <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> name = <font color="#A31515">'Habrahabr'</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">function</font> sayPreved () {</font> <font color="black"><br></font>  <font color="black">alert ( <font color="#A31515">'PREVED'</font> + name.toUpperCase ());</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> {</font> <font color="black"><br></font>  <font color="black">sayPrevedToHabrahabr: <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black">sayPreved (name);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}) ();</font> <font color="black"><br></font>  <font color="black">MyModule.sayPrevedToHabrahabr ();</font>  <font color="black"><font color="#008000">// alerts "PREVED Habrahabr"</font></font> <font color="black"><br></font> </blockquote><br>  Finally, I want to describe a common mistake that drives many into a stupor if they do not know how the closures work. <br><br>  Let us have an array of links, and our task is to make sure that when clicked on each one, its serial number is displayed by an alert.  The first decision that comes to mind looks like this: <br><blockquote>  <font color="black"><font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0; i &lt;links.length; i ++) {</font> <font color="black"><br></font>  <font color="black">links [i] .onclick = <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black">alert (i);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> </blockquote>  In fact, it turns out that when you click on any link, the same number is displayed - the value of links.length.  Why it happens?  In connection with the closure, the declared auxiliary variable i continues to exist, and at that moment when we click on the link.  Since by that time the cycle has already passed, i remains equal to the number of links - this is the value we see with clicks. <br><br>  This problem is solved as follows: <br><blockquote>  <font color="black"><font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 0; i &lt;links.length; i ++) {</font> <font color="black"><br></font>  <font color="black">( <font color="#0000ff">function</font> (i) {</font> <font color="black"><br></font>  <font color="black">links [i] .onclick = <font color="#0000ff">function</font> () {</font> <font color="black"><br></font>  <font color="black">alert (i);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}) (i);</font> <font color="black"><br></font>  <font color="black">}</font> </blockquote>  Here, using another closure, we ‚Äúshade‚Äù the variable i, creating its copy in its local scope at each step of the cycle.  Thanks to this, everything now works as intended. <br><br>  That's all.  This article, of course, does not pretend to be exhaustive, but I hope someone will still help you figure it out.  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/38642/">https://habr.com/ru/post/38642/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../38635/index.html">Cheap domains RU</a></li>
<li><a href="../38636/index.html">European investors have decided to wait</a></li>
<li><a href="../38639/index.html">Using expressions in PHP</a></li>
<li><a href="../38640/index.html">Google chrome</a></li>
<li><a href="../38641/index.html">Cannibal flower</a></li>
<li><a href="../38643/index.html">Hover under the transparent image</a></li>
<li><a href="../38645/index.html">Autocomplete text field</a></li>
<li><a href="../38647/index.html">Distributing invites to Camspace - computer control systems using a webcam.</a></li>
<li><a href="../38648/index.html">pleasedress.me - your assistant when searching for T-shirts :)</a></li>
<li><a href="../38652/index.html">Rusavtobus.ru: From the Kremlin Moscow to the Kremlin Kolomna</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>