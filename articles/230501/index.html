<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Animations on lambdas in C ++ 11</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Development companies, as a rule, are not particularly in a hurry to switch to a new C ++. Mainly due to the support of its compilers, or rather its c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Animations on lambdas in C ++ 11</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/d12/2f5/4cc/d122f54cce1487eef2b553cf5671f8c6.png"><br><br>  Development companies, as a rule, are not particularly in a hurry to switch to a new C ++.  Mainly due to the support of its compilers, or rather its complete or partial absence.  Recently, I decided to find out what's new in terms of supporting C ++ 11 with the GCC compiler, <a href="http://gcc.gnu.org/projects/cxx0x.html">and I realized that it was time to start</a> .  Fortunately, we at Ivideon are loyal to new technologies and give to try something new. <br>  He began, of course, with the most delicious - with lambda expressions!  And from the streams. <br><a name="habracut"></a><br><br>  I want to present the reader with a little sketch on how lambdas can help make the code more readable and concise.  Such code can be used everywhere, where you have to call some function periodically, while transferring to it the time elapsed from the previous call - for example, in animations. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Title: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> ANIMATION_ENGINE_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ANIMATION_ENGINE_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;functional&gt; namespace animation { // Actor function has one parameter: time delta since previous frame // It should return true if animation has finished, // or false if it should go on typedef std::function&lt;bool(float)&gt; actor_func; // Handler is called after the animation is complete typedef std::function&lt;void(void)&gt; handler_func; const handler_func doNothing = [] {}; void start(unsigned intervalMs, actor_func, handler_func = doNothing); } // end of namespace animation #endif // ANIMATION_ENGINE_H</span></span></span></span></code> </pre> <br><br>  The interface is simple: in start (), we pass a call interval, a function, and an optional completion handler. <br><br>  And implementation: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"animation_engine.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;thread&gt; namespace animation { void start(unsigned intervalMs, actor_func actor, handler_func handler) { std::thread t([=]() { auto timeStart = std::chrono::system_clock::now(); float lastInterval = 0; while(1) { std::this_thread::sleep_for(std::chrono::milliseconds(intervalMs)); float timeDelta = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt; (std::chrono::system_clock::now() - timeStart).count(); if (actor(timeDelta - lastInterval)) { handler(); break; } lastInterval = timeDelta; } }); t.detach(); } } // end of namespace animation</span></span></span></span></code> </pre><br><br>  Here it is more interesting: on the basis of the functions that are passed by the arguments, and the interval, a new function ( <i>closure</i> ) is built, where the passed arguments are copied ([=] means to capture all the variables from the current scope that are used in the lambda).  Then this new function is launched in a separate thread, where it is chasing our unfortunate actor function in an infinite loop until it returns true.  Well, or the application will not close.  Next, start () is completed, leaving the animation spinning in its thread. <br><br>  Below is an example of use.  Suppose we write a toy like a ping-pong or arkanoid, and we need to activate a ball.  Here's how to implement it: <br><pre> <code class="cpp hljs">animation::start (<span class="hljs-number"><span class="hljs-number">30</span></span>, [=] (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dt) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;adjustBallDirection(dt); <span class="hljs-comment"><span class="hljs-comment">// bouncing, maybe gravitation this-&gt;updateBallPosition(dt); return (this-&gt;ballMissed()) // if player missed the ball -&gt; stop }, [this] { resetBall(); } );</span></span></code> </pre><br><br>  Compile this all, as usual, it is necessary with the key-std = c ++ 11 or -std = c ++ 0x.  In addition, at the linking stage, you need to pass the -pthread key.  If you, like me, are working with QMake, just add these two lines to the .pro file: <br><pre> <code class="bash hljs">CONFIG += c++11 QMAKE_LFLAGS += -pthread</code> </pre><br><br>  Possible improvement # 1: for real tasks, it would be nice to improve the calculation of the interval between calls.  To do this, consider the time while the function-actor executes.  And now it turns out that the interval becomes a little more.  But I did not bother with it this time: just a note about this. <br><br>  Possible improvement number 2: you can introduce additional functionality that would allow to interrupt the animation.  This is easy to do (yes, at least by introducing a flag that all streams with animations would check during operation), but, again, the example code would be swollen. <br><br>  It is likely that you know a more concise way to solve this problem - it will be cool if you state it in the comments.  Or do you know a more interesting case where lambdas would simplify life ... well, you know what to do. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/230501/">https://habr.com/ru/post/230501/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230491/index.html">Rosetta - the nucleus of the comet is close</a></li>
<li><a href="../230493/index.html">Python-digest # 33. News, interesting projects, articles and interviews [July 13, 2014 - July 20, 2014]</a></li>
<li><a href="../230495/index.html">How to discuss money at the interview, if you hire someone and a little about working with people</a></li>
<li><a href="../230497/index.html">Announcement of the second meeting of Java User Group Ekaterinburg</a></li>
<li><a href="../230499/index.html">Jibo: ‚Äúsocial‚Äù robot for the whole family</a></li>
<li><a href="../230503/index.html">Master in the USA. Fulbright Graduate Student Program. Part 1</a></li>
<li><a href="../230505/index.html">Why a Win32 application manifest?</a></li>
<li><a href="../230507/index.html">Django-orm in search of LEFT JOIN</a></li>
<li><a href="../230511/index.html">Unlocking a Lenovo Phone by Depth Methods</a></li>
<li><a href="../230513/index.html">CentOS 7 Overview. Part 1: Linux Containers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>