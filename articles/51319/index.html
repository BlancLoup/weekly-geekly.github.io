<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Qt - translation difficulties</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You have written a program in Qt and want to translate it into other languages ‚Äã‚Äãto make it useful for people in other countries. This is not easy, bu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Qt - translation difficulties</h1><div class="post__text post__text-html js-mediator-article">  You have written a program in Qt and want to translate it into other languages ‚Äã‚Äãto make it useful for people in other countries.  This is not easy, but very simple.  For this we need to do just three simple steps. <br><a name="habracut"></a><br><h4>  Source program </h4><br>  Suppose we have a simple program: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include &lt;QtGui&gt; #include &lt;QtCore&gt; <font color="#0000ff">int</font> main( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> *argv[]) { QApplication app(argc, argv); QLabel label( <font color="#A31515">"Hello, World!"</font> ); label.show(); <font color="#0000ff">return</font> app.exec(); }</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;QtGui&gt; #include &lt;QtCore&gt; <font color="#0000ff">int</font> main( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> *argv[]) { QApplication app(argc, argv); QLabel label( <font color="#A31515">"Hello, World!"</font> ); label.show(); <font color="#0000ff">return</font> app.exec(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;QtGui&gt; #include &lt;QtCore&gt; <font color="#0000ff">int</font> main( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> *argv[]) { QApplication app(argc, argv); QLabel label( <font color="#A31515">"Hello, World!"</font> ); label.show(); <font color="#0000ff">return</font> app.exec(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;QtGui&gt; #include &lt;QtCore&gt; <font color="#0000ff">int</font> main( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> *argv[]) { QApplication app(argc, argv); QLabel label( <font color="#A31515">"Hello, World!"</font> ); label.show(); <font color="#0000ff">return</font> app.exec(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;QtGui&gt; #include &lt;QtCore&gt; <font color="#0000ff">int</font> main( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> *argv[]) { QApplication app(argc, argv); QLabel label( <font color="#A31515">"Hello, World!"</font> ); label.show(); <font color="#0000ff">return</font> app.exec(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;QtGui&gt; #include &lt;QtCore&gt; <font color="#0000ff">int</font> main( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> *argv[]) { QApplication app(argc, argv); QLabel label( <font color="#A31515">"Hello, World!"</font> ); label.show(); <font color="#0000ff">return</font> app.exec(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;QtGui&gt; #include &lt;QtCore&gt; <font color="#0000ff">int</font> main( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> *argv[]) { QApplication app(argc, argv); QLabel label( <font color="#A31515">"Hello, World!"</font> ); label.show(); <font color="#0000ff">return</font> app.exec(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;QtGui&gt; #include &lt;QtCore&gt; <font color="#0000ff">int</font> main( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> *argv[]) { QApplication app(argc, argv); QLabel label( <font color="#A31515">"Hello, World!"</font> ); label.show(); <font color="#0000ff">return</font> app.exec(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> #include &lt;QtGui&gt; #include &lt;QtCore&gt; <font color="#0000ff">int</font> main( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> *argv[]) { QApplication app(argc, argv); QLabel label( <font color="#A31515">"Hello, World!"</font> ); label.show(); <font color="#0000ff">return</font> app.exec(); } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include &lt;QtGui&gt; #include &lt;QtCore&gt; <font color="#0000ff">int</font> main( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> *argv[]) { QApplication app(argc, argv); QLabel label( <font color="#A31515">"Hello, World!"</font> ); label.show(); <font color="#0000ff">return</font> app.exec(); }</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  All she does is create a window that says ‚ÄúHello, World!‚Äù.  We will make for her a translation into Russian. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Step 1. Specify all lines for which translation is required. </h4><br>  All strings that the user sees should be processed by QObject :: tr () or QcoreApplication :: translate () functions. <br>  All Qt classes inherited from QObject have a tr () member function.  Since we are working with a string in a global function that does not belong to any class, we use the translate () function, which allows us to specify the translation context, that is, the class to which it belongs (in this case, QLabel). <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  #include &lt;QtGui&gt; </li><li>  #include &lt;QtCore&gt; </li><li></li><li>  <font color="#0000ff">int</font> main ( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> * argv []) { </li><li>  QApplication app (argc, argv); </li><li>  QLabel label (app.translate ( <font color="#A31515">"QLabel"</font> , <font color="#A31515">"Hello, World!"</font> )); </li><li>  label.show (); </li><li>  <font color="#0000ff">return</font> app.exec (); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  In the tr () and translate () functions, after the string to be translated, you can specify a comment that will be shown to the translator when the application is translated into another language.  Comments are used to eliminate ambiguity. <br>  If you need to translate text that is outside the function, there are two macros for help: QT_TR_NOOP () and QT_TRANSLATE_NOOP (), similar to tr () and translate ().  They unnoticeably mark the text to be extracted by the lupdate utility, about which we will discuss below: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">static</font> <font color="#0000ff">const</font> <font color="#0000ff">char</font> * greeting_strings [] = { </li><li>  QT_TR_NOOP ( <font color="#A31515">"Hello"</font> ), </li><li>  QT_TR_NOOP ( <font color="#A31515">"Goodbye"</font> ) </li><li>  }; </li><li>  <font color="#0000ff">static</font> <font color="#0000ff">const</font> <font color="#0000ff">char</font> * greeting_strings [] = { </li><li>  QT_TRANSLATE_NOOP ( <font color="#A31515">"HelloWidget"</font> , <font color="#A31515">"Hello"</font> ), </li><li>  QT_TRANSLATE_NOOP ( <font color="#A31515">"HelloWidget"</font> , <font color="#A31515">"Goodbye"</font> ) </li><li>  }; </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  When disabling automatic conversion from const char * to QString by compiling a program with a specific macro QT_NO_CAST_FROM_ASCII, you can find all the lines that are skipped. <br>  When we need to insert the values ‚Äã‚Äãof any variables in the middle of the line, it is best to use the arg () function.  For example, when copying files, we could display the process as follows: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">void</font> FileCopier :: showProgress ( <font color="#0000ff">int</font> done, <font color="#0000ff">int</font> total, </li><li>  <font color="#0000ff">const</font> QString (FtFile) </li><li>  { </li><li>  label.setText (tr ( <font color="#A31515">"% 1 of% 2 files copied. \ nCopying:% 3"</font> ) </li><li>  .arg (done) </li><li>  .arg (total) </li><li>  .arg (currentFile)); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  If you need to change the order of the arguments during the translation, then during the translation you will need to change the variables with the% symbol in places, for example, like this: <br><br><blockquote>  ‚ÄúCopying file% 3.  % 1 of% 2 files copied ¬ª </blockquote><br><br>  Rewriting the program because of this is not required. <br><br><h4>  Step 2. Create a translation </h4><br>  After we have used tr () throughout the application, we need to create a translation of the text.  Text translation also contains 3 steps: <br><ol><li>  Run lupdate to extract translatable text from Qt application source code in C ++, creating a message file for translators (.ts file).  The utility recognizes the tr () and translate () constructors and the QT_TR * _NOOP () macros described above and produces .ts files (usually one for each language). </li><li>  Providing translations for source texts in a .ts file using Qt Linguist.  Since .ts files are in XML format, they can also be edited manually. </li><li>  Run lrelease to get a lightweight message file (.qm file) from an .ts file that is convenient only for end use.  Think of the .ts files as "source files", and of the .qm files as "object files."  The translator edits the .ts files, but users of our application only need .qm files.  Both file types are platform and locale independent. </li></ol><br><br>  Usually you need to repeat these steps for each release of the application.  The lupdate utility does its best to reuse translations from previous releases. <br>  Before running lupdate, you need to prepare a project file.  This is how our project file will look like (helloworld.pro file): <br><br>  TEMPLATE = app <br>  TARGET = release <br>  DEPENDPATH + =. <br>  INCLUDEPATH + =. <br>  SOURCES + = main.cpp <br>  TRANSLATIONS + = helloworld_ru.ts <br><br>  When you run lupdate or lrelease, you must provide the name of the project file as a command line argument. <br><br><h4>  Step 3. Downloading translation files in the application. </h4><br>  In our application, we need to load QTranslator :: load () files using QcoreApplication :: installTranslator ().  The final version of the program will look like: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  #include &lt;QtGui&gt; </li><li>  #include &lt;QtCore&gt; </li><li></li><li>  <font color="#0000ff">int</font> main ( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> * argv []) { </li><li>  QApplication app (argc, argv); </li><li>  QTranslator myTranslator; </li><li>  myTranslator.load ( <font color="#A31515">"helloworld_"</font> + QLocale :: system (). name ()); </li><li>  app.installTranslator (&amp; myTranslator); </li><li>  QLabel label (app.translate ( <font color="#A31515">"QLabel"</font> , <font color="#A31515">"Hello, World!"</font> )); </li><li>  label.show (); </li><li>  <font color="#0000ff">return</font> app.exec (); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  We create a QTranslator object, load the translation file into it using the load () function.  In it we indicate the beginning of the name of our translation file.  By default, translation files are searched in the program folder, but you can specify any directory by passing its name as the second parameter to the function.  The extension ".qm" will be added automatically.  The Qlocale :: system (). Name () function returns the name of the current locale, in my case it was ru_RU.UTF-8.  The search for the translation file using the load () function is as follows: <br><br><ol><li>  helloworld_ru_RU.UTF-8.qm </li><li>  helloworld_ru_RU.UTF-8 </li><li>  helloworld_ru_RU.qm </li><li>  helloworld_ru_RU </li><li>  helloworld_q.qm </li><li>  helloworld </li><li>  helloworld.qm </li><li>  helloworld </li></ol><br><br>  The truth is, when I tried to download the translation file in Windows XP in this way, it didn‚Äôt work for me.  It turned out that (at least in my case) the function Qlocale :: system (). Name () always returned the value "C".  Therefore, it is worthwhile to provide an additional method for specifying the language of the application interface, for example, through the program settings dialog or command line parameters. <br><br>  That's all, our application is translated into Russian, but there are a couple more points that are worth mentioning in this article. <br><br><h4>  Additional text lines </h4><br>  Qt contains about 400 lines inside, which also need to be translated into the languages ‚Äã‚Äãwe need.  In the $ QTDIR / translations directory you can find translation files for French, German and Simplified Chinese, as well as templates for translations into other languages.  (This directory also contains some additional unsupported translations that may be useful, for example, a Russian translation). <br>  Usually, these transfers are also loaded into main () functions: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">int</font> main ( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> * argv []) </li><li>  { </li><li>  ... </li><li>  QTranslator qtTranslator; </li><li>  qtTranslator.load ( <font color="#A31515">"qt_"</font> + QLocale :: system (). name (), </li><li>  QLibraryInfo :: location (QLibraryInfo :: TranslationsPath)); </li><li>  app.installTranslator (&amp; qtTranslator); </li><li>  ... </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  Note the use of QLibraryInfo :: location () to detect Qt translations.  The developer must request a path to the translations by processing the QLibraryInfo :: TranslationsPath for this function instead of using the QTDIR environment variable in its applications.  Although in cases where we are not sure that the user has the full version of Qt, it makes sense to ship this translation file along with the program and download it from the program directory (or any other one of your choice). <br><br><h4>  Dynamic translation </h4><br>  Some applications must provide changes to the user's language settings during operation.  To warn widgets about changes to the set QTranslators, you can redo the function of the changeEvent () widget to check if the event is a LanguageChange event and update the text displayed by the widgets using the tr () function in the usual way.  For example: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">void</font> MyWidget :: changeEvent (QEvent * <font color="#0000ff">event</font> ) </li><li>  { </li><li>  <font color="#0000ff">if</font> (e-&gt; type () == QEvent :: LanguageChange) { </li><li>  titleLabel-&gt; setText (tr ( <font color="#A31515">"Document Title"</font> )); </li><li>  ... </li><li>  okPushButton-&gt; setText (tr ( <font color="#A31515">"&amp; OK"</font> )); </li><li>  } <font color="#0000ff">else</font> </li><li>  QWidget :: changeEvent ( <font color="#0000ff">event</font> ); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  All other change events must be handled by calling the default implementation of this function. <br>  The list of installed translations can be changed in response to the LocaleChange event, or the application can provide an interface to the user, which will allow him to change the current application language. <br>  The default event handler for QWidget subclasses responds to the QEvent :: LanguageChange event and will call this function if necessary;  In other application components, you can also force widgets to update themselves by sending them a LanguageChange event. <br>  UPD: As prompted by <a href="https://habrahabr.ru/users/intellinside/" class="user_link">intellinside</a> , the GUI classes generated by Qt Designer have a retranslateUi () function that can be called to dynamically change the language of the application. </div><p>Source: <a href="https://habr.com/ru/post/51319/">https://habr.com/ru/post/51319/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../51302/index.html">Extending wget features</a></li>
<li><a href="../51305/index.html">Search engine optimization. Part 1 - internal factors</a></li>
<li><a href="../51313/index.html">Psd - trick with file size</a></li>
<li><a href="../51315/index.html">Overview of SSL certificates: types, choices, benefits.</a></li>
<li><a href="../51318/index.html">Translator</a></li>
<li><a href="../51321/index.html">SQLAlchemy rocks!</a></li>
<li><a href="../51322/index.html">Free replacement for powerful Alcohol, Nero and other virtual drive programs</a></li>
<li><a href="../51327/index.html">The system of separation of access rights in the web application</a></li>
<li><a href="../51328/index.html">Introduction to jabber bots</a></li>
<li><a href="../51330/index.html">Stylization of form elements. We improve one of the solutions.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>