<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another smart home, in three parts. Part One, Iron</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to tell and show the results of the project, which has been developing for about 10 years. It develops as a hobby, so it happens that in a week...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another smart home, in three parts. Part One, Iron</h1><div class="post__text post__text-html js-mediator-article">  I want to tell and show the results of the project, which has been developing for about 10 years.  It develops as a hobby, so it happens that in a week a new device is made, and then in half a year nothing is done.  I really do not like the phrase "Smart Home", so it will not meet further.  Also, there will be no circuits, code examples, wired prototyping boards and other boring things.  There will be a lot of photos and discussions on general topics. <br><br><img src="https://habrastorage.org/files/4db/bc7/6df/4dbbc76dfb0247e1a7de2747d546e4fd.jpg" alt="image"><br><a name="habracut"></a><br><h3>  How it all began, or Lighting Controller </h3><br>  About 10 years ago it somehow coincided that I got a job as a developer of embedded electronics and bought an apartment.  There was little money, the apartment was a one-room, I lived alone.  I wanted something that, as I later found out, was called "Studio Apartment".  An exciting lesson began that could not be completed - repairs.  And from what the person who has taken a soldering iron picked up before hand begins to do repair?  Correctly, with the wiring.  I wanted to turn on the light from the remote control from the TV.  No sooner said than done.  Then I wanted to, in the dark time when opening the front door, the light in the hallway turned on.  Reed switch in the door works.  Then I wanted the doorbell to be turned off.  Ok done.  Then he wanted to go to the toilet at night, turn on a small light bulb.  Ok, I connected the motion sensor.  Well, since I have such a smart switch - can I connect it to a computer?  Hooked up.  In general, after about five iterations of hardware and hundreds, if not thousands of software iterations, this is the lighting controller. <br><br><img src="https://habrastorage.org/files/795/8e6/0ee/7958e60ee6ba48209121d8169ada007a.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What does he do? <br><ul><li>  4 channels of lighting, continuously adjustable; </li><li>  Relay doorbell, or lock; </li><li>  Door opening sensor, movement, bell button; </li><li>  RC-5 remote control receiver. </li></ul><br><br><h3>  Lighting and heating controller </h3><br>  The next step was the repair in the bathroom.  And what is most important in the toilet and bathroom?  <s>Freshener, book or tablet.</s>  Warm floor.  And there is also a fan, and a pair of channels of light.  And I want to open the door at night and the faint light would turn on itself.  And then the fan was turned on for a couple of minutes.  So, stop.  4 exits.  Yeah, there is a lighting controller!  I redid it a bit, and in the end I got a lighting controller and a warm floor.  Looking ahead - then it was divided into two slightly different logical devices - for heating and for bathrooms, balconies, kitchens.  In the first, three temperature sensors are connected, one in the control loop, two simply for measurements;  for example, outdoor temperature and, for example, coolant temperature.  The second remained with one temperature sensor, but got a pair of leakage sensors.  Here it is in the photo: <br><br><img src="https://habrastorage.org/files/2fe/b7d/759/2feb7d759098479095e4b07987e833fe.jpg" alt="image"><br><br>  What does he do? <br><ul><li>  2 channels of lighting, continuously adjustable; </li><li>  Fan outlet; </li><li>  Outlet to connect the heater; </li><li>  Heater power control relay (for heating) or leakage protection actuator (for sanitary facilities); </li><li>  Door opening sensor </li></ul><br><br>  Then he took up the balcony.  There are also a couple of channels of light, warm floor.  The second controller got a brother. <br><br><h3>  Power supply controller </h3><br>  Everything worked, everything was fine until I went on vacation ... I came back - the refrigerator does not work.  An autopsy revealed a blown varistor and fuse.  It is clear that the voltage jump, it‚Äôs good that they limited everything to two.  Changed, earned.  But the trouble does not come alone, after a couple of weeks the same thing happened with the air conditioner. <br>  Need to do something.  What?  That's right, the controller to protect the power grid. <br><br><img src="https://habrastorage.org/files/f4c/faf/1c2/f4cfaf1c2d37420080a60dc4a733005c.jpg" alt="image"><br><br>  What does he do? <br><ul><li>  Two channels of voltage measurement, for example, before and after the normalizer or bespereboynik; </li><li>  Current measurement; </li><li>  Relay disconnect consumers at the time of excess voltage; </li><li>  Output to shunt release to completely shut off everything; </li><li>  Adjustable protection thresholds, the calculation of power consumption - instant, per hour, per day, complete. </li></ul><br><br><h3>  Water supply and irrigation controller </h3><br>  At the same time, I changed jobs, began to <s>dress</s> better, I bought a car and saved up some money.  And what does a city dweller do with a car and some free money?  Buys a cottage.  I did not become an exception.  Electricity there was constant, but the water was worse.  There was a pipe from which in a day there was barely anything that flowed there.  The task is clear, we need a barrel, a pump station and a boiler.  And of course, another controller.  This time the water supply and irrigation. <br><br>  But here the interesting begins - pressure and water level sensors, soil moisture sensor.  The industrial ones are not at all humane, so I decided to do it myself.  The water level in the tank - first tried capacitive, did not work.  And different sensors, and different schemes - no way.  All right, I will try another principle, ultrasound, since there are many inexpensive ones in China.  It worked.  At the same time there added a humidity sensor and temperature. <br><br><img src="https://habrastorage.org/files/026/ec1/e5d/026ec1e5df9f47789e5de5e9294c4e91.jpg" alt="image"><br><br>  Pressure.  Where else measure the pressure of liquids?  Yeah, car!  I chose the Gazov oil pressure sensor.  According to the parameters of 0-6 atm, the thread is the same as on the water dial gauges.  There were doubts about corrosion resistance - but for three years everything has been working.  You can change in advance, they are worth a penny.  Here it is, to the left of the pressure gauge.  The flow meter was made on the basis of a conventional water meter, sticking a magnet on the impeller, and a Hall sensor on the case. <br><br><img src="https://habrastorage.org/files/8b9/2d3/784/8b92d37849a64e6ebf2d791cd0dc5ea8.jpg" alt="image"><br><br>  Soil moisture sensor.  I also made capacitive, but did not grow together, in the end I simply measure the resistance with two probes.  Well, the temperature of the soil, let it be. <br><br><img src="https://habrastorage.org/files/638/d8d/ec6/638d8dec62954f85af6e9ee7366f8b9f.jpg" alt="image"><br><br>  It turned out something like this (yes, apparently they are all the same): <br><br><img src="https://habrastorage.org/files/836/b14/1ac/836b141acbe74608bf8bc878b0366ba1.jpg" alt="image"><br><br>  What does he do? <br><ul><li>  Outputs for pumping station, water heater and water valve in the tank; </li><li>  Remote sensor of water level in the tank, humidity and temperature; </li><li>  Remote sensor of humidity and temperature of the soil; </li><li>  Two pressure sensors, flow meter, control of pumping station automation; </li><li>  4 channels of control irrigation valves; </li></ul><br><br><h3>  RGB tape controller </h3><br>  Then at home I wanted to make a decorative lighting.  Bought RGB tapes, and how to manage?  Buy ready?  Not my method, we do the interior lighting controller.  Here is this: <br><br><img src="https://habrastorage.org/files/2e9/ec4/eba/2e9ec4ebaba045998d482b34f572480a.jpg" alt="image"><br><br>  What does he do? <br><ul><li>  4 PWM outputs for LED strips, RGB + white; </li><li>  and nothing more. </li></ul><br><br><h3>  RS485 Gateway - Ethernet </h3><br>  All is well, but RS485 ... where is it?  There were several options, I will describe in the next part, in the end it all came down to another controller.  He also connected the drive of the entrance gate. <br><br><img src="https://habrastorage.org/files/9d3/a85/fc0/9d3a85fc04b14d7d9cb195bfe8d3bb03.jpg" alt="image"><br><br>  What does he do? <br><ul><li>  4 discrete and 3 analog inputs, 2 relay outputs. </li><li>  Real time clock. </li><li>  And most importantly - the RS485 gateway - Ethernet. </li></ul><br><h3>  Summing up </h3><br>  I would like to talk about some of the nuances from my point of view. <br><br>  <b>Why RS-485, and not wireless interfaces?</b>  <b>Why not Wi-Fi?</b> <br>  I don‚Äôt already remember where, but I heard such a phrase - where you can lay copper, you need to lay copper there.  As you can see, for the introduction of this system it is necessary to almost completely redo the wiring.  So why not lay additional signal wires?  What is better - not just sitting down batteries, clogged air or good old copper? <br><br>  <b>Why not ARM with Linux, and the ancient 8-bit controller?</b>  <b>How is the internet of things?</b> <br>  Everything is simple - the principle of reasonable sufficiency.  Why use megabytes of memory and Linux to light a light bulb?  And in any case, the power unit, input circuits, etc. will be exactly the same. <br><br>  <b>Why not touch screens, custom switches, mobile phones, tablets, voice control?</b> <br>  I believe that interfaces should be uniform.  When I wake up at night to drink water, I don‚Äôt want to figure out which of the 5 buttons I press to turn on the light.  I want to click on the standard switch, drink water and go to bed on.  I do not want each of the visitors to tell me what needs to be done in order to turn on the light in my house.  It's one thing with the tablet to set up a schedule for watering or lighting, set limits for the allowable voltage to protect, and quite another to turn on the lights. <br><br>  <b>But what about management via the Internet?</b> <br>  Of course, control over the Internet is.  I can do anything from anywhere within a framework implemented in hardware.  But there is one thing - all controllers must be autonomous and carry out their basic functions without any network, Internet or other servers.  If I forgot to pay for the Internet - I do not want to be without light.  If I have a bad connection in the country - I just want to press a button on the controller to turn on the pump and tank.  A watering schedule - you can customize and then. <br><br><hr><br>  With the iron part on it all, in the next, second part, I will describe the server part.  And I will show some more photos of all this in the collection on the example of a couple of projects. </div><p>Source: <a href="https://habr.com/ru/post/253505/">https://habr.com/ru/post/253505/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../253493/index.html">Analyzing the attendance of employees according to the access control</a></li>
<li><a href="../253495/index.html">The engineering device data center level TIER III, standing on four trunk lines</a></li>
<li><a href="../253497/index.html">Quick server setup with PowerShell Desired State Configuration</a></li>
<li><a href="../253501/index.html">The domain zone .com is 30 years old</a></li>
<li><a href="../253503/index.html">Architectural visualization in Unreal Engine 4</a></li>
<li><a href="../253507/index.html">Google Play Review, Paying Selfie, Apple's Trade-in - and other news of the week for a mobile developer</a></li>
<li><a href="../253509/index.html">Amtech fluxes: a world wide hoax</a></li>
<li><a href="../253511/index.html">New loyalty program for developers from Microsoft</a></li>
<li><a href="../253513/index.html">Tamagochi as a key for intercom and travel card in the subway</a></li>
<li><a href="../253515/index.html">Areas ... Quarters ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>