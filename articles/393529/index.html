<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HUD speedometer - from idea to result</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 I have not written anything for a long time, now it is more a news resource, and not a practical one. I'll try to correct the situation. I'll...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HUD speedometer - from idea to result</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br>  I have not written anything for a long time, now it is more a news resource, and not a practical one.  I'll try to correct the situation.  I'll tell you about the development of a HUD-speedometer.  Although not a <a href="https://geektimes.ru/company/wayray/blog/279972/">laser projection</a> , it is accessible and compact. <br>  <b>Introduction</b> <br>  It began with the fact that I got into the hands of large 3.3 "seven-segment indicators. I ordered them for watches that were not born. It was necessary to have 4 pieces, in lot 5, the Chinese put six. After evaluating the size, brightness and reflection from the windshield I decided - here it is. Due to the size, the split image is not visible, and the jacuzzi allows you to use it even in direct sun.I agree that the Chinese have beautiful finished pieces that are quite inexpensive (all prices at the time of this writing) are from 1800r. (close eyes on unsporting  such a decision): <br>  1. It is necessary to glue the film on the glass - although it is transparent, it still covers the review, but I do not like it when something is interfering with the glass.  Slightly leaned back, moved the chair - and the film must be re-glued.  Well, even with the film almost nothing is visible on a sunny day. <br>  2. You can not glue the film, then tsiferki (they are quite small) are split, and nothing is visible in the sun. <br>  For the seed, the result is without film anywhere on the glass and even during the day: <br><img src="https://habrastorage.org/files/ff6/b22/fc5/ff6b22fc52b64ef1b49e753cf85203ff.png"><br><br>  Under the cat I promise a lot of pictures, mediocre video, code and text - all in the best traditions. <br><a name="habracut"></a><br>  <b>Theory</b> <br>  The idea is simple - for a fixed period of time we count the number of pulses from the speed sensor.  As a simple and affordable CPU, ATMega8. <br>  The first difficulty turned out to be in agreement with the MK 5 V and the 7.5 V indicators. Fantasy drew a circuit from a pack of transistors and resistors (7 elements with dynamic indication).  Of all the Google, only one article about the replacement of indicators in the clock helped me, sorry I lost her address.  Taking this opportunity, I convey my gratitude to the author for the idea of ‚Äã‚Äãusing TD62783 (from 5 pieces in a lot).  Actually, this is a seven-segment indicator driver, inside a transistor assembly. <br>  Next, a DC / DC converter.  Made on the MC34063, I have a lot of them, I stock them.  I counted on a calculator, checked it with a tester - 7.5 V. In the field trials it was not enough, the brightness was not enough, increased to 10 V. <br>  The brightness is adjusted based on the readings of the light sensor, which is the usual Chinese photoresistor. <br>  As a result, the scheme turned out this: <br><img src="https://habrastorage.org/files/c2a/f7f/9a8/c2af7f9a87e44b3c8096cb226beff9b1.png"><br>  <b>Practice</b> <br>  The PCB I threw <a href="https://geektimes.ru/post/255296/">TopoR</a> .  I took advantage of auto-placement, although I fixed most of the elements manually.  But progress must work for me, and not only for progress.  It turned out beauty: <br><img src="https://habrastorage.org/files/ff6/75a/f61/ff675af611bb4a16988ef316f5efba70.png"><img src="https://habrastorage.org/files/920/8e8/1a6/9208e81a60364c3ca3acba4b4041c5c4.png"><br>  With the width of the U4 case I missed, I had to finish the tracks and did not solder the 11th leg. <br>  How it looks in real life: <br><img src="https://habrastorage.org/files/30a/758/c18/30a758c18cc64043a5e8eff2bc50df12.jpg"><br><img src="https://habrastorage.org/files/5d8/fa2/1cf/5d8fa21cf4c04799878eebdbbd8918d8.jpg"><br><img src="https://habrastorage.org/files/a84/745/d1b/a84745d1b01644f0b37b8460c11d094e.jpg"><br>  The next nezhdanchik crept in the software (I will not tell you how I forgot to mirror the 2 and 5, 4 - there is nothing to be proud of).  More difficult was the problem: the counter had the necessary number of pulses for too long.  For example, at 60 km / h, counting 60 pulses from the speed sensor took more than a second.  This rare update of the testimony did not suit me. <br>  It was necessary to multiply each floor measurement by 2. <br>  A linear change in brightness as compared to illumination did not fit: when it was slightly darker - the brightness was insufficient, when it was almost dark - the brightness was too much.  Launched Excel, built a graph for different mathematical functions.  In the end, I chose the square. <br><img src="https://habrastorage.org/files/879/6f1/217/8796f12172ba4f0ba9d5cdd77da3e15e.png"><br><br>  Bascom Code: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><code>'HUD-speedometer <br> '17/01/2016 <br> '21/01/2016 <br> 'v1.1 <br> <br> $regfile = "m8adef.dat" <br> $crystal = 4000000 <br> $hwstack = 40 <br> $swstack = 16 <br> $framesize = 32 <br> <br> Config Portb = Output <br> Config Portc = Output <br> Config Portd = Output <br> Config Portd.4 = Input <br> Portd.4 = 1 <br> Config Timer0 = Counter , Edge = Falling <br> Config Timer1 = Pwm , Pwm = 8 , Compare_a_pwm = Clear_up , Compare_b_pwm = Clear_up , Prescale = 8 <br> Config Timer2 = Timer , Prescale = 1024 <br> On Timer2 Mytimer2 <br> Enable Interrupts <br> Enable Timer2 <br> Config Adc = Single , Prescaler = Auto , Reference = Internal <br> Start Adc <br> <br> Dim I As Byte '    <br> Dim N As Byte '   <br> Dim Pwm_value As Integer ' <br> Dim Speed As Integer , Speed_half As Integer , First_symbol As Integer , Second_symbol As Integer <br> Dim A As Integer ' Speed  Speed_half <br> Dim R1 As Word <br> Declare Sub Digit_indication(digit As Integer) '  <br> <br> Const P = 500 <br> Const T = 5000 '    <br> Const T1 = 1000 '    PWM <br> Pwm_value = 5 <br> Tcnt0 = 0 ' <br> <br> Do <br> Incr I <br> If I = 25 Then '    <br> R1 = Getadc(7) <br> R1 = Sqr(r1) '  <br> R1 = R1 * 8 <br> If R1 &lt; 250 Then <br> Pwm_value = 250 - R1 <br> Else <br> Pwm_value = 3 '  <br> End If <br> I = 0 <br> End If <br> Gosub Indication <br> Loop <br> <br> Indication: <br> If Speed &lt; 3 Then '  0 -  , 3 -    <br> Pwm_value = 0 <br> End If <br> While Speed &gt; 99 '..  2  <br> Speed = Speed - 100 <br> Wend <br> First_symbol = Speed / 10 '  <br> Second_symbol = First_symbol * 10 ' <br> Second_symbol = Speed - Second_symbol '  <br> Pwm1b = 0 <br> Pwm1a = 0 <br> Waitus T1 '   <br> Call Digit_indication(first_symbol) '   <br> Pwm1b = Pwm_value <br> Waitus T <br> Pwm1b = 0 <br> Pwm1a = 0 <br> Waitus T1 '   <br> Call Digit_indication(second_symbol) <br> Pwm1a = Pwm_value <br> Waitus T <br> Return <br> <br> Sub Digit_indication(digit As Integer) <br> Select Case Digit <br> Case 0: <br> Portd.0 = 0 <br> Portc.0 = 1 <br> Portc.1 = 1 <br> Portc.2 = 1 <br> Portc.3 = 1 <br> Portc.4 = 1 <br> Portc.5 = 1 <br> Case 1: <br> Portd.0 = 0 <br> Portc.0 = 1 <br> Portc.1 = 0 <br> Portc.2 = 0 <br> Portc.3 = 0 <br> Portc.4 = 0 <br> Portc.5 = 1 <br> Case 2: <br> Portd.0 = 1 <br> Portc.0 = 0 <br> Portc.1 = 1 <br> Portc.2 = 1 <br> Portc.3 = 0 <br> Portc.4 = 1 <br> Portc.5 = 1 <br> Case 3: <br> Portd.0 = 1 <br> Portc.0 = 1 <br> Portc.1 = 1 <br> Portc.2 = 0 <br> Portc.3 = 0 <br> Portc.4 = 1 <br> Portc.5 = 1 <br> Case 4: <br> Portd.0 = 1 <br> Portc.0 = 1 <br> Portc.1 = 0 <br> Portc.2 = 0 <br> Portc.3 = 1 <br> Portc.4 = 0 <br> Portc.5 = 1 <br> Case 5: <br> Portd.0 = 1 <br> Portc.0 = 1 <br> Portc.1 = 1 <br> Portc.2 = 0 <br> Portc.3 = 1 <br> Portc.4 = 1 <br> Portc.5 = 0 <br> Case 6: <br> Portd.0 = 1 <br> Portc.0 = 1 <br> Portc.1 = 1 <br> Portc.2 = 1 <br> Portc.3 = 1 <br> Portc.4 = 1 <br> Portc.5 = 0 <br> Case 7: <br> Portd.0 = 0 <br> Portc.0 = 1 <br> Portc.1 = 0 <br> Portc.2 = 0 <br> Portc.3 = 0 <br> Portc.4 = 1 <br> Portc.5 = 1 <br> Case 8: <br> Portd.0 = 1 <br> Portc.0 = 1 <br> Portc.1 = 1 <br> Portc.2 = 1 <br> Portc.3 = 1 <br> Portc.4 = 1 <br> Portc.5 = 1 <br> Case 9: <br> Portd.0 = 1 <br> Portc.0 = 1 <br> Portc.1 = 1 <br> Portc.2 = 0 <br> Portc.3 = 1 <br> Portc.4 = 1 <br> Portc.5 = 1 <br> End Select <br> End Sub <br> <br> Mytimer2: <br> Incr N <br> If N = 26 Then <br> N = 0 <br> Speed = Tcnt0 'Speed =     <br> Tcnt0 = 0 '   <br> End If <br> If N = 13 Then '..      (  ) <br> Speed_half = Tcnt0 * 2 '  <br> A = Speed - Speed_half <br> A = A And &amp;B0111111111111111 ' <br> If A &gt; 2 Then <br> Speed = Speed_half <br> End If <br> End If <br> Timer2 = 135 ' 135  <br> Return <br></code> <br></div></div><br>  At the end of the 135 - correction factor, selected it for each machine individually (135 is for Logan, for Solaris was less - everyone has different speed sensors). <br>  Promised video.  Sorry for the quality, filmed on a piece of blue tape with one hand, ruled with the other: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/s9eSjLEi_6M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Indicators do not light when the speed is less than 3 km / h.  If the speed is greater than 99, it displays without the first character. <br><br>  <b>Budget:</b> <br>  ATMega8 - 200r for 5 pieces - 40r <br>  Indicators - 825r for 10 pcs - 165r <br>  TD62783 - 250r for 5 pieces - 50r <br>  I had the rest of the payouts, but in general it is clear that you can meet the 500r. <br><br>  More to tell and nothing.  It turned out a big beautiful counter.  Tested on Solaris.  The focus failed, the focus was not a speed sensor.  Slightly finish the program for working with OBD2 via ELM327. <br>  <a href="https://yadi.sk/d/6K5GUGYQuyUwW">Folder with the project on Yandex.Disk</a> <br>  Thank you all for your attention! </div><p>Source: <a href="https://habr.com/ru/post/393529/">https://habr.com/ru/post/393529/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../393517/index.html">Religion, Superstition, and Cosmos</a></li>
<li><a href="../393521/index.html">After five days of compilation, Gentoo Linux is installed on the Tesla Model S</a></li>
<li><a href="../393523/index.html">Downtime compensation options from Google and Telstra</a></li>
<li><a href="../393525/index.html">Very Large Telescope has even more features.</a></li>
<li><a href="../393527/index.html">The world's first asymmetric single-piece drone</a></li>
<li><a href="../393531/index.html">Service anonymous blog "Something like this ..." - rethinking and work on the bugs</a></li>
<li><a href="../393533/index.html">In the United States started testing the world's largest unmanned ship "Sea Hunter"</a></li>
<li><a href="../393535/index.html">4xiDraw: homemade pen plotter on Arduino</a></li>
<li><a href="../393539/index.html">Launch Nextion Editor 0.34 under Wine</a></li>
<li><a href="../393543/index.html">Homey Review, Smart Ball Project from Athom Kickstarter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>