<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We implement pull to refresh and infinite scrolling on Swift</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Let's take the article as a basis. Meet Swift! where it is shown how to make a simple application in Swift, and add there such well-known and useful t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We implement pull to refresh and infinite scrolling on Swift</h1><div class="post__text post__text-html js-mediator-article">  Let's take the article as a basis. <a href="http://habrahabr.ru/post/225297/">Meet Swift!</a>  where it is shown how to make a simple application in Swift, and add there such well-known and useful things like <b>pull to refresh</b> and <b>infinite scrolling</b> using the built-in language features.  To make it even more interesting, add a little asynchrony, otherwise the application will freeze each time during the update. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a06/36e/404/a0636e404c1a90918cebfdd3e715fb73.jpg"><br><a name="habracut"></a><br><h4>  Training </h4><br>  We take the above example as a basis, so we will simply supplement it.  To begin with, we add 2 variables to the controller class, which will be responsible for the number of cells and for the text displayed in the cells. <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ViewController</span></span>: <span class="hljs-title"><span class="hljs-title">UIViewController</span></span>, <span class="hljs-title"><span class="hljs-title">UITableViewDataSource</span></span>, <span class="hljs-title"><span class="hljs-title">UITableViewDelegate</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> countRow = <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = <span class="hljs-string"><span class="hljs-string">"Habrapost"</span></span></code> </pre> <br>  And we modify the cell generation code using these variables. <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tableView: UITableView!, numberOfRowsInSection section: Int</span></span></span><span class="hljs-function">) -&gt; Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> countRow } <span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tableView: UITableView!, cellForRowAtIndexPath indexPath: NSIndexPath!</span></span></span><span class="hljs-function">) -&gt; UITableViewCell!</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell: UITableViewCell = UITableViewCell(style: UITableViewCellStyle.Subtitle, reuseIdentifier: <span class="hljs-string"><span class="hljs-string">"MyTestSwiftCell"</span></span>) cell.text = <span class="hljs-string"><span class="hljs-string">"\(text) \(indexPath.row)"</span></span> cell.detailTextLabel.text = <span class="hljs-string"><span class="hljs-string">"Hi, \(indexPath.row)"</span></span> cell.detailTextLabel.textColor = UIColor.purpleColor() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell }</code> </pre> <br>  Now we will bind the TableView to the controller so that we can perform the necessary manipulations on it.  In the interface builder, select the TableView, press cmd + alt + enter and right-click in the appeared window <br><img src="https://habrastorage.org/getpro/habr/post_images/b81/3df/f0f/b813dff0fd7deeadb4adfd33b693dd75.jpg"><br><br>  We drive in the name by which we will apply <br><img src="https://habrastorage.org/getpro/habr/post_images/fb8/440/be4/fb8440be49fc8c75f771e4d323dc5d08.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will also add the View component to the TableView, on which we place 2 elements in order to get the following <br><img src="https://habrastorage.org/getpro/habr/post_images/901/44c/0c8/90144c0c82dc01d111e9eae34e629163.jpg"><br><br>  This View is needed in order to display a notification that an update is in progress, and we need it to be visible only when new data is being loaded (for this we will use the tableFooterView.hidden property), therefore we need to hide it at the beginning, and show only later.  You will also need to manually start the animation UIActivityIndicatorView, for this, similarly as above, add a binding <br><img src="https://habrastorage.org/getpro/habr/post_images/a19/70d/c60/a1970dc60fe052a34ae4995775463c55.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/289/463/223/289463223512326f7153db9b6c718037.jpg"><br><br>  For the preliminary preparation of these actions will be enough. <br><br><h4>  Pull to refresh </h4><br>  Now you can go directly to the implementation of pull to refresh.  In the controller class, add a new variable of the special class UIRefreshControl <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> refreshControl:UIRefreshControl!</code> </pre> <br>  In viewDidLoad, add the code that initializes this variable and binds it to the tableView. <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { super.viewDidLoad() refreshControl = UIRefreshControl() refreshControl.attributedTitle = NSAttributedString(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>: <span class="hljs-string"><span class="hljs-string">" ..."</span></span>) refreshControl.addTarget(self, action: <span class="hljs-string"><span class="hljs-string">"refresh:"</span></span>, forControlEvents: UIControlEvents.ValueChanged) tableView.addSubview(refreshControl) }</code> </pre> <br>  Now we need to define the refresh function, which will be called every time during the pull-to-refresh action.  To make the update happen in asynchronous mode, we use the following scheme (I will not go into the description of the details, it's not difficult to figure out the code yourself) <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refresh</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">sender:AnyObject</span></span></span><span class="hljs-function">)</span></span> { refreshBegin(<span class="hljs-string"><span class="hljs-string">"Refresh"</span></span>, refreshEnd: {(x:Int) -&gt; () <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.tableView.reloadData() self.refreshControl.endRefreshing() }) } <span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">refreshBegin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newtext:String, refreshEnd:(Int</span></span></span><span class="hljs-function">) -&gt; (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>))</span></span> { dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="hljs-number"><span class="hljs-number">0</span></span>)) { println(<span class="hljs-string"><span class="hljs-string">"refreshing"</span></span>) self.text = <span class="hljs-function"><span class="hljs-function">newtext </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sleep</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispatch_async</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch_get_main_queue(</span></span></span><span class="hljs-function">))</span></span> { refreshEnd(<span class="hljs-number"><span class="hljs-number">0</span></span>) } } }</code> </pre><br>  As a result, we get <br><img src="https://habrastorage.org/getpro/habr/post_images/578/1a0/76e/5781a076e5141f582b83974cd9d6f4dd.jpg"><br><br>  <b>UPD:</b> If you use UITableViewController (and it is better to use it in this and similar cases), then the code will be even easier.  UITableViewController already has tableView and refreshControl properties, so you don‚Äôt need to bind the UITableView manually and you don‚Äôt need to declare refreshControl in the class.  Just write the following code in viewDidLoad and everything will work <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { super.viewDidLoad() refreshControl = UIRefreshControl() refreshControl.attributedTitle = NSAttributedString(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>: <span class="hljs-string"><span class="hljs-string">" ..."</span></span>) refreshControl.addTarget(self, action: <span class="hljs-string"><span class="hljs-string">"refresh:"</span></span>, forControlEvents: UIControlEvents.ValueChanged) }</code> </pre> <br><br><h4>  Infinite scrolling </h4><br>  With endless scrolling a bit more difficult, but not by much.  We will add a new variable loadMoreStatus to the controller class, which will be responsible for protecting it from re-updating if it is already running. <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> loadMoreStatus = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  In viewDidLoad we will add a code that will initially hide the View with information about the loading of new data <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { super.viewDidLoad() refreshControl = UIRefreshControl() refreshControl.attributedTitle = NSAttributedString(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>: <span class="hljs-string"><span class="hljs-string">" ..."</span></span>) refreshControl.addTarget(self, action: <span class="hljs-string"><span class="hljs-string">"refresh:"</span></span>, forControlEvents: UIControlEvents.ValueChanged) tableView.addSubview(refreshControl) self.tableView.tableFooterView.hidden = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br>  Add the definition of the special function scrollViewDidScroll, which is called every time any scrolling occurs.  If we reach the end of the list, the loadMore function is called, which implements the asynchronous loading of new data. <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scrollViewDidScroll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">scrollView: UIScrollView!</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currentOffset = scrollView.contentOffset.y <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> maximumOffset = scrollView.contentSize.height - scrollView.frame.size.height <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> deltaOffset = maximumOffset - currentOffset <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> deltaOffset &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> { loadMore() } } <span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadMore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !loadMoreStatus ) { self.loadMoreStatus = <span class="hljs-literal"><span class="hljs-literal">true</span></span> self.activityIndicator.startAnimating() self.tableView.tableFooterView.hidden = <span class="hljs-function"><span class="hljs-literal"><span class="hljs-function"><span class="hljs-literal">false</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadMoreBegin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Load more"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, loadMoreEnd: {(x:Int</span></span></span><span class="hljs-function">) -&gt; (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">in</span></span></span><span class="hljs-function"> self.tableView.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reloadData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) self.loadMoreStatus</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span> self.activityIndicator.stopAnimating() self.tableView.tableFooterView.hidden = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }) } } <span class="hljs-function"><span class="hljs-function">func </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadMoreBegin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newtext:String, loadMoreEnd:(Int</span></span></span><span class="hljs-function">) -&gt; (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>))</span></span> { dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="hljs-number"><span class="hljs-number">0</span></span>)) { println(<span class="hljs-string"><span class="hljs-string">"loadmore"</span></span>) self.text = newtext self.countRow += <span class="hljs-number"><span class="hljs-number">20</span></span> sleep(<span class="hljs-number"><span class="hljs-number">2</span></span>) dispatch_async(dispatch_get_main_queue()) { loadMoreEnd(<span class="hljs-number"><span class="hljs-number">0</span></span>) } } }</code> </pre><br>  As a result, everything works, the application does not freeze, and the data is added successfully <br><img src="https://habrastorage.org/getpro/habr/post_images/8d8/bfe/103/8d8bfe1038746f499b14756524688386.jpg"><br><br>  In this simple way, you can implement pull to refresh and infinite scrolling, and of course, because of the asynchronous update, you can, for example, make JSON requests to the server in a simple synchronous way and this does not interfere with the operation of the application. </div><p>Source: <a href="https://habr.com/ru/post/228881/">https://habr.com/ru/post/228881/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228869/index.html">Intersystems Cach√©: Globals API for .NET - direct access to globals from C #</a></li>
<li><a href="../228871/index.html">Google closes orkut</a></li>
<li><a href="../228875/index.html">5 key elements of friendly notifications</a></li>
<li><a href="../228877/index.html">Where games grow from. Interview with David Helgason - CEO Unity</a></li>
<li><a href="../228879/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ116 (June 29 - July 6, 2014)</a></li>
<li><a href="../228893/index.html">[Translation] Do not be afraid of functional programming</a></li>
<li><a href="../228895/index.html">Digest of articles on data analysis No. 4 (06.23.2014 ‚Äî06.07.2014)</a></li>
<li><a href="../228897/index.html">FiDELYS: smart watches, fitness tracker and security system</a></li>
<li><a href="../228899/index.html">Elena, "electronic girl" from the support service</a></li>
<li><a href="../228901/index.html">When you need something almost ready</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>