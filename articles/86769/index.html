<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Local ISO repository in Citrix XenServer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In some circumstances, I needed to install and configure Citrix XenServer. The distribution was downloaded from the Citrix website and successfully in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Local ISO repository in Citrix XenServer</h1><div class="post__text post__text-html js-mediator-article"> In some circumstances, I needed to install and configure Citrix XenServer.  The distribution was downloaded from the Citrix website and successfully installed on the HP server.  It seems to be able to stick it in a rack and enjoy the virtual life of the servers, but it was not there.  As it turned out, XenServer does not provide local storage for distributions, more precisely for ISO images.  It is assumed that all distributions will lie on the network storage (to work with which there are all the tools), but if we talk about the Stand-alone server, without any network storage, then there are various ideas.  One of these ideas under the cut. <br><a name="habracut"></a><br><br>  So, there is a task: you need to make a repository of ISO images on the same server on which XenServer is installed. <br><br>  First, go to the Citrix XenServer documentation and find an article there: <a href="http://docs.vmd.citrix.com/XenServer/5.0.0/1.0/en_gb/guest.html">docs.vmd.citrix.com/XenServer/5.0.0/1.0/en_gb/guest.html#iso_local_copies</a> , which seems to be how very simple and quickly the task is solved.  However, I do not recommend doing so.  Under the operating system with a hypervisor, about 3 gigabytes is allocated on the disk, of which 1.7 gigabytes are free.  Therefore, trying to copy the ISO image of Windows Server 2008 R2 with a volume of about 2.5 gigabytes, they killed XenServer completely. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Having climbed the Admin Guide for XenServer, we find that XenServer can connect to ISO network storages.  In this regard, it is necessary to allocate space for the ISO storage on the server, make it available over the network and then connect to our XenServer.  I do not pretend to the correctness of this decision, but in my case it completely suited me. <br><br>  Now more in steps: <br>  1. The screenshot shows that we have Local Storage, from which we will cut a piece to organize an ISO repository <br><img src="https://habrastorage.org/getpro/habr/post_images/aa6/26d/1e6/aa626d1e6f360a6694a747d9a6950056.png" alt="image"><br><br>  2. It is necessary to determine the SR UUID (Storage Repositpry Universal Unique IDentificator) for the Local Storage disk, for this we enter the command: <br>  xe sr-list type = lvm, the result of the command execution is visible in the screenshot: <br><img src="https://habrastorage.org/getpro/habr/post_images/bd7/171/318/bd7171318b7d9f0309144b0c080fb966.png" alt="image"><br>  from the output we need the highlighted identifier sr uuid <br><br>  3. Now we define the PBD UUID (Phisical Block Device Universal Unique IDentificator) on which the Local Storage is located, for this we enter the command: <br>  heh pbd-list sr-uuid = ... (here we indicate the number we received in the previous step) <br><img src="https://habrastorage.org/getpro/habr/post_images/18b/113/fbb/18b113fbb38bdc18082963f7544e55bc.png" alt="image"><br>  from the information received, we will need a distinguished identifier pbd uuid <br><br>  4. Unmount Local Storage, for this we enter: <br>  xe pbd-unplug uuid = ... (the number obtained in step 3 is indicated here) <br><img src="https://habrastorage.org/getpro/habr/post_images/7ad/a36/657/7ada36657633fd58e21bba99c7806f98.png" alt="image"><br>  after that, in the XenCenter console, the Local Storage storage will be highlighted with an exclamation mark: <br><img src="https://habrastorage.org/getpro/habr/post_images/45a/6a9/368/45a6a936888d6bc2bc872fea53ea2135.png" alt="image"><br><br>  5. Now delete the Local Storage command: <br>  xe pbd-destroy uuid = ... (specify pbd uuid, obtained in step # 3) <br><img src="https://habrastorage.org/getpro/habr/post_images/be2/044/676/be2044676e0672e2a4a007d45360bbb7.png" alt="image"><br>  notice that local storage is now gray <br><br>  6. Now delete the link to Local Storage: <br>  xe sr-forget uuid = ... (specify the sr uuid obtained in step 2) <br><img src="https://habrastorage.org/getpro/habr/post_images/7c2/9e7/809/7c29e7809a048d722cba5fb80dc15f9b.png" alt="image"><br>  Now Local Storage disappeared altogether: <br><img src="https://habrastorage.org/getpro/habr/post_images/e66/3ca/2a8/e663ca2a8b7196dd67265b90cbaa02b7.png" alt="image"><br><br>  7. Next, we look at which partitions we have on the disk using the fdisl -l command. <br><img src="https://habrastorage.org/getpro/habr/post_images/0b8/8e4/c30/0b88e4c30267d6d541661598dabc93ca.png" alt="image"><br>  We see that we have 3 partitions, the largest of which / dev / sda3 (Linux LVM) is the same partition on which Local Storage was located <br><br>  8. Delete this section: <br><img src="https://habrastorage.org/getpro/habr/post_images/900/67b/c39/90067bc39fad48b69e10ff89a210f682.png" alt="image"><br>  commands and values ‚Äã‚Äãentered are highlighted. <br>  Check that the required partition is removed with fdisk -l <br><img src="https://habrastorage.org/getpro/habr/post_images/d50/1f0/8e9/d501f08e98773c9fceb1ea6b8a3f86cf.png" alt="image"><br><br>  9. Now, instead of the deleted partition, we will create two, using the fdisk command as well: <br>  Section under ISO images (/ dev / sda3) <br><img src="https://habrastorage.org/getpro/habr/post_images/464/007/301/4640073015e08789b85a620ac6e9a3a1.png" alt="image"><br>  Section under Local Storage (/ dev / sda4) <br><img src="https://habrastorage.org/getpro/habr/post_images/f23/d48/78c/f23d4878c9e4cb616f3d4eb701dc81b7.png" alt="image"><br>  commands and values ‚Äã‚Äãentered are highlighted. <br>  Let's see the current state of the sections: <br><img src="https://habrastorage.org/getpro/habr/post_images/568/260/7b3/5682607b3088af137b2c4acd741de692.png" alt="image"><br><br>  10. In order for the changes to take effect, you must restart the server. <br><br>  11. Format the partition, which was taken under the ISO repository (/ dev / sda3): <br>  mkfs -t ext3 / dev / sda3 <br><img src="https://habrastorage.org/getpro/habr/post_images/c1d/ad3/7be/c1dad37bea49a2bdc10698377dbadbbd.png" alt="image"><br><br>  12. Create a mount point in the file system to which we will mount the newly created partition, and mount it: <br>  mkdir / mnt / iso <br>  mount -t ext3 / dev / sda3 / mnt / iso <br><img src="https://habrastorage.org/getpro/habr/post_images/91c/c6d/a67/91cc6da6737b903bfaabff674f21ab02.png" alt="image"><br>  for automatic mount when the server starts, we will write the mount line in the / etc / fstab file: <br>  / dev / sda3 / mnt / iso ext3 defaults 0 0 <br><img src="https://habrastorage.org/getpro/habr/post_images/2a9/3f9/05d/2a93f905d3c1553a32ab4b90431d27ee.png" alt="image"><br><br>  13. Now the mount point / mnt / iso needs to be made accessible over the network.  To do this, add a line to the / etc / exports file: <br>  / mnt / iso 127.0.0.1/255.255.255.255 (rw,no_root_squash) - note that there is no space between the address and the opening bracket! <br><img src="https://habrastorage.org/getpro/habr/post_images/be4/139/b72/be4139b72553197fb49869728f8ea9c9.png" alt="image"><br>  in order for the changes in the file to take effect immediately we make the command: <br>  exportfs -r <br>  and to check that we all wrote correctly, enter the command: <br>  exportfs <br><img src="https://habrastorage.org/getpro/habr/post_images/f0a/14b/c29/f0a14bc290a403491bd85bc11fe41a40.png" alt="image"><br><br>  14. We start the NFS service: <br>  service nfs start <br>  then turn on the service start when the server is loaded: <br>  chlconfig nfs on <br><img src="https://habrastorage.org/getpro/habr/post_images/20c/b2e/9cc/20cb2e9cc00a05106038190bebceb87b.png" alt="image"><br><br>  15. Now we need to connect this drive through XenCenter.  In the XenCenter menu, select the New Storage item, in the appeared window select the NFS ISO item, click Next. <br>  Next, fill in the fields in the next window: In the Share Name field we write the following: 127.0.0.1:/mnt/iso <br><img src="https://habrastorage.org/getpro/habr/post_images/24f/a5c/d14/24fa5cd14b14e82f77e9186437a9b81b.png" alt="image"><br>  A new repository has now appeared in the XenCenter console: <br><img src="https://habrastorage.org/getpro/habr/post_images/2d7/871/a40/2d7871a40ed448a9fb5b106820df4c44.png" alt="image"><br>  The creation of the ISO repository is over.  Copy iso-images to / mnt / iso and use. <br><br>  16. However, we still have to return the section for virtualki.  To do this, on the remaining / dev / sda4 create an lvm and connect it to the XenServer: <br>  xe sr-create type = lvm content-type = user device-config: device = / dev / sda4 name-label = "Local Storage" <br><img src="https://habrastorage.org/getpro/habr/post_images/e41/762/b10/e41762b101b1cc627b32a22056458aba.png" alt="image"><br>  Notice that Local Storage has appeared on the left side of XenCenter.  Click on it with the right mouse button and from the context menu choose Set as Default <br><img src="https://habrastorage.org/getpro/habr/post_images/5e2/e7a/16b/5e2e7a16bb4fcf68f3b0d19b220fd201.png" alt="image"><br><br>  Mission accomplished. <br><br>  A few additions: <br><br>  If you need to provide access to the iso-repository on the network, then for this you need: <br>  1. Correct the / etc / exports file by adding IP addresses from which to access. <br>  2. Correct the file / etc / sysconfig / portmap, remove the -l parameter, the line should look like this: PMAP_ARGS = "" <br>  3. Fix the file / etc / sysconfig / iptables </div><p>Source: <a href="https://habr.com/ru/post/86769/">https://habr.com/ru/post/86769/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../86758/index.html">Will cable - Titanic, when will you drown?</a></li>
<li><a href="../86761/index.html">The first neurocomputer interface on sale</a></li>
<li><a href="../86763/index.html">Weekly digest of new computer hardware (Release 2) - CeBIT 2010</a></li>
<li><a href="../86764/index.html">‚ÄúYour Radio‚Äù is another free way to listen to last.fm radio</a></li>
<li><a href="../86765/index.html">How candidate's recommendations are verified</a></li>
<li><a href="../86770/index.html">Good CSS Rules</a></li>
<li><a href="../86773/index.html">CDP (Cisco Discovery Protocol) on Linux</a></li>
<li><a href="../86774/index.html">Medvedev suggested that Yanukovych think about using a single navigation and time space</a></li>
<li><a href="../86776/index.html">HDin.tv closes</a></li>
<li><a href="../86777/index.html">What is a genetic algorithm?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>