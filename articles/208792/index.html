<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Data Virtualization in WPF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 

 I have long been interested in the question of writing my class for the optimal loading of information from a database, for example, when...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Data Virtualization in WPF</h1><div class="post__text post__text-html js-mediator-article">  Good day. <br><br>  I have long been interested in the question of writing my class for the optimal loading of information from a database, for example, when the number of records is more than 10 million records. <br>  Delayed loading of information, the use of multiple data sources, etc. <br><br>  I did not find a post dedicated to this topic in Habr√©, so I present to you my translation of the article by Paul McClin, which became the starting point in solving the tasks. <br><a name="habracut"></a><br>  Original article: <a href="http://www.codeproject.com/Articles/34405/WPF-Data-Virtualization">here</a> <br>  Project source files: <a href="https://drive.google.com/file/d/0Bz8XXlCEKG4DcnRXbVNlT3lUVVE/edit%3Fusp%3Dsharing">here</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Further in the text I will write on behalf of the author. <br><br><h4>  Introduction </h4><br>  WPF provides some interesting user interface virtualization features for efficient work with large collections, at least in terms of user interface, but does not provide a general method for data virtualization.  While in many posts on the forums there is a discussion of data virtualization, no one (as far as I know) published a solution.  The article represents one of these solutions. <br><br><h4>  Prerequisites </h4><br><h5>  UI Virtualization </h5><br>  When a WPF ItemsControl control is associated with a large collection of source data with UI virtualization enabled, the control creates visual containers for visible items only (plus some above and below).  This is usually a small part of the original collection.  When the user scrolls through the list, new visual containers are created when the elements become visible, and the old containers are destroyed when the elements become invisible.  When reusing visual containers, we reduce the overhead of creating and destroying objects. <br><br>  User interface virtualization means that the control can be associated with a large collection of data and take up less memory due to the small number of visible containers. <br><br><h5>  Data virtualization </h5><br>  Data virtualization is a term that means achieving virtualization for a data object associated with an ItemsControl.  Data virtualization is not provided in WPF.  For relatively small collections of basic objects, memory consumption does not matter.  However, for large collections, memory consumption can become very significant.  In addition, retrieving information from a database or creating objects can take a lot of time, especially during network operations.  For these reasons, it is advisable to use some kind of data virtualization mechanism to limit the number of data objects to be extracted from the source and stored in memory. <br><br><h4>  Decision </h4><br><h5>  Overview </h5><br>  This solution is based on the fact that when the ItemsControl control is associated with the IList implementation, not the IEnumerable, it does not enumerate the entire list, but instead provides only a selection of the elements necessary for the display.  It uses the Count property to determine the size of the collection, to set the size of the scroll bar.  In the future, it will iterate through the screen items through the list indexer.  Thus, you can create an IList, which can report that it has a large number of elements, and receive elements only as needed. <br><br><h5>  IItemsProvider &lt;T&gt; </h5><br>  In order to use this solution, the basic source must be able to provide information on the number of elements in the collection, and to provide a small part (or page) from the entire collection.  These requirements are expressed in the IItemsProvider interface. <br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">     of collection details. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;typeparam name="T"&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/typeparam&gt;</span></span></span><span class="hljs-comment"> public interface IItemsProvider</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;T&gt;</span></span></span><span class="hljs-comment"> { </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">      </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment"> int FetchCount(); </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">    </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="startIndex"&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="count"&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment"> IList</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;T&gt;</span></span></span><span class="hljs-comment"> FetchRange(int startIndex, int count); }</span></span></code> </pre> <br>  If the underlying data source is a database query, then you can relatively easily implement the IItemsProvider interface using the aggregate function COUNT (), or the OFFSET and LIMIT expressions provided by most database providers. <br><br><h5>  VirtualizingCollection &lt;T&gt; </h5><br>  This is an implementation of the IList interface that performs data virtualization.  VirtualizingCollection &lt;T&gt; divides the entire collection space into a series of pages.  If necessary, the pages are loaded into memory, and destroyed when not needed. <br><br>  Interesting points will be discussed below.  For details, please refer to the source code attached to this article. <br><br>  The first aspect of the IList implementation is the implementation of the Count property.  It is used by the ItemsControl control to estimate the size of the collection and draw the scroll bar. <br><pre> <code class="cs hljs">Private <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _count = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Count { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_count == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { LoadCount(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _count; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _count = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadCount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Count = FetchCount(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FetchCount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ItemsProvider.FetchCount(); }</code> </pre><br>  The Count property is implemented using a lazy load or lazy load pattern.  It uses the special value -1 to indicate that the value has not yet been loaded.  On first access, the property will load the current number of items from ItemsProvider. <br><br>  Another important aspect of the IList interface is the indexer implementation. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index] { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-comment"><span class="hljs-comment">//        int pageIndex = index / PageSize; int pageOffset = index % PageSize; //    RequestPage(pageIndex); //      50%     if ( pageOffset &gt; PageSize/2 &amp;&amp; pageIndex &lt; Count / PageSize) RequestPage(pageIndex + 1); //      50%     if (pageOffset &lt; PageSize/2 &amp;&amp; pageIndex &gt; 0) RequestPage(pageIndex - 1); //    CleanUpPages(); //       if (_pages[pageIndex] == null) return default(T); //    return _pages[pageIndex][pageOffset]; } set { throw new NotSupportedException(); } }</span></span></code> </pre><br>  The indexer is the most unique part of the solution.  First, it must determine which page belongs to the requested element (pageIndex) and the offset inside the page (pageOffset).  Then the RequestPage () method is called, returning the page. <br><br>  It then loads the next or previous page based on the pageOffset variable.  This is based on the assumption that if users are browsing page 0, then there is a high probability that they will scroll down to view page 1. Getting data in advance does not cause data gaps when displayed on the screen. <br><br>  CleanUpPages () is called to clean (or unload) unused pages. <br><br>  Finally, a defensive check for page availability.  This check is required in case the RequstPage () method does not work in synchronous mode, as when using the derived class AsyncVirtualizingCollection &lt;T&gt;. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, IList&lt;T&gt;&gt; _pages = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, IList&lt;T&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, DateTime&gt; _pageTouchTimes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, DateTime&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RequestPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pageIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_pages.ContainsKey(pageIndex)) { _pages.Add(pageIndex, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); _pageTouchTimes.Add(pageIndex, DateTime.Now); LoadPage(pageIndex); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _pageTouchTimes[pageIndex] = DateTime.Now; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PopulatePage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pageIndex, IList&lt;T&gt; page</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_pages.ContainsKey(pageIndex)) _pages[pageIndex] = page; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CleanUpPages</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; keys = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(_pageTouchTimes.Keys); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> keys) { <span class="hljs-comment"><span class="hljs-comment">// page 0 is a special case, since the WPF ItemsControl // accesses the first item frequently if ( key != 0 &amp;&amp; (DateTime.Now - _pageTouchTimes[key]).TotalMilliseconds &gt; PageTimeout ) { _pages.Remove(key); _pageTouchTimes.Remove(key); } } }</span></span></code> </pre><br>  Pages are stored in a dictionary (Dictionary), in which the index is used as a key.  Also, the dictionary is used to store information about the time of last use.  This time is updated each time the page is accessed.  It is used by the CleanUpPages () method to remove pages that have not been accessed for a significant amount of time. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pageIndex</span></span></span><span class="hljs-function">)</span></span> { PopulatePage(pageIndex, FetchPage(pageIndex)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> IList&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FetchPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pageIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ItemsProvider.FetchRange(pageIndex*PageSize, PageSize); }</code> </pre><br>  Finally, FetchPage () retrieves the page from ItemsProvider, and the LoadPage () method does the work of calling the PopulatePage () method, which places the page in a dictionary with a given index. <br><br>  It may seem that there are many irrelevant methods in the code, but they were developed in this way for certain reasons.  Each method performs exactly one task.  This helps to keep the code readable, and also makes it easy to extend and modify the functionality in derived classes, as will be observed later. <br><br>  The VirtualizingCollection &lt;T&gt; class achieves the primary goal of implementing data virtualization.  Unfortunately, in the process of using this class has one major drawback - all methods for obtaining data are performed synchronously.  This means that they are started by user interface threads, which as a result potentially slow down the application. <br><br><h5>  AsyncVirtualizingCollection &lt;T&gt; </h5><br>  The AsyncVirtualizingCollection &lt;T&gt; class inherits from VirtualizingCollection &lt;T&gt;, and overrides the Load () method to implement asynchronous data loading.  A key feature of an asynchronous data source is that at the time of receiving data, it must notify the user interface through its data binding.  In normal objects, this is solved using the INotifyPropertyChanged interface.  To implement collections, you must use its close relative INotifyCollectionChanged.  This interface is used by the ObservableCollection &lt;T&gt; class. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> NotifyCollectionChangedEventHandler CollectionChanged; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnCollectionChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NotifyCollectionChangedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { NotifyCollectionChangedEventHandler h = CollectionChanged; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (h != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) h(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, e); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FireCollectionReset</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { NotifyCollectionChangedEventArgs e = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset); OnCollectionChanged(e); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> PropertyChangedEventHandler PropertyChanged; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPropertyChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PropertyChangedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { PropertyChangedEventHandler h = PropertyChanged; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (h != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) h(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, e); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FirePropertyChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propertyName</span></span></span><span class="hljs-function">)</span></span> { PropertyChangedEventArgs e = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyChangedEventArgs(propertyName); OnPropertyChanged(e); }</code> </pre><br>  The AsyncVirtualizingCollection &lt;T&gt; class implements both the INotifyPropertyChanged and INotifyCollectionChanged interfaces to provide maximum binding flexibility.  There is nothing to be noted in this implementation. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadCount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Count = <span class="hljs-number"><span class="hljs-number">0</span></span>; IsLoading = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; ThreadPool.QueueUserWorkItem(LoadCountWork); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadCountWork</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = FetchCount(); SynchronizationContext.Send(LoadCountCompleted, count); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadCountCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> args</span></span></span><span class="hljs-function">)</span></span> { Count = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)args; IsLoading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; FireCollectionReset(); }</code> </pre><br>  In the overridden LoadCount () method, the retrieval is invoked asynchronously via ThreadPool.  Upon completion, the new quantity will be set and the FireCollectionReset () method will be called to update the user interface via InotifyCollectionChanged.  Notice that the LoadCountCompleted method is called from the user interface thread using the SynchronizationContext.  The SynchronizationContext property is set in the class constructor, with the assumption that the collection instance will be created in the user interface thread. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index</span></span></span><span class="hljs-function">)</span></span> { IsLoading = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; ThreadPool.QueueUserWorkItem(LoadPageWork, index); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadPageWork</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pageIndex = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)args; IList&lt;T&gt; page = FetchPage(pageIndex); SynchronizationContext.Send(LoadPageCompleted, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[]{ pageIndex, page }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadPageCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pageIndex = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)((<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[]) args)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; IList&lt;T&gt; page = (IList&lt;T&gt;)((<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[])args)[<span class="hljs-number"><span class="hljs-number">1</span></span>]; PopulatePage(pageIndex, page); IsLoading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; FireCollectionReset(); }</code> </pre><br>  Asynchronous loading of the page data follows the same rules, and again the FireCollectionReset () method is used to update the user interface. <br><br>  Note also the property IsLoading.  This is a simple flag that can be used by the user interface to indicate the loading of a collection.  When the IsLoading property is changed, the FirePropertyChanged () method causes the user interface to be updated via the INotifyProperyChanged mechanism. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsLoading { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _isLoading; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> != _isLoading ) { _isLoading = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; FirePropertyChanged(<span class="hljs-string"><span class="hljs-string">"IsLoading"</span></span>); } } }</code> </pre><br><h4>  Demonstration project </h4><br>  In order to demonstrate this solution, I created a simple demonstration project (included in the project source codes). <br><br>  Firstly, an implementation of the IItemsProvider class was created, which provides dummy data with the flow stopped to simulate the delay in receiving data from a disk or network. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DemoCustomerProvider</span></span> : <span class="hljs-title"><span class="hljs-title">IItemsProvider</span></span>&lt;<span class="hljs-title"><span class="hljs-title">Customer</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _count; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _fetchDelay; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DemoCustomerProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fetchDelay</span></span></span><span class="hljs-function">)</span></span> { _count = count; _fetchDelay = fetchDelay; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FetchCount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Thread.Sleep(_fetchDelay); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _count; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IList&lt;Customer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FetchRange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> startIndex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> count</span></span></span><span class="hljs-function">)</span></span> { Thread.Sleep(_fetchDelay); List&lt;Customer&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Customer&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=startIndex; i&lt;startIndex+count; i++ ) { Customer customer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Customer {Id = i+<span class="hljs-number"><span class="hljs-number">1</span></span>, Name = <span class="hljs-string"><span class="hljs-string">"Customer "</span></span> + (i+<span class="hljs-number"><span class="hljs-number">1</span></span>)}; list.Add(customer); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; } }</code> </pre><br>  The ubiquitous Customer object is used as a collection item. <br><br>  A simple WPF window with a ListView control was created to allow the user to experiment with different list implementations. <br><pre> <code class="cs hljs">&lt;Window x:Class=<span class="hljs-string"><span class="hljs-string">"DataVirtualization.DemoWindow"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> Title=<span class="hljs-string"><span class="hljs-string">"Data Virtualization Demo - By Paul McClean"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"600"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"600"</span></span>&gt; &lt;Window.Resources&gt; &lt;Style x:Key=<span class="hljs-string"><span class="hljs-string">"lvStyle"</span></span> TargetType=<span class="hljs-string"><span class="hljs-string">"{x:Type ListView}"</span></span>&gt; &lt;Setter Property=<span class="hljs-string"><span class="hljs-string">"VirtualizingStackPanel.IsVirtualizing"</span></span> Value=<span class="hljs-string"><span class="hljs-string">"True"</span></span>/&gt; &lt;Setter Property=<span class="hljs-string"><span class="hljs-string">"VirtualizingStackPanel.VirtualizationMode"</span></span> Value=<span class="hljs-string"><span class="hljs-string">"Recycling"</span></span>/&gt; &lt;Setter Property=<span class="hljs-string"><span class="hljs-string">"ScrollViewer.IsDeferredScrollingEnabled"</span></span> Value=<span class="hljs-string"><span class="hljs-string">"True"</span></span>/&gt; &lt;Setter Property=<span class="hljs-string"><span class="hljs-string">"ListView.ItemsSource"</span></span> Value=<span class="hljs-string"><span class="hljs-string">"{Binding}"</span></span>/&gt; &lt;Setter Property=<span class="hljs-string"><span class="hljs-string">"ListView.View"</span></span>&gt; &lt;Setter.Value&gt; &lt;GridView&gt; &lt;GridViewColumn Header=<span class="hljs-string"><span class="hljs-string">"Id"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"100"</span></span>&gt; &lt;GridViewColumn.CellTemplate&gt; &lt;DataTemplate&gt; &lt;TextBlock Text=<span class="hljs-string"><span class="hljs-string">"{Binding Id}"</span></span>/&gt; &lt;/DataTemplate&gt; &lt;/GridViewColumn.CellTemplate&gt; &lt;/GridViewColumn&gt; &lt;GridViewColumn Header=<span class="hljs-string"><span class="hljs-string">"Name"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"150"</span></span>&gt; &lt;GridViewColumn.CellTemplate&gt; &lt;DataTemplate&gt; &lt;TextBlock Text=<span class="hljs-string"><span class="hljs-string">"{Binding Name}"</span></span>/&gt; &lt;/DataTemplate&gt; &lt;/GridViewColumn.CellTemplate&gt; &lt;/GridViewColumn&gt; &lt;/GridView&gt; &lt;/Setter.Value&gt; &lt;/Setter&gt; &lt;Style.Triggers&gt; &lt;DataTrigger Binding=<span class="hljs-string"><span class="hljs-string">"{Binding IsLoading}"</span></span> Value=<span class="hljs-string"><span class="hljs-string">"True"</span></span>&gt; &lt;Setter Property=<span class="hljs-string"><span class="hljs-string">"ListView.Cursor"</span></span> Value=<span class="hljs-string"><span class="hljs-string">"Wait"</span></span>/&gt; &lt;Setter Property=<span class="hljs-string"><span class="hljs-string">"ListView.Background"</span></span> Value=<span class="hljs-string"><span class="hljs-string">"LightGray"</span></span>/&gt; &lt;/DataTrigger&gt; &lt;/Style.Triggers&gt; &lt;/Style&gt; &lt;/Window.Resources&gt; &lt;Grid Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span>&gt; &lt;Grid.RowDefinitions&gt; &lt;RowDefinition Height=<span class="hljs-string"><span class="hljs-string">"Auto"</span></span>/&gt; &lt;RowDefinition Height=<span class="hljs-string"><span class="hljs-string">"Auto"</span></span>/&gt; &lt;RowDefinition Height=<span class="hljs-string"><span class="hljs-string">"Auto"</span></span>/&gt; &lt;RowDefinition Height=<span class="hljs-string"><span class="hljs-string">"*"</span></span>/&gt; &lt;/Grid.RowDefinitions&gt; &lt;GroupBox Grid.Row=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Header=<span class="hljs-string"><span class="hljs-string">"ItemsProvider"</span></span>&gt; &lt;StackPanel Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"0,2,0,0"</span></span>&gt; &lt;TextBlock Text=<span class="hljs-string"><span class="hljs-string">"Number of items:"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> TextAlignment=<span class="hljs-string"><span class="hljs-string">"Right"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;TextBox x:Name=<span class="hljs-string"><span class="hljs-string">"tbNumItems"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Text=<span class="hljs-string"><span class="hljs-string">"1000000"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"60"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;TextBlock Text=<span class="hljs-string"><span class="hljs-string">"Fetch Delay (ms):"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> TextAlignment=<span class="hljs-string"><span class="hljs-string">"Right"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;TextBox x:Name=<span class="hljs-string"><span class="hljs-string">"tbFetchDelay"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Text=<span class="hljs-string"><span class="hljs-string">"1000"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"60"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;/StackPanel&gt; &lt;/GroupBox&gt; &lt;GroupBox Grid.Row=<span class="hljs-string"><span class="hljs-string">"1"</span></span> Header=<span class="hljs-string"><span class="hljs-string">"Collection"</span></span>&gt; &lt;StackPanel&gt; &lt;StackPanel Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"0,2,0,0"</span></span>&gt; &lt;TextBlock Text=<span class="hljs-string"><span class="hljs-string">"Type:"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> TextAlignment=<span class="hljs-string"><span class="hljs-string">"Right"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;RadioButton x:Name=<span class="hljs-string"><span class="hljs-string">"rbNormal"</span></span> GroupName=<span class="hljs-string"><span class="hljs-string">"rbGroup"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Content=<span class="hljs-string"><span class="hljs-string">"List(T)"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;RadioButton x:Name=<span class="hljs-string"><span class="hljs-string">"rbVirtualizing"</span></span> GroupName=<span class="hljs-string"><span class="hljs-string">"rbGroup"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Content=<span class="hljs-string"><span class="hljs-string">"VirtualizingList(T)"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;RadioButton x:Name=<span class="hljs-string"><span class="hljs-string">"rbAsync"</span></span> GroupName=<span class="hljs-string"><span class="hljs-string">"rbGroup"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Content=<span class="hljs-string"><span class="hljs-string">"AsyncVirtualizingList(T)"</span></span> IsChecked=<span class="hljs-string"><span class="hljs-string">"True"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;/StackPanel&gt; &lt;StackPanel Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"0,2,0,0"</span></span>&gt; &lt;TextBlock Text=<span class="hljs-string"><span class="hljs-string">"Page size:"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> TextAlignment=<span class="hljs-string"><span class="hljs-string">"Right"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;TextBox x:Name=<span class="hljs-string"><span class="hljs-string">"tbPageSize"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Text=<span class="hljs-string"><span class="hljs-string">"100"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"60"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;TextBlock Text=<span class="hljs-string"><span class="hljs-string">"Page timeout (s):"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> TextAlignment=<span class="hljs-string"><span class="hljs-string">"Right"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;TextBox x:Name=<span class="hljs-string"><span class="hljs-string">"tbPageTimeout"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Text=<span class="hljs-string"><span class="hljs-string">"30"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"60"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;/StackPanel&gt; &lt;/StackPanel&gt; &lt;/GroupBox&gt; &lt;StackPanel Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span> Grid.Row=<span class="hljs-string"><span class="hljs-string">"2"</span></span>&gt; &lt;TextBlock Text=<span class="hljs-string"><span class="hljs-string">"Memory Usage:"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;TextBlock x:Name=<span class="hljs-string"><span class="hljs-string">"tbMemory"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"80"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;Button Content=<span class="hljs-string"><span class="hljs-string">"Refresh"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"Button_Click"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"100"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>/&gt; &lt;Rectangle Name=<span class="hljs-string"><span class="hljs-string">"rectangle"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"20"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span> Fill=<span class="hljs-string"><span class="hljs-string">"Blue"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>&gt; &lt;Rectangle.RenderTransform&gt; &lt;RotateTransform Angle=<span class="hljs-string"><span class="hljs-string">"0"</span></span> CenterX=<span class="hljs-string"><span class="hljs-string">"10"</span></span> CenterY=<span class="hljs-string"><span class="hljs-string">"10"</span></span>/&gt; &lt;/Rectangle.RenderTransform&gt; &lt;Rectangle.Triggers&gt; &lt;EventTrigger RoutedEvent=<span class="hljs-string"><span class="hljs-string">"Rectangle.Loaded"</span></span>&gt; &lt;BeginStoryboard&gt; &lt;Storyboard&gt; &lt;DoubleAnimation Storyboard.TargetName=<span class="hljs-string"><span class="hljs-string">"rectangle"</span></span> Storyboard.TargetProperty= <span class="hljs-string"><span class="hljs-string">"(TextBlock.RenderTransform).(RotateTransform.Angle)"</span></span> From=<span class="hljs-string"><span class="hljs-string">"0"</span></span> To=<span class="hljs-string"><span class="hljs-string">"360"</span></span> Duration=<span class="hljs-string"><span class="hljs-string">"0:0:5"</span></span> RepeatBehavior=<span class="hljs-string"><span class="hljs-string">"Forever"</span></span> /&gt; &lt;/Storyboard&gt; &lt;/BeginStoryboard&gt; &lt;/EventTrigger&gt; &lt;/Rectangle.Triggers&gt; &lt;/Rectangle&gt; &lt;TextBlock Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span> FontStyle=<span class="hljs-string"><span class="hljs-string">"Italic"</span></span> Text=<span class="hljs-string"><span class="hljs-string">"Pause in animation indicates UI thread stalled."</span></span>/&gt; &lt;/StackPanel&gt; &lt;ListView Grid.Row=<span class="hljs-string"><span class="hljs-string">"3"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Style=<span class="hljs-string"><span class="hljs-string">"{DynamicResource lvStyle}"</span></span>/&gt; &lt;/Grid&gt; &lt;/Window&gt;</code> </pre><br>  Do not go into the details of XAML.  The only thing worth mentioning is using the specified ListView styles to change the background and mouse cursor in response to a change in the IsLoading property. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DemoWindow</span></span> { <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Initializes a new instance of the </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see cref="DemoWindow"/&gt;</span></span></span><span class="hljs-comment"> class. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public DemoWindow() { InitializeComponent(); // use a timer to periodically update the memory usage DispatcherTimer timer = new DispatcherTimer(); timer.Interval = new TimeSpan(0, 0, 1); timer.Tick += timer_Tick; timer.Start(); } private void timer_Tick(object sender, EventArgs e) { tbMemory.Text = string.Format("{0:0.00} MB", GC.GetTotalMemory(true)/1024.0/1024.0); } private void Button_Click(object sender, RoutedEventArgs e) { // create the demo items provider according to specified parameters int numItems = int.Parse(tbNumItems.Text); int fetchDelay = int.Parse(tbFetchDelay.Text); DemoCustomerProvider customerProvider = new DemoCustomerProvider(numItems, fetchDelay); // create the collection according to specified parameters int pageSize = int.Parse(tbPageSize.Text); int pageTimeout = int.Parse(tbPageTimeout.Text); if ( rbNormal.IsChecked.Value ) { DataContext = new List</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;Customer&gt;</span></span></span><span class="hljs-comment">(customerProvider.FetchRange(0, customerProvider.FetchCount())); } else if ( rbVirtualizing.IsChecked.Value ) { DataContext = new VirtualizingCollection</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;Customer&gt;</span></span></span><span class="hljs-comment">(customerProvider, pageSize); } else if ( rbAsync.IsChecked.Value ) { DataContext = new AsyncVirtualizingCollection</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;Customer&gt;</span></span></span><span class="hljs-comment">(customerProvider, pageSize, pageTimeout*1000); } } }</span></span></code> </pre><br>  The window layout is quite simple, but sufficient to demonstrate the solution. <br><br>  The user can configure the number of items in the DemoCustomerProvider instance and the simulator delay time. <br><br>  The demonstration allows users to compare the standard List implementation (T), the implementation with synchronous data loading VirtualizingCollection (T), and the implementation with asynchronous data loading AsyncVirtualizingCollection (T).  When using VirtualizingCollection (T) and AsyncVirtualizingCollection (T), the user can set the page size and timeout (sets the time after which the page should be unloaded from memory).  They must be selected according to the characteristics of the element and the expected pattern of use. <br><br><img src="http://habrastorage.org/storage3/f81/c7a/b6a/f81c7ab6a273010a5320ca8bb7cc6a4b.png"><br><br>  To compare different types of collections, the window also displays the total amount of used memory.  A rotating square animation is used to visualize the stopping of user interface flow.  In a fully asynchronous solution, the animation should not slow down or stop. </div><p>Source: <a href="https://habr.com/ru/post/208792/">https://habr.com/ru/post/208792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../208780/index.html">Real Time Operating Systems for Beginners</a></li>
<li><a href="../208782/index.html">SoftEther VPN - an advanced multi-protocol VPN server and client</a></li>
<li><a href="../208784/index.html">How a good piece of hardware was made excellent - an overview of EMC VNX storage systems</a></li>
<li><a href="../208786/index.html">Packet crafting as it is</a></li>
<li><a href="../208788/index.html">Seamless splitting and splicing video with DirectShow</a></li>
<li><a href="../208796/index.html">Domestic MOOC provider - Universarium</a></li>
<li><a href="../208798/index.html">Google Glass as a regular tool for data center employees</a></li>
<li><a href="../208800/index.html">Apple App Store. Get ERN</a></li>
<li><a href="../208802/index.html">Export Favorites on Habr√© in PDF</a></li>
<li><a href="../208804/index.html">The digest of news from the world of mobile development for the last week ‚Ññ36 (January 4-12, 2014)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>