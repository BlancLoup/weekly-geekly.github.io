<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learning to create a small template parser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings, dear reader. Even before this, I didn‚Äôt even know about the existence of Node.js, but I managed to weightily with JavaScript, after which I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learning to create a small template parser</h1><div class="post__text post__text-html js-mediator-article">  Greetings, dear reader.  Even before this, I didn‚Äôt even know about the existence of Node.js, but I managed to weightily with JavaScript, after which I don‚Äôt want to write on anything else.  Many who have understood JS and its Zen, that everything is an object, in closures, anonymous functions, prefer to work only with it.  Once, with a friend, we exchanged thoughts about PHP, criticized the meager and inconvenient features of the OOP, and I said: ‚ÄúI‚Äôd like to write JS instead of PHP on the server side, and I received an instant answer:‚Äú nodejs is in your hands. ‚Äù  Without hesitation, I started digging through wiki and other resources, then in the shortest possible time I raised Ubuntu Server to the Virtual Box and put Node.js there myself. <br><br>  I‚Äôm just warning you that if you haven‚Äôt worked with JavaScript or are just too familiar with it, start with it, otherwise Node.js may seem like a dark forest to you.  I want to introduce you to the language immediately in practice, and also show the idea of ‚Äã‚Äãpractical application again.  I will give an example of the implementation of a small template parser, all of this will fit into 2 small files, deliberately no frills, in order to visually and transparently see "how it works." <br><a name="habracut"></a><br>  So, the concept is as follows: we will use inserts in the following template: <br><blockquote><code><font color="#000000"><b>&lt;script</b></font> <font color="#000066">type</font> <font color="#008000">=</font> <font color="#993333">"</font> <font color="#993333">nodejs</font> <font color="#993333">"</font> <font color="#000000"><b>&gt;</b></font> <font color="#1111ee">100</font> <font color="#008000">+</font> <font color="#1111ee">235</font> <font color="#008000">;</font> <font color="#000000"><b>&lt;/script</b></font> <font color="#000000"><b>&gt;</b></font></code> </blockquote> <blockquote> <code><a href="http://habrasyntax.fractalizer.ru/"></a> <font color="gray">      <font color="gray">FractalizeR's HabraSyntax Source Code Highlighter</font> .</font></code> </blockquote> <br>  This code will display 335 on the screen.  Why such a method, and not for example: <i>&lt;% = 100 + 235%&gt;</i> ?  This is the idea, firstly, these tags will contain the usual JS-code, and this design will support syntax highlighting in editors without any rituals of sacrifices with a tambourine.  Why choose JS code?  ‚ÄúIt's barbaric!‚Äù Well, I personally like the 1C-Bitrix template model, I think it‚Äôs very convenient, just make the conditions and cycles in the language you know, and not learn the new syntax template every time and get into its tight framework.  Plus, it's JS!  Catch a thought?  Typically, designers as impose, and write to JS, and then inserts, with the same JS, that is, they continue to typeset, just knowing that their code is replaced on the server side with what they return in it at the end of the manipulation.  For me, so the best solution. <br><br>  Now, finally, let's move on to our favorite practice, step by step, write the code describing the actions.  First, create two files: start.js for our script and template.html for the template.  Further code is written in start.js.  Let's connect the built-in Node.js modules, which are necessary for the example to work: <br><blockquote> <code><font color="#000000"><b>var</b></font> <font color="#000000">http</font> <font color="#008000">=</font> <font color="#000000">require</font> <font color="#008000">(</font> <font color="#ff0000">'</font> <font color="#ff0000">http</font> <font color="#ff0000">'</font> <font color="#008000">)</font> <font color="#008000">;</font> <font color="#888888"><i>//</i></font> <font color="#888888"><i>      </i></font> <br> <font color="#000000"><b>var</b></font> <font color="#000000">fs</font> <font color="#008000">=</font> <font color="#000000">require</font> <font color="#008000">(</font> <font color="#ff0000">'</font> <font color="#ff0000">fs</font> <font color="#ff0000">'</font> <font color="#008000">)</font> <font color="#008000">;</font> <font color="#888888"><i>//</i></font> <font color="#888888"><i>   ,     </i></font> <br> <font color="#000000"><b>var</b></font> <font color="#000000">vm</font> <font color="#008000">=</font> <font color="#000000">require</font> <font color="#008000">(</font> <font color="#ff0000">'</font> <font color="#ff0000">vm</font> <font color="#ff0000">'</font> <font color="#008000">)</font> <font color="#008000">;</font> <font color="#888888"><i>//</i></font> <font color="#888888"><i>  JS-  ,     </i></font></code> </blockquote> <blockquote> <code><a href="http://habrasyntax.fractalizer.ru/"></a> <font color="gray">      <font color="gray">FractalizeR's HabraSyntax Source Code Highlighter</font> .</font></code> </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Please note that Node.js does not require any Apache and other things, if you compare it with PHP, this is a different element.  The server rises right in the script and is created when the script is executed from the console.  Let's declare a variable to create a server and also immediately declare, for example, a JSON data structure for exporting to a template: <br><blockquote> <code><font color="#000000"><b>var</b></font> <font color="#993333">host</font> <font color="#008000">=</font> <font color="#008000">{</font> <font color="#000000"><br> addr</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000">127.0.0.1</font> <font color="#ff0000">'</font> <font color="#008000">,</font> <br> <font color="#993333">port</font> <font color="#008000">:</font> <font color="#1111ee">8070</font> <br> <font color="#008000">}</font> <font color="#008000">;</font> <br> <br> <font color="#000000"><b>var</b></font> <font color="#000000">jsonExport</font> <font color="#008000">=</font> <font color="#008000">{</font> <br> <font color="#993333">title</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000">  </font> <font color="#ff0000">'</font> <font color="#008000">,</font> <font color="#000000"><br> list</font> <font color="#008000">:</font> <font color="#008000">[</font> <br> <font color="#008000">{</font> <font color="#993333">name</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000">  </font> <font color="#ff0000">'</font> <font color="#008000">,</font> <font color="#000000">msg</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000">  </font> <font color="#ff0000">'</font> <font color="#008000">}</font> <font color="#008000">,</font> <br> <font color="#008000">{</font> <font color="#993333">name</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000"></font> <font color="#ff0000">'</font> <font color="#008000">,</font> <font color="#000000">msg</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000"></font> <font color="#ff0000">'</font> <font color="#008000">}</font> <font color="#008000">,</font> <br> <font color="#008000">{</font> <font color="#993333">name</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000"></font> <font color="#ff0000">'</font> <font color="#008000">,</font> <font color="#000000">msg</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000">   !</font> <font color="#ff0000">'</font> <font color="#008000">}</font> <br> <font color="#008000">]</font> <br> <font color="#008000">}</font> <font color="#008000">;</font></code> </blockquote> <blockquote> <code><a href="http://habrasyntax.fractalizer.ru/"></a> <font color="gray">      <font color="gray">FractalizeR's HabraSyntax Source Code Highlighter</font> .</font></code> </blockquote> <br>  Pay attention to port 8070, just in case if the 80th is busy with Apache, or something else.  If you are sure that the port is free, you can deliver the 80th.  127.0.0.1 is a local machine, and the server will be accessible only within it, this is enough for us so far. <br><br>  Next, create the server itself with a request handler from the browser: <br><blockquote> <code><font color="#000000"><b>var</b></font> <font color="#000000">server</font> <font color="#008000">=</font> <font color="#000000">http</font> <font color="#008000">.</font> <font color="#555599">createServer</font> <font color="#008000">(</font> <font color="#000000"><b>function</b></font> <font color="#008000">(</font> <font color="#000000">request</font> <font color="#008000">,</font> <font color="#000000">response</font> <font color="#008000">)</font> <font color="#008000">{</font> <br> <font color="#888888"><i>//</i></font> <font color="#888888"><i> </i></font> <br> <font color="#008000">}</font> <font color="#008000">)</font> <font color="#008000">;</font></code> </blockquote> <blockquote> <code><a href="http://habrasyntax.fractalizer.ru/"></a> <font color="gray">      <font color="gray">FractalizeR's HabraSyntax Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  For now, let's go through the handler code and immediately start the wiretapping of port 8070 on the local machine and send a report to the console: <br><blockquote> <code><font color="#000000">server</font> <font color="#008000">.</font> <font color="#555599">listen</font> <font color="#008000">(</font> <font color="#993333">host</font> <font color="#008000">.</font> <font color="#993333">port</font> <font color="#008000">,</font> <font color="#993333">host</font> <font color="#008000">.</font> <font color="#555599">addr</font> <font color="#008000">)</font> <font color="#008000">;</font> <font color="#000000"><br> console</font> <font color="#008000">.</font> <font color="#ffdd00">log</font> <font color="#008000">(</font> <font color="#ff0000">'</font> <font color="#ff0000">  :</font> <font color="#ff0000">'</font> <font color="#008000">+</font> <font color="#993333">host</font> <font color="#008000">.</font> <font color="#555599">addr</font> <font color="#008000">+</font> <font color="#ff0000">'</font> <font color="#ff0000">:</font> <font color="#ff0000">'</font> <font color="#008000">+</font> <font color="#993333">host</font> <font color="#008000">.</font> <font color="#993333">port</font> <font color="#008000">)</font> <font color="#008000">;</font></code> </blockquote> <blockquote> <code><a href="http://habrasyntax.fractalizer.ru/"></a> <font color="gray">      <font color="gray">FractalizeR's HabraSyntax Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Now it's time to describe the handler code: <br><blockquote> <code><font color="#000000">response</font> <font color="#008000">.</font> <font color="#555599">writeHead</font> <font color="#008000">(</font> <font color="#1111ee">200</font> <font color="#008000">,</font> <font color="#008000">{</font> <font color="#ff0000">'</font> <font color="#ff0000">content-type</font> <font color="#ff0000">'</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000">text/html; charset=utf-8</font> <font color="#ff0000">'</font> <font color="#008000">}</font> <font color="#008000">)</font> <font color="#008000">;</font> <font color="#000000"><br> fs</font> <font color="#008000">.</font> <font color="#555599">readFile</font> <font color="#008000">(</font> <font color="#ff0000">'</font> <font color="#ff0000">./template.html</font> <font color="#ff0000">'</font> <font color="#008000">,</font> <font color="#000000"><b>function</b></font> <font color="#008000">(</font> <font color="#000000">err</font> <font color="#008000">,</font> <font color="#993333">data</font> <font color="#008000">)</font> <font color="#008000">{</font> <br> <font color="#888888"><i>//</i></font> <font color="#888888"><i>  </i></font> <br> <font color="#008000">}</font> <font color="#008000">)</font> <font color="#008000">;</font></code> </blockquote> <blockquote> <code><a href="http://habrasyntax.fractalizer.ru/"></a> <font color="gray">      <font color="gray">FractalizeR's HabraSyntax Source Code Highlighter</font> .</font></code> </blockquote> <br>  The first line is the return in the headers of the 200th server response, ala OK, everything is fine.  The second parameter is the object that passes the remaining headers, in this case, the content type and encoding.  The next line is to read the template file and the handler. <br><br>  And as you might have guessed, the template processing code, the final part of the start.js script: <br><blockquote> <code><font color="#000000"><b>var</b></font> <font color="#993333">data</font> <font color="#008000">=</font> <font color="#993333">data</font> <font color="#008000">.</font> <font color="#993333">toString</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <font color="#000000"><b>var</b></font> <font color="#000000">dataArr</font> <font color="#008000">=</font> <font color="#993333">data</font> <font color="#008000">.</font> <font color="#993333">match</font> <font color="#008000">(</font> <font color="#000000">/</font> <font color="#000000">\&lt;script type=(nodejs|'nodejs'|"nodejs")\&gt;([^\0]+?)&lt;</font> <font color="#0000ff"><b>\/</b></font> <font color="#000000">script\&gt;</font> <font color="#000000">/gi</font> <font color="#000000">m</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <font color="#000000"><b>for</b></font> <font color="#008000">(</font> <font color="#000000"><b>var</b></font> <font color="#000000">i</font> <font color="#008000">=</font> <font color="#1111ee">0</font> <font color="#008000">;</font> <font color="#000000">i</font> <font color="#008000">&lt;</font> <font color="#008000">(</font> <font color="#000000">dataArr</font> <font color="#008000">.</font> <font color="#993333">length</font> <font color="#008000">|</font> <font color="#008000">|</font> <font color="#1111ee">0</font> <font color="#008000">)</font> <font color="#008000">;</font> <font color="#000000">i</font> <font color="#008000">+</font> <font color="#008000">+</font> <font color="#008000">)</font> <font color="#008000">{</font> <br> <font color="#000000"><b>var</b></font> <font color="#000000">code</font> <font color="#008000">=</font> <font color="#000000">dataArr</font> <font color="#008000">[</font> <font color="#000000">i</font> <font color="#008000">]</font> <font color="#008000">.</font> <font color="#993333">replace</font> <font color="#008000">(</font> <font color="#000000">/</font> <font color="#000000">^\&lt;script([^\&gt;]+)\&gt;([^\0]+?)&lt;</font> <font color="#0000ff"><b>\/</b></font> <font color="#000000">script\&gt;$</font> <font color="#000000">/i</font> <font color="#000000">m</font> <font color="#008000">,</font> <font color="#ff0000">'</font> <font color="#ff0000">$2</font> <font color="#ff0000">'</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <font color="#993333">data</font> <font color="#008000">=</font> <font color="#993333">data</font> <font color="#008000">.</font> <font color="#993333">replace</font> <font color="#008000">(</font> <font color="#000000">/</font> <font color="#000000">\&lt;script type=(nodejs|'nodejs'|"nodejs")\&gt;([^\0]+?)&lt;</font> <font color="#0000ff"><b>\/</b></font> <font color="#000000">script\&gt;</font> <font color="#000000">/i</font> <font color="#000000">m</font> <font color="#008000">,</font> <font color="#000000"><br> vm</font> <font color="#008000">.</font> <font color="#555599">runInNewContext</font> <font color="#008000">(</font> <font color="#000000">code</font> <font color="#008000">,</font> <font color="#000000">jsonExport</font> <font color="#008000">)</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <font color="#008000">}</font> <font color="#000000"><br> response</font> <font color="#008000">.</font> <font color="#555599">end</font> <font color="#008000">(</font> <font color="#993333">data</font> <font color="#008000">)</font> <font color="#008000">;</font></code> </blockquote> <blockquote> <code><a href="http://habrasyntax.fractalizer.ru/"></a> <font color="gray">      <font color="gray">FractalizeR's HabraSyntax Source Code Highlighter</font> .</font></code> </blockquote> <br>  <b>1st line</b> - convert the resulting file content to a string to work with regs.  I will not write any details about regs, just note the reg keys for understanding what is happening. <br>  <b>2nd line</b> - create an array of the found pieces of the parser code that needs to be processed and replaced with the result of the execution.  The keys gim, g are more than one match, i is case-insensitive, m is a multi-line search (instead of searching in separate strings).  Regarding reg, I want to mention only one of my methods, which I often use, it may be useful to you.  The dot character captures all characters except line breaks, in this case we also need line breaks!  And instead of a point we write: <b>[^ \ 0]</b> , which means everything that does not equal null (emptiness).  Interesting, yes?  It is possible and just <b>[^]</b> , but if you use it in JavaScript, of course, Internet Explorer will give an error, because we use the first, longer version. <br>  <b>The 3rd line</b> is a cycle, we go through the array of found calls to the parser code. <br>  <b>The first line of the cycle</b> - we pull out the code between the &lt;script *&gt; ... &lt;/ script&gt; of the current parser code and add it to the code variable. <br>  <b>2nd and 3rd line of the cycle</b> - in the data variable we replace the current call to the parser with the result of the execution using the vm module, which executes the specified code in a specific context.  In this case, he passed our JSON structure as this context.  Notice that reg without the g key to work only with the current insert, since we replace all of the code in its entirety. <br><br>  Our start.js file is ready, here‚Äôs the whole view: <br><blockquote> <code><font color="#000000"><b>var</b></font> <font color="#000000">http</font> <font color="#008000">=</font> <font color="#000000">require</font> <font color="#008000">(</font> <font color="#ff0000">'</font> <font color="#ff0000">http</font> <font color="#ff0000">'</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <font color="#000000"><b>var</b></font> <font color="#000000">fs</font> <font color="#008000">=</font> <font color="#000000">require</font> <font color="#008000">(</font> <font color="#ff0000">'</font> <font color="#ff0000">fs</font> <font color="#ff0000">'</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <font color="#000000"><b>var</b></font> <font color="#000000">vm</font> <font color="#008000">=</font> <font color="#000000">require</font> <font color="#008000">(</font> <font color="#ff0000">'</font> <font color="#ff0000">vm</font> <font color="#ff0000">'</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <br> <font color="#000000"><b>var</b></font> <font color="#993333">host</font> <font color="#008000">=</font> <font color="#008000">{</font> <font color="#000000"><br> addr</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000">127.0.0.1</font> <font color="#ff0000">'</font> <font color="#008000">,</font> <br> <font color="#993333">port</font> <font color="#008000">:</font> <font color="#1111ee">8070</font> <br> <font color="#008000">}</font> <font color="#008000">;</font> <br> <br> <font color="#000000"><b>var</b></font> <font color="#000000">jsonExport</font> <font color="#008000">=</font> <font color="#008000">{</font> <br> <font color="#993333">title</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000">  </font> <font color="#ff0000">'</font> <font color="#008000">,</font> <font color="#000000"><br> list</font> <font color="#008000">:</font> <font color="#008000">[</font> <br> <font color="#008000">{</font> <font color="#993333">name</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000">  </font> <font color="#ff0000">'</font> <font color="#008000">,</font> <font color="#000000">msg</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000">  </font> <font color="#ff0000">'</font> <font color="#008000">}</font> <font color="#008000">,</font> <br> <font color="#008000">{</font> <font color="#993333">name</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000"></font> <font color="#ff0000">'</font> <font color="#008000">,</font> <font color="#000000">msg</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000"></font> <font color="#ff0000">'</font> <font color="#008000">}</font> <font color="#008000">,</font> <br> <font color="#008000">{</font> <font color="#993333">name</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000"></font> <font color="#ff0000">'</font> <font color="#008000">,</font> <font color="#000000">msg</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000">   !</font> <font color="#ff0000">'</font> <font color="#008000">}</font> <br> <font color="#008000">]</font> <br> <font color="#008000">}</font> <font color="#008000">;</font> <br> <br> <font color="#000000"><b>var</b></font> <font color="#000000">server</font> <font color="#008000">=</font> <font color="#000000">http</font> <font color="#008000">.</font> <font color="#555599">createServer</font> <font color="#008000">(</font> <font color="#000000"><b>function</b></font> <font color="#008000">(</font> <font color="#000000">request</font> <font color="#008000">,</font> <font color="#000000">response</font> <font color="#008000">)</font> <font color="#008000">{</font> <font color="#000000"><br> response</font> <font color="#008000">.</font> <font color="#555599">writeHead</font> <font color="#008000">(</font> <font color="#1111ee">200</font> <font color="#008000">,</font> <font color="#008000">{</font> <font color="#ff0000">'</font> <font color="#ff0000">content-type</font> <font color="#ff0000">'</font> <font color="#008000">:</font> <font color="#ff0000">'</font> <font color="#ff0000">text/html; charset=utf-8</font> <font color="#ff0000">'</font> <font color="#008000">}</font> <font color="#008000">)</font> <font color="#008000">;</font> <font color="#000000"><br> fs</font> <font color="#008000">.</font> <font color="#555599">readFile</font> <font color="#008000">(</font> <font color="#ff0000">'</font> <font color="#ff0000">./template.html</font> <font color="#ff0000">'</font> <font color="#008000">,</font> <font color="#000000"><b>function</b></font> <font color="#008000">(</font> <font color="#000000">err</font> <font color="#008000">,</font> <font color="#993333">data</font> <font color="#008000">)</font> <font color="#008000">{</font> <br> <font color="#000000"><b>var</b></font> <font color="#993333">data</font> <font color="#008000">=</font> <font color="#993333">data</font> <font color="#008000">.</font> <font color="#993333">toString</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <font color="#000000"><b>var</b></font> <font color="#000000">dataArr</font> <font color="#008000">=</font> <font color="#993333">data</font> <font color="#008000">.</font> <font color="#993333">match</font> <font color="#008000">(</font> <font color="#000000">/</font> <font color="#000000">\&lt;script type=(nodejs|'nodejs'|"nodejs")\&gt;([^\0]+?)&lt;</font> <font color="#0000ff"><b>\/</b></font> <font color="#000000">script\&gt;</font> <font color="#000000">/gi</font> <font color="#000000">m</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <font color="#000000"><b>for</b></font> <font color="#008000">(</font> <font color="#000000"><b>var</b></font> <font color="#000000">i</font> <font color="#008000">=</font> <font color="#1111ee">0</font> <font color="#008000">;</font> <font color="#000000">i</font> <font color="#008000">&lt;</font> <font color="#008000">(</font> <font color="#000000">dataArr</font> <font color="#008000">.</font> <font color="#993333">length</font> <font color="#008000">|</font> <font color="#008000">|</font> <font color="#1111ee">0</font> <font color="#008000">)</font> <font color="#008000">;</font> <font color="#000000">i</font> <font color="#008000">+</font> <font color="#008000">+</font> <font color="#008000">)</font> <font color="#008000">{</font> <br> <font color="#000000"><b>var</b></font> <font color="#000000">code</font> <font color="#008000">=</font> <font color="#000000">dataArr</font> <font color="#008000">[</font> <font color="#000000">i</font> <font color="#008000">]</font> <font color="#008000">.</font> <font color="#993333">replace</font> <font color="#008000">(</font> <font color="#000000">/</font> <font color="#000000">^\&lt;script([^\&gt;]+)\&gt;([^\0]+?)&lt;</font> <font color="#0000ff"><b>\/</b></font> <font color="#000000">script\&gt;$</font> <font color="#000000">/i</font> <font color="#000000">m</font> <font color="#008000">,</font> <font color="#ff0000">'</font> <font color="#ff0000">$2</font> <font color="#ff0000">'</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <font color="#993333">data</font> <font color="#008000">=</font> <font color="#993333">data</font> <font color="#008000">.</font> <font color="#993333">replace</font> <font color="#008000">(</font> <font color="#000000">/</font> <font color="#000000">\&lt;script type=(nodejs|'nodejs'|"nodejs")\&gt;([^\0]+?)&lt;</font> <font color="#0000ff"><b>\/</b></font> <font color="#000000">script\&gt;</font> <font color="#000000">/i</font> <font color="#000000">m</font> <font color="#008000">,</font> <font color="#000000"><br> vm</font> <font color="#008000">.</font> <font color="#555599">runInNewContext</font> <font color="#008000">(</font> <font color="#000000">code</font> <font color="#008000">,</font> <font color="#000000">jsonExport</font> <font color="#008000">)</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <font color="#008000">}</font> <font color="#000000"><br> response</font> <font color="#008000">.</font> <font color="#555599">end</font> <font color="#008000">(</font> <font color="#993333">data</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <font color="#008000">}</font> <font color="#008000">)</font> <font color="#008000">;</font> <br> <font color="#008000">}</font> <font color="#008000">)</font> <font color="#008000">;</font> <font color="#000000"><br> <br> server</font> <font color="#008000">.</font> <font color="#555599">listen</font> <font color="#008000">(</font> <font color="#993333">host</font> <font color="#008000">.</font> <font color="#993333">port</font> <font color="#008000">,</font> <font color="#993333">host</font> <font color="#008000">.</font> <font color="#555599">addr</font> <font color="#008000">)</font> <font color="#008000">;</font> <font color="#000000"><br> console</font> <font color="#008000">.</font> <font color="#ffdd00">log</font> <font color="#008000">(</font> <font color="#ff0000">'</font> <font color="#ff0000">  :</font> <font color="#ff0000">'</font> <font color="#008000">+</font> <font color="#993333">host</font> <font color="#008000">.</font> <font color="#555599">addr</font> <font color="#008000">+</font> <font color="#ff0000">'</font> <font color="#ff0000">:</font> <font color="#ff0000">'</font> <font color="#008000">+</font> <font color="#993333">host</font> <font color="#008000">.</font> <font color="#993333">port</font> <font color="#008000">)</font> <font color="#008000">;</font></code> </blockquote> <blockquote> <code><a href="http://habrasyntax.fractalizer.ru/"></a> <font color="gray">      <font color="gray">FractalizeR's HabraSyntax Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  And then, without thinking twice, we write the following code in the template.html file (I think no explanation is required for the layout): <br><blockquote> <code><font color="#000000"><b>&lt;html</b></font> <font color="#000000"><b>&gt;</b></font> <br> <font color="#000000"><b>&lt;head</b></font> <font color="#000000"><b>&gt;</b></font> <br> <font color="#000000"><b>&lt;meta</b></font> <font color="#000066">http-equiv</font> <font color="#008000">=</font> <font color="#993333">"</font> <font color="#993333">content-type</font> <font color="#993333">"</font> <font color="#000066">content</font> <font color="#008000">=</font> <font color="#993333">"</font> <font color="#993333">text/html; charset=utf-8</font> <font color="#993333">"</font> <font color="#000000"><b>&gt;</b></font> <br> <font color="#000000"><b>&lt;title</b></font> <font color="#000000"><b>&gt;</b></font> <font color="#000000"><b>&lt;script</b></font> <font color="#000066">type</font> <font color="#008000">=</font> <font color="#993333">"</font> <font color="#993333">nodejs</font> <font color="#993333">"</font> <font color="#000000"><b>&gt;</b></font> <font color="#993333">title</font> <font color="#008000">;</font> <font color="#000000"><b>&lt;/script</b></font> <font color="#000000"><b>&gt;</b></font> <font color="#000000"><b>&lt;/title</b></font> <font color="#000000"><b>&gt;</b></font> <br> <font color="#000000"><b>&lt;/head</b></font> <font color="#000000"><b>&gt;</b></font> <br> <br> <font color="#000000"><b>&lt;body</b></font> <font color="#000000"><b>&gt;</b></font> <br> <font color="#000000"><b>&lt;h1</b></font> <font color="#000000"><b>&gt;</b></font> <font color="#000000"><b>&lt;script</b></font> <font color="#000066">type</font> <font color="#008000">=</font> <font color="#993333">"</font> <font color="#993333">nodejs</font> <font color="#993333">"</font> <font color="#000000"><b>&gt;</b></font> <font color="#993333">title</font> <font color="#008000">;</font> <font color="#000000"><b>&lt;/script</b></font> <font color="#000000"><b>&gt;</b></font> <font color="#000000"><b>&lt;/h1</b></font> <font color="#000000"><b>&gt;</b></font> <br> <font color="#000000"><b>&lt;script</b></font> <font color="#000066">type</font> <font color="#008000">=</font> <font color="#993333">"</font> <font color="#993333">nodejs</font> <font color="#993333">"</font> <font color="#000000"><b>&gt;</b></font> <br> <font color="#000000"><b>var</b></font> <font color="#000000">out</font> <font color="#008000">=</font> <font color="#ff0000">'</font> <font color="#ff0000">'</font> <font color="#008000">;</font> <font color="#000000"><br> out</font> <font color="#008000">+</font> <font color="#008000">=</font> <font color="#ff0000">'</font> <font color="#ff0000">&lt;ul&gt;\n</font> <font color="#ff0000">'</font> <font color="#008000">;</font> <br> <font color="#000000"><b>for</b></font> <font color="#008000">(</font> <font color="#000000"><b>var</b></font> <font color="#000000">i</font> <font color="#008000">=</font> <font color="#1111ee">0</font> <font color="#008000">;</font> <font color="#000000">i</font> <font color="#008000">&lt;</font> <font color="#000000">list</font> <font color="#008000">.</font> <font color="#993333">length</font> <font color="#008000">;</font> <font color="#000000">i</font> <font color="#008000">+</font> <font color="#008000">+</font> <font color="#008000">)</font> <font color="#008000">{</font> <font color="#000000"><br> out</font> <font color="#008000">+</font> <font color="#008000">=</font> <font color="#ff0000">'</font> <font color="#ff0000">\t\t&lt;li&gt;&lt;b&gt;</font> <font color="#ff0000">'</font> <font color="#008000">+</font> <font color="#000000">list</font> <font color="#008000">[</font> <font color="#000000">i</font> <font color="#008000">]</font> <font color="#008000">.</font> <font color="#993333">name</font> <font color="#008000">+</font> <font color="#ff0000">'</font> <font color="#ff0000">&lt;/b&gt;</font> <font color="#ff0000">'</font> <font color="#008000">+</font> <font color="#000000">list</font> <font color="#008000">[</font> <font color="#000000">i</font> <font color="#008000">]</font> <font color="#008000">.</font> <font color="#555599">msg</font> <font color="#008000">+</font> <font color="#ff0000">'</font> <font color="#ff0000">&lt;/li&gt;\n</font> <font color="#ff0000">'</font> <font color="#008000">;</font> <br> <font color="#008000">}</font> <font color="#000000"><br> out</font> <font color="#008000">+</font> <font color="#008000">=</font> <font color="#ff0000">'</font> <font color="#ff0000">\t&lt;/ul&gt;</font> <font color="#ff0000">'</font> <font color="#008000">;</font> <font color="#000000"><br> out</font> <font color="#008000">;</font> <br> <font color="#000000"><b>&lt;/script</b></font> <font color="#000000"><b>&gt;</b></font> <br> <font color="#000000"><b>&lt;/body</b></font> <font color="#000000"><b>&gt;</b></font> <br> <font color="#000000"><b>&lt;/html</b></font> <font color="#000000"><b>&gt;</b></font></code> </blockquote> <blockquote> <code><a href="http://habrasyntax.fractalizer.ru/"></a> <font color="gray">      <font color="gray">FractalizeR's HabraSyntax Source Code Highlighter</font> .</font></code> </blockquote> <br>  I think it will be easy for you to analyze this code yourself.  The inserts simply display the key values ‚Äã‚Äãfrom our JSON context structure.  A list is displayed at the bottom, at first everything is added to a local variable, and then it returns at the end for output. <br><br>  So, now a little magic, type in the console: <br><blockquote> <code><font color="#000000">node start</font> <font color="#008000">.</font> <font color="#555599">js</font></code> </blockquote> <blockquote> <code><a href="http://habrasyntax.fractalizer.ru/"></a> <font color="gray">      <font color="gray">FractalizeR's HabraSyntax Source Code Highlighter</font> .</font></code> </blockquote> <br>  Go to <a href="http://127.0.0.1:8070/">http://127.0.0.1:8070</a> and admire!  Good luck with experiments! <br><br>  PS Do not forget that this is only an example, there is not even an error handler and other things, the example is very minimalist. </div><p>Source: <a href="https://habr.com/ru/post/119966/">https://habr.com/ru/post/119966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119953/index.html">1C-Bitrix in the Scalaxy panel</a></li>
<li><a href="../119958/index.html">The legendary long-term construction Duke Nukem Forever went "for gold"</a></li>
<li><a href="../119959/index.html">Blockers of all time</a></li>
<li><a href="../119960/index.html">Xi3 ChromiumPC - pretty desktop with Chrome OS on board</a></li>
<li><a href="../119961/index.html">erlanger.ru rides Erlang Factory 2011 in London</a></li>
<li><a href="../119967/index.html">NASA has stopped trying to contact "Spirit"</a></li>
<li><a href="../119968/index.html">A smooth transition of the company's network to IPv6</a></li>
<li><a href="../119969/index.html">SkypeKit Description (headless Skype)</a></li>
<li><a href="../119972/index.html">Migration from one physical server to another</a></li>
<li><a href="../119973/index.html">June 9 - RoR developers meeting with Rendell Thomas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>