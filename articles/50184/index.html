<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Python. Plasma snake</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="KDE4 
 Everyone has already managed to go through the dampness of technology, appearance, interface concepts, but real apologists know that when KDE4 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Python. Plasma snake</h1><div class="post__text post__text-html js-mediator-article"><h2>  KDE4 </h2><br>  Everyone has already managed to go through the dampness of technology, appearance, interface concepts, but real apologists know that when KDE4 enters a stable phase, everything will be fine, and weak spirit renegades who you see could not tolerate a year of constant glitches and return. <br><br>  Now seriously - the key technology of the new KDE - Plasma.  So that in KDE it was good to live, it is necessary to create <i>plasmoids</i> .  Thanks to C and C ++ for the work of the kernel, X server and KDE, and we, the generation of web developers, and generally people accustomed to simplicity, can easily inhabit the system using more familiar languages, for example Python, which, as you know, comes with batteries. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Package </h2><br>  For all of the above, you need python plasmoid support by your KDE version.  The latest release of Ubuntu has this support. <br><br>  Python plasmoids are organized in packages.  A package is a file structure wrapped in a zip: <br> <code>./contents <br> ./contents/code <br> ./contents/code/main.py <br> ./metadata.desktop <br></code> <br><br>  So, let's begin.  Create a folder plasma-informer, and in it the folders and files from the listing.  The first in line metadata.desktop, we will assume that the fields are sufficiently speaking: <br> <code>[Desktop Entry] <br> Encoding=UTF-8 <br> Name=Informer about something <br> Type=Service <br> ServiceTypes=Plasma/Applet <br> X-Plasma-API=python <br> X-Plasma-MainScript=code/main.py <br> Icon=chronometer <br> <br> X-KDE-PluginInfo-Author= <br> X-KDE-PluginInfo-Email=deeppy@kuku.ya <br> X-KDE-PluginInfo-Name=plasma-informer <br> X-KDE-PluginInfo-Version=1.0 <br> X-KDE-PluginInfo-Website=http://habrahabr.ru <br> X-KDE-PluginInfo-Category=Tests <br> X-KDE-PluginInfo-Depends= <br> X-KDE-PluginInfo-License=GPL <br> X-KDE-PluginInfo-EnabledByDefault=true <br></code> <br><br>  The package description is of course an important part for good integration of the package into all sorts of lists, but the salt of the earth lies in contents / code / main.py, which is supplied with a mass of comments: <br><pre> <code class="hljs rust">#! /usr/bin/python # -*- coding: utf8 -*- from PyQt4.QtCore import * from PyQt4.QtGui import * from PyKDE4.kdecore import * from PyKDE4.kdeui import * from PyKDE4.plasma import Plasma import plasma class MyLabel(Plasma.Label): <span class="hljs-string"><span class="hljs-string">"     ,  ."</span></span> def setText(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>,text): <span class="hljs-string"><span class="hljs-string">" .         ."</span></span> width = QFontMetrics(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.font()).width(text) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.setMinimumWidth(width) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.setMaximumWidth(width) Plasma.Label.setText(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>,text) class PyInfApplet(plasma.Applet): <span class="hljs-string"><span class="hljs-string">" .  -  ,     ..."</span></span> def __init__(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>,parent,args=<span class="hljs-literal"><span class="hljs-literal">None</span></span>): <span class="hljs-string"><span class="hljs-string">"   ,      ."</span></span> plasma.Applet.__init__(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>,parent) #       ,     ! def init(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>): #     <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.setHasConfigurationInterface(False) #     ,       <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.setAspectRatioMode(Plasma.IgnoreAspectRatio) #  ,     ,    <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.timer = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.startTimer(<span class="hljs-number"><span class="hljs-number">1000</span></span>) #  <span class="hljs-string"><span class="hljs-string">""</span></span>, ,      <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mlayout = QGraphicsLinearLayout(Qt.Horizontal) #   <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.label = MyLabel() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.label.setText(<span class="hljs-symbol"><span class="hljs-symbol">'Yahooho</span></span>') #      <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mlayout.addItem(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.label) #  ,  Plasma,       ! <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.setLayout(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mlayout) def timerEvent(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>,ev): <span class="hljs-string"><span class="hljs-string">"      "</span></span> pass def constraintsEvent(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, constraints): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> constraints &amp; Plasma.SizeConstraint: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.resize(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.size()) def CreateApplet(parent): <span class="hljs-string"><span class="hljs-string">"      Plasma"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PyInfApplet(parent)</code> </pre><br><br>  As you can see from the code, the applet does nothing, but simply occupies the panel with a silly inscription.  But for experiments with a plasmoid, it is time to install it and see how it works.  At the root of the package, run zip -r ../plasma-informer.zip *, and then install it: plasmapkg -i ../plasma-informer.zip <br><br>  The package will be installed in the home directory in the folder .kde / share / apps / plasma / plasmoids / plasma-informer, and you can continue the development work by editing the file .kde / share / apps / plasma / plasmoids / plasma-informer / contents / code / main.py.  The second is to look at the result, and all Pythonists know the property of the packages - if you have already imported a package, then in order to update its code, it is advisable to reload the entire python code.  In our case, this is equal to the overload of Plasma, which is generally a risky operation - you will remain with a bare desktop without controls.  So, for the Jedi there is a special utility - plasmoidviewer. <br><br>  ~ $ plasmoidviewer plasma-informer <br><br><img src="http://img5.imageshost.ru/imgs/090126/5c57066a2d81f49f4b4146dae9231454/31d951462509d5fea887d48a4d4cb5d7.png"><br><br>  Since the plasmoid is already installed, you can look at it: plasmoidviewer plasma-informer <br><br>  To load our informer with meaning, edit the timerEvent code: <br><pre> <code class="hljs ruby"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timerEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">self</span></span></span></span><span class="hljs-function"><span class="hljs-params">,ev)</span></span></span></span>: <span class="hljs-string"><span class="hljs-string">"      "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.label.setText(open(<span class="hljs-string"><span class="hljs-string">'/proc/loadavg'</span></span>,<span class="hljs-string"><span class="hljs-string">'r'</span></span>).read().strip())</code> </pre><br><br>  Now the informer really informs us about something like that. <br><br><img src="http://img5.imageshost.ru/imgs/090126/8cea7f2ec540f480526ddfc543f3787c/c5e2e406c73f2c007bab84fdc125db8d.png"><br><br>  But with the placement of the second applet (one more you can see in the picture, it serves to control Amarok) problems arose during import.  A small workaround is to edit /usr/share/kde4/apps/plasma_scriptengine_python/plasma_importer.py - in the PlasmaImporter class, I rendered the declaration self.toplevel = {} from __init__ and did this: <br><pre> <code class="hljs python"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlasmaImporter</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> toplevel = {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> sys.path.append(<span class="hljs-string"><span class="hljs-string">'&lt;plasma&gt;'</span></span>) sys.path_hooks.append(self.hook)</code> </pre><br><br>  Such a chip makes toplevel belonging to a <i>class</i> and not to an object instance, as it was at the very beginning it put me in a stupor for two hours, but it helped here. <br><br>  Homework - monitoring of own karma, the code for check is accepted in the comment. <br><br>  PS cat plasma-restart <br> <code>kbuildsycoca4 <br> kquitapp plasma <br> plasma <br></code> <br><br>  PPS I put KDE4.2, got out a bug, more precisely, the modules were slightly changed.  Replace the import plasma line with from PyKDE4 import plasmascript as plasma, and everything will work again. <br>  PPPS After a series of updates, I don‚Äôt remember from what moment it broke again.  Well, the solution is to add a line to metadata.desktop: X-Plasma-MainScript = code / main.py </div><p>Source: <a href="https://habr.com/ru/post/50184/">https://habr.com/ru/post/50184/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../50176/index.html">Introduction</a></li>
<li><a href="../50177/index.html">Likbez on the basics of security and cryptography</a></li>
<li><a href="../50179/index.html">Using the console when debugging ASP.Net applications</a></li>
<li><a href="../50181/index.html">Comments are visible only to the author of the topic.</a></li>
<li><a href="../50182/index.html">Popular errors administrators jabber-servers</a></li>
<li><a href="../50187/index.html">Nhibernate. DAO + Generic</a></li>
<li><a href="../50189/index.html">Budget planning</a></li>
<li><a href="../50193/index.html">Overburning or how to stuff an unburned</a></li>
<li><a href="../50195/index.html">Kharkiv First Coworking Office</a></li>
<li><a href="../50196/index.html">Calculating the value of an expression</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>