<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yet Another Rating System</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, the topic of rating systems continues to haunt the minds of users. There are more and more new schemes, formulas, tests. And each time it all come...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yet Another Rating System</h1><div class="post__text post__text-html js-mediator-article">  So, the topic of rating systems <a href="http://habrahabr.ru/company/darudar/blog/143188/">continues</a> <a href="http://habrahabr.ru/post/150683/">to</a> haunt the <a href="http://habrahabr.ru/post/172065/">minds of</a> users.  There are more and more new schemes, formulas, tests.  And each time it all comes down to the same question: how to combine the average user rating with our confidence in this rating.  For example, if one film received 80 positive and 20 negative votes, and another - 9 positive and 1 negative, which film is better?  Without pretending to create a new universal rating system, I still offer one of the possible approaches to the solution of this particular issue. <br><a name="habracut"></a><br><h4>  Approximation by normal distribution </h4><br>  In general, the wording itself ‚Äî to evaluate a certain value and our confidence in it ‚Äî suggests the use of a probability distribution model, for example, a normal distribution. <br><br><div class="spoiler">  <b class="spoiler_title">What is a normal distribution ?!</b> <div class="spoiler_text">  For those who skipped a pair of mat.  statistics, I remind you that it is a normal distribution, and indeed the probability distribution.  Suppose we came to a stop and saw a bus leave in front of us.  We know that the next one will arrive in about 15 minutes (at the 15th minute).  Well, maybe on the 16th.  Or vice versa, on the 14th.  In principle, the driver can hurry and arrive at 12 minutes, but the likelihood of this is much lower.  The graph below just shows the probability distribution of the bus arrival at every minute: most likely it will arrive at the 15th minute, with a slightly lower probability - at the 14th or 16th, and with very little probability at the 12th or 18th. <br><br><img src="https://habrastorage.org/storage2/493/f9e/e10/493f9ee1099648b4fe5a68c247afb880.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It should be understood that the value along the Y axis is not a probability, but <i>a</i> probability density function (PDF).  The probability itself is calculated as the area under the graph between two values ‚Äã‚ÄãX1 and X2, for example, the probability that the bus will come between 15 and 16 minutes in this case is equal to 0.248.  But more about that later. <br><br>  Normal distribution is characterized by two parameters - the average value (mean, here - 15 minutes) and variance (variance, variation), which shows the degree of uncertainty of the average value: the greater the variance, the wider the graph, and the less we are sure when this bus will come. <br></div></div><br><br>  Rating, as a rule, is just a number, some final result of evaluation.  And we will actually evaluate the estimated quality of the film (coffee grinders, articles, users - it must be emphasized).  The graph below shows the distribution plots for two <a href="http://www.imdb.com/title/tt0138704/">hypothetical</a> <a href="http://www.imdb.com/title/tt1210166/">films</a> . <br><br><img src="https://habrastorage.org/storage2/9e4/0fd/b56/9e40fdb56ddfd10d89b9a72ab90d38f2.png"><br><br>  The first film (blue line) caused conflicting reviews (the average distribution value is 0.5).  In contrast, the second film (the green line) received more positive than negative ratings, but there were far fewer people voted, therefore, as a result, we are much less certain (the variance is much greater than in the first graph). <br><br>  In principle, the normal distribution in itself already makes it possible to model a rating well (the <a href="http://en.wikipedia.org/wiki/Central_limit_theorem">central limit theorem</a> gives a theoretical justification for this).  However, in statistics there is a more convenient tool for this. <br><br><h4>  Beta distribution </h4><br>  Like the normal one, the beta distribution is defined by two parameters, alpha&gt; 0 and beta&gt; 0 (written as X ~ B (alpha, beta)).  However, unlike the normal, always bell-shaped, beta distribution has much more flexibility.  In particular, for alpha = 1 and beta = 1, this distribution becomes uniform (the dark blue line in the figure below), for alpha &lt;1 and beta &lt;1, the distribution function takes the form of a well (green line), and for alpha&gt; 1 and beta&gt; 1 becomes similar to normal (red and light blue lines). <br><br><img src="https://habrastorage.org/storage2/fa8/034/780/fa8034780e100327a14144067f55c3aa.png"><br><br><div class="spoiler">  <b class="spoiler_title">programming exercise</b> <div class="spoiler_text">  It would be unfair to continue to show graphs and not tell how to draw them and play with the parameters, so here and below I will show examples of code for generating each image.  The examples will be in Python using the NumPy, SciPy and matplotlib libraries (all three are available from pip), but they can be easily transferred to <a href="http://stat.ethz.ch/R-manual/R-patched/library/stats/html/Beta.html">R</a> , <a href="http://www.mathworks.com/help/stats/prob.betadistributionclass.html">Matlab</a> / <a href="http://www.gnu.org/software/octave/doc/interpreter/Distributions.html">Octave</a> , <a href="http://commons.apache.org/proper/commons-math//apidocs/org/apache/commons/math3/distribution/BetaDistribution.html">Java,</a> and even <a href="http://www.jstat.org/">JavaScript</a> . <br><br>  For all examples, the following imports will be needed: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scipy.stats <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ss <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pylab <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> plt</code> </pre> <br><br>  The previous chart was generated by the following code: <br><br><pre> <code class="python hljs">x = arange(<span class="hljs-number"><span class="hljs-number">101</span></span>) / <span class="hljs-number"><span class="hljs-number">100.</span></span> plt.plot(x, ss.beta(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).pdf(x)) plt.plot(x, ss.beta(<span class="hljs-number"><span class="hljs-number">.7</span></span>, <span class="hljs-number"><span class="hljs-number">.7</span></span>).pdf(x)) plt.plot(x, ss.beta(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>).pdf(x)) plt.plot(x, ss.beta(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>).pdf(x)) plt.show()</code> </pre><br></div></div><br><br>  In addition, the beta distribution has several interesting properties: <br><br><ol><li>  It is limited to a finite interval.  If we want to ‚Äúlock in‚Äù possible values ‚Äã‚Äãin the range from 0 to 1, then the beta distribution is just what we need. </li><li>  It is symmetrical with respect to its parameters.  Graph B (alpha, beta) will be a mirror image of graph B (beta, alpha). </li><li>  alpha and beta act on different sides of the density plot.  With increasing alpha, the graph shifts and leans to the right, with increasing beta - vice versa, to the left. </li><li>  Dispersion with increasing any of the parameters decreases. </li></ol><br><br><h4>  User Ratings </h4><br>  And what if we use as parameters alpha and beta, respectively, the number of positive and the number of negative user ratings?  In this case, initially, the beta distribution can be initialized by units for both parameters (which, generally speaking, will correspond to the <a href="http://en.wikipedia.org/wiki/Additive_smoothing">Laplace smoothing</a> ).  In this case, initially our assessment of the quality of the film will be evenly distributed (we know nothing about it), and each vote will increase one of the parameters, reduce variance and shift the graph either to the right (alpha parameter, positive feedback) or to the left (beta parameter negative reviews).  At the same time, our assessment of the quality of the film will never go beyond the interval [0..1] and, in fact, will show the likelihood that the film will please the <a href="http://absurdopedia.wikia.com/wiki/%25D0%25A1%25D1%2580%25D0%25B5%25D0%25B4%25D0%25BD%25D0%25B5%25D1%2581%25D1%2582%25D0%25B0%25D1%2582%25D0%25B8%25D1%2581%25D1%2582%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25B3%25D1%2580%25D0%25B0%25D0%25B6%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25BD">average viewer</a> . <br><br>  Consider a few examples.  When a new <a href="http://www.imdb.com/title/tt0123755/%3Fref_%3Dtt_rec_tti">film</a> appears, about which no one has yet expressed its opinion, its alpha and beta parameters will be equal to one, and the density graph will be equivalent to the uniform distribution graph: <br><br><img src="https://habrastorage.org/storage2/473/aac/002/473aac00251199556e5967ff3f957b0e.png"><br><br><div class="spoiler">  <b class="spoiler_title">programming exercise</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    plt.plot(x, ss.beta(1, 1).pdf(x)) plt.show()</span></span></code> </pre><br></div></div><br><br>  It turned out that the information about the film was uploaded by the director himself.  I downloaded it myself, and voted myself.  Naturally, positively.  Yes, and five of his assistants asked for help.  The result: alpha = 1 + 1 + 5 = 7, beta = 1. <br><br><img src="https://habrastorage.org/storage2/c0e/89c/85e/c0e89c85e0cb8a12d5299a916729b23a.png"><br><br><div class="spoiler">  <b class="spoiler_title">programming exercise</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   plt.plot(x, ss.beta(7, 1).pdf(x)) plt.show()</span></span></code> </pre><br></div></div><br><br>  The former wife of the director saw the page of the film and decided to spoil the rating, having voted negatively along with her lover.  The result: alpha = 7, beta = 1 + 2 = 3: <br><br><img src="https://habrastorage.org/storage2/6c0/fbf/104/6c0fbf10496c02ee05b28020b1c8bbea.png"><br><br><div class="spoiler">  <b class="spoiler_title">programming exercise</b> <div class="spoiler_text"><pre> <code class="python hljs">plt.plot(x, ss.beta(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>).pdf(x)) plt.show()</code> </pre><br></div></div><br><br>  After 8 votes, the average score, taking into account the Laplace smoothing, will be equal to alpha / (alpha + beta) = 7/10 = 0.7.  However, the graph shows that the dispersion of the resulting distribution is still high, which means our confidence in such an assessment is low. <br><br>  Suppose that, during the first week of hire, another 90 people voted for the film, and so that the alpha parameter eventually turned out to be 70 and beta - 30. The average rating would be 70/100 = 0.7, as before, but the schedule is significantly will change: <br><br><img src="https://habrastorage.org/storage2/74d/c3a/260/74dc3a2609fc5a1a4b54b339f8326f64.png"><br><br><div class="spoiler">  <b class="spoiler_title">programming exercise</b> <div class="spoiler_text"><pre> <code class="python hljs">plt.plot(x, ss.beta(<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>).pdf(x)) plt.show()</code> </pre><br></div></div><br><br>  The variance in the second graph is much smaller.  Those.  with an increase in the number of votes, our confidence in assessing the quality of the film also increases. <br><br><h4>  Rating </h4><br>  All this is good, but the user does not want to see some strange graphics.  He needs a rating - a figure by which he can determine whether to watch a movie <s>or better to go read a book</s> .  In principle, having the parameters of the beta distribution, you can calculate the average estimate and variance, and somehow try to combine them (for example, divide the average estimate by the logarithm of the variance).  But you can go and more statistically correct way. <br><br>  To make the conversation more substantive, take for example 2 films: one from the previous section with the distribution B (70, 30) and another, <a href="http://www.imdb.com/title/tt0371724/">more popular</a> , with the distribution B (650, 350).  Distribution plots are shown below: <br><br><img src="https://habrastorage.org/storage2/d9e/25f/4ff/d9e25f4ff352bb16f7659c0ce0bbe0e1.png"><br><br><div class="spoiler">  <b class="spoiler_title">programming exercise</b> <div class="spoiler_text"><pre> <code class="python hljs">plt.plot(x, ss.beta(<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>).pdf(x)) plt.plot(x, ss.beta(<span class="hljs-number"><span class="hljs-number">650</span></span>, <span class="hljs-number"><span class="hljs-number">350</span></span>).pdf(x)) plt.show()</code> </pre><br></div></div><br><br>  On the one hand, the average of the ratings for the first film is higher - 0.7 versus 0.65.  However, the second film was watched by many more people, so it is not yet known what the rating of the first film after the same number of reviews would have been.  So how do you compare them? <br><br>  One of the comparison options is to calculate the <i>minimum trust quality of the</i> film, a number indicating the minimum rating a film can receive after an infinite amount of reviews.  In statistics, it is not customary to bring everything to the absolute, therefore, as a level of trust, we take not 100%, but the standard 95%.  This means that we want to be 95% sure that the film is <i>no worse</i> than X. Graphically, this means that 95% of the area under the graph should be on the right of X: <br><br><img src="https://habrastorage.org/storage2/b75/854/139/b7585413944dce9e87f92f432e9beeb3.png"><br><br><div class="spoiler">  <b class="spoiler_title">programming exercise</b> <div class="spoiler_text">  Virtually all statistical libraries for all implemented distributions provide a probability function (cumulative probability function, CDF), which takes as input a value and returns the probability that a random variable is <i>less than that value</i> .  Those.  in fact, the CDF from some value of X returns the area under the graph between zero and X. This is different from what we need in two aspects. <br><br>  First, we need the area on the other hand - from X to 1. Fortunately, as mentioned above, the beta function is symmetric about its parameters, so instead of direct beta distribution B (alpha, beta) we can work with the inverse - B (beta, alpha). <br><br>  Secondly, we need a function that, for a given degree of confidence (a percentage of the entire area of ‚Äã‚Äãthe graph), will return the desired value of X. Most often, the mat.  In packages, this function is called inverse CDF or something like that, but SciPy uses the name PPF (percent point function, also found in the literature under the name quantile funtion). <br><br>  In total, the following code can be used to get the value of the minimum trust quality of a movie: <br><br><pre> <code class="python hljs">dist1 = ss.beta(<span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-comment"><span class="hljs-comment">#    ,    dist2 = ss.beta(650, 350) #    ,     idist1 = ss.beta(30, 70) # ,   idist2 = ss.beta(350, 650) # ,   q1 = 1 - idist1.ppf(.95) #        95% q2 = 1 - idist2.ppf(.95) #        95% ... &gt;&gt;&gt; q1 0.62272854953840073 &gt;&gt;&gt; q2 0.62503161244929017</span></span></code> </pre><br></div></div><br><br>  After the calculations, it turned out that with a 95% probability the first film will ultimately enjoy at least 0.6227 from all viewers, but the second one - 0.6250 of them.  The difference is only two thousandths, but if you use these ratings in the rating, the second film, even with a lower average rating, will be higher in the list. <br><br>  The same calculations can be repeated for the films indicated at the very beginning of the post: for a film with an 80/20 proportion, the minimum trust quality will be 0.731, and for a film with a 9/1 proportion - 0.717, i.e.  the number of votes again outweighs the average estimate.  However, it is worth adding the second film only one vote ‚Äúfor‚Äù, and our coefficient for it becomes equal to 0.741, bringing it to the first place. <br><br><h4>  Variations, advantages and disadvantages </h4><br>  All the coefficients indicated here are taken, by and large, by eye.  Although, it seems, they give a rather sane result, in a real application it makes sense to try different values ‚Äã‚Äãfor them.  For example, with a large number of users voting for movies, it makes sense to increase the parameters not by 1, but, for example, by 0.5 for each vote.  Or even introduce a damping factor, when each next voice has less weight than the previous one - this way you can slow down the growth of the coefficients. <br><br>  In addition, it is possible to improve the initial rating relative to the film.  In this article, I proceeded from the fact that initially we know nothing about the film itself or about other films in our system, so a uniform distribution is assigned to the film at the beginning (alpha = 1, beta = 1).  However, in practice, we, as a rule, already know something about the film in advance and can use this information as an a priori estimate.  For example, we can calculate the average rating for previous films of this director and initialize the parameters of the beta distribution accordingly.  Even if we do not know anything about the director (producer, screenwriter, cast), we can use the average rating for all films in our database. <br><br>  In principle, the method can be extended for more graded assessments, for example, for a scale from 0 to 10. In this case, ratings above 5 will be added to the alpha parameter, below 5 to the beta, and if evaluated exactly 5, both alpha and beta increase by 0.5 (hello Habr!). <br><br>  Finally, one can vary the required degree of confidence in the answer or even change the approach, using instead of the minimum confidence quality the area under the graph within a certain fixed interval. <br><br><div class="spoiler">  <b class="spoiler_title">Beta distribution schedule for this article.</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/af7/e3e/48c/af7e3e48c439dad6ba810ef15e96e3cf.png"><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/172101/">https://habr.com/ru/post/172101/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../172079/index.html">World Digital Revolution</a></li>
<li><a href="../172081/index.html">Cisco opens EIGRP for third-party</a></li>
<li><a href="../172083/index.html">On the styles of implementing large ERP projects</a></li>
<li><a href="../172085/index.html">SQLite - database size after DELETE FROM</a></li>
<li><a href="../172093/index.html">Report on the maintenance of the base station standards GSM and UMTS</a></li>
<li><a href="../172105/index.html">CryptoSMS - protect your SMS (Android only)</a></li>
<li><a href="../172107/index.html">Debugging Node.js in Visual Studio</a></li>
<li><a href="../172109/index.html">Rails 4 - Thread-Safety</a></li>
<li><a href="../172111/index.html">DIYROCKETS and Sunglass are taking a step towards the general availability of aerospace development using joint 3D modeling</a></li>
<li><a href="../172115/index.html">Controlling access to Samba file servers in an AD-based Windows domain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>