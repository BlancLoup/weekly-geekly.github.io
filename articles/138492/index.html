<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dynamic translation of the page into another language</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. 

 Today I will talk about my achievements in the field of instant page change - dynamic language change. I needed this thing quite recently...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dynamic translation of the page into another language</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr. <br><br>  Today I will talk about my achievements in the field of instant page change - dynamic language change.  I needed this thing quite recently, and since I don‚Äôt trust third-party implementations (I didn‚Äôt even find them), I had to write my own.  During its use (about six months), I fixed all the most noticeable bugs (but this does not mean that they are no longer there :)), and now I am presenting a working version. <br><br>  Someone will say that it is impractical to make a transfer on the client, but I got the situation that can‚Äôt be done otherwise: for the server transfer, you have to forcibly close web applications on the page in order not to lose data;  in the case of a dynamic language change, the texts on the elements are simply replaced and the work continues.  I think, not one annoyed me "Settings will be applied when rebooting."  My implementation, though complicated, solves this problem. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order not to be confused, I will define the following list of terms for this article: <br>  <i>Dictionary</i> - a repository of keys by which access to localization in a given language.  In fact, it is a regular JavaScript object, where properties are access keys, and their values ‚Äã‚Äãare translated strings. <br>  <i>A hash</i> is an object that is the result of an ordered merge of dictionaries;  general dictionary, from which the translation is subsequently sampled. <br><br>  Now in more detail. <br><a name="habracut"></a><br><br>  To speed up reading, I recommend skipping the chapters <i>Source Code</i> and <i>Interface Description</i> , as  they give the description of the object of conversation from the program point of view.  If you wish, you can read them later if you are interested in the article. <br><br><h4>  Source </h4><br>  Immediately suggest the source code.  Do not go into details yet, but we will come back to it. <br><pre><code class="javascript hljs">lang = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init_lang</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> BODY = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body, <span class="hljs-comment"><span class="hljs-comment">//  LANG_HASH = {}, //,   LANG_HASH_LIST = [], //   LANG_HASH_INDEX = {}, //   LANG_HASH_USER = {}, //  LANG_HASH_SYSTEM = {}, //  LANG_QUEUE_TO_UPDATE = [], //    LANG_PROPS_TO_UPDATE = {}, //    LANG_UPDATE_LAST = -1, //    LANG_UPDATE_INTERVAL = 0, //  LANG_JUST_DELETE = false; //     var hash_rebuild = function hash_rebuild() { //   var obj = {}; obj = lang_mixer(obj, LANG_HASH_USER); for (var i = 0, l = LANG_HASH_LIST.length; i &lt; l; i++) obj = lang_mixer(obj, LANG_HASH_LIST[i]); LANG_HASH = lang_mixer(obj, LANG_HASH_SYSTEM); }, lang_mixer = function lang_mixer(obj1, obj2) { //   for (var k in obj2) obj1[k] = obj2[k]; return obj1; }, lang_update = function lang_update(data) { //,   switch (typeof data) { default: return; case "string": LANG_PROPS_TO_UPDATE[data] = 1; break; case "object": lang_mixer(LANG_PROPS_TO_UPDATE, data); } LANG_UPDATE_LAST = 0; if (!LANG_UPDATE_INTERVAL) LANG_UPDATE_INTERVAL = setInterval(lang_update_processor, 100); }, lang_update_processor = function lang_update_processor() { //  var date = new Date; for (var l = LANG_QUEUE_TO_UPDATE.length, c, k; LANG_UPDATE_LAST &lt; l; LANG_UPDATE_LAST++) { c = LANG_QUEUE_TO_UPDATE[LANG_UPDATE_LAST]; if(!c) continue; if (!c._lang || !(c.compareDocumentPosition(BODY) &amp; 0x08)) { LANG_QUEUE_TO_UPDATE.splice(LANG_UPDATE_LAST, 1); LANG_UPDATE_LAST--; if (!LANG_QUEUE_TO_UPDATE.length) break; continue; } for (k in c._lang) if (k in LANG_PROPS_TO_UPDATE) lang_set(c, k, c._lang[k]); if (!(LANG_UPDATE_LAST % 10) &amp;&amp; (new Date() - date &gt; 50)) return; } LANG_PROPS_TO_UPDATE = {}; clearInterval(LANG_UPDATE_INTERVAL); LANG_UPDATE_INTERVAL = 0; }, lang_set = function lang_set(html, prop, params) { //   html[params[0]] = prop in LANG_HASH ? LANG_HASH[prop].replace(/%(\d+)/g, function rep(a, b) { return params[b] || ""; }) : "#" + prop + (params.length &gt; 1 ? "(" + params.slice(1).join(",") + ")" : ""); }; var LANG = function Language(htmlNode, varProps, arrParams) { //    var k; if (typeof htmlNode != "object") return; if (typeof varProps != "object") { if (typeof varProps == "string") { k = {}; k[varProps] = [htmlNode.nodeType == 1 ? "innerHTML" : "nodeValue"]. concat(Array.isArray(arrParams) ? arrParams : []) varProps = k; } else return; } if (typeof htmlNode._lang != "object") htmlNode._lang = {}; for (k in varProps) { if (!(Array.isArray(varProps[k]))) varProps[k] = [varProps[k]]; htmlNode._lang[k] = varProps[k]; lang_set(htmlNode, k, varProps[k]); } if (LANG_QUEUE_TO_UPDATE.indexOf(htmlNode) == -1) LANG_QUEUE_TO_UPDATE.push(htmlNode); }; lang_mixer(LANG, { get: function get(strProp) { //    return LANG_HASH[strProp] || ("#" + strProp); }, set: function set(strProp, strValue, boolSystem) { //    //   var obj = !boolSystem ? LANG_HASH_USER : LANG_HASH_SYSTEM; if (typeof strValue != "string" || !strValue) delete obj[strProp]; else obj[strProp] = strValue; hash_rebuild(); lang_update(strProp + ""); return obj[strProp] || null; }, load: function load(strName, objData) { // () switch (typeof strName) { default: return null; case "string": if (LANG_HASH_INDEX[strName]) { LANG_JUST_DELETE = true; LANG.unload(strName); LANG_JUST_DELETE = false; } LANG_HASH_LIST.push(objData); LANG_HASH_INDEX[strName] = objData; break; case "object": objData = {}; for (var k in strName) { if (LANG_HASH_INDEX[k]) { LANG_JUST_DELETE = true; LANG.unload(k); LANG_JUST_DELETE = false; } LANG_HASH_LIST.push(strName[k]); LANG_HASH_INDEX[k] = strName[k]; objData[k] = 1; } } hash_rebuild(); lang_update(objData); return typeof strName == "string" ? objData : strName; }, unload: function unload(strName) { // () var obj, res = {}, i; if (!(Array.isArray(strName))) strName = [strName]; if (!strName.length) return null; for (i = strName.length; i--;) { obj = LANG_HASH_INDEX[strName[i]]; if (obj) { LANG_HASH_LIST.splice(LANG_HASH_LIST.indexOf(obj), 1); delete LANG_HASH_INDEX[strName[i]]; res[strName[i]] = obj; if (LANG_JUST_DELETE) return; } } hash_rebuild(); lang_update(obj); return strName.length == 1 ? res : obj; }, params: function params(htmlElem, strKey, arrParams) { if (typeof htmlElem != "object" || !htmlElem._lang || !htmlElem._lang[strKey]) return false; htmlElem._lang[strKey] = htmlElem._lang[strKey].slice(0, 1).concat(Array.isArray(arrParams) ? arrParams : []); lang_set(htmlElem, strKey, htmlElem._lang[strKey]); return true; } }); return LANG; })();</span></span></code> </pre> <br><br><h4>  Hierarchy </h4><br>  First, I want to note that in my implementation I selected several types of dictionaries: <br>  1) <i>downloadable</i> : <br>  The keys of such a dictionary cannot be changed by the user individually: they can be downloaded or unloaded only as a whole.  Such a dictionary always takes precedence over other downloadable dictionaries.  Named. <br>  2) <i>custom</i> : <br>  Built-in dictionary, the priority of which is always lower than the priority of any of the loaded dictionaries.  Cannot be loaded or unloaded entirely, changes only by individual keys.  Its meaning is to keep the values ‚Äã‚Äãthat were specified by the user separately from the rest.  If you download all downloaded dictionaries, it will not affect the user dictionary and its values ‚Äã‚Äãwill still be available. <br>  3) <i>systemic</i> : <br>  According to the meaning, it repeats the user one completely, but it has the highest priority. <br><br><img src="https://habrastorage.org/storage2/514/2f5/abc/5142f5abcca1f84d0c623a823e2e1088.png"><br>  <i><b>Figure 1 - List of downloadable dictionaries (in square brackets), as well as user and system dictionaries, arranged in order of increasing priority.</b></i> <br><br>  So, when changing the user or system dictionary, as well as changes in the list of loaded dictionaries, the hash is updated.  The algorithm is as follows: <br>  1) keys from objects are copied into the hash object in the reverse of the specified figure, i.e.  in order of lower priority; <br>  2) if such a key is already in the hash, then copying does not occur. <br><br><table><tbody><tr><td>  Key \ Dictionary </td><td>  [User] </td><td>  Common </td><td>  System </td><td>  App1 </td><td>  App2 </td><td>  App3 </td><td>  [System] </td><td>  Hash </td></tr><tr><td>  Ok </td><td></td><td>  Ok </td><td>  Ok </td><td></td><td></td><td></td><td></td><td>  Ok </td></tr><tr><td>  CANCEL </td><td>  Cancel </td><td>  Cancel </td><td>  Cancel </td><td></td><td></td><td></td><td></td><td>  Cancel </td></tr><tr><td>  DONE </td><td></td><td>  Done </td><td></td><td>  Is done </td><td></td><td></td><td></td><td>  Is done </td></tr><tr><td>  STRING </td><td></td><td>  String </td><td></td><td></td><td></td><td></td><td></td><td>  String </td></tr></tbody></table><br>  <i><b>Table 1 - Transfer of keys to the hash from higher priority dictionaries.</b></i> <br><br>  By default, no dictionary is loaded;  User and system dictionaries are empty.  By the way, a call to a non-existent dictionary property returns not an empty string, but a string of the form "#key", where the hash character is followed by the name of the key to which the call was made.  This is done so that it is immediately visible on the screen which keys do not exist. <br><br><h4>  Interface Description </h4><br>  After executing the source code, the global variable lang will become available, the value of which is the function that associates the attributes of the element with the hash through the key.  You can pass arguments to it as follows: <br><pre> <code class="javascript hljs">lang(htmlTextNode,strKey); lang(htmlTextNode,strKey,arrParams); lang(htmlTextNode,objKeys); lang(htmlElement,objKeys);</code> </pre>  Where: <br>  <i>htmlTextNode</i> - the text node with which the binding occurs; <br>  <i>strKey</i> - the key in the dictionary, which will be addressed; <br>  <i>arrParams</i> - parameters substituted into the translation (more on this later); <br>  <i>objKeys</i> is an object containing, in its properties, the keys by which the call should occur, and in values ‚Äã‚Äãthe attribute to bind (as a string).  In the value you can also specify the parameters inserted into the translation.  For this, the value must be an array, where the first element is the attribute to bind, and the rest are the parameter values. <br>  The variable lang has its own function-functions <i>get, set, load, unload, params</i> . <br><br>  <i>Use <b>get</b> :</i> <br><pre> <code class="javascript hljs">lang.get(strKey);</code> </pre>  Where: <br>  <i>strKey</i> is the key whose value you want to get. <br>  Returns the translation string associated with the passed key. <br><br>  <i>Using <b>set</b> :</i> <br><pre> <code class="javascript hljs">lang.set(strKey, strValue,boolSystem);</code> </pre>  Where: <br>  <i>strKey</i> - the key whose value is to be set; <br>  <i>strValue</i> is the value to set.  If it is empty or is not a string, then the corresponding key is deleted from the dictionary; <br>  <i>boolSystem</i> - if this parameter is set to <b>true</b> , then the entry occurs in the system dictionary, otherwise - in the user dictionary. <br>  Returns the recorded value or <b>null</b> if the key has been deleted. <br><br>  <i>Use <b>load</b> :</i> <br><pre> <code class="javascript hljs">lang.load(strName,objData);</code> </pre>  Where: <br>  <i>strName</i> - the name of the dictionary (string) or an object with a set of properties that represent the names of the dictionaries, and their meaning is the dictionaries themselves; <br>  <i>objData</i> - if the first argument is a string, then this argument is a dictionary. <br>  Returns the dictionary (s) that (e) was (s) loaded (s). <br><br>  <i>Using <b>unload</b> :</i> <br><pre> <code class="javascript hljs">lang.unload(strName);</code> </pre>  Where: <br>  <i>strName</i> - the name (string) or names (array) of dictionaries that should be unloaded. <br>  Grows uploaded dictionary (s). <br><br>  <i>Using <b>params</b> :</i> <br><pre> <code class="javascript hljs">lang. params(htmlElem,strKey,arrParams);</code> </pre>  Where: <br>  <i>htmlElem</i> - an item that has already been associated with a dictionary; <br>  <i>strKey</i> - dictionary access key; <br>  <i>arrParams</i> - an array of new parameters. <br>  Returns <b>true</b> if new parameters were set, or <b>false</b> otherwise. <br>  The example in the next chapter should bring clarity to the understanding of the interface. <br><br><h4>  Interaction with elements </h4><br>  In order to be able to interact with dictionaries, you need to bind a specific element or text node to a hash through one of the attribute of this element and the key of the dictionary.  This attribute can be both <i>innerHTML</i> , and <i>title, alt</i> , etc. If a text node is bound, then the default binding passes through <i>textContent</i> .  Below I will describe why. <br>  Consider an example: <br><pre> <code class="javascript hljs">lang(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.appendChild(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"button"</span></span>)),{<span class="hljs-string"><span class="hljs-string">"just_a_text"</span></span>:<span class="hljs-string"><span class="hljs-string">"innerHTML"</span></span> }); <span class="hljs-comment"><span class="hljs-comment">//      innerHTML   just_a_text</span></span></code> </pre>  The button is connected via a key that does not exist yet (therefore the text is "#just_a_text").  As for the technical implementation, the <i>_lang</i> property is created on the element, the properties of which are the hash keys, and the values ‚Äã‚Äãare the arrays, where the first elements are the attributes of this element, into which the hash values ‚Äã‚Äãwill be written, and the rest are the parameters passed to the translation. <br>  Now there are 3 options to write the key to the dictionary: add to the list of loaded dictionaries with a new dictionary or assign a value to the user or system dictionary.  Consider all the options in order of increasing priority (I would advise doing it line by line in the console): <br><pre> <code class="javascript hljs">lang.set(<span class="hljs-string"><span class="hljs-string">"just_a_text"</span></span>,<span class="hljs-string"><span class="hljs-string">"  "</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    lang.load("def",{"just_a_text":"   "}); lang.set("just_a_text","    ",1); //   </span></span></code> </pre>  The text on the button will change with each step to the one specified in the code.  Thus, in this case, all 3 types of dictionaries are used. <br>  Now we remove the keys from the dictionaries in the reverse order and make sure that the declared hierarchy really works: <br><pre> <code class="javascript hljs">lang.set(<span class="hljs-string"><span class="hljs-string">"just_a_text"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    lang.unload("def");//    def lang.set("just_a_text",""); //    </span></span></code> </pre>  Now the text on the button will again become "#just_a_text". <br><br><h4>  Options </h4><br>  Often I had to not only substitute the text from the dictionary, but also pass some parameters into it, so the possibility of parameter substitution is also implemented.  They can be specified when associating an element with a key, or after binding with the help of the lang.params function.  To indicate the position of a parameter within a line, the <i>/% \ d + /</i> construct is used, where digits indicate the number of the parameter being passed.  If the parameter was not passed, then an empty string is substituted. <br>  Especially good replacement manifests itself in conjunction with <i>innerHTML</i> : <br><pre> <code class="javascript hljs">lang(b=<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.appendChild(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"button"</span></span>)), {<span class="hljs-string"><span class="hljs-string">"pr1"</span></span>:<span class="hljs-string"><span class="hljs-string">"innerHTML"</span></span> }); lang.set(<span class="hljs-string"><span class="hljs-string">"pr1"</span></span>,<span class="hljs-string"><span class="hljs-string">" 1: &lt;b&gt;%1&lt;/b&gt;.  2: &lt;b&gt;%2&lt;/b&gt;. "</span></span>); lang.params(b,<span class="hljs-string"><span class="hljs-string">"pr1"</span></span>,[<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>]);</code> </pre>  Now inside the button, the passed parameters will be highlighted.  <a href="http://jsfiddle.net/pashak/XhFGN/1/">Link</a> <br><br><h4>  Performance </h4><br>  In order to distribute the load (I already wrote about this <a href="http://habrahabr.ru/blogs/client_side_optimization/137318">here</a> ), I use an interval function that processes the array of elements associated with the dictionary. <br>  Secondly, try to use as little as possible <i>innerHTML</i> on elements, instead use <i>textContent</i> on the text nodes of these elements.  <i>innerHTML</i> works <b>20+</b> times slower, because the setter of this attribute parses the passed value as HTML code.  <i>textContent</i> does not think about parsing HTML, but inserts text as it is (you can even &lt;,&gt; not change), but, unfortunately, this is not always applicable, in particular, in the last example. <br><br><h4>  Run under IE8 </h4><br>  A little thought, I realized that this thing can be run under the eighth IE.  To do this, you will have to resort to a pair of dirty hacks: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.isArray != <span class="hljs-string"><span class="hljs-string">'function'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.isArray = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.prototype.toString.call(value) === <span class="hljs-string"><span class="hljs-string">'[object Array]'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype.indexOf != <span class="hljs-string"><span class="hljs-string">'function'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.prototype.indexOf = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value, offset</span></span></span><span class="hljs-function">) </span></span>{ offset = <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(offset); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = offset &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? offset : <span class="hljs-number"><span class="hljs-number">0</span></span>, l = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.length; i &lt; l; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[i] === value) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; }; <span class="hljs-comment"><span class="hljs-comment">//        IE8 Text.prototype._lang = null; //    ,     if(typeof Element.prototype.compareDocumentPosition!="function") Text.prototype.compareDocumentPosition = Element.prototype.compareDocumentPosition = function compareDocumentPosition(node) { // Compare Position - MIT Licensed, John Resig function comparePosition(a, b) { return a.compareDocumentPosition ? a.compareDocumentPosition(b) : a.contains ? (a != b &amp;&amp; a.contains(b) &amp;&amp; 16) + (a != b &amp;&amp; b.contains(a) &amp;&amp; 8) + (a.sourceIndex &gt;= 0 &amp;&amp; b.sourceIndex &gt;= 0 ? (a.sourceIndex &lt; b.sourceIndex &amp;&amp; 4) + (a.sourceIndex &gt; b.sourceIndex &amp;&amp; 2) : 1) + 0 : 0; } return comparePosition(this,node); };</span></span></code> </pre><br>  Although in fact I believe that the IE line up to the eighth version inclusive should be buried for a long time.  Internets are belong to us. <br><br><h4>  Conclusion </h4><br>  When designing this thing, I tried to optimize it as much as possible, for example, minimized text changes inside the element.  If the value of the key has not changed, then it is not updated.  As a result, it turned out that changing the text inside 10,000 buttons takes (with profiling enabled, via <i>textContent</i> ) for about a second. <br><br>  There is a small minus: if you ‚Äúpull out‚Äù an element from the DOM, then the data on it can no longer be updated.  To solve the problem, you will have to re-associate it with the hash. <br><br>  In principle, this implementation can be used not only to change the page language.  Its main goal is to change the specified attributes when changing the dictionary.  Those.  the scope is much broader than that specified in the title. <br><br>  The implementation is probably not the most successful.  In the comments I am waiting for ratings and tips for improvement.  And please argue the cons.  Oh yes, MIT license. <br><br>  <b>UPD.</b>  An example can be found <a href="http://clip2net.unet.by/clip/m341/1329668404-t-41kb.html%3Fnocache%3D1">here</a> .  Just open the page when the internet is on. <br><br>  <b>UPD2.</b>  <a href="http://habrahabr.ru/users/lahmatiy/" class="user_link">Special</a> thanks to <a href="http://habrahabr.ru/users/lahmatiy/" class="user_link">lahmatiy</a> for the instructions on the true path and for pointing out the shortcomings. </div><p>Source: <a href="https://habr.com/ru/post/138492/">https://habr.com/ru/post/138492/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138485/index.html">ITSM, knowledge is power</a></li>
<li><a href="../138486/index.html">Algorithms in Bioinformatics Part 1</a></li>
<li><a href="../138487/index.html">Inter for 30 minutes scored 5k likes on Facebook</a></li>
<li><a href="../138489/index.html">Usability testing KidsReview.ru site - we are looking for volunteers</a></li>
<li><a href="../138490/index.html">Practical application of DNSSEC</a></li>
<li><a href="../138494/index.html">VLC reaches 2.0</a></li>
<li><a href="../138495/index.html">Ainol Novo 7 Paladin - MIPS-tablet on Android 4 ICS</a></li>
<li><a href="../138496/index.html">Life hacking in web development</a></li>
<li><a href="../138497/index.html">CyanogenMod asked for help - and raised money in 8 hours</a></li>
<li><a href="../138498/index.html">The developers explained why Chrome connects to three random domains at startup.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>