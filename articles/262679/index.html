<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Y" you do not "and" short! The Importance of Unicode Normalization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past six months, the Internet has simply flooded the "letter" "y." I met her on news sites, in instant messengers, on habrahabr and geektimes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Y" you do not "and" short! The Importance of Unicode Normalization</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/eb3/552/c89/eb3552c89a849ac897ffbce125661191.png" alt="th"><br><br>  Over the past six months, the Internet has simply flooded the "letter" "y."  I met her on news sites, in instant messengers, on habrahabr and geektimes.  "What is it all about?" - you ask - "I see the usual letter d!".  What a score.  I see her like this: <br><table><tbody><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/f1a/430/12c/f1a43012c17fe36b1fb1bf23d011fad1.png" alt="image"></td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/2ab/3a9/47a/2ab3a947ac8b4addb57c15da0e60f695.png" alt="image"></td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/4fe/617/936/4fe61793627f7cb28ec2c7a900dad0f4.png" alt="image"></td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/ffb/7f2/b5a/ffb7f2b5a5bad0c024990a4affedb713.png" alt="image"></td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/48a/e04/d2a/48ae04d2a96297ebac2d24699c1c4d00.png" alt="image"></td></tr></tbody></table>  If you are one of the lucky ones whose letter ‚Äúy‚Äù looks the same as ‚Äúreal‚Äù ‚Äúy‚Äù, here‚Äôs the trick: copy it (the letter ‚Äúy‚Äù) into a notebook, put the cursor at the end of the letter and press backspace.  Magic dump head just! <br>  How is that? <br><br><h3>  Graphemes, glyphs, code points, layout and bytes </h3>  Very brief introduction: <br>  Grapheme is what we used to call a letter in the sense of a unit of text.  A glyph is a unit of graphics, and can graphically represent the grapheme itself or a part of it (for example, various diacritical marks: stress, umlauts, a superscript colon for the letter e, etc.). <br>  Code Point - how the text is written in the Unicode view.  One grapheme can be recorded with different code points. <br>  Code Points are encoded by different byte representation depending on the standard: UTF-8, UTF-16, UTF-32, BE, LE ... <br>  Programming languages, as a rule, work with code points;  for us humans, it is habitual to think in glyphs. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's finally deal with our letter nd.  What is so special about her? <br>  This letter is one grapheme (‚Äúand‚Äù short), but it is recorded by two code points: <br><pre><code class="hljs">U+000438 CYRILLIC SMALL LETTER I U+000306 COMBINING BREVE</code> </pre> <br>  If you did the trick with pressing the backspace, you just erased COMBINING BREVE, or, speaking in print, the short icon over the vowel. <br><br>  The usual letter ‚Äúand‚Äù short, which we are all used to typing with the keyboard, is a composite character, which is recorded by one code point: <br><pre> <code class="hljs">U+000439 CYRILLIC SMALL LETTER SHORT I</code> </pre> <a name="habracut"></a><br>  The display of accents depends on the font and renderer.  For example, in the editing window of this post, the symbol looks right, but when viewing it goes.  Some fonts may display accented characters separately, even in composite characters. <br><br><h3>  What is bad? </h3>  Not all programs, but sites even more so, are able to lead code points to a form that allows you to compare identical glyphs recorded with different code points.  In other words, not every program and site recognizes ‚Äú¬ª ‚Äùand‚Äú  ‚Äùfor one character, which makes it impossible, for example, to search for such letters. <br><br>  There is no need to go far for an example: a relatively recent article <a href="http://geektimes.ru/company/mvideo/blog/251222/">with a review of the mouse on geektimes</a> , a screenshot of which is given above in the article.  Let's do a Google search for the following phrase, which, like, is in the article: <br><pre> <code class="hljs 1c"> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   ¬´¬ª </code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/156/a7a/927/156a7a927f28310e6bb4c16f44bef723.png" alt="image"><br><br>  The post is issued the second result, and, as can be seen from the bold part, we have a full text match.  Great, open it and try to find the same text on the page and see that Firefox did not find anything: <br><img src="https://habrastorage.org/getpro/habr/post_images/9ec/20b/e48/9ec20be4826552616455c7c6c02431c7.png" alt="image"><br><br>  Search in Geektimes also does not produce a suitable result: <br><img src="https://habrastorage.org/getpro/habr/post_images/857/6d5/ed5/8576d5ed5ee805a4fb19d804f7ad6c0f.png" alt="image"><br><br>  But it is worth replacing the composite ‚Äúd‚Äù with its decomposition counterpart ‚Äúd‚Äù, as everything falls into place: <br><img src="https://habrastorage.org/getpro/habr/post_images/c32/cf3/a5d/c32cf3a5d624372b8aecbd19e3904608.png" alt="image"><br><br>  Obviously, Google somehow translates the search query, allowing you to search by glyphs, not by their code points. <br>  How it works? <br><br><h3>  Normalization </h3>  The Unicode Normalization Standard describes two symbol equivalents: Canonical and Compatibility.  The first just allows you to compare the same glyphs with different code points, and the second allows you to compare them with simplified counterparts - ¬Ω with 1/2, c H, etc. <br><br>  There are also 4 types of normalization: <br><ul><li>  <b>Normalization Form D (NFD)</b> - canonical decomposition.  Spread cze≈õƒá (hello in Polish) to c, z, e, c + ¬¥, s + ¬¥. </li><li>  <b>Normalization Form C (NFC)</b> - collects what the previous version has laid out. </li><li>  <b>Normalization Form KD (NFKD)</b> - compatibility decomposition.  Make 1/2 of ¬Ω, 25 of 2‚Åµ. </li><li>  <b>Normalization Form KC (NFKC)</b> - will try to collect what the previous one has laid out. </li></ul><br>  If we talk about a site like habrakhabra, then it makes sense to NFC-normalize all posts before they are published, and subject the search query to NFKD processing. <br><br>  In Python, for example, this can be done with the unicodedata module. <div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  import sys <br>  import unicodedata <br>  print (unicodedata.normalize ('NFKD', sys.argv [1])) <br><br>  % python unicode.py cze≈õƒá |  hexdump -C <br>  00000000 63 7a 65 73 cc 81 63 cc 81 0a | czes..c ... | <br>  % echo 'cze≈õƒá' |  hexdump -C <br>  00000000 63 7a 65 c5 9b c4 87 0a | cze ..... | </div></div><br><h4>  Conclusion </h4>  I can not say with complete certainty who is to blame for the appearance of the "th" in runet, but the suspicion falls on Google Docs.  Fortunately, it seems that the bug was repaired, because  3 weeks I have not had to look at the crawl briefly. <br><br>  Problems with glyphs also happen offline.  Here is a picture of a real passport with a letter, probably ‚Äú‚Äù (CYRILLIC SMALL LETTER IE + COMBINING DIAERESIS) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f91/259/c1b/f91259c1bc9ecc515234be9973aa7bcc.png" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/262679/">https://habr.com/ru/post/262679/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262667/index.html">We generate the version number and build on the iOS application icon</a></li>
<li><a href="../262669/index.html">Voice of Reason: effectively combine Internet and telephony in the office</a></li>
<li><a href="../262671/index.html">Announcement of JavaScript library databoom</a></li>
<li><a href="../262673/index.html">Archives and history spiral</a></li>
<li><a href="../262675/index.html">Asterisk: Auto-informing the callee before connecting to the operator</a></li>
<li><a href="../262681/index.html">It's not about the number of lines of code. From serial developer modules</a></li>
<li><a href="../262683/index.html">Pros and Cons: Tier Assessment System</a></li>
<li><a href="../262685/index.html">Fault detection on the example of determining the surface of an autonomous machine</a></li>
<li><a href="../262687/index.html">Beeline automatically adds a toolbar and changes the design of sites.</a></li>
<li><a href="../262689/index.html">The most interesting materials about Visual Studio 2015</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>