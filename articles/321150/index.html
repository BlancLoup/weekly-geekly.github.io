<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Infecting the cache of the DNS servers of providers due to the manipulation of DNS responses from legitimate reputable DNS servers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A serious problem of modernity is the IS network threats, that is, classes of threats implemented using interworking protocols. One of these protocols...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Infecting the cache of the DNS servers of providers due to the manipulation of DNS responses from legitimate reputable DNS servers</h1><div class="post__text post__text-html js-mediator-article">  A serious problem of modernity is the IS network threats, that is, classes of threats implemented using interworking protocols.  One of these protocols is the Domain Name System Protocol - DNS. <br><br>  Threats that use the domain name system include threats based on modifying DNS transaction packets and aimed at creating a spurious route on the network.  Their potential danger lies in the possibility of intercepting data transmitted between clients of network services and servers of these services. <br><br>  It is rather difficult to track modification of DNS transaction packages, with a potentially high risk of implementing attacks in information systems, therefore such attacks as: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  network traffic analysis; </li><li>  substitution of a trusted network object; </li><li>  imposing a false route; </li><li>  the introduction of a false network object. </li></ul><br>  The topic of infecting the cache of the DNS servers of providers has long been crawled, however, using a practical example, we will show how simple it is to make clients of a particular Internet service provider ‚Äúgo‚Äù to the IP address we need, instead of the correct one, for a given domain without hacking anything and infecting trojans, thereby giving us full control over the traffic associated with a specific DNS zone. <br><a name="habracut"></a><br>  Imagine a fragment of the global Internet from client PC to a remote web service, as well as other network elements related to the domain name system <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/424/f30/337/424f30337cda43b68c1fdb2c7e21b434.jpg"></div><br>  A typical computer network that implements the substitution of an IP address for a target domain consists of the following elements: <br><br><ol><li>  Client PC (Client). </li><li>  Internet provider (consisting of: caching DNS server, gateway). </li><li>  Auxiliary client. </li><li>  Domain Name System. </li><li>  Monitoring point (firewall, filter, proxy server). </li><li>  Information service server. </li></ol><br>  For the successful implementation of our plan, it is necessary to fulfill a number of conditions: <br><br><ol><li>  There is a controlled DNS server that is responsible for any (any) zone of the domain name system. </li><li>  The client is served by an ISP with a caching DNS server, or another DNS server is known, whose services are used by the client, and this server is caching. </li><li>  At the time of receiving the DNS response from the monitored DNS server, there is no record in the cache of the DNS server of the ISP with the target DNS name of the information service node. </li><li>  At the monitoring point, there is a base of IP addresses and domain names of target information services, which are monitored and managed by the network interaction with the client. </li></ol><br>  To initiate the monitoring process, it is necessary to make a request to resolve the DNS name from the zone for which the monitored DNS server is responsible.  Due to this, it is possible to generate a DNS response to the received request with the specified parameters. <br><br>  According to the recommendations of RFC 1034, RFC 1035, which establish the order of operation, specification and use of the domain name system, the addition of so-called ‚ÄúAdditional‚Äù fields is allowed when generating a DNS response.  These fields are required to record the IP addresses of auxiliary nodes of various types, including to prevent repeated access to the DNS server in cases where, for certain reasons, the primary node whose record is transmitted in the ‚ÄúAnswer‚Äù field is unavailable.  <i>If the proposed approach is applied, the ‚ÄúAdditional‚Äù field records the IP address that corresponds to the domain name of the target information service, but actually belongs to the monitoring point - the firewall.</i> <br><br>  Such a task (adding the field we need) can be assigned to a script that simulates the operation of a legitimate DNS server responsible for any DNS zone, and no matter what level ... <br><br>  After the Internet service provider‚Äôs (ISP) caching DNS server receives a DNS response in the process of resolving a given DNS name, then if there are no entries in its cache with the corresponding entries from the additional DNS response fields, it places these entries in the cache memory.  Thus, records that match the domain names of the information services to be monitored and the IP addresses belonging to the monitoring point are placed in the DNS provider's DNS server cache.  From this point on, if the client generates a DNS request for resolving the host name of the target information service with a domain name stored in the provider's cache and stored from additional fields received after processing the DNS query of the "auxiliary" client, the Internet DNS server provider generates and sends a DNS response to the client based on data from its cache. <br><br>  Thus, the client obtains the resolution of the domain name of the requested information service with the IP address obtained from the monitored DNS server and stored by the Internet provider in the provider‚Äôs cache at the time the client‚Äôs request is processed.  The IP address does not belong to the target information service requested by the client, but to the monitoring point.  Accordingly, further, the client accesses the target information service on the IP address belonging to the monitoring point. <br><br>  When a client accesses a received IP address to a monitoring point, in which, based on the predefined parameters of the network security policy, a number of control actions are performed.  These actions include: <br><br><ol><li>  Analysis of the transaction received from the client. </li><li>  Development and application of control actions. </li><li>  Audit of received transactions and actions taken. </li><li>  Formation of a request for an information service based on the data of the received client transaction </li></ol><br>  At the monitoring point - ITU, network address translation (Network Address Translation - NAT) is performed, which makes it possible to ensure its ‚Äútransparent‚Äù operation from the point of view of the client and the target information service. <br><br>  The verification of the presented investigations was carried out using a test bench in the form of a computer network with the following elements: <br><br><ol><li>  DNS server based on the BIND 9.4 software, which is responsible for the zone ".a", with the domain name "ns.a". </li><li>  DNS server based on the BIND 9.4 software, which is responsible for the ".b" zone, with the domain name "ns.b". </li><li>  Client PC with IP Address 10.0.33.13. </li><li>  The monitoring point is a firewall with an IP address of 10.0.33.13. </li></ol><br>  Between all objects of a computer network network interaction is configured.  The principle of the computer network is as follows. <br><br>  Between DNS servers, zone transfer is configured in such a way that when receiving a request to resolve a domain name from a zone for which another DNS server is responsible, the current DNS server generates and sends a repeated DNS request to it and, having received a response from it, generates and sends a DNS response to the client that generated the first request, at the same time placing in its cache memory the response from the second DNS server.  Thus, the operation of the ISP's DNS server is simulated. <br><br>  At the 1st stage, the script ‚Äúfakedns‚Äù is launched on the DNS server responsible for the zone ‚Äú.b‚Äù, which implements the work of the DNS switch.  The task of the script is to process the received DNS request for the resolution of a domain name from the ".b" zone and add to the DNS response an additional "Additional" field for the specified domain name (in the example, "victim.com") corresponding to the target information service for which The client will monitor and manage the security of the network interaction with the client, and with the specified IP address (in the example, ‚Äú10.0.33.13‚Äù), the corresponding monitoring point ‚Äî the firewall.  Running the ‚Äúfakedns‚Äù script with the specified parameters, simulating the operation of the DNS switch, is carried out ** by the command ** <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/4c0/303/4d6/4c03034d604e4a76a0d6190dbe5aa79a.jpg"></div><br>  At the 2nd stage, a DNS query for the domain name ‚Äútest.b‚Äù is generated and transmitted from the client to the domain name system, consisting of the DNS server ‚Äúns.a‚Äù and the DNS server ‚Äúns.b‚Äù.  In this case, the primary DNS server (DNS server of the Internet provider) for the client is the DNS server ‚Äúns.a‚Äù. <br><br><h3>  Query structure </h3><br><img src="https://habrastorage.org/files/521/fbf/f01/521fbff013234405982508f6ee7d5fce.jpg"><br><br>  At the 3rd stage, a DNS response is generated and transmitted for the domain name ‚Äútest.b‚Äù with an additional field ‚ÄúAdditional‚Äù and the specified domain name ‚Äúvictim.com‚Äù, corresponding to the information service, which is assigned the specified IP address ‚Äú10.0.33.13 "Corresponding to the monitoring point. <br><br><h3>  DNS response packet structure </h3><br><img src="https://habrastorage.org/files/986/fa3/915/986fa39158bb4ad9a0b4a114bdd9243e.jpg"><br><br>  At the 4th stage, the DNS server ‚Äúns.a‚Äù of the domain name ‚Äúvictim.com‚Äù corresponding to the information service, but with the IP address corresponding to the monitoring point ‚Äú10.0.33.13‚Äù, is checked in the cache memory. <br><br>  Verification is done by the command <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/7ac/f20/320/7acf203205674e1a987e459af230a08e.jpg"></div><br>  At the 5th stage, a response is received about the presence in the cache memory of the DNS server ‚Äúns.a‚Äù of the domain name ‚Äúvictim.com‚Äù. <br><br><h3>  DNS response structure </h3><br><img src="https://habrastorage.org/files/c0e/b86/ee5/c0eb86ee549b4f2aaefb9c39b901d8be.jpg"><br><br>  Obviously, when the client continues to call the victim.com site by IP address from the received DNS response, the call will be made to the IP address specified in the parameters to the fakedns script and the corresponding monitoring point, the firewall. <br><br>  This fact is verified by the command <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ee4/d96/60a/ee4d9660a77147d9b70c29dfd1db8213.jpg"></div><br>  Based on the presented materials of the experiment, it can be concluded that, if the listed conditions are met and an additional field ‚ÄúAdditional‚Äù is added in the DNS switch, when processing a request for resolving the domain name of the target information service, it becomes possible to monitor the client‚Äôs network interaction with the specified information services depending on their location and computer network topology.  In addition, it becomes possible to monitor and control the client‚Äôs network interaction with specified information services both at the stage of establishing a connection session and at the stage of information exchange, which is not good ... </div><p>Source: <a href="https://habr.com/ru/post/321150/">https://habr.com/ru/post/321150/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321138/index.html">Voice standards</a></li>
<li><a href="../321140/index.html">Neural networks, genetic algorithms, etc. ... Myths and reality</a></li>
<li><a href="../321142/index.html">How to test online store communication channels before sales</a></li>
<li><a href="../321146/index.html">On the question of the history and the role of the personality in it (not according to Plekhanov)</a></li>
<li><a href="../321148/index.html">The story of the Russian A (AA) -indi gamedev on one example</a></li>
<li><a href="../321152/index.html">Enum-Almighty</a></li>
<li><a href="../321154/index.html">9 ridiculous ways to open a .sketch file. And one is nothing</a></li>
<li><a href="../321156/index.html">How the SAP HANA Platform Works with Big Data</a></li>
<li><a href="../321160/index.html">Trigger mailings for engagement: how to light a spark</a></li>
<li><a href="../321162/index.html">Static analyzers for Swift and Objective-C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>