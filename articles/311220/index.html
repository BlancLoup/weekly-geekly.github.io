<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Programming & Music: we understand and write VSTi synthesizer on C # WPF. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Being engaged in musical creativity, I often make arrangements and recordings on a computer - using a bunch of all sorts of VST plug-ins and instrumen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Programming & Music: we understand and write VSTi synthesizer on C # WPF. Part 1</h1><div class="post__text post__text-html js-mediator-article"><p>  Being engaged in musical creativity, I often make arrangements and recordings on a computer - using a bunch of all sorts of <a href="https://ru.wikipedia.org/wiki/Virtual_Studio_Technology">VST plug-ins and instruments</a> .  I am ashamed to admit - I never understood how the sounds in synthesizers are "wound".  Programming allowed me to write my own synthesizer, ‚Äúskip through‚Äù the process of creating sound. </p><br><p>  I am planning several articles in which I will step by step how to write my VST plug-in / instrument: programming an oscillator, a frequency filter, various effects, and modulation of parameters.  <strong>The emphasis will be placed on the practice</strong> , an explanation to the programmer in a simple language, how it all works.  The theory (harsh conclusions and evidence) will be bypassed (naturally, there will be references to articles and books). </p><br><p>  Typically, plug-ins are written in C ++ (cross-platform, the ability to effectively implement algorithms), but I decided to choose a more suitable language for me - C #;  focus on learning about the synthesizer itself, the algorithms, and not the technical details of programming.  To create a beautiful interface, I used WPF.  The ability to use the .NET architecture has made it possible to use the <a href="https://vstnet.codeplex.com/">VST</a> wrapper library <a href="https://vstnet.codeplex.com/">.</a>  <a href="https://vstnet.codeplex.com/">NET</a> . </p><br><p>  Below is a review video of <a href="https://github.com/lis355/Syntage">my simple synthesizer</a> , received interesting sounds. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6zAVMEtIb2w" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  There is a hard road ahead, if you are ready - welcome under cat. </p><br><a name="habracut"></a><br><h2 id="cikl-statey">  Cycle of articles </h2><br><ol><li>  We understand and write VSTi synthesizer on C # WPF </li><li>  <a href="https://habrahabr.ru/post/311750/">ADSR signal envelope</a> </li><li>  <a href="https://habrahabr.ru/post/313062/">Buttervo Frequency Filter</a> </li><li>  <a href="https://habrahabr.ru/post/313338/">Delay, Distortion and Parameter Modulation</a> </li></ol><br><h2 id="oglavlenie">  Table of contents </h2><br><ol><li>  <a href="https://habr.com/ru/post/311220/">Mysterious world of sound synthesis</a> </li><li>  <a href="https://habr.com/ru/post/311220/">Digital sound</a> </li><li>  <a href="https://habr.com/ru/post/311220/">VST SDK</a> </li><li>  <a href="https://habr.com/ru/post/311220/">WDL-OL and JUCE</a> </li><li>  <a href="https://habr.com/ru/post/311220/">VST .NET</a> </li><li>  <a href="https://habr.com/ru/post/311220/">My add-on VST .NET</a> </li><li>  <a href="https://habr.com/ru/post/311220/">WPF UI</a> </li><li>  <a href="https://habr.com/ru/post/311220/">UI thread</a> </li><li>  <a href="https://habr.com/ru/post/311220/">Syntage synthesizer architecture overview</a> </li><li>  <a href="https://habr.com/ru/post/311220/">Customize the project to create a plugin / tool</a> </li><li>  <a href="https://habr.com/ru/post/311220/">Debugging code</a> </li><li>  <a href="https://habr.com/ru/post/311220/">We write a simple oscillator</a> </li><li>  <a href="https://habr.com/ru/post/311220/">Bibliography</a> </li></ol><br><a name="Part1"></a><br><h2 id="zagadochnyy-mir-sinteza-zvuka">  Mysterious world of sound synthesis </h2><br><p>  I love music, I listen to different styles, I play various instruments, and, of course, I compose and record arrangements.  When I started using synthesizer emulators in recording programs (and even now) I always went through a bunch of presets, looking for the right sound. </p><br><p>  Going through the presets of one synthesizer, one can find both the ‚Äúexpected‚Äù sound of an electronic synthesizer from childhood (music from the cartoon <a href="https://www.youtube.com/watch%3Fv%3DZv5lIQPRCPY">Flying Ship</a> ) and imitation of drums, sounds, noise, even voices!  And all this makes one synthesizer, with the same parameter knobs.  It always surprised me, although I understood that each sound is the essence of the specific setting of all the knobs. </p><br><p>  Recently, I finally decided to finally figure out how the sound is created (or, more correctly, <em>synthesized</em> ), how and why you need to turn the knobs, how the signal changes (visually and by ear) from the effects.  And of course, learn (at least understand the basics) to "wind up" the sound yourself, copy the styles I like.  I decided to follow one quote: </p><br><blockquote>  <em>"Tell me - and I will forget, show me - and I will remember, let me do it - and I will understand."</em> <br>  <em>Confucius</em> </blockquote><p><br>  Of course, you don‚Äôt have to do everything (where so many bicycles?), But now I want to get knowledge and the most important thing is to share it with you. </p><br><p>  <strong>Objective</strong> : Without going into theory, create a simple synthesizer, focusing on explaining processes from a programming point of view, in practice. </p><br><p>  In the synthesizer will be: </p><br><ul><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B5%25D0%25BD%25D0%25B5%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580_%25D1%2581%25D0%25B8%25D0%25B3%25D0%25BD%25D0%25B0%25D0%25BB%25D0%25BE%25D0%25B2">wave generator (oscillator)</a> </li><li>  <a href="http://ru.wikipedia.org/wiki/ADSR-%25D0%25BE%25D0%25B3%25D0%25B8%25D0%25B1%25D0%25B0%25D1%258E%25D1%2589%25D0%25B0%25D1%258F">ADSR signal envelope</a> </li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B8%25D1%2584%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B9_%25D1%2584%25D0%25B8%25D0%25BB%25D1%258C%25D1%2582%25D1%2580">frequency filter</a> </li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D0%25BB%25D1%258D%25D0%25B9">echo / delay</a> </li><li>  parameter modulation </li></ul><br><p>  I plan to consider all components in several articles.  This program will consider the oscillator. </p><br><p>  We will program in C #;  UI can be written either on WPF, or on Windows Forms, or do without the graphical shell.  Plus the choice of WPF - beautiful graphics, which is fast enough to code, minus - only on Windows.  Owners of other OSs - do not be discouraged, after all, the goal is to understand the work of the synthesizer (and not sip a beautiful UI), especially the code that I will demonstrate can be quickly transferred, say, to C ++. </p><br><p>  In the chapters of the <a href="https://habr.com/ru/post/311220/">VST SDK</a> and <a href="https://habr.com/ru/post/311220/">WDL-OL and JUCE,</a> I will <a href="https://habr.com/ru/post/311220/">discuss the</a> concept of VST, its internal implementation;  about add-on libraries that are well suited for developing serious plugins.  In the chapter <a href="https://habr.com/ru/post/311220/">VST .NET</a> I will tell about this library, its minuses, my add-in, programming UI. </p><br><p>  Programming logic synthesizer begins with the head of <a href="https://habr.com/ru/post/311220/">writing a simple oscillator</a> .  If you are not interested in the technical aspects of writing VST plug-ins, you just want to read about the synthesis (and do not code anything) - you are welcome to this chapter right away. </p><br><p>  The source code for the synthesizer I wrote is available <a href="https://github.com/lis355/Syntage">on GitHub</a> . </p><br><a name="Part2"></a><br><h2 id="zvuk-v-cifrovom-vide">  Digital sound </h2><br><p>  In essence, our ultimate goal is the creation of <em>sound</em> on a computer.  <strong>Be sure to</strong> read (at least fluently) the <a href="https://habrahabr.ru/company/yandex/blog/270765/">article on Habr√© "Theory of Sound"</a> - it outlines the basic knowledge about the representation of sound on a computer, concepts and terms. </p><br><p>  Any audio file in a computer in an uncompressed format is an array of samples.  Any plug-in, ultimately, accepts and processes an array of seeds as input (depending on the accuracy, they will be float or double numbers, or you can work with integers).  Why did I say an array, not a single sample?  With this, I wanted to emphasize that the <em>sound is</em> processed <em>as a whole</em> : if you need to do an <a href="http://ru.wikipedia.org/wiki/%25D0%25AD%25D0%25BA%25D0%25B2%25D0%25B0%25D0%25BB%25D0%25B0%25D0%25B9%25D0%25B7%25D0%25B5%25D1%2580">equalization</a> , you cannot operate with one sample without information about the others. </p><br><p>  Although, of course, there are tasks for which it is not important to know what you are processing - they are considering a particular sample.  For example, the task is to raise the volume level 2 times.  We can work with each sample separately, and we do not need to know about the others. </p><br><p>  We will work with a sample as with a float number from -1 to 1. Usually, in order not to say ‚Äúthe value of the sample‚Äù, you can say ‚Äúamplitude‚Äù.  If the amplitude of some samples is greater than 1 or less than -1, <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BB%25D0%25B8%25D0%25BF%25D0%25BF%25D0%25B8%25D0%25BD%25D0%25B3_(%25D0%25B0%25D1%2583%25D0%25B4%25D0%25B8%25D0%25BE)">clipping</a> will occur, this should be avoided. </p><br><a name="Part3"></a><br><h2 id="vst-sdk">  VST SDK </h2><br><p>  <a href="https://ru.wikipedia.org/wiki/Virtual_Studio_Technology">VST (Virtual Studio Technology)</a> is a technology that allows you to write plug-ins for sound processing programs.  Now there are a large number of plug-ins that solve various problems: synthesizers, effects, sound analyzers, virtual instruments and so on. </p><br><p>  To create VST plug-ins, Steinberg (some of them know from Cubase) released the VST SDK written in C ++.  In addition to the technology (or, as they say, "plug-in format") VST, there are others - RTAS, AAX, <a href="https://en.wikipedia.org/wiki/Audio_plug-in">thousands of them</a> .  I chose VST, because of its greater fame, a large number of plug-ins and tools (although most of the known plug-ins come in different formats). </p><br><p>  At the moment, the current version of VST SDK 3.6.6, although many continue to use version 2.4.  Historically, it is difficult to find a <a href="http://en.wikipedia.org/wiki/Digital_audio_workstation">DAW</a> without support for version 2.4, and not all support version 3.0 and higher. </p><br><p>  VST SDK can be downloaded from the <a href="http://www.steinberg.net/en/company/developer.html">official site</a> . <br>  In the future, we will work with the VST.NET library, which is a wrapper for VST 2.4. </p><br><p>  If you intend to seriously develop plugins, and want to use the latest version of the SDK, then you can independently study the documentation and examples (everything can be downloaded from the <a href="http://www.steinberg.net/en/company/developers.html">official site</a> ). </p><br><p> Now I will summarize the principles of VST SDK 2.4, for a general understanding of the work of the plugin and its interaction with <a href="http://en.wikipedia.org/wiki/Digital_audio_workstation">DAW</a> . </p><br><p>  In Windows VST plugin version 2.4 is presented as a dynamic DLL library. <br>  We will call the host a program that loads our DLL.  Usually, this is either a music editing program ( <a href="http://en.wikipedia.org/wiki/Digital_audio_workstation">DAW</a> ) or a simple shell to run a plugin independently of other programs (for example, very often in virtual instruments with a .dll plugin an .exe file is supplied to load the plugin as a separate program - piano, synthesizer). </p><br><p>  Further functions, enumerations and structures can be found in the <a href="http://www.steinberg.net/en/company/developers.html">downloaded VST SDK</a> in the source code from the folder "VST3 SDK \ pluginterfaces \ vst2.x". </p><br><p>  The library should export the function with the following signature: </p><br><pre><code class="hljs lisp">EXPORT void* VSTPluginMain(<span class="hljs-name"><span class="hljs-name">audioMasterCallback</span></span> hostCallback)</code> </pre> <br><p>  The function accepts a pointer to a callback so that the plugin can receive the information it needs from the host. </p><br><pre> <code class="hljs pgsql">VstIntPtr (VSTCALLBACK *audioMasterCallback) (AEffect* effect, VstInt32 opcode, VstInt32 <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, VstIntPtr <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-type"><span class="hljs-type">void</span></span>* ptr, <span class="hljs-type"><span class="hljs-type">float</span></span> opt)</code> </pre> <br><p>  Everything is done at a fairly "low" level - in order for the host to understand what they want from it, you need to send the command number via the opcode parameter.  Enumeration of all opcodes hardcore C-encoders can be found in the listing AudioMasterOpcodesX.  The remaining parameters are used in the same way. </p><br><p>  VSTPluginMain should return a pointer to the AEffect structure, which, in essence, is our plugin: it contains information about the plugin and pointers to the functions that the host will call. </p><br><p>  Main fields of the AEffect structure: </p><br><ul><li>  Information about the plugin.  Name, version, number of parameters, number of programs and presets (read below), type of plug-in and so on. </li><li>  Functions for querying and setting parameter values. </li><li>  Functions change presets / programs. </li><li><p>  Sample array processing function </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (VSTCALLBACK *AEffectProcessProc) (AEffect* effect, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>** inputs, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>** outputs, VstInt32 sampleFrames)</code> </pre> <br><p>  float ** is an array of channels, each channel contains the same number of samples (the number of samples in the array depends on the sound driver and its settings).  Mainly plugins that handle mono and stereo. </p><br></li><li><p>  Super function, similar to audioMasterCallback. </p><br><pre> <code class="hljs pgsql">VstIntPtr (VSTCALLBACK *AEffectDispatcherProc) (AEffect* effect, VstInt32 opcode, VstInt32 <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, VstIntPtr <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-type"><span class="hljs-type">void</span></span>* ptr, <span class="hljs-type"><span class="hljs-type">float</span></span> opt)</code> </pre> <br><p>  Called by the host, the required action is determined by the opcode parameter (the AEffectOpcodes list).  It is used to find out additional information about the parameters, to inform the plugin about changes in the host (change of the frequency of discredit), to interact with the UI of the plugin. </p><br></li></ul><br><p>  When working with a plugin, it would be very convenient for the user to save all the configured knobs and switches.  And even steeper that was their automation!  For example, you may want to make the <a href="https://www.audioblocks.com/stock-audio/sci-fi-rise-and-and-vanish-sound-101335.html">famous effect of <em>rise up</em></a> - then you need to change the <a href="http://fierymusic.ru/rabota-so-zvukom/obrabotka-zvuka/chto-takoe-ekvalayzer">cutoff</a> parameter <a href="http://fierymusic.ru/rabota-so-zvukom/obrabotka-zvuka/chto-takoe-ekvalayzer">(cutoff frequency) of the</a> equalizer in time. </p><br><p>  In order for the host to control the parameters of your plugin, AEffect has corresponding functions: the host can query the total number of parameters, find out or set the value of a specific parameter, find out the name of the parameter, its description, and get the displayed value. </p><br><p>  The host doesn't care what the logic of the parameters in the plugin is.  The task of the host is to save, load, automate parameters.  It is very convenient for the host to take a parameter as a float number from 0 to 1 - let the plug-in be as it pleases, and interprets it that way (as most DAW did, unofficially). </p><br><p>  Presets (in terms of VST SDK - programs / programs) is a collection of specific values ‚Äã‚Äãof all parameters of a plugin.  The host can change / switch / select preset numbers, learn their names, similarly with parameters.  Banks - a collection of presets.  Banks logically exist only in DAW, in the VST SDK there are only presets and programs. </p><br><p>  Having understood the idea of ‚Äã‚Äãthe AEffect structure, you can sketch and compile a simple DLL plugin. <br>  And we will go further, one level higher. </p><br><a name="Part4"></a><br><h2 id="wdl-ol-i-juce">  WDL-OL and JUCE </h2><br><p>  What is bad development on bare VST SDK? </p><br><ul><li>  Write the whole routine from scratch yourself? .. Anyway, someone has already done it! </li><li>  Structures, callbacks ... but you want something more high-level </li><li>  I want cross-platform so that the code is one </li><li>  What about UI, which is easy to develop!? </li></ul><br><p>  <a href="https://github.com/olilarkin/wdl-ol">WDL-OL</a> enters the scene.  This is a C ++ library for creating cross-platform plugins.  Supported formats are VST, VST3, Audiounit, RTAS, AAX.  The convenience of the library is that (if the project is properly configured), you write one code, and when compiling you get your plugin in different formats. </p><br><p>  How to work with WDL-OL is well described in <a href="http://www.martin-finke.de/blog">Martin Finke's Blog "Music &amp; Programming"</a> , there are even <a href="https://habrahabr.ru/post/224911/">habr articles and translations into Russian</a> . </p><br><p>  WDL-OL solves at least the first three points of the development minuses on the VST SDK.  All you need is to set up the project correctly (the first article from the blog), and inherit from the IPlug class. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MySuperPuperPlugin</span></span> : <span class="hljs-title"><span class="hljs-title">public</span></span> <span class="hljs-title"><span class="hljs-title">IPlug</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">explicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyFirstPlugin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IPlugItanceInfo instanceInfo</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~MyFirstPlugin() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessDoubleReplacing</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">** inputs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">** outputs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nFrames</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span></span>; };</code> </pre> <br><p>  Now with a clear conscience, you can implement the function ProcessDoubleReplacing, which, in essence, is the "core" of the plugin.  All concerns took over the class IPlug.  If you study it, you can quickly understand that (in VST format) it is a wrapper around the AEffect structure.  Callbacks from the host and functions for the host have become convenient virtual functions with clear names and adequate lists of parameters. </p><br><p>  The WDL-OL already has the tools to build a UI.  But as for me, all this is done with great pain: the UI is assembled in code, all resources must be described in a .rc file, and so on. </p><br><p>  In addition to WDL-OL, I also learned about the <a href="http://www.juce.com/">JUCE</a> library.  JUCE is similar to WDL-OL, solves all declared minuses of development on the VST SDK.  In addition, it already has in its composition and UI-editor, and a bunch of classes for working with audio data.  I personally did not use it, so I advise you to read about it, <a href="http://en.wikipedia.org/wiki/JUCE">at least, on the wiki</a> . </p><br><p>  If you want to write a serious plugin, then I would have seriously thought about using the libraries WDL-OL or JUCE.  They will do the whole routine for you, and you still have all the power of the C ++ language to implement efficient algorithms and cross-platform - which is not unimportant in the world of a large number of DAWs. </p><br><a name="Part5"></a><br><h2 id="vst-net">  VST .NET </h2><br><p>  What did not please me WDL-OL and JUCE? </p><br><ol><li>  My task is to understand how the synthesizer is programmed, audio processing, effects, and not how to build a plugin for the maximum number of formats and platforms.  "Technical programming" here fades into the background (of course, this is not a reason to write bad code and not to use OOP). </li><li>  I am spoiled by the C # language.  Again, this language, unlike the same C ++, allows not to think about some <em>technical</em> issues. </li><li>  I like WPF technology in terms of its visual capabilities. </li></ol><br><p>  Library page - <a href="http://vstnet.codeplex.com/">vstnet.codeplex.com</a> , there are source codes, binaries, documentation.  As I understand it, the library is in the process of <del>  almost completed and scored </del>  frosts (some rarely used functions are not implemented, there are no repository changes for a couple of years). </p><br><p>  The library consists of three key assemblies: </p><br><ol><li>  Jacobi.Vst.Core.dll - contains interfaces defining host and plug-in behavior, auxiliary classes of audio, events, MIDI.  Most are wrappers for native structures, defines, and enumerations from the VST SDK. </li><li>  Jacobi.Vst.Framework.dll - contains the base classes of plug-ins that implement the interfaces from Jacobi.Vst.Core, which allow speeding up the development of plug-ins and not writing everything from scratch;  classes for higher-level interaction "host plugin", various managers of parameters and programs, MIDI messages, working with UI. </li><li>  Jacobi.Vst.Interop.dll - Managed C ++ wrapper over VST SDK, which allows you to connect a host with a loaded .NET assembly (your plugin). </li></ol><br><p>  How can a .NET assembly be made if the host expects a simple dynamic DLL?  And this is how: in fact, the host does not load your build, but the compiled DLL Jacobi.Vst.Interop, which already in turn loads your plugin as part of .NET. </p><br><p>  The following trick is used: let's say you are developing your plugin, and you get the .NET build of MyPlugin.dll.  You need to make the host download Jacobi.Vst.Interop.dll instead of your MyPlugin.dll, and it loads your plugin.  The question is, how does Jacobi.Vst.Interop.dll know where to ship your lib from?  There are a lot of solutions.  The developer chose to name the wrapper with the same name as your lib, and then search for the .NET assembly as "my_name.vstdll". </p><br><p>  It works like this. </p><br><ol><li>  You compiled and got MyPlugin.dll </li><li>  Rename MyPlugin.dll to MyPlugin.vstdll </li><li>  Copy next to Jacobi.Vst.Interop.dll </li><li>  Rename Jacobi.Vst.Interop.dll to MyPlugin.dll </li><li>  Now the host will load the MyPlugin.dll (i.e. Jacobi.Vst.Interop wrapper) and she, knowing that her name is "MyPlugin", will load your assembly MyPlugin.vstdll. </li></ol><br><p>  When loading your data, it is necessary that it has a class that implements the IVstPluginCommandStub interface: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IVstPluginCommandStub</span></span> : <span class="hljs-title"><span class="hljs-title">IVstPluginCommands24</span></span> { <span class="hljs-function"><span class="hljs-function">VstPluginInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPluginInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstHostCommandStub hostCmdStub</span></span></span><span class="hljs-function">)</span></span>; Configuration PluginConfiguration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  VstPluginInfo contains the base plug-in - version, unique plug-in ID, number of parameters and programs, number of channels processed.  PluginConfiguration is needed for the calling wrapper Jacobi.Vst.Interop. </p><br><p>  In turn, IVstPluginCommandStub implements the IVstPluginCommands24 interface, which contains the methods called by the host: processing the array (buffer) of samples, working with parameters, programs (presets), MIDI messages, and so on. </p><br><p>  Jacobi.Vst.Framework contains a ready-made convenient StdPluginCommandStub class that implements the IVstPluginCommandStub.  All you need to do is inherit from StdPluginCommandStub and implement the CreatePluginInstance () method, which will return an object (instance) of your plugin class that implements IVstPlugin. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PluginCommandStub</span></span> : <span class="hljs-title"><span class="hljs-title">StdPluginCommandStub</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IVstPlugin </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePluginInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyPluginController(); } }</code> </pre> <br><p>  Again, there is a ready-made convenient class VstPluginWithInterfaceManagerBase: </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VstPluginWithInterfaceManagerBase</span></span> : <span class="hljs-title"><span class="hljs-title">PluginInterfaceManagerBase</span></span>, <span class="hljs-title"><span class="hljs-title">IVstPlugin</span></span>, <span class="hljs-title"><span class="hljs-title">IExtensible</span></span>, <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VstPluginWithInterfaceManagerBase</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, VstProductInfo productInfo, VstPluginCategory category, VstPluginCapabilities capabilities, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> initialDelay, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pluginID</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> VstPluginCapabilities Capabilities { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> VstPluginCategory Category { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IVstHost Host { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> InitialDelay { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PluginID { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> VstProductInfo ProductInfo { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EventHandler Opened; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Open</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstHost host</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Resume</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Suspend</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> disposing</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnOpened</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> <br><p>  If you look at the source code of the library, you can see the interfaces that describe the components of the plug-in for working with audio, parameters, MIDI, etc.  : </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">IVstPluginAudioProcessor</span></span> IVstPluginParameters IVstPluginPrograms IVstHostAutomation IVstMidiProcessor</code> </pre> <br><p>  The VstPluginWithInterfaceManagerBase class contains virtual methods that return these interfaces: </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IVstPluginAudioPrecisionProcessor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateAudioPrecisionProcessor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstPluginAudioPrecisionProcessor instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IVstPluginAudioProcessor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateAudioProcessor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstPluginAudioProcessor instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IVstPluginBypass </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateBypass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstPluginBypass instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IVstPluginConnections </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateConnections</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstPluginConnections instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IVstPluginEditor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateEditor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstPluginEditor instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IVstMidiProcessor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateMidiProcessor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstMidiProcessor instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IVstPluginMidiPrograms </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateMidiPrograms</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstPluginMidiPrograms instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IVstPluginMidiSource </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateMidiSource</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstPluginMidiSource instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IVstPluginParameters </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateParameters</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstPluginParameters instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IVstPluginPersistence </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePersistence</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstPluginPersistence instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IVstPluginProcess </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateProcess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstPluginProcess instance</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> IVstPluginPrograms </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePrograms</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstPluginPrograms instance</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  These methods also need to be overloaded in order to implement your logic in custom component classes.  For example, you want to process samples, then you need to write a class that implements the IVstPluginAudioProcessor, and return it in the CreateAudioProcessor method. </p><br><pre> <code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyPlugin</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VstPluginWithInterfaceManagerBase</span></span></span><span class="hljs-class"> </span></span>{ ... protected <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> IVstPluginAudioProcessor CreateAudioProcessor(IVstPluginAudioProcessor instance) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyAudioProcessor(); } ... } ... public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyAudioProcessor</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VstPluginAudioProcessorBase</span></span></span><span class="hljs-class"> //      </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Process(VstAudioBuffer[] inChannels, VstAudioBuffer[] outChannels) { <span class="hljs-comment"><span class="hljs-comment">//   } }</span></span></code> </pre> <br><p>  Using various pre-built component classes, you can focus on programming the plug-in logic.  Although no one bothers you to implement everything yourself, as you want, based only on the interfaces from Jacobi.Vst.Core. </p><br><p>  For those who are already kodit - I offer you an example of just a plug-in, which lowers the volume by 6 dB (for this you need to multiply the sample by 0.5, why - read the <a href="https://habrahabr.ru/company/yandex/blog/270765/">article about the sound</a> ). </p><br><div class="spoiler">  <b class="spoiler_title">Just plugin example</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Jacobi.Vst.Core; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Jacobi.Vst.Framework; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Jacobi.Vst.Framework.Plugin; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Plugin</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PluginCommandStub</span></span> : <span class="hljs-title"><span class="hljs-title">StdPluginCommandStub</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IVstPlugin </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePluginInstance</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyPlugin(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyPlugin</span></span> : <span class="hljs-title"><span class="hljs-title">VstPluginWithInterfaceManagerBase</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyPlugin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"MyPlugin"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, new VstProductInfo(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"MyPlugin"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"My Company"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1000</span></span></span></span></span><span class="hljs-function">), VstPluginCategory.Effect, VstPluginCapabilities.None, 0, new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FourCharacterCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"TEST"</span></span></span></span></span><span class="hljs-function">).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToInt32</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>))</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IVstPluginAudioProcessor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateAudioProcessor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IVstPluginAudioProcessor instance</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AudioProcessor(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AudioProcessor</span></span> : <span class="hljs-title"><span class="hljs-title">VstPluginAudioProcessorBase</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AudioProcessor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">) </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//     { } public override void Process(VstAudioBuffer[] inChannels, VstAudioBuffer[] outChannels) { for (int i = 0; i &lt; inChannels.Length; ++i) { var inChannel = inChannels[i]; var outChannel = outChannels[i]; for (int j = 0; j &lt; inChannel.SampleCount; ++j) { outChannel[j] = 0.5f * inChannel[j]; } } } } }</span></span></span></span></code> </pre> </div></div><br><a name="Part6"></a><br><h2 id="moya-nadstroyka-nad-vst-net">  My add-on VST .NET </h2><br><p>  When programming a synth, I encountered some problems when using classes from Jacobi.Vst.Framework.  The main problem was the use of parameters and their automation. </p><br><p>  First, I didn‚Äôt like the implementation of value-changing events;  secondly, there were bugs when testing the plugin in FL Studio and Cubase.  FL Studio perceives all parameters as float numbers from 0 to 1, even without using a special function from the VST SDK with the opGode effGetParameterProperties (the function is called by the plugin to get additional information about the parameter).  In the WDL-OL, the implementation is commented out with the note: </p><br><blockquote>  <em>couldn‚Äôt implement aGetParameterProperties to group parameters</em> </blockquote><p><br>  Although, of course, this function is called in Cubase (Cubase is a product of Steinberg, which released the VST SDK). </p><br><p>  In VST .NET, this callback is implemented as a GetParameterProperties function that returns an object of the VstParameterProperties class.  Anyway, Cubase incorrectly perceived and automated my parameters. </p><br><p>  In the beginning, I made the edits to the library itself, wrote to the author, so that he would give permission to upload the source code to the repository, or create the repository on GitHub himself.  But I never received a clear answer, so I decided to make a superstructure over the library - <strong>Syntage.Framework.dll</strong> . </p><br><p>  In addition, the add-in implemented convenient classes for working with UI, if you want to use WPF. </p><br><p>  It's time to download the <a href="https://github.com/lis355/Syntage">source code of my synthesizer</a> and compile it. </p><br><div class="spoiler">  <b class="spoiler_title">Compiling code</b> <div class="spoiler_text"><ol><li>  Clone / download repository. </li><li>  Build a solution in Visual Studio in Debug. </li><li>  To run the synth from the studio, you need to use the project SimplyHost. </li><li>  Plugin files and dependent libraries will be in the "out \ vst \" folder: </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a76/3c7/f42/a763c7f42c8f4aaa9c3c46081993f482.png"></div></div></div><br><p>  The rules for using my add-in are simple: instead of StdPluginCommandStub, use SyntagePluginCommandStub, and inherit your plugin from SyntagePlugin. </p><br><a name="Part7"></a><br><h2 id="wpf-ui">  WPF UI </h2><br><p>  In the VST plugin does not have to be a graphical interface.  I have seen many plugins without UI (some of them are <a href="http://mda.smartelectronix.com/">mda</a> ).  Most DAWs (at least Cubase and FL Studio) will provide you with the ability to manage parameters from the UI they generate. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/947/ea3/120/947ea3120e4c487ab270f302776f7be0.png"></div><br><p>  <em>Auto-generated UI for my synthesizer in FL Studio</em> </p><br><p>  In order for your plugin to be with a UI, first, you must have a class that implements IVstPluginEditor;  secondly, you need to return its instance in the overloaded CreateEditor function of your plugin class (heir to SyntagePlugin). </p><br><p>  I wrote a PluginWpfUI &lt;T&gt; class that directly owns a WPF window.  Here T is the type of your UserControl, which is the "main form" of the UI.  PluginWpfUI &lt;T&gt; has 3 virtual methods that you can overload to implement your logic: </p><br><ul><li>  public virtual void Open (IntPtr hWnd) - called whenever the UI of the plugin is opened </li><li>  public virtual void Close () - called whenever the UI plug-in is closed </li><li>  public virtual void ProcessIdle () - called several times per second from a UI thread, to process custom logic (the basic implementation is empty) </li></ul><br><p>  In my Syntage synthesizer, I wrote a couple of controls - a slider, a knob, a piano keyboard - if you want, you can copy and use them. </p><br><a name="Part8"></a><br><h2 id="ui-potok-thread">  UI thread (thread) </h2><br><p>  I tested the synthesizer in FL Studio and Cubase 5 and I am sure that in other DAW it will be the same: the UI of the plug-in is processed by a separate stream.  This means that the audio and UI logic is processed in independent threads.  This entails all the problems, or the <em>consequences of</em> such an approach: access to data from different streams, critical data, access to the UI from another stream ... </p><br><p>  To facilitate problem solving, I wrote the UIThread class, which, in essence, is a command queue.  If at some point you want to inform / change / do something in the UI, and the current code does not work in the UI stream, then you can put the necessary function in the queue: </p><br><pre> <code class="hljs coffeescript">UIThread.Instance.InvokeUIAction(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> Control.Oscilloscope.Update());</code> </pre> <br><p>  Here an anonymous method is placed in the command queue, updating the necessary data.  When you call ProcessIdle, all the commands accumulated in the queue will be executed. </p><br><p>  UIThread does not solve all problems.  When programming the <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D1%2581%25D1%2586%25D0%25B8%25D0%25BB%25D0%25BB%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584">oscilloscope,</a> it was necessary to update the UI over an array of samples that were processed in another stream.  I had to use mutexes. </p><br><a name="Part9"></a><br><h2 id="obzor-arhitektury-sintezatora-syntage">  Syntage synthesizer architecture overview </h2><br><p>  When writing a synthesizer, OOP was actively used;  I suggest you get acquainted with the resulting architecture and use my code.  <em>You can do everything in your own way, but these articles will have to endure my vision)</em> </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b22/167/91b/b2216791bb8a4bf0b75f5e0ff898b887.png"></div><br><p>  The PluginCommandStub class is only needed to create and return an object of the PluginController class.  PluginController provides information about the plugin, it also creates and owns the following components: </p><br><ul><li>  AudioProcessor - a class with all the audio processing logic </li><li>  MidiListener - class for handling MIDI messages (from Syntage.Framework) </li><li>  PluginUI (heir to PluginWpfUI &lt;View&gt;) is the class that controls the synthesizer's GUI, the main form is the UserControl "View". </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5d3/1e8/06e/5d31e806efea40ff8935194cb2d0f1e7.png"></div><br><p>  To process audio data there are interfaces IAudioChannel and IAudioStream.  IAudioChannel provides direct access to the sample array / buffer (double [] Samples).  IAudioStream contains an array of channels. </p><br><p>  The presented interfaces contain convenient methods for processing all samples and channels "together": mixing channels and streams, applying the method to each sample separately, and so on. </p><br><p>  For interfaces IAudioChannel and IAudioStream implementations of AudioChannel and AudioStream are written.  Here it is important to remember the following thing: <strong>you cannot store links to the AudioStream and AudioChannel, if they are external data in a function</strong> .  The bottom line is that buffer sizes can change as the plugin goes on, buffers are constantly reused - it is not profitable to constantly re-allocate and copy memory.  If you need to save a buffer for future use. <del>  (I don‚Äôt know why) </del>  - copy it to your clipboard. </p><br><p>  The IAudioStreamProvider owns the audio streams, you can ask the CreateAudioStream function to create a stream and return the stream to remove it by the ReleaseAudioStream function. </p><br><p>  At any time, the length (length of the sample array) of all audio streams and channels is the same, technically it is determined by the host.  In the code, it can be obtained either from the IAudioChannel itself or the IAudioStream (the Length property), also from the ‚Äúhost‚Äù IAudioStreamProvider (the CurrentStreamLenght property). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/77f/be7/875/77fbe78751a84a7f8c47727de0770b7c.png"></div><br><p>  The AudioProcessor class is the "core" of the synthesizer - it is in this that the synthesis of sound occurs.  The class is a successor of SyntageAudioProcessor, which, in turn, implements the following interfaces: </p><br><ul><li>  VstPluginAudioProcessorBase - to process the sample buffer (Process method) </li><li>  IVstPluginBypass - to disable synthesizer logic if the plugin is in <a href="http://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B0%25D0%25B9%25D0%25BF%25D0%25B0%25D1%2581">Bypass</a> mode </li><li>  IAudioStreamProvider - to provide audio streams for generators </li></ul><br><p>  Sound synthesis goes through a long chain of processing: creating a simple wave in oscillators, mixing sound with different oscillators, sequential processing in effects.  The sound creation and processing logic was divided into component classes for the AudioProcessor.      SyntageAudioProcessorComponentWithParameters&lt;T&gt; ‚Äî    AudioProcessor    . <br><br>     : </p><br><ul><li> Input ‚Äî      (MIDI-    UI) </li><li> Oscillator ‚Äî <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B5%25D0%25BD%25D0%25B5%25D1%2580%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580_%25D1%2581%25D0%25B8%25D0%25B3%25D0%25BD%25D0%25B0%25D0%25BB%25D0%25BE%25D0%25B2"></a> </li><li> ADSR ‚Äî <a href="http://ru.wikipedia.org/wiki/ADSR-%25D0%25BE%25D0%25B3%25D0%25B8%25D0%25B1%25D0%25B0%25D1%258E%25D1%2589%25D0%25B0%25D1%258F"> </a> </li><li> ButterworthFilter ‚Äî <a href="http://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B8%25D1%2584%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B9_%25D1%2584%25D0%25B8%25D0%25BB%25D1%258C%25D1%2582%25D1%2580"> </a> </li><li> Distortion ‚Äî  <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D1%2581%25D1%2582%25D0%25BE%25D1%2580%25D1%2588%25D0%25BD"></a> </li><li> Delay ‚Äî  <a href="http://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D0%25BB%25D1%258D%25D0%25B9">/</a> </li><li> Clip ‚Äî      -1  1. </li><li> LFO ‚Äî   (       Low Frequency Oscillator ‚Äî   ) </li><li> Master ‚Äî - ( ) .       . </li><li> Oscillograph ‚Äî <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D1%2581%25D1%2586%25D0%25B8%25D0%25BB%25D0%25BB%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584"></a> </li><li> Routing ‚Äî        </li></ul><br><p>          Routing.Process    : </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/03b/914/8ff/03b9148ff42c4296a88ee09260dd7749.png"></div><br><p>        (  -   ).        .     ,     ,    ,   .      .      ,       LFO- (    ). </p><br><p>       Oscillator,        -. </p><br><p>   ,     Parameter&lt;T&gt;,   : EnumParameter, IntegerParameter, RealParameter  .   ,       Value  T,  float- RealValue ‚Äî      [0,1] (    UI  ). </p><br><a name="Part10"></a><br><h2 id="nastraivaem-proekt-dlya-sozdaniya-plaginainstrumenta">     / </h2><br><p>  Finally!     .    C#,    Visual Studio. <br>   .NET Class Library,     Jacobi.Vst.Core.dll  Jacobi.Vst.Framework.dll, Syntage.Framework.dll. </p><br><p>          (       <a href="https://habr.com/ru/post/311220/">VST .NET</a> ). </p><br><p>      (    <strong>Project ‚Üí Properties ‚Üí Build Events ‚Üí Post-build event command line</strong> ,     <strong>On successful build</strong> ): </p><br><pre> <code class="hljs ruby"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> exist <span class="hljs-string"><span class="hljs-string">"$(TargetDir)\vst\" mkdir "</span></span>$(TargetDir)\vst\<span class="hljs-string"><span class="hljs-string">" copy "</span></span>$(TargetDir)$(TargetFileName)<span class="hljs-string"><span class="hljs-string">" "</span></span>$(TargetDir)\vst\$(TargetName).net.vstdll<span class="hljs-string"><span class="hljs-string">" copy "</span></span>$(TargetDir)Syntage.Framework.dll<span class="hljs-string"><span class="hljs-string">" "</span></span>$(TargetDir)\vst\Syntage.Framework.dll<span class="hljs-string"><span class="hljs-string">" copy "</span></span>$(TargetDir)Jacobi.Vst.Interop.dll<span class="hljs-string"><span class="hljs-string">" "</span></span>$(TargetDir)\vst\$(TargetName).dll<span class="hljs-string"><span class="hljs-string">" copy "</span></span>$(TargetDir)Jacobi.Vst.Core.dll<span class="hljs-string"><span class="hljs-string">" "</span></span>$(TargetDir)\vst\Jacobi.Vst.Core.dll<span class="hljs-string"><span class="hljs-string">" copy "</span></span>$(TargetDir)Jacobi.Vst.Framework.dll<span class="hljs-string"><span class="hljs-string">" "</span></span>$(TargetDir)\vst\Jacobi.Vst.Framework.dll<span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre> <br><a name="Part11"></a><br><h2 id="otladka-koda">   </h2><br><p>     Syntage    SimplyHost.   ,        ".vstdll" (    .exe    ).         ‚Äî         . </p><br><p>         ,      .    ,    DAW: FL Studio 12  Cubase 5.   FL Studio  ,   Visual Studio    FL Studio ( <strong>Debug ‚Üí Attach To Process</strong> ).    ,    :  .dll       (   );      <strong></strong>     DAW. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/43f/34c/04e/43f34c04e2594efe84170e61ba109e5b.png"></div><br><a name="Part12"></a><br><h2 id="pishem-prostoy-oscillyator">    </h2><br><p>  ,     "   Syntage" ‚Äî        . </p><br><p>    ‚Äî    ( <em> , </em> )  .         .         -  ( ,  ). <a href="https://habrahabr.ru/post/196374/"> </a> ,             .    <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D0%25BC%25D0%25B1%25D1%2580"><em></em></a> ‚Äî  ,       ( <a href="https://en.wikipedia.org/wiki/Spectrum"></a> ). </p><br><p>     ‚Äî    ,          . </p><br><p>   "" ? , ,      ,   .     : </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/dcd/77e/254/dcd77e254b0c4a10ac5cbd9af7ed92a5.png"></div><br><p> <em>   : , , /, </em> . </p><br><p>   ,          . </p><br><p>      ,   ‚Äî ""  .    , ,    ,        ()  . </p><br><p>       :    . <br>       . ,        0  1.   ,       .       ,    ,     . </p><br><p>       WaveGenerator,   GetTableSample,              (      0  1). </p><br><p>       <a href="http://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B5%25D0%25BB%25D1%258B%25D0%25B9_%25D1%2588%25D1%2583%25D0%25BC"> </a> ‚Äî      .    ,         .  NextDouble   Random    ‚Äî  ,   ,        . ,     <em></em> ,   .         [0,1]        [-1,1]. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> EOscillatorType { Sine, Triangle, Square, Saw, Noise } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Random _random = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTableSample</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EOscillatorType oscillatorType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> t</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (oscillatorType) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EOscillatorType.Sine: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Math.Sin(DSPFunctions.Pi2 * t); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EOscillatorType.Triangle: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t &lt; <span class="hljs-number"><span class="hljs-number">0.25</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> * t; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t &lt; <span class="hljs-number"><span class="hljs-number">0.75</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">4</span></span> * t; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> * (t - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EOscillatorType.Square: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (t &lt; <span class="hljs-number"><span class="hljs-number">0.5f</span></span>) ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EOscillatorType.Saw: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> * t - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EOscillatorType.Noise: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _random.NextDouble() * <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentOutOfRangeException(); } } }</code> </pre> <br><p> ,   Oscillator,    SyntageAudioProcessorComponentWithParameters&lt;AudioProcessor&gt;.   <em></em> ,      IGenerator,    </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">IAudioStream </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>;</code> </pre> <br><p>    IAudioStreamProvider (     AudioProcessor) ,      Generate    . </p><br><p>        : </p><br><ul><li>   ‚Äî WaveGenerator.EOscillatorType,   EnumParameter  Syntage.Framework </li><li>   ‚Äî    20  20000 ,   FrequencyParameter  Syntage.Framework </li></ul><br><p>   : </p><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Oscillator : SyntageAudioProcessorComponentWithParameters&lt;AudioProcessor&gt;, IGenerator { private readonly IAudioStream _stream; // ,     private <span class="hljs-type"><span class="hljs-type">double</span></span> _time; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> EnumParameter&lt;WaveGenerator.EOscillatorType&gt; OscillatorType { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> RealParameter Frequency { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Oscillator(AudioProcessor audioProcessor) : base(audioProcessor) { _stream = Processor.CreateAudioStream(); //   } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> override IEnumerable&lt;Parameter&gt; CreateParameters(string parameterPrefix) { OscillatorType = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> EnumParameter&lt;WaveGenerator.EOscillatorType&gt;(parameterPrefix + "Osc", "Oscillator Type", "Osc", <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); Frequency = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FrequencyParameter(parameterPrefix + "Frq", "Oscillator Frequency", "Hz"); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Parameter&gt; { OscillatorType, Frequency }; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> IAudioStream Generate() { _stream.Clear(); //  ,    GenerateToneToStream(); //   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _stream; } }</code> </pre> <br><p>    GenerateToneToStream. </p><br><p>        ,      : </p><br><ul><li>    </li><li>   </li></ul><br><p>        ,    -   .    Generate()        (  ,     ) ‚Äî   "".   ,        ,    "".         .         . </p><br><p>      0  [  ]. </p><br><p>   ‚Äî    . ,          timeDelta = 1/SampleRate.    44100      ‚Äî 0.00002267573 . </p><br><p>    ,            ‚Äî   _time      timeDelta   . </p><br><p>    WaveGenerator.GetTableSample      0  1,  1 ‚Äî  .    ,      ‚Äî ,  . </p><br><p>               . </p><br><p> <b>:</b>       <a href="http://ru.wikipedia.org/wiki/%25D0%259B%25D1%258F_(%25D0%25BD%25D0%25BE%25D1%2582%25D0%25B0)">440 </a> .     : 1/440 = 0.00227272727 . <br>   44100 . <br>  44150- ,       . <br>  44150-   44150/44100 = 1.00113378685 . <br> ,     ‚Äî 1.00113378685/0.00227272727 = 440.498866743. <br>    ‚Äî 0.498866743.         WaveGenerator.GetTableSample. </p><br><p>    , : </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3aa/e1b/ebb/3aae1bebbf6a40a785cf8a6a0e0598d9.gif"></div><br><p>       WaveGenerator.GenerateNextSample     GenerateToneToStream. </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateNextSample</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EOscillatorType oscillatorType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> frequency, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> time</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ph = time * frequency; ph -= (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)ph; <span class="hljs-comment"><span class="hljs-comment">//  frac    return GetTableSample(oscillatorType, ph); } ... private void GenerateToneToStream() { var count = Processor.CurrentStreamLenght; //     double timeDelta = 1.0 / Processor.SampleRate; //       //    ,       var leftChannel = _stream.Channels[0]; var rightChannel = _stream.Channels[1]; for (int i = 0; i &lt; count; ++i) { // Frequency  OscillatorType    -     //    var frequency = DSPFunctions.GetNoteFrequency(Frequency.Value); var sample = WaveGenerator.GenerateNextSample(OscillatorType.Value, frequency, _time); leftChannel.Samples[i] = sample; rightChannel.Samples[i] = sample; _time += timeDelta; } }</span></span></code> </pre> <br><p> ,     : </p><br><ul><li>  Volume </li><li>  (Fine) ‚Äî         .   ,   <a href="http://ru.wikipedia.org/wiki/Wah-wah">wah-wah</a>    .      ,       . </li><li> / (Pan/Panning/Stereo)        . </li></ul><br><p>        ‚Äî     . </p><br><p>    AudioProcessor (        Generate)  PluginController ( AudioProcessor). <br>        Syntage.    AudioProcessor , : </p><br><ul><li>   </li><li>   (  CreateParameters) </li><li>        Generte   </li></ul><br><div class="spoiler"> <b class="spoiler_title">   ,  </b> <div class="spoiler_text"><pre> <code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PluginCommandStub</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SyntagePluginCommandStub</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PluginController</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> IVstPlugin CreatePluginInstance() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PluginController(); } } ... public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PluginController</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SyntagePlugin</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AudioProcessor AudioProcessor { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PluginController() : base( <span class="hljs-string"><span class="hljs-string">"MyPlugin"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VstProductInfo(<span class="hljs-string"><span class="hljs-string">"MyPlugin"</span></span>, <span class="hljs-string"><span class="hljs-string">"TestCompany"</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>), VstPluginCategory.Synth, VstPluginCapabilities.None, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FourCharacterCode(<span class="hljs-string"><span class="hljs-string">"TEST"</span></span>).ToInt32()) { AudioProcessor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AudioProcessor(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); ParametersManager.SetParameters(AudioProcessor.CreateParameters()); ParametersManager.CreateAndSetDefaultProgram(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> IVstPluginAudioProcessor CreateAudioProcessor(IVstPluginAudioProcessor instance) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> AudioProcessor; } } ... public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AudioProcessor</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SyntageAudioProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> readonly AudioStream _mainStream; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> readonly PluginController PluginController; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Oscillator Oscillator { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AudioProcessor(PluginController pluginController) : base(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   ,      ,    - { _mainStream = (AudioStream)CreateAudioStream(); PluginController = pluginController; Oscillator = new Oscillator(this); } public override IEnumerable&lt;Parameter&gt; CreateParameters() { var parameters = new List&lt;Parameter&gt;(); parameters.AddRange(Oscillator.CreateParameters("O")); return parameters; } public override void Process(VstAudioBuffer[] inChannels, VstAudioBuffer[] outChannels) { base.Process(inChannels, outChannels); //   var stream = Oscillator.Generate(); //   stream  _mainStream _mainStream.Mix(stream, 1, _mainStream, 0); //   _mainStream.WriteToVstOut(outChannels); } }</span></span></code> </pre> </div></div><br><p>        <a href="http://ru.wikipedia.org/wiki/ADSR-%25D0%25BE%25D0%25B3%25D0%25B8%25D0%25B1%25D0%25B0%25D1%258E%25D1%2589%25D0%25B0%25D1%258F">ADSR-</a> . </p><br><p>  <em>Good luck in programming!</em> </p><br><p> <b>PS</b>        ‚Äî    ,   <a href="https://lartsov.bandcamp.com/album/music"> </a> ,    <a href="https://lartsov.bandcamp.com/album/17"> diy-</a> . </p><br><a name="Part13"></a><br><h2 id="spisok-literatury">  Bibliography </h2><br><ol><li> <a href="https://habrahabr.ru/company/yandex/blog/270765/"> .</a>  <a href="https://habrahabr.ru/company/yandex/blog/270765/">What you need to know about the sound to work with it.</a> <a href="https://habrahabr.ru/company/yandex/blog/270765/"> ..</a> </li><li> -. . .      . </li><li>  .,  . ‚Äî   .  . </li><li> <a href="http://www.martin-finke.de/blog">Martin Finke's Blog "Music &amp; Programming"</a>          C++,   WDL-OL. </li><li> <a href="https://habrahabr.ru/post/224911/">- Martin Finke's Blog</a> </li><li> <a href="https://habrahabr.ru/post/236703/">  </a> ( -    ,      ). </li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/311220/">https://habr.com/ru/post/311220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311208/index.html">Microservices: please do not need</a></li>
<li><a href="../311210/index.html">Complex Data Visualization Algorithm</a></li>
<li><a href="../311212/index.html">Installation and optimal configuration of Nginx + LAMP (CentOS 7)</a></li>
<li><a href="../311214/index.html">When exceptions are needed</a></li>
<li><a href="../311218/index.html">How do we test the server code without mobile clients?</a></li>
<li><a href="../311224/index.html">The history of one study in log4net and its acceleration more than 10 times</a></li>
<li><a href="../311226/index.html">JSX: antipattern or not?</a></li>
<li><a href="../311230/index.html">Alexey Igoshin (HomeApp) changes the rules of the game on the Russian real estate market using information technology</a></li>
<li><a href="../311232/index.html">Using autoencoders to build a recommendation system</a></li>
<li><a href="../311234/index.html">learnopengl. Lesson 1.3 - Hello Window</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>