<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>InvoiceMall - SaaS billing service for studios and freelancers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! My name is Ignat. I‚Äôm an employee of CloudMill who developed the InvoiceMall customer relationship management service . This article is the fir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>InvoiceMall - SaaS billing service for studios and freelancers</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://www.invoicemall.ru/"><img align="left" src="http://cdn.cloudmill.ru/habr/logo_IM.png" alt="invoicemall"></a>  Hello!  My name is Ignat.  I‚Äôm an employee of CloudMill who developed the <a href="http://www.invoicemall.ru/">InvoiceMall</a> customer relationship management <a href="http://www.invoicemall.ru/">service</a> .  This article is the first in a series of materials that will tell about it.  In this article I will discuss the technical part of the project implementation, talk about the technologies used and the development process.  The following material will be devoted to using the service with invite keys. <a name="habracut"></a><br><br>  Initially, the service was created for the needs of our company.  Over time, we decided to expand its capabilities somewhat, using the most successful ideas that emerged as a result of the brainstorming and analysis of the work of competitors.  The development of the concept took about two months.  We have collected all the best and created a unique service that has ample opportunities. <br><br>  The basic functionality consisted of a billing service and a customer base.  As a result of hard work on the project, the following additional functions appeared: <br><ul><li>  customer management; </li><li>  project management; </li><li>  account management (various statuses and types of accounts); </li><li>  cost management; </li><li>  ticket system; </li><li>  archive of documents; </li><li>  statistics; </li><li>  the ability to accept payment to an internal account in the system through various payment instruments. </li></ul>  We are developing several additional sections that will make our service a full-fledged CRM system.  In addition, we are planning to introduce social services and multi-language functionality.  All the above functions will be connected as modules, depending on the preferences of our customers.  Thus, we will keep the simplicity of service for those of them who only want to create accounts in our SaaS project. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Other SaaS services in operation.</b> <br><br>  We have always been interested in how other teams work, so we'll talk a little about ourselves.  Initially, we used BaseCamp, but for some reason, we soon abandoned it.  After a long process of choosing from various project management / collaboration services, we switched to the following: <br><ul><li>  dropbox.com - File storage and backups; </li><li>  beanstalkapp.com - GIT &amp; SVN repositories; </li><li>  lighthouseapp.com - Ticket system. </li></ul>  <b>Iron and Hosting</b> <br><br>  For two years now we have been customers of The Planet.  At the moment we rent three servers: <br><ul><li>  2x Intel Xeon QC 2.0GHz, FreeBSD 8.0, MySQL 5.1.50, not accessible from outside, 12GB of RAM; </li><li>  2x Intel Xeon QC 2.0GHz, FreeBSD 8.0, memcached / MongoDB, not accessible from outside, 12GB of RAM; </li><li>  2x Intel Xeon QC 2.0GHz, FreeBSD 7.2, nginx 0.8.48, PHP 5.3.3 fastcgi (FPM). </li></ul>  This is quite enough for hosting our clients and for the functioning of our project.  We initially abandoned Clouds for several reasons: <br><ul><li>  First of all, this is awful SLA Amazon `a; </li><li>  secondly, the prices for using such resources will not be much lower. </li></ul>  However, we use S3 &amp; CloudFront (CDN) to store and distribute content.  We are now setting up the infrastructure at Hetzner, to transfer InvoiceMall to the site in Germany.  This will reduce the delay from 220ms to 70-80ms.  We are also considering options for using MDNS (Zerigo), for even faster response. <br><br>  <b>Security</b> <br><br>  We paid a lot of attention to project security.  For this, the framework has been reworked.  Now all incoming data is pre-filtered and cleaned, thus avoiding possible developer errors.  In addition, all data that goes into SQL queries is also cleared.  Our next step is to connect the CSRF protection to the forms. <br><br>  We really encrypt backup tables before sending them to the archive server once a day.  Software is constantly updated.  In addition, we conducted an internal server optimization.  Enabled ipfw and autobahn bots.  Constant monitoring of server load and network. <br><br>  Thanks to all this, we can sleep peacefully without waking up at three in the morning from angry calls complaining that the server is not responding.  We do not need to wrestle with how to climb on it and overcome the DDoS attack. <br><br>  <b>Soft</b> <br><br>  As it became clear, the service is written in PHP.  We use our own framework, the base for which was Kohana 3.0.  He was heavily rewritten.  It can start only in PHP&gt; 5.3, it definitely needs memcached and mysqli.  We also abandoned the Kohana `View model, connecting the H2O template engine, which, in turn, was subjected to strong correspondence.  Twig dropped, losing out on H2O performance.  ORM was also excluded, and sessions and authorization were rewritten with it.  The exception ORM - a necessary measure, because  All queries are profiled and optimized. <br><br>  All framework code is profiled.  We tried to optimize everything in our power to remove the repeated calls of functions, the passage of cycles, the transfer of content. <br><br>  As a result, we have reached the maximum page generation time of 0.007 seconds and 800kb memory costs when using APC and multi-level caching (tests were performed on the production service). <br><br>  When you deploy a new version, a script is launched that combines the framework into one file.  Logging and queues go to MongoDB, which allows us to safely scale the project.  At the moment we do not plan to switch to NoSQL. <br><br>  <b>A couple of words about architecture</b> <br><br>  After our decision to make the product public and analyze the capabilities of competitors, we began designing a service for hundreds of thousands of users.  Various fields, types of invoices, predefined installations, and more, depending on the selected country, were laid.  All text was removed from templates and scripts and rendered into language files that are always accessible from the cache.  Thus, the only thing required to add a new language is to add its language files, the system will connect it itself. <br><br>  <b>Features</b> <br><br><div style="text-align:center;"><img src="http://cdn.cloudmill.ru/habr/imlogin.jpg" alt="invoicemall authorization"></div>  Authorization with us is possible through Yahoo, Yandex, Google and Google Apps.  Soon we will connect FaceBook.  We do not use OpenID (the work logic is slightly different).  Authorization will only happen if you are already registered with this email. <br><br><img align="left" src="http://cdn.cloudmill.ru/habr/imimport.jpg" alt="invoicemall authorization">  Currently implemented import contacts through Google AuthSub.  You just need to click on the button, confirm the permission on the site and select those you need to add. <br><br>  Both classes (OpenID, oAuth) we have our own.  One Janrain connection added almost 0.3 s.  to execute and increased memory by 1mb.  Refactoring was pointless, so for each service, a wrapper was written.  The base class took OpenID from ZF. <br><br>  <b>HTML / JS</b> <br><br>  JS framework - the well-known jQuery, for the beta period, we do not optimize or compress CSS.  In the future, a script will be written that will flood CloudFront immediately with both the source code and the gzip version that has previously been optimized. <br><br>  The project implemented partial support for IE6.  For example, there are no rounded corners in it, but nothing floats and the scripts work as they should.  We also optimized javascript so that the download and all actions with the DOM take place without delay on all browsers.  In the future, we plan to complete the transition to HTML5 and the rejection of support for IE6. <br><br>  <b>API</b> <br><br>  We are currently working on an API.  Each function on the site will be available through the API.  It will be a simple and easy way to integrate.  For example, the use of our service in the operation of your store will allow you to issue beautiful invoices, maintain convenient statistics, make a marketing newsletter for customers and accept payment through various merchants.  We will try to limit the use of the API only your imagination. <br><br>  On this I will finish.  We will be happy to answer all your questions and provide interested persons for testing our product.  We ask you to treat with understanding the possible errors, but we believe that with your help we will be able to quickly, and most importantly in the right direction to complete the beta testing stage and with confident steps to come to the release. <br><br>  Sincerely, CloudMill Team. </div><p>Source: <a href="https://habr.com/ru/post/105024/">https://habr.com/ru/post/105024/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../105019/index.html">UN appoints representative for contact with aliens</a></li>
<li><a href="../105020/index.html">The battle with the "dark genius" or Microsoft-HTTPAPI / 2.0 strikes the first blow</a></li>
<li><a href="../105021/index.html">Java as a language for parallel computing. Installation, configuration, first program</a></li>
<li><a href="../105022/index.html">Redis 2.0</a></li>
<li><a href="../105023/index.html">The first Lenovo brand store opened in Moscow</a></li>
<li><a href="../105025/index.html">The principles of the poker bot. part 2</a></li>
<li><a href="../105026/index.html">Plugin for the Site Memory Button in WordPress</a></li>
<li><a href="../105028/index.html">160 byte Brainfuck interpreter</a></li>
<li><a href="../105029/index.html">DXCore - Free library for creating plugins in Visual Studio</a></li>
<li><a href="../105030/index.html">Welcome to the new era!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>