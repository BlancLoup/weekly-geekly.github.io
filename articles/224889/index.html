<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google maps clustering</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you are developing applications using Google Maps, then you may well encounter the situation shown in the picture on the left. And, if you think th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google maps clustering</h1><div class="post__text post__text-html js-mediator-article">  If you are developing applications using Google Maps, then you may well encounter the situation shown in the picture on the left.  And, if you think that the picture on the right looks better, then you are here. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d69/93c/2ca/d6993c2caa8910d7b10a57268b41a311.png" alt="image"><br><a name="habracut"></a><br>  So, what problems arise when working with a large number of markers: <br><ul><li>  With the number of markers&gt; 5000-10000, the card begins to severely slow down. </li><li>  The appearance of the map, filled with markers, does not please the eye at all. </li></ul><br>  What is the solution to this problem?  The answer is clustering.  <i>Cluster - the union of several homogeneous elements, which can be considered as an independent unit with certain properties.</i>  Accordingly, we must combine markers on a territorial basis and replace them with one marker.  And, fortunately, all this has already been implemented. <br><br>  In addition to the standard library for working with maps, Google provides a great library of Google Maps Android Marker Clustering Utility.  This library is supplied separately and allows you to assemble markers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider the most difficult example when you have several types of markers, each with its own icon and the necessary actions to click (for example, output InfoWindow with text). <br><div class="spoiler">  <b class="spoiler_title">Who is more interesting to read the documentation</b> <div class="spoiler_text">  <a href="https://developers.google.com/maps/articles/toomanymarkers%3Fhl%3Dru">developers.google.com/maps/articles/toomanymarkers?hl=en</a> <br>  <a href="https://developers.google.com/maps/documentation/android/utility/marker-clustering">developers.google.com/maps/documentation/android/utility/marker-clustering</a> <br>  <a href="https://github.com/googlemaps/android-maps-utils">github.com/googlemaps/android-maps-utils</a> <br></div></div><br><br><h5>  Task </h5><br>  Let the following task be set before us: a trading network is given, it has a certain number of points and a large number of trucks carrying goods that are able to report on their location.  It is necessary to establish monitoring of the position of trucks and outlets.  Truck markers should have a driver-face icon.  The customer is severe, he saw the picture with the clusters and said that everything was so and not otherwise. <br><br><h5>  Step 1. Preparation </h5><br>  The first step is very logical - you need to describe an abstract class of the marker, from which all the others will be inherited.  To be able to use clustering, this marker class must be able to return its location.  To do this, you must implement the <b>ClusterItem</b> interface.  Then the possible code of the abstract class: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMarker</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClusterItem</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> latitude; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> longitude; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> MarkerOptions marker; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> LatLng </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPosition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LatLng(latitude, longitude); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AbstractMarker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> latitude, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> longitude)</span></span></span><span class="hljs-function"> </span></span>{ setLatitude(latitude); setLongitude(longitude); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> MarkerOptions </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMarker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> marker; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setMarker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MarkerOptions marker)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.marker = marker; } <span class="hljs-comment"><span class="hljs-comment">//others getters &amp; setters }</span></span></code> </pre> <br><br>  Next is the not very important code of classes of markers of outlets and trucks, but suddenly someone is interested. <br><br><div class="spoiler">  <b class="spoiler_title">TradeMarker, TruckMarker</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TradeMarker</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMarker</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> BitmapDescriptor shopIcon = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String description; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TradeMarker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String description, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> latitude, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> longitude)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(latitude, longitude); setDescription(description); setBitmapDescriptor(); setMarker(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MarkerOptions() .position(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LatLng(getLatitude(), getLongitude())) .title(<span class="hljs-string"><span class="hljs-string">""</span></span>) .icon(shopIcon)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBitmapDescriptor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (shopIcon == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) shopIcon = BitmapDescriptorFactory. fromResource(R.drawable.trademarker); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Trade place: "</span></span> + getDescription(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDescription</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> description; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDescription</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String description)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.description = description; } }</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TruckMarker</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMarker</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String aim; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TruckMarker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, String aim, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> latitude, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> longitude, BitmapDescriptor photo)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(latitude, longitude); setName(name); setAim(aim); setMarker(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MarkerOptions() .position(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LatLng(getLatitude(), getLongitude())) .title(<span class="hljs-string"><span class="hljs-string">""</span></span>) .icon(photo)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Name: "</span></span> + getName() + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"Aim: "</span></span> + getAim(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAim</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aim; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAim</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String aim)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.aim = aim; } }</code> </pre><br></div></div><br><br><h5>  Step 2. The simplest clustering </h5><br>  Well, the preparation is completed, now it's time to set up clustering.  The most important thing here is the <b>ClusterManager</b> class, which allows you to flexibly customize clustering.  The ClusterManager class is generalized; the class that implements the ClusterItem interface is passed as a parameter.  As parameters during initialization, it is served with the application context and the GoogleMap object. <br><br>  Thus, for our code, it will look something like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ClusterManager&lt;AbstractMarker&gt; clusterManager; <span class="hljs-comment"><span class="hljs-comment">//... clusterManager = new ClusterManager&lt;AbstractMarker&gt;(this.getApplicationContext(), getMap());</span></span></code> </pre><br>  And now it remains only to add markers to this object using the <b>clusterManager.addItem</b> method <b>(AbstractMarker marker);</b>  . <br><br>  Using the <b>cluster</b> method of the ClusterManager class object, you can call reclustering (for example, after adding elements).  To automatically call this method when the camera position changes (when the approximation changes), you must assign an <b>OnCameraChangeListener</b> handler to the map. <br><br><pre> <code class="java hljs">map.setOnCameraChangeListener(clusterManager);</code> </pre><br><br>  Well, now our map is almost beautiful.  Why almost?  Because instead of the photos of drivers, you will see only the default markers, <s>it is possible that this would be better</s> , and nothing will happen when you click on the marker, even if you wrote the InfoWindowAdapter.  Now we will improve the appearance, using the means provided. <br><br><h5>  Step 3. Algorithm </h5><br>  Consider the clustering algorithms.  There are various algorithms, we can distinguish 2 main ones: <br><br>  <b>Grid-based clustering</b> - the visible area of ‚Äã‚Äãthe map is divided into squares; one cluster is placed in the center of the square. <br><ul><li>  Supports removal of items. </li><li>  It works quite quickly. </li><li>  It does not look very nice, but if the markers are evenly distributed, then there is nothing wrong with this algorithm. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/42a/e5f/eb6/42ae5feb6650f1501a879cd4b7c3dd92.png"><br><br>  <b>Distance-based clustering</b> is the default algorithm.  Based on the calculation of the centers of the highest concentration of markers;  Clusters do not have fixed boundaries. <br><ul><li>  Does not support deleting items. </li><li>  It works slower (more complex calculations). </li><li>  Beautifully arranged markers in accordance with the position on the map. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e22/23b/5a1/e2223b5a1ba87260cd9bb756b59058b3.png"><br><br>  I hope Google will not be offended at me for the pictures taken from the documentation. <br><br>  It is unlikely that there will be a significant need to write your own algorithm, but if you really want to, then you will have to implement the <b>Algorithm</b> interface. <br><br><h5>  Step 4. Modifying the properties of the clusterManager object </h5><br>  As I said, the photos of our drivers have changed to standard markers.  Not order.  Fortunately, this is easy to fix (and not only that).  The clusterManager object has a <b>setRenderer</b> method that allows you to set a class that will manage clusters / markers before mapping and more.  By default, the <b>DefaultClusterRenderer</b> class is used, in which many of the chips are already implemented correctly.  Therefore, the best approach would be to inherit from this class and override the necessary methods: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OwnIconRendered</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultClusterRenderer</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMarker</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OwnIconRendered</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, GoogleMap map, ClusterManager&lt;AbstractMarker&gt; clusterManager)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, map, clusterManager); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBeforeClusterItemRendered</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AbstractMarker item, MarkerOptions markerOptions)</span></span></span><span class="hljs-function"> </span></span>{ markerOptions.icon(item.getMarker().getIcon()); } }</code> </pre><br>  And assign this class to our clusterManager: <br><br><pre> <code class="java hljs">clusterManager.setRenderer(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OwnIconRendered( getApplicationContext(), getMap(), clusterManager));</code> </pre><br><br>  I only need to change the icon for the markers, so I only redefined the <b>onBeforeClusterItemRendered</b> method, which allows you to configure cluster elements before outputting to the map.  But the choice of methods for redefining is large enough: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9fe/2c7/591/9fe2c75918fb13f6ef0f912282866801.png"><br><br>  Just as a separate fact, in the clustering process, an important role is played by the <b>MarkerManager</b> class, which essentially provides an interface for working with a collection of markers and clusters. <br><br>  And let's make the final touch: by clicking on the marker, we will standardly display information about the current marker using the toString method (we redefine it), and by clicking on the cluster we will display how many outlets and trucks are in this region. <br>  First, we need the objects of the selected marker and cluster: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AbstractMarker chosenMarker; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Cluster&lt;AbstractMarker&gt; chosenCluster;</code> </pre><br><br>  You must add listeners to the clusterManager: <br><br><pre> <code class="java hljs">clusterManager.setOnClusterItemClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClusterManager.OnClusterItemClickListener&lt;AbstractMarker&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClusterItemClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AbstractMarker item)</span></span></span><span class="hljs-function"> </span></span>{ chosenMarker = item; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }); clusterManager.setOnClusterClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClusterManager.OnClusterClickListener&lt;AbstractMarker&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClusterClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Cluster&lt;AbstractMarker&gt; cluster)</span></span></span><span class="hljs-function"> </span></span>{ chosenCluster = cluster; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } });</code> </pre><br><br>  You also need to make the clusterManager listener for the OnMarkerClickListener event: <br><br><pre> <code class="java hljs">map.setOnMarkerClickListener(clusterManager);</code> </pre><br><br>  Now you need to assign the InfoWindowAdapter to all markers and all clusters.  To do this, you can use the methods of obtaining collections of clusters of markers with the object clusterManager.  Also, do not forget to assign InfoWindowAdapter to the map: <br><pre> <code class="java hljs">clusterManager.getMarkerCollection().setOnInfoWindowAdapter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MarkerInfoWindowAdapter()); clusterManager.getClusterMarkerCollection().setOnInfoWindowAdapter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClusterInfoWindow()); map.setInfoWindowAdapter(clusterManager.getMarkerManager());</code> </pre><br><br>  Well, for an example, the class ClusterInfoWindow might look like: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClusterInfoWindow</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InfoWindowAdapter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInfoContents</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Marker arg0)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInfoWindow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Marker marker)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (chosenCluster != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { View v = getLayoutInflater().inflate(R.layout.cluster_window, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); TextView info = (TextView) v.findViewById(R.id.clusterTitle); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] markerTypesCount = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>]; Arrays.fill(markerTypesCount, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (AbstractMarker abstractMarker : chosenCluster.getItems()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (abstractMarker <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> TradeMarker) markerTypesCount[<span class="hljs-number"><span class="hljs-number">0</span></span>] += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (abstractMarker <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> TruckMarker) markerTypesCount[<span class="hljs-number"><span class="hljs-number">1</span></span>] += <span class="hljs-number"><span class="hljs-number">1</span></span>; } info.setText(<span class="hljs-string"><span class="hljs-string">"Trade places: "</span></span> + markerTypesCount[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">"\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"Truck: "</span></span> + markerTypesCount[<span class="hljs-number"><span class="hljs-number">1</span></span>] + <span class="hljs-string"><span class="hljs-string">"\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre><br><br>  Thus, we have created a beautiful and quite functional map. <br><br>  I hope this article was helpful to you.  It is only the result of studying the library and personal research, so I will not leave links to resources.  Thank you for reading to the end! <br><br>  PS Join the world's largest <a href="http://alexnab.github.io/android-united/">community of Android developers</a> in Slack. </div><p>Source: <a href="https://habr.com/ru/post/224889/">https://habr.com/ru/post/224889/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224869/index.html">The future of Ethernet & FC</a></li>
<li><a href="../224871/index.html">The electronic cigarette will count every puff</a></li>
<li><a href="../224875/index.html">Feature # 2 - Podcast on entrepreneurs and current trends in the IT ecosystem</a></li>
<li><a href="../224879/index.html">Anemic Domain Model [Translation]</a></li>
<li><a href="../224883/index.html">Kerio Control for Windows to Kerio Control Appliance Migration Guide</a></li>
<li><a href="../224891/index.html">(May 25, Kiev) Fighters of the invisible front or the story of how to protect themselves from DDoS-attacks in a short time using Radware</a></li>
<li><a href="../224895/index.html">The main international standards and best practices for auditing information technology</a></li>
<li><a href="../224897/index.html">WebRTC or how I taught our CRM to call phones</a></li>
<li><a href="../224901/index.html">Automatic downloading of the list of prohibited sites from the Roskomnadzor service</a></li>
<li><a href="../224903/index.html">5 mistakes made when starting a startup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>