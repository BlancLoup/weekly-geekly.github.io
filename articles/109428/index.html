<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hg Init: Part 6. Repository Architecture</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the sixth, final part of the Hg Init Series : A Mercurial Study Guide by Joel Spolsky . Previous parts: 


- "Retraining for Subversion Users"...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hg Init: Part 6. Repository Architecture</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/eebea7f1/5482efc4/01467053/55589e0f.png" align="left">  This is the sixth, final part of the <b>Hg Init</b> Series <b>: A Mercurial Study Guide by</b> <a href="http://www.joelonsoftware.com/">Joel Spolsky</a> .  Previous parts: <br><ul><li>  <a href="http://habrahabr.ru/blogs/development_tools/108443/">"Retraining for Subversion Users"</a> </li><li>  <a href="http://habrahabr.ru/blogs/development_tools/108658/">"The Basics of Mercurial"</a> </li><li>  <a href="http://habrahabr.ru/blogs/development_tools/108904/">‚ÄúWe get used to working in a team‚Äù</a> </li><li>  <a href="http://habrahabr.ru/blogs/development_tools/109074/">‚ÄúCorrecting mistakes‚Äù</a> </li><li>  <a href="http://habrahabr.ru/blogs/development_tools/109203/">"The merger process"</a> </li></ul><br><br><img src="https://habrastorage.org/storage/80a00e0e/f27de307/ccce4ca3/7532006e.png" align="left"><br>  Mercurial allows very flexible configuration of repositories.  Plus, since merges work fine and you can rely on them, you can have specific service repositories in accordance with the requirements of the development process in your team. <br><br><h4>  Part 6. Repository Architecture </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Our recipe is getting better: <br><br><a name="habracut"></a><br><br><img src="https://habrastorage.org/storage/d68f2d22/b07c1108/357e69d3/6be4c263.png"><br><br>  Let's look closely at the change set number: <br><br><img src="https://habrastorage.org/storage/b80f7a57/03613f2d/fb95fcea/bb2f8430.png"><br><br>  The first part of the number, 13, is short and comfortable.  The problem is that ... you can not rely on it! <br><br>  With the independent work of team members and the implementation of mergers, these short numbers can start to differ from different team members: <br><br><img src="https://habrastorage.org/storage/a35d59b3/1ed965ee/64cf690c/4e903cb9.png"><br><br>  So in practice, I cannot say: ‚ÄúWell, let's release a version compiled from 13 sets of changes,‚Äù because employees may have different ideas about what is the 13th set.  That is why there is also that crazy hex number. <br><br><img src="https://habrastorage.org/storage/75357326/1bf027db/eb83d6fb/73144a39.png"><br><br>  This hexadecimal number <i>is unique</i> in all repositories and never changes. <br><br>  So I can tell people: ‚ÄúHey, today is the release!  1b03ab783b17th set of changes! ".  Agree, it would be nice to be able to give this set a <i>name</i> ? <br><br>  Well, you have this opportunity.  This name is called a tag (or tag, from the English. Tag). <br><br><img src="https://habrastorage.org/storage/29f99fca/dad78d02/617c7ae2/e1015e41.png"><br><br>  Let's take a look at the log now: <br><br><img src="https://habrastorage.org/storage/e3f5ceba/7ef7ce12/9230375b/fdac5b68.png"><br><br>  Note that adding a tag to a change set itself is a change set.  This changeset is automatically recorded in the repository (committed).  So now every time I want to refer to the version of the code that we released, I can use <b>Version-1.0</b> instead of <b>1b03ab783b17</b> . <br><br>  The deputy director descended from the 31st floor in order to participate in an office party for the release of a new version and brought a box of fairly expensive-looking sparkling wine.  Stan got a little drunk.  Well, not that little.  Actually, it was something unheard of.  Stan took off his shirt and, showing everyone his muscles and a solid belly, tried to impress the ladies from the marketing department.  He boasted: ‚ÄúI will catch up on the lamps‚Äù (in our office we use long fluorescent lamps).  In general, he jumped, grabbed the lamp and, of course, tore it along with the lamps and ceiling tiles.  It is not surprising, because the lamp weighing about 4.5 kilograms hung on a <a href="">pair of wires</a> , and Stan's weight is just in the same popular range of 130-135 kilograms.  Everywhere was broken glass and pieces of soundproof tiles.  Stan fell right on the tailbone and began to complain that he would sue the company for unsafe working conditions. <br><br>  The rest are back to work to work on Guac 2.0. <br><br><img src="https://habrastorage.org/storage/c9f4e36c/0637f3bf/d472f6a8/c1d4fdea.png"><br><br>  Commit: <br><br><img src="https://habrastorage.org/storage/0031b86c/94b2ba74/1baa1291/493613a4.png"><br><br>  Needless to say, this recipe is still questionable.  It was not tested, for example.  And then the customer calls. <br><br>  ‚ÄúIt‚Äôs too salty!‚Äù The customer whines.  And no, he does not want to wait for the release of version 2.0 with the correction of the error. <br><br>  Fortunately, we have that tag.  I can use <code>hg up</code> to go to any version in the repository. <br><br><img src="https://habrastorage.org/storage/633fedc2/cc2c66c1/cb5d3c8f/42cbc002.png"><br><br>  Now I can fix this stupid problem with salt: <br><br><img src="https://habrastorage.org/storage/6a67553e/093ccf44/d290f910/6956c6f1.png"><br><br>  Then: <br><br><img src="https://habrastorage.org/storage/efe56ec9/58727a58/94a0e492/e56d5553.png"><br><br>  Mercurial reminds me that my actions created a new head.  Now there are two heads in the repository: version 2.0, which I recently worked on, and the version that I just committed. <br><br><img src="https://habrastorage.org/storage/461735ea/624be09a/a8b26521/af885f2f.png"><br><br>  At the moment I can give the version with the latest changes to the client, mark it as 1.1, and continue to work with version 2.0. <br><br><img src="https://habrastorage.org/storage/71bc196d/41345306/1ef4d16e/9ab05419.png"><br><br>  But there is one problem ... fixes about salt are missing in version 2.0.  How do i fix this? <br><br><img src="https://habrastorage.org/storage/45277523/d4534deb/e6e778b4/f3665feb.png"><br><br><img src="https://habrastorage.org/storage/72edbdf4/50bd8cdd/e08640a9/32196428.png"><br><br>  Here you go.  I have to do tag merging.  This is a known bug in Mercurial.  The problem is that tags in Mercurial are simply a file called .hgtags, for which version control is also being conducted.  Therefore, from time to time you need to manually merge different versions of the .hgtags file.  In such a situation, your actions are simple ... you should always save BOTH versions of each line in the file. <br><br><img src="https://habrastorage.org/storage/1aa9272a/8bcae15c/b09cb4ec/5242aae8.png"><br><br>  The above simple way to switch to the old, labeled version is good if you only need to make one small unplanned change in the released code.  But the truth is that in most software projects such situations occur all the time, and Mercurial has a more reliable way to deal with them. <br><br>  So I‚Äôll cancel all changes made after 1.0, return the repository to the state it had at release 1.0, and then I can show you a fashionable reliable way to fix the bugs of existing clients and work on the new version in parallel. <br><br><img src="https://habrastorage.org/storage/920e88ad/36225520/5db9dd52/ddf8aa7a.png"><br><br>  The idea is that instead of working with one repository, we will create two repositories.  One repository is called <b>stable</b> , and the second is <b>dev</b> . <br><br>  The <b>stable</b> major version of the code sent to the clients is stored in the <b>stable</b> repository.  Every time you urgently need to fix a bug, you do this in <b>stable</b> .  In our example, all patches for version 1.0 will fall into <b>stable</b> . <br><br>  The <b>dev</b> repository is where the next major version is being developed, that is, version 2.0. <br><br>  As soon as version 1.0 was released, I clone <b>stable</b> to <b>dev</b> : <br><br><img src="https://habrastorage.org/storage/874eef22/a1545d93/a0232e75/95342a96.png"><br><br>  Now I have two identical repositories: <br><br><img src="https://habrastorage.org/storage/6a6b8010/f84d4b0a/78f25f9a/49c5c0bc.png"><br><br>  Since the story in both repositories is the same until the 14th set of changes inclusive, Mercurial will use the ‚Äú <a href="http://ru.wikipedia.org/wiki/%25D0%2596%25D1%2591%25D1%2581%25D1%2582%25D0%25BA%25D0%25B0%25D1%258F_%25D1%2581%25D1%2581%25D1%258B%25D0%25BB%25D0%25BA%25D0%25B0">hard links</a> ‚Äù instead of making two copies on the disk.  Therefore, the <code>hg clone</code> operation is performed quickly and cheaply, which means you can do many, many repository clones without hesitation. <br><br>  Now let's start working on guac in the <b>dev</b> repository: <br><br><img src="https://habrastorage.org/storage/905ffd18/8d990fe0/40ba5e86/0f957768.png"><br><br>  And fix that salt problem in the <b>stable</b> repository: <br><br><img src="https://habrastorage.org/storage/93b7491a/01cd83a3/2f852c5c/aea3d2a8.png"><br><br>  I will mark this version and release it as 1.1: <br><br><img src="https://habrastorage.org/storage/d5ca3f6d/5a1321e9/abf90da0/35c32879.png"><br><br>  Now, from time to time, we need to pull in the changes from <b>stable</b> to <b>dev</b> : <br><br><img src="https://habrastorage.org/storage/b8a8ffd4/dc5c701b/3b95d143/21255c0d.png"><br><br>  Here is what we just did: <br><br><img src="https://habrastorage.org/storage/53bf82a1/b62b1a9f/ee8752b7/398d919f.png"><br><br>  And if you can understand what is drawn on <i>this</i> crazy picture, then with the understanding of Mercurial you will have no more problems.  The bottom line is that only bug fixes get into the <b>stable</b> repository, and the <b>dev</b> repository stores new code and merges with bug fixes. <br><br>  There are other uses for multiple repositories. <br><br><ul><li>  You can set up team repositories where several people work together on some new functionality.  When they finish and everything done will work correctly, you push the changes from the command repository to the main repository, and everyone will see these changes. <br></li><li>  You can set up a repository for testers.  Instead of pushing changes to the main repository right away, you will push changes to the testers repository.  The testers check the changes and when (and if) the changes are approved, you can push the changes from the testers repository to the main repository.  With this approach, the main repository will always contain the tested code. <br></li><li>  Since each developer has his own repository, you can pull out experimental changes from a friend's repository for trial without affecting the work of the rest of the team. <br></li></ul><br><br>  In large, complex organizations, you can combine these techniques and customize chains of repositories that pull changes from one another.  As soon as some functionality goes through the stages of testing and integration, it is pulled into the repositories along the chain until it finally finds itself in the main repository, which stores the code that customers receive: <br><br><img src="https://habrastorage.org/storage/aa0f38ff/e5a593c6/0470c7bd/89c7c3d4.png"><br><br><h5>  check yourself </h5><br><br>  Here is what you should be able to do after reading this part: <br><ol><li>  Mark old versions and return to them. </li><li>  Organize team work with two repositories (stable and dev). </li></ol><br><br>  Well, it so happened that we reached the end of the manual.  I did <i>n't</i> even <i>get close</i> to describing all the features of Mercurial, but there are enough materials for in-depth study.  There is a <a href="http://hgbook.red-bean.com/">book</a> that describes everything in extreme detail.  And if you have any questions, then I invite you to the <a href="http://kiln.stackexchange.com/">Kiln Knowledge Exchange</a> site (it's like <a href="http://stackoverflow.com/">StackOverflow</a> , only for Kiln, and questions about Mercurial are more than welcome on this site). <br><br>  <i>Comments from the translator:</i> <br>  If you, like me, are interested in seeing guacamole, here is a video that shows the process of cooking this dish. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Aiyx5AxKHTE%3Ffeature%3Doembed&amp;xid=17259,15700022,15700043,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhh-IY0JgrzTDOwiGUjTOaiqP2gvsw" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/109428/">https://habr.com/ru/post/109428/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../109421/index.html">Come in! Login without login and password</a></li>
<li><a href="../109424/index.html">Notion Ink Adam or why am I waiting for the New Year</a></li>
<li><a href="../109425/index.html">Base of all settlements and regions of Russia</a></li>
<li><a href="../109426/index.html">NewsWave.com.ua: Reader of Ukrainian news. Theory and practice</a></li>
<li><a href="../109427/index.html">Leningrad NPP from the inside</a></li>
<li><a href="../109429/index.html">Ideology and problems of developing financial systems. Part 2</a></li>
<li><a href="../109431/index.html">Interview with John Hrvatin (John Hrvatin)</a></li>
<li><a href="../109433/index.html">Domain.RF: registration continues and contests too!</a></li>
<li><a href="../109434/index.html">Decide the fate of the project: Winnie cloud - cloud hosting hosting</a></li>
<li><a href="../109435/index.html">Lufthansa offers its customers access to the Internet on flights</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>