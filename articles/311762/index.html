<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pitfalls Bash</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we‚Äôll talk about errors made by bash programmers. In all the examples there are some flaws. You will be able to avoid many of the erro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pitfalls Bash</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e9b/203/63c/e9b20363c99b43628a2913f59071b5bd.jpg"><br><br>  In this article we‚Äôll talk about errors made by bash programmers.  In all the examples there are some flaws.  You will be able to avoid many of the errors described below if you always use quotes and never use wordsplitting!  Word breaking is a flawed legacy practice inherited from the Bourne shell.  It is applied by default if you do not enclose quotes.  In general, the overwhelming majority of pitfalls are somehow connected with the substitution without quotation marks, which leads to word splitting and globbing of the resulting result. <br><br><div class="spoiler">  <b class="spoiler_title">Content</b> <div class="spoiler_text"><ol><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">for i in $ (ls * .mp3)</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">cp $ file $ target</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">File names with preceding hyphens</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">[$ foo = "bar"]</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">cd $ (dirname "$ f")</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">["$ foo" = bar &amp;&amp; "$ bar" = foo]</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">[[$ foo&gt; 7]]</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">grep foo bar |</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">while read -r;</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">do ((count ++));</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">done</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">if [grep foo myfile]</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">if [bar = "$ foo"];</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">then ...</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">if [[a = b] &amp;&amp; [c = d]];</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">then ...</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">read $ foo</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">cat file |</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">sed s / foo / bar /&gt; file</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">echo $ foo</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">$ foo = bar</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">foo = bar</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">echo &lt;&lt; EOF</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">su -c 'some command'</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">cd / foo;</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">bar</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">[bar == "$ foo"]</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">for i in {1..10};</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">do ./something &amp;;</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">done</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">cmd1 &amp;&amp; cmd2 ||</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">cmd3</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">echo "Hello World!"</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">for arg in $ *</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">function foo ()</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">echo "~"</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">local varname = $ (command)</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">export foo = ~ / bar</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">sed 's / $ foo / good bye /'</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">tr [AZ] [az]</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">ps ax |</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">grep gedit</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">printf "$ foo"</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">for i in {1 .. $ n}</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">if [[$ foo = $ bar]] (depending on the target)</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">if [[$ foo = ~ 'some RE']]</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">[-n $ foo] or [-z $ foo]</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">[[-e "$ broken_symlink"]] returns 1, despite the existence of $ broken_symlink</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">Crash ed file &lt;&lt;&lt; g / d \ {0,3 \} / s // e / g</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">Sub-string failure (sub-string) expr for "match"</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">About UTF-8 and byte sequence marks (Byte-Order Marks, BOM)</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">content = $ (&lt;file)</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">for file in ./*;</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">do if [[$ file! = *. *]]</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">somecmd 2&gt; &amp; 1 &gt;&gt; logfile</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">cmd;</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">((! $?)) ||</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">die</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">y = $ ((array [$ x]))</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">read num;</a>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">echo $ ((num + 1))</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">IFS =, read -ra fields &lt;&lt;&lt; "$ csv_line"</a> </li><li>  <a href="https://habrahabr.ru/company/mailru/blog/311762/">export CDPATH = .: ~ / myProject</a> </li></ol></div></div><br><a name="habracut"></a><br><a name="1"></a><h1>  1. for i in $ (ls * .mp3) </h1><br>  One of the most common mistakes made by BASH-programmers.  It is expressed in the writing of such cycles: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $(ls *.mp3); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-comment"><span class="hljs-comment"># ! some command $i # ! done for i in $(ls) # ! for i in `ls` # ! for i in $(find . -type f) # ! for i in `find . -type f` # ! files=($(find . -type f)) # ! for i in ${files[@]} # !</span></span></code> </pre> <br>  Yes, it would be great if you could process the output <code>ls</code> or <code>find</code> as a list of file names and iterate it.  But you <b>can not</b> .  This approach is entirely wrong, and this can not be corrected.  You need to approach this completely differently. <br><br>  There are at least five problems here: <br><br><ol><li>  If the file name contains spaces, then it is subject to <a href="http://mywiki.wooledge.org/WordSplitting">WordSplitting</a> .  Suppose that in the current folder we have a file named <code>01 - Don't Eat the Yellow Snow.mp3</code> .  The <code>for</code> loop iterates each word and returns the result: <i>01, -, Don't, Eat</i> , etc. <br><br></li><li>  If the file name contains <a href="http://mywiki.wooledge.org/glob">glob</a> characters, then it is subjected to globbing (" <a href="http://mywiki.wooledge.org/glob">globbing</a> ").  If the output of <code>ls</code> contains the character <b>*</b> , then the word into which it belongs will be regarded as a template and replaced with a list of all the file names that correspond to it.  The path to the file can contain <b>any</b> characters, with the exception of NUL.  Yes, including newline characters. <br><br></li><li>  The <code>ls</code> utility can shred file names.  Depending on the platform on which you are working out, on the arguments (or not) you use, and also on whether the standard output is pointing to the terminal, <code>ls</code> can suddenly replace some characters in the file name with a "?".  Or even do not display them.  <a href="http://mywiki.wooledge.org/ParsingLs">Never attempt to parse the output ls</a> . <br><br></li><li>  <a href="http://mywiki.wooledge.org/CommandSubstitution">The CommandSubstitution</a> truncates all end line <a href="http://mywiki.wooledge.org/CommandSubstitution">feeds</a> from the output.  At first glance, this is good, because <code>ls</code> adds a new line.  But if the last file name in the list ends with a new line, then `...` or <code>$()</code> will also be removed in addition. </li></ol><br>  You also can not enclose the substitution in double quotes: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(ls *.mp3)</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-comment"><span class="hljs-comment"># !</span></span></code> </pre><br>  This will result in the entire output of <code>ls</code> being considered as one word.  Instead of iterating each file name, the loop will be executed <b>once</b> , assigning <code>i</code> string value from the combined file names.  And you can't just change the <a href="http://mywiki.wooledge.org/IFS">IFS</a> to a new line.  File names may also contain new lines. <br><br>  Another variation on this topic is the abuse of word splitting and for loops for (incorrect) reading lines of a file.  For example: <br><br><pre> <code class="bash hljs">IFS=$<span class="hljs-string"><span class="hljs-string">'\n'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $(cat file); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ... <span class="hljs-comment"><span class="hljs-comment"># !</span></span></code> </pre><br>  This does not work!  Especially if the strings are file names.  Bash (like any other Bourne shell) just doesn't work that way.  In addition to all the above, you absolutely do not need to use <code>ls</code> itself.  This is an external command, the output of which is specifically designed for reading by a person, and not for parsing by a script. <br><br>  <b>So how do you do it right?</b> <br><br>  Use <code>find</code> , for example, in conjunction with <code>-exec</code> : <br><br><pre> <code class="bash hljs">find . -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> some <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> {} \;</code> </pre><br>  Instead of <code>ls</code> you can consider this option: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> *.mp3; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-comment"><span class="hljs-comment">#  ! ... some command "$i" # ...    ! done</span></span></code> </pre><br>  POSIX shells, like Bash, have the globbing property for this purpose ‚Äî this allows them to apply templates to the list of matching file names.  No need to interpret the results of the external utility.  Since globbing is the last stage of the substitution procedure, the <code>*.mp3</code> pattern is correctly applied to individual words that are not affected by the wildcard substitution.  If you need to recursively process files, use <a href="http://mywiki.wooledge.org/UsingFind">UsingFind</a> or take a look at <code>shopt -s globstar</code> in Bash 4 and higher. <br><br>  <i>Question:</i> What happens if there are no files in the current folder that satisfy the pattern * .mp3?  The <code>for</code> loop will be executed once with <code>i="*.mp3"</code> , which is not the expected behavior!  As a solution to this problem, you can check for the presence of a suitable file: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># POSIX for i in *.mp3; do [ -e "$i" ] || continue some command "$i" done</span></span></code> </pre><br>  Another solution is to use the Bash <code>shopt -s nullglob</code> .  Although this can be done only after reading the documentation and carefully evaluating the effect of this setting on all other globs in this script.  Note the quotes around <code>$i</code> in the body of the loop.  This leads us to the second problem: <br><br><a name="2"></a><h1>  2. cp $ file $ target </h1><br>  What is wrong with this team?  In principle, nothing <b>if</b> you know in advance that <code>$file</code> and <code>$target</code> do not contain spaces or wildcards.  However, the results of the substitution still undergo WordSplitting and file path substitution.  Therefore, always include parameter expansions in double quotes. <br><br><pre> <code class="bash hljs">cp -- <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$file</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$target</span></span></span><span class="hljs-string">"</span></span></code> </pre><br>  Otherwise, you will receive the following command <code>cp 01 - Don't Eat the Yellow Snow.mp3 /mnt/usb</code> , which will lead to errors like <code>cp: cannot stat `01': No such file or directory</code> .  If <code>$file</code> contains wildcard characters ( <b>*</b> or <b>?</b> Or <b>[</b> ), then they will be expanded only if there are matching files.  With double quotes, everything will be fine, until at the beginning of "$ file" there is a "-" character.  In this case, <code>cp</code> will decide that you are trying to feed command line options to it (see the next chapter). <br><br>  Even in a few unusual circumstances, when you can guarantee the contents of a variable, quoting parameter substitution is a good and common practice, especially if they contain filenames.  Experienced script writers will always use quotes, except in rare cases when it is <b>absolutely</b> clear from the context of the code that the parameter contains a guaranteed safe value.  Experts will certainly decide that using the <code>cp</code> command in the header is an error.  You should think so too. <br><br><a name="3"></a><h1>  3. Filenames with preceding hyphens </h1><br>  File names with preceding hyphens can cause a lot of problems.  Globs like <code>*.mp3</code> sorted into an expanded list (according to your current locale), and in most locales a hyphen is sorted first and then letters.  Then the list is passed to some command that may incorrectly interpret <code>-filename</code> as an option.  This situation has two main solutions. <br><br>  The first is to insert two hyphens ( <code>--</code> ) between the command (for example, <code>cp</code> ) and its arguments.  This will be a signal to stop searching for options, and everything will be fine: <br><br><pre> <code class="bash hljs">cp -- <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$file</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$target</span></span></span><span class="hljs-string">"</span></span></code> </pre><br>  But this approach has its own problems.  You must be sure to insert <code>--</code> <b>every time you</b> use a parameter in context, when it can be interpreted as an option.  This implies greater redundancy, and you can easily miss something. <br><br>  Most of the well-written parsing options libraries understand this, and programs that correctly use them should inherit this feature for free.  However, keep in mind that the responsibility for recognizing the end of options rests solely with the application.  Some programs that parse options manually, or do it incorrectly, or use third-party libraries may not recognize the endings.  Standard utilities <b>should</b> do this, apart from the few exceptions described in POSIX.  For example, <code>echo</code> . <br><br>  Another option is to make sure that your file names always begin with a folder.  To do this, use relative or absolute file paths. <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ./*.mp3; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> cp <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string">"</span></span> /target ... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br>  In this case, even if we have a file whose name begins with a hyphen, thanks to glob we can be sure that the variable always contains something like <code>./-foo.mp3</code> .  And it is perfectly safe, if we talk about <code>cp</code> . <br><br>  Finally, if you can guarantee that all the results will have the same prefix, and the variable is used in the body of the loop only a few times, you can simply concatenate the prefix during the substitution.  Theoretically, it will save us the generation and storage of several additional characters for each word. <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> *.mp3; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> cp <span class="hljs-string"><span class="hljs-string">"./</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string">"</span></span> /target ... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br><a name="4"></a><h1>  4. [$ foo = "bar"] </h1><br>  This situation is very similar to the problem described in the second chapter.  But still, I will repeat it, because it is very important.  In the header line quoted, the quotes are not where they are needed.  In Bash, you <b>do not need</b> to quote quotes for string literals (unless they contain metacharacters or wildcards).  But you <b>must</b> quote your variables if they can contain spaces or wildcard characters. <br><br>  The above example can break for several reasons: <br><br><ul><li>  If the variable referenced in <code>[</code> does not exist or is empty, then the command <code>[</code> will ultimately look like this: <br><br><pre> <code class="bash hljs">[ = <span class="hljs-string"><span class="hljs-string">"bar"</span></span> ] <span class="hljs-comment"><span class="hljs-comment"># !</span></span></code> </pre><br>  ... and throw an error: <code>unary operator expected.</code>  (Operator <code>=</code> is binary, not unary, so the team <code>[</code> will be shocked to see him). <br><br></li><li>  If a variable contains internal spaces, then it will be divided into words before the <code>[</code> .  Therefore, we get: <br><br><pre> <code class="bash hljs">[ multiple words here = <span class="hljs-string"><span class="hljs-string">"bar"</span></span> ]</code> </pre><br>  You may not see any problems, but thanks to the use <code>[</code> there is a syntax error.  The correct way to write: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># POSIX [ "$foo" = bar ] # !</span></span></code> </pre><br>  This will work fine in POSIX-compatible implementations, even if there is a hyphen before <code>$foo</code> , because in the POSIX command, <code>[</code> determines its actions depending on the number of arguments passed to it.  Only very ancient shells will have problems with this, you can not worry about them when writing code (see below the trick with x " <code>$foo</code> "). </li></ul><br>  Bash and many other ksh-like shells have an excellent alternative using the <a href="http://mywiki.wooledge.org/BashFAQ/031">keyword [[</a> . <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Bash / Ksh [[ $foo == bar ]] # !</span></span></code> </pre><br>  You do not need to quote links to variables to the left of <code>=</code> inside <code>[[ ]]</code> , because they are not subject to word splitting or globbing.  And even empty variables will be processed correctly.  On the other hand, the use of quotes does not hurt.  Unlike <code>[</code> and <code>test</code> , you can also use <code>==</code> .  Just note that when comparing using <code>[[</code> pattern search is performed for the strings on the right side, not a simple string comparison.  To make the right string literal, you must put it in quotes when using any characters that have special meaning in the context of a pattern search. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Bash / Ksh match=b*r [[ $foo == "$match" ]] # !    ,       b*r.</span></span></code> </pre><br>  You've probably seen similar code: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># POSIX / Bourne [ x"$foo" = xbar ] # ,    .</span></span></code> </pre><br>  For code that runs on very ancient shells, the hack x " <code>$foo</code> " will be required.  Here, instead of <code>[[</code> more primitive is used <code>[</code> .  If <code>$foo</code> starts with a hyphen, then confusion arises.  On older systems <code>[</code> does not care about whether the token to the right of <code>=</code> begins with a hyphen.  She uses it literally.  So you need to be more careful with the left side. <br><br>  Note that shells that need this workaround are not compatible with POSIX.  Even Heirloom Bourne does not require this (it is probably a non-POSIX clone of the Bourne shell, which is still one of the most common system shells).  Such extreme portability is rarely required, it makes your code less readable and beautiful. <br><br><a name="5"></a><h1>  5. cd $ (dirname "$ f") </h1><br>  Another error related to quotes.  As is the case with variable expansion (variable expansion), the result of command substitution is subjected to word splitting and file path substitution.  Therefore, enclose in quotes: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> -P -- <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(dirname -- "$f")</span></span></span><span class="hljs-string">"</span></span></code> </pre><br>  The logic of quotation is not completely obvious here.  A C programmer will expect that the first and second double quotes will be grouped together, and then the third and fourth quotes will be displayed.  But in Bash everything is different.  Bash treats double quotes inside the command substitution as one pair, and double quotes outside the substitution like the other pair. <br><br>  You can write differently: the parser treats the command substitution as ‚Äúnesting level‚Äù, and the quotes inside go separately from the quotes outside. <br><br><a name="6"></a><h1>  6. ["$ foo" = bar &amp;&amp; "$ bar" = foo] </h1><br>  You cannot use <code>&amp;&amp;</code> inside the old <a href="http://mywiki.wooledge.org/BashFAQ/031">test (or [)</a> command.  The Bash parser sees <code>&amp;&amp;</code> outside <code>[[ ]]</code> or <code>(( ))</code> , and as a result splits your command into <b>two</b> commands ‚Äî before and after <code>&amp;&amp;</code> .  Instead, use one of two options: <br><br><pre> <code class="bash hljs">[ bar = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$foo</span></span></span><span class="hljs-string">"</span></span> ] &amp;&amp; [ foo = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$bar</span></span></span><span class="hljs-string">"</span></span> ] <span class="hljs-comment"><span class="hljs-comment"># ! (POSIX) [[ $foo = bar &amp;&amp; $bar = foo ]] #  ! (Bash / Ksh)</span></span></code> </pre><br>  (Note that due to the Legacy mentioned in Chapter 4, we swapped the constant and variable inside <code>[</code> . We could also change <code>[[</code> , but to prevent interpretation, we would have to take substitutions in quotes). <br><br>  The same applies to <code>||</code>  .  Instead, use <code>[[</code> or two commands <code>[</code> . <br><br>  Avoid this: <br><br><pre> <code class="bash hljs">[ bar = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$foo</span></span></span><span class="hljs-string">"</span></span> -a foo = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$bar</span></span></span><span class="hljs-string">"</span></span> ] <span class="hljs-comment"><span class="hljs-comment">#  .</span></span></code> </pre><br>  The binary <code>-a</code> , <code>-o</code> and (/) (grouping) operators are POSIX XSI extensions.  In POSIX 2008, they are all marked as obsolete.  Use them in the new code is not worth it.  One of the practical problems associated with <code>[ A = B -a C = D ]</code> (or <code>-o</code> ) is that <a href="http://www.opengroup.org/onlinepubs/9699919799/utilities/test.html">POSIX does not define the</a> results of the <code>test</code> commands or <code>[</code> with more than four arguments.  This will probably work in most shells, but you cannot count on it.  If you need to write for the POSIX shell, then use two <code>test</code> commands or <code>[</code> , separated by the <code>&amp;&amp;</code> operator. <br><br><a name="7"></a><h1>  7. [[$ foo&gt; 7]] </h1><br>  There are a few points here.  First, the command <code>[[</code> should not be used exclusively to calculate arithmetic expressions.  It should be used for test expressions that include one of the supported test operators.  Although technically you <b>can</b> perform calculations with the help of operators <code>[[</code> , but it makes sense only in combination with one of the non-mathematical test operators, which is present somewhere in the expression.  If you just want to compare numeric data (or perform any other arithmetic operation), then it is much better to use <code>(( ))</code> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Bash / Ksh ((foo &gt; 7)) # ! [[ foo -gt 7 ]] # ,  .   .   ((...))  let.</span></span></code> </pre><br>  If inside <code>[[ ]]</code> you use the&gt; operator, then the system treats it as a comparison of string data (checking the sort order by locale), not numeric.  Sometimes it can work, but it will let you down just when you least expect it.  It is even worse to use&gt; inside <code>[ ]</code> : this is a redirection of the output.  A file with the name 7 will appear in your folder, and the test will run successfully until there is something in <code>$foo</code> . <br><br>  If strict compatibility with POSIX is required and the command is not available <code>((</code> , then using the old-fashioned <code>[</code> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># POSIX [ "$foo" -gt 7 ] #  ! [ $((foo &gt; 7)) -ne 0 ] #   POSIX  ((     .</span></span></code> </pre><br>  Note that if <code>$foo</code> not integer, then the <code>test ... -gt</code> will fail.  Therefore, quotation makes sense only for the sake of performance and separation of arguments into single words in order to reduce the likelihood of side effects in some shells. <br><br>  If you cannot guarantee the input data for any arithmetic context (including <code>((</code> or <code>let</code> )) or a test expression <code>[</code> that implies numeric comparisons, then you should <b>always</b> validate the input data before performing the calculation. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># POSIX case $foo in *[![:digit:]]*) printf '$foo expanded to a non-digit: %s\n' "$foo" &gt;&amp;2 exit 1 ;; *) [ $foo -gt 7 ] esac</span></span></code> </pre><br><a name="8"></a><h1>  8. grep foo bar |  while read -r;  do ((count ++));  done </h1><br>  Does this code look ok?  Of course, this is just a mediocre implementation of <code>grep -c</code> , but this is done for simplicity of example.  Changes in <code>count</code> will not propagate beyond the boundaries of the <code>while</code> , because each pipeline command is executed in a separate subshell ( <a href="http://mywiki.wooledge.org/SubShell">SubShell</a> ).  At some point, this surprises any newcomer to Bash. <br><br>  POSIX does not determine whether the last element of the pipeline should be calculated in a subshell.  Some shells, like ksh93 and Bash&gt; = 4.2 with <code>shopt -s lastpipe</code> , will run the example <code>while</code> in the original shell process, which can lead to any side effects.  Therefore, portable scripts should be written in such a way that they do not depend on such behavior. <br><br>  Ways to solve this and similar problems you can learn from the <a href="http://mywiki.wooledge.org/BashFAQ/024">Bash FAQ # 24</a> .  It is too long to describe them here. <br><br><a name="9"></a><h1>  9. if [grep foo myfile] </h1><br>  Many beginners have an erroneous idea of <code>if</code> expressions, due to the fact that very often this keyword immediately follows <code>[</code> or <code>[[</code> .  People believe that <code>[</code> somehow part of the <code>if</code> expression syntax, as are the simple brackets used in the C expression in the C language. This is not so!  <code>if</code> receives <b>command</b> .  It is <code>[</code> , it is not a syntax marker for <code>if</code> .  This command is equivalent to <code>test</code> , except that the last argument must be <code>]</code> .  For example: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># POSIX if [ false ]; then echo "HELP"; fi if test false; then echo "HELP"; fi</span></span></code> </pre><br>  These lines are equivalent: both check that the argument ‚Äúfalse‚Äù is not empty.  In both cases, HELP will be output, to the surprise of programmers who have come from other languages ‚Äã‚Äãand are trying to figure out the shell syntax. <br><br>  The <code>if</code> expression has the following syntax: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> COMMANDS <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> &lt;COMMANDS&gt; <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> &lt;COMMANDS&gt; <span class="hljs-comment"><span class="hljs-comment"># optional then &lt;COMMANDS&gt; else &lt;COMMANDS&gt; # optional fi # required</span></span></code> </pre><br>  Once again - <code>[</code> is a command.  She gets arguments like any other regular command.  <code>if</code> is a compound command containing other commands.  And <b>in its syntax is not [</b> ! <br><br>  Although Bash has a builtin command <code>[</code> , and so it knows about <code>[</code> , c <code>]</code> there is nothing special.  Bash only passes <code>]</code> as an argument to the command <code>[</code> , which needs it to be <code>]</code> last argument, otherwise the script will look ugly. <br><br>  There may be zero and more optional <code>elif</code> sections, as well as one optional <code>else</code> section. <br><br>  The compound <code>if</code> command contains two or more sections that contain <b>lists of</b> commands.  Each section begins with the keyword <code>then</code> , <code>elif</code> or <code>else</code> , and ends with the keyword <code>fi</code> .  The completion code of the last command of the first section and each subsequent section of <code>elif</code> determine the calculation of each corresponding section of <code>then</code> .  The other section of <code>elif</code> computed before one of the <code>then</code> is executed.  If no <code>then</code> section is calculated, then switching to the <code>else</code> branch.  If there is no <code>else</code> , the <code>if</code> block <code>if</code> completed, and the resulting <code>if</code> command returns 0 (true). <br><br>  If you want to make a decision depending on the output of the <code>grep</code> , then you do not need to enclose it in parentheses or square brackets, backticks, or any other syntax!  Just use <code>grep</code> as a command after the <code>if</code> : <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> grep -q fooregex myfile; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br>  If <code>grep</code> finds a match in the string from <code>myfile</code> , then the <code>myfile</code> code will be 0 (true), and the <code>then</code> part will be executed.  If no match is found, <code>grep</code> will return a value other than 0, and the resulting <code>if</code> command will be zero. <br><br>  <b>See also:</b> <br><br><ul><li>  <a href="http://mywiki.wooledge.org/BashGuide/TestsAndConditionals">BashGuide / TestsAndConditionals</a> </li><li>  <a href="http://wiki.bash-hackers.org/syntax/ccmd/if_clause">http://wiki.bash-hackers.org/syntax/ccmd/if_clause</a> </li></ul><br><a name="10"></a><h1>  10. if [bar = "$ foo"];  then ... </h1><br><pre> <code class="bash hljs">[bar=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$foo</span></span></span><span class="hljs-string">"</span></span>] <span class="hljs-comment"><span class="hljs-comment"># ! [ bar="$foo" ] #   !</span></span></code> </pre><br>  As explained in the previous chapter, <code>[</code> is a command (this can be proved with <code>type -t [</code> or <code>whence -v [</code> ).  As with any other simple command, Bash expects a space after it, then the first argument, space again, and so on.  You just can not neglect the spaces!  Here is the correct spelling: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ bar = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$foo</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ...</code> </pre><br>  Each of the components - <code>bar</code> , <code>=</code> , the substitution of " <code>$foo</code> " and <code>]</code> - are separate <a href="http://mywiki.wooledge.org/Arguments">arguments to the</a> command <code>[</code> .       ,   ,       . <br><br><a name="11"></a><h1> 11. if [ [ a = b ] &amp;&amp; [ c = d ] ]; then ... </h1><br>    . <code>[</code>  <b></b> .    ,   <code>if</code>  - ¬´¬ª,    .   <code>[</code>   .     - <code>if</code>     Bash-,      ! <br><br>       ,  : <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ a = b ] &amp;&amp; [ c = d ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ...</code> </pre><br>  ,      <b></b>  <code>if</code> ,   <code>&amp;&amp;</code> ( AND,  ).    ,  : <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> a = b &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> c = d; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ...</code> </pre><br>    <code>test</code>  false,      <code>if</code>  .   true,     <code>test</code> ;     true,       <code>if</code> . (C-    <code>&amp;&amp;</code> . Bash    <b> </b> .  ,  <code>||</code>      <i>OR</i> .) <br><br>   <code>[[</code> <b></b>  <code>&amp;&amp;</code> ,      : <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ a = b &amp;&amp; c = d ]]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ...</code> </pre><br>   6  ,    <code>test</code>   . <br><br><a name="12"></a><h1> 12. read $foo </h1><br>   <code>$</code>      <code>read</code> .          <code>foo</code> ,  : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">read</span></span> foo</code> </pre><br>   : <br><br><pre> <code class="bash hljs">IFS= <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -r foo</code> </pre><br> <code>read $foo</code>         /   <code>$foo</code> .    ,      <code>foo</code>    ;      . <br><br><a name="13"></a><h1> 13. cat file | sed s/foo/bar/ &gt; file </h1><br>  <b> </b>           .    ,    , : <br><br><ul><li>    (clobbered) ( 0 ,   ,      ), </li><li>        , </li><li>    ,    ,   . </li></ul><br>      ,      ,    . <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> %s\\n <span class="hljs-string"><span class="hljs-string">',s/foo/bar/g'</span></span> wq | ed -s file</code> </pre><br>          ,    (*)    . <br><br>      : <br><br><pre> <code class="bash hljs">sed <span class="hljs-string"><span class="hljs-string">'s/foo/bar/g'</span></span> file &gt; tmpfile &amp;&amp; mv tmpfile file</code> </pre><br>       GNU sed 4.x: <br><br><pre> <code class="bash hljs">sed -i <span class="hljs-string"><span class="hljs-string">'s/foo/bar/g'</span></span> file(s)</code> </pre><br>  ,             ‚Äî   . <br><br>   -   Perl 5.x (, ,  ,  GNU sed 4.x): <br><br><pre> <code class="bash hljs">perl -pi -e <span class="hljs-string"><span class="hljs-string">'s/foo/bar/g'</span></span> file(s)</code> </pre><br>         <a href="http://mywiki.wooledge.org/BashFAQ/021">Bash FAQ #21</a> . <br><br> (*)    <code>sponge</code>  <a href="http://packages.debian.org/sid/moreutils">moreutils</a>   : <br><br><pre> <code class="bash hljs">sed <span class="hljs-string"><span class="hljs-string">'...'</span></span> file | grep <span class="hljs-string"><span class="hljs-string">'...'</span></span> | sponge file</code> </pre><br>       <code>mv</code> ,   ¬´¬ª (  !)  ,       <code>file</code> . ,        ,   ,           . <br><br>    <code>+ mv</code>            /  .      ,   <code>mv</code>  <code>sync</code> . <br><br><a name="14"></a><h1> 14. echo $foo </h1><br>        .  <code>$foo</code>    ,       ,   . -  Bash- ,      ,         .          . <br><br><pre> <code class="bash hljs">msg=<span class="hljs-string"><span class="hljs-string">",    *.zip"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$msg</span></span></code> </pre><br>     ,    (glob) ( *.zip) .   ,   : <code>,    freenfss.zip lw35nfss.zip</code> . : <br><br><pre> <code class="bash hljs">var=<span class="hljs-string"><span class="hljs-string">"*.zip"</span></span> <span class="hljs-comment"><span class="hljs-comment"># var  ,    "zip" echo "$var" #  *.zip echo $var #   ,   .zip</span></span></code> </pre><br>  ,   <code>echo</code>     .   , , <code>-n</code> ,  <code>echo</code> ,   ,       .       ‚Äî  <code>printf</code> : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> <span class="hljs-string"><span class="hljs-string">"%s\n"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$foo</span></span></span><span class="hljs-string">"</span></span></code> </pre><br><a name="15"></a><h1> 15. $foo=bar </h1><br> ,  <code>$</code>   ,     .   Perl. <br><br><a name="16"></a><h1> 16. foo = bar </h1><br> ,       <code>=</code> ,    .   .    <code>foo = bar</code> ,      .  ‚Äî <code>foo</code> ‚Äî     .    ‚Äî    . <br><br><ul><li> <code>foo= bar # !</code> </li> <li> <code>foo =bar # !</code> </li> <li> <code>$foo = bar; #  !</code> </li> <li> <code>foo=bar # .</code> </li> <li> <code>foo="bar" #  .</code> </li> </ul><br><a name="17"></a><h1> 17. echo &lt;&lt;EOF </h1><br> Here- ‚Äî           .            .  ,  <code>echo</code>    stdin. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  : echo &lt;&lt;EOF Hello world How's it going? EOF #     : cat &lt;&lt;EOF Hello world How's it going? EOF #   ,      (, echo ): echo "Hello world How's it going?"</span></span></code> </pre><br>          .          .        .   ,      ,      <code>cat</code> ,   : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   printf ( , printf ): printf %s "\ Hello world How's it going? "</span></span></code> </pre><br>    <code>printf</code> ,  \            .       (       ).  <code>\n</code>   <code>printf</code>      .    \      .        ,      ,     ¬´¬ª    : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> %s \ <span class="hljs-string"><span class="hljs-string">'Hello world '</span></span> <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> %s <span class="hljs-string"><span class="hljs-string">'Hello world '</span></span></code> </pre><br><a name="18"></a><h1> 18. su -c 'some command' </h1><br>    .   ,     <code>su</code>   <code>-c</code> ,   ,   .    OpenBSD: <br><br><pre> <code class="bash hljs">$ su -c <span class="hljs-string"><span class="hljs-string">'echo hello'</span></span> su: only the superuser may specify a login class</code> </pre><br>     <code>-c 'some command'</code> ,    <code>-c</code>    . <br><br><pre> <code class="bash hljs">su root -c <span class="hljs-string"><span class="hljs-string">'some command'</span></span> <span class="hljs-comment"><span class="hljs-comment"># Now it's right.</span></span></code> </pre><br> <code>su</code>   root-,    .     ,       .           . <br><br><a name="19"></a><h1> 19. cd /foo; bar </h1><br>          <code>cd</code> ,    <code>bar</code>   .    , ,  , <code>bar</code>  <code>rm -f *</code> . <b></b>       <code>cd</code> .  : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /foo &amp;&amp; bar</code> </pre><br>   <code>cd</code>    ,    : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /foo || <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 1 bar baz bat ... <span class="hljs-comment"><span class="hljs-comment"># Lots of commands.</span></span></code> </pre><br> <code>cd</code>     ,  stderr-  ¬´bash: cd: /foo: No such file or directory¬ª.      stdout  ,     : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /net || { <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> &gt;&amp;2 <span class="hljs-string"><span class="hljs-string">"Can't read /net. Make sure you've logged in to the Samba network, and try again."</span></span>; xit 1; } do_stuff more_stuff</code> </pre><br>  ,   <code>{</code>  <code>echo</code>  .    <code>}</code>  <code>;</code>  . <br><br>    <a href="http://mywiki.wooledge.org/BashFAQ/105">set -e</a> ,       ,  ,   .        (           ,      ). <br><br> ,        Bash-,      <code>pushd</code> , <code>popd</code>  <code>dirs</code> . ,  ,      <code>cd</code>  <code>pwd</code> ,   .  : <br><br><pre> <code class="bash hljs">find ... -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> d -print0 | <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> IFS= <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -r -d <span class="hljs-string"><span class="hljs-string">''</span></span> subdir; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> here=<span class="hljs-variable"><span class="hljs-variable">$PWD</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$subdir</span></span></span><span class="hljs-string">"</span></span> &amp;&amp; whatever &amp;&amp; ... <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$here</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br> C : <br><br><pre> <code class="bash hljs">find ... -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> d -print0 | <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> IFS= <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -r -d <span class="hljs-string"><span class="hljs-string">''</span></span> subdir; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$subdir</span></span></span><span class="hljs-string">"</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>; whatever; ...) <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br>     <code>cd</code>    .         ,    ,    <code>cd</code> .      ,          <code>... &amp;&amp; ...</code> ,     .       (   ). <br><br><a name="20"></a><h1> 20. [ bar == "$foo" ] </h1><br>  <code>==</code>     POSIX- <code>[</code> .  <code>=</code>   <code>[[</code> . <br><br><pre> <code class="bash hljs">[ bar = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$foo</span></span></span><span class="hljs-string">"</span></span> ] &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> yes [[ bar == <span class="hljs-variable"><span class="hljs-variable">$foo</span></span> ]] &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> yes</code> </pre><br>  Bash <code>[ "$x" == y ]</code>   ,      .     ‚Äî  ¬´¬ª ( <a href="http://mywiki.wooledge.org/Bashism">Bashism</a> ).     ,       <code>[[</code> . <br><br><a name="21"></a><h1> 21. for i in {1..10}; do ./something &amp;;  done </h1><br> <b></b>  <code>;</code>   <code>&amp;</code> .    <code>;</code>  . <br><br><pre> <code class="bash hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> {1..10}; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ./something &amp; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> {1..10}; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ./something &amp; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br> <code>&amp;</code>      (command terminator),   <code>;</code>  .   . <br><br>  , <code>;</code>    ,         <code>;</code>  . <br><br><a name="22"></a><h1> 22. cmd1 &amp;&amp; cmd2 || cmd3 </h1><br> -   <code>&amp;&amp;</code>  <code>||</code>      <code>if ... then ... else ... fi</code> .     : <br><br><pre> <code class="bash hljs">[[ -s <span class="hljs-variable"><span class="hljs-variable">$errorlog</span></span> ]] &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Uh oh, there were some errors."</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Successful."</span></span></code> </pre><br>         <code>if ... fi</code> . ,   <code>&amp;&amp;</code> ,    .      ¬´true¬ª (0),     ,   <code>||</code>  .  For example: <br><br><pre> <code class="bash hljs">i=0 <span class="hljs-literal"><span class="hljs-literal">true</span></span> &amp;&amp; ((i++)) || ((i--)) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$i</span></span> <span class="hljs-comment"><span class="hljs-comment"># Prints 0</span></span></code> </pre><br>  What's going on here? ,  <code>i</code>   1,   0. ?      <code>i++</code> ,  <code>i--</code> .  <code>((i++))</code>   ,            .    0 (  <code>i</code> ),     ,  0,  <b>false</b> .    <code>((i++))</code> ( <code>i</code>  0)    1 (false),      <code>((i--))</code> . <br><br>   ,      ,    <code>++i</code>  true: <br><br><pre> <code class="bash hljs">i=0 <span class="hljs-literal"><span class="hljs-literal">true</span></span> &amp;&amp; (( ++i )) || (( --i )) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$i</span></span> <span class="hljs-comment"><span class="hljs-comment"># Prints 1</span></span></code> </pre><br>     <b></b> .      <code>x &amp;&amp; y || z</code> ,  y    !     ,    <code>i</code>  -1  0. <br><br>          ,   ,     -    , ,    <code>if ... fi</code> . <br><br><pre> <code class="bash hljs">i=0 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ((i++)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ((i--)) <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$i</span></span> <span class="hljs-comment"><span class="hljs-comment"># Prints 1</span></span></code> </pre><br>       Bourne: <br><br><pre> <code class="bash hljs"><span class="hljs-literal"><span class="hljs-literal">true</span></span> &amp;&amp; { <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } || { <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br>      ¬´true¬ª  ¬´false¬ª,    ¬´true¬ª. <br><br><a name="23"></a><h1> 23. echo ¬´Hello World!¬ª </h1><br>    Bash (  4.3),   : <br><br><pre> <code class="bash hljs">bash: !<span class="hljs-string"><span class="hljs-string">": event not found</span></span></code> </pre><br>   ,        , Bash    (history expansion)   csh,   .      ,     .  ,   ¬´¬ª  : <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hi\!"</span></span> hi\!</code> </pre><br>   ‚Äî      <code>histexpand</code> .      <code>set +H</code>  <code>set +o histexpand</code> : <br><br> <b>:</b>    <code>histexpand</code> ,   ? <br><br> <i>     ,        </i> <br><br><pre> <code class="bash hljs">mp3info -t <span class="hljs-string"><span class="hljs-string">"Don't Let It Show"</span></span> ... mp3info -t <span class="hljs-string"><span class="hljs-string">"Ah! Leah!"</span></span> ...</code> </pre><br> <i>    ,        .        .  ,       ,   .      .        ,   </i> <code>~/.bashrc. --</code> <a href="http://mywiki.wooledge.org/GreyCat">GreyCat</a> <br><br>   : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Hello World!'</span></span></code> </pre><br>  Or <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> +H <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Hello World!"</span></span></code> </pre><br>  Or <br><br><pre> <code class="bash hljs">histchars=</code> </pre><br>    <code>set +H</code>  <code>set +o histexpand</code>   <code>~/.bashrc</code> ,     .   , ,    . <br><br>  : <br><br><pre> <code class="bash hljs">exmark=<span class="hljs-string"><span class="hljs-string">'!'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Hello, world</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$exmark</span></span></span><span class="hljs-string">"</span></span></code> </pre><br>  Bash 4.3  ,    <code>!</code>     .        ,    <code>echo "Hello World!"</code> ,     : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Hello, World!(and the rest of the Universe)"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"foo!'bar'"</span></span></code> </pre><br><a name="24"></a><h1> 24. for arg in $* </h1><br> Bash (   Bourne-)         ,    .  <code>$*</code> ,   <code>$@</code> .          ,      .  : <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> arg <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$@</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-comment"><span class="hljs-comment">#  : for arg</span></span></code> </pre><br>         , <code>for arg</code>     <code>for arg in "$@"</code> .     <code>"$@"</code> ‚Äî   ,         (   ).      99% . <br><br>  Example: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   for x in $*; do echo "parameter: '$x'" done $ ./myscript 'arg 1' arg2 arg3 parameter: 'arg' parameter: '1' parameter: 'arg2' parameter: 'arg3'</span></span></code> </pre><br>   : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   for x in "$@"; do echo "parameter: '$x'" done #  : for x; do echo "parameter: '$x'" done $ ./myscript 'arg 1' arg2 arg3 parameter: 'arg 1' parameter: 'arg2' parameter: 'arg3'</span></span></code> </pre><br><a name="25"></a><h1> 25. function foo() </h1><br>     ,    .    <b></b>     <code>function</code>    <code>()</code> . Bash (   )   .        (, zsh 4.x , , ).    <code>function foo</code> ,      : <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span></span>() { ... }</code> </pre><br><a name="26"></a><h1> 26. echo "~" </h1><br>       ,  '~'    .    echo   stdout '~',      .    ,      ,    $HOME,   '~'.  ,  $HOME ‚Äî  "/home/my photos". <br><br><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">"~/dir with spaces"</span></span> <span class="hljs-comment"><span class="hljs-comment">#   "~/dir with spaces" ~"/dir with spaces" #   "~/dir with spaces" ~/"dir with spaces" #   "/home/my photos/dir with spaces" "$HOME/dir with spaces" #   "/home/my photos/dir with spaces"</span></span></code> </pre><br><a name="27"></a><h1> 27. local varname=$(command) </h1><br>      , <code>local</code>    .       . ,       ( <code>$?</code> )  ,      .      .     : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">local</span></span> varname varname=$(<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>) rc=$?</code> </pre><br>      . <br><br><a name="28"></a><h1> 28. export foo=~/bar </h1><br>      , ‚Äî     ‚Äî      <a href="http://mywiki.wooledge.org/TildeExpansion">   </a> (     ).     ,        <code>=</code> . <br><br>   <code>export</code>  <code>local</code> <b>  </b> .      ( Bash) <code>export foo=~/bar</code>     ,    ( dash) ‚Äî . <br><br><pre> <code class="bash hljs">foo=~/bar; <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> foo <span class="hljs-comment"><span class="hljs-comment"># ! export foo="$HOME/bar" # !</span></span></code> </pre><br><a name="29"></a><h1> 29. sed 's/$foo/good bye/' </h1><br>       <code>$foo</code>  .     ‚Äî      <code>$</code> .   : <br><br><pre> <code class="bash hljs">foo=<span class="hljs-string"><span class="hljs-string">"hello"</span></span>; sed <span class="hljs-string"><span class="hljs-string">"s/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$foo</span></span></span><span class="hljs-string">/good bye/"</span></span></code> </pre><br>  :         escapes.      ¬´ <a href="http://mywiki.wooledge.org/Quotes"></a> ¬ª. <br><br><a name="30"></a><h1> 30. tr [AZ] [az] </h1><br>     .  : <code>[AZ]</code>  <code>[az]</code>    .          ,    ,    .  ,    . ,  3   . <br><br>  :        <code>tr</code> . ,  '['   '[',  -   AZ  az,   ']'  ']'.         ,     . <br><br>     ,     , AZ  az      26 ASCII-.     z   !    ,   : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ,    26   LC_COLLATE=C tr AZ az # ,        .       tr '[:upper:]' '[:lower:]'</span></span></code> </pre><br>      ,   . <br><br><a name="31"></a><h1> 31. ps ax | grep gedit </h1><br>     ,        .      gedit.   - ,   gedit (      ).   ,   <a href="http://mywiki.wooledge.org/ProcessManagement"> </a> .   PID gedit (),    <br><br><pre> <code class="bash hljs">$ ps ax | grep gedit 10530 ? S 6:23 gedit 32118 pts/0 R+ 0:00 grep gedit</code> </pre><br>  ,    <a href="http://mywiki.wooledge.org/RaceCondition">Race Condition</a> ,       grep.   : <br><br><pre> <code class="bash hljs">ps ax | grep -v grep | grep gedit <span class="hljs-comment"><span class="hljs-comment"># ,   </span></span></code> </pre><br><br> : <br><br><pre> <code class="bash hljs">ps ax | grep <span class="hljs-string"><span class="hljs-string">'[g]edit'</span></span> <span class="hljs-comment"><span class="hljs-comment">#   ,   shell GLOB</span></span></code> </pre><br> Grep     ,    <code>[g]edit</code> , <code>grep</code>     <code>gedit</code> . <br><br>  GNU/Linux  ‚ÄìC       : <br><br><pre> <code class="bash hljs">$ ps -C gedit PID TTY TIME CMD 10530 ? 00:06:23 gedit</code> </pre><br>   ,    <code>pgrep</code> ? <br><br><pre> <code class="bash hljs">$ pgrep gedit 10530</code> </pre><br>    PID     <code>awk</code>  <code>cut</code> : <br><br><pre> <code class="bash hljs">$ ps -C gedit | awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span> | tail -n1</code> </pre><br>           <code>ps</code> : <br><br><pre> <code class="bash hljs">$ ps -C gedit -opid= 10530</code> </pre><br>     1992     <code>pgrep</code> ,    ,    <code>pidof</code> (  GNU/Linux): <br><br><pre> <code class="bash hljs">$ pidof gedit 10530</code> </pre><br>     PID,   ,     <code>pkill</code> .   , , , <code>pgrep/pkill ssh</code>      sshd,     . <br><br>  ,       . , Firefox    firefox-bin.        , , <b>ps ax | grep firefox</b> .       pgrep: <br><br><pre> <code class="bash hljs">$ pgrep -fl firefox 3128 /usr/lib/firefox/firefox 7120 /usr/lib/firefox/plugin-container /usr/lib/flashplugin-installer/libflashplayer.so -greomni /usr/lib/firefox/omni.ja 3128 <span class="hljs-literal"><span class="hljs-literal">true</span></span> plugin</code> </pre><br>   <a href="http://mywiki.wooledge.org/ProcessManagement"> </a> .  Seriously. <br><br><a name="32"></a><h1> 32. printf "$foo" </h1><br>      ,     .  <code>$foo</code>      ,      <code>\</code>  <code>%</code>     .     : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> %s <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$foo</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> <span class="hljs-string"><span class="hljs-string">'%s\n'</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$foo</span></span></span><span class="hljs-string">"</span></span></code> </pre><br><a name="33"></a><h1> 33. for i in {1..$n} </h1><br> <a href="http://mywiki.wooledge.org/BashParser"> Bash</a>    <b></b>    .       <code>$n</code> ,    ,         .          ,       runtime.   : <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ((i=1; i&lt;=n; i++)); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br>              <code>for</code> ,     ,          (pre-expands),        . <br><br><a name="34"></a><h1> 34. if [[ $foo = $bar ]] (   ) </h1><br>      ,     <code>=</code>  [[,  Bash     ,     .       <code>bar</code>   *,    <b></b> true.         ,      : <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">$foo</span></span> = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$bar</span></span></span><span class="hljs-string">"</span></span> ]]</code> </pre><br>      ,       , ,     .   . <br><br>   ,         <code>=~</code> ,     <b></b>    ,      .      . <br><br><a name="35"></a><h1> 35. if [[ $foo =~ 'some RE' ]] </h1><br>        ,    .         ,       ,     : <br><br><pre> <code class="bash hljs">re=<span class="hljs-string"><span class="hljs-string">'some RE'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">$foo</span></span> =~ <span class="hljs-variable"><span class="hljs-variable">$re</span></span> ]]</code> </pre><br>        <code>=~</code>    Bash.         . <br><br>          <code>[[</code> : <br><br><pre> <code class="bash hljs">[[ <span class="hljs-variable"><span class="hljs-variable">$foo</span></span> = <span class="hljs-string"><span class="hljs-string">"*.glob"</span></span> ]] <span class="hljs-comment"><span class="hljs-comment"># Wrong! *.glob is treated as a literal string. [[ $foo = *.glob ]] # Correct. *.glob is treated as a glob-style pattern.</span></span></code> </pre><br><a name="36"></a><h1> 36. [ -n $foo ] or [ -z $foo ] </h1><br>   <code>[</code> ,  <b></b>       .    <code>$foo</code>    0 ,  42 ,    ,  1,   . <br><br><pre> <code class="bash hljs">[ -n <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$foo</span></span></span><span class="hljs-string">"</span></span> ] [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$foo</span></span></span><span class="hljs-string">"</span></span> ] [ -n <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$( -   "$file")</span></span></span><span class="hljs-string">"</span></span> ] <span class="hljs-comment"><span class="hljs-comment"># [[          ,      : [[ -n $foo ]] [[ -z $foo ]]</span></span></code> </pre><br><a name="37"></a><h1> 37. [[ -e "$broken_symlink" ]]  1    $broken_symlink </h1><br> Test   symlink', ,  symlink , ‚Äî ,   ,        , ‚Äî  <code>test ‚Äìe</code>  1,    symlink.    (   ), : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># bash/ksh/zsh [[ -e "$broken_symlink" || -L "$broken_symlink" ]] # POSIX sh+test [ -e "$broken_symlink" ] || [ -L "$broken_symlink" ]</span></span></code> </pre><br><a name="38"></a><h1> 38.  ed file &lt;&lt;&lt;¬´g/d\{0,3\}/s//e/g¬ª </h1><br>   ,  ed   0  \{0,3\}.  ,    : <br><br><pre> <code class="bash hljs">ed file &lt;&lt;&lt;<span class="hljs-string"><span class="hljs-string">"g/d\{1,3\}/s//e/g"</span></span></code> </pre><br>  ,        POSIX-,  BRE (  ,  ed), <a href="http://www.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap09.html">  0      (.  5)</a> . <br><br><a name="39"></a><h1> 39.   (sub-string) expr  ¬´match¬ª </h1><br>    ‚Ä¶   <br><br><pre> <code class="bash hljs">word=abcde expr <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$word</span></span></span><span class="hljs-string">"</span></span> : <span class="hljs-string"><span class="hljs-string">".\(.*\)"</span></span> bcde</code> </pre><br>    ¬´match¬ª   <br><br><pre> <code class="bash hljs">word=match expr <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$word</span></span></span><span class="hljs-string">"</span></span> : <span class="hljs-string"><span class="hljs-string">".\(.*\)"</span></span></code> </pre><br>   ,  ¬´match¬ª ‚Äî  .  GNU       '+' <br><br><pre> <code class="bash hljs">word=match expr + <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$word</span></span></span><span class="hljs-string">"</span></span> : <span class="hljs-string"><span class="hljs-string">".\(.*\)"</span></span> atch</code> </pre><br>      <code>expr</code> . ,    ,        ( <a href="http://mywiki.wooledge.org/BashFAQ/073">Parameter Expansion</a> ). ,      ?  POSIX-          (Substring Expansion): <br><br><pre> <code class="bash hljs">$ word=match $ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${word#?}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-comment"><span class="hljs-comment"># PE atch $ echo "${word:1}" # SE atch</span></span></code> </pre><br> ,   <code>expr</code>    ,       Solaris     POSIX <code>/bin/sh</code> .   ,      ,    .      ,     ,   ,          . <br><br><a name="40"></a><h1> 40.  UTF-8     (Byte-Order Marks, BOM) </h1><br> <b> :</b>  Unix    UTF-8   BOM.     , MIME-   .   BOM       UTF-8,     ,    ( -  )    ,      ,  ,     . ,    BOM,   ,   ,       MS-DOS. <br><br> <b>  :</b> ,  UTF-8    8- ,  BOM       ,  ,       ASCII-,  "#!"    Unix-¬ª. <br><br> <a href="http://unicode.org/faq/utf_bom.html">http://unicode.org/faq/utf_bom.html#bom5</a> <br><br><a name="41"></a><h1> 41. content=$(&lt;file) </h1><br>      ,  ,     ( : <code>`...`</code> , <code>$(...)</code> , <code>$(&lt;file)</code> , <code>`&lt;file`</code>  <code>${ ...; }</code> (ksh))     . ,     ,        ,      ,    ,   ,       .     ,   :         . <br><br><pre> <code class="bash hljs">absolute_dir_path_x=$(readlink -fn -- <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dir_path</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> x) absolute_dir_path=<span class="hljs-variable"><span class="hljs-variable">${absolute_dir_path_x%x}</span></span></code> </pre><br>  ,    :  <code>read</code>   . <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Ksh (or bash 4.2+ with lastpipe enabled) readlink -fn -- "$dir_path" | IFS= read -rd '' absolute_dir_path</span></span></code> </pre><br>     ,  <code>read</code>    false,     NUL-,       .       ‚Äî  <code>PIPESTATUS</code> .     NUL-,   <code>read</code>  true,   <code>pipefail</code> . <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -o pipefail { readlink -fn -- <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dir_path</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> <span class="hljs-string"><span class="hljs-string">'\0x'</span></span>; } | IFS= <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -rd <span class="hljs-string"><span class="hljs-string">''</span></span> absolute_dir_path</code> </pre><br>    : Bash  <code>pipefail</code>  <code>PIPESTATUS</code> , ksh93 ‚Äî  <code>pipefail</code> ,    mksh  <code>pipefail</code> ,    ‚Äî  <code>PIPESTATUS</code> .  ,     ksh93,   <code>read</code>   NUL-. <br><br><a name="42"></a><h1> 42. for file in ./*; do if [[ $file != *.* ]] </h1><br>             ,      (.  3).            <code>./</code> . <br><br>       <code>*.*</code> ,       <code>./filename</code> .            . ,        (,        ,    ),      : <code>[[ $file != ./*.* ]]</code> ,   . <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Bash shopt -s nullglob for path in ./*; do [[ ${path##*/} != *.* ]] &amp;&amp; rm "$path" done #    for file in *; do [[ $file != *.* ]] &amp;&amp; rm "./${file}" done #    for file in *.*; do rm "./${file}" done</span></span></code> </pre><br>       ‚Äî   <code>--</code> (   3). <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">shopt</span></span> -s nullglob <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> *; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">$file</span></span> != *.* ]] &amp;&amp; rm -- <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$file</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br><a name="43"></a><h1> 43. somecmd 2&gt;&amp;1 &gt;&gt;logfile </h1><br> ,    ,   ,   ,        stdout  stderr.       ,  stderr      .        ,    ,     <a href="http://wiki.bash-hackers.org/howto/redirection_tutorial"></a>  <a href="http://mywiki.wooledge.org/FileDescriptor"> </a> .    ,   .     : ¬´    ,      (tty),       -¬ª.    .      tty.  : <br><br><pre> <code class="bash hljs">somecmd &gt;&gt;logfile 2&gt;&amp;1</code> </pre><br>  <a href="http://mywiki.wooledge.org/BashFAQ/055">  </a> , <a href="http://wiki.bash-hackers.org/scripting/copydescriptor">   Copy</a>  <a href="http://mywiki.wooledge.org/BashGuide/InputAndOutput">BashGuide ‚Äî redirection</a> . <br><br><a name="44"></a><h1> 44. cmd; ((! $? )) || die </h1><br> <code>$?</code>   ,        .      ,       (   ),    , : <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cmd; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br>           : <br><br><pre> <code class="bash hljs">cmd status=$? <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$status</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> success &gt;&amp;2 ;; 1) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Must supply a parameter, exiting.'</span></span> &gt;&amp;2 <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 1 ;; *) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Unknown error </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$status</span></span></span><span class="hljs-string">, exiting."</span></span> &gt;&amp;2 <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$status</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span></code> </pre><br><a name="45"></a><h1> 45. y=$(( array[$x] )) </h1><br>  POSIX    (arithmetic expansion) <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html"></a> (      ),     (array subscript)        . ,   ,  . <br><br><pre> <code class="bash hljs">$ x=<span class="hljs-string"><span class="hljs-string">'$(date &gt;&amp;2)'</span></span> <span class="hljs-comment"><span class="hljs-comment">#    ,  ,   $ y=$((array[$x])) #      Mon Jun 2 10:49:08 EDT 2014</span></span></code> </pre><br>     : <br><br><pre> <code class="bash hljs">$ y=$((array[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$x</span></span></span><span class="hljs-string">"</span></span>])) Mon Jun 2 10:51:03 EDT 2014</code> </pre><br>   : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># 1.  $x,       . $ y=$((array[\$x])) # 2.    ${array[$x]}. $ y=$((${array[$x]}))</span></span></code> </pre><br><a name="46"></a><h1> 46. read num; echo $((num+1)) </h1><br>     (. <a href="http://mywiki.wooledge.org/BashFAQ/054">BashFAQ/054</a> ),    num   ,       . <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'a[$(echo injection &gt;&amp;2)]'</span></span> | bash -c <span class="hljs-string"><span class="hljs-string">'read num; echo $((num+1))'</span></span> injection 1</code> </pre><br><a name="47"></a><h1> 47. IFS=, read -ra fields &lt;&lt;&lt; "$csv_line" </h1><br>    ,  POSIX   <a href="http://mywiki.wooledge.org/IFS">IFS</a>     (field terminator),     .     ,         ,    : <br><br><pre> <code class="bash hljs">$ IFS=, <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -ra fields &lt;&lt;&lt; <span class="hljs-string"><span class="hljs-string">"a,b,"</span></span> $ <span class="hljs-built_in"><span class="hljs-built_in">declare</span></span> -p fields <span class="hljs-built_in"><span class="hljs-built_in">declare</span></span> -a fields=<span class="hljs-string"><span class="hljs-string">'([0]="a" [1]="b")'</span></span></code> </pre><br>    ?      (¬´    ¬ª).       Bash,     .    : <br><br><pre> <code class="bash hljs">$ IFS=, <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -ra fields &lt;&lt;&lt; <span class="hljs-string"><span class="hljs-string">"a,b,c"</span></span> $ <span class="hljs-built_in"><span class="hljs-built_in">declare</span></span> -p fields <span class="hljs-built_in"><span class="hljs-built_in">declare</span></span> -a fields=<span class="hljs-string"><span class="hljs-string">'([0]="a" [1]="b" [2]="c")'</span></span></code> </pre><br>      ?   ,  IFS-        .    ,   IFS- ¬´¬ª ,    .     ,  IFS-  ,  ,   . <br><br><pre> <code class="bash hljs">$ input=<span class="hljs-string"><span class="hljs-string">"a,b,"</span></span> $ IFS=, <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -ra fields &lt;&lt;&lt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$input</span></span></span><span class="hljs-string">,"</span></span> $ <span class="hljs-built_in"><span class="hljs-built_in">declare</span></span> -p fields <span class="hljs-built_in"><span class="hljs-built_in">declare</span></span> -a fields=<span class="hljs-string"><span class="hljs-string">'([0]="a" [1]="b" [2]="")'</span></span></code> </pre><br><a name="48"></a><h1> 48. export CDPATH=.:~/myProject </h1><br>   CDPATH.  CDPATH  .bashrc   ,     ,   Bash-  sh-,  <code>cd</code> ,    .   . ,  : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> some/dir || <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> cmd to be run <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> some/dir</code> </pre><br>     <code>./some/dir</code>  <code>~/myProject/some/dir</code> ,    ,      .   <code>cd</code>      ,        ,     ,  . <br><br>   ‚Äî  <code>cd</code>   ,    : <br><br><pre> <code class="bash hljs">output=$(<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> some/dir &amp;&amp; some <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>)</code> </pre><br>  CDPATH ,      <code>cd</code>   stdout   <code>/home/user/some/dir</code> ,  ,     CDPATH,          <code>some command</code> . <br><br>      CDPATH,   ,    <code>./</code>   .       <code>unset CDPATH</code> ,   ,        ,     CDPATH. </div><p>Source: <a href="https://habr.com/ru/post/311762/">https://habr.com/ru/post/311762/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311752/index.html">How to choose the best RKO when opening a business</a></li>
<li><a href="../311754/index.html">‚ÄúAdmin: password‚Äù problem: standard passwords helped create a botnet from almost 400,000 IoT devices</a></li>
<li><a href="../311756/index.html">We launch a simple blog on Wagtail CMS (Django) - part 2</a></li>
<li><a href="../311758/index.html">EBU R128 / BS.1770-3: Batch Normalization of Audio / Video File Volume</a></li>
<li><a href="../311760/index.html">Network monitoring with FlapMyPort</a></li>
<li><a href="../311764/index.html">Analytics for the theater industry - a new niche for startups</a></li>
<li><a href="../311766/index.html">The evolution of mobile slang: when will graphics replace words?</a></li>
<li><a href="../311768/index.html">A selection of useful materials on the development of Xamarin</a></li>
<li><a href="../311770/index.html">JSOC availability: metrics and measurement</a></li>
<li><a href="../311772/index.html">Patent hysteria: how to stop being afraid of journalistic prejudices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>