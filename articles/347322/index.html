<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Not a feature, but a bug</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="December 22, 2017 - VKontakte rolled out an interesting upgrade of its own iOS application. Here is a news agency quote regarding specific changes: 
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Not a feature, but a bug</h1><div class="post__text post__text-html js-mediator-article">  December 22, 2017 - VKontakte rolled out an interesting upgrade of its own iOS application.  Here <a href="https://ria.ru/technology/20171222/1511505601.html">is a</a> news agency <a href="https://ria.ru/technology/20171222/1511505601.html">quote</a> regarding specific changes: <br><blockquote>  The new version of VKontakte for iOS and Android now supports Accelerated Mobile Pages (AMP), a mobile standard that allows you to quickly load external articles.  Now the pages of all sites that have configured AMP, open right inside the application. </blockquote>  ( <a href="https://vk.com/blog/amp">official news</a> ) <br><br>  Technology AMP, the development of which was initiated by Google, is designed to accelerate the work of websites on all devices and platforms.  This is a modern approach to optimizing HTML and CSS, allowing you to speed up loading on devices using the preconnect API and asynchronous execution of Javascript. <br><a name="habracut"></a><br>  AMP tries to preload the contents of a supported page using the platform on which you see the link - a social network or instant messenger.  When you simply scroll updates, AMP pages are loaded in the background, when you click on the link, the page opens on your mobile device almost instantly. <br><br>  AMP has a <a href="https://www.ampproject.org/ru/">page</a> with a detailed description, a bunch of manuals and instructions, however, the developers of the VKontakte iOS application managed to build a howitzer from, in fact, a children's designer (the basic implementation of AMP) and charge it with warheads (an iOS application bug). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We do not know exactly what happened on VKontakte when introducing AMP into an iOS application.  The Android version of the application does not have this problem. <br><br>  As a company that primarily deals with denial of service attacks, we carefully monitor the traffic of our customers.  Some of them (we will not name specific names in this publication, all persons associated with this incident were informed) informed us about traffic anomalies, which motivated Qrator Labs to look deeper into the logs. <br><br>  What we found impressed us.  One of the largest social networks, available in 80 languages, with more than 400 million accounts, actually implemented DDoS on some resources, mainly news agencies and those companies that aggressively export news to Vkontakte.  Because of a banal error in a single implementation of AMP for iOS. <br><br>  Fortunately, VKontakte uses either a new or rarely used user agent to preload pages: <br><br><pre><code class="hljs pgsql">VK/<span class="hljs-number"><span class="hljs-number">74</span></span> CFNetwork/&lt;cfn <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>&gt; Darwin/&lt;ios <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>&gt;</code> </pre> <br>  Part of our anonymized statistics looks like this. <br><br>  <i>Large news agency with several servers</i> : <br><br><ul><li>  up to 20% of the total response time was spent on these requests from 2% (of all unique) IP with this application </li><li>  up to 16% of all requests from the application </li><li>  50-66% of all requests from 8-15% of all IP, 65-77% of the total response time </li><li>  up to 25% of all requests </li><li>  up to 18% of all requests </li></ul><br>  <i>Retailer</i> : <br><br><ul><li>  91-98% of all requests from 15-31% (of all unique) IP with this user agent, up to 33% of the time to process these requests </li></ul><br>  <i>Media company</i> : <br><br><ul><li>  13-46% of all requests from 1-5% IP </li></ul><br>  <i>News Agency</i> : <br><br><ul><li>  up to 12% of all requests </li></ul><br>  What happens on these servers? <br>  When a page that supports AMP appears in the user's tape of an iOS application on VKontakte, in some cases the application makes up to 5,000 requests with this user agent, which in itself is a classic example of a DDoS attack.  Since there are a lot of users in the world, and technologies like AMP and other ‚Äúinstant view‚Äù are quickly spread and implemented by a wide variety of resources (eBay), the number of such links will only grow. <br><br>  The danger of this bug is estimated by us as average, since we are mainly talking about light and cached pages that do not require significant server resources to issue.  But for the pages generated for each request, this situation can be painful. <br><br>  More importantly, there is no normal way to stop publishing AMP-compatible links on the social network.  VKontakte (the representative of which we contacted before publishing) will fix this bug, but no one forbids the attacker or just passing by to find this opportunity for a more interesting application.  Before releasing VKontakte iOS applications, make sure that the pages you submit with AMP support are cached. <br><br>  VKontakte is doing a great job providing its users with the latest technology.  Special thanks to Sergey Paranko, the director of the VKontakte media ecosystem, who responded to our request, saying that this problem will be fixed. </div><p>Source: <a href="https://habr.com/ru/post/347322/">https://habr.com/ru/post/347322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347306/index.html">TypeScript real-time applications: chat development using WebSocket, Node and Angular</a></li>
<li><a href="../347312/index.html">IT infrastructure of Navalny headquarters and collection of signatures: preparation for collection, site ‚ÄúBulk 20! 8‚Äù</a></li>
<li><a href="../347314/index.html">"Fall" LKML.org: the cause of failure - the old home server</a></li>
<li><a href="../347316/index.html">IT infrastructure of Navalny headquarters and collection of signatures: hardware and networks</a></li>
<li><a href="../347320/index.html">Navalny Headquarters IT infrastructure and collection of signatures: Reaper-2018</a></li>
<li><a href="../347324/index.html">Risks of using virtual number services for receiving SMS when registering on Internet resources</a></li>
<li><a href="../347328/index.html">Creating parametric database objects in nanoCAD Mechanics (Part 2)</a></li>
<li><a href="../347330/index.html">Developing AI for a turn-based game on Node.js (part 2)</a></li>
<li><a href="../347332/index.html">We read data from the open part of KOMPAS-3D files for integration with Pilot-ICE</a></li>
<li><a href="../347338/index.html">The obvious benefit: how and why to use the service approach beyond IT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>