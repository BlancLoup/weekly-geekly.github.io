<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mirror ESET Update Server on Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Each of you who have to keep a corporate linux server may be confronted with the fact that the noticed ESET antivirus does not have an update server f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mirror ESET Update Server on Linux</h1><div class="post__text post__text-html js-mediator-article">  Each of you who have to keep a corporate linux server may be confronted with the fact that the noticed ESET antivirus does not have an update server for linux; by ourselves.  The topic does not claim to be new, this question has been sufficiently considered on the Internet, however, I did not come across any good solutions, let's bring the script to the mind.  Our script should be able to find new passwords to official servers on the Internet and support the bases for the entire product line, such as Smart Security, Business Edition, Home Edition, Exchange Server. <br>  Let us leave the legitimacy of these actions on your conscience, the article is given to familiarize with the features of updating antivirus databases, and is not a guide to the violation of the law.  To avoid violations, you should use only the <i>Evaluation License</i> from ESET. <br>  So, neonka vnutre: <br><a name="habracut"></a><br><h5>  0. Scene </h5><br>  Imagine that we have a home directory /var/www/site.ru/web, which is the DocumentRoot for your virtualhost.  We mean that we put all the files there, unless otherwise stated.  Therefore, if we want to run the script via cron, at the beginning of our main script we need to put the following actions. <br> <code>CURDIR=/var/www/site.ru/web <br> cd $CURDIR</code> <br> <br><h5>  1. Where to get license accounts? </h5><br>  I came across a multi-megabyte creation under the approximate name ‚ÄúEset Password Finder‚Äù, I don‚Äôt remember exactly.  It is difficult to find a much more effective way to distribute malware to anti-virus users.  Skimming through the exe-shnik hex-viewer, a link to the Chinese site http://www.nnvv.org was found in the characters, where daily fresh passwords are laid out.  Let's write a simple parser that outputs a couple of variables in the <i>bash</i> format: <br> <code>USERNAME=EAV-xxx <br> PASSWORD=xxx</code> <br>  Let's not invent a bicycle and produce entities, take the <a href="http://sourceforge.net/projects/simplehtmldom/">simplehtmldom PHP framework</a> to bypass the DOM tree.  Thanks to him, our script will take the following form: <br> <code>./getpass.php: <br> #!/usr/bin/php <br> &lt;?php <br> require('simple_html_dom.php'); //       <br> $html = file_get_html('http://www.nnvv.org/'); <br> $a=$html-&gt;getElementById("#nod32ids")-&gt;children(0)-&gt;children(0)-&gt;plaintext; <br> $a = str_replace("Username:", 'USERNAME=', $a); <br> $a = str_replace("Password:", 'PASSWORD=', $a); <br> echo $a."\n"; <br> ?&gt; <br></code>  <i>let's</i> make it executable <i>chmod 755 ./getpass.php</i> and <i>leave</i> it at that. <br><br><h5>  2. Creating the necessary directories </h5><br> <code>mkdir -p ./download/engine3 <br> mkdir -p ./download/engine3ess <br> mkdir -p ./eset_upd <br> mkdir -p ./download/win/emsx <br> mkdir -p ./download/win/v3eav <br> mkdir -p ./download/win/v3ess <br> mkdir -p ./download/win/v3eav/pre <br> mkdir -p ./download/win/v3ess/pre</code> <br>  The structure completely repeats the hierarchy of directories on official servers. <br><br><h5>  3. Getting information about updates </h5><br>  Data on current databases is stored in the file http://update.eset.com/eset_upd/update.ver and is packed with the old <a href="https://gna.org/projects/unrar">free archiver unrar-0.0.1</a> , which, however, is incompatible with <a href="http://rarsoft.com/download.htm">Roshalovsky</a> .  Download <a href="">unrar-0.0.1</a> , compile, after compilation put unrar binary in our directory of our locale.  After unpacking, <i>update.ver</i> can be parsed by generating lists of update file URLs. <br> <code>wget -q --timestamping http://update.eset.com/eset_upd/update.ver <br> mv -f update.ver update.rar <br> cd eset_upd <br> ../unrar e -f -y -c- ../update.rar 2&gt;&amp;1 &gt;/dev/null <br> cd .. <br> mv -f update.rar update.ver <br> grep file= $CURDIR/eset_upd/update.ver |grep "engine3/"| sed -e 's/file\=/http\:\/\/um10.eset.com/' |grep -v data &gt; downlist1.txt <br> grep file= $CURDIR/eset_upd/update.ver |grep engine3ess| sed -e 's/file\=/http\:\/\/um10.eset.com/' |grep -v data &gt; downlist2.txt <br> grep file= $CURDIR/eset_upd/update.ver |grep emsx| sed -e 's/file\=/http\:\/\/um10.eset.com/' |grep -v data &gt; downlist5.txt <br> grep file= $CURDIR/eset_upd/update.ver |grep v3eav|grep -v pre| sed -e 's/file\=/http\:\/\/um10.eset.com/' |grep -v data &gt; downlist3.txt <br> grep file= $CURDIR/eset_upd/update.ver |grep v3ess|grep -v pre| sed -e 's/file\=/http\:\/\/um10.eset.com/' |grep -v data &gt; downlist4.txt <br> grep file= $CURDIR/eset_upd/update.ver |grep v3eav|grep pre| sed -e 's/file\=/http\:\/\/um10.eset.com/' |grep -v data &gt; downlist6.txt <br> grep file= $CURDIR/eset_upd/update.ver |grep v3ess|grep pre| sed -e 's/file\=/http\:\/\/um10.eset.com/' |grep -v data &gt; downlist7.txt</code> <br> <br><h5>  4. Get updates </h5><br>  We rob fresh passwords with the help of the PHP script that we made earlier. <br> <code>./getpass.php &gt; ./pass.sh <br> sed -i 's/\r//' pass.sh #       ,  wget   --http-user=$USERNAME     . <br> source ./pass.sh</code> <br>  To get the databases, we use <i>wget</i> with the --timestamping parameter, which will allow us not to re-download already downloaded files.  For caution, use the official <i>--user-agent</i> , for authentication, use the usual pair <i>--http-user / - http-password</i> .  The file list for <i>wget</i> can be passed with the <i>--input-file =</i> parameter. <br> <code>wget --timestamping --http-user=$USERNAME --http-password=$PASSWORD --input-file=../../downlist1.txt --user-agent="ESS Update (Windows; U; 32bit; VDB 7001; BPC 4.0.474.0; OS: 5.1.2600 SP 3.0 NT; CH 0.0; LNG 1049; x32c; UPD http://um10.eset.com; APP ess; BEO 1; CPU 5964; ASP 0.0)" <br> cd ../engine3ess/ <br> wget --timestamping --http-user=$USERNAME --http-password=$PASSWORD --input-file=../../downlist2.txt --user-agent="ESS Update (Windows; U; 32bit; VDB 7001; BPC 4.0.474.0; OS: 5.1.2600 SP 3.0 NT; CH 0.0; LNG 1049; x32c; UPD http://um10.eset.com; APP ess; BEO 1; CPU 5964; ASP 0.0)" <br> cd ../win/v3eav/ <br> wget --timestamping --http-user=$USERNAME --http-password=$PASSWORD --input-file=../../../downlist3.txt --user-agent="ESS Update (Windows; U; 32bit; VDB 7001; BPC 4.0.474.0; OS: 5.1.2600 SP 3.0 NT; CH 0.0; LNG 1049; x32c; UPD http://um10.eset.com; APP ess; BEO 1; CPU 5964; ASP 0.0)" <br> cd ../v3ess/ <br> wget --timestamping --http-user=$USERNAME --http-password=$PASSWORD --input-file=../../../downlist4.txt --user-agent="ESS Update (Windows; U; 32bit; VDB 7001; BPC 4.0.474.0; OS: 5.1.2600 SP 3.0 NT; CH 0.0; LNG 1049; x32c; UPD http://um10.eset.com; APP ess; BEO 1; CPU 5964; ASP 0.0)" <br> cd ../emsx/ <br> wget --timestamping --http-user=$USERNAME --http-password=$PASSWORD --input-file=../../../downlist5.txt --user-agent="ESS Update (Windows; U; 32bit; VDB 7001; BPC 4.0.474.0; OS: 5.1.2600 SP 3.0 NT; CH 0.0; LNG 1049; x32c; UPD http://um10.eset.com; APP ess; BEO 1; CPU 5964; ASP 0.0)" <br> cd ../v3eav/pre/ <br> wget --timestamping --http-user=$USERNAME --http-password=$PASSWORD --input-file=../../../../downlist6.txt --user-agent="ESS Update (Windows; U; 32bit; VDB 7001; BPC 4.0.474.0; OS: 5.1.2600 SP 3.0 NT; CH 0.0; LNG 1049; x32c; UPD http://um10.eset.com; APP ess; BEO 1; CPU 5964; ASP 0.0)" <br> cd ../../v3ess/pre/ <br> wget --timestamping --http-user=$USERNAME --http-password=$PASSWORD --input-file=../../../../downlist7.txt --user-agent="ESS Update (Windows; U; 32bit; VDB 7001; BPC 4.0.474.0; OS: 5.1.2600 SP 3.0 NT; CH 0.0; LNG 1049; x32c; UPD http://um10.eset.com; APP ess; BEO 1; CPU 5964; ASP 0.0)"</code> <br> <br>  It's all.  Do not forget the resulting script (let's call it <i>nodupdate.sh</i> , for example) register in cron <br> <code># sudo crontab -e <br> 50 * * * * /var/www/site.ru/web/nodupdate.sh 2&gt; /dev/null</code> <br> <br><h5>  5. Configure the client </h5><br><ul><li>  Call the antivirus window </li><li>  Press F5, the <i>Advanced setup</i> settings window appears. </li><li>  Update - Update server - Edit - Add </li><li>  Add a line <i>http://site.ru</i> if we worked in DocumentRoot, then the update location is like a root, that is <i>/</i> and not <i>/ mirror /</i> or <i>/ update /</i> , as it happens in some places. </li><li>  Click OK. </li><li>  For greater importance, clear <i>update cache</i> .  The fact is that an unclean update cache may cause the antivirus to stop updating at times. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  6. Summary </h5><br>  The full text of the script can be <a href="http://pastebin.com/eX4QdhTb">found on Pastebin</a> . <br><br>  As it turned out, no special tools or special knowledge are required to make your own mirror of updates.  It should be understood that the purpose of this post is only familiarization with the features of the system of updates of ESET products, and the goal of the solution is only to save corporate traffic, and in no case is there a way to break the law.  In theory, to use this script, you must have legally acquired licenses for all copies of antivirus updated from a mirror, this remains on your conscience.  You can rewrite the code so that it only looks for the <i>Evaluation License</i> , which, it seems, is quite legal to use.  One acquaintance has been using this decision for three years now, practically without any changes.  The weight of all updates will be somewhere around 300 megabytes, taking into account subsequent downloads can grow to 700-900 meters.  Every six months, you can delete database files to get rid of obsolete files.  The format of the <i>update.ver</i> file itself is very simple, divided into sections, from there you can find out the entire directory structure on the server, and after the release of new ESET products, simply add these paths to the script. <br><br>  <b>UPD 2012.04.24: Minor changes (thanks to <a href="https://habrahabr.ru/users/zombic/" class="user_link">zombic</a> y).</b> <br>  Instead of getpass.php use getpass.sh: <br>  $ cat getpass.sh <br><br>  #! / bin / sh <br><br>  curl <a href="http://www.nnvv.org/">www.nnvv.org</a> |  \ <br>  grep -A1 `date +% Y-% m-% d` |  \ <br>  awk '$ 9 ~ / Password / \ <br>  {if (sub (/ Username: /, "+ USERNAME =")) \ <br>  {if (sub (/ &lt;br \ /&gt; Password: /, "+ PASSWORD =")) \ <br>  {if (sub (/ &lt;\ / p&gt; /, "\ n")) {print $ 8 "\ n" $ 9}}}} '|  \ <br>  awk -F "+" '{print $ 2}'&gt; pass.sh <br><br>  The script takes the username / password for today's number. <br><br>  In the nodupdate.sh script, respectively, replace getpass.php with getpass.sh and comment the line <br>  sed -i 's / \ r //' pass.sh, <br>  it is not necessary. </div><p>Source: <a href="https://habr.com/ru/post/125367/">https://habr.com/ru/post/125367/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125360/index.html">Terms of Reference</a></li>
<li><a href="../125362/index.html">Do not use Java7 for anything.</a></li>
<li><a href="../125363/index.html">How we got to the Android Market</a></li>
<li><a href="../125364/index.html">FPGA clock with Quartus II and some Verilog</a></li>
<li><a href="../125366/index.html">A brief report from the development team of the webonmap.ru project</a></li>
<li><a href="../125368/index.html">Cisco Modular Command Line QoS</a></li>
<li><a href="../125369/index.html">Processes in the Linux operating system (basic concepts)</a></li>
<li><a href="../125371/index.html">Accelerating with Windows Azure Accelerator</a></li>
<li><a href="../125375/index.html">Deploying Nodejs DotCloud Applications</a></li>
<li><a href="../125376/index.html">Droider Show. Release # 2, Innovative</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>