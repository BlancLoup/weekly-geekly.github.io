<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A library for working with the Yandex.Money API and a demo Android application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, the community. 

 I want to share my development - an Android library for working with the Yandex.Money API. 

 Not later than April 1...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A library for working with the Yandex.Money API and a demo Android application</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, the community. <br><br>  I want to share my development - an Android library for working with the Yandex.Money API. <br><br>  Not later than April 15, Yandex opened an API for working with Money.  Like all previously open APIs for working with Yandex services, it is based on authorization through OAuth.  In the current implementation, the API allows you to request information about your account, request a list of transactions on the account and make payments using templates.  Details - in the <a href="http://api.yandex.ru/money/">documentation</a> , questions can be asked in <a href="http://clubs.ya.ru/moneyapi/">the developer club</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a result, a <a href="https://github.com/Olegas/YandexAPI">library</a> and a <a href="https://github.com/Olegas/YandexWalletDemoApp">demo application</a> for Android, working with the wallet through the API, was downloaded. <br><a name="habracut"></a><br>  Actually, the basis of the library regarding the Android application is the <a href="">OAuthActivity</a> class, from which you should inherit your Activity, which will perform the initial OAuth authorization of the application.  The result of the application authorization is the access token with which the <a href="">YandexMoneyService</a> class is <a href="">initialized</a> which, using this token, can perform the following actions (for now) <br><ul><li>  getAccountInfo: Request account information - API method <a href="">account-info</a> </li><li>  getOperationHistory: Queries operation history - <a href="">operation-history</a> API method </li></ul><br>  When called without arguments, the second method returns all operations (both enrollment and write-off).  Paging is not yet supported.  As an argument, it is possible to pass an object of the <a href="">YandexMoneyOperationTypes</a> class to specify a specific operation. <br><br>  There is also a storage of tokens.  To avoid requesting authorization each time the token can be saved.  To do this, use the heirs of the <a href="">AccessTokenStorage</a> class, namely, <a href="">SharedPreferencesStorage</a> and <a href="">EncryptedSharedPreferencesStorage</a> .  The second implementation differs in that it stores the token in the form encrypted using the 3DES algorithm. <br><br>  To use OAuth authorization, an application must define a descendant class of OAuthActivity by implementing the following methods in it: <br><ul><li>  getRequiredPermissions is a method that returns the set of rights required by the application.  For Yandex.Money, we use <a href="">YandexMoneyPermissions</a> container </li><li>  getClientId is the client identifier in the Yandex.Money system.  It will be issued at the <a href="">application registration</a> stage <a href="">.</a> </li><li>  getAppId - application identifier.  Used to compose the redirect_uri address, it actually identifies the application when processing the authorization response, it is better to set it = the application package name </li><li>  getServer is the server from which to request authorization </li><li>  getTokenStorage - returns tokens storage used to save the received authorization token </li></ul><br>  Success or authorization failure is reported by starting the Activity by sending Action == ‚Äúru.elifantiev.yandex.oauth.AUTH_RESULT‚Äù (see OAuthActivity.ACTION_AUTH_RESULT).  Intent is placed a sign of success (.AUTH_RESULT_EXTRA) equal AUTH_RESULT_OK or AUTH_RESULT_ERROR.  The error is placed in Extra .EXTRA_AUTH_RESULT_ERROR. <br><br>  Another important point.  For successful return processing from application authorization (and it, according to Yandex requirements, is performed in the OS built-in browser), processing by the OAuthActivity Intent heir described by the following filter is required: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.VIEW"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.DEFAULT"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.BROWSABLE"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scheme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"oauth"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:host</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_id"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  In fact, this is processing browser redirection to the URL oauth: // appId (where appId is the application identifier, the same as in the getAppId method, I have it stored in the application resources). <br><br>  About the demo app ... <br><br>  Consists of 3 Activity - <a href="">AppLoginActivity</a> , <a href="">AuthActivity</a> and <a href="">MainActivity</a> . <br><br>  AppLoginActivity at the first start of the application offers to undergo an application authorization procedure (it launches AuthActivity, which in turn is the heir of OAuthActivity).  If the application has already been authorized successfully - the PIN request dialog is displayed. <br><br>  Before undergoing the authorization procedure, AuthActivity requests the user a new PIN code, which will then be used to store the encrypted token, after which it starts the authorization. <br><br>  The result of the authorization comes back to AppLoginActivity where it is processed (an error message is displayed or the state is saved - authorization is passed).  In case of success, MainAcitivty is launched, which starts the call to services. <br><br>  What is the result ... I want to get criticism regarding the implementation, to collect complaints and suggestions, etc.  Those who want to drank it together - welcome. <br><br>  PS The author has nothing to do with Yandex and Yandex. Money has not. <br>  <b>EDIT</b> with the key lying in sortsah, the application will not start.  Register your application with an alternate redirect address and get your ID. </div><p>Source: <a href="https://habr.com/ru/post/117739/">https://habr.com/ru/post/117739/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117734/index.html">Chinese typewriter</a></li>
<li><a href="../117735/index.html">Capturing video from network cameras, part 2</a></li>
<li><a href="../117736/index.html">Mobile Shopping List</a></li>
<li><a href="../117737/index.html">What hosting do you use for your open source development? (you can specify several options)</a></li>
<li><a href="../117738/index.html">The Pirate Bay promotes new file sharing service</a></li>
<li><a href="../117740/index.html">Yahoo is rolling back its policy on storing user information</a></li>
<li><a href="../117742/index.html">Colleagues! Friends! Request to those freelancers who live and work in Moscow and St. Petersburg</a></li>
<li><a href="../117743/index.html">Opera Startup Awards</a></li>
<li><a href="../117745/index.html">Apple sued Samsung for copying iPhone and iPad</a></li>
<li><a href="../117746/index.html">Multi-camera video analytics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>