<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Programming ARM Controllers in Eclipse on Ubuntu: how to do it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the job I ran into the programming of the controller AT91SA7A3, for this IAR is used. But since I am lazy to keep the second system, an attempt was...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Programming ARM Controllers in Eclipse on Ubuntu: how to do it</h1><div class="post__text post__text-html js-mediator-article">  On the job I ran into the programming of the controller AT91SA7A3, for this IAR is used.  But since I am lazy to keep the second system, an attempt was made to ensure the possibility of programming, debugging and firmware under my beloved Ubuntu.  And now, after two weeks of communication with the wall through obscene vocabulary (the wallpaper started to move as much), I managed to set up this whole economy.  And since perhaps I will not be the only one, I will write how it is done. <br><a name="habracut"></a><br>  So, I had: an AT91SAM7A3-EK board, an Atmel SAM-ICE JTAG adapter, a computer with Ubuntu 11.04, half a pack of cigarettes and a couple of coffee mugs.  Good kit.  Go! <br><br>  1) Go to the Eclipse website (http://www.eclipse.org) and download the Eclipse IDE for C / C ++ Developers for our system.  The latest version is Eclipse 3.7 Indigo. <br>  2) We go to the site of the OpenOCD project (http://developer.berlios.de/projects/openocd/) and download the OpenOCD 0.5.0 sources. <br>  3) Follow the compiler.  I chose Sourcery G ++, since it is updated, unlike ARMGCC.  Download IA32 GNU / Linux TAR. <br>  4) Optional: as long as all of this is pumped out, you can go to smoke. <br>  5) Unpack the Eclipse archive into the directory we need (I have this / home / user / arm, the eclipse folder will appear). <br>  6) Extract the compiler archive to the correct directory (I have this / home / user / arm, the folder will appear arm-2011.03 or something like that, the numbers may differ). <br>  7) Go to Synaptic, install the usb-dev package, we will need it later. <br>  8) Unpack the archive with OpenOCD, better to the home folder, it will be a little easier with the paths. <br>  9) We start the terminal, jump to the folder with the source of OpenOCD (the one that just unpacked) and write the following commands: <br><br>  ./configure --enable-jlink <br>  sudo make <br>  sudo make install 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The --enable-jlink key is needed to enable support for our SAM-ICE, for this we also put a usb-dev sachet. <br>  10) Optional: while all this is going, you can go for coffee. <br>  11) Now we also write the following in the console: sudo gedit / etc / environment. <br>  In the opened file we add the path to our compiler, it should be approximately the following: <br>  PATH = "/ usr / local / sbin: / usr / local / bin: / usr / sbin: / usr / bin: / sbin: / bin: / usr / games: /home/user/arm/arm-2011.03/bin " <br>  Restart the car and (optionally) go to smoke. <br>  12) The machine rebooted, launch Eclipse from the folder, select the workspace and tick it in order not to climb anymore.  We go to Help-&gt; Install New Software, there we poke into the Add button, write the name Zylincdt, the address <a href="http://opensource.zylin.com/zylincdt">opensource.zylin.com/zylincdt</a> , press OK, tick the only package in the Zylin Embedded CDT window, and follow the instructions of the installer. After installing Eclipse will restart.  Now we create a new project: go to File-&gt; New-&gt; C Project, select the Makefile project-&gt; Empty project, Toolchain-Other Toolchain, give the project a name and click Finish.  Now for the time we turn off Eclipse. <br>  13) Go to the / usr / local / share / openocd / scripts / target folder and look for the configuration file with our controller in the name.  There was no mine (AT91SAM7A3), but it was quickly found in Google and slightly tweaked with pens.  If there is, fine.  We connect SAM-ICE to the computer and the board, we supply power to the board.  We start the terminal and write the following: <br><br>  sudo openocd -f interface / jlink.cfg -c "jtag_rclk 30; gdb_flash_program enable; gdb_memory_map disable" -f target / at91sam7a3.cfg <br><br>  Attention!  If you have a different adapter or another board, replace jlink.cfg and at91sam7a3.cfg with the files you need. <br>  OpenOCD should start and show us a bunch of information, among which there will be a chip model.  Minimize the terminal window. <br>  14) Go to the Atmel website and look for a trial project.  There is a somewhat crooked system, so I will immediately give a direct link to the project under our AT91SAM7A3-EK <a href="">board</a> : <a href="">www.atmel.com/dyn/resources/...ing_started.zip</a> .  Download, unpack, remember where unpacked.  We return to Eclipse, right-click on our project, select Import, there the General-File System.  We indicate to him the folder where the freshly minded project was unpacked, we indicate what files are needed (you can just select everything and not suffer) and click Finish. <br>  15) Go to the project's Makefile, find the string CROSS_COMPILE = arm-elf- and replace it with CROSS_COMPILE = arm-none-eabi-. Save the Makefile, go to the Project-&gt; Build Project and observe how everything is compiled and assembled.  If everything is done correctly, the output will be two files * .elf and * .bin. <br>  16) Create in the folder home (or somewhere else the files gdbinit_sram and gdbinit_flash, in which we write the following. <br>  gdbinit_sram: <br><br>  target remote localhost: 3333 <br>  monitor reset init <br>  monitor halt <br>  printf "____Target halted ____ \ n" <br>  set $ mem_a = * 0x00000000 <br>  set $ mem_c = $ mem_a <br>  set $ mem_a = $ mem_a + 1 <br>  set * 0x00000000 = $ mem_a <br>  set $ mem_b = * 0x00000000 <br>  if ($ mem_a == $ mem_b) <br>  set * 0x00000000 = $ mem_c <br>  printf "____ Remap_is_Done ____ \ n" <br>  else <br>  printf "____ Remap_is_Not ____ \ n" <br>  set * 0xFFFFFF00 = 1 <br>  printf "____ Remap_is_Done ____ \ n" <br>  end <br>  monitor reg pc 0x00000000 <br>  monitor arm7_9 dbgrq enable <br>  monitor gdb_breakpoint_override hard <br>  load <br>  hbreak / * here we indicate the breakpoint * / <br>  continue <br>  condition 1 <br><br>  gdbinit_flash: <br><br>  target remote localhost: 3333 <br>  monitor reset init <br>  monitor halt <br>  printf "____Target halted ____ \ n" <br>  set $ mem_a = * 0x00000000 <br>  set $ mem_c = $ mem_a <br>  set $ mem_a = $ mem_a + 1 <br>  set * 0x00000000 = $ mem_a <br>  set $ mem_b = * 0x00000000 <br>  if ($ mem_a == $ mem_b) <br>  printf "____ Remap_is_Not ____ \ n" <br>  set * 0x00000000 = $ mem_c <br>  set * 0xFFFFFF00 = 1 <br>  printf "____ Remap_is_Done ____ \ n" <br>  else <br>  printf "____ Remap_is_Done ____ \ n" <br>  end <br>  monitor arm7_9 dcc_downloads enable <br>  monitor arm7_9 fast_memory_access enable <br>  monitor flash erase_sector 0 0 15 <br>  monitor flash probe 0 <br>  monitor flash write_bank 0 / * here specify the path to the firmware file * / 0 <br>  monitor reset run <br>  kill <br><br>  17) Now we set up the debugger.  We go to Run-&gt; Debug Configuration, we create 2 new configurations there: Zylin Embedded Debug (Native) sram (for debugging) and Zylin Embedded Debug (Native) flash (for firmware).  Now by tabs. <br>  Main: C / C ++ Application specify the path and file name, the one that * .elf is needed for debugging, * .bin- for firmware. <br>  Debugger: GDB Debuger-specify the path to our debugger, in our case it will be so home / user / arm / arm-2011.03 / bin / arm-none-eabi-gdb, <br>  GDB Command File-here we specify the path to the corresponding gdbinit file. <br>  Commands: in the Initialze Command field is empty. <br>  Common tab: check Debug under Display in the favorites menu. <br>  We press Apply, we are convinced that we are running OpenOCD, click Debug.  A window should appear with debug information if the sram configuration is running.  Optionally, you can add windows with an overview of variables, memory, disassembly, and so on. <br>  Voila, it works. <br>  Now a small addition.  It is better not to delete the downloaded project ‚Äî there is a header file that describes a bunch of constants to facilitate working with registers, there are Startup files, there is a linker script (which is important) and most importantly, a Makefile that describes how the memory will be distributed in the files for the debugger and programmer.  For me, it's better to transfer them to each new project and edit the Makefile a bit.  And life will be beautiful. <br><br>  PS A little later, I realized that if I could move my brain a little, the same could be done using the ARM tulechain, but the need disappeared and I didn‚Äôt do it. </div><p>Source: <a href="https://habr.com/ru/post/174195/">https://habr.com/ru/post/174195/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../174177/index.html">2 Russian finalists for the Windows Phone Next App Star contest went to the second round!</a></li>
<li><a href="../174181/index.html">How to save money in Amazon Web Services - choosing an efficient architecture</a></li>
<li><a href="../174183/index.html">5% of computers protected by antivirus are still infected</a></li>
<li><a href="../174187/index.html">The digest of interesting news and materials from the world of PHP over the past two weeks, number 13 (03/12/2013 - 03/25/2013)</a></li>
<li><a href="../174189/index.html">GamePlay 3D Framework - easy start to cross-platform development of 3D games</a></li>
<li><a href="../174197/index.html">Create a convenient viewer for vk.com using Fluid.app with notification of new messages in the dock Mac OS X</a></li>
<li><a href="../174201/index.html">Sony SmartWatch, 7 dream apps</a></li>
<li><a href="../174205/index.html">Easy setup of replication in PostgreSQL</a></li>
<li><a href="../174207/index.html">Swig - JavaScript Template Engine with Django Template Syntax</a></li>
<li><a href="../174209/index.html">Report on the eighth Habrebest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>