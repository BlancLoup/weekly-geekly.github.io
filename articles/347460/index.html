<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google Pay Integration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 My name is Igor, I'm an Android developer on the Trinity Digital team. Today I want to talk about the cool tool - Google Pay API . 

  

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google Pay Integration</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  My name is Igor, I'm an Android developer on the Trinity Digital team.  Today I want to talk about the cool tool - <b>Google Pay API</b> . <br><br> <a href=""><img src="https://habrastorage.org/webt/zp/oz/tm/zpoztmk3kbzmwajqwi6hcaplwwe.png" alt="Image from https://developers.google.com/payments/"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>So</b> , if you can make purchases in your application, and at the same time you are not using In-app Billing (processing is not responsible for Google Play), then you most likely have ‚ÄúPayment by card‚Äù among the payment options.  This means that every time you have to send a user to enter card data or on beautifully designed screens with a card, or on the website of your payment service provider (hereinafter - payment processor).  Have you already counted how many actions the user will have to make in order to pay for the coveted order?  Yeah, and now imagine that he can perform the same target action in just two tapas.  We also introduced and thought, why not give users the opportunity?  The main conditions for success - the seller must be <a href="https://payments.developers.google.com/signup">registered with Google</a> and the payment processor must cooperate with Google. <br><a name="habracut"></a><br>  The list of Russian banks that cooperate with Android Pay: <br><br>  AK Bars Bank <br>  Alfa Bank <br>  BINBANK <br>  Promsvyazbank <br>  VTB 24 <br>  Bank opening <br>  MTS Bank <br>  Raiffeisen Bank <br>  Roketbank <br>  Agricultural Bank <br>  Russian Standard Bank <br>  Sberbank <br>  Tinkoff Bank <br>  Point <br>  Yandex money <br><br>  How everything will look for the <b>user</b> : he gets on the screen for choosing the type of payment in your application, clicks on the button ‚ÄúPay via Google‚Äù, selects the desired card or leaves the one specified by default, presses the confirmation button.  Done! <br>  Remember that Google Pay API allows users to select any card linked either to a Google account or added to Google Pay. <br><br>  We now turn directly to the <b>integration</b> . <br><br>  Consider the steps: <br><br><ol><li>  Layout </li><li>  Code </li><li>  Testing </li><li>  Send for manual check </li><li>  Release </li></ol><br><h2>  1. Layout </h2><br>  The first thing worth mentioning is to warn designers about <a href="https://developers.google.com/payments/brand-guidelines">guidelines</a> .  Briefly by points: <br><br><ul><li>  On screens <b>BEFORE OR</b> on the screen where the button ‚ÄúPay via Google‚Äù will be located, the purchase price must be indicated; </li><li>  allow users to change order data, select payment type [, change address]; </li><li>  never show payment details in full (any numbers, dates, and so on); </li><li>  once again - ‚ÄúPay via Google‚Äù - this is the inscription that should be on your button if you make an application that supports the Russian language; </li><li>  Google recommends using standard buttons.  If you want to use a dark theme or even a button with your own design, then you should write in those.  support at <a href="">androidpay-api-support@google.com</a> .  But even on a custom button, there should be a Google logo and an inscription ... yes, I hope you understood :); </li><li>  there is no limit to the width, the minimum button height is 40dp.  If you do higher / wider, remember that the text should be centered. </li></ul><br>  Compliance with these items will allow you to quickly pass all checks and get into the white list. <br><br><h2>  2. Code </h2><br>  For Google payment to work, Google Play Services must be version 11.4 or later on the user's phone.  But do not worry, there is a special method that will tell you whether you can make a payment or whether it is worth hiding the button. <br><br>  To begin with, add the necessary dependencies to the build.gradle of the application level.  Before implementation, check the relevance of the versions! <br><br><pre><code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">dependencies</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">compile</span></span> <span class="hljs-string"><span class="hljs-string">'com.google.android.gms:play-services-wallet:11.4.0'</span></span> compile <span class="hljs-string"><span class="hljs-string">'com.android.support:support-v4:24.1.1'</span></span> compile <span class="hljs-string"><span class="hljs-string">'com.android.support:appcompat-v7:24.1.1'</span></span> }</code> </pre> <br>  Next, update AndroidManifest: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Enables the Google Pay API --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.google.android.gms.wallet.api.enabled"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Now there is quite a bit: <br><br><ul><li>  Create a PaymentsClient in your Activity or Fragment.  In order not to clutter up these classes, you can put all the code in GooglePaymentUtils methods, for example.  Then: <br><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">AppCompatActivity</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> googlePaymentsClient: PaymentsClient ... <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Bundle</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) ... googlePaymentsClient = GooglePaymentUtils.createGoogleApiClientForPay(context) } ... }</code> </pre><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> GooglePaymentUtils { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createGoogleApiClientForPay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Context</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: PaymentsClient = Wallet.getPaymentsClient(context, Wallet.WalletOptions.Builder() .setEnvironment(WalletConstants.ENVIRONMENT_TEST) .setTheme(WalletConstants.THEME_LIGHT) .build()) }</code> </pre><br>  Pay attention to the constants: <br><br>  <i>WalletConstants.ENVIRONMENT_TEST</i> - as long as Google does not allow access to the combat environment, you must use it to test the flow of payment yourself.  Do not be alarmed when you see a warning in the Google Pay dialog that the application is not recognized. <br>  <i>WalletConstants.THEME_LIGHT</i> is a light topic of dialogue, there is also a dark one. <br></li><li>  Great, we have a client, now we are ready to make a request whether it is possible to use the payment at all and show the button. <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> GooglePaymentUtils { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkIsReadyGooglePay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(paymentsClient: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">PaymentsClient</span></span></span></span><span class="hljs-function"><span class="hljs-params">, callback: (</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">res</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> isReadyRequest = IsReadyToPayRequest.newBuilder() .addAllowedPaymentMethod(WalletConstants.PAYMENT_METHOD_CARD) .addAllowedPaymentMethod(WalletConstants.PAYMENT_METHOD_TOKENIZED_CARD) .build() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> task = paymentsClient.isReadyToPay(isReadyRequest) task.addOnCompleteListener { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (it.getResult(ApiException::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">)) //    , </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">  callback.invoke</span></span></span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-comment"><span class="hljs-comment">//     callback.invoke(false) } catch (e: ApiException) { e.printStackTrace() callback.invoke(false) } } } }</span></span></code> </pre><br>  <i>PAYMENT_METHOD_CARD</i> , <i>PAYMENT_METHOD_TOKENIZED_CARD</i> - they say that we want to see cards from a Google user account and cards linked to Android Pay. <br></li><li>  If we can show a button, then we must hang a click handler on it. <br><br><pre> <code class="hljs vbscript">btnPaymentByGoogle.setOnClickListener { val <span class="hljs-built_in"><span class="hljs-built_in">request</span></span> = GooglePaymentUtils.createPaymentDataRequest(price) AutoResolveHelper.resolveTask&lt;PaymentData&gt;(googlePaymentsClient.loadPaymentData(<span class="hljs-built_in"><span class="hljs-built_in">request</span></span>), context, REQUEST_CODE) }</code> </pre><br>  Here, remember that price is a line.  And most importantly, even if you call AutoResolveHelper.resolveTask from a fragment, the result will still come in activations (more on that later) [at the time of writing this article works this way, AutoResolveHelper does not know how to return the result to the fragment]. <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createPaymentDataRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(price: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: PaymentDataRequest { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> transaction = createTransaction(price) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> request = generatePaymentRequest(transaction) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createTransaction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(price: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: TransactionInfo = TransactionInfo.newBuilder() .setTotalPriceStatus(WalletConstants.TOTAL_PRICE_STATUS_FINAL) .setTotalPrice(price) .setCurrencyCode(CURRENCY_CODE) .build() <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generatePaymentRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(transactionInfo: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TransactionInfo</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: PaymentDataRequest { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tokenParams = PaymentMethodTokenizationParameters .newBuilder() .setPaymentMethodTokenizationType (WalletConstants.PAYMENT_METHOD_TOKENIZATION_TYPE_DIRECT) .addParameter(<span class="hljs-string"><span class="hljs-string">"publicKey"</span></span>, TOKENIZATION_PUBLIC_KEY) build() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PaymentDataRequest.newBuilder() .setPhoneNumberRequired(<span class="hljs-literal"><span class="hljs-literal">false</span></span>) .setEmailRequired(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) .setShippingAddressRequired(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) .setTransactionInfo(transactionInfo) .addAllowedPaymentMethods(SUPPORTED_METHODS) .setCardRequirements(CardRequirements.newBuilder() .addAllowedCardNetworks(SUPPORTED_NETWORKS) .setAllowPrepaidCards(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) .setBillingAddressRequired(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) .setBillingAddressFormat(WalletConstants.BILLING_ADDRESS_FORMAT_FULL) .build()) .setPaymentMethodTokenizationParameters(tokenParams) .setUiRequired(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) .build() }</code> </pre><br>  Here <i>CURRENCY_CODE</i> = ‚ÄúRUB‚Äù. <br>  <i>WalletConstants.TOTAL_PRICE_STATUS_FINAL</i> - we say that the purchase price is final and will not change anymore. <br><br>  There are also options: <br>  <i>WalletConstants.TOTAL_PRICE_STATUS_ESTIMATED</i> - approximate cost, and may change, for example, after specifying the address. <br>  <i>WalletConstants.TOTAL_PRICE_STATUS_NOT_CURRENTLY_KNOWN</i> - do not yet know what the cost. <br><br>  I can not say how the last two constants behave in practice, since I did not check ¬Ø \ _ („ÉÑ) _ / ¬Ø. <br><br>  Let us dwell on <b>PaymentMethodTokenizationParameters</b> and its setPaymentMethodTokenizationType method: <br><br><ol><li>  <i>PAYMENT_METHOD_TOKENIZATION_TYPE_PAYMENT_GATEWAY</i> <br>  is used only if your payment processor is listed: <br><br>  Adyen <br>  Braintree <br>  Paysafe <br>  Stripe <br>  Vantiv <br>  WorldPay <br><br>  Then instead of <code>.addParameter("publicKey", TOKENIZATION_PUBLIC_KEY)</code> <br>  you must write <code>.addParameter("gateway", "yourGateway")</code> <br> <code>.addParameter("gatewayMerchantId", "yourMerchantIdGivenFromYourGateway")</code> <br> </li><li>  Otherwise, the above type <i>PAYMENT_METHOD_TOKENIZATION_TYPE_DIRECT is used</i> . <br>  To do this, you need to request the public key from the payment service provider and transfer it to the <code>.addParameter("publicKey", TOKENIZATION_PUBLIC_KEY)</code> <br></li></ol><br>  <b>It now remains to create a request.</b> <br>  <i>.setPhoneNumberRequired</i> - whether the user should enter a number. <br>  <i>.setEmailRequired</i> - whether the user should enter an email <br>  <i>.setShippingAddressRequired</i> - whether the user should select a country.  Here you can limit the number of countries for which this transaction will be executed. <br>  <i>.addAllowedPaymentMethods</i> - we have <i>WalletConstants.PAYMENT_METHOD_CARD</i> - cards from google account, <i>WalletConstants.PAYMENT_METHOD_TOKENIZED_CARD</i> - cards added to Google Pay. <br><br>  In CardRequirements, we indicate that Visa, Mastercard and other cards must work (MIR, for example) <br><br><pre> <code class="hljs lisp">val SUPPORTED_NETWORKS = arrayListOf(<span class="hljs-name"><span class="hljs-name">WalletConstants</span></span>.CARD_NETWORK_OTHER, WalletConstants.CARD_NETWORK_VISA, WalletConstants.CARD_NETWORK_MASTERCARD)</code> </pre> <br></li><li>  Everything, we created a request, sent it through the client and wait for the result through AutoResolveHelper. <br><br>  As you remember, the result will come in the <b>activity</b> . <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onActivityResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(requestCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, resultCode: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">data</span></span></span></span><span class="hljs-function"><span class="hljs-params">: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Intent</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onActivityResult(requestCode, resultCode, <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (requestCode) { LOAD_PAYMENT_DATA_REQUEST_CODE -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (resultCode) { Activity.RESULT_OK -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> paymentData = PaymentData.getFromIntent(<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) } Activity.RESULT_CANCELED -&gt; { <span class="hljs-comment"><span class="hljs-comment">//   , //     google pay //     - , //    } AutoResolveHelper.RESULT_ERROR -&gt; { if (data == null) return //     . //      , //   val status = AutoResolveHelper.getStatusFromIntent(data) Log.e("GOOGLE PAY", "Load payment data has failed with status: $status") } else -&gt; { } } } else -&gt; { } } }</span></span></code> </pre><br></li></ul><br>  That's all, in paymentData you will have a token that should be given to your server.  Further logic depends on your payment processor. <br><br><h2>  3. Testing </h2><br>  Nothing complicated, just check that the <i>WalletConstants.ENVIRONMENT_TEST</i> constant is <i>set</i> , and go through the entire flow.  There will be no debit from the card, you will receive a test token, so the payment processor must reject the payment. <br><br><h2>  4. Send to manual check. </h2><br>  Congratulations!  You are ready to send your debug build for manual verification to Google. <br>  Some tips: <br><br><ul><li>  If your application only supports Russian, then prepare screenshots with directions on where to click. </li><li>  If there is any specificity in the order process, then describe in detail. </li><li>  Create a test account specifically for Google and send directly to the build. </li></ul><br>  Send the build to <a href="">androidpay-api-support@google.com</a> and wait for an answer. <br><br><h2>  5. Release </h2><br>  You were told that everything is good and you can release the application.  First of all, you will be asked to <a href="https://payments.developers.google.com/signup">activate the application at</a> (from the merchant account). <br><br>  Next you may be asked to send a PCI Compliance.  These documents confirm that your payment processor complies with card security standards.  Ask him and send in support. <br><br>  Once you have completed these two items, you will be told that you can change <i>WalletConstants.ENVIRONMENT_TEST</i> to <i>WalletConstants.ENVIRONMENT_PRODUCTION</i> .  You may also need to change the TOKENIZATION_PUBLIC_KEY if you used the key from the test environment of your payment processor. <br><br>  That's all, now test the real payment and you can release a release to the market! <br><br>  Thanks and good luck! </div><p>Source: <a href="https://habr.com/ru/post/347460/">https://habr.com/ru/post/347460/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347450/index.html">Flask Mega-Tutorial, Chapter 8: Subscribers, Contacts and Friends (Edition 2018)</a></li>
<li><a href="../347452/index.html">IT solutions architecture. Part 2. Architects</a></li>
<li><a href="../347454/index.html">Familiar faces: algorithms for creating a "typical" portrait</a></li>
<li><a href="../347456/index.html">Layer 7 DoS: Web Application Denial of Service Attacks</a></li>
<li><a href="../347458/index.html">Frequent difficulties in working with React.js</a></li>
<li><a href="../347464/index.html">How to return the domain, which forgot to renew</a></li>
<li><a href="../347466/index.html">How to import accounts from CSV to Zimbra</a></li>
<li><a href="../347468/index.html">5 myths about the leading developers, which makes me sad</a></li>
<li><a href="../347470/index.html">Numphp - library for working with numeric arrays</a></li>
<li><a href="../347472/index.html">Satisfaction JET or how we manage customer satisfaction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>