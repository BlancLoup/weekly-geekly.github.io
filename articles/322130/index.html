<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing the Documented API with the Apiary Dredd Utility</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We all love  nothing to do  work with a well-documented API. Using the Blueprint or Swagger API standards, you can obtain machine-and-human-readable d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing the Documented API with the Apiary Dredd Utility</h1><div class="post__text post__text-html js-mediator-article"><p>  We all love <del>  nothing to do </del>  work with a well-documented API.  Using the <a href="https://apiblueprint.org/documentation/">Blueprint</a> or <a href="http://swagger.io/specification/">Swagger</a> <a href="https://apiblueprint.org/documentation/">API</a> standards, you can obtain machine-and-human-readable documentation, and therefore API verification tools based on this documentation. </p><br><p>  <a href="https://apiary.io/">Apiary</a> offers interactive tools to validate the API manually, substituting the necessary parameters into forms generated from the documentation.  But much more benefit can be gained if the API is checked automatically.  This eliminates the need to write separate tests for each interface, but imposes certain restrictions on the structure and quality of the documentation itself. </p><br><p><img src="https://habrastorage.org/files/5a5/cc2/e6d/5a5cc2e6de914c838f3d31ff1e62da30.jpg" alt="image"></p><br><p>  In this tutorial, let's talk about the <a href="http://dredd.readthedocs.io/en/latest/">Dredd</a> utility using the example of the API from GitHub. </p><a name="habracut"></a><br><p><img src="https://raw.github.com/apiaryio/dredd/master/img/dredd.png?v=3&amp;raw=true" alt="image"></p><br><h2 id="bootstrap">  Bootstrap </h2><br><p>  I assume that you already have <a href="https://www.vagrantup.com/downloads.html">Vagrant</a> and <a href="https://git-scm.com/downloads">Git</a> locally installed.  I work on MacOS, all the commands below were executed in it. </p><br><p>  Prepare the necessary accounts and permissions. </p><br><p>  Register and <a href="https://app.apiary.io/">create a new project</a> in the service Apiary. </p><br><p><img src="https://habrastorage.org/files/a8b/085/a02/a8b085a0287d4609a8f803f38ee6c509.jpg" alt="image"></p><br><p> In the created project, click the Tests&gt; Tutorial tab.  Here you need to write the values ‚Äã‚Äãof the variables <code>apiaryApiName</code> and <code>apiaryApiKey</code> , which will be useful later. </p><br><p><img src="https://habrastorage.org/files/5de/b4b/538/5deb4b5381664e708b60a48f2ea88ebb.jpg" alt="image"></p><br><p>  In the GitHub settings, <a href="https://github.com/settings/tokens">create a token to access the API</a> with the following permissions (scopes): <em>gist, user: email</em> .  You can <a href="https://developer.github.com/v3/oauth/">read</a> more about available permissions <a href="https://developer.github.com/v3/oauth/">in the</a> GitHub API <a href="https://developer.github.com/v3/oauth/">documentation</a> . </p><br><p>  <strong>Do not forget to copy the token</strong> .  It is visible only once. </p><br><p><img src="https://habrastorage.org/files/7f3/a16/ab4/7f3a16ab4e2243a59a5cc2114e16831e.jpg" alt="image"></p><br><p>  Create a working directory. </p><br><p> <code>mkdir ~/dredd_test &amp;&amp; cd ~/dredd_test &amp;&amp; git init</code> </p> <br><h2 id="virtual-environment">  Virtual environment </h2><br><p>  Prepare a virtual environment in order not to litter your OS, as well as to document every step taken. </p><br><p> <code>mkdir vagrant &amp;&amp; touch vagrant/Vagrantfile &amp;&amp; git add vagrant/</code> </p> <br><p>  In the root directory, create a <code>.gitignore</code> file and add exceptions to it: </p><br><p> <code>echo 'vagrant/.vagrant' &gt;&gt; .gitignore &amp;&amp; git add .gitignore</code> </p> <br><p>  Edit the <code>vagrant/Vagrantfile</code> , add the following configuration there: </p><br><div class="spoiler">  <b class="spoiler_title">vagrant / vagrantfile</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">Vagrant.require_version "&gt;= 1.5" Vagrant.configure("2") <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> |config| config.vm.hostname = "dredd.dev" config.vm.provider :virtualbox <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> |v| v.name = "dredd_test" v.customize [ "modifyvm", :id, "--name", "dredd_test", "--memory", <span class="hljs-number"><span class="hljs-number">2048</span></span>, "--natdnshostresolver1", "on", "--natdnsproxy1", "on", "--cpus", <span class="hljs-number"><span class="hljs-number">2</span></span>, ] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> #     , # ..   Ubuntu/Debian      npm config.vm.box = "centos/7" # IP-   config.vm.network :private_network, ip: "192.168.99.105" config.ssh.forward_agent = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> #        , #            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ENV[<span class="hljs-string"><span class="hljs-string">'DREDD_GITHUB_TEST_PATH'</span></span>] config.vm.synced_folder "#{ENV['DREDD_GITHUB_TEST_PATH']}", "/var/dredd_test", :owner=&gt; <span class="hljs-string"><span class="hljs-string">'vagrant'</span></span>, :<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>=&gt; <span class="hljs-string"><span class="hljs-string">'vagrant'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> #      -       config.vm.synced_folder "~/dredd_test", "/var/dredd_test", :owner=&gt; <span class="hljs-string"><span class="hljs-string">'vagrant'</span></span>, :<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>=&gt; <span class="hljs-string"><span class="hljs-string">'vagrant'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> #          config.vm.provision :shell, <span class="hljs-type"><span class="hljs-type">path</span></span>: "provision.sh" #      , #   GitHub API ,   Apiary  config.vm.provision "shell" <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> |s| s.binary = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> # Replace Windows <span class="hljs-type"><span class="hljs-type">line</span></span> endings <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Unix <span class="hljs-type"><span class="hljs-type">line</span></span> endings. s.<span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> = %Q(sudo echo \ "GITHUB_API_TOKEN=#{ENV['GITHUB_API_TOKEN']}\nAPIARY_API_KEY=#{ENV['APIARY_API_KEY']}\nAPIARY_API_NAME=#{ENV['APIARY_API_NAME']}" \ &gt; /etc/environment ) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> #  ,         VM config.vm.provision "shell" <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> |s| s.binary = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> # Replace Windows <span class="hljs-type"><span class="hljs-type">line</span></span> endings <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Unix <span class="hljs-type"><span class="hljs-type">line</span></span> endings. s.<span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> = %Q(cd /var/dredd_test &amp;&amp; composer install &amp;&amp; composer <span class="hljs-keyword"><span class="hljs-keyword">check</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre></div></div><br><p>  Now you need to prepare a file with a set of instructions for preparing a virtual machine. </p><br><p> <code>touch vagrant/provision.sh &amp;&amp; git add vagrant/provision.sh</code> </p> <br><p>  Put the text in it: </p><br><div class="spoiler">  <b class="spoiler_title">vagrant / provision.sh</b> <div class="spoiler_text"><pre> <code class="hljs tex">#!/usr/bin/env bash yum -y clean all #    EPEL ( nodejs etc)  webtatic ( php) sudo rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm sudo rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm #    npm sudo curl --silent --location https://rpm.nodesource.com/setup_6.x | bash - yum -y update #   , #   PHP composer, #   API Dredd #   - Express JS   API sudo yum -y install curl git nodejs npm php70w-cli --skip-broken <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&amp;&amp; curl -sS https://getcomposer.org/installer | sudo php -- --install-dir=/usr/bin --filename=composer <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&amp;&amp; yum -y install gcc-c++ make <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&amp;&amp; sudo npm cache clean <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&amp;&amp; sudo npm install dredd -g <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&amp;&amp; sudo npm install express -g <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>&amp;&amp; echo "Done"</code> </pre> </div></div><br><p>  As you can see, in addition to the desired Dredd, the PHP <a href="https://getcomposer.org/doc/">Composer</a> dependency manager will also be installed.  PHP will be useful as an example for writing hooks when testing APIs.  You can use <a href="https://dredd.readthedocs.io/en/latest/hooks/">other languages</a> for this, for example, the same NodeJs, so as not to breed the "zoo" of technologies.  As my main language is PHP, I will show below how to integrate dredd into Composer so as not to memorize call commands. </p><br><p>  So, we have a virtual environment ready. </p><br><h2 id="blueprint-for-github-api">  Blueprint for GitHub API </h2><br><p>  Now it‚Äôs time to prepare the API documentation.  The following interfaces were used as the experimental animal: </p><br><ul><li>  <a href="https://developer.github.com/v3/users/">Retrieving public data of an individual user</a> </li><li>  <a href="https://developer.github.com/v3/gists/">Listing the Gists</a> </li><li>  <a href="https://developer.github.com/v3/gists/">Create, Receive and Delete Gist</a> . </li></ul><br><p>  Dredd supports <a href="https://dredd.readthedocs.io/en/latest/">two types of documentation</a> : API Blueprint and Swagger.  We‚Äôll use the first one, since this standard is based on Markdown markup and you can read the API documentation in your favorite git-service: Gitlab, Github, Bitbucket etc.  In addition, Swagger support is announced for now in beta mode. </p><br><p>  In the project root, create the <code>touch github-api.md &amp;&amp; git add github-api.md</code> file <code>touch github-api.md &amp;&amp; git add github-api.md</code> and put the documentation in it. <br>  I will not describe each line in detail, but I will make some explanations about the structure of the listing below. </p><br><div class="spoiler">  <b class="spoiler_title">github-api.md</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">FORMAT</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>A HOST: https://api.github.com/ # Github API test Just a simple test <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> GitHub API ## Users Collection [/users] ### OAuth Non-Web authentication flow: <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> data [<span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /users/technoweenie] + Request <span class="hljs-type"><span class="hljs-type">JSON</span></span> (application/<span class="hljs-type"><span class="hljs-type">json</span></span>; charset=utf<span class="hljs-number"><span class="hljs-number">-8</span></span>) + Headers <span class="hljs-keyword"><span class="hljs-keyword">Authorization</span></span>: token <span class="hljs-number"><span class="hljs-number">12345</span></span> + Response <span class="hljs-number"><span class="hljs-number">200</span></span> (application/<span class="hljs-type"><span class="hljs-type">json</span></span>; charset=utf<span class="hljs-number"><span class="hljs-number">-8</span></span>) + Headers <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>: GitHub.com <span class="hljs-type"><span class="hljs-type">Date</span></span>: Fri, <span class="hljs-number"><span class="hljs-number">28</span></span> Jan <span class="hljs-number"><span class="hljs-number">2017</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">30</span></span>:<span class="hljs-number"><span class="hljs-number">40</span></span> GMT Content-Length: <span class="hljs-number"><span class="hljs-number">1248</span></span> Status: <span class="hljs-number"><span class="hljs-number">200</span></span> OK X-RateLimit-<span class="hljs-keyword"><span class="hljs-keyword">Limit</span></span>: <span class="hljs-number"><span class="hljs-number">5000</span></span> X-RateLimit-Remaining: <span class="hljs-number"><span class="hljs-number">4992</span></span> X-RateLimit-<span class="hljs-keyword"><span class="hljs-keyword">Reset</span></span>: <span class="hljs-number"><span class="hljs-number">1485553884</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Cache</span></span>-Control: private, max-age=<span class="hljs-number"><span class="hljs-number">60</span></span>, s-maxage=<span class="hljs-number"><span class="hljs-number">60</span></span> Vary: Accept, <span class="hljs-keyword"><span class="hljs-keyword">Authorization</span></span>, Cookie, X-GitHub-OTP, Accept-<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span> ETag: "123456701aaf50ed0c83ad4123456789" Last-Modified: Fri, <span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-type"><span class="hljs-type">Dec</span></span> <span class="hljs-number"><span class="hljs-number">2016</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> GMT X-OAuth-Scopes: gist, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>:email X-GitHub-Media-<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>: github.v3; <span class="hljs-keyword"><span class="hljs-keyword">format</span></span>=<span class="hljs-type"><span class="hljs-type">json</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Access</span></span>-Control-Expose-Headers: ETag, Link, X-GitHub-OTP, X-RateLimit-<span class="hljs-keyword"><span class="hljs-keyword">Limit</span></span>, X-RateLimit-Remaining, X-RateLimit-<span class="hljs-keyword"><span class="hljs-keyword">Reset</span></span>, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-<span class="hljs-type"><span class="hljs-type">Interval</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Access</span></span>-Control-Allow-Origin: * Content-<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Policy</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-src <span class="hljs-string"><span class="hljs-string">'none'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Strict</span></span>-Transport-<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span>: max-age=<span class="hljs-number"><span class="hljs-number">31536000</span></span>; includeSubdomains; preload X-Content-<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Options</span></span>: nosniff X-Frame-<span class="hljs-keyword"><span class="hljs-keyword">Options</span></span>: deny X-XSS-Protection: <span class="hljs-number"><span class="hljs-number">1</span></span>; mode=block X-Served-<span class="hljs-keyword"><span class="hljs-keyword">By</span></span>: q1234567cned3f5c4u15a34csddc1234 X-GitHub-Request-Id: ABCD:EFGH:A5DA75D:<span class="hljs-number"><span class="hljs-number">2</span></span>EF637A:<span class="hljs-number"><span class="hljs-number">12345678</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">close</span></span> + Body { "login": "technoweenie", "id": <span class="hljs-number"><span class="hljs-number">21</span></span>, "avatar_url": "https://avatars.githubusercontent.com/u/21?v=3", "gravatar_id": "", "url": "https://api.github.com/users/technoweenie", "html_url": "https://github.com/technoweenie", "followers_url": "https://api.github.com/users/technoweenie/followers", "following_url": "https://api.github.com/users/technoweenie/following{/other_user}", "gists_url": "https://api.github.com/users/technoweenie/gists{/gist_id}", "starred_url": "https://api.github.com/users/technoweenie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/technoweenie/subscriptions", "organizations_url": "https://api.github.com/users/technoweenie/orgs", "repos_url": "https://api.github.com/users/technoweenie/repos", "events_url": "https://api.github.com/users/technoweenie/events{/privacy}", "received_events_url": "https://api.github.com/users/technoweenie/received_events", "type": "User", "site_admin": <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, "name": "risk danger olson", "company": "GitHub", "blog": "http://techno-weenie.net", "location": "Louisville, CO", "email": "technoweenie@gmail.com", "hireable": <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, "bio": ":metal:", "public_repos": <span class="hljs-number"><span class="hljs-number">164</span></span>, "public_gists": <span class="hljs-number"><span class="hljs-number">105</span></span>, "followers": <span class="hljs-number"><span class="hljs-number">2328</span></span>, "following": <span class="hljs-number"><span class="hljs-number">17</span></span>, "created_at": "2008-01-14T04:33:35Z", "updated_at": "2017-01-24T10:45:13Z" } + <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span> { "$schema": "http://json-schema.org/draft-04/schema#", "type": "object", "properties": { "login": { "type": "string" }, "id": { "type": "number" }, "avatar_url": { "type": ["string", "null"] }, "gravatar_id": { "type": ["string", "null"] }, "url": { "type": ["string", "null"] }, "html_url": { "type": ["string", "null"] }, "followers_url": { "type": ["string", "null"] }, "following_url": { "type": ["string", "null"] }, "gists_url": { "type": ["string", "null"] }, "starred_url": { "type": ["string", "null"] }, "subscriptions_url": { "type": ["string", "null"] }, "organizations_url": { "type": ["string", "null"] }, "repos_url": { "type": ["string", "null"] }, "events_url": { "type": ["string", "null"] }, "received_events_url": { "type": ["string", "null"] }, "type": { "type": ["string", "null"] }, "site_admin": { "type": "boolean" }, "name": { "type": ["string", "null"] }, "company": { "type": ["string", "null"] }, "blog": { "type": ["string", "null"] }, "location": { "type": ["string", "null"] }, "email": { "type": ["string", "null"] }, "hireable": { "type": ["boolean", "null"] }, "bio": { "type": ["string", "null"] }, "public_repos": { "type": ["number", "null"] }, "public_gists": { "type": ["number", "null"] }, "followers": { "type": ["number", "null"] }, "following": { "type": ["number", "null"] }, "created_at": { "type": ["string", "null"] }, "updated_at": { "type": ["string", "null"] } } } ## Gists Collection [/gists] ### <span class="hljs-keyword"><span class="hljs-keyword">Load</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> Gists [<span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /gists] + Request <span class="hljs-type"><span class="hljs-type">JSON</span></span> (application/<span class="hljs-type"><span class="hljs-type">json</span></span>; charset=utf<span class="hljs-number"><span class="hljs-number">-8</span></span>) + Response <span class="hljs-number"><span class="hljs-number">200</span></span> (application/<span class="hljs-type"><span class="hljs-type">json</span></span>; charset=utf<span class="hljs-number"><span class="hljs-number">-8</span></span>) + Attributes (<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>[Gist], optional) ### Creating <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Gist [POST] + Request <span class="hljs-type"><span class="hljs-type">JSON</span></span> (application/<span class="hljs-type"><span class="hljs-type">json</span></span>; charset=utf<span class="hljs-number"><span class="hljs-number">-8</span></span>) + Headers Accept: application/<span class="hljs-type"><span class="hljs-type">json</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Authorization</span></span>: token <span class="hljs-number"><span class="hljs-number">12345</span></span> + Body { "description": "This is a simple test file for gist API check", "public": <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, "files": { "file1.md": { "content": "# Hello, world\n- This is just a GitHub API testing result" } } } + <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span> { "$schema": "http://json-schema.org/draft-04/schema#", "type": "object", "properties": { "files": { "type": "object" }, "description": { "type": ["string"] }, "public": { "type": ["boolean"] } }, "required": [ "files" ] } + Response <span class="hljs-number"><span class="hljs-number">201</span></span> (application/<span class="hljs-type"><span class="hljs-type">json</span></span>; charset=utf<span class="hljs-number"><span class="hljs-number">-8</span></span>) + Attributes (Gist) ### <span class="hljs-keyword"><span class="hljs-keyword">Load</span></span> a Gist [<span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /gists/{id}] + Request <span class="hljs-type"><span class="hljs-type">JSON</span></span> (application/<span class="hljs-type"><span class="hljs-type">json</span></span>; charset=utf<span class="hljs-number"><span class="hljs-number">-8</span></span>) + Parameters + id: a123456bcd (string) - The ID <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the Gist. + Response <span class="hljs-number"><span class="hljs-number">200</span></span> (application/<span class="hljs-type"><span class="hljs-type">json</span></span>; charset=utf<span class="hljs-number"><span class="hljs-number">-8</span></span>) + Attributes (Gist) ### <span class="hljs-keyword"><span class="hljs-keyword">Delete</span></span> a Gist [<span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> /gists/{id}] + Parameters + id: a123456bcd (string) - The ID <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the Gist. + Response <span class="hljs-number"><span class="hljs-number">204</span></span> # Data Structures ## Gist This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a demo documentation example. <span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> fields was included. + id: a123456bcd (string, required) + url: https://api.github.com/gists/{id} (string) + forks_url: https://api.github.com/gists/{id}/forks (string) + commits_url: https://api.github.com/gists/{id}/commits (string) + git_pull_url: https://gist.github.com/{id}.git (string) + <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> (<span class="hljs-type"><span class="hljs-type">boolean</span></span>)</code> </pre> </div></div><br><p>  The first two lines are needed for parsers, which will understand the standard version and which default host to access, so that you can check the API in an interactive form. </p><br><p>  Headings of the 1st, 2nd, ... levels can be used variably.  For analyzers it is important that you specify in square brackets, for example <code>[GET /users/technoweenie]</code> .  This text will be used to compose interactive forms, for example in Apiary: </p><br><p><img src="https://habrastorage.org/files/e5e/0e8/409/e5e0e840967d48ae9b6ffff18418b251.jpg" alt="image"></p><br><p>  After this construction, the markup analyzer will wait for the details of the expected request and response on this interface.  To do this, use the constructs <code>+ Request  (  )</code> and <code>+ Response http-status-code (  )</code> </p><br><p>  The following are nested levels: </p><br><ul><li>  <code>Headers</code> - Examples of headers and their values ‚Äã‚Äãthat can be received or returned. </li><li>  <code>Body</code> - An example of a request or response body, primarily for people who will read the documentation.  Here you can bring a complete copy-n-paste from the real API, removing only sensitive data.  For automated testing, it is better to use Schema or Attributes. </li><li>  <code>Schema</code> - This section is already important for automated analysis and autotesting, but can also be useful for developers.  Both Blueprint and Swagger use <a href="http://json-schema.org/latest/json-schema-core.html">the json-schema.org standard</a> to describe data types. <br><img src="https://habrastorage.org/files/f8f/b8d/e67/f8fb8de673c8454592d9d82f8d895fd9.jpg" alt="image"></li><li>  <code>Parameters</code> - This is an alternative, simplified way to describe the fields if you just want to quickly jot down simple examples. </li><li>  <code>Attributes</code> - At this level, Blueprint allows you to refer to a previously created overall structure.  In our example, this is a <code>Gist</code> structure and it is described at the end of the document as a nested level to the <code>Data Structures</code> header. </li></ul><br><p>  Thus, in the given example, two different ways of describing the data structures in the body of requests and responses are shown: the ‚Äútricked‚Äù Schema and the simplified Parameters and Attributes. </p><br><p>  After we have saved the document, it can be checked in Apiary and Github for readability and adequacy of use in manual mode. </p><br><h2 id="podgotovka-proekta-composer">  Preparing the composer project </h2><br><p>  This step is optional, but here it is present for a more comprehensive approach, when testing is an integral part of the project itself. </p><br><p>  Add a new line to the git exception file: <code>echo 'vendor/' &gt;&gt; .gitignore</code> </p><br><p>  Create a file <code>composer.json</code> , as well as a folder for <a href="https://dredd.readthedocs.io/en/latest/hooks/">Dredd hooks</a> with a file of future hooks inside. </p><br><p> <code>mkdir hooks &amp;&amp; touch composer.json composer.lock hooks/github-api.php &amp;&amp; echo '{}' &gt; composer.lock &amp;&amp; git add composer.* hooks/github-api.php</code> </p> <br><p>  In the composer file.  <strong>json</strong> put the project description: </p><br><div class="spoiler">  <b class="spoiler_title">composer.json</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"kivagant/github-api-test"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"project"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"MIT"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Github API test example with dredd and Apiary"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"require"</span></span>: { }, <span class="hljs-attr"><span class="hljs-attr">"require-dev"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"ddelnano/dredd-hooks-php"</span></span>: <span class="hljs-string"><span class="hljs-string">"^1.1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"check"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"@test-mock"</span></span>, <span class="hljs-string"><span class="hljs-string">"@test"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"dredd --header=\"Authorization: token ${GITHUB_API_TOKEN}\" --config=./dredd-local.yml"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"test-mock"</span></span>: <span class="hljs-string"><span class="hljs-string">"dredd --header=\"Authorization: token ${GITHUB_API_TOKEN}\" --config=./dredd.yml"</span></span> } }</code> </pre> </div></div><br><p>  Here you should pay attention to the following points: </p><br><ul><li>  In dependencies of the dev level (since we are unlikely to run these tests in production), the <code>ddelnano/dredd-hooks-php</code> package has been added.  This part of the Dredd project will allow us to intercept various stages of test execution and manipulate data in order, for example, to transfer some execution context between different tests (data obtained in one test pass to another test). </li><li>  In the scripts section, two operations have been added: <code>test</code> and <code>test-mock</code> , both of which will be executed when invoking the <code>composer check</code> command </li><li>  Below are the console start commands.  Thus, we get a simplified call of these two teams, wrapping them in the <code>composer check</code> , in which we can also call unit tests, code quality checks, and so on. </li><li>  Console launch commands will call the dredd utility and pass it a header that will be added to all APIs.  The value of the GITHUB_API_TOKEN environment variable will be substituted into it, so that we do not need to commit its value to the code itself, but to store it somewhere in a protected place. </li><li>  Two separate dredd calls use different configuration files.  It would be more correct to simply replace some parameters from these files, but the <a href="https://github.com/apiaryio/dredd/issues/455">world is not perfect</a> .  One of the configurations apply directly to github.  The second one will call a stub (we will write it below), which for example may be your prototype of the API before the backend developers implement it in practice.  And you can play <a href="https://en.wikipedia.org/wiki/Test-driven_development">TDD</a> . </li></ul><br><h2 id="konfiguriruem-dredd">  Configuring dredd </h2><br><p>  Now we will create two configuration files - for production and for the API layout. </p><br><p> <code>touch dredd.yml dredd-local.yml &amp;&amp; git add dredd.yml dredd-local.yml</code> </p> <br><p>  In the first <code>dredd.yml</code> file <code>dredd.yml</code> we write the following parameters, the purpose of which can be <a href="https://dredd.readthedocs.io/en/latest/usage-cli/">read in the documentation</a> : </p><br><div class="spoiler">  <b class="spoiler_title">dredd.yml</b> <div class="spoiler_text"><pre> <code class="hljs vbscript">reporter: apiary #custom: # apiaryApiKey: <span class="hljs-number"><span class="hljs-number">12345</span></span> # better <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> use console argument # apiaryApiName: abcdefg #header: [<span class="hljs-string"><span class="hljs-string">"Authorization: token 12345"</span></span>] # better <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> use console argument dry-run: <span class="hljs-literal"><span class="hljs-literal">null</span></span> hookfiles: hooks/*.php #   hooks language: vendor/bin/dredd-hooks-php #    composer- sandbox: <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-built_in"><span class="hljs-built_in">server</span></span>-wait: <span class="hljs-number"><span class="hljs-number">3</span></span> init: <span class="hljs-literal"><span class="hljs-literal">false</span></span> names: <span class="hljs-literal"><span class="hljs-literal">false</span></span> only: [] output: [] sorted: <span class="hljs-literal"><span class="hljs-literal">false</span></span> user: <span class="hljs-literal"><span class="hljs-literal">null</span></span> inline-errors: <span class="hljs-literal"><span class="hljs-literal">false</span></span> details: <span class="hljs-literal"><span class="hljs-literal">false</span></span> method: [] color: <span class="hljs-literal"><span class="hljs-literal">true</span></span> level: info timestamp: <span class="hljs-literal"><span class="hljs-literal">false</span></span> silent: <span class="hljs-literal"><span class="hljs-literal">false</span></span> path: [] hooks-worker-timeout: <span class="hljs-number"><span class="hljs-number">5000</span></span> hooks-worker-connect-timeout: <span class="hljs-number"><span class="hljs-number">1500</span></span> hooks-worker-connect-retry: <span class="hljs-number"><span class="hljs-number">500</span></span> hooks-worker-after-connect-wait: <span class="hljs-number"><span class="hljs-number">100</span></span> hooks-worker-term-timeout: <span class="hljs-number"><span class="hljs-number">5000</span></span> hooks-worker-term-retry: <span class="hljs-number"><span class="hljs-number">500</span></span> hooks-worker-handler-host: localhost hooks-worker-handler-port: <span class="hljs-number"><span class="hljs-number">61321</span></span> blueprint: github-api.md #   API Blueprint  endpoint: <span class="hljs-comment"><span class="hljs-comment">'https://api.github.com' #  </span></span></code> </pre> </div></div><br><p>  The same text should be placed in the <code>dredd-local.yml</code> file, but at the end replace the <code>endpoint</code> parameter and add the additional <code>server</code> parameter, like so: </p><br><div class="spoiler">  <b class="spoiler_title">dredd-local.yml</b> <div class="spoiler_text"><pre> <code class="hljs 1c"><span class="hljs-meta"><span class="hljs-meta">#...  </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> dredd.yml,  endpoint endpoint: 'http:</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//localhost:3000' #   server: node app.js # ,       ""   API</span></span></span></span></code> </pre> </div></div><br><p>  In this version, Dredd will examine the contents of the <code>github-api.md</code> file and launch all interfaces one by one.  But this is not enough.  In the documentation, we perform the following operations: </p><br><ul><li>  GET for Users Collection </li><li>  GET for Gists list </li><li>  POST, GET and DELETE for a single Gist. </li></ul><br><p>  For the first two cases, everything is fine out of the box, but to get and delete a specific Gist, you must pass the identifier of the created resource to the following requests.  For this we need the Dredd hooks. </p><br><h3 id="pishem-dredd-hooks">  Writing Dredd hooks </h3><br><p>  Open the file <code>hooks/github-api.php</code> and add the following code there: </p><br><div class="spoiler">  <b class="spoiler_title">hooks / github-api.php</b> <div class="spoiler_text"><pre> <code class="hljs bash">&lt;?php //     use Dredd\Hooks; //       github-api.md //        , //         const DEFAULT_GIST_ID = <span class="hljs-string"><span class="hljs-string">"a123456bcd"</span></span>; //      , //        <span class="hljs-variable"><span class="hljs-variable">$scope</span></span> = [ <span class="hljs-string"><span class="hljs-string">'lastGistId'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> ]; //          Gist   Hooks::after(<span class="hljs-string"><span class="hljs-string">"Gists Collection &gt; Creating new Gist"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (&amp;<span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>) use (&amp;<span class="hljs-variable"><span class="hljs-variable">$scope</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$scope</span></span>[<span class="hljs-string"><span class="hljs-string">'lastGistId'</span></span>] = <span class="hljs-string"><span class="hljs-string">''</span></span>; //      ,   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isset(<span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;real-&gt;body)) { //   ,      <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;fail = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">return</span></span>; } <span class="hljs-variable"><span class="hljs-variable">$body</span></span> = json_decode(<span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;real-&gt;body, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); //  JSON    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isset(<span class="hljs-variable"><span class="hljs-variable">$body</span></span>[<span class="hljs-string"><span class="hljs-string">'id'</span></span>])) { //      Gist,    <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;fail = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">return</span></span>; } <span class="hljs-variable"><span class="hljs-variable">$scope</span></span>[<span class="hljs-string"><span class="hljs-string">'lastGistId'</span></span>] = <span class="hljs-variable"><span class="hljs-variable">$body</span></span>[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; //        }); //   ,   API ,      //  Gist        Hooks::before(<span class="hljs-string"><span class="hljs-string">"Gists Collection &gt; Load a Gist"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (&amp;<span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>) use (&amp;<span class="hljs-variable"><span class="hljs-variable">$scope</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;expected-&gt;body = str_replace(DEFAULT_GIST_ID, <span class="hljs-variable"><span class="hljs-variable">$scope</span></span>[<span class="hljs-string"><span class="hljs-string">'lastGistId'</span></span>], <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;expected-&gt;body); <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;id = str_replace(DEFAULT_GIST_ID, <span class="hljs-variable"><span class="hljs-variable">$scope</span></span>[<span class="hljs-string"><span class="hljs-string">'lastGistId'</span></span>], <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;id); <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;request-&gt;uri = str_replace(DEFAULT_GIST_ID, <span class="hljs-variable"><span class="hljs-variable">$scope</span></span>[<span class="hljs-string"><span class="hljs-string">'lastGistId'</span></span>], <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;request-&gt;uri); <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;fullPath = str_replace(DEFAULT_GIST_ID, <span class="hljs-variable"><span class="hljs-variable">$scope</span></span>[<span class="hljs-string"><span class="hljs-string">'lastGistId'</span></span>], <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;fullPath); }); //   ,   API ,      //  Gist        Hooks::before(<span class="hljs-string"><span class="hljs-string">"Gists Collection &gt; Delete a Gist"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (&amp;<span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>) use (&amp;<span class="hljs-variable"><span class="hljs-variable">$scope</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;expected-&gt;body = str_replace(DEFAULT_GIST_ID, <span class="hljs-variable"><span class="hljs-variable">$scope</span></span>[<span class="hljs-string"><span class="hljs-string">'lastGistId'</span></span>], <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;expected-&gt;body); <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;id = str_replace(DEFAULT_GIST_ID, <span class="hljs-variable"><span class="hljs-variable">$scope</span></span>[<span class="hljs-string"><span class="hljs-string">'lastGistId'</span></span>], <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;id); <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;request-&gt;uri = str_replace(DEFAULT_GIST_ID, <span class="hljs-variable"><span class="hljs-variable">$scope</span></span>[<span class="hljs-string"><span class="hljs-string">'lastGistId'</span></span>], <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;request-&gt;uri); <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;fullPath = str_replace(DEFAULT_GIST_ID, <span class="hljs-variable"><span class="hljs-variable">$scope</span></span>[<span class="hljs-string"><span class="hljs-string">'lastGistId'</span></span>], <span class="hljs-variable"><span class="hljs-variable">$transaction</span></span>-&gt;fullPath); });</code> </pre> </div></div><br><p>  Now we have almost everything ready, but for completeness we will add one more step. </p><br><h2 id="podgotovka-prototipa-api-s-pomoschyu-express-js">  Preparing a prototype API using Express JS </h2><br><p>  Add a new line to the git exception file: <code>echo 'node_modules/' &gt;&gt; .gitignore</code> </p><br><p>  Create a future API server file: <code>touch app.js &amp;&amp; git add app.js</code> </p><br><p>  In this file we add the following content, which will simply simulate the behavior of github.  I will not dwell on the details. </p><br><div class="spoiler">  <b class="spoiler_title">app.js</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">var app = require(<span class="hljs-string"><span class="hljs-string">'express'</span></span>)(); app.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(req, res) { res.json({message: <span class="hljs-string"><span class="hljs-string">'Hello World!'</span></span>}); }); app.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'/users/technoweenie'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(req, res) { res.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>( { "Server": "GitHub-Mock.local", "Date": "Fri, 28 Jan 2017 02:31:55 GMT", "Content-Type": "application/json; charset=utf-8", "Content-Length": <span class="hljs-number"><span class="hljs-number">1248</span></span>, "Status": "200 OK", "X-RateLimit-Limit": <span class="hljs-number"><span class="hljs-number">5000</span></span>, "X-RateLimit-Remaining": <span class="hljs-number"><span class="hljs-number">4992</span></span>, "X-RateLimit-Reset": <span class="hljs-number"><span class="hljs-number">1485553884</span></span>, "Cache-Control": "private, max-age=60, s-maxage=60", "Vary": "Accept, Authorization, Cookie, X-GitHub-OTP, Accept-Encoding", "ETag": "\"<span class="hljs-number"><span class="hljs-number">123456701</span></span>aaf50ed0c83ad4123456789\"", "Last-Modified": "Fri, 02 Dec 2016 07:32:00 GMT", "X-OAuth-Scopes": "gist, user:email", "X-Accepted-OAuth-Scopes": "", "X-GitHub-Media-Type": "github.v3; format=json", "Access-Control-Expose-Headers": "ETag, Link, X-GitHub-OTP, X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset, X-OAuth-Scopes, X-Accepted-OAuth-Scopes, X-Poll-Interval", "Access-Control-Allow-Origin": "*", "Content-Security-Policy": "default-src 'none'", "Strict-Transport-Security": "max-age=31536000; includeSubdomains; preload", "X-Content-Type-Options": "nosniff", "X-Frame-Options": "deny", "X-XSS-Protection": "1; mode=block", "X-Served-By": "q1234567cned3f5c4u15a34csddc1234", "X-GitHub-Request-Id": "ABCD:EFGH:25DA75D:2EF637A:12345679" } ).json( { "login": "technoweenie", "id": <span class="hljs-number"><span class="hljs-number">21</span></span>, "avatar_url": "https://avatars.githubusercontent.com/u/21?v=3", "gravatar_id": "", "url": "https://api.github.com/users/technoweenie", "html_url": "https://github.com/technoweenie", "followers_url": "https://api.github.com/users/technoweenie/followers", "following_url": "https://api.github.com/users/technoweenie/following{/other_user}", "gists_url": "https://api.github.com/users/technoweenie/gists{/gist_id}", "starred_url": "https://api.github.com/users/technoweenie/starred{/owner}{/repo}", "subscriptions_url": "https://api.github.com/users/technoweenie/subscriptions", "organizations_url": "https://api.github.com/users/technoweenie/orgs", "repos_url": "https://api.github.com/users/technoweenie/repos", "events_url": "https://api.github.com/users/technoweenie/events{/privacy}", "received_events_url": "https://api.github.com/users/technoweenie/received_events", "type": "User", "site_admin": <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, "name": "risk danger olson", "company": "GitHub", "blog": "http://techno-weenie.net", "location": "Louisville, CO", "email": "technoweenie@gmail.com", "hireable": <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, "bio": ":metal:", "public_repos": <span class="hljs-number"><span class="hljs-number">164</span></span>, "public_gists": <span class="hljs-number"><span class="hljs-number">105</span></span>, "followers": <span class="hljs-number"><span class="hljs-number">2328</span></span>, "following": <span class="hljs-number"><span class="hljs-number">17</span></span>, "created_at": "2008-01-14T04:33:35Z", "updated_at": "2017-01-24T10:45:13Z" } ); }); app.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'/gists'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(req, res) { res.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>( { "Server": "GitHub-Mock.local", "Date": "Fri, 28 Jan 2017 02:31:55 GMT", "Content-Type": "application/json; charset=utf-8" } ).json( [ { "url": "https://api.github.com/gists/12345678c62ca49gf313ahd156781234", "forks_url": "https://api.github.com/gists/12345678c62ca49gf313ahd156781234/forks", "commits_url": "https://api.github.com/gists/12345678c62ca49gf313ahd156781234/commits", "id": "12345678c62ca49gf313ahd156781234", "git_pull_url": "https://gist.github.com/12345678c62ca49gf313ahd156781234.git", "git_push_url": "https://gist.github.com/12345678c62ca49gf313ahd156781234.git", "html_url": "https://gist.github.com/12345678c62ca49gf313ahd156781234", "files": { "file.html": { "filename": "file.html", "type": "text/html", "language": "HTML", "raw_url": "https://gist.githubusercontent.com/anonymous/12345678c62ca49gf313ahd156781234/raw/1234ac2e64b06898787920a14f85511be/file.html", "size": <span class="hljs-number"><span class="hljs-number">45934</span></span> } }, "public": <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, "created_at": "2017-01-28T01:29:29Z", "updated_at": "2017-01-28T01:29:29Z", "description": "just a test", "comments": <span class="hljs-number"><span class="hljs-number">0</span></span>, "user": <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, "comments_url": "https://api.github.com/gists/12345678c62ca49gf313ahd156781234/comments", "truncated": <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> } ] ); }); app.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'/gists/:id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(req, res) { res.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>( { "Server": "GitHub-Mock.local", "Date": "Fri, 28 Jan 2017 02:31:55 GMT", "Content-Type": "application/json; charset=utf-8" } ).json( { "url": "https://api.github.com/gists/" + req.params.id, "forks_url": "https://api.github.com/gists/" + req.params.id + "/forks", "commits_url": "https://api.github.com/gists/" + req.params.id + "/commits", "id": req.params.id, "git_pull_url": "https://gist.github.com/" + req.params.id + ".git", "git_push_url": "https://gist.github.com/" + req.params.id + ".git", "html_url": "https://gist.github.com/" + req.params.id, "files": { "file.html": { "filename": "file.html", "type": "text/html", "language": "HTML", "raw_url": "https://gist.githubusercontent.com/anonymous/" + req.params.id + "/raw/12345678910abc/file.html", "size": <span class="hljs-number"><span class="hljs-number">45934</span></span> } }, "public": <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, "created_at": "2017-01-28T01:29:29Z", "updated_at": "2017-01-28T01:29:29Z", "description": "just a test", "comments": <span class="hljs-number"><span class="hljs-number">0</span></span>, "user": <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, "comments_url": "https://api.github.com/gists/" + req.params.id + "/comments", "truncated": <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> } ); }); app.post(<span class="hljs-string"><span class="hljs-string">'/gists'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(req, res) { res.status(<span class="hljs-number"><span class="hljs-number">201</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>( { "Server": "GitHub-Mock.local", "Date": "Fri, 28 Jan 2017 02:31:55 GMT", "Content-Type": "application/json; charset=utf-8" } ).json( { "url": "https://api.github.com/gists/d7b4325ac95ca49ef310aed14dfa8b15", "forks_url": "https://api.github.com/gists/d7b4325ac95ca49ef310aed14dfa8b15/forks", "commits_url": "https://api.github.com/gists/d7b4325ac95ca49ef310aed14dfa8b15/commits", "id": "d7b4325ac95ca49ef310aed14dfa8b15", "git_pull_url": "https://gist.github.com/d7b4325ac95ca49ef310aed14dfa8b15.git", "git_push_url": "https://gist.github.com/d7b4325ac95ca49ef310aed14dfa8b15.git", "html_url": "https://gist.github.com/d7b4325ac95ca49ef310aed14dfa8b15", "files": {}, "public": <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> } ); }); app.<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>(<span class="hljs-string"><span class="hljs-string">'/gists/:id'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(req, res) { res.status(<span class="hljs-number"><span class="hljs-number">204</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>( { "Server": "GitHub-Mock.local", "Date": "Fri, 28 Jan 2017 02:31:55 GMT" } ).<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); }); app.<span class="hljs-keyword"><span class="hljs-keyword">listen</span></span>(<span class="hljs-number"><span class="hljs-number">3000</span></span>);</code> </pre> </div></div><br><p>         nodejs,          : </p><br><p> <code>touch package.json &amp;&amp; git add package.json</code> </p> <br><p>    : </p><br><div class="spoiler"> <b class="spoiler_title">package.js</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"dredd_test"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"index.js"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"MIT"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"private"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"dredd "</span></span>: <span class="hljs-string"><span class="hljs-string">"^2.2.5"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"express"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.14.0"</span></span> } }</code> </pre> <br><p> (,  ,    "private": true, npm   package.js          npm ERR! code 1. ,     WARN,    .) </p></div></div><br><h2 id="zapusk-testov">  Running tests </h2><br><pre> <code class="hljs sql">cd vagrant/ vagrant box <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> DREDD_GITHUB_TEST_PATH=~/dredd_test GITHUB_API_TOKEN=&lt;your-token&gt; APIARY_API_KEY=&lt;your-<span class="hljs-keyword"><span class="hljs-keyword">key</span></span>&gt; APIARY_API_NAME=&lt;your-<span class="hljs-keyword"><span class="hljs-keyword">project</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>&gt; vagrant up</code> </pre> <br><p>          ¬´¬ª: </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="hljs sql">info: Configuration './dredd.yml' found, ignoring other arguments. info: Beginning Dredd testing... info: Found Hookfiles: 0=hooks/github-api.php info: Spawning `vendor/bin/dredd-hooks-php` hooks <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> process. info: Hooks <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> stdout: <span class="hljs-keyword"><span class="hljs-keyword">Starting</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> info: Successfully connected <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> hooks handler. Waiting <span class="hljs-number"><span class="hljs-number">0.1</span></span>s <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> testing. pass: <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">users</span></span>/technoweenie <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>: NaNms pass: <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /gists <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>: NaNms pass: POST /gists <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>: NaNms pass: <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /gists/<span class="hljs-number"><span class="hljs-number">1</span></span>f892b1c9fef3f3fc09fc66c11ad2027 <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>: NaNms pass: <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> /gists/<span class="hljs-number"><span class="hljs-number">1</span></span>f892b1c9fef3f3fc09fc66c11ad2027 <span class="hljs-keyword"><span class="hljs-keyword">duration</span></span>: NaNms info: Sending SIGTERM <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> hooks <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> process. <span class="hljs-keyword"><span class="hljs-keyword">complete</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">passing</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> failing, <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">errors</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> skipped, <span class="hljs-number"><span class="hljs-number">5</span></span> total <span class="hljs-keyword"><span class="hljs-keyword">complete</span></span>: Tests took <span class="hljs-number"><span class="hljs-number">7286</span></span>ms <span class="hljs-keyword"><span class="hljs-keyword">complete</span></span>: See results <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Apiary <span class="hljs-keyword"><span class="hljs-keyword">at</span></span>: https://app.apiary.io/githubtest5/tests/run/bcb8184a<span class="hljs-number"><span class="hljs-number">-2365</span></span><span class="hljs-number"><span class="hljs-number">-4459</span></span>-b898<span class="hljs-number"><span class="hljs-number">-20e9</span></span>bea8a389 &gt; dredd <span class="hljs-comment"><span class="hljs-comment">--header="Authorization: token ${GITHUB_API_TOKEN}" --config=./dredd-local.yml info: Configuration './dredd-local.yml' found, ignoring other arguments. info: Starting backend server process with command: node app.js info: Waiting 3 seconds for backend server process to start. info: Beginning Dredd testing... info: Found Hookfiles: 0=hooks/github-api.php info: Spawning `vendor/bin/dredd-hooks-php` hooks handler process. info: Hooks handler stdout: Starting server info: Successfully connected to hooks handler. Waiting 0.1s to start testing. pass: GET /users/technoweenie duration: NaNms pass: GET /gists duration: NaNms pass: POST /gists duration: NaNms pass: GET /gists/d7b4325ac95ca49ef310aed14dfa8b15 duration: NaNms pass: DELETE /gists/d7b4325ac95ca49ef310aed14dfa8b15 duration: NaNms info: Sending SIGTERM to hooks handler process. complete: 5 passing, 0 failing, 0 errors, 0 skipped, 5 total complete: Tests took 2779ms complete: See results in Apiary at: https://app.apiary.io/githubtest5/tests/run/625c2477-7384-48fa-8bb9-25e27af2a908 info: Sending SIGTERM to backend server process. info: Backend server process was killed.</span></span></code> </pre> </div></div><br><p>    ,     :    ,    production.    <a href="https://gist.github.com/">gist.github.com</a>  ,     . </p><br><p>                GUI. </p><br><p> <code>https://app.apiary.io/githubtest5/tests/run/625c2477-7384-48fa-8bb9-25e27af2a908</code> <br> <img src="https://habrastorage.org/files/a6a/bd5/df1/a6abd5df1f41469396e055be3974515f.jpg" alt="image"></p><br><div class="spoiler"> <b class="spoiler_title">   ?</b> <div class="spoiler_text"><p>      - ,  <code>provision.sh</code>    -  (     npm,     ).   <code>vagrant ssh</code> ,   sudo  ,    dredd  express.   ‚Äî    . <br> ,    provision-   (provision  up  ): <br> <code>DREDD_GITHUB_TEST_PATH=~/dredd_test GITHUB_API_TOKEN=&lt;your-token&gt; APIARY_API_KEY=&lt;your-key&gt; APIARY_API_NAME=&lt;your-project-name&gt; vagrant provision</code> </p> </div></div><br><p>       <code>vagrant ssh</code> ,        <code>cd /var/dredd_test &amp;&amp; composer check</code> . </p><br><p>        . </p><br><p> <code>git add . &amp;&amp; git commit -m 'Dredd testing project initial state'</code> </p> <br><p> ,    . <br>       <a href="https://github.com/KIVagant/dredd_testing"> </a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/322130/">https://habr.com/ru/post/322130/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../322106/index.html">Problems of ergonomics of the workplace. Chapter from the book ‚ÄúErgonomic workplace design‚Äù 2017</a></li>
<li><a href="../322108/index.html">Wordpress + CloudFlare - fresh move to https</a></li>
<li><a href="../322112/index.html">SDS, Cloudless Cloud, Aruba, and Composable Infrastructure: New HPE Webinars</a></li>
<li><a href="../322116/index.html">Problems encountered in the development of android-applications</a></li>
<li><a href="../322120/index.html">A tale about how I treated a server with WP, or 700 users online on 2 cores</a></li>
<li><a href="../322132/index.html">Detailed introduction to rvalue links for those who lacked a short</a></li>
<li><a href="../322134/index.html">[Bughunting] Blind XSS vulnerability on omnidesk support sites</a></li>
<li><a href="../322138/index.html">The worst technological forecasts for the last 150 years</a></li>
<li><a href="../322140/index.html">Graphic description of ownership and borrowing in Rust</a></li>
<li><a href="../322142/index.html">MySQL dacherization in Uber</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>