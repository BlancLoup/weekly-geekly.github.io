<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create apps for Windows Phone using Silverlight + XNA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day I saw this post with a list of materials for developing for Windows Phone, and, unfortunately, I did not meet there a single article on ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create apps for Windows Phone using Silverlight + XNA</h1><div class="post__text post__text-html js-mediator-article">  The other day I saw this <a href="http://habrahabr.ru/blogs/windows_mobile/135653/">post</a> with a list of materials for developing for Windows Phone, and, unfortunately, I did not meet there a single article on developing applications using both Silverlight and XNA at the same time.  This great opportunity for developers came with the advent of Mango. <br>  I wanted to fill this gap and tell you about the following: <br><ul><li>  Using Silverlight and XNA on the same page </li><li>  Simplest gesture processing in XNA </li><li>  Camera basics in XNA </li></ul><br>  The example from this article may be familiar to visitors of the first flow of the <a href="http://blogs.msdn.com/b/stasus/archive/2011/09/05/windows-phone-evening-school.aspx">evening school of Stas Pavlov</a> . <br>  Let's first see what Silverlight and XNA gives us in one application. <br><a name="habracut"></a><br><h1>  What does this give to the developer? </h1><br>  First of all, the following possibilities have appeared for game developers: <br><ul><li>  Fast UI creation using Silverlight controls </li><li>  Easy navigation between pages using the Navigation Service </li><li>  Using WebClient to integrate various social services </li><li>  Creating an Interface in Expression Blend </li></ul><br>  And it is worth noting that not all pages should combine in themselves and Silverlight and XNA.  I also want to draw attention to the fact that this feature is useful not only for game developers.  For example, XNA has excellent built-in gesture support and very convenient texture methods.  An example of a great non-game application using Silverlight and XNA - <a href="http://mne.p0x.ru/p/holiday-photo.html">Holiday Photo</a> . <br><br><h1>  Howto: Development of the first application on Silverlight + XNA </h1><br>  As an example, I chose a very famous math game, Life, which was repeatedly written on Habr√© ( <a href="http://habrahabr.ru/blogs/games/63848/">1</a> , <a href="http://habrahabr.ru/blogs/python/111247/">2</a> , <a href="http://habrahabr.ru/blogs/javascript/111686/">3</a> and many others).  In short, the game is a <strong>‚Äúzero-player game‚Äù</strong> , which means that the player sets only the initial state.  Further, the state of each cell in each generation is calculated based on the states of the eight cells surrounding it according to fairly simple rules. <br>  I just want to make a reservation that I use the simplest algorithm using 2 arrays, but this is not a post about algorithms and data structures.  So the implementation of the optimal and fast algorithm will be one of your homework. <br><br><h2>  Step 1. Creating a project and rendering the interface </h2><br>  When creating a new project, you must select <strong>"Windows Phone Silverlight and XNA Application"</strong> .  A new project will be created with 2 pages <strong>MainPage</strong> and <strong>GamePage</strong> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <strong>MainPage</strong> is a usual Silverlight application page, on which the ‚ÄúChange to game page‚Äù button is located, when clicked, the <strong>GamePage</strong> page opens <strong>accordingly</strong> . <br>  <strong>GamePage</strong> is our XNA page.  If you look at the content of its xaml file, then instead of marking the page there will be just one line: <br><br><pre><code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!--No XAML content is required as the page is rendered entirely with the XNA Framework--&gt;</span></span></code> </pre> <br><br>  Thus, when we want to add controls to this page, we will need to replace this comment with our code, let's do it by placing the <strong>Start</strong> button. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Layout"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">LayoutUpdated</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Layout_LayoutUpdated"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Start"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"71"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"160"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25,717,295,12"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button1_Click"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Let's now launch our project, press the " <strong>Change to game page</strong> " button and see only the blue screen, our button is nowhere to be found.  But there is nothing terrible in it, now we will fix it. <br><br>  Open the GamePage.xaml.cs file, which contains all the logic of our XNA application.  To display Silverlight elements, we need to create a special UIElementRenderer object: <br><br><pre> <code class="cs hljs">UIElementRenderer uiRenderer;</code> </pre> <br><br>  Now in the drawing cycle, we need to render and draw the interface: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDraw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, GameTimerEventArgs e</span></span></span><span class="hljs-function">)</span></span> { SharedGraphicsDeviceManager.Current.GraphicsDevice.Clear(Color.White); uiRenderer.Render(); spriteBatch.Begin(); spriteBatch.Draw(uiRenderer.Texture, Vector2.Zero, Color.White); spriteBatch.End(); <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Add your drawing code here }</span></span></code> </pre> <br><br>  As you can see, we created a uiRenderer object, but never initialized it.  There are several points of view on how to do this better.  I prefer to catch updates of our interface and check for the presence of the renderer, and in its absence or inconsistency - create anew: <br><br>  GamePage.xaml <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Layout"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">LayoutUpdated</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Layout_LayoutUpdated"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  GamePage.xaml.cs <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Layout_LayoutUpdated</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> width = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)ActualWidth; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> height = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)ActualHeight; <span class="hljs-comment"><span class="hljs-comment">// Ensure the page size is valid if (width &lt;= 0 || height &lt;= 0) return; // Do we already have a UIElementRenderer of the correct size? if (uiRenderer != null &amp;&amp; uiRenderer.Texture != null &amp;&amp; uiRenderer.Texture.Width == width &amp;&amp; uiRenderer.Texture.Height == height) { return; } // Before constructing a new UIElementRenderer, be sure to Dispose the old one if (uiRenderer != null) uiRenderer.Dispose(); // Create the renderer uiRenderer = new UIElementRenderer(this, width, height); }</span></span></code> </pre> <br><br>  Now run our project again.  As you can see, our button now appears in the right place.  Let's now draw the playing field. <br><br><h2>  2. Conclusion of XNA </h2><br>  Let's agree that our field will be 100x100 cells, each cell 30x30 pixels.  Total our field will be 3000x3000 pixels. <br>  Create a class Area: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Area</span></span> { Texture2D point; Rectangle line; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Area</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Texture2D point</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.point = point; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Draw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SpriteBatch spriteBatch</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>; i++) { line = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle(i*<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3000</span></span>); spriteBatch.Draw(point, line, Color.White); line = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle( <span class="hljs-number"><span class="hljs-number">0</span></span>, i*<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">3000</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); spriteBatch.Draw(point, line, Color.White); } } }</code> </pre> <br><br>  In XNA, there is no way to draw a line, but you can draw a rectangle filled with any color or texture.  Here we create 100 horizontal and 100 vertical lines filled with a point texture containing a black point 1x1 in size. <br><br>  Now let's create and initialize our field in GamePage.xaml.cs: <br><br><pre> <code class="cs hljs">Texture2D point; Area area;</code> </pre> <br><br>  When sharing XNA and Silverlight, there is no need to use a separate method for loading content, as it was in a pure XNA application (LoadContent).  In general, you can download game content whenever you want, but you must make sure that the application is in XNA rendering mode (by calling the SetSharingMode method) while loading the graphic content.  If you try to load graphic content during Silverlight rendering, it will cause an exception.  You can upload non-graphic content any time you have ContentManager created.  I usually load content in the OnNavigatedTo method: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNavigatedTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NavigationEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Set the sharing mode of the graphics device to turn on XNA rendering SharedGraphicsDeviceManager.Current.GraphicsDevice.SetSharingMode(true); // Create a new SpriteBatch, which can be used to draw textures. spriteBatch = new SpriteBatch(SharedGraphicsDeviceManager.Current.GraphicsDevice); // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> use this.content to load your game content here point = contentManager.Load&lt;Texture2D&gt;("point"); area = new Area(point); // Start the timer timer.Start(); base.OnNavigatedTo(e); }</span></span></code> </pre> <br><br>  Now we will draw our field in the OnDraw method: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDraw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, GameTimerEventArgs e</span></span></span><span class="hljs-function">)</span></span> { SharedGraphicsDeviceManager.Current.GraphicsDevice.Clear(Color.CornflowerBlue); uiRenderer.Render(); spriteBatch.Begin(); area.Draw(spriteBatch) spriteBatch.End(); spriteBatch.Begin(); spriteBatch.Draw(uiRenderer.Texture, Vector2.Zero, Color.White); spriteBatch.End(); <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Add your drawing code here }</span></span></code> </pre> <br><br>  As you can see, I draw the field in a separate spriteBatch.  Why is this so - I will tell you a little later. <br><br>  Let's launch our application: now we can admire our field with a button. <br>  Make a small cosmetic change: add a semi-transparent substrate under the button and make the field white. <br>  GamePage.xaml: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Layout"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">LayoutUpdated</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Layout_LayoutUpdated"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Rectangle</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Left"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0,700,0,0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rectangle1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Stroke</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Black"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StrokeThickness</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Top"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"480"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#B1000000"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Start"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"71"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"160"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"25,717,295,12"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button1_Click"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1 gen"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"72"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">HorizontalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Left"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"254,716,0,0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">VerticalAlignment</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Top"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"160"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button2_Click"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  GamePage.xaml.cs: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDraw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, GameTimerEventArgs e</span></span></span><span class="hljs-function">)</span></span> { SharedGraphicsDeviceManager.Current.GraphicsDevice.Clear(Color.White); uiRenderer.Render(); ...</code> </pre> <br><br><h2>  3. Work with gestures </h2><br>  The XNA Framework supports 10 different gestures, the story about them deserves a separate article (which, if you wish, I will write).  In our application, we will use 2 types of gestures: Tap (click) and FreeDrag (free movement). <br>  Let's start by adding points to our field.  I do not want to give the full code of the Dots class here, you can download the example at the bottom of the article and see it yourself.  We will now be interested only in the AddDot method, which is used to add points: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddDot</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, Vector2 shift</span></span></span><span class="hljs-function">)</span></span> { DotX = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(x / DotSize ); DotY = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(y / DotSize ); DotsNow[DotX, DotY] = !DotsNow[DotX, DotY]; }</code> </pre> <br><br>  In this method we transfer the coordinates of the touch point, and on its basis we calculate the desired cell in the matrix.  It's simple. <br><br>  First, we need to enable gesture support in the OnNavigatedTo () method: <br><br><pre> <code class="cs hljs">TouchPanel.EnabledGestures = GestureType.Tap | GestureType.FreeDrag;</code> </pre><br><br>  Now you can track them in the OnUpdate loop: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, GameTimerEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (TouchPanel.IsGestureAvailable) { GestureSample gesture = TouchPanel.ReadGesture(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gesture.GestureType == GestureType.Tap) { dots.AddDot((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)gesture.Position.X, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)gesture.Position.Y); } } }</code> </pre> <br><br>  Do not forget to display our live cells on the screen in the OnDraw () method: <br><br><pre> <code class="cs hljs">dots.Draw(spriteBatch);</code> </pre> <br><br>  If you start the application now and try to add a point, it will instantly disappear.  The reason for this is the update rate.  You need to implement some delay to call dots.Update ().  My example is the simplest implementation of this delay: <br><br><pre> <code class="cs hljs">i++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsGameStarted &amp;&amp; Math.IEEERemainder(i, <span class="hljs-number"><span class="hljs-number">15</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { i = <span class="hljs-number"><span class="hljs-number">0</span></span>; dots.Update(); }</code> </pre> <br><br>  Where IsGameStarted is a flag that changes value when you click the Start button.  The second homework is to implement the delay using the GameTime class. <br>  Now we have a fully functional game, but we see only a small part of the field.  Let's fix this by adding the ability to navigate the field. <br><br><h2>  4. Work with the camera </h2><br>  In the simplest approximation, the camera is a certain matrix with the help of which we project our game world onto the screen as an image.  The Matrix class has many corresponding methods, for example, CreateScale (), CreateTranslation (), CreateRotationX ().  Just CreateTranslation () and we need.  First, we find out how much we need to move our game world and create a matrix: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (TouchPanel.IsGestureAvailable) { GestureSample gesture = TouchPanel.ReadGesture(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gesture.GestureType == GestureType.Tap) { dots.AddDot((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)gesture.Position.X, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)gesture.Position.Y, totalShift); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gesture.GestureType == GestureType.FreeDrag) { shift = gesture.Delta; totalShift += shift; } } matrix *= Matrix.CreateTranslation(totalShift.X, totalShift.Y, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre> <br><br>  Then you need to draw a new projection.  To do this, you need to transfer our matrix to spriteBatch: <br><br><pre> <code class="cs hljs">spriteBatch.Begin(SpriteSortMode.Deferred, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, matrix); area.Draw(spriteBatch); dots.Draw(spriteBatch); spriteBatch.End();</code> </pre> <br><br>  That is why we needed the second spriteBatch: if we were to draw everything in one, our button would also move with the field, which we do not need.  Homework - see what happens if you place the drawing of the game and the interface in one spriteBatch. <br>  One problem remains - we do not take into account the shift of our camera when adding points.  This is solved simply, the totalShift must also be passed to the AddDot () method: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddDot</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, Vector2 shift</span></span></span><span class="hljs-function">)</span></span> { DotX = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(Math.Abs(x-shift.X) / DotSize ); DotY = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(Math.Abs(y-shift.Y) / DotSize ); DotsNow[DotX, DotY] = !DotsNow[DotX, DotY]; }</code> </pre> <br><br>  Now points will be added in the places we need.  Homework: when you try to add a living cell outside the field, it will still be the wrong reaction: either adding to the mirror point, or going beyond the bounds of the array.  Make it so that you can not go beyond the field. <br> <a href=""><img src="http://habrastorage.org/storage2/ab4/f03/69a/ab4f0369a7daf420f0f10d022f0b53fc.png"><br></a>  <i>Cheshire Cat</i> <br><br><h1>  Conclusion </h1><br>  Actually, that's all.  You have quite a workable game Life for Windows Phone and homework, on which you can smash your head for a couple of hours.  You can also make various buns, such as the counter of generations, random filling and much more.  You can find my final version in the Marketplace called <a href="http://www.windowsphone.com/ru-RU/apps/e7c4488f-137d-4401-a625-bac86ad61ba6">SilverLife</a> . <br><br>  <a href="https://skydrive.live.com/redir.aspx%3Fcid%3Da2567e038f37be43%26resid%3DA2567E038F37BE43!479%26parid%3DA2567E038F37BE43!463%26authkey%3D!AGpRA2Ko1P_S0TQ">Download the source code of the application</a> . <br><br>  Have a good New Year holidays! </div><p>Source: <a href="https://habr.com/ru/post/135706/">https://habr.com/ru/post/135706/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135696/index.html">ZIP compression</a></li>
<li><a href="../135700/index.html">Double buffering or Back to the past. Part two</a></li>
<li><a href="../135701/index.html">Customer and freelancer. Interaction. Part 2</a></li>
<li><a href="../135703/index.html">OpenStreetMap-based group chat (MapChat)</a></li>
<li><a href="../135704/index.html">Programming for the PlayStation 2 - start</a></li>
<li><a href="../135707/index.html">Siberian technology in Abu Dhabi</a></li>
<li><a href="../135709/index.html">Lego and Arduino mechanical display</a></li>
<li><a href="../135712/index.html">Rust programming language overview</a></li>
<li><a href="../135713/index.html">Free cloud-based PHP-MySQL hosting for a small site based on Amazon AWS</a></li>
<li><a href="../135717/index.html">Release MODx 2.2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>