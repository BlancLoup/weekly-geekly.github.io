<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ZX Spectrum 128k do it yourself. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="First part here 

 All images are clickable. 

 More than a year has passed since I wrote an article about the assembly of the ZX Spectrum clone "Leni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ZX Spectrum 128k do it yourself. Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/kc/wq/-j/kcwq-jvvuygc9r-dtrztad_7yyo.jpeg" alt="image"><br>  <b>First part</b> <a href="https://habr.com/ru/post/410081/">here</a> <br><br>  All images are clickable. <br><br>  More than a year has passed since I wrote an article about the assembly of the ZX Spectrum clone "Leningrad".  And during this time, its capabilities have significantly expanded.  I did not think that I would write its continuation, but still there were not so many articles on retrocomputers, so I decided. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Expansion port </h4><br>  A computer to which nothing can be connected is very limited in capabilities and I decided to solder the expansion port to it.  In addition to the 40 pin IDE, nothing more fit on the board, but after calculating the number of contacts I needed, that was enough.  Minus one contact on a key, 2 contacts on + 5v, 2 contacts on the earth. <br><a name="habracut"></a><br> <a href=""><img src="https://habrastorage.org/webt/qu/tk/-g/qutk-g-uv0q8dsjkuk_9bm41ajo.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/tw/lx/rt/twlxrtx6s4rkrbbvsog1jai1-lg.jpeg"></a> <br><br><h4>  Keyboard in case </h4><br>  Earlier, I used an external keyboard, but I wanted a more authentic form factor.  At the time of the assembly I drove Claudia from the Spectrum from the 90s with stickers.  Ports for Sinclair joysticks and the RESET button fastened to it.  The case is simple, cut out a rectangle in the case and fasten it to the board on the rack.  The back part also had a little drank. <br><br> <a href=""><img src="https://habrastorage.org/webt/ny/nh/dj/nynhdjjpjue_avdd_qpepewrtuc.jpeg"></a> <br><br><h4>  No download games </h4><br>  Cartridges for Spectrum we were not popular, unless you count the game console ALP.  Not that they were popular in Europe, as they required an expensive device ZX Interface 2. Officially, only 10 games were released.  The cartridge is just a ROM with a prerecorded game on the board with a set of contacts, so making this device is a snap.  I have long wanted to try to erase the board and now is the case.  But first, it must also be diluted, for this purpose I used the sprint layout program. <br><br> <a href=""><img src="https://habrastorage.org/webt/a_/bt/06/a_bt06lorwtzq5wdnn4ylp5pgu0.png"></a> <br><br>  On the Leningrad board itself, only soldered the pull-up resistor to the 20th pin of the ROM and the pin itself brought to the expansion port.  When the cartridge is connected, it will be fed + 5v and will turn off the computer's ROM.  Well, contact / RDROM also brought to the expansion port.  Well, the board is divorced, we cut a small square out of a piece of Soviet PCB. <br><br> <a href=""><img src="https://habrastorage.org/webt/ie/fo/f9/iefof926tixw9mib9n_lwokvjf4.jpeg"></a> <br><br>  We put a page from a glossy magazine in the printer, print and turn on the iron. <br><br> <a href=""><img src="https://habrastorage.org/webt/p-/jo/dh/p-jodheeqywabfekwz60d-c4vvu.jpeg"></a> <br><br>  The board is double-sided, we make an envelope from the pages with a stapler. <br><br> <a href=""><img src="https://habrastorage.org/webt/m6/5l/bg/m65lbgi6pz1kg3rbzjhobhgnggy.jpeg"></a> <br><br>  It turned out something like this, of course it was necessary to paint over some areas better with a marker. <br><br> <a href=""><img src="https://habrastorage.org/webt/i7/nn/lm/i7nnlmw_epjwtpoudx-risobgem.jpeg"></a> <br><br>  I chose ferric chloride for etching, although I know that it is full of other newfangled methods. <br><br> <a href=""><img src="https://habrastorage.org/webt/3u/z5/no/3uz5nozg2igriv3t-b4-p-owd2y.jpeg"></a> <br><br>  It turned out so-so. <br><br> <a href=""><img src="https://habrastorage.org/webt/du/d_/xj/dud_xjjv-u3yvayjwd0z4elzxns.jpeg"></a> <br><br>  And then fiercely, he messed up the layers during the printout, noticed only after the board was etched.  A new piece of PCB cut was too lazy and desperate I made vias.  In vain I began to tinker with the tracks, as sometimes there were pieces of foil on the soldering iron tip, without MGTF, and this was not done.  The ROM for the cartridge, as well as for Leningrad itself, chose the EEPROM W27C512.  For the selection of games (4 pieces of 16kb each) I used the 74HC393 counter so that when the RESET button was pressed, they would switch as in DANDY collections.  But it was a bad idea and in the end I dropped the counter and made the switch with two deep switches.  Fill with hot melt glue for rigidity soldering 40 pin contact. <br><br> <a href=""><img src="https://habrastorage.org/webt/0z/0o/i4/0z0oi4b_x4192qhz0awos4_9qya.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/i4/zm/v6/i4zmv6ulq3-mtg8jieibvanavmg.jpeg"></a> <br><br>  Programmer at that time I already got my own.  Fill all hits from Ultimate Play The Game including Jetpac.  Of course, I later tried others, including games that were not yet released, such as Gyruss and Star Wars. <br><br> <a href=""><img src="https://habrastorage.org/webt/ge/vq/7s/gevq7s4alvhikj6v3mmjjht7xes.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/ct/-c/ex/ct-cex6gr8xklawfs4asf75_kdo.jpeg"></a> <br><br><h4>  We connect the drive </h4> <br>  Although I already have tape and cartridges as storage media, the softness of course is in the use of a floppy drive.  The best games, such as Black Raven, UFO, are written under this carrier: the enemy is unknown, and in the near future POWER BLADE will appear, besides almost all toys from the tape have been ported under it.  Download speeds are 15-20 times faster than downloads from a tape recorder, the volume of a floppy disk formatted in TR-DOS is 640kb, the profit is obvious.  But the drive itself is not connected to the Spectrum, you will still have to assemble a half-room - a controller of a floppy disk drive, also known as CNLMD.  The scheme of this device I decided to take from the site zxbyte.ru, like many other improvements of Leningrad. <br><br> <a href=""><img src="https://habrastorage.org/webt/--/m8/-d/--m8-d_nmspbzxdfxifky7elw9m.png"></a> <br><br>  I decided to be a realist and I‚Äôll probably reconnect the 15-chip circuit only to the next century, so I started collecting it on a breadboard.  Well, I really wanted to put the board in a compact case.  The heart of domestic disk drive controllers was the KR1818VG93 chip.  The disadvantage of it is quite significant, it required 12 volts and did not differ in reliability.  Therefore, I ordered an MB8877 analogue chip, which works fine from five.  I do not know the Chinese sent me the original or a fake, but it works and it is wonderful.  Choosing the CNGMD C-48 scheme, which was created to connect to Leningrad and the Baltics, faced an unpleasant detail, on the reading node the PLL logic was implemented on the K556RT4 PROM chip, which my Chinese programmer did not know about.  I tried replacing the previously used W27C512 instead, but either I‚Äôve got something wrong, or there were problems in the EEPROM itself, but I didn‚Äôt work on the floppy, although I was already able to enter TR-DOS.  Then I reassembled the Pentagon-128 reading node without the PLL and, as a result, the drive was able to format a floppy disk.  By the way, standard high-density diskettes need to glue holes in the corner so that they appear in the drive as double-density diskettes. <br><br> <a href=""><img src="https://habrastorage.org/webt/g-/cy/9m/g-cy9mjvutbjzl-sh9xydzk_q5e.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/4f/sc/hh/4fschhmiyin4t93m34gopiqtijq.jpeg"></a> <br><br>  What a relief to use diskettes, after downloads, even accelerated from tape / phone.  The KNGMD scheme is simplified and can work with only two drives (in the same pentagon and many other clones up to 4), although this is enough for the eyes.  Having played enough with a 3.5 "drive, I wanted to buy 5.25" and it earned without problems, by the way, I first touched five-inch floppy disks, they are so flexible, flexible, in general, a high.  For convenience, I flashed instead of the BASIC-128 Quick commander, he knows how to play music and watch images and all kinds of file operations. <br><br> <a href=""><img src="https://habrastorage.org/webt/m9/sq/ie/m9sqiemh41bedgei-eiinov5u3k.jpeg"></a> <br><br>  To write a TR-DOS floppy image on a PC, I use the ZX Studio software, and to build my own ZX Spectrum Navigator image. <br><br> <a href=""><img src="https://habrastorage.org/webt/zu/-w/ks/zu-wks4rwamxg93jntictpd5j0c.jpeg"></a> <br><br> <a href=""><img src="https://habrastorage.org/webt/cz/sb/h3/czsbh3hqp5s_nx2lpwmrpe8zt_s.jpeg"></a> <br><br><h4>  Watch demos </h4><br>  Our demoscene developed mainly under the Pentagon-128 clone of the Spectrum, and by virtue of the circuitry features, it had 71680 cycles for drawing one frame, while 69x88 cycles were the company‚Äôs zen spectrum, and 65184 cycles were only for Leningrad because of the memory response delays.  For most games and other programs, this did not really matter, but not for demos.  Cut the signal / WAIT and put it on + 5v.  on the leg 9D5 we feed the ground instead of the signal / BC.  But Spectrum multicolor may not work with Pentagon timings, so we will make a jumper Spectrum / Pentagon.  With the CMOS version of the processor (Z84), this option did not work, but there are no problems with the U880.  The computer did not receive 100% compatibility with the pentagon, but the demos written for the pentagon no longer slow down.  I really liked REFRESH, developed back in 1998. <br><br> <a href=""><img src="https://habrastorage.org/webt/7n/fj/s3/7nfjs38140c13rpimje7pefwcvm.jpeg"></a> <br><br><h4>  We work in SR / M-80 </h4><br>  Few clones could run this OS, you can recall the BYTE-01, Quorum-64, ZS Scorpion 256, Pro.  To work with SR / M, the computer must have shadow RAM support.  And since the ZS Scorpion 256 is Leningrad on the speeds, there will not be much difficulty in modifying it.  We swing the <a href="">scheme</a> and we study.  Disconnects the ROM with bit 0 of port # 1FFD as well as at spectrum +3, which from the box had the ability to run CP / M.  And bit 4 switches the pages by 128kb.  I also switch bit 6 of port # 7FFD, which conflicts in some cases with programs, although I only had a problem with one demo.  I had to redraw <a href="">the expansion scheme</a> to support port # 1FFD.  Did it in the paint, it turned out like that. <br><br> <a href=""><img src="https://habrastorage.org/webt/bp/oh/wi/bpohwivj_i1rpkid_ufynzewxwm.png"></a> <br><br>  I no longer have space on the board, I regretted 100 times that I did not take a 20 * 30 board under the ATX case.  Since we no longer use the 6 bits of the # 7FFD port, the 1533TM2 chip is now superfluous, instead we put 1533TM9, on which we start 0 and 4 bits of the # 1FFD port.  We use the maximum of 1533KP12 in the expansion scheme, thereby freeing the necessary OR element.  We check by writing to the CP / M diskette from the scorpion kit.  Works! <br><br> <a href="https://habrastorage.org/webt/2r/qj/hn/2rqjhnb6o8mbpncu2dduclmf2ug.jpeg%2522%2522"><img src="https://habrastorage.org/webt/2r/qj/hn/2rqjhnb6o8mbpncu2dduclmf2ug.jpeg"></a> <br><br>  It is a bit unusual to see CP / M with a gray background and black letters, but those who ported it apparently wanted similarities with the native BASIC-48.  By default, the OS has 48kb of RAM and a 160kb RAM disk, it starts up with 64 characters per line (3 pixels wide + space), which is not very well readable but tolerable.  Utility mode, you can change to 32, 40.48 and 80 required for most programs (3 pixels wide without spaces, unreadable space) characters.  Some clones had high resolution modes, for example, Byte-01 with 512x192 mode, which made it quite suitable for working with CP / M.  But the brand spectrum +3, the scorpion 256, and most other clones did not have such happiness, which probably caused the unpopularity of this OS on the spectra.  About the CP / M-80 itself, or rather its version 2.2 of 1979, you can write a separate article, I‚Äôll just go over the software. <br><br>  <b>OFFICE</b> <br><br>  Text editor WORDSTAR, very functional text editing, one of the progenitors of MS WORD. <br><br> <a href=""><img src="https://habrastorage.org/webt/08/wn/xw/08wnxwlfzoow8v03l3b2ppaaycs.jpeg"></a> <br><br>  Spreadsheets Varitab, a Soviet-Bulgarian development, very much like SuperCalc, was it translated into a great and powerful western program, or made in the image and likeness, well, or there was some kind of licensing, I hope in the comments will prompt.  There is still Varitab-86 for MS-DOS, it may have been used by many.  I‚Äôm not able to start another Multiplan spreadsheet from MicroSoft, maybe it took 25 lines instead of 24. <br><br> <a href=""><img src="https://habrastorage.org/webt/g6/qy/kx/g6qykxzqgycpqnupcjxztruy2h4.jpeg"></a> <br><br>  <b>Programming</b> <br><br>  On CP / M is just a paradise for programmers, here you can find Turbo Pascal and C compiler, Fortran compiler, ADA compiler, FORT-83 language, assembler, MS BASIC, PL / 1 translator and much more. <br><br>  <b>Games</b> <br><br>  Yes, there were games on CP / M, mostly text quests, such as the ZORK trilogy, unfortunately with my level of English I cannot evaluate them. <br><br> <a href=""><img src="https://habrastorage.org/webt/yq/do/6j/yqdo6jysfj_qjimpxnc1bgyqflw.jpeg"></a> <br><br>  Chess was also popular, such as SARGON. <br><br> <a href=""><img src="https://habrastorage.org/webt/yh/pf/kf/yhpfkfcu_a4e4dh2a39ty4eozvi.jpeg"></a> <br><br>  But there were also action games, for example, Ladder, quite playable platformer. <br><br> <a href=""><img src="https://habrastorage.org/webt/fw/js/3p/fwjs3panewhm83uixvhhpirldw4.jpeg"></a> <br><br>  Clone PAC MAN. <br><br> <a href=""><img src="https://habrastorage.org/webt/mb/cv/2v/mbcv2viprfp4wid1xiwr707bfaa.jpeg"></a> <br><br>  And what about without His Majesty TETRIS. <br><br> <a href=""><img src="https://habrastorage.org/webt/vc/lu/ev/vcluev6iiv5l__zd7dirlaqs9qu.jpeg"></a> <br><br><h4>  Epilogue </h4><br>  The result was a fairly functional machine for retro and not very gaming, watching demos, listening to chiptune and other entertainment.  Appetite comes with eating and you have thoughts to assemble a mouse controller, a hard disk controller, COVOX, finally bring the Kempston joystick according to the zx spectrum next standard, overclock the computer to 7 MHz ... but is it worth it? </div><p>Source: <a href="https://habr.com/ru/post/446366/">https://habr.com/ru/post/446366/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446352/index.html">Protection without protection</a></li>
<li><a href="../446354/index.html">Security Week 14: ShadowHammer and supply chain</a></li>
<li><a href="../446360/index.html">The exhibition ‚ÄúNedra-2019. Study of. Intelligence service. Production"</a></li>
<li><a href="../446362/index.html">3 Key Qualities for a Successful Product Manager: Dmitry Orlov, Senior Product Manager</a></li>
<li><a href="../446364/index.html">Jokes and references from the Simpsons in English, which need to be explained</a></li>
<li><a href="../446370/index.html">"Well, again, the weather station"? Not quite</a></li>
<li><a href="../446372/index.html">Love quests, love and find your personal data in public</a></li>
<li><a href="../446378/index.html">The problem of the transition to winter and summer time for a single Skype school</a></li>
<li><a href="../446380/index.html">H2 Evolution - window functions, CTE, JSON / XML in embedded database</a></li>
<li><a href="../446384/index.html">Tips for developing very large projects in Revit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>