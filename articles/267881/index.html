<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>12 typical database backup errors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Initially, this article was conceived only for developers and administrators of Firebird DBMS, but after talking with administrators of other database...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>12 typical database backup errors</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d5e/2c0/aaa/d5e2c0aaaabe4e7089fc8babf9242b47.jpg" align="left"><br>  <i>Initially, this article was conceived only for developers and administrators of Firebird DBMS, but after talking with administrators of other databases, it turned out that most of the errors are common, and literally everything comes to a very similar rake.</i>  <i>If you can add something to this list (even if it is specific for a particular DBMS), write to your personal email or in the comments.</i> <br>  <a href="http://ib-aid.com/en/articles/12-common-mistakes-while-backing-up-databases/">In English: 12 Common Mistakes while Backing Up Databases</a> <br><br>  Our company is engaged in recovery, backup, optimization and DBMS support tools (mainly Firebird, but there are also MSSQL, PostgreSQL, InterBase, etc.) and, as a result of numerous audits and repairs, has accumulated a collection of backup-related errors.  All items below are set out based on real cases with database damage, loss and damage of backups, disks, server crashes, and other ‚Äújoys‚Äù of database administrators. <br><br>  I would like to talk about them so that administrators and developers can change their approaches to backup management and prevent possible problems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So let's get started. <br><a name="habracut"></a><br>  <b>1. Delete the previous backup copy before creating a new backup copy</b> <br>  Most often, this error is made by newbies who do not understand that the main purpose of the backup database is to provide a minimal simple information system (an important part of which is the database), and not just creating a copy of the database. <br>  As a result, from the moment of deleting the last backup before creating a new one, the system is in an unprotected state, because during this period the database does not have a single backup copy.  Since the backup can be created for a long time, this is the ideal time to trigger the Murphy law.  This approach works especially well in conjunction with clause 7 (see below). <br>  <i>Recommendation</i> : do not delete the previous backup until the new one is created!  (and do not make a new backup to an existing file) <br><br>  <b>2. Overwriting an existing database when restoring from a backup</b> <br>  This mistake is made less often, but the results can be much sadder.  If the backup was not checked and was damaged (see clause 6), then as a result of overwriting, you will not have either the previous copy of the database or the valid backup. <br>  Usually this disgrace happens on Friday evening, at the time of dergotni, confusion and conflicting instructions from the authorities.  A little negative luck and languid weekend in the server provided. <br>  Firebird has some protection against this error - creating a restauran from a backup using the gbak utility with the default key ‚Äìcreate will not work if the specified file name points to an existing database.  Unfortunately, there is also a bypass of this protection - the ‚Äìrep switch, which allows you to overwrite the existing file. <br>  <i>Recommendations</i> : never overwrite the combat database file without receiving written instructions from the management and, preferably, without receiving a proposal for a new job. <br><br>  <b>3. Using a one-step backup restaurant, without creating an intermediate backup file</b> <br>  Standard I / O streams allow you to turn with many DBMS (including Firebird) an interesting trick: perform a stream backup with immediate recovery of the database from it.  As a result, an intermediate backup file is not created.  This is convenient for maintenance and running a test restore (if you have another backup), but in no case should you use it for an automatic backup! <br>  If in the process of such a backup-restaurant a serious disk failure occurs, for example, the original database may be damaged, and a new one will not be created yet.  Of course, if item 1 is observed, and there is a copy of the database from the previous attempt, then only data that has been created or modified in the database since the creation of its copy will be lost. <br>  <i>Recommendations</i> : do not use single-step backup-restore in automatic mode, and in manual mode always check for a sufficiently fresh copy. <br><br>  <b>4. Storage of backup and database on the same physical device</b> <br>  Here, many may laugh, that we give some children's advice ‚Äî this is the ABC of system administration.  That's the way it is, but due to the proliferation of virtual environments and the database, and the disk can be on the same storage system.  And it will surely break at the most inappropriate moment for the business.  Plus, there are still people who believe that if they use RAID (from 1 or higher), nothing can happen to their data at all.  There are still people who believe in the super-reliability of ‚Äúbranded‚Äù iron, but this is a special case. <br>  <i>Recommendations</i> : do not store backup and database on the same physical device, no matter how reliable it may seem. <br><br>  <b>5. Lack of verification of successful completion of backup</b> <br>  This is quite a common mistake of both administrators and IT managers.  If the result of the backup is not checked, then you can not backup at all - the result is generally the same.  Be sure to need notifications by email about a successful backup, and even better by SMS.  Moreover, the lack of notification is a sign of a problem! <br>  And where are the leaders, the attentive reader will ask, who has read this far?  And despite the fact that the administrator will usually configure the backup, he will be too lazy to check the notifications, especially since they are in his separate daddy, and therefore the head of the IT department should periodically request an additional report on the status of all backups.  This is the question of who to punish if there are some backups, but at the right moment they were not there :) <br>  !  And when combined with paragraph 2, we get the absence of both the base and the backup. <br>  <i>Recommendations</i> : use backup automation tools that can track successful and unsuccessful backups, report problems to users, and have an overview of controls (especially important when you need to control tens and hundreds of backups on different servers). <br><br>  <b>6. Lack of validation backups</b> <br>  The fact that backups are put somewhere does not mean that they can be read from there. <br>  Therefore, periodic verification of backups created is mandatory, to be sure that the backups being created are not damaged, have not been copied to / dev / null <br>  <i>Recommendations</i> : do not trust anyone, even yourself.  All need to check. <br><br>  <b>7. Lack of health check database when using unverified backups.</b> <br>  Usually DBMS have several types of backup - dumps, just backups, etc.  Without going into specifics, we can distinguish 2 categories - verified and unverified backups.  Firebird has gbak and nbackup. <br>  Gbak reads the entire database at the record level to create a backup file, and creates the database by inserting records into the new database, and thus verifies the backup (there are options for how errors can leak into the replicated copy, but this is another type of database administrator‚Äôs fix with incorrect migration), and the database itself (if it can be read from beginning to end, then with a high degree of probability it is not damaged). <br>  Nbackup (also known as incremental backup) temporarily blocks the main database file for writing (in a consistent state), and allows you to quickly copy the database file (fully or partially / incrementally). <br>  For large Firebird databases (more than 500GB), it is preferable to do nbackup, so as not to slow down users, but you need to check the database, because the created unverified backups are page copies of the database, and if the error nests at the record level (this happens because of a failure RAM) or at a logical level, then an unverified backup will contain it in the same way as the original database. <br>  To do this, you need to use the online validation of the source database (in Firebird, starting from version 2.5.4, online validation using gfix is ‚Äã‚Äãavailable, and our <a href="http://ib-aid.com/en/fbdataguard/">FBDataGuard</a> tool supports online database checking for versions 1.5-2.5). <br>  Also, in addition to an unverified backup, it is advisable to make a verified backup periodically (once a week, for example). <br>  For other DBMS, you must use the appropriate tools and combinations of checks. <br><br>  <b>8. Lack of control over the space for backup</b> <br>  In general, this is a classic mistake - with insufficient space, the backup takes up all the free space and crashes.  When placing a backup on the same disk along with the database, it can lead to stopping the work with the database, and when placed on the system disk, it can lead to system failure. <br>  In combination with point 4, at best, we will get the system to stop working, because the database also needs free space, and it has ended because of the backup. <br>  And in combination with points 5 and 2, we again receive as a result the absence of both the base and the backup. <br>  <i>Recommendations</i> : use backup tools that make a forecast of the size of the backup and warn you of a possible lack of space. <br><br>  <b>9. Lack of time control for backup duration</b> <br>  Just six months ago, the backup lasted 40 minutes, and suddenly it became 3 hours - why?  Perhaps the size of the database has grown, or maybe the disk has fallen out of the RAID array, which has caused the write speed to deteriorate dramatically, and all your backups are about to leave this mortal world.  Or maybe a good colleague simultaneously included another backup system (by the way, you can run several backups in Firebird at once, only it‚Äôs not very clear why this might be necessary). <br>  If you do not control the execution time of the backup, then you can overlook the problem and miss the chance to fix it before it becomes large. <br>  Also, if the backup system does not track the status of tasks, but simply launches them on schedule, you can easily get to the ‚Äúmorning trolley bus‚Äù - this is when a new backup can start at the moment when the previous backup is not over. <br>  <i>Recommendations</i> : use the means of controlling the duration of the backup process. <br><br>  <b>10. Execution of database backup during application of OS updates</b> <br>  A very common problem, especially in combination with p.9 and the included automatic updates of Windows (which by default occur at 3 nights).  At best, it slows down the process, and if the OS is overloaded to use updates, then the backup will be corrupted.  It's good that OS updates don't happen every day. <br>  <i>Recommendations</i> : If you can not turn off, then assign OS updates at a time when they can not interfere with backups. <br><br>  <b>11. Database backup by means of file backup or by means of backup of the virtual machine entirely, with the database server turned on</b> <br>  Many administrators forget about the fact that any DBMS has an active and complex cache that contains read and write data, and the database files themselves are opened in random access mode. <br>  That is why it is necessary to use special types of backup, and not a simple file backup (including simple copying of database files) or backup of a virtual machine.  File backup tools read the database consistently and, especially for large databases, can take a long time, so the integrity of the created copy cannot be guaranteed. <br>  For those who want to backup the database using file tools or tools for backing up virtual machines, you can offer 2 ways: <br><ol><li>  completely shut down the services and processes of the DBMS so that nothing is in the cache, </li><li>  use agents and / or scripts that translate databases into a special mode when copying a database file in a consistent manner is safe. </li></ol><br>  For Firebird, you need to block the main database file using nbackup before starting the backup and unlock it after it is finished, for other DBMS there are similar means to enable / disable the corresponding modes. <br><br>  Some database administrators are convinced that if the DBMS has a transaction log, then such a database can be safely backed up using standard file tools, in the extreme case, only this log will be damaged.  This is a dangerous misconception that is not supported by database vendors. <br><br>  The roots of this misconception are clear: aggressive advertising from virtual machine manufacturers and from manufacturers of backup tools is usually silent on the fact that additional settings are needed for databases and other actively changing files.  Do not trust advertising - not all yogurts are equally useful. <br>  <i>Recommendations</i> : do not use file backup tools and VM backup tools without appropriate automation tools. <br><br>  <b>12. Replacing backup replication</b> <br>  Backup and data replication serve to increase reliability and prevent data loss, but still differ significantly. <br>  Everyone loves replication for the ability to synchronize data on another server with minimal latency, however, backup also has a number of undeniable advantages.  For example, in case of accidental (or intentional) deletion of data, replication quickly and calmly transmits changes to the replica, and the backup, especially on read-only media, is unresponsive to such operations.  Setting up the correct replication, as well as the correct backup, is worth some effort, and the likelihood of errors there also exists. <br>  <i>Recommendations</i> : If you have replication configured, do not neglect backups, use them together. <br><br>  <b>findings</b> <br>  Properly organizing backups for your beloved DBMS is not so easy, so usually DBA administrators from organizations that value data usually use professional backup tools that allow you to take into account and prevent the errors described above.  For Firebird (sorry for advertising) there is <a href="http://ib-aid.com/ru/contacts/">our</a> FBDataGuard, for other DBMS you can use DBArtisan or other means. <br><br>  <i>Well, and of course - do not forget to groom and cherish your admin paranoia, for example, take and check your backups ... right now!</i> <i><br></i> <br><br>  <b>UPDATE</b> <b><br><br></b>  <b>Gentlemen, please respond to the PM of those who use CBT on VMWare for VM with DB.</b> <br></div><p>Source: <a href="https://habr.com/ru/post/267881/">https://habr.com/ru/post/267881/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267871/index.html">Drone dodging probe: Expose the sensation</a></li>
<li><a href="../267873/index.html">Attempt to implement universal parser online stores using SlimerJS</a></li>
<li><a href="../267875/index.html">19 principles of development on BEM, or what every library developer should know</a></li>
<li><a href="../267877/index.html">Partner Seminar "1C" - for the first time not only for partners</a></li>
<li><a href="../267879/index.html">Financial Computing Challenge</a></li>
<li><a href="../267883/index.html">Optimization of communication channels for mining in the north of Russia</a></li>
<li><a href="../267887/index.html">.sorting in Perl 6</a></li>
<li><a href="../267889/index.html">GitFlow and Semantic Versioning for every day</a></li>
<li><a href="../267893/index.html">Checking Appleseed source code</a></li>
<li><a href="../267895/index.html">Creating a JavaScript Synthesizer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>