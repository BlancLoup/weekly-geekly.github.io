<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another post about building a front-end project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I spent decently time structuring and automating the assembly of the front. The task is interesting and worth mentioning. 

 What the collector can do...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another post about building a front-end project</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/64e/343/aea/64e343aeab1a4076b892db50b4f9be72.png" alt="Js app starter"><br><br>  I spent decently time structuring and automating the assembly of the front.  The task is interesting and worth mentioning. <br><br>  What the collector can do: <br><ul><li>  Build a front-end project for development &amp; production environments. </li><li>  Collect several js / css bundles per project. </li><li>  Use CommonJS style modules in the browser. </li><li>  Use ES6 syntax. </li><li>  Sprites, pictures and more. </li></ul><br><a name="habracut"></a><br><h4>  Introductory </h4><br>  To make it easier to follow the thought, I immediately throw a link to the repository with the project template: <a href="https://github.com/alexfedoseev/js-app-starter">github.com/alexfedoseev/js-app-starter</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">How to start it</b> <div class="spoiler_text">  Make sure that npm is installed. <br><pre><code class="bash hljs">npm -v</code> </pre> <br><br>  Install the necessary global modules (if not already installed): <br><pre> <code class="bash hljs">npm install -g gulp browserify babel jade stylus http-server</code> </pre><br><br>  Fork the repository. <br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/alexfedoseev/js-app-starter.git</code> </pre><br><br>  Install the project dependencies (execute in the repository root): <br><pre> <code class="bash hljs">npm install</code> </pre><br><br>  Build the project in the development environment and start the local server: <br><pre> <code class="bash hljs">npm start</code> </pre><br><br>  Open a browser and go to <b>lvh.me:3500</b> <br></div></div><br>  We will use <a href="http://gulpjs.com/">Gulp</a> as a collector. <br>  What does the assembly process include and what technologies are used: <br><ul><li>  <b>HTML build</b> <br>  Template Designer: <a href="http://jade-lang.com/">Jade</a> </li><li>  <b>CSS build</b> <br>  Preprocessor: <a href="http://learnboost.github.io/stylus/">Stylus</a> <br>  Prefixer: <a href="https://github.com/postcss/autoprefixer">Autoprefixer</a> </li><li>  <b>Build js</b> <br>  Modular system: <a href="http://browserify.org/">Browserify</a> + <a href="https://babeljs.io/">Babel</a> (ES6 transpiler) <br>  Code quality check: <a href="http://jshint.com/">jsHint</a> </li><li>  <b>Image Optimization</b> <br>  Optimizer: <a href="https://github.com/imagemin/imagemin">Imagemin</a> </li><li>  If necessary: ‚Äã‚Äãbuild sprites, json processing, copying fonts and other files to the public folder <br>  <a href="https://github.com/Ensighten/spritesmith">Sprite</a> Collector: <a href="https://github.com/Ensighten/spritesmith">Spritesmith</a> <br>  <a href="https://github.com/morou/gulp-json-editor">Json</a> processing: <a href="https://github.com/morou/gulp-json-editor">gulp-json-editor</a> </li></ul><br>  <i>In general, I love Slim and Sass, but Ruby to Ruby, a JS to JS: for the frontend project we will use only pieces from npm.</i>  <i>If desired, any tool can be replaced.</i> <br><br><h4>  Project structure </h4><br><pre> <code class="bash hljs">| dist/ | lib/ |-- gulp/ |-- helpers/ |-- tasks/ |-- config.js | node_modules/ | public/ |-- css/ |-- files/ |-- fonts/ |-- img/ |-- js/ |-- json/ |-- favicon.ico |-- index.html | src/ |-- css/ |-- files/ |-- fonts/ |-- html/ |-- img/ |-- js/ |-- json/ |-- sprite/ |-- favicon.ico | .gitignore | .npmignore | gulpfile.js | npm-shrinkwrap.json | package.json</code> </pre>  <sub><a href="https://github.com/alexfedoseev/js-app-starter">Github</a></sub> <br><br>  <b>.gitignore</b> &amp; <b>.npmignore</b> <br>  Inside these files is a list of what git and npm will be ignored when commits / publish. <br><br>  <b>node_modules /</b> <br>  All the modules that we install via npm fall into this directory. <br><br>  <b>npm-shrinkwrap.json</b> <br>  I do not keep <i>node_modules /</i> contents in the repository.  Instead, I am locking all dependencies through this file  It is generated automatically by the command: <i>`npm shrinkwrap`</i> . <br><br>  <b>package.json</b> <br>  This is a file with global project settings.  To him back again. <br><br>  <b>gulpfile.js</b> <br>  Usually, all the tasks for building the project are stored here, but in our case it simply determines the value of the environment variable and sends us further to the folder with gulp-tasks. <br><br>  <b>lib / gulp /</b> <br>  Here we store all the settings and tasks of the collector. <br><br>  <b>| - config.js</b> <br>  We carry out the settings for all tasks in a separate file in order to minimize editing of the tasks themselves. <br><br>  <b>| - helpers /</b> <br>  Auxiliary methods of the collector. <br><br>  <b>| - tasks /</b> <br>  And yourself gulp-taski. <br><br>  <b>src /</b> <br>  Sources of the project. <br><br>  <b>public /</b> <br>  The result of the assembly.  Absolutely all the contents of this folder is generated by the collector and it is completely cleaned before each new build, so we never store anything here. <br><br>  <b>dist /</b> <br>  Sometimes I write opensource modules.  After assembling, this folder contains the regular and minified version of the written js-library.  In this case, the <i>public /</i> directory is used as a repository for the demo.  If you make a regular site or landing page, then it will not be needed. <br><br><h4>  Project Setup </h4><br><h5>  package.json </h5><br>  This is the file where the global project settings are stored. <br>  A detailed description of his insides can be found here: <a href="">browsenpm.org/package.json</a> <br>  Below I will focus only on some important parts. <br><br><pre> <code class="javascript hljs">{ <span class="hljs-comment"><span class="hljs-comment">//   "name": "js-app-starter", //   //     /  js+css        "version": "0.0.1", //    js-,      , //     `require('your-lib')` "main": "./dist/app.js", //  browserify //    ,      ES6  ES5 "browserify": { "transform": [ "babelify" ] }, //   ( ) "scripts": { "start": "NODE_ENV=development http-server -a lvh.me -p 3500 &amp; gulp", "build": "NODE_ENV=production gulp build" }, //  jshint (  ) "lintOptions": { "esnext": true ... }, // Frontend  "dependencies": { "jquery": "^2.1.3" ... }, // Development  "devDependencies": { "gulp": "^3.8.11" ... } }</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br><br><h5>  Console commands </h5><br>  In package.json, we can prescribe aliases for console commands that we will often perform during the development process. <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"NODE_ENV=development http-server -a lvh.me -p 3500 &amp; gulp"</span></span>, <span class="hljs-string"><span class="hljs-string">"build"</span></span>: <span class="hljs-string"><span class="hljs-string">"NODE_ENV=production gulp build"</span></span> }</code> </pre><br><br>  <b><i>Development build</i></b> <br>  Before starting work with the project we need: <br><ul><li>  compile it from source (with sourcemaps for debug) </li><li>  run "observers" who will rebuild the project when the source files change </li><li>  start local server </li></ul><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ,   npm start #      NODE_ENV=development http-server -a lvh.me -p 3500 &amp; gulp</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">We disassemble in parts</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    NODE_ENV=development #      lvh.me   3500 http-server -a lvh.me -p 3500 #  gulp  gulp</span></span></code> </pre><br></div></div><br><br>  <b><i>Production build</i></b> <br>  When we are ready to release a project, we make a production assembly. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  Ctrl+C,      ,    # ,   npm run build #      NODE_ENV=production gulp build</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">We disassemble in parts</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    NODE_ENV=production #  gulp- `build` gulp build</span></span></code> </pre><br></div></div><br><br><h4>  Gulp </h4><br>  Go to Gulp.  The structure of the task is taken from the collector by <a href="https://github.com/greypants/gulp-starter">Dan Tello</a> . <br><br>  Before diving, a small comment on the order of execution of the usual gulp-task: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>); gulp.task(<span class="hljs-string"><span class="hljs-string">'task_1'</span></span>, [<span class="hljs-string"><span class="hljs-string">'pre_task_1'</span></span>, <span class="hljs-string"><span class="hljs-string">'pre_task_2'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'task_1 is done'</span></span>); }); <span class="hljs-comment"><span class="hljs-comment">//    `task_1`,      `task_1 is done` //    `gulp task_1` //     `task_1`    `['pre_task_1', 'pre_task_2']` //  ,  'pre_task_1' &amp; 'pre_task_2' -  , //           , //  `task_1`    ,   2 pre- -   </span></span></code> </pre><br><br>  Now we will understand what and in what order we will collect. <br><br>  <b><i>Development build</i></b> <br>  <i>`npm start`</i> runs <i>the` gulp`</i> command.  What happens next: <br><br><ul><li>  Gulp searches the current directory for <b><i>gulpfile.js</i></b> .  Usually all tasks are added to it, but here it will simply determine the value of the environment variable and forward us further to the folder with gulp tasks. <br><br><div class="spoiler">  <b class="spoiler_title">Code with comments</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: gulpfile.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">// ,       var requireDir = require('require-dir'); //    , //     development &amp; production  global.devBuild = process.env.NODE_ENV !== 'production'; //         requireDir('./lib/gulp/tasks', { recurse: true });</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br></div></div><br></li><li>  After we have been forwarded to the directory, the collector looks for a task called <i>`default`</i> , which first launches" observers "over the sources, then: <br><ul><li>  clears the <i>`public /`</i> &amp; <i>`dist /`</i> folders </li><li>  lint js files </li><li>  and collects sprites </li></ul><br>  After that, the project is going to (html, css, js and everything else). <br><br><div class="spoiler">  <b class="spoiler_title">Code with comments</b> <div class="spoiler_text">  <b><i>default</i></b> <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: lib/gulp/tasks/default.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    `default`,     `watch` gulp.task('default', ['watch']);</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br><br>  <b><i>watch</i></b> <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: lib/gulp/tasks/watch.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>), finder = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../helpers/finder'</span></span>), <span class="hljs-comment"><span class="hljs-comment">//     config = require('../config'); //  //   `watch`,     `watching` &amp; `build` gulp.task('watch', ['watching', 'build'], function() { //        `css`, `images` &amp; `html` //         gulp    gulp.watch(finder(config.css.src), ['css']); gulp.watch(finder(config.images.src), ['images']); gulp.watch(finder(config.html.src), ['html']); }); gulp.task('watching', function() { //    `isWatching`, //  ,    global.isWatching = true; });</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br><br>  <b><i>build</i></b> <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: lib/gulp/tasks/build.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   `build`,    : // `clean` -     `public/` &amp; `dist/` // `lint` -  jshint  js- (  ) // `sprite` -   gulp.task('build', ['clean', 'lint', 'sprite'], function() { //  ,     ,   `bundle` //   `gulp.start` deprecated, //    sync/async     Gulp 4.0, //     gulp.start('bundle'); }); //   gulp.task('bundle', ['scripts', 'css', 'images', 'html', 'copy'], function() { //    dev-,       `doBeep` = true // `notifier`           // (    ) if (devBuild) global.doBeep = true; });</span></span></code> </pre>  <sub><a href="">Github</a></sub> </div></div></li></ul><br>  <b><i>Production build</i></b> <br>  Everything is easier with her.  <i>`npm run build`</i> runs <i>the` gulp build` command</i> , which clears the target folders, scans the js code, builds the sprites and then builds the project (without sourcemaps).  Code with comments above. <br><br><h5>  Gulp-task configuration file </h5><br>  All basic configurations of tasks are moved to a separate file <b><i>lib / gulp / config.js</i></b> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: lib/gulp/config.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pkg = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../../package.json'</span></span>), <span class="hljs-comment"><span class="hljs-comment">//  package.json bundler = require('./helpers/bundler'); //      /*   */ var _src = './src/', //    _dist = './dist/', //       _public = './public/'; //         var _js = 'js/', //   javascript  _css = 'css/', //   css _img = 'img/', //    _html = 'html/'; //   html /* *  js / css  * * : app.js, app.css -  * admin.js, admin.css -  * * : your-lib.js -    * your-lib.jquery.js -    jquery- * */ var bundles = [ { name : 'app', //   global : 'app', //   ,   ,      compress : true, // ? saveToDist : true //    `/dist`? (true -   , false -   ) } ]; module.exports = { /*    */ };</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br><br><h5>  HTML build </h5><br>  For templating we use <a href="http://jade-lang.com/">Jade</a> .  It allows you to insert partials, use inline-javascript, variables, mixins and many more cool stuff. <br><br><div class="spoiler">  <b class="spoiler_title">Gulp</b> <div class="spoiler_text">  <b><i>Config</i></b> <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: lib/gulp/config.js */</span></span> html: { <span class="hljs-attr"><span class="hljs-attr">src</span></span>: _src + _html, <span class="hljs-comment"><span class="hljs-comment">//   jade- dest: _public, //    params: { //   jade pretty: devBuild, //    html? locals: { // ,      pkgVersion: pkg.version //      `pkgVersion` } } }</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br><br>  <b><i>Task</i></b> <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: lib/gulp/tasks/html.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>), jade = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-jade'</span></span>), jadeInherit = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-jade-inheritance'</span></span>), gulpif = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-if'</span></span>), changed = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-changed'</span></span>), filter = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-filter'</span></span>), notifier = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../helpers/notifier'</span></span>), config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../config'</span></span>).html; gulp.task(<span class="hljs-string"><span class="hljs-string">'html'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cb</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   jade-   src/html gulp.src(config.src + '*.jade') //  dev-,  watcher     .pipe(gulpif(devBuild, changed(config.dest))) //    .pipe(jadeInherit({basedir: config.src})) //  - ( `_` ) .pipe(filter(function(file) { return !/\/_/.test(file.path) || !/^_/.test(file.relative); })) //  jade  html .pipe(jade(config.params)) //  html- .pipe(gulp.dest(config.dest)) //     .on('end', function() { notifier('html'); //  (  + ) cb(); // gulp-callback,     }); });</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br></div></div><div class="spoiler">  <b class="spoiler_title">Sources</b> <div class="spoiler_text">  <b>Folder structure src / html</b> <br><br><pre> <code class="bash hljs">| src |-- html |-- index.jade <span class="hljs-comment"><span class="hljs-comment">#   |-- components/ #   |-- _header.jade |-- helpers/ # ,  |-- _params.jade |-- _mixins.jade |-- meta/ #  head,    . |-- _head.jade</span></span></code> </pre>  <sub><a href="https://github.com/alexfedoseev/js-app-starter/tree/master/src/html">Github</a></sub> <br><br>  All partials are prefixed with `_` (underscore), so that we can filter and ignore them during assembly. <br><br>  <b><i>helpers / _variables.jade</i></b> <br>  We save necessary parameters in variables.  For example, if our phone is in several places on a page, then it‚Äôs better to save it into a variable and use it in templates. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: src/html/helpers/_variables.jade */</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> release = pkgVersion <span class="hljs-comment"><span class="hljs-comment">//   gulp- - var phone = '8 800 CALL-ME-NOW' // </span></span></code> </pre>  <sub><a href="">Github</a></sub> <br><br>  <b><i>helpers / _mixins.jade</i></b> <br>  Frequently used blocks can be wrapped in mixin. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: src/html/helpers/_mixins.jade */</span></span> mixin phoneLink(phoneString) - <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cleanPhone = phoneString.replace(<span class="hljs-regexp"><span class="hljs-regexp">/\(|\)|\s|\-/g</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>) a(href=<span class="hljs-string"><span class="hljs-string">"tel:#{cleanPhone}"</span></span>)= phoneString <span class="hljs-comment"><span class="hljs-comment">//    // +phoneLink(phone)</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br><br>  <b><i>index.jade</i></b> <br>  The skeleton of the main page. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: src/html/index.jade */</span></span> include helpers/_variables <span class="hljs-comment"><span class="hljs-comment">//   include helpers/_mixins //   doctype html html head include meta/_head body include components/_header include components/_some_component include components/_footer</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br><br>  <b><i>meta / _head.jade</i></b> <br>  Content head. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: src/html/meta/_head.jade */</span></span> meta(charset=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) ... <span class="hljs-comment"><span class="hljs-comment">//   ,    js/css    link(rel="stylesheet" href="css/app.min.css?v=#{release}") script(src="js/app.min.js?v=#{release}") ...</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br></div></div><br><br><h5>  Javascript build </h5><br>  We use <a href="http://browserify.org/">Browserify</a> as a modular system.  With it we can use the style of connection of CommonJS modules directly in the browser.  In addition, we can now use the ES6 syntax: <a href="https://babeljs.io/">Babel</a> converts it to ES5 before Browserify collects js.  And before <a href="http://jshint.com/">building,</a> we <a href="http://jshint.com/">run jsHint</a> to check the quality of the code. <br><br>  <i>Browserify has one drawback: if you are writing a library with external dependencies (for example, a jQuery plugin), then it will not be able to make the correct UMD wrapper.</i>  <i>In this case, I replace Browserify with concatenation and write the wrapper with my hands.</i> <br><br><div class="spoiler">  <b class="spoiler_title">About bandla</b> <div class="spoiler_text">  On the project it may be necessary to form several sets of js / css. <br><br>  For example, you write front + admin panel.  Or a library in 2 versions: no dependencies and jQuery-plugin format.  These assemblies need to be shared.  To do this, we create an array in the collector settings: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: lib/gulp/config.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bundles = [ { <span class="hljs-attr"><span class="hljs-attr">name</span></span> : <span class="hljs-string"><span class="hljs-string">'myLib'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   global : 'myLib', //   ,      compress : true, // ? (   ) saveToDist : true //    `/dist`? } ]; /*   /   */ var bundles = [ { name : 'app', //   global : false, //     compress : true, // ? saveToDist : false //    `/dist`? }, name : 'admin', global : false, compress : true, saveToDist : false } ];</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br><br>  js / css collectors will search the folder with the js / css source for the corresponding end-point file (`app.js` or` app.styl`).  Through this end-point file, we manage all dependencies of the bundle.  I will show their structure below. <br><br>  <i>Before transferring the bundles to the assembler, we first pass the array through the <a href="">`bundler` helper</a> , which forms the object with the settings.</i> </div></div><div class="spoiler">  <b class="spoiler_title">Gulp</b> <div class="spoiler_text">  <b><i>Config</i></b> <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: lib/gulp/config.js */</span></span> scripts: { <span class="hljs-attr"><span class="hljs-attr">bundles</span></span>: bundler(bundles, _js, _src, _dist, _public), <span class="hljs-comment"><span class="hljs-comment">//   banner: '/** ' + pkg.name + ' v' + pkg.version + ' **/\n', //     min.js extensions: ['.jsx'], //    lint: { //   jshint options: pkg.lintOptions, dir: _src + _js } }</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br><br>  <b><i>Task</i></b> <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: lib/gulp/tasks/scripts.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>), browserify = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'browserify'</span></span>), watchify = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'watchify'</span></span>), uglify = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-uglify'</span></span>), sourcemaps = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-sourcemaps'</span></span>), derequire = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-derequire'</span></span>), source = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'vinyl-source-stream'</span></span>), buffer = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'vinyl-buffer'</span></span>), rename = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-rename'</span></span>), header = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-header'</span></span>), gulpif = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-if'</span></span>), notifier = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../helpers/notifier'</span></span>), config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../config'</span></span>).scripts; gulp.task(<span class="hljs-string"><span class="hljs-string">'scripts'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cb</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  -  var queue = config.bundles.length; //     ,    , //      bundle-   //      var buildThis = function(bundle) { //  bundle browserify var pack = browserify({ //   sourcemaps cache: {}, packageCache: {}, fullPaths: devBuild, //   end-point (app.js) entries: bundle.src, //   ,     // browserify    UMD- //        bundle.global standalone: bundle.global, //   extensions: config.extensions, //  sourcemaps? debug: devBuild }); //  var build = function() { return ( // browserify- pack.bundle() //  browserify-  vinyl .pipe(source(bundle.destFile)) //   ,    `require`   .pipe(derequire()) //  dev-,      `public/` ( -  )) .pipe(gulpif(devBuild, gulp.dest(bundle.destPublicDir))) //     `dist` -  .pipe(gulpif(bundle.saveToDist, gulp.dest(bundle.destDistDir))) //     sourcemaps   .pipe(gulpif(bundle.compress, buffer())) //  dev-    ‚Äî  sourcemaps .pipe(gulpif(bundle.compress &amp;&amp; devBuild, sourcemaps.init({loadMaps: true}))) //  .pipe(gulpif(bundle.compress, uglify())) //      `.min` .pipe(gulpif(bundle.compress, rename({suffix: '.min'}))) //    production -        .pipe(gulpif(!devBuild, header(config.banner))) //  sourcemaps .pipe(gulpif(bundle.compress &amp;&amp; devBuild, sourcemaps.write('./'))) //     `/dist` .pipe(gulpif(bundle.saveToDist, gulp.dest(bundle.destDistDir))) //   `public` .pipe(gulp.dest(bundle.destPublicDir)) //    callback handleQueue ( ) .on('end', handleQueue) ); }; //   watchers if (global.isWatching) { //  browserify-  watchify pack = watchify(pack); //      -   pack.on('update', build); } //     var handleQueue = function() { // ,    notifier(bundle.destFile); //    if (queue) { //   1 queue--; //    ,  ,    if (queue === 0) cb(); } }; return build(); }; //      config.bundles.forEach(buildThis); });</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br></div></div><div class="spoiler">  <b class="spoiler_title">Sources</b> <div class="spoiler_text">  <b>Src / js folder structure</b> <br><br><pre> <code class="bash hljs">| src/ |-- js/ |-- components/ <span class="hljs-comment"><span class="hljs-comment">#   |-- helpers/ # js- |-- app.js # end-point </span></span></code> </pre>  <sub><a href="https://github.com/alexfedoseev/js-app-starter/tree/master/src/js">Github</a></sub> <br><br>  <b><i>app.js</i></b> <br>  Through this file we drive all dependencies and order of execution of js-components.  The file name must match the name of the bundle. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: src/js/app.js */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Vendor */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* Components */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> myComponent <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/my-component'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* App */</span></span> $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { myComponent(); });</code> </pre>  <sub><a href="">Github</a></sub> <br></div></div><div class="spoiler">  <b class="spoiler_title">What if there is no dependency in npm</b> <div class="spoiler_text">  In such cases, use <a href="https://github.com/thlorenz/browserify-shim">browserify-shim</a> : a plugin that allows you to turn ordinary libraries into CommonJS-compatible modules.  So, we have a jQuery plugin <i>`maskedinput`</i> , which is not in npm. <br><br>  Add a transformation to <i>`package.json`</i> and set the options for the dependency: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: package.json */</span></span> <span class="hljs-string"><span class="hljs-string">"browserify"</span></span>: { <span class="hljs-string"><span class="hljs-string">"transform"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"babelify"</span></span>, <span class="hljs-string"><span class="hljs-string">"browserify-shim"</span></span> <span class="hljs-comment"><span class="hljs-comment">//   ] }, //  `browserify-shim`     //    github: https://github.com/thlorenz/browserify-shim "browser": { "maskedinput": "./path/to/jquery.maskedinput.js" }, "browserify-shim": { "maskedinput": { "exports": "maskedinput", "depends": [ "jquery:jQuery" ] } }</span></span></code> </pre><br><br>  After that we can connect the module: <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'maskedinput'</span></span>);</code> </pre><br></div></div><br><h5>  CSS build </h5><br>  We use <a href="http://learnboost.github.io/stylus/">Stylus</a> as a preprocessor.  Plus, we pass on css with <a href="https://github.com/postcss/autoprefixer">autoprefixer</a> , so as not to prescribe vendor prefixes with our hands. <br><br><div class="spoiler">  <b class="spoiler_title">Gulp</b> <div class="spoiler_text">  <b><i>Config</i></b> <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: lib/gulp/config.js */</span></span> css: { <span class="hljs-attr"><span class="hljs-attr">bundles</span></span>: bundler(bundles, _css, _src, _dist, _public), <span class="hljs-comment"><span class="hljs-comment">//   src: _src + _css, //      watcher params: {}, //     stylus -   autoprefixer: { //  autoprefixer browsers: ['&gt; 1%', 'last 2 versions'], //     cascade: false //   ,    }, compress: {} //     -   }</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br><br>  <b><i>Task</i></b> <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: lib/gulp/tasks/css.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>), process = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-stylus'</span></span>), prefix = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-autoprefixer'</span></span>), compress = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-minify-css'</span></span>), gulpif = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-if'</span></span>), rename = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-rename'</span></span>), notifier = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../helpers/notifier'</span></span>), config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../config'</span></span>).css; <span class="hljs-comment"><span class="hljs-comment">/*  css-   js- */</span></span> gulp.task(<span class="hljs-string"><span class="hljs-string">'css'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">cb</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> queue = config.bundles.length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> buildThis = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bundle</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> build = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( gulp.src(bundle.src) .pipe(process(config.params)) .pipe(prefix(config.autoprefixer)) .pipe(gulpif(bundle.compress, compress(config.compress))) .pipe(gulpif(bundle.compress, rename({<span class="hljs-attr"><span class="hljs-attr">suffix</span></span>: <span class="hljs-string"><span class="hljs-string">'.min'</span></span>}))) .pipe(gulp.dest(bundle.destPublicDir)) .on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, handleQueue) ); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handleQueue = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ notifier(bundle.destFile); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (queue) { queue--; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (queue === <span class="hljs-number"><span class="hljs-number">0</span></span>) cb(); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> build(); }; config.bundles.forEach(buildThis); });</code> </pre>  <sub><a href="">Github</a></sub> <br></div></div><div class="spoiler">  <b class="spoiler_title">Sources</b> <div class="spoiler_text">  <b>Src / css folder structure</b> <br><br><pre> <code class="bash hljs">| src/ |-- css/ |-- components/ <span class="hljs-comment"><span class="hljs-comment">#   |-- header.styl |-- footer.styl |-- globals/ |-- fonts.styl #   |-- global.styl #    |-- normalize.styl #  /  |-- variables.styl #  |-- z-index.styl # z-  |-- helpers/ |-- classes.styl #   |-- mixins.styl #   |-- sprite/ |-- sprite.json # json,  gulp.spritesmith |-- sprite.styl #   json css- |-- vendor/ #  css   |-- app.styl # end-point </span></span></code> </pre>  <sub><a href="https://github.com/alexfedoseev/js-app-starter/tree/master/src/css">Github</a></sub> <br><br>  <b><i>app.styl</i></b> <br>  Through this file we rule the connection order of css-components.  The file name must match the name of the bundle. <br><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* file: src/css/app.styl */</span></span> @<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"helpers/mixins"</span></span> @import <span class="hljs-string"><span class="hljs-string">"helpers/classes"</span></span> @import <span class="hljs-string"><span class="hljs-string">"globals/variables"</span></span> @import <span class="hljs-string"><span class="hljs-string">"globals/normalize"</span></span> @import <span class="hljs-string"><span class="hljs-string">"globals/z-index"</span></span> @import <span class="hljs-string"><span class="hljs-string">"globals/fonts"</span></span> @import <span class="hljs-string"><span class="hljs-string">"globals/global"</span></span> @import <span class="hljs-string"><span class="hljs-string">"sprite/sprite"</span></span> @import <span class="hljs-string"><span class="hljs-string">"vendor/*"</span></span> @import <span class="hljs-string"><span class="hljs-string">"components/*"</span></span></code> </pre>  <sub><a href="">Github</a></sub> <br></div></div><br><br>  All other tasks - pictures, sprites, cleaning, etc. - do not require additional comments (in fact, I was just tired of scribbling).  Sources are in the repository: <a href="https://github.com/alexfedoseev/js-app-starter">github.com/alexfedoseev/js-app-starter</a> <br><br>  If there are shoals or additions - I will be glad to feedback through the comments here or <a href="https://github.com/alexfedoseev/js-app-starter/issues">issues</a> / pull requests on Github.  Good luck! </div><p>Source: <a href="https://habr.com/ru/post/251807/">https://habr.com/ru/post/251807/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251795/index.html">Visual Studio Extensibility. Part One: MSBuild</a></li>
<li><a href="../251797/index.html">Static hosting: life after death narod.ru</a></li>
<li><a href="../251801/index.html">SummaryJS Release 3</a></li>
<li><a href="../251803/index.html">Krita 2.9: Draft Brush Profiles, Locked Settings, and Cumulative Cancellation</a></li>
<li><a href="../251805/index.html">The digest of interesting materials for the mobile developer # 92 (February 21 - March 1)</a></li>
<li><a href="../251815/index.html">Bond James Bond. Robotic fake handwriting for marketers and social engineers</a></li>
<li><a href="../251817/index.html">Check LibreOffice project</a></li>
<li><a href="../251821/index.html">Krita 2.9: Selection of canvas areas with a brush</a></li>
<li><a href="../251823/index.html">The dangers of using open-uri</a></li>
<li><a href="../251827/index.html">MailChimp UX Team: How We Do Research [Part 3 of the book]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>