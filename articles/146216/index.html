<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Photosite on MVC 4 for beginners</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If someone has a desire to make his photosite or to get acquainted with ASP.NET MVC with an example, it may be useful to have my experience in creatin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Photosite on MVC 4 for beginners</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://www.bongiozzo.ru/"><img align="right" src="http://www.bongiozzo.ru/content/img/screenshot.jpg" alt="Bongiozzo Photosite"></a> <br><br>  If someone has a desire to make his photosite or to get acquainted with ASP.NET MVC with an example, it may be useful to have my experience in creating such a site and the source code will form the basis of my own project. <br><br>  To make it clear what will be discussed, the link to the site is <a href="http://www.bongiozzo.ru/">www.bongiozzo.ru</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And now, actually, how it was done. <br><br>  What did you want? <br><ul><li>  Make a portfolio in the form of several photo albums and add context from social networks; </li><li>  I wanted to make something of my own - I initially did not look at ready-made solutions; </li><li>  As a photo storage, I immediately planned to use existing photo hosting services with an active community of photographers - services have an API, besides, photos are published for feedback, and you can get it, first of all, there; </li><li>  For the same reason, fasten the Facebook and Twitter buttons to the photos; </li><li>  To view photos, it was planned to acquire a stylish gallery that will look good on tablets; </li><li>  Well, in the end, I wanted to put all this on the best, in terms of cost / service ratio, hosting. </li></ul><br>  Task set, let's go ... <br><br><a name="habracut"></a><br><br><h5>  Determine the development environment and framework </h5><br>  First of all, <a href="http://www.microsoft.com/visualstudio/11/en-us">freely downloaded</a> and installed Visual Studio 2012 RC.  Web Forms and MVC are available for website development - my sympathies are entirely on the side of MVC, since  This pattern is used to create sites on Perl, when Web Forms was still not there :). <br>  As for the MVC version, there were no special thoughts either - since everything is new (VS 2012 on Windows 8), I will develop it on the latest version of MVC 4. <br><br><h5>  The main thing is content </h5><br>  I already had a pro account on <a href="http://www.flickr.com/">Flickr</a> , although this is an absolutely optional condition.  The automatic grouping and sorting of photos by albums on Flickr was also configured by me using the <a href="http://ericappel.net/smartsetr">SmartSetr</a> service.  Therefore, the first thing I did was open the Nuget Package Manager and, having entered Flickr, I got in the project support for the Flickr API using the Flickr.NET library. <br>  <i>Maybe later I will consider transferring CMS to <a href="http://www.500px.com/">500px</a> , or maybe someone will do it faster than me.</i> <br><br>  The idea of ‚Äã‚Äãusing Flickr as a CMS was simple - photo albums with the Project keyword in the description will be displayed on my site (in Flickr they are called Photoset).  Photos in the album will be sorted by popularity as determined by Flickr users. <br><br>  Here are some simple methods for the FlickrModel data generation model. <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;FlickrProject&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetProjects</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> language</span></span></span><span class="hljs-function">)</span></span> { PhotosetCollection flickrPhotosets = flickr.PhotosetsGetList(Properties.Settings.Default.FlickrUserId); Regex reg_Project = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Regex(<span class="hljs-string"><span class="hljs-string">@"^Project\s+([^\|].*)\s+\|\s+(.*)"</span></span>); Match m; List&lt;FlickrProject&gt; returnProjects = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;FlickrProject&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Photoset item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> flickrPhotosets) { m = reg_Project.Match(item.Description); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m.Success) { FlickrProject prj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FlickrProject(); prj.Description = getDescription(item.Description, language); prj.PhotosetId = item.PhotosetId; prj.Photos = GetPhotosetPhotos(item.PhotosetId, language); prj.PrimaryPhoto = prj.Photos.ToList().Find( <span class="hljs-keyword"><span class="hljs-keyword">delegate</span></span>(Photo ph) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ph.PhotoId == item.PrimaryPhotoId; }); returnProjects.Add(prj); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> returnProjects; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PhotosetPhotoCollection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPhotosetPhotos</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> photosetId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> language</span></span></span><span class="hljs-function">)</span></span> { PhotosetPhotoCollection photos = flickr.PhotosetsGetPhotos(photosetId, PhotoSearchExtras.Description ); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Photo item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> photos) { item.Title = getTitle(item.Title, language); item.Description = getDescription(item.Description, language); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> photos; }</code> </pre> <br><br>  Models for the latest <a href="http://www.twitter.com/">Twitter posts</a> and <a href="http://www.kinopoisk.ru/">Kinopoisk</a> movies look no harder. <br><br>  If you noticed - the method returns the names and descriptions of photos in different languages. <br><br><h5>  Call photos for their own or in English? </h5><br>  I had such a question some time ago.  I decided that I would duplicate the names in Russian and English, separating them with a vertical bar.  Now this naming has become possible to use on the site in the best way - if the visitor uses Russian by default in the browser settings - show him native names, otherwise English.  Unlike photo hosting sites on my site it will look natural, without any dividing sticks. <br><br>  MVC has a filter mechanism that applies to all or individual requests.  For this task, the LocalizationAware filter was implemented, which will work on requests to the main pages of the site and set the desired language culture depending on the browser settings: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LocalizationAwareAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">ActionFilterAttribute</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnActionExecuting</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ActionExecutingContext filterContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> httpContext = filterContext.HttpContext; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> language = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; HttpCookie langCookie = httpContext.Request.Cookies[<span class="hljs-string"><span class="hljs-string">"lang"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (langCookie == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (httpContext.Request.UserLanguages != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; httpContext.Request.UserLanguages[<span class="hljs-number"><span class="hljs-number">0</span></span>].IndexOf(<span class="hljs-string"><span class="hljs-string">"ru"</span></span>, StringComparison.OrdinalIgnoreCase) != <span class="hljs-number"><span class="hljs-number">-1</span></span>) language = <span class="hljs-string"><span class="hljs-string">"ru"</span></span>; httpContext.Response.AppendCookie(createCookie(language)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (langCookie.Value == <span class="hljs-string"><span class="hljs-string">"ru"</span></span>) language = <span class="hljs-string"><span class="hljs-string">"ru"</span></span>; Thread.CurrentThread.CurrentUICulture = CultureInfo.CreateSpecificCulture(language); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HttpCookie </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCookie</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> language</span></span></span><span class="hljs-function">)</span></span> { HttpCookie cookie = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpCookie(<span class="hljs-string"><span class="hljs-string">"lang"</span></span>, language); cookie.Expires = DateTime.Now.AddYears(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cookie; } }</code> </pre><br><br>  Of course, it is possible to change the language if the default selection does not suit: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLanguage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { id = id == <span class="hljs-string"><span class="hljs-string">"ru"</span></span> ? <span class="hljs-string"><span class="hljs-string">"ru"</span></span> : <span class="hljs-string"><span class="hljs-string">"en"</span></span>; Response.AppendCookie(LocalizationAwareAttribute.createCookie(id)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Redirect(<span class="hljs-string"><span class="hljs-string">"/"</span></span>); }</code> </pre><br><br>  In addition to the names of the photos, all elements of the page - the headers and texts now also automatically switch to the selected language due to the exposed language culture and the presence in the project of two resource files - Resources.resx and Resources.ru.resx.  It was not necessary to encode something additionally - this functionality is built-in. <br><br><h5>  Performance and caching </h5><br>  The advantages of network services are obvious, but these advantages will be negated if the response is slow, especially during peak loads.  Obviously, responses from Flickr, Twitter and other systems need to be cached. <br><br>  It is easy to do this - it is enough to connect the appropriate filter, specifying the OutputCache attribute before the method. <br>  To form a page, I use several Actions ‚Äî the main request (Index, for example) and several ChildActions for rendering parts of the page that contain answers from different external systems.  For each type of content, you can use its own storage time in the cache, depending on the dynamics of changes. <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">LocalizationAware</span></span>] [OutputCache(Duration = <span class="hljs-number"><span class="hljs-number">20</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span>, Location = System.Web.UI.OutputCacheLocation.Server, VaryByCustom = <span class="hljs-string"><span class="hljs-string">"lang"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(bag); } [ChildActionOnly] [OutputCache(Duration = <span class="hljs-number"><span class="hljs-number">10</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetProjects</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> language</span></span></span><span class="hljs-function">)</span></span> { HomeViewBag bag = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HomeViewBag(); FlickrContext flickr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FlickrContext(); bag.FlickrProjects = flickr.GetProjects(language); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(bag); } [ChildActionOnly] [OutputCache(Duration = <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLastPhotos</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> language</span></span></span><span class="hljs-function">)</span></span> { HomeViewBag bag = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HomeViewBag(); FlickrContext flickr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FlickrContext(); bag.LastPhotos = flickr.GetLastPhotos(<span class="hljs-number"><span class="hljs-number">5</span></span>, language, <span class="hljs-number"><span class="hljs-number">1</span></span>).ToList(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(bag); }</code> </pre><br><br>  ASP.NET MVC itself separates cached copies of the results depending on the values ‚Äã‚Äãof the input parameters.  For ChildActions, the input parameters in the form of a language are explicitly defined, however, for basic requests, you will need to divide the cache depending on the session language, and this parameter is not clearly present in the parameters.  This is implemented using the attribute VaryByCustom = "lang" and a special method GetVaryByCustomString.  Now there should be no overlays in the cache. <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetVaryByCustomString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HttpContext context, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> arg</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg.ToLower() == <span class="hljs-string"><span class="hljs-string">"lang"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> langParam = context.Request.QueryString[<span class="hljs-string"><span class="hljs-string">"lang"</span></span>]; HttpCookie langCookie = context.Request.Cookies[<span class="hljs-string"><span class="hljs-string">"lang"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (langParam != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> langParam == <span class="hljs-string"><span class="hljs-string">"ru"</span></span> ? <span class="hljs-string"><span class="hljs-string">"ru"</span></span> : <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (langCookie != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> langCookie.Value == <span class="hljs-string"><span class="hljs-string">"ru"</span></span> ? <span class="hljs-string"><span class="hljs-string">"ru"</span></span> : <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.GetVaryByCustomString(context, arg); }</code> </pre><br><br><h5>  Design and photo gallery </h5><br>  Because  The task was originally set up - to make the site independently, but I myself was not a designer at all, it was immediately decided to make the site look as simple as possible and to limit the expressive abilities of CSS3 and HTML5.  Moreover, the main focus on the photosite should go to the photos and their submission. <br><br>  Therefore, I searched for available galleries and focused on the stylish <a href="http://galleria.io/">Galleria</a> solution.  Gallery is written in jQuery, has its own API, the basic edition, sufficient for expansion - is free and available for use.  Exactly what is needed. <br><br>  In addition to minor adjustments, the gallery initialization module added its navigation elements and integration with social networks: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.append({ <span class="hljs-string"><span class="hljs-string">'stage'</span></span>: [<span class="hljs-string"><span class="hljs-string">'closeBG'</span></span>, <span class="hljs-string"><span class="hljs-string">'socialBG'</span></span>] }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'socialBG'</span></span>).html(<span class="hljs-string"><span class="hljs-string">'&lt;div id="div-fblike"&gt;&lt;/div&gt;&lt;div id="div-twitter"&gt;&lt;/div&gt;'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$(<span class="hljs-string"><span class="hljs-string">'closeBG'</span></span>).bind(<span class="hljs-string"><span class="hljs-string">"click"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location = <span class="hljs-string"><span class="hljs-string">"/"</span></span>; });</code> </pre><br><br>  Filling the gallery with photos looks like filling an array in JSON format with data obtained from FlickrModel. <br><br>  Forming JSON in Controller: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getJSON</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;Photo&gt; list, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> p</span></span></span><span class="hljs-function">)</span></span> { List&lt;PhotoJSON&gt; json = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;PhotoJSON&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Photo pht <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> list) json.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PhotoJSON { thumb = pht.ThumbnailUrl, image = pht.LargeUrl, title = pht.Title, description = pht.Description, link = pht.WebUrl, url = Settings.Default.SiteURL + Url.Action(<span class="hljs-string"><span class="hljs-string">"Gallery"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { controller = <span class="hljs-string"><span class="hljs-string">"Home"</span></span>, id = pht.PhotoId, photoset = p }) }); JavaScriptSerializer serializer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JavaScriptSerializer(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> serializer.Serialize(json); }</code> </pre><br><br>  JavaScript in Viewer: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = @Html.Raw(Model.PhotosJSON); Galleria.loadTheme(<span class="hljs-string"><span class="hljs-string">'/galleria/themes/bongiozzo/galleria.bongiozzo.js'</span></span>); Galleria.run(<span class="hljs-string"><span class="hljs-string">'#galleria'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">show</span></span>: @Model.IndexOfCurrentPhoto, <span class="hljs-attr"><span class="hljs-attr">transition</span></span>: <span class="hljs-string"><span class="hljs-string">'slide'</span></span>, <span class="hljs-attr"><span class="hljs-attr">initialTransition</span></span>: <span class="hljs-string"><span class="hljs-string">'fade'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataSource</span></span>: data });</code> </pre><br><br><h5>  Hanging tweets and likes </h5><br>  On the event of switching photos in the gallery, we update the Facebook and Twitter buttons. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bind(<span class="hljs-string"><span class="hljs-string">"image"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = galleria.getData().title; $(<span class="hljs-string"><span class="hljs-string">'#div-fblike'</span></span>).html(<span class="hljs-string"><span class="hljs-string">'&lt;fb:like href="'</span></span> + data[galleria.getIndex()].url + <span class="hljs-string"><span class="hljs-string">'" layout="button_count" send="false" show_faces="false" colorscheme="dark" /&gt;'</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#div-twitter'</span></span>).html(<span class="hljs-string"><span class="hljs-string">'&lt;a href="https://twitter.com/share" class="twitter-share-button" data-url="'</span></span> + data[galleria.getIndex()].url + <span class="hljs-string"><span class="hljs-string">'" data-text="'</span></span> + galleria.getData().title + <span class="hljs-string"><span class="hljs-string">'"&gt;Tweet&lt;/a&gt;'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { FB.XFBML.parse(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'div-fblike'</span></span>)); twttr.widgets.load(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(ex) {} });</code> </pre><br><br>  And do not forget to fill in the OpenGraph tags for correct display in Facebook and other OG compatible systems. <br><br><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">property</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fb:app_id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Model.fb_app_id"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">property</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"og:title"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@ViewBag.Title"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">property</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"og:site_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Resources.Resources.Title"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">property</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"og:type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"website"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">property</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"og:url"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Model.SiteUrl@Url.Action("</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Gallery</span></span></span><span class="hljs-tag">", </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">new</span></span></span><span class="hljs-tag"> { </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Home"</span></span></span><span class="hljs-tag">, </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">Model.GalleryPhotos[Model.IndexOfCurrentPhoto].PhotoId,</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">photoset</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">Model.PhotosetId})</span></span></span><span class="hljs-tag">" /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">property</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"og:image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Model.GalleryPhotos[Model.IndexOfCurrentPhoto].SquareThumbnailUrl"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">property</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"og:description"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Html.Raw(Model.GalleryPhotos[Model.IndexOfCurrentPhoto].Description.Replace("</span></span></span><span class="hljs-tag">\</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">n</span></span></span><span class="hljs-tag">","&lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">br</span></span></span><span class="hljs-tag">/&gt;</span></span>"))" /&gt;</code> </pre><br><br><h5>  Where to host the project? </h5><br>  By the time the photosite could be launched, cloud hosting <a href="https://www.windowsazure.com/en-us/pricing/calculator/">Windows Azure with 10 free Shared sites</a> became very useful.  There is a separate cost for the database and traffic, however, given that I do not have the database and the photos themselves are stored on Flickr, and, accordingly, there is no traffic either - hosting seems almost free.  At the same time, in the case of Azure, I have no questions about the quality and availability of the service, which is important.  Service management is clear and simple - before Azure, I considered hosting from other providers, and this was especially evident in the contrast of confusing interface, correspondence and telephone communication with support services. <br><br>  Unfortunately, there is one BUT - you cannot link your domain name to this Shared site.  For those who don‚Äôt need their own domain name and need a URL like bongiozzo.azurewebsites.net, this is really the best option. <br>  However, it <a href="https://twitter.com/scottgu/status/210972290719031298">is hoped</a> that this is a temporary restriction for Shared sites.  Therefore, while I turned the site into Reserved mode, in which such a binding can be made.  In any case, the 90-day Trial is still working and I have an MSDN subscription with prepay for a certain number of Azure services. <br><br>  The next version of Azure Web Sites will be released - I will watch, maybe transfer to a minimal hosting of <a href="http://infobox.ru/hosting/winplans/">Infobox.ru</a> , <a href="http://infobox.ru/hosting/winplans/">Parking.ru</a> , etc., or an <a href="http://www.windowsazure.com/en-us/pricing/calculator/%3Fscenario%3Dcloud">XS instance of cloud services</a> , but for now it works, it works fine and is not worth the money. <br><br><h5>  As a conclusion </h5><br><ul><li>  The project turned out to be simple - just right for dating or warm-up.  It took a dozen evenings to get acquainted with ASP.NET MVC 4, CSS3, jQuery and Azure; </li><li>  Sources can be taken here - <a href="https://bongiozzo.codeplex.com/">bongiozzo.codeplex.com</a> ; </li><li>  I will be glad to questions, constructive wishes and comments - <a href="https://twitter.com/">@bongiozzo</a> ; </li></ul></div><p>Source: <a href="https://habr.com/ru/post/146216/">https://habr.com/ru/post/146216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146210/index.html">Qt Designer & Runtime Qt library on the service of OpenCV developer, or dragging IplImage on QLabel</a></li>
<li><a href="../146211/index.html">Digitimes: the cheapest Surface tablet will cost $ 599</a></li>
<li><a href="../146212/index.html">Project K28A or a new generation bicycle</a></li>
<li><a href="../146213/index.html">Petition to Qualcomm: the final?</a></li>
<li><a href="../146214/index.html">Fail on Surface Presentation</a></li>
<li><a href="../146220/index.html">Mini-computers: MK802, CuBox, Raspberry PI</a></li>
<li><a href="../146222/index.html">Educational startup is looking for development partners (iOS and Android)</a></li>
<li><a href="../146223/index.html">We integrate Amazon S3 into .Net application</a></li>
<li><a href="../146224/index.html">Evolution of analytical infrastructure</a></li>
<li><a href="../146227/index.html">What part of the code is written for the project for nothing?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>