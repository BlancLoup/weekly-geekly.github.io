<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nuances of Firebase messaging for beginners</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the publication on Habr√© of Artyom Osipov‚Äôs article ‚Äú Push notifications to Android using Firebase Cloud Messaging for beginners, ‚Äù a number of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nuances of Firebase messaging for beginners</h1><div class="post__text post__text-html js-mediator-article">  After the publication on Habr√© of Artyom Osipov‚Äôs article ‚Äú <a href="https://habrahabr.ru/post/302002/">Push notifications to Android using Firebase Cloud Messaging for beginners,</a> ‚Äù a number of questions arose that could be resolved. <br><br>  It was possible to achieve sending Push notifications with vibration and with their own sound + a notification in the status bar has a large icon and next to it all text.  And it does not matter whether the application is active or hanging in the background - when you click on a notification, the Main Activity is always updated and carries the parameters from the notification. <br><br>  So, in layout activity_mail.xml, we add two TextViews: one for the notification header and one for the text. <br><a name="habracut"></a><br>  In MainActivity between: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="java hljs">setContentView(R.layout.activity_main);</code> </pre> <br>  and <br><br><pre> <code class="java hljs">Button subscribeButton = (Button) findViewById(R.id.subscribeButton);</code> </pre><br>  delete all lines and insert: <br><br><pre> <code class="java hljs"> TextView titleText = (TextView)findViewById(R.id.textView); TextView bodyText = (TextView)findViewById(R.id.textView2); <span class="hljs-comment"><span class="hljs-comment">// [START handle_data_extras] if (getIntent().getExtras() != null) { Intent intent = getIntent(); String title = intent.getStringExtra("title"); String body = intent.getStringExtra("body"); titleText.setText(title); bodyText.setText(body); }</span></span></code> </pre><br>  In the file MyFirebaseMessagingService function <br><br><pre> <code class="java hljs">onMessageReceived</code> </pre><br>  should have this code: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMessageReceived</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RemoteMessage remoteMessage)</span></span></span><span class="hljs-function"> </span></span>{ sendNotification (remoteMessage.getData().get(<span class="hljs-string"><span class="hljs-string">"title"</span></span>), remoteMessage.getData().get(<span class="hljs-string"><span class="hljs-string">"body"</span></span>)); }</code> </pre><br>  and function <br><br><pre> <code class="java hljs">sendNotification</code> </pre><br>  should accept a code like this: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendNotification</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String messageTitle, String messageBody)</span></span></span><span class="hljs-function"> </span></span>{ Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, MainActivity.class); intent.putExtra(<span class="hljs-string"><span class="hljs-string">"title"</span></span>, messageTitle); intent.putExtra(<span class="hljs-string"><span class="hljs-string">"body"</span></span>, messageBody); intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP); intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); PendingIntent pendingIntent = PendingIntent.getActivity(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Request code */</span></span>, intent, PendingIntent.FLAG_ONE_SHOT); Bitmap largeIcon = BitmapFactory.decodeResource(getResources(), R.drawable.ic_krolik); NotificationCompat.Builder notificationBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotificationCompat.Builder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .setSmallIcon(R.mipmap.ic_stat_s1) .setLargeIcon(largeIcon) .setColor(Color.parseColor(<span class="hljs-string"><span class="hljs-string">"#4B8A08"</span></span>)) .setStyle(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotificationCompat.BigTextStyle().bigText(messageBody)) .setContentTitle(messageTitle) .setContentText(messageBody) .setAutoCancel(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) .setSound(Uri.parse(<span class="hljs-string"><span class="hljs-string">"android.resource://"</span></span> + getPackageName() + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + R.raw.circles0)) .setVibrate(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span>[] { <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span> }) .setLights(Color.MAGENTA, <span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>) .setContentIntent(pendingIntent); NotificationManager notificationManager = (NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE); notificationManager.notify(<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ID of notification */</span></span>, notificationBuilder.build()); }</code> </pre><br>  Where <br><br><pre> <code class="java hljs">R.drawable.ic_krolik</code> </pre><br>  this is my notification icon, and <br><br><pre> <code class="java hljs">R.raw.circles0</code> </pre><br>  This is my .mp3 file for the soundtrack of an incoming notification placed in the raw directory. <br><br>  I send notifications via CURL.  At first for tests I tried to do it from the Raspberry Pi terminal, where the line looked like this: <br><br><pre> <code class="bash hljs">curl -s <span class="hljs-string"><span class="hljs-string">"https://gcm-http.googleapis.com/gcm/send"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Authorization: key=AIzaSyB4ZanJWaCay_fXxO5z0jI55T8UOwdGNNQ"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> -d <span class="hljs-string"><span class="hljs-string">'{"to": "fJuOOiTAk4w:APA91bHLrg95cyxodZDULzXU604BXJZUJKBaV8LHCbWPvMUlBhr6tzeD7TfNUp1rOMMObYmnC87OyqwRFbROjZV_pGUtNEh1fGFPDf0ApgljyDrLYEmAneKycVX5jCf8Rm2lpC7MDCss","priority" : "high", "vibrate": 1, "notification": { "title": "Port", "body" : "great", "sound": "circles0.mp3", "color": "#379F00", "icon" : "ic_stat_s"}, "data": {"title" : "3.21.15", "body": 12345678}}'</span></span></code> </pre><br>  but when the application is in the background or closed, the notification came in a stripped-down text format without vibration, but with its own sound and icon.  I had to send CURL from PHP.  First, install CURL in Raspberry Pi: <br><br><pre> <code class="bash hljs">sudo apt-get install curl libcurl3 libcurl3-dev php5-curl</code> </pre><br>  Create a PHP file: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// API access key from Google API's Console define( 'API_ACCESS_KEY', 'AIzaSyB4ZanJWaCay_fXxO5z0jI55T8UOwdGNNQ' ); $registrationIds = array( 'fJuOOiTAk4w:APA91bHLrg95cyxodZDULzXU604BXJZUJKBaV8LHCbWPvMUlBhr6tzeD7TfNUp1rOMMObYmnC87OyqwRFbROjZV_pGUtNEh1fGFPDf0ApgljyDrLYEmAneKycVX5jCf8Rm2lpC7MDCss' ); // prep the bundle $msg = array ( 'message' =&gt; 'here is a message. message', 'title' =&gt; 'This is a title. title', 'body' =&gt; 'This is a subtitle. subtitle, subtitle. subtitle subtitle. subtitle, subtitle. subtitle subtitle. subtitle, subtitle. subtitle subtitle. subtitle', 'tickerText' =&gt; 'Ticker text here...Ticker text here...Ticker text here', 'vibrate' =&gt; 1, 'sound' =&gt; 1, 'largeIcon' =&gt; 'large_icon', 'smallIcon' =&gt; 'small_icon' ); $fields = array ( 'registration_ids' =&gt; $registrationIds, 'data' =&gt; $msg ); $headers = array ( 'Authorization: key=' . API_ACCESS_KEY, 'Content-Type: application/json' ); $ch = curl_init(); curl_setopt( $ch,CURLOPT_URL, 'https://gcm-http.googleapis.com/gcm/send' ); curl_setopt( $ch,CURLOPT_POST, true ); curl_setopt( $ch,CURLOPT_HTTPHEADER, $headers ); curl_setopt( $ch,CURLOPT_RETURNTRANSFER, true ); curl_setopt( $ch,CURLOPT_SSL_VERIFYPEER, false ); curl_setopt( $ch,CURLOPT_POSTFIELDS, json_encode( $fields ) ); $result = curl_exec($ch ); curl_close( $ch ); echo $result; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  From the terminal we start sending a notification: <br><br><pre> <code class="bash hljs">php curl.php</code> </pre><br>  and it does not matter what state our application is in: in the background or it works - we receive a notification with our own sound, with our own icon and the notification text contains all.  When you click on the notification (if the application is running), the main activity is updated and the title and body of the notification will be placed in two TextViews.  If the application is in the background, then it starts with the above result. <br><br>  If we want another activation to open when we click on the notification, then we do this: <br>  create another activity called Main2Activity.  In the manifesto before <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  add code: <br><br><pre> <code class="java hljs">&lt;activity android:name=<span class="hljs-string"><span class="hljs-string">".Main2Activity"</span></span>&gt; &lt;intent-filter&gt; &lt;action android:name=<span class="hljs-string"><span class="hljs-string">"OPEN_ACTIVITY_1"</span></span> /&gt; &lt;category android:name=<span class="hljs-string"><span class="hljs-string">"android.intent.category.DEFAULT"</span></span> /&gt; &lt;/intent-filter&gt; &lt;/activity&gt;</code> </pre><br>  In CURL, add the value <br><br><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">"click_action"</span></span>: <span class="hljs-string"><span class="hljs-string">"OPEN_ACTIVITY_1"</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/303514/">https://habr.com/ru/post/303514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303500/index.html">SYP wrong or how to compromise all users in SAP JAVA</a></li>
<li><a href="../303502/index.html">Where to go to Python: What is interesting will be at the conference PyCon-2016</a></li>
<li><a href="../303506/index.html">Creation of e-sports organization</a></li>
<li><a href="../303508/index.html">Intel RealSense SR300 and F200 Front View Camera Comparison</a></li>
<li><a href="../303512/index.html">Core Data + Swift for the smallest: the minimum necessary (part 1)</a></li>
<li><a href="../303516/index.html">Decorators and reflection in TypeScript: from beginner to expert (part 3)</a></li>
<li><a href="../303518/index.html">DEV Labs 2016. JAVA. June 25</a></li>
<li><a href="../303520/index.html">How to create visually effective calls to action</a></li>
<li><a href="../303522/index.html">Validation of Fuel Plugins within the Mirantis Unlocked validation program. Do you need it?</a></li>
<li><a href="../303524/index.html">The experience of switching from Sublime to Vim</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>