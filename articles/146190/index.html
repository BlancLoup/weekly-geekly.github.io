<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Control the water temperature in the gas. column</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I love to spend time in the bathroom, even very much. 
 There is nothing better to take a beer, fried dumplings, aypadik and bylokodit lying in hot wa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Control the water temperature in the gas. column</h1><div class="post__text post__text-html js-mediator-article">  I love to spend time in the bathroom, even very much. <br>  There is nothing better to take a beer, fried dumplings, aypadik and bylokodit lying in hot water. <br><br>  But this idyll breaks a terrible creature, and his name is ‚Äúgas column‚Äù. <br><br><a name="habracut"></a><br>  <b>The essence of the problem:</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Our house is old, the pipelines are also old, respectively, and the pressure in the riser is simply disgusting. <br><br>  If you turn on the water from the tap and tune the column in 40 degrees, then it will give you 40 degrees ... but not for long.  Once you turn on the shower, the temperature will soar sharply to 50 or even higher.  Also, takeoff depends on the day of the week (on weekends, the water temperature graph with a constant column setting looks like a dubstep visualization). <br><br>  The reason is simple, when you turn on the shower because  the diameter of the shower hose is smaller than the diameter of the pipe, then a smaller amount of water passes through the heat exchanger in the column with the same flame.  Accordingly, the water is heated more.  This effect is observed at the weekend when everyone accepts water procedures and the pressure in the general system drops even more, this effect can also be observed from anything in the flesh to the phase of the moon and the position of Saturn. <br><br>  I nursed a plan of revenge for a very long time, but since I was very far from circuit engineering, I could not decide. <br>  But then the hour of reckoning came and I decided. <br><br>  <b>Let's go ¬©</b> <br><br>  So it took me: <br>  - Arduino Uno <br>  - simple servo drive <br>  - wires, resistors and other small things <br>  - a cat that constantly drags this very small things <br><br>  I have a column Oasis 20RG <br><img src="http://e96.ru/images/catalog/thumbs2/8/83275/400x400_24aa1903d337bbf9b7e4d9917f735e1a.jpg" alt="image"><br><br>  What pushed me to create the device is the fact that the column shows the current water temperature, which means there is a sensor that can be read. <br><br><img src="https://habrastorage.org/storage2/3b5/0b2/611/3b50b2611fbb3a6ffec523ab4854fa6d.jpg"><br><br>  As you can see from the photo, the left-hand twist knob is responsible for the height of the flame, the temperature is controlled to it, and we will turn it on. <br><br><img src="https://habrastorage.org/storage2/b40/7fb/730/b407fb7300b75cedc547eb98e4de1636.jpg"><br><br>  All the good ordered on the site amperka.ru, yes, with ebey byloby at times cheaper and would cost a penny.  But the thirst for revenge could not wait. <br><br>  So removing the front panel was detected temperature sensor at the outlet of hot water <br><img src="https://habrastorage.org/storage2/cfc/7be/441/cfc7be441622bff8c07f0e040eeca4ce.jpg"><br>  which is a conventional thermistor. <br>  By including it in the voltage divider and sticking the data into the analog input, I got an analog value, which was converted to temperature by simple manipulations and the map function. <br><br>  In fact, I was tormented here for a long time because I forgot Jeremy Bloom's video lesson about the voltage dividers, but after looking again I quickly grabbed everything, it was up to small matters. <br><br>  The temperature I received, it remains to place the servo and come up with a mechanic who will twist the handle of the stud. <br><br>  Servu placed clearly under the hairpin <br><img src="https://habrastorage.org/storage2/c63/387/6f1/c633876f1ac08294cf825f88990af273.jpg"><br><br>  I thought how to fix it, at first I drilled holes for fastening, but the metal of the column turned out to be stronger than the metal of the bolts on which the thread instantly sat down. <br>  An irreplaceable material was taken - nylon ties.  Fixed it tightly. <br><img src="https://habrastorage.org/storage2/0cb/fd1/dd6/0cbfd1dd6c4e2e5de315a7e79f0bcc71.jpg"><br><br>  I was stuck further, I don‚Äôt know what found me, but I couldn‚Äôt figure out how to mechanically connect the servo to the spire, the idea of ‚Äã‚Äãthe yoke was spinning in my head, but it didn‚Äôt materialize.  Thank God for Q &amp; A prompted, in the end of the PCB was cut rocker the same length as on the server, and pasted on the hairpin. <br>  Traction were made of flexible wire (then replaced). <br><br>  Further, I made it so that when you turn on the column - the whole process is turned on, there is no need to try to raise the temperature when the column is turned off.  To do this, monitor the screen's power wire (which only works when the speaker is on) for voltage.  And if it is, I launch the process. <br><br>  I also wrote a so-called.  ‚ÄúWarming up‚Äù - the controller waits 10 seconds after the column is turned on and only then it starts working.  Made to heat the heat exchanger. <br><br>  As a result, the alpha version of the controller was born (I apologize for the bad video, then - better): <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/_UOcUGZpkuY%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253,15700255,15700259&amp;usg=ALkJrhgnuCig09KpEsVSYqjJEW67ucLpOw" frameborder="0" allowfullscreen=""></iframe><br><br>  After a couple of tests, the following bugs were noticed: <br><br>  Well, firstly an obvious bug with rods, they are soft and not strained, respectively, there is a backlash that prevents the rapid setting of the temperature. <br>  In the bins was found a piece of copper wire and simple manipulations made by the traction. <br><br>  We measure: <br><img src="https://habrastorage.org/storage2/a9a/66d/e04/a9a66de04f6a01c66171e237af0d4f4c.jpg"><br><br>  Happened: <br><img src="https://habrastorage.org/storage2/c96/e2a/db7/c96e2adb77f257618ae6f900fbc1593a.jpg"><br><br>  The next bug was that the temperature sensor showed less than 20 degrees outside the window, but after a few seconds it returned to its normal state.  For a long time I caught it and eventually realized what was the matter. <br>  I powered the sensor from 3.3V output per arduino, I don‚Äôt know why, but these same 3.3 jumped, thereby changing the sensor reading.  Having powered the sensor from 5V, everything became normal. <br><br>  The result was a beta test: <br><br>  Unfortunately I don‚Äôt know how to make two videos into one, therefore: <br>  Arduinka logs: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/76dyraifwo0%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253,15700255,15700259&amp;usg=ALkJrhhW20IazBxGvznUYzTR1AtcF5bRFA" frameborder="0" allowfullscreen=""></iframe><br><br>  Serva with new rods: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/pHMlEtDSpIU%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253,15700255,15700259&amp;usg=ALkJrhiZVT2-HH-6sisygcJamz5BAGiADg" frameborder="0" allowfullscreen=""></iframe><br><br>  Well, in principle, that's all, then I quote the program listing, after writing the article the program was still a little bit more in order to adjust it to the fastest possible temperature equalization. <br><br>  Listing: <br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Servo.h&gt; int termalPin=A5; int enablePin=8; int ledPin=7; int temp; int lastTemp=0; boolean enabled=false; static int minAngle=5; static int maxAngle=100; static int needTemp=40; Servo myservo; void setup() { //  Serial.begin(9600); //   pinMode(enablePin,INPUT); pinMode(ledPin,OUTPUT); } void loop() { //     temp = map(analogRead(termalPin),800,635,31,51); if(digitalRead(enablePin)==HIGH) { //  if(!enabled) { //      //  myservo.attach(9); //   myservo.write(50); Serial.println("WARMING UP BOILER."); //    delay(10000); Serial.println("BOILER READY!"); } // enabled=true; //  digitalWrite(ledPin,HIGH); Serial.print("BOILER ONLINE. CURRENT TEMP: "); Serial.print(temp); Serial.println(" C"); //       if(temp&gt;needTemp) decTemp(); if(temp&lt;needTemp) incTemp(); delay(300); } else { if(enabled) { // Serial.println("BOILER OFFLINE. GOOD LUCK!"); //   myservo.write(50); //    myservo.detach(); enabled=false; } //  digitalWrite(ledPin,LOW); } } void incTemp() { int p=needTemp-temp; Serial.print("Increasing TEMP. P="); Serial.println(p); int pos=myservo.read(); int newpos=pos-p; for(int i=pos;i&gt;=newpos;i--) { if(i&gt;minAngle) myservo.write(i); if(i&lt;minAngle) myservo.write(minAngle); delay(50); } if(p&gt;5) { delay(p*1000); } else { if(p&lt;=3) delay(p*3000); else delay(p*2000); } } void decTemp() { int p=temp-needTemp; Serial.print("Decreasing TEMP. P="); Serial.println(p); int pos=myservo.read(); int newpos=pos+p; for(int i=pos;i&lt;=newpos;i++) { if(i&lt;maxAngle) myservo.write(i); if(i&gt;maxAngle) myservo.write(maxAngle); delay(50); } if(p&gt;5) { delay(p*1000); } else { if(p&lt;=3) delay(p*3000); else delay(p*2000); } }</span></span></span></span></code> </pre> <br><br>  Well, that's all, arduino was placed in the column itself next to the native control unit.  External power supply by power supply found in bins. <br><br>  By the way, I also returned the native screen to the place, and it also works, the guests are often scared seeing how the pen on the column is spinning itself) <br><br>  This is my first article on Habr√©, please do not strictly judge, understand and forgive :) <br>  I am happy to answer all questions. </div><p>Source: <a href="https://habr.com/ru/post/146190/">https://habr.com/ru/post/146190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146182/index.html">Our principles</a></li>
<li><a href="../146183/index.html">Web developer and designer Chris Koyer collected $ 25,000 in 24 hours on Kickstarter</a></li>
<li><a href="../146185/index.html">Lego Turing Machine</a></li>
<li><a href="../146188/index.html">Napartner.ru: $ 2,450,000 investment in startups over 2 years</a></li>
<li><a href="../146189/index.html">QML and QtQuick webinars: custom elements and resource usage</a></li>
<li><a href="../146191/index.html">Russians on Kickstarter.com</a></li>
<li><a href="../146192/index.html">PaymentGate: PaySto Universal Payments</a></li>
<li><a href="../146193/index.html">The first programming language in modern universities of the CIS? (actual)</a></li>
<li><a href="../146194/index.html">Recovery of CISCO Linksys E2500 router</a></li>
<li><a href="../146195/index.html">GodMode in Backyard Monsters or ‚ÄúHow do you exchange data with the application?‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>