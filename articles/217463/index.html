<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>From flash to appstore, full cycle</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 The other day my first app for appstore passed a review in an epple and was approved on the first try. This ended my monthly journey from...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>From flash to appstore, full cycle</h1><div class="post__text post__text-html js-mediator-article"><h4>  Prehistory </h4><br>  The other day my first app for appstore passed a review in an epple and was approved on the first try.  This ended my monthly journey from writing a small toy on Actionscript 3 to appstore <s>tops</s> .  The whole journey was made with the use of a Windows computer without the use of poppy (there is a small fly in the ointment, but more on that later) and I think the experience gained can be useful to many.  I myself had to google a lot in the development process, collecting bit of useful information from all over the Internet, so a small tutorial highlighting important points will be useful for those interested. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c50/06a/509/c5006a509630bbe2ad3d0ccd2c297420.jpg"><br><a name="habracut"></a><br><h4>  Given </h4><br>  I note right away that there will be nothing about the development of the actual game: design, coding, and the like will remain outside the article.  Here will be how to make a cross-platform application on a flash and send it to the store.  From the same source code, you can build an application that will open in the browser and pack for mobile platforms.  Development environment - Flash Develop.  In Builder, however, everything is about the same.  In addition, I used the starling framework ( <a href="http://gamua.com/starling/">gamua.com/starling</a> ) - its beauty is that it a) supports hardware graphics acceleration, i.e.  Your flash drive most likely will not slow down on the device and b) supports multiresolution - worries about the support of different screens are minimized <br><br><h4>  Decision </h4><br><h5>  Step 1. Creating a project, registering a developer account, certificates, provisioned and all that. </h5><br>  In this place, I allow myself to relax and give you this link here: <a href="http://kpulv.com/115/FlashDevelop_to_iPad_Workflow/">kpulv.com/115/FlashDevelop_to_iPad_Workflow</a> - here is a great instruction that takes you in small steps and with pictures from project creation to launching the first build on some iPhone.  All you need is 100 bucks to get an account of an Apple developer and a Windows PC (no poppies, hurray!) Apart from the fact that getting an account will take about a day (as it passes through manual moderation), then this whole way should not take more than an hour.  If you have already had your project before, then it will be enough to transfer its sources and resources to the project created according to the instructions, connect the device to the computer, press the F5 button and enjoy how your game slows down on the device in the debug mode :) These brakes Do not be afraid - they are most likely from debag.  If you do not click F5, but run PackageApp.bat and select Ad-Hoc build there, the application will run quickly, but it will take a very long time to build (assembling within 5-10 minutes is normal).  In interpreter mode, it will be collected quite quickly, but it will slowly work. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Step 2. Connecting Native Extensions </h5><br>  Adobe Native Extensions (ane) - these are libraries that allow you to use the capabilities of the device, such as vibration, accelerometer or In-apps and Game Center.  If you do not need anything, then we‚Äôll skip this step.  I also wanted to fasten to my toy a collection of statistics (Flurry) and the Game Center itself for achivok and leaderboards.  For this, I downloaded <a href="https://github.com/StickSports/ANE-Flurry-Analytics">flurry ane</a> and the <a href="http://gaming.adobe.com/technologies/gamingsdk/">Adobe Gaming SDK</a> , from which only gamecenter.ane was needed.  However, it is better not to use this gamecenter.ane - this will be discussed later too. <br><br>  Connecting ane is quite simple (we find the file in the project explorer, we right-click on it and click Add to library; it is recommended to add ane to the libs folder), but there are a couple of unobvious moments. <br>  <b>First:</b> by default they are connected as a Library, but you need the External Library.  It switches here: <br><img src="https://habrastorage.org/getpro/habr/post_images/bf7/964/42e/bf796442e29b3e9a034046a2799d0267.png"><br>  <b>Second:</b> in the SetupApplication.bat file that lies in the project, in the bat folder, in the line <code>call adt -package -target %TYPE%%TARGET% %OPTIONS% %SIGNING_OPTIONS% "%OUTPUT%" "%APP_XML%" %FILE_OR_DIR%</code> in the end you need to register <code>-extdir lib/</code> , where lib / is the path to the place where you have .ane <br>  <b>Third:</b> in application.xml, which lies in the project folder, you need to write an extension extension, like this: <br><br><pre> <code class="xml hljs">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensionID</span></span></span><span class="hljs-tag">&gt;</span></span>com.adobe.ane.gameCenter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensionID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensionID</span></span></span><span class="hljs-tag">&gt;</span></span>com.sticksports.nativeExtensions.Flurry<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensionID</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  These IDs are case-sensitive and not always obvious.  In order to know the extensionID for sure, you need to open the .ane file as a zip archive and look inside the \ META-INF \ ANE \ extension.xml file - the required line will be written inside the tag. <br><br>  TA-dah!  Now we can use native extensions.  Just write, for example, import com.adobe.ane.gameCenter. * - and you can use. <br><br>  By the way, the remark about the Adobe Game Center ANE.  It is free, it is there, but its use causes the application to crash when trying to send data to the game center, provided there is authorization in the game center and no Internet connection.  Adobi has been silent about this, the problem has been known for at least several months, but there are no fixes and it is not clear when they will be.  In addition, it does not know how to display banners that pop up from the top of the screen about getting achivok.  In general, it is better not to use it.  There is another <a href="https://github.com/StickSports/ANE-Game-Center">ANE</a> , also free, but it requires an iOS SDK to compile, that is, an application using this thing will not build without a poppy.  And there is ANE for 70 bucks, a link to which I will not give, it already gives Google the first line.  I could find nothing more. <br><br><h5>  Step 3. One code - many platforms </h5><br>  At that moment when we begin to use native extensions, our code ceases to be cross-platform.  That is, we cannot assemble a flash drive from the same code that runs in the browser and a flash drive that runs on the phone.  And it's sad and we do not want it.  It is much more convenient to test the gameplay in the form of a flash drive right on your computer, without collecting ipa each time and not flooding the game on the device.  For this, I came up with a crutch ... crooked, but it works. <br><br>  I made a copy of the project file in the same folder.  For example, these are Project.as3proj and ProjectMobile.as3proj files.  And a copy of the Document Class file Main.as - MainMobile.as.  At the same time, the Flash Player platform is specified in the usual Project settings, and Air Mobile is specified in the ProjectMobile settings; Run.bat is selected in the Test Project item in the Test Project item.  Further, in a simple Project, Main remained the document class, and in ProjectMobile the MainMobile appeared as the document class.  Then, in the Singleton Game, I started <code>public static var main:Class</code> <br>  and each Main sets the value of this variable equal to itself.  That is, in the project, the usual Game class considers that main is Main, and in the mobile project, he thinks that main is MainMobile, and you can simply refer to them as main.  In MainMobile, we import everything we need from .ane, but in a simple Main we don‚Äôt.  Further, when from the game itself we need to call some kind of chip, which is mobile, we do this if there is a corresponding variable in main.  For example, the opening of the game center looks like this: <br><pre> <code class="actionscript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(main.gc){ main.gc.showLeaderboardView() }</code> </pre><br>  If the main we currently have is not Mobile Main, then there is no gc variable in it and the game center will not be shown.  At the same time, the Game class itself, in which this occurs, generally has no idea about any gamecenter, it does not import the necessary classes. <br><br>  Now we can simply switch between projects to collect either a mobile version or a browser version, despite the fact that all the source code is shared (except for Main.as, of course). <br><br><h5>  Step 4. The most tedious. </h5><br>  In general, we are great, and did everything we wanted.  The application is going, working steadily on our devices and we are determined to break the records of the Flappy bird.  It's time to fill in the AppStore.  But for this we need some more preparatory steps ... <br><br>  <b>Icon</b> <br>  In the icons folder there are default icons, they should be replaced with the correct ones from our application.  They are needed in different sizes.  You can automatically generate a bunch of smaller files from one file, for example, here: <a href="http://makeappicon.com/">makeappicon.com</a> This site accepts one 1024 * 1024 picture (in this size you need an icon for appstore) and spits out pictures of various sizes.  It is necessary to check the application.xml, so that there the file names correspond to the desired size. <br><br>  <b>Splash-screen</b> <br>  In the same place, in the icons folder there are pictures of splashes - this is the image that is displayed on the screen at the very beginning, while everything else is loaded.  There are usually the logo of the company draw.  They just need to make and save here. <br><br>  <b>Certificates again</b> <br>  In the first step, you generated certificates for testing; now you need a certificate for distribution, distribution or production (on the eppl website, both of these words are used to mean the same thing).  This is done in exactly the same way as in the first step, even a little easier, because  With a distribution certificate, you do not need to list devices for provisioned - after all, you are assembling the application not for test devices, but for all users of the app!  In general, we get the .p12 and .mobileprovision files and write them into the SetupApplication.bat, which is already familiar to us, we get something like: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> IOS_DIST_CERT_FILE=cert\ios_dist.p12 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> IOS_DEV_CERT_FILE=cert\ios_dev.p12 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> IOS_DEV_CERT_PASS=******* <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> IOS_PROVISION=cert\crushTest.mobileprovision <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> IOS_DIST_PROVISION=cert\crushDist.mobileprovision <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> IOS_ICONS=icons/ios <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> IOS_DEV_SIGNING_OPTIONS=-storetype pkcs12 -keystore <span class="hljs-string"><span class="hljs-string">"%IOS_DEV_CERT_FILE%"</span></span> -storepass %IOS_DEV_CERT_PASS% -provisioning-profile %IOS_PROVISION% <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> IOS_DIST_SIGNING_OPTIONS=-storetype pkcs12 -keystore <span class="hljs-string"><span class="hljs-string">"%IOS_DIST_CERT_FILE%"</span></span> -provisioning-profile %IOS_DIST_PROVISION%</code> </pre><br>  I note that I added the line set IOS_DIST_PROVISION = cert \ crushDist.mobileprovision (and replaced% IOS_PROVISION% in the last line with% IOS_DIST_PROVISION%) in the last line, so as not to change the provisioning each time, switching between test and final builds. <br><br>  <b>AIR SDK 13</b> <br>  Perhaps this item will soon lose relevance, but at the moment, the latest stable build of the AIR SDK is 4.0, which was until February.  And in February, Apple activated a new policy, according to which applications that do not know something from ios7 are not allowed into the store.  And just the applications collected in the 4 SDK are not able to do this and are not allowed to store.  But it fixes the AIR SDK 13.0 beta (you shouldn't be afraid of the difference in the version, in fact, the 13th is the next after 4th :) just Adobe has changed the version numbering system).  In order to use the 13th version you need to download it here: <a href="http://labs.adobe.com/technologies/flashruntimes/air/">labs.adobe.com/technologies/flashruntimes/air</a> and unpack the archive into the tools / flexsdk folder (yes, all right air sdk is dumped into the flexsdk folder), which is located you have installed Flash Develop (well, or wherever you have flex sdk, if everything is not the default).  And in the application.xml file in the second line we replace the number at the end with 13.0, it should turn out something like this: <code><br> <br>  5. . <br> !  .    PackageApp.bat ,   AppStore,    ,   5    dist     .ipa,     .       ,       .       " ".   99%    ,      ,     -. .     .          , .       "App Loader",      XCode.         .     ,       .    ,    ,      . <br> <br>  ,         -      ,  , , .          .         ...       ,    ,       ,   -  .   , . <br> <br>  <br>  ,   , : <br>      ,    - ,           99 ,                     (    ) -  flash still alive :)</code> <h5> <code><br> <br>  5. . <br> !  .    PackageApp.bat ,   AppStore,    ,   5    dist     .ipa,     .       ,       .       " ".   99%    ,      ,     -. .     .          , .       "App Loader",      XCode.         .     ,       .    ,    ,      . <br> <br>  ,         -      ,  , , .          .         ...       ,    ,       ,   -  .   , . <br> <br>  <br>  ,   , : <br>      ,    - ,           99 ,                     (    ) -  flash still alive :)</code> </h5> <code><br> <br>  5. . <br> !  .    PackageApp.bat ,   AppStore,    ,   5    dist     .ipa,     .       ,       .       " ".   99%    ,      ,     -. .     .          , .       "App Loader",      XCode.         .     ,       .    ,    ,      . <br> <br>  ,         -      ,  , , .          .         ...       ,    ,       ,   -  .   , . <br> <br>  <br>  ,   , : <br>      ,    - ,           99 ,                     (    ) -  flash still alive :)</code> <h5> <code><br> <br>  5. . <br> !  .    PackageApp.bat ,   AppStore,    ,   5    dist     .ipa,     .       ,       .       " ".   99%    ,      ,     -. .     .          , .       "App Loader",      XCode.         .     ,       .    ,    ,      . <br> <br>  ,         -      ,  , , .          .         ...       ,    ,       ,   -  .   , . <br> <br>  <br>  ,   , : <br>      ,    - ,           99 ,                     (    ) -  flash still alive :)</code> </h5> <code><br> <br>  5. . <br> !  .    PackageApp.bat ,   AppStore,    ,   5    dist     .ipa,     .       ,       .       " ".   99%    ,      ,     -. .     .          , .       "App Loader",      XCode.         .     ,       .    ,    ,      . <br> <br>  ,         -      ,  , , .          .         ...       ,    ,       ,   -  .   , . <br> <br>  <br>  ,   , : <br>      ,    - ,           99 ,                     (    ) -  flash still alive :)</code> <ul><li> <code><br> <br>  5. . <br> !  .    PackageApp.bat ,   AppStore,    ,   5    dist     .ipa,     .       ,       .       " ".   99%    ,      ,     -. .     .          , .       "App Loader",      XCode.         .     ,       .    ,    ,      . <br> <br>  ,         -      ,  , , .          .         ...       ,    ,       ,   -  .   , . <br> <br>  <br>  ,   , : <br>      ,    - ,           99 ,                     (    ) -  flash still alive :)</code> </li> <li> <code><br> <br>  5. . <br> !  .    PackageApp.bat ,   AppStore,    ,   5    dist     .ipa,     .       ,       .       " ".   99%    ,      ,     -. .     .          , .       "App Loader",      XCode.         .     ,       .    ,    ,      . <br> <br>  ,         -      ,  , , .          .         ...       ,    ,       ,   -  .   , . <br> <br>  <br>  ,   , : <br>      ,    - ,           99 ,                     (    ) -  flash still alive :)</code> </li> <li> <code><br> <br>  5. . <br> !  .    PackageApp.bat ,   AppStore,    ,   5    dist     .ipa,     .       ,       .       " ".   99%    ,      ,     -. .     .          , .       "App Loader",      XCode.         .     ,       .    ,    ,      . <br> <br>  ,         -      ,  , , .          .         ...       ,    ,       ,   -  .   , . <br> <br>  <br>  ,   , : <br>      ,    - ,           99 ,                     (    ) -  flash still alive :)</code> </li> <li> <code><br> <br>  5. . <br> !  .    PackageApp.bat ,   AppStore,    ,   5    dist     .ipa,     .       ,       .       " ".   99%    ,      ,     -. .     .          , .       "App Loader",      XCode.         .     ,       .    ,    ,      . <br> <br>  ,         -      ,  , , .          .         ...       ,    ,       ,   -  .   , . <br> <br>  <br>  ,   , : <br>      ,    - ,           99 ,                     (    ) -  flash still alive :)</code> </li> </ul></div><p>Source: <a href="https://habr.com/ru/post/217463/">https://habr.com/ru/post/217463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../217445/index.html">The most central coworking</a></li>
<li><a href="../217447/index.html">Meet WebStorm 8: AngularJS support, spy-js, Grunt integration, and more.</a></li>
<li><a href="../217449/index.html">Altergaze: virtual reality for your smartphone</a></li>
<li><a href="../217455/index.html">Good interface design. Part 3</a></li>
<li><a href="../217457/index.html">Developer Contest ‚ÄúNative Speech‚Äù - attention, semifinal!</a></li>
<li><a href="../217465/index.html">Discovered the first asteroid with rings</a></li>
<li><a href="../217467/index.html">How we use beta testing on google play</a></li>
<li><a href="../217471/index.html">What the Firefox 30 prepares for us</a></li>
<li><a href="../217473/index.html">Love, design and geolocation</a></li>
<li><a href="../217475/index.html">The most powerful booster in the world: a video of the SLS build process video</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>