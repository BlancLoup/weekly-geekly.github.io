<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analysis of weather station data based on Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Creating your own personal weather station has become much easier than before. Given the inconstant weather in New England, we decided that we wanted ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analysis of weather station data based on Arduino</h1><div class="post__text post__text-html js-mediator-article">  Creating your own personal weather station has become much easier than before.  Given the inconstant weather in New England, we decided that we wanted to create our own weather station and use MATLAB to analyze weather data. <br><br>  In the article we will answer the following questions: <br><ul><li>  In which direction did the wind blow during the last 3 hours? </li><li>  How did the temperature and dew point change during the last week? </li><li>  Does barometric pressure actually fall as thunderstorms approach? </li></ul><br>  It is clear that the questions discussed are quite simple, but the described techniques and commands will help you to solve more complex practical problems. <br><a name="habracut"></a><br><h2>  Step 1: Location of the weather station </h2><br>  First, we had to decide where to place our weather station.  We decided to do it on the top floor of the car park.  The place was chosen because it was under the influence of weather, but also had a roof for mounting electronics.  Due to the fact that we ultimately wanted to give data to a third-party data aggregator, we had to take this into account when choosing a place and iron. <br><img src="https://habrastorage.org/files/574/408/735/574408735637416daa6802671e48e7b6.png"><br><br><h2>  Step 2: Select Hardware </h2><br>  The location chosen was outside the range of the Wi-Fi of our building, so we had to find a way to transfer data from the station to the receiver, which was inside the neighboring building. To do this, we connected the Arduino Uno to the XBee high power transmitter.  The data is then transferred to the receiving XBee module on the Arduino Mega already inside the building.  This Arduino was connected to the Internet and the data is sent to a free data aggregation service, <a href="https://thingspeak.com/">ThingSpeak.com</a> .  A complete list of the equipment we used in our installation is given below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Equipment list </h2><br><ul><li>  <a href="https://www.sparkfun.com/products/11021">Arduino Uno</a> with <a href="https://www.sparkfun.com/products/12081">Weather shield</a> and <a href="https://www.sparkfun.com/products/8942">weather sensors</a> </li><li>  2x <a href="https://www.sparkfun.com/products/10854">XBee Shield</a> and 2x <a href="http://www.digi.com/products/wireless-wired-embedded-solutions/zigbee-rf-modules/point-multipoint-rfmodules/xbee-series1-module">XBee Extended Range Modules</a> from Digi International </li><li>  <a href="https://www.sparkfun.com/products/11061">Arduino Mega</a> with <a href="https://www.sparkfun.com/products/9026">Ethernet Shield</a> </li><li>  2 sets for mounting <a href="https://www.sparkfun.com/products/11417">Arduino</a> </li><li>  2x 5V transformer for Arduino power </li><li>  <a href="https://www.sparkfun.com/products/9819">XBee Explorer Dongle</a> for programming the XBee transmitter </li></ul><br><img src="https://habrastorage.org/files/441/622/277/44162227778743888ac368fd68d19a5b.png"><br><br><h2>  Step 3: Connecting the weather station transmitter and programming the outdoor Arduino </h2><br>  External Arduino is installed in the garage and is responsible for collecting measurements and transferring data to the Arduino indoors.  To implement this exchange, we first connected the contacts from the Weather shield and the XBee shield.  Then we connected the XBee shield with the Arduino Uno in accordance with the documentation provided with the shields.  The XBee shield has a high-power XBee transceiver.  We used the <a href="http://www.digi.com/support/kbase/kbaseresultdetl%3Fid%3D2125">X-CTU</a> software to program the desired recipient address and download the correct firmware to the XBee shield.  An anemometer, rain wind sensors were connected to the weather shield using the included RJ-45 connectors. <br><br><h2>  Step 4: Connect the Weather Station Receiver and Indoor Arduino Programming </h2><br>  The internal Arduino is located inside our building, and is responsible for receiving data from the external Arduino, for checking the validity of the data, and sending it to ThingSpeak. To build such a system, we first soldered the contacts on the Ethernet shield and the second XBee shield. XBee shield in Mega Arduino in accordance with the documentation.  We again used <a href="http://www.digi.com/support/kbase/kbaseresultdetl%3Fid%3D2125">X-CTU</a> to program the required recipient address and download the necessary firmware on the XBee shield. <br><br>  Next, we programmed the Arduino to receive XBee messages and forward packets to ThingSpeak at a rate of once per minute.  Before sending the ThingSpeak message, we set up an account and configured the channel and location information.  As soon as the data transfer setup was finished, we began to analyze the data in MATLAB. <br><br>  <i>Please note that to reproduce the analysis given in the article, you do not need to buy and tune equipment. The current data of our station is available on <a href="https://thingspeak.com/channels/12397">channel 12,397</a> .</i> <br><br><h2>  Step 5: Answer the questions </h2><br><h2>  Retrieving weather data from ThingSpeak </h2><br>  To answer our first two questions, we use the command <br><pre><code class="matlab hljs">thingSpeakFetch</code> </pre>  to view the available data fields, simultaneously import all fields into MATLAB and store data on temperature, humidity, wind speed, and wind direction in their variables.  <a href="http://www.mathworks.com/thingspeak">ThingSpeak Support Documentation</a> . <br><pre> <code class="matlab hljs">[d,t,ci] = thingSpeakFetch(<span class="hljs-number"><span class="hljs-number">12397</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPoints'</span></span>,<span class="hljs-number"><span class="hljs-number">8000</span></span>); <span class="hljs-comment"><span class="hljs-comment">% fetch last 8000 minutes of data</span></span></code> </pre><br>  8000 points is the maximum number of points that ThingSpeak allows you to query at a time.  For our measurement frequency, this corresponds to about 6 days of measurement. <br><pre> <code class="matlab hljs">tempF = d(:,<span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-comment"><span class="hljs-comment">% field 4 is temperature in deg F baro = d(:,6); % pressure in inches Hg humidity = d(:,3); % field 3 is relative humidity in percent windDir = d(:,1); windSpeed = d(:,2); tempC = (5/9)*(tempF-32); % convert to Celsius availableFields = ci.FieldDescriptions'</span></span></code> </pre><br><pre> <code class="matlab hljs">availableFields = <span class="hljs-string"><span class="hljs-string">'Wind Direction (North = 0 degrees)'</span></span> <span class="hljs-string"><span class="hljs-string">'Wind Speed (mph)'</span></span> <span class="hljs-string"><span class="hljs-string">'% Humidity'</span></span> <span class="hljs-string"><span class="hljs-string">'Temperature (F)'</span></span> <span class="hljs-string"><span class="hljs-string">'Rain (Inches/minute)'</span></span> <span class="hljs-string"><span class="hljs-string">'Pressure ("Hg)'</span></span> <span class="hljs-string"><span class="hljs-string">'Power Level (V)'</span></span> <span class="hljs-string"><span class="hljs-string">'Light Intensity'</span></span></code> </pre><br><br><h2>  Calculation of some basic statistics for the observation period and their visualization </h2><br>  To get a better understanding of our data, we find the minimum, maximum and average values ‚Äã‚Äãfor the data we imported and we find the time for the maximum and minimum values. This gives us a quick way to validate the data from our weather station. <br><pre> <code class="matlab hljs">[maxData,index_max] = <span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(d); maxData = maxData'; times_max = datestr(t(index_max)); times_max = cellstr(times_max); [minData,index_min] = <span class="hljs-built_in"><span class="hljs-built_in">min</span></span>(d); minData = minData'; times_min = datestr(t(index_min)); times_min = cellstr(times_min); meanData = <span class="hljs-built_in"><span class="hljs-built_in">mean</span></span>(d); meanData = meanData'; <span class="hljs-comment"><span class="hljs-comment">% make column vector summary = table(availableFields,maxData,times_max,meanData,minData,times_min) % display</span></span></code> </pre><br><pre> <code class="matlab hljs">summary = availableFields maxData times_max ____________________________________ _______ ______________________ <span class="hljs-string"><span class="hljs-string">'Wind Direction (North = 0 degrees)'</span></span> <span class="hljs-number"><span class="hljs-number">338</span></span> <span class="hljs-string"><span class="hljs-string">'10-Jul-2014 05:01:32'</span></span> <span class="hljs-string"><span class="hljs-string">'Wind Speed (mph)'</span></span> <span class="hljs-number"><span class="hljs-number">6.3</span></span> <span class="hljs-string"><span class="hljs-string">'10-Jul-2014 12:47:14'</span></span> <span class="hljs-string"><span class="hljs-string">'% Humidity'</span></span> <span class="hljs-number"><span class="hljs-number">86.5</span></span> <span class="hljs-string"><span class="hljs-string">'15-Jul-2014 04:51:24'</span></span> <span class="hljs-string"><span class="hljs-string">'Temperature (F)'</span></span> <span class="hljs-number"><span class="hljs-number">96.7</span></span> <span class="hljs-string"><span class="hljs-string">'12-Jul-2014 16:28:55'</span></span> <span class="hljs-string"><span class="hljs-string">'Rain (Inches/minute)'</span></span> <span class="hljs-number"><span class="hljs-number">0.04</span></span> <span class="hljs-string"><span class="hljs-string">'15-Jul-2014 13:47:13'</span></span> <span class="hljs-string"><span class="hljs-string">'Pressure ("Hg)'</span></span> <span class="hljs-number"><span class="hljs-number">30.23</span></span> <span class="hljs-string"><span class="hljs-string">'11-Jul-2014 09:25:07'</span></span> <span class="hljs-string"><span class="hljs-string">'Power Level (V)'</span></span> <span class="hljs-number"><span class="hljs-number">4.44</span></span> <span class="hljs-string"><span class="hljs-string">'10-Jul-2014 10:25:01'</span></span> <span class="hljs-string"><span class="hljs-string">'Light Intensity'</span></span> <span class="hljs-number"><span class="hljs-number">0.06</span></span> <span class="hljs-string"><span class="hljs-string">'12-Jul-2014 13:23:38'</span></span> meanData minData times_min _________ _______ ______________________ NaN <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">'10-Jul-2014 04:54:32'</span></span> <span class="hljs-number"><span class="hljs-number">3.0272</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">'10-Jul-2014 01:33:14'</span></span> <span class="hljs-number"><span class="hljs-number">57.386</span></span> <span class="hljs-number"><span class="hljs-number">25.9</span></span> <span class="hljs-string"><span class="hljs-string">'12-Jul-2014 13:39:39'</span></span> <span class="hljs-number"><span class="hljs-number">80.339</span></span> <span class="hljs-number"><span class="hljs-number">69.6</span></span> <span class="hljs-string"><span class="hljs-string">'11-Jul-2014 06:59:54'</span></span> <span class="hljs-number"><span class="hljs-number">5.625e-05</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">'10-Jul-2014 01:02:11'</span></span> <span class="hljs-number"><span class="hljs-number">30.04</span></span> <span class="hljs-number"><span class="hljs-number">29.78</span></span> <span class="hljs-string"><span class="hljs-string">'15-Jul-2014 13:04:08'</span></span> <span class="hljs-number"><span class="hljs-number">4.4149</span></span> <span class="hljs-number"><span class="hljs-number">4.38</span></span> <span class="hljs-string"><span class="hljs-string">'11-Jul-2014 09:22:06'</span></span> <span class="hljs-number"><span class="hljs-number">0.0092475</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">'10-Jul-2014 01:02:11'</span></span></code> </pre><br>  If we get unexpected values, such as a maximum atmospheric pressure of 40 atmospheres or a maximum temperature of 1700 degrees, we can assume that the data are incorrect.  Such errors may occur due to transmission errors, voltage spikes and other causes.  At the end of the article, we will show some ways to handle such ‚Äúoutliers‚Äù, but for uploaded data, when this report was published, everything looks fine. <br><br>  For the code above, we used a tabular data type, first introduced in MATLAB R2013b. See the <a href="http://blogs.mathworks.com/loren/2013/09/10/introduction-to-the-new-matlab-data-types-in-r2013b/">blog entry</a> to learn more about this data type. <br><br><h2>  Visualization of the wind in the last three hours </h2><br>  Since our weather station receives meteorological reports about once a minute, we look at the last 180 minutes to answer our question about what the wind was in the last 3 hours, and we use the MATLAB Compass plot to see the speed and direction wind in the time of interest.  This is a mathematical compass, where the North (0 degrees) is on the right, and the degrees increase counterclockwise.  90 degrees represents the East (top), 180 degrees represents the south (left) and 270 degrees represents the West (bottom).  If there is no wind shear due to thunderstorms or with a frontal passage, the compass, as a rule, shows the preferential wind direction indicated by higher density arrows on the graph.  In the case of the data requested in this example, we observe wind direction mainly from the south and southwest, typical of summer time in New England. <br><pre> <code class="matlab hljs"><span class="hljs-built_in"><span class="hljs-built_in">figure</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) windDir = windDir((<span class="hljs-keyword"><span class="hljs-keyword">end</span></span><span class="hljs-number"><span class="hljs-number">-180</span></span>):<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>); <span class="hljs-comment"><span class="hljs-comment">% last 3 hours windSpeed = windSpeed((end-180):end); rad = windDir*2*pi/360; u = cos(rad) .* windSpeed; % x coordinate of wind speed on circular plot v = sin(rad) .* windSpeed; % y coordinate of wind speed on circular plot compass(u,v) titletext = strcat(' for last 3 hours ending on: ',datestr(now)); title({'Wind Speed, MathWorks Weather Station'; titletext})</span></span></code> </pre><br><img src="https://habrastorage.org/files/d1a/cb5/7c7/d1acb57c7dbf41fcb3a94288bf83664e.png"><br><br><h2>  Dew point calculation </h2><br>  Now we are ready to answer our second question about how the temperature and dew point changed during <br>  last week. The dew point is the temperature at which the air (when cooled) becomes saturated with water vapor.  The higher the humidity of the air mass, the higher the dew point.  Dew point is also sometimes used as a measure of discomfort.  When the dew point exceeds 65 degrees (+ 18C), many people begin to say that the air is ‚Äústicky‚Äù.  At a dew point of 70, many feel uncomfortable.  The overall estimate for the dew point, TDP, can be found using the equation and constants, as shown below: <br><img src="https://habrastorage.org/files/f6c/8f5/f70/f6c8f5f70d3a43fbadac9c177a5699bc.png"><br>  Where <br><img src="https://habrastorage.org/files/098/d82/c18/098d82c189ef4a8db105c104abb6da14.png"><br>  with <img src="https://habrastorage.org/files/119/9ea/eaa/1199eaeaa98d412fb461df84a013dcb4.png"><br>  Now, having written the above equations, as the MATLAB code we have: <br><pre> <code class="matlab hljs">b = <span class="hljs-number"><span class="hljs-number">17.62</span></span>; c = <span class="hljs-number"><span class="hljs-number">243.5</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">gamma</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(humidity/<span class="hljs-number"><span class="hljs-number">100</span></span>) + b*tempC ./ (c+tempC); tdp = c*<span class="hljs-built_in"><span class="hljs-built_in">gamma</span></span> ./ (b-<span class="hljs-built_in"><span class="hljs-built_in">gamma</span></span>); tdpf = (tdp*<span class="hljs-number"><span class="hljs-number">1.8</span></span>) + <span class="hljs-number"><span class="hljs-number">32</span></span>; <span class="hljs-comment"><span class="hljs-comment">% convert back to Fahrenheit</span></span></code> </pre><br><br><h2>  Visualization of temperature, humidity and dew point as a function of time </h2><br>  Now that we have calculated the dew point, we are ready to visualize the data and observe their behavior over the past 5 or 6 days. <br><pre> <code class="matlab hljs"><span class="hljs-built_in"><span class="hljs-built_in">figure</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>) [ax, h1, h2] = plotyy(t,[tempF tdpf],t,humidity); set(ax(<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-string"><span class="hljs-string">'XTick'</span></span>,[]) set(ax(<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-string"><span class="hljs-string">'YColor'</span></span>,<span class="hljs-string"><span class="hljs-string">'k'</span></span>) set(ax(<span class="hljs-number"><span class="hljs-number">1</span></span>),<span class="hljs-string"><span class="hljs-string">'YTick'</span></span>,[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>]) set(ax(<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-string"><span class="hljs-string">'YTick'</span></span>,[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span>,<span class="hljs-number"><span class="hljs-number">60</span></span>,<span class="hljs-number"><span class="hljs-number">80</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>]) datetick(ax(<span class="hljs-number"><span class="hljs-number">1</span></span>),<span class="hljs-string"><span class="hljs-string">'x'</span></span>,<span class="hljs-string"><span class="hljs-string">'keeplimits'</span></span>,<span class="hljs-string"><span class="hljs-string">'keepticks'</span></span>) set(get(ax(<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-string"><span class="hljs-string">'YLabel'</span></span>),<span class="hljs-string"><span class="hljs-string">'String'</span></span>,availableFields(<span class="hljs-number"><span class="hljs-number">3</span></span>)) set(get(ax(<span class="hljs-number"><span class="hljs-number">1</span></span>),<span class="hljs-string"><span class="hljs-string">'YLabel'</span></span>),<span class="hljs-string"><span class="hljs-string">'String'</span></span>,availableFields(<span class="hljs-number"><span class="hljs-number">4</span></span>)) grid on <span class="hljs-built_in"><span class="hljs-built_in">legend</span></span>(<span class="hljs-string"><span class="hljs-string">'Location'</span></span>,<span class="hljs-string"><span class="hljs-string">'South'</span></span>,<span class="hljs-string"><span class="hljs-string">'Temperature'</span></span>,<span class="hljs-string"><span class="hljs-string">'Dew point'</span></span>, <span class="hljs-string"><span class="hljs-string">'Humidity'</span></span>)</code> </pre><br><img src="https://habrastorage.org/files/741/358/715/7413587157124fdabd73d18601592434.png"><br>  During a typical week, you can clearly see daily variations in temperature and humidity.  As expected, relative humidity usually increases at night (as the temperature drops to the dew point) and maximum temperatures are usually reached in the afternoon. The dew point temperature indicates the humidity of the air masses.  When we collected the data for publishing this example, you can see that the dew point was over 70 degrees, which is typical of a hot and humid summer day in New England. If you run this code in MATLAB, you can get different answers as you go. how you will request the latest data reported by the weather station. <br><br><h2>  Retrieving and processing weather data for a rainy day in New England </h2><br>  The last question we wanted to answer is: is the atmospheric pressure really falling before the rain?  To do this, we obtained data from a weather station for a famous rainy day.  This time, we are interested in barometric pressure and precipitation.  We used a self emptying sensor, which is emptied when it is full.  Our sensor rotates and empties when 0.01 inches of precipitation falls. Our Arduino code counts the number of emptyings per minute and transmits the corresponding precipitation value to ThingSpeak.  We use MATLAB to sample hourly samples from our data so that we can easily see precipitation accumulation and pressure trends. <br><pre> <code class="matlab hljs">[d,t,ci] = thingSpeakFetch(<span class="hljs-number"><span class="hljs-number">12397</span></span>,<span class="hljs-string"><span class="hljs-string">'DateRange'</span></span>,{<span class="hljs-string"><span class="hljs-string">'6/4/2014'</span></span>,<span class="hljs-string"><span class="hljs-string">'6/6/2014'</span></span>}); <span class="hljs-comment"><span class="hljs-comment">% get data baro = d(:,6); % pressure extraData = rem(length(baro),60); % computes excess points beyond the hour baro(1:extraData) = []; % removes excess points so we have even number of hours rain = d(:,5); % rainfall from sensor in inches per minute</span></span></code> </pre><br>  Did it really rain on June 5th?  It's hard to say if we just look at every minute of data transfer, since the maximum value is only 0.01 inch.  However, if we sum up all the precipitations for June 5, we see that we received 0.48 inches of precipitation, which is 13% of the monthly average of 3.68 inches, which indicates that the day was really very rainy.  To get a more complete picture of when the maximum precipitation fell, we converted the data into hourly data, as shown below. <br><pre> <code class="matlab hljs">rain(<span class="hljs-number"><span class="hljs-number">1</span></span>:extraData) = []; t(<span class="hljs-number"><span class="hljs-number">1</span></span>:extraData) = []; rainHourly = sum(<span class="hljs-built_in"><span class="hljs-built_in">reshape</span></span>(rain,<span class="hljs-number"><span class="hljs-number">60</span></span>,[]))'; <span class="hljs-comment"><span class="hljs-comment">% convert to hourly summed samples maxRainPerMinute = max(rain) june5rainfall = sum(rainHourly(25:end)) % 24 hours of measurements from June 5 baroHourly = downsample(baro,60); % hourly samples timestamps = downsample(t,60); % hourly samples</span></span></code> </pre><br><pre> <code class="matlab hljs">maxRainPerMinute = <span class="hljs-number"><span class="hljs-number">0.0100</span></span> june5rainfall = <span class="hljs-number"><span class="hljs-number">0.4800</span></span></code> </pre><br><br><h2>  Visualize hourly cloud and pressure data and find the pressure trend </h2><br>  After we have pre-processed our data, we are ready to visualize them.  Here we use MATLAB, to find the trend line to barometric pressure data.  If we plot, will we see a drop in pressure before a heavy downpour? <br><pre> <code class="matlab hljs"><span class="hljs-built_in"><span class="hljs-built_in">figure</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) subplot(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) bar(timestamps,rainHourly) <span class="hljs-comment"><span class="hljs-comment">% plot rain xlabel('Date and Time') ylabel('Rainfall (inches /per hour)') grid on datetick('x','dd-mmm HH:MM','keeplimits','keepticks') title('Rainfall on June 4 and 5') subplot(2,1,2) hold on plot(timestamps,baroHourly) % plot barometer xlabel('Date and Time') ylabel(availableFields(6)) grid on datetick('x','dd-mmm HH:MM','keeplimits','keepticks') detrended_Baro = detrend(baroHourly); baroTrend = baroHourly - detrended_Baro; plot(timestamps,baroTrend,'r') % plot trend hold off legend('Barometric Pressure','Pressure Trend') title('Barometric Pressure on June 4 and 5')</span></span></code> </pre><br><img src="https://habrastorage.org/files/48a/80a/a66/48a80aa664304ec0bd1a31b65b074e97.png"><br>  After we visualize this data and look at the trend, we clearly see that the atmospheric pressure really drops exactly before the onset of precipitation! <br><br><h2>  Clearing data from inaccurate measurements </h2><br>  Our questions were fairly simple, but sometimes there are problems with the available data.  For example, on May 30, we recorded some inaccurate temperature data.  Let's see how to use MATLAB to filter them. <br><pre> <code class="matlab hljs">[d,t] = thingSpeakFetch(<span class="hljs-number"><span class="hljs-number">12397</span></span>,<span class="hljs-string"><span class="hljs-string">'DateRange'</span></span>,{<span class="hljs-string"><span class="hljs-string">'5/30/2014'</span></span>,<span class="hljs-string"><span class="hljs-string">'5/31/2014'</span></span>}); rawTemperatureData = d(:,<span class="hljs-number"><span class="hljs-number">4</span></span>); newTemperatureData = rawTemperatureData; minTemp = <span class="hljs-built_in"><span class="hljs-built_in">min</span></span>(rawTemperatureData) <span class="hljs-comment"><span class="hljs-comment">% wow that is cold!</span></span></code> </pre><br><pre> <code class="matlab hljs">minTemp = <span class="hljs-number"><span class="hljs-number">-1.7662e+03</span></span></code> </pre><br><h2>  Using a threshold filter to remove outliers </h2><br>  Deleting items that did not pass the threshold test.  In this case, we have some values ‚Äã‚Äãthat are obviously unreliable, such as a temperature value of -1766 degrees Fahrenheit.  Therefore, you can use data that includes only temperature values, between 0 and 120, which are acceptable values ‚Äã‚Äãfor a spring day in New England. <br><pre> <code class="matlab hljs">tnew = t'; outlierIndices = [<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>(rawTemperatureData &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">find</span></span>(rawTemperatureData &gt; <span class="hljs-number"><span class="hljs-number">120</span></span>)]; tnew(outlierIndices) = []; newTemperatureData(outlierIndices) = [];</code> </pre><br>  Construct graphics cleaned and source data. <br><pre> <code class="matlab hljs"><span class="hljs-built_in"><span class="hljs-built_in">figure</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) subplot(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">plot</span></span>(tnew,newTemperatureData,<span class="hljs-string"><span class="hljs-string">'-o'</span></span>) datetick xlabel(<span class="hljs-string"><span class="hljs-string">'Time of Day'</span></span>) ylabel(availableFields(<span class="hljs-number"><span class="hljs-number">4</span></span>)) title(<span class="hljs-string"><span class="hljs-string">'Filtered Data - outliers deleted'</span></span>) grid on subplot(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">plot</span></span>(t,rawTemperatureData,<span class="hljs-string"><span class="hljs-string">'-o'</span></span>) datetick xlabel(<span class="hljs-string"><span class="hljs-string">'Time of Day'</span></span>) ylabel(availableFields(<span class="hljs-number"><span class="hljs-number">4</span></span>)) title(<span class="hljs-string"><span class="hljs-string">'Original Data'</span></span>) grid on</code> </pre><br><img src="https://habrastorage.org/files/673/bd5/27e/673bd527ee0c4f2e8429147f3b9a0d4b.png"><br><br><h2>  Using a median filter to remove invalid data </h2><br>  Another way to remove bad data is to apply a median filter.  The median filter does not require as much knowledge about the data set.  It will simply remove the values ‚Äã‚Äãthat fall outside the average nearest neighbors.  The filtering results are a vector of the same length as the original one, in contrast to deleting data points, which leads to data breaks and shortening the record.  This type of filter can also be used to remove noise from a signal. <br><pre> <code class="matlab hljs">n = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">% this value determines the number of total points used in the filter</span></span></code> </pre><br>  Large n values ‚Äã‚Äãdenote the number of ‚Äúneighbors‚Äù for comparison.  At temperatures collected once a minute, we choose n = 5, because the temperature should not, as a rule, vary greatly within 5 minutes. <br><pre> <code class="matlab hljs">f = medfilt1(rawTemperatureData,n); <span class="hljs-built_in"><span class="hljs-built_in">figure</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>) subplot(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">plot</span></span>(t,f,<span class="hljs-string"><span class="hljs-string">'-o'</span></span>) datetick xlabel(<span class="hljs-string"><span class="hljs-string">'Time of Day'</span></span>) ylabel(availableFields(<span class="hljs-number"><span class="hljs-number">4</span></span>)) title(<span class="hljs-string"><span class="hljs-string">'Filtered Data - using median filter'</span></span>) grid on subplot(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">plot</span></span>(t,rawTemperatureData,<span class="hljs-string"><span class="hljs-string">'-o'</span></span>) datetick xlabel(<span class="hljs-string"><span class="hljs-string">'Time of Day'</span></span>) ylabel(availableFields(<span class="hljs-number"><span class="hljs-number">4</span></span>)) title(<span class="hljs-string"><span class="hljs-string">'Original Data'</span></span>) grid on</code> </pre><br><img src="https://habrastorage.org/files/cbd/321/a66/cbd321a662184f60b85ea1af93d3bea3.png"><br><br><h2>  Conclusion </h2><br>  So, we analyzed the data from our weather station and answered questions of interest to us. <br>  We also demonstrated some ways to filter data that does not pass the initial test. <br><br>  The questions posed in the article are elementary, but think about what can be achieved by collecting data from thousands of stations?  In addition, you can measure and analyze real-time changes in industrial and scientific systems and make decisions based on data. <br><br>  We remind you that in order to reproduce the analysis given in the article, you do not need to buy and set up equipment.  Live data from our installation is available on channel 12,397 on ThingSpeak.com. <br><br>  <a href="http://www.mathworks.com/matlabcentral/fileexchange/47049">MATLAB project code</a> </div><p>Source: <a href="https://habr.com/ru/post/256413/">https://habr.com/ru/post/256413/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../256403/index.html">We unify the behavior of LINQ to IEnumerable and LINQ to IQueriable in terms of working with null values. Part two. Its implementation of IQueryProvider</a></li>
<li><a href="../256405/index.html">Interview with Serge</a></li>
<li><a href="../256407/index.html">Worm apples [WITHOUT JailBreak]</a></li>
<li><a href="../256409/index.html">New graphics mode: CGA in 1024 colors</a></li>
<li><a href="../256411/index.html">Interference: as a tram, radar detector and poorly crimped cable can affect the satellite channel</a></li>
<li><a href="../256415/index.html">Overview of Wireframesketcher features on the example of creating a site layout</a></li>
<li><a href="../256417/index.html">How it all works: the development of interactive online courses</a></li>
<li><a href="../256419/index.html">Vulnerability in iOS 8 found disabling devices in range of a Wi-Fi access point</a></li>
<li><a href="../256425/index.html">Python Meetup 03/27/15: machine learning, python AST and player statistics World of Tanks</a></li>
<li><a href="../256427/index.html">Ubuntu 15.04 released (Vivid Vervet)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>