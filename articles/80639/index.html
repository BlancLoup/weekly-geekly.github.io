<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google maps api. Building routes on the map</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I would like to consider another possibility google maps api - adding routes to maps. If there is enough information on the markers on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google maps api. Building routes on the map</h1><div class="post__text post__text-html js-mediator-article">  In this article I would like to consider another possibility google maps api - adding routes to maps.  If there is enough information on the markers on the Internet, then I could not find any sensible examples on this topic, and even in Russian.  Of course, everything that will be written below is <a href="http://code.google.com/intl/ru/apis/maps/documentation/reference.html">in Google</a> , but to begin to understand api, at least some minimal ideas about the subject are necessary. <br><br>  I propose to consider an example in which the user is given the opportunity to add markers and routes.  The example is quite functional, can be used as a basis for its own development. <br><br>  For routes on the map, we can change the position of key points, delete them and add new ones.  Add markers to the nodes, set a description for them (markers).  All this is seen in the <a href="http://www.image123.net/qc7jkokn11cxpic.html">figure</a> . <br><a name="habracut"></a><br>  Information about added routes and markers will be stored in the mysql database.  In the example, I used jquery and one plugin for it.  In addition to all this, to display information about the marker, I used the ExtInfoWindow class ( <a href="http://gmaps-utility-library-dev.googlecode.com/svn/trunk/extinfowindow/">see</a> ), extending the ability of standard Google windows.  In this article I don‚Äôt want to dwell on how to work with markers and how to implement interaction with the database, but all this functionality is implemented in the example, and those who wish can take a look at the source codes in the archive (we link to the end of the article). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, let's begin.  The first thing to do is place a card.  Create a div c id = map_canvas on the page and write the following code in javascript: <br><blockquote><code>map = new GMap2(document.getElementById("map_canvas")); <br> map.setCenter(new GLatLng(58.12432, 55.0), 4); <br> map.setUIToDefault(); <br> map.mode = '';</code> </blockquote> <br>  Here we create a map, set the display center and scale, and add a set of controls to it.  The map will have a mode variable in which the current mode will be located (four modes are possible, adding a marker, deleting a marker, adding a route, deleting a route). <br><br>  Place on the page two div elements with id = add_route and id = del_route.  These will be the buttons for adding and deleting a route.  Assign two handlers to them: <br><blockquote> <code>$('#add_route').click(handle_add_route); <br> $('#del_route').click(handle_del_route);</code> </blockquote> <br>  In the handle_add_route () function, we check the mode in which we are and call the route building function: <br><blockquote> <code>if(map.mode !== '') return; <br> map.mode = 'add_route'; <br> build_route(0,'');</code> </blockquote> <br>  We pass the route id and its coordinates to the build_route function, since we create a new one, we pass a zero and an empty string.  Next, set the line color, transparency and its thickness: <br><blockquote> <code>var lineColor = "#CF3A34"; <br> var opacity = .70; <br> var lineWeight = 2;</code> </blockquote> <br>  Point coordinates are a pair of comma separated numbers.  The row of coordinates is coordinates separated by a semicolon.  If a string with coordinates was passed, then we form an array of points from it.  The conversion into a clear map format is performed using the fromUrlValue () function. <br><blockquote> <code>var line = []; <br> if(points) <br> { <br> var p = []; <br> newroute = false; <br> p = points.match(/([0-9.,\-]*)/g); <br> for(var i=0;i&lt;p.length;i++) <br> if(p[i]!='') <br> line.push(GLatLng.fromUrlValue(p[i])); <br> }</code> </blockquote> <br>  Now we create a route and start its drawing: <br><blockquote> <code>theroute = new GPolyline(line, lineColor, lineWeight, opacity); <br> start_drawing(theroute, id, update_route);</code> </blockquote> <br>  The third parameter here is the name of the function that will be called when the route changes (the update_route () function reads the vertices, converts them to a string, and sends them to the server). <br><blockquote> <code>function start_drawing(poly, id, onUpdate) <br> { <br> map.addOverlay(poly); <br> <br> if(!id) <br> { <br> poly.enableDrawing(); <br> editing_route = poly; <br> } <br> <br> poly.enableEditing({onEvent: "mouseover"}); <br> poly.disableEditing({onEvent: "mouseout"}); <br> ‚Ä¶</code> </blockquote> <br>  Add a route to the map.  If this is a new route (just created, and not just added from the database), then set it to the editable state.  We hang two handlers on the route so that you can edit the created routes. <br><br>  Next we add the lineupdated event, which will be triggered when the route is changed, however, we will call the function to save changes only for routes that have already been completed (from the base). <br><blockquote> <code>GEvent.addListener(poly, "lineupdated", function() <br> { <br> if(id) <br> update_route(); <br> });</code> </blockquote> <br>  Now we hang up the endline event - the end of the addition (double click on the last point of the route). <br><blockquote> <code>GEvent.addListener(poly, "endline", function() <br> { <br> GEvent.bind(poly, "lineupdated", this, onUpdate); <br> save_route(poly); <br> });</code> </blockquote> <br>  For this event, we hang up the route change handler and arrange it. <br><br>  The last step is to add a route click handler to set a marker to one of its vertices: <br><blockquote> <code>GEvent.addListener(poly, "click", function(latlng, index) <br> { <br> if (typeof index == "number") <br> { <br> if(map.mode == 'add_marker') <br> { <br> point = poly.getVertex(index); <br> if(point) save_marker(point); <br> } <br> } <br> }); <br> }</code> </blockquote> <br>  The route is saved as follows: <br><blockquote> <code>function save_route(poly) <br> { <br> var finish = function(resp) <br> { <br> if( check_response(resp) ) <br> { <br> var id = resp.content; <br> poly.route_id = id; <br> routes[id] = {}; <br> routes[id] = {'id': id, 'point':points}; <br> map.mode = ''; <br> } <br> } <br> <br> var pointsCount = poly.getVertexCount(); <br> var points = []; <br> for(i = 0; i &lt; pointsCount; i++) <br> points[i] = poly.getVertex(i).toUrlValue(); <br> points = points.join(';'); <br> <br> var params = 'action=add_route&amp;points='+points; <br> $.post(this_url, params, finish, 'json'); <br> }</code> </blockquote> <br>  Here we get the vertices, convert them to a string and send to the server ajax request.  If everything went well, we add the route to the route array and turn off the edit mode. <br><br>  At this point you can finish the article, the main functionality we reviewed.  I want to say again that in the attached example, a full-fledged work with markers is implemented.  Everything is quite transparent and simple even for beginners. <br><br>  Download an example here <a href="http://www.filehoster.ru/files/ee8710">http://www.filehoster.ru/files/ee8710</a> <br><br>  For those who are going to run the example in their own place - do not forget to change the GOOGLE_MAPS_API key. <br><br>  Lastly - the archive composition: <br>  index.php - processing ajax requests, receiving data from the database <br>  dump.sql - database structure <br>  /css/style.css - styles for the page and for the ExtInfoWindow class <br>  / img - images for the ExtInfoWindow class <br>  /inc/core.php - script settings, connection settings to the database and a couple of additional functions in php <br>  /js/extinfo.js - ExtInfoWindow class <br>  /js/jquery-1.3.2.min.js - jquery <br>  /js/jquery.editable.js - jquery text editing plugin (onfly) <br>  /js/script.js - the main functionality. <br>  /tpl/template.html - page template with map </div><p>Source: <a href="https://habr.com/ru/post/80639/">https://habr.com/ru/post/80639/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../80633/index.html">Translation of app-engine-patch documentation</a></li>
<li><a href="../80634/index.html">Re: How to activate God mode in Windows 7</a></li>
<li><a href="../80635/index.html">EveryDNS.net sold to a commercial DNS hoster</a></li>
<li><a href="../80636/index.html">Installing 10.2.0.1 x86_64 on CentOS 5.1 x86_64</a></li>
<li><a href="../80638/index.html">Dell Mini 5 Internet Tablet</a></li>
<li><a href="../80640/index.html">The queue for "Avatar" in Minsk</a></li>
<li><a href="../80642/index.html">MySQL vs PostgreSQL in the context of celebrating the New Year</a></li>
<li><a href="../80644/index.html">Nexus One buyers do not want to pay money when returning</a></li>
<li><a href="../80645/index.html">Copyright and AppStore</a></li>
<li><a href="../80647/index.html">Microsoft has more than a month buggy licensing site</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>