<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Verkhuffa algorithm for an arbitrary even number system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes there is a task to protect the identifier string from accidental mistakes made by a person. For example, the number of the payment card. For...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Verkhuffa algorithm for an arbitrary even number system</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/he/i8/yu/hei8yu1qvckw3xedpmhxzobgvom.jpeg" align="left" alt="KDPV">  Sometimes there is a task to protect the identifier string from accidental mistakes made by a person.  For example, the number of the payment card.  For this purpose, a specially calculated check digit is added to the line, and when a person enters this number, you can do an initial check for errors without accessing the database.  The simplest option is to add the remainder of dividing the sum of all digits by 10, in which case the distortion of any single digit (including the control) will be easy to detect, and such a line will not pass the test.  But some other errors such checksum will miss, for example, rearrangement of two digits in places, and this is also a fairly common mistake. <br><a name="habracut"></a><br>  To protect bank card numbers, a slightly more complicated algorithm, <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%259B%25D1%2583%25D0%25BD%25D0%25B0">the Moon</a> algorithm, was chosen.  One modification has been added to it: the numbers standing in even places are multiplied by 2 before summing (and if more than nine is obtained, then 9 is subtracted).  This makes it possible to catch, in addition to the distortion of any digit, the majority (although not all) of the permutations of neighboring digits. <br><br>  Are there any algorithms that can detect any permutation of neighboring digits (in addition to the distortion of any single digit)?  Yes, there are, although for some reason they are not very common.  These are <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%2592%25D0%25B5%25D1%2580%25D1%2585%25D1%2583%25D1%2584%25D1%2584%25D0%25B0">the Verhuff algorithm</a> based on dihedral groups, and <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%2594%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B0">Damm's algorithm</a> , which is based on Damm quasigroups.  It sounds scary, but in fact there is nothing complicated (for those who are familiar with the concept of "group"). <br><br>  Jacobus Verhoeff, a Dutch mathematician and sculptor (one of his sculptures in the photo), proposed an algorithm based on <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D1%258D%25D0%25B4%25D1%2580%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B3%25D1%2580%25D1%2583%25D0%25BF%25D0%25BF%25D0%25B0">dihedral groups</a> .  A dihedral group is a symmetry group of a regular N-gon, including both rotations and axial symmetries.  Such a group is not commutative: if a regular polygon with renumbered vertices is first symmetrically displayed, and then rotated, then in most cases it will not be the same as if you first rotate and then display.  Therefore, when sequentially ‚Äúmultiplying‚Äù the digits of the original string, using the operation of the dihedral group, i.e.  consistently applying the rotation and symmetric mapping operations on the correct N-gon, we get protection against most permutations.  From the majority, but still not from everyone.  Verkhuff proposed to improve this algorithm, and before multiplying, replace each digit with another in a special table, depending on the location of the digit in the row.  The table is obtained from one permutation by applying it consistently to the previous result, and after 8 such applications we come to the original order, so you can build an 8x10 table in advance and take the value from there.  Some of these permutations allow you to determine all 100% of possible errors in the order of the adjacent digits of the source line, that is, this is a complete and correct solution to the problem of finding a check digit that protects against these two types of errors.  Apparently, Verhuffff found a successful permutation by random selection, there are quite a few of them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The question of whether there are groups that allow one to find any permutations of neighboring numbers without additional modifications has remained open for a long time.  And already in the 21st century, in 2004, the German mathematician Michael Damm proved the existence of such groups, they are called weakly totally anti-symmetric quazigroup.  I have not fully understood the way of their construction, anyone can try to do it yourself by <a href="https://www.sciencedirect.com/science/article/pii/S0012365X06004225">publishing it</a> .  And although at a cursory review it doesn‚Äôt look so complicated (it‚Äôs even strange that the question remained open for so long), for practical implementation there is an easier way: use <a href="http://www.md-software.de/math/DAMM_Quasigruppen.txt">ready-made tables</a> . <br><br>  We now turn to the following and the main question: what to do if you want to protect not a string of decimal digits, but a string of arbitrary characters, for example, hexadecimal or base64 or base58?  That is, to solve the problem not for the particular case of the decimal number system, but in general. <br><br>  The Moon algorithm expands to this case without problems, but it is not so interesting, because it does not find all permutations of neighboring numbers.  The method of constructing an antisymmetric quasigroup of arbitrary size is not quite clear.  For the Verhuff algorithm, the dihedral group of size N is not difficult to construct, but we still need a permutation table, which is also not clear where to take (and even it is not clear whether it exists).  Here is the study of the last question I took up. <br><br>  Googling did nothing, except for individual attempts and the use of ‚Äúsufficiently good‚Äù solutions (that is, those that reveal almost all permutations) for N = 64. <br><br>  Perhaps, I will not describe all the tried and tested methods of searching for the desired permutation, which did not produce a result.  I tried to solve a particular problem: to find a permutation for base64 and base58, which gives protection against changing the order of neighboring digits.  Let me just say that attempts to find such a permutation using the method of random or sequential search with different optimization options did not lead to anything.  But in the end I found a common solution for any even n. <br><br>  Rearrangement such: <br><br> <code>0, N-1 .. N/2+1, 1 .. N/2 <br></code> <br>  For example, for N = 10, this would be: <br><br> <code>0, 9, 8, 7, 6, 1, 2, 3, 4, 5 <br></code> <br>  This permutation has another remarkable property: it always has a period (for N&gt; = 8) equal to 12, which allows you to build a table 12xN in advance and take a figure from there. <br><br>  <a href="https://github.com/pgul/verhoeff-demo">Here is an example of the implementation of the proposed extension of the Verhuff algorithm for base58</a> (strictly speaking, this is no longer <a href="https://github.com/pgul/verhoeff-demo">Verkhuff‚Äôs</a> algorithm, but its generalization).  Not a full-fledged lib, but just a utility, so to speak, proof of concept. <br><br>  The proof that this permutation possesses the necessary property, and that it has a period of 12, I will provide somehow later.  There is too little space on the margin to place it here. </div><p>Source: <a href="https://habr.com/ru/post/435446/">https://habr.com/ru/post/435446/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435430/index.html">The coolest new CES 2019</a></li>
<li><a href="../435432/index.html">New Year, New GitHub: Unlimited Free Private Repositories</a></li>
<li><a href="../435434/index.html">We use annotations in PHP to the maximum</a></li>
<li><a href="../435436/index.html">5 IT infrastructure trends: forecast for 2019</a></li>
<li><a href="../435442/index.html">Funnel change</a></li>
<li><a href="../435448/index.html">About the experience of communicating with the signal generator through QTcpSocket and SCPI</a></li>
<li><a href="../435450/index.html">Happy new year with new MQTT / UDP</a></li>
<li><a href="../435452/index.html">End-to-end testing of microservices with Catcher</a></li>
<li><a href="../435454/index.html">AOP vs Functions</a></li>
<li><a href="../435462/index.html">Testing Node.js projects. Part 1. Anatomy of tests and types of tests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>