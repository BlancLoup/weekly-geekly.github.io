<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing a bot for an online JavaScript game using AOP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you like me and love online games, but do not like to spend on them much time, welcome under the cat. We will not discuss bots as it is good or not...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing a bot for an online JavaScript game using AOP</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/e44/95f/a01/e4495fa011891f5614f7911ba1f7b14a.jpg"><br>  If you like me and love online games, but do not like to spend on them much time, welcome under the cat.  We will not discuss bots as it is good or not, but just analyze how you can make a bot for a specific online game.  It will not stupidly click on the button by timeout, but will respond to events in the browser.  We will do this with the help of Aspect-Oriented Programming (hereinafter AOP).  For example, I chose the favorite game Pernatsk. <br><a name="habracut"></a><br><h4>  1. Cooking ingredients </h4><br>  We will need: <br><ul><li>  Own the game itself.  I will show the example of <a href="http://pernatsk.ru/">Pernatsk</a> </li><li>  Browser.  I have everything standard - Chrome </li><li>  A text editor or what you will edit the JS code.  Notepad ++ will do </li><li>  Test account, which is not a pity to lose as a result of the ban </li></ul><br><br>  <b>Important!</b>  The game should work in the browser, not in the client.  And not on Flash, but on HTML + JavaScript. <br>  At the output, we should have an extension for Chrome, which will play instead of us. <br><h4>  2. Making an extension </h4><br>  I will not describe in detail how this extension is made.  On Habr√© about this already written, for example, <a href="http://habrahabr.ru/post/198652/">here</a> . <br>  I will give only the codes we need files. <br>  In manifest.json <br><br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"BOT for pernatsk"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"manifest_version"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"content_scripts"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"matches"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"http://pernatsk.ru/*"</span></span> ], <span class="hljs-string"><span class="hljs-string">"js"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"background.js"</span></span> ], <span class="hljs-string"><span class="hljs-string">"run_at"</span></span>: <span class="hljs-string"><span class="hljs-string">"document_end"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"storage"</span></span> ], <span class="hljs-string"><span class="hljs-string">"web_accessible_resources"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"/injected.js"</span></span> ] }</code> </pre> <br>  In the line "matches": [" <a href="http://pernatsk.ru/">pernatsk.ru</a> *"] you will need to specify the address of your game. <br>  I use the background.js file for cases when I want to inject my JS code on the site.  Actually background.js code: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="javascript hljs">$.get(chrome.extension.getURL(<span class="hljs-string"><span class="hljs-string">'/injected.js'</span></span>), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> script = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"script"</span></span>); script.setAttribute(<span class="hljs-string"><span class="hljs-string">"type"</span></span>, <span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>); script.innerHTML = data; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"head"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].appendChild(script); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"body"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].setAttribute(<span class="hljs-string"><span class="hljs-string">"onLoad"</span></span>, <span class="hljs-string"><span class="hljs-string">"ai_on();"</span></span>); } );</code> </pre> <br>  <b>Important!</b>  If you do not understand what we are doing in this single function, then it is too early for you to make a bot.  Read the basics of javascript. <br>  All our work will be done in the file injected.js. His code is so far: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ai_on</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Hello world"</span></span>) }</code> </pre> <br>  All these files are saved in the same bot folder. <br><h4>  3. The first launch of the bot </h4><br>  Go to Chomre in Settings - Tools - Extensions, click on "Download unpacked extension."  You should have a tick on "Developer Mode".  Specify the folder with our files. <br>  Now let's go to our game.  Turn on the developer console (we will have to do this often) - press F12 and see ‚ÄúHello Wolrd‚Äù.  The application has earned. <br>  Now everything we write in the ai_on function will be processed after the page loads. <br><h4>  4. Add AOP </h4><br>  We need libraries for the bot to work.  My favorite jQuery is already used in Pernatsk, so it won't be added. <br>  Add <a href="https://code.google.com/p/jquery-aop/">AOP for Jquery</a> plugin.  For good, it was worth packing into the extension itself as a separate file, but I'm lazy.  So just add the code bin / aop.pack.js in the first line of our injected.js. <br>  Check that it works by changing ai_on <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ai_on</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ bot = jQuery.aop.after( {<span class="hljs-attr"><span class="hljs-attr">target</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>, <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'$'</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'jQuery detected!'</span></span>); bot[<span class="hljs-number"><span class="hljs-number">0</span></span>].unweave(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }); }</code> </pre> <br>  Check that the AOP is properly connected.  The developer console will now have the line ‚ÄújQuery detected!‚Äù The message will be only once, since I disable the advice after the first trigger. <br>  <b>Important!</b>  Read the AOP for Jquery documentation to understand jQuery.aop.after and bot [0] .unweave (). <br><h4>  5. Why we will use AOP </h4><br>  The essence of AOP can be very roughly expressed as follows: " <i><b>After function_1, function_2 must be done. What this function_1 worries us very little. It worked, it means we must work it out. We‚Äôll not go into function_1.</b></i> "  It is better to read the normal description for example <a href="http://habrahabr.ru/post/199378/">here.</a> <br>  How to use it?  We after any function can run ours.  For example, in the browser, a function was executed that a monster appeared in sight.  We launch the function to attack it, which we have already written ourselves. <br><h4>  6. We teach the bot the first team </h4><br>  In injected.js add the following code: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> commands = { <span class="hljs-attr"><span class="hljs-attr">conessearch</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.pathname != <span class="hljs-string"><span class="hljs-string">"/location/conessearch"</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.pathname = <span class="hljs-string"><span class="hljs-string">"/location/conessearch"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> buttons = $(<span class="hljs-string"><span class="hljs-string">'form'</span></span>).eq(<span class="hljs-number"><span class="hljs-number">0</span></span>).find(<span class="hljs-string"><span class="hljs-string">'button'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; index &lt; buttons.length; ++index) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(buttons.eq(index).css(<span class="hljs-string"><span class="hljs-string">'display'</span></span>) == <span class="hljs-string"><span class="hljs-string">"inline-block"</span></span>) { buttons.eq(index).mouseenter(); buttons.eq(index).click(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }, }</code> </pre><br><br>  At this command, our bot-bird will fly in Pernatsk for cones.  The code is a bit tricky, as in Pernatsk there is a little protection from bots. <br>  When you write your commands, I recommend first trying out their performance in the console, and only then transfer the code to the editor. <br>  In order to test and test the work of our team, we will launch the <code>commands.conessearch()</code> code in the spacebar. <br><br><h4>  7. We are looking for an event to which the bot should respond. </h4><br>  There are two methods here: the first is analyzing the game code.  Long: ( <br>  The second method is to use AOP, and after all the functions that worked to output their name to the log.  Then select the desired. <br>  Change ai_on () <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ai_on</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ bot = jQuery.aop.around( {<span class="hljs-attr"><span class="hljs-attr">target</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>, <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">invocation</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(invocation.method); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> invocation.proceed(); }); }</code> </pre> <br>  We will have many, many functions.  There will be $ from jQuery or standard setTimeout. <br>  Working with this is not very convenient to change the code again. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ai_on</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ fnList = []; bot = jQuery.aop.around( {<span class="hljs-attr"><span class="hljs-attr">target</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>, <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">invocation</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fnName = invocation.method.toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(fnList.indexOf(fnName) == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(fnName); fnList.push(fnName); } }); }</code> </pre> <br>  Now we have reflected only those functions that have not yet been displayed.  Their full list is stored in fnList. <br>  After a couple of minutes there will be such options for the hitching function <code>["clearInterval", "$", "setTimeout", "timerTick", "serverTimeUpdate", "getComputedStyle", "setInterval", "tutorialArr", "showQ", "showQc", "updateBirdData", "viz", "unviz", "weatherUpdate"]</code> <br>  Changing the target and the regular expression in method, we can choose the function that will suit us to cling to it.  For example, I choose the weatherUpdate function. Now, every time the weather changes, our bird will fly behind the cones. <br><h4>  7. We teach the bot to respond to events </h4><br>  We again change the function code ai_on () <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ai_on</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ bot = jQuery.aop.after( {<span class="hljs-attr"><span class="hljs-attr">target</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>, <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'weatherUpdate'</span></span>}, commands.conessearch()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ai_off</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ bot[<span class="hljs-number"><span class="hljs-number">0</span></span>].unweave(); }</code> </pre><br>  The ai_off function is needed to turn off the bot through the console. <br><h4>  8. Directions for further development </h4><br>  I hope this material was useful for you.  What else can you do? <br><ul><li>  Make the switch off the bot by button.  Using functions ai_on, ai_off </li><li>  Make a full bot </li><li>  Make the extension work in any browser.  For example, using <a href="http://kangoextensions.com/">Kango</a> </li><li>  And so on </li></ul><br>  The code doesn‚Äôt really do anything, so I don‚Äôt post it. </div><p>Source: <a href="https://habr.com/ru/post/228607/">https://habr.com/ru/post/228607/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228595/index.html">What are dangerous "smart" power</a></li>
<li><a href="../228599/index.html">Overview of the mechanical keyboard CODE Keyboard</a></li>
<li><a href="../228601/index.html">LifeTrak: we thought Pebble had no competitors</a></li>
<li><a href="../228603/index.html">Java 8 Advanced Content</a></li>
<li><a href="../228605/index.html">BOOTSTRA.386: The theme for the Bootstrap in the spirit of the 1980s</a></li>
<li><a href="../228609/index.html">"The effect of empty space" or the luxury of nothing</a></li>
<li><a href="../228613/index.html">Russian Post plans to develop an application for iOS and Android</a></li>
<li><a href="../228617/index.html">Legal Clickjacking VKontakte</a></li>
<li><a href="../228619/index.html">Live Windows Phone Tiles</a></li>
<li><a href="../228623/index.html">Paid subscriptions and paid content services of mobile operators</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>