<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ScribeJava - even your grandma can work with OAuth</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This phrase welcomes us to the library for working with OAuth - ScribeJava ( https://github.com/scribejava/scribejava ). To be precise, the phrase is:...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ScribeJava - even your grandma can work with OAuth</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/273/4b0/326/2734b032642d44d38ea5ac257bd2e693.jpg" alt="image"><br><br>  This phrase welcomes us to the library for working with OAuth - ScribeJava ( <a href="https://github.com/scribejava/scribejava">https://github.com/scribejava/scribejava</a> ).  To be precise, the phrase is: ‚ÄúWho said OAuth / OAuth2 was difficult?  Configuring ScribeJava is <b>so easy your grandma can do it!</b>  check it out: ‚Äù. <br><br>  And it really seems to be true: <br><pre><code class="java hljs">OAuth20Service service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceBuilder().apiKey(clientId).apiSecret(clientSecret) .callback(<span class="hljs-string"><span class="hljs-string">"http://your.site.com/callback"</span></span>).grantType(<span class="hljs-string"><span class="hljs-string">"authorization_code"</span></span>).build(HHApi.instance()); String authorizationUrl = service.getAuthorizationUrl(); OAuth2AccessToken accessToken = service.getAccessToken(code);</code> </pre> <br>  Done!  These three lines are enough to start making OAuth requests.  And the OAuth request itself can be done like this: <br><pre> <code class="java hljs">OAuthRequest request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OAuthRequest(Verb.GET, <span class="hljs-string"><span class="hljs-string">"https://api.hh.ru/me"</span></span>, service); service.signRequest(accessToken, request); String response = request.send().getBody();</code> </pre><br>  User data is in our hands (in the response variable).  And not a bit of insight into how OAuth works in detail.  Want asynchronous http requests?  We have enough of the same three lines.  Below we take this example. <br><a name="habracut"></a><br><h3>  1. OAuth?  What is it about? </h3><br>  Most of the sites in one form or another need to register users: for comments, tracking orders, vacancy responses - it does not matter. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the same time, people on the Internet usually show lazy behavior and do not like to fill in registration forms, especially if they have already done this somewhere.  OAuth comes to the rescue of such sites.  However, the article is not about the OAuth protocol itself, so we will talk about how to work with OAuth, without going into details and the mechanism of its work. <br><br>  In a nutshell, OAuth was created to give authorization to a third-party server (site) to receive any data from another resource (for example, social network).  Ie, for example, a Vkontakte user using OAuth can give a right to a certain site (for example, hh.ru) to request its data or to perform any actions on the Vkontakte network on its behalf.  It should be noted that OAuth was not created to identify the user.  However, among other things, we can almost always request data ‚Äúabout ourselves‚Äù, thus obtaining the user id and identifying it. <br><br>  If you try to describe OAuth step by step, you‚Äôll get something like this (using OAuth2 as an example - it is simpler). <br><ol><li>  We register our application on a third-party site, we get client_id and client_secret - this is done once. </li><li>  When a user comes to us, our site forms a link to a third-party site where we want to get authorization to receive data about the user.  The link necessarily contains the client_id of our application on this site.  Further, our site gives the user this link. </li><li>  The user follows the link to a third-party site, logs in (if not already logged in), approves the rights requested by us (for example, receiving his full name) and returns to us with the additional GET parameter 'code'. </li><li>  Our site directly (server-server) sends the received GET parameter to a third-party site and receives a token (access_token) in response. </li><li>  We make requests to receive data or perform any activities on behalf of the user, and we add this access_token to each request. </li></ol><br><h3>  2. Even your grandma can use OAuth </h3><br>  Let's try to make out in more detail an example from the beginning of the article by making an OAuth request on hh.ru.  To do this, we need to create an OAuthService using the builder ServiceBuilder.  This line of code will look like this: <br><pre> <code class="java hljs">OAuth20Service service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceBuilder() .apiKey(clientId) .apiSecret(clientSecret) .callback(<span class="hljs-string"><span class="hljs-string">"http://your.site.com/callback"</span></span>) .grantType(<span class="hljs-string"><span class="hljs-string">"authorization_code"</span></span>) .build(HHApi.instance());</code> </pre><br>  You will only need to substitute your application's clientId and clientSecret, which you can get by registering a new application at <a href="https://dev.hh.ru/">https://dev.hh.ru</a> .  You will also need to specify a callback url where the user will be redirected to with the code we need (code). <br><pre> <code class="java hljs">String authorizationUrl = service.getAuthorizationUrl();</code> </pre><br>  We send the user to this address.  In our case, it will look something like this: <br>  <a href="https%253A%252F%252Fhhid.ru%252Foauth2%252Fcode">hh.ru/oauth/authorize?response_type=code&amp;client_id=UHKBSA...&amp;redirect_uri=https%3A%2F%2Fhhid.ru%2Foauth2%2Fcode</a> <br>  If you open this address in the browser, the user will see the login form, then the form of issuing rights to the application.  If he is already logged in and / or granted rights to the application earlier, he will immediately be redirected to the callback we specified.  In our case, this: <br>  <a href="https://hhid.ru/oauth2/code%3Fcode%3DI2R6O5">hhid.ru/oauth2/code?code=I2R6O5</a> ... <br>  This is the GET parameter 'code' we need.  Change it to a token: <br><pre> <code class="java hljs">String code = <span class="hljs-string"><span class="hljs-string">"I2R6O5..."</span></span>; OAuth2AccessToken accessToken = service.getAccessToken(code);</code> </pre><br>  That's all!  We have a token (OAuth2AccessToken accessToken), if we bring it to the console, we will see the insides: <br><pre> <code class="java hljs">OAuth2AccessToken { access_token=I55KQQ..., token_type=bearer, expires_in=<span class="hljs-number"><span class="hljs-number">1209599</span></span>, refresh_token=PGELQV..., scope=<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>}</code> </pre><br>  Now let's try to get some data.  Create a query: <br><pre> <code class="java hljs">OAuthRequest request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OAuthRequest(Verb.GET, <span class="hljs-string"><span class="hljs-string">"https://api.hh.ru/me"</span></span>, service);</code> </pre><br>  Sign the request with a token: <br><pre> <code class="java hljs">service.signRequest(accessToken, request);</code> </pre><br>  We send a request to hh.ru: <br><pre> <code class="java hljs">Response response = request.send();</code> </pre><br>  Print the result: <br><pre> <code class="java hljs">System.out.println(response.getCode()); System.out.println(response.getBody());</code> </pre><br>  Profit!  In the console we will see something like this: <br><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">200</span></span> {<span class="hljs-string"><span class="hljs-string">"first_name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"last_name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"middle_name"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">"is_in_search"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">"is_anonymous"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">"resumes_url"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">"is_employer"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-string"><span class="hljs-string">"personal_manager"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">"email"</span></span>: <span class="hljs-string"><span class="hljs-string">"s.gromov@hh.ru"</span></span>, <span class="hljs-string"><span class="hljs-string">"manager"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, ...}</code> </pre><br>  And we did not have to learn what parameters need to be transferred, how to do it, how to encrypt them, in what order to transfer, and many other nuances of both the OAuth protocol itself and its specific implementation from HeadHunter. <br><br>  ps.  The full code of the example being run can be seen here: <br>  <a href="">https://github.com/scribejava/scribejava/blob/master/scribejava-apis/src/test/java/com/github/scribejava/apis/examples/HHExample.java</a> <br><br>  The library is released in maven central, so it will be very easy to connect it to the project: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.github.scribejava<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>scribejava-apis<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.3.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  If you have very strict requirements on the size of the final application, then you can take only the core part, without a collection of different APIs: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.github.scribejava<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>scribejava-core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.3.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h3>  3.scribe-java -&gt; SubScribe -&gt; ScribeJava or how to fork and return the debt to opensource community </h3><br>  We received user data that can be used both for registering a new user and for authenticating the old one.  This may be necessary not only for new sites that are too lazy to bother with registration, but also for old, already mature, such as hh.ru.  It is with these thoughts that we entered 2013. <br><img src="https://habrastorage.org/files/77a/9c0/d7a/77a9c0d7ab3b482997cf415e943aa570.jpg"><br>  It should be noted that, despite the existence of relatively good specifications of the OAuth protocol, as is usually the case, each server has invented and invents its own modifications.  Somewhere freely interpreting standards, somewhere taking advantage of the freedom provided by the specifications, and somewhere going against them for the sake of some of their ideas. <br><br>  At hh.ru, we wanted to add inputs at once through several different social networks, and, of course, we wanted to write code that works with each of them to a minimum.  Surely someone has already written everything!  At a minimum, a list of addresses to which you need to send requests (and in fact a bunch of small nuances).  In addition, I would like to keep the written code to a minimum, and, if necessary, when, for example, the social network decides to change the URL for which you need to go for the token, simply update the library version. <br><br>  We studied the options that existed at that time, and it turned out that the easiest to use and, at the same time, the largest database of APIs that the library would work out of the box, was scribe-java from <a href="https://github.com/fernandezpablo85/">https://github.com/fernandezpablo85/</a> .  At that time, she had a few, but not all of the APIs, which we wanted.  Well, not scary, you can add the missing and give them to the public. <br><br>  From this we began.  But having written our first PullRequest on a githaba, we learned that the author was already ‚Äútired‚Äù of such Pull Revests and answered us with a prepared article on the wiki that he would not add new APIs ;-( According to the author, scribe-java should to be a small simple library (possibly without OAuth2 at all, leaving only the first version of the protocol), and we wanted to have all the true ‚Äúlibrary‚Äù properties from it, a collection of all addresses of different APIs. Well, it's not a big deal if there‚Äôs something the library is not satisfied, you can always make a fork! Thus the project was born  SubScribe t. With a heading of five points that indicated the main reasons for creating our fork: <br><blockquote>  Main reasons of fork here: <br>  1.https: //github.com/fernandezpablo85/scribe-java/wiki/Scribe-scope-revised <br>  2.We really think, OAuth2.0 should be here; <br>  3.We really think, async http should be here for a high-load projects; <br>  4.We really think, all APIs should be here.  With all their specific stuff.  It is easier to change the programmer; <br>  5. Scribe should be multi-maven-module project.  Core and APIs should not be deployed as separated artifacts. <br></blockquote>  ¬© <a href="">https://github.com/hhru/subscribe/blob/a8450ec2ed35ecaa64ef03afc1bd077ce14d8d61/README.md</a> <br><br>  In addition to the previously described, of the reasons for creating the fork, there are several more.  Being one of the most loaded sites of the runet and the job sites of Europe, we really wanted to be able to work asynchronously.  And it was not included in the plans of a simple original library.  We also decided to eliminate the author‚Äôs ‚Äúfear‚Äù that the library would become cumbersome due to the abundance of specific features of an individual specific API.  We divided the project into two modules.  After some gestures, on March 3rd, 2014, the first version of SubScribe (immediately 2.0) appeared in the central repository of Maven <a href="http://central.maven.org/maven2/ru/hh/oauth/subscribe/subscribe/2.0/">http://central.maven.org/maven2/ru/hh/oauth/subscribe/subscribe/2.0/</a> .  Where the project existed before version 3.4, released on June 30th, 2015.  During this time, having gained a bit of his own popularity and new features, new APIs, he does not forget to backport all the goodies from the parent scribe-java. <br><br>  It would have remained so, if at the beginning of autumn 2015 Pablo Fernandez ( <a href="https://github.com/fernandezpablo85">https://github.com/fernandezpablo85</a> ), apparently, finally tired of his creation, would not have stumbled upon our fork.  Pablo said that he was impressed and sees a lot of things that he would like to do himself, but didn‚Äôt get around, and offered to work out the details of the transfer of the project to us completely.  Having got a little shaken up for decency, we accepted the offer, and so ScribeJava appeared - in effect renamed back the SubScribe fork.  Since then, the library has a separate organization on github.com - <a href="https://github.com/scribejava">https://github.com/scribejava</a> . <br><br>  At the moment, ScribeJava is an open source project under the wing hh.ru.  Included in the list of client libraries in java on the main page of the official website of the OAuth2 protocol: <a href="http://oauth.net/2/">http://oauth.net/2/</a> .  It has 280 observers, 3,106 stars and 1,220 forks on github.com. <br><br><h3>  4. Add asynchrony and update the token using the example of working with Google </h3><br>  If you have a heavily loaded site and you want to save threads and / or just use the ning http client, then we can ask ScribeJava to use the asynchronous version of the work.  For this you need to have ning http client in your classpath <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.ning<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>async-http-client<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.9.32<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  This time we will use the Asynchronous builder of the ServiceBuilderAsync service. <br><pre> <code class="java hljs">OAuth20Service service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceBuilderAsync() .apiKey(clientId) .apiSecret(clientSecret) .scope(<span class="hljs-string"><span class="hljs-string">"profile"</span></span>) <span class="hljs-comment"><span class="hljs-comment">// replace with desired scope .state("secret" + new Random().nextInt(999_999)) .callback("https://hhid.ru/oauth2/code") .asyncHttpClientConfig(clientConfig) .build(GoogleApi20.instance());</span></span></code> </pre><br>  The only difference here is the call to the asyncHttpClientConfig (clientConfig) method, to which we must give the config for the asynchronous ning http client.  For example, let it be this: <br><pre> <code class="java hljs">AsyncHttpClientConfig clientConfig = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AsyncHttpClientConfig.Builder() .setMaxConnections(<span class="hljs-number"><span class="hljs-number">5</span></span>) .setRequestTimeout(<span class="hljs-number"><span class="hljs-number">10_000</span></span>) .setAllowPoolingConnections(<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) .setPooledConnectionIdleTimeout(<span class="hljs-number"><span class="hljs-number">1_000</span></span>) .setReadTimeout(<span class="hljs-number"><span class="hljs-number">1_000</span></span>) .build();</code> </pre><br>  Google also requires a state variable.  It is necessary to protect against CRSF attacks, but this is beyond the interest of our article.  Further work is no different from the example of working with api.hh.ru, discussed at the beginning.  We send the user to the address: <br><pre> <code class="java hljs">String authorizationUrl = service.getAuthorizationUrl();</code> </pre><br>  And for each method with HTTP campaign we add the postfix 'Async' inside.  Those.  instead of the getAccessToken method, we will call the getAccessTokenAsync method. <br><pre> <code class="java hljs">Future&lt;OAuth2AccessToken&gt; accessTokenFuture = service.getAccessTokenAsync(<span class="hljs-string"><span class="hljs-string">"code"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);</code> </pre><br>  In response, we get Future (asynchrony after all).  Or we can optionally pass the second argument Callback, as we prefer. <br>  Done!  Simple, isn't it?  Now you can send asynchronous requests (OAuthRequestAsync) to Google on behalf of the user: <br><pre> <code class="java hljs">OAuth2AccessToken accessToken = accessTokenFuture.get(); OAuthRequestAsync request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OAuthRequestAsync(Verb.GET, <span class="hljs-string"><span class="hljs-string">"https://www.googleapis.com/plus/v1/people/me"</span></span>, service); service.signRequest(accessToken, request); Response response = request.sendAsync(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>).get(); System.out.println(response.getCode()); System.out.println(response.getBody());</code> </pre><br>  In the resulting OAuthRequestAsync, we called the sendAsync method, which, by analogy, optionally expects a Callback and returns us the Future.  At the same time, we still have the opportunity to send synchronous requests in parallel with asynchronous.  If we want to somehow asynchrony (or synchrony) requests, you can ask ScribeJava to do it through a static ‚Äúconfigurator‚Äù: <br><pre> <code class="java hljs">ScribeJavaConfig.setForceTypeOfHttpRequests(ForceTypeOfHttpRequest.FORCE_ASYNC_ONLY_HTTP_REQUESTS);</code> </pre><br>  In this case, when you try to use the synchronous version of ScribeJava, we will get an Exception.  Other options are possible, for example, not throwing Exception, but logging about each such case.  Or vice versa to require only synchronous work. <br><br>  Consider here another useful OAuth point - refresh_token.  The fact is that the access_token we get has a limited lifespan.  And when it gets rotten, we need to get a new token.  There are two options: either wait for the user and once again guide him through the whole mechanism, or use refresh_token (not all support it, but Google, by the example of which we will try it, supports it).  So, to get a fresh access_token, all we need is just: <br><pre> <code class="java hljs">OAuth2AccessToken refreshedAccessToken accessToken = service.refreshAccessToken(accessToken.getRefreshToken());</code> </pre><br>  or for the asynchronous option: <br><pre> <code class="java hljs">Future&lt;OAuth2AccessToken&gt; refreshedAccessTokenFuture = service.refreshAccessTokenAsync(accessToken.getRefreshToken(), <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);</code> </pre><br>  It is worth noting that in the case of Google, the refresh_token that needs to be passed to the refreshAccessToken method will not come unless specifically asked for it.  To do this, you need to create an address to which the user will add a couple of parameters: <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// access_type=offline   refresh_token //https://developers.google.com/identity/protocols/OAuth2WebServer#preparing-to-start-the-oauth-20-flow Map&lt;String, String&gt; additionalParams = new HashMap&lt;&gt;(); additionalParams.put("access_type", "offline"); //Google  refresh_token    offline ,    ,      prompt additionalParams.put("prompt", "consent"); String authorizationUrl = service.getAuthorizationUrl(additionalParams);</span></span></code> </pre><br>  ps.  This and other examples in the run form (with the static main method) are here: <a href="https://github.com/scribejava/scribejava/tree/master/scribejava-apis/src/test/java/com/github/scribejava/apis/examples">https://github.com/scribejava/scribejava/tree/master/scribejava-apis/src/test/java/com/github/scribejava/apis/examples</a> <br><br><h3>  5. Useful links </h3><br>  1.ScribeJava on github.com <a href="https://github.com/scribejava/scribejava">https://github.com/scribejava/scribejava</a> <br>  2. documentation api.hh.ru <a href="https://github.com/hhru/api">https://github.com/hhru/api</a> <br>  3. Google documentation <a href="https://developers.google.com/identity/protocols/OAuth2WebServer">https://developers.google.com/identity/protocols/OAuth2WebServer</a> <br>  4.RFC OAuth2 <a href="http://tools.ietf.org/html/rfc6749">http://tools.ietf.org/html/rfc6749</a> <br>  5.javadoc online <a href="http://www.javadoc.io/doc/com.github.scribejava/scribejava-core">http://www.javadoc.io/doc/com.github.scribejava/scribejava-core</a> <br><br><h3>  Post Scriptum </h3><br>  Comments are very welcome.  Especially in the form of pull requests on github.com </div><p>Source: <a href="https://habr.com/ru/post/278957/">https://habr.com/ru/post/278957/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278947/index.html">Speed ‚Äã‚ÄãDevelopment Unity3D games for the competition</a></li>
<li><a href="../278949/index.html">Spiceworks research: insider threats will be the biggest information security challenge in 2016</a></li>
<li><a href="../278951/index.html">We collect Electron.js rake or desktop JS-applications in practice</a></li>
<li><a href="../278953/index.html">Web merge sync on MS SQL</a></li>
<li><a href="../278955/index.html">An error in the AMD processor microcode allows virtual machine users to access the hypervisor host system</a></li>
<li><a href="../278959/index.html">A fresh look at the Oracle VM VirtualBox code</a></li>
<li><a href="../278961/index.html">Reinforced.Typings - TypeScript Angular services directly from your MVC controllers</a></li>
<li><a href="../278963/index.html">"Festive Chef" at FBD, step by step</a></li>
<li><a href="../278965/index.html">Announcement of Java-conference for students in Moscow: JPoint 2016 Student Day</a></li>
<li><a href="../278967/index.html">STM32 and LCD, fast screen fill</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>