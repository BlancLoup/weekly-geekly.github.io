<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VMware PowerCLI: We manage the clouds and everything from the command line:</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="advbg 


 About the routine and struggle with it 
 We all love VMware products! In addition to all of our beloved Workstation, WMware offers the most ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VMware PowerCLI: We manage the clouds and everything from the command line:</h1><div class="post__text post__text-html js-mediator-article">  <a href="https://habrahabr.ru/users/advbg/" class="user_link">advbg</a> <br><img src="http://www.dmitryalexandrov.net/pcli.jpeg" alt="image"><br><br><h4>  About the routine and struggle with it </h4><br>  We all love VMware products!  In addition to all of our beloved Workstation, WMware offers the most powerful virtualization tools at the corporate and multi-corporate level. <br><br>  Having several ESXi hypervisors using vCenter Server installed, for example, on one of the virtual machines living on one of the same hypervisors, we can quite easily manage all connected hypervisors, manage all resources, create, delete, edit virtual machines, etc. d.  We can connect, for example, using the vSphere Client and get a pretty nice view of our entire virtual infrastructure. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      True, at one moment, this infrastructure can become very large and very heavy.  Any kind of administration at one point may take too much time and take too much effort.  Some tasks are performed periodically, which is a little annoying. <br><br>  A rather reasonable question arises, and what of all this can be scripted and how?  This is where PowerCLI comes to the rescue. <a name="habracut"></a><br><br>  PowerCLI is an extension for Windows Powershell that adds over 400 new cmdlets to manage Virtual Infrastructure, including the Cloud.  You can download the product from here <a href="http://communities.vmware.com/community/vmtn/server/vsphere/automationtools/powercli">communities.vmware.com/community/vmtn/server/vsphere/automationtools/powercli</a> .  There are also links to documentation, blog and community. <br><br><h4>  Something about Powershell </h4><br>  After installing the distribution, run the PowerCLi shortcut.  A console opens, which is essentially a full-featured Powershell, but with a loaded SnapIn to manage the Virtual Infrastructure.  You can simply open Powershell and load snapins from the folder where PowerCLI is installed. <br><br>  Briefly recall the syntax of Powershell.  Commands in it are formed as follows: <br><br> <b><code>Verb-Noun ‚ÄìParam1 <i>String</i> [[-Param2] <i>int</i> ] [-Param3 <i>short</i> ] [-SwitchParam] [-EnumParam { <i>Val1</i> | .. | <i>ValN</i> ]} [ <i>CommonParameters</i> ]</code></b> <br>  <b>Verb</b> - as follows from the definition, this is an action that needs to be performed on <b>Noun</b> by submitting parameters by name or by position.  The result of the execution will be a .Net object.  Further, these objects are recorded in variables or you can submit them via pipeline to some cmdlet.  For example: <br> <b><code>Get-Process -name notepad | Stop-Process</code></b> <br> <br>  Here we take all the processes named notepad using the <b>Get-Process cmdlet</b> and pass it along the pipeline to the <b>Stop-Process cmdlet</b> , which stops them. <br><br><h4>  How it works in PowerCli </h4><br>  We apply this philosophy to manage our infrastructure: <br><br> <code>#           <br> PS&gt; $vm = Get-VM -Name DemoMachine <br> #  <br> PS&gt; $vm <br> Name PowerState Num CPUs Memory (MB) <br> ---- ---------- -------- ----------- <br> DemoMachine PoweredOff 1 256 <br></code> <br><br>  We can complicate the command and show other information.  As in the example with notepad, we take a virtual machine, transfer it along the pipeline to the Select-Object, which takes some of the fields of the virtual machine object and transfer the result to the Format-Table, which formats the output. <br><br> <code>PS&gt; $vm | Select-Object Name,VMHost,Version | Format-Table -AutoSize <br> Name VMHost Version <br> ---- ------ ------- <br> DemoMachine 10.23.83.210 v7 <br></code> <br><br>  Now let's try to change something.  Suppose we have added memory on the host machines.  One line we can upgrade all virtual machines, for example, in the marketing department: <br><br> <code>PS&gt; Get-VM ‚ÄìLocation MarketingPool | Set-VM ‚ÄìMemoryMB 512 ‚ÄìConfirm:$false <br> Name PowerState Num CPUs Memory (MB) <br> ---- ---------- -------- ----------- <br> MarketingVM05 PoweredOff 1 512 <br> MarketingVM04 PoweredOff 1 512 <br> MarketingVM03 PoweredOff 1 512 <br> MarketingVM01 PoweredOff 1 512 <br> MarketingVM02 PoweredOff 1 512 <br></code> <br><br>  Consider a few more eloquent examples: <br> <code>#     <br> PS&gt; Get-VM -Location DevelopmentPool | New-Snapshot -Name "ClearState" <br> <br> #       <br> PS&gt; Get-VM -Location DevelopmentPool | Set-VM -Snapshot "ClearState" <br> <br> #       <br> PS&gt; Get-VM -Location DevelopmentPool | Get-Snapshot -Name "ClearState" | Remove-Snapshot <br> <br> #    datastore- <br> PS&gt; Get-Datastore | Select Name,CapacityGB,FreespaceGB | Format-Table -AutoSize <br> <br> #        <br> PS&gt; Get-VM -Location DevelopmentPool | Get-HardDisk | Select Parent,Name,CapacityKB,StorageFormat <br> <br> #    ESX(i)  <br> PS&gt; Get-VMHost | Select Name,Manufacturer,Model,NumCpu,MemoryTotalMB,CpuTotalMhz,ApiVersion | ft -AutoSize <br></code> <br><br><h4>  Now fashionable word cloud ... </h4><br>  These commands were executed on vSphere, but as I said in a similar way, we can manage the Cloud infrastructure.  For this, there is a set of commandlets. <br><br>  Having connected to the cloud, we are interested in what virtual machines we have.  We carry out: <br><br> <code>PS&gt; Get-CIVM | Select Name <br> Name <br> ---- <br> CloudVM03 <br> CloudVM04 <br> CloudVM01 <br> CloudVM02 <br> CloudVM05 <br></code> <br><br>  And finally, we can execute commands on both the vSphere and the Cloud at the same time. <br><br>  In one line, we can move virtual machines to the Cloud: <br><br> <code>PS&gt; Get-VM ‚ÄìLocation AccountingPool | Import-CIVapp ‚ÄìOrgVdc AccountingVdc <br> Name Enabled InMaintenanceMode Owner <br> ---- ------- ----------------- ----- <br> AccountingVM03 True False system <br> AccountingVM04 True False system <br> AccountingVM01 True False system <br> AccountingVM02 True False system <br> AccountingVM05 True False system <br></code> <br>  Like this!  Everything is very simple! <br><br><h4>  Finally, a bit of magic </h4><br>  Using cmdlets, you can interact with the guest operating system.  To do this, it must be installed VMware Tools.  You can upgrade them as follows: <br><br> <code>PS&gt; Get-VMGuest VM | Update-Tools</code> <br> <br>  What does this interaction include?  For example, we want to rewrite a certain file on all our virtual machines (in the case of Windows) to a specific place: <br><br> <code>PS&gt; Get-VM | Copy-VMGuestFile -Source c:\text.txt -Destination c:\temp\ -GuestToLocal -HostUser root -HostPassword pass1 -GuestUser user -GuestPassword pass2</code> <br> <br>  And the most interesting - we execute the script on the guest OS: <br><br> <code>PS&gt;$script = '"%programfiles%\Common Files\Microsoft Shared\MSInfo\msinfo32.e <br> xe" /report "%tmp%\inforeport"' <br> Invoke-VMScript -ScriptText $script -VM MyVM -HostCredential $hostCredential -GuestCredential $guestCredential -ScriptType Bat</code> <br> <br>  The cmdlet allows the execution of bat / bash / powershell scripts. <br><br>  I‚Äôm sure most of you have already felt the full power of this interaction!  With their help, you can create, for example, powerful post-provisioning configurations. <br><br><h4>  Conclusion </h4><br>  So, PowerCLI is a fairly powerful tool for administering the entire Virtual Infrastructure.  You can create complex scripts for all sorts of manipulations on it.  These scenarios can, for example, run periodically or be used to lift the environment.  You can also create scripts for disaster recovery.  The properties and approach of Powershell make it quite easy - a small number of commands to manipulate a large number of objects. <br><br>  Under the above link you can get full instructions on the use of this product.  You can also ask about the problems you are interested in in the community.  It is one of the largest for powershell at all. </div><p>Source: <a href="https://habr.com/ru/post/143753/">https://habr.com/ru/post/143753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143744/index.html">SQL Server 2012 - what's new for the developer?</a></li>
<li><a href="../143745/index.html">Rovio Entertainment launches new toy</a></li>
<li><a href="../143746/index.html">The company NDS presented a working prototype of transparent TV</a></li>
<li><a href="../143747/index.html">Cacti Weathermap: network visualization + interactive</a></li>
<li><a href="../143748/index.html">New chkdsk utility in Windows 8</a></li>
<li><a href="../143754/index.html">Comparative table of SaaS CRM-systems</a></li>
<li><a href="../143755/index.html">Which way of registering / entering the site is preferable for you?</a></li>
<li><a href="../143756/index.html">Arduino in a snack machine</a></li>
<li><a href="../143758/index.html">144 million dollars button</a></li>
<li><a href="../143759/index.html">Competition for display design of the news feed Habr</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>