<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Opening a cloud to new customers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="News in one line: 

 Cloud launched  We reopened the ability to create virtual machines and are ready to accept new users in our cloud in a new pool. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Opening a cloud to new customers</h1><div class="post__text post__text-html js-mediator-article">  News in one line: <br><br><h1>  Cloud launched </h1>  We reopened the ability to create virtual machines and are ready to accept new users in our cloud in a new pool.  Tariffs are the same, more opportunities. <br><img src="https://habrastorage.org/getpro/habr/post_images/54d/e03/0e1/54de030e19d66a0d69ccdcf1dfa75968.png" alt="Selectel Cloud continues to work" align="right"><br>  Key changes: <br><ul><li>  New Cluster Storage </li><li>  Updated LVM virtual machine templates that simplify disk resizing </li><li>  Snapshots </li><li>  Improved control panel performance </li></ul><br><a name="habracut"></a>  Actually, this announcement ends, then the lyrics begin. <br><br>  What have we been doing these 3 months? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Or, more correctly, ‚Äúwhat was wrong?‚Äù. <br><br>  Python is a great language known as an excellent means of rapid development.  Write on it a prototype of a working application, ‚Äúproof of opportunity‚Äù (proof of concept) - yes.  Write on it an application that spends more time in the code of libraries than on math - yes. <br><br>  But here it is possible to write multi-threaded applications on it with tens of thousands of transactions per second with reasonable CPU consumption ... Until a certain point.  Then the architectural problems begin, the struggle with which begins to take more time than the programming of the new. <br><br>  This is exactly the situation we have had.  At the same time, in several components that were ‚Äúwritten and forgotten‚Äù (that is, they were not planned for further development in the near future), the bottlenecks were revealed.  For some time we ‚Äúhad fun‚Äù with code optimization, discussed the possibility of making part of it in sishnye libraries with bindings on python ... So far we have not found that problems are accumulating faster than we solve them.  And this is despite the fact that this autumn we almost doubled the number of developers. <br><br>  An additional problem was created by new users experimenting and playing with functionality (we have nothing against it, but not at that moment when the system is already ‚Äúon the verge‚Äù) - this gave additional stress.  At that moment, when some API requests began to be executed 10 s instead of the set 0.1-0.2 (someone could notice how slowly the control panel contents were displayed at that moment, and the delay was completely unpredictable), it was decided to stop creating new machines. <br><br>  This, firstly, reduced the load from new customers, and secondly, when all the machines are created, users rarely enter the control panel and the number of calls to the control panel has dropped significantly. <br><br>  At a time when the load was stabilized, during the extremely bloody battles, functionalists defeated the processors.  Or, in other words, we looked towards functional programming languages. <br><br>  Namely, the Haskell programming language. <br><br>  Yes, yes, that terrible and terrible language, in articles about which the code ends on page 5-10 and the highest mathematics begins. <br><br>  Personally, I was a desperate opponent of adopting this language.  However, the argument from the supporters convinced me - strict typification, type inference, pattern matching (with control of its completeness) ... <br><br>  Add to this consumer properties: compiled language (read: to run, you only need an executable file without any environment), a long history with long-gone children's diseases (20+ years), a lot of libraries for all occasions (this, by the way, determined ‚ÄúHaskel or okaml ").  Finally, I was struck by the fact that the program on Haskel was going nose-to-nose in a simple test for IO and math with a program in C.  And ‚Äúnose-to-nose‚Äù is when gcc optimization is enabled. <br><br>  Is haskell programming fast?  Not.  According to my observations, the program is written about three times slower than on python.  However, the real difference comes after.  It‚Äôs enough to say that if we rolled out an average of 3 to 10 bugfixes for programs on python, then the programs that we currently work on haskell practically do not contain bugfixes.  Most of the changes are related to a change in the TK, and not a reaction to the next ‚Äúattribute has not method foobar‚Äù in the flow log. <br><br>  We used to write a lot of code on python, now we write a little code on Haskel. <br><br>  Have we copied everything to Haskel?  Alas, no, the process goes on as needs arise and most of our code is still on python, but as the architecture changes, everything else is planned to be rewritten into it. <br><br>  Moreover, as the final chord - our API server is still written on the python - and it was the ‚Äúquick python‚Äù that caused the two-week delay with the launch, as it had to repeatedly and painfully recheck all the behaviors of the new functions that the python (as a language with dynamic typing) ) could not check. <br><br>  ... <br><br>  However, while programmers were sharpening their style, the system administration department did not sit still. <br><br><h1>  Cluster storage </h1><img src="https://habrastorage.org/getpro/habr/post_images/c03/ca6/b1a/c03ca6b1a1b1bcb3197299bd0dd9406d.png" alt="New Selectel SHD" align="right">  One of our shortcomings was the use of non-clustered storage systems.  The data was safe, but there was a chance to stumble on problems with uptime.  Not very big, but it was. <br><br>  The combination of drbd, flashcache and multipath, I hope, solved this problem.  Data is stored on the 10th raid, a complete copy of all data is located on each node of the cluster.  If the node dies - the clients either do not notice anything, or (in the worst case) receive 5-10 seconds with a one-time delay of disk operations, after which the multipath finds an alternative path and requests are further processed without fail. <br><br><h1>  Templates </h1>  The key and fundamental was the transition to the 3.1-xen core (except for the centros, which is on its own mind).  At the same time, reluctantly, we allowed users to load the cores from the machine, and not ‚Äúours‚Äù.  Why reluctantly heart?  Because if the client puts the ‚Äúwrong core‚Äù, then his machine will hang or behave inadequately.  Poor, poor technical support department.  But the convenience of the fact that the kernel is installed inside the virtual machine still outweighed. <br><br>  The second important change was the transition to LVM for system drives.  This should greatly simplify the process of managing partitions. <br><br>  OS were updated: OpenSUSE 12.1, CentOS 5.7, Debian Wheezy appeared.  There was a template with ClearOS (for those who want a web interface to the VPN server).  Some more useful templates in development. <br><br><h1>  Snapshots </h1><img src="https://habrastorage.org/getpro/habr/post_images/2f6/00d/9c7/2f600d9c74b6693a0567d737550c7664.png" alt="Snapshots in the selectle cloud"><br><br>  The most difficult and difficult task that we solved with great success.  About snapshots and the principles of their work, I will write a separate article, but for now the ‚Äúsqueeze‚Äù of snapshots features: <br>  * Snapshots are made "on the go" without stopping the machine <br>  * Snapshots can form both a chronological list and a "tree". <br>  * Snapshots store only changed data (minimum size - 8Mb) <br>  * Snapshots are paid for as disk space (a separate line) at the price of regular disk space <br>  * Disk snapshots can be connected in read only to existing machines without stopping the use of a ‚Äúregular‚Äù disk. <br><br>  In order to do this well and conveniently, we had to greatly rewrite the usual snapshots in the Xen Cloud Platform, in particular, to add support for the tree-like relations between snapshots and the possibility of free kickbacks between any snapshots. <br><br><h1>  Control Panel </h1>  The design of the new control panel we ‚Äúrolled out‚Äù shortly before the suspension of service (stupid, yes, but now everyone can see it).  In addition, we rewrote statistics, significantly reduced the load on the database in some types of queries.  At the same time, on the sly, we added the upload of consumption data to CSV. <br><br>  Much time was given to ergonomics.  For example, such fields as password, IP-address and other data, which are often copied, are made in such a way that a double click selects them and only them, without crawling to the neighbors.  All controls in the regular menus are static (that is, do not jump back and forth and do not change the value depending on the context).  This does not apply to ‚Äúdangerous operations‚Äù, where our main task was not to create maximum comfort, but to make us think ‚Äúwhether I want it or not.‚Äù  By the way, if someone has a clear feeling of ‚Äúdoing too much‚Äù in some case, write to me (or in tickets).  We do not promise a correction, but at least I will think about how to implement it and if we can think of it, we will do it. <br><br><h1>  The fate of the old pool </h1>  Due to architectural changes, we were unable to implement new features in the old pool, they are implemented in the new pool (virtual machines will be created in it). <br><br><ul><li>  <b>Reference:</b> pool (pool) - a group of servers that has a single administrative center (pool wizards) with a single configuration and shared storage.  In the context of our cloud, it means the highest hierarchical unit of cloud segmentation.  Pools do not interact with each other, although they obey a single API server. </li></ul><br>  We will continue to maintain the old pool for a long time (I don‚Äôt promise that ‚Äúalways‚Äù, but for a very long time - for sure), and all new machines will be created in the new pool - this is where snapshots, ‚Äúnative kernels‚Äù will work, and that‚Äôs where the new templates are located . </div><p>Source: <a href="https://habr.com/ru/post/135858/">https://habr.com/ru/post/135858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135851/index.html">XNA: Display text in system fonts</a></li>
<li><a href="../135853/index.html">In China, buyers of goods in online stores will be obliged to indicate real data</a></li>
<li><a href="../135855/index.html">Errrr - Simplest Error Recorder</a></li>
<li><a href="../135856/index.html">Improved Android NDK (Native Development Kit)</a></li>
<li><a href="../135857/index.html">Python, scipy.weave and openMP - overclocking the code</a></li>
<li><a href="../135859/index.html">How future computer programmers taught physics</a></li>
<li><a href="../135861/index.html">Reverse development of a commercial program: keygen for Zuma Deluxe</a></li>
<li><a href="../135862/index.html">Simple Restful implementation for Yii</a></li>
<li><a href="../135863/index.html">How to write an add-on for GIMP in Python</a></li>
<li><a href="../135865/index.html">Coder vs. Developer vs. Engineer - what's your Job Title,% username%?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>