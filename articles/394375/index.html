<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wiren Board 5: flexibility and modularity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 Recently we wrote about ( once and twice ) that we released a new version of the controller for automation - Wiren Board 5. Today we will tel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wiren Board 5: flexibility and modularity</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello! <br>  Recently we wrote about ( <a href="https://geektimes.ru/company/wirenboard/blog/274530/">once</a> and <a href="https://geektimes.ru/company/wirenboard/blog/275012/">twice</a> ) that we released a new version of the controller for automation - Wiren Board 5. Today we will tell in detail, perhaps, about the most important thing in the controller - its expansion modules. </p><br><img src="https://habrastorage.org/files/ae7/908/2bb/ae79082bb5de430391e26b92bb9bcd99.jpg" alt="image" width="50%"><a name="habracut"></a><br><br><h1>  Why it is needed. </h1><br><p>  Our first idea was to make a sufficiently versatile controller for home and commercial automation - with different wired and wireless interfaces, RS-485, inputs for connecting buttons, relays, etc. The advantage of this approach is a very high functionality / price ratio: for little money the user gets a bunch of interfaces. </p><br><p>  The experience of using the first versions of controllers showed that only a few interfaces are usually used. <br>  And if wired interfaces are used, they quickly begin to be missed: for example, if the meters and peripheral devices are connected via RS-485 and have different protocols, then often they are not compatible and they need to be connected to different ports.  If buttons, counters and sensors with ‚Äúdry contact‚Äù outputs are connected, there are a lot of corresponding inputs needed and they are not enough, etc. </p><br><p>  Often customers ask for some very specific functions.  Of course, you can ‚Äúredraw‚Äù the controller to implement the necessary functionality, but launching a new revision of the equipment, even with minor changes, is a big deal, working for 2-3 months: </p><br><ul><li>  Four-layer board - long production time, as a prototype, and a series. </li><li>  Manually boards of such complexity are poorly soldered - the series must be given to automatic installation, and not to manual. </li><li>  For each new version of the board, a new hardware and software is required for testing. </li></ul><br><p>  Because of this, I would very much like to have a controller in the form: </p><br><ul><li>  Basic controller, with basic functionality and a large reserve for expansion </li><li>  A series of simple expansion cards, ‚Äúbrainless‚Äù, with convenient connectivity. </li></ul><br><p>  This scheme has the following advantages: </p><br><ul><li>  Specific functions are easy to add to the controller.  Expansion boards are easily made for the customer.  They are double-layered, easy to design and convenient for manual soldering. </li><li>  New revisions (bug fixes, improved design) for the controller and expansion cards are made separately.  Accelerated development and launch on sale. </li></ul><br><p>  As a result of much thought, the modular design of the WB5 was born. </p><br><p>  The first type of modules is soldered to the microassembly controller board. </p><br><ul><li>  GSM (when installing on an automatic line, we do not install a module on a part of controllers).  It is inconvenient, but no other method was invented. </li><li>  Wi-Fi and 433MHz radio.  Small scarves, soldered on their own capacities before assembling a batch for a customer. </li></ul><br><p>  About other types we will tell more. </p><br><h1>  Mezzanine Modules </h1><br><img src="https://habrastorage.org/files/5bc/be0/c82/5bcbe0c82e3543aca4f94c348cf90fd4.jpg" alt="image" width="40%"><br><p>  These modules are installed on the DIN-rail on the second floor: </p><br><ul><li>  Battery module.  With his development had pretty tricky.  Everything is complicated there, but not interesting. </li><li>  Second Ethernet (coming soon) </li><li>  Display (in plans) </li></ul><br><h1>  Expansion modules. </h1><br><p>  These are small scarves, placed vertically in the controller.  In the Wiren Board 5 controller there are two slots for them, for each slot there are three terminals.  Power, interfaces UART, SPI, I2C, GPIO are brought to the combs.  When assembling, the boards are pressed against the case from above, so they cannot fall out of vibration. </p><br><p><img src="https://habrastorage.org/files/376/1ad/453/3761ad453bcc48f49e5913d93d7d91c9.jpg" alt="image" width="50%"><img src="https://habrastorage.org/files/f8e/a9f/1ab/f8ea9f1ab67141bb87ffb8557d70feec.png" alt="image" width="25%"><img src="https://habrastorage.org/files/eae/ca0/e41/eaeca0e41a8f4f7bbf266c7199d8c1b1.jpg" alt="image" width="25%"></p><br><p>  Already developed: <br>  -RS-232. <br>  -CAN (Isolated) <br>  -RS-485 (Isolated) <br>  - ADC - (coming soon) voltage inputs, 0-20mA inputs, PT100 and PT1000 sensors <br>  -CAP - outputs 0-10V <br>  -3 entrances "dry contact" <br>  -GPS / Glonass <br>  -Additional 1-Wire <br>  - microSD card <br>  -Relay SPDT 6A <br>  Basically, they are simple, there is nothing special to tell about circuitry, so we go further. </p><br><h1>  I / O modules. </h1><br><p>  But about this type is to tell more. <br>  Often there are tasks when you need a large number of I / O channels - connecting pulse meters, controlling contactors, etc. In this case, we connect external, side modules, which are joined to the controller in series up to 8 pieces. </p><br><p>  An I / O module needs additional GPIOs.  The easiest way to do this is using the so-called GPIO extenders for I2C.  We use extenders MCP23008 and MCP23016.  They have three legs for setting the address, so it is possible to have up to 8 devices on the bus.  Addresses are distributed as follows - 000 100 010 001 - sequentially by module. <br>  Addresses are inverted on the input modules, and they get the addresses 111 011 101 110. This allows you to connect up to 8 pieces (4 + 4) and in the future automatically determine their type - input it or output. </p><br><img src="https://habrastorage.org/files/e16/4c5/096/e164c50964e343458e173a533fc8a6aa.jpg" alt="image" width="100%"><br><p>  From left to right are the modules: TTL I / O, ‚Äúdry contacts‚Äù, ‚ÄúHigh side switch‚Äù, ‚ÄúInputs 220V‚Äù, relay block. </p><br><p>  More about each: </p><br><h2>  Relay unit. </h2><br><p>  8 Relays for 10A @ 230V, with protection against arcing of contacts on varistors. </p><br><p>  To reduce consumption and heat, after turning on the relay, you can reduce the current on the control coil by 2 times.  The simplest way is to use the circuit as in Figure 1 - Turn on the relay with two transistors, one with a resistor.  We give a signal - both transistors open - the nominal current flows, through time R1C1 the transistor Q1 closes - the current flows through R2.  By reducing the current by 2 times, we reduce consumption by 2 times. </p><br><img src="https://habrastorage.org/files/233/72e/523/23372e523f8a43ee851e089f2fe2a359.png" alt="image" width="20%"><br><p>  A more reasonable way to control a relay is to use PWM.  Then, reducing the current by 2 times, reduce the consumption by 4 times.  It is good when there is a microcontroller: it has many shima channels, you can control it directly with a transistor.  But what if SHIMA is not?  Need to do it.  Take the 555th timer, or rather its reincarnation MIC1557, and let it generate PWM for us with a duty cycle of 50%.  On the diodes collect the logical element ‚ÄúOR‚Äù.  So when you turn on any of the relays, the timer is turned off and the relay receives a full 5V. </p><br><img src="https://habrastorage.org/files/d07/5c8/ad8/d075c8ad8ed243729fe9206f841fec55.png" alt="image" width="80%"><br><br><h2>  Module ‚ÄúInputs 220V‚Äù </h2><br><p>  Module to determine the presence of voltage in the network.  8 channels. <br>  The simplest solution for monitoring 220 V is an optocoupler with a resistor.  The problem with such a simple solution is that the optocouplers have a large CTR (current transfer coefficient) spread and reliable operation requires at least 1 mA of current, and the input should be from 50V AC - as a result, a lot of heat is generated on the resistor.  And since inputs 8 - then the board will be very hot. <br>  There are different ways to reduce heat.  For example, you can use an optocoupler with a transistor Darlington output (large CTR), and use a capacitor instead of a resistor.  We didn‚Äôt put the capacitor, but used the following trick: if you look at the ‚ÄúCTR vs. input current‚Äù characteristic of the optocouplers, you can see that the curve has a peak at a current of 1-2 ma.  Therefore, if current is supplied with short pulses of 1 ma each, it is possible to ensure a high CTR with a low average input current.  The dinistor and the capacitor form these pulses to us. </p><br><p><img src="https://habrastorage.org/files/b6f/a73/8bb/b6fa738bbfe34b3da4574c16fa208ee1.png" alt="image" width="25%"><img src="https://habrastorage.org/files/efd/fdd/f71/efdfddf71da94b0498b84371119e38ae.png" alt="image" width="70%"><br>  Explanations of the scheme: R4-R6 charge C2, when reaching ~ 35V, the dynistor is triggered, while R3 sets a current of 1-2 ma through the optocoupler.  D1 protects the optocoupler against reverse polarity.  R1 C1 average pulses. </p><br><h1>  Dry contact module </h1><br><p>  For connecting buttons, impulse meters, etc. <br>  The input is triggered by a ground fault. <br>  There is a group galvanic isolation.  Protection against voltage supply up to 30 V. </p><br><h1>  TTL I / O Module </h1><br><p>  This is a GPF with overvoltage protection on a polyfuse and a protective diode.  Levels - 5V TTL. </p><br><h1>  ‚ÄúHigh side switch‚Äù module </h1><br><p>  Designed to control low-voltage load (the output delivers a voltage of 12-45 V, current up to 0.5A). </p><br><p>  Here we decided to move away from the beloved principle of reinventing our bicycle and used a ready-made chip like the smart key <a href="http://www.infineon.com/cms/en/product/power/smart-low-side-and-high-side-switches/high-side-switch/automotive-smart-high-side-switch-profet/BTS4880R/productType.html%3FproductType%3Ddb3a304412fcb7bb011320570d261c41">BTS4880R</a> .  The chip has built-in protection against overvoltage, overheating, short circuit, etc. </p><br><h1>  Conclusion </h1><br><p>  In this article, we talked about the hardware solutions that are used in the expansion and input-output modules for the Wiren Board.  In the next article we will tell about their use, why they are needed and how to use the controller as a whole. </p><br><h1>  PS </h1><br><p>  Our company is expanding, and we are looking to the team for another Linux system programmer - to develop software for our devices.  The tasks are interesting, the conditions are flexible, we write the code immediately to the <a href="https://github.com/contactless/">github</a> .  Details in the <a href="https://moikrug.ru/vacancies/1000024806">job description</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/394375/">https://habr.com/ru/post/394375/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../394361/index.html">Iron based solar panels</a></li>
<li><a href="../394365/index.html">Tesla is preparing a new Roadster</a></li>
<li><a href="../394367/index.html">Online fraud research</a></li>
<li><a href="../394371/index.html">Review Skolkovo Robotics International Conference 2016</a></li>
<li><a href="../394373/index.html">Prospective nano motors can accumulate and use light energy for movement</a></li>
<li><a href="../394377/index.html">Programming is not for everyone</a></li>
<li><a href="../394379/index.html">Microsoft's Nokia Experiment Completed</a></li>
<li><a href="../394381/index.html">Stellaris - a breath of fresh air in the space strategy genre</a></li>
<li><a href="../394383/index.html">Tax privileges for IT companies extended until 2023</a></li>
<li><a href="../394385/index.html">Google Play will appear on Chrome OS this year.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>