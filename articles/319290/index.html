<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The introduction of social services in non-game application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Modern reality is impossible to imagine without social networks and different ratings. In connection with this trend, mobile games and applications ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The introduction of social services in non-game application</h1><div class="post__text post__text-html js-mediator-article">  Modern reality is impossible to imagine without social networks and different ratings.  In connection with this trend, mobile games and applications are actively ‚Äúsocializing‚Äù.  However, while for games such a phenomenon is mundane and regular, adding a functional social network to non-game applications will not seem to everyone an obvious solution.  Nevertheless, our long-standing partners and friends - the company-developer of music applications <a href="http://go.everydaytools.mobi/gzDq6F">Music Paradise</a> - have decided on a similar step.  Today we share their case under the code name "How we did the first social pads." <br><br>  ‚ÄúIn this article we would like to share the experience of creating a social platform for music lovers based on the <a href="http://go.everydaytools.mobi/MJ4O5e">DJ Mix Pads 2</a> music application. <br><br>  Initially, the application was a simple set of tools with which music lovers could record tracks, even without special skills and knowledge.  Just a few clicks could get a complete composition with a sound close to professional. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/caa/4d3/ecc/caa4d3ecc8794de39bc1f2e4fa1e7db5.jpg"><br><br>  In order to stand out from a variety of similar products, we decided to play on the competitive element and make the process of creating compositions more focused.  It will be more interesting to open a musician in yourself if you give people the opportunity to share their creations with other users, evaluate others, break into the tops, unite in groups of musical interests and discover new application features, raising your rating. <br><br>  In this article, we will touch on various aspects of working with the server, describe some additional functions that were required for the introduction of the social component, and how they were implemented in the product. <br><a name="habracut"></a><br><h3>  Client-server interaction </h3><br>  Work with server API is carried out through POST and GET requests.  Here I would like to consider in detail the tricks to which we resorted to adjust the work with them. <br><br>  There is no particular point in telling about the formation of HTTP requests: Google is already so full of relevant information, and you can find many useful libraries on the githaba. <br><br>  Therefore, we will analyze better the work with the response from the server using the example of how to get a list of tracks that are popular with users.  The track list comes in this format: <br><br><pre><code class="objectivec hljs">{ data = (); success = <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br>  Or in this, if the request is incorrect or some error has occurred: <br><br><pre> <code class="objectivec hljs">{ error = <span class="hljs-string"><span class="hljs-string">"Error description"</span></span>; success = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  To parse the answer, we use this construction: <br><br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *answer = [<span class="hljs-built_in"><span class="hljs-built_in">NSJSONSerialization</span></span> JSONObjectWithData:data options:<span class="hljs-built_in"><span class="hljs-built_in">NSJSONReadingMutableLeaves</span></span> error:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>];<span class="hljs-comment"><span class="hljs-comment">// data -     if([[answer objectForKey:@"success"] boolValue]){ NSMutableArray *dataArray = [answer objectForKey:@"data"]; [self doSomeStuff:dataArray]; } else{ if([answer objectForKey:@"error"]) NSLog(@"%@",[answer objectForKey:@"error"]); }</span></span></code> </pre> <br><h3>  Image Transfer </h3><br>  When registering in the application, the user has the opportunity to put himself an avatar.  Accordingly, the question arose of how the images will be transmitted to and from the server. <br><br>  The mechanism of circulation of images, we have chosen a very peculiar.  The simplest solution would be to transfer the files themselves as a POST request, after which, if necessary, obtain a link to the file on the server side.  In this way, we have implemented the storage of audio files that users upload to the server. <br><br>  However, it was decided to transfer the image as a base64 string.  To do this on the client side, the following string conversion methods are used. <br><br>  First, we convert the image into a string, changing its size at the same time, if necessary.  It is worth mentioning that the images by this point are already square: <br><br><pre> <code class="objectivec hljs">-(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)imageToNSString:(<span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> *)image { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!image) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(image.size.width&gt;<span class="hljs-number"><span class="hljs-number">250</span></span>&amp;image.size.height&gt;<span class="hljs-number"><span class="hljs-number">250</span></span>) image = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> imageWithImage:image scaledToSize:<span class="hljs-built_in"><span class="hljs-built_in">CGSizeMake</span></span>(<span class="hljs-number"><span class="hljs-number">250</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>)]; <span class="hljs-built_in"><span class="hljs-built_in">NSData</span></span> *imageData = <span class="hljs-built_in"><span class="hljs-built_in">UIImagePNGRepresentation</span></span>(image); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [imageData base64EncodedStringWithOptions:<span class="hljs-built_in"><span class="hljs-built_in">NSDataBase64Encoding64CharacterLineLength</span></span>]; } - (<span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> *)imageWithImage:(<span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> *)image scaledToSize:(<span class="hljs-built_in"><span class="hljs-built_in">CGSize</span></span>)newSize { <span class="hljs-built_in"><span class="hljs-built_in">UIGraphicsBeginImageContext</span></span>(newSize); [image drawInRect:<span class="hljs-built_in"><span class="hljs-built_in">CGRectMake</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, newSize.width, newSize.height)]; <span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> *newImage = <span class="hljs-built_in"><span class="hljs-built_in">UIGraphicsGetImageFromCurrentImageContext</span></span>(); <span class="hljs-built_in"><span class="hljs-built_in">UIGraphicsEndImageContext</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newImage; }</code> </pre> <br>  Now convert the string to a picture: <br><br><pre> <code class="objectivec hljs">-(<span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> *)stringToUIImage:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)string { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(string==<span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">NSData</span></span> *data = [[<span class="hljs-built_in"><span class="hljs-built_in">NSData</span></span> alloc]initWithBase64EncodedString:string options:<span class="hljs-built_in"><span class="hljs-built_in">NSDataBase64DecodingIgnoreUnknownCharacters</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> imageWithData:data]; }</code> </pre> <br>  At first glance, this approach may not seem the most effective, because you have to do double work, converting the image back and forth.  However, for us such an insignificant complication was justified: in the end, it made life much easier for us and accelerated the development process. <br><br><h3>  A little about pagination </h3><br>  This problem came before us unexpectedly and somewhat later than the others, when our social innovations had already begun to gain popularity.  People began to download a fairly large number of tracks per day, an array of audio files on the server grew inexorably - all this caused problems in getting lists of tops.  When you try to process the entire list at once, the application hangs and gives errors.  It became clear that we would have to switch to partial uploading of content, and therefore, to introduce pagination. <br><br><img src="https://habrastorage.org/files/35a/cb2/376/35acb23769614c15afd419c7a5bf5560.gif"><br><br>  Lists were standardly created using UITableView, and it was necessary to develop a method for loading new cells as data was received from the server. <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)tableView:(<span class="hljs-built_in"><span class="hljs-built_in">UITableView</span></span> *)tableView willDisplayCell:(<span class="hljs-built_in"><span class="hljs-built_in">UITableViewCell</span></span> *)cell forRowAtIndexPath:(<span class="hljs-built_in"><span class="hljs-built_in">NSIndexPath</span></span> *)indexPath{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(indexPath.row == <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.tableContentArray.count<span class="hljs-number"><span class="hljs-number">-1</span></span> &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.isFullContent) { [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> getContentFrom:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.tableContentArray.count withCount:<span class="hljs-number"><span class="hljs-number">10</span></span>]; } }</code> </pre> <br>  First of all, we check: <br><br>  - whether the given cell is the last one that we can display; <br>  - whether we got all the content that should be displayed on this controller. <br><br>  The calculation is as follows: if we received a smaller number of records than requested, (in this case less than 10), then at this moment we mark the variable isFullContent as true. <br><br><h3>  Notifications inside the application </h3><br>  We wanted the user to have access to full information about the status of his account (the number of likes, listens, etc.) within the application.  For this, a local notification system was introduced.  The principle of its operation is as follows: when a user enters the application, we save the current state: <br><br><pre> <code class="objectivec hljs">[[<span class="hljs-built_in"><span class="hljs-built_in">NSUserDefaults</span></span> standardUserDefaults] setInteger:user.countOfLikes forKey:<span class="hljs-string"><span class="hljs-string">@"countOfLikes"</span></span>]; [[<span class="hljs-built_in"><span class="hljs-built_in">NSUserDefaults</span></span> standardUserDefaults] setInteger:user.countOfLikes integerValue] forKey:<span class="hljs-string"><span class="hljs-string">@"countOfListens"</span></span>]; [[<span class="hljs-built_in"><span class="hljs-built_in">NSUserDefaults</span></span> standardUserDefaults] setInteger:user.level forKey:<span class="hljs-string"><span class="hljs-string">@"countOfLevels"</span></span>];</code> </pre> <br>  At the next input, these values ‚Äã‚Äãare compared with the data received from the server.  If they do not match, we display a local notification, informing the user that he has progress.  Such pleasant news positively influences user experience: <br><br><pre> <code class="objectivec hljs">CongratsCustomPush *push = [[CongratsCustomPush alloc] initInController:[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> topViewController] withTitle:<span class="hljs-string"><span class="hljs-string">@"Changes since your last visit.\nGood job!"</span></span> withLevel:countOfLevels withLikes:countOfLikes andWithListens:countOfListens]; [push showAnimated:<span class="hljs-literal"><span class="hljs-literal">YES</span></span>];</code> </pre> <br><img src="https://habrastorage.org/files/e51/fc3/edf/e51fc3edf2ef4ba993aee4e0025de835.gif"><br><br><h3>  Progress </h3><br>  Achievements are not only interesting content and user reward for using all the features of the application, but also a good way to learn more about the desires of the audience, in addition to the data provided by the analyst. <br><br><img src="https://habrastorage.org/files/d07/db3/741/d07db374112e43719bae1ada141028a9.PNG"><br><br>  At the moment there are 9 achievements in the app: <br><br><ul><li>  Create a studio </li><li>  Take a mini-lesson on effects </li><li>  Get 5 plays of your tracks </li><li>  Post 3 tracks </li><li>  Publish the first track in the studio </li><li>  Record your first track </li><li>  Spend 30 minutes in the app. </li><li>  Complete a mini studio creation lesson </li><li>  Complete the initial tutorial </li></ul><br>  Making money is the client's business, the server only stores information about the achievements made and some statistics (for example, how much time the user spent in the application) <br><br>  When sending alerts on achievements, a system of remote PUSH notifications for specific users is used.  To identify the user, we save the UUID of the device from which the last login was made, and when we receive a PUSH notification, we go one of two ways, depending on the circumstances. <br><br>  If the user is not currently in the application, he will receive a standard alert with information on the achievement achieved - this is the first way. <br><br>  The second way is more complicated.  If the user is currently in the application, we intercept the received message in the AppDelegate method: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)application:(<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> *)application didReceiveRemoteNotification:(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *)userInfo</code> </pre> <br><br>  and display it in the current ViewController. <br><br><h3>  Conclusion </h3><br>  Summarize what additional features in the end gave us the use of the server: <br><br><ul><li>  Registration of users and saving data from their profiles (mail or Facebook page, name, avatar). </li><li>  Remote storage of tracks on the server. </li><li>  Providing tracks to the general court. </li><li>  Ability to mark other people's tracks as you like and save them to your own collection. </li><li>  ‚ÄúStudios‚Äù - groups of users according to their preferences in musical genres.  Joining the studio gives access to new samples, sounds. </li><li>  Tops by tracks, users, studios </li><li>  Sending push notifications to specific users by achievements </li><li>  Getting achivok </li><li>  Loading of a part of content (sounds, samples) from the server.  This gave us the opportunity to shrink the application to a size less than 100MB.  This is important: according to the rules of the market, applications over 100MB in weight can not be downloaded via mobile networks, only via wi-fi. </li><li>  Collection of detailed, point statistics on users, publications, preferences.  The number of published tracks, the most popular genres, the activity of individual users, the frequency of receiving achievements - all this gave material for a more objective assessment of the results of our works.  And also, let's say in secret, the ability to remotely reward the most active users. ‚Äù </li></ul><br>  <b>PS The</b> guys also told us that they noticed a funny trend: the leading developers of this project are getting married about 2-3 months after they start working on it.  At the moment, the score is 2: 0 in favor of this "belief."  So, if you want fundamental changes in your personal life, try to implement a similar project in your application. </div><p>Source: <a href="https://habr.com/ru/post/319290/">https://habr.com/ru/post/319290/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319280/index.html">Layout online store: list of goods</a></li>
<li><a href="../319282/index.html">Tail recursion optimization in Java</a></li>
<li><a href="../319284/index.html">How to attract a million users to the Bitcoin marketplace</a></li>
<li><a href="../319286/index.html">Virtualization with Ubuntu Server 16.04 and pHpVirtualBox 5.0.5</a></li>
<li><a href="../319288/index.html">Machine learning is easy</a></li>
<li><a href="../319294/index.html">Why did Tesla lure away the Swift language creator from Apple</a></li>
<li><a href="../319296/index.html">The structure of the project folder designer</a></li>
<li><a href="../319298/index.html">Draw commits on Github</a></li>
<li><a href="../319300/index.html">Economy of ideas. Composable infrastructure. HPE Synergy</a></li>
<li><a href="../319302/index.html">FPS and let your code wait</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>