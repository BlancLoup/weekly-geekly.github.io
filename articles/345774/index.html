<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Code Coverage - I want to believe</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The developer must know his tools! Knowledge of tools increases productivity, efficiency, productivity , the potency of the developer! I can not progr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Code Coverage - I want to believe</h1><div class="post__text post__text-html js-mediator-article">  The developer must know his tools!  Knowledge of tools increases productivity, efficiency, productivity <s>, the potency of the</s> developer!  I can not program without R #! <br><br>  Such phrases can be heard from completely different people: fanatics of development, vendors of various utilities, users of convenient tools.  My manager also hears them when I want to experiment with something new. <br><br>  However, the instruction to the tool usually does not contain the section "Contraindications", does not indicate the situation when you should NOT use the utility.  Meanwhile, a similar section could save tons of time for unsuccessful experiments. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Today, I rush stones to Code Coverage (CC).  Quite a useful metric, under which are several poorly <a href="http://www.exampler.com/testing-com/writings/coverage.pdf">documented</a> rakes. <br><a name="habracut"></a><br>  <i>"There is a lie, there is a blatant lie</i> <i><br></i>  <i>there are statistics. "</i> <br>  The creators of SonarQube understand this perfectly well, it‚Äôs not for nothing that SonarQube <a href="https://docs.sonarqube.org/display/SONAR/Metric%2Bdefinitions">has a dozen CC metrics</a> .  I will interrupt statistics using CC from DevExpress, there is only one metric. <br><br>  <b>Problem 1. Typical test wrong.</b>  Test the method with a bunch of argument checks: <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Hash </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example1_IfThen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> arg</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(arg == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"0 argument"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg == <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"1 argument"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg == <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"2 argument"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hash(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hash(arg + <span class="hljs-number"><span class="hljs-number">42</span></span>) + <span class="hljs-number"><span class="hljs-number">13</span></span>); } ... [TestMethod, ExpectedException(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ArgumentException))] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example1_IfThen_0</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Program.Example1_IfThen(<span class="hljs-number"><span class="hljs-number">0</span></span>); } [TestMethod, ExpectedException(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ArgumentException))] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example1_IfThen_2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Program.Example1_IfThen(<span class="hljs-number"><span class="hljs-number">2</span></span>); } [TestMethod, ExpectedException(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ArgumentException))] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example1_IfThen_1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Program.Example1_IfThen(<span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br>  The method is covered with tests for 83%, which is usually <i>enough for an auto-build</i> .  Technically, there is nothing to argue about, most of the code is covered with tests, but the main scenario is not affected by tests.  Tests covered the simplest part of the code, not the most important. <br><br>  <b>Problem 2. We measure the actual code, instead of the necessary.</b> <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example2_IncompleteLogic</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; arg</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> arg .Where(elem =&gt; elem != <span class="hljs-number"><span class="hljs-number">2</span></span>) .Where(elem =&gt; elem != <span class="hljs-number"><span class="hljs-number">3</span></span>) .Count(); } ... [TestMethod] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OneTestToCoverAll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Arrange - collection with one element '4' var arg = new List&lt;int&gt; { 4 }; // Act var result = Program.Example2_IncompleteLogic(arg); // Assert Assert.AreEqual(1, result); }</span></span></code> </pre><br>  The test method does not contain a check for a null argument, but the coverage is 100%.  Sometimes people forget: Code Coverage is a code coverage metric, not a requirement closure metric;  if the method lacks logic (the method is not complicated enough to solve its problem) - CC will not show it. <br><br>  <i>100% coverage does not guarantee the performance of the program</i> .  Bringing to the point of absurdity: the empty method is elementarily covered at 100%.  The nonempty method is covered by 100% tests without Assertions. <br><br>  <b>Problem 3. Optimism.</b>  A slightly different manifestation of the previous problem.  As you can see, one test covers 100% of the code.  Let's try to rewrite our method, getting rid of LINQ (to improve performance). <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elem <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> arg) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(elem == <span class="hljs-number"><span class="hljs-number">2</span></span> || elem == <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { result++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result;</code> </pre> <br>  We get only 73% coverage.  The functionality has not changed, the metric has fallen.  Not only that 100% coverage does not guarantee the performance of the program, these <i>100% can be fake</i> .  Conclusion: <s>LINQ - g ** but the</s> results of the CC may be too high, try to check the coverage in the editor. <br><br>  A side observation: in this case, we can simply have a joint in the technical implementation; in theory, the anonymous method <i>elem =&gt; elem! = 2</i> can be replaced by <i>elem =&gt; if (elem! = 2) return true else return false;</i>  That will fix the coverage of the original method to 73%.  True, such an approach would require complicating the now convenient UI. <br><br>  Corollary: The tool used may not have all the desired functionality.  A trivial thing, no less from that true. <br><br>  <b>Problem 4. Transfer of responsibility.</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MakeEverythingWell</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { OuterLib.MakeEverythingWell(); }</code> </pre> <br>  The method is 100% covered with one test.  At the same time, the OuterLib coverage of the library lies on the conscience of the person who added it.  Or updated.  About three years ago, before the introduction of CC.  Before firing. <br>  It is necessary to state the fact again: <i>not only that 100% of the coverage does not guarantee the operation of the program, these 100% can be fake</i> . <br><br><h3>  In addition to purely code points, there are several complaints about the processing of CC results. </h3><br>  <b>Claim 0, known to all.</b>  <b>100% coverage.</b>  No 100% coverage - no build approval.  The problem is that it is relatively easy to get the first percentages of coverage, but the last ones ... Especially when part of the code is generated.  Or unattainable (since it was created for Vasya, who will use it in two days).  Or just theoretically achievable, and an example to select / calculate a couple of weeks (this happens when working with mathematics).  In short, most teams (of those who generally integrate CC into CI) stop at 60/70/80 percent of the required coverage. <br><br>  <b>Claim 1, controversial.</b>  <b>Covering dead code.</b>  In my memory, a similar problem was most clearly manifested during the <a href="https://habrahabr.ru/company/pvs-studio/blog/244097/">test by</a> <a href="https://habrahabr.ru/company/pvs-studio/blog/244415/">Mirand's</a> colleagues from PVS.  The comments are quite emotional, but some of the controversies concerned the dead code: some of the diagnostics found pointed to (abandoned) plugins, but not to the <a href="https://habrahabr.ru/company/pvs-studio/blog/244097/">core</a> . <br><br>  The question arises: <b>Is CodeCoverage needed for a dead code</b> ?  On the one hand, the dead code is a problem, and drawing attention to it is welcome.  On the other hand, the dead code does not affect production, so is it worth allowing it to influence the CC metric? <br><br>  <b>Claim 2. The importance of the code.</b>  Expansion of the problem 1. In my project there are two remarkable controllers: ‚Äúpayment‚Äù and ‚Äúnegotiation‚Äù.  "Payment" is critical for the client, and I fully agree with the requirement of "80% coverage", "negotiation" is used by 1.5 anonymus.  In year.  And it has not changed for two years.  Question: why write tests to half-dead functionality?  Just to get 80% badge <i>auto approval</i> ? <br><br>  <b>Claim 3, impossible.</b>  <b>Metric as achivka.</b>  This is when no one checks what is covered.  Remember the bikes about paying for the lines of the code?  I have heard about people who created unnecessary code for better coverage. <br><br>  <b>Claim 4. Metrics "for free."</b>  When management throws off the requirement to ‚Äúcover the code by 80%,‚Äù and the developers meekly agree.  The project at the same time - disposable.  Or a prototype.  Or deadline on the nose.  Or there is a hefty <s>pasta</s> legacy monster without a single test. <br><br>  <b>Code coverage tests takes time!</b>  If the coverage is also measured - time for tests may increase (although it may fall).  So if the team did not have time to deliver the project on time, but it reached 80% of the coverage - the fault can be shared between management and developers.  The question of the line of division of guilt should not be raised, for holivar. <br><br>  <b>At the end.</b>  I note once again: SS is a useful metric, albeit with surprises.  It really helps with the control of the code, if there is no blind desire for numbers in the reports. </div><p>Source: <a href="https://habr.com/ru/post/345774/">https://habr.com/ru/post/345774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345764/index.html">Blockchain and everything related to it legalized in Belarus</a></li>
<li><a href="../345766/index.html">Memory segmentation (Computer memory scheme)</a></li>
<li><a href="../345768/index.html">Introducing AVAudioEngine for working with sound on iOS</a></li>
<li><a href="../345770/index.html">Annual Report Habrapost - 2017</a></li>
<li><a href="../345772/index.html">Epic files in online chat rooms, or why sales do not grow</a></li>
<li><a href="../345776/index.html">Keyboard Response Comparison</a></li>
<li><a href="../345778/index.html">Pygest # 21. Releases, articles, interesting projects, packages and libraries from the world of Python [January 1, 2018 - January 17, 2018]</a></li>
<li><a href="../345780/index.html">Kubernetes success stories in production. Part 6: BlaBlaCar</a></li>
<li><a href="../345784/index.html">Overview of rounding implementations in Go</a></li>
<li><a href="../345786/index.html">Blog RuVDS. Digest of posts and our results of the year</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>