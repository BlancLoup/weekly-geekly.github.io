<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Blackhole + CVE-2012-0507 = Carberp</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This week, the famous Blackhole exploit kit has been updated to version 1.2.3, and a new exploit for Java has been introduced to the vulnerability CVE...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Blackhole + CVE-2012-0507 = Carberp</h1><div class="post__text post__text-html js-mediator-article">  This week, the famous Blackhole exploit kit has been <a href="http://xylibox.blogspot.com/2012/03/blackhole-v123.html">updated</a> to version 1.2.3, and a new exploit for Java has been introduced to the vulnerability <a href="http://weblog.ikvm.net/PermaLink.aspx%3Fguid%3Dcd48169a-9405-4f63-9087-798c4a1866d3">CVE-2012-0507</a> ( <a href="http://www.eset.eu/encyclopaedia/java-exploit-cve-2012-0507-a-c-cve2012%3Flng%3Den">Java / Exploit.CVE-2012-0507</a> ).  The first to draw public attention to the relevance of this vulnerability was Microsoft, which published a <a href="http://blogs.technet.com/b/mmpc/archive/2012/03/20/an-interesting-case-of-jre-sandbox-breach-cve-2012-0507.aspx">message</a> in its blog about an interesting way of executing Java code outside of the JRE (Java Runtime Environment) sandbox. <br><br>  The first mention of a combat exploit for this vulnerability came from the company Immunity, which <a href="https://www.immunityinc.com/ceu-index.shtml">released a</a> special module for its product Immunity CANVAS in early March 7/03/2012.  This vulnerability was closed on February 15 as part of a critical <a href="http://www.oracle.com/technetwork/topics/security/javacpufeb2012-366318.html">update</a> from Oracle.  Just late yesterday, at the time of this publication, a public <a href="https://community.rapid7.com/community/metasploit/blog/2012/03/29/cve-2012-0507--java-strikes-again">exploit</a> appeared for the CVE-2012-0507 as part of the Metasploit Framework.  Separately, it is worth noting its cross-platform and the possibility of operation on Windows, Linux, Solaris and OSX systems (Apple's security update <a href="http://support.apple.com/kb/HT5228">appeared</a> yesterday).  The latter is particularly interesting in light of the increase in the number of <a href="http://blog.eset.com/2012/03/28/osxlamadai-a-the-mac-payload">malicious programs</a> for it, spreading also through the exploitation of Java vulnerabilities.  The exploit from Metasploit Framework looks very similar to the one that was found in the updated Blackhole and it seems that it was ripped mostly from there ... <br><br>  Recently, I often wrote about exploits for Java and they are really the last year to be the most disruptive in mass distribution of malware incidents.  The developers of exploit kits, such as Blackhole, use only the so-called 1-day vulnerabilities, i.e.  already containing the official fix from the developers.  Because the use of 0-day is too expensive for their purposes and does not pay for itself at all, but there are exceptions when 0-day hits public with PoC.  The use of the zero-day vulnerability at the moment can most often be seen in targeted attacks.  By the way, a rather entertaining post about the prices for 0-day and the resets' karma can be read <a href="http://asintsov.blogspot.com/2012/03/0day.html">here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's return to our exploit, this week again the spread of <a href="http://www.eset.eu/encyclopaedia/win32-trojandownloader-carberp-ah-backdoor-bredolab-xuf-trojan%3Flng%3Den">Win32 / TrojanDownloader.Carberp</a> through popular web resources was noticed, through the introduction of iFrame constructs for redirection to a resource with a set of exploits. <br><br>  First we came across the resource lifenews.ru, which contained the following iFrame: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/080/c92/59e/080c9259e4f8ac181ce6ebcc1c7bfcd0.png" alt="image"><br><br>  As can be seen from the embedded code, the attack was immediately CVE-2012-0507, and the domain name on which Blackhole was located is very similar to the name of the attacked web resource.  The result of executing code in iFrame can even be seen visually on a modified original page. <br><br><a name="habracut"></a><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b9c/0d0/d03/b9c0d0d03578a0e0f569c29dad9b4757.png" alt="image"><br><br>  After that, the old, but not good, page of waiting is displayed and it is at this moment that the active stage of operation takes place. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bfb/03e/537/bfb03e53743613954a05be2bbef4bf8e.png" alt="image"><br><br>  A similar attack was seen on the web resource izvestia.ru and a modification from the Win32 / TrojanDownloader.Carberp family was also installed.  In general, the first Java / Exploit.CVE-2012-0507 operating detections were seen closer to mid-March. <br><br>  The full event log when you visit the modified page of the livenews.ru web resource looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91d/73a/26a/91d73a26a9c57722155fe05a01373cf6.png" alt="image"><br><br>  In both cases, the infection occurred when visiting the URL of the form: <br><br>  hxxp: //izvestia.ru/banners/index.php? p = 55 <br><br>  hxxp: //lifenews.ru/banners/index.php? p = 2 <br><br>  This suggests an idea of ‚Äã‚Äãinfection through the banner network used on both resources.  The address at which the redirection occurred also looked the same in both cases. <br><br>  By the way, the reader may have a logical question, but what about the recent press noise about the detention of a group of cybercriminals spreading Win32 / TrojanDownloader.Carberp and earning fraud in RBS systems.  Everything was rightly arrested eight people who were different parts of the criminal network and were only one group that worked with Carberp.  But after all, others remained at large and naturally a miracle did not happen and they didn‚Äôt roll their activities. <br><br>  But let's still return to the exploit on the vulnerability CVE-2012-0507, it is he who represents the greatest interest of all this attack (Carberp was previously known to us modifications and only repacked to bypass detection).  The vulnerability is hidden in the implementation of the class AtomicReferenceArray, in which there is an incorrect check for belonging to the type Object [].  This vulnerability belongs to the so-called ‚ÄúType Confusion Vulnerabilities‚Äù class, before such vulnerabilities were encountered at the bytecode verifier level, but now they are already closed and the conflict is directly in the Java API.  All this allows you to perform a specially prepared applet or class outside the sandbox JRE. <br><br>  The object structure in Java / Exploit.CVE-2012-0507 is as follows: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/396/efd/822/396efd82287618ffbfea5bd03ca056f2.png" alt="image"><br><br>  The init () method of the Ner class creates an object of type AtomicReferenceArray to execute code outside the sandbox. <br><br><img src="http://rghost.ru/37400453/image.png" alt="image"><br><br>  In the next step, the doWork () method from the Hal class is executed; it is through this method that the class code is created, which later will be executed outside the sandbox. <br><br><img src="http://rghost.ru/37400493/image.png" alt="image"><br><br>  The class code that should be executed outside the sandbox is encrypted with a simple permutable encryption algorithm and decrypted before execution, which eventually results in DownloadAndExec, which already outside the isolated environment downloads the Carberp Trojan in the% TEMP% \ vdsh89 directory \ gyu &lt;file_number&gt; and executes it. <br><br><img src="http://rghost.ru/37400521/image.png" alt="image"><br><br>  To counteract the detection of antivirus products, the code encryption algorithm is constantly changing, which downloads the payload and obfuscation of string constants. <br><br>  I think this year we will return again and again to the topic of exploiting vulnerabilities for the Java platform and this is not the last vulnerability for it. <br><br>  study author: <a href="http://habrahabr.ru/users/matrosov/" class="user_link">matrosov</a> </div><p>Source: <a href="https://habr.com/ru/post/141365/">https://habr.com/ru/post/141365/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141357/index.html">In the assembly of Opera Labs (Mobile) appeared support extensions</a></li>
<li><a href="../141358/index.html">How UniSender works: instructions for use</a></li>
<li><a href="../141362/index.html">Unity3d Lessons from Unity 3D Student (B00-B03)</a></li>
<li><a href="../141363/index.html">Building a data center, part 3: serve chilled</a></li>
<li><a href="../141364/index.html">Google CodeF in Russia!</a></li>
<li><a href="../141366/index.html">Electronic Accountant # 15: Pocket Promoter</a></li>
<li><a href="../141368/index.html">Robot transformer Bioloid</a></li>
<li><a href="../141369/index.html">How to send SMS</a></li>
<li><a href="../141371/index.html">Beyond the edge of Habr (list of publications)</a></li>
<li><a href="../141373/index.html">Map Affairs - GIS service placement and search of personal orders</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>