<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Emulate network problems with WANem</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, one of the customers of TestLab¬≤ wanted to know how its installer will work (with downloading on the fly) on different channels. Suddenly, t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Emulate network problems with WANem</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/035/475/0e4/0354750e46f4ecef5620760c2250d8cf.jpg" alt="Picture to attract attention" align="left">  Recently, one of the customers of <a href="http://www.testlab2.com/">TestLab¬≤</a> wanted to know how its installer will work (with downloading on the fly) on different channels.  Suddenly, the first approaches showed that the usual edge, umts and wimax channels (not to mention the wired ones) in our district are lucky enough to work very well. <br>  To create difficult conditions, we found and applied a specialized tool <a href="http://wanem.sourceforge.net/">WANem</a> , which I will discuss under the cut. <br><a name="habracut"></a><br><h5>  What is WANem? </h5><br>  This is a knoppix-based distribution kit that allows you to emulate various client network connection conditions.  First of all, it is useful for testing and debugging applications that will work in un-understandable conditions without physical immersion in these very conditions. <br>  Rules for work can be created both manually and through a more or less convenient web-interface. <br><br><h5>  How to apply WANem? </h5><br>  Take any virtualization system and load the LiveCD in it.  Or, if you are using VMWare solutions, download a ready-made virtual machine.  In the future, I will proceed from the download from the LiveCD. <br><br><h5>  WANem preparation </h5><br><ol><li>  Create a new virtual machine (1core / 256ram will be quite enough), indicate the source of the LiveCD download </li><li>  We confirm download from livecd </li><li>  Confirm the configuration of all network interfaces via DHCP (or refuse, and later specify the IP manually) </li><li>  The startup script creates a perc user and asks which password to set for it (ssh is allowed by default) </li><li>  By specifying the password, we can connect to SSH </li><li>  We get to the WANem command line interface.  Let's start with a simple help command, which will list all available commands with a brief description. <br><ul><li>  <strong>help</strong> - <strong>help</strong> output </li><li>  <strong>about</strong> - display version and copyright </li><li>  <strong>clear</strong> - clear the screen </li><li>  <strong>reset</strong> - reset network settings and restart services </li><li>  <strong>shutdown</strong> - shutting down the system </li><li>  <strong>restart</strong> - system restart </li><li>  <strong>status</strong> - show current system status (IP addresses, routes, service states) </li><li>  <strong>wanemreset</strong> - resetting the rules of WANem itself (if you‚Äôve been wise to the evil and access to the web-interface does not work) </li><li>  <strong>assign</strong> - specify the IP address manually (if you previously refused DHCP) </li><li>  <strong>quit</strong> - exit the WANem console </li></ul></li></ol><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f0f/682/b8a/f0f682b8ad080f2f6cc441b045da9cfc.png" alt="basic setting wanem 3" align="left"></a>  Open in the browser http: // <i>IP of</i> virtual / WANem / and see the interface to manage.  From the menu are available: <br><ul><li>  <strong>WANalyzer</strong> is a simple tool for checking parameters and properties of a connection, which gives <a href="">these results</a> </li><li>  <strong>Basic Mode</strong> is a simple emulation settings mode that allows you to limit bandwidth and add packet processing delay in milliseconds. </li><li>  <strong>Advanced Mode</strong> is an advanced mode of emulation settings that allows you to specify not only more detailed settings, but also their temporal distribution, which brings the emulation one step closer to reality. </li><li>  <strong>Save / Restore</strong> - saves current settings to a local profile file for reuse ( <a href="http://pastie.org/private/ameegjw1mnuedaqap39m7w">sample format</a> ) </li></ul><br><h5>  Health check </h5><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f60/1b6/2e8/f601b62e80c998e20fd400281ec7cfeb.png" alt="basic setting wanem 3" align="left"></a>  Inside itself, WANem operates with rules that can be set explicitly in Advanced Mode, or simply selected from those available in Basic Mode.  The easiest application scenario is to turn on the mode, say ISDN 128 Kbps and a delay of 500 milliseconds.  After saving these settings, you need to command the machine on which the test application is installed to route all of your traffic through WANem. <br><ul><li>  <strong>Windows</strong> : route add 0.0.0.0 mask 0.0.0.0 <i>WANemIPaddress</i> </li><li>  <strong>Debian</strong> : route add default gw <i>WANemIPaddress</i> eth0 </li><li>  <strong>Any other OS</strong> : <a href="http://tinyurl.com/4yovdph">http://tinyurl.com/4yovdph</a> </li></ul><br>  After this simple action, it is enough to make a traceroute from the test machine to the outside world and make sure that the first hop is the <i>IP of the virtual machine with WANem</i> and that the packet delay ¬± coincides with the one specified in the settings. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Fine tuning </h5><br> <a href=""><img src="http://i.imgur.com/eYSy6.png" alt="Fine tuning wanem 4" align="left"></a>  Making sure with the help of Basic Mode that our test station wraps all network traffic through the emulator, you can proceed to more fine-tuning.  First of all, you should pay attention to the extensive settings of the random distribution of delays, errors and <s>packet</s> loss packets.  Another small step to the realism of emulation. <br>  I will decipher the most incomprehensible options in advance: <br><ul><li>  MTTF - average time to error </li><li>  MTTR is the average time to error recovery </li><li>  Jitter - in the context of IP networks, the term is described in detail in <a href="http://tools.ietf.org/html/rfc3393">RFC 3393</a> , and in brief it is the difference (in milliseconds) between the delay in delivering a pair of packets </li></ul><br>  For example, you can set the parameters of loss and restoration of communication, you can emulate the presence of a connection but the absence of data packets, the loss or damage of% of packets. <br>  If necessary, WANem can work with several network interfaces at the same time (creating different rules for them), which allows to implement the most sophisticated network configuration. <br><br><h5>  WANem Alternatives </h5><br>  I know a paid product for Windows called <a href="http://www.softperfect.com/products/connectionemulator/">SoftPerfect Connection Emulator</a> ($ 99 / $ 149). <br>  <b>UPD</b> : For OS X, <a href="http://habrahabr.ru/users/goshakkk_reborn/" class="user_link">goshakkk_reborn</a> recommends Network Link Conditioner from Xcode. <br>  <b>UPD</b> : For Windows <a href="http://habrahabr.ru/users/x1shn1k/" class="user_link">x1shn1k</a> also prompted <a href="http://tmurgent.com/Tools.aspx">TMnetSim Network Simulator</a> (freeware, there are versions √ó 32 and √ó 64) <br><br><h5>  findings </h5><br>  Excellent, fairly simple and effective tool.  I personally lack a little logging on the WANem side, but I suspect that this is solved by third-party utilities, which have yet to be resolved. <br><br>  Here are a couple of examples of profiles that we used for tests: <a href="http://db.tt/YGDUwGZ">CDMA EV-DO rev.A</a> , <a href="http://db.tt/zdcfTvX">EDGE</a> . <br><br>  Official site: <a href="http://wanem.sourceforge.net/">wanem.sourceforge.net</a> , distribution ~ 400mb <br>  The latest version: 2.3, 03/15/2011 </div><p>Source: <a href="https://habr.com/ru/post/127274/">https://habr.com/ru/post/127274/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127267/index.html">How to install fonts in e-books Alphabet n516 and Alphabet n618</a></li>
<li><a href="../127268/index.html">Creation and promotion of Symbian-hit. Part 2 Money</a></li>
<li><a href="../127270/index.html">Doctrine pagination - count the number of records using SQL_CALC_FOUND_ROWS (MySQL)</a></li>
<li><a href="../127271/index.html">Zend_Db_Table ease of use</a></li>
<li><a href="../127273/index.html">Obtaining zero statistical information in the absence of source data</a></li>
<li><a href="../127275/index.html">SCLOG: a bike with all the features of a programming language</a></li>
<li><a href="../127276/index.html">Language for working with ActionScript events</a></li>
<li><a href="../127281/index.html">Bypassing the integrated protection of PIC microcontrollers</a></li>
<li><a href="../127282/index.html">SymmetricDS based PostgreSQL database replication</a></li>
<li><a href="../127285/index.html">Keymaster.js: a simple micro-library for hot keys</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>