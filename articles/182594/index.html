<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic lamp for aquarium MK PIC12</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As part of studying the 12 series, PIC microcontrollers decided to make a small, but very useful device. 
 My daughter lives an aquarium. The backligh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic lamp for aquarium MK PIC12</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/c06/c39/cf5/c06c39cf587be88e5428470e1b54f19f.jpg" align="left">  As part of studying the 12 series, PIC microcontrollers decided to make a small, but very useful device. <br>  My daughter lives an aquarium.  The backlight is made on fluorescent lamps, which must be switched on every morning and turned off in the evening.  And since we are a family of avid tourists, in order not to arrange for the fish to be tortured with light or darkness for 5-7 days, I decided to make the lighting with LED tape with automatic switch on / off from solar lighting. <br>  Along the way, try to squeeze the maximum out of the microcontroller, in terms of functionality. <br><a name="habracut"></a><br>  So the goal: <br><ul><li>  Two independent lighting tapes </li><li>  Adjustable light variable resistor </li><li>  Implement tape brightness control using software implementation of PWM </li><li>  3 modes of operation: </li></ul><ol><li>  sequential increase in the brightness of the tapes in turn (first one then the second) </li><li>  simultaneous increase in the brightness of the tapes </li><li>  simultaneous increase of brightness of tapes with automatic on / off mode from sunlight </li></ol><ul><li>  The automatic mode is implemented on the photoresistor taking into account the hysteresis to eliminate blinking in the twilight period </li><li>  Memorizing the selected mode in EEPROM with power on recovery </li><li>  LED indication of selected mode </li><li>  Change modes by pressing a button </li><li>  Since the tapes are powered from 12V, then make the power supply MK from 12V </li></ul><br>  In store was MK PIC12F675, which is ideally suited for my purposes. <br>  A standard microassembly 7805 is used to power the MK from 12V. <br>  BP was ordered to <a href="http://www.banggood.com/Wholesale-12V-2A-24W-Switch-Power-Supply-Driver-For-LED-Strip-Light-Display-220V-Converter-p-35761.html">BangGood</a> - as it turned out, very worthy of BP for ridiculous money. <br>  LED tape is also ordered there. <br><br>  I will tell a little about this MK: <br>  8 contacts, <br>  1.75 kb - software flash memory, <br>  128 bytes - EEPROM <br>  64 bytes - RAM <br>  4 - 10bit ADC <br>  On GPIO pins there are software pluggable pull-up resistors. <br>  4MHz - the frequency of the internal clock generator. <br>  2 timers 8/16 bits <br><br>  At first I was afraid that the speed of the internal clock generator would not be enough so that the tapes with a small PWM value would not blink.  Tests on the old ATshnom BP and showed that the tape flicker.  But then checking the finished product in the new Chinese BP showed that the ripple came from the old BP. <br>  Actually it is better to tell me the scheme and the source of the program (under MPLAB X), in which everything is described in detail.  Since the LED tape has its own current-limiting resistors, they are not indicated in the diagram. <br><div class="spoiler">  <b class="spoiler_title">The scheme, source code and some photos</b> <div class="spoiler_text">  <a href="">Source archive</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/468/048/292/468048292de8eea1820d86f65f84895f.jpg"><br><br>  On the label instead of ribbons with field workers, just LEDs with current-limiting resistors are installed. <br><img src="https://habrastorage.org/storage2/6f1/db6/db9/6f1db6db9eebe1a4223cf01ee5d4c872.jpg"><br><br>  Under the aquarium cover, 5050 LED strips are laid in the profile. <br><img src="https://habrastorage.org/storage2/d35/eb6/4e2/d35eb64e2bc13883c6c5bc197df70fd2.png"><br><br>  Well, the control unit itself is glued to the double-sided tape on top of the lid, where the sunlight comes from the window. <br><img src="https://habrastorage.org/storage2/f2f/9bd/0cd/f2f9bd0cd27e23e1c24b70facc57e67f.jpg"><br><br></div></div><br>  In the process, I ran into two problems - during the initialization I forgot to specify ANSEL = 0, as a result of which I was throwing all kinds of garbage on my digital legs. <br>  And in the process of multiple flashing of the MK, the calibration constant has flown away (I cannot understand how, since the PicKit3 programmer automatically protects this constant from being overwritten).  As it turned out, the calibration constant in the MIC PIC12 is stored in the last address of the software flash memory and the best method is not to lose it - you must first read and save (I scribbled with a needle on the MK body). <br>  Many thanks to the easyelectronics.ru forum members for their help in solving these issues. <br><br>  Now the machine has worked perfectly for 2 weeks in the field.  Adjustable backlight looks very nice - especially if you place tapes of lighting in the background and in the background.  The only negative - now I forget to feed the fish, as they no longer need to turn the lights on and off. <br><br>  The next step will be an automatic feeder with RTC or via SMS from a mobile phone, but this is probably already on the PIC16 series. <br><br>  The cost of the project came out at about $ 15-16 with BP, which creates a healthy competition for fluorescent lamps sold in aquarium shops, but LED lighting has many more options.  As an option, you can simulate sunsets / sunrises with RGB tape, and the main lighting with white tape.  In general, the weight options. </div><p>Source: <a href="https://habr.com/ru/post/182594/">https://habr.com/ru/post/182594/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../182578/index.html">Interview with Mark McClain, OpenStack Networking Project Leader</a></li>
<li><a href="../182580/index.html">Prism Developer Guide - Part 9, the interaction between loosely coupled components</a></li>
<li><a href="../182584/index.html">HiRISE or how to photograph Mars from orbit</a></li>
<li><a href="../182586/index.html">Transparent authentication for OTRS using mod_auth_ntlm_winbind using the example of Cent OS 6</a></li>
<li><a href="../182588/index.html">SIMD without SIMD, or looking at C almost twice as fast as C ++</a></li>
<li><a href="../182598/index.html">Assembler for brainfuck</a></li>
<li><a href="../182600/index.html">Development of a content application for iOS, attack Russian App Store</a></li>
<li><a href="../182604/index.html">PocketBook Touch 2 - reader with E-Ink Pearl and sensor</a></li>
<li><a href="../182606/index.html">Photos of workplaces habrazhiteli</a></li>
<li><a href="../182608/index.html">Real-Time UIKit Inspector (Reveal App)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>