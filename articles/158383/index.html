<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How ninja prototypes did. Ninjamock.com - interface designer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! We are a team of ninja-developers of the ninjamock.com project. Ninjamock.com is another online designer of sketches and prototypes. The projec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How ninja prototypes did. Ninjamock.com - interface designer</h1><div class="post__text post__text-html js-mediator-article">  Hello!  We are a team of ninja-developers of the ninjamock.com project.  <a href="http://ninjamock.com/">Ninjamock.com</a> is another online designer of sketches and prototypes.  The project is completely written in javascript and HTML5, the server part is in ASP.NET MVC. <br><br>  For the year of work on the project, we stepped on a huge number of rakes and have gained invaluable experience in developing large JavaScript applications, which we want to share.  In this article we will tell how a prototype from a single index.html file has grown into a full-fledged project with more than 250 classes and 60,000 lines of code (not counting third-party libraries).  Also, in general terms, we describe our architecture and describe in detail the implementation of rendering on the client. <br><br><img src="https://habrastorage.org/storage2/b0e/139/d8f/b0e139d8ffa9e0284c692f95cb13854e.png" title="The interface of our ninja editor"><br>  <b>UPD: Follow the updates on our <a href="http://twitter.com/ninjamock">twitter</a> or <a href="http://facebook.com/ninjamock">fb page</a></b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h1>  Start </h1><br>  We all work (still working) in one large company, and somehow it coincided that we got tired of it at one moment and we decided to <s>take over the world</s> to start a project that would allow us to work for ourselves.  So, one autumn afternoon, we gathered in the bar to drink a mug of "tea" and discuss how to do it.  Somewhere after the Nth circle our ingenious plan was ready: <br><br><ul><li>  We write the best sketch designer </li><li>  ??? </li><li>  We make a profit </li></ul><br>  Later it turned out that we are not original, and this plan came up to us - the <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D0%25BD%25D0%25BE%25D0%25BC%25D1%258B_%2528%25D0%25AE%25D0%25B6%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D0%25B0%25D1%2580%25D0%25BA%2529">business plan of the dwarfs</a> . <br><br>  By a sketch designer, we mean an application in which you can draw sketches, wireframes, or mockaps of applications, and also make simple clickable prototypes.  Our main target audience is programmers, designers, business analysts and small companies engaged in the development of mobile applications, who need to quickly draw the design of the application, or test a prototype. <br><br>  We considered the main competitor to the well-known balsamiq.com, whose financial reports inspired us to start working in this area.  But it seems that we were not alone who thought the same, and during the year several similar projects appeared. <br><br>  Unlike balsamiq, which is written in flash, we decided to do everything ‚Äúcorrectly‚Äù and write in HTML5 so that we could work on all platforms (and because it was a fashion trend at that time). <br><br>  Another difference from balsamiq is that we focus on specific platforms (iPhone, iPad, Windows Phone, etc.).  That is, balsamic is a universal platform for drawing anything, so they do not have semantics specific to specific platforms.  Why such semantics is needed?  For example, to generate code for the drawn design.  With us, all controls behave more or less like real ones. <br><br><h1>  The current project architecture </h1><br>  The server part is quite simple and implemented on ASP.NET MVC;  there is probably nothing to talk about.  Most of the code we have is on the client and is written in JavaScript.  When we started the project, we looked in the direction of CoffeeScript, but considered that the infrastructure for it at that time was rather raw, so we decided to write everything in pure JavaScript. <br><br>  Like all JavaScript-respecting developers, we invented more than one bike and wrote several of our frameworks :) For example, we have our own way of creating classes - there are several interesting points that we will discuss in one of the following articles.  Now, with the advent of TypeScript, we will most likely switch to it as soon as support appears in WebStorm. <br><br>  On the client, we have one main page that uses all JavaScript.  From third-party frameworks, we use jQuery and knockout.js.  However, architecturally we decided not to be tied tightly to third-party frameworks, so we have only a few platform-specific classes in which their use is allowed. <br><br>  Client code includes: <br><ul><li>  The object model of the design elements, i.e., the base classes for our controls. </li><li>  The core of the render.  This includes mouse and keyboard event handling classes.  These classes are responsible for finding and moving elements along the coordinates, drawing up the order of drawing elements, and also calling the drawing itself for each element. </li><li>  Design elements (controls) for specific platforms (for now, only for the iPhone).  Each control decides for itself how to draw itself in the given coordinates.  In the current controls, the drawing of ‚Äúhardcoded‚Äù into the code of the control itself - for example, in the ‚Äúbutton‚Äù code we draw a rectangle, paint it with a color, then draw the text from the top, align it with the middle, etc.  However, to draw new controls (which have not yet been released), we decided to do otherwise - use our own designer to draw full-fledged controls.  It turned out quite interesting and we will tell about it in more detail in one of the following articles. Partly this functionality is already available, you can select one or more elements, then right-click and select Assets -&gt; Convert to asset.  After that, a new item appears in the left pane.  And by double clicking on an element you can edit its template. </li><li>  View models (ViewModel) for the page and dialogs.  These are platform-independent classes for which knockout.js templates are tied. </li><li>  Classes of kernel binding to the platform on which our application is running.  Here we have the subscription code for mouse and keyboard events;  This code redirects events to the kernel for further processing.  For example, on a computer, on an iPad or on an iPhone, subscription to events is done in different ways;  Macs and PCs differ in keyboard shortcuts, etc. </li><li>  Extensions.  When designing our code, we relied on the <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B8%25D0%25BD%25D1%2586%25D0%25B8%25D0%25BF_%25D0%25BE%25D1%2582%25D0%25BA%25D1%2580%25D1%258B%25D1%2582%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8/%25D0%25B7%25D0%25B0%25D0%25BA%25D1%2580%25D1%258B%25D1%2582%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8">principle of openness / closeness</a> , so the extensions implemented the functionality that one could do without in principle: for example, snapping elements, highlighting a container when an element is dropped, project autosave in localStorage.  We have a total of 17 extensions. </li></ul><br>  But it all started much easier ... <br><br><h1>  First prototype </h1><br>  The first prototype was written in a few days.  In it, as it should be in the prototype, everything was very simple.  Our controls were HTML elements.  For example, a rectangle is just a div, the phone's keyboard is img, and the elements are more complicated, where gradients are needed (for example, a tab bar or a toolbar), it is a canvas.  All elements had absolute coordinates, the position of elements relative to each other was specified through the css-property z-index.  Moving elements has been implemented via jquery.draggable. <br><br>  All controls were placed in a div element that was our virtual page, i.e., it was wider and taller than the workspace (to allow scrolling), and when scaled, its size changed accordingly. <br>  The main advantages of this approach are the ease of implementation and the excellent scrolling of elements that the browser does for us, well, and many other goodies. <br><br>  This architecture has existed for several months.  But our project grew and developed, and as we added new features, we realized that it did not suit us. <br><br>  The first stumbling block was the banal zoom, which we could not properly implement.  Actually, we had two options: <br><br><ul><li> CSS zoom - works fine if you need to reduce the element.  There is a problem with the increase: all our elements are vector elements, most of them were drawn on canvas.  When you increase the canvas through css, its content is scaled raster, while we needed a vector zoom.  An example of how this does not work can be found here: <a href="http://jsfiddle.net/MzGpe/3/">jsfiddle.net/MzGpe/3</a> </li><li>  ‚ÄúManual‚Äù zoom, when you need to go through all the elements and change their position and size, as well as redraw the entire contents of all the canvas, taking into account the new scale.  But we could not achieve a smooth drawing - all the elements jumped awfully (consistently) at the time of scaling. </li></ul><br>  Surprisingly, none of the competing applications implemented on HTML (fluidui.com, gomockingbird.com, moqups.com) have any scaling. <br><br><h1>  Second prototype </h1><br>  Our solution was to throw out all the HTML elements and replace them with one big canvas, on which everything was drawn.  The size of the canvas was equal to the size of our virtual page.  Therefore, scrolling worked as before, but now it is possible to scale everything smoothly. <br><br>  An additional advantage of this approach is an easy way to generate images from canvas - this allows us to do page thumbnails using the canvas.toDataUrl method.  Moreover, all this is done on the client and does not load the server.  In addition, we have the opportunity to process individual pixels of the image (which in the future will allow adding interesting graphical tools). <br><br>  The working area of ‚Äã‚Äãour application with 15x zoom: <br><br><img src="https://habrastorage.org/storage2/ff1/5c1/16d/ff15c116dc02a818ff7beaaef489112c.png" title="Scaling"><br><br>  However, everything was not so simple.  With any movement of the elements with the mouse (and this is the most frequently used action), the canvas with all controls was redrawn in its entirety, which significantly affected the performance of the application.  It was solved quite simply - we added another canvas over the first one.  So we got 2 layers (initially there were 3, but that's another story :)).  The first layer contained a more or less static picture, which was relatively rarely redrawn, while on the second canvas, temporary objects and various effects were drawn, such as snapping lines and highlighting elements during hover.  The result satisfied us almost completely. <br><br><img src="https://habrastorage.org/storage2/a04/81a/a6b/a0481aa6bb5100721a37a9de5e25dedb.png" title="Three layers scheme"><br><br>  However, again there were problems that showed the imperfections of this approach.  When scaling, the size of the image, and, accordingly, the size of the canvas, increased.  By default, the size of our design page is 1024x768.  At 4x magnification, the size of the canvas is 4096x3072, and not every machine can handle drawing (at an acceptable speed).  Moreover, on several machines, strange artifacts in the form of stripes and colored dots began to appear on several machines.  But a 4-fold increase is far from the limit. <br><br>  As a result, we came to a decision that we use now.  These are the same two canvas, but now their size is not equal to the size of the page design, but to the size of the visible part of the page on the screen.  Because of this, we had to abandon the standard scrolling and take into account the position of scrolling when drawing. <br><br>  With this approach, everything works fine, with the exception of one small minus - the scrolling speed dropped slightly compared with the previous versions. <br><br>  In the screenshot at the beginning of the article you can see how our project now looks.  You can watch it live here: <a href="http://ninjamock.com/">ninjamock.com</a> . <br><br><h1>  Epilogue </h1><br>  Now we are actively working to increase the number of controls supported by the platforms (soon there will be support for ipad, windows phone, surface, as well as desktop applications) <s>and at the same time we are thinking about the second point of our business plan</s> .  We will be glad to hear any feedback and answer any questions about our project. <br><br>  <i>The project team ninjamock -</i> <a href="http://habrahabr.ru/users/pastorgluk/" class="user_link">pastorgluk</a> , Denis and <a href="http://habrahabr.ru/users/headwithoutbrains/" class="user_link">Headwithoutbrains</a> . </div><p>Source: <a href="https://habr.com/ru/post/158383/">https://habr.com/ru/post/158383/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158371/index.html">The command line of a Linux photographer is retired!</a></li>
<li><a href="../158375/index.html">Roskomnadzor registry. More questions than answers</a></li>
<li><a href="../158377/index.html">Switch to Percona XtraDB Cluster. One possible configuration</a></li>
<li><a href="../158379/index.html">Key people on the #AndroidDev tag</a></li>
<li><a href="../158381/index.html">Interview with CYBERMANIAC</a></li>
<li><a href="../158385/index.html">Python - tail recursion optimization</a></li>
<li><a href="../158389/index.html">Cray Titan - the most powerful supercomputer of our time</a></li>
<li><a href="../158391/index.html">Demonoid is back!</a></li>
<li><a href="../158393/index.html">Proxy and save</a></li>
<li><a href="../158395/index.html">Building partner networks based on BILLmanager</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>