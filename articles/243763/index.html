<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Authentication based on JSON Web Token in Django and AngularJS: part two</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part, we looked at what was needed to create JSON Web Token: serializers and views. 

 Now we will create templates and work on services ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Authentication based on JSON Web Token in Django and AngularJS: part two</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="http://habrahabr.ru/post/243427/">first part,</a> we looked at what was needed to create JSON Web Token: serializers and views. <br><br>  Now we will create templates and work on services for authentication and data acquisition. <br><br><h4>  <b>Bower, package manager for web applications</b> </h4><br>  Before we go to the code, let's install all the necessary dependencies.  For this we will use Bower, it is an ideal tool for managing dependencies of web applications. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is assumed that you already have Node.js installed.  To install bower just run the following command: <br><pre><code class="bash hljs">$ npm install -g bower</code> </pre> <br>  Note: You may need administrator rights. <br>  In order to change the default directory in which bower will install packages, in the root of your project, create a file called ‚Äú.bowerrc‚Äù and add the following lines to it: <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"directory"</span></span>: <span class="hljs-string"><span class="hljs-string">"static/bower_components"</span></span> }</code> </pre><br>  We have specified the ‚Äústatic‚Äù directory so that these components are available in Django. <br><a name="habracut"></a><br>  Run the command: <br><pre> <code class="bash hljs">$ bower init</code> </pre><br>  and configure the proposed options. <br>  Now you can install dependencies by running the following command: <br><pre> <code class="bash hljs">$ bower install --save angular angular-route bootstrap jquery</code> </pre><br><br><h4>  <b>Server side template processing</b> </h4><br>  When the necessary components are installed, you can go to the code. <br>  Remember the templates / index.html file that we created in the first part.  It's time to fill it. <br>  Replace the contents of templates / index.html with the following: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"application"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>django-angular-token-auth<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/static/bower_components/bootstrap/dist/css/bootstrap.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container-fluid"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ng-view row"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/static/bower_components/jquery/dist/jquery.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/static/bower_components/bootstrap/dist/js/bootstrap.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/static/bower_components/angular/angular.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/static/bower_components/angular-route/angular-route.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/static/javascripts/app.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/static/javascripts/app.config.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/static/javascripts/app.routes.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Thanks to the use of bootstrap styles, the page will look pretty pretty. <br>  Also for AngularJS we included the &lt;base /&gt; tag inside the &lt;head /&gt; tag.  It is required because we will use HTML 5 routing. <br><br><h4>  <b>Getting started with AngularJS</b> </h4><br>  Let's go ahead and create the file /static/javascripts/app.js and add to it: <br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'application'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'application.config'</span></span>, <span class="hljs-string"><span class="hljs-string">'application.routes'</span></span> ]); angular.module(<span class="hljs-string"><span class="hljs-string">'application.config'</span></span>, []); angular.module(<span class="hljs-string"><span class="hljs-string">'application.routes'</span></span>, [<span class="hljs-string"><span class="hljs-string">'ngRoute'</span></span>]);</code> </pre><br>  This is where AngularJS modules are created, which we will use for configuration and routing. <br>  Create a file /static/javascripts/app.config.js.  And fill it with the following content: <br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'application.config'</span></span>) .config(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$httpProvider, $locationProvider</span></span></span><span class="hljs-function">) </span></span>{ $locationProvider.html5Mode(<span class="hljs-literal"><span class="hljs-literal">true</span></span>).hashPrefix(<span class="hljs-string"><span class="hljs-string">'!'</span></span>); });</code> </pre><br>  Here we want to enable HTML 5 routing.  It eliminates the use of the # symbol in a URL that should be used for other purposes.  This also explains why we included &lt;base /&gt; in &lt;head /&gt;. <br>  Note: We will use $ httpProvider later, so make sure that it is written in dependencies. <br>  Create the file /static/javascripts/app.routes.js and add the following to it: <br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'application.routes'</span></span>) .config(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$routeProvider</span></span></span><span class="hljs-function">) </span></span>{ $routeProvider.when(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">controller</span></span>: <span class="hljs-string"><span class="hljs-string">'IndexController'</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'/static/templates/static/index.html'</span></span> }); });</code> </pre><br><br><h4>  <b>Creating an Auth Service</b> </h4><br>  It's time to start implementing the Auth service, which will be engaged in the registration, entry and exit of users. <br>  Start by creating the file /static/javascripts/auth/auth.module.js. <br>  In this file we will configure the modules that we will use for authentication: <br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'application.auth'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'application.auth.controllers'</span></span>, <span class="hljs-string"><span class="hljs-string">'application.auth.interceptors'</span></span>, <span class="hljs-string"><span class="hljs-string">'application.auth.services'</span></span> ]); angular.module(<span class="hljs-string"><span class="hljs-string">'application.auth.controllers'</span></span>, []); angular.module(<span class="hljs-string"><span class="hljs-string">'application.auth.interceptors'</span></span>, []); angular.module(<span class="hljs-string"><span class="hljs-string">'application.auth.services'</span></span>, []);</code> </pre><br>  You might have noticed that the author is a big fan of the modular structure when using AngularJS. <br>  We simply create various modules for controllers, interceptors, services and add them to the application.auth module. <br>  Remember to add auth.module.js to index.html <br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"/static/javascripts/auth/auth.module.js"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  After adding auth.module.js, open /static/javascripts/app.js and enable the application.auth module depending on our application. <br>  Now let's create the Auth service.  Create the file /static/javascripts/auth/services/auth.service.js and include the following: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'application.auth.services'</span></span>). service(<span class="hljs-string"><span class="hljs-string">'Auth'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$http, $location, $q, $window</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Auth = { <span class="hljs-attr"><span class="hljs-attr">getToken</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.localStorage.getItem(<span class="hljs-string"><span class="hljs-string">'token'</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">setToken</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">token</span></span></span><span class="hljs-function">) </span></span>{ $<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'token'</span></span>, token); }, <span class="hljs-attr"><span class="hljs-attr">deleteToken</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.localStorage.removeItem(<span class="hljs-string"><span class="hljs-string">'token'</span></span>); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Auth; });</code> </pre><br></div></div><br>  We have created some methods that we will use with the Auth service.  Here we use only one dependency $ window.  The rest will be used in other methods: login (), logout (), and register ().  Let's create them. <br>  Add the login () function to the Auth service, like this: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="javascript hljs">login: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">username, password</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> deferred = $q.defer(); $http.post(<span class="hljs-string"><span class="hljs-string">'/api/v1/auth/login/'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">username</span></span>: username, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: password }).success(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response, status, headers, config</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.token) { Auth.setToken(response.token); } deferred.resolve(response, status, headers, config); }).error(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response, status, headers, config</span></span></span><span class="hljs-function">) </span></span>{ deferred.reject(response, status, headers, config); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deferred.promise; },</code> </pre><br></div></div><br>  Here we make a simple AJAX request to one of our APIs, which we did in the first part.  If there is a token in the answer, then it is saved for subsequent API calls. <br>  User exit is more simple.  Due to the use of JWT-based authentication, we only need to erase the token from the repository.  Add the logout () function to the Auth service: <br><pre> <code class="javascript hljs">logout: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ Auth.deleteToken(); $<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location = <span class="hljs-string"><span class="hljs-string">'/'</span></span>; },</code> </pre><br>  The last method to add to the Auth service is register (), it is very similar to login ().  In it, we make a request to our API, to create a user, and then by the second call go to the system on behalf of this user. <br>  Add the register () method to the Auth service: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="javascript hljs">register: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">user</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> deferred = $q.defer(); $http.post(<span class="hljs-string"><span class="hljs-string">'/api/v1/auth/register/'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">user</span></span>: user }).success(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response, status, headers, config</span></span></span><span class="hljs-function">) </span></span>{ Auth.login(user.username, user.password). then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response, status, headers, config</span></span></span><span class="hljs-function">) </span></span>{ $<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location = <span class="hljs-string"><span class="hljs-string">'/'</span></span>; }); deferred.resolve(response, status, headers, config); }).error(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response, status, headers, config</span></span></span><span class="hljs-function">) </span></span>{ deferred.reject(response, status, headers, config); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deferred.promise; }</code> </pre><br></div></div><br>  The Auth service is ready to include it in index.html: <br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"/static/javascripts/auth/services/auth.service.js"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  Now we have the opportunity to register, log in and log out. <br>  Now we need to add an interceptor in order for it to add our marker to each AJAX request. <br>  Create /static/javascripts/auth/interceptors/auth.interceptor.js and paste the following into it: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'application.auth.interceptors'</span></span>) .service(<span class="hljs-string"><span class="hljs-string">'AuthInterceptor'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$injector, $location</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> AuthInterceptor = { <span class="hljs-attr"><span class="hljs-attr">request</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">config</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Auth = $injector.get(<span class="hljs-string"><span class="hljs-string">'Auth'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token = Auth.getToken(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (token) { config.headers[<span class="hljs-string"><span class="hljs-string">'Authorization'</span></span>] = <span class="hljs-string"><span class="hljs-string">'JWT '</span></span> + token; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> config; }, <span class="hljs-attr"><span class="hljs-attr">responseError</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.status === <span class="hljs-number"><span class="hljs-number">403</span></span>) { $location.path(<span class="hljs-string"><span class="hljs-string">'/login'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response; } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> AuthInterceptor; });</code> </pre><br></div></div><br>  Here we have done a few things, let's look at them. <br>  This service has two main methods: request and responseError.  The request method is called for each AJAX request, and the responseError method is called when an AJAX request returns an error. <br>  It was previously mentioned that we add a token to each AJAX request.  This is done in the request method.  Every time the request method is called, we check if we have a token (Auth.getToken () method) and if so, we add it to the request header.  If there is no token, a simple query is executed. <br>  Note: You may notice that the $ injector service is used here.  It is necessary, because sometimes due to interceptors, cyclic dependencies arise, which in turn cause errors.  Using $ injector is the best way to get an Auth service, bypassing this problem. <br>  In responseError, we check the response for 403 errors.  This error is thrown by djangorestframework-jwt when there is no token or when it has expired.  In any case, we must redirect the user to the login page.  This does not require updating the page. <br>  Now that we‚Äôre done with the interceptor, we need to do two things: add it to index.html and app.config.js. <br>  Open index.html and add the following line: <br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"/static/javascripts/auth/interceptors/auth.interceptor.js"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  Now open app.config.js and where we enabled HTML 5 mode add the following line: <br><pre> <code class="javascript hljs">$httpProvider.interceptors.push(<span class="hljs-string"><span class="hljs-string">'AuthInterceptor'</span></span>);</code> </pre><br>  This will add the AuthInterceptor to the list of interceptors used by the $ http service.  Each interceptor is invoked with every request, so there should not be too many of them. <br><br><h4>  <b>Service to get users</b> </h4><br>  The last thing we do in the second part is a service for getting users. <br>  This service is very simple.  In fact, it is only needed to test the performance of our application. <br>  Create the file /static/javascripts/auth/services.users.service.js and add the following to it: <br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'application.auth.services'</span></span>) .service(<span class="hljs-string"><span class="hljs-string">'Users'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$http</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Users = { <span class="hljs-attr"><span class="hljs-attr">all</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $http.get(<span class="hljs-string"><span class="hljs-string">'/api/v1/users/'</span></span>); } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Users; });</code> </pre><br>  Now add it to Index.html under the Auth service: <br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"/static/javascripts/auth/services/users.service.js"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><br><h4>  <b>Completing the second part</b> </h4><br>  In the second part, we looked at the services and interceptors that are needed to build an authentication system.  Affected mechanism Django, which handles static files.  It remains to define several controllers and templates. <br>  In the third part we will talk about controllers and templates.  This will be another long article. <br>  If you are interested in the code, you can check out my <a href="https://github.com/brwr/django-angular-token-auth">repository</a> on Github. <br><br><div class="spoiler">  <b class="spoiler_title">From translator</b> <div class="spoiler_text"><ul><li>  The author greatly overdid modularity, there is practically nothing in the application, and the files and modules are already ... </li><li>  The third part of the translation does not see the point, because the topic of using JWT is disclosed. </li><li>  I also consider it unnecessary to put js into a separate template and then connect it.  In the original, the author uses templates / javascripts.html for this. </li><li>  And also, in the original, the author used the global window object (window.angular.module ('application.auth.services')) although the repository already contains a rather beautiful code. </li></ul><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/243763/">https://habr.com/ru/post/243763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243749/index.html">Unity3D nonplayer application</a></li>
<li><a href="../243751/index.html">"Holes" of startups: the most common problems of young companies that hinder their development</a></li>
<li><a href="../243755/index.html">DataTalks 10.25.14: First meeting</a></li>
<li><a href="../243757/index.html">Amazon distributes $ 25 for AWS account for free and launches Russian version of the site.</a></li>
<li><a href="../243761/index.html">How OpenStack Fills the Gap between PaaS and IaaS</a></li>
<li><a href="../243771/index.html">Restoration of three-dimensional models by the active parallax method</a></li>
<li><a href="../243773/index.html">ASP.NET vNext application for Ubuntu</a></li>
<li><a href="../243775/index.html">Course pixel art 5</a></li>
<li><a href="../243779/index.html">Highlighting in the browser or writing another extension for Chrome</a></li>
<li><a href="../243781/index.html">Interview marketer. Typical HR errors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>