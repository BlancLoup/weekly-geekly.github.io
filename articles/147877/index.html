<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Redmine - control over production update</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the process of developing web applications, we often have 2 questions: 
 1. What tasks have already been solved, but have not yet been uploaded to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Redmine - control over production update</h1><div class="post__text post__text-html js-mediator-article"> In the process of developing web applications, we often have 2 questions: <br>  1. What tasks have already been solved, but have not yet been uploaded to the combat server.  In other words - what exactly will be uploaded to the combat server when git is updated <br>  2. How to quickly see the logs - what and when it was uploaded to the server. <br><br>  Git is used as a version control system (through it the production server is updated).  As a task manager of Redmine. <a name="habracut"></a><br>  A few words about redmine.  For him, we took the cheapest VPS from the hetzner, and our repository was tied to the redmine.  It turned out very convenient when comments to the commit in the form of " <code>re #111 </code> " are automatically attached to task ‚Ññ111.  Accordingly, " <code>fix #111</code> " will close this task.  Well, buns in the form of specifying references to revisions, viewing diffs between commits and so on.  The main ‚Äúmaster‚Äù repository is in our githaba, but I'm going to give it up. <br><br>  So, the above questions can be answered quite easily using the commands in the console: <br>  one. <pre> <code class="bash hljs">git config --global alias.incoming <span class="hljs-string"><span class="hljs-string">'!git remote update -p; git log ..@{u}'</span></span></code> </pre><br>  And then, with the <code>git incoming</code> command, we see exactly what is poured to us.  More <a href="http://stackoverflow.com/questions/231211/using-git-how-do-i-find-modified-files-between-local-and-remote">here</a> (link given in <a href="http://habrahabr.ru/qa/21522/">q &amp; a</a> ) <br>  2 <br><pre> <code class="bash hljs">git reflog</code> </pre><br>  and <br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> HEAD@{1}..HEAD@{0}</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, this method is not always convenient.  In particular, it is not immediately clear what exactly the task # 111, which will flash in the logs. <br>  How I implemented it to make it more convenient. <br>  In the Redmine for tasks a new logical field Production was added, yes - uploaded to the server, no - not uploaded. <br>  Also, the user <b>Robot</b> was added to Redmine. <br>  When uploading to the server, a <code>post-merge</code> hook is used.  This hook looks at exactly which commits were uploaded, runs over each of them, if there is a task number, marks this task in the <code>Production=true</code> mine, and at the end draws up a final list of changes, creates a task for the Robot (with the status "solved") and there records the changes. <br>  Hook is written in php, because  An excellent <a href="https://github.com/lux/phpactiveresource">ActiveResource.php</a> library was found for working with Ruby on Rails REST APIs. <br>  I will give the whole code, since  there are some: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/php &lt;?php require_once ('ActiveResource.php'); //      .         User  . class Issue extends ActiveResource { var $site = 'http://redmine.site.com/'; var $request_format = 'xml'; var $extra_params = '?key=API_KEY'; } $issue = new Issue(); // ,    . exec('git log --pretty="%h=!=%an=!=%s" HEAD@{1}..HEAD@{0}',$logs); //  ,     $s = ""; //    foreach($logs as $log){ //  ,  ,    list($hash, $name, $comment) = explode("=!=", $log); //      echo $hash . " " . $name . " " . $comment . "\n"; // # -     . $s .= "# "; //         if(preg_match("/#\d+/", $comment, $ids)){ $id = substr($ids[0],1); $issue-&gt;find($id); //    Production  true.     ID.     2. $issue-&gt;set("custom_fields", array("@type"=&gt;"array", array("custom_field"=&gt;array("@id"=&gt;"2", "value"=&gt;1)))); $issue-&gt;save(); //     " "   .         alt   .      - . $s .= "+ " . $ids[0] . "+ "; } // ..       -    .      . $s .= "commit:" . $hash; //     $s .= " *".$name."*"; //     ,    ,    2       $comment = trim(preg_replace("/^.*#\d+/", "", $comment)); if(!empty($comment)){ $s .= ", _" . $comment . "_"; } $s .= "\n"; } //   . $newIssue = new Issue(array ('subject' =&gt; ' Production', 'project_id' =&gt; '2')); //  $newIssue-&gt;set("description", $s); //  $newIssue-&gt;set("status_id",3); //    $newIssue-&gt;set("assigned_to_id",12); $newIssue-&gt;save();</span></span></code> </pre><br>  The task with the final description looks like this: <br><img src="https://habrastorage.org/storage2/3e2/866/e72/3e2866e7298a82932a911f5aaf3bef0b.png"><br><br>  What we have in the end. <br>  Through the filters of redmine, you can see which tasks are solved but not filled.  You can also see in a convenient way when and what was updated on the server - convenient for reports. <br><br>  By the way, add yourself to .bashrc <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> gl=<span class="hljs-string"><span class="hljs-string">'git log --pretty="%Cgreen%h %Cblue%an%Creset %s %Cred%ar"'</span></span></code> </pre><br>  and use <code>gl</code> instead of <code>git log</code> . </div><p>Source: <a href="https://habr.com/ru/post/147877/">https://habr.com/ru/post/147877/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147868/index.html">How is UniSender better than MailChimp?</a></li>
<li><a href="../147869/index.html">20 services and tips for web developers</a></li>
<li><a href="../147870/index.html">Run external applications from Notepad ++. NppExec: speeding up Internet searches and more ...</a></li>
<li><a href="../147875/index.html">Jax-Awards, PhpStorm and everything, everything, everything (news digest from July 9-15)</a></li>
<li><a href="../147876/index.html">RubyMine 4.5 release</a></li>
<li><a href="../147879/index.html">Opening coworking incubator in Samara: photo report</a></li>
<li><a href="../147880/index.html">‚ÄúRunet today‚Äù, July 16, 2012. Experts of the issue: Anatoly Denisov, Oleg Uliansky</a></li>
<li><a href="../147882/index.html">Photo after each commit (Win)</a></li>
<li><a href="../147885/index.html">If PHP were to highlight lists and generators</a></li>
<li><a href="../147886/index.html">Mobile applications in China: developers do not earn</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>