<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New features LCD serial interfaces</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When this idea arose, a serial bus LCD indicator was required. A modern display was not at hand and an ancient LCD with a driver ¬µPD7225 was used for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New features LCD serial interfaces</h1><div class="post__text post__text-html js-mediator-article"><p>  When this idea arose, a serial bus LCD indicator was required.  A modern display was not at hand and an ancient LCD with a driver ¬µPD7225 was used for verification.  When the task was solved, it became clear that the indicators available today are just a special case. </p><br><p>  When using microcontrollers with a small number of legs, you often face the problem of lack of I / O ports.  The resources of the microcontroller are enough "by the eye" to solve the problem, but the ports are not.  There is a temptation to "load" already occupied.  As an example, let us consider a simple two-channel voltmeter on the MK tiny13, in which two ports are analog inputs and two are a serial LCD interface.  Expand the functionality of the device can only be using the serial data bus (SD).  Moreover, she almost always rests.  Data transfer to the indicator takes a maximum of two to three hundred microseconds, the update is no more than once every 300 ms.  The clocking line (CLK) cannot be used for obvious reasons.  A simple device lacks a pair of buttons to switch modes and display these modes, especially when the display is small.  That's the problem ... </p><a name="habracut"></a><br><p>  First, connect the indicator to a two-wire serial interface.  To control the LCD with the ¬µPD7225, 6 signal lines are required: RESET, CS, C / D, BUSY, SI, SCK.  The last two have nothing to discuss, we have already mentioned them.  The rest, in order: reset, chip select, command / data and readiness, which is generated by the LCD driver.  A two-wire display connection diagram is shown in Figure 1 on the right.  The reset of the crystal occurs once at power on and is carried out by the R2C2 circuit, provided for by the documentation on the driver. </p><br><p><img src="https://habrastorage.org/files/f98/34f/bfd/f9834fbfde0d44bb84dd9f81a9243161.png" alt="image"></p><br><p>  Active low CS is formed by a low level on the sync line.  While data is being written to the LCD, capacitor C1 is discharged through the diode VD1.  After the last entry, the CLK is set to "1" and C1, charging through R1, removes the resolution of the crystal. </p><br><p>  Before writing the command sequence to the indicator, you must set a high level on the SD bus and wait for C3 to charge through R3.  The recording time of a few bytes is not enough for the voltage on C3 to change significantly.  To record data, the C3 is discharged low on SD.  Instead of polling the BUSY signal, which is expensive to do, the program generates a time delay after the edge of the pulse, before writing the next byte.  The readiness signal is removed by the driver after each byte has been recorded and when CS is removed, as shown in the waveform. </p><br><p><img src="https://habrastorage.org/files/806/706/91e/80670691e57f45a6bcddee572ce07029.png" alt="image"></p><br><p>  To be sure of the reliability of the circuit, we tested another LCD with a similar interface - KTM-S1201.  The driver is the same, the clocking parameters differ by 20%. </p><br><img src="https://habrastorage.org/files/14b/c9d/1a9/14bc9d1a94d04b31a118bae7f6a5d5d6.png"><br><p><br></p><br><img src="https://habrastorage.org/files/fcb/a33/44d/fcba3344d83b439e9eaae61b8d8bb818.png"><br><p><br></p><br><p>  I had to adjust the delay constants and add the missing contrast adjustment circuit.  For the 8-bit NEC indicator, the pt13.asm program is intended, for the 12-bit KTM-S1201 - pt23.asm.  Connecting to the microcontroller through the standard for these indicators 8-pin rectangular connector. </p><br><img src="https://habrastorage.org/files/1ef/72a/f81/1ef72af81d8746dba2bacad224697322.png"><br><p><br>  It is clear that more modern LCDs with sequential control are much easier to connect to two buses. </p><br><p>  The control and indication circuit is shown in Fig.1 in the center.  A chain of three LEDs and a pair of resistors with two ordinary buttons without latching allows you to get a set of voltages in the nodes necessary and sufficient for reliable identification of pressing, and also allows you to independently control two LEDs of different colors using the capabilities of the standard output port.  Consistently connected red diodes will be counted as one with a doubled direct voltage drop.  Since the LEDs are used here not only for their intended purpose, but also as zener diodes, to begin with, let us warn that any substitution for LEDs with a different color than those indicated will hardly lead to good results.  The same applies to the supply voltage of the circuit. </p><br><p>  In the initial state (the buttons are not pressed), the voltage at the junction point of the diodes is 2.1V.  There is no glow, there is little voltage on each of the diodes.  Pressed upper / lower - 1.4 / 4.8V.  To distinguish between levels, the microcontroller must be able to analog-to-digital conversion on the selected port for connecting the circuit.  Then everything is standard. </p><br><p>  The port is configured as an input, conversion of input voltage, comparison of the code with the set thresholds, suppression of "bounce" and generation of pressure flags.  The logic of the scanning program is arranged so that the first pressing of the selected button sets its flag, the second - resets.  Another program controls the LEDs.  The third port state is used to enable and disable them independently.  Low port lights red LEDs, high green.  So that all the LEDs can be lit at the same time, the usual principle of dynamic indication is used.  Maintenance costs are scanty. </p><br><p>  The control circuit of its only input / output is connected to the SD bus of the serial LCD interface.  In the pause between calls to the indicator, the bus is translated to high-impedance, and the clocking bus is in a passive state.  Now the level on the SD bus is determined by the LED-resistive-button circuit, which can vary in one direction or another from the middle, depending on the button pressed, by the amount of the forward voltage drop across the LEDs.  After the ADC cycle, the microcontroller, in the time-sharing mode, controls the LEDs. The circuit can be connected optionally to any convenient port of any microcontroller, for setting operations, checking or searching for program buggy.  In this case, it is necessary to provide for a simple check of its presence during initial initialization, a sign of which is the voltage level ‚Äúnone zero or one‚Äù.  The circuit does not affect the operation of the interface of the indicator and does not require any significant expenditure of the program memory of the microcontroller.  This is clearly seen in the size of the demo HEX file. </p><br><p>  The operation of the control circuit is illustrated with an oscillogram of signals on the SD bus of the serial interface.  The pict on the left is the moment of polling the state of the buttons.  "Paling" to the right of the center - update the indicator. </p><br><img src="https://habrastorage.org/files/285/f05/2e6/285f052e61fd4fc9b7e08cef085083e4.png"><br><p><br>  Choosing element base consider the following.  Green SMD LEDs are rejected due to low brightness at the selected current.  I had to use a 3 mm LED.  To test, turn it on to the 5V circuit through a 10K resistor.  Brightness should suit you.  Red LEDs are suitable for any.  It is not necessary to pay attention to the LED glow at the moment of pressing the button (such is the diagram), since  change of information in the register of the microcontroller occurs when the button is released.  Some time is still required to activate the new output cycle (the old one may not be finished yet), so take it as a wink at the controller to you personally, no more.  No inconvenience during the work is noted.  The only feature, a short flash of LEDs when the indicator is updated, can be considered an indication of the operating state of the device. </p><br><p>  The demonstration program is written in assembler, compiled for ATtiny13 under two indicators and contains only what is necessary to understand the principle of the interface and control scheme operation in a real device.  The LED of the corresponding button lights up when first pressed and goes out when the second.  This limits the processing of click flags in the program.  The developer has a free port to control, depending on the functional purpose of the device and the "reset" input is in stock.  The remaining free program memory, which is almost half of all, should be enough to provide the device with specific additional functions.  Using tiny25 / 45/85 removes the memory problem altogether. </p><br><p>  To select the conversion factors for the voltmeter channels, use the Coef constants in the source.  Their selection when compiling the program makes it unnecessary to use trimming resistors in the dividers of the input circuits and allows the use of a voltmeter in the input voltage range up to 99.9V.  Although two digits are displayed after the comma, it should be understood that the accuracy is limited by the microcontroller's ADC digit capacity.  Averaging over 64 counts allows us to observe changes within tens of millivolts of input voltage above 10V with high stability of readings.  The nominal values ‚Äã‚Äãof the resistors of the input divisors are selected from the condition that the supply voltage at the microcontroller leads is not exceeded, followed by the correction of constants in the program to match the readings.  Values ‚Äã‚Äãfuses MK in the source text.  It is necessary to turn off the divider by 8, the rest by default. </p><br><p>  The author points out that the choice of a voltmeter to demonstrate additional features of a serial interface is purely pragmatic.  In the test program it was easy to add a couple of functions.  Application of this idea in designs on microcontrollers in housings with a small number of ports allows expanding the functionality already in finished devices by simply connecting the described control circuit and modifying the software component. </p><br><h3 id="chast-2-a-ne-zamahnutsya-li-">  Part 2. "And not to wipe ..." </h3><br><p>  I2C bus also applies to two-wire interfaces.  It would be tempting to transfer the idea of ‚Äã‚Äãdouble use of a serial bus to it, especially since there are many LCD indicators of this standard.  Even the domestic manufacturer produces a dozen titles. </p><br><p>  The obvious solution is to mirror a series of LED-resistive circuits so that there is no voltage above half the supply voltage at the midpoint in the initial state.  Bus operation is based on the principle of "mounting or" and the low level current should be within the required limits.  To ensure this parameter, while maintaining the ability to identify button presses by different voltage levels at the connection point of indicator LEDs, the scheme shown in Fig.  2 </p><br><img src="https://habrastorage.org/files/10d/1b8/b96/10d1b8b964f24bac9029adecd01605ee.png"><br><p>  To offset the initial level, a parametric stabilizer is applied on the LED VD3, the current through which sets the resistor R3.  This LED can be used as an indicator of device operation.  The demonstration program of the voltmeter described above, but intended to work with the indicator MT-10T11 (MELT LLC) and the control-display circuit, is present. </p><br><img src="https://habrastorage.org/files/5be/a86/064/5bea86064b574d2a831316fca1291e95.png"><br><p><br></p><br><img src="https://habrastorage.org/files/c4b/241/f79/c4b241f79d35469ea7b13c74adaf5c67.png"><br><p><br>  ATTENTION: SDA bus pull-up resistor is not installed, it performs its functions <br>  control circuit-indication.  An SCL bus pull-up resistor is mounted on the indicator. </p><br><p>  ‚Üí <a href="">Files</a> <br>  ‚Üí <a href="http://vbb.su/%3Fp%3D423">Materials</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/358338/">https://habr.com/ru/post/358338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358328/index.html">Symmetric cards as a means of minimizing Boolean functions</a></li>
<li><a href="../358330/index.html">History of one oscilloscope on stm32</a></li>
<li><a href="../358332/index.html">Arduino LLC and Arduino SRL Are United Again</a></li>
<li><a href="../358334/index.html">Determine the length of the tracks on the board</a></li>
<li><a href="../358336/index.html">Vapor soldering, or as soldered in production</a></li>
<li><a href="../358340/index.html">Russian production of embedded systems</a></li>
<li><a href="../358342/index.html">Chip aging is accelerating</a></li>
<li><a href="../358344/index.html">An inside look at a modern domestic plant for the production of microelectronics and not only</a></li>
<li><a href="../358346/index.html">"You can make your products on imported machines, from which it will not become less domestic"</a></li>
<li><a href="../358348/index.html">How we conquered chaos in the central warehouse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>