<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We carry the general functionality of applications and configurations of Gradle into separate modules</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Often there is a situation when it is necessary to use the same code in different projects and at the same time maintain its relevance on each of them...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We carry the general functionality of applications and configurations of Gradle into separate modules</h1><div class="post__text post__text-html js-mediator-article">  Often there is a situation when it is necessary to use the same code in different projects and at the same time maintain its relevance on each of them.  In this article, I will show how you can put such code into separate components and use them through dependencies inside build.gradle.  In addition to the general code, there will also be considered an example with making the general settings of the build.gradle file migrating from application to application. <br><br>  If you have a disgust when copying the same code on the projects and the desire to fix it somehow, welcome under cat. <a name="habracut"></a><br><br>  The first thing you need to understand what happens in the end and how to use it.  All code that will be used in applications must be divided into components, each of which will be specified in the application dependencies.  By components, I mean a separate jar file containing a specific implementation, i.e.  we will not build one big jar with all classes, our goal is to put each of the functionalities into a separate component.  For example, there are several packages in the application that we would like to reuse, let's say these are classes for logging and some other auxiliary ones. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> src /
 Main‚îÄ‚îÄ main
 ‚îÇ ‚îú‚îÄ‚îÄ java
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ com
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ example
 ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ logger
 ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ util
</pre><br><br>  Therefore we want to get 2 components, logger and util.  In order to be able to get a component in your application, you need to store it in a remote maven repository.  I chose for a long time what is better to use for this purpose and eventually settled on the Artifactory.  It is easily controlled via the web interface, there is a plugin for Gradle that allows you to easily publish the code and everything works fine out of the box.  Customized for this <a href="https://jeroenmols.github.io/blog/2015/08/06/artifactory/">article</a> . <br>  In the end, we will create a separate project for all components, and the logger and util packages will replace a couple of lines in the dependencies block of the build.gradle file. <br><br>  But that is not all.  In addition to copying classes, you often have to copy the configuration from build.gradle.  Because of this, there are situations when configs do not change synchronously, where it remains an incorrectly specified minimum version, where additional parameters are added for proguard or lint.  To avoid this, part of the build file can also be put into components.  This can be done using gradle plugins.  Therefore, we will create 2 types of components, plug-ins and packages. <br><br>  In this article I will not discuss the topic of creating plug-ins for Gradle, if you are not familiar with their work, habrahabr has already had more than one article on this topic, so I see no reason to rewrite it in a new way.  In addition, all the code with the implementation of plug-ins is available on github (link at the end). <br><br>  First of all we will create a project, and transfer the necessary packages to it.  Now you need to write a config in order for Gradle to collect separate jar files from us from these packages and publish them in the Artifactory.  Then I will bring parts of the config to describe a specific action, the full file can be viewed at the end. <br><br>  To begin with, add some basic information about the repositories to build.gradle and connect plugins to publish the components. <br><br><div class="spoiler">  <b class="spoiler_title">Basic settings</b> <div class="spoiler_text"><pre><code class="hljs pgsql">buildscript { repositories { jcenter() } dependencies { classpath <span class="hljs-string"><span class="hljs-string">'org.jfrog.buildinfo:build-info-extractor-gradle:3.1.1'</span></span> } } allprojects { repositories { jcenter() } } // Artifactory apply plugin: <span class="hljs-string"><span class="hljs-string">'com.jfrog.artifactory'</span></span> //     apply plugin: <span class="hljs-string"><span class="hljs-string">'maven-publish'</span></span> //    ,    apply plugin: <span class="hljs-string"><span class="hljs-string">'groovy'</span></span> //           apply <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: <span class="hljs-string"><span class="hljs-string">'components.gradle'</span></span> dependencies { //  Gradle  Gradle API compile gradleApi() }</code> </pre> <br></div></div><br><br>  All that relates directly to working with components is rendered in the components.gradle file. <br><br>  All possible components are added to the array, each element of which contains information about the name and version.  In principle, if necessary, you can add something else, such as a description, license, etc. <br><br><pre> <code class="hljs pgsql">//  def components = [ [<span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'logger'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>:<span class="hljs-string"><span class="hljs-string">'1.0'</span></span>], [<span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'util'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>:<span class="hljs-string"><span class="hljs-string">'1.0'</span></span>] ]</code> </pre><br><br>  If you execute the command ./gradlew jar, then in the folder build / libs a jar file with all classes will be created, but since  We are interested in individual components, we will create a separate task for each component.  The following code is added to understand the process, the resulting file will be different. <br><br><div class="spoiler">  <b class="spoiler_title">Creating components</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">//       . //      compileUtil  compileLogger,     jar components.<span class="hljs-keyword"><span class="hljs-keyword">each</span></span> { component -&gt; task "compile${component.name.capitalize()}" (<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: Jar) { <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> component.<span class="hljs-keyword"><span class="hljs-keyword">version</span></span> classifier component.classifier baseName component.name <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sourceSets.main.output //        //     . // <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">exclude</span></span>,      task.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "com/example/${component.name}/**" } }</code> </pre><br></div></div><br><br>  Now, if we execute one of the compileUtil or compileLogger tasks, we‚Äôll get a jar file with a specific package inside.  This is useful if you need to update a specific component, but if you need to collect everything at once, you want to avoid entering all these tasks.  To do this, we will have to inherit our tasks by our type and create a task to perform them. <br><br><div class="spoiler">  <b class="spoiler_title">Creating components</b> <div class="spoiler_text"><pre> <code class="hljs haskell">//  ,        <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-type"><span class="hljs-type">ComponentsJar</span></span> extends <span class="hljs-type"><span class="hljs-type">Jar</span></span> { } //       task <span class="hljs-string"><span class="hljs-string">"compile${component.name.capitalize()}"</span></span> (<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ComponentsJar</span></span></span><span class="hljs-class">) { //       </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">task</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">compileComponents</span></span></span><span class="hljs-class"> {} //          compileComponents.dependsOn { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tasks</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">withType</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ComponentsJar</span></span></span><span class="hljs-class">) }</span></span></code> </pre> <br></div></div><br><br>  Now we have the compileComponents task, which depends on all the above created ones, having executed it, we get 2 jar files: <br><pre> build / libs /
 Log‚îÄ‚îÄ logger-1.0.jar
 Util‚îÄ‚îÄ util-1.0.jar
</pre><br><br>  As for plug-ins, their only difference from simply assembled classes is that they need to additionally indicate the name of the plug-in and the class responsible for its implementation.  When applying a plug-in using apply plugin: 'pluginName', Gradle searches inside the jar file with the appropriate name and properties: META-INF / gradle-plugins / pluginName.properties.  Inside this file is the class handler. <br><pre> <code class="hljs cs">implementation-<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=com.example.MyPluginClass</code> </pre><br><br>  Therefore, for plugins, we will have to additionally pack such a file. <br><br><div class="spoiler">  <b class="spoiler_title">Creating plugins</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">//  Gradle //    ,    packagePrefix. //        , // packagePrefix        def plugins = [ [<span class="hljs-type"><span class="hljs-type">name</span></span>:<span class="hljs-string"><span class="hljs-string">'android-signing'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>:<span class="hljs-string"><span class="hljs-string">'1.0'</span></span>, packagePrefix:<span class="hljs-string"><span class="hljs-string">'signing'</span></span>], [<span class="hljs-type"><span class="hljs-type">name</span></span>:<span class="hljs-string"><span class="hljs-string">'android-library-publishing'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>:<span class="hljs-string"><span class="hljs-string">'1.0'</span></span>, packagePrefix:<span class="hljs-string"><span class="hljs-string">'publishing'</span></span>], [<span class="hljs-type"><span class="hljs-type">name</span></span>:<span class="hljs-string"><span class="hljs-string">'android-base'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>:<span class="hljs-string"><span class="hljs-string">'1.0'</span></span>, packagePrefix:<span class="hljs-string"><span class="hljs-string">'android'</span></span>] ] //        plugins.<span class="hljs-keyword"><span class="hljs-keyword">each</span></span> { component -&gt; task "compile${component.name.capitalize()}" (<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: ComponentsJar) { //     jar  <span class="hljs-string"><span class="hljs-string">'plugin'</span></span> appendix <span class="hljs-string"><span class="hljs-string">'plugin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> component.<span class="hljs-keyword"><span class="hljs-keyword">version</span></span> classifier component.classifier baseName component.name <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sourceSets.main.output def componentPackages = [] //         ,         componentPackages.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>("META-INF/gradle-plugins/${component.name}.properties") //  ,  ,           componentPackages.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(component.packagePrefix ? "com/example/${component.packagePrefix}/**" : "com/example/${component.name}/**") <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> componentPackages } }</code> </pre> <br></div></div><br><br>  In the previous example, the include section indicated two paths, one of which is ‚ÄúMETA-INF / gradle-plugins / $ {component.name} .properties‚Äù, these files are taken from the resources folder.  Therefore, for each plugin you need to create such a file. <br><pre> src / main /
 Resources‚îÄ‚îÄ resources
     MET‚îÄ‚îÄ META-INF
         Dle‚îÄ‚îÄ gradle-plugins
             And‚îÄ‚îÄ android-base.properties
             And‚îÄ‚îÄ android-library-publishing.properties
             And‚îÄ‚îÄ android-signing.properties 
</pre><br><br>  The contents of android-base.properties looks like this: <br><pre> <code class="hljs cs">implementation-<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=com.example.android.BaseAndroidConfiguration</code> </pre><br><br>  Given that the Gradle configuration is written in Groovy, it is logical that the plugins will be written in Groovy.  In principle, they can also be written in java, but you don't need it.  Therefore, the implementation of plug-ins is located in the appropriate groovy folder: <br><pre> src / main /
 Gro‚îÄ‚îÄ groovy
  Com‚îÄ‚îÄ com
  Example‚îÄ‚îÄ example
  And‚îÄ‚îÄ android
  ‚îÇ ‚îî‚îÄ‚îÄ BaseAndroidConfiguration.groovy
  Publishing‚îÄ‚îÄ publishing
  ‚îÇ ‚îî‚îÄ‚îÄ LibraryPublishingPlugin.groovy
  Signing‚îÄ‚îÄ signing
  Sign‚îÄ‚îÄ SigningPlugin.groovy
</pre><br><br>  In my example, I made 3 settings.  The basic one, in which the standard android build settings are specified, the config for publishing libraries in Artifactory and the application signature setting. <br><br>  Actually, now our task compileComponents creates all the necessary files: <br><pre> build / libs /
 And‚îÄ‚îÄ android-base-plugin-1.0.jar
 And‚îÄ‚îÄ android-library-publishing-plugin-1.0.jar
 And‚îÄ‚îÄ android-signing-plugin-1.0.jar
 Log‚îÄ‚îÄ logger-1.0.jar
 Util‚îÄ‚îÄ util-1.0.jar
</pre><br><br>  Now these jar-nicks need to be published in our repository. <br>  The first step is to prepare the artifacts for maven.  Again, to be able to work with one component, we will create separate publications for maven. <br><br><div class="spoiler">  <b class="spoiler_title">Publish Settings</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">// ,     <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Artifact { String <span class="hljs-type"><span class="hljs-type">path</span></span>, groupId, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>, id, <span class="hljs-type"><span class="hljs-type">name</span></span> } //  Artifact,       //    compileComponents (.  ) def artifacts = []; //  Artifact,      , //     def activeArtifacts = []; //       //   ,           //   artifacts publishing { publications { artifacts.<span class="hljs-keyword"><span class="hljs-keyword">each</span></span> { art -&gt; "$art.name"(MavenPublication) { groupId art.groupId version = art.<span class="hljs-keyword"><span class="hljs-keyword">version</span></span> artifactId art.id artifact(art.path) } } } } // artifactory     ,    activeArtifacts //     .        . artifactoryPublish { doFirst { activeArtifacts.<span class="hljs-keyword"><span class="hljs-keyword">each</span></span> { artifact -&gt; publications(artifact.name) } } } //..          //  ,       artifactory { contextUrl = ArtifactoryUrl publish { repository { // ,      repoKey = <span class="hljs-string"><span class="hljs-string">'libs-release-local'</span></span> username = ArtifactoryUser <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = ArtifactoryPassword } } }</code> </pre><br></div></div><br><br>  In principle, everything is clear from the comments, for Artifactory we do not specify all publications at once (as is usually done in the examples of working with Artifactory), but fill them out of necessity.  This allows you to run compileUtil artifactoryPublish tasks and compile and publish only one component - util.  The only thing left is to generate pom.xml for each of the components, but this is all simple.  Maven plugin creates a separate task for each publication, with the name generatePomFileForNAMEPublication, and since  we created publications by component name, respectively, generatePomFileForUtilPublication tasks are created, and so on. <br>  Now that all the details are described, we will collect everything in a heap. <br><br><div class="spoiler">  <b class="spoiler_title">Summary file components.gradle</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">//   ,        <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ComponentsJar extends Jar { } // ,     <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Artifact { String <span class="hljs-type"><span class="hljs-type">path</span></span>, groupId, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>, id, <span class="hljs-type"><span class="hljs-type">name</span></span> } //  Artifact,       def artifacts = []; //  Artifact,      , //     def activeArtifacts = []; //  def components = [ [<span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'logger'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>:<span class="hljs-string"><span class="hljs-string">'1.0'</span></span>], [<span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'util'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>:<span class="hljs-string"><span class="hljs-string">'1.0'</span></span>] ] //  Gradle def plugins = [ [<span class="hljs-type"><span class="hljs-type">name</span></span>:<span class="hljs-string"><span class="hljs-string">'android-signing'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>:<span class="hljs-string"><span class="hljs-string">'1.0'</span></span>, packagePrefix:<span class="hljs-string"><span class="hljs-string">'signing'</span></span>], [<span class="hljs-type"><span class="hljs-type">name</span></span>:<span class="hljs-string"><span class="hljs-string">'android-library-publishing'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>:<span class="hljs-string"><span class="hljs-string">'1.0'</span></span>, packagePrefix:<span class="hljs-string"><span class="hljs-string">'publishing'</span></span>], [<span class="hljs-type"><span class="hljs-type">name</span></span>:<span class="hljs-string"><span class="hljs-string">'android-base'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>:<span class="hljs-string"><span class="hljs-string">'1.0'</span></span>, packagePrefix:<span class="hljs-string"><span class="hljs-string">'android'</span></span>] ] //       def baseTask = { task, component, packages -&gt; task.<span class="hljs-keyword"><span class="hljs-keyword">version</span></span> component.<span class="hljs-keyword"><span class="hljs-keyword">version</span></span> task.classifier component.classifier task.baseName component.name task.<span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sourceSets.main.output def componentPackages = [] //  ,  ,           componentPackages.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(component.packagePrefix ? "com/example/${component.packagePrefix}/**" : "com/example/${component.name}/**") <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (packages != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { componentPackages.addAll(packages) } task.<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> componentPackages //         def art = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Artifact( <span class="hljs-type"><span class="hljs-type">name</span></span>: component.name, groupId: "com.example", <span class="hljs-type"><span class="hljs-type">path</span></span>: "$buildDir/libs/$task.archiveName", id: task.appendix == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? component.name : "$component.name-$task.appendix", <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>: component.<span class="hljs-keyword"><span class="hljs-keyword">version</span></span> ) //      artifacts.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(art) //       ,      task.doFirst { //        activeArtifacts.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(art) } //       pom.xml    task.doLast { tasks."generatePomFileFor${art.name.capitalize()}Publication".<span class="hljs-keyword"><span class="hljs-keyword">execute</span></span>() } } //        components.<span class="hljs-keyword"><span class="hljs-keyword">each</span></span> { component -&gt; task "compile${component.name.capitalize()}" (<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: ComponentsJar) { baseTask(it, component, component.package) } } //        plugins.<span class="hljs-keyword"><span class="hljs-keyword">each</span></span> { component -&gt; task "compile${component.name.capitalize()}" (<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: ComponentsJar) { //     jar   <span class="hljs-string"><span class="hljs-string">'plugin'</span></span> (        ) appendix <span class="hljs-string"><span class="hljs-string">'plugin'</span></span> //         ,         def packages = ["META-INF/gradle-plugins/${component.name}.properties"] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (component.package != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { packages.addAll(component.package) } baseTask(it, component, packages); } } //       task compileComponents {} //          compileComponents.dependsOn { tasks.withType(ComponentsJar) } jar { //    jar     doLast { <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> File(it.destinationDir, "${project.name}.jar").<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>() } } //       //   ,           //    artifacts publishing { publications { artifacts.<span class="hljs-keyword"><span class="hljs-keyword">each</span></span> { art -&gt; "$art.name"(MavenPublication) { groupId art.groupId version = art.<span class="hljs-keyword"><span class="hljs-keyword">version</span></span> artifactId art.id artifact(art.path) } } } } // artifactory     ,        artifactoryPublish { doFirst { activeArtifacts.<span class="hljs-keyword"><span class="hljs-keyword">each</span></span> { artifact -&gt; publications(artifact.name) } } } artifactory { contextUrl = ArtifactoryUrl publish { repository { // ,      repoKey = <span class="hljs-string"><span class="hljs-string">'libs-release-local'</span></span> username = ArtifactoryUser <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = ArtifactoryPassword } } }</code> </pre> <br></div></div><br><br>  The cofishing uses additional variable ArtifactoryUser, ArtifactoryPassword and ArtifactoryUrl.  I specifically took them out of the project.  This will allow you to easily manage these parameters in different environments.  I added them globally to the ~ / .gradle / gradle.properties file: <br><pre> <code class="hljs pgsql">ArtifactoryUrl=http://localhost:<span class="hljs-number"><span class="hljs-number">8081</span></span> ArtifactoryUser=<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> ArtifactoryPassword=<span class="hljs-keyword"><span class="hljs-keyword">password</span></span></code> </pre><br><br>  Actually that's all.  Assembled components can now be specified in dependencies, after which the project can safely refer to the necessary classes. <br><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">dependencie</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">compile</span></span> <span class="hljs-string"><span class="hljs-string">'com.example:util:1.0'</span></span> compile <span class="hljs-string"><span class="hljs-string">'com.example:logger:1.0'</span></span> }</code> </pre> <br><br>  In order for Gradle to find the components, you must specify our repository. <br><pre> <code class="hljs pgsql">allprojects { repositories { jcenter() maven { url "$ArtifactoryUrl/libs-release-local" credentials { username = ArtifactoryUser <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = ArtifactoryPassword } } } }</code> </pre> <br><br>  The plug-ins are connected in two lines, one is indicated in the buildscript dependencies, the second is directly when using the plug-in, now you can compare what build.gradle was and how it became <br><br><div class="spoiler">  <b class="spoiler_title">It was</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">buildscript { repositories { jcenter() } dependencies { classpath <span class="hljs-string"><span class="hljs-string">'com.android.tools.build:gradle:1.3.0'</span></span> } } allprojects { repositories { jcenter() } } apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.application'</span></span> android { compileSdkVersion <span class="hljs-number"><span class="hljs-number">22</span></span> buildToolsVersion "22.0.1" publishNonDefault <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> defaultConfig { minSdkVersion <span class="hljs-number"><span class="hljs-number">15</span></span> targetSdkVersion <span class="hljs-number"><span class="hljs-number">21</span></span> } packagingOptions { <span class="hljs-keyword"><span class="hljs-keyword">exclude</span></span> <span class="hljs-string"><span class="hljs-string">'META-INF/NOTICE.txt'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exclude</span></span> <span class="hljs-string"><span class="hljs-string">'META-INF/LICENSE.txt'</span></span> } testOptions { unitTests.returnDefaultValues = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } lintOptions { abortOnError <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(project.hasProperty("debugSigningPropertiesPath") &amp;&amp; project.hasProperty("releaseSigningPropertiesPath")) { File debugPropsFile = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> File(<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.getenv(<span class="hljs-string"><span class="hljs-string">'HOME'</span></span>) + "/" + project.property("debugSigningPropertiesPath")) File releasePropsFile = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> File(<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.getenv(<span class="hljs-string"><span class="hljs-string">'HOME'</span></span>) + "/" + project.property("releaseSigningPropertiesPath")) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(debugPropsFile.<span class="hljs-keyword"><span class="hljs-keyword">exists</span></span>() &amp;&amp; releasePropsFile.<span class="hljs-keyword"><span class="hljs-keyword">exists</span></span>()) { Properties debugProps = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Properties() debugProps.<span class="hljs-keyword"><span class="hljs-keyword">load</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FileInputStream(debugPropsFile)) Properties releaseProps = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Properties() releaseProps.<span class="hljs-keyword"><span class="hljs-keyword">load</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> FileInputStream(releasePropsFile)) signingConfigs { <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span> { storeFile file(debugPropsFile.getParent() + "/" + debugProps[<span class="hljs-string"><span class="hljs-string">'keystore'</span></span>]) storePassword debugProps[<span class="hljs-string"><span class="hljs-string">'keystore.password'</span></span>] keyAlias debugProps[<span class="hljs-string"><span class="hljs-string">'keyAlias'</span></span>] keyPassword debugProps[<span class="hljs-string"><span class="hljs-string">'keyPassword'</span></span>] } <span class="hljs-keyword"><span class="hljs-keyword">release</span></span> { storeFile file(releasePropsFile.getParent() + "/" + releaseProps[<span class="hljs-string"><span class="hljs-string">'keystore'</span></span>]) storePassword releaseProps[<span class="hljs-string"><span class="hljs-string">'keystore.password'</span></span>] keyAlias releaseProps[<span class="hljs-string"><span class="hljs-string">'keyAlias'</span></span>] keyPassword releaseProps[<span class="hljs-string"><span class="hljs-string">'keyPassword'</span></span>] } } buildTypes { <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span> { signingConfig signingConfigs.<span class="hljs-keyword"><span class="hljs-keyword">debug</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">release</span></span> { signingConfig signingConfigs.<span class="hljs-keyword"><span class="hljs-keyword">release</span></span> } } } } }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">It became</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">buildscript { repositories { jcenter() maven { url "$ArtifactoryUrl/libs-release-local" credentials { username = ArtifactoryUser <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = ArtifactoryPassword } } } dependencies { classpath <span class="hljs-string"><span class="hljs-string">'com.android.tools.build:gradle:1.3.0'</span></span> classpath <span class="hljs-string"><span class="hljs-string">'org.jfrog.buildinfo:build-info-extractor-gradle:3.1.1'</span></span> classpath <span class="hljs-string"><span class="hljs-string">'com.example:android-library-publishing-plugin:1.0'</span></span> classpath <span class="hljs-string"><span class="hljs-string">'com.example:android-signing-plugin:1.0'</span></span> classpath <span class="hljs-string"><span class="hljs-string">'com.example:android-base-plugin:1.0'</span></span> } } allprojects { repositories { jcenter() maven { url "$ArtifactoryUrl/libs-release-local" credentials { username = ArtifactoryUser <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = ArtifactoryPassword } } } } apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.application'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'android-library-publishing'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'android-signing'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'android-base'</span></span></code> </pre></div></div><br><br>  I posted the whole project on <a href="https://github.com/cooperok/gradle-components">github</a> . <br>  That's all, constructive criticism is always welcome. </div><p>Source: <a href="https://habr.com/ru/post/267311/">https://habr.com/ru/post/267311/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267295/index.html">RC5 encryption algorithm and its implementation in python</a></li>
<li><a href="../267297/index.html">Free Firebird large database seminar</a></li>
<li><a href="../267301/index.html">Automate Java EE Testing Web Services with SoapUI and Arquillian</a></li>
<li><a href="../267305/index.html">Modifiers private and private [this] in Scala</a></li>
<li><a href="../267307/index.html">Backups of Hyper-V virtual machines and regular computers</a></li>
<li><a href="../267315/index.html">Skype has collapsed and is not working around the world</a></li>
<li><a href="../267317/index.html">The evolution of network communication methods. Part II</a></li>
<li><a href="../267319/index.html">Skype came tight and paralyzed the activities of many companies.</a></li>
<li><a href="../267321/index.html">And again about 1C</a></li>
<li><a href="../267323/index.html">The United States and China may conclude an agreement on the rules of conduct in cyberspace</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>