<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Add a little more reflection: decorators</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, you have to work quite a bit with Python. Solving one of the current tasks, it became necessary within the function decorator to check wheth...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Add a little more reflection: decorators</h1><div class="post__text post__text-html js-mediator-article"> Recently, you have to work quite a bit with Python.  Solving one of the current tasks, it became necessary within the function decorator to check whether the decorated method was decoded by another decorator.  Unfortunately, the standard means of reflection of the language do not allow it.  More precisely, using, for example, the inspect module from the standard library can do this, but it really didn‚Äôt like this approach. <br><br>  Under the cut is your own method for solving a problem that has resulted in a small library available for general use. <br><a name="habracut"></a><br>  So, it was decided to create and use some special register of decorators.  Those.  register any decorator function in this registry before using it as a decorator.  After that, using the registry API, you can simply track the use of registered decorators on methods, functions and modules. <br><br>  Nevertheless, there are a few rules to remember.  Registering built-in decorators will not work.  That is, unfortunately, it is impossible to track decorators such as <code>@staticmethod</code> , <code>@classmethod</code> and the like (if someone can find a solution to this problem, I will be very grateful).  And most importantly, decorators must be registered <b>before they are used</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In fact, the mechanics of the registry is quite simple.  By registering a decorator, you actually get a decorated source decorator which, in addition to its original functionality, also records information about itself in the attribute "__annotations__" of the function being decorated. <br><br>  If a function (or method) is decorated by several decorators, it is important only to register all decorators before using them and all decorators will be correctly taken into account.  Ie, the construction of the form: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@decorator_one @decorator_two @decorator_three def some_function(): pass</span></span></code> </pre><br><br>  will work successfully. <br><br>  The library ‚Äúregd‚Äù (as I called it) is compatible with both Python 2.x and version 3.x (we use both branches on our projects, so compatibility has been tested). <br><br>  The source code is available on <a href="https://github.com/Mikhus/regd">Github</a> , the license, as always - MIT, so do whatever you want. <br><br>  Documentation is <a href="http://pythonhosted.org/regd/">here</a> . <br><br>  You can install it just through PyPI: <br><br><pre> <code class="bash hljs">$ pip install regd</code> </pre><br><br>  Below are a few words about the functionality. <br><br><h5>  1. Registration decorators. </h5><br>  ‚ÄúOrdinary‚Äù and ‚Äúparameterized‚Äù decorators should be registered using different methods: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> regd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> DecoratorRegistry <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> dreg <span class="hljs-comment"><span class="hljs-comment">#  ""  simple_decorator = dreg.decorator( mydecorator) #  ""  param_decorator = dreg.parametrized_decorator( param_decorator)</span></span></code> </pre><br><br><h5>  2. Reflection API </h5><br>  To make the API functions more understandable, let's first create and register a simple decorator, which in fact does nothing, but simply exists. <br><br><pre> <code class="hljs scala">from regd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">DecoratorRegistry</span></span> as dreg #   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mydecorator</span></span></span></span>( fn) : #    -  ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper</span></span></span></span>( *args, **kwargs) # ...   -  ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fn( *args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wrapper #    mydecorator = dreg.decorator( mydecorator)</code> </pre><br><br>  Remember - register decorators need <i>to use them</i> . <br><br>  Now, after registering, we can use our decorator as usual: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@mydecorator def myfunc() : pass</span></span></code> </pre><br><br>  Now, at any time from any place in the code, we can find out whether the function has been decorated by the decorator: <br><pre> <code class="python hljs">print( dreg.is_decorated_with( myfunc, mydecorator))</code> </pre><br><br>  Some more useful methods: <br><br><ul><li>  <code>all_decorated_module_functions( module, exclude_methods=False, exclude_functions=False)</code> - allows you to get all the functions and / or class methods decorated by registered decorators in a given module </li><li>  <code>module_functions_decorated_with( module, decorator, exclude_methods=False, exclude_functions=False)</code> - allows you to get all the functions and / or class methods decoded by a given decorator in a given module </li><li>  <code>decorated_methods( cls, decorator)</code> - we get all the methods of a class / object decorated with a given decorator </li><li>  <code>get_decorators( fn)</code> - returns a list of all known decorators for the given function / method </li><li>  <code>get_real_function( fn)</code> - returns the reference to the original function, which was decoded by the decorators (yes, you can get access to the original function and even perform it to bypass the decoration) </li><li>  <code>is_decorated_with( fn, decorator)</code> - checks if the given function is <code>is_decorated_with( fn, decorator)</code> by the specified decorator </li></ul><br><br>  I hope someone will come in handy or seem useful.  All comments and suggestions are welcome. </div><p>Source: <a href="https://habr.com/ru/post/178017/">https://habr.com/ru/post/178017/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../178007/index.html">We study the debugger, part one</a></li>
<li><a href="../178009/index.html">Prism Developer Guide - Part 8, Navigation</a></li>
<li><a href="../17801/index.html">Peering database :-)</a></li>
<li><a href="../178011/index.html">"Tax on discs" may cancel</a></li>
<li><a href="../178013/index.html">Shoemaker without boots, or accounting equipment in the IT department. Part I</a></li>
<li><a href="../178019/index.html">The vital position of users of VKontakte, depending on gender and age</a></li>
<li><a href="../17802/index.html">About amazing :)</a></li>
<li><a href="../178021/index.html">New CSS directive @supports</a></li>
<li><a href="../178023/index.html">The network has a 128-year-old voice recording of Alexander Bell</a></li>
<li><a href="../178027/index.html">Working with Group Policy Preferences: Managing INI Files</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>