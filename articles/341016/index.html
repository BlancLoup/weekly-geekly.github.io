<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>[SOA] Service Oriented Ansible</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. Today we will talk about Ansible and services, you can of course use other spare parts for Docker, Jenkins and Puppet SOA, but today we have...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>[SOA] Service Oriented Ansible</h1><div class="post__text post__text-html js-mediator-article"><p>  Good day.  Today we will talk about Ansible and services, you can of course use other spare parts for Docker, Jenkins and Puppet SOA, but today we have Ansible, services and a couple of PHP lines.  Many of you have seen such pictures (pictures and symbols are changed). </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/284/73d/389/28473d3892396995407b59c09b3137bc.png" alt="SOA"></div><br><p>  and read such articles with pictures ( <a href="https://habrahabr.ru/company/oleg-bunin/blog/340114/">first</a> , <a href="https://habrahabr.ru/company/badoo/blog/328062/">second</a> ), where SOA is mentioned. </p><a name="habracut"></a><br><p>  And more to the point!  Today we will </p><br><h2 id="deploit-soa">  Deploy SOA </h2><br><p>  2 nginx, 2 fronts and service and deploy.  Only 7 VMs are needed to deploy the SOA sandbox. </p><br><p>  As the server we will use the local machine and in the same network segment we have deployed virtuals with the user ansible # ansible.  Also, our VM requires Internet access to install software.  The easiest way is to make 2 network interfaces with NAT and internal network 192.168.0.0 \ 32.  If you reuse the VM, you can reduce this number to 4, as a sandbox, but no more. </p><br><p>  <a href="https://github.com/dangerousvasil/ansibleServicesDeploy">The main repository</a> that will put all of this on our sandwich from VM and that it works. </p><br><p>  We will also use 2 more repositories.  They contain a couple of lines of PHP code without reference to any framework or project.  <a href="https://github.com/dangerousvasil/simpleFront">One</a> and <a href="https://github.com/dangerousvasil/simpleService">two</a> . </p><br><p>  The task of the front to make a request to the service and display its result. </p><br><p>  The task of the service answer 3 large letters.  Your captain is obvious.  (You can try to slip your repository - ps Your Captain is obvious again). </p><br><h2 id="inventoriy">  Inventory </h2><br><p>  This is the name of the file in which the description of the VM structure and their hosts / prod.ini are stored. </p><br><p>  Let's call our VMs and give them names.  The front to which we contact the user is </p><br><pre><code class="hljs">nginx-front-00 ansible_host=192.168.56.102</code> </pre> <br><p>  Basic application that accepts requests </p><br><pre> <code class="hljs">php-front-00 ansible_host=192.168.56.103 php-front-01 ansible_host=192.168.56.101</code> </pre> <br><p>  One small balancer that serves our services </p><br><pre> <code class="hljs">nginx-balance-00 ansible_host=192.168.56.104</code> </pre> <br><p>  One small service that has a word in 3 letters </p><br><pre> <code class="hljs matlab">service-<span class="hljs-built_in"><span class="hljs-built_in">sign</span></span><span class="hljs-number"><span class="hljs-number">-00</span></span> ansible_host=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.56</span></span><span class="hljs-number"><span class="hljs-number">.101</span></span> service-<span class="hljs-built_in"><span class="hljs-built_in">sign</span></span><span class="hljs-number"><span class="hljs-number">-01</span></span> ansible_host=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.56</span></span><span class="hljs-number"><span class="hljs-number">.103</span></span></code> </pre> <br><p>  As you can see, I reuse VMs for service and foreon, but let's think that these are different VMs that are located on different iron servers for fault tolerance. </p><br><h2 id="struktura-inventoriya">  Inventory structure </h2><br><p>  We called our hosts, now we will compile the groups of them, and the groups themselves will be divided into several parts.  The first group of groups is groups of services. </p><br><h3 id="gruppa-servisy">  Group services </h3><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[nginx-front]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nginx-front-00</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[front_app]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">php-front-00</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">php-front-01</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[nginx-balancer]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nginx-balance-00</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[sign]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">service-sign-00</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">service-sign-01</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[deploy]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">deploy</span></span></code> </pre> <br><h3 id="gruppy-soft">  Soft Groups </h3><br><p>  We have grouped our hosts into groups and now we need to indicate which software each group needs. Another group of groups is needed for this. </p><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[php-cli:children]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">front_app</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[php-fpm:children]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">front_app</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sign</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[git:children]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">front_app</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[hg:children]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[nginx:children]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nginx-front</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nginx-balancer</span></span></code> </pre> <br><p>  Adding a group to a group will prompt our deployment that you need to install the appropriate software for this group.  For hosts included in the php-cli group, install the PHP console version for cron jobs for example. <br>  Ps  Your captain is obvious </p><br><h3 id="gruppa-servisy-1">  Group Services </h3><br><p>  The next group of groups =) </p><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">services:children</span></span>] sign</code> </pre> <br><p>  Groups our services as services. </p><br><h3 id="osobennost-servisov">  Feature of Services </h3><br><p>  Feature of the services is that there are 2 entry points </p><br><pre> <code class="hljs django"><span class="xml"><span class="xml">// server_name </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ service_name }}</span></span><span class="xml"><span class="xml"> api/index.php // server_name </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ service_name }}</span></span><span class="xml"><span class="xml">_web web/index.php</span></span></code> </pre> <br><p>  Why is this necessary?  If you want to make the administrative panel of the service, then you don‚Äôt need to do an additional service for it, you can use the same VMs and access them as {{service_name}} _ web via ifraym or request.  Services may change in this way the service administration code will be updated along with the service. </p><br><h2 id="klyuchi">  Keys </h2><br><p>  Passwords are not very convenient to use each time, so let's scatter keys on our VMs. </p><br><pre> <code class="hljs pgsql">ansible-playbook -i hosts/prod.ini task/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>/authorized_key.yml -k <span class="hljs-comment"><span class="hljs-comment">--ask-sudo-pass</span></span></code> </pre> <br><p>  especially for you, I have already generated the keys in the roles / authorized_key / keys folder, but you <del>  owe </del>  can make your own. </p><br><p>  Add a private key in the storage key </p><br><pre> <code class="hljs javascript">cp roles/authorized_key/keys/id_rsa ~<span class="hljs-regexp"><span class="hljs-regexp">/.ssh/i</span></span>d_rsa_deploy &amp;&amp; chmod <span class="hljs-number"><span class="hljs-number">700</span></span> ~<span class="hljs-regexp"><span class="hljs-regexp">/.ssh/i</span></span>d_rsa_deploy &amp;&amp; ssh-add ~<span class="hljs-regexp"><span class="hljs-regexp">/.ssh/i</span></span>d_rsa_deploy</code> </pre> <br><p>  IMPORTANT: after restarting the machine, the key must be added again </p><br><p>  Or write it in configurations, for example, in the / etc / ssh / ssh_config file add a line </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">IdentityFile</span></span> /etc/ssh/ssh_hg_deploy_key</code> </pre> <br><h2 id="soft">  Soft </h2><br><p>  Install the necessary software on VM </p><br><pre> <code class="hljs mel">ansible-playbook -i hosts/prod.ini task/<span class="hljs-keyword"><span class="hljs-keyword">system</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">soft</span></span>-install.yml</code> </pre> <br><p>  This will provide us with the necessary software for our Soft Groups.  We can add or remove groups from groups so that on each VM there is only the required set of software.  If the VM re is used in another service or large changes occur in the service, then it is easier for the VM to destroy and deploy again. </p><br><p>  We installed php-cli, php-fpm, git, nginx on the machine niches, what's next ... </p><br><h2 id="front">  FRONT </h2><br><p>  We need to configure our frontline NGIKS which is here </p><br><pre> <code class="hljs"> roles/nginx-front/templates/nginx.conf.j2</code> </pre> <br><p>  Apparently this is a template with a minimally configured set of parameters, even not specifically configured.  Also a very necessary file: </p><br><pre> <code class="hljs"> roles/nginx-front/templates/vhosts.conf.j2</code> </pre> <br><p>  Consider it in more detail. </p><br><pre> <code class="hljs markdown">upstream php-front { {% for upstream in groups[<span class="hljs-string"><span class="hljs-string">"front_app"</span></span>] %} server {{ hostvars[<span class="hljs-string"><span class="hljs-string">upstream</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">"ansible_host"</span></span>] }}:9000; {% endfor %} }</code> </pre> <br><p>  We configure our balancer in the simplest way, for a more serious configuration, you can add variables to the hosts and add our balancer, taking into account additional variables. </p><br><p>  The virtual host uses upstream php-front. </p><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">fastcgi_pass</span></span> php-front;</code> </pre> <br><p>  Apply these settings to our front. </p><br><pre> <code class="hljs matlab">ansible-playbook -<span class="hljs-built_in"><span class="hljs-built_in">i</span></span> hosts/prod.ini task/nginx/front.yml</code> </pre> <br><p>  Now our front has started sending requests to our front app! <br>  But there is still nothing .... </p><br><h2 id="servisy">  Services </h2><br><p>  Our front app is also a service like other services, it just accepts a request from the Internet, so it is configurable like all other services. </p><br><p>  in the hosts / group_vars / folder, according to the group name, there are group configuration files </p><br><pre> <code class="hljs smalltalk"><span class="hljs-symbol"><span class="hljs-symbol">#hosts</span></span>/group_vars/front_app.yml service_name: front_app deploy_via: git repo: <span class="hljs-string"><span class="hljs-string">'https://github.com/dangerousvasil/simpleFront'</span></span> branch: <span class="hljs-string"><span class="hljs-string">'master'</span></span> keep_releases: <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><p>  also common hosts / group_vars / all.yml configurations </p><br><pre> <code class="hljs cs"> releases_path: <span class="hljs-string"><span class="hljs-string">'/var/www'</span></span> current_release_dir: <span class="hljs-string"><span class="hljs-string">'www'</span></span> application_configuration_path: <span class="hljs-string"><span class="hljs-string">'/etc/application/config.ini'</span></span> keep_releases: <span class="hljs-number"><span class="hljs-number">0</span></span> apt_cache_valid_time: <span class="hljs-number"><span class="hljs-number">86400</span></span> www_user: <span class="hljs-string"><span class="hljs-string">'www-data'</span></span></code> </pre> <br><p>  Here we can specify where to deploy the application code and configuration file and many other configurations that you will need later. </p><br><p>  Run the task to update the application code </p><br><pre> <code class="hljs pgsql"> ansible-playbook -i hosts/prod.ini task/app/code-<span class="hljs-keyword"><span class="hljs-keyword">update</span></span>.yml</code> </pre> <br><p>  Now our application is ready to receive the first requests to the front!  We can also go to our VM and see where our default code is </p><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-variable"><span class="xml"></span><span class="hljs-template-variable">{{ releases_path }}</span></span><span class="xml"><span class="xml">/</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ service_name }}</span></span><span class="xml"><span class="xml">/</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ current_release_dir }}</span></span><span class="xml"><span class="xml"> /var/www/front_app/www</span></span></code> </pre> <br><p>  Going to the machine, we will see that this folder is a link that leads to another folder / 20171024121418Z, this is done so that we can always roll back the changes to the last successful release </p><br><pre> <code class="hljs swift">lrwxrwxrwx /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/www/front_app/www -&gt; /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/www/front_app/releases/20171024121418Z releases: total <span class="hljs-number"><span class="hljs-number">40</span></span> drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> 20171024121418Z drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> 20171024120329Z drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> 20171024112918Z drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> 20171024104100Z drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> 20171024102800Z drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> 20171024102702Z drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> 20171024102548Z drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> 20171024102458Z drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> 20171024095629Z drwxr-xr-x <span class="hljs-number"><span class="hljs-number">2</span></span> 20171024094949Z</code> </pre> <br><p>  There is a task for this. </p><br><pre> <code class="hljs pgsql">ansible-playbook -i hosts/prod.ini task/app/code-<span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span>.yml</code> </pre> <br><p>  This will move our link to the previous release, if it was, or throw an exception.  If you run the task again, it will move the link further until the releases end. </p><br><h2 id="balanser">  Balancer </h2><br><p>  The code is laid out, the front is configured, the matter remains small - the balancer of services. <br>  While we use 1, we can add a few more and banas between them using different ddns or HAProxy tools, or just randomly choose a server on the side of the application - you decide. </p><br><p>  Run the task </p><br><pre> <code class="hljs matlab">ansible-playbook -<span class="hljs-built_in"><span class="hljs-built_in">i</span></span> hosts/prod.ini task/nginx/balancer.yml</code> </pre> <br><p>  Using the hosts / group_vars / nginx-balancer.yml file </p><br><p>  The configuration of balancing the specified services is created here, respectively, the service name matches the group in the inventory file, but it may not coincide with the service name specified in the server configuration file </p><br><pre> <code class="hljs matlab">with_services: - <span class="hljs-built_in"><span class="hljs-built_in">sign</span></span></code> </pre> <br><h2 id="okruzhenie">  Environment </h2><br><p>  In order for our application to know what surrounds it (balancers, services) we will generate a small ini file and decompose it into each machine. </p><br><pre> <code class="hljs matlab">ansible-playbook -<span class="hljs-built_in"><span class="hljs-built_in">i</span></span> hosts/prod.ini task/app/app_config.yml</code> </pre> <br><pre> <code class="hljs ruby">$ cat /etc/application.ini [application] service.host[]=<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">56.102</span></span></code> </pre> <br><p>  Now our application knows who is responsible for communication with services, here you can add other settings for your application. </p><br><h2 id="testirovanie">  Testing </h2><br><p>  Opening our front in the browser <a href="http://192.168.56.102/">http://192.168.56.102</a> we will see an ugly picture </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(<span class="hljs-number"><span class="hljs-number">14</span></span>) <span class="hljs-string"><span class="hljs-string">"192.168.56.104"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>(<span class="hljs-number"><span class="hljs-number">191</span></span>) <span class="hljs-string"><span class="hljs-string">"HTTP/1.1 200 OK Server: nginx/1.10.3 (Ubuntu) Date: Wed, 25 Oct 2017 09:51:43 GMT Content-Type: text/html; charset=UTF-8 Transfer-Encoding: chunked Connection: keep-alive &lt;h1&gt;API&lt;/h1&gt;"</span></span></code> </pre><br><p>  For some, this seems to be complete nonsense, and someone will see that our service has written us its 3 big letters "API" and will be delighted. </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  If you added your project as a front and wrote a couple of lines there or connected a couple of libraries to work with services via json-rpc (you probably understand PHP and this will help you a lot) </p><br><pre> <code class="hljs ruby">$ch = curl_init(); curl_setopt($ch, CURLOPT_URL, <span class="hljs-string"><span class="hljs-string">'http://'</span></span> . $serviceHost); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> balancer $header[] = <span class="hljs-string"><span class="hljs-string">"Host: service"</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   @curl_setopt($ch, CURLOPT_HTTPHEADER, $header); $output = curl_exec($ch); var_dump($output);</code> </pre> <br><p>  Option with the library fguillot / json-rpc </p><br><pre> <code class="hljs ruby">$client = new Client(<span class="hljs-string"><span class="hljs-string">'http://'</span></span> . $serviceHost); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> balancer $http = $client-&gt;getHttpClient() -&gt;withHeaders([<span class="hljs-string"><span class="hljs-string">'Host: service'</span></span>]); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> service</code> </pre><br><p>  So congratulations, you plunged your project into the most fashionable and youth trend of the SOA season. </p><br><h3 id="post-skriptum">  Post Scriptum </h3><br><p>  The project code still requires a lot of improvements and configurations, so only basic configurations are made for it to work. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/341016/">https://habr.com/ru/post/341016/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341002/index.html">Installing FlexLM on Ubuntu Server 16</a></li>
<li><a href="../341004/index.html">Computer predicted the victory of the United States in Vietnam</a></li>
<li><a href="../341006/index.html">Super expressive code involving levels of abstractions</a></li>
<li><a href="../341008/index.html">Interview with Pavel Golubev (Appodeal) about publishers, monetization and advertising mediation</a></li>
<li><a href="../341014/index.html">Swift 4 - weak links</a></li>
<li><a href="../341020/index.html">The first deployment: how was the DevOops 2017 conference</a></li>
<li><a href="../341022/index.html">1st laboratory work of the program Data Engineer</a></li>
<li><a href="../341024/index.html">Bash recorder for cameras with rtsp</a></li>
<li><a href="../341026/index.html">What is Spring Cloud and how to cook it - an interview with Evgeny Borisov and Kirill Tolkachev</a></li>
<li><a href="../341028/index.html">Prototyping on production technologies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>