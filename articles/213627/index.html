<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>YM modular system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Another one? What for? Are there CommonJS and AMD? Guards can pass under the cat. 


 I will not go into why modules and modular systems are needed at...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>YM modular system</h1><div class="post__text post__text-html js-mediator-article">  Another one?  What for?  Are there CommonJS and AMD?  Guards can pass under the cat. <br><a name="habracut"></a><br><br>  I will not go into why modules and modular systems are needed at all; there is an article on this article, <a href="http://habrahabr.ru/post/181536/">The JavaScript module path</a> from <a href="https://habrahabr.ru/users/azproduction/" class="user_link">azproduction</a> , let's go straight to the main <a href="https://habrahabr.ru/users/azproduction/" class="user_link">point</a> : why another modular system?  After all, there are already CommonJS and AMD.  But both of them have one drawback, which for most of the projects in which I participate is, if neither fatal, then very uncomfortable - they, one way or another, are more or less synchronous.  And we often had situations when it was necessary to invent and write crutches, allowing to bypass this drawback. <br><br>  Consider a simple example: we have modules <i>moduleA</i> , <i>moduleB</i> , <i>moduleC</i> , and the latter depends on the previous two. <br>  To begin with, we will write the code describing these modules for all three modular systems: CommonJS, AMD, YM. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Commonjs </h5><br>  <i>moduleA.js:</i> <br><pre><code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-string"><span class="hljs-string">'A'</span></span>;</code> </pre> <br>  <i>moduleB.js:</i> <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-string"><span class="hljs-string">'B'</span></span>;</code> </pre><br>  <i>moduleC.js:</i> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> moduleA = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'A'</span></span>), moduleB = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'B'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = moduleA + moduleB + <span class="hljs-string"><span class="hljs-string">'C'</span></span>;</code> </pre><br>  Connection and use: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> moduleC = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'C'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(moduleC); <span class="hljs-comment"><span class="hljs-comment">// prints "ABC"</span></span></code> </pre><br><br><h5>  AMD </h5><br>  <i>moduleA.js:</i> <br><pre> <code class="javascript hljs">define(<span class="hljs-string"><span class="hljs-string">'A'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'A'</span></span>; });</code> </pre><br>  <i>moduleB.js:</i> <br><pre> <code class="javascript hljs">define(<span class="hljs-string"><span class="hljs-string">'B'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'B'</span></span>; });</code> </pre><br>  <i>moduleC.js:</i> <br><pre> <code class="javascript hljs">define(<span class="hljs-string"><span class="hljs-string">''</span></span>, [<span class="hljs-string"><span class="hljs-string">'A'</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">moduleA, moduleB</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> moduleA + moduleB + <span class="hljs-string"><span class="hljs-string">'C'</span></span>; });</code> </pre><br>  Connection and use: <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>([<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">moduleC</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(moduleC); <span class="hljs-comment"><span class="hljs-comment">// prints "ABC" });</span></span></code> </pre><br><br><h5>  YM </h5><br>  <i>moduleA.js:</i> <br><pre> <code class="javascript hljs">modules.define(<span class="hljs-string"><span class="hljs-string">'A'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provide</span></span></span><span class="hljs-function">) </span></span>{ provide(<span class="hljs-string"><span class="hljs-string">'A'</span></span>); });</code> </pre><br>  <i>moduleB.js:</i> <br><pre> <code class="javascript hljs">modules.define(<span class="hljs-string"><span class="hljs-string">'B'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provide</span></span></span><span class="hljs-function">) </span></span>{ provide(<span class="hljs-string"><span class="hljs-string">'B'</span></span>); });</code> </pre><br>  <i>moduleC.js:</i> <br><pre> <code class="javascript hljs">modules.define(<span class="hljs-string"><span class="hljs-string">'C'</span></span>, [<span class="hljs-string"><span class="hljs-string">'A'</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provide, moduleA, moduleB</span></span></span><span class="hljs-function">) </span></span>{ provide(moduleA + moduleB + <span class="hljs-string"><span class="hljs-string">'C'</span></span>); });</code> </pre><br>  Connection and use: <br><pre> <code class="javascript hljs">modules.require([<span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">moduleC</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(moduleC); <span class="hljs-comment"><span class="hljs-comment">// prints "ABC" });</span></span></code> </pre><br><br>  So far, nothing interesting.  All three examples are equivalent.  Now, pay attention to one detail in YM modules ‚Äî the <i>provide</i> function is transferred to the callback function of the module declaration.  It is especially unclear why it is there, but now imagine a situation where the modules <i>moduleA</i> and <i>moduleB</i> cannot split up immediately, synchronously (as required by both CommonJS and AMD), that for this they need to perform some kind of asynchronous action.  For simplicity, let it be <code>setTimeout</code> .  With the help of YM, the previous example can be easily rewritten as follows (which cannot be expressed either by CommonJS or AMD, although the latter even contains <i>Asynchronous</i> in the title, but it only affects the declaration method and the method of requiring the module): <br><br>  <i>moduleA.js:</i> <br><pre> <code class="javascript hljs">modules.define(<span class="hljs-string"><span class="hljs-string">'A'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provide</span></span></span><span class="hljs-function">) </span></span>{ setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ provide(<span class="hljs-string"><span class="hljs-string">'A'</span></span>); }); });</code> </pre><br>  <i>moduleB.js:</i> <br><pre> <code class="javascript hljs">modules.define(<span class="hljs-string"><span class="hljs-string">'B'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provide</span></span></span><span class="hljs-function">) </span></span>{ setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ provide(<span class="hljs-string"><span class="hljs-string">'B'</span></span>); }); });</code> </pre><br>  <i>moduleC.js:</i> <br><pre> <code class="javascript hljs">modules.define(<span class="hljs-string"><span class="hljs-string">'C'</span></span>, [<span class="hljs-string"><span class="hljs-string">'A'</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provide, moduleA, moduleB</span></span></span><span class="hljs-function">) </span></span>{ provide(moduleA + moduleB + <span class="hljs-string"><span class="hljs-string">'C'</span></span>); });</code> </pre><br>  In this case, we note that the <i>moduleC</i> itself <i>knows</i> nothing at all about the asynchronous nature of <i>moduleA</i> and <i>moduleB</i> .  Profit. <br><br><h5>  Life example </h5><br>  From a synthetic example, let's move on to the real one.  In projects, we use the Yandex.Map API, which in principle does not know how to boot synchronously (inside it uses multi-stage loading).  This means that it is impossible to simply write and hope that all my subsequent scripts will be able to work with ready-made api.  To get started, you need to wait for the event <code>ymaps.ready</code> .  Our project is quite complicated, and we use quite a lot of inheritance from the base classes from api.  Consider the example of one of them.  We have our own layer class ComplexLayer, which we want to inherit from the base layer of ymaps: <code>ymaps.Layer</code> .  With the help of YM, this is done simply: we define the module ymaps, which loads the API, then it waits for the desired event (ymaps.ready) and then it will provide itself.  All modules that depended on the api module (ymaps) begin their rezolving only after that.  Thus, our modules, again, do not know anything about the asynchronous nature of the Yandex.Maps API.  No crutches in the code! <br><br>  ymaps.js: <br><pre> <code class="javascript hljs">modules.define( <span class="hljs-string"><span class="hljs-string">'ymaps'</span></span>, [<span class="hljs-string"><span class="hljs-string">'loader'</span></span>, <span class="hljs-string"><span class="hljs-string">'config'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provide, loader, config</span></span></span><span class="hljs-function">) </span></span>{ loader(config.hosts.ymaps + <span class="hljs-string"><span class="hljs-string">'/2.1.4/?lang=ru-RU&amp;load=package.full&amp;coordorder=longlat'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ymaps.ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ provide(ymaps); }); }); });</code> </pre><br>  The code of the <i>loader</i> and <i>config</i> modules is not given here: the first is able to load scripts by urla, the second is just a hash of constants. <br><br>  ComplexLayer.js: <br><pre> <code class="javascript hljs">modules.define(<span class="hljs-string"><span class="hljs-string">'ComplexLayer'</span></span>, [<span class="hljs-string"><span class="hljs-string">'inherit'</span></span>, <span class="hljs-string"><span class="hljs-string">'ymaps'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provide, inherit, ymaps</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ComplexLayer = inherit(ymaps.Layer, ...); provide(ComplexLayer); });</code> </pre><br>  We do the same if, for example, we need a dependency on jQuery. <br>  Define the <i>jquery</i> module: <br><pre> <code class="javascript hljs">modules.define( <span class="hljs-string"><span class="hljs-string">'jquery'</span></span>, [<span class="hljs-string"><span class="hljs-string">'loader'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">provide, loader</span></span></span><span class="hljs-function">) </span></span>{ loader(<span class="hljs-string"><span class="hljs-string">'//yandex.st/jquery/2.1.0/jquery.min.js'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ provide(jQuery.noConflict(<span class="hljs-literal"><span class="hljs-literal">true</span></span>)); }); });</code> </pre><br>  And we use the dependence on the <i>jquery</i> module in all other modules. <br><br>  Thus, the entire code of our project is only modules, no globality, no agreement on how to connect other scripts (including third-party) or other modules, no crutches about asynchrony. <br><br>  In the end, I bring api of our modular system YM (in fact, there are several more methods, only the main ones are given here): <br><br><h6>  Module declaration </h6><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> modules.define( <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> moduleName, [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>[] dependencies], <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span> objectToProvide) provide, [<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span> resolvedDependency, ...], [<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span> previousDeclaration] ) declarationFunction )</code> </pre><br><h6>  Module connection </h6><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> modules.require( <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>[] dependencies, <span class="hljs-built_in"><span class="hljs-built_in">Function</span></span>( [<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span> resolvedDependency, ...] ) callbackFunction )</code> </pre><br><br>  Project repository: <a href="https://github.com/ymaps/modules">github.com/ymaps/modules</a> </div><p>Source: <a href="https://habr.com/ru/post/213627/">https://habr.com/ru/post/213627/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../213613/index.html">An office in Berlin, how Russian startups differ from German ones - and why do we need geoservices for the good old shops offline?</a></li>
<li><a href="../213615/index.html">Ridding our world of long shadows</a></li>
<li><a href="../213617/index.html">How we caught sea crucians, or review of Huawei OceanStor Dorado2100 G2</a></li>
<li><a href="../213621/index.html">5 risks in implementing BPM</a></li>
<li><a href="../213625/index.html">Oktodon keyboard and world record</a></li>
<li><a href="../213629/index.html">Screenshot Editor at Yandex.Disk</a></li>
<li><a href="../213633/index.html">Belarusian companies were demanded to certify sold information security tools</a></li>
<li><a href="../213635/index.html">Electronics manufacturing in China - what to expect? (part two)</a></li>
<li><a href="../213639/index.html">Hex editor reference material 010 Editor: templates</a></li>
<li><a href="../213645/index.html">Python-digest # 15. News, interesting projects, articles and interviews [February 18, 2013 - February 23, 2014]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>