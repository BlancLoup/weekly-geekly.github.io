<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Daily backup Atlassian JIRA and Confluence for Windows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Task: 


- Daily backup mysql database for JIRA and Confluence; 
- Daily backup of the directory with attachments; 
- Archiving all made backups; 
- D...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Daily backup Atlassian JIRA and Confluence for Windows</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/1b311ed2/13bbaed6/b3a5fa06/9a4e8709.png"><img src="https://habrastorage.org/storage1/0229a6c8/55d14a50/798ad8d7/20d0a1e9.png"><br><br>  <b>Task:</b> <br><ul><li>  Daily backup mysql database for JIRA and Confluence; </li><li>  Daily backup of the directory with attachments; </li><li>  Archiving all made backups; </li><li>  Delete old backups. </li></ul><br><br>  I will make a reservation that I needed to do this for Windows and I understand that everything is easier and faster for Linux.  Also, if you are an administrator, then this topic is unlikely to be interesting to you and you will not learn anything new.  But you can use the written, as a ready and proven solution. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  First, let's define the variables: <br><pre><code class="bash hljs">::   Attachments  JIRA  Confluence <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> attachments=<span class="hljs-string"><span class="hljs-string">"C:\Program Files\Atlassian\Application Data\JIRA\data"</span></span> ::,     backups <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> backup_folder=D:\Backups\Atlassian\JIRA\daily_backups ::   mysqldump.exe <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> mysqldump_path=<span class="hljs-string"><span class="hljs-string">"C:\Program Files\MySQL\MySQL Server 5.5\bin\mysqldump.exe"</span></span> ::  MySQL <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dbuser=root ::   MySQL <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dbpass=&lt;change password&gt; ::  ,     (JIRA  Confluence) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dbname=jiradb</code> </pre> <br><br>  Each backup should have a unique name, for its generation you can use the year, month, day and time interval. <br><pre> <code class="bash hljs">For /f <span class="hljs-string"><span class="hljs-string">"tokens=2-4 delims=/ "</span></span> %%a <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'date /t'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dt=%%c-%%a-%%b) For /f <span class="hljs-string"><span class="hljs-string">"tokens=1-4 delims=:."</span></span> %%a <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'echo %time%'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> tm=%%a%%b%%c%%d) <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> backupdate=%1%dt%_%tm% <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> date_folder=%1%dt%</code> </pre><br><br>  You can adjust your name as you like, in my case the format is: [db name] .YYYY-MM-DD_tt <br><br>  I started the variable <strong>date_folder</strong> so that the folder YYYY-MM-DD is created every day and the backups are added to it. <br><br>  Accordingly, if there is no directory, then create it: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exist %backup_folder%\%date_folder% GOTO NODIR mkdir %backup_folder%\%date_folder% :NODIR</code> </pre><br><br>  Next, we perform the usual backup database using mysqldump, archive with 7zip and delete the archived file. <br><pre> <code class="bash hljs">%mysqldump_path% --user=%dbuser% --password=%dbpass% --databases %dbname% &gt; <span class="hljs-string"><span class="hljs-string">"%backup_folder%\%date_folder%\%dbname%.%backupdate%.sql"</span></span> <span class="hljs-string"><span class="hljs-string">"zip\7za.exe"</span></span> a -tzip <span class="hljs-string"><span class="hljs-string">"%backup_folder%\%date_folder%\%dbname%.%backupdate%.zip"</span></span> <span class="hljs-string"><span class="hljs-string">"%backup_folder%\%date_folder%\*.sql"</span></span> del <span class="hljs-string"><span class="hljs-string">"%backup_folder%\%date_folder%\*.sql"</span></span></code> </pre><br><br>  Do not forget to archive the folder with attachments: <br><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">"zip\7za.exe"</span></span> a -tzip %backup_folder%\%date_folder%\attachments.%backupdate%.zip %attachments%</code> </pre><br><br>  And all we have to do is remove the old directories (over 14 days). <br><pre> <code class="bash hljs">forfiles -p %backup_folder% -s -d -14 -c <span class="hljs-string"><span class="hljs-string">"cmd /c if @isdir == TRUE rd /s /q @path"</span></span></code> </pre><br><br>  All we have to do is to feed this bat file to the Windows Task Sheduler and indicate that the task should work every day. <br><br>  PS If the task does not work, check that there is a tick that the task should be performed even when the user on whose behalf the task is launched is not logged in and that this user has write permissions.  Also, do not forget to specify that the task is executed in the directory in which the script resides.  (For tasks, this is an optional parameter, but without this, the task was executed, but the script did not run.) <br><br>  PPS If anyone found the script useful, then you can download it here: <a href="">download</a> </div><p>Source: <a href="https://habr.com/ru/post/131893/">https://habr.com/ru/post/131893/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131884/index.html">jQuery 1.7 Released</a></li>
<li><a href="../131887/index.html">How should the #followfriday hashtag work</a></li>
<li><a href="../131889/index.html">Sliding Screens with ViewPager</a></li>
<li><a href="../131890/index.html">Java codec dedicated</a></li>
<li><a href="../131892/index.html">Qt Developer Days 2011, Munich</a></li>
<li><a href="../131894/index.html">Canobuvosti, 116th edition</a></li>
<li><a href="../131895/index.html">A little bit about HTML5</a></li>
<li><a href="../131901/index.html">7 reasons to upgrade from Drupal to Yii</a></li>
<li><a href="../131902/index.html">Free licenses are delaying the advent of bright times without the tyranny of copyright?</a></li>
<li><a href="../131903/index.html">Theft of information from the smartphone screen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>