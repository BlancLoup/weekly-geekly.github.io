<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Topological" sorting graph with cycles</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The full title of the article was supposed to sound like ‚ÄúStable‚Äú topological ‚Äùsorting of a graph with cycles by O(|V| + |e| log |e|) by time and O(|V...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Topological" sorting graph with cycles</h1><div class="post__text post__text-html js-mediator-article"> The full title of the article was supposed to sound like ‚ÄúStable‚Äú topological ‚Äùsorting of a graph with cycles by <code>O(|V| + |e| log |e|)</code> by time and <code>O(|V|)</code> by memory without recursion‚Äù, but I was told what is bust. <br><a name="habracut"></a><br>  Disclaimer: I am a programmer, not a mathematician, so in some places inaccurate wording is possible, for which you can and should kick. <br><br><h3>  The essence of the task </h3><br>  I will analyze the formulation of the problem, the solution of which I want to share, in parts. <br><br>  <b><a href="https://en.wikipedia.org/wiki/Topological_sorting">Topological sorting</a></b> is the ordering of the vertices of a directed acyclic graph, in which each of the vertices from which the edge extends comes earlier than the vertex into which this edge enters.  There are two important nuances: a graph can have <em>more than one</em> such orderings and it applies only to <em>acyclic</em> graphs.  Mathematicians are not worried, but programmers sometimes want determinism and a little more than ‚Äúsorry, you have a cycle here, there will be no sorting for you‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Therefore, we add the requirement of <b>stability</b> : a pair of vertices, the order between which is not specified by the edges of the graph, must be determined by the order in which these same vertices arrived at the input of the algorithm.  As a result, repeated sorts will not change the order of the vertices. <br><br>  With the absence of <b>recursion,</b> everything is simple, the computer is significantly weaker than the Turing machine, and the memory (and especially the stack) is limited.  Therefore, in application programming, usually iterative algorithms are preferable to recursive ones. <br><br>  And, finally, I will define what I call ‚Äútopological‚Äù sorting if there are <b>cycles</b> in the graph.  This is the ordering of the vertices, which coincides with the true topological sorting, if each of the cycles is replaced by one vertex, and the vertices of the cycle itself, in accordance with the requirement of stability, are located relative to each other in the original order. <br><br>  And now <s>with all this garbage, we will try to take off,</s> I <s>will</s> do it all within the limits specified in the beginning of the post time and memory restrictions. <br><br><h3>  Search for a solution </h3><br>  If you look at the existing topological sorting <a href="https://en.wikipedia.org/wiki/Topological_sorting">algorithms</a> ( <a href="https://en.wikipedia.org/wiki/Topological_sorting">Kahn's algorithm</a> , <a href="https://en.wikipedia.org/wiki/Topological_sorting">search in depth</a> ), it turns out that they all, if there is a cycle, say "I can not" and stop working. <br><br>  Therefore, let us go on the other hand, with algorithms that can do something intelligible with cycles.  For example, <em>find</em> them.  Among the <a href="https://en.wikipedia.org/wiki/Strongly_connected_component">algorithms for searching cycles in graphs</a> listed in Wikipedia, <a href="https://en.wikipedia.org/wiki/Tarjan%2527s_strongly_connected_components_algorithm">Tarjan‚Äôs algorithm</a> attracted attention.  It contains an interesting remark that, as a by-product, the algorithm produces the <em>inverse</em> topological graph sorting: <br><blockquote>  In the case of a successor.  Therefore, it was <em>strongly connected</em> . </blockquote>  True, the algorithm is recursive and it is not clear that it has stability, but this is clearly a movement in the right direction.  When reading Wikipedia more attentively, it reveals a reference to the article <a href="">A</a> by the authorship of Comrade David Pierce, in which it is not enough that there is an imperative algorithm, but also with reduced memory requirements compared to the classical Tarjan algorithm.  The bonus is the <a href="">implementation of the algorithm in Java</a> .  We must take! <br><br><div class="spoiler">  <b class="spoiler_title">Algorithm PEA_FIND_SCC3 (V, E) from Pierce's article</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/wq/44/il/wq44iloqbs-c5f4qxqabj710a2c.png"><br></div></div><br>  So, we have a list of vertices at the input and (thanks to Pierce) a certain index of the strong connected component to which this vertex belongs to the output.  The next step is to stably sort the vertices according to the sequence number of their component.  There is an algorithm for such a task; it is called <a href="https://en.wikipedia.org/wiki/Counting_sort">sorting by calculation</a> , performing it in <code>O(n)</code> time. <br><br>  In the process of collecting the algorithm in a heap, it turned out that from Tarjan the fact that it is natural for him to give <em>back the</em> topological sorting ‚Äî that the neighboring branches of the graph (not having an order relationship) ‚Äînumber the graph backwards, not really having any connections with each other, are in the reverse order ... <br><br><h3>  Answer </h3><br>  So, the final decision: <br><br><ol><li>  We number the vertices of the source list. <code>O(|V|)</code> </li><li>  We sort the edges of each of the vertices according to the number of the vertex where the edge goes. <code>O(|e| log |e|)</code> </li><li>  Using the Pierce algorithm, we find and number the components of strong connectivity. <code>O(|V|)</code> </li><li>  Using sorting by counting, sort the vertices on the basis of the numbers of the components of the strong connectivity they received. <code>O(|V|)</code> </li></ol><br>  <a href="">The code on GitHub, Java, public domain</a> .  It can be noted that in order to ensure the stability of sorting, the Pierce algorithm is slightly modified and goes around the vertices in the reverse order. <br><br><h3>  But why??? </h3><br>  And now the background, why it all took.  When loading / unloading dynamic libraries (.so), glibc, you need to decide in which order to initialize the static variables.  Variables depend on each other, depend on various functions, etc.  In general, all this forms the same graph in which there are cycles and which must be sorted. <br><br>  Once upon a time, this task was dealt with by a rather non-optimal code that performed the task in <code>O(n^2)</code> .  And in general, it didn‚Äôt really bother anyone, until in 2012 it was <a href="https://sourceware.org/bugzilla/show_bug.cgi%3Fid%3D13882">discovered</a> that the code was not working correctly and was mistaken in some cases. <br><br>  Severe men from RedHat thought-thought and screwed on top some more cycles.  Problem cases have been fixed, but the algorithm has already started working for <code>O(n^3)</code> , and this has already become noticeable and in some applications it has taken a few to tens of seconds, about which in 2013 a <a href="https://sourceware.org/bugzilla/show_bug.cgi%3Fid%3D15310">bug</a> was introduced.  Also, the author of the bug found cases in which the algorithm with <code>O(n^3)</code> <a href="https://sourceware.org/bugzilla/show_bug.cgi%3Fid%3D15311">also wrong</a> .  He suggested using Tarjan‚Äôs algorithm, although the patch with corrections was never issued. <br><br>  As time went on, glibc mercilessly braked and in 2015 there <a href="https://sourceware.org/bugzilla/show_bug.cgi%3Fid%3D17645">was another attempt to fix the algorithm</a> .  Unfortunately unsuccessful, the algorithm was chosen <code>O(n^2)</code> , besides it was confused by the branches of the graph, between which the order is not defined. <br><br>  Today is the year 2019, and glibc is still slowing down.  Judging by how much time it took for me to correct the task, the chances that I will complete it are significantly lower than 100%.  Everything is aggravated by the fact that it happens on C, without IDE support, in the code with the GNU coding style, the insane test runner (‚Äúand if you want to run the test again, just delete the corresponding .out file‚Äù).  And in order for glibc to even take a look at your patch, you need to go through the procedure of <a href="https://sourceware.org/glibc/wiki/Contribution%2520checklist">copyright assignment</a> , correctly patch the patch and the devil knows what else.  Therefore, in order to at least remove the issue with the invention of the algorithm that solves the problem, this post was written. </div><p>Source: <a href="https://habr.com/ru/post/451208/">https://habr.com/ru/post/451208/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451186/index.html">LINSTOR repository and its integration with OpenNebula</a></li>
<li><a href="../451196/index.html">Separation of customer profiles and freelancer</a></li>
<li><a href="../4512/index.html">Google is interested in weddings</a></li>
<li><a href="../451204/index.html">Free text editors for collaboration</a></li>
<li><a href="../451206/index.html">What is happening with RDF repositories?</a></li>
<li><a href="../451210/index.html">Jira integration with GitLab</a></li>
<li><a href="../451212/index.html">Arc protection system with the ability to operate on a current signal</a></li>
<li><a href="../451214/index.html">Fundamentals of modern artificial intelligence: how it works, and whether our society will destroy this year?</a></li>
<li><a href="../451216/index.html">How to completely disable Windows Defender on Windows 10</a></li>
<li><a href="../451220/index.html">Technical details of recent Firefox extensions crash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>