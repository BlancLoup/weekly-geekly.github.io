<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make friends MD5 in Java and PHP for UTF8 strings</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Preamble 
 Somehow, my company decided to integrate a forum written in PHP with our employee management system written in Java. To integrate in this c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make friends MD5 in Java and PHP for UTF8 strings</h1><div class="post__text post__text-html js-mediator-article"><h4>  Preamble </h4><br>  Somehow, my company decided to integrate a forum written in PHP with our employee management system written in Java.  To integrate in this case is to update the employee‚Äôs account on the forum in case of changes in his data in our system.  And they entrusted this business to me (the PHP part) and to my colleague Ivan (the Java part).  I create a small web API, it writes a function that, in case of changes in the employee‚Äôs data in our system, accesses the API and updates the employee‚Äôs account on the forum.  The task is small, 3 days from the strength to write and debug everything.  Naturally, we didn‚Äôt want to mess with coding - there‚Äôs nothing secret about the name, position, work phone, and other employee data.  But somehow it was necessary to protect oneself from the fact that someone else could access the API and change the employee‚Äôs data.  It was decided to sign the message using magic phrase.  As the magic phrase, it was decided to take MD5 (login + position + salt), where salt (salt) is a kind of constant string.  We implemented all of this, started testing - and it turned out that MD5 calculated for some employee in PHP does not coincide with that calculated for the same employee in our system written in Java.  Our data on both sides was in UTF8.  And I decided to figure out what was wrong. <br><a name="habracut"></a><br><br><h3>  Formulation of the problem </h3><br>  <b>Given: a</b> UTF8 encoded string from which you need to get an MD5 hash. <br>  <b>Necessary: ‚Äã‚Äãto</b> determine why MD5 hashes calculated using Java and PHP differ. <br><br><h3>  The process of finding a solution </h3><br>  Take the classic string from the manual - "Hello world!"  UTF8 encoded and will compare its hashes in PHP and Java. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  We write PHP script </h4><br>  Well, everything is simple.  Create a file in UTF8 encoding (I used Notepad ++ for this) and write the following code into it: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">&lt;?php header( <font color="#A31515">"Content-Type: text/html; charset=UTF-8"</font> ); $utf8string = <font color="#A31515">", !"</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .$utf8string. <font color="#A31515">'&lt;/pre&gt;'</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .md5($utf8string). <font color="#A31515">'&lt;/pre&gt;'</font> ; ?&gt;</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> &lt;?php header( <font color="#A31515">"Content-Type: text/html; charset=UTF-8"</font> ); $utf8string = <font color="#A31515">", !"</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .$utf8string. <font color="#A31515">'&lt;/pre&gt;'</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .md5($utf8string). <font color="#A31515">'&lt;/pre&gt;'</font> ; ?&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> &lt;?php header( <font color="#A31515">"Content-Type: text/html; charset=UTF-8"</font> ); $utf8string = <font color="#A31515">", !"</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .$utf8string. <font color="#A31515">'&lt;/pre&gt;'</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .md5($utf8string). <font color="#A31515">'&lt;/pre&gt;'</font> ; ?&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> &lt;?php header( <font color="#A31515">"Content-Type: text/html; charset=UTF-8"</font> ); $utf8string = <font color="#A31515">", !"</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .$utf8string. <font color="#A31515">'&lt;/pre&gt;'</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .md5($utf8string). <font color="#A31515">'&lt;/pre&gt;'</font> ; ?&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> &lt;?php header( <font color="#A31515">"Content-Type: text/html; charset=UTF-8"</font> ); $utf8string = <font color="#A31515">", !"</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .$utf8string. <font color="#A31515">'&lt;/pre&gt;'</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .md5($utf8string). <font color="#A31515">'&lt;/pre&gt;'</font> ; ?&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> &lt;?php header( <font color="#A31515">"Content-Type: text/html; charset=UTF-8"</font> ); $utf8string = <font color="#A31515">", !"</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .$utf8string. <font color="#A31515">'&lt;/pre&gt;'</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .md5($utf8string). <font color="#A31515">'&lt;/pre&gt;'</font> ; ?&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> &lt;?php header( <font color="#A31515">"Content-Type: text/html; charset=UTF-8"</font> ); $utf8string = <font color="#A31515">", !"</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .$utf8string. <font color="#A31515">'&lt;/pre&gt;'</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .md5($utf8string). <font color="#A31515">'&lt;/pre&gt;'</font> ; ?&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">&lt;?php header( <font color="#A31515">"Content-Type: text/html; charset=UTF-8"</font> ); $utf8string = <font color="#A31515">", !"</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .$utf8string. <font color="#A31515">'&lt;/pre&gt;'</font> ; echo <font color="#A31515">'&lt;pre&gt;'</font> .md5($utf8string). <font color="#A31515">'&lt;/pre&gt;'</font> ; ?&gt;</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Header ("Content-Type: text / html; charset = UTF-8");  I added in order not to switch the encoding in the browser (for my Apache from Denver, the default encoding was win1251, of course). <br><br>  We look in the browser that we have left: <br><blockquote>  Hello World! <br>  c446a2994f35689482651b7c7ba8b56c </blockquote><br><h5><br></h5><br><h4>  Writing a console program in Java </h4><br>  Similarly, create a file in UTF8 encoding and write the following code: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">public</font> <font color="#0000ff">class</font> Md5Tester { </li><li></li><li>  <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> main ( <font color="#2B91AF">String</font> [] args) throws java.io.UnsupportedEncodingException, java.security.NoSuchAlgorithmException { </li><li>  java.io.PrintStream sysout = <font color="#0000ff">new</font> java.io.PrintStream (System. <font color="#0000ff">out</font> , <font color="#0000ff">true</font> , <font color="#A31515">"UTF-8"</font> ); </li><li></li><li>  <font color="#2B91AF">String</font> utf8_string = <font color="#A31515">"Hello world!"</font>  ; </li><li>  sysout.println (utf8_string); </li><li></li><li>  java.security.MessageDigest md5 = java.security.MessageDigest.getInstance ( <font color="#A31515">"MD5"</font> ); </li><li>  <font color="#0000ff">byte</font> [] md5_byte_array = md5.digest (utf8_string.getBytes ()); </li><li></li><li>  <font color="#2B91AF">String</font> md5_string = <font color="#0000ff">new</font> <font color="#2B91AF">String</font> (md5_byte_array); </li><li>  sysout.println (md5_string); </li><li>  } </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br>  Run (I did this in IntelliJ IDEA): <br><blockquote>  C: \ Sun \ SDK \ jdk \ bin \ java -Didea.launcher.port = 7552 "-Didea.launcher.bin.path = C: \ Program Files (x86) \ JetBrains \ IntelliJ IDEA 8.1.3 \ bin" <b>- Dfile.encoding = UTF-8</b> ... <br>  Hello World! <br>   F  O5h  e | {  l </blockquote><br><br>  (everything that went after <b>-Dfile.encoding = UTF-8</b> in the start line I dropped so as not to clutter up the example). <b><br><br></b>  As we can see, we have md5 hash in the console but not in hexadecimal.  The first idea is to use BigInteger to get the string in hexadecimal. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  ... </li><li>  java.math.BigInteger md5_biginteger = <font color="#0000ff">new</font> java.math.BigInteger (1, md5_byte_array); </li><li>  sysout.println (md5_biginteger.toString (16)); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  Result: <br><blockquote>  Hello World! <br>  c446a2994f35689482651b7c7ba8b56c </blockquote><br>  It seems we got what we wanted.  However, let's not hurry and compare the hashes of some other string.  Take the string whose hash contains leading 0: "rbablord5".  Checking: <br><blockquote>  rbablord5 <br>  9736a8436e10bf1991927f2ffc76c12 </blockquote><br>  While the correct hash is: <font color="red">0</font> 9736a8436e10bf1991927f2ffc76c12.  Remarkably, such an error is quite frequent, it was even once in MySQL (I found a bug report in their tracker <a href="http://bugs.mysql.com/bug.php%3Fid%3D27623">bugs.mysql.com/bug.php?id=27623</a> ).  Then I realized that I was obviously inventing a bicycle, and after walking a little, I found the <a href="http://commons.apache.org/codec/">commons.apache.org/codec</a> library.  Having connected it, you can simply write: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#2B91AF">String</font> md5_string = DigestUtils.md5Hex (utf8_string); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  And get the desired result.  For those who do not want, for the sake of one md5 function, to connect an additional library to the project (there is still a lot of useful information in the library, see <a href="http://commons.apache.org/codec/api-release/index.html">commons.apache.org/codec/api-release/index.html</a> ) you can pick up the encodeHex function: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">char</font> [] DIGITS_LOWER = { <font color="#A31515">'0'</font> , <font color="#A31515">'1'</font> , <font color="#A31515">'2'</font> , <font color="#A31515">'3'</font> , <font color="#A31515">'4'</font> , <font color="#A31515">'5'</font> , <font color="#A31515">'6'</font> , <font color="#A31515">'7'</font> , <font color="#A31515">'8'</font> , <font color="#A31515">'9'</font> , <font color="#A31515">' a '</font> , <font color="#A31515">' b '</font> , <font color="#A31515">' c '</font> , <font color="#A31515">' d '</font> , <font color="#A31515">' e '</font> , <font color="#A31515">' f '</font> }; </li><li></li><li>  <font color="#0000ff">private</font> <font color="#0000ff">static</font> final <font color="#0000ff">char</font> [] DIGITS_UPPER = { <font color="#A31515">'0'</font> , <font color="#A31515">'1'</font> , <font color="#A31515">'2'</font> , <font color="#A31515">'3'</font> , <font color="#A31515">'4'</font> , <font color="#A31515">'5'</font> , <font color="#A31515">'6'</font> , <font color="#A31515">'7'</font> , <font color="#A31515">'8'</font> , <font color="#A31515">'9'</font> , <font color="#A31515">' A '</font> , <font color="#A31515">' B '</font> , <font color="#A31515">' C '</font> , <font color="#A31515">' D '</font> , <font color="#A31515">' E '</font> , <font color="#A31515">' F '</font> }; </li><li></li><li>  <font color="#0000ff">protected</font> <font color="#0000ff">static</font> String encodeHex ( <font color="#0000ff">byte</font> [] data, <font color="#0000ff">char</font> [] toDigits) { </li><li>  <font color="#0000ff">int</font> l = data.length; </li><li>  <font color="#0000ff">char</font> [] <font color="#0000ff">out</font> = <font color="#0000ff">new</font> <font color="#0000ff">char</font> [l &lt;&lt; 1]; </li><li>  <font color="#008000">// two characters form the hex value.</font> </li><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0, j = 0; i &lt;l; i ++) { </li><li>  <font color="#0000ff">out</font> [j ++] = toDigits [(0xF0 &amp; data [i]) &gt;&gt;&gt; 4]; </li><li>  <font color="#0000ff">out</font> [j ++] = toDigits [0x0F &amp; data [i]]; </li><li>  } </li><li>  <font color="#0000ff">return</font> <font color="#0000ff">new</font> String ( <font color="#0000ff">out</font> ); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><h3><br></h3><br><h3>  Conclusion </h3><br>  When organizing data exchange between two systems using different technologies / programming languages, be vigilant, do not rely on the fact that the functions implementing the same algorithms completely match the input and output data formats.  Most of the time, you will have to make an effort to dock the formats.  But you do not need to try to reinvent the wheel (like me), if both systems are quite common, then this task has already been solved by someone before you. <br><br>  <b>PS</b> I, unfortunately, lost a piece of code that was previously used in our Java system.  I remember that there was a bike with BigInteger and some not very clear (for me, in any case) checks. </div><p>Source: <a href="https://habr.com/ru/post/73952/">https://habr.com/ru/post/73952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../73944/index.html">Serious talk about VLC</a></li>
<li><a href="../73945/index.html">RAR: creating a store archive</a></li>
<li><a href="../73946/index.html">On various plugins and tips on the "wonderful" weaning of Firefox to eat RAM</a></li>
<li><a href="../73950/index.html">Billing selection for provider</a></li>
<li><a href="../73951/index.html">We write our first application in python for s60</a></li>
<li><a href="../73954/index.html">Separating the wheat from the chaff in Google Reader</a></li>
<li><a href="../73955/index.html">HTC Droid Eris Debuts November 6</a></li>
<li><a href="../73960/index.html">Turbofilm again became free, but not for long</a></li>
<li><a href="../73961/index.html">Do not want to update Firefox?</a></li>
<li><a href="../73962/index.html">qutIM 0.2. Release is ready!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>