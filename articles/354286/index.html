<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ESET: Lazarus Cyber ‚Äã‚ÄãGroup Switches to Central America</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lazarus Group gained fame after a cyber attack on Sony Pictures Entertainment in 2014. In 2017, the group remains active using a wide range of malicio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ESET: Lazarus Cyber ‚Äã‚ÄãGroup Switches to Central America</h1><div class="post__text post__text-html js-mediator-article">  Lazarus Group gained fame after a cyber attack on Sony Pictures Entertainment in 2014.  In 2017, the group remains active using a wide range of malicious tools, including the KillDisk wiper. <br><br>  Our study showed that Lazarus is most likely behind the attack on online casinos in Central America and <a href="https://blog.trendmicro.com/trendlabs-security-intelligence/new-killdisk-variant-hits-financial-organizations-in-latin-america/">some other goals</a> at the end of 2017.  In these incidents, the attackers used the same tools, including KillDisk, which was run on compromised devices. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qo/jl/xy/qojlxytnzxzy91hiq8wocfzz7la.jpeg"></div><a name="habracut"></a><br><h3>  Lazarus Tools </h3><br>  Lazarus hackers were first identified in a Novetta <a href="https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-Report.pdf">Operation Blockbuster</a> report in February 2016;  US CERT and FBI called this cyber group <a href="https://www.us-cert.gov/HIDDEN-COBRA-North-Korean-Malicious-Cyber-Activity">Hidden Cobra</a> .  The band gained wide popularity after the <a href="https://habrahabr.ru/company/eset/blog/244853/">attack on Sony Pictures Entertainment</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Subsequent attacks related to Lazarus attracted the attention of information security specialists who relied on <a href="https://www.operationblockbuster.com/resources/">Novetta materials</a> and other research ‚Äî hundreds of pages of descriptions of attackers' tools: attacks on <a href="https://www.welivesecurity.com/2017/02/16/demystifying-targeted-malware-used-polish-banks/">Polish and Mexican banks</a> , <a href="https://www.malwaretech.com/2017/05/how-to-accidentally-stop-a-global-cyber-attacks.html">the WannaCry epidemic</a> , phishing <a href="https://researchcenter.paloaltonetworks.com/2017/08/unit42-blockbuster-saga-continues/">attacks on US Department of Defense contractors</a> , etc. All of these studies allow Lazarus to be identified as a source of attack. <br><br>  Please note that the list of Lazarus tools (all the files that information security specialists associate with the activity of the group) is quite wide, and we believe that there are many subfamilies of them.  Unlike the toolboxes used by other cybergroups, the source code of the Lazarus tools has never been revealed as a result of a public leak. <br><br>  In addition to special programs, Lazarus use projects that are available on GitHub or provided on a commercial basis. <br><br><h3>  Lazarus tools for attacking online casinos </h3><br>  In this section, we will look at some of the tools found on the servers and workstations of the online casino network in Central America, and explain how their relationship with Lazarus was established.  ESET antivirus products detect malware groups like Win32 / NukeSped and Win64 / NukeSped.  They were used in combination with samples of destructive KillDisk software. <br><br>  Almost all of these tools are designed to run as a Windows service.  Administrator rights are required for this, which means that attackers must have these rights during development or compilation. <br><br>  <b>TCP backdoor</b> <br><br>  Win64 / NukeSped.W is a console application installed in the system as a service.  One of the first stages of execution is the dynamic loading of the required DLL names onto the stack: <br><br><img src="https://habrastorage.org/webt/le/q_/xi/leq_xifx415mo45qxnnfvexobuc.png"><br><br>  Similarly, procedure names for the Windows API are built dynamically.  In this particular sample, they are visible as plaintext;  in other past samples that we analyzed, they were encoded in base64, encrypted or placed on the stack character-by-character: <br><br><img src="https://habrastorage.org/webt/ki/nm/pz/kinmpz9ip6fpc0g-htrwscuisqy.png"><br><br>  These signs are typical Lazarus malware traits.  Another typical feature of the Lazarus backdoor is also visible in this backdoor: it listens on a specific port, which is an indicator of firewall blocking: <br><br><img src="https://habrastorage.org/webt/4z/4z/jr/4z4zjrtt5fsoe-4cosl_alwoqfu.png"><br><br>  The backdoor supports 20 commands, the functionality of which is similar to the previously analyzed Lazarus samples (note that the command names are not set by the attackers, but were created by the ESET virus analyst): <br><br><img src="https://habrastorage.org/webt/tt/wg/dk/ttwgdkw5iuk7n1d1h0anq0adbak.png"><br><br>  The backdoor creates several files in the file system.  The listening port is stored in a text file named <code>%WINDOWS%\Temp\p</code> .  The <code>%WINDOWS%\Temp\perflog.evt</code> contains a list of paths for binary files intended for injection, execution, or writing to the registry, depending on the starting character of the line: <br><br><img src="https://habrastorage.org/webt/lc/vo/xl/lcvoxl2nkg5yxy-rr4wo0zkujdc.png"><br><br>  In the case of the ‚Äú+‚Äù option, the output <code>cmd.exe / c ¬´% s 2 ¬ª% s¬ª</code> (or <code>cmd.exe / c ¬´% s ¬ª% s 2&gt;  1¬ª</code> ) is written to <code>% WINDOWS% \ Temp \ perflog.dat</code> . <br><br>  <b>Session hacker</b> <br><br>  The Win64 / NukeSped.AB console application creates a process on behalf of another user currently logged on the victim's system (similar to command number 17 from the TCP backdoor previously described). <br><br>  This is a protected version of Themida <a href="https://securelist.com/files/2017/04/Lazarus_Under_The_Hood_PDF_final.pdf">described by</a> Kaspersky Lab.  In our case, it was installed as <code>C:\ Users\public\ps.exe</code> .  It has three parameters. <br><br>  The static view shows the same file properties in both of these selections: the same PE compilation timestamp, identical Rich Header linker data (pointing to the Visual Studio 2010 linker (10.00)), and some of the version information for resources matches: <br><br><img src="https://habrastorage.org/webt/3l/am/gm/3lamgm00vrlu79mbwwnxmcpni_c.png"><br><br>  Although the PE timestamp and resources were stolen from the legitimate Microsoft <code>PREVHOST.EXE</code> file from Windows 7 SP1, there is no <code>PREVHOST.EXE</code> data available: the Microsoft source file was compiled and linked to Visual Studio 2008 (9.00). <br><br>  Our consistent dynamic analysis confirmed that this file, found in the compromised online casino network, is associated with a session hacker used in attacks against Polish and Mexican sites. <br><br>  <b>Bootloader / Installer</b> <br><br>  This is a simple command line tool that takes several parameters.  It is designed to work with processes (injection / deletion of a process using a PID or name), services (shutting down / reinstalling a service) or files (reset / deletion).  Functionality is determined by the parameters. <br><br><h3>  KillDisk Versions </h3><br>  KillDisk is the common name by which ESET products detect destructive malware with the erase disk function ‚Äî damage the boot sectors and overwrite and then delete (system) files, followed by a reboot, to make the device unusable. <br><br>  Although all versions of KillDisk have similar functions, the sample code base does not always match.  KillDisk has many subfamilies, whose names are distinguished by suffixes (in our case, Win32 / KillDisk.NBO).  Variants of subfamilies with common code fragments are sometimes used in different cyber campaigns, which may indicate a common source of attacks, as in this case. <br><br>  Other versions of KillDisk were used in targeted attacks on Ukrainian sites in <a href="https://www.welivesecurity.com/2016/01/03/blackenergy-sshbeardoor-details-2015-attacks-ukrainian-news-media-electric-industry/">December 2015</a> and <a href="https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/">December 2016</a> , but these samples belong to other subfamilies and, most likely, are not related to new attacks. <br><br>  Studying the incident in Central America, we found two Win32 / KillDisk.NBO variants in the compromised network.  Malicious software has infected more than a hundred machines in the organization.  There are several possible explanations for his appearance: the attackers could hide the traces after the attack, or use KillDisk for extortion or cyber sabotage.  In any case, this is a large-scale infection within the same organization. <br><br>  The data of our telemetry, as well as the simultaneous use of versions of Win32 / KillDisk.NBO and other well-known Lazarus tools in a compromised network indicate that it was Lazarus hackers who deployed KillDisk, and not any other cyber group. <br><br>  Analysis of the two samples showed that they have many common code fragments.  In addition, they are almost identical to the KillDisk version, which was used in attacks on financial institutions in Latin America <a href="https://blog.trendmicro.com/trendlabs-security-intelligence/new-killdisk-variant-hits-financial-organizations-in-latin-america/">studied by Trend Micro</a> . <br><br>  The KillDisk samples found on the online casino network use the following path: <code>C:\Windows\Temp\dimens.exe</code> <br><br>  The actual built-in payload is injected into the <code>werfault.exe</code> system process: <br><br><img src="https://habrastorage.org/webt/mj/ag/mu/mjagmu-k-vdebqm7sdmy44ryq1q.png"><br><br>  One of the options is protected by a third-generation commercial VMProtect, which makes unpacking difficult.  Most likely, the attackers did not buy the VMProtect license, but used the available pirated or leaked copies of the Internet.  The use of software protection tools is characteristic of the Lazarus group: in attacks on <a href="https://www.welivesecurity.com/2017/02/16/demystifying-targeted-malware-used-polish-banks/">Polish and Mexican banks</a> in February 2017, they used Enigma Protector;  Some of the Operation Blockbuster samples <a href="https://researchcenter.paloaltonetworks.com/2017/08/unit42-blockbuster-saga-continues/">reported by Palo Alto Networks</a> used an older version of VMProtect. <br><br>  <b>Typical Lazarus String Format</b> <br><br>  Among the numerous characteristics that allow us to attribute the authorship of the samples and the origin of the attacks to the Lazarus group, it is necessary to note the format of the lines.  The table below shows the formatted strings found in the above samples, as well as other TCP backdoors associated with Lazarus: <br><br><img src="https://habrastorage.org/webt/hj/d_/ak/hjd_akug9shk0id1ocp5vawmgnq.png"><br><br>  By itself, this fact cannot be proof, but, looking for similar string formatting in all malware samples collected by ESET, we found them only in samples supposedly related to Lazarus.  Therefore, we can assume that the presence of these lines indicates the authorship of Lazarus. <br><br><h3>  Additional tools </h3><br>  There are at least two tools available that attackers have used. <br><br>  <b>Browser Password Dump</b> <br><br>  This tool is designed to recover passwords from popular web browsers.  Since December 2014, he has been using old, well-known methods.  It can be used in the latest versions of Google Chrome (64.0.3282.186), Chromium (67.0.3364.0), Microsoft Edge (41.16299.15.0) and Microsoft Internet Explorer (11.0.9600.17843).  It is not compatible with the latest versions of Firefox or Opera. <br><br><img src="https://habrastorage.org/webt/b8/ko/ms/b8komsgqibajqc9837hwipa5_s8.png"><br><br>  <b>Mimikatz</b> <br><br>  The attackers also used a modified version of the Mimikatz tool designed to extract Windows credentials.  It takes one parameter - the name of the file to store the output.  If the parameter is not specified, the output file named <code>~Temp1212.tmp</code> is stored in the same directory as Mimikatz.  The output contains hashes of Windows credentials of authorized users.  The tool is often used in targeted attacks, in particular by the Telebots group <a href="https://habrahabr.ru/company/eset/blog/332058/">in the Petya epidemic</a> , as well as in <a href="https://www.welivesecurity.com/2015/04/09/operation-buhtrap/">Operation Buhtrap</a> . <br><br><img src="https://habrastorage.org/webt/vc/yz/er/vcyzer8chzh9e_0bcr8enp8tkrw.png"><br><br><h3>  Infection vector </h3><br>  Most of the tools described above were downloaded and installed on workstations using malicious droppers and loaders used in the initial stage of the attack.  In addition, we have seen indicators that indicate the use of remote access tools, including <a href="https://www.radmin.com/">Radmin 3</a> and <a href="https://www.logmein.com/">LogMeIn,</a> to monitor target devices. <br><br><h3>  findings </h3><br>  A recent attack on online casinos in Central America suggests that Lazarus hackers will recompile tools before each new campaign (we did not see identical samples anywhere else).  It was a complex multi-step attack, in which dozens of secure tools were used, which, being autonomous, hardly showed such a dynamic. <br><br>  The use of KillDisk most likely served one of two purposes: the attackers hid their tracks after the espionage operation, or used destructive software for extortion or sabotage.  In any case, the detection of malware on more than 100 workstations and servers of the organization indicates considerable resources spent by the attackers. <br><br><h3>  Samples </h3><br> <code>429B750D7B1E3B8DFC2264B8143E97E5C32803FF Win32/KillDisk.NBO <br> 7DFE5F779E46855B32612D168B9CC5334F25B5F6 Win32/KillDisk.NBO <br> 5042C16076AE6346AF8CF2B40553EEEEA98D5321 Win64/NukeSped.W trojan (VMProtect-ed) <br> 7C55572E8573D08F3A69FB15B7FEF10DF1A8CB33 Win64/NukeSped.W trojan (Themida-protected) <br> E7FDEAB60AA4203EA0FF24506B3FC666FBFF759F Win64/NukeSped.Z trojan (Themida-protected) <br> 18EA298684308E50E3AE6BB66D7321A5CE664C8E Win64/NukeSped.Z trojan (VMProtect-ed) <br> 8826D4EDBB00F0A45C23567B16BEED2CE18B1B6A Win64/NukeSped.AB trojan (Themida-protected) <br> 325E27077B4A71E6946735D32224CA0421140EF4 Win64/Riskware.Mimikatz.A application <br> D39311C74DEB60C736982C1AB74D6684DD1E1264 Win32/SecurityXploded.T (VMProtect-ed) <br> E4B763B4E74DE3EF24DB6F19108E70C494CD18C9 Win32/SecurityXploded.T (Themida-protected) <br> <br></code> </div><p>Source: <a href="https://habr.com/ru/post/354286/">https://habr.com/ru/post/354286/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354276/index.html">"End of the World" will not be</a></li>
<li><a href="../354278/index.html">Right-sided assignment and other unusual programming techniques in C #</a></li>
<li><a href="../354280/index.html">Javascript es6: write less - do more</a></li>
<li><a href="../354282/index.html">Configure BGP to bypass locks, or ‚ÄúHow I stopped being afraid and fell in love with the RKN‚Äù</a></li>
<li><a href="../354284/index.html">Basics of programming on the SAS Base. Lesson 3. Reading text files</a></li>
<li><a href="../354290/index.html">Summ3r 0f h4ck: Digital Security Internship 2018</a></li>
<li><a href="../354292/index.html">Developing a game server on Nadron</a></li>
<li><a href="../354294/index.html">PYCON RUSSIA 2018 will be held July 22-23. Save the date</a></li>
<li><a href="../354296/index.html">We charge super power Appium tests on Android</a></li>
<li><a href="../354302/index.html">Veeam Backup & Replication: 10 Tips for Beginners</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>