<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SaltStack: Pre-generation of passwords for use in services</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is the article about? 
 A short article on how to generate passwords needed for various services automatically set using SaltStack. 


 The diffi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SaltStack: Pre-generation of passwords for use in services</h1><div class="post__text post__text-html js-mediator-article"><h5>  <b>What is the article about?</b> </h5><br>  A short article on how to generate passwords needed for various services automatically set using SaltStack. <br><a name="habracut"></a><br><br><h4>  The difficulties of generating passwords. </h4><br>  Very often, it is necessary to automatically install services or applications that require specifying passwords for access to some of their parts (for example, to the web interface or to manage their API).  It is also often necessary to configure database users, which will then be used in services using these databases, etc. <br><br>  A typical problem is the generation of passwords for all such cases.  There are several solutions to this problem: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  1. Register passwords manually in the pillar file </h5><br><br>  <b>pillar / passwords.sls</b> <br><pre><code class="python hljs">service1: web-access-password: <span class="hljs-string"><span class="hljs-string">'9KTE2aN11GYOJmZGOoqV'</span></span> db-access-password: <span class="hljs-string"><span class="hljs-string">'2pGbSlSFkHPY22TwqUus'</span></span></code> </pre> <br>  Well, then in any other pillar or in the stack use the specified passwords to generate accesses. <br>  Everything seems to be normal and understandable - but there is one thing - if you spread the state using the specified pillar, the passwords will be stored in the same unchanged form.  Moreover, even all single-type servers for which this state will be used will have the same password.  Naturally, it makes no sense to explain how this may threaten from the point of view of information security. <br><br><h5>  2. Generate passwords with SaltStack. </h5><br><br>  There is one interesting <a href="http://docs.saltstack.com/en/latest/ref/modules/all/salt.modules.grains.html">function</a> in SaltStack in the grains <a href="http://docs.saltstack.com/en/latest/ref/modules/all/salt.modules.grains.html">get_or_set_hash</a> module, which can generate a password for later use of a particular grain.  Passwords are quite complex (due to the default character set, which can be overridden when called), it is easy to use them in the states (just read the corresponding grain from the minion).  The only thing worth remembering is that the password is generated only when you first call this function (and the password itself is placed in the / etc / salt / grains file), all subsequent ones will simply read this grain from the file as if the <b>salt</b> was called <b>[ 'grains.get'] ('stored-password-grain-name')</b> . <br>  One of the most significant drawbacks of this method is the inability to read the passwords generated in this way in pillar files, which is often useful when using various formulas ( <a href="https://github.com/saltstack-formulas">SaltStack Formulas</a> ). <br><br><h5>  3. Prev  password generation in pillar file </h5><br>  Another way that I use often enough is to pre-generate passwords with Jinja2. <br>  In general, for the pre.  generation is used minion installed on the same machine as Salt Master.  If you do not want to connect such a minion to the master itself, you can use the <a href="http://docs.saltstack.com/en/latest/topics/tutorials/quickstart.html">masterless</a> configuration, but I prefer to use the minion connected to the master, designating it as grains: roles: local-minion and creating a separate entry in the master configuration: <br>  <b>master / top.sls</b> <br><pre> <code class="python hljs">base: <span class="hljs-string"><span class="hljs-string">'roles:local-minion'</span></span>: - match: grain - local-minion-state</code> </pre><br><br>  The essence of the method before.  generating passwords is to create a jarja template for a pillar file with passwords (s) of the following form: <br>  <b>master / files / some-srv-password.sls.jinja2</b> <br><pre> <code class="python hljs">some-srv: password: <span class="hljs-string"><span class="hljs-string">'{{salt['</span></span>random.get_st<span class="hljs-string"><span class="hljs-string">r'](30)}}'</span></span></code> </pre><br><br>  The function get_str of the <a href="http://docs.saltstack.com/en/latest/ref/modules/all/salt.modules.mod_random.html">random</a> module is used here. <br><br>  The next step will be a description of the state for the local minion that generates the pillar password file. <br>  <b>master / local-minion-state.sls</b> <br><pre> <code class="python hljs">passwords-file: file.managed: - name: /srv/salt/pillar/some-srv-password.sls <span class="hljs-comment"><span class="hljs-comment">#   ,  pillar      - source: salt://files/some-srv-password.sls.jinja2 - template: jinja</span></span></code> </pre><br><br>  Thereafter, before applying the states, depending on the presence of the pre.  generated passwords, run the described state: <br><pre> <code class="bash hljs">~<span class="hljs-comment"><span class="hljs-comment"># salt-call --local state.sls local-minion-state # masterless or ~# salt -C 'G@roles:local-minion' state.sls local-minion-state</span></span></code> </pre><br><br>  After the execution of the state, we get a pillar file containing the generated password.  To use it, execute include in another pillar file: <br>  <b>pillar / some-srv.sls</b> <br><pre> <code class="python hljs">include: - some-srv-password some-srv: username: Fred . . .</code> </pre><br><br>  As a result, when requesting <b>salt 'minion-with-some-srv-pillar-connected' pillar.items</b> we get something like this: <br><pre> <code class="python hljs">pillar: . . . some-srv: . . . username: Fred password: AoEK8u4Uvo_r9MKtooSUxZV1Y_DLoy</code> </pre><br><br>  then you can access the password data by simply calling <b>salt ['pillar.get'] ('some-srv: password')</b> . <br><br><h4>  Conclusion </h4><br>  Due to the rather large flexibility of the SaltStack system, the solution to this problem is most likely not limited to only 3 methods described in the article - it is quite possible that you will come up with an equally productive and convenient method. <br>  In any case - I hope the description in this article is useful for beginners and not only for SaltStack users.  Good luck! </div><p>Source: <a href="https://habr.com/ru/post/254403/">https://habr.com/ru/post/254403/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254385/index.html">Based on Scott Guthrie Announcements - Azure Web Apps as a convenient and cheap way to develop</a></li>
<li><a href="../254387/index.html">AggreGate Network Manager: platform + box for umbrella monitoring of IT infrastructure</a></li>
<li><a href="../254393/index.html">How to launch a simple static site in five ‚âà five-minute steps using Node.js and Express</a></li>
<li><a href="../254397/index.html">Creating dynamic animations in WatchKit</a></li>
<li><a href="../254399/index.html">Top 10 myths of cloud technologies according to Gartner</a></li>
<li><a href="../254407/index.html">White paper on the availability of PhoneGap</a></li>
<li><a href="../254409/index.html">Payler 2.0 - work on the creation of a new site</a></li>
<li><a href="../254413/index.html">Grid, Data Grouping and OData</a></li>
<li><a href="../254415/index.html">Become the master of loading Linux</a></li>
<li><a href="../254417/index.html">How to get a neighbor or Karaoke on GStreamer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>