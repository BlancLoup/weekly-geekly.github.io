<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHDays HackQuest 2017: RanSomWare - a small cryptor on GO</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all, just came to the end of a two-week HackQuest from PHDays . Despite the predominance of tasks related to WEB, the organizers did not i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHDays HackQuest 2017: RanSomWare - a small cryptor on GO</h1><div class="post__text post__text-html js-mediator-article">  Good day to all, just came to the end of a two-week <a href="https://hackquest.phdays.com/">HackQuest</a> from <a href="https://www.phdays.ru/">PHDays</a> .  Despite the predominance of tasks related to WEB, the organizers did not ignore the tasks associated with the reverse.  The decision of one of these tasks ( <a href="https://rosnadzorcom.ru/erawmosnar">erawmosnar</a> ), I would like to consider today.  Besides, I think after <i>WannaCry</i> this topic will become even more relevant. <br>  There was only 1 hint to the task: <br><blockquote>  Warn: erawmosnar == ransomware, do not run it, if you don‚Äôt know what you doing. </blockquote><a name="habracut"></a><h3>  Let's start </h3><br>  Download the file and open it in IDA, and <s>suffer</s> go google for us over1000 unnamed functions, and apparently this is <i>Golang</i> : <br><br><img src="https://habrastorage.org/web/c11/b40/e07/c11b40e070c24b7e91e9c676e5939ba8.PNG"><br><br>  A quick search on Google showed a <a href="https://github.com/strazzere/golang_loader_assist">solution to</a> this problem.  Download the script, run it in IDA and enjoy. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/ca6/97f/9ba/ca697f9ba1674d7693b6d1114e33367b.PNG"><br><br>  Starting all the same binary, we see an invitation to enter the 8-digit PIN, and a message about its incorrectness in case of failure. <br><br><img src="https://habrastorage.org/web/1e0/83a/eb1/1e083aeb15c44ed5a1ef004a0a6ce46f.png"><br><br>  Using this as a starting point is not difficult to find a function that handles all this.  After processing the code by the script, this function is called <i>main_main</i> . <br><br>  It all starts with the fact that a hash is written to the buffer: <br><br><img src="https://habrastorage.org/web/154/918/8c5/1549188c59da4f10882811bd8cd4039b.PNG"><br><br>  Then we are asked to enter a pin: <br><br><img src="https://habrastorage.org/web/816/e01/fce/816e01fce6ad46d789df8f9558543234.PNG"><br><br>  Then the SHA1 hash is calculated from it, and it is checked against the standard, well, then everything is simple, either we see the flag, or the contents of the current directory are encrypted: <br><br><img src="https://habrastorage.org/web/e50/466/c50/e50466c503654618b7ba59eb54123bfc.PNG"><br><br>  Set several breakpoints for clarity: <br><br><pre><code class="bash hljs">gdb-peda$ <span class="hljs-built_in"><span class="hljs-built_in">break</span></span> *0x4015B4 Breakpoint 1 at 0x4015b4 gdb-peda$ <span class="hljs-built_in"><span class="hljs-built_in">break</span></span> *0x4015D5 Breakpoint 2 at 0x4015d5 gdb-peda$ <span class="hljs-built_in"><span class="hljs-built_in">break</span></span> *0x401669 Breakpoint 3 at 0x401669 gdb-peda$</code> </pre> <br>  The first breakpoint is triggered before the <i>runtime_concatstring2</i> function <i>call</i> , some hash is sent to the stack, and our pin, along with the <i>"\ n"</i> symbol: <br><br><img src="https://habrastorage.org/web/a5e/b9f/68b/a5eb9f68be2f4cf29f730cb6cbee4a55.png"><br><br>  We press to continue, we get to the next breakpoint, where the result of the concatenation of the PIN code we entered with the salt is clearly visible: <br><br><img src="https://habrastorage.org/web/334/bbc/0ad/334bbc0ad1d64beea1ba8550251fccbf.png"><br><br>  On the third breakpoint, the hashes are simply checked.  Now having all the necessary information, it remains only to clear the hash.  Create a dictionary for enumeration: <br><br><pre> <code class="bash hljs">gh0st3rs@gh0st3rs-pc:erawmosnar$ crunch 8 8 1234567890 -o /media/DATA/passwdlst/8digits.lst</code> </pre> <br>  And run the brute force: <br><br><pre> <code class="bash hljs">gh0st3rs@gh0st3rs-pc:erawmosnar$ sudo hashcat -m 110 --hex-salt <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span> /media/DATA/passwdlst/8digits.lst</code> </pre> <br><img src="https://habrastorage.org/web/563/757/176/5637571761894b83be7f9a1cd455f974.png"><br><br>  Pin successfully picked up, it remains to pick up the flag: <br><br><img src="https://habrastorage.org/web/1d6/83f/e79/1d683fe79e6745e7969e84a163a7ff6b.png"></div><p>Source: <a href="https://habr.com/ru/post/328114/">https://habr.com/ru/post/328114/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328104/index.html">A detailed commentary by Dan Abramov on the article ‚ÄúThings that no one will tell you about React‚Äù</a></li>
<li><a href="../328106/index.html">Analysis of the report of Roman Nevolin about F #</a></li>
<li><a href="../328108/index.html">How to work with events in Flussonic</a></li>
<li><a href="../328110/index.html">How I did a "<" monoid</a></li>
<li><a href="../328112/index.html">How to learn 100 English words per day</a></li>
<li><a href="../328116/index.html">The story of creating a classic RTS at home from scratch (Part 2: "Resurrection"). Continuation of the article: GUI</a></li>
<li><a href="../328118/index.html">The story of creating a classic RTS at home from scratch (Part 2: "Resurrection") End of article: Network</a></li>
<li><a href="../328120/index.html">Hachim IntegerCache in Java 9</a></li>
<li><a href="../328122/index.html">We do GraphQL API on PHP and MySQL. Part 1: Installation, layout and queries</a></li>
<li><a href="../328126/index.html">Parallels Mac Management: Transition Difficulties</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>