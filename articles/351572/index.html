<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CleanTalk Malware Scanner - Heuristic Code Analysis</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We already talked about the launch of WordPress Security Service in a previous article . Today we want to talk about the launch of heuristic analysis ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CleanTalk Malware Scanner - Heuristic Code Analysis</h1><div class="post__text post__text-html js-mediator-article">  We already talked about the launch of WordPress Security Service in a <a href="https://habrahabr.ru/post/349420/">previous article</a> .  Today we want to talk about the launch of heuristic analysis to identify malicious code. <br><br>  The very presence of malicious code can lead to a ban in the search results or a warning in the search that the site is infected, to protect users from possibly dangerous content. <br><br>  You can find the malicious code yourself as well, but this is a lot of work and most WordPress users do not have the necessary skills to find and remove unwanted lines of code. <br><a name="habracut"></a><br>  Often, the authors of malicious code camouflage it, making it difficult to determine by signature.  The malicious code itself can be located anywhere on the site, for example, obfuscated php code in the logo.png file, and the code itself is invoked by one imperceptible line in the index.php.  Therefore, the use of plug-ins to search for malicious code is preferable. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      CleanTalk when you first scan, scans all WordPress core files, plugins and themes.  With repeated scans, only those files that have been changed since the last scan are scanned.  This saves resources and increases scanning speed. <br><br><h3>  How heuristic analysis works </h3><br>  One of the main drawbacks of the heuristic analysis is that it is quite slow, so we only use it when it is really needed.  First of all, we break the source code into lexemes (minimal language construction) and delete all unnecessary: <br><br><ol><li>  Space characters. </li><li>  Comment of various kinds. </li><li>  Not PHP code (out of &lt;? Php?&gt; Tags) </li></ol><br>  Next, we recursively simplify the code until there remains ‚Äúcomplex structures‚Äù: <br><br><ol><li>  We perform string concatenation. </li><li>  Variable substitution in variables. </li><li>  And so on </li></ol><br>  Also in the process of simplifying the code, we follow the origin of variables and much more. <br><br>  As a result, we get a clean code that can be analyzed.  It is very important that we receive the code not as a string, but as a token.  Thus, we know where the string token is located with the required text, and where is the token function. <br><br>  In terms of searching for ‚Äúbad construction‚Äù, eval for us is the difference: <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'eval("echo \"some\"")'</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  - in this case there will be no lexeme T_EVAL, <br><br>  there will be a token T_CONSTANT_ENCAPSED_STRING 'eval ("echo \" eval \ "") <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">eval</span></span>(<span class="hljs-string"><span class="hljs-string">'echo "some"'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  - and there will be.  And it is this option that we will discover. <br><br>  We are looking for such constructions, we divide them into degrees of criticality: <br><br><ol><li>  Critical: <br><ul><li>  eval </li><li>  include * and require * <br><ul><li>  with bad file extension </li><li>  nonexistent files (will be removed in the next versions) </li><li>  connection of remote files </li></ul></li></ul></li><li>  Dangerous <br><ul><li>  system </li><li>  passthru </li><li>  proc_open </li><li>  exec </li><li>  include * and require * <ul><li>  with the error suppression operator (to be removed in the next versions) </li><li>  with variables dependent on POST or GET. </li></ul></li></ul></li><li>  Suspicious <br><ul><li>  base64_encode </li><li>  str_rot13 </li><li>  syslog </li></ul><br></li><li>  Other. </li></ol><br>  We are constantly improving this analysis: we add new constructions to search, reduce the number of false positives, optimize the simplification of the code. <br><br>  The plans teach him to detect and decode strings encoded in the URL and BASE64 and others. <br><br>  The plugin itself is available in the <a href="https://wordpress.org/plugins/security-malware-firewall/">WordPress directory</a> . </div><p>Source: <a href="https://habr.com/ru/post/351572/">https://habr.com/ru/post/351572/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351562/index.html">From patches in the fight against malware to a holistic strategy</a></li>
<li><a href="../351564/index.html">Wireless LANs or how Wi-Fi works according to IEEE 802.11 standard. Lab at Packet Tracer</a></li>
<li><a href="../351566/index.html">A few tips on organizing a Python application on the server</a></li>
<li><a href="../351568/index.html">Minimal multiboot bootloader</a></li>
<li><a href="../351570/index.html">Rust: try overloading functions</a></li>
<li><a href="../351574/index.html">Convert IP range to Classless Addressing (CIDR) and back to Go</a></li>
<li><a href="../351576/index.html">13 reasons to switch to Kanban. And no superstition</a></li>
<li><a href="../351580/index.html">One million plus one equals one million. Theory of Relativity of the Natural Series</a></li>
<li><a href="../351582/index.html">Impressions of Teamlead Conf 2018</a></li>
<li><a href="../351584/index.html">Scaling Selenium</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>