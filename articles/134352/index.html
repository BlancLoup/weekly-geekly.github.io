<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Octave to calculate the center of rotation of a star field</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have already partially talked about working with FITS files in Octave. Now I will talk about the application of this mathematical package for proces...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Octave to calculate the center of rotation of a star field</h1><div class="post__text post__text-html js-mediator-article">  I have already partially <a href="http://habrahabr.ru/blogs/programming/132784/">talked</a> about working with FITS files in Octave.  Now I will talk about the application of this mathematical package for processing specific data, namely: to calculate the center of rotation of the star field from a set of images taken at a certain interval. <br><a name="habracut"></a><br><hr><br><h4>  Geometric Transformations </h4><br>  To begin, let's touch the mathematical part.  Geometrical transformations are mathematically convenient to present in vector-matrix form.  So, for example, if we have a radius vector <b>r</b> that characterizes a given image point, then to get the radius vector of a point-mapping, <b>r ', we</b> must multiply the geometric transformation matrix, <b>A</b> , by <b>r</b> : <b>r'</b> = <b>A ¬∑ r</b> .  In the simplest case, <b>A</b> is a two-dimensional 2x2 matrix.  However, for complex transformations it is necessary to expand it to the size of 3x3: for example, to describe the image displacement. <br><br>  In the general case, the vectors <b>r</b> and <b>r '</b> are column vectors of three elements: the actual coordinates of a point and one.  The 3x3 transformation matrix itself has only six significant elements (the top two rows), and its third row contains two zeros and one unit. <br>  In this case, the transformation of rotation relative to the origin of coordinates at an angle Œ∏ in the matrix form will be written as: <br><img src="https://habrastorage.org/getpro/habr/post_images/1f6/37c/50e/1f637c50e09a11fa9bf13dc36058619f.png"><br><br>  The significant members of the geometric transformation matrix carry the following meaning: the submatrix 2x2 of the upper left corner reflects transformations depending on the coordinates of the point (for example, rotation, scaling), and the upper two members of the rightmost column represent transformations that do not depend on the coordinates (offset). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thus, for example, the rotation matrix around the origin of coordinates at an angle Œ∏ followed by this shift by the vector <b>t</b> will look like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/de2/205/22d/de220522ded5f2eabcac3dc673117c93.png"><br><br>  To obtain a matrix describing a more complex transformation, we will need to expand this motion into elementary (rotation, displacement, scaling) and multiply the corresponding matrices.  Those who worked with openGL will have no difficulty in doing this.  It is only necessary to remember that if the transformations are performed in the order <b>A, B, C</b> , then they will need to be multiplied "backwards": the resulting matrix is <b>M = C ¬∑ B ¬∑ A</b> (since the transformation <b>A is</b> first produced by multiplying <b>A ¬∑ r</b> , the resulting vector is experiencing a conversion <b>B</b> and so on. <br><br>  Rotation around an arbitrary point is decomposed into three elementary transformations: shift the image so that the origin is at the point of rotation (i.e. if the center of rotation is at the point (x, y), you need to shift by the vector <b>(-x, -y)</b> ) ;  its rotation by the angle Œ∏ and the reverse shift by the vector <b>(x, y)</b> .  As a result of this multiplication, the transformation matrix will be <br><img src="https://habrastorage.org/getpro/habr/post_images/a9c/9e5/14c/a9c9e514c14e3bafb9e189b8ed20487a.png"><br>  (for simplicity, I replaced sin Œ∏ with s, and cos Œ∏ with c). <br><br>  If we designate the significant terms of the rotation matrix as the matrix <b>R</b> , then the last system of equations can be represented in the matrix form <b>(IR) ¬∑ t = AB</b> , where <b>AB</b> is a column vector from the A and B terms of the final transformation matrix. <br>  From here you can find the vector <b>t</b> , which characterizes the center of the image: <b>t = (IR) \ AB</b> , where the backslash denotes the operation of the "left" division (entry, adopted in Matlab and Octave): in algebra it is similar to the entry <b>t = (IR) <sup>-1</sup> AB</b> ( <b>I</b> is the identity matrix). <br><br>  If the rotation is accompanied by even small displacements, the vector <b>AB</b> will contain the additive term <b>dr</b> , which will introduce a significant error in the calculations (since the length of the vector <b>AB</b> is small when rotating at small angles).  Mathematically, it is impossible to determine this shift, having only a couple of shots on hand.  However, if we have a significant number of images, it is possible to calculate the median value of the center of rotation, and knowing it already it will be easy to determine small displacements <b>dr</b> . <br><br><hr><br><h4>  Implementation in Octave </h4><br>  So, let us have a set of images of the star field (this, by the way, can be an arbitrary image with reliably selected reference areas) and it is necessary to calculate the center of rotation of this field. <br><br>  To begin, we need to select the stars (in general, reference points).  In the specific case, this is solved by simple binarization at a given threshold (the threshold is selected as the maximum from the value set by the user and the sum of the median intensity value over the image plus a quarter of the standard deviation).  Then, in the resulting binary image, zones with 8-coherence are detected and numbered in the order of detection.  As a result, we get a set of masks with which we can calculate the centers of objects (in the simplest case, as an elementary center of gravity). <br><br>  Next, we need to highlight the objects present in all images.  I solved this problem head-on: for each image a set of vectors is constructed ‚Äî the coordinates of the objects detected in the polar system relative to each object (that is, for a set of N points we get N ¬∑ (N-1) vectors).  For identification, all sets of vectors for the first and for the i-th image are sorted.  Each set is given an estimate ‚Äî the number of coincidences of the radius vectors of the points up to the user-set error dr, dœÜ.  Then, a pair of sets with the highest score is selected and the objects of the i-th image are numbered, in accordance with the order of the objects of the first image.  After each procedure of detecting objects of the first image on the i-th, the value of the counters corresponding to the detected objects of the first image increases.  In parallel, the accumulation of the coordinates of the detected objects. <br><br>  This ‚Äúhead-on‚Äù solution greatly slows down the calculations and consumes a lot of memory in case of a large number of objects detected and a large number of images, so the method can be simplified.  For example, you can first compare the first and last image, having defined the set of points (which will reduce the memory consumption and the number of iterations);  the search itself can also be performed only with respect to two or three objects of the first image (it is impossible to use the comparison of only one set, since a specific object can not be detected in the ith image). <br><br>  After the end of the detection of objects, we get an array of counters.  If the object is present on all images, the value of the corresponding counter should be equal to M-1 (M is the number of images).  All data for which the counter is not equal to M-1 is deleted.  Further, it is necessary only to compare the object coordinates for all images in pairs, calculating the center of rotation for each pair using the above formula (the transformation matrix is ‚Äã‚Äãcalculated by the least squares method).  Having accumulated an array of coordinates of the center, we find the real center of rotation as the median of all coordinates. <br><br>  In addition to my method, I found another method in <a href="http://www.cs.otago.ac.nz/staffpriv/mccane/publications/fcr_medical_imaging_proof.pdf">this article</a> (McKein et al.).  The method is convenient in that it does not require finding the transformation matrix by the least squares method.  It is based on the fact that the rotation around an arbitrary point can be represented more simply: as a rotation immediately relative to the origin of coordinates and the subsequent displacement.  Instead of calculating the transformation matrix, the authors suggested determining the rotation angle of the entire system (which is easy to do using the coordinates of objects in the polar coordinate system relative to the center of gravity of the objects).  The rotation angle is calculated by the rotation angle <b>R.</b>  Multiplying this matrix by the radius vectors of the objects of the first image, we find the displacement vector, <b>v</b> (as the median of the difference between the radius vectors of the objects of the i-th image and the obtained radius vectors).  The center of rotation is calculated using the same formula <b>t = (IR) <sup>-1</sup> v</b> . <br><br>  On a large amount of statistical material, both methods gave the same results.  The choice of a particular method is determined by the implementation: in Octave, for example, my method is calculated faster, and the implementation of both methods is simple;  When implementing an algorithm in C, it will be easier for McKein associates. <br><br>  Here is the scatter of the found coordinates of the centers: <br><img src="https://habrastorage.org/getpro/habr/post_images/e2e/5d0/c9f/e2e5d0c9f50208d5a224463d2b9f310c.png"><br><br>  Emissions are explained by the fact that when comparing adjacent images (for which the angle of rotation is small), we get a very high error in the calculation of displacements, comparable to the error in calculating the coordinates of objects.  The absolute deviation of the found coordinates relative to the median illustrates the above: <br><img src="https://habrastorage.org/getpro/habr/post_images/644/082/137/6440821377d0244eeb255b3d01123960.png"><br>  (outliers characteristic for close images then sharply decrease with increasing angle of rotation).  Median averaging allows you to drop these outliers. <br><br>  Yes, I almost forgot to give an example of the image of the star field.  Here it is: <br><img src="https://habrastorage.org/getpro/habr/post_images/4a8/d64/9f3/4a8d649f342c52e9bf9dd991c2b1ab2e.png"><br><br><hr><br><h4>  Sources </h4><br><br>  Reading FITS files: <br><pre><code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[image header]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fits_read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename)</span></span></span><span class="hljs-function"> % %  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FITS</span></span></span><span class="hljs-function">-      %  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">    ! % </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   flipdim,   )</span></span></span><span class="hljs-function"> % % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_fits_image</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(  fits)</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("Read file %s ... ", filename)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fflush</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">; % ,         : </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ sem ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e != 0 || !S_ISREG(s.mode)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("No such file!\n")</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fflush</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ image header ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_fits_image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(!isempty(image)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flipdim</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image',1)</span></span></span><span class="hljs-function">; % ,    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("OK!\n")</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("Bad image!\n")</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fflush</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfunction</span></span></span></span></code> </pre> <br><br>  Calculation of object centers: <br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ xc, yc ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_centers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Img, treshold)</span></span></span><span class="hljs-function"> % </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ xc, yc ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_centers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Img, treshold)</span></span></span><span class="hljs-function"> %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Img</span></span></span><span class="hljs-function">    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">treshold</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yc</span></span></span><span class="hljs-function"> -   % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmp</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zeros</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(Img)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mm</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mean2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Img)</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">std2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Img)</span></span></span><span class="hljs-function">/4; %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tres1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mm, treshold)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("\nTreshold: %g\n", tres1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fflush</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(stdout)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(find(Img &gt; tres1)</span></span></span><span class="hljs-function">) = 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tmp</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">medfilt2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(logical(tmp)</span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ Labels, Nlabels ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bwlabel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tmp)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Nlabels &lt; 1)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(stderr, "\nError! There's no spots!!!\n\n")</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[yy, xx]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ndgrid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1:size(Img,1)</span></span></span><span class="hljs-function">,1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Img,2)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1 : Nlabels]</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idxs</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Labels == i)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Is</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Img(idxs)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ xc sum(Img(idxs) .* xx(idxs)) / Is ]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ yc sum(Img(idxs) .* yy(idxs)) / Is ]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfunction</span></span></span></span></code> </pre><br><br>  Calculation of the coordinates of objects relative to the object number N: <br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_tree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xc, yc, N)</span></span></span><span class="hljs-function"> % % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_tree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xc, yc, N)</span></span></span><span class="hljs-function"> %     , </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc</span></span></span><span class="hljs-function">  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yc</span></span></span><span class="hljs-function">,     %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">N</span></span></span><span class="hljs-function">       . %  ,     -   % ,  -  . % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(xc, 1)</span></span></span><span class="hljs-function">) == 1 % ,      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc</span></span></span><span class="hljs-function">'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(yc, 1)</span></span></span><span class="hljs-function">) == 1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yc</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yc</span></span></span><span class="hljs-function">'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(xc)</span></span></span><span class="hljs-function"> != </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(yc)</span></span></span><span class="hljs-function"> || </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">N</span></span></span><span class="hljs-function"> &gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xc, 1)</span></span></span><span class="hljs-function">) %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xn</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(N)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yn</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(N)</span></span></span><span class="hljs-function">; %  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">N</span></span></span><span class="hljs-function">-  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xn</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yc</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yn</span></span></span><span class="hljs-function">; %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">N</span></span></span><span class="hljs-function">- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Dx.^2+Dy.^2)</span></span></span><span class="hljs-function">; %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Phi</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">atan2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Dy,Dx)</span></span></span><span class="hljs-function">*180/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pi</span></span></span><span class="hljs-function">; %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[R Phi]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfunction</span></span></span></span></code> </pre><br><br>  Building a set of all relative coordinates of objects for a given image: <br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Tree xc yc]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_tree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(treshold, i)</span></span></span><span class="hljs-function"> % % </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Tree xc yc]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_tree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(treshold, i)</span></span></span><span class="hljs-function"> %            % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">treshold</span></span></span><span class="hljs-function"> -      % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> -     % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tree</span></span></span><span class="hljs-function"> -      ,   % *   -      % *   -       % *   -      % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yc</span></span></span><span class="hljs-function"> -   % % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fits_read</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_tree</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_centers</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tree</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">name</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sprintf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("object_%04d.fit", i)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">II</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fits_read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(isempty(II)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("Find centers of %s ... ", name)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fflush</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[xc, yc]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_centers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(II, treshold)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function"> = 1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xc,2)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,:,j)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_tree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xc, yc, j)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("done (%d vectors)</span></span></span><span class="hljs-function">!\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">", </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tree, 1)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfunction</span></span></span></span></code> </pre><br><br>  Obtaining compliance numbers of objects in two images: <br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coord_indexes</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_cluster_c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CC, CC1, dR, dPhi)</span></span></span><span class="hljs-function"> % % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coord_indexes</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_cluster_c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CC, CC1, dR, dPhi)</span></span></span><span class="hljs-function"> %      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC1</span></span></span><span class="hljs-function"> % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC1</span></span></span><span class="hljs-function"> -       % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dR</span></span></span><span class="hljs-function"> -   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( |r1-r0| &lt; dR, ,  r1 == r0)</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dPhi</span></span></span><span class="hljs-function"> -      % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coord_indexes</span></span></span><span class="hljs-function"> -      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1 2; ...]</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ncc</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CC, 3)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ncc1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CC1, 3)</span></span></span><span class="hljs-function">; % -      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cluster</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; %   : - , 1, 2,   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jj</span></span></span><span class="hljs-function"> = 1 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ncc</span></span></span><span class="hljs-function"> %      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Nnear</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; % ,     -      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhiMed</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,1,jj)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,2,jj)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ii</span></span></span><span class="hljs-function"> = 1 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ncc1</span></span></span><span class="hljs-function"> %      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,1,ii)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,2,ii)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">points</span></span></span><span class="hljs-function"> = {}; %      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(  1;     2)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dphi_s</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; % ,         </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r0)</span></span></span><span class="hljs-function">; %      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r1-r0(i)</span></span></span><span class="hljs-function">); %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d &lt; dR)</span></span></span><span class="hljs-function">; %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(isempty(idx)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">continue</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function">; %   -   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">points</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ points; {i, idx} ]</span></span></span><span class="hljs-function">; %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(points, 1)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dphi</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(phi1(points{i,2})</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(points{i,1})</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dphi_s</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[dphi_s; dphi]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(isempty(dphi_s)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">continue</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dphi</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">median</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dphi_s)</span></span></span><span class="hljs-function">; %     2  1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(find(abs(dphi_s-dphi)</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dPhi</span></span></span><span class="hljs-function">), 1); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Nnear</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ Nnear, n ]</span></span></span><span class="hljs-function">; %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PhiMed</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ PhiMed, dphi ]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Nnear == max(Nnear)</span></span></span><span class="hljs-function">)</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">; %   ,    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">jj</span></span></span><span class="hljs-function">- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cluster</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ Cluster; Nnear(idx) jj idx PhiMed(idx) ]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfor</span></span></span><span class="hljs-function"> %       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Cluster(:,1)</span></span></span><span class="hljs-function">); %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Cluster(:,1)</span></span></span><span class="hljs-function"> == </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">)</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">; %       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cluster</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idx, 2)</span></span></span><span class="hljs-function">; %     1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">second</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cluster</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idx, 3)</span></span></span><span class="hljs-function">; % -//- 2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Phi</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cluster</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idx, 4)</span></span></span><span class="hljs-function">; %   2  1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,1,first)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,2,first)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,1,second)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CC1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,2,second)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coord_indexes</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r0)</span></span></span><span class="hljs-function">; %      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(r1-r0(i)</span></span></span><span class="hljs-function">); %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d &lt; dR)</span></span></span><span class="hljs-function">; %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(isempty(idx)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">continue</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function">; %   -   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dphi</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(abs(phi1(idx)</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i)</span></span></span><span class="hljs-function">) - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Phi</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(idx, 1)</span></span></span><span class="hljs-function"> != 1) %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dphi == min(dphi)</span></span></span><span class="hljs-function">)</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">; %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idx</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dphi</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dphi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dphi &gt; dPhi)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">continue</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function">; %   -   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coord_indexes</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ coord_indexes; i idx ]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfunction</span></span></span></span></code> </pre><br><br>  Getting the arrays of coordinates of objects in all images in accordance with their numbering in the first image: <br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[XY]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_centers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i0, i1, treshold, dR, dPhi)</span></span></span><span class="hljs-function"> % % </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[XY]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_centers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i0, i1, treshold, dR, dPhi)</span></span></span><span class="hljs-function"> %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-function">       %  % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i1</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> -      % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">treshold</span></span></span><span class="hljs-function"> -     % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dR</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dPhi</span></span></span><span class="hljs-function"> -     </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(   )</span></span></span><span class="hljs-function"> % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-function"> -      %         %   -   %     -       % % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_tree</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fits_read</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_tree</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_centers</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_cluster_c</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function"> = 1; %   +     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i_start</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i0</span></span></span><span class="hljs-function">; %      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CS</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("\nimage 1\n", i)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[CC xc yc]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_tree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(treshold, i_start)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">im1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i_start</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i_start</span></span></span><span class="hljs-function">++; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">until</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(!isempty(CC)</span></span></span><span class="hljs-function"> || </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i_start</span></span></span><span class="hljs-function"> &gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i1</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc</span></span></span><span class="hljs-function">'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yc</span></span></span><span class="hljs-function">'; %   -   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counters</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zeros</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(X)</span></span></span><span class="hljs-function">); %       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i_start</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i1</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[CC1 xc1 yc1]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_tree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(treshold, i)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(isempty(CC1)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">continue</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("\nimage %d, ", ++n)</span></span></span><span class="hljs-function">; %       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexes</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_cluster_c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CC, CC1, dR, dPhi)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("%d points\n\n", size(indexes, 1)</span></span></span><span class="hljs-function">); %  : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(indexes(:,1)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">) = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(indexes(:,2)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(indexes(:,1)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">) = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yc1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(indexes(:,2)</span></span></span><span class="hljs-function">); %       </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(indexes(:,1)</span></span></span><span class="hljs-function">)++; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfor</span></span></span><span class="hljs-function"> %  ,      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Counters != n-1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idx,:)</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idx,:)</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfunction</span></span></span></span></code> </pre><br><br>  Getting the center of rotation: <br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Xc Yc]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matr_center</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, Y)</span></span></span><span class="hljs-function"> % % </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Xc Yc]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matr_center</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, Y)</span></span></span><span class="hljs-function"> %    ,     % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-function"> -     </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(  get_centers)</span></span></span><span class="hljs-function"> % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Xc</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Yc</span></span></span><span class="hljs-function"> -    % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Xc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Yc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imax</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X,2)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imax</span></span></span><span class="hljs-function">-1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">+1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imax</span></span></span><span class="hljs-function"> %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,i)</span></span></span><span class="hljs-function">'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,j)</span></span></span><span class="hljs-function">'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,i)</span></span></span><span class="hljs-function">'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,j)</span></span></span><span class="hljs-function">'; %      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( -   )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vec0X</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X0</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X0)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vec0Y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y0</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Y0)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vec1X</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X1</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vec1Y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y1</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Y1)</span></span></span><span class="hljs-function">; %    ,        %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">atan2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vec0Y, vec0X)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">atan2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vec1Y, vec1X)</span></span></span><span class="hljs-function">; %%    2,    -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pi</span></span></span><span class="hljs-function">+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pi</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(find(phi0&lt;0)</span></span></span><span class="hljs-function">) += 2*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pi</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(find(phi1&lt;0)</span></span></span><span class="hljs-function">) += 2*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pi</span></span></span><span class="hljs-function">; %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dphi</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">median</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(phi1 - phi0)</span></span></span><span class="hljs-function">; %     %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[cos(dphi) -sin(dphi); sin(dphi) cos(dphi)]</span></span></span><span class="hljs-function">; %   %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RR1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> * </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[vec0X;vec0Y]</span></span></span><span class="hljs-function">; % ,       0 %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dR</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqrt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((vec1X-RR1(1,:)</span></span></span><span class="hljs-function">).^2+</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vec1Y-RR1(2,:)</span></span></span><span class="hljs-function">).^2); %      %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">idx</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dR &lt; median(dR)</span></span></span><span class="hljs-function">+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">std</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dR)</span></span></span><span class="hljs-function">); %    %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(idx,2)</span></span></span><span class="hljs-function"> &lt; 3) %    %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("Image %d: too much bad data\n", i)</span></span></span><span class="hljs-function">; %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">continue</span></span></span><span class="hljs-function">; %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endif</span></span></span><span class="hljs-function"> %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idx)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idx)</span></span></span><span class="hljs-function">;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idx)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(idx)</span></span></span><span class="hljs-function">; %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">A</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[X1;Y1;ones(size(X1))]</span></span></span><span class="hljs-function">/</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[X0;Y0;ones(size(X1))]</span></span></span><span class="hljs-function">; %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CRDS</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(eye(2)</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">A</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1:2,1:2)</span></span></span><span class="hljs-function">) \ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">A</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1:2,3)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Xc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Xc CRDS(1)]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Yc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Yc CRDS(2)]</span></span></span><span class="hljs-function">; %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Xmed</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">median</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Xc)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ymed</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">median</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Yc)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfunction</span></span></span></span></code> </pre><br><br>  The same, but by the McKein associates: <br><pre> <code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Xc Yc]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matr_center_notmine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, Y)</span></span></span><span class="hljs-function"> % % </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Xc Yc]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matr_center</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, Y)</span></span></span><span class="hljs-function"> %    ,     % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-function"> -     </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(  get_centers)</span></span></span><span class="hljs-function"> % : % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Xc</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Yc</span></span></span><span class="hljs-function"> -    % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Xc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Yc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imax</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X,2)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imax</span></span></span><span class="hljs-function">-1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">+1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imax</span></span></span><span class="hljs-function"> %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,i)</span></span></span><span class="hljs-function">'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,j)</span></span></span><span class="hljs-function">'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,i)</span></span></span><span class="hljs-function">'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(:,j)</span></span></span><span class="hljs-function">'; %      </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( -   )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vec0X</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X0</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X0)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vec0Y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y0</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Y0)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vec1X</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">X1</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vec1Y</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y1</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Y1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi0</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">atan2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vec0Y, vec0X)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi1</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">atan2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vec1Y, vec1X)</span></span></span><span class="hljs-function">; %    2,    -</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pi</span></span></span><span class="hljs-function">+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pi</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(find(phi0&lt;0)</span></span></span><span class="hljs-function">) += 2*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pi</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">phi1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(find(phi1&lt;0)</span></span></span><span class="hljs-function">) += 2*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pi</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dphi</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">median</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(phi1 - phi0)</span></span></span><span class="hljs-function">; %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[cos(dphi) -sin(dphi); sin(dphi) cos(dphi)]</span></span></span><span class="hljs-function">; %   %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">median</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(R * [X0; Y0] - [X1; Y1], 2)</span></span></span><span class="hljs-function">; %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CRDS</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(eye(2)</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R</span></span></span><span class="hljs-function">) \ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v</span></span></span><span class="hljs-function">; %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">("Center: (%g, %g)</span></span></span><span class="hljs-function">\</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">n</span></span></span><span class="hljs-function">", </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CRDS</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CRDS</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Xc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Xc -CRDS(1)]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Yc</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Yc -CRDS(2)]</span></span></span><span class="hljs-function">; %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfor</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Xmed</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">median</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Xc)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Ymed</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">median</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Yc)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">endfunction</span></span></span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/134352/">https://habr.com/ru/post/134352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134346/index.html">This letter to Santa Claus</a></li>
<li><a href="../134348/index.html">Silverlight 5 Released!</a></li>
<li><a href="../134349/index.html">A new way to generate random numbers will protect data from hackers</a></li>
<li><a href="../134350/index.html">Motorola won a lawsuit with Apple in a German court</a></li>
<li><a href="../134351/index.html">Certon Systems has released a protected hard drive.</a></li>
<li><a href="../134353/index.html">Samsung NC215 Green Netbook Review</a></li>
<li><a href="../134354/index.html">7app chart # 6</a></li>
<li><a href="../134357/index.html">tma (Part 3) Why you can't automate financial accounting</a></li>
<li><a href="../134358/index.html">Imposing MT Subscriptions</a></li>
<li><a href="../134359/index.html">Strike ddos ‚Äã‚Äãbotnet in the home</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>