<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>iTunes In-App Purchases from server side</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ITunes Payments are actual leaders in monetizing content provided by mobile apps. In one of the applications I know, the income from them is 3 times h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>iTunes In-App Purchases from server side</h1><div class="post__text post__text-html js-mediator-article">  ITunes Payments are actual leaders in monetizing content provided by mobile apps.  In one of the applications I know, the income from them is 3 times higher than the income from Google Play users, while the attendance of the latter is 1.5 times higher.  Thus, from one iTunes user you can receive up to 5 times more money than from one Google Play user.  This argument is sufficient to integrate iTunes payments into mobile applications. <br><br>  This article describes some features of the verification of iTunes payments (including subscriptions) from the server side, which, it seemed to me, are not sufficiently covered in existing articles. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In accordance with <a href="http://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/StoreKitGuide/StoreKitGuide.pdf">the developer‚Äôs guide</a> , two payment transaction verification schemes are proposed: simple, in which the confirmation of a transaction occurs as a result of the interaction of a mobile application and the App Store, and complex.  In the second case, an additional confirmation step is introduced from your own server by contacting iTunes Connect.  The fact of successful confirmation of a payment transaction through iTunes Connect is considered sufficient to verify the payment. <br>  The downside to simple verification is a <a href="http://www.appleinsider.ru/app-store/upd-otechestvennyj-xaker-nashel-sposob-obxoda-vnutriigrovyx-pokupok.html">broken trust</a> .  The advantages of complex include the convenience of working with subscriptions, the possibility of charging worldly goods and storing the list of products on the server side.  The last two points are especially relevant when you have to wait for the app update in the App Store for a week.  And maybe a <a href="http://allthingsd.com/20121108/the-latest-long-apple-line-developers-waiting-for-app-approval/">few weeks</a> , if you suddenly decide to please users seductive product in anticipation of another Christmas.  I don‚Äôt even talk about security - everything is quite clear in the following graph: <br><br><img src="https://habrastorage.org/storage2/d75/515/eed/d75515eed57c6ee4ef73fa9cec1fef1f.png"><br><br>  So in the monitoring system of payment requests for an abstract application, it may look like quite ordinary days.  The blue color represents the total number of requests for payment verification.  Green - requests that actually went through the App Store.  And red - malicious requests.  It is terrible to imagine what loss of profits the application can receive if it ignores the server payment confirmation.  The estimated ratio of the data from the graph is presented in the following table: <br><br><table><tbody><tr><th>  Request feature </th><th>  <nobr>Percent</nobr> </th></tr><tr><td>  Unconfirmed.  Fake payments, consisting of data similar to the correct ones, but perhaps there is no field in them, the number is represented by a line or is there any other distinctive feature that does not allow to verify the payment </td><td>  0.7% </td></tr><tr><td>  Repetitions.  Requests from the client with a verified payment, but sent again after a while </td><td>  one% </td></tr><tr><td>  <b>Cracker</b> payments (type, <b>iAP Cracker</b> , etc.).  They send for verification payments formulated for confirmation by themselves. </td><td>  9.3% </td></tr><tr><td>  Fake.  ITunes-verified payments from other apps </td><td>  79% </td></tr><tr><td>  Confirmed.  Really honest purchases.  Their numbers converge with the numbers of purchases through the account </td><td>  ten% </td></tr></tbody></table><br><br>  In fact, most malicious requests can be determined on their own without spending any traffic on accessing the verification service.  ITunes payment appears so-called.  <b>recipe</b> .  A recipe is a base64 JSON-encoded payment transaction data object.  To verify a payment or subscription through the App Store service, you need to submit their recipe, which is reported by the client application.  In response, get the status of the recipe and some payment details <br><br>  Consider the correct recipe (hereinafter, the data of the correct recipes are slightly modified): <br><br><pre><code class="bash hljs">$ php -r <span class="hljs-string"><span class="hljs-string">"var_dump(base64_decode('Re4LRece1PT='));"</span></span> string(2453) <span class="hljs-string"><span class="hljs-string">"{ "</span></span>signature<span class="hljs-string"><span class="hljs-string">" = "</span></span>8iN4rY5iGNaTUrE==<span class="hljs-string"><span class="hljs-string">"; "</span></span>purchase-info<span class="hljs-string"><span class="hljs-string">" = "</span></span>PuRCh45e1nf0RM4tIoN==<span class="hljs-string"><span class="hljs-string">"; "</span></span>pod<span class="hljs-string"><span class="hljs-string">" = "</span></span>22<span class="hljs-string"><span class="hljs-string">"; "</span></span>signing-status<span class="hljs-string"><span class="hljs-string">" = "</span></span>0<span class="hljs-string"><span class="hljs-string">"; }"</span></span> $ php -r <span class="hljs-string"><span class="hljs-string">"var_dump(base64_decode('PuRCh45e1nf0RM4tIoN=='));"</span></span> string(784) <span class="hljs-string"><span class="hljs-string">"{ "</span></span>original-purchase-date-pst<span class="hljs-string"><span class="hljs-string">" = "</span></span>2013-02-18 10:05:51 America/Los_Angeles<span class="hljs-string"><span class="hljs-string">"; "</span></span>purchase-date-ms<span class="hljs-string"><span class="hljs-string">" = "</span></span>1361210751012<span class="hljs-string"><span class="hljs-string">"; "</span></span>unique-identifier<span class="hljs-string"><span class="hljs-string">" = "</span></span>aun1que1dent1f1er<span class="hljs-string"><span class="hljs-string">"; "</span></span>original-transaction-id<span class="hljs-string"><span class="hljs-string">" = "</span></span>1234567890<span class="hljs-string"><span class="hljs-string">"; "</span></span>bvrs<span class="hljs-string"><span class="hljs-string">" = "</span></span>220<span class="hljs-string"><span class="hljs-string">"; "</span></span>app-item-id<span class="hljs-string"><span class="hljs-string">" = "</span></span>123<span class="hljs-string"><span class="hljs-string">"; "</span></span>transaction-id<span class="hljs-string"><span class="hljs-string">" = "</span></span>1234567890<span class="hljs-string"><span class="hljs-string">"; "</span></span>quantity<span class="hljs-string"><span class="hljs-string">" = "</span></span>1<span class="hljs-string"><span class="hljs-string">"; "</span></span>original-purchase-date-ms<span class="hljs-string"><span class="hljs-string">" = "</span></span>1361210751012<span class="hljs-string"><span class="hljs-string">"; "</span></span>unique-vendor-identifier<span class="hljs-string"><span class="hljs-string">" = "</span></span>VEND0R-1DENT1F1ER<span class="hljs-string"><span class="hljs-string">"; "</span></span>item-id<span class="hljs-string"><span class="hljs-string">" = "</span></span>456<span class="hljs-string"><span class="hljs-string">"; "</span></span>version-external-identifier<span class="hljs-string"><span class="hljs-string">" = "</span></span>789<span class="hljs-string"><span class="hljs-string">"; "</span></span>product-id<span class="hljs-string"><span class="hljs-string">" = "</span></span>com.example.application.product.1<span class="hljs-string"><span class="hljs-string">"; "</span></span>purchase-date<span class="hljs-string"><span class="hljs-string">" = "</span></span>2013-02-18 18:05:51 Etc/GMT<span class="hljs-string"><span class="hljs-string">"; "</span></span>original-purchase-date<span class="hljs-string"><span class="hljs-string">" = "</span></span>2013-02-18 18:05:51 Etc/GMT<span class="hljs-string"><span class="hljs-string">"; "</span></span>bid<span class="hljs-string"><span class="hljs-string">" = "</span></span>com.example.application<span class="hljs-string"><span class="hljs-string">"; "</span></span>purchase-date-pst<span class="hljs-string"><span class="hljs-string">" = "</span></span>2013-02-18 10:05:51 America/Los_Angeles<span class="hljs-string"><span class="hljs-string">"; }"</span></span></code> </pre> <br><br>  A recipe consists of purchase data, a signature, and a pair of service fields.  The signature is binary and base64 encoded.  These purchases are also encoded and represent a JSON object with multiple fields.  I consider two fields to be the most interesting: <b>product-id</b> is the identifier of the purchased product and <b>bid</b> is the identifier of the application. <br><br>  Top picks of malicious requests ‚Äî fake requests ‚Äî look like this: <br><br><pre> <code class="bash hljs">$ php -r <span class="hljs-string"><span class="hljs-string">"var_dump(base64_decode('CHuZH0iRECE1pt=='));"</span></span> string(2281) <span class="hljs-string"><span class="hljs-string">"{ "</span></span>signature<span class="hljs-string"><span class="hljs-string">" = "</span></span>8iN4rY5iGNaTUrE==<span class="hljs-string"><span class="hljs-string">"; "</span></span>purchase-info<span class="hljs-string"><span class="hljs-string">" = "</span></span>4n0THeRPuRCh45e1nf0RM4tIoN==<span class="hljs-string"><span class="hljs-string">"; "</span></span>pod<span class="hljs-string"><span class="hljs-string">" = "</span></span>17<span class="hljs-string"><span class="hljs-string">"; "</span></span>signing-status<span class="hljs-string"><span class="hljs-string">" = "</span></span>0<span class="hljs-string"><span class="hljs-string">"; }"</span></span> $ php -r <span class="hljs-string"><span class="hljs-string">"var_dump(base64_decode('4n0THeRPuRCh45e1nf0RM4tIoN=='));"</span></span> string(656) <span class="hljs-string"><span class="hljs-string">"{ "</span></span>original-purchase-date-pst<span class="hljs-string"><span class="hljs-string">" = "</span></span>2012-07-12 05:54:35 America/Los_Angeles<span class="hljs-string"><span class="hljs-string">"; "</span></span>purchase-date-ms<span class="hljs-string"><span class="hljs-string">" = "</span></span>1342097675882<span class="hljs-string"><span class="hljs-string">"; "</span></span>original-transaction-id<span class="hljs-string"><span class="hljs-string">" = "</span></span>170000029449420<span class="hljs-string"><span class="hljs-string">"; "</span></span>bvrs<span class="hljs-string"><span class="hljs-string">" = "</span></span>1.4<span class="hljs-string"><span class="hljs-string">"; "</span></span>app-item-id<span class="hljs-string"><span class="hljs-string">" = "</span></span>450542233<span class="hljs-string"><span class="hljs-string">"; "</span></span>transaction-id<span class="hljs-string"><span class="hljs-string">" = "</span></span>170000029449420<span class="hljs-string"><span class="hljs-string">"; "</span></span>quantity<span class="hljs-string"><span class="hljs-string">" = "</span></span>1<span class="hljs-string"><span class="hljs-string">"; "</span></span>original-purchase-date-ms<span class="hljs-string"><span class="hljs-string">" = "</span></span>1342097675882<span class="hljs-string"><span class="hljs-string">"; "</span></span>item-id<span class="hljs-string"><span class="hljs-string">" = "</span></span>534185042<span class="hljs-string"><span class="hljs-string">"; "</span></span>version-external-identifier<span class="hljs-string"><span class="hljs-string">" = "</span></span>9051236<span class="hljs-string"><span class="hljs-string">"; "</span></span>product-id<span class="hljs-string"><span class="hljs-string">" = "</span></span>com.zeptolab.ctrbonus.superpower1<span class="hljs-string"><span class="hljs-string">"; "</span></span>purchase-date<span class="hljs-string"><span class="hljs-string">" = "</span></span>2012-07-12 12:54:35 Etc/GMT<span class="hljs-string"><span class="hljs-string">"; "</span></span>original-purchase-date<span class="hljs-string"><span class="hljs-string">" = "</span></span>2012-07-12 12:54:35 Etc/GMT<span class="hljs-string"><span class="hljs-string">"; "</span></span>bid<span class="hljs-string"><span class="hljs-string">" = "</span></span>com.zeptolab.ctrexperiments<span class="hljs-string"><span class="hljs-string">"; "</span></span>purchase-date-pst<span class="hljs-string"><span class="hljs-string">" = "</span></span>2012-07-12 05:54:35 America/Los_Angeles<span class="hljs-string"><span class="hljs-string">"; }"</span></span></code> </pre><br><br>  It is a decent recipe.  Only not from our application.  If you apply to iTunes Connect, you will receive a confirmation of this payment: <br><br><pre> <code class="bash hljs">$ wget <span class="hljs-string"><span class="hljs-string">'https://buy.itunes.apple.com/verifyReceipt'</span></span> -q --post-data=<span class="hljs-string"><span class="hljs-string">'{"receipt-data":"CHuZH0iRECE1pt=="}'</span></span> -O - {<span class="hljs-string"><span class="hljs-string">"receipt"</span></span>:{<span class="hljs-string"><span class="hljs-string">"original_purchase_date_pst"</span></span>:<span class="hljs-string"><span class="hljs-string">"2012-07-12 05:54:35 America/Los_Angeles"</span></span>, <span class="hljs-string"><span class="hljs-string">"purchase_date_ms"</span></span>:<span class="hljs-string"><span class="hljs-string">"1342097675882"</span></span>, <span class="hljs-string"><span class="hljs-string">"original_transaction_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"170000029449420"</span></span>, <span class="hljs-string"><span class="hljs-string">"original_purchase_date_ms"</span></span>:<span class="hljs-string"><span class="hljs-string">"1342097675882"</span></span>, <span class="hljs-string"><span class="hljs-string">"app_item_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"450542233"</span></span>, <span class="hljs-string"><span class="hljs-string">"transaction_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"170000029449420"</span></span>, <span class="hljs-string"><span class="hljs-string">"quantity"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"bvrs"</span></span>:<span class="hljs-string"><span class="hljs-string">"1.4"</span></span>, <span class="hljs-string"><span class="hljs-string">"version_external_identifier"</span></span>:<span class="hljs-string"><span class="hljs-string">"9051236"</span></span>, <span class="hljs-string"><span class="hljs-string">"bid"</span></span>:<span class="hljs-string"><span class="hljs-string">"com.zeptolab.ctrexperiments"</span></span>, <span class="hljs-string"><span class="hljs-string">"product_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"com.zeptolab.ctrbonus.superpower1"</span></span>, <span class="hljs-string"><span class="hljs-string">"purchase_date"</span></span>:<span class="hljs-string"><span class="hljs-string">"2012-07-12 12:54:35 Etc/GMT"</span></span>, <span class="hljs-string"><span class="hljs-string">"purchase_date_pst"</span></span>:<span class="hljs-string"><span class="hljs-string">"2012-07-12 05:54:35 America/Los_Angeles"</span></span>, <span class="hljs-string"><span class="hljs-string">"original_purchase_d</span></span></code> </pre><br><br>  In principle, could not check.  You can save 80% of the traffic to iTunes by comparing <b>product-id</b> and <b>bid</b> with those allowed in our application at the stage of receiving a recipe from a client application. <br><br>  The recipes created by crackers are rather primitive: <code>Y29tLnVydXMuaWFwLjk2NjU3Mjkw</code> .  Decrypt, we get <code>com.urus.iap.96657290</code> .  Obviously, there is not even a talk about any recipe structure - neither a signature nor a purchase data.  Such recipes can be safely rejected.  iTunes for such a recipe will return error <a href="http://developer.apple.com/library/ios/">21002</a> . <br><br>  If, in the case of receiving recipes created by crackers, you can verify the recipe both on your own and with the help of the iTunes service, then duplicates can be found only on your side.  It is enough to keep all transaction identifiers for which benefits were accrued, and to check whether such an identifier was already among those that have passed.  According to the <a href="http://developer.apple.com/library/ios/">documentation,</a> all transaction identifiers uniquely identify the payment. <br><br>  The smallest evil from the sample is unconfirmed recipes.  Below is an example of one: <br><pre> <code class="bash hljs">$ php -r <span class="hljs-string"><span class="hljs-string">"var_dump(base64_decode('P0dDe1NyRECE1pt=='));"</span></span> string(613) <span class="hljs-string"><span class="hljs-string">"{"</span></span>signing-status<span class="hljs-string"><span class="hljs-string">"="</span></span>0<span class="hljs-string"><span class="hljs-string">";"</span></span>purchase-info<span class="hljs-string"><span class="hljs-string">"="</span></span>P0dDe1N0e1NF0==<span class="hljs-string"><span class="hljs-string">";"</span></span>pid<span class="hljs-string"><span class="hljs-string">"="</span></span>143<span class="hljs-string"><span class="hljs-string">";"</span></span>signature<span class="hljs-string"><span class="hljs-string">"="</span></span>1POdP1sD4jEe5t=<span class="hljs-string"><span class="hljs-string">";}"</span></span> $ php -r <span class="hljs-string"><span class="hljs-string">"var_dump(base64_decode('P0dDe1N0e1NF0=='));"</span></span> string(388) <span class="hljs-string"><span class="hljs-string">"{"</span></span>unique-identifier<span class="hljs-string"><span class="hljs-string">"="</span></span>an0theru1que1dent1f1er<span class="hljs-string"><span class="hljs-string">";"</span></span>purchase-date<span class="hljs-string"><span class="hljs-string">"="</span></span>2012-02-18 19:23:27 Etc/GMT<span class="hljs-string"><span class="hljs-string">";"</span></span>original-transaction-id<span class="hljs-string"><span class="hljs-string">"="</span></span>0123456789<span class="hljs-string"><span class="hljs-string">";"</span></span>quantity<span class="hljs-string"><span class="hljs-string">"="</span></span>1<span class="hljs-string"><span class="hljs-string">";"</span></span>original-purchase-date<span class="hljs-string"><span class="hljs-string">"="</span></span>2012-02-18 19:23:27 Etc/GMT<span class="hljs-string"><span class="hljs-string">";"</span></span>bvrs<span class="hljs-string"><span class="hljs-string">"="</span></span>123<span class="hljs-string"><span class="hljs-string">";"</span></span>product-id<span class="hljs-string"><span class="hljs-string">"="</span></span>com.example.application.product.1<span class="hljs-string"><span class="hljs-string">";"</span></span>item-id<span class="hljs-string"><span class="hljs-string">"="</span></span>456<span class="hljs-string"><span class="hljs-string">";"</span></span>transaction-id<span class="hljs-string"><span class="hljs-string">"="</span></span>0123456789<span class="hljs-string"><span class="hljs-string">";"</span></span>bid<span class="hljs-string"><span class="hljs-string">"="</span></span>com.example.application<span class="hljs-string"><span class="hljs-string">";}"</span></span></code> </pre><br><br>  Compared with the correct recipe, in this case, the savings on space, but this is not a reason to reject the recipe - because it is compiled and encoded by the client application.  And so the recipe looks correct: there are correct product and application identifiers, plausible payment data, a signature.  You need to send a request to iTunes (well, that such requests are only 0.7% of the total number and 7% of the number of useful requests).  iTunes will respond with the code 21002. <br><br>  The picture below shows the verification algorithm for recipes received from the client application on its own server side: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/b39/b0f/3d0/b39b0f3d025c5fd1b008e3c16d635204.png"></div><br><br>  Directly for verification through iTunes, I propose to use a small and convenient <a href="https://github.com/alxmsl/AppStoreClient">library</a> .  This library allows you to verify including <a href="http://developer.apple.com/library/ios/">updated subscriptions</a> .  You can request information on the subscription with the same verification request, specifying the secret password when the client is initialized. <br><br><pre> <code class="php hljs">$AppStore = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \AppStore\Client\AppStoreClient(); $AppStore-&gt;setPassword(<span class="hljs-string"><span class="hljs-string">'secret shared password'</span></span>) -&gt;setSandbox((bool) mt_rand(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)); $Status = $AppStore-&gt;verifyReceipt(<span class="hljs-string"><span class="hljs-string">'5t4TUs=='</span></span>);</code> </pre><br><br>  iTunes will return the response data to us as follows. <br><br><pre> <code class="hljs vbscript">object(AppStore\Client\<span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>\RenewableStatus)#<span class="hljs-number"><span class="hljs-number">7</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span>) { [<span class="hljs-string"><span class="hljs-string">"latestReceipt"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\RenewableStatus"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">3460</span></span>) <span class="hljs-string"><span class="hljs-string">"5t4TUs=="</span></span> [<span class="hljs-string"><span class="hljs-string">"LatestReceiptInfo"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\RenewableStatus"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; object(AppStore\Client\<span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>\RenewableReceipt)#<span class="hljs-number"><span class="hljs-number">8</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>) { [<span class="hljs-string"><span class="hljs-string">"expiresDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\RenewableReceipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-string"><span class="hljs-string">"1363547483000"</span></span> [<span class="hljs-string"><span class="hljs-string">"quantity"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) [<span class="hljs-string"><span class="hljs-string">"productId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">35</span></span>) <span class="hljs-string"><span class="hljs-string">"com.example.application.product.2"</span></span> [<span class="hljs-string"><span class="hljs-string">"transactionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-string"><span class="hljs-string">"0987654321"</span></span> [<span class="hljs-string"><span class="hljs-string">"purchaseDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">27</span></span>) <span class="hljs-string"><span class="hljs-string">"2013-02-18 20:11:23 Etc/GMT"</span></span> [<span class="hljs-string"><span class="hljs-string">"originalTransactionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-string"><span class="hljs-string">"9078563412"</span></span> [<span class="hljs-string"><span class="hljs-string">"originalPurchaseDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">27</span></span>) <span class="hljs-string"><span class="hljs-string">"2013-01-18 20:11:25 Etc/GMT"</span></span> [<span class="hljs-string"><span class="hljs-string">"appItemId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-string"><span class="hljs-string">"456"</span></span> [<span class="hljs-string"><span class="hljs-string">"versionExternalIdentifier"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-string"><span class="hljs-string">""</span></span> [<span class="hljs-string"><span class="hljs-string">"bid"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">19</span></span>) <span class="hljs-string"><span class="hljs-string">"com.example.application"</span></span> [<span class="hljs-string"><span class="hljs-string">"bvrs"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"123"</span></span> } [<span class="hljs-string"><span class="hljs-string">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Status"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) [<span class="hljs-string"><span class="hljs-string">"Receipt"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Status"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; object(AppStore\Client\<span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>\RenewableReceipt)#<span class="hljs-number"><span class="hljs-number">9</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>) { [<span class="hljs-string"><span class="hljs-string">"expiresDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\RenewableReceipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-string"><span class="hljs-string">"1363547483000"</span></span> [<span class="hljs-string"><span class="hljs-string">"quantity"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) [<span class="hljs-string"><span class="hljs-string">"productId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">35</span></span>) <span class="hljs-string"><span class="hljs-string">"com.example.application.product.2"</span></span> [<span class="hljs-string"><span class="hljs-string">"transactionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-string"><span class="hljs-string">"0987654321"</span></span> [<span class="hljs-string"><span class="hljs-string">"purchaseDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">27</span></span>) <span class="hljs-string"><span class="hljs-string">"2013-02-18 20:11:23 Etc/GMT"</span></span> [<span class="hljs-string"><span class="hljs-string">"originalTransactionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-string"><span class="hljs-string">"9078563412"</span></span> [<span class="hljs-string"><span class="hljs-string">"originalPurchaseDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">27</span></span>) <span class="hljs-string"><span class="hljs-string">"2013-01-18 20:11:25 Etc/GMT"</span></span> [<span class="hljs-string"><span class="hljs-string">"appItemId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-string"><span class="hljs-string">"456"</span></span> [<span class="hljs-string"><span class="hljs-string">"versionExternalIdentifier"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-string"><span class="hljs-string">""</span></span> [<span class="hljs-string"><span class="hljs-string">"bid"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">19</span></span>) <span class="hljs-string"><span class="hljs-string">"com.example.application"</span></span> [<span class="hljs-string"><span class="hljs-string">"bvrs"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"123"</span></span> } }</code> </pre><br><br>  Unlike <a href="http://habrahabr.ru/post/160911/">Google Play subscriptions</a> , iTunes creates a new subscription recipe for each payment period.  About a day before the start of the next payment period, iTunes is trying to withdraw money from the user's account, although I saw a complaint that the money for renewing a subscription was written off 48 hours before the start of the new payment period.  If the attempt has not yet been carried out and has not yet successfully passed the data presented in the <b>latest_receipt</b> match the data of the original recipe, as in the example above.  If the subscription is successfully renewed, the automatic purchase data will be presented in the <b>latest_receipt_info</b> field, the encoded recipe in the <b>latest_receipt</b> field <br><br><pre> <code class="hljs vbscript">object(AppStore\Client\<span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>\RenewableStatus)#<span class="hljs-number"><span class="hljs-number">7</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span>) { [<span class="hljs-string"><span class="hljs-string">"latestReceipt"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\RenewableStatus"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">3460</span></span>) <span class="hljs-string"><span class="hljs-string">"ReNEW481E5t4TUs=="</span></span> [<span class="hljs-string"><span class="hljs-string">"LatestReceiptInfo"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\RenewableStatus"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; object(AppStore\Client\<span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>\RenewableReceipt)#<span class="hljs-number"><span class="hljs-number">8</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>) { [<span class="hljs-string"><span class="hljs-string">"expiresDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\RenewableReceipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-string"><span class="hljs-string">"1363547483000"</span></span> [<span class="hljs-string"><span class="hljs-string">"quantity"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) [<span class="hljs-string"><span class="hljs-string">"productId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">35</span></span>) <span class="hljs-string"><span class="hljs-string">"com.example.application.product.2"</span></span> [<span class="hljs-string"><span class="hljs-string">"transactionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-string"><span class="hljs-string">"0987654321"</span></span> [<span class="hljs-string"><span class="hljs-string">"purchaseDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">27</span></span>) <span class="hljs-string"><span class="hljs-string">"2013-02-18 20:11:23 Etc/GMT"</span></span> [<span class="hljs-string"><span class="hljs-string">"originalTransactionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-string"><span class="hljs-string">"9078563412"</span></span> [<span class="hljs-string"><span class="hljs-string">"originalPurchaseDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">27</span></span>) <span class="hljs-string"><span class="hljs-string">"2013-01-18 20:11:25 Etc/GMT"</span></span> [<span class="hljs-string"><span class="hljs-string">"appItemId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-string"><span class="hljs-string">"456"</span></span> [<span class="hljs-string"><span class="hljs-string">"versionExternalIdentifier"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-string"><span class="hljs-string">""</span></span> [<span class="hljs-string"><span class="hljs-string">"bid"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">19</span></span>) <span class="hljs-string"><span class="hljs-string">"com.example.application"</span></span> [<span class="hljs-string"><span class="hljs-string">"bvrs"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"123"</span></span> } [<span class="hljs-string"><span class="hljs-string">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Status"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) [<span class="hljs-string"><span class="hljs-string">"Receipt"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Status"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; object(AppStore\Client\<span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>\RenewableReceipt)#<span class="hljs-number"><span class="hljs-number">9</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>) { [<span class="hljs-string"><span class="hljs-string">"expiresDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\RenewableReceipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-string"><span class="hljs-string">"1361131883894"</span></span> [<span class="hljs-string"><span class="hljs-string">"quantity"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) [<span class="hljs-string"><span class="hljs-string">"productId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">35</span></span>) <span class="hljs-string"><span class="hljs-string">"com.example.application.product.2"</span></span> [<span class="hljs-string"><span class="hljs-string">"transactionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-string"><span class="hljs-string">"0987654312"</span></span> [<span class="hljs-string"><span class="hljs-string">"purchaseDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">27</span></span>) <span class="hljs-string"><span class="hljs-string">"2013-01-18 20:11:23 Etc/GMT"</span></span> [<span class="hljs-string"><span class="hljs-string">"originalTransactionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-string"><span class="hljs-string">"9078563412"</span></span> [<span class="hljs-string"><span class="hljs-string">"originalPurchaseDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">27</span></span>) <span class="hljs-string"><span class="hljs-string">"2013-01-18 20:11:25 Etc/GMT"</span></span> [<span class="hljs-string"><span class="hljs-string">"appItemId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-string"><span class="hljs-string">"456"</span></span> [<span class="hljs-string"><span class="hljs-string">"versionExternalIdentifier"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-string"><span class="hljs-string">""</span></span> [<span class="hljs-string"><span class="hljs-string">"bid"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">19</span></span>) <span class="hljs-string"><span class="hljs-string">"com.example.application"</span></span> [<span class="hljs-string"><span class="hljs-string">"bvrs"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"123"</span></span> } }</code> </pre><br><br>  In case the subscription cannot be renewed, the response status is returned <b>21006</b> <br><br><pre> <code class="php hljs">$AppStore = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \AppStore\Client\AppStoreClient(); $AppStore-&gt;setPassword(<span class="hljs-string"><span class="hljs-string">'secret shared password'</span></span>) -&gt;setSandbox((bool) mt_rand(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $Status = $AppStore-&gt;verifyReceipt(<span class="hljs-string"><span class="hljs-string">'ExP1ReD5t4TUs=='</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (\AppStore\Client\Response\ExpiredSubscriptionException $ex) { var_dump($ex-&gt;getStatus()); }</code> </pre><br><br><pre> <code class="hljs vbscript">object(AppStore\Client\<span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>\RenewableStatus)#<span class="hljs-number"><span class="hljs-number">7</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span>) { [<span class="hljs-string"><span class="hljs-string">"latestReceipt"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\RenewableStatus"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-string"><span class="hljs-string">""</span></span> [<span class="hljs-string"><span class="hljs-string">"LatestReceiptInfo"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\RenewableStatus"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> [<span class="hljs-string"><span class="hljs-string">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Status"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">21006</span></span>) [<span class="hljs-string"><span class="hljs-string">"Receipt"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Status"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; object(AppStore\Client\<span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>\RenewableReceipt)#<span class="hljs-number"><span class="hljs-number">8</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>) { [<span class="hljs-string"><span class="hljs-string">"expiresDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\RenewableReceipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-string"><span class="hljs-string">"1361208738953"</span></span> [<span class="hljs-string"><span class="hljs-string">"quantity"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) [<span class="hljs-string"><span class="hljs-string">"productId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">35</span></span>) <span class="hljs-string"><span class="hljs-string">"com.example.application.product.2"</span></span> [<span class="hljs-string"><span class="hljs-string">"transactionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-string"><span class="hljs-string">"2143658709"</span></span> [<span class="hljs-string"><span class="hljs-string">"purchaseDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">27</span></span>) <span class="hljs-string"><span class="hljs-string">"2013-01-18 17:32:18 Etc/GMT"</span></span> [<span class="hljs-string"><span class="hljs-string">"originalTransactionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span>) <span class="hljs-string"><span class="hljs-string">"2143658709"</span></span> [<span class="hljs-string"><span class="hljs-string">"originalPurchaseDate"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">27</span></span>) <span class="hljs-string"><span class="hljs-string">"2013-01-18 17:32:19 Etc/GMT"</span></span> [<span class="hljs-string"><span class="hljs-string">"appItemId"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-string"><span class="hljs-string">"456"</span></span> [<span class="hljs-string"><span class="hljs-string">"versionExternalIdentifier"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-string"><span class="hljs-string">""</span></span> [<span class="hljs-string"><span class="hljs-string">"bid"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">19</span></span>) <span class="hljs-string"><span class="hljs-string">"com.example.application"</span></span> [<span class="hljs-string"><span class="hljs-string">"bvrs"</span></span>:<span class="hljs-string"><span class="hljs-string">"AppStore\Client\Response\Receipt"</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>]=&gt; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"123"</span></span> } }</code> </pre><br><br>  I suggest the following scheme for processing iTunes subscriptions on the server side: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/60c/072/591/60c07259122c4021aa1d5833aa7a3a77.png"></div><br><br>  Description: <br><br><ul><li>  buy - buy a subscription on the client side </li><li>  verify - verification of subscription data on the server side according to the algorithm proposed above </li><li>  queue - data queue of verified subscriptions </li><li>  periodical verification - periodical verification of subscriptions.  If the subscription has been renewed, write the updated recipe back into the queue for subsequent checks. </li></ul><br><br>  According to my data, ~ 60% of iTunes subscriptions are renewed.  For Google Play subscriptions, this value is ~ 40%.  And the overwhelming majority of cases of the inability to renew a subscription are cases of lack of funds in user accounts. </div><p>Source: <a href="https://habr.com/ru/post/162335/">https://habr.com/ru/post/162335/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../162323/index.html">Creating a frequency dictionary based on the analysis of the library of fiction</a></li>
<li><a href="../162325/index.html">Retention, or why the user will return to the game?</a></li>
<li><a href="../162327/index.html">Google Analytics: download advertising cost data from external sources</a></li>
<li><a href="../162329/index.html">Connecting and working with MySQL in VB.NET</a></li>
<li><a href="../162333/index.html">AR Drone - quadcopter intercepting communication of other quadcopters</a></li>
<li><a href="../162337/index.html">Trend Watching: 10 major trends in 2013. Part 2</a></li>
<li><a href="../162339/index.html">zsh and bash: what to choose</a></li>
<li><a href="../162341/index.html">Features of working with time in different time zones</a></li>
<li><a href="../162343/index.html">Runetology (177): Levon Oganesyan, Founder of the Delivery Club</a></li>
<li><a href="../162345/index.html">AWS Insight: Reservations for EC2 - how it works</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>