<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Merging Rails and Merb: A Year Later (Part 1 of 6)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Six consecutive articles on the merger of Rails and Merb were published on www.engineyard.com from December 2009 to April 2010. This is the first one....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Merging Rails and Merb: A Year Later (Part 1 of 6)</h1><div class="post__text post__text-html js-mediator-article">  <i>Six consecutive articles on the merger of Rails and Merb were published on <a href="http://www.engineyard.com/">www.engineyard.com</a> from December 2009 to April 2010.</i>  <i>This is the first one.</i> <br><br>  Today, exactly one year since the day we announced the merger of Rails and Merb.  Then there were a lot of skepticism about the success of this enterprise.  The most common association for those who heard about our plans was the unicorn.  On RailsConf last year, and DHH (David Heinemeyer Hansson, author of Rails. - <i>approx. Transl.</i> ), And I mentioned the unicorn in my reports, causing laughter regarding our high expectations and the inability to fulfill them for version 3.0. <br><br>  A year has passed, it is time to reflect how well we have worked to achieve our goals.  Over the next few days I will describe in detail the progress made towards each of the points in my original post ( <a href="http://www.engineyard.com/blog/2008/rails-and-merb-merge/">http://www.engineyard.com/blog/2008/rails-and-merb-merge/</a> ). <br><a name="habracut"></a><br>  I have already made several reports on these topics, so that some of you could already see separate things, but I also wanted to write it down for those who have not had time.  I also added information previously omitted because of its complexity for the oral presentation, and too new to be told somewhere. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Modularity </h4><br>  <i>Rails will become more modular, starting with the implementation of the kernel itself, including the ability to turn individual components on or off at will.</i>  <i>We will focus on reducing the repetition of code inside Rails to make it possible to replace parts of Rails without interfering with other parts.</i>  <i>This is what the vaunted ‚Äúmodularity‚Äù of Merb is.</i> <br><br>  We spent a lot of time at this stage, which brought us really a lot of fruit.  I will give some typical examples. <br><br><h5>  ActiveSupport </h5><br>  First, we walked through ActiveSupport, making it adapted to choosing the right items.  This means that the use of inflector (translation of words from the singular to the plural and vice versa), time extensions, class extensions, and everything else is now possible without independent study of the dependency graph.  Here is what I mean (using the example of the <code>to_sentence</code> method in ActiveSupport from Rails 2.3): <br><blockquote> <code><a href="http://s-c.me/6484/s"></a> <a href="http://s-c.me/6484/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">module</font> ActiveSupport&lt;br/&gt; <font color="#0000ff">module</font> CoreExtensions&lt;br/&gt; <font color="#0000ff">module Array</font> &lt;br/&gt; <font color="#0000ff">module</font> Conversions&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">to_sentence</font> (options = {})&lt;br/&gt;          ...&lt;br/&gt;          options.assert_valid_keys :words_connector, :two_words_connector, :last_word_connector, :locale&lt;br/&gt;          ...&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;      ...&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote> <br>  As you can see, there is a call to <code>assert_valid_keys</code> in another module in <code>to_sentence</code> , which means that to connect only <code>active_support/core_ext/array/conversions</code> , you would have to go through the file, find all implicit dependencies, and connect the corresponding modules separately.  And of course, the structure of these dependencies could easily change in a future version of Rails, so it would be unsafe to hope that there will be a result.  In Rails 3, the same file starts with: <br><blockquote> <code><a href="http://s-c.me/6482/s"></a> <a href="http://s-c.me/6482/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">require</font> <font color="#008000">'active_support/core_ext/hash/keys'</font> &lt;br/&gt; <font color="#0000ff">require</font> <font color="#008000">'active_support/core_ext/hash/reverse_merge'</font> &lt;br/&gt; <font color="#0000ff">require</font> <font color="#008000">'active_support/inflector'</font> &lt;br/&gt;</font></code> </blockquote> <br>  This is because we ourselves have walked through the entire ActiveSupport library, found implicit dependencies and made them explicit.  As a result, you can pull out the specific libraries you need for a small project, and not the entire ActiveSupport. <br><br>  Better yet, parts of Rails now explicitly declare <b>their</b> dependencies on ActiveSupport.  For example, the code that adds a log entry for ActionController received the following lines at the beginning: <br><blockquote> <code><a href="http://s-c.me/6483/s"></a> <a href="http://s-c.me/6483/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">require</font> <font color="#008000">'active_support/core_ext/logger'</font> &lt;br/&gt; <font color="#0000ff">require</font> <font color="#008000">'active_support/benchmarkable'</font> &lt;br/&gt;</font></code> </blockquote> <br>  This means that all parts of Rails now know exactly which parts of ActiveSupport they need.  For simplicity, Rails 3 comes with a full set of ActiveSupport modules, so you can use things like <code>3.days</code> or <code>3.kilobytes</code> without problems.  At the same time, if you want more control over exactly which modules are connected to the application, it is possible.  You can declare <code>config.active_support.bare = true</code> in the configuration, and only those parts of ActiveSupport that are explicitly specified in the project files are included.  You still need to include different trinkets if you want to use them - <code>3.days</code> will not work right out of the box with the <code>bare</code> flag turned on. <br><br><h5>  ActionController </h5><br>  Another area in need of processing is ActionController.  Previously, ActionController contained a lot of radically different elements within it.  On closer examination, we found that these were actually three different components. <br><br>  First, the functionality of the dispatcher.  It included the controller itself, routing, middleware and rack extensions.  Secondly, it contained a large amount of controller code intended to be used elsewhere, and actually used again in ActionMailer.  Finally, there was code that served as an intermediary between the two, managing requests and responses through the entire controller architecture. <br><br>  In Rails 3, each of these components is separated from the other.  The dispatcher's functionality was moved to ActionDispatch, its code is tight and really turned into a conceptual component.  Parts of ActionController, intended for use by non-HTTP controllers, were moved to a new component called AbstractController, from which both ActionController and ActionMailer inherit. <br><br>  Finally, ActionController itself underwent a thorough renovation.  In fact, we isolated each individual component and made it possible to start with a minimum and supplement it with components of your choice.  Our old friend <code>ActionController::Base</code> just starts from the same place and adds <b>everything you</b> need.  For example, look at the beginning of a new version of this class: <br><blockquote> <code><a href="http://s-c.me/6480/s"></a> <a href="http://s-c.me/6480/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">module</font> ActionController&lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">Base</font> &lt; Metal&lt;br/&gt;    abstract!&lt;br/&gt; <font color="#0000ff">include</font> AbstractController::Callbacks&lt;br/&gt; <font color="#0000ff">include</font> AbstractController:: <font color="#cc6633">Logger</font> &lt;br/&gt; <font color="#0000ff">include</font> ActionController::Helpers&lt;br/&gt; <font color="#0000ff">include</font> ActionController::HideActions&lt;br/&gt; <font color="#0000ff">include</font> ActionController::UrlFor&lt;br/&gt; <font color="#0000ff">include</font> ActionController::Redirecting&lt;br/&gt; <font color="#0000ff">include</font> ActionController::Rendering&lt;br/&gt; <font color="#0000ff">include</font> ActionController::Renderers::All&lt;br/&gt; <font color="#0000ff">include</font> ActionController::Layouts&lt;br/&gt; <font color="#0000ff">include</font> ActionController::ConditionalGet&lt;br/&gt; <font color="#0000ff">include</font> ActionController::RackDelegation&lt;br/&gt; <font color="#0000ff">include</font> ActionController:: <font color="#cc6633">Logger</font> &lt;br/&gt; <font color="#0000ff">include</font> ActionController::Benchmarking&lt;br/&gt; <font color="#0000ff">include</font> ActionController::Configuration &lt;br/&gt;</font></code> </blockquote> <br>  All we are doing here is adding all the available modules, so the initial way of using Rails is the same as before.  The real strength of what we have done here is the same as in ActiveSupport: each module declares its dependencies on other modules, so you can turn on, for example, <code>Rendering</code> without having to figure out which other modules should be connected and what order. <br><br>  Here is a fully working Rails 3 controller: <br><blockquote> <code><a href="http://s-c.me/6479/s"></a> <a href="http://s-c.me/6479/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">FasterController</font> &lt; ActionController::Metal&lt;br/&gt;  abstract!&lt;br/&gt; <font color="#696969"># Rendering   ,   </font> &lt;br/&gt; <font color="#696969">#    </font> &lt;br/&gt; <font color="#0000ff">include</font> ActionController::Rendering &lt;br/&gt; <font color="#0000ff">include</font> ActionController::Layouts&lt;br/&gt;  append_view_path Rails.root.join( <font color="#008000">"app/views"</font> ) &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">AwesomeController</font> &lt; <font color="#cc6633">FasterController</font> &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">index</font> &lt;br/&gt;    render <font color="#008000">"_"</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote> <br>  And further in the routing file with complete success can be done: <br><blockquote> <code><a href="http://s-c.me/6478/s"></a> <a href="http://s-c.me/6478/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt;MyApp.routes.draw <font color="#0000ff">do</font> &lt;br/&gt;  match <font color="#008000">"/must_be_fast"</font> , :to =&gt; <font color="#008000">"awesome#index"</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote> <br>  In essence, <code>ActionController::Base</code> was just one of the ways to create controllers.  This is the same as the classic Rails, but with the ability to make your own, if the original is not to your taste.  It's really easy to match your requirements: if you want to add the <code>before_filter</code> functionality to <code>FasterController</code> , you can simply add <code>AbstractController::Callbacks</code> . <br><br>  Notice that adding these modules automatically added <code>AbstractController::Rendering</code> (the rendering functionality is shared with ActionMailer), <code>AbstractController::Layouts</code> and <code>ActiveSupport::Callbacks</code> . <br><br>  This makes it easy to add only the functionality you need in performance-sensitive places without having to use a completely different API.  If additional functionality is required, you can easily add additional modules or eventually use the full <code>ActionController::Base</code> without having to <code>ActionController::Base</code> something along the way. <br><br>  This is, in fact, the idea of ‚Äã‚Äãthe core of Rails 3: there are no monolithic components, only modules without complex relationships, running by default in large packages.  This allows people to continue to use Rails in the same way as in previous versions, but it supports the code with alternative options.  There is no more functionality enclosed in inaccessible forms. <br><br>  The immediate benefit of all this is that ActionMailer deliberately gets all the functionality of ActionController in a simple way.  Everything, starting with layouts and helpers to filters, uses the same code used in ActionController, so ActionMailer can never slip from the functionality of ActionController (in the process of how ActionController will evolve). <br><br>  Middleware also gets a helping hand.  <code>ActionController::Middleware</code> , middleware with all the benefits of ActionController, allows you to add any ActionController features you like (as Rendering, ConditionalGet, Request and Response objects, etc.).  Here is an example: <br><blockquote> <code><a href="http://s-c.me/6477/s"></a> <a href="http://s-c.me/6477/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#696969">#  </font> &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">AddMyName</font> &lt; ActionController::Middleware&lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">call</font> (env)&lt;br/&gt;    status, headers, body = @app. <font color="#cc6633">call</font> (env)&lt;br/&gt;    headers[ <font color="#008000">"X-Author"</font> ] = <font color="#008000">"Yehuda Katz"</font> &lt;br/&gt;    headers[ <font color="#008000">"Content-Type"</font> ] = <font color="#008000">"application/xml"</font> &lt;br/&gt; &lt;br/&gt;    etag = env[ <font color="#008000">"If-None-Match"</font> ]&lt;br/&gt;    key = ActiveSupport::Cache.expand_cache_key(body + <font color="#008000">"Yehuda Katz"</font> )&lt;br/&gt;    headers[ <font color="#008000">"ETag"</font> ] = %[ <font color="#008000">"#{Digest::MD5.hexdigest(key)}"</font> ]&lt;br/&gt; <font color="#0000ff">if</font> headers[ <font color="#008000">"ETag"</font> ] == etag&lt;br/&gt;      headers[ <font color="#008000">"Cache-Control"</font> = <font color="#008000">"public"</font> ]&lt;br/&gt; <font color="#0000ff">return</font> [ <font color="#008000">304</font> , headers, [ <font color="#008000">" "</font> ]]&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">return</font> status, headers, body&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; &lt;br/&gt;</font></code> </blockquote> <br><blockquote> <code><a href="http://s-c.me/6476/s"></a> <a href="http://s-c.me/6476/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#696969">#   Rack </font> &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">AddMyName</font> &lt; ActionController::Middleware&lt;br/&gt; <font color="#0000ff">include</font> ActionController::RackDelegation&lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">call</font> (env)&lt;br/&gt; <font color="#0000ff">self</font> .status, <font color="#0000ff">self</font> .headers, <font color="#0000ff">self</font> .response_body = @app. <font color="#cc6633">call</font> (env)&lt;br/&gt; &lt;br/&gt;    headers[ <font color="#008000">"X-Author"</font> ] = <font color="#008000">"Yehuda Katz"</font> &lt;br/&gt; &lt;br/&gt; <font color="#696969">#       </font> &lt;br/&gt; <font color="#0000ff">self</font> .content_type = <font color="#cc6633">Mime</font> ::XML <font color="#696969"># delegates to the response</font> &lt;br/&gt;    response.etag = <font color="#008000">"#{response.body}Yehuda Katz"</font> &lt;br/&gt;    response.cache_control[:public] = <font color="#0000ff">true</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">self</font> .status, <font color="#0000ff">self</font> .response_body = <font color="#008000">304</font> , <font color="#0000ff">nil if</font> request.fresh?(response)&lt;br/&gt; &lt;br/&gt;    response.to_a&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote> <br><blockquote> <code><a href="http://s-c.me/6470/s"></a> <a href="http://s-c.me/6470/h"></a> <font color="black">Copy Source | Copy HTML&lt;br/&gt; <font color="#696969">#   ConditionalGet</font> &lt;br/&gt; <font color="#0000ff">class</font> <font color="#cc6633">AddMyName</font> &lt; ActionController::Middleware&lt;br/&gt; <font color="#696969">#  RackDelegation</font> &lt;br/&gt; <font color="#0000ff">include</font> ActionController::ConditionalGet&lt;br/&gt; &lt;br/&gt; <font color="#0000ff">def</font> <font color="#cc6633">call</font> (env)&lt;br/&gt; <font color="#0000ff">self</font> .status, <font color="#0000ff">self</font> .headers, <font color="#0000ff">self</font> .response_body = @app. <font color="#cc6633">call</font> (env)&lt;br/&gt; &lt;br/&gt;    headers[ <font color="#008000">"X-Author"</font> ] = <font color="#008000">"Yehuda Katz"</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">self</font> .content_type = <font color="#cc6633">Mime</font> ::XML&lt;br/&gt;    fresh_when :etag =&gt; <font color="#008000">"#{response.body}Yehuda Katz"</font> , :public =&gt; <font color="#0000ff">true</font> &lt;br/&gt; &lt;br/&gt;    response.to_a&lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt; <font color="#0000ff">end</font> &lt;br/&gt;</font></code> </blockquote> <br>  I think we really kept the promise to bring modularity into Rails.  I think that the level of what happened in the new version exceeds the expectations of many a year ago, and this is exactly the territory of the golden unicorn.  Enjoy! <br><br>  Next time, I'll talk about improving performance in Rails 3. I hope it won't be too fast.  :) </div><p>Source: <a href="https://habr.com/ru/post/87907/">https://habr.com/ru/post/87907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../87898/index.html">An open letter to the Yandex.Mail team</a></li>
<li><a href="../87903/index.html">On the issue of copy-paste in Windows Phone</a></li>
<li><a href="../87904/index.html">Font using CSS</a></li>
<li><a href="../87905/index.html">How to choose the diagonal and screen resolution?</a></li>
<li><a href="../87906/index.html">Spring updates Yota</a></li>
<li><a href="../87908/index.html">Nagare - an example of using the framework</a></li>
<li><a href="../87909/index.html">Boat "Lukoil" otmazyvaet Barkov in LiveJournal</a></li>
<li><a href="../87914/index.html">Subliminal divorce or carelessness of the designer?</a></li>
<li><a href="../87915/index.html">Are you satisfied with the memory of your Linux system?</a></li>
<li><a href="../87916/index.html">"Lunokhod-2" or 37 years of oblivion</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>