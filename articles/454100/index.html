<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Common code problems in microservices</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 Recently, at the PGConf conference in Moscow, one of the speakers demonstrated a ‚Äúmicroservice‚Äù architecture, mentioning in passing that all...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Common code problems in microservices</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  Recently, at the PGConf conference in Moscow, one of the speakers demonstrated a ‚Äúmicroservice‚Äù architecture, mentioning in passing that all microservices inherit from one common base class.  Although there was no explanation for the implementation, it seemed that in this company the term ‚Äúmicroservices‚Äù is not understood in the same way as the classics would have taught us.  Today we will deal with one of the interesting problems - what can be the common code in microservices and whether it can be at all. <br><a name="habracut"></a><br>  What is microservice?  This is a separate application.  Not a module, not a process, not something that is simply separately deployed, but a full-fledged, real, separate application.  It has its own main function, its own repository in the gita, its tests, its API, its web server, its README file, its own database, its own version, its own developers. <br><br>  Like containers, microservices began to be used when the computing power of HW and the reliability of networks reached such a level that you can afford the challenge of a function that lasts 100 times longer than before, you can afford the memory consumption 100 times higher, you can afford the luxury to settle each ‚Äúgrandmother‚Äù not just into a separate ‚Äúapartment‚Äù, but into a separate ‚Äúhouse‚Äù.  As with any architectural solutions, microservice architecture once again sacrifices performance, winning in the maintainability of the code for developers.  But since the person and the speed of his reaction remained the same, the systems continue to meet the requirements. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Why split into separate applications?  Because we distribute part of the complexity of the system at the level of the system architecture.  The programming process is generally speaking a phased ‚Äúbiting off‚Äù of a large initial ‚Äúpiece of complexity‚Äù, and decomposition (into classes, modules, functions, and in our case into entire applications) is the implementation of part of this complexity as a structure.  When we broke the system into microservices, we made an architectural decision (good or not), which developers will no longer need to take in the implementation of specific parts of the functionality.  It is known that this particular microservice is responsible for sending emails, and this one is for authorization, it‚Äôs already started, so all my new features ‚Äúfall‚Äù on this pattern without discussion. <br><br>  A key aspect of microservices is weak connectivity.  Microservices should be independent of the word "absolutely."  They do not have common data structures, and each microservice can / should have its own architecture, technologies, method of assembly (and so on).  By definition.  Because it is independent applications.  Changes in the code of one microservice should not affect the others in any way, unless the API is affected.  If I have N microservices written in Java, then there should not be any limiting factors in order not to write N + 1-th microservice in Python, if suddenly it is beneficial for some reason.  They are loosely coupled, and therefore a developer who starts working with a specific microservice: <br><br>  a) Very sensitively monitors its API, because it is the only component visible from the outside; <br>  b) Feels completely free in refactoring; <br>  c) Understands the purpose of microservice (we recall SRP here) and implements a new function accordingly; <br>  d) Select the persistence method that is most suitable; <br>  etc. <br><br>  All this is good and sounds logical and coherent, like many ideologies and theories (and here the theoretical ideologist puts an end and goes to dinner), but we practice with you.  The code has to be written at all on the site <a href="https://martinfowler.com/">martinfowler.com</a> .  And sooner or later we are faced with the fact that all microservices: <br><br><ul><li>  log information; </li><li>  contain authorization; </li><li>  appeal to message brokers; </li><li>  return correct error messages; </li><li>  should somehow understand the common entities in the system, if any; </li><li>  should work with the general format (and protocol) of messages; </li></ul><br>  and make it identical. <br><br>  And at some point an ideologue-architect comes to work in the morning and discovers that at night a ‚Äúlibrary‚Äù has appeared in the system - a new repository with common code that is used in many microservices.  Should an architect be horrified? <br><br>  It depends. <br><br>  To correctly assess the situation, you should return to the main idea: microservices are a set of independent applications that interact with each other through the (network) API.  In this we see the main advantage and simplicity of architecture.  And we do not want to lose this advantage under any circumstances.  Does the common code that is placed in the ‚Äúlibrary‚Äù hinder this?  Consider examples. <br><br>  1. The class ‚Äúuser‚Äù lives in the library (or some other business entity). <br><br><ul><li>  those.  a business entity is not encapsulated in one microservice, but is spread over different ones (otherwise, why should it be placed in a shared code library?); </li><li>  those.  Microservices become connected through this business entity, changing the logic of working with the entity will affect several microservices; </li><li>  it is bad, very bad, it is not microservices at all, although it is not ‚Äúbig ball of mud‚Äù, but very quickly the team‚Äôs worldview will lead to ‚Äúbig ball of distributed mud‚Äù; </li><li>  but after all, microservices in the system work with the same concepts, and concepts are often entities, or just structures with fields, what to do?  To read DDD, it is exactly about how to encapsulate entities inside microservices so that they do not ‚Äúfly‚Äù through the API. </li></ul><br>  Unfortunately, any business logic placed in a shared library will have this effect.  Libraries of a common code tend to grow, eventually a logical ‚Äútumor‚Äù is formed in the middle of the system that does not belong to any specific microservice, and the architecture crashes.  The ‚Äúcenter of logical gravity‚Äù of the system begins to move into the repo with a common code, and we get a hellish mixture of monolith and microservices, but we do not need to go there at all. <br><br>  2. The library placed the code for parsing the message format. <br><br><ul><li>  The code is most likely in Java if all microservices are written in Java; </li><li>  If tomorrow I write a service in Python, I can‚Äôt use a parser, but it‚Äôs not at all a problem, I‚Äôll write a Python version; </li><li>  The key point: if I write a new microservice in Java, am I obligated to use this parser?  Yes, probably not.  Perhaps that is not required, although I, as a developer of microservice, it can be very useful.  Well, as if I had found something useful in the Maven Repository. </li></ul><br>  The parser of messages, or an improved logger, or a wrapped client for sending data to RabbitMQ is sort of like helpers, auxiliary components.  They are on a par with standard libraries from NuGet, Maven or NPM.  The developer of microservice is always king, he decides whether to use the standard library, or make his own new code, or use the code from the general library of helpers.  How it will be more convenient for him, because he writes a SEPARATE AND INDEPENDENT APPENDIX.  Can a specific helper develop?  Maybe he will probably have a version.  Let the developer refer in his service to a specific version, no one forces to update the service, when updating the helpers, this is a question to who supports the service. <br><br>  3. Java interface, abstract base class, treit. <br><br><ul><li>  Or another thing from the category of "torn out a piece of code"; </li><li>  Those.  I am here, independent and independent, and a piece of my liver lies somewhere else; </li><li>  This is where microservices are connected at the code level, so we will not recommend it; </li><li>  At the initial stages, this probably will not bring any tangible problems, but the essence of architectural design is, after all, a guarantee of comfort (or discomfort) for years to come. </li></ul><br>  The team that starts working on a new product lays the foundation for the architecture and has the greatest influence on what trends the product will have.  If the principles of SRP, successful decomposition, low connectivity, etc. are initially incorporated into the system, then it has a chance to continue to develop correctly.  If not, then the centrifugal acceleration of the ‚Äútime factors‚Äù (another team, little time, urgent patches, lack of documentation) will push the system further to the curb faster than it seems. <br><br>  The question of a common code in microservices remains difficult, because it is associated with some sort of trade-off: we weigh what will be more profitable for us in the future - the degree of independence of microservices, fewer repetitions in the code, qualification of engineers, simplicity of the system, etc.  Each time there are reflections and discussions that can lead to different specific architectural solutions.  Nevertheless, let us summarize some recommendations: <br><br>  Recommendation 0: Do not call microservices any piece that is divided into independently existing pieces.  Not every table with columns is a matrix, let's use the terms correctly. <br><br>  Recommendation 1: It is highly desirable that microservices do not have a common code at all. <br><br>  Recommendation 2: If there is a common code, let it be an aggregate (library) of optional ‚Äúhelpers‚Äù.  The developer of the service decides whether to use them or write your own code. <br><br>  Recommendation 3: Under no circumstances should there be any business logic in the common code.  All business logic is encapsulated in microservices. <br><br>  Recommendation 4: Let the common code library be framed as a typical package (NuGet, Maven, NPM, etc), with the possibility of versioning (or, even better, several separate packages). <br><br>  Recommendation 5: The ‚Äúcenter of logical gravity‚Äù of the system should always remain in microservices themselves, and not in the general code. <br><br>  Recommendation 6: If you decided to write in the format of microservices, then beforehand accept the fact that the code between them will sometimes be duplicated.  To some extent, our natural ‚ÄúDRY instinct‚Äù should be suppressed. <br><br>  Thank you for your attention and successful microservices. </div><p>Source: <a href="https://habr.com/ru/post/454100/">https://habr.com/ru/post/454100/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454088/index.html">Voting for reports on the summer DIY-mitap at Mail.ru Group on June 16</a></li>
<li><a href="../45409/index.html">Quick guide to customer management</a></li>
<li><a href="../454096/index.html">Digest of June IT events</a></li>
<li><a href="../454098/index.html">The merger of two white dwarfs can end with the appearance of a new neutron star</a></li>
<li><a href="../4541/index.html">The British government: ‚ÄúSave the Internet video!‚Äù</a></li>
<li><a href="../454102/index.html">Using a random oracle on the example of the lottery</a></li>
<li><a href="../454104/index.html">Cloud services to play on weak PCs, relevant in 2019</a></li>
<li><a href="../454106/index.html">With me - 15 ideas that can change your life, with you - 5 minutes of attention</a></li>
<li><a href="../454110/index.html">Development of an online store to preserve the nature of Kamchatka</a></li>
<li><a href="../454112/index.html">The history of the design levels Duke Nukem (with sketches of Levelrord)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>