<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cross-platform use of .Net classes in 1C through Native VK. Or replacing COM with Linux II</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a continuation of the articles: 

 ¬ª Development ‚Üí Cross-platform use of .Net classes from unmanaged code. Or analogue IDispatch on Linux 
 ¬ª ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cross-platform use of .Net classes in 1C through Native VK. Or replacing COM with Linux II</h1><div class="post__text post__text-html js-mediator-article">  This is a continuation of the articles: <br><br>  ¬ª <a href="https://habrahabr.ru/post/304482/">Development ‚Üí Cross-platform use of .Net classes from unmanaged code.</a>  <a href="https://habrahabr.ru/post/304482/">Or analogue IDispatch on Linux</a> <br>  ¬ª <a href="https://habrahabr.ru/post/304542/">Development ‚Üí Cross-platform use of .Net classes in 1C through Native VK.</a>  <a href="https://habrahabr.ru/post/304542/">Or replacing COM with Linux</a> <br><br>  Since then, added support for methods with default parameters, calling extension methods, inferring types for generic methods, supporting objects implementing IDynamicMetaObjectProvider (ExpandoObject, DynamicObject), adding synonyms to type members and asynchronous programming on 1C! <br><a name="habracut"></a><br>  At one time I wrote an article <a href="http://infostart.ru/public/466196/">.Net in 1C.</a>  <a href="http://infostart.ru/public/466196/">On the example of using HTTPClient, AngleSharp.</a>  <a href="http://infostart.ru/public/466196/">Convenient parsing of sites using the AngleSharp library, including authorization ala JQuery using CSS selectors.</a>  <a href="http://infostart.ru/public/466196/">Dynamic compilation</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In which there was an example of using extension methods, generic methods, default parameters.  As a result, the code using IReflect was very far from real in C #.  In the new version I tried to bring the code to 1C as close as possible to the original. <br><br>  Let's look at an example in C # <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> config = Configuration.Default.WithDefaultLoader().WithCookies(); <span class="hljs-comment"><span class="hljs-comment">//     var address = "https://en.wikipedia.org/wiki/List_of_The_Big_Bang_Theory_episodes"; //      var document = BrowsingContext.New(config).OpenAsync(address).Result; //  &lt;a href="/wiki/The_Big_Bang_Theory" title="The Big Bang Theory"&gt;The Big Bang Theory&lt;/a&gt; var rowSelector = "a[title='The Big Bang Theory']"; var HtmlAnchorElement = document.QuerySelector&lt;IHtmlAnchorElement&gt;(rowSelector); rowSelector="form#searchform"; var FormElement = doc.&lt;IHtmlFormElement&gt;QuerySelector(rowSelector));</span></span></code> </pre> <br>  Here is its analogue on 1C: <br><br><pre> <code class="1c hljs">AngleSharp=(.(<span class="hljs-string"><span class="hljs-string">"AngleSharp"</span></span>)); Assembly=(AngleSharp.GetType()); .(Assembly.(),<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"GetType"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       AngleSharp_Configuration=(AngleSharp.("AngleSharp.Configuration")); //     GetType HtmlParser=(AngleSharp.GetType("AngleSharp.Parser.Html.HtmlParser")); //  BrowsingContext = (AngleSharp.("AngleSharp.BrowsingContext")); Configuration=(AngleSharp.("AngleSharp.Configuration")); //   ConfigurationExtensions // public static IConfiguration WithDefaultLoader(this IConfiguration configuration, Action&lt;LoaderService&gt; setup = null, IEnumerable&lt;IRequester&gt; requesters = null); // public static IConfiguration WithCookies(this IConfiguration configuration); config = (((Configuration.Default).WithDefaultLoader()).WithCookies()); address = "https://en.wikipedia.org/wiki/List_of_The_Big_Bang_Theory_episodes"; context = (BrowsingContext.New(config.())); //    //   BrowsingContextExtensions //public static Task&lt;IDocument&gt; OpenAsync(this IBrowsingContext context, string address); document = ((context.OpenAsync(address)).Result); rowSelector = "a[title='The Big Bang Theory']"; //   ApiExtensions //public static TElement QuerySelector&lt;TElement&gt;(this IParentNode parent, string selectors) where TElement : class, IElement; HtmlAnchorElement=((document.in(IHtmlAnchorElement.())).QuerySelector(rowSelector)); //  ApiExtensions //public static Task&lt;IDocument&gt; ApiExtensions.NavigateAsync&lt;TElement&gt;(this TElement element) where TElement : IUrlUtilities, IElement; //  this TElement   IElement doc=((HtmlAnchorElement.NavigateAsync()).Result); rowSelector="form#searchform"; FormElement = ((doc.in(IHtmlFormElement.())).QuerySelector(rowSelector)); ("OuterHtml="+FormElement.OuterHtml);</span></span></code> </pre> <br>  Let me draw attention to a few points.  Design: <br><br><pre> <code class="cs hljs">document.QuerySelector&lt;IHtmlAnchorElement&gt;(rowSelector);</code> </pre> <br>  On 1C it looks like this: <br><br><pre> <code class="1c hljs">HtmlAnchorElement=((document.in(IHtmlAnchorElement.())).QuerySelector(rowSelector));</code> </pre> <br>  I used the reserved word <b>in</b> to create a descendant of DynamicObject, in which the object and generic arguments are saved, and then through TryInvokeMember we get the method name and parameters and find the right method and execute it. <br><br>  So far, for generics, I have not implemented methods with default parameters and array parameters. <br><br>  For generics, the types for the following constructions are displayed: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> K <span class="hljs-number"><span class="hljs-number">3</span></span>&lt;K&gt;(IList&lt;K&gt; param1, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> param2, K param3)</code> </pre> <br>  1C example <br><br><pre> <code class="1c hljs">List=(<span class="hljs-string"><span class="hljs-string">"System.Collections.Generic.List`1[System.String]"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(.<span class="hljs-number"><span class="hljs-number">3</span></span>(List.(),<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-string"><span class="hljs-string">"3"</span></span>));</code> </pre> <br>  The type is inferred from the List, resulting in an Ilist and comparing the result with a type of 3 parameters. <br><br>  I was often reproached for <a href="http://infostart.ru/public/238584/">using .NET assemblies in 1C 7.xb 8.x.</a>  <a href="http://infostart.ru/public/238584/">Creating an external component.</a> <br><br>  1. No cross-platform <br>  2. No Russian synonyms. <br><br>  Well, with MS help, and made a cross-platform component.  And made the ability to add synonyms to the type. <br><br><pre> <code class="1c hljs">AngleSharp=(.(<span class="hljs-string"><span class="hljs-string">"AngleSharp"</span></span>)); Assembly=(AngleSharp.GetType()); .(Assembly.(),<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"GetType"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       AngleSharp_Configuration=(AngleSharp.("AngleSharp.Configuration")); //     GetType HtmlParser=(AngleSharp.GetType("AngleSharp.Parser.Html.HtmlParser"));</span></span></code> </pre> <br>  Synonyms can also be used from extensions.  For example: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>  { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>  ,<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Str) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> .()+<span class="hljs-string"><span class="hljs-string">" "</span></span>+ Str; } }</code> </pre> <br>  Now you can call: <br><br><pre> <code class="1c hljs"> <span class="hljs-comment"><span class="hljs-comment">//         //(, "NetObjectToNative",.Native); //  = ("AddIn.NetObjectToNative.LoaderCLR"); // .(CoreClrDir,NetObjectToNative,""); //  // CoreClrDir       .Net    coreclr // NetObjectToNative      //            //  //HttpClient=(.("System.Net.Http",)); //HttpClient=(HttpClient.GetType("System.Net.Http.HttpClient")); //   .   Dll =(.("TestDllForCoreClr.")); .(.(),"GetStringFromExtensionWithParams",""); //     (.("")); //    (.GetStringFromExtensionWithParams("  GetStringFromExtensionWithParams"));</span></span></code> </pre> <br>  You can also call extensions for generic methods.  Including with a withdrawal on restriction. <br><br>  ApiExtensions extension method: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Task&lt;IDocument&gt; ApiExtensions.NavigateAsync&lt;TElement&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> TElement element) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TElement : IUrlUtilities, IElement;</code> </pre> <br>  The type of this TElement on the IElement constraint is displayed. <br><br><pre> <code class="1c hljs">doc=((HtmlAnchorElement.NavigateAsync()).Result);</code> </pre> <br>  I have not yet found a way to view all loaded assemblies.  Therefore, the search for extensions is being done in the assembly where the type is located with the called method.  I hope the release will come out in the fall with great potential. <br><br>  Also added a shorter record of getting the interface. <br><br>  Instead <br><br><pre> <code class="1c hljs">=(.(.(),<span class="hljs-string"><span class="hljs-string">"IEnumerable"</span></span>));</code> </pre> <br><br>  Can be used <b>as</b> <br><br><pre> <code class="1c hljs">=(.as(<span class="hljs-string"><span class="hljs-string">"IEnumerable"</span></span>)); =(.GetEnumerator()); <span class="hljs-comment"><span class="hljs-comment">//       IEnumerator =(.as("IEnumerator"));</span></span></code> </pre><br><br>  Examples and sources can be downloaded <a href="https://yadi.sk/d/jRSHEA19svgrn/">here.</a> <br>  In the next article, <a href="https://habrahabr.ru/users/serginio1/topics/">Asynchronous Programming in 1C via .Net Native VK I</a> will talk about asynchronous programming in 1C. </div><p>Source: <a href="https://habr.com/ru/post/307188/">https://habr.com/ru/post/307188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307176/index.html">Samsung SM961 512GB and 256GB SSD Review</a></li>
<li><a href="../307178/index.html">Java performance: present and future</a></li>
<li><a href="../307180/index.html">Let the Holy War begin: Java vs C ++</a></li>
<li><a href="../307184/index.html">Who is behind the Pokemon Go PR campaign?</a></li>
<li><a href="../307186/index.html">Choose a long way (or goodbye MAX_PATH)</a></li>
<li><a href="../307192/index.html">Lead from the fields: who and how applied qualitative methods in UX Research to develop IT products. Part 2 of 6</a></li>
<li><a href="../307196/index.html">Who is Caviar? School of creative thinking for the digital world</a></li>
<li><a href="../307198/index.html">10 tricks to feel like a specialist, working with Google Drive</a></li>
<li><a href="../307200/index.html">Work with OrnaJS library</a></li>
<li><a href="../307202/index.html">Security Week 31: News from Blackhat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>