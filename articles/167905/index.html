<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>In the footsteps of a mobile phone. Geolocation via cellular network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last time, when we talked about the MegaFon Navigation application and how it works, we mentioned several other services, the main component of which ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>In the footsteps of a mobile phone. Geolocation via cellular network</h1><div class="post__text post__text-html js-mediator-article">  Last time, when we talked about <a href="http://habrahabr.ru/company/megafon/blog/158027/">the MegaFon Navigation application</a> and how it works, we mentioned several other services, the main component of which is the definition of coordinates and their interpretation <i>(Location-based services)</i> . <br><br>  Depending on the tasks set before the service and accuracy requirements, we use different technologies for determining the coordinates.  Today we will tell you what technological platforms we have at our disposal, and how we use them. <br><a name="habracut"></a><br><h4>  Theory </h4><br>  Turning on your mobile phone or any other device operating in the GSM network <i>(Mobile station)</i> , you start a huge technological process. <br><br>  The first thing your mobile device <i>(MS)</i> does is to search for nearby base stations <i>(Base station, BS)</i> .  To be more precise, then listens to the air in search of available cells.  The phone can listen to up to 16 broadcast channels.  Of these, 6 are the most satisfying in terms of energy costs and signal quality.  But at one point in time will work with only one.  Each cell has its own unique number <i>(CellID)</i> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this case, all base stations <i>(BS) are</i> combined into groups.  As a rule, membership in a group is determined by their location <i>(Location area)</i> , and in order for base stations to be identified, each group is assigned a unique number ‚Äî the <i>Location area code (LAC)</i> . <br><br>  Together, the <i>LAC</i> and <i>CellID</i> parameters work as unique identifiers of the base station where the mobile device is registered and operating.  It is by using these parameters that the Switching Center selects the right direction to send a call in your direction, otherwise you would have to search for you among thousands of base stations. <br>  In addition, the base station sector is determined <i>(Cell Sector)</i> and the time is recorded for which the signal from the mobile device reaches the base station - this is the <i><a href="http://en.wikipedia.org/wiki/Timing_advance">Timing Advance</a></i> parameter.  Due to this, not only the belonging to the base station is known, but also the distance from it. <br><br><img src="https://habrastorage.org/storage2/123/de8/403/123de84037b38e49f111b5f8362f7ae4.png"><br>  <i>Determining the position of the subscriber in the cellular network.</i> <br><br>  The location data of the mobile phone is updated with a certain frequency or in case it moves (of course, along with you), then each time it switches between base stations. <br><br>  How to send a call to the desired subscriber? <br><br><img src="https://habrastorage.org/storage2/c39/053/ab5/c39053ab515d426c2c2382825aa0a967.jpg"><br><br>  The interaction of systems to determine the position of the mobile device. <br>  A phone number that is stored in a huge database of mobile operator numbers.  The Home Location Registry <i>(HLR)</i> contains information about all subscribers assigned to it.  Having found a subscriber in one of the <i>HLRs</i> , we redirect the call to its associated <i>switching center (Mobile switching center, MSC)</i> , which in turn requests information from the Guest Location Register <i>(VLR)</i> , which contains data on the last registered <i>CallID</i> , <i>LAC of the</i> subscriber.  After that, the base <i>station controller (Base station controller, BSC)</i> communicates with the base stations within the transmitted <i>LAC</i> , and the call is routed to the desired cell <i>(CellID)</i> . <br><br><h4>  Practice </h4><br>  Due to the fact that the work of cellular communication is inseparably connected with the determination of location, geolocation services based on the GSM / UMTS network also began to develop. <br><br>  The main criteria for geolocation services are not only the accuracy of determining the coordinates of a mobile terminal, but also the frequency of updating them on demand, the ability to get not only current coordinates at the moment, but also store historical data and build a route for the phone, and hence the subscriber. <br><br>  Since the work of many subscriber services is related to obtaining the coordinates of a particular subscriber, showing the coordinates, we can only if the subscriber has given permission for this: he confirmed this possibility as part of the request from the service.  There is no other way to get the coordinates of the subscriber. <br><br>  For services <a href="http://moscow.megafon.ru/services/searchandnavi/sledi.html">Radar</a> and <a href="http://moscow.megafon.ru/services/searchandnavi/mayachok.html">Beacon</a> , where the location is tracked only upon request from the subscriber, we use the following logic of operation. <br><br>  With each request from the service, the system accesses the equipment chain and receives the <i>CellID</i> and <i>LAC</i> parameter.  We, in turn, know the coordinates of each base station and after additional mathematical processing we show the user the zone in which the subscriber may be located.  The greater the density of base stations, the more accurate the definition of coordinates.  Accordingly, within the city limits the error is lower than outside the city. <br><br>  We have the opportunity to get not only the <i>CellID</i> data of the base station to which the subscriber is connected, but also the data of the ‚Äúneighbors‚Äù (neighboring base stations), we can improve the accuracy of determination using <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D1%2580%25D0%25B8%25D0%25B0%25D0%25BD%25D0%25B3%25D1%2583%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F_(%25D0%25B3%25D0%25B5%25D0%25BE%25D0%25BC%25D0%25B5%25D1%2582%25D1%2580%25D0%25B8%25D1%258F)">triangulation</a> - now the zone in which the subscriber is located is not limited to the range of the base station. stations, and a simplex between several base stations (often a triangle, the vertices of which are given by the coordinates of the base stations).  This definition method also works on user request and, for example, is used in the <a href="http://www.navigator.megafonpro.ru/">Navigator</a> service. <br><br>  Creating a service of <a href="http://moscow.megafon.ru/corporate/mobile/stuff_control/">personnel control,</a> we have put in front of him more complex tasks.  In addition to determining the coordinates of the subscriber, we can give the user data on the entry and exit of the subscriber from a specific geographic area, search for employees who are closest to a given point, and most importantly collect statistics on all routes.  Additionally, the service allows you to adjust the time for monitoring (in order to limit it only to the employee‚Äôs working time), and also allows you to send messages to employees directly from the service. <br><br><img src="https://habrastorage.org/storage2/bf1/7eb/115/bf17eb1156d8588351ed3cd9356ff3d6.png"><br>  <i>An example of using the service "Personnel Control"</i> <br><br>  To implement a similar set of functions, you need more than just asking for the location coordinates of the subscriber.  We implemented the ability to collect data from base stations immediately after updating them and aggregating them into history.  This made it possible to eliminate the constant system polling and provide for all services the possibility of obtaining information about the subscriber's coordinates in real time.  The platform accumulates all values ‚Äã‚Äãreceived from base stations, and geolocation services communicate with it already: <br><ul><li>  With a given frequency, data from base stations is checked to see if the subscriber has entered a zone that is allocated for monitoring; </li><li>  Specify the geo-location data on request.  In this way, you can get the last location of the subscriber; </li><li>  Build a route for the movement of subscribers based on historical data; </li><li>  Predict clusters and migration paths of subscribers based on stored history. </li></ul><br>  On the basis of this platform, there are a lot of services, for example, Emergency Services.  When you call 112, in addition to communicating with the operator and voicing the difficulty that has arisen, the geographical position of the caller is also transmitted.  In this case, operational services can act more accurately and find someone who needs help even if the connection was later lost. <br><br>  It is possible to use anonymous data (without using subscriber data), when only geographic coordinates are used for analysis.  We call it Geospatial analysis - aggregation of information on migration and movement, the accumulation of subscribers.  After receiving such information, you can find the most suitable place for the development of a network of shops, service offices or installation of ATMs.  But this is not the only application; thanks to this data, it is possible to predict new traffic intersections, public transport stops, social objects: parks, walking areas, and so on. <br><br><img src="https://habrastorage.org/storage2/506/f9e/c54/506f9ec54ba4dc0f271cc349d241bb91.jpg"><br>  <i>An example of the analysis of the accumulation of mobile devices of a certain category in the regions.</i> <br><br>  In the <a href="http://moscow.megafon.ru/services/joy/200403111752-7741.htm">Dating</a> service, which is built into the <a href="http://moscow.megafon.ru/services/searchandnavi/megafon-navigation.html">MegaFon-Navigation</a> application, we also apply only the geographical position.  You can find the subscribers closest to you, but the only thing that you can find out about them is the names (nickname) that users have set for themselves. <br><br><h4>  Conclusion </h4><br>  In general, for each task you can find your own tool that allows you to solve it in the best way.  You may also have ideas for a geolocation service that MegaFon subscribers or employees of your company will use.  We will be glad to all offers of cooperation or requests for access to API services. <br><br>  <i>All described services are developed and developed in the company <a href="http://www.megalabs.ru/">"MegaLabs"</a> .</i> </div><p>Source: <a href="https://habr.com/ru/post/167905/">https://habr.com/ru/post/167905/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167889/index.html">Amazon Web Services: cheaper again</a></li>
<li><a href="../167891/index.html">Someone got a report on natural gas 400 milliseconds earlier.</a></li>
<li><a href="../167893/index.html">Using ssh socks proxy with MSF Reverse TCP Payloads</a></li>
<li><a href="../167895/index.html">Long Polling A to Z do it yourself</a></li>
<li><a href="../167903/index.html">And this is Chelyabinsk ... UWDC venue!</a></li>
<li><a href="../167907/index.html">Rambler closes Map projects, Avia, Photos, Dictionaries, Rambler Plus</a></li>
<li><a href="../167909/index.html">Interview with the creator of C ++ STL, 1995 Part 3</a></li>
<li><a href="../167911/index.html">The Moscow Government opens co-working center to help small businesses.</a></li>
<li><a href="../167913/index.html">TeleGeography Worldwide Highway Map</a></li>
<li><a href="../167915/index.html">A new version of scrobbler for last.fm has been released, support for Raspberry Pi has been added</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>