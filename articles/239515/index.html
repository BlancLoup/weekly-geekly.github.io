<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Version Control in the Explorer context menu on VBS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When collectively working with a common group of files, it is often possible for someone from the employees to spoil the document. When I work as a la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Version Control in the Explorer context menu on VBS</h1><div class="post__text post__text-html js-mediator-article">  When collectively working with a common group of files, it is often possible for someone from the employees to spoil the document.  When I work as a layout designer in a district newspaper, I encounter such cases, and I have to rearrange some elements. <br><br>  Therefore, I thought about the file recovery system.  Backup on the machine is carried out automatically once a week, which allows not to lose data, but with frequent changes of documents it does not save.  The publication is weekly, there are few pages - the directory with the layout files of the current issue takes 1-2 GB.  We do not have a separate file server, all data is stored on my machine, and is used over the network by two more PCs.  Actually, all the cards in my hands. <br><a name="habracut"></a><br>  For backup, I use the utility <a href="https://www.maxsyncup.com/">MAX SyncUp</a> (not advertising).  There are 3 hard drives in the machine: OS / software, layout / photo and backups.  Creating a backup of any file does not noticeably affect performance.  There is plenty of space on the third HDD, so I didn‚Äôt use additional software, guided by the principle ‚ÄúLess frills - more stable operation of the system‚Äù. <br>  So, I started to organize my ideas. <br><br>  To begin with, in the backup utility I created a rule that copies all files that were changed in the layout to the X: \ Backup \ directory, indicating the date and time, every 7 minutes (the time was chosen experimentally).  Each version of the file has a difference in a short period of time, if, of course, has been changed.  Having worked since this Monday, I once again faced data corruption, and tried to recover them.  For this, we had to manually go into the backup directory and type the name of the strip in the search.  But it is impossible to work this way, and from the principle it is necessary to develop the idea.  I turn to the second part - I add the ‚ÄúFile Versions‚Äù item to the context menu. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To start in the registry created directory <br><br><pre><code class="vbscript hljs">HKEY_CLASSES_ROOT\*\shell\Search\command</code> </pre> <br><br>  In the last added string parameter <br><br><pre> <code class="vbscript hljs">WScript C:\windows\version.vbs \<span class="hljs-string"><span class="hljs-string">"%1\"</span></span></code> </pre><br><br>  In the Search directory in the registry above, I created a string parameter named MUIVerb that specifies the name of the item.  In our case, these are ‚ÄúFile Versions,‚Äù and an Icon parameter containing the path to the icon. <br><br>  What happened: <br><br><img src="https://habrastorage.org/files/248/aad/fd5/248aadfd532b45b5bbeee041c93f6656.png" alt="image"><br><br><img src="https://habrastorage.org/files/72b/57f/433/72b57f433c464709b07be52747db16ae.png" alt="image"><br><br>  My backups are saved to the directory automatically as they change to this form: <br><br><pre> <code class="html hljs xml">X:\Backup\2014-09-01T16-45\ 3  X:\Backup\2014-09-02T15-32\ 1  X:\Backup\2014-09-02T15-39\ 1 </code> </pre><br><br>  Now it's time to write a VBS script that searches for the necessary files in the backup and lists them. <br>  We use <a href="http://habrahabr.ru/post/52027/">WSO.dll</a> <br><br><div class="spoiler">  <b class="spoiler_title">Script code</b> <div class="spoiler_text"><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> folder <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> fso <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> filename <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> mass() folder = <span class="hljs-string"><span class="hljs-string">"X:\Backup"</span></span> <span class="hljs-comment"><span class="hljs-comment">'       Set WshShell = CreateObject("WScript.Shell") rc = WshShell.Run("regsvr32.exe /sc:\windows\wso.dll", 0, True) Set objArg = WScript.Arguments Set fso = WScript.CreateObject("Scripting.FileSystemObject") Set oFolders = fso.GetFolder(folder) Set oSubfolders = oFolders.SubFolders filename = FSO.GetFileName(objArg(0)) Redim mass(oSubFolders.Count) i = 1 For Each oFolder In oSubFolders mass(i) = oFolder.Name i=i+1 Next Set o = WScript.CreateObject("Scripting.WindowSystemObject") o.EnableVisualStyles = true Set f = o.CreateForm(0,0,520,0) f.Text = " " f.CenterControl() Sub ButtonClick(this) rc=WshShell.Run(this.note) f.Close() End Sub Function CanClose(Sender,Result) Result.Put(true) End Function files =0 for i = oSubFolders.Count to 1 Step -1 if FSO.FileExists(Folder &amp; "\"&amp; mass(i) &amp; "\" &amp; filename) Then if files &lt; 15 then f.ClientHeight = 40 * (files +1) f.CenterControl() strListFolders = fso.GetBaseName(Folder &amp; "\"&amp; mass(i) &amp; "\" &amp; filename) &amp; " - " &amp; GetDate(mass(i)) &amp; vbcrlf SET Button = f.CreateButton(7,40 * files,490,40,strListFolders) Button.CommandLinkButton = true Button.OnClick = GetRef("ButtonClick") Button.Note = chr(34) &amp; Folder &amp; "\"&amp; mass(i) &amp; "\" &amp; filename &amp; chr(34) files = files +1 End if End if Next if files =0 then MsgBox "  " f.close End if f.OnCloseQuery = GetRef("CanClose") f.Show() o.Run() Function StartupDir() Dim s s = WScript.ScriptFullName s = Left(s,InStrRev(s,"\")) StartupDir = s End Function Sub AboutWSO_OnHitTest(Sender,x,y,ResultPtr) ResultPtr.put(o.Translate("HTCAPTION")) End Sub Sub CloseFormHandler(Sender) Sender.Form.Close() End Sub function GetDate(ByVal DateIn) If DateDiff("d",DateSerial(Left(DateIn,4),Mid(DateIn,6,2),Mid(DateIn,9,2)),Date()) = 1 Then GetDate = "  " &amp; Mid(DateIn,12,2) &amp; "." &amp; Right(DateIn,2) ElseIf DateDiff("d",DateSerial(Left(DateIn,4),Mid(DateIn,6,2),Mid(DateIn,9,2)),Date()) &gt; 1 Then GetDate = Mid(DateIn,9,2) &amp; "." &amp; Mid(DateIn,6,2) &amp; "." &amp; Left(DateIn,4) &amp; "  " &amp; Mid(DateIn,12,2) &amp; "." &amp; Right(DateIn,2) 'ElseIf DateDiff("d",DateSerial(Left(DateIn,4),Mid(DateIn,6,2),Mid(DateIn,9,2)),Date()) &lt; 1 Then ' GetDate = Mid(DateIn,9,2) &amp; "." &amp; Mid(DateIn,6,2) &amp; "." &amp; Left(DateIn,4) &amp; "  " &amp; Mid(DateIn,12,2) &amp; "." &amp; Right(DateIn,2) ElseIf DateSerial(Left(DateIn,4),Mid(DateIn,6,2),Mid(DateIn,9,2)) = Date() Then GetDate = "  " &amp; Mid(DateIn,12,2) &amp; "." &amp; Right(DateIn,2) End If end function</span></span></code> </pre><br></div></div><br><br>  What happened: <br><br><img src="https://habrastorage.org/files/fea/174/2d7/fea1742d7c844eb4ae2cb80638c51fe3.png" alt="image"><br><br><img src="https://habrastorage.org/files/fc5/d6c/984/fc5d6c984aa042f590b46aec80258b6f.png" alt="image"><br><br>  I also put backup files on auto deletion older than 10 days.  Since the accumulated occupied disk volume from Monday to Friday was 6 GB, you should not worry about the free space.  Now it is possible, without keeping cumbersome software in memory, to have quick access to backup copies, including over the network, since there is no need for additional software on other machines. <br><br>  The implementation certainly has flaws, such as the lack of searching in subdirectories and binding to the name.  But, although now there is no need for a more flexible structure of the VBS script, it will probably be needed in the future.  I will be glad to criticism and suggestions. </div><p>Source: <a href="https://habr.com/ru/post/239515/">https://habr.com/ru/post/239515/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../239501/index.html">How to make Apache work or how I implement the creation of thumbnails of images in my projects</a></li>
<li><a href="../239503/index.html">Conference "Extreme Robotics" through the eyes of a student</a></li>
<li><a href="../239507/index.html">Cloudflare has enabled free SSL for all sites.</a></li>
<li><a href="../239509/index.html">In Cloud. RF - electronic cloud computing journal</a></li>
<li><a href="../239511/index.html">A simple way to assess the clarity of the text in Russian</a></li>
<li><a href="../239517/index.html">Icon hamburger</a></li>
<li><a href="../239519/index.html">How I implemented Linux in school</a></li>
<li><a href="../239523/index.html">Tools for translating works into the public domain</a></li>
<li><a href="../239525/index.html">Problems of modern "dialers"</a></li>
<li><a href="../239529/index.html">Premature optimization is evil!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>