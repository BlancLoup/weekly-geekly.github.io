<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As we wrote a strategic clicker on the hackathon ReactRiot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hey. Not so long ago, we with rjericho saw the article How I participated in the Angular Attack hackathon, and what came of it . We in Barnaul started...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As we wrote a strategic clicker on the hackathon ReactRiot</h1><div class="post__text post__text-html js-mediator-article"><p>  Hey.  Not so long ago, we with <a href="https://habrahabr.ru/users/rjericho/" class="user_link">rjericho</a> saw the article <a href="https://habrahabr.ru/company/wrike/blog/330504/">How I participated in the Angular Attack hackathon, and what came of it</a> .  We in Barnaul <a href="http://hack.apiorg.ru/">started</a> hackathons just a year ago.  At the same time, they were more focused on the quick start of an IT startup.  Therefore, they could not get to enjoy the use of all sorts of cool hipster libraries, and had to cut the product in good old PHP or Java.  However, we have long wanted to participate in some kind of fan event, where you can just cut down what your heart desires and not think up how to monetize it. </p><br><p>  A hackathon was found from the same organizers as AngularAttack: <a href="https://www.reactriot.com/">ReactRiot</a> .  The fact that we knew about the reactor only from articles on Habr√© only added interest to this event. </p><br><p><img src="https://habrastorage.org/web/caf/022/4c7/caf0224c746441c8b8b7e6024c9e4cdb.png" alt="Screenshot of the resulting game interface"></p><a name="habracut"></a><br><h2 id="za-nedelyu-do-hakatona">  One week before the hackathon </h2><br><p>  For a start it was necessary to learn more about the reactor itself.  Habr, official docks and <a href="https://codesandbox.io/">codesandbox.io</a> helped with this.  On this site there were some examples that helped determine the choice of core libraries. </p><br><p>  <a href="https://mobx.js.org/">MobX</a> was selected for state management.  <a href="http://redux.js.org/docs/introduction/">Redux</a> also looked interesting, but it seemed that it is not suitable for the hackathon, as it takes more time to think through the architecture and add actions, which is not very suitable for the hackathon format, when one day after the start you come up with a brilliant feature that doesn‚Äôt fit into the architecture . </p><br><p>  For the styling of the components was taken <a href="https://github.com/paypal/glamorous">glamorous</a> and the <a href="https://github.com/threepointone/glamor">glamor</a> itself.  I liked that all the code of one component can be in one file, and not scattered in the css and js folders and does not affect other components. </p><br><h2 id="za-dva-dnya-do-hakatona">  Two days before the hackathon </h2><br><p>  The hardest thing in the hackathon is the idea :).  Since for us the goal of this hackathon was to study a new technology and get a fan, it was decided to make a game.  And so that it also beautifully lay down in the principles of the reactor and mobx, i.e. it was possible to create a component and use it many times on the page, as well as when everything was reacted by the user, it was decided to do something like a clicker. </p><br><p>  <a href="https://docs.google.com/document/d/1tB43Osh_299Y9QvkHVGQWdjyyaG0gcvYr2gTFAQugk0/edit%3Fusp%3Dsharing">The initial idea</a> was a simulator of a mining village with various types of miners, mines and auxiliary buildings that affect miners (such as increasing productivity, etc.).  However, when I started doing mocap for this case, it turned out that it was very difficult to put this on one screen so that it was immediately clear what to do here.  Therefore, the idea was completely redone. </p><br><p>  The only thing left of the initial idea is that the population has a discontent indicator, with an increase in which they begin a riot (eng. Riot - a reference to the name of the hackathon). </p><br><p>  In short: </p><br><ul><li>  Different types of resources (wood, jewelry, money, food, electricity) </li><li>  Population: <br><ul><li>  Unemployed - you can teach the profession </li><li>  Workers - extract a certain type of resources (miner, forester, farmer, hunter) </li><li>  Criminals spoil resources a little </li><li>  Rebellious - badly spoil resources </li><li>  Prisoners - can not become criminals, they immediately extract all the resources </li><li>  Soldiers - differ in strength (recruit, sergeant, officer, general).  You can send to the war to seize resources or turn into police, so that criminals and rioters become prisoners </li></ul></li><li>  Population parameters <br><ul><li>  Mortality - the probability of death for people tick.  Strongly increases when there is not enough food. </li><li>  Dissatisfaction - the higher it is, the more criminals, if the threshold is exceeded </li></ul></li><li>  Buildings - during the construction they change other game parameters (electricity, number of unemployed, mortality, discontent) </li></ul><br><p>  A full description of the idea with which we started the hackathon can be found <a href="https://docs.google.com/document/d/1vsEaygq7tQRayYm7U0PQaOg5_FLo9sxg4Os04NVfznU/edit%3Fusp%3Dsharing">here</a> .  True, it differs from what eventually happened, as some features did not have enough time.  Other features were remembered only in the middle of the hackathon, when it was already difficult to insert them. </p><br><p>  And here there would be another problem for the team of two programmers - the graphic component of the project.  However, following the example of <a href="https://habrahabr.ru/users/stickytape/" class="user_link">stickytape,</a> suitable icons for units, resources, and buildings were taken from the <a href="https://github.com/twitter/twemoji">emoji twitter pack</a> (except for the ax logo. It turns out that it is not in Unicode and, accordingly, in emoji. Therefore, an ax suitable for the style had to be found elsewhere). </p><br><p><img src="https://habrastorage.org/web/846/ffb/4ef/846ffb4ef11d482ab804eecf55388591.png" alt="Example of unit icons"></p><br><h2 id="za-chas-do-hakatona">  An hour before the hackathon </h2><br><p>  An hour before the hackathon - it's time to start thinking about the architecture of the project :).  However, they only managed to invent a folder structure. </p><br><p><img src="https://habrastorage.org/web/3e9/eeb/899/3e9eeb8996eb48759d3dfc928e07426a.png" alt="Project Folder Structure"></p><br><p> The <code>components</code> contain the jsx components of the reactor.  In <code>logic</code> - model - MobX states. <br>  A <code>static</code> webpack bundle was assembled, third-party css, fonts and images were inserted. <br>  In <code>styles.js</code> were some common styles that were used in several components, like this: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { css } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'glamor'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> boldBorder = css({ <span class="hljs-attr"><span class="hljs-attr">border</span></span>: <span class="hljs-string"><span class="hljs-string">'3px solid'</span></span> })</code> </pre> <br><p>  Not sure about properly organized work with such styles.  It would be nice if the comments suggested something about this. </p><br><h2 id="pervyy-den">  First day </h2><br><p>  Development began with the creation of small information components.  Components have been written to display information on one unit, building and resource. </p><br><p><img src="https://habrastorage.org/web/49a/2cd/469/49a2cd469c594152892fb7d45f12db45.png" alt="Components"></p><br><p>  After that, the main three-column view was made up and a couple more components were added.  This is <a href="https://react-bootstrap.github.io/getting-started.html">where the react-bootstrap</a> and <a href="https://github.com/whoisandy/react-rangeslider">react-rangeslider libraries helped</a> . </p><br><p>  The result was this: </p><br><p><img src="https://habrastorage.org/web/7d1/62a/f79/7d162af79bb947078071f4fd4320db8d.png" alt="General form"></p><br><p>  Then a component of displaying the grid of units and buildings was written and some icons were added. </p><br><p>  Finally it is time to write logic.  The first was written to increment resources for units and build new units.  This is where the first wtf happened. </p><br><p>  We update the game in ticks: the main ticks are in one second.  Smaller learning tics were also introduced to more smoothly reflect learning progress.  When a unit was clicked, the animation of its construction began, and if everything was still good with one unit, then at a click on several lags at once.  Even not so - logs.  Everything was starting to slow down so wildly that I already thought to just remove this animation.  However, the time was later and, having decided that morning was wiser, we went to bed. </p><br><h2 id="vtoroy-den">  Second day </h2><br><p>  The morning of the second day began with the realization of our main mistake: we are preparing MobX incorrectly.  Our minimal components that display the basic information are not observers, but stupidly receive information about what to show through props.  And this is fundamentally contrary to the method of operation of MobX. </p><br><p>  It was: </p><br><pre> <code class="javascript hljs">&lt;Unit key={i} trainingAvailable={<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.canBuy(unit)} trainingProgress={unit.queueProgress} queueSize={unit.queueLength} name={unit.name} cost={unit.costStr} description={unit.description} imgSrc={unit.imgSrc} onTrain={() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.onTrain(unit)} /&gt;</code> </pre> <br><p>  After correcting this error, the application speed has stabilized. </p><br><p>  It became: </p><br><pre> <code class="javascript hljs">&lt;Unit key={i} unit={unit} trainingAvailable={<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.canBuy(unit)} onTrain={() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.onTrain(unit)} /&gt;</code> </pre> <br><p>  Also in the process of correcting this miscalculation, it was discovered that dynamically using <code>glamor.css</code> inside <code>render()</code> is not very good.  For each change in style used in the animation, he created a new rule in the style sheet, which perhaps also sagged performance. </p><br><p>  After the correction of yesterday‚Äôs jambs, a grid of buildings was added </p><br><p><img src="https://habrastorage.org/web/80f/b23/31d/80fb2331dd474ec59cdc8bd2459195a2.png" alt="Building construction grid"></p><br><p>  Then there was completed the logic of mortality of the population and the accumulation of discontent, sending soldiers to the war, and also added zero speed of the game to create a pause. </p><br><p>  After that, it was time to balance all the coefficients, prices and effects of buildings so that it was impossible to play just poking at everything, but also so that it was not too hardcore.  It was probably the most fun part.  Because of the mortality formula invented by the bald, it was interesting to observe how the lumberjacks who were taking turns turning down one tree and immediately died, because of the high crime rate, the newly trained farmers immediately became criminals, ate all stocks and started to rebel from hunger.  However, if the death rate was balanced still fairly easily, then while calibrating crime, we could not find such a balance for a long time, so that with a small starting number of people they would not immediately become criminals.  As a result, we had to introduce a mechanism for turning the criminals back into the unemployed, also with a certain coefficient. </p><br><p><img src="https://habrastorage.org/web/599/d27/8aa/599d278aae204e9f939fedd8e54b3f96.png" alt="Notification example"></p><br><p>  After adjusting the balance, it was necessary to add notifications of riot and random events (migrations and floods), as well as add a voting plate from the organizers.  Moreover, they made this plate 6 hours before the end of the hackathon and when it was added, we had to transfer one block from the right side of the interface to the left one, so that everything would fit in height. </p><br><h2 id="itogi">  Results </h2><br><p>  In the process of the hackathon, the reactor and MobX were studied, although at the initial level.  Some rakes were tried on their own :).  One of our main conclusions: the architecture is better to think about it a bit beforehand.  So, of course, it turns out more roflov, but on the second day the code changed color to brown and some things were done with awful crutches.  The code can be found <a href="https://github.com/alhimik45/reactriot2017-town">here</a> .  You can poke the game itself at <a href="http://town.surge.sh/">town.surge.sh</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/331778/">https://habr.com/ru/post/331778/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331768/index.html">MIPT launches Russia's first online magistracy in technology entrepreneurship</a></li>
<li><a href="../331770/index.html">JQuery plugin - jdDialog. The principle of "transit calls"</a></li>
<li><a href="../331772/index.html">Cash registers go online: Russia's tax has opened a new market for application developers</a></li>
<li><a href="../331774/index.html">What is RQL</a></li>
<li><a href="../331776/index.html">SD-WAN "on the fingers": pros, cons, pitfalls</a></li>
<li><a href="../331780/index.html">It's time to throw! Migration Experience from Objective-C to Swift</a></li>
<li><a href="../331784/index.html">Million WebSocket and Go</a></li>
<li><a href="../331786/index.html">The problem of continuous protection of web applications. View from the side of researchers and operators</a></li>
<li><a href="../331788/index.html">Petya.A, Petya.C, PetrWrap or PetyaCry? New virus threat for companies in Russia and Ukraine</a></li>
<li><a href="../331790/index.html">Early bury java</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>