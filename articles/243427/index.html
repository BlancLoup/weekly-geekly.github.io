<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>[TRANSFER] JSON Web Token-based authentication in Django and AngularJS: part one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The most common authentication method is cookie cookie authentication. A more modern authentication method is based on using JSON Web Token (literally...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>[TRANSFER] JSON Web Token-based authentication in Django and AngularJS: part one</h1><div class="post__text post__text-html js-mediator-article">  The most common authentication method is cookie cookie authentication.  A more modern authentication method is based on using JSON Web Token (literally: web marker in JSON format) and it is quickly gaining popularity.  In this article we will focus on it. <br><br><h4>  <b>What is JSON Web Token?</b> </h4><br>  The markers are actually pretty simple.  Imagine a marker as a key in the form of a card with which you enter the office every day.  When you were hired by a company, you confirmed your identity (login) by providing a set of credentials, such as a driver's license or a social security number.  In exchange for this data, you were given a key (marker) that allows you to be in the building.  If you decide to quit your job or you are fired (logged out), the company may simply disable the key.  Of course, this key may remain in your pocket, but it will not give you anything good. <br><br>  JSON Web Token is a simple token in a special format.  While the format is not standardized, but many already use one of its implementations ( <a href="http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html">JWT</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://jwt.io/">JWT</a> (pronounced jot) consists of three parts: <br><ul><li>  Headline </li><li>  Payload </li><li>  Signature </li></ul><br>  Let's look at each of them before we delve into the implementation. <br><a name="habracut"></a><br><h4>  <b>Headline</b> </h4><br>  By default, the header contains only the type of the token and the algorithm used for encryption. <br>  Marker type is stored in the ‚Äútyp‚Äù key.  The ‚Äútyp‚Äù key is ignored in JWT (this is not important for this article, but you can <a href="http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html">read</a> to find out why).  If the key "typ" is present, its value must be JWT to indicate that this object is JSON Web Token. <br>  The second key "alg" defines the algorithm used to encrypt the token.  By default, it should be set to HS256.  There are a number of alternative algorithms that are used in various implementations.  A complete list with a breakdown by library can be found at JWT.io. <br>  The header is encoded in base64. <br><br><h4>  <b>Payload</b> </h4><br>  The payload stores any information that needs to be checked.  Each key in the payload is known as a ‚Äústatement‚Äù.  For example, consider a social network in which you can join the community only by invitation.  When we want to invite someone to the community, we send him an invitation letter.  Here it is important to check that the email address belongs to the person who accepts the invitation, so we will include this address in the payload, for this we will save it in the ‚Äúemail‚Äù key. <br><br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"email"</span></span>: <span class="hljs-string"><span class="hljs-string">"example@jamesbrewer.io"</span></span> }</code> </pre> <br>  The keys in the payload can be arbitrary.  However, there are some reserved ones that you need to know: <br><ul><li>  iat (Issued At).  This key represents the time when the marker was issued and can be used to determine the age of the JWT.  iat key must be a timestamp in unix format. </li><li>  exp (Expiration Time).  This key indicates when the token expires.  Standard </li></ul>  JWT requires that, in all its implementations, expired markers be rejected.  In <a href="http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html">some implementations</a> , additional keys may be added to account for time out-of-sync.  The exp key must be a timestamp in unix format. <br>  It is important to understand that the payload is not transmitted in encrypted form (although markers can be nested and then it is possible to transfer encrypted data).  Therefore, it can not store any secret information.  For example, passwords, social security numbers, etc. <br>  Like the header, the payload is base64 encoded. <br><br><h4>  <b>Signature</b> </h4><br>  When we have a header and payload, we can calculate the signature. <br>  Base64-encoded header and payload are taken, they are combined into a string through a dot.  Then this string and the secret key are fed to the input of the encryption algorithm specified in the header (the ‚Äúalg‚Äù key).  The key can be any string.  Longer lines will be most preferable, since it will take more time to pick up. <br><br><h4>  <b>Jwt</b> </h4><br>  Now that we have a header, payload, and signature, we can build JWT.  The final JWT is as follows: <br><br><pre> <code class="javascript hljs">&lt;encoded header&gt;.&lt;encoded payload&gt;.&lt;signature&gt;</code> </pre><br>  Note: never save a marker in your database.  Because a valid token, equivalent to a password, to store a token is the same as storing a password in the clear.  Therefore, always use hashing before saving. <br><br><h4>  <b>Implementing Authentication with JSON Web Token</b> </h4><br>  Let's go ahead and create our project. <br>  Go to the project directory and run the commands: <br><br><pre> <code class="bash hljs">$ django-admin.py startproject django_angular_token_auth $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> django_angular_token_auth/ $ mkdir static templates</code> </pre><br>  You need to make sure that the STATICFILES_DIRS and TEMPLATE_DIRS settings are present in django_angular_token_auth / settings.py and they should look like this: <br><pre> <code class="python hljs">STATICFILES_DIRS = ( os.path.join(BASE_DIR, <span class="hljs-string"><span class="hljs-string">'static'</span></span>), ) TEMPLATE_DIRS = ( os.path.join(BASE_DIR, <span class="hljs-string"><span class="hljs-string">'templates'</span></span>), )</code> </pre><br><br><h4>  <b>Django REST Framework</b> </h4><br>  Now you need to install the Django REST Framework.  The Django REST Framework is a large open source project for those who want to create one-page applications and APIs for them. <br><br>  We will not discuss in detail how the Django REST Framework works, so if you are not familiar with it, check the documentation. <br><br>  To install the Django REST Framework, run the following command: <br><br><pre> <code class="bash hljs">$ pip install djangorestframework</code> </pre><br>  The Django REST Framework must be added to your installed applications (INSTALLED_APPS in django_angular_token_auth / settings.py :) <br><br><pre> <code class="python hljs">INSTALLED_APPS = ( ..., <span class="hljs-string"><span class="hljs-string">'rest_framework'</span></span>, )</code> </pre><br>  You also need to add the following parameters in django_angular_token_auth / settings.py: <br><br><pre> <code class="python hljs">REST_FRAMEWORK = { <span class="hljs-string"><span class="hljs-string">'DEFAULT_PERMISSION_CLASSES'</span></span>: ( <span class="hljs-string"><span class="hljs-string">'rest_framework.permissions.IsAuthenticated'</span></span>, ), <span class="hljs-string"><span class="hljs-string">'DEFAULT_AUTHENTICATION_CLASSES'</span></span>: ( <span class="hljs-string"><span class="hljs-string">'rest_framework.authentication.SessionAuthentication'</span></span>, <span class="hljs-string"><span class="hljs-string">'rest_framework.authentication.BasicAuthentication'</span></span>, ), }</code> </pre><br>  We will not use SessionAuthentication or BasicAuthentication, but they are available in the Django REST Framework and offer a working API out of the box. <br><br><h4>  <b>django-rest-framework-jwt</b> </h4><br>  The last thing to do is to install django-rest-framework-jwt.  This package provides JWT support for the Django REST Framework and uses the PyJWT implementation as JSON Web Token.  To install django-rest-framework-jwt, run the following command: <br><br><pre> <code class="bash hljs">$ pip install djangorestframework-jwt</code> </pre><br>  You will need to add the following parameters to django_angular_token_auth / settings.py: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime JWT_AUTH = { <span class="hljs-string"><span class="hljs-string">'JWT_EXPIRATION_DELTA'</span></span>: datetime.timedelta(days=<span class="hljs-number"><span class="hljs-number">14</span></span>) }</code> </pre><br><br>  This parameter indicates the lifespan for our markers and in our case it will be 14 days.  You can change it based on your own preferences. <br><br>  You should also add the updated REST_FRAMEWORK settings: <br><br><pre> <code class="python hljs">REST_FRAMEWORK = { <span class="hljs-string"><span class="hljs-string">'DEFAULT_PERMISSION_CLASSES'</span></span>: ( <span class="hljs-string"><span class="hljs-string">'rest_framework.permissions.IsAuthenticated'</span></span>, ), <span class="hljs-string"><span class="hljs-string">'DEFAULT_AUTHENTICATION_CLASSES'</span></span>: ( <span class="hljs-string"><span class="hljs-string">'rest_framework.authentication.SessionAuthentication'</span></span>, <span class="hljs-string"><span class="hljs-string">'rest_framework.authentication.BasicAuthentication'</span></span>, <span class="hljs-string"><span class="hljs-string">'rest_framework_jwt.authentication.JSONWebTokenAuthentication'</span></span>, ) }</code> </pre><br><br>  Please note that we have added: <br>  'rest_framework_jwt.authentication.JSONWebTokenAuthentication', in 'DEFAULT_AUTHENTICATION_CLASSES'. <br><br><h4>  Creating a django application </h4><br>  Now let's create a Django application for storing views and serializers in it: <br><br><pre> <code class="bash hljs">$ python manage.py startapp authentication</code> </pre><br><br>  Add 'authentication' to our INSTALLED_APPS (in django_angular_token_auth / settings.py like so): <br><br><pre> <code class="python hljs">INSTALLED_APPS = ( ..., <span class="hljs-string"><span class="hljs-string">'rest_framework'</span></span>, <span class="hljs-string"><span class="hljs-string">'authentication'</span></span>, )</code> </pre><br>  As a rule, after creating the application, you need to perform migrations to create models in the database.  But we will not create our own models, so there is no need to worry about it. <br><br><h4>  <b>Serializers</b> </h4><br>  To test the functionality of the API, you need to send some data to AJAX requests.  The easiest way to do this is to send back user data in our system. <br><br>  The first thing to do is create a user.  Run the following command and follow the instructions on the screen: <br><br><pre> <code class="bash hljs">$ python manage.py createsuperuser</code> </pre><br>  After creating the user, it is necessary that Django send his data to the Angular application.  Obviously, we cannot send Django objects to our application in JavaScript, so we need a serializer to convert objects to JSON and back.  It can be easily created using the Django REST Framework. <br>  Create a file called serializers.py and add the following code to it: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.auth.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> User <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rest_framework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> serializers <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserSerializer</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(serializers.ModelSerializer)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Meta</span></span></span><span class="hljs-class">:</span></span> model = User fields = (id, username, email)</code> </pre><br><br>  This code tells the Django REST Framework that we want to serialize the User model and we want to include only the following fields: id, username and email. <br><br><h4>  <b>Representation</b> </h4><br>  With the serializers figured out, let's now move on to the views. <br>  For our purposes, we need only one view, which will return a list of user objects. <br>  The Django REST Framework offers a variety of views that perform different functions, for example, a list of objects of one type.  This functionality is offered by the ListAPIView class. <br>  Add the following to authentication / views.py: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.contrib.auth.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> User <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rest_framework <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> generics <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> authentication.serializers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UserSerializer <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserListAPIView</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(generics.ListAPIView)</span></span></span><span class="hljs-class">:</span></span> queryset = User.objects.all() serializer_class = UserSerializer</code> </pre><br><br><h4>  Templates </h4><br>  Create a simple template that will represent our application. <br>  Create a file called templates / index.html and add the following code to it: <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>django-angular-token-auth<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> Hello, World! <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  In the following, we will add some angular code to this file. <br><br><h4>  <b>URLs</b> </h4><br>  Now you need to configure the URLs for our project. <br>  Open django_angular_token_auth / urls.py and bring it to the following view: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.conf.urls <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> include, patterns, url <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> django.views.generic <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TemplateView <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> authentication.views <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UserListAPIView urlpatterns = patterns(<span class="hljs-string"><span class="hljs-string">''</span></span>, url(<span class="hljs-string"><span class="hljs-string">r'api/v1/auth/login/'</span></span>, <span class="hljs-string"><span class="hljs-string">'rest_framework_jwt.views.obtain_jwt_token'</span></span>), url(<span class="hljs-string"><span class="hljs-string">r'api/v1/users/'</span></span>, UserListAPIView.as_view()), url(<span class="hljs-string"><span class="hljs-string">r'^.*$'</span></span>, TemplateView.as_view(template_name=<span class="hljs-string"><span class="hljs-string">'index.html'</span></span>)), )</code> </pre><br>  Let's take a look at what's going on here. <br><br>  The first thing you notice, in the second argument for the first URL pattern is the string.  This line points to the django-rest-framework-jwt view that generates the token.  We will not consider how it works, but you can see the django-rest-framework-jwt code in the Github repository: django-rest-framework-jwt / rest_framework_jwt / views.py. <br>  We also did not use the TemplateView view before.  It is similar to the ListAPIView class in the Django REST Framework, which offers an easy way to handle templates. <br><br>  You probably noticed that the regular expression used in the last URL pattern will match any URL. <br><br>  For correct processing of addresses, it is important that this pattern is the last.  Because, Django matches the address with the templates, in the order in which they are defined and the first match coincides with the check.  Since the regular expression used matches any address, we thereby give a chance to all other addresses to be processed.  Anything that does not comply with Django should be processed with Angular.  Also, the API / api / v1 / namespace ensures that the Django and Angular templates will not conflict. <br><br><h4>  <b>In the second part</b> </h4><br>  On this we dwell.  In the second part, we will build the client application and mainly focus on the registration and login session.  We will write a service in order to be able to correctly log in and out of the system. </div><p>Source: <a href="https://habr.com/ru/post/243427/">https://habr.com/ru/post/243427/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243417/index.html">Ethernet Weather Station 2 - Continued ...</a></li>
<li><a href="../243419/index.html">Turing test based on real search queries in Yandex</a></li>
<li><a href="../243421/index.html">Print from Google Apps Script</a></li>
<li><a href="../243423/index.html">New IBM Global Entrepreneurship Program Accelerates Cloud Development</a></li>
<li><a href="../243425/index.html">Compact RSA implementation for embedded applications</a></li>
<li><a href="../243429/index.html">Autostarting Node.js application on CentOS 6.2</a></li>
<li><a href="../243431/index.html">Why you should never say "never"</a></li>
<li><a href="../243433/index.html">How we tested the dependence of LTE speed on S1 parameters</a></li>
<li><a href="../243437/index.html">C ++ code refactoring in Visual Studio 2015</a></li>
<li><a href="../243439/index.html">Document life cycle in professional help system. A little fabulous post about how a pile of paper turns into a system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>