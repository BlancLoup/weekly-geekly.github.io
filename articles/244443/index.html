<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Running applications in the Android Virtual Device on a remote Linux server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the process of working on one project, a situation arose when it was necessary to automatically conduct a series of operations from a mobile applic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Running applications in the Android Virtual Device on a remote Linux server</h1><div class="post__text post__text-html js-mediator-article">  In the process of working on one project, a situation arose when it was necessary to automatically conduct a series of operations from a mobile application.  Since the set of input data that the user enters for the operation of the application changes, an implementation was needed that would allow to simulate the user's actions.  Moreover, it was necessary for the application to run automatically on a remote linux server, perform actions and save the results.  About how to solve this problem, I want to tell the readers. <br><a name="habracut"></a><br>  The first part of the problem was solved quite simply - take a library to test mobile applications and implement the necessary logic.  The choice fell on Robotium.  Firstly, it is free, and secondly, it makes it quite convenient to work with the application under test, at least for me.  I will not focus on the implementation of tests, other articles are devoted to this, let me just remind you that this results in another application that can run the application under test, analyze what it displays, etc.  The second part of the work had much more all kinds of pitfalls, but first things first. <br><br><h4>  Requirements and tools </h4><br>  The main requirement was that the application should run on a linux server.  For me, this meant that the graphical interface would not be familiar to me, an inveterate "winery", with all the ensuing difficulties.  Also among the useful wishes was the ability to debug everything on the same server if necessary. <br><br>  For implementation were used: <br><ol><li>  Development Environment - <b>IntelliJ IDEA</b> ; </li><li>  Remote linux server - <b>Debian 7</b> ; </li><li>  <b>Android SDK</b> ; </li><li>  <b>Putty</b> - to implement remote debugging. </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Step 1. Deploy the SDK </h4><br>  Android SDK itself can be taken <a href="http://developer.android.com/index.html">from here</a> .  Of course, it requires a pre-installed JDK to work, I had version 1.7.  Previously, the x86 version was needed, but since some of the latest versions this problem has disappeared.  After we have the Android SDK, we begin to install and configure it: <br><ol><li>  Copy the archive to our linux-machine and unpack it in the desired directory; </li><li>  Next, update our SDK. <br>  There are two options.  First, when you know exactly what you need, then we get a list of available libraries: <br><br><pre><code class="bash hljs">./android list sdk ‚Äìall</code> </pre> <br>  As a result, we will get a long list of packages available for download, select the necessary ones and give the command to download from: <br><br><pre> <code class="bash hljs">./android update sdk --no-ui ‚Äìfilter&lt;        &gt;</code> </pre><br>  The second option is to download all that is available at the moment.  It turned out to be closer to me, because I myself am not an Android developer, and I was not sure that I would choose everything I needed: <br><br><pre> <code class="bash hljs">./android update sdk --no-ui</code> </pre><br>  Both of these commands are described on the official website in the <a href="http://developer.android.com/tools/help/android.html">documentation</a> section, but for some reason I didn‚Äôt find the description of the key - <i>no-ui</i> , which indicates a launch without a graphical interface. </li><li>  We are waiting for the end of the package download. </li></ol><br>  Further, for ease of management, you can add the <i>adb</i> , <i>android</i> , <i>emulator</i> utilities from the <i>platform-tools</i> and <i>tools</i> directories to the system variables, but I just ran them from the directory. <br><br><h4>  Step 2. Create and run the Android Virtual Device </h4><br>  Now we need to create our virtual device, here too nothing complicated, the command for this is standard: <br><br><pre> <code class="bash hljs">./android create avd --name &lt; &gt; --target &lt;    Android&gt; ‚Äìb &lt;  &gt;</code> </pre><br>  <i><b>The name of the device</b></i> - well, everything is clear here. <br>  <i><b>The sequence number of the Android OS version</b></i> - it can be seen in the list of available versions for device creation.  The list itself can be obtained with the command: <br><br><pre> <code class="bash hljs">./android list target</code> </pre><br>  <i><b>Processor instruction set</b></i> - which processor to emulate, if only one processor version was used for the Android version, then this parameter can be ignored, otherwise, in response to the command, the utility will display a message about the need to explicitly specify a set of instructions, and also indicate possible options.  For example, my value for this parameter was <i>default / armeabi</i> . <br><br>  After this, it creates a folder with a set of virtual device files, it is located in the <i>* /. Android / avd directory</i> , which is located either in the <i>root</i> directory, or in the directory where the SDK itself is located (depending on user rights).  The name of the file directory is the same as the name of the virtual device. <br><br>  Now we start our device.  I remind you that in the condition it is worth it that we have a server with terminal access, which means we did not have any graphic libraries, and never will.  But we must pay tribute to the guys from Google, they have provided for this case: <br><br><pre> <code class="bash hljs">./emulator -avd &lt; &gt; -no-window</code> </pre><br>  <i><b>-no-window</b></i> - indicates the launch with the screen off. <br>  <i><b>The device</b></i> name is the name we specified when creating the device above. <br>  A more detailed description and other launch keys can be found <a href="http://developer.android.com/tools/help/emulator.html">here</a> . <br><br>  Now we need to wait until the device boots: <br><br><pre> <code class="bash hljs">./adb <span class="hljs-built_in"><span class="hljs-built_in">wait</span></span>-for-device</code> </pre><br>  Now we just have to install our applications: the main one that accesses the server, and the robotium application that can access the main one and perform actions: <br><br><pre> <code class="bash hljs">./adb install -r &lt; &gt;</code> </pre><br>  <b><i>-r</i></b> - this key indicates that if the application already exists, overwrite it. <br>  <b><i>Application</i></b> name - the name of your apk-file with the extension. <br><br>  On many resources I met the mention that AVD can be transferred simply by copying files from one machine to another, but I did not succeed: when I tried to start up, I started cheerfully cursing the absence of a <i>kernel.ini</i> file, although I didn‚Äôt create any files directly in the linux emulator with that name was not observed.  But since the creation of an emulator is a matter of a minute, I waved my hand to it. <br><br><h4>  Step 3. Launch Applications </h4><br>  Launching a robotium application is quite simple (I‚Äôll give a specific example for clarity): <br><br><pre> <code class="bash hljs">./adb -s emulator-5554 shell am instrument -w -e class com.example.robotium.Kernel com.example/android.test.InstrumentationTestRunner</code> </pre><br>  <b><i>emulator-5554</i></b> is the name of the emulator, usually it is standard if the emulator is running on the system alone, but you can see the list of available launched devices with the command: <br><br><pre> <code class="bash hljs">./adb devices</code> </pre><br>  <b><i>e class com.example.robotium.Kernel</i></b> is the name of the class in the robotium application that directly executes the tests. <br>  <b><i>com.example</i></b> is the package name from the AndroidManifest.xml file for a robotium application. <br><br>  It would seem that here and the finish, but it was not there.  The application started, some time was executed and dropped out with an error.  Everything turned out to be trite, when you start the emulator starts with a locked screen - and it still displays this screen or not.  One of the first links in the search engine advises us to just drive a command: <br><br><pre> <code class="bash hljs">./adb shell input keyevent 82</code> </pre><br>  The test on his windows-machine showed that it works, and regardless of whether the emulator is running with the ‚Äìno-window parameter, and without it.  But the launch on debian-e did not give anything, the error was repeated, which means the reason is different, I suggested.  Long searches did not give anything concrete, apparently, very few people come to mind to drive tests for the GUI on the terminal server.  There were mostly comments that, since these tests are for gui, they cannot work even when the screen is off, they say, there is no GUI displayed, and there are no tests for them.  But my situation was from the category ‚Äúthe party said it is necessary‚Äù and I couldn‚Äôt come up with my answer to my teamlead, so I took it as an axiom that the screen simply didn‚Äôt unlock, unfortunately I didn‚Äôt check visually how it was smog, terminal server after all.  I added additional checks on the state of the screen at the time of launch, and it turned out that the screen was not only not unlocked, but also turned off - the team had failed. <br><br>  The problem was solved by software unlocking.  To do this, add the code to the robotium application: <br><br><pre> <code class="java hljs">PowerManager.WakeLock wl; PowerManager pm = (PowerManager) solo.getCurrentActivity().getApplicationContext().getSystemService(Context.POWER_SERVICE); wl = pm.newWakeLock(PowerManager.FULL_WAKE_LOCK | PowerManager.ACQUIRE_CAUSES_WAKEUP | PowerManager.ON_AFTER_RELEASE, <span class="hljs-string"><span class="hljs-string">"INFO"</span></span>); wl.acquire(); KeyguardManager km = (KeyguardManager) solo.getCurrentActivity().getApplicationContext().getSystemService(Context.KEYGUARD_SERVICE); KeyguardManager.KeyguardLock kl; kl = km.newKeyguardLock(<span class="hljs-string"><span class="hljs-string">"name"</span></span>); kl.disableKeyguard();</code> </pre><br>  For this code to work in the <i>AndroidManifest.xm</i> file, you need to add the following lines: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.WAKE_LOCK"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.DISABLE_KEYGUARD"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  It should be noted that you do not need to add to the robotium-application file, but to the file of the application under test, because all the work with the Android OS is done through it, which means that they need all access rights. <br><br>  After this, once again we execute the command described earlier - hurray, everything started, everything works. <br><br><h4>  Step 4. Configuring Remote Debugging </h4><br>  Unfortunately, from scratch, neither the Android SDK nor the IDEA can work with virtual devices on remote servers, which means we make them think that the device is nearby.  To do this, set up a tunnel to our server in Putty.  For this you need to add two ports - for the <i>emulator-5554</i> device, these will be ports <b>5554</b> and <b>5555</b> .  To clarify, just in case, the example in the image: <br><br><img src="https://habrastorage.org/files/44f/293/308/44f2933087d74ae9854bdefa23976241.png" alt="image"><br><br>  Now turn off the ADB service on the remote server: <br><br><pre> <code class="bash hljs">./adb <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span>-server</code> </pre><br>  And on the local machine, we start or restart (by turning it off immediately): <br><br><pre> <code class="bash hljs">./adb start-server</code> </pre><br>  Now if we execute the command <i>./adb devices</i> , we will see remote devices that are running.  Unfortunately, we can not run emulators remotely, just see the already running, well, and work with them.  Now, when launching a robotium application directly from IDEA, in the device selection dialog we will see our remote emulator (see image).  You can work with it in the same way as with the local one. <br><br><img src="https://habrastorage.org/files/1b7/0d6/84c/1b70d684c29548029de9f5dba341ef10.png" alt="image"><br><br>  Thank you for your attention, I hope this post will be useful to someone else, because I really missed it in due time. </div><p>Source: <a href="https://habr.com/ru/post/244443/">https://habr.com/ru/post/244443/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../244431/index.html">Agile in document flow</a></li>
<li><a href="../244435/index.html">Script on NodeJS for Backup data: End</a></li>
<li><a href="../244437/index.html">Barcode Printers in Trade Automation</a></li>
<li><a href="../244439/index.html">Making email notifications and increasing the number of paying customers</a></li>
<li><a href="../244441/index.html">Sale of game items in online games have imposed VAT</a></li>
<li><a href="../244445/index.html">Registration of a tax-free company in Estonia</a></li>
<li><a href="../244447/index.html">84% of WordPress sites can be hacked: what next?</a></li>
<li><a href="../244449/index.html">Sync, share & secure - three in one with Acronis Access 7</a></li>
<li><a href="../244451/index.html">Resources for learning Wolfram Language (Mathematica) in Russian</a></li>
<li><a href="../244455/index.html">We write a simple encyclopedia on the Slim Framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>