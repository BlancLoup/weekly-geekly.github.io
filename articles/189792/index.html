<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a simple bot for WoW, programming routes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 I recently read a post in which the author spoke about his bot for trading at auction in the game World of Warcraft. His character ran ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a simple bot for WoW, programming routes</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  I recently read a <a href="http://habrahabr.ru/post/113258/">post</a> in which the author spoke about his bot for trading at auction in the game World of Warcraft.  His character ran a shuttle for short distances and performed specific actions strictly specified in the control program.  Taking advantage of his ideas, I decided to go a little further: let the character be able to run along a route of at least five minutes, while it should be possible to record the route and the actions performed from the outside, without resorting to changing the management program itself.  What I described is the development of <a href="http://habrahabr.ru/post/113258/">the original post</a> , however I tried to make it not mandatory to read it. <br>  In the post I will describe <br><ol><li>  The process of creating a trivial addon for the user interface of WoW in the Lua language <br><ul><li>  Serialization of data for transmission between parts of the system </li><li>  Transfer using color pixels </li></ul></li><li>  AutoIt character management process <br><ul><li>  Program to record actions </li><li>  Program to play </li><li>  Calculation of the direction of movement </li><li>  Why you should not resort to reading / writing process memory </li></ul></li><li>  Program management (ro) bot with commands that are understandable to non-programmer </li></ol><br><a name="habracut"></a><br><h4>  A warning </h4><br>  I understand that the use of bots is prohibited by the license agreement Blizzard.  This can lead to permanent account banning.  I would be upset to learn that someone, taking advantage of the materials of this post, began to profit, worsening the economy of the game and causing disapproval of other players.  And yes, I understand that what I am doing is not fair. <br><br>  The purpose of the post is to tell about my experience and describe the difficulties I encountered, to find out from you what could have been done better. <br><br><h4>  Prehistory </h4><br><h5>  Collecting </h5><br>  People far from the gaming industry may, without prejudice, skip this section.  The WoW game has such an aspect - collecting.  As in numismatics / philately, the more you have, for example, riding animals, the more pleasant it is for you.  The process of getting is just as important.  Some dragons require dozens of tasks ("achivok") to do, some to enter the top 2% of players in the world for character management skills (arena battles), something you can just buy for game currency, then - for real money in the store.  Details can be read in <a href="http://www.mmopeon.ru/index.php/articles/235-wow-all-mounts">another source</a> , it's not about that.  So, some of the collected items fall into the dungeon with a chance of about 0.5%.  If the chance of loss is given to the player only once a day (sometimes a week), you will need time, commensurate with the year, for the races.  And all for the sake of the moment of receiving the cherished suffering object.  The more time and effort you have spent on the " <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B0%25D1%2580%25D0%25BC%25D0%25B5%25D1%2580_(MMORPG)">farm</a> " of an item, the more pleasant it is for you to get it in the end.  In my experience, joy is very fleeting. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  The dependence of the chance of loss on the number of attempts </h5><br>  A small digression.  What is the likelihood that in six throws of the die would be ‚Äú6‚Äù?  It's obvious that <a href="http://www.codecogs.com/eqnedit.php%3Flatex%3D1-%5Cfrac5%26space%3B6%5E6%5Capprox%26space%3B0.66"><img src="https://habrastorage.org/getpro/habr/post_images/92b/bc0/f47/92bbc0f4733832ea8ffd80ba6c6c16e5.gif" title="1- \ frac5 6 ^ 6 \ approx 0.66"></a>  .  That is, our event is the <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B5%25D1%2580%25D0%25BE%25D1%258F%25D1%2582%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C">opposite event</a> to the failure of "6" for all six attempts. <br>  Using the <a href="http://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BC%25D0%25B5%25D1%2587%25D0%25B0%25D1%2582%25D0%25B5%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BB">second remarkable limit</a> , it is easy to show that <a href="http://www.codecogs.com/eqnedit.php%3Flatex%3D1-(1-%5Cfrac1%26space%3Bn)%5En%5Crightarrow%26space%3B1-%5Cfrac1%26space%3Be"><img src="https://habrastorage.org/getpro/habr/post_images/87f/68d/785/87f68d785d1353bf3f5a6fa82b5a4a93.gif" title="1- (1- \ frac1 n) ^ n \ rightarrow 1- \ frac1 e"></a>  . <br><br>  And the probability of getting a horse with a ‚Äúdrop‚Äù chance of 1% for 100 attempts is approximately equal to 63%. <br><br>  Some players, having made three hundred attempts, consider that they are just about lucky, because the probability of breaking off for such a large number of attempts is small.  They are disappointed, because in the next 100 they will be lucky again only by 63%.  And the old works give nothing. <br><br><h5>  Task </h5><br>  There is a dungeon.  It is necessary to run through it with turns, perform a couple of simple tasks along the way.  Kill the final boss and raise loot.  In order not to run to the exit on foot, teleport to the nearest village and fly to the entrance.  Repeat 5 times. <br><br>  Dungeon map and route: <br><img src="https://habrastorage.org/storage2/688/ca7/3b9/688ca73b9eb240ae0bec1b894b60dc96.jpg"><br><br>  The maximum task.  Launched and left for half an hour.  The process is fully automatic. <br><br>  The task is at least.  Run and sit next to, read or play the guitar, glancing at the monitor.  If necessary, occasionally help the character get out of an unexpected situation. <br><br>  It is important to be able, if desired, to describe the route of another dungeon without getting into the code. <br><br><h4>  An approach </h4><br><h5>  Motion and positioning </h5><br>  Just write down and release the keys, the position and mouse clicks will not work.  It is more accurate to write something, only during playback, something completely different than what you expected will occur for the following reasons: <br><ol><li>  You need to reproduce the original position of the character and the direction of his gaze.  If you turn slightly in the opposite direction before the automatic race, you will run crookedly and sooner or later hit the wall </li><li>  If you have recorded the exact coordinates and angle, then you will not be able to place the character there either.  He responds to the buttons like a bulldozer and turns the same way.  And even an error of 1 degree in 100 meters will result in <a href="http://www.codecogs.com/eqnedit.php%3Flatex%3D%5Csin1%5E%7B%5Ccirc%7D*100%5Capprox%26space%3B2"><img src="https://habrastorage.org/getpro/habr/post_images/4d5/35d/bdd/4d535dbddaa661486fa33e6d7258872d.gif" title="\ sin1 ^ {\ circ} * 100 \ approx 2"></a>  meters (doorway width) </li><li>  The time of pressing and releasing the buttons is also far from ideal.  It is like moving around an apartment with eyes closed.  It seems to be six steps forward and strictly to the right, but in fact, instead of the toilet, we find ourselves in the bathroom.  Try also to open the door with eyes closed, not feeling the handle. </li></ol><br>  It is for these reasons that we need to be positioned in the world using coordinates.  At the same time, it is necessary to check the position and make adjustments regularly, every 100 milliseconds. <br><br><pre> move 40.644 20.417 1.537
 move 40.526 20.411 1.537
 move 40.246 20.408 1.592
 move 39.974 20.414 1.592
 move 39.691 20.411 1.537
 move 39.417 20.388 1.510
</pre><br>  This is an excerpt from the list of commands for moving the robot.  The <b>x</b> , <b>y</b> coordinates and the angle of rotation in space are given in radians. <br><br><h5>  Keys and commands </h5><br>  On the way, you have to press the buttons and click with the mouse, open the doors, somewhere you have to wait.  I would not like to write it all manually.  And to search among the teams with coordinates (in the example above), where to enter something, is not very pleasant.  Therefore, we will write one-time clicks on buttons and clicks in parallel with the recording of coordinates. <br><br><pre> pitch -0.89
 mouse right 942 498
 pause 10,000
 move 39.417 20.388 1.510
 key `
 pause 1000
 key {SPACE}
 move 39.142 20.364 1.510
 key {TAB}
 key 3
 key 3
 mouse right 963 622
 move 38.864 20.340 1.510
 move 38.653 20.321 1.510
</pre><br>  Separately mention the "pitch" (tilt).  If a character is looking at the horizon, it is zero.  If the feet, the slope is negative.  And in the sky - is positive.  Measured in radians.  He had to add as soon as the character wanted to fly. <br><br><h5>  Modules </h5><br>  Thus, we see the parts of <s>the</s> bot <s>software and hardware complex</s> : <br><ol><li>  We will write the <b>addon for the WoW interface</b> , which will determine the character's position, azimuth, slope.  The rules of the game add-ons are not prohibited, the specified information is available through the game API inside the add-on.  He will draw it all on the screen.  Sam addon is written in the language of Lua, because the game developers have decided. </li><li>  In the addon you can define something, you can draw, but you can't make the character move.  Even in the addon you can not write to the file, ask the game where the walls are, where the enemies are, and what else is impossible.  Therefore, we need to write <b>an external control application</b> .  I did not become original and used <a href="http://www.autoitscript.com/site/">AutoIt</a> .  This is really quick and convenient, albeit a bit wild for me, who are used to programming in <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D0%25B0%25D1%2582%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D1%2582%25D0%25B8%25D0%25BF%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">strictly typed languages</a> . <br><ul><li>  The application must be able to <b>record</b> my actions.  Let's call this functionality Recorder </li><li>  The application must be able to <b>play the</b> recording.  Let's call the player </li></ul></li><li>  We will store the <b>recorded actions and coordinates</b> in a text file line by line.  They can and should be edited manually.  Add crutches, remove debris.  I will say right away, this is the most difficult. </li></ol><br><br><h4>  Addon for WoW to Lua </h4><br>  <a href="http://www.wowwiki.com/AddOns">Addon for WoW</a> is a <a href="http://ru.wikipedia.org/wiki/Lua">Lua</a> script.  The language is full, flexible, effective.  Do nothing with the system.  You can do everything with the game, but only within the framework of the <a href="http://www.wowpedia.org/World_of_Warcraft_API">API</a> provided by the game.  Since Blizzard does not want, or rather, prohibits players and entrepreneurs from writing bots, the API, in addition to the coordinates mentioned above, provides almost nothing useful and does not provide.  Of course, useful for our needs.  A good guide on writing addons immediately with a description of Lua can be found <a href="http://www.mmo-champion.com/threads/817817-Creating-Your-Own-WoW-Addon">here</a> .  Well, I will describe my version. <br><br><h5>  Manifesto and GUI </h5><br>  <a href="http://www.wowwiki.com/WoW_AddOn">Details</a> and <a href="http://wowpedia.org/Getting_started_with_writing_addons">source</a> .  In the <i>World of Warcraft \ Interface \ AddOns \</i> folder, create the <i>HelloWorld</i> folder.  Put <i>HelloWorld.toc</i> into it. <br><br><pre> ## Interface: 50001
 ## Title: Hello, World!
 ## Notes: My first AddOn
 HelloWorld.lua
</pre><br>  If I wanted to draw molds and buttons (and addons are usually needed for this), I would add <i>HelloWorld.xml</i> with the description of these buttons as the last line.  <a href="http://addonstudio.codeplex.com/">AddOn Studio is a</a> great help in the design and writing of such a GUI addon.  Powerful tool based on MS Visual Studio. <br><br>  But since I'm a minimalist, we won't draw this time.  In addition, it will give me the opportunity to show that you can create forms dynamically from the script itself without using a designer.  Consider the <i>HelloWorld.lua</i> .  I edited it in Notepad ++.  For the game to connect changes to <i>HelloWorld.toc</i> , you need to restart it entirely.  But the changes in <i>HelloWorld.lua</i> can be picked up by writing the <b>/ reload</b> command in the console.  Therefore, the programming and debugging process is not so painful. <br><br><h5>  Slash commands </h5><br>  By the way, about debugging.  I advise you to immediately add <a href="http://wowpedia.org/HOWTO:_Create_a_Slash_Command">a slash command handler</a> : <br><br><pre><code class="lua hljs">SLASH_HELLO_WORLD1 = <span class="hljs-string"><span class="hljs-string">'/helloworld'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SlashCmdList.HELLO_WORLD</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(msg, editbox)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> facing = GetPlayerFacing(); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> pitch = GetUnitPitch(<span class="hljs-string"><span class="hljs-string">"player"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> x, y = GetPlayerMapPosition(<span class="hljs-string"><span class="hljs-string">"player"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">"HelloWorld %.2f %.2f %.2f %.2f"</span></span>, x*<span class="hljs-number"><span class="hljs-number">100</span></span>, y*<span class="hljs-number"><span class="hljs-number">100</span></span>, facing, pitch)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  To do this, we define a variable of the form <b>SLASH_IMEN</b> .  Where <b>NAME is</b> unique for all add-ons, and <b>n is</b> either empty or is an ordinal number with 1. And we add a function with the name <b>NAME</b> into some object.  It may seem strange to a C ++ programmer that we are not explicitly registering this handler function anywhere.  Yes, and with a string variable bind purely by the variable name.  But such is the power and magic of Lua. <br><br>  Now the command in the WoW console <b>/ helloworld</b> will perform the actions you <b>require</b> : it will allow you to display debugging information, and for the simplest add-ons, it will actually produce all that you wrote them for. <br><br>  Well, and then I showed the WoW API, which provides the required information. <br><br><h5>  Event handler </h5><br>  The system for working with GUI in addon is similar to the work of Windows with its messages and their processing. <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> EventFrame = CreateFrame(<span class="hljs-string"><span class="hljs-string">"Frame"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventFrame:OnEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event, ...)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"HelloWorld:"</span></span>, event) self[event](self, ...) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> EventFrame:SetScript(<span class="hljs-string"><span class="hljs-string">"OnEvent"</span></span>, EventFrame.OnEvent) EventFrame:RegisterEvent(<span class="hljs-string"><span class="hljs-string">"PLAYER_LOGIN"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventFrame:PLAYER_LOGIN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">--   end function EventFrame:OnUpdate() --    end EventFrame:SetScript("OnUpdate", EventFrame.OnUpdate)</span></span></code> </pre><br>  We create a frame of type " <b>Frame</b> " and connect to the actions of " <b>OnEvent</b> " and " <b>OnUpdate</b> " commands <br><br><pre> <code class="lua hljs">EventFrame:SetScript(<span class="hljs-string"><span class="hljs-string">"OnEvent"</span></span>, EventFrame.OnEvent) EventFrame:SetScript(<span class="hljs-string"><span class="hljs-string">"OnUpdate"</span></span>, EventFrame.OnUpdate)</code> </pre><br>  The <b>OnUpdate</b> handler will be called after each frame - what we need to update the coordinates.  And <b>OnEvent</b> will be called on other desired events.  From it we will pull the corresponding functions: <br><br><pre> <code class="lua hljs">self[event](self, ...)</code> </pre><br>  What is even more convenient in Lua, is that such a construction can invoke unique view handlers. <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventFrame:PLAYER_LOGIN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span></code> </pre><br>  Here, <b>PLAYER_LOGIN</b> is an event that is sent to all the frames upon entering the world and restarting the user interface.  Other events: <b>PLAYER_LEAVE_COMBAT</b> , <b>QUEST_FINISHED</b> , <b>PLAYER_EQUIPMENT_CHANGED</b> , <b>PLAYER_DEAD</b> , - and a lot more.  The full list can be found <a href="http://wowprogramming.com/docs/events">here</a> .  Register the event that we want to handle with the command <br><br><pre> <code class="lua hljs">EventFrame:RegisterEvent(<span class="hljs-string"><span class="hljs-string">"PLAYER_LOGIN"</span></span>)</code> </pre><br><br><h5>  Information transfer </h5><br>  Since in the addon nothing can be done with the system, we will transmit information from the WoW of another part of the bot by changing the color of the pixels.  As <a href="https://habrahabr.ru/users/rednaxi/" class="user_link">rednaxi</a> did in his <a href="http://habrahabr.ru/post/113258/">post</a> .  But only we will transmit not one bit of information in color, but we will serialize the data and transmit them more. <br><br><h5>  Drawing </h5><br>  Since we also need frames for drawing, we will create them <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> HelloWorld1 = CreateFrame(<span class="hljs-string"><span class="hljs-string">"Frame"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, UIParent) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> HelloWorld2 = CreateFrame(<span class="hljs-string"><span class="hljs-string">"Frame"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, UIParent) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventFrame:PLAYER_LOGIN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> HelloWorld1:SetFrameStrata(<span class="hljs-string"><span class="hljs-string">"BACKGROUND"</span></span>) HelloWorld1:SetWidth(<span class="hljs-number"><span class="hljs-number">10</span></span>) HelloWorld1:SetHeight(<span class="hljs-number"><span class="hljs-number">10</span></span>) HelloWorld1.texture = HelloWorld1:CreateTexture(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"BACKGROUND"</span></span>) HelloWorld1.texture:SetAllPoints(HelloWorld1) HelloWorld1:SetPoint(<span class="hljs-string"><span class="hljs-string">"TOPLEFT"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) HelloWorld1:Show() HelloWorld2:SetFrameStrata(<span class="hljs-string"><span class="hljs-string">"BACKGROUND"</span></span>) HelloWorld2:SetWidth(<span class="hljs-number"><span class="hljs-number">10</span></span>) HelloWorld2:SetHeight(<span class="hljs-number"><span class="hljs-number">10</span></span>) HelloWorld2.texture = HelloWorld2:CreateTexture(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"BACKGROUND"</span></span>) HelloWorld2.texture:SetAllPoints(HelloWorld2) HelloWorld2:SetPoint(<span class="hljs-string"><span class="hljs-string">"TOPLEFT"</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) HelloWorld2:Show() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  I think everything is clear and without comment.  For details on each method, <a href="http://www.wowwiki.com/index.php%3Fsearch%3DCreateTexture%26fulltext%3DSearch%26ab%3D46">look for</a> yourself. <br><br><h5>  Serialization </h5><br>  We have two coordinates and two angles.  All are floating point numbers.  The color components of the pixels in the addon are also floating point numbers, but from <b>0.0</b> to <b>1.0</b> .  In addition, it is known that the color component will remain in one byte.  At first, I saved each coordinate in one color component.  As a result, the positioning accuracy in the location was <b>1/255</b> of the map size.  It turned out like in <b>GPS</b> : it seems there are coordinates, but driving on an automatic machine (controlling a computer without a person) on the way through the navigator will not work.  So I had to give two bytes.  How is it more advantageous to save one fractional number of two bytes?  I did so <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> x1, x2 = <span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">modf</span></span>(x*<span class="hljs-number"><span class="hljs-number">255</span></span>)</code> </pre><br>  The <b>modf</b> function returns the integer and fractional parts of a number, separated by commas.  It uses <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B8%25D1%2581%25D0%25B2%25D0%25B0%25D0%25B8%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">parallel assignment</a> - another useful Lua fiction. <br><br>  With this approach, I use the full power of each of the two bytes in which the coordinate is stored.  Well, the azimuth and tilt are not so exacting for accuracy, so long as they fit into the <b>0.0-1.0</b> segment.  It turns out like this: <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-built_in"><span class="hljs-built_in">math</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">getfenv</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>).<span class="hljs-built_in"><span class="hljs-built_in">math</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventFrame:OnUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> facing = GetPlayerFacing(); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> pitch = GetUnitPitch(<span class="hljs-string"><span class="hljs-string">"player"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> x, y = GetPlayerMapPosition(<span class="hljs-string"><span class="hljs-string">"player"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> x1, x2 = <span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">modf</span></span>(x*<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> y1, y2 = <span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">modf</span></span>(y*<span class="hljs-number"><span class="hljs-number">255</span></span>) HelloWorld1.texture:SetTexture(x1/<span class="hljs-number"><span class="hljs-number">255</span></span>, x2, facing/<span class="hljs-number"><span class="hljs-number">7</span></span>) HelloWorld2.texture:SetTexture(y1/<span class="hljs-number"><span class="hljs-number">255</span></span>, y2, pitch/<span class="hljs-number"><span class="hljs-number">4</span></span>+<span class="hljs-number"><span class="hljs-number">0.5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Now, when moving around the world in the upper left corner, two 10x10 squares will randomly change their color. <br><div class="spoiler">  <b class="spoiler_title">Full text HelloWorld.lua</b> <div class="spoiler_text"><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-built_in"><span class="hljs-built_in">math</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">getfenv</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>).<span class="hljs-built_in"><span class="hljs-built_in">math</span></span> SLASH_HELLO_WORLD1 = <span class="hljs-string"><span class="hljs-string">'/helloworld'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> EventFrame = CreateFrame(<span class="hljs-string"><span class="hljs-string">"Frame"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> HelloWorld1 = CreateFrame(<span class="hljs-string"><span class="hljs-string">"Frame"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, UIParent) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> HelloWorld2 = CreateFrame(<span class="hljs-string"><span class="hljs-string">"Frame"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, UIParent) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventFrame:OnEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event, ...)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"HelloWorld:"</span></span>, event) self[event](self, ...) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> EventFrame:SetScript(<span class="hljs-string"><span class="hljs-string">"OnEvent"</span></span>, EventFrame.OnEvent) EventFrame:RegisterEvent(<span class="hljs-string"><span class="hljs-string">"PLAYER_LOGIN"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventFrame:PLAYER_LOGIN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> HelloWorld1:SetFrameStrata(<span class="hljs-string"><span class="hljs-string">"BACKGROUND"</span></span>) HelloWorld1:SetWidth(<span class="hljs-number"><span class="hljs-number">10</span></span>) HelloWorld1:SetHeight(<span class="hljs-number"><span class="hljs-number">10</span></span>) HelloWorld1.texture = HelloWorld1:CreateTexture(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"BACKGROUND"</span></span>) HelloWorld1.texture:SetAllPoints(HelloWorld1) HelloWorld1:SetPoint(<span class="hljs-string"><span class="hljs-string">"TOPLEFT"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) HelloWorld1:Show() HelloWorld2:SetFrameStrata(<span class="hljs-string"><span class="hljs-string">"BACKGROUND"</span></span>) HelloWorld2:SetWidth(<span class="hljs-number"><span class="hljs-number">10</span></span>) HelloWorld2:SetHeight(<span class="hljs-number"><span class="hljs-number">10</span></span>) HelloWorld2.texture = HelloWorld2:CreateTexture(<span class="hljs-literal"><span class="hljs-literal">nil</span></span>,<span class="hljs-string"><span class="hljs-string">"BACKGROUND"</span></span>) HelloWorld2.texture:SetAllPoints(HelloWorld2) HelloWorld2:SetPoint(<span class="hljs-string"><span class="hljs-string">"TOPLEFT"</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) HelloWorld2:Show() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EventFrame:OnUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> facing = GetPlayerFacing(); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> pitch = GetUnitPitch(<span class="hljs-string"><span class="hljs-string">"player"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> x, y = GetPlayerMapPosition(<span class="hljs-string"><span class="hljs-string">"player"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> x1, x2 = <span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">modf</span></span>(x*<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> y1, y2 = <span class="hljs-built_in"><span class="hljs-built_in">math</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">modf</span></span>(y*<span class="hljs-number"><span class="hljs-number">255</span></span>) HelloWorld1.texture:SetTexture(x1/<span class="hljs-number"><span class="hljs-number">255</span></span>, x2, facing/<span class="hljs-number"><span class="hljs-number">7</span></span>) HelloWorld2.texture:SetTexture(y1/<span class="hljs-number"><span class="hljs-number">255</span></span>, y2, pitch/<span class="hljs-number"><span class="hljs-number">4</span></span>+<span class="hljs-number"><span class="hljs-number">0.5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> EventFrame:SetScript(<span class="hljs-string"><span class="hljs-string">"OnUpdate"</span></span>, EventFrame.OnUpdate) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SlashCmdList.HELLO_WORLD</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(msg, editbox)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> facing = GetPlayerFacing(); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> pitch = GetUnitPitch(<span class="hljs-string"><span class="hljs-string">"player"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> x, y = GetPlayerMapPosition(<span class="hljs-string"><span class="hljs-string">"player"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">format</span></span>(<span class="hljs-string"><span class="hljs-string">"HelloWorld %.2f %.2f %.2f %.2f"</span></span>, x*<span class="hljs-number"><span class="hljs-number">100</span></span>, y*<span class="hljs-number"><span class="hljs-number">100</span></span>, facing, pitch)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br></div></div><br><br><h4>  Conclusion of the first part </h4><br>  Repeat what was said <br><ol><li>  We considered the probability of obtaining the item for a large number of attempts. </li><li>  Designated the task, developed an approach to the solution, divided into modules </li><li>  We reviewed the simplest WoW add-on code in Lua <br><ul><li>  learned to transfer coordinates using color </li><li>  learned to draw, handle events </li><li>  learned to handle slash commands </li></ul><br>  Now you are ready to write your addon. </li></ol><br>  And if you are developing something and want to allow yourself or users to participate, flexibly adjust the software for themselves using your API (for example, write artificial intelligence of opponents, allow brokers to place positions based on quotes, allow administrators to perform their actions on the results user systems inventory, etc.), then know that Lua is very flexible and very easy to build.  Consider this opportunity. <br><br>  Well, in the <a href="http://habrahabr.ru/post/189874/">next part</a> we will talk about <br><ol><li>  writing the keys and coordinates in the AutoIt language </li><li>  Writing Player'a instructions for the bot </li><li>  math 2D how to navigate in the Cartesian coordinate system without the cosine theorem </li><li>  control of the robot with an insufficient number of sensors </li><li>  bots countermeasures </li></ol><br>  <b>Change from August 14</b> <br>  Added a <a href="http://habrahabr.ru/post/189874/">link</a> to the second part. <br></div><p>Source: <a href="https://habr.com/ru/post/189792/">https://habr.com/ru/post/189792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../189778/index.html">Client Tests on Lettuce + Selenium</a></li>
<li><a href="../189782/index.html">JavaScript: how to smoke IE10, or migration problems</a></li>
<li><a href="../189784/index.html">Announcement: Introduction to the YotaPhone SDK for Developers</a></li>
<li><a href="../189786/index.html">"Multithreading" WSH VBScript</a></li>
<li><a href="../189788/index.html">The basis of AI - the structure of the mind</a></li>
<li><a href="../189794/index.html">Creating Metaboxes in WordPress</a></li>
<li><a href="../189798/index.html">Hadoop Tutorial. Writing your grep</a></li>
<li><a href="../189802/index.html">Unreal LED, or load management from Unreal Tournament</a></li>
<li><a href="../189804/index.html">Recognition and conversion of subtitles from VOB to SRT format</a></li>
<li><a href="../189806/index.html">Entity Framework Code First - field indexing and full text search</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>