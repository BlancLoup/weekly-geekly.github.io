<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recover data from XtraDB tables without a structure file, using byte analysis of the ibd file</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 


 It so happened that the server was attacked by a cryptographer who, by "happy coincidence", partially left intact .ibd files (raw data ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recover data from XtraDB tables without a structure file, using byte analysis of the ibd file</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/03c/9b3/e38/03c9b3e38fcb18bd367a89bfe4703e44.png" alt="image"></p><br><h3 id="predystoriya">  Prehistory </h3><br><p>  It so happened that the server was attacked by a cryptographer who, by "happy coincidence", partially left intact .ibd files (raw data files of innodb tables), but completely encrypted the .fpm files (structure files).  At the same time .idb could be divided into: </p><br><ul><li>  subject to recovery through standard tools and guides.  For such cases, there is a great <a href="https://www.voxteneo.com/restoring-tables-mysql-database-frm-ibd-files-available/">article</a> ; </li><li>  partially encrypted tables.  Mostly these are large tables for which (as I understood), the attackers did not have enough RAM for full encryption; </li><li>  well, fully encrypted tables that cannot be recovered. <a name="habracut"></a></li></ul><br><p>  It was possible to determine which of the variants the tables were opened in any text editor under the desired encoding (in my case it is UTF8) and simply looking at the file for the presence of text fields, for example: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/174/210/7be/1742107bed20737a14746a046ae1f560.png" alt="image"></p><br><p>  Also, at the beginning of the file you can observe a large number of 0-bytes, and viruses using the block encryption algorithm (most common) usually affect them. <br><img src="https://habrastorage.org/getpro/habr/post_images/22b/5bc/3e3/22b5bc3e34d8165ce204c646389297ec.png" alt="image"></p><br><p>  In my case, the attackers at the end of each encrypted file left a string of 4 bytes (1, 0, 0, 0), which simplified the task.  A script was enough to search for uninfected files: </p><cut text=""></cut><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">opened</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path)</span></span></span><span class="hljs-function">:</span></span> files = os.listdir(path) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.isfile(path + f): <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> path + f <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> full_path <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> opened(<span class="hljs-string"><span class="hljs-string">"C:\\some\\path"</span></span>): file = open(full_path, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>) last_string = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> file: last_string = line file.close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (last_string[len(last_string) <span class="hljs-number"><span class="hljs-number">-4</span></span>:len(last_string)]) != (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>): print(full_path)</code> </pre> <cut></cut><br><p>  Thus it turned out to find the files belonging to the first type.  The second implies a long manual, but it has already been found enough.  Everything is good, but you need to know the <strong>exact structure</strong> and (of course) there was such a case that you had to work with a frequently changing table.  No one remembered whether the field type was changing or whether a new column was added. </p><br><p>  Debri city unfortunately could not help with such a case, so this article is written. </p><br><h3 id="blizhe-k-delu">  Closer to the point </h3><br><p>  There is a structure of a table 3 months old that does not coincide with the current one (perhaps according to one field, but possible and more).  Table structure: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`table_1`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`date`</span></span> DATETIME , <span class="hljs-string"><span class="hljs-string">`description`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> , <span class="hljs-string"><span class="hljs-string">`id_point`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`id_user`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`date_start`</span></span> DATETIME , <span class="hljs-string"><span class="hljs-string">`date_finish`</span></span> DATETIME , <span class="hljs-string"><span class="hljs-string">`photo`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-string"><span class="hljs-string">`id_client`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`status`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-string"><span class="hljs-string">`lead__time`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span> , <span class="hljs-string"><span class="hljs-string">`sendstatus`</span></span> TINYINT (<span class="hljs-number"><span class="hljs-number">4</span></span>) );</code> </pre> <br><p>  at the same time, you need to extract: </p><br><ul><li>  <code>id_point</code> int (11); </li><li>  <code>id_user</code> int (11); </li><li>  <code>date_start</code> DATETIME; </li><li>  <code>date_finish</code> DATETIME. </li></ul><br><p>  For recovery, a single byte analysis of the .ibd file is used, followed by their conversion to a more readable form.  Since to search for the required, we only need to analyze such data types as int and datatime, only they will be described in the article, but sometimes they will refer to other data types, which can help in other similar incidents. </p><br><p>  <strong>Problem 1</strong> : in the fields with the DATETIME and TEXT types there was a NULL value, and they are simply skipped in the file, because of this, it was not possible to determine the structure for recovery in my case.  In the new columns, the default value was null, and some transactions could be lost due to the setting innodb_flush_log_at_trx_commit = 0, so additional time would have to be spent to determine the structure. </p><br><p>  <strong>Problem 2</strong> : it should be noted that the rows deleted via DELETE will all be exactly in the ibd file, but with ALTER TABLE their structure will not be updated.  As a result, the data structure can vary from the beginning of the file to its end.  If you often use OPTIMIZE TABLE, then with a similar problem is unlikely to come across. </p><br><p>  <strong>Please note</strong> that the DBMS version affects the way data is stored, and this example may not work for other major versions.  In my case, the windows version of mariadb 10.1.24 was used.  Also, although in mariadb you work with InnoDB tables, but in fact they are <a href="https://ru.wikipedia.org/wiki/XtraDB">XtraDB</a> , which excludes the applicability of the method with InnoDB mysql. </p><br><h3 id="analiz-fayla">  File analysis </h3><br><p>  In python, the data type <a href="">bytes ()</a> displays data in unicode instead of the usual set of numbers.  Although the file can be viewed in this form, but for convenience, you can convert bytes into a numeric form by transferring an array of bytes into a regular array (list (example_byte_array)).  In any case, both methods will be useful for analysis. </p><br><p>  After reviewing several ibd files, you can find the following: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d5d/2d6/512/d5d2d6512bd39fcb0d8d9764e23a5d91.png" alt="image"></p><br><p>  Moreover, if you divide the file by these keywords, you get mostly flat data blocks.  We will use infimum as a divider. </p><br><pre> <code class="python hljs">table = table.split(<span class="hljs-string"><span class="hljs-string">"infimum"</span></span>.encode())</code> </pre> <br><p>  An interesting observation, for tables with a small amount of data, between infimum and supremum is a pointer to the number of rows in the block. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c74/8f3/ec1/c748f3ec108e8bec2dec0c71c2ef2911.png" alt="image">  - test table with the 1st row </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d89/f17/970/d89f179703c5e18456efcaaed194d8ee.png" alt="image">  - test table with 2 lines </p><br><p>  An array of table [0] strings can be skipped.  After reviewing it, I could not find the raw data tables.  Most likely, this block is used to store indexes and keys. <br>  Starting from table [1] and translating it into a numeric array, you can already notice some regularities, namely: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/cf0/48f/44d/cf048f44d77573d0261cf58d79c8ee8b.png" alt="image"></p><br><p>  These are the int values ‚Äã‚Äãstored in the string.  The first byte indicates whether the number is positive or negative.  In my case, all the numbers are positive.  Of the remaining 3 bytes, you can determine the number using the following function.  Script: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_int</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(val: str)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># example '128, 1, 2, 3' val = [int(v) for v in val.split(", ")] result_int = val[1]*256**2 + val[2]*256*1 + val[3] return result_int</span></span></code> </pre> <br><p>  For example, <em>128, 0, 0, 1 = 1</em> , or <em>128, 0, 75, 108 = 19308</em> . <br>  The table had a primary key with auto-increment, and here it can also be found </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b3f/43b/70b/b3f43b70b07f22365ecef4b92934335b.png" alt="image"></p><br><p>  Comparing the data from the test tables, it was revealed that the DATETIME object consists of 5 bytes starting at 153 (most likely indicating annual intervals).  Since the DATTIME range is '1000-01-01' to '9999-12-31', I think the number of bytes may differ, but in my case, the data falls in the period from 2016 to 2019, so we assume that 5 bytes is enough . </p><br><p>  To determine the time without seconds, the following functions were written.  Script: </p><br><pre> <code class="python hljs">day_ = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x % <span class="hljs-number"><span class="hljs-number">64</span></span> // <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment"># {x,x,X,x,x } def hour_(x1, x2): # {x,x,X1,X2,x} if x1 % 2 == 0: return x2 // 16 elif x1 % 2 == 1: return x2 // 16 + 16 else: raise ValueError min_ = lambda x1, x2: (x1 % 16) * 4 + (x2 // 64) # {x,x,x,X1,X2}</span></span></code> </pre> <cut></cut><br><p>  For the year and month it was not possible to write a health-working function, so it was necessary to harkodit.  Script: </p><br><pre> <code class="python hljs">ym_list = {<span class="hljs-string"><span class="hljs-string">'2016, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 152, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 152, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 152, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 153, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 153, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 153, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 153, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 154, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 154, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 154, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 154, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 155, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 155, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 155, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 156, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 156, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 156, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 156, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 157, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 157, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 157, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 157, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 158, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 158, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 158, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 159, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 159, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 159, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 159, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 160, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 160, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 160, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 160, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 161, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 161, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 161, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 162, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 162, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 162, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 162, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 163, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 163, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 163, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 163, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 164, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 164, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 164, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 164, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 165, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 165, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 165, 192'</span></span>,<span class="hljs-string"><span class="hljs-string">'2020, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 166, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 166, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 1, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 166, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 167, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 167, 64'</span></span>,<span class="hljs-string"><span class="hljs-string">'2020, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 167, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 167, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 168, 0'</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">year_month</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x1, x2)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># {x,X,X,x,x } for key, value in ym_list.items(): key = [int(k) for k in key.replace("'", "").split(", ")] value = [int(v) for v in value.split(", ")] if x1 == value[1] and x2 // 64 == value[2] // 64: return key return 0, 0</span></span></code> </pre> <br><p>  Sure, if you spend n times, then this misunderstanding can be corrected. <br>  Next, the function returns a datetime object from the string.  Script: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_data_time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(val:str)</span></span></span><span class="hljs-function">:</span></span> val = [int(v) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> val.split(<span class="hljs-string"><span class="hljs-string">", "</span></span>)] day = day_(val[<span class="hljs-number"><span class="hljs-number">2</span></span>]) hour = hour_(val[<span class="hljs-number"><span class="hljs-number">2</span></span>], val[<span class="hljs-number"><span class="hljs-number">3</span></span>]) minutes = min_(val[<span class="hljs-number"><span class="hljs-number">3</span></span>], val[<span class="hljs-number"><span class="hljs-number">4</span></span>]) year, month = year_month(val[<span class="hljs-number"><span class="hljs-number">1</span></span>], val[<span class="hljs-number"><span class="hljs-number">2</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> datetime(year, month, day, hour, minutes)</code> </pre> <cut></cut><br><p>  We managed to find frequently repeated values ‚Äã‚Äãfrom int, int, datetime, datetime <img src="https://habrastorage.org/getpro/habr/post_images/a2a/054/0dd/a2a0540dd230dc92ac1d8e6a5cfcdf51.png" alt="image">  It looks like this is what you need.  Moreover, such a sequence twice per line is not repeated. </p><br><p>  Using a regular expression, we find the necessary data: </p><br><pre> <code class="python hljs">fined = re.findall(<span class="hljs-string"><span class="hljs-string">r'128, \d*, \d*, \d*, 128, \d*, \d*, \d*, 153, 1[6,5,4,3]\d, \d*, \d*, \d*, 153, 1[6,5,4,3]\d, \d*, \d*, \d*'</span></span>, int_array)</code> </pre> <br><p>  Please note that when searching for this expression, it will not be possible to determine NULL values ‚Äã‚Äãin the required fields, but in my case this is not critical.  After in the loop we iterate the found.  Script: </p><br><pre> <code class="python hljs">result = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> val <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fined: pre_result = [] bd_int = re.findall(<span class="hljs-string"><span class="hljs-string">r"128, \d*, \d*, \d*"</span></span>, val) bd_date= re.findall(<span class="hljs-string"><span class="hljs-string">r"(153, 1[6,5,4,3]\d, \d*, \d*, \d*)"</span></span>, val) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> it <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bd_int: pre_result.append(find_int(bd_int[it])) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> bd <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bd_date: pre_result.append(find_data_time(bd)) result.append(pre_result)</code> </pre> <br><p>  Actually everything, the data from the result array, this is the data we need.  ### PS. ### <br>  I understand that this method is not for everyone, but the main goal of the article is rather to push into action than to solve all your problems.  I think the most correct solution would be to start exploring the source code of <a href="">mariadb</a> itself, but due to limited time, the current method seemed to be the fastest. </p><br><p>  In some cases, after analyzing the file, you can determine the approximate structure and restore it in one of the standard ways from the links above.  It will be much more correct and cause less problems. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/453368/">https://habr.com/ru/post/453368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453354/index.html">The classification of land cover using eo-learn. Part 3</a></li>
<li><a href="../453356/index.html">Modern trends and recommendations for the development of large financial institutions</a></li>
<li><a href="../453362/index.html">Habra–°onf ‚Ññ1 - pobbrim behind the backend</a></li>
<li><a href="../453364/index.html">Rollout history that affected everything</a></li>
<li><a href="../453366/index.html">How to use commas in English: 15 rules and examples of errors</a></li>
<li><a href="../45337/index.html">Quicky template review: Performance and Flexibility</a></li>
<li><a href="../453370/index.html">Opposition 2019: Jet Security Team ranked first in defense</a></li>
<li><a href="../453380/index.html">World War with private cars: MaaS strides across the planet</a></li>
<li><a href="../453382/index.html">How to make customizable caching in the project and save colleagues from writing the same type of code</a></li>
<li><a href="../453384/index.html">Security Cheat Sheets: REST</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>