<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we did a huge amount of communication for a rather big security structure</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part of the equipment of the central node of the network, which according to the survival scenario can be completely destroyed, and the network will r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we did a huge amount of communication for a rather big security structure</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/co/wc/a5/cowca5tspcawilp1orz0tqivxsa.jpeg"><br><br>  <i>Part of the equipment of the central node of the network, which according to the survival scenario can be completely destroyed, and the network will retain the main functionality</i> <br><br>  There is one state enterprise whose employees protect more than 2,000 different objects, including strategically important ones.  IT, and indeed communications, is not in the sphere of their main interests, therefore, he has few specialists in networks and telephony. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Within the framework of the project, two tasks were accomplished in parallel: the separation of the departmental network from the channels and the savings in communication.  If you are engaged in IP-telephony, perhaps our experience will be interesting for you. <br><a name="habracut"></a><br><h2>  Situation </h2><br>  As part of a comprehensive project, we built a corporate data network for this customer on Huawei routers.  Plus, the customer wanted to provide all the same objects with a telephone connection, simultaneously reducing the costs of it.  Objects of about 500, for a start, took up 270 of them.  Objects are large - this is the management of regional offices, guiding the work, respectively, at the regional level.  Local departments are subordinate to them, and small sites are already subordinate to branches. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2f/gh/y2/2fghy2opdfa3weem1i9k0sbydlk.png"></div><br>  At each of the sites there was a local area network on the equipment that they could afford.  The existing telephony at the facilities was implemented either on small PBXs connected to external telephone networks using conventional two-wire lines, or these same two-wire lines were routed directly to offices and workplaces.  Some regional divisions had E1 flows.  There was no single standard for equipment and settings for telephony.  There was one unit-exception - there was already built a full-fledged piece of CSFD based on Cisco DMVPN and telephony based on Avaya.  Currently, Avaya PBXs are integrated with Huawei-based telephony and a general numbering plan. <br><br><h2>  Decision making </h2><br>  By telephony, we looked at key market players.  The customer needed only basic telephone functionality - call routing, transfer, call forwarding, etc., scalability and disaster recovery.  This functionality is easy to close all vendors.  The scope of the project was big - all of Russia, so the choice was made for the price.  In terms of price-quality ratio, the Huawei solution turned out to be the best. <br><br><h2>  How to build CSFD </h2><br>  To build a CSFD, we simply selected performance routers for each type of object.  Here's what we got: <br><br>  The parent company.  Huawei AR2240: <br><br><img src="https://habrastorage.org/webt/3n/ny/do/3nnydonu1b_p28r2hxw1w9b49q0.png"><br><br>  Office of regional offices.  Huawei AR2240, Huawei 2220E or Huawei 1220 (depending on the size of the unit). <br><br>  Local branches.  Huawei AR1220: <br><br><img src="https://habrastorage.org/webt/2h/o_/kh/2ho_khemsuy4bykek_86aj0y1b4.png"><br><br>  Huawei 2220E Router: <br><br><img src="https://habrastorage.org/webt/ib/tl/sq/ibtlsqzibohpb5l1-j6rnby8d_i.png"><br><br>  Small sites: Huawei AR151: <br><br><img src="https://habrastorage.org/webt/lc/u8/a9/lcu8a9ngwcunxakelrhtxa3nvs4.png"><br><br>  From the point of view of the network building logic, between objects, repeating their hierarchy, we build GRE / IPSec tunnels, within which we transmit routing information using OSPF.  It turns out such a tree structure.  Routing scheme in the corporate data network: <br><br><img src="https://habrastorage.org/webt/ld/zz/og/ldzzoguaclgr3vpv5fabxgvvvvm.png"><br><br><h2>  Telephony </h2><br>  First, the vendor, following the usual design schemes, offered to carry out all call processing at one central point.  In our case, this is the parent company. <br>  Having estimated the size of the territory over which customer objects are scattered, and the reliability of communication channels, we came to the conclusion that it is better to make the processing distributed.  In the adopted architecture, it occurs independently in the management of each of the regional divisions.  The equipment of local offices is connected to the equipment of divisions in the Local Regeneration Mode.  In this mode, call management between SIP phones and analog lines of the local branch is managed by the regional department, and when the connection with it is broken, it is automatically transferred to the local branch equipment.  Small sites, in turn, receive analog voice gateways ‚Äî devices that register with SIP on the regional unit's control equipment and provide a number of analog ports. <br><br>  Distributed call handling solved another problem: in the corporate network there were satellite transitions and tricky joints of several providers, thanks to which, for example, traffic between the cities of the Far East cut a loop through Moscow.  On the part of the nodes, the network delay reached 1 second.  With such a delay, telephones from distant points could not register at all at the central facility. <br><br>  Equipment mounted in the local branch: <br><br><img src="https://habrastorage.org/webt/_y/63/9m/_y639mc-7lp4zkdjnjfxx6ekp-m.png"><br><br>  As an alternative to the old PBX, regional office divisions received eSpace U1960 devices.  These are chassis with E1, FXO and FXS interface modules and SIP support.  The eSpace U1911, similar devices of smaller size, went to the small platforms. <br><br>  PBX Huawei eSpace U1960: <br><br><img src="https://habrastorage.org/webt/jc/w5/ss/jcw5sscmxausx2keuypoe3jypja.png"><br><br>  eSpace U1911: <br><br><img src="https://habrastorage.org/webt/ve/id/8v/veid8vhmdt6cwveshu30tdlxosw.png"><br><br>  At the parent company installed eSpace U1981, U1960 older brother.  In addition, the regional offices have deployed a server to register softphones.  They are used by employees of the customer who spend a lot of time on business trips. <br><br>  External telephone lines, in most cases analog or ISDN PRI interfaces and subscribers, are connected to the PBX eSpace.  Auto attendant with extension dialing is supported. <br><br>  At small sites, external telephone lines are not connected, small analog line adapters are used.  They are called iad.  IAD 104H analog line adapter: <br><br><img src="https://habrastorage.org/webt/jb/jv/9n/jbjv9n5autxzxkywqyyh-zz9g04.png"><br><br>  In most cases, analog telephone sets were used as subscriber devices.  This made the decision cheaper at the initial stage compared to the mass installation of SIP phones, since telephone lines, unlike Ethernet cables, have already been installed at all workstations.  Now the customer himself is testing SIP devices from other manufacturers, in order to enable regional units to buy their own phones to choose from the list of tested. <br><br>  Heads of regional divisions received SIP-devices with Android inside and video support.  Huawei eSpace 8950 SIP Phone: <br><br><img src="https://habrastorage.org/webt/jv/v2/fy/jvv2fylkiii-bpjoj4-9q8mllhe.png"><br>  Secretaries - devices with expansion panel.  Huawei eSpace 7950 SIP Phone: <br><img src="https://habrastorage.org/webt/wy/sc/zc/wysczcbjaxug38ezgeiz-dvvfks.png"><br>  Some of the other employees are basic eSpace 7910 devices. In the photo, he is already ‚Äúin work‚Äù.  Huawei eSpace 7910 SIP Phone: <br><br><img src="https://habrastorage.org/webt/q5/a7/zj/q5a7zjp5i8z8rh1ys71pfclntr0.png"><br><br><h2>  Result </h2><br>  The whole solution looks like this.  Architecture of PSTN and IP-telephony solutions: <br><br><img src="https://habrastorage.org/webt/w2/jj/jf/w2jjjfupox7zntwheuy8jzw0ie0.png"><br><br>  <b>What did the customer end up with?</b> <br><br>  The corporate data transmission network allowed to integrate local networks of objects into the general infrastructure.  This is the basis for the work of application services, including telephony.  In part of the same telephony: <br><br><ul><li>  Communication is now organized uniformly (you no longer need to think about which PBX where it is and whether it is at all), at the facilities of one level of hierarchy (regional division management / local branch / small platform) the same equipment is installed </li><li>  All use a single numbered plan - employees have four-digit internal numbers, each regional unit has a two-digit prefix </li><li>  In all local branches and offices, the same telephone functionality is available - connecting analog and SIP subscribers, external interfaces FXO and PRI for connecting to the city networks </li><li>  Everywhere there was an auto attendant for the extension of internal numbers.  It is no longer necessary to start an external city line for each employee who receives calls from the city. </li><li>  Finally, the classic of IP-telephony - savings due to the reduction of long-distance calls through public networks - both in the payment of calls and in the payment of urban lines, the number of which can now be reduced. </li></ul><br><h2>  Project Features </h2><br>  Totally 5 thousand subscribers are covered.  The first part of the implementation - 10 months. <br><br>  One of the main difficulties was the installation.  Business trips to all necessary points of our country would cost more than work.  Therefore, we acted differently: we received the equipment at the customer‚Äôs Moscow warehouse, unpacked it, set it up, then packed it back and sent it to places.  On the ground, the customer‚Äôs employees turned on the equipment in the socket and the local network, embroidered analog lines on the patch panels, after which we connected and tuned everything we needed.  Often, some of the settings did not coincide with the survey data - somewhere not the same IP, somewhere not such a mask.  A separate topic is analog telephone lines.  Adventures never end with them.  For situations where parameters like pulse / tone dialing or ‚Äúbusy‚Äù signal did not match, they got used quickly, but there were moments and more interesting.  On one of the objects, the line, when dialed from the telephone, did not accept the number "9".  All other numbers at the same time were typed normally.  It was solved only by laying a new cable. <br><br>  ESpace has quite good means of analogue telephony switching - from the web interface, you can see the graphs of current and voltage in the line and even something like an oscillogram of sound.  It helped us a lot, but the main tools for solving problems, as in the old days, were a telephone receiver and a piercer in the hands of an employee of a customer working on site.  The project in general was more about interacting with people than about working with technology.  Once, for example, after long attempts to defeat voltage fluctuations on external communication lines during lengthy consultations and dialogues, we went out to a person who told us that these lines were near the power plant on the way to the customer‚Äôs site, and everyone was used to them for a long time.  The same person helped his colleagues in the field competently organize the grounding and eventually solved the problem. <br><br>  Well, yes, even for IVR, we gave texting to the employees of the customer, and they called the special number and recorded greetings.  Not Levitan, of course, but someone discovered the talent of the announcer. <br><br>  At one of the sites, we initially incorrectly downloaded localization files, because of which the station told the external subscriber that it would be transferred to the extension number in Chinese.  The customer told us that he heard a ‚Äúspeech that was alien to his ear,‚Äù and suggested rewriting the voice file on his own.  Showed him how to do it.  After 5 minutes, we make a test call and hear: "From the sober in the office, only the communications personnel, so we transfer the call to the IT department." <br><br><h2>  Links </h2><br><ul><li> Pro <a href="https://habrahabr.ru/company/croc/blog/327720/">features of brake lines</a> </li><li>  <a href="https://habrahabr.ru/company/croc/blog/306674/">Alteration of the Aeroexpress network</a> </li><li>  <a href="https://habrahabr.ru/company/croc/blog/320836/">VCS in ECE</a> </li><li>  My mail is ASigachev@croc.ru </li></ul></div><p>Source: <a href="https://habr.com/ru/post/343352/">https://habr.com/ru/post/343352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343342/index.html">Yet another kaspersky crackme</a></li>
<li><a href="../343344/index.html">LLVM source guide</a></li>
<li><a href="../343346/index.html">Distribution video. Ambush: nginx or php?</a></li>
<li><a href="../343348/index.html">3 Unusual Linux Networking Cases</a></li>
<li><a href="../343350/index.html">‚ÄúDo you want to be a system architect? There is only light and purity ... "</a></li>
<li><a href="../343356/index.html">Interpolation polynomial on arbitrary functions</a></li>
<li><a href="../343358/index.html">We collected the user activity in WPF</a></li>
<li><a href="../343362/index.html">Broadcast h264 video without transcoding and delay</a></li>
<li><a href="../343364/index.html">Simplest RESTful service on Kotlin and Spring boot</a></li>
<li><a href="../343366/index.html">UX-design: common misconceptions and myths</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>