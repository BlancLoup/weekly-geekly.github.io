<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I watch TV shows in console / bash scripting</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Do you like to watch movies? I am yes: ‚ÄúThe Big Bang Theory‚Äù, ‚ÄúThe IT Crowd‚Äù, different anime ... All this is very addictive. 
 To view all this stuff...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I watch TV shows in console / bash scripting</h1><div class="post__text post__text-html js-mediator-article">  Do you like to watch movies?  I am yes: ‚ÄúThe Big Bang Theory‚Äù, ‚ÄúThe IT Crowd‚Äù, different anime ... All this is very addictive. <br>  To view all this stuff, I use the console version of the most omnivorous media player mplayer.  (Let's refrain from holivar about the red-eye and GUI vs console) But bad luck, for each new series you have to re-type a long command like this: <br><pre> $ mplayer -ass -subcp cp1251 serial_name_01_more_how_how_to_bush.mkv
</pre><br>  It‚Äôs clear that I‚Äôm not dialing this whole sheet from scratch, but simply erasing backspace to the series number, writing a new number and tabom to the end of the file name.  But this is a long and inconvenient, you can miss and erase too much. <br>  And often there are several serials in parallel, as new series are released.  And remembering which series I stopped last time, and with what parameters and keys I started mplayer, it becomes difficult.  And so I decided to write myself on the shell a simple launch of the player, which will remember the parameters, the number of the last episode viewed and be able to substitute the number of the next one in the launch team. <br><a name="habracut"></a><br><h4>  Interface </h4><br>  To begin with, we will decide what interface this wrapper should have. <br>  Serial numbers are almost always two-digit, so I did not bother with the support of single-digit or three-digit numbers. <br>  This is how the initial setup will look like, which needs to be performed only once: <br><pre> $ cd ~ / serial_name # where and what we want to watch
 $ ls # look at what the video files are called
 serial_name_01_bla_bla.avi
 serial_name_01_bla_bla.srt
 serial_name_02_bla_bla.avi
 serial_name_02_bla_bla.srt
 ...
 $ serial set mask "serial_name _ ?? _ bla_bla.avi" # specify the parameter name - the name of the video files with the replaced series number to "??"
 # serial set options -subcp cp1251 # optionally specifying the options parameter - the keys with which to run mplayer
</pre><br>  And now we look: <br><pre>  $ serial next # Let's start from the beginning
 Playing episode 01 ...
 ...
 $ serial next # Liked it, let's go next
 Playing episode 02 ...
 ...
 $ serial same # I saw a funny moment, I want to revise the same episode again
 Playing episode 02 ...
 ...
 $ serial episode 14 # Jump to specific episode
 Playing episode 14 ...
 ...
 $ while true;  do;  serial n;  sleep 1;  done;  # non-stop
</pre><br>  And if our episode names differ not only in the series number?  Then use shell substitution: <br><pre>  $ ls # look at what the video files are called
 serial_name_01_qwerty.mkv
 serial_name_02_asdfgh.mkv
 $ serial set mask "serial_name _ ?? _ *. avi" # specify the name parameter with a replacement for the asterisk
 $ serial set glob yes # perform substitution
</pre><br><br><h4>  We write </h4><br>  Set default values, it's simple: <br><pre> player = mplayer
 options = ""
 episode = 00
</pre><br>  Where we will store the data on the state of view?  First of all, the thought comes to write it directly into the folder in which it lies, but this option will not work if you watch the show from a CD, which, as you know, is read-only.  Network folders (nfs / samba) or simply incorrectly configured permissions on a torrent can also be write-protected. <br>  Therefore, we will store in the home folder, but we will identify the series as well along the path in the file system where the episodes lie.  For convenience, it is better to take a hash from it, in order not to deal with the screening of any special characters that can meet there. <br><pre> pwdhash = `pwd | md5sum | awk '{print $ 1}'`
</pre><br>  Create a directory in which we will store all our serials states, if it does not already exist: <br><pre> test!  -d ~ / .serial &amp;&amp; mkdir ~ / .serial
</pre><br>  Define the name of the file to which we will write: <br><pre> savefile = ~ / .serial / $ pwdhash
</pre><br>  Somewhere here I was visited by a crazy thought that you can use a full-fledged relational database like sqlite or even harder, mysql, but I drove away this thought in time, otherwise a big monster would come out instead of a simple wrapper over the player. <br>  Now about serialization: how exactly to store data?  I didn't smile at all at parsing the newly-created bash formats, which is meant for completely different purposes, so I just decided that there would be environment variables in the same sh-format. <br>  Let's load the file if it is already there: <br><pre> if [-f $ savefile]
 then
     ready = "true"
     .  $ savefile
 fi
</pre><br>  So, what actions can we do with the show?  I stopped at these: <br><pre> case $ 1 in
     # Launches the next episode
     n | next)
         # ...
     ;;
     # Runs just watched episode again.
     s | same)
         # ...
     ;;
     # Runs an episode by its number. 
     e | ep | episode)
         # ...
     ;;
     # Sets the parameters with which to watch the series
     set)
         # ...
     ;;
     # View current status
     status | show)
         # ...
     ;;
     # And a brief help if I suddenly forget something.
     *)
         echo Unknown command.
         echo Commands:
         echo next - plays episode next
         echo same - plays this episode again
         echo show - shows current state
         echo episode NN - plays episode NN
         echo set var_name value - sets the variable
     ;;
 esac
</pre><br>  We proceed to the implementation of individual actions. <br>  The first step is to check whether we set up watching this show or not.  Since this action is performed in almost every command, I brought it to a function that looks at the presence of a variable set when loading parameters, and if there is no, it displays an instruction how this thing is configured. <br><pre> function check_ready {
     if [-z "$ ready"]
     then
         echo
         echo Use the following command to setup:
         echo "$ 0 set mask \" Movie_name_episode _ ?? _ smth.avi \ ""
         exit 1
     fi
 }
</pre><br>  Now, in fact, the launch is also a separate function: <br><pre> function launch {
     # ...
 }
</pre><br>  First, let's replace the questions in the title with the current episode number: <br><pre> movie = "echo \" $ mask \ "| sed \" s / ?? / $ episode / g \ "` "
</pre><br>  I had some problems with the substitution: it turns out that it‚Äôs not so easy in the bash ... Having tried many options for different degrees of perversion, I stopped at this, although I honestly did not understand how it works, but the side effect is that need to escape spaces when defining a mask: <br><pre> if ["$ glob" == "yes"]
 then
     movie = "$ (eval" echo $ movie ")"
 fi
</pre><br>  In the comments can offer better options. <br><br>  Check that the file with the resulting name exists, and if not, you need to dump the message and exit. <br><pre> test!  -f "$ movie" &amp;&amp; die Episode $ episode not found
</pre><br>  Oh yeah, here's another auxiliary function: displays the message and exits <br><pre> function die {
     echo $ @
     exit 1
 }
</pre><br>  Let's go back to the launch launch function.  Save the number of the last played episode (and at the same time the launch date) in the settings file: <br><pre> echo episode = $ episode "#" at `date` &gt;&gt; $ savefile
</pre><br>  Let's display a message about the current episode: <br><pre> echo Playing episode $ episode ...
</pre><br>  Finally, let's launch our player with the parameters, file and additional arguments that the user can pass after specifying the episode <br><pre> $ player $ options "$ movie" "$ @"
</pre><br>  Great, the launch function is ready!  It remains quite a bit: fill in the case structure.  The simplest command is the same: <br><pre> s | same)
     check_ready
     shift
     launch "$ @"
 ;;
</pre><br>  To view the next episode, you need to increment the variable, but at the same time save the beat zeroes first.  For this came awk: <br><pre> n | next)
     check_ready
     episode = `echo $ episode | awk '{printf"% 02d ", $ 1 + 1}'`
     shift
     launch "$ @"
 ;;
</pre><br>  This is how you can run with a specific episode by number: <br><pre> e | ep | episode)
     check_ready
     test -z "$ 2" &amp;&amp; die No episode specified
     episode = $ 2
     shift
     shift
     launch "$ @"
 ;;
</pre><br>  And now something completely different - setting variables: <br><pre> set)
     # Verify that the variable name was passed to us
     test -z "$ 2" &amp;&amp; die Variables: episode mask glob options player
     var_name = "$ 2"
     # Check that there is at least something in meaning
     test -z "$ 3" &amp;&amp; die No value specified
     shift
     shift
     # And write down all that is:
     echo "$ var_name = \" $ @ \ "" "#" at `date` &gt;&gt; $ savefile
 ;;
</pre><br>  Finally, display the current state: <br><pre> status | show)
     check_ready
     echo Last played episode $ episode
     echo Options are $ options
     echo Savefile is $ savefile
     echo Mask is \ "$ mask \"
     test -z "$ glob" ||  echo globbing is set
 ;;
</pre><br>  Here you can see the script in a ready-made, but very poorly documented version, which I actively use for a long time <a href="http://bitbucket.org/tsx/env/src/tip/bin/serial">bitbucket.org/tsx/env/src/tip/bin/serial</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/107277/">https://habr.com/ru/post/107277/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../107267/index.html">Multihome IPv4 on Linux</a></li>
<li><a href="../107268/index.html">3D Console Renderer</a></li>
<li><a href="../107269/index.html">October 31 - open webinar. The problem of graph isomorphism and functional programming</a></li>
<li><a href="../107270/index.html">Three years ago‚Ä¶</a></li>
<li><a href="../107272/index.html">Using macros in MASM using the example of creating a window</a></li>
<li><a href="../107278/index.html">Awesome way of charging. Which is working</a></li>
<li><a href="../107280/index.html">Urgent charging of players and phones</a></li>
<li><a href="../107281/index.html">Screen brightness adjustment in Meego 1.1 on Samsung 210</a></li>
<li><a href="../107283/index.html">Unifying and destructive internet</a></li>
<li><a href="../107285/index.html">NASA will send people to Mars without hope of return</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>