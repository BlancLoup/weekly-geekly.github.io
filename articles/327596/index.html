<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tale of creating a classic RTS at home from scratch (Part 2: "Resurrection")</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About a year ago my article came out, which can be called the " first part " of this article. In the first part, as far as I could, I sorted out in de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tale of creating a classic RTS at home from scratch (Part 2: "Resurrection")</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/5c0/bb8/9d7/5c0bb89d72904e72aebc5e656c30839c.jpg"></div><br>  About a year ago my article came out, which can be called the " <a href="https://habrahabr.ru/post/280520/">first part</a> " of this article.  In the first part, as far as I could, I sorted out in detail the thorny path of an enthusiastic developer who I was once able to independently walk from beginning to end.  The result of these efforts was the game of the <b>RTS</b> genre "The <i>Land of Onimods</i> " that I created at home without engines, designers and other modern development tools.  For the project, <b>C ++</b> and <b>Assembler were used</b> , well, and my own head was the main tool. <br>  In this article I will try to talk about how I decided to take on the role of "resuscitator" and try to "resurrect" this project.  A lot of attention will be paid to writing your own game server. <br><a name="habracut"></a><br><br>  <a href="https://habrahabr.ru/post/328116/">Continued article: GUI</a> <br>  <a href="https://habrahabr.ru/post/328118/">End of article: Network</a> <br><br>  I attach a short video to the article so that it is immediately clear what is at stake: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/lsxF7PBpSvE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h2>  Introduction </h2><br>  This whole story goes back to 1998, when the IT world was very different.  The game, of course, was originally designed for the conditions existing at that moment.  In particular, I would hardly begin using assembler for plotting graphics, but at that moment it seemed to me almost the only solution.  If someone is interested in how it all works (game mechanics, AI, etc.) and how was the Russian "publisher" of games at the end of the last century, refer you to the <a href="https://habrahabr.ru/post/280520/">first part of the article</a> . <br><br>  There is also a separate description of the pathfinding algorithm that I once developed for my RTS.  This article has been for more than 10 years and was written, rather, ‚Äúfor itself,‚Äù but it was written in sufficient detail so that I myself can remember how it all works.  The used solution, in my opinion, is highly effective in terms of speed of work and is guaranteed to build a path to the target on a cellular field with any degree of complexity of the location of the obstacles.  You can get acquainted with this method <a href="http://astralax.ru/articles/pathway">here</a> . <br><br>  Why did I decide to continue this whole ‚Äúepic‚Äù?  It has always hurt me to realize that the work of such magnitude was just buried by me for economic reasons at one time.  And when it seemed to me that there was at least some chance to give this game a second attempt, then I naturally tried to do it.  The last year of my life, I almost completely devoted this issue.  Thanks mainly to the support of the readers of the <a href="https://habrahabr.ru/post/280520/">first part of the article</a> , the game passed <b>Greenlight</b> , and I decided to put everything in order with my characteristic purpose.  And this article will be devoted to my work.  In the beginning, I thought to describe in detail the whole process, starting with creating my own <b>GUI</b> (graphical user interface) and ending with writing a game server.  But, unfortunately, I found out that this information is received too much.  As a result, I paid more attention to the description of the network, since it seemed to me that this topic was more interesting for many.  I tried to give explanations in such a way that it could somehow be put into practice.  However, I do not have confidence that as a result, the article did not work out slightly "hard" to understand. <br><br><h2>  A ‚Äúshell‚Äù for a game or something that can be downloaded and viewed in C ++ source code </h2><br>  Oddly enough, this section, which is at the very beginning of the article, I wrote in the last place.  In the course of writing this article, I realized that I need to show at least something ‚Äúfrom the inside,‚Äù otherwise all my explanations do not have much practical sense and in fact turn into a verbiage.  And I really would not want this. <br><br>  Therefore, in addition, I provided an article with an example by which anyone can get acquainted with some aspects of my approach to writing large projects: <br><br><img src="https://habrastorage.org/files/720/d03/168/720d03168a8a49de92462c1a409ea0a2.jpg"><br><br>  Visually, this example is not very similar to my game, but in fact the game uses this particular code, only it uses a different ‚Äúdecorating theme‚Äù.  Setting up a game session in the game looks like this: <br><br><img src="https://habrastorage.org/files/5b3/9ea/9ff/5b39ea9ffe67403c8d0c1ff7193535c4.jpg"><br><br>  Also, just in case, I clarify that these are not ‚ÄúWindows buttons,‚Äù as someone might think, but my own components, which I did in the volume that my game required. <br><br>  An example is not just a ‚Äúformal‚Äù example, but contains a shell that I created to use as part of a game.  This product has no names, but it was created by me, taking into account that the game may need to be ported to another platform.  Currently, in a fully operational state, there is only a <i>Windows</i> version, but all calls to the operating system are made through virtual functions that can be replaced.  In practice, it took me when it came time to lay out the game server on the Internet.  For free testing, only the version of the server managed by <i>Unix</i> -like OS was available to me.  As a result, I had to add a <i>Unix</i> branch to the shell.  I didn‚Äôt change the server myself at all, only replaced the functions that the server needed to interact with the OS.  I do not particularly understand <b>the</b> <i>Unix</i> <b>API</b> , but I have a good acquaintance programmer (on this resource is code-named <a href="https://habrahabr.ru/users/komei/" class="user_link">Komei</a> ), who is well aware of this topic.  With it, the server has been ported for several days.  In addition, my friend kindly provided me with his <i>Unix</i> -server for launching and testing my online gaming server, and this, at least, was a decent financial assistance to my project, since keeping your own dedicated server is not such a cheap pleasure. <br><br>  I needed an example in the article due to the fact that the entire second part of the article is devoted to a network game device.  And there I have to periodically go into the explanations for the code.  And by themselves, individual pieces of code seem to me quite meaningless.  I considered publishing the source code of the game ‚Äúbrute-force‚Äù, yet this is a commercial product for me, and besides, a relatively small example seems to me much more understandable.  So I decided to make the shell source code public, providing it with an example for clarity.  The example shows how to work with my <b>GUI</b> , loses sound and demonstrates network interaction.  Those.  the user can click the "Enable Network" button, then the "New" button and a game session will be created, which you can join from the example running on another computer.  The configuration of the player in the session is reduced to the ability to change its color, but to demonstrate the principle of this is quite enough. <br><br>  I did not begin to describe in detail the organization of the <b>GUI</b> , since I am not sure that this is very interesting for someone, and the article turned out to be quite large.  In any case, the example demonstrates how to work with all the components in my <b>GUI</b> . <br><br>  I do not mind if someone takes advantage of my work for their own selfish or selfless purposes.  But I do not promise that I will develop this project or that I will maintain compatibility with the current version.  I also clarify that the <b>GUI was</b> designed not for speed, but for versatility, as was required in my case.  In addition, I have implemented a branch that works only with 16-bit color, which is necessary for my game, but no one bothers to add a branch of code that will work with 32-bit colors, as well as use hardware acceleration of the <b>GPU</b> , where possible .  Download this project <a href="http://astralax.ru/projects/others/ol_wrap">here</a> . <br><br>  The sample project was made in <b>Visual Studio 2008</b> and uses the <b>C ++</b> and <b>DirectX9</b> language. <br><br><h2>  The problems that I had to solve </h2><br>  First, here is a list of problems that existed in the game a year ago: <br><br><ul><li>  The game fully worked only under <i>Windows XP</i> .  Under <i>Windows 7, the</i> game started normally, but the local network did not function at all.  And <i>Windows 8/10</i> simply refused to launch the game. </li><li>  The game was tightly nailed to the <i>Windows</i> platform.  Actively used <b>DirectX</b> , as well as <b>MFC</b> . </li><li>  The design of the menu was very "dumb" even in my opinion.  This was due to the fact that I am engaged in programming and I have a very distant attitude to drawing, and I completed the game alone. </li><li>  Visually, with the ‚Äúresearch icons‚Äù, the situation was even worse than with the menu. </li><li>  Voice voice left, to put it mildly, much to be desired. </li><li>  There was no Internet server that I always wanted to have, since I believe that the most interesting thing about <b>RTS</b> is the game over the network. </li></ul><br>  Gradually, step by step, I solved these problems and now I feel that finally the result suits me perfectly.  However, it was not always so ... <br><br><h2>  Where to begin </h2><br>  The game project was once done in <b>Visual Studio C ++ 6.0</b> .  Now this <b>Visual Studio C ++ 6.0</b> did not even want to work in <i>Windows 8</i> .  Therefore, first of all, I had to transfer the project to a new environment for it.  On the one hand, everything should be simple, since <b>Visual Studio is</b> able to convert projects from previous versions into its own format, but this was not the case.  The fact is that I used the assembler <b>tasm32</b> , which created me an <b>obj</b> file.  This file was linked to <b>Visual Studio C ++ 6.0</b> without any problems, but I didn‚Äôt want to link to <b>Visual Studio 2008 at all</b> .  A new version of <b>tasm32 was</b> not in the world, and other <b>masm</b> type assemblers somehow flamed to the syntax of <b>tasm32</b> with fierce hatred and gave a lot of errors when trying to slip my <b>asm</b> file into them. <br><br>  Upon reflection, I decided that I was not ready at this stage to rewrite the assembler code under a different syntax, because at first I was not at all sure that I was moving in the right direction.  As a result, I made the following decision: I installed <i>Windows XP</i> , put <b>Visual Studio C ++ 6.0 in it</b> , created a project of type <b>DLL</b> , wrote exported functions that simply called assembler functions through myself and linked my assembly <b>obj</b> file to it, which is fine in <i>Windows XP</i> Created through <i>tasm32.exe</i> .  As a result, I got the <b>asm.dll</b> library, which I was able to easily connect to a new project in <b>Visual Studio 2008</b> .  This decision worked, almost immediately, and while I decided to stop at it.  Naturally, I understand that this solution is absolutely not portable to other platforms, but if the question of porting really comes up, you can ‚Äúgather the will into a fist‚Äù and translate the assembler into another syntax.  In the meantime, the fate of this game is foggy for me, although I definitely reanimated it for the last year.  In any case, I spent on this project already enough strength to finally get a clear answer from the universe on this matter. <br><br>  After I was able to start the game in <i>Windows 8</i> using <b>Visual Studio 2008</b> , I finally had a debugger in my hands.  To begin with, I needed to understand the reasons why the new versions of <i>Windows</i> did not want to run the game.  I haven‚Äôt been involved in games for a long time and didn‚Äôt particularly follow the evolution of restrictions that <i>Windows</i> began to impose on the work of old programs.  For me personally, this reason was very unexpected.  I found that the 16-bit color mode that was used by my game was removed from <i>Windows 8/10</i> .  After several ‚Äúmagic rituals,‚Äù I still managed to start the game and even play a little, but everything worked dangerously slowly, and instead of the landscape, the main part of the screen was clean and beautiful black.  For myself, I noted that the 16-bit mode is now emulated and has restrictions on use. <br><br><h2>  Battle for 16-bit video mode </h2><br>  How to deal with this problem?  At least there are 2 exits: <br><br><ol><li>  Transform all the graphics in the game so that it can work in 24-bit resolution.  In my case, this option is bad because all the graphics were stored in a compressed form and drawn by an assembler.  All functions of the assembler were able to work only with 16-bit graphics, the functions themselves were many and they worked quickly enough, assumed many nuances when drawing and, most importantly, over the years I have forgotten how it all functions in detail. </li><li>  Create your own surface in RAM, which will be a screen memory for the game.  Draw everything on this surface, and then copy it to a real screen.  I chose this option as the only correct one.  With this solution, the fattest plus also appeared - I now almost don't need <b>DirectX</b> to work with graphics, since the only thing he had to do now was copy my surface onto the screen.  But there is in this decision and not immediately an obvious disadvantage - <b>DirectX</b> allowed me to easily display the text, and I, naturally, did just that.  And now it turned out: ‚Äúno <b>DirectX</b> - no text‚Äù. </li></ol><br>  As a result, I decided to do the following - to write something like a ‚Äúshell‚Äù through which the game would communicate with the operating system.  Any calls to OS resources should be performed through virtual functions, so that if something happens, they can be replaced.  Practically, this makes it possible to port a game to another OS relatively quickly, but as always, not everything is so simple ... almost any program that at least communicates with the user needs an interface.  The interface consists of different small (but cute) elements like " <i>Text field</i> ", " <i>List</i> ", " <i>Tree</i> ", " <i>Dialog window</i> " and so on.  In other words, if you go this way, then you need to make your own <b>GUI</b> , which will work the same way in any OS.  In addition, you need to somehow solve the problem with playing sounds and networking. <br><br>  For sounds, I decided to use the <b>Squall</b> library.  There were several advantages to its use ... firstly, this library was already used in the old version of the game, secondly, compared to other similar free solutions, it played almost all the <b>wav</b> files that I shoved to it, thirdly, I was personally familiar with the author of <a href="https://habrahabr.ru/users/cesium/" class="user_link">cesium</a> , which is also important.  The main disadvantage of <b>Squall</b> is that it has not been developed for a long time and exists only under <i>Windows</i> .  Recently, however, I began to try to make such a structure with my programs so that it would be relatively easy to replace the external library with some analogue.  As a result, I did all the interaction with <b>Squall</b> through a small layer of my own class.  A little later, as an experiment, I replaced <b>Squall</b> with <b>BASS</b> , but not really feeling the benefit of this replacement, I returned <b>Squall</b> back.  But now I knew that if I needed another platform, I could use <b>BASS</b> , which is everywhere. <br><br>  Since I almost had to get rid of <b>DirectX</b> as part of the game, for starters, I just commented out all the <b>DirectX</b> <b>h-</b> files.  I clicked on <i>Build</i> and got ready to estimate the amount of the proposed work on replacing <b>DirectX</b> functions with my own.  When the long ‚Äúlist of problems‚Äù finally stopped, the number of errors found a total of just over 9,000 was very eloquently displayed below.  Least of all, the errors concerned <b>DirectInput</b> , since the input from the mouse and keyboard is a relatively small part of the code, but <b>DirectDraw</b> and <b>DirectPlay were</b> noted, as they say, ‚Äúto the fullest‚Äù. <br><br>  There was another powerful problem.  The fact is that the game is attached to the editor maps and campaigns.  And it was completely written using <b>MFC</b> , and since this is practically a windowing <i>Windows</i> application, I immediately decided not to even think that the editor could work on another platform in the future.  But the fact is that both the game and the editor were, in my case, the same project (in the literal sense, it was the same <b>exe</b> file that was run with different parameters).  Accordingly, I had to divide this project into 2 parts: the game had to work almost completely independently of <i>Windows</i> , and the editor, on the contrary, remained an <b>MFC</b> project.  As a result, when I ripped the game out of the <b>MFC</b> framework, I often ran into a situation where the functions common to these projects should now perform their task in different ways.  We had to insert a conditional compilation into the code and generate the second branch of the code. <br><br>  First of all, I began to create my own shell, which would help me get rid of <b>DirectX-</b> dependency.  It was necessary for me that the shell be able to work with 16-bit resolution, be composed of standard components for the formation of the interface, and also allow the display of text. <br><br><h2>  Shell structure </h2><br>  I made the <b>GGame</b> class <b>as the</b> base class for the whole shell, which will already contain all the other important objects.  The <b>GPlatform</b> class <b>is</b> responsible for my communication with the OS, excluding graphic operations.  But everything related to working with the file system, processing the message loop, <b>shutting down the</b> application, starting threads and processes belongs to <b>GPlatform</b> .  The <b>GSound</b> class <b>is</b> responsible for sound, and the <b>GNet</b> class is either a <b>GNetServer</b> server or a <b>GNetClient</b> client, depending on the task.  The most difficult was the class <b>GDevice</b> , which manages the graphics. <br><br>  The <b>GDevice</b> class works with <b>GSurface</b> surfaces.  These surfaces are defined by me very abstractly, i.e.  there are no hints of the number of bits per pixel, but there are a number of abstract functions that should replace the standard <b>GDI</b> .  However, in reality, objects like <b>GSurface</b> are never created in the game; instead, child objects of type <b>GSurface16</b> are used that are just able to perform <b>GDI</b> work as applied to 16-bit surfaces.  I reasoned that if I need to give my shell the opportunity to work with 24-bit graphics, I can always create a similar class <b>GSurface24</b> and this does not require any global changes to the overall structure of the shell. <br><br>  The <b>GDevice</b> class <b>is</b> also responsible for working with screen resolutions, it has abstract functions that determine the available screen resolutions, and allows you to select a new resolution.  <b>GDevice</b> can also scale the size of the scene to the size of the monitor.  For example, the game uses any resolution simply by increasing the visible area of ‚Äã‚Äãthe playing field, but the menu always works only in <b>1920 x 1080</b> resolution.  However, if the actual resolution of the monitor is smaller, then <b>GDevice</b> scaled the menu to the current resolution of the monitor.  It is possible that a better solution would be to make several types of menus for different monitor resolutions, but I am still not a corporation, and such decisions in my case would simply be irrational.  In any case, on a laptop with a resolution of <b>1366 x 768, the</b> menu looks quite acceptable. <br><br>  All these base classes are <b>GPlatform</b> , <b>GDevice</b> , <b>GNet</b> , etc.  contain many abstract functions.  In a real program, instead of the <b>GPlatform</b> class, the child class is <b>GPlatformWindows</b> , instead of the <b>GDevice</b> class, the <b>GDeviceOnimodLandDX9</b> class, instead of the <b>GNet</b> class, either the <b>GNetServerLibUV</b> class or the <b>GNetClientLibUV</b> class, i.e.  I use class objects that are already adapted to the desired platform and my game.  The ‚Äúshell‚Äù itself has neither the game, nor the OS, not the slightest idea. <br><br>  And the most basic class actually transforms from <b>GGame</b> to <b>GGameOnimodLandDX9</b> .  How does all this bind together?  The answer is to never create important objects in the program directly through the <b>new</b> operator.  Instead, there are virtual functions that create the object of the desired type.  For example, abstract functions of the <b>GGame</b> class: <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   virtual GPlatform* GGame::NewPlatform(GGame* owner, const char* game_name)=0; //   virtual GSound* GGame::NewSound()=0;</span></span></code> </pre> <br>  look for the <b>GGameOnimodLand</b> class <b>like</b> this: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   GPlatform* GGameOnimodLand::NewPlatform(GGame* owner, const char* game_name) { return new GPlatformWindows(owner, game_name); } //   GSound* GGameOnimodLand::NewSound() { #ifdef SQUALL_SOUND return new GSoundSquall(); #endif #ifdef BASS_SOUND return new GSoundBass(); #endif }</span></span></code> </pre><br>  And now how all this is created through the base class: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,     bool GGame::CreateGame(void* init, int view_width, int view_height) { platform=NewPlatform(this, game_name.c_str()); platform-&gt;Create(); device=NewDevice(init); device-&gt;Create(view_width, view_height); sound=NewSound(); .... .... .... }</span></span></code> </pre><br>  Thus, it turns out that the base class creates the objects it needs, without delving into the subtleties of the specifics of the OS or the graphics <b>API</b> .  This approach allows us to separate the main program code from the features of the runtime environment.  It also makes it relatively easy to port to another platform, and to replace <b>DirectX</b> with <b>OpenGL</b> , since all the specifics of the execution environment are rendered into small and completely separate classes and their functions. <br><br>  <a href="https://habrahabr.ru/post/328116/">Continued article: GUI</a> <br>  <a href="https://habrahabr.ru/post/328118/">End of article: Network</a> </div><p>Source: <a href="https://habr.com/ru/post/327596/">https://habr.com/ru/post/327596/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327586/index.html">Cheeky telegram bot</a></li>
<li><a href="../327588/index.html">We are testing a new line of SSD VPS + a little insider from the life of a hoster</a></li>
<li><a href="../327590/index.html">Gixy - open source from Yandex, which will make configuring Nginx safe</a></li>
<li><a href="../327592/index.html">Results of the third round of the Russian Code Cup 2017</a></li>
<li><a href="../327594/index.html">How to use the HTTP API to send emails</a></li>
<li><a href="../327598/index.html">Security Week 17: DoublePulsar broke free, a hundred thousand Linksys found holes, SMSVova expelled from Google Play</a></li>
<li><a href="../327600/index.html">Outstanding portfolio creation guide</a></li>
<li><a href="../327604/index.html">learnopengl. Lesson 1.9 - Camera</a></li>
<li><a href="../327606/index.html">SQL101: Change Recovery Model</a></li>
<li><a href="../327608/index.html">Video recording of the webinar "Julia - A Fresh Approach to Numerical Computing and Data Science"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>