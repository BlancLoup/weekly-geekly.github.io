<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interaction with the modem in the Android OS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article, I talked about how the radio interface layer is organized in the Android OS. Today I will talk about how you can interact dir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interaction with the modem in the Android OS</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="http://habrahabr.ru/post/183984/">previous</a> article, I talked about how the radio interface layer is organized in the Android OS.  Today I will talk about how you can interact directly with the modem. <br>  It often happens that a tablet with a 3G modem does not provide an opportunity to make a call, send an SMS message and even find out the account balance.  In this article we will deal with this, as well as see how to use all the functionality provided by the modem. <br>  As you already know, the manufacturer‚Äôs RIL translates Android OS requests into a clear modem view.  As a rule, many standardized Hayes AT commands are used to interact with the modem, however, some modem manufacturers supplement the standard set of AT commands with their own extensions.  Today we will work at the level between the RIL manufacturer and the modem. <br><img src="https://habrastorage.org/getpro/habr/post_images/f44/a42/aea/f44a42aeab85cea865a8ba4be579bb50.png"><br><a name="habracut"></a><br>  I note that for experiments your device should be rooted, and you should have minimal programming experience on the NDK. <br><br><h4>  Let's get started </h4><br>  First we need to install the name of the modem device file in the system.  Typically, this is / dev / ttyACM0 or / dev / smd0 (/ dev / ttyUSB0 is also encountered).  To find out, you need to execute the command to view the radio log in the terminal: <b>logcat -b radio</b> .  The very first line of the radio log should look like: " <b>Opening tty device / dev / ttyACM0</b> ".  If there is no such line, then we are less fortunate; we will have to go through all the devices located in the / dev / directory.  To do this, a test command " <b>AT</b> " must be sent to each file from this directory and, if it is a file of a modem device, see the response in the radio log " <b>OK</b> ".  Commands can be sent for example using the terminal: <b>echo "AT"&gt; / dev / file_name</b> . <br><br>  Now, let's establish what commands are sent to the modem.  To do this, carry out the "attack" of the MITM type. <br><img src="https://habrastorage.org/getpro/habr/post_images/3b1/0cc/07f/3b10cc07f16d690ef4563e093ed79fbc.jpg"><br>  For this: <br><ul><li>  Rename the real modem file to <b>/ dev / ttyACM0_real</b> . </li><li>  Create the file <b>/ dev / ttyACM0</b> as a symbolic link to the pseudo-terminal <b>/ dev / ptmx</b> . </li><li>  We will write to the log everything that goes through <b>/ dev / ttyACM0</b> and redirect it to <b>/ dev / ttyACM0_real</b> </li><li>  Restart the rild daemon: " <b>kill pid_rild</b> ", it will start automatically. </li></ul><br>  Program code is available <a href="">here</a> . <br><img src="https://habrastorage.org/getpro/habr/post_images/096/98d/8f7/09698d8f7f4e354e01751f2fa0bfc96a.png"><br>  After examining our log, you can see which AT commands and parameters correspond to the actions.  After the start of the rild daemon, the modem is initialized, the necessary information is received from the base station, etc. <br>  If you sent an SMS message, then the following sequence of AT commands corresponded to this: <br>  <b>AT + CMGS = 18</b> <b><br></b>  <b>&gt;</b> <b><br></b>  <b>0001000b815686070855f4345005c8329bfd06 ^ z</b> <br>  The message looks like this because it is encoded in PDU format.  By playing a programmed sequence of AT commands, you can verify that the message is being successfully sent.  In this case, of course, is not displayed in the list of sent messages in the Android OS application. <br>  Using the AT command <b>AT + CUSD = 1, * 100 #, 15,</b> you can make a USSD request <br>  And using the command <b>ATD + 79161234567;</b>  make an outgoing phone call. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Using this approach, it is possible to filter, for example, SMS messages, calls, etc. <br><br>  Materials used: <br>  1. <a href="http://fabiensanglard.net/cellphoneModem/index2.php">fabiensanglard.net/cellphoneModem/index2.php</a> <br>  2. Source codes of manufacturer‚Äôs RIL </div><p>Source: <a href="https://habr.com/ru/post/185012/">https://habr.com/ru/post/185012/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184996/index.html">JavaOpen and JavaDay in Samara</a></li>
<li><a href="../185000/index.html">DARPA held a competition of humanoid robots in virtual reality</a></li>
<li><a href="../185004/index.html">Create a ListView with Context Action Bar as in the new Gmail</a></li>
<li><a href="../185008/index.html">Runet in pictures. New release</a></li>
<li><a href="../185010/index.html">DIY do-it-yourself instrumentation profiler</a></li>
<li><a href="../185014/index.html">On-line broadcast from the Open Day of the JetBrains</a></li>
<li><a href="../185018/index.html">EU court decided to collect tax from printer manufacturers due to possible copyright violations</a></li>
<li><a href="../185020/index.html">PayPal launches Galactic program to prepare payment systems for space commercialization</a></li>
<li><a href="../185022/index.html">QIWI Plastic for you - on special conditions</a></li>
<li><a href="../185030/index.html">Software raids: migration from Windows raid0 to Linux mdadm raid5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>