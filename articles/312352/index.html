<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>TailSampler - parallel GET requests sent to Apache.JMeter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Purpose of the plugin ¬´HTTP Request Tail¬ª 
 The plugin makes it easy to load embedded resources, and allows you to perform specified GET requests i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>TailSampler - parallel GET requests sent to Apache.JMeter</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/1d7/d54/2f5/1d7d542f5aff4a60a71849b9a1da54a1.jpg"><br><br><h3>  1. Purpose of the plugin ¬´HTTP Request Tail¬ª </h3><br>  The plugin makes it easy to load embedded resources, and allows you <b><i>to</i></b> perform <b><i>specified</i></b> GET requests <b><i>in parallel</i></b> .  By making the test as close as possible to the work of the browser in terms of the composition of the downloaded resources and the method of loading these resources. <br><br>  <b><a href="https://github.com/pflb/Jmeter.Plugin.TailSampler">TailSampler</a></b> helps out if needed: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  perform a group of GET requests in parallel; </li><li>  execute 1000 GET requests without generating 1000 <b>HTTP Request</b> components; </li><li>  test a site actively using <b>AJAX</b> , <b>Adobe Flash</b> , <b>Adobe AIR</b> , <b>SilverLigth</b> , ... </li></ul><a name="habracut"></a><br><h3>  2. Instructions for use </h3><br>  <b>HTTP Request Tail</b> converts the list of links into an HTML document, loading the embedded resources of which will create a GET request for each of the specified links. <br><br> <a href=""><img src="https://habrastorage.org/files/6ef/258/983/6ef25898340a4970952bccb41c52f0fa.png" alt="TailSampler </ b> plugin and using it"></a> <br>  <font color="#999999">Figure 1. <i>Data preparation process for the <b>TailSampler</b> plugin and its use</i></font> <br><br><ol><li>  Launch <b>Fiddler</b> . </li><li>  Open a page in a web browser, the download of which must be simulated in detail in a test - it can be a page with <b>Adobe Flash</b> , with <b>Adobe AIR</b> , with <b>Microsoft SilverLigth</b> , with <b>ActiveX</b> components. </li><li>  Perform the necessary actions on the page. </li><li>  Copy from <b>Gid</b> -requests from <b>Fiddler</b> , which need to be executed in the test in parallel, as if they were executed by the browser. </li><li>  Insert links into <b>TailSampler</b> , parameterize if necessary. </li><li>  Get parallel execution of specified queries in the test, the degree of parallelism is configured. </li></ol><br><iframe width="560" height="315" src="https://www.youtube.com/embed/9tKD0G9Hn-8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h3>  3. Operation of standard JMeter html parsers </h3><br>  The standard way to get an HTML document using the HTTP protocol in <b>JMeter</b> is to use the <b>HTTP Request</b> sampler.  In <b>HTTP Request</b> there is an easy way to request the embedded resources of the page - tick [v] <b><u><i>Retrieve Embedded Resource</i></u></b> s.  The standard parser that forms links to the page resources is <b>LagartoBasedHtmlParser</b> .  The parser can be changed in the <b>htmlparser.classname</b> setting of the <b>jmeter.properties</b> file. <br><br>  The study of <b>Apache.JMeter</b> parsers for five popular sites is given in the article ‚ÄúChoosing an html-parser for Apache.JMeter‚Äù: <br><br><ul><li>  <a href="https://habrahabr.ru/post/308254/">https://habrahabr.ru/post/308254/</a> </li></ul><br>  When using parsers, almost all the necessary resources are loaded.  But for different sites the download is different.  So if the website is implemented on <b>Microsoft Silverlight</b> , then the efficiency of the <b>Apache.JMeter</b> parser will be about 0%.  Whereas, using <b>TailSampler</b> , it will be possible to apply a load similar to the work of the browser in a simple way. <br><br><h4>  3.1.  An example of working with a complex site atlas.mos.ru </h4><br><table><tbody><tr><td><a href=""><img src="https://habrastorage.org/files/1bf/9b6/0bb/1bf9b60bb308436185939c92dfb486aa.png"></a> <br>  <font color="#999999">Figure 2. <i>Website <a href="https://atlas.mos.ru/">atlas.mos.ru</a> in the browser - <code>85</code> queries to the main domain</i></font> </td><td> <a href=""><img src="https://habrastorage.org/files/061/9d5/e15/0619d5e1561c41ddb1c71d8da98c5172.png"></a> <br>  <font color="#999999">Figure 3. <i>Website <a href="https://atlas.mos.ru/">atlas.mos.ru</a> in <b>JMeter</b> - <code>2</code> requests to the main domain</i></font> <br></td></tr><tr><td> <a href=""><img src="https://habrastorage.org/files/462/219/bec/462219bece014910bb052df61433b873.png"></a> <br>  <font color="#999999">Figure 4. <i>Tracing query execution can be seen at <a href="https://www.webpagetest.org/result/161014_ZM_1HRA/1/details/">webpagetest.org</a></i></font> <br></td><td> <a href=""><img src="https://habrastorage.org/files/c29/afb/df7/c29afbdf73ee415994e00040119c7e70.png"></a> <br>  <font color="#999999">Figure 5. <i>The browser performs <code>85</code> requests to the main domain, and JMeter only <code>2</code> - efficiency <code>2,35%</code> , see logs in <a href="https://docs.google.com/spreadsheets/d/1kL3XdDdg7KYSe64iKWlPEL-1jhTwp8v-9eu0IWTnEUk/edit%3Fusp%3Dsharing">google docs</a></i></font> </td></tr></tbody></table><br>  When you open the site <a rel="nofollow" href="https://atlas.mos.ru/">atlas.mos.ru</a> , actively using <b>AJAX</b> , you can see the difference: <br><br><ul><li>  <code>2</code> GET requests if <b>LagartoBasedHtmlParser</b> , <b>HTTP Request</b> , <b>JMeter</b> 3.0 is running; </li><li>  <code>85</code> GET requests if <b>Chrome</b> browser is running. </li></ul><br>  Thus, when using <b>HTTP Request</b> with setting [v] <i><b>Retrieve Embedded Resources</b></i> for the address <code>83</code> GET request will not be sent. <br><br><img src="https://habrastorage.org/files/daf/51c/368/daf51c3684a846d599d8fc978aa66883.jpg"><br><blockquote>  Not enough to be <br>  <a rel="nofollow" href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D0%25B4%25D0%25B0%25D0%25BB_%25D0%25BF%25D1%2580%25D0%25BE%25D1%2588%25D0%25BB%25D0%25BE%25D0%25B3%25D0%25BE%25D0%25B4%25D0%25BD%25D0%25B8%25D0%25B9_%25D1%2581%25D0%25BD%25D0%25B5%25D0%25B3">"Last year's snow fell"</a> </blockquote><br>  To simulate sending <code>83</code> GET requests, you will need to add <code>83</code> <b>HTTP Request</b> components to the <b>JMeter</b> script: <br><br><ul><li>  JMeter script will become cumbersome. </li></ul><br><p>  Added <code>83</code> <b>HTTP Request</b> will be processed one after the other - the browser sends requests for embedded resources <i>in parallel</i> : <br><br></p><ul><li>  the total duration of loading the page resources will be longer than in the browser; sequential loading is performed longer than the parallel one on an unloaded server; </li><li>  the number of simultaneously open connections to the server will be less than with the browser, the number of connections to the server indirectly affects performance. </li></ul><br><br> <a href=""><img src="https://habrastorage.org/files/9b7/e30/e9f/9b7e30e9fec8482ea7229eeb3ebf27c3.png"></a> <br>  <font color="#999999">Figure 6. <i>Report on the download site pflb.ru in <b>Firefox</b> - <a href="http://www.webpagetest.org/result/160319_RQ_Q3W/1/details/">http://www.webpagetest.org/result/160319_RQ_Q3W/1/details/</a> - you can see parallel download groups of <code>6</code> requests</i></font> <br><br>  Thus, using only <b>HTTP Request,</b> it will not be possible to completely reload the embedded resources so as to <i><b>accurately</b></i> measure the load time of the html page with all the subqueries. <br><br> <a href=""><img src="https://habrastorage.org/files/6df/8e9/03d/6df8e903de274468a7372d3e8f8afbef.jpg"></a> <br>  <font color="#999999">Figure 7. <i><b>HTTP Request</b> does not allow to see the whole picture; <b>HTTP Request Tail</b> will help to realize the tail of subqueries</i></font> <br><br><h3>  4. History of creation </h3><br>  The <b>HTTP Request Tail</b> plugin for <b>JMeter was</b> created as an alternative to the <b>Tile Server</b> - <b>python</b> service, see description below. <br><br>  The first acquaintance with the <b>Tile Server</b> service happened when colleagues Zhenya Borodenkov and Maxim Konyshev talked about load testing a web project loading large images in slices and tiles.  Then we solved the problem of load testing one of the versions of this web project using <b>SilverLight</b> on the client and streaming content from the server using the <i>SOAP / MSBin1 protocol</i> .  We did not know how to send requests from the <b>JMeter</b> via the <i>SOAP / MSBin1 protocol</i> and process the answers to them. We discussed the options. <br><br>  The story was like this: <br><blockquote>  - If Vova were here, he would say to use an intermediate service to form the necessary requests. <br><br>  - Intermediate service, it is too difficult (answered them).  Let's write a plugin for <b>JMeter</b> .  Plugin - simple and reliable. <br><br>  - That was when the previous testing was done, Andrey Pischulin wrote the <b>Tile Server</b> service in <b>python</b> , we still use this service, the service for working with tiles: <ul><li>  <b>JMeter</b> sends a list of links to the <b>Tile Server</b> server using the <i>POST</i> method via <b>HTTP Request</b> ; </li><li>  <b>Tile Server</b> implements a web server, accepts a list of links, generates from links an html-document with a list of iframes that point to links and returns an html-document <b>JMeter</b> ; </li><li>  <b>JMeter</b> parses the html document and performs the necessary GET requests as subqueries. </li></ul>  Let's do the same. <br><br>  - Well, let's do an intermediate service to implement the work with <i>SOAP / MSBin1</i> . <br></blockquote><br><img src="https://habrastorage.org/files/0b8/eb3/6bb/0b8eb36bb487494599412fc68bc85df6.PNG"><br>  <font color="#999999">Figure 8. <i>Tile Server</i></font> <br><br>  Looking ahead, I said, we did as well as I once did.  We made a proxy service on .NET, which formed requests for <i>SOAP / MSBin1</i> - <b>JMeter</b> sent commands to this service via <i>SOAP / XML</i> , and the service sent requests to the loadable node already via <i>SOAP / MSBin1</i> and returned answers to <b>JMeter</b> . <br><br>  And with a high load, the proxy service became a bottleneck, it could not generate requests and process responses so that the loadable servers would be depressed and lay down.  The test servers received the load, but if they answered the proxy service in <code>10</code> seconds, the proxy service responded to <b>JMeter</b> in <code>110</code> seconds.  According to statistics, the <b>JMeter</b> logs showed that the loadable service was depressed, and yes, the load was good, but the loadable service responded briskly, more cheerfully, as the <b>JMeter</b> logs showed.  Prompt addition of detailed logging to the proxy service corrected the situation, but when the proxy service hung, then logging on it was delayed - it was necessary to scale the intermediate service or rewrite it completely, one copy did not pull on the role of ‚ÄúTsar Cannon‚Äù. <br><br> <a href=""><img src="https://habrastorage.org/files/b8e/0db/c6d/b8e0dbc6d298450c9ddb0ee4ac9aea0e.jpg"></a> <br>  <font color="#999999">Figure 9. <i>Tsar Cannon</i></font> <br><br>  Proxy service has become the point of failure.  Then we returned to the idea of ‚Äã‚Äãa plug-in for <b>JMeter</b> , and made a <b>JSR223</b> <b>JNA</b> library and a proxy client on a .NET machine gun to work on the <i>SOAP / MSBin1 protocol</i> , it <i>turned</i> out great.  The plugin no longer has to handle multiple incoming streams.  Of course, there are more overhead costs for RAM, but it works faster. <br><br>  Then the idea arose to write a sampler <b>JMeter</b> to java, to replace the <b>Tile Server</b> , all of a sudden and it is a point of failure under load.  Even the name of the future sampler appeared ‚ÄúHTTP Request Tail‚Äù or ‚ÄúTail Sampler‚Äù.  Due to the poor knowledge of the English language, I heard the word ‚ÄúTile‚Äù as ‚ÄúTail‚Äù, did not understand a little, and here ‚Äútiles‚Äù and the word, which is translated as ‚Äútail‚Äù.  Deaf phones, tail and tail, the image of a mermaid added to the picture.  The idea was fixed, the idea is clear, the name is.  It remained the least - to do.  Here Sasha Perevozchikova <a href="https://habrahabr.ru/users/sanchez92/" class="user_link">Sanchez92</a> , a plugin development expert, helped. <br><br>  I have no <b>complaints</b> about <b>Tile Server</b> , my colleagues say - this is a fast and reliable tool.  The plugin was created out of curiosity and interest in the <b>JMeter</b> tool for me, and Sasha had to do something, or the girl missed. <br><br>  All the names in this story are non-fictional, made explicitly or indirectly by the plugin ‚ÄúHTTP Request Tail‚Äù: <br><br><ul><li>  Sasha Perevozchikova; </li><li>  Andrey Pishulin; </li><li>  Vova Lavrentiev; </li><li>  Maxim Konyshev; </li><li>  Zhenya Borodenkov; </li><li>  and I was there, drinking something. </li></ul><br><p></p><br><h3>  5. Description </h3><br><h4>  5.1.  Default settings </h4><br> <a href=""><img src="https://habrastorage.org/files/b00/fe1/2ab/b00fe12ab7c44ed6b20decd841ba9fc2.PNG"></a> <br>  <font color="#999999">Figure 10. <i>Default Settings</i></font> <br><br>  The default settings are: <br><br><ul><li>  [v] <i><b>Retrieve All Embedded Resources</b></i> - the checkbox is checked by default, it can be removed, but then subqueries will not be executed, and the <b>HTTP Request Tail</b> will become useless; </li><li>  [v] <i><b>Use concurent pool</b></i> - by default, a check mark is set; on a large number of embedded resources, multi-threaded download increases the download speed; </li><li>  <i><b>Use concerent pool Size</b></i> : <code>4</code> - the default value is 4, this value is used by <b>JMeter</b> as the base: <br><ul><li>  <b>HttpClient4</b> when configuring <i><b>Use concerent pool Size</b></i> : <code>4</code> will send up to 4 requests simultaneously, each stream will use 1 permanent connection for each domain: <br><ul><li>  a group of streams will start, the size of the group is determined by the setting <b>Use concerent pool Size</b> ; </li><li>  when setting [v] <i><b>Use keepalive,</b></i> each stream for each unique domain will create one persistent connection (persistent-connection); </li></ul></li><li>  <b>Mozilla Firefox 44.0</b> browser by default sends up to <code>6</code> simultaneous requests for each domain (see <code>about:config</code> ): <br><ul><li>  <code>256</code> - <b>network.http.max-connections</b> - the maximum number of connections; </li><li>  <code>6</code> - <b>network.http.max-persistent-connections-per-server</b> - the maximum number of persistent connections to the server (keepalive); </li><li>  <code>32</code> - <b>network.http.max-persistent-connections-per-proxy</b> - the maximum number of persistent connections to the proxy server (keepalive); </li></ul></li><li>  If you focus on the settings of <b>Mozilla Firefox 44.0</b> , and the fact that links to embedded resources in load testing projects usually belong to the same domain, then in the <i><b>Use concerent pool Size</b></i> you can put the value <code>6</code> , instead of the default value <code>4</code> . </li></ul></li></ul><br>  Unused settings are settings for POST requests, the values ‚Äã‚Äãare not used in any way by the main request or by subqueries: <br><br><ul><li>  [] <i><b>Use multipart / form-data for POST</b></i> ; </li><li>  [] <i><b>Browser-compatible headers</b></i> . </li></ul><br>  The main request is generated, but not sent, the settings for POST requests do not apply to it.  Subqueries use the GET method; the settings for POST requests also do not work for them. <br><br>  The remaining settings affect subqueries. <br><br>  <b>HTTP Request Tail</b> is a successor to <b>HTTP Request</b> , a description of the settings can be found in the documentation for the <b>HTTP Request</b> : <br><br><ul><li>  <a rel="nofollow" href="http://jmeter.apache.org/usermanual/component_reference.html">http://jmeter.apache.org/usermanual/component_reference.html#HTTP_Request</a> - documentation for the <b>HTTP Request</b> . </li></ul><br><br><h4>  5.2.  Customized HTTP Request Tail </h4><br> <a href=""><img src="https://habrastorage.org/files/401/7bb/e33/4017bbe3372d4f6f9d846506dcbafdac.png"></a> <br>  <font color="#999999">Figure 11. <i>Configured HTTP Request Tail</i></font> <br>  Links to embedded resources are listed in the <i><b>Embedded resources</b></i> text box.  You can specify relative and absolute links. <br><br><h5>  5.2.1.  Absolute links </h5><br>  For a description of the format of absolute links, see RFC: <a href="https://tools.ietf.org/html/rfc3986">https://tools.ietf.org/html/rfc3986</a> . <br><br>  Absolute links begin with the protocol: <br><ul><li> <code>file://</code> </li> <li> <code>http://</code> </li> <li> <code>https://</code> </li> </ul><br>  Other protocols will not be processed by <b>HTTP Request Tail</b> .  Examples of absolute links: <br><br><ul><li> <code>file://C:\Data\htmlDocument.html#Part1</code> </li> <li> <code><a rel="nofollow" href="http://www.pflb.ru/">http://www.pflb.ru/</a></code> </li> <li> <code><a rel="nofollow" href="https://yandex.ru/%3Fq%3DTesting%26amp%3Bclient%3DMozilla">https://yandex.ru/?q=Testing&amp;client=Mozilla</a></code> </li> </ul><br><br><h5>  5.2.2.  Relative links </h5><br>  Relative references are complemented by field values: <br><ul><li>  <i><b>Path</b></i> - the directory for those links that are relative to the page, not relative to the host, here can be specified and the protocol and the host and port. </li><li>  <i><b>Web Server</b></i> - host and port: <br><ul><li>  <i><b>Server Name or IP</b></i> ; </li><li>  <i><b>Port Number</b></i> ; </li></ul></li><li>  <i><b>Protocol [http]</b></i> - protocol, if the <i><b>Path</b></i> does not specify a protocol, the value is taken into account, the values <code>file</code> , <code>http</code> , <code>https</code> acceptable. </li></ul><br>  An example of relative links: <br><br><ul><li> <code>image1.png</code> </li> <li> <code>/images/image1.png</code> </li> <li> <code>/ResourceGenerator.aspx?id=0121</code> </li> <li> <code>subFolder/style.css</code> </li> <li> <code>subFolder/1/2/3/test.php</code> </li> </ul><br><br><h5>  5.2.3.  Parameterization using variables and functions </h5><br>  To parameterize GET queries, you can use <b>JMeter</b> variables and functions.  Example: <br><ul><li> <code><b>${variable_URL}</b></code> </li> <li> <code>/search.php?q= <b>${variable_Query_String}</b></code> </li> <li> <code>/search.php?q= <b>${variable_Query_String}</b> &amp;client=Mozilla</code> </li> <li> <code>/search.php?q= <b>${__urlencode(${variable_Query_String})}</b> &amp;client=Mozilla</code> </li> </ul><br><br><h5>  5.2.4.  Unicode and html entity handling features </h5><br>  When forming the html-page of the links used html-screening.  Therefore, when writing links, you can use: <br><br><ul><li>  Cyrillic domains; </li><li>  special characters such as <code>&lt;</code> , <code>&gt;</code> , <code>&amp;</code> and others; </li><li>  any unicode characters. </li></ul><br>  The structure of the HTML-page is not broken, the links will be processed correctly and in full. <br>  For a complete list of html entities for html4, see here: <br><br><ul><li>  <a rel="nofollow" href="http://www.w3.org/TR/html4/sgml/entities">http://www.w3.org/TR/html4/sgml/entities</a> </li></ul><br>  If an entity from the specification is not escaped, then make a note to the plugin. <br><br>  No need to pre-screen special characters.  So if there is a need to specify the URL of the form: <br><br><ul><li>  <code>/search.php?q=Testing <b>&amp;</b> client=Mozilla</code> - correct. </li></ul><br>  This is the way to write - just <b><code>&amp;</code></b> , pre-screen on <b><code>&amp;amp;</code></b>  do not: <br><br><ul><li> <code>/search.php?q=Testing <b>&amp; <u>amp;</u></b> client=Mozilla</code>  <code>/search.php?q=Testing <b>&amp; <u>amp;</u></b> client=Mozilla</code> is <b><i><u>wrong</u></i></b> . </li></ul><br><br><h5>  5.2.5.  Unicode for java </h5><br>  It is noticed that if there is a unicode-character in the address, for example, ¬Æ, Œ©, œÄ, ‚âà: <br><br><ul><li> <code>/search.php?q=Microsoft¬Æ</code> </li> </ul><br>  And in the <i><b>Implementation</b></i> setting there is a <code>Java</code> value, then in the subquery, the unicode character will be replaced by a square: <br><br><ul><li> <code>/search.php?q=Microsoft‚ñ°</code> </li> </ul><br>  When running <b>JMeter</b> from <b>Windows</b> using a bat-file, <code>windows-1251</code> is assigned to <b>java as</b> an encoding, I guess this is the reason for replacing the unicode-character with a square.  To set the encoding, you need to specify in the bat-file the argument for <b>java</b> : <code>-Dfile.encoding=UTF-8</code> .  When using <code>HttpClient4</code> and <code>HttpClient3.1</code> such an unwanted transformation does not occur. <br><br><h4>  5.3.  Generated response </h4><br> <a href=""><img src="https://habrastorage.org/files/9d7/613/9e7/9d76139e750242c5a9145dd949fa100f.PNG"></a> <br>  <font color="#999999">Figure 12. The <i>response to the main request - the generated response</i></font> <br><br>  The response to the main request is generated.  There is no request, only the response body. <br><br>  The body of the response is a html-document, text encoded in UTF-8, where for each link to the embedded resource an <code>iframe</code> tag is generated. <br><br>  Sample document: <br><br><pre> <code class="html hljs xml"> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Embedded resources<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.google-analytics.com/analytics.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/sites/all/themes/pro/static/img/icons.png"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sites/all/themes/pro/static/img/main_3_block90-s.png"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://pflb.ru/sites/all/themes/pro/static/img/footer-shadow.png"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://staticxx.facebook.com/connect/xd_arbiter.php"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br> <a href=""><img src="https://habrastorage.org/files/80b/699/662/80b6996620724c6293e4e6ca4a3ffa04.PNG"></a> <br>  <font color="#999999">Figure 13. <i>Executed query execution statistics</i></font> <br><br><h5>  5.3.1.  Plans to change </h5><br>  When writing an article about JMeter parsers, JMeter developer Philippe M. <a href="https://habrahabr.ru/users/philmdot/" class="user_link">philmdot</a> appeared in the comments and asked to post a defect to the recursive processing account: <br><br><ul><li>  <a href="https://habrahabr.ru/post/308254/">https://habrahabr.ru/post/308254/#comment_9767524</a> </li></ul><br>  I plan to post a defect, and even fix it.  Making it so that for responses to requests from <code>img</code> tags there is no recursive search for references to resources.  For <b>JMeter</b> parsing to work as well as the browser does.  But if the <code>iframe</code> , then it is necessary to perform the parsing, and if just <code>img</code> , then a single query is executed. <br><br>  And then it will be necessary to change the <b>TailSampler</b> plugin so that when generating, <code>img</code> tags are used instead of <code>iframe</code> tags. <br><br>  Today Philippe wrote that he would like to see this code in the <b>JMeter</b> core, that it would be a good way to work with <b>AJAX</b> .  I will try to catch this year, it will be an interesting experience. <br><br><br><h4>  5.4.  Known effects </h4><br><br><h5>  5.4.1.  +1 query in the log </h5><br>  Although the root request is not sent, it is logged: <br><br><ul><li>  weakly, but overestimates the value of the indicator <b>Hits per second</b> - hits per second; </li><li>  indirectly, it affects the overall statistics for the JMeter log; </li><li>  to reduce the impact of this single query on statistics - the number of real subqueries should be large, dozens of links in the <i><b>Embedded resources</b></i> field. </li></ul><br><br><h5>  5.4.2.  Visual deception for answer 302 </h5><br>  If there is a <i><b>Follow Redirect</b></i> setting, then for each embedded resource with the response code <code>302</code> (Found): <br><br><ul><li>  it will be redirected to the page specified in the <b>Location</b> value of the response header; </li><li>  redirects are displayed in <b>JMeter</b> as subqueries - visually looks like a cascade of requests. </li></ul><br><br><h5>  5.4.3.  Recursion </h5><br>  A rare but possible effect is the loading of embedded resources for an embedded resource: <br><br><ul><li>  with content type (see <b>htmlParser.Types</b> settings and <b>wmlParser.Types settings</b> in <b>jmeter.properties</b> ): <br><br><ul><li>  text / html; </li><li>  application / xhtml + xml; </li><li>  application / xml; </li><li>  text / xml; </li><li>  text / vnd.wap.wml; </li></ul></li><li>  performed: <br><br><ul><li>  loading embedded resources for the current embedded resource ‚Äî perhaps there will be more subqueries than links in the <i><b>Embedded resources</b></i> field. </li></ul></li></ul><br><br>  There are plans to limit the recursion depth to a parameter settable from the plug-in interface to 3 levels by default.  When downloading a picture ( <b>img</b> tag), the browser does not load embedded resources for it.  Immediately, all the resources are wrapped in the <b>iframe</b> tag, and <b>Apache.JMeter</b> does not currently distinguish which tag was used for the request - it always parses the answer to the subject of the subqueries, if the <b>Content Type of the</b> response is appropriate. <br><br> <a href=""><img src="https://habrastorage.org/files/640/bff/594/640bff5949084b1e98f03dc3295db0a9.png"></a> <br>  <font color="#999999">Figure 14. The <i>first request, test_server.ru, is visible, which was not actually executed (‚Äú+1 request‚Äù effect).</i></font>  <font color="#999999"><i>The redirection cascade is visible (the ‚ÄúVisual deception for response 302‚Äù effect) and the subqueries for subqueries (the ‚ÄúRecursion‚Äù effect).</i></font> <br><br><p></p><h4>  5.5.  Temporal characteristics </h4><br>  If you uncheck [] <i><b>Retrieve All Embedded Resources</b></i> or don‚Äôt specify any links to <i><b>Embedded resources</b></i> , then the logs will say that the request went instantly, and the answer came instantly. <br><br>  Description of time characteristics: <br><br><ul><li>  <b>Load Time</b> - the total duration of the load embedded resources; </li><li>  <b>Connect time is</b> always <code>0</code> ; </li><li>  <b>Latency is</b> always <code>0</code> . </li></ul><br><br><h3>  6. Project on Github </h3><br><ul><li>  <a rel="nofollow" href="https://github.com/pflb/Jmeter.Plugin.TailSampler">https://github.com/pflb/Jmeter.Plugin.TailSampler</a> - link to the project; </li><li>  <a rel="nofollow" href="https://github.com/pflb/Jmeter.Plugin.TailSampler/issues">https://github.com/pflb/Jmeter.Plugin.TailSampler/issues</a> - issue a comment to the project. </li></ul><br><br><h3>  7. Project structure </h3><br>  Source code in the directory: <br><br>  <a rel="nofollow" href="https://github.com/pflb/Jmeter.Plugin.TailSampler/tree/master/ru.pflb.jmeter.samplers.TailSampler/src/ru/pflb/jmeter">/ src / ru / pflb / jmeter</a> <br><ul><li>  <a rel="nofollow" href="http/config/gui">protocol / http / config / gui</a> : <br><ul><li>  <b><a rel="nofollow" href="https://github.com/pflb/Jmeter.Plugin.TailSampler/blob/master/ru.pflb.jmeter.samplers.TailSampler/src/ru/pflb/jmeter/protocol/">TailUrlConfigGui.java</a></b> - a control with a large input field for links to embedded resources; </li></ul></li><li>  samplers: <br><ul><li>  <a rel="nofollow" href="https://github.com/pflb/Jmeter.Plugin.TailSampler/tree/master/ru.pflb.jmeter.samplers.TailSampler/src/ru/pflb/jmeter/samplers/wrapper">wrapper</a> - wrappers to use the implementation specified on the form: <br><ul><li>  <b><a rel="nofollow" href="">WrapperHTTPFileImpl.java</a></b> - a wrapper to use the <code>file://</code> protocol handler for subqueries; </li><li>  <b><a rel="nofollow" href="">WrapperHTTPHC3Impl.java</a></b> - a wrapper to use <code>HttpClient3.1</code> from the <i><b>Implementation</b></i> setting for subqueries; </li><li>  <b><a rel="nofollow" href="">WrapperHTTPHC4Impl.java</a></b> - a wrapper to use <code>HttpClient4</code> from the <i><b>Implementation</b></i> setting for subqueries; </li><li>  <b><a rel="nofollow" href="">WrapperHTTPJavaImpl.java</a></b> - a wrapper to use <code>Java</code> from the <i><b>Implementation</b></i> setting for subqueries; </li><li>  <b><a rel="nofollow" href="">WrapperHTTPSamplerFactory.java</a></b> - a factory to create wrappers, returns a handler based on protocol values ‚Äã‚Äãand the <i><b>Implementation</b></i> setting; </li></ul></li><li>  <b><a rel="nofollow" href="">EscapeUtils.java</a></b> - implementation of html-screening, allows you to work with Russian domains, Unicode, and special characters in the links; </li><li>  <b><a rel="nofollow" href="">ITailHTTPImpl.java</a></b> - the basic interface for all handlers; </li><li>  <b><a rel="nofollow" href="">TailHTTPHC4Impl.java</a></b> - modified <b>HttpClient4</b> , which uses the specified response body without sending a request; </li><li>  <b><a rel="nofollow" href="">TailHTTPSamplerProxy.java</a></b> is a proxy class which implements all the logic of <b>TailSampler</b> operation: <br><ul><li>  for the first request, takes a list of links from the <i><b>Embedded resources</b></i> field and sends to <b>TailHTTPHC4Impl</b> - emulation of the page with the list of <b>iframes</b> in the content; </li><li>  for requests for embedded resources, a standard handler is created and called, specified in the <i><b>Implementation</b></i> setting ‚Äî the actual sending of requests; </li></ul></li><li>  <b><a rel="nofollow" href="">TailHttpSamplerGui.java</a></b> - <b><a rel="nofollow" href="">TailSampler</a></b> visual presentation. </li></ul></li></ul><br>  Other directories are auxiliary, used for ease of debugging the project. <br><br><h4>  7.1.  The form </h4><br>  The <i>TailUrlConfigGui</i> form is a modification of the main <b>HTTP Request</b> form from <b>Apache.JMeter</b> 2.13, from which the fields for editing the request body and setting the parameter list have been removed, but one large field has been added for entering the list of links. <br>  And the appearance of <i>TailHttpSamplerGui is</i> also a copy of the <b>HTTP Request</b> , where the new main control <i>TailUrlConfigGui</i> is now used. <br><br>  It was not without copy-paste.  I took this step so that the <b>HTTP Request Tail is</b> almost the same as the <b>HTTP Request</b> . <br><br>  But in <b>JMeter</b> 3.0, the look and feel of the <b>HTTP Request has</b> been changed, the controls have been swapped.  Now <b>HTTP Request Tail</b> is different <b>HTTP Request</b> for <b>JMeter</b> 3.0.  But this does not affect the work. <br><br><h4>  7.2.  Wrappers </h4><br>  I wanted to use the existing code to the maximum, but I didn‚Äôt want to deal with copy-paste.  Therefore, the Wrapper classes were created, thanks to which the methods <i>sample</i> , <i>notifyFirstSampleAfterLoopRestart</i> and <i>threadFinished</i> became available. <br><br><h4>  7.3.  Shielding utility </h4><br>  The code for the class that performs the screening is taken from ibm.com: <a href="http://www.ibm.com/developerworks/ru/library/se-prevent/index.html">www.ibm.com/developerworks/ru/library/se-prevent/index.html</a> <br>  The html-entity table has been extended with an RFC with a description of HTML4. <br><br><br><h3>  8. Installation </h3><br><ol><li>  Download plugin <b>ru.pflb.jmeter.samplers.TailSampler.jar</b> : <br><ul><li>  All versions: <a href="https://github.com/pflb/Jmeter.Plugin.TailSampler/releases">github.com/pflb/Jmeter.Plugin.TailSampler/releases</a> </li></ul></li><li>  Copy plugin to <b>lib / ext</b> directory for <b>JMeter</b> . </li><li>  Restart <b>JMeter</b> . </li></ol><br> <a href=""><img src="https://habrastorage.org/files/d08/636/3bd/d086363bd0154c90904e7a1f9f646bf5.png"></a> <br>  <font color="#999999">Figure 15. <i><b>HTTP Request Tail</b> plugin is now available in <b>JMeter</b></i></font> <br><br>  Catalog example: <br><br><pre>  D: \ TOOLS \ apache-jmeter-2.13 \ lib \ ext \
 D: \ TOOLS \ apache-jmeter-2.13 \ lib \ ext \ ru.pflb.jmeter.samplers.TailSampler.jar
 D: \ TOOLS \ apache-jmeter-3.0 \ lib \ ext \
 D: \ TOOLS \ apache-jmeter-3.0 \ lib \ ext \ ru.pflb.jmeter.samplers.TailSampler.jar </pre><br><br><h3>  9. System requirements </h3><br><br><h4>  9.1.  To work with Apache.JMeter 2.13 </h4><br><ul><li>  Java (TM) SE Runtime Environment version 6 (build 1.6.0_45-b06) or higher: <br><br><ul><li>  <a rel="nofollow" href="http://www.oracle.com/technetwork/java/javase/downloads/419409">http://www.oracle.com/technetwork/java/javase/downloads/419409</a> - the minimum required version (the project will need to be rebuilt, the project built for JDK 1.7 in the repository); </li><li>  <a rel="nofollow" href="http://www.java.com/ru/download/manual.jsp">http://www.java.com/en/download/manual.jsp</a> - the latest version of Oracle JDK; </li><li>  <b>OpenJDK</b> versions not lower than 1.6 are also suitable, for example, <b>OpenJDK</b> 1.7.0_09-icedtea. </li></ul></li><li>  JMeter 2.13: <br><br><ul><li>  <a rel="nofollow" href="">https://archive.apache.org/dist/jmeter/binaries/apache-jmeter-2.13.zip</a> - <b>Apache.JMeter</b> 2.13. </li></ul></li></ul><br>  <b>Apache.JMeter</b> 2.13 is built using <b>Java</b> 6. And if you build the <b>TailSampler</b> plugin using, for example, <b>OpenJDK</b> 1.7.0_09-icedtea, and run <b>Apache.JMeter</b> 2.13 + the assembled plugin on a computer with only <b>Java</b> 6, then <b>Apache.JMeter</b> 2.13 it will start, but the plugin will not.  As a result, their bundle will not work.  The question of building projects and libraries for different versions of <b>Java</b> and their compatibility deserves a separate instruction. <br><br><h4>  9.2.  To work with Apache.JMeter 3.0 </h4><br><ul><li>  Java (TM) SE Runtime Environment version 7 (build 1.7.0_80-b15 (Oracle Corporation)) or higher: <br><br><ul><li>  <a rel="nofollow" href="http://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html">http://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html#jre-7u80-oth-JPR</a> - the minimum required version; </li><li>  <a rel="nofollow" href="http://www.java.com/ru/download/manual.jsp">http://www.java.com/en/download/manual.jsp</a> - the latest version of Oracle JRE; </li><li>  <b>OpenJDK</b> versions not lower than 1.7 also fit. </li></ul></li><li>  JMeter 3.0: <br><br><ul><li>  <a rel="nofollow" href="http://jmeter.apache.org/download_jmeter.cgi">http://jmeter.apache.org/download_jmeter.cgi</a> - <b>Apache.JMeter</b> 3.0. </li></ul></li></ul><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache.JMeter</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3.0 is built using Java 7. The </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TailSampler</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> plugin </font><font style="vertical-align: inherit;">must be built using Java 7 or the version of Java that will be used to run JMeter and the plugin.</font></font><p></p></div><p>Source: <a href="https://habr.com/ru/post/312352/">https://habr.com/ru/post/312352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../312338/index.html">MapReduce from scrap materials. Part III - Putting It All Together</a></li>
<li><a href="../312340/index.html">Basics of computer networks. Subject number 4. Network devices and types of cables used</a></li>
<li><a href="../312344/index.html">Pro application backward compatibility and digging out flight attendants</a></li>
<li><a href="../312346/index.html">Cross-VC NSX: Simplicity and Flexibility for Multiple Deployments</a></li>
<li><a href="../312348/index.html">OpenShift xPaaS version 3. "Hello, world"</a></li>
<li><a href="../312354/index.html">For lovers of FPGAs, ASICs, architecture and micro-architecture - more about seminars and conveyors</a></li>
<li><a href="../312356/index.html">Building a mental map for learning</a></li>
<li><a href="../312358/index.html">Study. As an increase in the clickable area of ‚Äã‚Äãa button changes the number of clicks on it.</a></li>
<li><a href="../312360/index.html">Duma about the web-API. Part one</a></li>
<li><a href="../312362/index.html">How technologies change the quality of life: the development of smart prostheses based on ITMO University</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>