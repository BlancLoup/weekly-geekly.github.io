<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ZF2 + Blitz templates</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, my dear habrovchane. And if any of you are engaged in web development in PHP, then generally welcome. I began to look at various frameworks jus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ZF2 + Blitz templates</h1><div class="post__text post__text-html js-mediator-article">  Hello, my dear habrovchane.  And if any of you are engaged in web development in PHP, then generally welcome.  I began to look at various frameworks just now ... We divorced them in PeHaPe - a passion.  Apple has nowhere to fall, as they say blondes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/766/5aa/c06/7665aac064a24ac69b736a00bd4fcbc3.jpg"></div><br><a name="habracut"></a><br>  I remembered here that once upon a time (when DOM-trees were large, and Unicode was single-byte) I made a tiny commit to Zend Framework (then only the 1st version was).  Let me think, see - what lives, what Zend breathes today.  I looked - I grew up somehow ... matured ... And I remember him like that‚Ä¶ I began to read <a href="http://framework.zend.com/blog/announcing-the-zend-framework-3-roadmap.html">what will happen next</a> , and also <a href="http://www.php-fig.org/psr/psr-7/">an article about PSR-7, HTTP Messages and their implementation in PHP</a> .  Holy Fathers!  We must continue to look, we must learn, learn and learn.  And then a young pimp will come, and how will he wipe me from the face of the Earth: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/4cc/b04/527/4ccb045273c34b8eb89a2cac93af2215.jpg"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All had to learn again.  He groaned, went through the <a href="http://framework.zend.com/manual/current/en/user-guide/overview.html">Getting Started <s>Quest</s> Guide</a> , thought.  I didn't like something in all this.  Maybe the dark words "Skeleton Application" at the top?  Or the fact that the config for Nginx had to write itself (what are they poking me with their Apache Harey in the face?).  No, not that ... <br><br>  ABOUT!  There after all in ZF2 template engine for PHP! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e3d/5ec/d1f/e3d5ecd1f0aaef458e0f0fc4d779bccb.jpg" alt="Tired of Spaghetti code? Try Blitz!"></div><br><br>  Over the years in Badoo, Blitz templates have become familiar and familiar.  It is necessary to fasten them here urgently.  Googled - no.  What the hell??  (probably bad google?) In general, I cleaned the XDebug <s>scalpel</s> , took cotton, alcohol and a cucumber, and began to dissect. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e5d/074/273/e5d074273da2450397125c8144151f83.jpg"></div><br><br>  The patient was <a href="https://github.com/akrabat/zf2-tutorial">a learning app</a> .  More precisely, <a href="https://github.com/crocodile2u/zf2-tutorial">its fork</a> . <br><br>  Tak-s, <a href="http://framework.zend.com/manual/current/en/modules/zend.view.quick-start.html">let's see, see</a> ... What is a patient's healthy liver, you do not find, colleague?  Though in the coffin of luggage ... Here we will transplant it.  By cookie, I mean the implementation of the <i>RendererStrategy</i> from <a href="http://framework.zend.com/manual/current/en/modules/zend.view.quick-start.html">Zend View Quick Start</a> .  Take the class <i>AcceptStrategy</i> and copy to yourself.  Let's call a copy, as usual, Poluekt.  Just kidding, let's call <i>Application \ View \ RenderingStrategy</i> .  Why not <i>BlitzRenderingStrategy</i> ?  Yes, of course, it creates and adjusts our rendering engine, which means it will also, for example, customize the rendering of JSON, in the case of a corresponding request.  So here. <br><br>  In the resulting class, I amputated the ‚ÄúxxxRenderer‚Äù properties ‚Äî why do we need them right away?  Well, to have Zendovsky <i>ServiceManager</i> on hand, I decided to pass it on to the constructor: <br><br><blockquote>  <font color="#009933">/ **</font> <font color="#009933"><br></font>  <font color="#009933">* @param ServiceManager $ sm</font> <font color="#009933"><br></font>  <font color="#009933">* /</font> <br>  <font color="#000000">public</font> <font color="#000000">function</font> __construct <font color="#009900">(</font> ServiceManager <font color="#000088">$ sm</font> <font color="#339933">=</font> <font color="#009900">null</font> <font color="#009900">)</font> <br>  <font color="#009900">{</font> <br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">sm</font> <font color="#339933">=</font> <font color="#000088">$ sm</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> </blockquote><br><br>  <i>selectRenderer ()</i> and <i>injectResponse ()</i> had to be rewritten.  That's what comes to it! <br><br><blockquote>  <font color="#009933">/ **</font> <font color="#009933"><br></font>  <font color="#009933">* @param ViewEvent $ e</font> <font color="#009933"><br></font>  <font color="#009933">* @return \ Zend \ View \ Renderer \ RendererInterface</font> <font color="#009933"><br></font>  <font color="#009933">* /</font> <br>  <font color="#000000">public</font> <font color="#000000">function</font> selectRenderer <font color="#009900">(</font> <font color="#000088">$ e</font> <font color="#009900">)</font> <br>  <font color="#009900">{</font> <br>  <font color="#000088">$ model</font> <font color="#339933">=</font> <font color="#000088">$ e</font> <font color="#339933">-&gt;</font> <font color="#004000">getModel</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ model</font> instanceof JsonModel <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#b1b100">return</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">sm</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> JsonRenderer <font color="#339933">::</font> <font color="#000000">class</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#b1b100">return</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">sm</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> BlitzRenderer <font color="#339933">::</font> <font color="#000000">class</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#009933">/ **</font> <font color="#009933"><br></font>  <font color="#009933">* @param \ Zend \ Mvc \ MvcEvent $ e The MvcEvent instance</font> <font color="#009933"><br></font>  <font color="#009933">* @return void</font> <font color="#009933"><br></font>  <font color="#009933">* /</font> <br>  <font color="#000000">public</font> <font color="#000000">function</font> injectResponse <font color="#009900">(</font> <font color="#000088">$ e</font> <font color="#009900">)</font> <br>  <font color="#009900">{</font> <br>  <font color="#000088">$ renderer</font> <font color="#339933">=</font> <font color="#000088">$ e</font> <font color="#339933">-&gt;</font> <font color="#004000">getRenderer</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ response</font> <font color="#339933">=</font> <font color="#000088">$ e</font> <font color="#339933">-&gt;</font> <font color="#004000">getResponse</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ renderer</font> instanceof JsonRenderer <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#666666">// JSON Renderer;</font>  <font color="#666666">set content-type header</font> <br>  <font color="#000088">$ headers</font> <font color="#339933">=</font> <font color="#000088">$ response</font> <font color="#339933">-&gt;</font> <font color="#004000">getHeaders</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ headers</font> <font color="#339933">-&gt;</font> <font color="#004000">addHeaderLine</font> <font color="#009900">(</font> <font color="#0000ff">'content-type'</font> <font color="#339933">,</font> <font color="#0000ff">'application / json'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#666666">// Inject the content</font> <br>  <font color="#000088">$ response</font> <font color="#339933">-&gt;</font> <font color="#004000">setContent</font> <font color="#009900">(</font> <font color="#000088">$ e</font> <font color="#339933">-&gt;</font> <font color="#004000">getResult</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> </blockquote><br>  Something for a long time there were no pictures. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b3d/164/97b/b3d16497b6a643afa51bac1ce870f2af.jpg"></div><br><br>  Here it is.  Already a whole class did!  But this was not enough!  It is also necessary that our ‚Äúmodule‚Äù (the word for which is the module module) know that we are preparing for it!  No, what's a goose, eh ?!  This all happens in the class <i>Application \ Module</i> <br><br><blockquote>  <font color="#009933">/ **</font> <font color="#009933"><br></font>  <font color="#009933">* @param \ Zend \ Mvc \ MvcEvent $ e The MvcEvent instance</font> <font color="#009933"><br></font>  <font color="#009933">* @return void</font> <font color="#009933"><br></font>  <font color="#009933">* /</font> <br>  <font color="#000000">private</font> <font color="#000000">function</font> registerRenderingStrategy <font color="#009900">(</font> <font color="#000088">$ e</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000088">$ app</font> <font color="#339933">=</font> <font color="#000088">$ e</font> <font color="#339933">-&gt;</font> <font color="#004000">getTarget</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ locator</font> <font color="#339933">=</font> <font color="#000088">$ app</font> <font color="#339933">-&gt;</font> <font color="#004000">getServiceManager</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ view</font> <font color="#339933">=</font> <font color="#000088">$ locator</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> \ Zend \ View \ View <font color="#339933">::</font> <font color="#000000">class</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000088">$ renderingStrategy</font> <font color="#339933">=</font> <font color="#000088">$ locator</font> <font color="#339933">-&gt;</font> <font color="#004000">get</font> <font color="#009900">(</font> RenderingStrategy <font color="#339933">::</font> <font color="#000000">class</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#666666">// Attach strategy, which is a listener aggregate, at high priority</font> <br>  <font color="#000088">$ view</font> <font color="#339933">-&gt;</font> <font color="#004000">getEventManager</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">attach</font> <font color="#009900">(</font> <font color="#000088">$ renderingStrategy</font> <font color="#339933">,</font> <font color="#cc66cc">100</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000000">public</font> <font color="#000000">function</font> getServiceConfig <font color="#009900">(</font> <font color="#009900">)</font> <br>  <font color="#009900">{</font> <br>  <font color="#b1b100">return</font> <font color="#990000">array</font> <font color="#009900">(</font> <br>  <font color="#339933">...</font> <br>  <font color="#0000ff">'factories'</font> <font color="#339933">=&gt;</font> <font color="#990000">array</font> <font color="#009900">(</font> <br>  RenderingStrategy <font color="#339933">::</font> <font color="#000000">class</font> <font color="#339933">=&gt;</font> <font color="#000000">function</font> <font color="#009900">(</font> <font color="#000088">$ sm</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#009933">/ ** @var ServiceManager $ sm * /</font> <br>  <font color="#b1b100">return</font> <font color="#000000">new</font> RenderingStrategy <font color="#009900">(</font> <font color="#000088">$ sm</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <font color="#339933">, ..</font> <br>  <font color="#009900">)</font> <font color="#339933">,</font> <br>  <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> </blockquote><br>  Well, a little change <i>onBootstrap ()</i> in the application module: <br><blockquote>  <font color="#000088">$ eventManager</font> <font color="#339933">-&gt;</font> <font color="#004000">attach</font> <font color="#009900">(</font> <font color="#0000ff">'render'</font> <font color="#339933">,</font> <font color="#000000">function</font> <font color="#009900">(</font> <font color="#000088">$ e</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#009933">/ ** @var \ Zend \ Mvc \ MvcEvent $ e * /</font> <br>  <font color="#b1b100">return</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">registerRenderingStrategy</font> <font color="#009900">(</font> <font color="#000088">$ e</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <font color="#339933">,</font> <font color="#cc66cc">100</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br>  What else to add?  I decided that it was not worthwhile to save Blitz templates with the .phtml extension, and before the heap I changed the config file: <br><br><blockquote>  <font color="#0000ff">'view_manager'</font> <font color="#339933">=&gt;</font> <font color="#990000">array</font> <font color="#009900">(</font> <br>  <font color="#339933">...</font> <br>  <font color="#0000ff">'default_template_suffix'</font> <font color="#339933">=&gt;</font> <font color="#0000ff">'blitz.html'</font> <font color="#339933">,</font> <br>  <font color="#009900">)</font> <font color="#339933">,</font> </blockquote><br>  Well, I also had to change the controller code a bit where the result of the database sample is transferred to the view: Blitz does not support all these new-fashioned iterators, give it arrays (our grandfathers programmed without iterators, and we will! Really, <a href="https://habrahabr.ru/users/fisher/" class="user_link">fisher</a> ?) , that if you call <i>toArray ()</i> on the <i>ResultSet</i> instance, then it will call the same <i>toArray ()</i> on each row.  I had to supplement the <i>Album</i> model with the <i>toArray ()</i> method.  And, well, I had to translate the templates to Blitz and save it with the suffix "blitz.html". <br><br>  I do not even know how bad this way of integrating the template engine in ZF2.  Maybe professionals know a clever way?  Discuss? </div><p>Source: <a href="https://habr.com/ru/post/268191/">https://habr.com/ru/post/268191/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268179/index.html">The digest of interesting materials for the mobile developer # 123 (September 28 - October 4)</a></li>
<li><a href="../268181/index.html">4 must-have-elements of software testing</a></li>
<li><a href="../268183/index.html">BabylonJS Tutorial - Camera and Lighting</a></li>
<li><a href="../268187/index.html">Accelerate debugging and prototyping of mobile QML applications on a live device</a></li>
<li><a href="../268189/index.html">Silex skeleton + Gulp + LiveReload</a></li>
<li><a href="../268193/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ179 (September 28 - October 4, 2015)</a></li>
<li><a href="../268195/index.html">Blocks. The internal structure of the Cach√© database file. Part 2</a></li>
<li><a href="../268197/index.html">Home server on Intel Atom platform and Centos 7 OS</a></li>
<li><a href="../268199/index.html">Moscow metro map. SVG version</a></li>
<li><a href="../268203/index.html">PHP Digest number 71 - interesting news, materials and tools (September 21 - October 5, 2015)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>