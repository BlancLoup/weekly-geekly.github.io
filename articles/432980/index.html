<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VMware NSX for the smallest. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you look at the configuration of any firewall, then most likely we will see a sheet with a bunch of IP addresses, ports, protocols and subnets. Thi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VMware NSX for the smallest. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/kn/e7/rd/kne7rdjjh4u5enji031kvgh7gzg.jpeg"><br><br>  If you look at the configuration of any firewall, then most likely we will see a sheet with a bunch of IP addresses, ports, protocols and subnets.  This is how classically implemented network security policies for user access to resources.  At first, they try to maintain order in the config, but then employees start to move from department to department, servers multiply and change their roles, access for different projects appears where they usually cannot be, and hundreds of unknown goat trails are obtained. <br><br>  About any rules, if lucky, the comments are spelled out ‚ÄúI asked Vasya to do it‚Äù or ‚ÄúThis is a passage in the DMZ‚Äù.  The network administrator quits and everything becomes completely incomprehensible.  Then someone decided to clean the config from Vasya, and SAP fell, because Vasya once asked for this access for the combat SAP operation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/5l/aa/t8/5laat8oq9-3e7oul-uqjikdo0ly.jpeg"><br><br>  Today I will talk about the solution of VMware NSX, which helps point-to-point apply the policy of network interaction and security without confusion in the firewall configs.  I will show you what new features appeared compared to what VMware used to have in this part. <a name="habracut"></a><br><br>  VMWare NSX is a platform for virtualizing and securing network services.  NSX solves problems of routing, switching, load balancing, firewall and can do many other interesting things. <br><br>  NSX is the successor to its own VMware vCloud Networking and Security (vCNS) product and Nicira NVP purchased. <br><br><h3>  From vCNS to NSX </h3><br>  Previously, a client in a cloud built on VMware vCloud had a separate vCNS vShield Edge virtual machine.  It served as an edge gateway, where you could configure many network functions: NAT, DHCP, Firewall, VPN, load balancer, etc. vShield Edge limited the interaction of the virtual machine with the outside world according to the rules prescribed in Firewall and NAT.  Inside the network, virtual machines communicated freely among themselves within subnets.  If you really want to divide and conquer traffic, you can make a separate network for individual parts of applications (different virtual machines) and write the corresponding rules on the firewall according to their network interaction.  But it is long, difficult and uninteresting, especially when you have several dozen virtual machines. <br><br>  In NSX, VMware implemented the concept of microsegmentation using a distributed firewall (distributed firewall) embedded in the core of the hypervisor.  It contains security and network policies not only for IP and MAC addresses, but also for other objects: virtual machines, applications.  If NSX is deployed within an organization, then a user or group of users from Active Directory can become such objects.  Each such object turns into a microsegment in its security loop, in the required subnet, with its cozy DMZ :). <br><br><img src="https://habrastorage.org/webt/mw/oj/xp/mwojxpk_julswicwpykrb6femt4.png"><br>  <i>Previously, the security perimeter was one for the entire pool of resources, protected by a border switch, and with the NSX you can protect a separate virtual machine from unnecessary interactions even within the same network.</i> <br><br>  Security policies and network interactions are adapted if the object moves to another network.  For example, if we move a machine with a database to another network segment or even to another related virtual data center, the rules prescribed for this virtual machine will continue to operate regardless of its new position.  The application server will still be able to interact with the database. <br><br>  The vCNS vShield Edge border gateway itself has been replaced by the NSX Edge.  He has the whole gentlemanly set of the old Edge plus some new useful features.  About them, and will be discussed further. <br><br><h3>  What's new in NSX Edge? </h3><br>  The functionality of the NSX Edge depends on the <a href="https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/products/nsx/vmware-nsx-compare-editions.pdf">edition of the</a> NSX.  There are five of them: Standard, Professional, Advanced, Enterprise, Plus Remote Branch Office.  All new and interesting can be seen only since Advanced.  Including the new interface, which until the full transition of vCloud to HTML5 (VMware promises the summer of 2019) opens in a new tab. <br><br>  <b>Firewall</b>  You can select IP addresses, networks, gateway interfaces, and virtual machines as objects to which the rules will be applied. <br><br><img src="https://habrastorage.org/webt/6i/d7/nt/6id7ntpl-tdn3vnryzutyducbqy.png"><br><br><img src="https://habrastorage.org/webt/xk/wl/nq/xkwlnq4fatvrzkiptgeqq0b-wva.png"><br><br>  <b>DHCP.</b>  In addition to setting the range of IP addresses that will automatically be issued to the virtual machines of this network, the <b>Binding</b> and <b>Relay</b> functions are now available in NSX Edge. <br><br>  In the <b>Bindings</b> tab, you can bind the MAC address of the virtual machine to the IP address if you want the IP address not to change.  The main thing is that this IP address is not included in the DHCP Pool. <br><br><img src="https://habrastorage.org/webt/f3/2h/nx/f32hnxvra06myg_imqym7dtl4a0.png"><br><br>  In the <b>Relay</b> tab, you can configure the relay of DHCP messages to DHCP servers that are located outside your organization in vCloud Director, including the physical infrastructure DHCP servers. <br><br><img src="https://habrastorage.org/webt/zt/7z/tc/zt7ztchcoikawrby-1a-9ufkum0.png"><br><br>  <b>Routing</b>  With vShield Edge, you could only configure static routing.  This is where dynamic routing appeared, supporting OSPF and BGP protocols.  ECMP (Active-active) settings have also become available, and therefore active-active failover to physical routers. <br><br><img src="https://habrastorage.org/webt/x3/is/vg/x3isvgy5rahk5cgydwxdbxw7oq0.png"><br>  <i>OSPF Setup</i> <br><br><img src="https://habrastorage.org/webt/vx/k8/_m/vxk8_m9l98jke-xmmqdz79hpkug.png"><br>  <i>BGP Setup</i> <br><br>  Another of the new - setting up the transfer of routes between different protocols, <br>  redistribution of routes (route redistribution). <br><br><img src="https://habrastorage.org/webt/4f/mi/jl/4fmijl4ays4ns2ct_uxjeudbqok.png"><br><br>  <b>L4 / L7 Load Balancer.</b>  Appeared X-Forwarded-For for HTTPs header.  Without him, everyone cried.  For example, you have a website that you are balancing.  Without forwarding this header, everything works, but in the web server statistics you did not see the visitors IP, but the balancer IP.  Now everything was right. <br><br>  Also in the Application Rules tab you can now add scripts that will directly control traffic balancing. <br><br><img src="https://habrastorage.org/webt/26/46/fa/2646fa6wdjfpnj9ugnxmvel45ou.png"><br><br>  <b>VPN.</b>  In addition to IPSec VPN, NSX Edge supports: <br><br><ul><li>  L2 VPN, allowing you to stretch the network between geographically separated sites.  Such a VPN is needed, for example, so that when moving to another site, the virtual machine remains on the same subnet and stores the IP address. <br></li></ul><br><img src="https://habrastorage.org/webt/6m/dy/fu/6mdyfu_zrhv2c0bowbae4kqi9fo.png"><br><br><ul><li>  SSL VPN Plus, which allows users to connect remotely to the corporate network.  At the vSphere level, such a function was, but for vCloud Director this is an innovation. <br></li></ul><br><img src="https://habrastorage.org/webt/st/ur/xv/sturxv2qdq626_9yonfrna5owoc.png"><br><br>  <b>SSL certificates.</b>  You can now put certificates on NSX Edge.  This is again to the question of who needed a balancer without a certificate for https. <br><br><img src="https://habrastorage.org/webt/9h/kj/qw/9hkjqwobkgbenpldlqkec8vvunm.png"><br><br>  <b>Grouping Objects.</b>  In this tab, groups of objects are defined for which certain network interaction rules will be applied, for example, firewall rules. <br><br>  These objects can be IP and MAC addresses. <br><br><img src="https://habrastorage.org/webt/_1/lv/w_/_1lvw_i7xubqbbswu3ol2logi8m.png"><br><br><img src="https://habrastorage.org/webt/yf/fr/l-/yffrl-4iz47ue8t1jfp-yhprxbi.png"><br><br>  It also contains a list of services (protocol-port combination) and applications that can be used to compose firewall rules.  New services and applications can be added only by the administrator of the vCD portal. <br><br><img src="https://habrastorage.org/webt/zl/rb/tb/zlrbtbcvwtyvbyomigzkujt-sru.png"><br><br><img src="https://habrastorage.org/webt/jv/qs/yr/jvqsyrklyx1xydrvn4pnptyci5g.png"><br><br>  <b>Statistics.</b>  Connection statistics: traffic that passes through the gateway, firewall and balancer. <br><br>  Status and statistics for each IPSEC VPN and L2 VPN tunnel. <br><br><img src="https://habrastorage.org/webt/d1/z9/j7/d1z9j7kuzq5zlahmptruaws02mg.png"><br><br>  <b>Logging</b>  In the Edge Settings tab, you can set the server for logging.  Logging works for DNAT / SNAT, DHCP, Firewall, routing, balancer, IPsec VPN, SSL VPN Plus. <br><br>  For each object / service the following types of alerts are available: <br><br>  - Debug <br>  - Alert <br>  - Critical <br>  - Error <br>  - Warning <br>  - Notice <br>  - Info <br><br><img src="https://habrastorage.org/webt/qj/rr/by/qjrrby_zyvhjd0mg8mnabc-sfam.png"><br><br><h3>  NSX Edge Sizes </h3><br>  Depending on the tasks and volumes, VMware <a href="https://docs.vmware.com/en/VMware-NSX-Data-Center-for-vSphere/6.3/com.vmware.nsx.install.doc/GUID-311BBB9F-32CC-4633-9F91-26A39296381A.html">recommends</a> creating an NSX Edge of the following sizes: <br><table><tbody><tr><td></td><td>  <b>NSX Edge</b> <b><br></b>  <b>(Compact)</b> <br></td><td>  <b>NSX Edge</b> <b><br></b>  <b>(Large)</b> <br></td><td>  <b>NSX Edge</b> <b><br></b>  <b>(Quad-large)</b> <br></td><td>  <b>NSX Edge</b> <b><br></b>  <b>(X-Large)</b> <br></td></tr><tr><td>  vCPU <br></td><td>  one <br></td><td>  2 <br></td><td>  four <br></td><td>  6 <br></td></tr><tr><td>  Memory <br></td><td>  512MB <br></td><td>  1GB <br></td><td>  1GB <br></td><td>  8GB <br></td></tr><tr><td>  Disk <br></td><td>  512MB <br></td><td>  512MB <br></td><td>  512MB <br></td><td>  4.5GB + 4GB <br></td></tr><tr><td>  Purpose <br></td><td>  One thing <br>  test application <br>  data center <br></td><td>  Small <br>  or average <br>  data center <br></td><td>  Loaded <br>  firewall <br></td><td>  Balancing <br>  L7 load <br></td></tr></tbody></table><br>  The table below shows the working metrics for network services, depending on the size of the NSX Edge. <br><table><tbody><tr><td></td><td>  <b>NSX Edge</b> <b><br></b>  <b>(Compact)</b> <br></td><td>  <b>NSX Edge</b> <b><br></b>  <b>(Large)</b> <br></td><td>  <b>NSX Edge</b> <b><br></b>  <b>(Quad-large)</b> <br></td><td>  <b>NSX Edge</b> <b><br></b>  <b>(X-Large)</b> <br></td></tr><tr><td>  Interfaces <br></td><td>  ten <br></td><td>  ten <br></td><td>  ten <br></td><td>  ten <br></td></tr><tr><td>  Sub Interfaces (Trunk) <br></td><td>  200 <br></td><td>  200 <br></td><td>  200 <br></td><td>  200 <br></td></tr><tr><td>  NAT Rules <br></td><td>  2,048 <br></td><td>  4,096 <br></td><td>  4,096 <br></td><td>  8,192 <br></td></tr><tr><td>  ARP Entries <br>  Until Overwrite <br></td><td>  1,024 <br></td><td>  2,048 <br></td><td>  2,048 <br></td><td>  2,048 <br></td></tr><tr><td>  FW Rules <br></td><td>  2000 <br></td><td>  2000 <br></td><td>  2000 <br></td><td>  2000 <br></td></tr><tr><td>  FW Performance <br></td><td>  3Gbps <br></td><td>  9.7Gbps <br></td><td>  9.7Gbps <br></td><td>  9.7Gbps <br></td></tr><tr><td>  DHCP Pools <br></td><td>  20,000 <br></td><td>  20,000 <br></td><td>  20,000 <br></td><td>  20,000 <br></td></tr><tr><td>  ECMP Paths <br></td><td>  eight <br></td><td>  eight <br></td><td>  eight <br></td><td>  eight <br></td></tr><tr><td>  Static routes <br></td><td>  2,048 <br></td><td>  2,048 <br></td><td>  2,048 <br></td><td>  2,048 <br></td></tr><tr><td>  Lb pools <br></td><td>  64 <br></td><td>  64 <br></td><td>  64 <br></td><td>  1,024 <br></td></tr><tr><td>  LB Virtual Servers <br></td><td>  64 <br></td><td>  64 <br></td><td>  64 <br></td><td>  1,024 <br></td></tr><tr><td>  LB Server / Pool <br></td><td>  32 <br></td><td>  32 <br></td><td>  32 <br></td><td>  32 <br></td></tr><tr><td>  Lb health checks <br></td><td>  320 <br></td><td>  320 <br></td><td>  320 <br></td><td>  3,072 <br></td></tr><tr><td>  LB Application Rules <br></td><td>  4,096 <br></td><td>  4,096 <br></td><td>  4,096 <br></td><td>  4,096 <br></td></tr><tr><td>  L2VPN Clients Hub to Spoke <br></td><td>  five <br></td><td>  five <br></td><td>  five <br></td><td>  five <br></td></tr><tr><td>  L2VPN Networks per Client / Server <br></td><td>  200 <br></td><td>  200 <br></td><td>  200 <br></td><td>  200 <br></td></tr><tr><td>  IPSec Tunnels <br></td><td>  512 <br></td><td>  1,600 <br></td><td>  4,096 <br></td><td>  6,000 <br></td></tr><tr><td>  SSLVPN Tunnels <br></td><td>  50 <br></td><td>  100 <br></td><td>  100 <br></td><td>  1,000 <br></td></tr><tr><td>  SSLVPN Private Networks <br></td><td>  sixteen <br></td><td>  sixteen <br></td><td>  sixteen <br></td><td>  sixteen <br></td></tr><tr><td>  Concurrent session <br></td><td>  64,000 <br></td><td>  1,000,000 <br></td><td>  1,000,000 <br></td><td>  1,000,000 <br></td></tr><tr><td>  Sessions / Second <br></td><td>  8,000 <br></td><td>  50,000 <br></td><td>  50,000 <br></td><td>  50,000 <br></td></tr><tr><td>  LB Throughput L7 Proxy) <br></td><td></td><td>  2.2Gbps <br></td><td>  2.2Gbps <br></td><td>  3Gbps <br></td></tr><tr><td>  LB Throughput L4 Mode) <br></td><td></td><td>  6Gbps <br></td><td>  6Gbps <br></td><td>  6Gbps <br></td></tr><tr><td>  LB Connections / s (L7 Proxy) <br></td><td></td><td>  46,000 <br></td><td>  50,000 <br></td><td>  50,000 <br></td></tr><tr><td>  LB Concurrent Connections (L7 Proxy) <br></td><td></td><td>  8,000 <br></td><td>  60,000 <br></td><td>  60,000 <br></td></tr><tr><td>  LB Connections / s (L4 Mode) <br></td><td></td><td>  50,000 <br></td><td>  50,000 <br></td><td>  50,000 <br></td></tr><tr><td>  LB Concurrent Connections (L4 Mode) <br></td><td></td><td>  600,000 <br></td><td>  1,000,000 <br></td><td>  1,000,000 <br></td></tr><tr><td>  BGP Routes <br></td><td>  20,000 <br></td><td>  50,000 <br></td><td>  250,000 <br></td><td>  250,000 <br></td></tr><tr><td>  BGP Neighbors <br></td><td>  ten <br></td><td>  20 <br></td><td>  100 <br></td><td>  100 <br></td></tr><tr><td>  BGP Routes Redistributed <br></td><td>  No limit <br></td><td>  No limit <br></td><td>  No limit <br></td><td>  No limit <br></td></tr><tr><td>  OSPF Routes <br></td><td>  20,000 <br></td><td>  50,000 <br></td><td>  100,000 <br></td><td>  100,000 <br></td></tr><tr><td>  OSPF LSA Entries Max 750 Type-1 <br></td><td>  20,000 <br></td><td>  50,000 <br></td><td>  100,000 <br></td><td>  100,000 <br></td></tr><tr><td>  OSPF Adjacencies <br></td><td>  ten <br></td><td>  20 <br></td><td>  40 <br></td><td>  40 <br></td></tr><tr><td>  OSPF Routes Redistributed <br></td><td>  2000 <br></td><td>  5000 <br></td><td>  20,000 <br></td><td>  20,000 <br></td></tr><tr><td>  Total routes <br></td><td>  20,000 <br></td><td>  50,000 <br></td><td>  250,000 <br></td><td>  250,000 <br></td></tr></tbody></table>  ‚Üí <a href="https://anthonyspiteri.net/nsx-bytes-updated-nsx-edge-feature-and-performance-matrix-2/"><i>Source</i></a> <br><br>  From the table it can be seen that balancing on NSX Edge for productive scenarios is recommended to be organized only from the size Large. <br><br>  Today I have everything.  In the following sections, I‚Äôll go through the details of configuring each NSX Edge network service. </div><p>Source: <a href="https://habr.com/ru/post/432980/">https://habr.com/ru/post/432980/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432966/index.html">Encryption downloader for STM32</a></li>
<li><a href="../432968/index.html">6 typical problems in implementing a project management solution</a></li>
<li><a href="../432972/index.html">Source: "Conway's Law"</a></li>
<li><a href="../432976/index.html">Anonymous Father Frost 2018-2019: post boasting New Year's gifts</a></li>
<li><a href="../432978/index.html">John Romero: reflection on DOOM</a></li>
<li><a href="../432982/index.html">The shortest introduction to compiler creation</a></li>
<li><a href="../432984/index.html">Machine learning with Node.js using the Tensorflow.js library</a></li>
<li><a href="../432986/index.html">C vs Go cycles and simple math</a></li>
<li><a href="../432988/index.html">Eighth Webmaster. Live on Habr√©</a></li>
<li><a href="../432990/index.html">Edison Wooden Lamp with voice control. Issue price of $ 5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>