<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to fix errors in google maps javascript api 3 mobile</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I met a serious problem when placing maps on Google Maps on the site, namely, not displaying / not fully displaying the map after loading the page, I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to fix errors in google maps javascript api 3 mobile</h1><div class="post__text post__text-html js-mediator-article">  I met a serious problem when placing maps on Google Maps on the site, namely, not displaying / not fully displaying the map after loading the page, I noticed that there are many such topics and very few answers, and if you are a fan of searching answers somewhere in the outback forums, below I will give a few options for solving these problems with the initialization code, so sit back with popcorn and start reading <a name="habracut"></a><br><br><pre><code class="hljs lua">//google maps Api $(<span class="hljs-string"><span class="hljs-string">"#companyform_showonmap_page"</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ var geocoder; var map; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { geocoder = new google.maps.Geocoder(); var latlng = new google.maps.LatLng(<span class="hljs-number"><span class="hljs-number">-34.397</span></span>, <span class="hljs-number"><span class="hljs-number">150.644</span></span>); var myOptions = { zoom: <span class="hljs-number"><span class="hljs-number">17</span></span>, center: latlng, mapTypeId: google.maps.MapTypeId.ROADMAP, timeout: <span class="hljs-number"><span class="hljs-number">6000</span></span>, maximumAge: <span class="hljs-number"><span class="hljs-number">50000</span></span>, enableHighAccuracy:<span class="hljs-literal"><span class="hljs-literal">true</span></span> } map = new google.maps.Map(document.getElementById(<span class="hljs-string"><span class="hljs-string">"map_canvas"</span></span>), myOptions); } /* <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((company.getcompanygpslalo(gpslalo)!=<span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; (company.getcompanygpslalo(gpslalo)!= null)){ map.setCenter(company.getcompanygpslalo(gpslalo)); // console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(results[<span class="hljs-number"><span class="hljs-number">0</span></span>].geometry.location.Ua);     // console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(results[<span class="hljs-number"><span class="hljs-number">0</span></span>].geometry.location.Va); var marker = new google.maps.Marker({ map: map, position: company.getcompanygpslalo(gpslalo) }); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{*/ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">codeAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { var address = document.getElementById(<span class="hljs-string"><span class="hljs-string">"address"</span></span>).value; var gps = company.getgpslalo(); //          geocoder.geocode( { <span class="hljs-string"><span class="hljs-string">'address'</span></span>: $(<span class="hljs-string"><span class="hljs-string">"#companyform_gpscoords"</span></span>).val()}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(results, status)</span></span></span></span> { //        adress    JSON   console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(company.getgpslalo(gps)); console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(gps.la); console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(gps.lo); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((gps.la)&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp;(gps.la)&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { map.setCenter(new google.maps.LatLng((gps.la),(gps.lo))); pos = new google.maps.LatLng((gps.la),(gps.lo)); // console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(results[<span class="hljs-number"><span class="hljs-number">0</span></span>].geometry.location.Ua);      // console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(results[<span class="hljs-number"><span class="hljs-number">0</span></span>].geometry.location.Va); var marker = new google.maps.Marker({ map: map, position: pos }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //             <span class="hljs-built_in"><span class="hljs-built_in">input</span></span><span class="hljs-string"><span class="hljs-string">' address if (status == google.maps.GeocoderStatus.OK) { map.setCenter(results[0].geometry.location); // console.log(results[0].geometry.location.Ua);      // console.log(results[0].geometry.location.Va); var marker = new google.maps.Marker({ map: map, position: results[0].geometry.location }); } else { alert("      : " + status); } //company.getcompanycoordinats(results[0].geometry.location.Ua,results[0].geometry.location.Va);      } }); } function loadScript() { var script = document.createElement("script"); script.type = "text/javascript"; script.src = "http://maps.google.com/maps/api/js?sensor=true&amp;callback;=initialize"; document.body.appendChild(script); } window.onload = loadScript; $.mobile.changePage("#companyform_showonmap_page"); window.onload = initialize(); window.onload = codeAddress(); });</span></span></code> </pre> <br><br>  All secret in function loadScript () and also in window.onload which need to be placed FOR $ .mobile.changePage.  new google.maps.LatLng - we don‚Äôt forget to write this way, because otherwise Google will not understand what you want from it (changes for working with javascript google api v3).  As you noticed, I wrote window.onload 2 times, although the function should be executed 1 time, but when working with Google maps for some reason, 2 times window.onload saved me, I don‚Äôt know what it is, but it works! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      One more thing, I don‚Äôt know why, but when determining the size of the div ªa in%, the correct display is also not correct, the solution to this problem is very trivial and simple <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map_canvas"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width: 100%; height: 500px; position:center;"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Where map_canvas is the container in which our map is displayed. <br><br>  The next problem is related to Google's geolocation, the same problem, drawing a map, below I give a complete example with the solution. <br><br><pre> <code class="hljs pgsql"> $( "#map-page" ).live( "pageshow", <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() var defaultLatLng = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> google.maps.LatLng(<span class="hljs-number"><span class="hljs-number">37.530073</span></span>, <span class="hljs-number"><span class="hljs-number">15.112151</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( navigator.geolocation ) { <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> success(pos) { // <span class="hljs-keyword"><span class="hljs-keyword">Location</span></span> <span class="hljs-built_in"><span class="hljs-built_in">found</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> coordinates <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> map drawMap(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> google.maps.LatLng(pos.coords.latitude, pos.coords.longitude)); } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> fail() { drawMap(defaultLatLng); // <span class="hljs-keyword"><span class="hljs-keyword">Show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> map } // Find users <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> position navigator.geolocation.getCurrentPosition(success, fail, {enableHighAccuracy:<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, timeout: <span class="hljs-number"><span class="hljs-number">6000</span></span>, maximumAge: <span class="hljs-number"><span class="hljs-number">50000</span></span> }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { drawMap(defaultLatLng); // <span class="hljs-keyword"><span class="hljs-keyword">No</span></span> geolocation support } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> drawMap(latlng) { var myOptions = { zoom: <span class="hljs-number"><span class="hljs-number">17</span></span>, center: latlng, zoomControl: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, scaleControl: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, mapTypeId: google.maps.MapTypeId.ROADMAP } var map = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> google.maps.Map( document.getElementById("map-canvas"), myOptions); // <span class="hljs-keyword"><span class="hljs-keyword">Add</span></span> an overlay <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the map <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> lat/lng var marker = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> google.maps.Marker({ position: latlng, map: map, title: "  !" }); } });</code> </pre><br><br>  The solution to this problem in these lines <br><pre> <code class="hljs css">{<span class="hljs-attribute"><span class="hljs-attribute">enableHighAccuracy</span></span>:true, timeout: <span class="hljs-number"><span class="hljs-number">6000</span></span>, maximumAge: <span class="hljs-number"><span class="hljs-number">50000</span></span> }</code> </pre> <br>  and again you cannot set the height of the div `where the map will be displayed in%. <br><br>  These are recommendations that helped to configure the same display on both tablet / mobile and stationary devices.  Although off.  The Javascript google API 3 documentation has all the examples written in size in%, but in reality it‚Äôs a headache. <br><br>  Another problem I did not find a solution to is the display of controls, they disappear on some cards, while others are displayed normally, all the difference is in the pages, the code is the same, and I haven‚Äôt found a bug yet. <br><br>  The boss suggested an interesting solution, in practice it helped, the code below <br><br><pre> <code class="hljs pgsql">// Jquery      ,      $.getDocHeight = <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Math.max( $(document).height(), $(<span class="hljs-keyword"><span class="hljs-keyword">window</span></span>).height(), <span class="hljs-comment"><span class="hljs-comment">/* For opera: */</span></span> document.documentElement.clientHeight ); }; //alert( $.getDocHeight() ); $(".googlemap").height($.getDocHeight()<span class="hljs-number"><span class="hljs-number">-10</span></span>); //  googlemap      $(".googlemap").width("98%");//     googlemap` </code> </pre><br><br>  and block cards with a mandatory class <br><pre> <code class="hljs javascript">&lt;div id=<span class="hljs-string"><span class="hljs-string">"map_canvas"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"googlemap"</span></span> style=<span class="hljs-string"><span class="hljs-string">"position:center"</span></span> &gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><br>  I hope these tips will help readers quickly cope with the problems of displaying Google maps on mobile and on conventional devices. </div><p>Source: <a href="https://habr.com/ru/post/140705/">https://habr.com/ru/post/140705/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140700/index.html">Review of new features in playframework v2</a></li>
<li><a href="../140701/index.html">Authorization on the site through Mail.ru (oAuth 2.0)</a></li>
<li><a href="../140702/index.html">Ruby on Rails I18n: developer - develops, client - fills. The rest will be taken care of by the service.</a></li>
<li><a href="../140703/index.html">In search of a convenient power source, an overview of an external 6000mAh battery</a></li>
<li><a href="../140704/index.html">Creating Instagram Filters with PHP and ImageMagick</a></li>
<li><a href="../140706/index.html">Happy childhood with ZD-printer</a></li>
<li><a href="../140707/index.html">Conference Report # MBLT12</a></li>
<li><a href="../140708/index.html">Cloud - what is it and why?</a></li>
<li><a href="../140709/index.html">Distributions, updates and errata for Oracle Linux are now available for free</a></li>
<li><a href="../140710/index.html">Where would you get the first large round of investment for your startup? Comment!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>