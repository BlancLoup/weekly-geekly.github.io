<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Framework for web applications built on CodeIgniter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Surely, many web programmers have studied and, perhaps, even used such a wonderful framework as CodeIgniter . I chose him because he has the lowest th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Framework for web applications built on CodeIgniter</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage1/304c7bf6/6b0bfcd1/937e563e/7e08a2e4.jpg" alt="image"><br>  Surely, many web programmers have studied and, perhaps, even used such a wonderful framework as <i>CodeIgniter</i> .  I chose him because he has the lowest threshold of entry, he is the most simple to learn, good documentation, fast, etc.  etc.  For simple projects, the most ‚Äúit‚Äù is to try your hand exactly as a developer.  Of course, for more serious projects it is better to use more functional and feature-rich frameworks. <br><br>  Further I will describe how I ‚Äúupgrade‚Äù <i>CodeIgnite</i> r to use this framework for different projects, since  its basic functionality and examples from the documentation, to put it mildly, are very simple, but in life everything is much more complicated.  So let's start with. <br><a name="habracut"></a><br>  Before reading it is highly recommended to familiarize yourself with the official <i>CodeIgniter</i> documentation, since  The article assumes that at least you have read the main topics and the theme ‚Äú <i>Template Parser Class</i> ‚Äù and have completed these examples. <br>  The first thing that is very inconvenient in the basic configuration is the separation of controllers, models and mappings into different folders without the possibility of combining any module into one folder.  Those.  if you want to write, for example, the ‚Äú <i>News</i> ‚Äù module, which displays news, your module will crawl into three different folders <i>controllers, models, views</i> .  And soon it will be unclear which controller belongs to which model and which ‚Äúviews‚Äù.  It is good if you have one such module.  And if there are more than 10, then it becomes very difficult to control. <br><img src="https://habrastorage.org/storage1/bc90ba97/2ebf6ddc/ff1031e7/b404f15d.jpg"><br>  Yes, you can create subfolders inside folders (controllers, models, views) (for example, <i>news, menu, comments</i> ) and throw our controllers, models and views there, as the documentation says, but it seems to me that this is still inconvenient. <br>  It would be much more convenient if we had the <i>modules</i> folder, and in it we created our <i>News</i> module, i.e.  folder, and inside it already 3 folders (counter-s, models, views).  This functionality provides us with a <i>HMVC</i> extension for <i>CodeIgniter</i> .  Download and read the installation instructions at this <a href="https://bitbucket.org/wiredesignz/codeigniter-modular-extensions-hmvc/wiki/Home">link</a> . <br><br>  This extension will allow us to locate our models, controllers, views related only to this module inside each module.  It is also possible to create subfolders inside the model, counter-ops or view folders inside these modules, which is very convenient for large modules that have many files. <br><img src="https://habrastorage.org/storage1/6557081f/bdb96f0f/03af16d1/d2b41c51.jpg"><br>  Moreover, it allows us to load several controllers or models from different modules and build a structure that is convenient for us (or run a controller from another model, etc. from one model). <br>  In this, of course, I did not discover anything new.  Therefore, we go further. <br>  The basic CI URL is resolved as follows: <br>  example.com/ <i>class / function / ID</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Those.  the first segment is the controller being called (class), the second is the function in it, the third is the parameter passed to the function (maybe the fourth and fifth).  Honestly, even for an average project this is very inconvenient, so I decided to build my own URL processing logic, which gives me complete freedom of action.  To do this, edit the routes.php file in the application / config folder and write to it: <br><pre><code class="php hljs">$route[<span class="hljs-string"><span class="hljs-string">'default_controller'</span></span>] = <span class="hljs-string"><span class="hljs-string">"main"</span></span>; $route[<span class="hljs-string"><span class="hljs-string">':any'</span></span>] = <span class="hljs-string"><span class="hljs-string">"main"</span></span>;</code> </pre> <br>  This shows that in any case the main controller will be loaded and the function <b>index ()</b> will be launched.  Next, create a file in the <i>application / controllers</i> folder and call it ‚Äú <i>main.php</i> ‚Äù.  Do not forget that we have installed the HMVC extension, so our controllers will now be inherited not from <i>CI_Controller</i> , but from <i>MX_Controller</i> .  This controller will be the main one, and everything will pass through it.  At the same time, it will be very simple and will simply transfer control to other modules.  This is what the function <b>index ()</b> looks like for me: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ session_start(); <span class="hljs-comment"><span class="hljs-comment">//   ,   CI  $this-&gt;check_lang(); //     $this-&gt;check_module(); //     $this-&gt;tp-&gt;load_tpl($this-&gt;tp-&gt;tpl); //       $this-&gt;tp-&gt;print_page(); //        }</span></span></code> </pre><br>  We will not touch the last two lines from the class ‚Äútp‚Äù.  Basic CI does not use PHP sessions, and instead saves data in Cookies (plunging newbies into misleading by calling its Session library, although it works with Cookies).  I nevertheless decided to use native PHP sessions, although I did not completely abandon the functionality offered by CI to work with cookies (I use this and that). <br><br>  So, the first thing I do is check for the language (my projects are often multilingual). <br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_lang</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($s=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;uri-&gt;segment(<span class="hljs-number"><span class="hljs-number">1</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($s) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'ru'</span></span>: define(<span class="hljs-string"><span class="hljs-string">'LANG'</span></span>,<span class="hljs-string"><span class="hljs-string">'ru'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'en'</span></span>: define(<span class="hljs-string"><span class="hljs-string">'LANG'</span></span>,<span class="hljs-string"><span class="hljs-string">'en'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config-&gt;set_item(<span class="hljs-string"><span class="hljs-string">'language'</span></span>, <span class="hljs-string"><span class="hljs-string">'english'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: show_404(<span class="hljs-string"><span class="hljs-string">'page'</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { define(<span class="hljs-string"><span class="hljs-string">'LANG'</span></span>,<span class="hljs-string"><span class="hljs-string">'ru'</span></span>); } }</code> </pre><br>  It can be seen that the first segment in the URL will be responsible for the language.  In the file <i>application / config / config.php,</i> specify: <br><pre> <code class="php hljs">$config[<span class="hljs-string"><span class="hljs-string">'language'</span></span>] = <span class="hljs-string"><span class="hljs-string">'russian'</span></span>;</code> </pre><br>  To change the configuration language from the controller, use this <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config-&gt;set_item(<span class="hljs-string"><span class="hljs-string">'language'</span></span>, <span class="hljs-string"><span class="hljs-string">'english'</span></span>);</code> </pre><br>  If you are not using multilanguage, just skip this. <br><br>  The <b>check_module ()</b> function should check the second segment of the URL (or the first if you do not use multilanguage) on whether it is a valid module, i.e.  I prescribe the allowed modules in the constructor, for example, like this: <br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modules=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'auth'</span></span>,<span class="hljs-string"><span class="hljs-string">'cabinet'</span></span>,<span class="hljs-string"><span class="hljs-string">'ads'</span></span>,<span class="hljs-string"><span class="hljs-string">'root'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   }</span></span></code> </pre><br>  Then in the function I check: <br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_module</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($m=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;uri-&gt;segment(<span class="hljs-number"><span class="hljs-number">2</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array($m,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;modules)) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;common-&gt;load_module($m); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tp-&gt;tpl=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;$m-&gt;tpl; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { show_404(<span class="hljs-string"><span class="hljs-string">'page'</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;load_main_page(); <span class="hljs-comment"><span class="hljs-comment">//    ,     } }</span></span></code> </pre><br>  Thus, if the second segment is empty, then the main page is loaded.  If the URL contains a valid module, then it loads, if not, then it throws it to 404. Next, I create 2 models of <i>tp.php</i> and <i>common.php</i> in the <i>application / models</i> folder, which will be available everywhere for me (I write them in the <i>application / config</i> autoloader <i>/autoload.php</i> ): <br><pre> <code class="php hljs">$autoload[<span class="hljs-string"><span class="hljs-string">'model'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'tp'</span></span>,<span class="hljs-string"><span class="hljs-string">'common'</span></span>);</code> </pre><br>  In <i>tp</i> , the functions for the operation of my simple template that will expand the capabilities of a very weak native will be described.  In " <i>common</i> " I write all the other functions that will be used frequently. <br>  Thus, <b>$ this-&gt; common-&gt; load_module ($ m)</b> will load the <i>$ m</i> module (the second segment from the URL) and the <b>index ()</b> function in it.  Everything is simple here: <br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_module</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($module)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_dir(<span class="hljs-string"><span class="hljs-string">'application/modules/'</span></span>.$module)) <span class="hljs-comment"><span class="hljs-comment">// ,    { $this-&gt;load-&gt;module($module); $this-&gt;$module-&gt;index(); } }</span></span></code> </pre><br>  Each module loaded from a URL must use some template of the whole page, for example, such <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/html4/strict.dtd"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>{page_title}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{SITEURL}/css/main.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"page"</span></span></span><span class="hljs-tag">&gt;</span></span> {HEADER} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"content"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"page_title"</span></span></span><span class="hljs-tag">&gt;</span></span> {title_of_page} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"needwidth"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rightside"</span></span></span><span class="hljs-tag">&gt;</span></span> {LOOKED_ADS} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sam_kontent"</span></span></span><span class="hljs-tag">&gt;</span></span> {MSG} {CONTENT} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clear"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> {FOOTER} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The main templates for the entire page are created in the <i>application / views / templates</i> folder (the <i>templates</i> folder is created manually).  Different modules can use the same templates. <br>  The module controller frame itself looks like this: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">News</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MX_Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $mname; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $tpl; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tpl=<span class="hljs-string"><span class="hljs-string">'p_default.tpl'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   $this-&gt;mname=strtolower(get_class());//   } public function index() { //    ,    .. $this-&gt;tp-&gt;parse('CONTENT', $this-&gt;mname.'/'.$this-&gt;mname.'.tpl'); } }</span></span></code> </pre><br>  In our <i>News</i> module we create 3 folders - <i>controllers, models, views</i> .  In the <i>controllers</i> folder, create the <i>news.php</i> file and write the code described above into it.  In the function <b>index () we</b> build our logic.  For example, I ship the model news_model.php there, located in the models folder of the news module.  Already in the model I describe functions for working with the database or other complex functions associated with this module. <br><br>  In the end, the entire result obtained from the news module is written to the <i>CONTENT</i> label, which is replaced in the template with this result.  To understand how this happens, you need to tell how I built the logic of my "template engine". <br>  I just expanded the capabilities of the base ‚ÄúParser‚Äù and brought it into the ‚Äúhuman species‚Äù.  If you don‚Äôt know how the base works, first understand it better. <br><br>  So, consider the ‚Äú <i>tp</i> ‚Äù model. <br><br>  There are 2 <i>public</i> variables - <i>$ D</i> , <i>$ tpl</i> .  <i>$ D</i> is our global array, which in the end will replace in the template all labels of the form {LABEL} with the contents of <i>$ this-&gt; D ['LABEL']</i> , worked in modules.  $ tpl is the main master template of the entire page, which is written in each module from the URL and is then transmitted to the main controller, where <b>$ this-&gt; tp-&gt; load_tpl ($ this-&gt; tp-&gt; tpl) is</b> called. <br><br>  We have already seen the <b>parse ()</b> function above.  Two parameters must be passed to this function, the first is the label to which the result will be saved (html chunk), the second is this html chunk located in the <i>views</i> folder.  But <b>parse ()</b> will check this html for the presence of tags in it and work them out, if necessary: <br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($label, $tpl)</span></span></span><span class="hljs-function"> </span></span>{ $TPL=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;load-&gt;view($tpl, <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>); $pattern = <span class="hljs-string"><span class="hljs-string">'/{[A-Za-z0-9_]+}/'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      preg_match_all($pattern, $TPL, $MODULES); //     foreach ($MODULES[0] as $MODULE) { $module=substr($MODULE,1,-1); if (!isset($this-&gt;D[$module])) $this-&gt;D[$module]=$this-&gt;lang-&gt;line($module); //    ,    langs } if (isset($this-&gt;D[$label])) { $this-&gt;D[$label].=$this-&gt;parser-&gt;parse($tpl, $this-&gt;D, TRUE); } else { $this-&gt;D[$label]=$this-&gt;parser-&gt;parse($tpl, $this-&gt;D, TRUE); } }</span></span></code> </pre><br>  From all this it should be clear that if you create a <i>news.tpl</i> file inside the news module in the views folder and write the simplest html there, for example <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>  !<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Then run <i>example.com/ru/news</i> , then the main controller <i>main.php</i> will <i>start</i> , which will transfer control to the <i>news</i> module, the template <i>p_default.tpl will be loaded there</i> (from the code above). <br><br>  Then the <i>news</i> module controller replaces {CONTENT} with the contents of the <i>application / modules / news / views / news.tpl file</i> and displays the contents of the <i>p_default.tpl</i> template. <br>  But ... this is still theoretically, because we have not described the functions <b>$ this-&gt; tp-&gt; load_tpl ($ this-&gt; tp-&gt; tpl)</b> and <b>$ this-&gt; tp-&gt; print_page ()</b> . <br><br>  The <b>load_tpl ()</b> function accepts a template as a parameter, which is the main one, i.e.  template for the entire page (in the <i>views / templates</i> folder).  Then this template is checked for other labels, which can be either modules or just variables (such as title or copyright). <br>  Labels in uppercase and with numbers are modules, in lowercase are simple variables.  If a replacement tag is not found, they are simply overwritten (deleted).  Here is the code itself: <br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_tpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($tpl_name)</span></span></span><span class="hljs-function"> </span></span>{ $TPL=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;load-&gt;view(<span class="hljs-string"><span class="hljs-string">'templates/'</span></span>.$tpl_name, <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span>); $pattern = <span class="hljs-string"><span class="hljs-string">'/{[A-Z0-9_]+}/'</span></span>; $pattern2 = <span class="hljs-string"><span class="hljs-string">'/{[a-z_]+}/'</span></span>; preg_match_all($pattern, $TPL, $MODULES); <span class="hljs-comment"><span class="hljs-comment">//   preg_match_all($pattern2, $TPL, $VALUES); //   foreach ($MODULES[0] as $MODULE) { $module=substr($MODULE,1,-1); if (!isset($this-&gt;D[$module])) { $this-&gt;D[$module]=''; $this-&gt;common-&gt;load_module(strtolower($module)); } } foreach ($VALUES[0] as $VALUE) { $value=substr($VALUE,1,-1); if (!isset($this-&gt;D[$value])) { $this-&gt;D[$value]=''; } } $this-&gt;D['TPL']=$tpl_name; }</span></span></code> </pre><br>  At the end of our main controller, the <i>main</i> function is the <b>print_page ()</b> function, which should display the worked template on the screen: <br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print_page</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;parser-&gt;parse(<span class="hljs-string"><span class="hljs-string">'templates/'</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;D[<span class="hljs-string"><span class="hljs-string">'TPL'</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;D); }</code> </pre><br><br>  All of the above, I tried to simplify as much as possible.  In fact, everything is much more complicated and wider for me, but you can do this yourself (because and this, perhaps, not everyone read to the end).  In the <i>tp</i> model I still have a bunch of all functions for the template engine, for example: <br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($label)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;D[$label]=<span class="hljs-string"><span class="hljs-string">''</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($label)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;D[$label]); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assign</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($label, $value=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($label)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($label <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $l=&gt;$v) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;D[$l]=$v; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;D[$label]=$value; }</code> </pre><br>  Understanding their logic is easy.  Using <i>$ this-&gt; tp-&gt; assign ('page_title', 'Home Page')</i> , for example, you can simply replace {page_title} with a ‚ÄúHome Page‚Äù in the template. <br><br>  Inside the templates there can also be modules that can display something, for example, the latest news or menu.  In the template, they are inserted inside curly brackets, for example, {MENU} or {HEADER}.  The parse () function, having encountered such a label, will check whether this label is a module, and if so, replace it with what the module will issue.  Such modules are also located inside the modules folder and have their own MVC. <br>  The main controller of the <i>header</i> module, for example, looks like this: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Header</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MX_Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $mname, $tag; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;mname=strtolower(get_class());<span class="hljs-comment"><span class="hljs-comment">//   $this-&gt;tag=strtoupper($this-&gt;mname); // ¬´¬ª   } public function index() { $this-&gt;load-&gt;model($this-&gt;mname.'/'.$this-&gt;mname.'_model'); $model=$this-&gt;mname.'_model'; $this-&gt;$model-&gt;index($this-&gt;mname); $this-&gt;tp-&gt;parse($this-&gt;tag, $this-&gt;mname.'/'.$this-&gt;mname.'.tpl'); } }</span></span></code> </pre><br>  The last function <b>$ this-&gt; tp-&gt; parse ($ this-&gt; tag, $ this-&gt; mname. '/'. $ This-&gt; mname. '. Tpl')</b> will replace {HEADER} with the contents of the <i>modules / header / views</i> file <i>/header.tpl</i> <br><br>  It should be noted that the module that runs from the URL and is the main one is always the first to work, then the template is loaded and parse () works through all the modules inside it. <br>  For clarity, everything described above is depicted in the picture. <br><br><img src="https://habrastorage.org/storage1/67c25936/cbc8f467/604532a8/c871e89a.jpg"><br><br>  I beg your pardon for the primitive graphics, I'm still a programmer, not a designer. <br><br>  If you are too lazy to write all this manually, you can download CodeIgniter with my minor modifications and dig out there (link below).  I deliberately cut out almost all of my functions, modules, models and everything else, limiting myself only to those described in the article, so that you could try to expand the functionality yourself and not be distracted by everything else. <br><br>  Of course, it was possible to add a lot more, but the article was so long. <br><br>  I will be glad to hear the criticism of professionals. <br><br>  My revised CodeIgniter can be downloaded <a href="">from here</a> . <br><br>  <b>UPDATE 10/15/2011</b> <br>  Registered on <a href="http://github.com/">github.com</a> and added to the repository.  I hope I did everything right.  Here is the link <a href="https://github.com/IbrahimKZ/codeigniter">https://github.com/IbrahimKZ/codeigniter</a> </div><p>Source: <a href="https://habr.com/ru/post/130387/">https://habr.com/ru/post/130387/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130380/index.html">200 million users already work with Google Chrome</a></li>
<li><a href="../130382/index.html">Trying free spice virtualization in Ubuntu 11.04 amd64</a></li>
<li><a href="../130383/index.html">Realistic flight simulator with a 360 degree view</a></li>
<li><a href="../130384/index.html">Camera Angle Control</a></li>
<li><a href="../130386/index.html">The Google + user base has exceeded 40 million and continues to grow - the official statistics from Google CEO!</a></li>
<li><a href="../130389/index.html">Common truths</a></li>
<li><a href="../130391/index.html">Easy PERL script for sending and receiving SMS via mobile phone</a></li>
<li><a href="../130393/index.html">Clearing the cache in iOS 5</a></li>
<li><a href="../130395/index.html">Mobile application developer brief: 15 key questions to ask the client</a></li>
<li><a href="../130396/index.html">Writing a module for Ejabberd</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>