<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Resolve IP addresses in Linux: a clear and detailed description</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Setting up the network interaction of services is not the easiest task and is often carried out without a deep understanding of how to configure the s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Resolve IP addresses in Linux: a clear and detailed description</h1><div class="post__text post__text-html js-mediator-article"><p> Setting up the network interaction of services is not the easiest task and is often carried out without a deep understanding of how to configure the system and what settings are affected.  After migrating services to docker containers from centos 6 to centos 7, I ran into a strange web server behavior: he tried to join the IPv6 service, and the service only listened to the IPv4 address.  The standard tip in this situation is to disable IPv6 support.  But this will not help in some cases.  What kind?  In this article, I set out to collect and explain in detail how applications <code>resolve</code> address addresses. </p><a name="habracut"></a><br><p>  The publication will be useful for beginners administrators and developers. </p><br><blockquote>  After reading this article, you will learn: <br><br><ul><li>  What is the Linux algorithm for resolving hostnames? </li><li>  how to override the hostname definition logic; </li><li>  what functions and libraries are used by the OS; </li><li>  what traps exist when configuring and how to prevent them; </li></ul><br></blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dc/1i/rc/dc1irc-coni4ebvplvv79g-gafy.png"></div><br><p>  The Linux operating system has several sources for determining the hostname address.  All the necessary functionality for determining is in the <a href="https://www.gnu.org/software/libc/">GNU C Library (glibc)</a> .  glibc is essentially a framework and implements many useful functions for the developer, providing its own API to simplify development.  Among other things, glibc implements <a href="http://pubs.opengroup.org/onlinepubs/9699919799/">POSIX</a> .  Functions such as <code>open</code> , <code>read</code> , <code>write</code> , <code>malloc</code> , <code>printf</code> , <code>getaddrinfo</code> , <code>dlopen</code> , <code>pthread_create</code> , <code>crypt</code> , <code>login</code> , <code>exit</code> for Linux systems are provided by glibc. </p><br><p>  <code>host</code> , <code>dig</code> and <code>nslookup</code> utilities known to many use glibc, but are shipped separately. </p><br><p>  Now that the developer has the ability to call the <code>getaddrinfo</code> family <code>getaddrinfo</code> from glibc to determine the address, there is a need to configure the return values.  For example, whether to use <code>/etc/hosts</code> or a query to the DNS server.  In glibc, this configuration is done using a scheme called <em>Name Service Switch</em> (NSS). </p><br><p>  If explained on the fingers, the NSS allows you to specify the database and the sequence of search in these databases to provide the service.  In our case, the service is a search by hostname, and the database can be <code>/etc/hosts</code> or DNS server.  This is not the only service configured by NSS, alias mail services, a user and group search service are provided.  You can see the list <a href="https://www.gnu.org/software/libc/manual/html_node/NSS-Basics.html">in the manual</a> . </p><br><p>  Thanks to NSS, it is possible, without reassembling applications, in runtime, to configure the mentioned databases.  It is configured in the <code>/etc/nsswitch.conf</code> file.  Below is an example of a config from standard / <code>/etc/nsswitch.conf</code> in Centos 7. </p><br><pre> <code class="hljs perl">$ <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> ^hosts /etc/nsswitch.conf hosts: files dns myhostname</code> </pre> <br><p>  <strong>files</strong> , <strong>dns</strong> and <strong>myhostname</strong> are database aliases for search.  <strong>files</strong> on most systems imply the use of <code>/etc/hosts</code> , the <strong>dns</strong> base is the DNS server to which the hostname search query will be made, and <strong>myhostname</strong> is the most unusual base that few people know about and it is not part of the standard delivery in glibc.  In some distributions there is also the <strong>mdns4_minimal</strong> base.  The following text provides a review of these databases. </p><br><p>  The databases are used in the order in which they are declared in <code>/etc/nsswitch.conf</code> and if an entry is found in the current database, then the output from the chain and the result are returned.  In the absence of a result, a transition to the next base in the list occurs.  If no result is found in any database, then such a response is given to the glibc request for the <code>getaddrinfo</code> function.  The behavior of the transition to the next base and the conditions of such a transition can be further configured, for example, when DNS is unavailable (not to be confused with the absence of a record) to complete the chain.  A clear and simple explanation of how to configure the conditions for <code>/etc/nsswitch.conf</code> given <a href="http://searchitchannel.techtarget.com/feature/Using-nsswitchconf-to-find-Linux-system-information">in this article</a> . </p><br><p>  The base <strong>files</strong> , and in particular <code>/etc/hosts</code> , out of the box in Centos 7 looks like this: </p><br><pre> <code class="hljs ruby">$ cat /etc/hosts <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> localhost localhost.localdomain localhost4 localhost4.localdomain4 <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> localhost localhost.localdomain localhost6 localhost6.localdomain6</code> </pre> <br><p>  It can be noted that for <em>localhost</em> there are two entries: IPv4 and IPv6 address.  This can play a cruel joke and at the end of the material I will tell you why. </p><br><p>  The <strong>dns</strong> database uses the name server specified in the <code>/etc/resolv.conf</code> config when defining the address.  Here is an example of my <code>/etc/resolv.conf</code> on a host system: </p><br><pre> <code class="hljs pgsql">$ cat /etc/resolv.conf # <span class="hljs-keyword"><span class="hljs-keyword">Generated</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> NetworkManager nameserver <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> nameserver <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span></code> </pre> <br><p>  Name server'a are also used in the chain and in the order of their announcement.  In my case, the first is the local DNS server (I use <em>dnsmasq</em> ) to set the local addresses of the <code>.priv</code> zones.  If a match is found, then the address is returned from the local network.  All other requests are sent to the primary DNS server with the address <code>192.168.100.1</code> . </p><br><p>  The <strong>myhostname</strong> base <strong>is</strong> present in the Centos and Ubuntu distribution, but is not part of <code>glibc</code> .  Without knowing this fact, I spent a lot of time trying to figure out why IPv6 addresses are returned to me to determine the host.  It works as follows: </p><br><ul><li>  When a local hostname is requested (the one that the <code>hostname</code> command returns), the plug-in returns all IP addresses of the public interfaces (ie, all except the loopback), in the absence of such interfaces, the IPv4 address is <code>127.0.0.2</code> and the IPv6 address is <code>::1</code> ; </li><li>  When the <strong>hostname is</strong> requested, <strong>localhost</strong> or <strong>localhost.localdomain</strong> returns the IPv4 address <code>127.0.0.1</code> and the IPv6 address <code>::1</code> ; </li><li>  When requesting a hostname ending in <strong>.localhost</strong> or <strong>.localhost.localdomain, it</strong> returns the IPv4 address <code>127.0.0.1</code> and the IPv6 address <code>::1</code> ; </li></ul><br><p>  <a href="https://www.freedesktop.org/software/systemd/man/nss-myhostname.html">The manual</a> also writes about a special logic with the processing of the _gateway <em>hostname</em> , but apparently this is some kind of patch, since I didn‚Äôt start up with Centos 7. </p><br><p>  The <strong>mdns4_minimal</strong> base or <strong>mdns_minimal</strong> is required for Avahi to work correctly.  If necessary, you can refer to the <a href="https://wiki.archlinux.org/index.php/avahi">Arch documentation on Avahi</a> , where brief and clear information is given <br>  on use. </p><br><p>  Now that information is given on the bases and principles of their work, it is worth noting differences in the definition of addresses in different tools, which leads to problems in runtime. </p><br><p>  Usually administrators check the hostname using the <em>host</em> command.  This is incorrect, so the host, like dig, uses only DNS rezolving, but does not use NSS.  Nginx, for example, uses the <a href="http://man7.org/linux/man-pages/man3/getaddrinfo.3.html">getaddrinfo</a> function, and it uses NSS.  This leads to the fact that the hostname hooked into <code>/etc/hosts</code> can work with nginx, but does not resolve it in other ways.  It's worse when the hostname's IPv6 address is hammered into <code>/etc/hosts</code> , and only the IPv4 address is returned in the DNS settings.  In this case, the administrator can verify that the host command returns only the IPv4 address and calms down, and then the application using <code>getaddrinfo</code> from glibc starts and finds the IPv4 and IPv6 address for the same hostname.  Source of errors ... </p><br><p>  To verify the results returned by each of the databases, the documentation recommends using the <a href="http://man7.org/linux/man-pages/man1/getent.1.html">getent</a> utility. </p><br><p>  Below are some examples of working with <code>getent</code> with IPv6 enabled. </p><br><p>  The <code>/etc/nsswitch.conf</code> contains the following database chain: </p><br><pre> <code class="hljs">hosts: files dns myhostname</code> </pre> <br><p>  <code>/etc/hosts</code> contains the following info </p><br><pre> <code class="hljs ruby">$ cat /etc/hosts <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> localhost ip6-localhost ip6-loopback</code> </pre> <br><p>  The <code>getent ahosts &lt;hostname&gt;</code> command will display a list of all the addresses that were found.  With these settings, it displays the following: </p><br><pre> <code class="hljs ruby">$ getent ahosts localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> STREAM localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> RAW <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> STREAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> RAW</code> </pre> <br><p>  The team allows you to point to a specific database and find out what the base is cutting.  Consider the return values ‚Äã‚Äãfor each database: </p><br><pre> <code class="hljs ruby">$ getent -s <span class="hljs-symbol"><span class="hljs-symbol">hosts:</span></span>files ahosts localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> STREAM localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> RAW <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> STREAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> RAW $ getent -s <span class="hljs-symbol"><span class="hljs-symbol">hosts:</span></span>dns ahosts localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> STREAM localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> RAW <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> STREAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> RAW $ getent -s <span class="hljs-symbol"><span class="hljs-symbol">hosts:</span></span>myhostname ahosts localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> STREAM localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> RAW <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> STREAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> RAW</code> </pre> <br><p>  If you remove the lines for localhost from <code>/etc/hosts</code> , the output will change: </p><br><pre> <code class="hljs ruby">$ getent -s <span class="hljs-symbol"><span class="hljs-symbol">hosts:</span></span>files ahosts localhost $ getent -s <span class="hljs-symbol"><span class="hljs-symbol">hosts:</span></span>dns ahosts localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> STREAM localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> RAW <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> STREAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> RAW $ getent -s <span class="hljs-symbol"><span class="hljs-symbol">hosts:</span></span>myhostname ahosts localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> STREAM localhost <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> RAW <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> STREAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> RAW</code> </pre> <br><p>  Now the <strong>dns</strong> base and <strong>myhostname</strong> return answers, and the <strong>files</strong> database does not contain data.  For DNS queries, the nameserver configured in <code>/etc/resolv.conf</code> in my container is used, for example </p><br><pre> <code class="hljs pgsql">$ cat /etc/resolv.conf nameserver <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.11</span></span> <span class="hljs-keyword"><span class="hljs-keyword">options</span></span> ndots:<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  <em>Dnsmasq is</em> installed on the host machine, which proxies and caches DNS server responses.  The answer from DNS will depend on the DNS server settings to which the request came.  <a href="https://www.ietf.org/rfc/rfc1912.txt">RFC 1912</a> recommends in clause 4.1 to configure the DNS servers so that localhost points to 127.0.0.1. </p><br><blockquote>  Certain zones should always be present in nameserver configurations: <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">primary</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">localhost</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">localhost</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">primary</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.127</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.in-addr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.arpa</span></span> 127<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">primary</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.in-addr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.arpa</span></span> 255 <span class="hljs-selector-tag"><span class="hljs-selector-tag">primary</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.in-addr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.arpa</span></span> 0</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Nameservice for "special" <br>  addresses or help <br>  local address to be sent to the root nameservers.  All of these <br>  record files <br>  you maintain your SOA <br>  timers very long, since this data will never change. <br><br>  The "localhost" address is a "special" address which always refers to <br>  the local host.  It should contain the following line: <br><br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">localhost</span></span>. <span class="hljs-selector-tag"><span class="hljs-selector-tag">IN</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">A</span></span> 127<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span></code> </pre> <br></blockquote><p>  In my case, the dnsmasq out of the box contains entries for localhost, as recommended by the RFC. </p><br><pre> <code class="hljs pgsql">$ dig +noall +answer localhost <span class="hljs-keyword"><span class="hljs-keyword">ANY</span></span> @<span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> localhost. <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> A <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> localhost. <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> AAAA ::<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  It is disabled by either removing entries from <code>/etc/hosts</code> on the DNS server itself, or by turning on the <code>no-hosts</code> option in <code>/etc/dnsmasq.conf</code> . </p><br><p>  After enabling the getent option for the <strong>myhostname</strong> database, the result is non-empty, but as noted above, with <strong>myhostname</strong> enabled, the IPv4 and IPv6 address will be returned.  On systems with static IP addresses, you can safely turn off the <strong>myhostname</strong> plugin and configure local hosts using <code>/etc/hosts</code> .  An alternative is to disable IPv6. </p><br><p>  The IPv6 status on the server can be obtained from the kernel parameters.  A value of 0 is returned when IPv6 is enabled, and 1 is turned off. </p><br><pre> <code class="hljs pgsql">$ sysctl net.ipv6.conf.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>.disable_ipv6 net.ipv6.conf.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.disable_ipv6 net.ipv6.conf.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>.disable_ipv6 = <span class="hljs-number"><span class="hljs-number">0</span></span> net.ipv6.conf.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.disable_ipv6 = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  In the <em>ifconfig</em> output, the IPv6 listening interfaces contain the line <em>inet6</em> .  Below is an example of output with IPv6 turned off and on, respectively: </p><br><pre> <code class="hljs pgsql"># diabled $ ifconfig -a eth0: flags=<span class="hljs-number"><span class="hljs-number">4163</span></span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu <span class="hljs-number"><span class="hljs-number">1500</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.101</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span> netmask <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> broadcast <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> ether <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">42</span></span>:c0:a8:<span class="hljs-number"><span class="hljs-number">65</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span> txqueuelen <span class="hljs-number"><span class="hljs-number">0</span></span> (Ethernet) RX packets <span class="hljs-number"><span class="hljs-number">15789549</span></span> bytes <span class="hljs-number"><span class="hljs-number">2553533549</span></span> (<span class="hljs-number"><span class="hljs-number">2.3</span></span> GiB) RX errors <span class="hljs-number"><span class="hljs-number">0</span></span> dropped <span class="hljs-number"><span class="hljs-number">0</span></span> overruns <span class="hljs-number"><span class="hljs-number">0</span></span> frame <span class="hljs-number"><span class="hljs-number">0</span></span> TX packets <span class="hljs-number"><span class="hljs-number">9783999</span></span> bytes <span class="hljs-number"><span class="hljs-number">1318627420</span></span> (<span class="hljs-number"><span class="hljs-number">1.2</span></span> GiB) TX errors <span class="hljs-number"><span class="hljs-number">0</span></span> dropped <span class="hljs-number"><span class="hljs-number">0</span></span> overruns <span class="hljs-number"><span class="hljs-number">0</span></span> carrier <span class="hljs-number"><span class="hljs-number">0</span></span> collisions <span class="hljs-number"><span class="hljs-number">0</span></span> lo: flags=<span class="hljs-number"><span class="hljs-number">73</span></span>&lt;UP,LOOPBACK,RUNNING&gt; mtu <span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span> <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> netmask <span class="hljs-number"><span class="hljs-number">255.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> txqueuelen <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Local</span></span> Loopback) RX packets <span class="hljs-number"><span class="hljs-number">606047</span></span> bytes <span class="hljs-number"><span class="hljs-number">67810892</span></span> (<span class="hljs-number"><span class="hljs-number">64.6</span></span> MiB) RX errors <span class="hljs-number"><span class="hljs-number">0</span></span> dropped <span class="hljs-number"><span class="hljs-number">0</span></span> overruns <span class="hljs-number"><span class="hljs-number">0</span></span> frame <span class="hljs-number"><span class="hljs-number">0</span></span> TX packets <span class="hljs-number"><span class="hljs-number">606047</span></span> bytes <span class="hljs-number"><span class="hljs-number">67810892</span></span> (<span class="hljs-number"><span class="hljs-number">64.6</span></span> MiB) TX errors <span class="hljs-number"><span class="hljs-number">0</span></span> dropped <span class="hljs-number"><span class="hljs-number">0</span></span> overruns <span class="hljs-number"><span class="hljs-number">0</span></span> carrier <span class="hljs-number"><span class="hljs-number">0</span></span> collisions <span class="hljs-number"><span class="hljs-number">0</span></span> # enabled $ ifconfig -a eth0: flags=<span class="hljs-number"><span class="hljs-number">4163</span></span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu <span class="hljs-number"><span class="hljs-number">1500</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.101</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span> netmask <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> broadcast <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> inet6 fe80::<span class="hljs-number"><span class="hljs-number">42</span></span>:c0ff:fea8:<span class="hljs-number"><span class="hljs-number">6505</span></span> prefixlen <span class="hljs-number"><span class="hljs-number">64</span></span> scopeid <span class="hljs-number"><span class="hljs-number">0x20</span></span>&lt;link&gt; ether <span class="hljs-number"><span class="hljs-number">02</span></span>:<span class="hljs-number"><span class="hljs-number">42</span></span>:c0:a8:<span class="hljs-number"><span class="hljs-number">65</span></span>:<span class="hljs-number"><span class="hljs-number">05</span></span> txqueuelen <span class="hljs-number"><span class="hljs-number">0</span></span> (Ethernet) RX packets <span class="hljs-number"><span class="hljs-number">15787641</span></span> bytes <span class="hljs-number"><span class="hljs-number">2553216408</span></span> (<span class="hljs-number"><span class="hljs-number">2.3</span></span> GiB) RX errors <span class="hljs-number"><span class="hljs-number">0</span></span> dropped <span class="hljs-number"><span class="hljs-number">0</span></span> overruns <span class="hljs-number"><span class="hljs-number">0</span></span> frame <span class="hljs-number"><span class="hljs-number">0</span></span> TX packets <span class="hljs-number"><span class="hljs-number">9782965</span></span> bytes <span class="hljs-number"><span class="hljs-number">1318487919</span></span> (<span class="hljs-number"><span class="hljs-number">1.2</span></span> GiB) TX errors <span class="hljs-number"><span class="hljs-number">0</span></span> dropped <span class="hljs-number"><span class="hljs-number">0</span></span> overruns <span class="hljs-number"><span class="hljs-number">0</span></span> carrier <span class="hljs-number"><span class="hljs-number">0</span></span> collisions <span class="hljs-number"><span class="hljs-number">0</span></span> lo: flags=<span class="hljs-number"><span class="hljs-number">73</span></span>&lt;UP,LOOPBACK,RUNNING&gt; mtu <span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-type"><span class="hljs-type">inet</span></span> <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> netmask <span class="hljs-number"><span class="hljs-number">255.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> inet6 ::<span class="hljs-number"><span class="hljs-number">1</span></span> prefixlen <span class="hljs-number"><span class="hljs-number">128</span></span> scopeid <span class="hljs-number"><span class="hljs-number">0x10</span></span>&lt;host&gt; <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> txqueuelen <span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Local</span></span> Loopback) RX packets <span class="hljs-number"><span class="hljs-number">605949</span></span> bytes <span class="hljs-number"><span class="hljs-number">67799887</span></span> (<span class="hljs-number"><span class="hljs-number">64.6</span></span> MiB) RX errors <span class="hljs-number"><span class="hljs-number">0</span></span> dropped <span class="hljs-number"><span class="hljs-number">0</span></span> overruns <span class="hljs-number"><span class="hljs-number">0</span></span> frame <span class="hljs-number"><span class="hljs-number">0</span></span> TX packets <span class="hljs-number"><span class="hljs-number">605949</span></span> bytes <span class="hljs-number"><span class="hljs-number">67799887</span></span> (<span class="hljs-number"><span class="hljs-number">64.6</span></span> MiB) TX errors <span class="hljs-number"><span class="hljs-number">0</span></span> dropped <span class="hljs-number"><span class="hljs-number">0</span></span> overruns <span class="hljs-number"><span class="hljs-number">0</span></span> carrier <span class="hljs-number"><span class="hljs-number">0</span></span> collisions <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  You can turn off IPv6 by calling </p><br><pre> <code class="hljs pgsql">$ sysctl -w net.ipv6.conf.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>.disable_ipv6=<span class="hljs-number"><span class="hljs-number">1</span></span> $ sysctl -w net.ipv6.conf.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.disable_ipv6=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  What will change after shutdown?  I rolled back all the configs to the standard ones: localhost with IPv4 and IPv6 addresses is present in <code>/etc/hosts</code> , the <code>no-hosts</code> option is disabled in dnsmasq.  I disabled the IPv6 commands above and the output of getent was as follows: </p><br><pre> <code class="hljs ruby">$ getent -s <span class="hljs-symbol"><span class="hljs-symbol">hosts:</span></span>files ahosts localhost <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> STREAM localhost <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> RAW <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> STREAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> RAW $ getent -s <span class="hljs-symbol"><span class="hljs-symbol">hosts:</span></span>dns ahosts localhost <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> STREAM localhost <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> RAW $ getent -s <span class="hljs-symbol"><span class="hljs-symbol">hosts:</span></span>myhostname ahosts localhost <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> STREAM localhost <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> DGRAM <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> RAW</code> </pre> <br><p>  Wow, in the first output we have duplicated the address 127.0.0.1.  To figure out why this is happening, it‚Äôs worth referring to the glibc source code and the getent utility code.  Below is a piece of getent utility code. </p><br><pre> <code class="hljs cs"><span class="hljs-comment"><span class="hljs-comment">/* This is for hosts, but using getaddrinfo */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ahosts_keys_int</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> af, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> xflags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *key[]</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... hint.ai_flags = (AI_V4MAPPED | AI_ADDRCONFIG | AI_CANONNAME | idn_flags | xflags); hint.ai_family = af; for (i = 0; i &lt; number; ++i) { struct addrinfo *res; if (getaddrinfo (key[i], NULL, &amp;hint, &amp;res) != 0) result = 2; else { struct addrinfo *runp = res; while (runp != NULL) { // printf goes here } freeaddrinfo (res); } } return result;</span></span></code> </pre> <br><p>  The <a href="http://man7.org/linux/man-pages/man3/getaddrinfo.3.html">AI_V4MAPPED</a> flag of the <a href="http://man7.org/linux/man-pages/man3/getaddrinfo.3.html">getaddrinfo function</a> performs mapping of IPv6 addresses to IPv4 if no IPv6 addresses were found as a result of polling the database.  The AI_ADDRCONFIG flag will force getaddrinfo to check for the presence of IPv6 / IPv4 addresses configured in the system and in the absence of at least one IPv6 / IPv4 address, the IPv6 / IPv4 address will not be returned regardless of whether the specific base responds. </p><br><p>  Since getent has both flags enabled, and in <code>/etc/hosts</code> <code>127.0.0.1</code> and <code>::1</code> addresses for localhost, getaddrinfo will receive from the NSS of the <strong>hosts</strong> database (in the example above we discussed this particular database), <code>127.0.0.1</code> and <code>::1</code> addresses <code>::1</code> , then not finding a single IPv6 address in the system (turned off by the kernel parameters) and will perform mapping <code>::1</code> -&gt; <code>127.0.0.1</code> . </p><br><p>  To better understand this concept, I will give examples with the output of getaddrinfo on the same system, with different settings <em>ai_flags</em> and <em>ai_family</em> .  The <code>/etc/hosts</code> are enabled for localhost IPv4 and IPv6 addresses. <br>  Source code can be found <a href="https://gist.github.com/WoZ/70f90bc053d2718d6311682525430b72">on my github</a> . </p><br><pre> <code class="hljs delphi"># ./getaddrinfo localhost IP addresses <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> localhost: [AF_INET] AI_V4MAPPED IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> [AF_INET] AI_V4MAPPED AI_ALL IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> [AF_INET] AI_ADDRCONFIG IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> [AF_INET] AI_V4MAPPED AI_ADDRCONFIG IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> [AF_INET] AI_V4MAPPED AI_ALL AI_ADDRCONFIG IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> -------------- [AF_INET6] AI_V4MAPPED IPv6: ::<span class="hljs-number"><span class="hljs-number">1</span></span> [AF_INET6] AI_V4MAPPED AI_ALL IPv6: ::ffff:<span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> IPv6: ::ffff:<span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> IPv6: ::<span class="hljs-number"><span class="hljs-number">1</span></span> [AF_INET6] AI_ADDRCONFIG getaddrinfo: <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> service <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> known [AF_INET6] AI_V4MAPPED AI_ADDRCONFIG getaddrinfo: <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> service <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> known [AF_INET6] AI_V4MAPPED AI_ALL AI_ADDRCONFIG getaddrinfo: <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> service <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> known -------------- [AF_UNSPEC] AI_V4MAPPED IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> IPv6: ::<span class="hljs-number"><span class="hljs-number">1</span></span> [AF_UNSPEC] AI_V4MAPPED AI_ALL IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> IPv6: ::<span class="hljs-number"><span class="hljs-number">1</span></span> [AF_UNSPEC] AI_ADDRCONFIG IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> [AF_UNSPEC] AI_V4MAPPED AI_ADDRCONFIG IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> [AF_UNSPEC] AI_V4MAPPED AI_ALL AI_ADDRCONFIG IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> IPv4: <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span> --------------</code> </pre> <br><p>  From the output, it is clear that with the _ai <em>family</em> equal to _AI <em>UNSPEC</em> (return both IPv4 and IPv6) and without the AI_ADDRCONFIG flag, <code>getaddrinfo</code> returns two addresses, IPv4 and IPv6, which many administrators do not expect to see.  This happens regardless of whether IPv6 is disabled in the kernel parameters.  If the address <code>::1</code> removed from <code>/etc/hosts</code> , then IPv6 addresses will disappear completely from the output of <code>getaddrinfo</code> (with the <code>AF_UNSPEC</code> flag). </p><br><p>  With IPv6 enabled and the presence of <code>::1</code> in <code>/etc/hosts</code> will return IPv4 and IPv6.  To prevent the return of an IPv6 address, you need to comment out the IPv6 address in <code>/etc/hosts</code> .  If the addresses are found in <code>/etc/hosts</code> , then glibc will not work in <strong>dns</strong> and myhostname. </p><br><p>  It remains to check how <code>getaddrinfo</code> behaves for the <strong>dns</strong> database.  To do this, I leave in <code>/etc/nsswitch.conf</code> for <strong>hosts</strong> only <strong>dns</strong> base and cut google.com.  The output below is with IPv6 enabled. </p><br><pre> <code class="hljs ruby">$ sysctl -w net.ipv6.conf.default.disable_ipv6=<span class="hljs-number"><span class="hljs-number">0</span></span> $ sysctl -w net.ipv6.conf.all.disable_ipv6=<span class="hljs-number"><span class="hljs-number">0</span></span> $ ./getaddrinfo google.com IP addresses <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> google.<span class="hljs-symbol"><span class="hljs-symbol">com:</span></span> [AF_INET] AI_V4MAPPED <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> [AF_INET] AI_V4MAPPED AI_ALL <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> [AF_INET] AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> [AF_INET] AI_V4MAPPED AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> [AF_INET] AI_V4MAPPED AI_ALL AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> -------------- [AF_INET6] AI_V4MAPPED <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e [AF_INET6] AI_V4MAPPED AI_ALL <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:ffff</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e [AF_INET6] AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e [AF_INET6] AI_V4MAPPED AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e [AF_INET6] AI_V4MAPPED AI_ALL AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:ffff</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e -------------- [AF_UNSPEC] AI_V4MAPPED <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e [AF_UNSPEC] AI_V4MAPPED AI_ALL <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e [AF_UNSPEC] AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e [AF_UNSPEC] AI_V4MAPPED AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e [AF_UNSPEC] AI_V4MAPPED AI_ALL AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e --------------</code> </pre> <br><p>  But the output with IPv6 off: </p><br><pre> <code class="hljs ruby">$ sysctl -w net.ipv6.conf.all.disable_ipv6=<span class="hljs-number"><span class="hljs-number">1</span></span> $ sysctl -w net.ipv6.conf.default.disable_ipv6=<span class="hljs-number"><span class="hljs-number">1</span></span> $ ./getaddrinfo google.com IP addresses <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> google.<span class="hljs-symbol"><span class="hljs-symbol">com:</span></span> [AF_INET] AI_V4MAPPED <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> [AF_INET] AI_V4MAPPED AI_ALL <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> [AF_INET] AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> [AF_INET] AI_V4MAPPED AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> [AF_INET] AI_V4MAPPED AI_ALL AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> -------------- [AF_INET6] AI_V4MAPPED <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e [AF_INET6] AI_V4MAPPED AI_ALL <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:ffff</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e [AF_INET6] AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">getaddrinfo:</span></span> Name <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> service <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> known [AF_INET6] AI_V4MAPPED AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">getaddrinfo:</span></span> Name <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> service <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> known [AF_INET6] AI_V4MAPPED AI_ALL AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">getaddrinfo:</span></span> Name <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> service <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> known -------------- [AF_UNSPEC] AI_V4MAPPED <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e [AF_UNSPEC] AI_V4MAPPED AI_ALL <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">a00:</span></span><span class="hljs-number"><span class="hljs-number">1450</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">401</span></span><span class="hljs-symbol"><span class="hljs-symbol">b:</span></span><span class="hljs-number"><span class="hljs-number">806</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">200</span></span>e [AF_UNSPEC] AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> [AF_UNSPEC] AI_V4MAPPED AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> [AF_UNSPEC] AI_V4MAPPED AI_ALL AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">216.58</span></span>.<span class="hljs-number"><span class="hljs-number">215.78</span></span> --------------</code> </pre> <br><p>  As you can see, the situation with AI_ADDRCONFIG is very similar. </p><br><p>  Finally, I will give an example of how not to consider all the above, plunge into problems.  IPv6 enabled, <code>/etc/nsswitch.conf</code> standard. </p><br><pre> <code class="hljs pgsql">$ cat /etc/hosts <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> localhost ::<span class="hljs-number"><span class="hljs-number">1</span></span> localhost ip6-localhost ip6-loopback $ grep hosts /etc/nsswitch.conf hosts: files dns myhostname $ cat /etc/resolv.conf nameserver <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.11</span></span> <span class="hljs-keyword"><span class="hljs-keyword">options</span></span> ndots:<span class="hljs-number"><span class="hljs-number">0</span></span> $ sysctl net.ipv6.conf.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>.disable_ipv6 net.ipv6.conf.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.disable_ipv6 net.ipv6.conf.<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>.disable_ipv6 = <span class="hljs-number"><span class="hljs-number">0</span></span> net.ipv6.conf.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.disable_ipv6 = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  What will return <code>host localhost</code> or <code>dig ANY localhost</code> ?  What will return <code>getaddrinfo</code> , for example, with flags like nginx? </p><br><pre> <code class="hljs ruby">$ dig +noall +answer ANY localhost @127.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">11</span></span> localhost. <span class="hljs-number"><span class="hljs-number">0</span></span> IN A <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> $ host localhost localhost has address <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span> $ ./getaddrinfo localhost IP addresses <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-symbol"><span class="hljs-symbol">localhost:</span></span> [AF_UNSPEC] AI_ADDRCONFIG <span class="hljs-symbol"><span class="hljs-symbol">IPv6:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-symbol"><span class="hljs-symbol">IPv4:</span></span> <span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  nginx will try to connect to two addresses: <code>127.0.0.1</code> and <code>::1</code> , and the application may not expect this.  Source for errors. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3d/kp/av/3dkpav9sjfl7k3icwm2zc91hbj8.jpeg"></div><br><p>  What can be concluded from all written? </p><br><ol><li>  If you are developing an application that works with a network, then consider that IPv6 may be disabled; </li><li>  When setting up the server, consider the presence of NSS and the order of checks, use getent or my code to check; </li><li>  If you don‚Äôt know how the application works, then if you have the source codes, you can see with which flags the rezolvitsya <br>  addresses and check with the system settings; </li><li>  If there are no source codes, then by the behavior in the strace output, it is possible to make an assumption about the flags used. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/352300/">https://habr.com/ru/post/352300/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352282/index.html">Continuous Integration for Newbies</a></li>
<li><a href="../352292/index.html">Hitachi: how the Japanese sunk from chainsaws to modern storage systems</a></li>
<li><a href="../352294/index.html">How to create an ideal product roadmap and what is needed for this?</a></li>
<li><a href="../352296/index.html">A simple asynchronous task manager for Unity3D</a></li>
<li><a href="../352298/index.html">From idea to AppStore</a></li>
<li><a href="../352302/index.html">Zuckerberg called. Facebook programmer about his experience of interviewing in the US and the workflow on Facebook</a></li>
<li><a href="../352304/index.html">Do-it-yourself Property Injection (Xamarin / .Net)</a></li>
<li><a href="../352306/index.html">Four facts about memcached amplification</a></li>
<li><a href="../352308/index.html">Lecture by Andrei Bezrukov on the digital economy, global challenges and what it is like to be a spy</a></li>
<li><a href="../352310/index.html">Development of elevator movement algorithm</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>