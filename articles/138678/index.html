<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using bat files to create scheduled tasks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I continue the theme of creating non-trivial bat-files for trivial tasks, started here . 

 Surely, many faced with the task, when for any purpose in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using bat files to create scheduled tasks</h1><div class="post__text post__text-html js-mediator-article">  I continue the theme of creating non-trivial bat-files for trivial tasks, started <a href="http://habrahabr.ru/blogs/crazydev/138162/">here</a> . <br><br>  Surely, many faced with the task, when for any purpose in Windows it is necessary to create a task that runs on a schedule (scheduled task). <br>  For these purposes there is a simple graphical interface.  However, what if the task should be created automatically? <br>  Let's try to solve this problem using a primitive bat-script that will be executed in almost any version of Windows. <br><a name="habracut"></a><br>  For convenience, we will create a local technological user on the machine, under which our task will run on a schedule.  This is convenient because you can set permissions for a user that are necessary only to perform certain actions. <br><br><blockquote>  :: The name of the local user under which we will work <br>  <font color="#000000">set</font> <font color="#007800">user_name</font> = test_user <br>  :: Password for local user <br>  <font color="#000000">set</font> <font color="#007800">user_passw</font> = test_passw </blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And as you know the user must be in a group with certain rights.  Here a certain complexity arises, since  if the script clearly specifies the name of the group, then problems may arise on a machine with a different location, such as Chinese.  And what will be called in the Chinese group "Users" will not be very easy to learn.  Fortunately, in Windows, groups are tied to the so-called <b>Group SID</b> .  Knowing, for example, the Group SID of the Administrators group, we can use it in the script.  For example, S-1-5-32-545 are local users, and S-1-5-32-544 are administrators. <br>  Now you need to determine the name for the specified Group SID used in this localization.  This is where WMIC (WMI command-line) comes to the rescue. <br><br><blockquote>  :: S- <font color="#000000">1</font> - <font color="#000000">5</font> - <font color="#000000">32</font> - <font color="#000000">545</font> - local users <br>  Set <font color="#007800">GroupSID</font> = S- <font color="#000000">1</font> - <font color="#000000">5</font> - <font color="#000000">32</font> - <font color="#000000">545</font> <br>  Set <font color="#007800">GroupName</font> = <br>  For <font color="#000000">/</font> F <font color="#ff0000">"UseBackQ Tokens = 1 * Delims =="</font> <font color="#000000">%%</font> I In <font color="#7a0874">(</font> <font color="#000000">`</font> WMIC Group Where <font color="#ff0000">" SID = '% GroupSID%' "</font> Get Name <font color="#000000">/</font> Value ^ <font color="#000000">|</font> Find <font color="#ff0000">" = "</font> <font color="#000000">`</font> <font color="#7a0874">)</font> Do Set <font color="#007800">GroupName</font> = <font color="#000000">%%</font> J <br>  Set <font color="#007800">GroupName</font> = <font color="#000000">%</font> GroupName: ~ <font color="#000000">0</font> , - <font color="#000000">1</font> <font color="#000000">%</font> </blockquote><br><br>  Need to know another nuance.  When creating a user, depending on the system settings, a password expiration time is set.  And if the password needs to be changed, the task will not be executed according to the schedule.  To do this, we need to create a user whose password never expires.  You cannot set this in the standard net user command (expires: never - specifies that the user cannot change the password), so again we will resort to using <b>WMIC</b> : <br><br><blockquote>  :: Create user <br>  net user <font color="#000000">%</font> user_name%% user_passw <font color="#000000">%</font> <font color="#000000">/</font> add <font color="#000000">/</font> comment: <font color="#ff0000">"User for works with application"</font> <font color="#000000">/</font> expires: never <font color="#000000">/</font> fullname: <font color="#000000">%</font> user_name <font color="#000000">%</font> <font color="#000000">/</font> passwordchg: no <br>  :: Set so that the password never expires <br>  :: Or so - wmic path Win32_UserAccount where <font color="#007800">Name</font> = <font color="#ff0000">'% user_name%'</font> <font color="#000000">set</font> <font color="#007800">PasswordExpires</font> = <font color="#c20cb9">false</font> <br>  wmic USERACCOUNT where <font color="#007800">Name</font> = <font color="#ff0000">'% user_name%'</font> <font color="#000000">set</font> <font color="#007800">PasswordExpires</font> = <font color="#c20cb9">false</font> <br>  :: Adding a local user to the specified local group <br>  net localgroup <font color="#000000">%</font> GroupName%% user_name <font color="#000000">%</font> <font color="#000000">/</font> ADD </blockquote><br><br>  Please note that if you delete a user with the <b>net user test_user / DELETE</b> command, then you will need to manually delete its directory along the path% USERS% \ test_user \ or provide for its deletion in the script. <br><br>  Well, then create the task itself, which is performed according to a schedule: <br><br><blockquote>  :: The name of the scheduled task under which the application will run <br>  <font color="#000000">set</font> <font color="#007800">task_name</font> = Test_task_bat <br>  :: Application Path <br>  <font color="#000000">set</font> <font color="#007800">my_app_path</font> = <font color="#ff0000">"d: test.bat"</font> <br>  :: Interval of the application in the temporary task <br>  :: Valid schedule types: MINUTE, HOURLY, DAILY, WEEKLY, MONTHLY, ONCE, ONSTART, ONLOGON, ONIDLE. <br>  :: EVERY MONTHLY, EVERY MONTHLY, EVERYDAY, WEEKLY, MONTHLY ON STARTING ENTRY INTO THE SYSTEM ON SIMPLE <br>  <font color="#000000">set</font> <font color="#007800">schtasks_time</font> = MINUTE <br>  :: Initial start time of the application in the temporary task <br>  <font color="#000000">set</font> <font color="#007800">schtasks_start</font> = 08: 00: 00 <br><br>  :: Creating a scheduled task <br>  schtasks <font color="#000000">/</font> create <font color="#000000">/</font> tn <font color="#ff0000">"% task_name%"</font> <font color="#000000">/</font> <font color="#c20cb9">tr</font> <font color="#000000">%</font> my_app_path <font color="#000000">%</font> <font color="#000000">/</font> sc <font color="#000000">%</font> schtasks_time <font color="#000000">%</font> <font color="#000000">/</font> st <font color="#000000">%</font> schtasks_start <font color="#000000">%</font> <font color="#000000">/</font> ru <font color="#000000">%</font> user_name <font color="#000000">%</font> <font color="#000000">/</font> rp <font color="#000000">%</font> user_passw <font color="#000000">%</font> </blockquote><br><br>  That's all.  I hope that my small manual will be useful and you will save your time when performing this task. <br><br>  PS <br>  I foresee such questions and comments: there are more convenient tools, why exactly bat? <br>  Just for fun! </div><p>Source: <a href="https://habr.com/ru/post/138678/">https://habr.com/ru/post/138678/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138672/index.html">Canonical introduced Ubuntu for Android (UPD)</a></li>
<li><a href="../138673/index.html">Simple productivity methods for freelancer</a></li>
<li><a href="../138674/index.html">Page Object - the path to perfect autotests</a></li>
<li><a href="../138675/index.html">Rating increase in wages in the IT-sphere</a></li>
<li><a href="../138676/index.html">Monads in Python in detail</a></li>
<li><a href="../138679/index.html">AirPush Phishing: Security Tips</a></li>
<li><a href="../138680/index.html">LTE from Yota in Moscow since April 15</a></li>
<li><a href="../138682/index.html">What's wrong with GNU make?</a></li>
<li><a href="../138684/index.html">Virtual functions in C</a></li>
<li><a href="../138685/index.html">Pixelapse - version control system for designers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>