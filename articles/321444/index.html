<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We read Google tables from the web application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Google has several APIs for accessing its spreadsheets. Let's figure out how to read data from spreadsheet tables in a java web application using API ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We read Google tables from the web application</h1><div class="post__text post__text-html js-mediator-article">  Google has several APIs for accessing its spreadsheets.  Let's figure out how to read data from spreadsheet tables in a java web application using API version 4. <br><a name="habracut"></a><br><h2>  Google app </h2><br>  Create a new project through the <a href="https://console.developers.google.com/">google console</a> . <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/9ea/216/8fb/9ea2168fbcad41ad92f5174eb256ce6b.png" alt="create a new google project"></div><br>  Activate Sheets API. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/9f1/6c3/7d1/9f16c37d1ade49e6952d9b6d70cdc2ac.png" alt="search API to activate"></div><br>  To use the selected API, you need to create credentials.  We will call the API from the browser. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/90b/6f2/b54/90b6f2b549aa4d979db32c71a9fdbeea.png" alt="credential creation"></div><br>  Create an OAuth 2 client ID and set the URL restrictions.  It is necessary to specify both productive and development url. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/57b/e75/5c1/57be755c135b4eda9d428af3c46f2a24.png" alt="create customer ID"></div><br>  The access request window can also be customized by specifying the display name, logo and license. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/cb4/f4f/e48/cb4f4fe483544139ac10a09d86652e18.png" alt="creating credentials 2"></div><br>  The output should be the credential file client_secrets.json.  The finished file must then be placed in the resources of your project. <br><br><h2>  Authorization Scripts </h2><br>  Go ahead.  <a href="https://developers.google.com/sheets/api/">The Google Sheets API v4</a> supports various <a href="https://developers.google.com/api-client-library/java/google-api-java-client/oauth2">scripts for authorization</a> using an authorization code: <br><br><ul><li>  For web server applications.  You need to implement a couple of defined servlets and add them to your web.xml </li><li>  Service accounts.  Service accounts are created on google and provide clients with access to their resources, and not to user resources. </li><li>  For installed applications.  <a href="https://developers.google.com/sheets/api/quickstart/java">An example of</a> working with API from a console application. </li><li>  For client applications.  In the browser, we form a request for obtaining an access code, which can then be exchanged for tokens. </li><li>  For android. </li></ul><br>  Scripts for web and client applications are suitable for us.  The scheme of work for them is common: <br><br><div style="text-align:center;"><img src="https://developers.google.com/accounts/images/webflow.png" alt="The process of using OAuth 2.0 for web applications."></div><br>  The first step is to request the google authorization key.  The user will be shown the form of access.  Having received an authorization code, it must be exchanged for an access token, without which it is impossible to communicate with the Google API.  The sequence of actions can be observed in the OAuth 2.0 <a href="https://developers.google.com/oauthplayground/">sandbox</a> . <br><br><h2>  Google oauth2 app </h2><br>  We take <a href="http://spring.io/">spring boot as the</a> basis for a web application.  The dependencies are as follows: <br><br><pre><code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- Google OAuth Client Library for Java. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.google.oauth-client<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>google-oauth-client-java6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${google.oauth.client.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Google OAuth2 API V2 Rev124 1.22.0 --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.google.apis<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>google-api-services-oauth2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${google.oauth2.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Google Sheets API V4 Rev38 1.22.0 --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.google.apis<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>google-api-services-sheets<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${google.sheets.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Create two services.  GoogleConnection will load client data from a local file and store identification data after receiving it. <br><br><div class="spoiler">  <b class="spoiler_title">GoogleConnectionService.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GoogleConnectionService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GoogleConnection</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CLIENT_SECRETS = <span class="hljs-string"><span class="hljs-string">"/client_secrets.json"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// .. @Override public GoogleClientSecrets getClientSecrets() { if (clientSecrets == null) { try { // load client secrets InputStreamReader clientSecretsReader = new InputStreamReader(getSecretFile()); clientSecrets = GoogleClientSecrets.load(Global.JSON_FACTORY, clientSecretsReader); } catch (IOException e) { e.printStackTrace(); } } return clientSecrets; } @Override public Credential getCredentials() { return credential; } // .. }</span></span></code> </pre><br></div></div><br>  And GoogleSheets will perform the main work - read the tabular data. <br><br><div class="spoiler">  <b class="spoiler_title">GoogleSheetsService.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GoogleSheetsService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GoogleSheets</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Sheets sheetsService = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;List&lt;Object&gt;&gt; readTable(GoogleConnection connection) <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> IOException { Sheets service = getSheetsService(connection); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> readTable(service, spreadsheetId, sheetName); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Sheets </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSheetsService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GoogleConnection gc)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sheetsService == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sheetsService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sheets.Builder(Global.HTTP_TRANSPORT, Global.JSON_FACTORY, gc.getCredentials()) .setApplicationName(appName).build(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sheetsService; } }</code> </pre><br></div></div><br>  We distribute the entire sequence of operations among the three controllers.  Controller for authorization. <br><br><div class="spoiler">  <b class="spoiler_title">GoogleAuthorizationController.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GoogleAuthorizationController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GoogleConnectionService connection; <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/ask"</span></span>, method = RequestMethod.GET) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpServletResponse response)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Step 1: Authorize --&gt; ask for auth code String url = new GoogleAuthorizationCodeRequestUrl(connection.getClientSecrets(), connection.getRedirectUrl(), Global.SCOPES).setApprovalPrompt("force").build(); response.sendRedirect(url); } }</span></span></code> </pre><br></div></div><br>  The result of his work will be a redirect to google for login. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/cf0/6f5/102/cf06f5102cee4ead9c4db47f880f0786.png" alt="google login"></div><br>  Then request the access of the google application to the user tables: <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/files/c7a/349/c11/c7a349c11cfc41af805812d0a4a53049.png" alt="request for application access to user data"></div><br>  In case of successful authorization, the feedback controller will exchange the code for tokens and redirect to the original url.  For the exchange itself is responsible class <a href="https://google.github.io/google-api-java-client/releases/1.21.0/javadoc/index.html">GoogleAuthorizationCodeTokenRequest</a> . <br><br><div class="spoiler">  <b class="spoiler_title">GoogleCallbackController.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GoogleCallbackController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GoogleConnectionService connection; <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/oauth2callback"</span></span>, method = RequestMethod.GET) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@RequestParam(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"code"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String code, HttpServletResponse response) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Step 2: Exchange code --&gt; access tocken if (connection.exchangeCode(code)) { response.sendRedirect(connection.getSourceUrl()); } else { response.sendRedirect("/error"); } } }</span></span></code> </pre> <br></div></div><br>  And, in fact, a working controller that implements the reading of tabular data. <br><br><div class="spoiler">  <b class="spoiler_title">GoogleSheetController.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GoogleSheetController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GoogleConnection connection; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GoogleSheets sheetsService; <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(value = <span class="hljs-string"><span class="hljs-string">"/api/sheet"</span></span>, method = RequestMethod.GET) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ResponseEntity&lt;List&lt;List&lt;Object&gt;&gt;&gt; read(HttpServletResponse response) <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> IOException { List&lt;List&lt;Object&gt;&gt; responseBody = sheetsService.readTable(connection); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResponseEntity&lt;List&lt;List&lt;Object&gt;&gt;&gt;(responseBody, HttpStatus.OK); } }</code> </pre> <br></div></div><br>  We also need an interceptor so that it is impossible to access the working controller without authentication. <br><br><div class="spoiler">  <b class="spoiler_title">GoogleSheetsInterceptor.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GoogleSheetsInterceptor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandlerInterceptor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// .. @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object obj) throws Exception { if (connection.getCredentials() == null) { connection.setSourceUrl(request.getRequestURI()); response.sendRedirect("/ask"); return false; } return true; } }</span></span></code> </pre> <br></div></div><br>  Compared to the API v3, each line is a list of objects. <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;List&lt;Object&gt;&gt; readTable(Sheets service, String spreadsheetId, String sheetName) <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> IOException { ValueRange table = service.spreadsheets().values().get(spreadsheetId, sheetName).execute(); List&lt;List&lt;Object&gt;&gt; values = table.getValues(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> values; }</code> </pre><br>  Using <a href="https://developers.google.com/sheets/api/guides/concepts">A1 notation, we</a> read page by page, not in blocks.  To do this, add the page id parameter and the tab name in the application settings. <br><br><pre> <code class="hljs pgsql">google.spreadsheet.id=.. google.spreadsheet.sheet.name=..</code> </pre><br>  We start.  We are checking. <br><br>  As a result, you should get an idea of ‚Äã‚Äãwhich Google API classes are used to connect to your OAuth 2.0 services and how you can use them from a web application. <br><br><h2>  Spring sso application </h2><br>  The application code responsible for working with OAuth2 can be simplified with spring.  To do this, connect <a href="http://projects.spring.io/spring-security-oauth/">Spring Security OAuth</a> . <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.security.oauth<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-security-oauth2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  This will allow us to hide the OAuth2 routine operations under the hood and protect our application. <br><br>  Let's transfer user secrets in application.properties. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">security</span></span>.oauth2.client.client-id=Enter Client Id <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>.oauth2.client.client-secret=Enter Client Secret <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>.oauth2.client.accessTokenUri=https://accounts.google.com/o/oauth2/token <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>.oauth2.client.userAuthorizationUri=https://accounts.google.com/o/oauth2/auth <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>.oauth2.client.scope=openid,profile,https://www.googleapis.com/auth/spreadsheets <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>.oauth2.resource.<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>-uri=https://www.googleapis.com/oauth2/v3/userinfo</code> </pre><br>  Having connected security to the project, we have already activated <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D1%2583%25D1%2582%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2584%25D0%25B8%25D0%25BA%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F_%25D0%25B2_%25D0%2598%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D0%25B5%25D1%2582%25D0%25B5">basic authentication</a> .  Replace it with something more suitable. <br><br>  Since we read the data from Google, even if it is engaged in user authentication for our application.  To do this, add just one annotation @ EnableOAuth2Sso. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@EnableOAuth</span></span>2Sso <span class="hljs-meta"><span class="hljs-meta">@SpringBootApplication</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//.. }</span></span></code> </pre><br>  An SSO authentication point will be created and configured.  No need to override the WebSecurityConfigurerAdapter.  We just have to set a couple of parameters in the configuration. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">security</span></span>.ignored=/ <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>.basic.enabled=<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>.oauth2.sso.<span class="hljs-keyword"><span class="hljs-keyword">login</span></span>-<span class="hljs-type"><span class="hljs-type">path</span></span>=/oauth2callback</code> </pre><br>  In this case, the login-path must match the URI for the redirect given in the google project.  And the scope parameter must contain the profile value as well. <br><br>  Additional controllers and the interceptor are no longer needed.  Now their work will do spring. <br><br>  Modify the GoogleConnection class.  Credential's we will create using an authorization code stored after authentication in OAuth2 context.  And we will take client data from the application config. <br><br><div class="spoiler">  <b class="spoiler_title">GoogleConnectionService.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GoogleConnectionService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GoogleConnection</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> OAuth2ClientContext oAuth2ClientContext; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GoogleCredential googleCredentials = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">// .. @Override public Credential getCredentials() { if (googleCredentials == null) { googleCredentials = new GoogleCredential.Builder() .setTransport(Global.HTTP_TRANSPORT) .setJsonFactory(Global.JSON_FACTORY) .setClientSecrets(clientId, clientSecret) .build() .setAccessToken(response.getAccessToken()) .setFromTokenResponse(oAuth2ClientContext .getAccessToken().getValue()); } return googleCredentials; } }</span></span></code> </pre><br></div></div><br>  Displaying data in the browser, error handling, use of the session, logout and other things we leave without consideration.  Their availability and configuration will depend on the specific requirements. <br><br>  That's all.  Working source is on <a href="https://github.com/webcane/google-spreadsheet-api-samples">github'e</a> .  Different approaches - in different branches. </div><p>Source: <a href="https://habr.com/ru/post/321444/">https://habr.com/ru/post/321444/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321434/index.html">Neyrabayesovsky approach to machine learning problems. Lecture by Dmitry Vetrov in Yandex</a></li>
<li><a href="../321436/index.html">YouTrack release 2017.1 and Hub 2017.1</a></li>
<li><a href="../321438/index.html">Offer a project for testing with the PVS-Studio analyzer: now on GitHub</a></li>
<li><a href="../321440/index.html">How to enable JTAG debugging via USB</a></li>
<li><a href="../321442/index.html">Openstack. Detective story or where the connection is lost? Part one</a></li>
<li><a href="../321446/index.html">How does it feel to be a developer in Russia when you're forty</a></li>
<li><a href="../321448/index.html">Load balancing and fault tolerance in Odnoklassniki</a></li>
<li><a href="../321452/index.html">CEF, Angular 2 using .Net Core class events</a></li>
<li><a href="../321454/index.html">Connecting Facebook SDK for Xamarin.Forms</a></li>
<li><a href="../321456/index.html">The method of recursive coordinate bisection for decomposition of computational grids</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>