<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experience in developing a service-oriented system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago we, together with a small team of programmers, began developing a rather interesting from a technical point of view, an analytical proje...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experience in developing a service-oriented system</h1><div class="post__text post__text-html js-mediator-article">  Some time ago we, together with a small team of programmers, began developing a rather interesting from a technical point of view, an analytical project.  Its main purpose was the processing of data obtained from various web pages.  It was necessary to process these data, leading to a convenient form and then analyze the collected statistics. <br><br>  As long as we did not have a large amount of all sorts of data, we did not have any non-standard problems and all solutions were fairly straightforward.  But the project grew, and the size of the information collected, although not very quickly at first, but still increased.  Grew and code base.  And after a while we realized a very sad fact - because of all the crutches and quick fixes, we violated almost all possible design principles.  And if at first the organization of the code was not so important, then over time it became clear that without good refactoring we would not go far. <br><a name="habracut"></a><br><br>  After discussions and reflections, it was decided that for our purposes, the architecture of the ‚Äúparsile‚Äù of the Internet should first of all be service oriented (SOA).  Then we repelled from this approach and identified three main parts of the future system, responsible for the following tasks: <br><ol><li>  Retrieving the contents of pages, data from various services through the API, data from structured files </li><li>  Structuring the information received </li><li>  Analyzing statistics and making recommendations </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a result of this separation, there should have been three independent services: Fetch Service, Parse Service and Analyze Service. <br><br>  * Hereinafter I will use some English-language names for greater convenience of perception and brevity <br><br>  Next came the question of how these services would communicate with each other.  Defining the general mechanism, it was decided to use the concept of pipeline processing (pipeline).  It is quite clear and simple approach when you need to consistently process any information, passing it from one node to another.  A RabbitMQ-based queue mechanism was chosen as the communication bus. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/352/277/0f7/3522770f7b13b346d4383dc46af5e192.png" alt="image"><br><br>  So, with the main architectural model decided.  It turned out quite simple, understandable and quite extensible.  Further I will describe what each service consists of and what allows them to scale. <br><br><h5>  Service Components and Technologies </h5><br>  Let's talk a little about the technologies that are used within each individual service.  In this article, I will mainly describe how the Fetch Service works.  However, other services have a similar architecture.  Below I will describe the general points, or rather the main components.  There are four of them. <br><br>  The first is the data processing module (proccessing module), which contains all the basic logic of working with data.  It is a set of workers who perform tasks.  And the clients who create these tasks.  It uses Gearman as a task server and, accordingly, its API.  The workers and customers themselves are separate processes that are controlled by Supervisord. <br><br>  The next component is the results repository.  Which is a database in MongoDB.  Basically, data is retrieved from web pages, or through various APIs that return JSON.  And MongoDB is convenient enough to store this type of information.  In addition, the structure of the results may vary, new metrics may appear, and so on.  And in this case, we can easily make changes to the structure of documents. <br><br>  And finally, the third component of the system is the queue.  There are two types of queues.  The former are engaged in serving to send requests to services from other services or from external clients (not to be confused with Gearman clients).  Such queues are referred to as Request Queues.  In the case of the Fetch Service, mentioned earlier, the JSON string is sent to this type of queue.  It contains the URL of the desired page or parameters for a request to a third-party API. <br><br>  The second type of queues is Notifications Queues.  In a queue of this type of services they place information about requests that have been processed and the result can be obtained from the repository.  Thus, asynchronous execution of requests for receiving, processing and analyzing data is realized. <br><br>  RabbitMQ was chosen as the message broker.  This is a good solution, it works perfectly, albeit with some problems.  However, for such a system is too heaped up, so it may be better to replace it with something more simple. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/828/64f/1f6/82864f1f6037d10cfd33dcac50e1856b.png" alt="image"><br><br><h5>  Communication </h5><br>  So, communication is provided by queuing and this is an obvious and convenient way to connect various services together.  Next, I will describe the communication process in more detail. <br><br>  There are two types of communication.  Inside the system, between services.  And between the end customer and the system as a whole. <br>  For example, Parse Service requires new data.  He sends a request to the queue for the Fetch Service and continues to go about his business - requests are executed asynchronously. <br>  After the Fetch Service receives the request from the queue, it will perform the necessary actions to extract data from the desired source (web page, file, API) and store it in the storage (MongoDB).  And then it will send a notification of the completion of the operation, which in turn will receive Parse Service to process the latest data. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/676/f5b/06c/676f5b06c4701569f2ad8f3bbb0cc03c.png" alt="image"><br><br><h5>  Fetch service </h5><br>  And finally, I will tell you a little more about the service, which is responsible for obtaining raw data from external sources. <br>  This basic part of the system is the first stage in the data processing pipeline.  The solution of the following tasks falls on him: <br><ol><li>  Getting data from an external source </li><li>  Exception and error handling at this stage (for example, processing HTTP responses) </li><li>  Providing basic information about the received data (headers, statistics of file changes, etc.) </li></ol><br><br>  In itself, the extraction of source data is an important part of most systems where data is structured.  And the service-oriented approach in this case is very convenient. <br>  We just say: ‚ÄúGive me this data‚Äù and get what we want.  In addition, this approach allows you to create different workers for obtaining information from specific sources without forcing customers to think about where the processing material will come from.  You can use different APIs with different formats and protocols.  The entire logic of obtaining target data is isolated at this level. <br><br>  In turn, others can be built on top of this service, implementing more specific logic, such as crawling sites, parsing, aggregation, and so on.  But every time there is no need to take care of network interactions and handle a variety of situations. <br><br>  On this, I probably finish.  Of course there are many more aspects of the development of such systems.  But the most important thing to remember is that you always need to think first about the architecture and use the principle of the only duty.  Isolate system components and link them in a simple and understandable way.  And you get a result that is easy to scale, easy to control and very easy to use in the future. </div><p>Source: <a href="https://habr.com/ru/post/207528/">https://habr.com/ru/post/207528/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../207514/index.html">Sale of e-books and video courses from Packt Publishing</a></li>
<li><a href="../207516/index.html">Why the mobile Internet does not work well</a></li>
<li><a href="../207518/index.html">Very small screen from a very old PDA</a></li>
<li><a href="../207524/index.html">Nanex: A nightmare on Elm Street for high-speed trading. Part 1</a></li>
<li><a href="../207526/index.html">Hard Trucker - unfulfilled dream</a></li>
<li><a href="../207530/index.html">In 2014, the microservice segment will grow by 139%</a></li>
<li><a href="../207532/index.html">Cryptolocker 2.0 or fake?</a></li>
<li><a href="../207536/index.html">Stanislavsky for the robot. How to use the possibilities of emotional synthesis</a></li>
<li><a href="../207538/index.html">How Data Mining Company Lives: Tasks and Research</a></li>
<li><a href="../207540/index.html">NASA celebrates the anniversary of one of the most important photographs ever taken by man.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>