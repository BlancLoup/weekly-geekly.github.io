<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Two-factor authentication with Check Point Security Gateway</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post we will talk about how to configure two-factor authentication in Check Point Security Gateway using electronic keys using the example of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Two-factor authentication with Check Point Security Gateway</h1><div class="post__text post__text-html js-mediator-article">  In this post we will talk about how to configure two-factor authentication in Check Point Security Gateway using electronic keys using the example of JaCarta PKI, a Russian developer of information security solutions. <br><br>  The fact that remote access to the resources of the organization is beneficial, but also creates a number of problems for the IT department, it is said everywhere very much.  We also consider this an important topic.  Therefore, we decided to dedicate this to the next post. <br><br>  The ability to correctly identify users requesting access to the information system is achieved through the use of integrated access control solutions. <br><a name="habracut"></a><br>  Implementing solutions for remote access without strong user authentication is equivalent to storing important data in a safe cell, the key of which is stored on the nearest coffee table. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Good user authentication solutions mean guaranteed access to company resources only by authorized users. <br><br>  PKI is an effective authentication method for strong authentication systems in terms of functionality, security, and dependency. <br><br><h2>  Jacarta client </h2><br>  JaCarta Client - software that allows you to build infrastructure with public keys using key media <a href="https://new.aladdin-rd.ru/catalog/jacarta-pki">JaCarta PKI</a> .  This software allows you to use secure transmission of information based on public key infrastructure. <br><br>  Electronic keys can be supplied in various form factors, including USB tokens, smart cards, including  with wide customization possibilities (logo application, use of corporate style, etc.).  All form factors are managed by a single interface, the JaCarta Client software.  JaCarta Client has unified work methods, such as PKCS # 11, CAPI, which provide support for many out-of-box applications that support these interfaces.  Scenarios such as secure web login, secure login, data encryption, mail encryption are supported.  PKI keys and certificates can be created, placed and used in the most secure way using hardware or software tokens. <br><br>  In combination with keys, the <a href="https://new.aladdin-rd.ru/catalog/jms">JaCarta Management System is</a> most often used, which provides the organization with a comprehensive key lifecycle management platform.  JMS associates identifiers with users, allowing you to control the certificates they use.  JMS allows you to scale the system without the threat of disruption. <br><br>  Check Point Security GateWay protects internal and external networks, public and private clouds from internal and external security threats by protecting virtual machines and applications with the full range of Check Point Software Blades protection tools. <br><br>  In this post, we will describe in detail the steps to configure support for logging into a remote network using a user's certificate using a smart card or a JaCarta PKI hardware token.  This implies that the Check Point Security GateWay environment is already configured with static user passwords for authentication. <br><br><h2>  Software Requirements </h2><br>  The information in the post applies to: <br><br><ul><li>  JaCarta Client - software that manages tokens <a href="https://www.aladdin-rd.ru/catalog/jacarta/">JaCarta</a> developed by <a href="https://new.aladdin-rd.ru/company">‚ÄúAladdin RD‚Äù</a> ; <br></li><li>  Check Point Security GateWay. </li></ul><br><h2>  Environment </h2><br>  The software versions that were used to prepare the configuration instructions. <br><br><ul><li>  JaCarta PKI Client <br></li><li>  CheckPoint GAIA <br></li><li>  CheckPoint Endpoint Security Client </li></ul><br><h2>  Who will be interested in what we will discuss next </h2><br>  In fact, the instruction that will be discussed later will be of interest to system administrators who are familiar with the Check Point Security Gateway family and are interested in using the capabilities of multi-factor authentication using smart cards and JaCarta USB tokens. <br><br>  <b>Authentication with certificates using the JaCarta PKI Client.</b> <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/653/bc7/346/653bc7346d4b4c219a18cc6188e653d4.jpg"></div><br><br>  The diagram below shows the certificate authentication script. <br><br>  The user connects to the Check Point Security Gateway Appliance using the Check Point Security Gateway client application.  The user inserts the JaCarta PKI token, on which his certificate is located, enters the token's PIN. <br><br>  After successful authentication, the user gets access to internal network resources. <br><br><h2>  Prerequisites </h2><br>  It describes the prerequisites that must be met before setting up two-factor certificate authentication for Check Point Security Gateway using JaCarta PKI. <br><br>  To use certificate authentication, you must install and configure the Microsoft Certificate Authority.  Any CA can be used as a Certification Authority, but this document considers Microsoft CA only. <br><br>  Users must have JaCarta PKI tokens with the appropriate certificates issued for them. <br><br>  JaCarta PKI Client version 6.30 and higher must be installed on users' computers. <br><br><h2>  Supported Tokens and Smart Cards </h2><br>  USB tokens: <br><br><ul><li>  JaCarta PKI; <br></li><li>  JaCarta PKI / Flash; <br></li><li>  JaCarta PKI / GOST; <br></li><li>  JaCarta PKI / GOST / Flash. </li></ul><br>  Smart Cards: <br><br><ul><li>  JaCarta PKI; <br></li><li>  JaCarta PKI / GOST. </li></ul><br>  <i>Smart cards require an ASEDriveIII USB reader.</i> <br><br><h2>  Configuring Check Point Security Gateway </h2><br>  Check Point SmartDashboard can be used to configure CheckPoint SSL VPN or IPSec VPN. <br><br>  Configuring Check Point Security Gateway requires a series of actions. <br><br><ul><li>  Create a user account and issue a registration key. <br></li><li>  Creating a user group. <br></li><li>  Allow authentication for VPN clients. <br></li><li>  Install policy. <br></li><li>  Install certificate. <br></li><li>  Permission to control the removal of a smart card. </li></ul><br><h2>  Creating a user and issuing a registration key </h2><br>  A user is created with a specific authentication scheme to log on to the Check Point Security VPN Client.  The administrator then initiates the process of issuing the certificate to the Security Management Server and receives the registration key. <br><br><ul><li>  Open Check Point SmartDashboard R77. <br></li><li>  On the login screen, fill in the following fields and click ‚ÄúLogin‚Äù. <br></li><li>  Username - enter your username. <br></li><li>  Password - enter the password for the user. <br></li><li>  Servername or Server IP Adress - select the name or IP address of the server where Check Point Security Gateway is located. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/7fa/fb9/21c/7fafb921cecc4ec6862fb03475169723.png"></div><br></li><li>  In the main Check Point SmartDashboard window, under Check Point SmartDashboard, click on Users and then click on New User&gt; Default. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/6fb/11a/191/6fb11a191faf4b409030d2825c8ccbb7.png"></div><br></li><li>  In the user settings window, in the user name field, enter the user name. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/e42/75c/2b9/e4275c2b9981448db0a96213e724f435.png"></div><br></li><li>  Click on Certificates. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/aad/fe8/331/aadfe83317d942e8b886c62c8b1e7342.png"></div><br></li><li>  Click on New, then choose Registration Key for certificate enrollment. <br></li><li>  The Registration Key is displayed in the Registration Key for Certificate Enrollment window. <br></li><li>  Copy this registration key, save it - you will need it for further registration. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/4bd/4ae/767/4bd4ae767d9344b4a88864e3ef5708bb.png"></div><br></li><li>  In the user settings window, in the list of certificates, a pending installation certificate is added.  Click OK. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/ea6/68d/ec2/ea668dec2a2f4862ba2ca8cdba9af78a.png"></div><br></li></ul><br><h2>  Create user group </h2><br>  User groups - a set of users with common tasks or responsibilities.  User groups, like individual users, can be processed in security policies. <br><br>  <i>Creating groups allows you to assign tasks to specific users.</i>  <i>The gateway does not allow you to define rules for specific users, but you can assign specific rules to groups of users.</i> <br><br><ol><li>  In the main Check Point SmartDashboard window, under Users and Administrators, right-click on User Groups, and then New Group. <br><br><div style="text-align:center;"><img width="200" hspace="5" src="https://habrastorage.org/web/92b/349/c2c/92b349c2c98f432fb53f6b667f4e0842.png"></div><br><br></li><li>  In the Group Properties window, complete the following fields, and then click OK. <br></li><li>  Name ‚Äî Enter the name of the group, for example, VPN_Group. <br></li><li>  Available Members / Selected Members - in the list of available members, select members to add to the group, then click Add.  Selected members will be moved to the Selected Members list. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/4cd/a3e/009/4cda3e00961c4c179f39c69e6288f672.png"></div></li></ol><br><h2>  Allow authentication for VPN clients </h2><br><ul><li>  In the main Check Point SmartDashboard window, under Network Objects, open Check Point, right-click on your device, for example, Checkpoint-ssl, then click on Edit. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/c7a/573/50f/c7a57350fd424205b37daa8b39a52dd6.png"></div><br><br></li><li>  In the Check Point Gateway - Checkpoint-ssl window, open VPN Clients, then click Authentication. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/e92/46e/e64/e9246ee64d1649b487f5cb45ef4a47d2.png"></div><br><br></li><li>  In the Authentication Method, select Defined on user record (Legacy Authentication) and then click OK. </li></ul><br><h2>  Configure Filtering Rules for VPN Clients </h2><br>  Security gateways have at least one hardware platform that is used as an entry point into the corporate network. <br><br>  Gateway rules define permissions and denial policies for the gateway.  Gateway rules are based on the concept of objects.  For example, network objects can be used as the source and destination of rules. <br><br><ul><li>  In the main Check Point SmartDashboard window, click on the Firewall. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/2da/f8c/826/2daf8c8260c744979ddd5f1ea6ce369a.png"></div><br></li><li>  Click on Policy, then on the Add rule at bottom icon.  A line is added under the Policy menu. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/acf/511/45d/acf51145dba04854b642e2c6488e83c8.png"></div><br></li><li>  In the Name column - right click on the new line and then Edit. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/7f0/b8a/221/7f0b8a221cb34cf5b75359d0306d149b.png"></div><br></li><li>  In the Rule Name window, in the Rule Name field, add a name for the rule, then click OK. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/435/f2c/532/435f2c532ec74c0393c8ad5266ae05fc.png"></div><br></li><li>  In the Destination column - right click on the new line, then click on the Network Object. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/148/6c4/bc4/1486c4bc4b364692a2235f299ed19ab9.png"></div><br></li><li>  In the Add Object window, select Internal_network.  Internal_network is a synonym for the corporate network of an enterprise. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/ab7/44a/bfa/ab744abfa3604365b4447f5c13e4cfd7.png"></div><br></li><li>  In the VPN column - right click on the new line, then Edit Cell. <br></li><li>  In the VPN Match Conditions window, perform the following steps and click OK. <br></li><li>  Select Only connections encrypted in specific VPN communities, click ADD. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/061/1ef/6d1/0611ef6d13c04bc58a52369a8bf0b8de.png"></div><br></li><li> In the Add Community to rule window, select RemoteAccess and click OK. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/b4a/4de/6df/b4a4de6dfeac46c987442961ee58b746.png"></a> </div></li></ul><br>  New policy created. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/b74/bbf/351/b74bbf35101642f286c213bd1269f77f.png"></a> </div><br><br><h2>  Policy setting </h2><br><ul><li>  The policy installation process is shown below. <br></li><li>  Conduct a heuristic verification of the rules in order to verify the compatibility and non-redundancy of the rules. <br></li><li>  Confirm that each Security Gateway to which the rule will apply ensures that at least one rule is observed. <br></li><li>  Convert the Security Policy into a control script and compile this script into an inspection code. <br></li><li>  Deliver the inspection code to all selected items for delivery. <br></li><li>  In the main Check Point SmartDashboard window - click on Install Policy above (in the menu). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/c66/380/2ca/c663802cad4d4ebd922f9fa20e0fcb21.png"></div><br></li><li>  In the Install Policy window, in the Network Security column, select the options for the required device and click OK. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/058/f71/247/058f71247a084b4bbd67b1c49d27c6b5.png"></div><br></li><li>  When the policy is established, click Close. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/9f9/ffd/e20/9f9ffde20f194336aa7690aeada5ea9f.png"></div></li></ul><br><h2>  Certificate installation </h2><br>  The client establishes a secure connection with the Check Point internal certificate authority, requests certificates using the registration key.  When requesting a user certificate for the first time, provide the registration key and install the certificate on the token. <br><br><ul><li>  Insert the JaCarta PKI into the USB slot, then open the Check Point Endpoint Security application. <br></li><li>  The IP address in the Site field is the same as the one entered during installation.  Also during the installation, certificates were selected as the authentication option.  Click on the link Click here if you don't have a certificate for this site. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/381/f94/872/381f948724c8491a8ae0667c6796bdf9.png"></div><br></li><li>  In the Provider field, select the Athena Smart Card CSP. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/1fb/346/ae2/1fb346ae2d8a47868c52799dcca8fbe9.png"></div><br></li><li>  In the Registration Key field, enter the registration key previously saved, click Enroll. <br></li><li>  In the Token Logon window, in the Token Password field, enter the user PIN from your JaCarta PKI, then click OK. <br></li><li>  A security message prompts you to install a new root certificate, press YES.  This certificate belongs to the Check Point Internal Certification Authority. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/b8b/cf0/776/b8bcf0776e6c4d60894041ae4f9bdc48.png"></div><br></li><li>  When the installation is complete, click OK. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/8cd/d08/dac/8cdd08dac56d4b3a9fa74703530af57b.png"></div><br></li><li>  Open the JaCarta PKI Client and verify that the certificate was successfully issued. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/000/65a/976/00065a976ac94fda952594694db41966.png"></div></li></ul><br><h2>  Smart Card Removal Control </h2><br><ul><li>  On the Check Point Gateway, you need to edit the file. <br>  $ FWDIR / conf / trac_client_1.ttm, using the editor VI or any other. <br></li><li>  Next, you need to find the line disconnect_on_smartcard_removal. <br><br><pre><code class="cpp hljs">*:disconnect_on_smartcard_removal ( gateway ( :<span class="hljs-keyword"><span class="hljs-keyword">default</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) ) )*</code> </pre> <br></li><li>  Modify default parameters as required: <br><ul><li>  true - enable detection of smart card extraction for the current gateway; <br></li><li>  false - disable detection of smart card extraction for the current gateway; <br></li><li>  client_deside ‚Äî allow the user to independently set the smart card extraction detection parameter for the current gateway. </li></ul><br></li><li>  Next, you need to save the file and exit edit mode. <br></li><li>  Install a policy using Smart DashBoard. <br></li><li>  On the client computer, open the Check Point Endpoint Security settings window and check the box next to Enable always-connect. </li></ul><br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/web/915/3b7/6f3/9153b76f370a45508a4ce5824083942e.png"></a> </div><br><h2>  Gateway Login </h2><br>  Open the Check Point Endpoint Security application. <br><br><ul><li>  Insert the JaCarta PKI.  Certificates on the token will be displayed in the Certificate field.  Click Connect. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/52b/c6c/fa7/52bc6cfa752547ed9a5a715286f48d6b.png"></div><br></li><li>  In the Token Logon window, in the Password field, enter the PIN from the token and click OK. <br></li><li>  In the taskbar, click the VPN icon to view the connection status.  When authentication is successful, the connection status becomes Connected. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/web/bca/e28/24b/bcae2824b3e245d28ee90418f9de4627.png"></div></li></ul><br>  Similar and other interesting projects in ‚ÄúAladdin RD‚Äù are led by the department for working with technology partners. <br><br>  We are currently expanding the staff of specialists, and we have a vacancy in this department - <a href="https://new.aladdin-rd.ru/company/job/tech-engineer/view">Partner Engineer / Presale Engineer</a> . <br><br>  If you are interested in working at Aladdin RD, please send your resume indicating the desired position to <a href="">job@aladdin-rd.ru</a> . <br><br>  We welcome your feedback! </div><p>Source: <a href="https://habr.com/ru/post/335250/">https://habr.com/ru/post/335250/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335240/index.html">Extending, modifying, and creating controls on the UWP platform. Part 3</a></li>
<li><a href="../335242/index.html">IT at the Otkritie Arena stadium. When the adrenaline in the project is not less than during the match</a></li>
<li><a href="../335244/index.html">A practical guide to using CSS Modules in React applications</a></li>
<li><a href="../335246/index.html">The client is at the helm, or why should the provider give the wheel</a></li>
<li><a href="../335248/index.html">Math Detective: Finding Positive Whole Solutions to an Equation</a></li>
<li><a href="../335252/index.html">A social network for film fans or how not to dig in, developing another social network</a></li>
<li><a href="../335254/index.html">How development workflow affects task decomposition</a></li>
<li><a href="../335256/index.html">Multiprotocol NAS access to Netapp resources with ACLs</a></li>
<li><a href="../335260/index.html">What happens at the junction of the database and operating system?</a></li>
<li><a href="../335262/index.html">How to avoid mistakes when changing CRM</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>