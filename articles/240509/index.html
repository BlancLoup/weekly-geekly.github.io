<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Docker: running graphical applications in containers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Strictly speaking, Docker was not created for this kind of things, namely the launch of graphical applications. However, from time to time there are q...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Docker: running graphical applications in containers</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/files/17f/891/871/17f89187147c4df09ab190ab2a48b4a8.png">  Strictly speaking, Docker was not created for this kind of things, namely the launch of graphical applications.  However, from time to time there are questions in Docker topics about whether it is possible to launch a GUI application in a container.  The reasons may be different, but more often than not, this desire to change an unnecessarily bulky virtual machine to something easier, without losing in convenience and retaining a sufficient level of isolation. <br><br>  This is a brief overview of how to launch graphical applications in Docker containers. <br><a name="habracut"></a><br><h2>  Table of contents </h2><br><ul><li>  <a href="https://habr.com/ru/post/240509/">Mounting devices</a> ( <a href="https://habr.com/ru/post/240509/">Example # 1</a> ) <br></li><li>  <a href="https://habr.com/ru/post/240509/">SSH-X</a> ( <a href="https://habr.com/ru/post/240509/">Example # 2</a> ) </li><li>  <a href="https://habr.com/ru/post/240509/">Subuser</a> ( <a href="https://habr.com/ru/post/240509/">Example # 3</a> ) </li><li>  <a href="https://habr.com/ru/post/240509/">Remote Desktop</a> ( <a href="https://habr.com/ru/post/240509/">Exhibit # 4</a> ) </li><li>  <a href="https://habr.com/ru/post/240509/">Related Links</a> </li></ul><br><h2><a name="mount"></a>  Mounting devices </h2> <br>  One of the easiest ways to get a container to talk and show is to give it access to our screen and sound devices. <br><br>  In order for applications in the container to connect to our screen, you can use Unix domain sockets for X11, which are usually located in the <code>/tmp/.X11-unix</code> directory.  Sockets can be shared by mounting this directory with the <code>-v</code> .  You also need to set the <a href="http://www.x.org/releases/X11R7.7/doc/man/man7/X.7.xhtml">DISPLAY</a> environment variable, which gives applications a screen for displaying graphics.  Since we will be outputting to our screen, it is enough to copy the host machine's DISPLAY value.  Usually, this is <code>:0.0</code> or simply <code>:0</code> .  An empty hostname (before the colon) <a href="http://www.x.org/releases/X11R7.7/doc/man/man1/Xorg.1.xhtml">implies a</a> local connection using the most efficient transport, which in most cases means Unix-domain sockets - just what we need: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs">$ docker run -e DISPLAY=unix<span class="hljs-variable"><span class="hljs-variable">$DISPLAY</span></span> -v /tmp/.X11-unix:/tmp/.X11-unix &lt;image&gt;</code> </pre><br>  The prefix ‚Äúunix‚Äù to DISPLAY is here to explicitly indicate the use of unix sockets, but more often than not, this is not necessary. <br><br><h4>  Authorisation Error </h4><br>  At startup, you may encounter an error of the form: <br><br><pre> No protocol specified
 Error: cannot open display: unix: 0.0
</pre><br>  This happens when the <a href="http://www.x.org/releases/X11R7.7/doc/man/man7/Xsecurity.7.xhtml">Xsecurity</a> extension blocks unauthorized connections to the X server.  This problem can be solved, for example, by allowing all local non-network connections: <br><br><pre> <code class="bash hljs">$ xhost +<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>:</code> </pre><br>  Or restrict permission to root-user only: <br><br><pre> <code class="bash hljs">$ xhost +si:localuser:root</code> </pre><br>  In most cases this should be enough. <br><br><div class="spoiler">  <b class="spoiler_title">For those who are not looking for easy ways</b> <div class="spoiler_text">  Another option would be to enable the container to independently authenticate on the X-server using a pre-prepared and mounted Xauthority file.  You can create one using the <a href="http://www.x.org/releases/X11R7.7/doc/man/man1/xauth.1.xhtml">xauth</a> utility, which is able to extract and export data for authorization.  The snag, however, is that such an authorization record contains the name of the host on which the X server is running.  Just copying it into a container is useless - the record will be ignored when trying to connect to the server locally.  This problem can be solved in different ways.  I will describe a couple of ways. <br><br>  <b>The substitution of the host name</b> .  The idea is simple.  Extract the authorization entry using the <code>xauth list</code> , change the host name to another (you need to think up in advance) and export the resulting key to the Xauthority file, which we then mount into the container: <br><pre> <code class="bash hljs">$ DOCKER_CONTAINER_HOSTNAME=foobar $ xauth list <span class="hljs-variable"><span class="hljs-variable">$DISPLAY</span></span> | sed -e <span class="hljs-string"><span class="hljs-string">"s/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOSTNAME</span></span></span><span class="hljs-string">/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$DOCKER_CONTAINER_HOSTNAME</span></span></span><span class="hljs-string">/"</span></span> | xargs xauth -f /tmp/.docker.Xauthority add $ docker run -e DISPLAY=<span class="hljs-variable"><span class="hljs-variable">$DISPLAY</span></span> -v /tmp/.X11-unix:/tmp/.X11-unix \ -v /tmp/.docker.Xauthority -e XAUTHORITY=/tmp/.docker.Xauthority -h <span class="hljs-variable"><span class="hljs-variable">$DOCKER_CONTAINER_HOSTNAME</span></span> &lt;image&gt;</code> </pre><br>  <b>Connection code substitution</b> .  The first two bytes in each entry from the Xauthority file contain the connection family matching code (TCP / IP, DECnet, local connections).  If you assign the <a href="http://www.x.org/releases/X11R7.7/doc/man/man7/Xsecurity.7.xhtml">FamilyWild</a> special value (code 65535 or 0xffff) to this parameter, the entry will correspond to any screen and can be used for any connection (that is, the host name will not have a value): <br><pre> <code class="bash hljs">$ xauth nlist <span class="hljs-variable"><span class="hljs-variable">$DISPLAY</span></span> | sed -e <span class="hljs-string"><span class="hljs-string">'s/^..../ffff/'</span></span> | xauth -f /tmp/.docker.Xauthority nmerge - $ docker run -e DISPLAY=<span class="hljs-variable"><span class="hljs-variable">$DISPLAY</span></span> -v /tmp/.X11-unix:/tmp/.X11-unix \ -v /tmp/.docker.Xauthority -e XAUTHORITY=/tmp/.docker.Xauthority &lt;image&gt;</code> </pre><br>  Peeped on <a href="http://stackoverflow.com/a/25280523">stackoverflow</a> . <br></div></div><br><h4>  And what about the sound? </h4><br>  Connecting sound devices is also not a big deal.  In Docker versions up to 1.2, they can be mounted using the <code>-v</code> parameter, while the container should be running in privileged mode: <br><br><pre> <code class="bash hljs">$ docker run -v /dev/snd:/dev/snd --privileged &lt;image&gt;</code> </pre><br>  A special option <code>--device</code> for connecting devices has been added to Docker 1.2.  Unfortunately, at the moment (version 1.2), <code>--device</code> as the value can take only one device at a time, which means you have to explicitly list them all.  For example: <br><br><pre> <code class="bash hljs">$ docker run --device=/dev/snd/controlC0 --device=/dev/snd/pcmC0D0p --device=/dev/snd/seq --device=/dev/snd/timer &lt;image&gt;</code> </pre><br>  Perhaps the function of processing all devices in the directory via <code>--device</code> will be added in future releases (there is a corresponding <a href="https://github.com/docker/docker/issues/7721">request</a> on github). <br><br><h4>  Eventually </h4><br>  To summarize, the command to launch a container with a graphics application looks like this: <br><br><pre> <code class="bash hljs">$ docker run -v /tmp/.X11-unix:/tmp/.X11-unix -e DISPLAY=unix<span class="hljs-variable"><span class="hljs-variable">$DISPLAY</span></span> \ --device=/dev/snd/controlC0 --device=/dev/snd/pcmC0D0p \ --device=/dev/snd/seq --device=/dev/snd/timer &lt;image&gt;</code> </pre><br>  Or, for Docker versions below 1.2: <br><br><pre> <code class="bash hljs">$ docker run -v /tmp/.X11-unix:/tmp/.X11-unix -e DISPLAY=unix<span class="hljs-variable"><span class="hljs-variable">$DISPLAY</span></span> \ -v /dev/snd:/dev/snd --privileged &lt;image&gt;</code> </pre><br><h4><a name="mount_example"></a>  Example ‚Ññ1 </h4><br>  I thought that some audio player with a graphical interface would be suitable for checking graphics and sound and selected <a href="http://deadbeef.sourceforge.net/">DeaDBeeF</a> as a test subject.  To start, we do not need anything except an image with the installed player. <br><br>  Dockerfile: <br><pre> <code class="bash hljs">FROM debian:wheezy ENV DEBIAN_FRONTEND noninteractive RUN apt-get update RUN apt-get install -yq wget <span class="hljs-comment"><span class="hljs-comment">#  deadbeef RUN wget -P /tmp 'http://sourceforge.net/projects/deadbeef/files/debian/0.6.2/deadbeef-static_0.6.2-2_amd64.deb' \ &amp;&amp; dpkg -i /tmp/deadbeef-static_0.6.2-2_amd64.deb || true \ &amp;&amp; apt-get install -fyq --no-install-recommends \ &amp;&amp; ln -s /opt/deadbeef/bin/deadbeef /usr/local/bin/deadbeef \ &amp;&amp; rm /tmp/deadbeef-static_0.6.2-2_amd64.deb #       ENTRYPOINT ["/opt/deadbeef/bin/deadbeef"]</span></span></code> </pre><br>  Let's collect an image: <br><br><pre> <code class="bash hljs">$ docker build -t deadbeef .</code> </pre><br>  Now you can start it and listen to, for example, the radio (if you decide to try it - keep in mind that the player will start at full volume): <br><br><pre> <code class="bash hljs">$ docker run --rm -v /tmp/.X11-unix:/tmp/.X11-unix -e DISPLAY=unix<span class="hljs-variable"><span class="hljs-variable">$DISPLAY</span></span> \ --device=/dev/snd/controlC0 --device=/dev/snd/pcmC0D0p --device=/dev/snd/seq --device=/dev/snd/timer \ deadbeef http://94.25.53.133/ultra-128.mp3</code> </pre><br>  The result should be a working player. <br><img src="https://habrastorage.org/files/497/bcf/a30/497bcfa301314bf0a76f337be5c94ded.png"><br><br><h2><a name="ssh_x"></a>  Ssh -x </h2><br>  And that's all you need!  Almost.  The <code>-X</code> when creating an ssh connection enables X11 redirection, which allows displaying a graphical application running on a remote machine on a local machine.  In this case, a remote machine can be understood as a docker container. <br><br>  The ssh server must be installed and running in the container.  You should also make sure that X11 redirection is enabled in the server settings.  You can check this by looking in <code>/etc/ssh/sshd_config</code> and looking for the <code>X11Forwarding</code> parameter (or its synonyms: <code>ForwardX11</code> , <code>AllowX11Forwarding</code> ), which should be set to <code>yes</code> : <br><br><pre> <code class="bash hljs">X11Forwarding yes</code> </pre><br><h4>  And the sound? </h4><br>  In ssh, there is no "magic" option to redirect audio.  But it is still possible to set it up.  For example, using the <a href="http://www.freedesktop.org/wiki/Software/PulseAudio/">PulseAudio</a> sound server, for which you can allow client access ‚Äúfrom outside‚Äù (for example, from a container).  The easiest way to do this is through <a href="http://freedesktop.org/software/pulseaudio/paprefs/">paprefs</a> .  After <code>paprefs</code> you need to go into the PulseAudio settings and in the ‚ÄúNetwork Settings‚Äù tab put a tick in front of ‚ÄúEnable network access to local sound devices‚Äù (enable network access to local audio devices).  You can also find the option ‚ÄúDon't require authentication‚Äù (do not require authorization).  Enabling this option will allow unauthorized access to the server, which can simplify the configuration of docker containers.  For authorized access, you must copy the <code>~/.pulse-cookie</code> file into the container. <br><br>  After changing the settings for PulseAudio, you should restart: <br><br><pre> <code class="bash hljs">$ sudo service pulseaudio restart</code> </pre>  or <br><pre> <code class="bash hljs">$ pulseaudio -k &amp;&amp; pulseaudio --start</code> </pre><br>  In some cases, a reboot may be required.  You can check the settings using the <code>pax11publish</code> , the output of which should look something like this: <br><br><pre> <code class="bash hljs">Server: &lt;...&gt;unix:/run/user/1000/pulse/native tcp:&lt;hostname&gt;:4713 tcp6:&lt;hostname&gt;:4713 Cookie: &lt;...&gt;</code> </pre><br>  Here you can see that the audio server is ‚Äúlistening‚Äù on a unix-socket (unix: / run / user / 1000 / pulse / native), 4713th TCP and TCP6 ports (standard port for PulseAudio). <br><br>  In order for the X-applications in the container to connect to our pulse server, you must specify its address in the environment variable PULSE_SERVER: <br><br><pre> <code class="bash hljs">$ PULSE_SERVER=tcp:172.17.42.1:4713</code> </pre><br>  Here "172.17.42.1" is the address of my docker host.  You can find out this address, for example, like this: <br><br><pre> <code class="bash hljs">$ ip route | awk <span class="hljs-string"><span class="hljs-string">'/docker/ { print $NF }'</span></span> 172.17.42.1</code> </pre><br>  That is, the line "tcp: 172.17.42.1: 4713" says that you can connect to the pulse server by its IP address 172.17.42.1, where it listens on TCP port 4713. <br><br>  In general, this setting is sufficient.  I will only note that when using the above method, the entire sound will be transmitted in the open (unencrypted) form, which, in the case of using the container on the local computer, does not matter.  But if you wish, this traffic can be encrypted.  To do this, PULSE_SERVER should be configured to any free port on localhost (for example: "tcp: localhost: 64713").  As a result, the audio stream will go to the local port 64713, which in turn can be forwarded to the 4713th port of the host machine using <code>ssh -R</code> : <br><br><pre> <code class="bash hljs">$ ssh -X -R 64713:localhost:4713 &lt;user&gt;@&lt;hostname&gt;</code> </pre><br>  The audio data will be transmitted over an encrypted channel. <br><br><h4><a name="ssh_x_example"></a>  Example 2 </h4><br>  As in the previous example, we describe the image of a DeaDBeF player with an ssh server.  I will proceed from the assumption that all the PulseAudio preliminary settings described above have been completed, which means that we can only begin to create a docker image. <br><br>  The installation code of the player will repeat the code from the example earlier.  We just need to add the installation of the openssh server. <br><br>  This time, in addition to the Dockerfile, we will create another file - entrypoint.sh.  This is the script for the ‚Äúentry point‚Äù, i.e.  it will be executed each time the container is started.  In it, we will create a user with a random password, set the PULSE_SERVER environment variable and start the ssh server. <br><br>  Dockerfile: <br><pre> <code class="bash hljs">FROM debian:wheezy ENV DEBIAN_FRONTEND noninteractive RUN apt-get update RUN apt-get install -yq wget <span class="hljs-comment"><span class="hljs-comment">#  deadbeef RUN wget -P /tmp 'http://sourceforge.net/projects/deadbeef/files/debian/0.6.2/deadbeef-static_0.6.2-2_amd64.deb' \ &amp;&amp; dpkg -i /tmp/deadbeef-static_0.6.2-2_amd64.deb || true \ &amp;&amp; apt-get install -fyq --no-install-recommends \ &amp;&amp; ln -s /opt/deadbeef/bin/deadbeef /usr/local/bin/deadbeef \ &amp;&amp; rm /tmp/deadbeef-static_0.6.2-2_amd64.deb #   pulseaudio RUN apt-get install -yq --no-install-recommends pulseaudio RUN apt-get install -yq \ pwgen \ openssh-server #      ssh- RUN mkdir -p /var/run/sshd ADD entrypoint.sh /entrypoint.sh RUN chmod +x /entrypoint.sh EXPOSE 22 ENTRYPOINT ["/entrypoint.sh"]</span></span></code> </pre><br>  The port and address of the pulse server will be passed as parameters when the container is started, in order to be able to change them to non-standard ones (not forgetting the default values). <br><br>  entrypoint.sh: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #    PULSE_SERVER PA_PORT=${PA_PORT:-4713} PA_HOST=${PA_HOST:-localhost} PA_SERVER="tcp:$PA_HOST:$PA_PORT" #     DOCKER_USER=dockerx #    DOCKER_PASSWORD=$(pwgen -c -n -1 12) DOCKER_ENCRYPTED_PASSWORD=$(perl -e 'print crypt('"$DOCKER_PASSWORD"', "aa")') #     , #        docker logs echo User: $DOCKER_USER echo Password: $DOCKER_PASSWORD #   useradd --create-home --home-dir /home/$DOCKER_USER --password $DOCKER_ENCRYPTED_PASSWORD \ --shell /bin/bash --user-group $DOCKER_USER #     PULSE_SERVER  ~/.profile   , #         echo "PULSE_SERVER=$PA_SERVER; export PULSE_SERVER" &gt;&gt; /home/$DOCKER_USER/.profile #  ssh- exec /usr/sbin/sshd -D</span></span></code> </pre><br>  Let's collect an image: <br><br><pre> <code class="bash hljs">$ docker build -t deadbeef:ssh .</code> </pre><br>  Run the container, remembering to specify the host PulseAudio (I will omit the port, since I have it standard), and call it ‚Äúdead_player‚Äù: <br><br><pre> <code class="bash hljs">$ docker run -d -p 2222:22 -e PA_HOST=<span class="hljs-string"><span class="hljs-string">"172.17.42.1"</span></span> --name=dead_player deadbeef:ssh</code> </pre><br>  You can find out the user password for connection using the <code>docker logs</code> : <br><br><pre> <code class="bash hljs">$ docker logs dead_player User: dockerx Password: vai0ay7OuNga</code> </pre><br>  To connect via ssh, you can use the address of both the container itself and the address of the docker host (the connection port will differ from the standard 22nd; in this case it will be 2222 - the one we specified when launching the container).  You can check the container's IP using the <code>docker inspect</code> : <br><br><pre> <code class="bash hljs">$ docker inspect --format <span class="hljs-string"><span class="hljs-string">'{{ .NetworkSettings.IPAddress }}'</span></span> dead_player 172.17.0.69</code> </pre><br>  Connection to the container: <br><br><pre> <code class="bash hljs">$ ssh -X dockerx@172.17.0.69</code> </pre><br>  Or through the docker-gateway: <br><br><pre> <code class="bash hljs">$ ssh -X -p 2222 dockerx@172.17.42.1</code> </pre><br>  Finally, after logging in, you can relax and listen to music: <br><br><pre> <code class="bash hljs">dockerx@5e3add235060:~$ deadbeef</code> </pre><br><br><h2><a name="subuser"></a>  Subuser </h2><br>  <a href="http://subuser.org/">Subuser</a> allows <a href="http://subuser.org/">you</a> to run programs in isolated docker containers, taking all the work involved in creating and customizing containers, so even people who know nothing about docker can use it.  In any case, this is the idea of ‚Äã‚Äãthe project.  For each container application, restrictions are set depending on its purpose ‚Äî limited access to the host directories, network, sound devices, etc.  In essence, the subuser implements a convenient wrapper over the first method described here for launching graphical applications, since the launch is done by mounting the necessary directories, devices, etc. <br><br>  Each perimeter is attached with the file permissions.json, which defines the access settings for the application.  So, for example, this file looks like for a vim image: <br><br><pre> <code class="hljs bash">{ <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"Simple universal text editor."</span></span> ,<span class="hljs-string"><span class="hljs-string">"maintainer"</span></span> : <span class="hljs-string"><span class="hljs-string">"Timothy Hobbs &lt;timothyhobbs (at) seznam dot cz&gt;"</span></span> //       ,<span class="hljs-string"><span class="hljs-string">"executable"</span></span> : <span class="hljs-string"><span class="hljs-string">"/usr/bin/vim"</span></span> //  ,          / //      . : <span class="hljs-string"><span class="hljs-string">"Downloads"</span></span>   <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOME</span></span></span><span class="hljs-string">/Downloads"</span></span> ,<span class="hljs-string"><span class="hljs-string">"user-dirs"</span></span> : [ <span class="hljs-string"><span class="hljs-string">'Downloads'</span></span>, <span class="hljs-string"><span class="hljs-string">'Documents'</span></span> ] //  : [] //    X11  ,<span class="hljs-string"><span class="hljs-string">"x11"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span> //  : <span class="hljs-literal"><span class="hljs-literal">false</span></span> //          ,<span class="hljs-string"><span class="hljs-string">"sound-card"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span> //  : <span class="hljs-literal"><span class="hljs-literal">false</span></span> //     ,         / ,<span class="hljs-string"><span class="hljs-string">"access-working-directory"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span> //  : <span class="hljs-literal"><span class="hljs-literal">false</span></span> //      ,<span class="hljs-string"><span class="hljs-string">"allow-network-access"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span> //  : <span class="hljs-literal"><span class="hljs-literal">false</span></span> }</code> </pre><br>  Subuser has a <a href="https://github.com/subuser-security/subuser-default-repository">repository</a> (at the moment - a small) ready-made applications, a list of which can be seen using the command: <br><br><pre> <code class="bash hljs">$ subuser list available</code> </pre><br>  Add an application from the repository, you can: <br><br><pre> <code class="bash hljs">$ subuser subuser add firefox-flash firefox-flash@default</code> </pre><br>  This command will install the application, calling it firefox-flash, based on the same image from the default repository. <br><br>  Running the application looks like this: <br><br><pre> <code class="bash hljs">$ subuser run firefox-flash</code> </pre><br>  In addition to using the standard repository, you can create and add your own subuser-applications. <br><br>  The project is quite young and still looks damp, but it performs its task.  The project code can be found on github: <a href="https://github.com/subuser-security/subuser">subuser-security / subuser</a> <br><br><h4><a name="subuser_example"></a>  Example number 3 </h4><br>  Let's create a subuser application for the same DeaDBeef.  For the demonstration, create a local subuser repository (nothing more than a git repository).  The <code>~/.subuser-repo</code> directory will come down.  It should initialize the git repository: <br><br><pre> <code class="bash hljs">$ mkdir ~/.subuser-repo $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/.subuser-repo $ git init</code> </pre><br>  Here we will create a directory for DeaDBeef: <br><br><pre> <code class="bash hljs">$ mkdir deadbeef</code> </pre><br>  The directory structure for the subuser image is as follows: <br><br><pre> <code class="bash hljs">image-name/ docker-image/ SubuserImagefile docker-build-context... permissions.json</code> </pre><br>  SubuserImagefile is the same Dockerfile.  The only difference is in the ability to use the <code>FROM-SUBUSER-IMAGE</code> , which accepts the identifier of an existing subuser image as an argument.  A list of available base images can be found here: <a href="https://github.com/subuser-security/subuser-examples/tree/master/SubuserBaseImages">SubuserBaseImages</a> . <br><br>  So, having prepared the directory structure, it remains to create two files: SubuserImagefile and permissions.json. <br><br>  SubuserImagefile is practically no different from the Dockerfile given earlier: <br><br><pre> <code class="bash hljs">FROM debian:wheezy ENV DEBIAN_FRONTEND noninteractive RUN apt-get update RUN apt-get install -yq wget <span class="hljs-comment"><span class="hljs-comment">#  deadbeef RUN wget -P /tmp 'http://sourceforge.net/projects/deadbeef/files/debian/0.6.2/deadbeef-static_0.6.2-2_amd64.deb' \ &amp;&amp; dpkg -i /tmp/deadbeef-static_0.6.2-2_amd64.deb || true \ &amp;&amp; apt-get install -fyq --no-install-recommends \ &amp;&amp; ln -s /opt/deadbeef/bin/deadbeef /usr/local/bin/deadbeef \ &amp;&amp; rm /tmp/deadbeef-static_0.6.2-2_amd64.deb</span></span></code> </pre><br>  In permissions.json we will describe the access parameters for our player.  We need a screen, sound and internet: <br><pre> <code class="bash hljs">{ <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Ultimate Music Player For GNU/Linux"</span></span>, <span class="hljs-string"><span class="hljs-string">"maintainer"</span></span>: <span class="hljs-string"><span class="hljs-string">"Humble Me"</span></span>, <span class="hljs-string"><span class="hljs-string">"executable"</span></span>: <span class="hljs-string"><span class="hljs-string">"/opt/deadbeef/bin/deadbeef"</span></span>, <span class="hljs-string"><span class="hljs-string">"sound-card"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"x11"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"user-dirs"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Music"</span></span> ], <span class="hljs-string"><span class="hljs-string">"allow-network-access"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"as-root"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre><br>  The <code>as-root</code> allows you to run applications in a container as root.  By default, the subuser starts the container with the <code>--user</code> parameter, giving it the current user ID.  But deadbeef at the same time refuses to run (it cannot create a socket file in a home directory that does not exist). <br><br>  Let's fix the changes in our improvised subuser repository: <br><br><pre> <code class="bash hljs">~/.subuser-repo $ git add . &amp;&amp; git commit -m <span class="hljs-string"><span class="hljs-string">'initial commit'</span></span></code> </pre><br>  Now you can install the player from the local repository: <br><br><pre> <code class="bash hljs">$ subuser subuser add deadbeef deadbeef@file:////home/silentvick/.subuser-repo</code> </pre><br>  Finally, you can start it with the following command: <br><br><pre> <code class="bash hljs">$ subuser run deadbeef</code> </pre><br><br><h2><a name="remote_desktop"></a>  Remote Desktop </h2><br>  Since the container is so similar to a virtual machine, and interaction with it resembles a network one, then a decision immediately comes to mind in the form of remote access systems, such as: <a href="http://www.tightvnc.com/">TightVNC</a> , <a href="https://www.xpra.org/">Xpra</a> , <a href="http://wiki.x2go.org/">X2Go</a> , etc. <br><br>  This option looks more expensive, as it requires the installation of additional software - both in the container and on the local computer.  But it also has advantages, for example: <br><ul><li>  high isolation of the container that increases safety at start of <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BA%25D1%2580%25D1%258B%25D1%2582%25D1%258B%25D0%25B9_%25D0%25B8%25D1%2581%25D1%2585%25D0%25BE%25D0%25B4%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BA%25D0%25BE%25D0%25B4">suspicious</a> programs </li><li>  traffic encryption </li><li>  network data optimization </li><li>  multiplatform </li><li>  as well as the ability to run a full graphical environment </li></ul><br><h4><a name="remote_desktop_example"></a>  Example 4 </h4><br>  As an example, I will use X2Go, because  of the solutions I have tested, he liked his ease of use, as well as the built-in support for broadcasting audio.  To connect to the x2go-server, a special <code>x2goclient</code> program is <code>x2goclient</code> .  More information about server and client installation can be found on the <a href="http://wiki.x2go.org/">official</a> project <a href="http://wiki.x2go.org/">website</a> . <br><br>  As for what we are going to install, you can, of course, install a full-fledged graphical shell like LXDE, XFCE, or even Gnome with KDE in a container.  But it seemed to me unnecessary for the conditions of this example.  We have enough and <a href="http://openbox.org/wiki/Main_Page">OpenBox</a> . <br><br>  In the container, in addition to the x2go server, you also need an ssh server.  Therefore, the code will be in many ways similar to that given in Example 2.  In the part where the player, openssh-server, and pulseaudio server are installed.  That is, it only remains to add the x2go server and openbox: <br><br>  Dockerfile: <br><pre> <code class="bash hljs">FROM debian:wheezy ENV DEBIAN_FRONTEND noninteractive RUN apt-get update RUN apt-get install -yq wget <span class="hljs-comment"><span class="hljs-comment">#  deadbeef RUN wget -P /tmp 'http://sourceforge.net/projects/deadbeef/files/debian/0.6.2/deadbeef-static_0.6.2-2_amd64.deb' \ &amp;&amp; dpkg -i /tmp/deadbeef-static_0.6.2-2_amd64.deb || true \ &amp;&amp; apt-get install -fyq --no-install-recommends \ &amp;&amp; ln -s /opt/deadbeef/bin/deadbeef /usr/local/bin/deadbeef \ &amp;&amp; rm /tmp/deadbeef-static_0.6.2-2_amd64.deb #   pulseaudio RUN apt-get install -yq --no-install-recommends pulseaudio #  ssh-   pwgen    RUN apt-get install -yq \ pwgen \ openssh-server #  ,    ssh- RUN mkdir -p /var/run/sshd #  x2go- RUN echo 'deb http://packages.x2go.org/debian wheezy main' &gt;&gt; /etc/apt/sources.list \ &amp;&amp; echo 'deb-src http://packages.x2go.org/debian wheezy main' &gt;&gt; /etc/apt/sources.list \ &amp;&amp; apt-key adv --recv-keys --keyserver keys.gnupg.net E1F958385BFE2B6E \ &amp;&amp; apt-get update &amp;&amp; apt-get install -yq x2go-keyring \ &amp;&amp; apt-get update &amp;&amp; apt-get install -yq \ x2goserver \ x2goserver-xsession #  openbox RUN apt-get install -yq openbox #    DeaDBeeF   OpenBox. # #       , # ,   ,     menu.xml     ADD RUN sed -i '/&lt;.*id="root-menu".*&gt;/a &lt;item label="DeaDBeeF"&gt;&lt;action name="Execute"&gt;&lt;execute&gt;deadbeef&lt;/execute&gt;&lt;/action&gt;&lt;/item&gt;' \ /etc/xdg/openbox/menu.xml ADD entrypoint.sh /entrypoint.sh RUN chmod +x /entrypoint.sh EXPOSE 22 ENTRYPOINT ["/entrypoint.sh"]</span></span></code> </pre><br>  We will also slightly modify the entrypoint.sh script.  We no longer need to set up the PULSE_SERVER environment variable, so we can get rid of this code.  In addition, the user to connect should be added to the x2gouser group, otherwise he will not be able to start the x2go session: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #     DOCKER_USER=dockerx X2GO_GROUP=x2gouser #    DOCKER_PASSWORD=$(pwgen -c -n -1 12) DOCKER_ENCRYPTED_PASSWORD=$(perl -e 'print crypt('"$DOCKER_PASSWORD"', "aa")') #     , #        docker logs echo User: $DOCKER_USER echo Password: $DOCKER_PASSWORD #   useradd --create-home --home-dir /home/$DOCKER_USER --password $DOCKER_ENCRYPTED_PASSWORD \ --shell /bin/bash --groups $X2GO_GROUP --user-group $DOCKER_USER #  ssh- exec /usr/sbin/sshd -D</span></span></code> </pre><br>  Let's collect an image: <br><br><pre> <code class="bash hljs">$ docker build -t deadbeef:x2go .</code> </pre><br>  Run the container in daemon mode: <br><br><pre> <code class="bash hljs">$ docker run -d -p 2222:22 --name=dead_player deadbeef:x2go</code> </pre><br>  Now that the container is working, you can connect to it using x2goclient, as we would connect to any remote machine.  In the connection settings, you should specify the address of either the container itself or the docker host as the host (in this case, you should also consider the non-standard ssh connection port).  You can find out the login and password for authorization using the <code>docker logs</code> , as shown in example 2.  To start an openbox session, in the ‚ÄúSession type‚Äù settings, select ‚ÄúCustom desktop‚Äù and enter ‚Äúopenbox-session‚Äù in the ‚ÄúCommand‚Äù field. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> After connecting, you can start the player through the openbox menu (right click with the mouse) and check its operation: </font></font><br><div class="spoiler">  <b class="spoiler_title">screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/23f/b38/78b/23fb3878b8f447b3993a712fb9cc0f0c.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If desired, you can achieve a more neat look: </font></font><br><div class="spoiler">  <b class="spoiler_title">screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/994/662/a5b/994662a5b222487aaef43c9578110d7f.png"><br></div></div><br>  But that's another story. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I also add that X2Go allows you to run single applications, as if they were running on a local machine. </font><font style="vertical-align: inherit;">To do this, in the client in the settings of the ‚ÄúSession type‚Äù select ‚ÄúSingle application‚Äù and in the ‚ÄúCommand‚Äù set the path to the executable file. </font><font style="vertical-align: inherit;">At the same time, there is not even a need to install a graphical environment in the container - all you need is to have an X2Go server and the desired application.</font></font><br><br><h2><a name="links"></a>  Related Links </h2><br><ul><li> <a href="https://github.com/docker/docker/tree/master/contrib/desktop-integration"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desktop integration examples</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - a couple of sample images for launching by mounting devices from the official Docker repository</font></font></li><li> <a href="https://github.com/jlund/docker-chrome-pulseaudio"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jlund / docker-chrome-pulseaudio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Google Chrome image using pulseaudio for audio</font></font></li><li> <a href="https://registry.hub.docker.com/u/tomparys/skype/">tomparys/skype</a> ‚Äî skype   (   pulseaudio) </li><li> <a href="http://dockerfile.github.io/">dockerfile/ubuntu-desktop</a> ‚Äî  Ubuntu LXDE  VNC-   </li><li> <a href="https://github.com/rogaha/docker-desktop">rogaha/docker-desktop</a> ‚Äî Ubuntu+FluxBox   Xpra </li><li> <a href="https://github.com/paimpozhil/DockerX2go">paimpozhil/DockerX2go</a> ‚Äî     ,  X2go </li><li> <a href="https://github.com/thewtex/docker-opengl-nvidia">thewtex/docker-opengl-nvidia</a> ‚Äî ,   ,    Nvidia   OpenGL </li><li> <a href="http://stackoverflow.com/questions/16296753/can-you-run-gui-apps-in-a-docker-container">Can you run GUI apps in a docker container?</a> ‚Äî    stackoverflow </li></ul></div><p>Source: <a href="https://habr.com/ru/post/240509/">https://habr.com/ru/post/240509/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../240497/index.html">SAM: your personal "Internet of things"</a></li>
<li><a href="../240499/index.html">SSLv3 POODLE vulnerability - like BEAST, only easier</a></li>
<li><a href="../240501/index.html">Explore the big and small worlds with the Lumia 1020</a></li>
<li><a href="../240505/index.html">How does coworker work actually look like?</a></li>
<li><a href="../240507/index.html">Operating practice: 1000 days without downtime TIER-III data center</a></li>
<li><a href="../240511/index.html">How to identify losses in sales</a></li>
<li><a href="../240517/index.html">Where is the minimum Hello World limit on AVR?</a></li>
<li><a href="../240519/index.html">Persistent Cartesian tree by implicit key</a></li>
<li><a href="../240521/index.html">Anxiety Symptoms Telegram</a></li>
<li><a href="../240523/index.html">How to Start a Startup - Business Course by Y Combinator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>