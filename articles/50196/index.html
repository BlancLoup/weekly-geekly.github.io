<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Calculating the value of an expression</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In continuation of the post Expression Compiler . At the request of readers. Especially for michurin 

 There are many ways to calculate the value of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Calculating the value of an expression</h1><div class="post__text post__text-html js-mediator-article"> <font color="gray"><i>In continuation of the post <a href="http://habrahabr.ru/blogs/development/50139/">Expression Compiler</a> .</i></font>  <font color="gray"><i>At the request of readers.</i></font>  <font color="gray"><i>Especially for <a href="https://habrahabr.ru/users/michurin/" class="user_link">michurin</a></i></font> <br><br>  There are many ways to calculate the value of an expression I like most about the two-stack method. <br>  Like for its elegance and ease of implementation. <br><br>  The essence of the 2-stack method <font color="gray"><i>(surely it has a beautiful scientific name.) Is</i></font> that <b>any difficult expression ultimately boils down to a sequence of simple operations</b> .  In our case, this will be a binary operation on the operands A and B. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will go from left to right, adding operands to one stack, and operations to another.  Each time a new operation is added, we will try to push the old ones out of the stack, guided by the priorities of the operations. <a name="habracut"></a>  <font color="gray"><i>(It is important to note that this is where you can pervert and do everything in 1 stack, but we will stick to the classics)</i></font> <br><br>  Since the words <b>Operator</b> and <b>Operand are</b> very similar, we will use <b>Function</b> instead of <b>Operator</b> . <br>  The stack of <i>operands</i> will be called <b>Q</b> <br>  <i>Operator</i> stack <b>W</b> <br><br>  A simple example: <br>  <b>2 + 2 * 3 - 4</b> <br><ol><li> <code>Q.Push(2)    Q  2 W.Push(+)    W  + Q.Push(2) W.Push(*).   W     +  *.    +  ,  *      . Q.Push(3) W.Push(-) <br>  ‚Äì     *,  ,   *.     2          AB. <br> B &lt;- Q.pop() <br> A &lt;- Q.pop() <br> Q.push(A - B) <br>         ,    .      Q = {8, 4}  W={-} <br> ,     ,            . Q = {4}  W={}</code> </li> <li> <code>Q.Push(2)    Q  2 W.Push(+)    W  + Q.Push(2) W.Push(*).   W     +  *.    +  ,  *      . Q.Push(3) W.Push(-) <br>  ‚Äì     *,  ,   *.     2          AB. <br> B &lt;- Q.pop() <br> A &lt;- Q.pop() <br> Q.push(A - B) <br>         ,    .      Q = {8, 4}  W={-} <br> ,     ,            . Q = {4}  W={}</code> </li> <li> <code>Q.Push(2)    Q  2 W.Push(+)    W  + Q.Push(2) W.Push(*).   W     +  *.    +  ,  *      . Q.Push(3) W.Push(-) <br>  ‚Äì     *,  ,   *.     2          AB. <br> B &lt;- Q.pop() <br> A &lt;- Q.pop() <br> Q.push(A - B) <br>         ,    .      Q = {8, 4}  W={-} <br> ,     ,            . Q = {4}  W={}</code> </li> <li> <code>Q.Push(2)    Q  2 W.Push(+)    W  + Q.Push(2) W.Push(*).   W     +  *.    +  ,  *      . Q.Push(3) W.Push(-) <br>  ‚Äì     *,  ,   *.     2          AB. <br> B &lt;- Q.pop() <br> A &lt;- Q.pop() <br> Q.push(A - B) <br>         ,    .      Q = {8, 4}  W={-} <br> ,     ,            . Q = {4}  W={}</code> </li> <li> <code>Q.Push(2)    Q  2 W.Push(+)    W  + Q.Push(2) W.Push(*).   W     +  *.    +  ,  *      . Q.Push(3) W.Push(-) <br>  ‚Äì     *,  ,   *.     2          AB. <br> B &lt;- Q.pop() <br> A &lt;- Q.pop() <br> Q.push(A - B) <br>         ,    .      Q = {8, 4}  W={-} <br> ,     ,            . Q = {4}  W={}</code> </li> <li> <code>Q.Push(2)    Q  2 W.Push(+)    W  + Q.Push(2) W.Push(*).   W     +  *.    +  ,  *      . Q.Push(3) W.Push(-) <br>  ‚Äì     *,  ,   *.     2          AB. <br> B &lt;- Q.pop() <br> A &lt;- Q.pop() <br> Q.push(A - B) <br>         ,    .      Q = {8, 4}  W={-} <br> ,     ,            . Q = {4}  W={}</code> </li> <li> <code>Q.Push(2)    Q  2 W.Push(+)    W  + Q.Push(2) W.Push(*).   W     +  *.    +  ,  *      . Q.Push(3) W.Push(-) <br>  ‚Äì     *,  ,   *.     2          AB. <br> B &lt;- Q.pop() <br> A &lt;- Q.pop() <br> Q.push(A - B) <br>         ,    .      Q = {8, 4}  W={-} <br> ,     ,            . Q = {4}  W={}</code> </li> <li> <code>Q.Push(2)    Q  2 W.Push(+)    W  + Q.Push(2) W.Push(*).   W     +  *.    +  ,  *      . Q.Push(3) W.Push(-) <br>  ‚Äì     *,  ,   *.     2          AB. <br> B &lt;- Q.pop() <br> A &lt;- Q.pop() <br> Q.push(A - B) <br>         ,    .      Q = {8, 4}  W={-} <br> ,     ,            . Q = {4}  W={}</code> </li> </ol><br>  For example, take the operations + - * / and brackets. <br>  y * and / priority will be equal to 1 <br>  y + and - will be equal to 2 <br>  the opening bracket has a priority of -1 and it does not push anyone out. <br>  A closing bracket pushes all operations up to the first one that opens. <br><br>  Example: <b>2 + 1 - 6 / (1 + 2)</b> <br>  Consider the example in steps: <br><ol><li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> <li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> <li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> <li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> <li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> <li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> <li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> <li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> <li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> <li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> <li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> <li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> <li> <code>Q.push(2) <br> Q = {2} <br> W = { } W.push(+) <br> Q = {2} <br> W = {+} Q.push(1) <br> Q = {2, 1} <br> W = {+} W.push(-) <br>   +  ‚Äì  ,   + <br> Q = {3} <br> W = {-} Q.push(6) <br> Q = {3, 6} <br> W = {-} W.push( / ) <br> Q = {3, 6} <br> W = {-, /} W.push( ( ) <br>     ,        <br> Q = {3, 6} <br> W = {-, /, (} Q.push(1) <br> Q = {3, 6, 1} <br> W = {-, /, (} W.push(+) <br>      .   . <br> Q = {3, 6, 1} <br> W = {-, /, (, +} Q.push(2) <br> Q = {3, 6, 1, 2} <br> W = {-, /, (, +} W.push( ) ) <br>         <br> <font color="gray">     (  )</font> <br> Q = {3, 6, 3} <br> W = {-, /}                ,      <br> Q = {3, 2, 3} <br> W = {-, /} Q = {1} <br> W = {} <br>      .     1  ‚Äì ,          .</code> </li> </ol><br>  In order not to bother with unary operations, we will use the fact that any unary one can be turned into binary.  for example, add one as the second operand (the neutral element) <br>  those.  instead of (-2) we will have (0 - 2) <br><br>  Algorithm in C #: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">double</font> Calc( <font color="#0000ff">string</font> s) <br> { <br> s = <font color="#A31515">'('</font> + s + <font color="#A31515">')'</font> ; <br> Stack&lt; <font color="#0000ff">double</font> &gt; Operands = <font color="#0000ff">new</font> Stack&lt; <font color="#0000ff">double</font> &gt;(); <br> Stack&lt; <font color="#0000ff">char</font> &gt; Functions = <font color="#0000ff">new</font> Stack&lt; <font color="#0000ff">char</font> &gt;(); <br> <font color="#0000ff">int</font> pos = 0; <br> <font color="#0000ff">object</font> token; <br> <font color="#0000ff">object</font> prevToken = <font color="#A31515">''</font> ; <br> <br> <font color="#0000ff">do</font> <br> { <br> token = getToken(s, <font color="#0000ff">ref</font> pos); <br> <font color="#008000">//   +  -</font> <br> <font color="#0000ff">if</font> (token <font color="#0000ff">is</font> <font color="#0000ff">char</font> &amp;&amp; prevToken <font color="#0000ff">is</font> <font color="#0000ff">char</font> &amp;&amp; <br> <font color="#008000">//      (char)prevToken != ')' &amp;&amp;</font> <br> <font color="#008000">//     (2 * -5)   (2 - -4)</font> <br> <font color="#008000">//        ,   2 + -+-+-+2    :)</font> <br> ( <font color="#0000ff">char</font> )prevToken == <font color="#A31515">'('</font> &amp;&amp; <br> (( <font color="#0000ff">char</font> )token == <font color="#A31515">'+'</font> || ( <font color="#0000ff">char</font> )token == <font color="#A31515">'-'</font> )) <br> Operands.Push(0); <font color="#008000">//   </font> <br> <br> <font color="#0000ff">if</font> (token <font color="#0000ff">is</font> <font color="#0000ff">double</font> ) <font color="#008000">//  </font> <br> { <br> Operands.Push(( <font color="#0000ff">double</font> )token); <font color="#008000">//     </font> <br> } <br> <font color="#008000">//         .    ,   ..  ..</font> <br> <font color="#0000ff">else</font> <font color="#0000ff">if</font> (token <font color="#0000ff">is</font> <font color="#0000ff">char</font> ) <font color="#008000">//  </font> <br> { <br> <font color="#0000ff">if</font> (( <font color="#0000ff">char</font> )token == <font color="#A31515">')'</font> ) <br> { <br> <font color="#008000">//  -   .      </font> <br> <font color="#0000ff">while</font> (Functions.Count &gt; 0 &amp;&amp; Functions.Peek() != <font color="#A31515">'('</font> ) <br> popFunction(Operands, Functions); <br> Functions.Pop(); <font color="#008000">//    "("</font> <br> } <br> <font color="#0000ff">else</font> <br> { <br> <font color="#0000ff">while</font> (canPop(( <font color="#0000ff">char</font> )token, Functions)) <font color="#008000">//   </font> <br> popFunction(Operands, Functions); <font color="#008000">//  </font> <br> <br> Functions.Push(( <font color="#0000ff">char</font> )token); <font color="#008000">//     </font> <br> } <br> } <br> prevToken = token; <br> } <br> <font color="#0000ff">while</font> (token != <font color="#0000ff">null</font> ); <br> <br> <font color="#0000ff">if</font> (Operands.Count &gt; 1 || Functions.Count &gt; 0) <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception( <font color="#A31515">"   "</font> ); <br> <br> <font color="#0000ff">return</font> Operands.Pop(); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> popFunction(Stack&lt; <font color="#0000ff">double</font> &gt; Operands, Stack&lt; <font color="#0000ff">char</font> &gt; Functions) <br> { <br> <font color="#0000ff">double</font> B = Operands.Pop(); <br> <font color="#0000ff">double</font> A = Operands.Pop(); <br> <font color="#0000ff">switch</font> (Functions.Pop()) <br> { <br> <font color="#0000ff">case</font> <font color="#A31515">'+'</font> : Operands.Push(A + B); <br> <font color="#0000ff">break</font> ; <br> <font color="#0000ff">case</font> <font color="#A31515">'-'</font> : Operands.Push(A - B); <br> <font color="#0000ff">break</font> ; <br> <font color="#0000ff">case</font> <font color="#A31515">'*'</font> : Operands.Push(A * B); <br> <font color="#0000ff">break</font> ; <br> <font color="#0000ff">case</font> <font color="#A31515">'/'</font> : Operands.Push(A / B); <br> <font color="#0000ff">break</font> ; <br> } <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">bool</font> canPop( <font color="#0000ff">char</font> op1, Stack&lt; <font color="#0000ff">char</font> &gt; Functions) <br> { <br> <font color="#0000ff">if</font> (Functions.Count == 0) <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> <font color="#0000ff">int</font> p1 = getPriority(op1); <br> <font color="#0000ff">int</font> p2 = getPriority(Functions.Peek()); <br> <br> <font color="#0000ff">return</font> p1 &gt;= 0 &amp;&amp; p2 &gt;= 0 &amp;&amp; p1 &gt;= p2; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">int</font> getPriority( <font color="#0000ff">char</font> op) <br> { <br> <font color="#0000ff">switch</font> (op) <br> { <br> <font color="#0000ff">case</font> <font color="#A31515">'('</font> : <br> <font color="#0000ff">return</font> -1; <font color="#008000">//         </font> <br> <font color="#0000ff">case</font> <font color="#A31515">'*'</font> : <font color="#0000ff">case</font> <font color="#A31515">'/'</font> : <br> <font color="#0000ff">return</font> 1; <br> <font color="#0000ff">case</font> <font color="#A31515">'+'</font> : <font color="#0000ff">case</font> <font color="#A31515">'-'</font> : <br> <font color="#0000ff">return</font> 2; <br> <font color="#0000ff">default</font> : <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> Exception( <font color="#A31515">" "</font> ); <br> } <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">object</font> getToken( <font color="#0000ff">string</font> s, <font color="#0000ff">ref</font> <font color="#0000ff">int</font> pos) <br> { <br> readWhiteSpace(s, <font color="#0000ff">ref</font> pos); <br> <br> <font color="#0000ff">if</font> (pos == s.Length) <font color="#008000">//  </font> <br> <font color="#0000ff">return</font> <font color="#0000ff">null</font> ; <br> <font color="#0000ff">if</font> ( <font color="#0000ff">char</font> .IsDigit(s[pos])) <br> <font color="#0000ff">return</font> <font color="#2B91AF">Convert</font> .ToDouble(readDouble(s, <font color="#0000ff">ref</font> pos)); <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">return</font> readFunction(s, <font color="#0000ff">ref</font> pos); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">char</font> readFunction( <font color="#0000ff">string</font> s, <font color="#0000ff">ref</font> <font color="#0000ff">int</font> pos) <br> { <br> <font color="#008000">//         </font> <br> <font color="#008000">//       == &amp;&amp; || mod div   </font> <br> <font color="#0000ff">return</font> s[pos++]; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">string</font> readDouble( <font color="#0000ff">string</font> s, <font color="#0000ff">ref</font> <font color="#0000ff">int</font> pos) <br> { <br> <font color="#0000ff">string</font> res = <font color="#A31515">""</font> ; <br> <font color="#0000ff">while</font> (pos &lt; s.Length &amp;&amp; ( <font color="#0000ff">char</font> .IsDigit(s[pos]) || s[pos] == <font color="#A31515">'.'</font> )) <br> res += s[pos++]; <br> <br> <font color="#0000ff">return</font> res; <br> } <br> <br> <font color="#008000">//       .</font> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> readWhiteSpace( <font color="#0000ff">string</font> s, <font color="#0000ff">ref</font> <font color="#0000ff">int</font> pos) <br> { <br> <font color="#0000ff">while</font> (pos &lt; s.Length &amp;&amp; <font color="#0000ff">char</font> .IsWhiteSpace(s[pos])) <br> pos++; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  This is an elementary example that supports only 4 operations.  But it is very easy to supplement it with &amp;&amp; ||  ^ &amp; |  div mod simply by giving them priority and writing the implementation. <br><br>  You can add variables.  The same algorithm can be used to build trees.  Moreover, the trees will be as computed as possible.  ie, constant branches (not containing variables) can be calculated in advance. <br><br>  Very easy to add operator comma. <br>  (2, 4 + 5, 4) will turn into an array {2, 9, 4} <br><br>  Functions F (x1, x2, ..., xn) is a unary operation on the array {x1, x2, ..., xn} <br><br>  <font color="gray"><i>If you liked the post, next I will write about how I did a small functional language and object-oriented language.</i></font> </div><p>Source: <a href="https://habr.com/ru/post/50196/">https://habr.com/ru/post/50196/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../50184/index.html">Python. Plasma snake</a></li>
<li><a href="../50187/index.html">Nhibernate. DAO + Generic</a></li>
<li><a href="../50189/index.html">Budget planning</a></li>
<li><a href="../50193/index.html">Overburning or how to stuff an unburned</a></li>
<li><a href="../50195/index.html">Kharkiv First Coworking Office</a></li>
<li><a href="../50197/index.html">little bit about the SPARQL access point</a></li>
<li><a href="../50198/index.html">Cable Management</a></li>
<li><a href="../50199/index.html">Aptana - creating plugins</a></li>
<li><a href="../50202/index.html">The Internet is the first billion users.</a></li>
<li><a href="../50204/index.html">continuation and stateful web programming (Updated!)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>