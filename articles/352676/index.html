<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hidden order in color chaos</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I was lucky at work to do what I loved in a strong team with good people. We built and demolished castles in the air, fought with windmills, introduce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hidden order in color chaos</h1><div class="post__text post__text-html js-mediator-article">  I was lucky at work to do what I loved in a strong team with good people.  We built and demolished castles in the air, fought with windmills, introduced, maintained and did not worry.  Once I wanted to build my castle.  Judging from different sides, I decided that it will be small, and I will build it myself, it will be a hobby project.  There were several ideas, I chose one and began to develop, it was a game. <br><a name="habracut"></a><br><h2>  Idea and implementation </h2><br>  The inspiration was the <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D1%2583%25D0%25B1%25D0%25B8%25D0%25BA_%25D0%25A0%25D1%2583%25D0%25B1%25D0%25B8%25D0%25BA%25D0%25B0">Rubik's Cube</a> and the <a href="https://ru.wikipedia.org/wiki/R-%25D1%2584%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D1%258F">R-functions of VL Rvachev</a> .  What is the idea: on the playing field there are elements that are linked into lists.  Chains of related items can be moved within these lists.  An important part of the implementation and gameplay - the geometric arrangement of elements.  In the case of the Rubik's Cube, they are located in a three-dimensional matrix. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6k/1w/vq/6k1wvqxmcofjv9v2lf1_xlxt3wm.png" alt="image alt"></div><br><br>  Now attention.  List nodes do not have to be placed in a rectangular matrix.  They can be arranged arbitrarily, you can make chains of different lengths, impose different conditions on this graph and move along it.  It sounds simple until we try to visualize such a model.  Here we face the first interesting task. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We are used to the fact that game objects have a clear and quite specific size.  However, if we specify arbitrary trajectories of the movement of objects, then when visualizing the puzzle elements, collisions will be inevitable, they will overlap each other.  Solution option - to calculate the size and shape of the elements, depending on their relative position. <br><br><div class="spoiler">  <b class="spoiler_title">In general, it would be interesting to get imitation drops, for example, such:</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/l3/ws/ln/l3wslnb4whw2yd-mp3c6hbcuric.gif" alt="image alt"></div><br></div></div><br>  Looks good.  R-functions will not get such a result, but I drew inspiration from them.  Now we complicate the model to see how it may look like in its entirety.  Drops had to be made more "hard", otherwise the whole image went shaking. <br><br><div class="spoiler">  <b class="spoiler_title">It turned out like this:</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/va/bs/4c/vabs4c_c6hhcj2ml4h9cdbo1r7q.gif" alt="image alt"></div><br></div></div><br>  And again it looks good, and even good.  With the verification of the starting model finished, now you need to extract useful artifacts from it.  After experiments, I stopped at this option. <br><br><ul><li>  To reduce memory consumption, graphic elements (now I‚Äôve started calling them blobs) will be stored in vector format in the form of polygons. </li><li>  To give them a rounded shape, polygons will be rendered with interpolation by splines, as in vector fonts. </li><li>  All the vertices and indices of a separate playing field will lie in one continuous buffer to reduce the number of draw passes. </li></ul><br>  Another small amount of memory for service structures to describe frames.  The result was a data structure ranging in size from 0.5 to 1 MB per playing field.  The size depends on the desired accuracy of the geometric description of blobs and the smoothness of their movement.  There is a model, there is data, it remains to revive them.  After some effort, the initial idea materialized into this gameplay: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ap/cg/uk/apcgukxd3bgt5buqkcfbuc1q_oi.gif" alt="image alt"></div><br>  In the article from the idea to the implementation fit a couple of paragraphs.  In practice, the path traveled was longer, and, of course, it was already well known to me many times.  Therefore, I will dwell only on a few episodes of the work done, which seem to me interesting. <br><br><h2>  Platform Selection and SDK </h2><br>  I approached the choice very far away.  I decided that it should be something cross-platform (or easily portable) and the first implementation should definitely be on a mobile platform, for example, on Android. <br><br>  My professional activities are related to enterprise development primarily on the .net stack, and the words ‚Äúmobile‚Äù and ‚Äúgame‚Äù were something far away for me.  Based on the foregoing, it would be logical to choose the Xamarin or mono-based implementation of other common libraries as the main development tool.  Therefore, after some thought, I decided to write in c ++ and use it as a framework.  As a result, 99.9% of the program code was written on it.  Development and debugging was carried out in Visual Studio under the native Windows OS.  For the mobile platform, only the final build and minor tests were performed. <br><br><h2>  The main thing - do not give up </h2><br>  The smoothness of movement of blobs is an important part of the gameplay, I needed FPS 60 and enough optimization to keep this frame rate on the maximum number of devices.  What happened with the implementation: API OpenGL ES2 is used, with minimal graphics settings in the application (disabled: anti aliasing, highlighting selected chains of blobs, etc.) the main screen is drawn for 3 calls to glDrawElements, with maximum settings from 6 to 9 calls.  In general, it turned out quite sparingly, it would be possible to work on optimization, but disappointment awaited me here.  Under no circumstances did I manage to achieve 60 FPS from my old Galaxy Ace (I thought it would work on it ‚Äî it would work everywhere).  After many experiments and considerable time spent, it finally came to me.  All the time I tried to optimize the shaders and the number of draw-stakes, and the solution to the problem with Galaxy Ace was in a completely different plane.  I excluded this device from my checklist, after which the need to continue to work on optimizing performance has disappeared.  The main thing is not to give up, there will definitely be a solution! <br><br><h2>  A pair of buttons on the interface </h2><br>  Another interesting task is the user interface.  Getting to it, I did not expect that the implementation of the ‚Äúpair of buttons‚Äù would take so long.  It was a very, very big surprise.  To make the ‚Äúbuttons‚Äù work, several render-s were implemented: for text, icons, sprites, rectangles, alignment of elements relative to the screen and each other was added.  Objects are more complex from primitives, behavior is added to them: text labels, buttons, dialog and pop-up windows, etc. Of course, I was concerned with performance and could not just draw the ‚Äúbuttons‚Äù, it had to be done quickly.  And if you need to quickly, then one option - minimize the draw-cola.  As a result, UI elements were combined into groups so that all objects of the same group are drawn in one call.  The bike turned out to be similar to a micro library for UI.  For example, a button is now created like this: <br><br><pre><code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;IControl&gt; button(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Icon( <span class="hljs-string"><span class="hljs-string">"render_group_for_all_controls_on_the_screen"</span></span>, IconType::MenuSolid, <span class="hljs-comment"><span class="hljs-comment">//   SDFStyle::Default, //   SDF   vec2(0, 0.5f), //     size, //  rect::up, //   rect::down, //   parent_button-&gt;GetRenderObject(), //    [](IControl*)-&gt;void {Locator::Resolve&lt;IActivityManager&gt;(true)-&gt;OpenActivity("Levels"); } ));</span></span></code> </pre> <br><h2>  Developer Feedback </h2><br>  As the release approached, I thought about journaling.  The application was ported to Android and tested on a pair of physical devices and emulators.  Obviously not enough to press the ‚Äúpublish‚Äù button with a clear conscience.  We need a centralized error log, which will help in the first days after the release (or the next update) to fix something critical.  Raising my servers is not at all what I would like.  Ready-made solutions for mobile applications did not like, at least free.  Went to the clouds.  In general, all the same.  By coincidence, which is not at all fundamental, I settled on Azure with its blob storage.  According to my expectations, a solution with a remote log in the cloud should be cheap because  the minimum is written to the log and, during normal operation of the application, the logs must be empty.  At the time of this writing, did not have time to check. <br><br><h2>  In conclusion about the main thing </h2><br>  Looking back at the work done and the decisions made, it is absolutely possible to say that the resources, which were already limited, were spent erratically and terribly inefficiently, but on the other hand it was very correct.  Business model, planning, product practices with hypotheses and pivots are very good tools when your project = work.  But if you suddenly have a desire to ‚Äúcompose‚Äù something beyond the usual, the metrics stop working, the goal becomes not the result, but the process.  And the most difficult task in it is to keep this strange and unsteady motivation.  Only with it you can climb into the most inaccessible places.  This was my main challenge during the project.  Probably, like everyone who passed on this road. <br><br>  All this time I have been working on a product, and it is much more than a code or an idea, work on it can never stop, but today I put one more tick: ‚ÄúThe lock is ready‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/352676/">https://habr.com/ru/post/352676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352666/index.html">Use of arbitrary DataFlash of the 25th series instead of expensive Altera FPGA configurators without additional hardware</a></li>
<li><a href="../352668/index.html">"The Internet has become a bit safer": IETF approved TLS 1.3</a></li>
<li><a href="../352670/index.html">How HFT trading contributes to stock market crashes</a></li>
<li><a href="../352672/index.html">JVM contract programming</a></li>
<li><a href="../352674/index.html">Election logo for 37 million VS. for 75 thousand</a></li>
<li><a href="../352678/index.html">NumPy in Python. Part 1</a></li>
<li><a href="../352680/index.html">9 paid, shareware and free programs for tracking application code</a></li>
<li><a href="../352682/index.html">Rsyslog 8. Centralized logging</a></li>
<li><a href="../352684/index.html">VulnHub Basic Pentesting</a></li>
<li><a href="../352686/index.html">SASS: Optimize the media screen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>