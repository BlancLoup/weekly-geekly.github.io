<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Changes in validation of the final version of ASP.NET MVC 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="and a few security issues to watch out for 

 Brad Wilson, one of the developers in the ASP.NET MVC group, reported on his blog about upcoming concept...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Changes in validation of the final version of ASP.NET MVC 2</h1><div class="post__text post__text-html js-mediator-article">  <b>and a few security issues to watch out for</b> <br><br><img src="http://img695.imageshack.us/img695/3133/aspnetmvc2.png" alt="image" align="left">  Brad Wilson, one of the developers in the ASP.NET MVC group, <a href="http://bradwilson.typepad.com/blog/2010/01/input-validation-vs-model-validation-in-aspnet-mvc.html">reported on his blog</a> about upcoming conceptual changes that will be made in the final version of ASP.NET MVC 2. <br><br>  It is about changing one concept of validation, based on form fields, to another - a concept based on a data model.  In this article, I would like to tell you why these changes were made and what they mean for the developer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  For the demonstration, I would like to define a simple data model.  For the sake of example, I chose a simplified model of a single entry of a digg-like service.  In such services, each entry is the text of a link to a useful resource on the network, plus a description of this link. <blockquote>  <em>In the article, I use images to demonstrate the code.</em>  <em>This is due to the fact that I plan to post an article on several resources and spend time on coloring the syntax in each of them I do not want.</em>  <em>Instead, at the end of the article I attach the source code in the form of a finished project.</em> </blockquote>  So, the Story.cs class: <br><br><img src="http://www.gotdotnet.ru/upload/blog/XaocCPS/f38/image_587e8162-9852-4b16-84ec-2981d4f39f85.png" alt="image"><br><br>  Here, besides the Url and Description fields, the Id (identifier), Approved (flag indicating that the entry was moderated) and CreateDate (record creation date) fields are declared.  The Bind attribute in this case indicates that when binding data to an instance of the model, it is not necessary to associate Id values. <br><br>  For the demonstration, we need an input form and a field for outputting the results.  Create the following markup: <br><br><img src="http://www.gotdotnet.ru/upload/blog/XaocCPS/59d/image_47940f71-9e52-44a1-8b95-93e3e21ef467.png" alt="image"><br><br>  Let's try to enter something and look at the result: <br><br><img src="http://www.gotdotnet.ru/upload/blog/XaocCPS/354/image_47b48bfd-236b-4c0b-9b06-d4cf9e6fac0e.png" alt="image"><br><br>  At first glance, everything is in order, except for the fact that there is no validation in our code.  We modify the data model class using the attributes DataAnnotations to support validation: <br><br><img src="http://www.gotdotnet.ru/upload/blog/XaocCPS/ae1/image_559302d3-daa5-4570-9b19-29e153fd6fcb.png" alt="image"><br><br>  Now, if we try to send empty fields from our form, we will get validation errors: <br><br><img src="http://www.gotdotnet.ru/upload/blog/XaocCPS/377/image_61dce553-1a6e-46f2-957d-d0a0bb972250.png" alt="image"><br><br>  So far everything looks nice and beautiful.  However, imagine such an option: the field for entering the description was not added in one of the variants of the form when another page was created by another developer.  Or, more tragically, the attacker forms and sends the data at all without specifying the ‚ÄúDescription‚Äù field.  How will our application behave in this case? <br><br>  To demonstrate such an attempt to send bad data, I formed a simple query that contains the value of Url, but not the value of Description.  You can see the result of the query below: <br><br><img src="http://www.gotdotnet.ru/upload/blog/XaocCPS/c46/image_2ea48540-5ee6-4c92-b759-ddd17991f289.png" alt="image"><br><br>  As you can see, Description is null, but the data model is considered valid.  In case there are no additional checks, this query would result in writing invalid (according to our views) model to the database. <br><br><h2>  Problem </h2><br>  What is the catch?  The fact is that validation, which works in ASP.NET MVC 2 of all currently public versions (the latest version - RC), is based on form values.  In other words, only those fields that have been transmitted to the server are subject to validation, the remaining fields do not pass validation. <br><br>  The problem of this moment is as follows: is server validation a mechanism of protection against unauthorized access or not?  Until recently, the answer was essentially no.  Validation was a means of validating user input for certain conditions. <br><br>  However, most developers who are not versed in the intricacies believe that validation protects their data from unauthorized access, and in this case, the default validation mechanism can be the source of numerous vulnerabilities in the created resources. <br><br><h2>  Decision </h2><br>  What is offered in exchange?  The solution is to change the validation behavior from form-based to model-specific.  That is, to bring the behavior to what is expected by most developers.  In the final version of ASP.NET MVC 2, this is exactly what will be done: validation will no longer depend on the values ‚Äã‚Äãtransferred, but will depend entirely on the data model. <br><br>  So, the attacker will not be able to harm us by sending a malformed request, in which there is no data.  If the model determines that the data is required, then when validating the values ‚Äã‚Äãof the form and the model instance, a validation error will occur and the model will not be valid. <br><br><h2>  Details or ‚Äúnot so simple‚Äù </h2><br>  There are several points in the upcoming innovations that need attention. <br><br><h3>  Complex types </h3><br>  The validation rules for nested complex objects within a model will affect validation only when there is at least one field of this complex type on the form.  For example, if a property of the Address type is declared in the Person class, then the validation rules for the Address will be applied only if at least one of the Address properties is involved in the request to the server. <br><br><h3>  Bind attribute processing changes </h3><br>  Due to changes in the validation mechanism, the processing of the Bind attribute, which is set for the model, is changed.  In the final version of MVC 2, validation will be performed for all properties of the model, regardless of whether the properties are placed in the Excluded list of the Bind attribute or not. <br><br>  Previously, by specifying certain fields in the Excluded list, one could achieve partial validation of the model.  From now on, it is impossible - all properties will be checked for validation rules. <br><br><h3>  Required for non-nullable types </h3><br>  Due to the fact that the validation will be repelled by the model, the use of Required for non-nullable types is useless.  It was impossible to determine whether or not the value was transferred from the form, since the value-type has a default value. <br><br><h3>  Parameters as part of the model </h3><br>  Another possible problem is that the developer can use not a strict presentation model as action parameters, but part of it: <br><br><img src="http://www.gotdotnet.ru/upload/blog/XaocCPS/403/image_5b0b4b05-ed45-4080-972a-f3811f73f4ac.png" alt="image"><br><br>  Here, the record is edited by first binding the single id parameter.  Then an existing entry is loaded from the repository and an attempt is made to update it.  The problem occurs when the data sent to the server does not contain all the necessary values.  For example, the same ‚ÄúDescription‚Äù field is empty.  In the presented example, the validation for the Description field will not work in any of the code execution locations and the model will be incorrectly saved. <br><br>  The solution to the problem is to use a strictly type of model, instead of part of it.  Then validation will work at the stage of binding action parameters. <br><br><h3>  Passing extra parameters </h3><br>  Another problem that may arise when using validation is the ability for an attacker to send the values ‚Äã‚Äãof such model fields that should not be sent to the server.  This may be the Approved value for our Story model.  The Approved value for the record means that the record has passed moderation, that is, this value determines the system security parameter and access to it must be explicitly restricted. <br><br>  I sent a malicious request from our form, look at the result: <br><br><img src="http://www.gotdotnet.ru/upload/blog/XaocCPS/b2d/image_e8e1e524-2167-4c45-af6d-231b0fdabcff.png" alt="image"><br><br>  You can see that the model already has the established value Approved = true, that is, the attacker potentially overcame the pre-moderation mechanism. <br><br>  To avoid this situation, it is necessary to carefully consider the validation mechanism and plan your models correctly.  For example, in order to avoid such pre-moderation hacking, you need to add the value Approved to the Excluded list in the model for the Bin attribute: <br><br><img src="http://www.gotdotnet.ru/upload/blog/XaocCPS/41e/image_bb74a605-a9cd-4786-8a0e-4e36e33a5124.png" alt="image"><br><br>  In this case, the binding of user data will not be made for the Approved field, which solves the problem. <br><br><h2>  Conclusion </h2><br>  In this article, I reviewed the innovations for the validation mechanism that will be made in the final version of ASP.NET MVC 2. In addition, security issues were discussed when using data binding, validation, and sending data from a form. <br><br>  Automatic validation and data binding are extremely useful mechanisms that can greatly facilitate your life.  But their use imposes obligations to comply with certain safety rules, which should not be forgotten.  Hope this article helps you build secure sites on ASP.NET MVC.  Pleasant development, colleagues! <blockquote>  Appendix: <a href="">source codes</a> from the article </blockquote><br> <a href="http://progg.ru/%25D0%2598%25D0%25B7%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F-%25D0%25B2-%25D0%25B2%25D0%25B0%25D0%25BB%25D0%25B8%25D0%25B4%25D0%25B0%25D1%2586%25D0%25B8%25D0%25B8-%25D1%2584%25D0%25B8%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25B9-%25D0%25B2%25D0%25B5%25D1%2580%25D1%2581%25D0%25B8%25D0%25B8-ASPNET-MVC-2-NET-%25D0%25A5%25D0%25B0%25D0%25B1%25D1%2580%25D0%25B0%25D1%2585%25D0%25B0%25D0%25B1%25D1%2580"><img alt="Progg it" src="http://progg.ru/image.axd?url=http%3A%2F%2Fhabrahabr.ru%2Fblogs%2Fnet%2F82006%2F"></a> <br></div><p>Source: <a href="https://habr.com/ru/post/82006/">https://habr.com/ru/post/82006/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../81998/index.html">iWish</a></li>
<li><a href="../82001/index.html">Client for Google Translate</a></li>
<li><a href="../82003/index.html">Run around the whole world without leaving the room</a></li>
<li><a href="../82004/index.html">No canvas</a></li>
<li><a href="../82005/index.html">Import entries from RSS to LiveJournal</a></li>
<li><a href="../82007/index.html">Use the Force, Luke! or How to see a stereogram without straining your eyes</a></li>
<li><a href="../82008/index.html">JQuery 1.4.1 released</a></li>
<li><a href="../82010/index.html">The deadline for registering a domain emspost.ru (EMS Russian Post)</a></li>
<li><a href="../82011/index.html">Google Reader now allows you to subscribe to a site without RSS</a></li>
<li><a href="../82012/index.html">Send SMS to the number HHHCH to get this job</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>