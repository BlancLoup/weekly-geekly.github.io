<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Get information about the user's workplace</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="0. Preface 


 It all started with the next call of the user, who proudly said: - ‚ÄúEverything broke,‚Äù and with my ‚Äúattempts‚Äù to remotely find the PC o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Get information about the user's workplace</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/c59/78f/99c/c5978f99c8524c198f747cc10d8dcab5.jpg" alt="image"></p><br><h2 id="0-predislovie">  0. Preface </h2><br><p>  It all started with the next call of the user, who proudly said: - ‚ÄúEverything broke,‚Äù and with my ‚Äúattempts‚Äù to remotely find the PC on which this user works. </p><br><p>  The decision planned to be simple to madness and gather on the knee.  So, as most of our employees work under the "Windows" and all workstations are included in the domain, a search vector of the solution was set.  Initially, it was planned to write a small script.  His task was to collect basic information about the system and the employee who works for this system.  The set of information is minimal.  Namely: login, name of the workstation and its ip.  The result of the work is saved on the server, and the script itself is "hung" on the user through the GPO. </p><br><p>  In this implementation there were significant drawbacks in the form: </p><br><ul><li>  information could be obtained only by going to the server (its network folder where the file was stored), which is not always convenient </li><li>  keep the file up to date </li><li>  get real time data </li></ul><br><p>  After deliberation, the decision came: use a bot in the Telegram.  Having resorted to a little manual dexterity, the script was rewritten into a small program to send information to the chat, for the place of the ‚Äúboring‚Äù record in the file on the server.  (+ some more parameters were added which were sent to the bot) <a name="habracut"></a></p><br><p><img src="https://habrastorage.org/web/d64/8fc/03c/d648fc03cb7f40e3bec99f9dac60f927.png" alt="image"><br>  <em>PS The data shown in the image is censored to preserve commercial secrets.</em> </p><br><p>  But even this approach solved only the problem with the availability of information, at the same time preserving the remaining drawbacks of the old approach. </p><br><p>  It was necessary to change something.  It was decided to write a full client-server application. <br>  The concept is simple.  We are writing a server that will serve incoming connections from the client and send it the requested information. </p><br><h2 id="1-pishem-server">  1. We write server </h2><br><p>  To begin, choose a protocol for "communication".  The choice is not great - UDP / TCP.  I decided in favor of TCP.  The advantages are obvious: </p><br><ul><li>  provides reliable communication </li><li>  data sharing in one session </li></ul><br><p>  Start by creating a user class. </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">User</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> PC { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> IP { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Version { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] Screen { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  Initially, he had only 3 properties.  But during the development process, the server code of the form changed.  There was a new functionality.  A version has become necessary for client and server compatibility.  I did not take the version from the assembly, having decided that it is redundant.  It is also an opportunity to make a screen of the user. </p><br><p>  Constructor: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ip, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> version</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PC = pc; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IP = ip; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Version = version; }</code> </pre> <br><p>  We do not always need to transfer a screen shot.  Therefore, we create a constructor overload: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ip, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> version, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] screen</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PC = pc; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IP = ip; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Version = version; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Screen = screen; }</code> </pre> <br><p>  Running a little bit in front, I‚Äôll say that the data was initially transferred via BinaryWriter "line by line" and without being reduced to a common data type.  What was very inconvenient when adding new features to the application.  Rewriting the function of sending data led to the addition of the possibility of their serialization.  Now the User object could be represented in three forms: </p><br><ul><li>  Binary </li><li>  Json </li><li>  XML </li></ul><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Serializable, DataContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">User</span></span> { [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> PC { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> IP { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Version { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] Screen { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ip, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> version</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PC = pc; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IP = ip; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Version = version; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ip, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> version, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] screen</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PC = pc; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.IP = ip; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Version = version; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Screen = screen; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">byte</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetBinary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { BinaryFormatter formatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryFormatter(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MemoryStream stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream()) { formatter.Serialize(stream, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stream.ToArray(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">byte</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetXML</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { XmlSerializer formatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlSerializer(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(User)); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MemoryStream stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream()) { formatter.Serialize(stream, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stream.ToArray(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">byte</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetJSON</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { DataContractJsonSerializer jsonFormatter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataContractJsonSerializer(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(User)); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MemoryStream stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream()) { jsonFormatter.WriteObject(stream, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stream.ToArray(); } } }</code> </pre> <br><p>  In order to be able to deserialize a binary User object, I had to put it into a separate library and use it in the program already through it. </p><br><p>  I also want to draw attention to the flow that we get at the output.  The byte array is returned via the ToArray method.  His minus - he creates a copy of the stream in memory.  But this is not critical, unlike using the GetBuffer method, which returns not a pure array of data, but the entire stream (the point is that the memory allocated for the stream may not be completely filled), as a result we get an increase in the array.  Unfortunately, I did not see this nuance right away.  And only with detailed data analysis. </p><br><p>  The class ClientObject is responsible for handling our connections. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ClientObject</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TcpClient client; [Flags] <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Commands : <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> { GetInfoBin = <span class="hljs-number"><span class="hljs-number">0x0a</span></span>, GetInfoJSON = <span class="hljs-number"><span class="hljs-number">0x0b</span></span>, GetInfoXML = <span class="hljs-number"><span class="hljs-number">0x0c</span></span>, GetScreen = <span class="hljs-number"><span class="hljs-number">0x14</span></span>, GetUpdate = <span class="hljs-number"><span class="hljs-number">0x15</span></span>, GetTest = <span class="hljs-number"><span class="hljs-number">0xff</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClientObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TcpClient tcpClient</span></span></span><span class="hljs-function">)</span></span> { client = tcpClient; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sender</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TcpClient client, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-string"><span class="hljs-string">"Sender OK 0xFF"</span></span>); BinaryWriter writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryWriter(client.GetStream()); writer.Write(data); writer.Flush(); writer.Close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(e.Message + <span class="hljs-string"><span class="hljs-string">"0xFF"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] _Info () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User.User(Environment.UserName, Environment.MachineName, GetIp(), Settings.Version, _Screen()).GetBinary(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] _Info(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> type) { User.User tmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User.User(Environment.UserName, Environment.MachineName, GetIp(), Settings.Version); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"bin"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp.GetBinary(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"json"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp.GetJSON(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"xml"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp.GetXML(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>] { <span class="hljs-number"><span class="hljs-number">0x00</span></span> }); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] _Screen() { Bitmap bm = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(Screen.PrimaryScreen.Bounds.Width, Screen.PrimaryScreen.Bounds.Height); Graphics gr = Graphics.FromImage(bm <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Image); gr.CopyFromScreen(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, bm.Size); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MemoryStream stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream()) { bm.Save(stream, ImageFormat.Jpeg); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stream.ToArray(); } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] _Test() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Encoding.UTF8.GetBytes(<span class="hljs-string"><span class="hljs-string">"Test send from server"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CmdUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Process process</span></span></span><span class="hljs-function">)</span></span> { Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-string"><span class="hljs-string">"Command from server: Update"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fileName = <span class="hljs-string"><span class="hljs-string">"Update.exe"</span></span>, myStringWebResource = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; WebClient myWebClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient(); myStringWebResource = Settings.UrlUpdate + fileName; myWebClient.DownloadFile(myStringWebResource, fileName); Process.Start(<span class="hljs-string"><span class="hljs-string">"Update.exe"</span></span>, process.Id.ToString()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(e.Message); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-string"><span class="hljs-string">"Command end"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _Process() { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { BinaryReader reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryReader(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client.GetStream()); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> cmd = reader.ReadByte(); Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(cmd.ToString()); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ((Commands)cmd) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Commands.GetInfoBin: Sender(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client, _Info(<span class="hljs-string"><span class="hljs-string">"bin"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Commands.GetInfoJSON: Sender(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client, _Info(<span class="hljs-string"><span class="hljs-string">"json"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Commands.GetInfoXML: Sender(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client, _Info(<span class="hljs-string"><span class="hljs-string">"xml"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Commands.GetScreen: Sender(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client, _Screen()); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Commands.GetUpdate: CmdUpdate(Process.GetCurrentProcess()); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Commands.GetTest: Sender(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client, _Test()); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-string"><span class="hljs-string">"Incorrect server command "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } reader.Close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(e.Message + <span class="hljs-string"><span class="hljs-string">" 0x2F"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-string"><span class="hljs-string">"Client close connect"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.client.Close(); MemoryManagement.FlushMemory(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetIp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IPHostEntry host = Dns.GetHostEntry(Dns.GetHostName()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> host.AddressList.FirstOrDefault(ip =&gt; ip.AddressFamily == AddressFamily.InterNetwork).ToString(); } }</code> </pre> <br><p>  It describes all the commands that come from the client.  Commands are implemented very simply.  The implication was that the client could be any device, program or server processing.  Therefore, the nature of the response is given by the receipt of one byte: </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Flags</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Commands : <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> { GetInfoBin = <span class="hljs-number"><span class="hljs-number">0x0a</span></span>, GetInfoJSON = <span class="hljs-number"><span class="hljs-number">0x0b</span></span>, GetInfoXML = <span class="hljs-number"><span class="hljs-number">0x0c</span></span>, GetScreen = <span class="hljs-number"><span class="hljs-number">0x14</span></span>, GetUpdate = <span class="hljs-number"><span class="hljs-number">0x15</span></span>, GetTest = <span class="hljs-number"><span class="hljs-number">0xff</span></span> }</code> </pre> <br><p>  You can quickly add new functionality or build complex logic of behavior, which will be determined by the entire 1 byte using a bit mask.  For convenience, all bytes are given to readable commands. </p><br><p>  The Sender method is responsible for sending data, which takes as input the TcpClient object and the data set as an array of bytes. </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sender</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TcpClient client, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-string"><span class="hljs-string">"Sender OK"</span></span>); BinaryWriter writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryWriter(client.GetStream()); writer.Write(data); writer.Flush(); writer.Close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(e.Message); } }</code> </pre> <br><p>  Everything is also pretty restrained.  Create a BinaryWriter from a stream from TcpClient, write an array of bytes into it, clean it up and close it. </p><br><p>  For creating a User object, the ._Info method is responsible for overloading. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] _Info () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User.User(Environment.UserName, Environment.MachineName, GetIp(), Settings.Version, _Screen()).GetBinary(); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] _Info(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> type) { User.User tmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User.User(Environment.UserName, Environment.MachineName, GetIp(), Settings.Version); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"bin"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp.GetBinary(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"json"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp.GetJSON(); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"xml"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tmp.GetXML(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>] { <span class="hljs-number"><span class="hljs-number">0x00</span></span> }); }</code> </pre> <br><p>  We initialize a new instance of User, populate the constructor, and immediately call the .GetBinary method to get the serialized data.  We will need overloading if we want to explicitly indicate what type of data we want to receive. </p><br><p>  The ._Screen method is responsible for creating a screenshot of the desktop. </p><br><p>  From interesting.  Here you can select the CmdUpdate method.  He takes to the entrance <br>  current process: </p><br><pre> <code class="cs hljs">CmdUpdate(Process.GetCurrentProcess());</code> </pre> <br><p>  This method implements our server updates at the command of the client.  Inside it, a WebClient object is created that downloads an assistant program with <del>  server / site </del>  specified source needed to update the server itself.  Then it starts it and passes the current process ID as an input parameter: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fileName = <span class="hljs-string"><span class="hljs-string">"Update.exe"</span></span>, myStringWebResource = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; WebClient myWebClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient(); myStringWebResource = Settings.UrlUpdate + fileName; myWebClient.DownloadFile(myStringWebResource, fileName); Process.Start(<span class="hljs-string"><span class="hljs-string">"Update.exe"</span></span>, process.Id.ToString());</code> </pre> <br><p>  The entry point for the handler is ._Process.  It creates a BinaryReader and reads a command byte from it.  Depending on the received byte, this or that operation is performed.  At the end, we shut down the client and clear the memory. </p><br><p>  To get obj TcpClient, we will be using the TcpListener in the perpetual loop using .AcceptTcpClient.  The resulting client object, we pass to our handler.  Running it in a new thread to avoid blocking the main thread </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> TcpListener listener; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { listener = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TcpListener(IPAddress.Parse(<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>), Settings.Port); listener.Start(); Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-string"><span class="hljs-string">"Listener start"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { TcpClient client = listener.AcceptTcpClient(); ClientObject clientObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClientObject(client); Task clientTask = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Task(clientObject._Process); clientTask.Start(); MemoryManagement.FlushMemory(); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(ex.Message); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-string"><span class="hljs-string">"End listener"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (listener != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { listener.Stop(); Logger.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-string"><span class="hljs-string">"Listener STOP"</span></span>); } }</code> </pre> <br><p>  Another server has a couple of auxiliary classes: Logger and Settings </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Settings</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Version { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Key { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> UrlUpdate { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Port { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Log { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> version, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> urlUpdate, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> port, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> log</span></span></span><span class="hljs-function">)</span></span> { Version = version; Key = key; UrlUpdate = urlUpdate; Port = port; Log = log; } }</code> </pre> <br><p>  In the future we plan to save and read settings from a file. </p><br><p>  The Logger class allows us to save to the file the events that occurred during the execution of the program.  It is possible, through the settings to disable the recording of logs. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Logger</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Stack&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; log_massiv = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stack&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> logFile = <span class="hljs-string"><span class="hljs-string">"log.txt"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> str</span></span></span><span class="hljs-function">)</span></span> { log_massiv.Push(time() + <span class="hljs-string"><span class="hljs-string">" - "</span></span> + str); write(log_massiv, logFile, Settings.Log); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stack&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; strs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> file, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> log</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (log) { File.AppendAllLines(file, strs); log_massiv.Clear(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">time</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DateTime.Now.Day + <span class="hljs-string"><span class="hljs-string">"."</span></span> + DateTime.Now.Month + <span class="hljs-string"><span class="hljs-string">"."</span></span> + DateTime.Now.Year + <span class="hljs-string"><span class="hljs-string">" "</span></span> + DateTime.Now.Hour + <span class="hljs-string"><span class="hljs-string">":"</span></span> + DateTime.Now.Minute + <span class="hljs-string"><span class="hljs-string">":"</span></span> + DateTime.Now.Second; } }</code> </pre> <br><h2 id="2-client">  2. Client </h2><br><p>  It will, but a little later. </p><br><p>  ‚Üí <a href="https://github.com/ruhex/GetInfo">Project sources on GitHub</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/328914/">https://habr.com/ru/post/328914/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328904/index.html">Guide React Native - create an application for iOS. Part 1.4 - 1.5</a></li>
<li><a href="../328906/index.html">Lua in Moscow for the first time at DevConf 2017</a></li>
<li><a href="../328908/index.html">Quick start iOS-applications on the example of iOS Mail Mail.Ru</a></li>
<li><a href="../328910/index.html">The blackmailer WannaCrypt attacks un-upgraded systems</a></li>
<li><a href="../328912/index.html">All educational projects Mail.Ru Group</a></li>
<li><a href="../328916/index.html">We are testing cloud platforms from Top-3</a></li>
<li><a href="../328918/index.html">Top 10 conference reports Heisenbag 2016 Moscow</a></li>
<li><a href="../328920/index.html">Meine √úberwachung, or a tale of beautiful monitoring - the beginning</a></li>
<li><a href="../328924/index.html">Scheme (Lisp) Games in DrRacket</a></li>
<li><a href="../328928/index.html">In response to the Ukrainian (and not only) prohibitions: the decentralized EmerDNS system against site blocking</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>