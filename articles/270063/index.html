<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JSON in Swift 2.0 without anesthesia</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Working with JSON is too common and a daily lesson to pay much attention to. Nevertheless, the implementation of some things in Swift looks too compli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JSON in Swift 2.0 without anesthesia</h1><div class="post__text post__text-html js-mediator-article">  Working with JSON is too common and a daily lesson to pay much attention to.  Nevertheless, the implementation of some things in Swift looks too complicated and causes toothache every time you see it. <br><br>  Recently, reading a <a href="http://habrahabr.ru/post/269741/">post about SwiftyVK</a> , I found there a link to <a href="http://habrahabr.ru/post/228949/">an article about OptJSON</a> that allows you to greatly simplify working with JSON in Swift.  And although the approach described in the article is really interesting, I still had the feeling that it was still too complicated. <br><br>  I tried to simplify the OptJSON library a little more, and this is what happened: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs pgsql">let obj = <span class="hljs-type"><span class="hljs-type">json</span></span>?["workplan"]?["presets"]?[<span class="hljs-number"><span class="hljs-number">1</span></span>]?["id"] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Int</span></span></code> </pre> <a name="habracut"></a><br>  The source code of the library can be viewed at the <a href="https://github.com/odnoletkov/OptJSON/tree/master/OptJSON">link on GitHub</a> : <br><br>  After downloading the only OptJSON.swift file, I added it to an empty, newly created test project for Apple TV.  Xcode cursed that the Swift version in the file was too old and suggested updating the code.  I did not mind.  In fact, the fixes touched only the removal of hash characters (#). <br><br>  I also included in the project JSON-config, which I used earlier in another project and tried to write a test code to extract some value in the old-fashioned way: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = <span class="hljs-type"><span class="hljs-type">NSData</span></span>(contentsOfFile: <span class="hljs-type"><span class="hljs-type">NSBundle</span></span>.mainBundle().pathForResource(<span class="hljs-string"><span class="hljs-string">"config"</span></span>, ofType: <span class="hljs-string"><span class="hljs-string">"json"</span></span>)!) { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> obj = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">NSJSONSerialization</span></span>.<span class="hljs-type"><span class="hljs-type">JSONObjectWithData</span></span>(data, options: []) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? [<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">AnyObject</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> a = obj?[<span class="hljs-string"><span class="hljs-string">"workplan"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? [<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">AnyObject</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> b = a?[<span class="hljs-string"><span class="hljs-string">"presets"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? [<span class="hljs-type"><span class="hljs-type">AnyObject</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(b) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = b?[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? [<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">AnyObject</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> d = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>?[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(d) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Error!"</span></span>) } }</code> </pre><br>  Yes, in Objective C it was really much easier.  Now we will try to use OptJSON for the same purposes: <br><br><div class="spoiler">  <b class="spoiler_title">If long</b> <div class="spoiler_text"><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = <span class="hljs-type"><span class="hljs-type">NSData</span></span>(contentsOfFile: <span class="hljs-type"><span class="hljs-type">NSBundle</span></span>.mainBundle().pathForResource(<span class="hljs-string"><span class="hljs-string">"config"</span></span>, ofType: <span class="hljs-string"><span class="hljs-string">"json"</span></span>)!) { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> obj = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">NSJSONSerialization</span></span>.<span class="hljs-type"><span class="hljs-type">JSONObjectWithData</span></span>(data, options: []) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> v = <span class="hljs-type"><span class="hljs-type">JSON</span></span>(obj) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> a = v?[key:<span class="hljs-string"><span class="hljs-string">"workplan"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> b = a?[key:<span class="hljs-string"><span class="hljs-string">"presets"</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(b) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = b?[index:<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> d = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>?[key:<span class="hljs-string"><span class="hljs-string">"id"</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(d) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Error!"</span></span>) } }</code> </pre><br></div></div><br>  Or in short: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = <span class="hljs-type"><span class="hljs-type">NSData</span></span>(contentsOfFile: <span class="hljs-type"><span class="hljs-type">NSBundle</span></span>.mainBundle().pathForResource(<span class="hljs-string"><span class="hljs-string">"config"</span></span>, ofType: <span class="hljs-string"><span class="hljs-string">"json"</span></span>)!) { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> obj = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">NSJSONSerialization</span></span>.<span class="hljs-type"><span class="hljs-type">JSONObjectWithData</span></span>(data, options: []) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> d = <span class="hljs-type"><span class="hljs-type">JSON</span></span>(obj)?[key:<span class="hljs-string"><span class="hljs-string">"workplan"</span></span>]?[key:<span class="hljs-string"><span class="hljs-string">"presets"</span></span>]?[index:<span class="hljs-number"><span class="hljs-number">1</span></span>]?[key:<span class="hljs-string"><span class="hljs-string">"id"</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(d) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Error!"</span></span>) } }</code> </pre><br>  Already not bad!  But all the same, the feeling that everything can be made simpler does not leave.  And you can!  I got into OptJSON.swift and, first of all, I was surprised by the construction: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JSON</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object: AnyObject?)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">JSONValue?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> some: <span class="hljs-type"><span class="hljs-type">AnyObject</span></span> = object { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> some { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> null <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-type"><span class="hljs-type">NSNull</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> number <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-type"><span class="hljs-type">NSNumber</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> number <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> string <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-type"><span class="hljs-type">NSString</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> string <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> array <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-type"><span class="hljs-type">NSArray</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> array <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dict <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-type"><span class="hljs-type">NSDictionary</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dict <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre><br>  Without hesitation, I replaced it with <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JSONValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object: AnyObject?)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">JSONValue?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> some = object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">JSONValue</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> some } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre><br>  And if there is no difference, why pay more?  The next step was to remove the named parameters that are so messy when calling a subscript: <br><br> <code>[key:"presets"]?[index:0]? <br></code> <br><br>  No sooner said than done!  Xcode swore that he didn‚Äôt like the return type JSONValue?  instead of the expected subscript AnyObject? .. Well, along the way we pull down the wrapper of the returned values ‚Äã‚Äãin JSON ().  The code took on something like the following: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSArray</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JSONValue</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">subscript</span></span>( key: <span class="hljs-type"><span class="hljs-type">String</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">JSONValue?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">subscript</span></span>( index: <span class="hljs-type"><span class="hljs-type">Int</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">JSONValue?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> index &lt; <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> &amp;&amp; index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>[index] : <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSDictionary</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JSONValue</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">subscript</span></span>( key: <span class="hljs-type"><span class="hljs-type">String</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">JSONValue?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>[key] } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">subscript</span></span>( index: <span class="hljs-type"><span class="hljs-type">Int</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">JSONValue?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre><br>  Having started the project, I understood why the author decided to use the named parameters, namely, the execution of the function went into deep recursion, trying to call self [key].  But in the end, why are the NSArray and NSDictionary classes used for the extension, and the alien objectForKeyedSubscript is used to retrieve the object ?!  After all, there are the objectForKey: and objectAtIndex: methods native to these classes: we use them: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSArray</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JSONValue</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">subscript</span></span>( key: <span class="hljs-type"><span class="hljs-type">String</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">JSONValue?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">subscript</span></span>( index: <span class="hljs-type"><span class="hljs-type">Int</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">JSONValue?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> index &lt; <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> &amp;&amp; index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.objectAtIndex(index) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">JSONValue</span></span> : <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSDictionary</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JSONValue</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">subscript</span></span>( key: <span class="hljs-type"><span class="hljs-type">String</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">JSONValue?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.objectForKey(key) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">JSONValue</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">subscript</span></span>( index: <span class="hljs-type"><span class="hljs-type">Int</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">JSONValue?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre><br>  And once such a binge went, then we basically don‚Äôt need the JSON () function for wrapping objects, just enough as?  JSONValue.  Replace its insides for something more convenient, for example, loading a JSON object from a string, NSData, or from the contents of an NSURL, and at the same time get rid of the need to use a new-fashioned try-catch: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JSON</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object: AnyObject?, options: NSJSONReadingOptions = [])</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">JSONValue?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data: <span class="hljs-type"><span class="hljs-type">NSData</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> aData = object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">NSData</span></span> { data = aData } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> string = object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">String</span></span>, aData = string.dataUsingEncoding(<span class="hljs-type"><span class="hljs-type">NSUTF8StringEncoding</span></span>) { data = aData } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> url = object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">NSURL</span></span>, aData = <span class="hljs-type"><span class="hljs-type">NSData</span></span>(contentsOfURL: url) { data = aData } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> json = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? <span class="hljs-type"><span class="hljs-type">NSJSONSerialization</span></span>.<span class="hljs-type"><span class="hljs-type">JSONObjectWithData</span></span>(data, options: options) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">JSONValue</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre><br>  After these transformations, the final code takes the following form: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> v = <span class="hljs-type"><span class="hljs-type">JSON</span></span>(<span class="hljs-type"><span class="hljs-type">NSBundle</span></span>.mainBundle().<span class="hljs-type"><span class="hljs-type">URLForResource</span></span>(<span class="hljs-string"><span class="hljs-string">"config"</span></span>, withExtension: <span class="hljs-string"><span class="hljs-string">"json"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> a = v[<span class="hljs-string"><span class="hljs-string">"workplan"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> b = a?[<span class="hljs-string"><span class="hljs-string">"presets"</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(b) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = b?[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> d = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>?[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(d) }</code> </pre><br>  And if shorter, it does: <br><br><pre> <code class="hljs pgsql">let <span class="hljs-type"><span class="hljs-type">json</span></span> = <span class="hljs-type"><span class="hljs-type">JSON</span></span>(NSBundle.mainBundle().URLForResource("config", withExtension: "json")) let obj = <span class="hljs-type"><span class="hljs-type">json</span></span>?["workplan"]?["presets"]?[<span class="hljs-number"><span class="hljs-number">1</span></span>]?["id"] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">Int</span></span> print(obj)</code> </pre><br>  And no named parameters!  Thanks for attention. <br><br><div class="spoiler">  <b class="spoiler_title">View full code of the modified file</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Foundation <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> protocol JSONValue: AnyObject { subscript(key: String) -&gt; JSONValue? { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } subscript(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: <span class="hljs-type"><span class="hljs-type">Int</span></span>) -&gt; JSONValue? { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span> NSNull : JSONValue { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> subscript(key: String) -&gt; JSONValue? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> subscript(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: <span class="hljs-type"><span class="hljs-type">Int</span></span>) -&gt; JSONValue? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil } } <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span> NSNumber : JSONValue { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> subscript(key: String) -&gt; JSONValue? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> subscript(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: <span class="hljs-type"><span class="hljs-type">Int</span></span>) -&gt; JSONValue? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil } } <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span> NSString : JSONValue { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> subscript( key: String) -&gt; JSONValue? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> subscript( <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: <span class="hljs-type"><span class="hljs-type">Int</span></span>) -&gt; JSONValue? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil } } <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span> NSArray : JSONValue { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> subscript( key: String) -&gt; JSONValue? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> subscript( <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: <span class="hljs-type"><span class="hljs-type">Int</span></span>) -&gt; JSONValue? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> &lt; count &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ? self.objectAtIndex(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? JSONValue : nil } } <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span> NSDictionary : JSONValue { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> subscript( key: String) -&gt; JSONValue? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.objectForKey(key) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? JSONValue } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> subscript( <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>: <span class="hljs-type"><span class="hljs-type">Int</span></span>) -&gt; JSONValue? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> func <span class="hljs-type"><span class="hljs-type">JSON</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>: AnyObject?, <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>: NSJSONReadingOptions = []) -&gt; JSONValue? { let data: NSData <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let aData = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? NSData { data = aData } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let string = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? String, aData = string.dataUsingEncoding(NSUTF8StringEncoding) { data = aData } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let url = <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? NSURL, aData = NSData(contentsOfURL: url) { data = aData } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let <span class="hljs-type"><span class="hljs-type">json</span></span> = try? NSJSONSerialization.JSONObjectWithData(data, <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">options</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">json</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? JSONValue } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nil }</code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/270063/">https://habr.com/ru/post/270063/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270053/index.html">Do not cos from development on Cach√©</a></li>
<li><a href="../270055/index.html">Another methodology: Stakhanov</a></li>
<li><a href="../270057/index.html">Technical interviews: tips</a></li>
<li><a href="../270059/index.html">Highload to Java: what you need to remember</a></li>
<li><a href="../270061/index.html">The evolution of automatic testing in 1C: Enterprise</a></li>
<li><a href="../270065/index.html">Exploit a million. We have a winner</a></li>
<li><a href="../270069/index.html">Buffers and binary input and output in Perl6</a></li>
<li><a href="../270071/index.html">Sorting an array without using conditional statements</a></li>
<li><a href="../270073/index.html">Protection in-App Purchase iOS from the server with the help of the server</a></li>
<li><a href="../270075/index.html">BEM - methodology for hanging crutches</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>