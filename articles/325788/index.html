<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PWA, ‚ÄúOminous Valley‚Äù and stable work offline</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last July at Altitude 2016, Alex Russell (Alex Russell) from Fastly told how he sees the future of mobile applications with PWA and service worker in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PWA, ‚ÄúOminous Valley‚Äù and stable work offline</h1><div class="post__text post__text-html js-mediator-article">  Last July at Altitude 2016, Alex Russell (Alex Russell) from Fastly told how he sees the future of mobile applications with PWA and service worker in mind, how to ensure reliable operation of the application offline, and how to get around the ‚Äúsinister valley‚Äù in the mobile interface. <br><br><h2>  Now the service worker is a programmable proxy inside the browser. </h2><br>  "In the team, we know that faster is always better," said Alex.  "This circumstance is confirmed by dozens of studies of our team and others." <br><br>  This pattern is illustrated in Figure 1. It is clearly seen that with increasing load time of a web page: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1) the number of hits to the page drops dramatically; <br>  2) the percentage of failures is constantly growing. <br><br><img src="https://habrastorage.org/files/9c8/5d8/968/9c85d89686734d63b57f0d8b464ca250.png"><br>  <em>Fig.</em>  <em>1. Faster is always better</em> <em><br></em>  <em>The bar chart shows the dependence of the number of hits to a web page per second on the load time (this page is also in seconds.</em> <em><br></em>  <em>The red graph shows the dependence of the bounce rate as a percentage of the same load time in seconds of a web page.</em> <br><a name="habracut"></a><br><h3>  What is "faster" </h3><br>  But it is not always clear what we mean by the word "faster."  Of course, we mean faster in relation to the load time of a web page.  However, there is not enough data on when the web page actually began to load. <br><br>  The interactive content of a webpage is, of course, what users need.  However, users are finding it harder to get to this content.  It should be noted that initially the web network grew in such conditions when the access speed was not great, but at the same time it was not too different for different devices. <br><br>  Today, mobile networks have a great time waiting for the opening of acceptable options for web pages, despite the rapid increase in the number of mobile devices.  Alex noted that "modern software has become much better, but at the same time, networks are not getting better in the same absolute figures." <br><br><h2>  service worker </h2><br>  The Chrome team decided to create a service worker that would provide reliable performance by storing the content in a new API cache.  According to Google‚Äôs web team, ‚Äúservice worker is a script (script) that the browser runs as a background program separately from the web page.  This opens access to such features that do not require a listing of a web page, nor any interaction with the user. ‚Äù <br><br>  The service worker gives web developers the ability to respond to network requests created by web applications while continuing to work even when offline, with full control over program events.  More on Habrahabr: <a href="https://habrahabr.ru/post/315660/">"Some of the subtleties of using Service Workers</a> . <a href="https://habrahabr.ru/post/315660/">"</a> <br><br><blockquote>  Site example.com.  The first time users visit example.com, the service worker starts.  With the service worker you deal with each subsequent request.  This allows you to choose how to create reliable offline events.  Figure 2 shows an example of a listing of service worker.  Figure 3 shows the enlarged text of the listings. </blockquote><br><img src="https://habrastorage.org/files/2b2/364/3a5/2b23643a56364573957a6287b18aa2d3.png"><br>  <em>Fig.</em>  <em>2. An example of listing service service is shown on example.com</em> <em><br></em>  <em><strong>1.</strong> The first part of the listing is the initialization of the service worker sw.js on the first access and the opening of the app.html application, i.e., providing the interface.</em> <em><br></em>  <em><strong>2.</strong> The second part of the listing is the description of the work of the service worker with the content of the app.html application (download content): request an update over the network using the cached content.</em> <br><br><img src="https://habrastorage.org/files/74c/919/06f/74c91906f4a34676829b546fd5ac9a0e.png"><br>  <em>Fig.</em>  <em>3. Enlarged text of listings in figure 2</em> <br><br><h3>  Offline design </h3><br>  The service worker allows you to design reliable offline events for a given application.  This is achieved by immediately providing the interface (system shell) to which the content is then loaded.  Figure 4 shows this process. <br><br><img src="https://habrastorage.org/files/4ea/a22/9c8/4eaa229c8ff04a28854bd6d369728ce9.png"><br>  <em>Fig.</em>  <em>4. Immediate provision of the system shell, which then loads the content</em> <em><br></em>  <em><strong>1.</strong> The first picture is an application.</em> <em><br></em>  <em><strong>2.</strong> The second picture is the system shell.</em> <em><br></em>  <em>The first two pictures show the immediate loading of the cached interface on repeated visits.</em> <em><br></em>  <em><strong>3.</strong> The third picture is content.</em>  <em>After the interface is loaded, specific images appear.</em> <br><br>  Application execution is a JavaScript framework that processes the structure of an application step by step.  The result is the following procedure: <br><br>  1) framework loading; <br>  2) application download; <br>  3) and then loading the data by the application. <br><br><h2>  What awaits us tomorrow: service worker with external requests </h2><br>  Today, a service worker can intercept requests to third-party hosts only if this is permitted by the source interaction policy for this host.  Consequently, the only way a third-party host can take advantage of the service worker is to connect to it, starting with the root domain.  Of course, even in this case, the visibility of requests for this third-party host is limited by the source interaction policy. <br><br>  To overcome these limitations, the Chrome team is currently developing a <a href="https://developers.google.com/web/updates/2016/09/foreign-fetch">service worker with external requests</a> , which allows third-party hosts to process these requests with their own service worker.  In this case, there is full visibility and optimization through sites that use the same service from a third-party host. <br><br>  With external requests, service workers can subscribe to requests from anywhere to their resources.  At the same time, proxy requests ‚Äúto the Internet‚Äù are not allowed: for example, the service worker, recognizing the request to the CDN (Content Delivery Network) for fonts, will direct it to the common client cache, which is also used by other sources. <br><br>  And now, without external requests, third-party hosts - CDN for fonts, analytical services and advertising networks - can implement this logic only with their own service worker without integration with the service worker deployed by the original participants. <br><br>  More on Habrahabr: <a href="https://habrahabr.ru/post/315660/">"Some of the subtleties of using Service Workers</a> . <a href="https://habrahabr.ru/post/315660/">"</a> <br><br><h2>  How to make life better for users with PWA </h2><br>  In addition to reliable performance, it would also be nice to impress your users, and it‚Äôs much easier to get their attention in connection events than with the App Store index. <br><br>  Alex used the PWA (progressive web app) example of the Washington Post. <br><br><blockquote>  Site wapo.com.  Right from wapo.com, mobile users can add the Washington Post icon to their home screens, creating a quick link to bypass the App Store.  This process is illustrated in Figure 5. </blockquote><br><br><img src="https://habrastorage.org/files/4da/1ac/ebf/4da1acebfccd48539e095144888efb5f.png"><br>  <em>Fig.</em>  <em>5. Adding the Washington Post icon directly from wapo.com to the home screen</em> <em><br></em>  <em><strong>1.</strong> The first picture is the Washington Post wapo.com site and below is the button for adding the icon of this site to the ADD TO HOME SCREEN home screen.</em> <em><br></em>  <em><strong>2.</strong> The second picture is the home screen with the added icon.</em> <em><br></em>  <em><strong>3.</strong> The third picture is again the Washington Post wapo.com website, opened with an icon.</em> <br><br>  With the help of PWA (progressive web app) you can provide functionality to users without having to create something multiple.  If you're interested in creating your own PWA, then you can use the Washington Post metadata: <a href="">washingtonpost.com/pwa/manifest.json</a> .  <a href="https://github.com/GoogleChrome/lighthouse">The Lighthouse Chrome tools</a> will help verify that you really created some event-application for PWA. <br><br>  Read more on Habrahabr: <a href="https://habrahabr.ru/company/plarium/blog/277485/">"6 impressive web technologies in 2015"</a> <br><br><h2>  Less time for interactivity for better performance. </h2><br>  To use the most successful performance optimization methods for creating a PWA or something else, the Chrome team follows the RAIL model.  This model consists of 4 principles, according to the number of letters in the title: <br><br>  1) Response (Respond): 100 ms, i.e. within 100 milliseconds, it is necessary to respond to user actions; <br>  2) Animation: &lt;8 ms, i.e. each frame of the animation should appear on the user's screen in less than 8 milliseconds; <br>  3) Waiting (Idle) work in blocks of 50 ms, that is, you need to group tasks in blocks of no more than 50 milliseconds; <br>  4) Load (Load): 1000 ms (= 1 s) to the first screen, i.e., until the first picture appears on the user's screen, it should not take more than 1 second. <br><br>  Read more on Habrahabr: <a href="https://habrahabr.ru/post/308026/">‚ÄúIntroducing RAIL: site performance evaluation model‚Äù</a> <br><br><h3>  Empty Waiting </h3><br>  On ordinary web sites, "a lot of wasted time" waiting in the network.  Figure 6 shows an example image of a ‚Äúlong‚Äù website loading with HTML code and JavaScript. <br><br><img src="https://habrastorage.org/files/355/d5a/c2d/355d5ac2d0ce4958b115394a4fdbf8bd.png"><br>  <em>Fig.</em>  <em>6. An exemplary picture of a ‚Äúlong‚Äù loading site with HTML code and JavaScript</em> <em><br></em>  <em>The vertical axis is the load percentage (from 0 to 100%).</em> <em><br></em>  <em><strong>1.</strong> First, the initial request to the site starts.</em> <em><br></em>  <em><strong>2.</strong> After a while, download the HTML code.</em> <em><br></em>  <em><strong>3.</strong> Then there is a ‚Äúlong‚Äù waiting time.</em> <em><br></em>  <em><strong>4.</strong> Before the end of the wait time, the download of the JavaScript code begins.</em> <em><br></em>  <em><strong>5.</strong> After the waiting time, the picture finally starts loading.</em> <em><br></em>  <em>The last two steps are parsing and executing JavaScript code.</em> <br><br>  Today, applications can render server-side JavaScript.  When you run such an application, as shown in Figure 6, basic HTML appears immediately, then JavaScript is loaded, and only then can you really use the site.  This "long" period of inability to interact with the site and is referred to by Paul Lewis of Google as "Ominous Valley." <br><br><blockquote>  The effect of the ‚ÄúSinister Valley‚Äù is a hypothesis according to which a robot or other object that looks or acts approximately like a human (but not exactly like the real one) causes hostility and disgust among observers.  <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B5%25D1%2589%25D0%25B0%25D1%258F%2520%25D0%25B4%25D0%25BE%25D0%25BB%25D0%25B8%25D0%25BD%25D0%25B0">Read more on wikipedia</a> </blockquote><br>  Figure 7 shows again Figure 6 with the ‚ÄúSinister Valley‚Äù marked on it. <br><br><img src="https://habrastorage.org/files/068/57c/13f/06857c13f47740b39e264e2288d5dc5f.png"><br>  <em>Fig.</em>  <em>7. Figure 6 with the gray shaded ‚ÄúSinister Valley‚Äù</em> <br><br>  What we really want to get from the site is the ability of the application to use ‚Äúall bits on the screen‚Äù when the picture appears immediately after the site loads.  Figure 8 shows how to eliminate the ‚ÄúOminous Valley‚Äù effect, i.e., a modification of Figure 6 with such a download move that we need. <br><br><img src="https://habrastorage.org/files/800/a2d/8c2/800a2d8c2033403aa2b068fa9fe428cb.png"><br>  <em>Fig.</em>  <em>8. Elimination of the "Sinister Valley"</em> <em><br></em>  <em>The vertical axis is the load percentage (from 0 to 100%).</em> <em><br></em>  <em><strong>1.</strong> First, the initial request to the site starts, as in Figure 6.</em> <em><br></em>  <em><strong>2.</strong> After a while, download the HTML code.</em> <em><br></em>  <em><strong>3.</strong> And then immediately on the blocks the picture starts to load.</em>  <em>The picture is loaded in blocks, so its loading, shaded in yellow, has a stepped appearance.</em> <br><br><h3>  Interactivity </h3><br>  ‚ÄúInteractivity is something that really excites users,‚Äù Alex pointed out.  "You do not like the Sinister Valley, where you do not trust the user interface." <br><br>  To demonstrate the perfect page load, Alex showed the site <a href="https://shop.polymer-project.org/">shop.polymer-project.org</a> . <br><br><blockquote>  Site shop.polymer-project.org.  As expected, the site page loads quickly and fully interactive.  The total download duration is long, but it is ‚Äúbroken into blocks,‚Äù so the site remains manageable all the time.  These same blocks are loaded as needed, creating a comfortable experience using the site and eliminating the "Ominous Valley". </blockquote><br>  Downloading these blocks is even easier with HTTP / 2.  Using the server-side HTTP / 2 push method, you can in advance parallel ‚Äúpush‚Äù additional resources to the client, sending transitive functional dependencies for top-level content as soon as the right moment approaches. <br><br><blockquote>  Functional dependency is a concept underlying many issues related to relational databases, including, in particular, their design.  Mathematically, it represents a binary relation between sets of attributes of a given relation and is, in fact, a one-to-many connection.  Their use is due to the fact that they allow us to solve many problems formally and strictly.  A transitive functional dependency is a logical consequence of two other dependencies, a transitive chain.  <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F%2520%25D0%25B7%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2581%25D0%25B8%25D0%25BC%25D0%25BE%25D1%2581%25D1%2582%25D1%258C%2520(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)">Read more in Wikipedia</a> and Habrahabr: <a href="https://habrahabr.ru/company/jugru/blog/191246/">"Resolving conflicts in transitive dependencies - Good, Bad, Evil</a> . <a href="https://habrahabr.ru/company/jugru/blog/191246/">"</a> </blockquote><br><blockquote>  Work with index.html.  For example, if you get index.html, you can start sending responses with link = preload via HTTP / 2 "as soon as possible."  Figure 9 shows the listings for this process. </blockquote><br><img src="https://habrastorage.org/files/ab9/bf3/9a5/ab9bf39a539f4650a123227d62678de1.png"><br>  <em>Fig.</em>  <em>9. Scheme for receiving index.html and sending responses with link = preload via HTTP / 2-compatible server part ‚Äúas soon as possible‚Äù</em> <em><br></em>  <em><strong>1.</strong> HTTP request headers to get index.html.</em> <em><br></em>  <em><strong>2.</strong> HTTP response headers for sending responses with link = preload.</em> <br><br>  As soon as the initial response starts and is sent to the browser, you can immediately group the resources as needed by the client.  Figure 10 shows this process. <br><br><img src="https://habrastorage.org/files/975/994/186/97599418692148b28666898326fe45b1.png"><br>  <em>Fig.</em>  <em>10. Start the initial response and send it to the browser, followed by grouping resources.</em> <br><br>  For example, the components shown above can be sent as soon as you receive an initial response.  In this case, the components are not merged into one file, duplicating each other, which may lead to data loss or the appearance of unnecessary. <br><br><h3>  Lazy download and selective update </h3><br>  You can use lazy (or delayed) loading and create an alternative route with a selective update. <br><br><blockquote>  Lazy loading is refusing to download additional data when it is not necessary.  More on Habrahabr: <a href="https://habrahabr.ru/post/87083/">"Increase the speed of loading the site using lazy-load images"</a> , <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2582%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F%2520%25D0%25B8%25D0%25BD%25D0%25B8%25D1%2586%25D0%25B8%25D0%25B0%25D0%25BB%25D0%25B8%25D0%25B7%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">Wikipedia</a> , the <a href="http://design-pattern.ru/patterns/lazy-load.html">article "Lazy Load (Lazy loading)</a> . <a href="http://design-pattern.ru/patterns/lazy-load.html">"</a> </blockquote><br><blockquote>  Selective update is a trick that a Polymer team has come up with.  This technology makes components appear only when they are really needed.  When the user decides to go to another section, the necessary objects that were already in the document are initialized due to context switching. </blockquote><br>  To avoid the Sinister Valley when structuring and using PWA, the Polymer team developed a PRPL model as a guide to action.  This model consists of 4 steps: <br><br>  1) push through (Push) resources for the initial route; <br>  2) provide (Render) the initial route as soon as possible; <br>  3) pre-cache (Pre-cache) code in order to leave routes; <br>  4) lazy load (Lazy load) and the creation of the following routes on demand. <br><br>  Alex advised everyone to familiarize themselves with the Polymer App Toolbox in order to simply try, and also provided a list of resources (see below) to further study the service worker and PWA: ‚ÄúI can't wait to wait until we start building a web network much faster.‚Äù <br><br><h2>  Resources </h2><br><ul><li>  <a href="https://github.com/GoogleChrome/lighthouse">Lighthouse</a> </li><li>  <a href="https://udacity.com/course/offline-web-applications-ud899">offline web application course Udacity</a> </li><li>  <a href="https://polymer-project.org/1.0/toolbox/">Polymer App Toolbox</a> </li><li>  <a href="https://wapo.com/pwa">The Washington Post PWA</a> </li><li>  <a href="https://shop.polymer-project.org/">Shop on PRPL PWA</a> </li><li>  <a href="https://pwa.rocks/">other significant PWA events</a> </li><li>  <a href="https://developer.google.com/web/progressive-web-appsyoutube.com/ChromeDevelopers">Progressive web app codelabs</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/325788/">https://habr.com/ru/post/325788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325778/index.html">Life programmers</a></li>
<li><a href="../325780/index.html">How to find 56 potential vulnerabilities in FreeBSD code in one evening</a></li>
<li><a href="../325782/index.html">The book "Programming in Python"</a></li>
<li><a href="../325784/index.html">Web application security: practical cases</a></li>
<li><a href="../325786/index.html">Why we created a replacement for the old document search systems</a></li>
<li><a href="../325790/index.html">Look at yourself through Zuckerberg‚Äôs eyes and help his rivals.</a></li>
<li><a href="../325792/index.html">SystemD sucks, long live SystemD</a></li>
<li><a href="../325796/index.html">How to reduce the time to launch applications for iOS</a></li>
<li><a href="../325798/index.html">Kinetics of large clusters</a></li>
<li><a href="../325802/index.html">Working in the cloud on Hyper-V, part 4: creating backup copies of a virtual machine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>