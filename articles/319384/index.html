<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Direct disk access from python (simhdd)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, colleagues. Much time has passed since the first article was written. During this time, my library for disk access has learned to work...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Direct disk access from python (simhdd)</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/e03/2cf/e61/e032cfe6188049f884cb1bca3f78c6b5.jpg" alt="image"></div><br>  Good afternoon, colleagues.  Much time has passed since the <a href="https://habrahabr.ru/post/274195/">first article</a> was written.  During this time, my library for disk access has learned to work with embedded SMART tests and their logs, as well as with the security mechanisms of modern drives. <br><br>  This time I will talk about creating an application for testing hard disks based on this library. <br><a name="habracut"></a><br>  I needed an application that can be run on a server with a hot-swap basket and test disks on it, replacing them as they pass the tests.  The best solution for this seemed to me to start the process of testing each disk in a separate stream.  Since I did not have the experience of multithreaded programming in python, I began to study the question.  To create multi-threaded applications in python there is a threading module.  Since threads are created within the same process, there is no problem accessing shared data.  Everything looks very simple.  Unfortunately, the problem was waiting for me.  My library refused to work in multithreading mode.  So my path lay to writing an application with several processes and all the charms of interprocess communication.  Python has a multiprocessing module for this. <br><br>  I saw the architecture of the application as follows: The main thread deals with user interaction.  Displays a list of disks, accepts commands and displays the progress of tests.  Each disk command is run in a separate process.  To be sure that the test will be executed on the disk to which the command was given in the menu (for example, you can randomly rearrange the disks and forget to re-read it in the program) the serial number of the disk is made to execute the command.  Before executing the command, the correspondence of the serial number of the transmitted command at startup to the serial number of the connected drive is checked.  If the numbers do not match, the command is rejected with a sound signal.  A useful feature to not accidentally run a destructive test on a disk connected to watch SMART. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To exchange data between the main process and the testing process, several dictionaries were created.  The keys of the dictionaries are the serial numbers of the disks.  I don‚Äôt really like the solution in the form of a pack of dictionaries, but I haven‚Äôt yet come up with a better one. <br><br><img src="https://habrastorage.org/files/7cf/0a7/db9/7cf0a7db978d4b228413366fdd72a81a.jpeg" alt="image"><br>  This is what the main window of the program looks like. <br><br>  Each disk in the program has a mode in which it is located.  The default idle mode is idle.  When you run a test, this mode is changed to the name of the test being performed.  The test process regularly checks the compliance of the mode with its name and, if it does not, interrupts the test.  Thus, the main process can interrupt the test by changing the disk mode to idle.  The program can run embedded SMART tests on disks (Short and Extended), check disks by sequential reading and writing.  In this case, the recording test is made cyclical, prescribing the disk again and again, noting how many cycles were done.  Continuous loop recording allows you to ‚Äúfinish off‚Äù discs that have a ‚Äúspill‚Äù surface, but which have not yet scored the necessary number of errors to return to the supplier.  In a few days in this mode, they usually reach the SMART status bad state, which is the reason for the replacement.  On the screen, the test shows the speed of the test (where possible), the number of disk errors and the number of "slow" sectors.  The time after which the sector is considered ‚Äúslow‚Äù is given by a constant in the program.  The program can also show basic information on the disk, SMART and the logs of SMART tests. <br><br><img src="https://habrastorage.org/files/812/a94/867/812a94867fc5474ab5e4ecb1d7e2ed99.jpeg" alt="image"><br><br>  A write test can prescribe a disk with both zero values ‚Äã‚Äãand a unique pattern by which it can be determined that the disk has already been tested by this program.  The write method is also switched by a constant.  Since the program was designed to load the test environment over the network, it has the ability to disable the exit from the program menu. <br><br>  Here such a utility turned out, maybe someone will come in handy.  The <a href="https://github.com/kazenniy/simhdd">utility</a> code and the <a href="https://github.com/kazenniy/atapt">library</a> on which it is built is available on github. </div><p>Source: <a href="https://habr.com/ru/post/319384/">https://habr.com/ru/post/319384/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319370/index.html">Electronics development: from idea to device</a></li>
<li><a href="../319374/index.html">VPS-digest: 30 useful materials on Habr√© and not only</a></li>
<li><a href="../319378/index.html">Powershell Practice: Monitoring Windows Backup Backup</a></li>
<li><a href="../319380/index.html">Exploit Exercises or another site for VulnHub lovers</a></li>
<li><a href="../319382/index.html">How PVS-Studio looks for errors: methods and technologies</a></li>
<li><a href="../319386/index.html">Modal windows and notifications in Angular</a></li>
<li><a href="../319388/index.html">BLE under the microscope 2</a></li>
<li><a href="../319392/index.html">Realistic UI: a realistic look at the Optimistic UI</a></li>
<li><a href="../319394/index.html">Own image slider on jQuery</a></li>
<li><a href="../319396/index.html">Evernote overview and integration (based on GTD using the Wunderlist example)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>