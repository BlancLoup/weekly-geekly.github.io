<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PVS-Studio analyzer checks TortoiseGit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most of our articles talk about errors found in various projects with the help of the PVS-Studio analyzer. This time, the TortoiseGit project was the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PVS-Studio analyzer checks TortoiseGit</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/ff5/072/7ad/ff50727ad7407b44a856a3801876395f.png" align="left"><br>  Most of our articles talk about errors found in various projects with the help of the PVS-Studio analyzer.  This time, the TortoiseGit project was the target for verification. <br><a name="habracut"></a><br><h2>  Tortoisegit </h2><br>  <a href="http://www.viva64.com/go.php%3Furl%3D1402">Description</a> from Wikipedia: <b>TortoiseGit</b> is a visual client of the git source code management system for Microsoft Windows.  Implemented as a Windows Explorer extension (shell extension).  The user interface is almost identical to TortoiseSVN, with the exception of Git-specific features. <br><br>  The TortoiseGit project is small.  The size of the downloaded source code is 35 megabytes.  And if you drop the ‚Äúext‚Äù folder, then only 9 megabytes will remain. <br><br>  Developers obviously care about quality.  Indirectly, this is evidenced by the fact that when compiling with Visual C ++, the / W4 key is used (fourth level of warning details).  Plus, in the source code I met the mention of the <a href="http://www.viva64.com/ru/t/0083/">Cppcheck</a> analyzer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's see if something interesting can be found in this PVS-Studio project. <br><br><h2>  Test results </h2><br>  <b>A note for TortoiseGit developers.</b>  Immediately check the project does not work.  There is confusion with the connection of files stdafx.h.  I will explain quite briefly. <br><br>  In some places the wrong stdafx.h files will be connected.  When compiling problems is not visible, since the compiler takes data from precompiled * .pch files.  But these errors manifest themselves when trying to create preprocessed * .i files.  The developers of TortoiseGit can write to us, and we will show you how to fix the project. <br><br><h3>  Badies with m_Rev2 </h3><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CGitStatusListCtrl</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CListCtrl { .... CString m_Rev1; CString m_Rev2; .... }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CGitStatusListCtrl::OnContextMenuList(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;m_Rev1.IsEmpty()) || (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;m_Rev1.IsEmpty()) ) .... }</code> </pre> <br>  PVS-Studio warning: V501 There are identical sub-expressions '(! This-&gt; m_Rev1.IsEmpty ())' to the left and to the right of the '||'  operator.  gitstatuslistctrl.cpp 1560 <br><br>  There are two members in the class: m_Rev1 and m_Rev2.  Most likely, they should have been present in the expression.  Then, the code should be like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;m_Rev1.IsEmpty()) || (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;m_Rev2.IsEmpty()) )</code> </pre> <br>  Another very similar place: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CGitStatusListCtrl::OnNMDblclk(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( (!m_Rev1.IsEmpty()) || (!m_Rev1.IsEmpty())) <span class="hljs-comment"><span class="hljs-comment">// m_Rev1 twice??? .... }</span></span></code> </pre> <br>  PVS-Studio warning: V501 There are identical sub-expressions '(! M_Rev1.IsEmpty ())'  operator.  gitstatuslistctrl.cpp 2642 <br><br>  There is a comment in the code that says that developers are also suspicious :). <br><br>  And one more such typo can be found here: gitstatuslistctrl.cpp 3274. <br><br><h3>  Something is wrong with the terms </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">svn_error_t</span></span> * svn_mergeinfo__adjust_mergeinfo_rangelists(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (range-&gt;start + offset &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; range-&gt;end + offset &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (range-&gt;start + offset &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) range-&gt;start = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> range-&gt;start = range-&gt;start + offset; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (range-&gt;end + offset &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) range-&gt;end = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> range-&gt;end = range-&gt;end + offset; .... }</code> </pre> <br>  PVS-Studio Warning: V637 Two opposite conditions were encountered.  The second condition is always false.  Check lines: 2464, 2466. TortoiseGitMerge mergeinfo.c 2464 <br><br>  There is something wrong with the terms.  To make it clearer, let's simplify the code: <ul><li>  Replace "range-&gt; start + offset" with A; </li><li>  Replace "range-&gt; end + offset" with B. </li></ul>  It turns out the following pseudocode: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (A &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; B &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (A &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) range-&gt;start = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> range-&gt;start = A; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (B &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) range-&gt;end = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> range-&gt;end = B; .... }</code> </pre> <br>  Now you can clearly see that there is no point in doing checks (A &lt;0), (B &lt;0).  These conditions are never met.  The code contains some logical errors. <br><br><h3>  Forgot pointer dereference </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">svn_path_splitext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **path_root, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **path_ext, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">apr_pool_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *pool)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *last_dot; .... last_dot = <span class="hljs-built_in"><span class="hljs-built_in">strrchr</span></span>(path, <span class="hljs-string"><span class="hljs-string">'.'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (last_dot &amp;&amp; (last_dot + <span class="hljs-number"><span class="hljs-number">1</span></span> != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>)) .... }</code> </pre> <br>  PVS-Studio warning: V528 It is odd that the pointer to the 'char' type is compared with the '\ 0' value.  Probably meant: * last_dot + 1! = '\ 0'.  path.c 1258 <br><br>  Consider the expression (last_dot + 1! = '\ 0') in more detail.  In it, a unit is added to the pointer, after which the result is compared with zero.  This expression has no practical meaning.  I think the code should be like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (last_dot &amp;&amp; (*(last_dot + <span class="hljs-number"><span class="hljs-number">1</span></span>) != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>))</code> </pre> <br>  Although, perhaps, it is better to write: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (last_dot &amp;&amp; last_dot[<span class="hljs-number"><span class="hljs-number">1</span></span>] != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>)</code> </pre> <br>  PVS-Studio analyzer found another similar error: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fuzzy_escape</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *src, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">apr_size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> len, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">apr_pool_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *pool)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *src_orig = src; .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (src_orig &lt; src_end) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (! svn_ctype_isascii(*src_orig) || src_orig == <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) .... }</code> </pre> <br>  PVS-Studio warning: V528 It is odd that the pointer to the 'char' type is compared with the '\ 0' value.  Probably meant: * src_orig == '\ 0'.  utf.c 501 <br><br>  It should be written: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (! svn_ctype_isascii(*src_orig) || *src_orig == <span class="hljs-string"><span class="hljs-string">'\0'</span></span>)</code> </pre> <br><h3>  Octal number </h3><br>  There is a code that wanders from project to project using Copy-Paste, and I often see it.  It contains an error due to which almost all programs behave incorrectly with IBM EBCDIC US-Canada encoding.  I think it's not scary.  I do not think that someone is using this encoding.  However, it is worth telling about the error.  Here is the code: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> CodeMap <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>[]= { {<span class="hljs-number"><span class="hljs-number">037</span></span>, _T(<span class="hljs-string"><span class="hljs-string">"IBM037"</span></span>)}, <span class="hljs-comment"><span class="hljs-comment">// IBM EBCDIC US-Canada {437, _T("IBM437")}, // OEM United States {500, _T("IBM500")}, // IBM EBCDIC International .... };</span></span></code> </pre> <br>  PVS-Studio warning: V536 Be advised that it is not possible.  Oct: 037, Dec: 31. unicodeutils.cpp 42 <br><br>  To make the text of the program look beautiful, 0 was added to the number 37. This is wrong.  The decimal number 37 turned into an octal number 037. The octal number 03 is 7 decimal number 31. <br><br><h3>  Conditions that are always true or false </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CCloneDlg::OnBnClickedCheckSvn() { .... CString str; m_URLCombo.GetWindowText(str); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(str.GetLength()&gt;=<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; str[str.GetLength()<span class="hljs-number"><span class="hljs-number">-1</span></span>] == _T(<span class="hljs-string"><span class="hljs-string">'\\'</span></span>) &amp;&amp; str[str.GetLength()<span class="hljs-number"><span class="hljs-number">-1</span></span>] == _T(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)) { str=str.Left(str.GetLength()<span class="hljs-number"><span class="hljs-number">-1</span></span>); } .... }</code> </pre> <br>  PVS-Studio warnings: V547 Expression is always false.  Probably the '||'  operator should be used here.  clonedlg.cpp 413 <br><br>  The above code snippet should remove all the characters \ and / at the end of the line.  In fact, these characters will not be deleted.  Error in this location: <br><pre> <code class="cpp hljs">str[str.GetLength()<span class="hljs-number"><span class="hljs-number">-1</span></span>] == _T(<span class="hljs-string"><span class="hljs-string">'\\'</span></span>) &amp;&amp; str[str.GetLength()<span class="hljs-number"><span class="hljs-number">-1</span></span>] == _T(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)</code> </pre> <br>  The character in the string can not be both \ and /.  The program should look like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(str.GetLength()&gt;=<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; (str[str.GetLength()<span class="hljs-number"><span class="hljs-number">-1</span></span>] == _T(<span class="hljs-string"><span class="hljs-string">'\\'</span></span>) || str[str.GetLength()<span class="hljs-number"><span class="hljs-number">-1</span></span>] == _T(<span class="hljs-string"><span class="hljs-string">'/'</span></span>))) { str=str.Left(str.GetLength()<span class="hljs-number"><span class="hljs-number">-1</span></span>); }</code> </pre> <br>  Similar error with status check: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> git_ack_status { GIT_ACK_NONE, GIT_ACK_CONTINUE, GIT_ACK_COMMON, GIT_ACK_READY }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wait_while_ack</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(gitno_buffer *buf)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pkt-&gt;type == GIT_PKT_ACK &amp;&amp; (pkt-&gt;status != GIT_ACK_CONTINUE || pkt-&gt;status != GIT_ACK_COMMON)) { .... }</code> </pre> <br>  PVS-Studio warning: V547 Expression is always true.  Probably the '&amp;&amp;' operator should be used here.  smart_protocol.c 264 <br><br>  Here, on the contrary, the condition is always satisfied.  The status is always unequal GIT_ACK_CONTINUE or not equal to GIT_ACK_COMMON. <br><br><h3>  There is no virtual destructor </h3><br>  The program has a class Command, which contains virtual functions: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Command</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; .... };</code> </pre> <br>  Destructor forgot to declare virtual.  Many other classes are inherited from the class: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SVNIgnoreCommand</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Command .... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddCommand</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Command .... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AutoTextTestCommand</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Command ....</code> </pre> <br>  Since the program works with a pointer to the base class, it leads to problems when destroying objects. <br><pre> <code class="cpp hljs">BOOL CTortoiseProcApp::InitInstance() { .... Command * cmd = server.GetCommand(....); .... <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> cmd; .... }</code> </pre> <br>  PVS-Studio warning: V599 The virtual destructor is not present, although the 'command' class contains virtual functions.  TortoiseGitProc tortoiseproc.cpp 497 <br><br>  <b>Note.</b>  I will make a small digression.  Often people joke and scoff when discussing a hackneyed question at the interview ‚ÄúWhy do we need virtual destructors?‚Äù.  Like, how much can you ask it. <br><br>  And in vain, by the way laugh.  Very good question.  I will ask it.  It allows you to quickly identify suspicious individuals.  If a person answers the question about virtual destructors, it certainly does not mean anything special.  He either read about it in a booklet or showed interest in what questions are usually asked at interviews.  And he decided to prepare, having studied the answers to the model questions. <br><br>  Again.  The correct answer to the question does not guarantee that a person is a good programmer.  It is much more important if a person cannot answer this question.  How can I read books on C ++, read articles on the Internet about interviews, and skip this topic?  Very strange! <br><br><h3>  Potential null pointer dereference </h3><br>  This time, I did not carefully watch the warnings related to the potential possibility of exchanging the null pointer.  There are a number of diagnostics <a href="http://www.viva64.com/ru/d/0205/">V595</a> , but something is not interesting to watch and study them.  I will give only one example: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">free_decoration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct decoration *n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object_decoration</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">n</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || n-&gt;hash == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; .... }</code> </pre> <br>  PVS-Studio warning: V595 The 'n' pointer was used before it was verified against nullptr.  Check lines: 41, 43. decorate.c 41 <br><br>  The pointer 'n' is dereferenced in the expression 'n-&gt; hash'.  Below, the 'n' pointer is checked for NULL equality.  This means that the pointer may be null and this will lead to problems. <br><br><h3>  Invalid string format </h3><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CGit::GetCommitDiffList(....) { .... cmd.Format( _T(<span class="hljs-string"><span class="hljs-string">"git.exe diff -r -R --raw -C -M --numstat -z %s --"</span></span>), ignore, rev1); .... }</code> </pre> <br>  PVS-Studio warning: V576 Incorrect format.  A different number of actual arguments is expected while calling 'Format' function.  Expected: 2. Present: 3. git.cpp 1231 <br><br>  One actual argument is superfluous. <br><br><h3>  Potentially dangerous array index </h3><br>  TortoiseGit has the following code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> svn_error_t * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">token_compare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> idx = datasource_to_index(file_token[i]-&gt;datasource); file[i] = &amp;file_baton-&gt;files[idx]; .... }</code> </pre> <br>  It is dangerous because the variable 'idx' theoretically can have a negative value.  The analyzer noticed that the datasource_to_index function can return the value -1 in case of an error: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">datasource_to_index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(svn_diff_datasource_e datasource)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (datasource) { .... } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; }</code> </pre> <br>  PVS-Studio warning: V557 Array underrun is possible.  The value of 'idx' index could reach -1.  diff_file.c 1052 <br><br>  So, while this code may work, it is potentially dangerous.  May occur beyond the boundary of the array. <br><br><h3>  Resource leak </h3><br><pre> <code class="cpp hljs">CMyMemDC(CDC* pDC, ....) { .... CreateCompatibleDC(pDC); .... }</code> </pre> <br>  PVS-Studio Warning: V530 The Return Value of Function 'CreateCompatibleDC' is required to be utilized.  mymemdc.h 36 <br><br>  The device context (DC) is created, but it is not used or destroyed at all.  Similar situation here: mymemdc.h 70 <br><br><h3>  Different enum types are compared. </h3><br>  There is confusion when comparing numbered types: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> { ABORT, VERBATIM, WARN, WARN_STRIP, STRIP } signed_tag_mode = ABORT; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> { ERROR, DROP, REWRITE } tag_of_filtered_mode = ERROR; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_tag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *name, struct tag *tag)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(tag_of_filtered_mode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ABORT: .... }</code> </pre> <br>  PVS-Studio warning: V556 The values ‚Äã‚Äãof different enum types are compared: switch (ENUM_TYPE_A) {case ENUM_TYPE_B: ...}.  fast-export.c 449 <br><br>  The variable tag_of_filtered_mode is of one type, and ABORT is of another type. <br><br><h3>  Typo </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">blame_internal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(git_blame *blame)</span></span></span><span class="hljs-function"> </span></span>{ .... blame-&gt;ent = ent; blame-&gt;path = blame-&gt;path; .... }</code> </pre> <br>  PVS-Studio warning: V570 The 'blame-&gt; path' variable is assigned to itself.  blame.c 319 <br><br><h3>  Other errors </h3><br>  Were found and other errors and shortcomings.  But they did not seem interesting to me to describe them in the article.  TortoiseGit developers will be able to easily find all the shortcomings using the PVS-Studio tool. <br><br>  I want to remind you that the main advantage of static analysis is its regular use.  Download and check one-time code, this is self-indulgence, and not the use of static code analysis techniques.  For example, programmers watch the compiler warnings regularly, rather than turning them on every 3 years before one of the releases. <br><br><h2>  Conclusion </h2><br>  This article turned out with a strong advertising bias.  I apologize.  Firstly, not every time really <a href="http://www.viva64.com/ru/b/0251/">interesting</a> <a href="http://www.viva64.com/ru/b/0249/">articles</a> about checking projects are obtained.  Secondly, I want more people to learn about the PVS-Studio analyzer.  This is a great, inexpensive tool that can suit a huge audience of developers using Visual C ++.  With regular use, it will save a lot of time searching for typos and other errors. <br><br>  Download PVS-Studio: <a href="http://www.viva64.com/ru/pvs-studio-download/">http://www.viva64.com/en/pvs-studio-download/</a> <br><br><h2>  This article is in English. </h2><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov.  <a href="http://www.viva64.com/en/b/0256/">The PVS-Studio Analyzer Checks TortoiseGit</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected the answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio and CppCat, version 2014</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/223243/">https://habr.com/ru/post/223243/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../223221/index.html">Google Play now supports PayPal payments.</a></li>
<li><a href="../223223/index.html">Noisli: an online background noise generator that helps concentrate</a></li>
<li><a href="../223229/index.html">Typograph Muravyova published on GitHub</a></li>
<li><a href="../223231/index.html">Rare graphic station SGI Indy. 20 years later. Part two. IRIX installation</a></li>
<li><a href="../223237/index.html">The Arecibo Observatory has confirmed the existence in the Universe of a new type of superpowerful sources of radio emission.</a></li>
<li><a href="../223245/index.html">Dell Active Fabric Manager 2.5: why you need it and what's new in the latest version</a></li>
<li><a href="../223247/index.html">Guikporn 4 - we continue to open the microcircuits: –ë–ö0010, MEMS gyroscope and some Rosnano</a></li>
<li><a href="../223251/index.html">Collect your essays on Angular.js</a></li>
<li><a href="../223253/index.html">‚ÄúForgotten‚Äù programming paradigms</a></li>
<li><a href="../223255/index.html">Python-digest # 27. News, interesting projects, articles and interviews [May 12, 2014 - May 18, 2014]</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>