<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ranking in Yandex: how to put machine learning on stream (post # 3)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we are completing a series of publications on the FML framework , in which we talk about how and why we have automated the use of machine learni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ranking in Yandex: how to put machine learning on stream (post # 3)</h1><div class="post__text post__text-html js-mediator-article">  Today we are completing a <a href="http://habrahabr.ru/search/%3Fq%3D%255BFML%255D%26target_type%3Dposts">series of publications on the FML framework</a> , in which we talk about how and why we have automated the use of machine learning technologies in Yandex.  In today's post we will tell: <br><ul><li>  why you need to monitor the quality of factors and how we do it; </li><li>  how FML helps in distributed computing tasks on a search index; </li><li>  how and for what our machine learning technologies are already used and can be applied both in Yandex and outside it; </li><li>  what literature can be advised for deeper immersion in the affected issues. </li></ul><img src="https://habrastorage.org/getpro/habr/post_images/afa/19d/045/afa19d045b2bce238895a5f2856f9174.gif"><br><img src="https://habrastorage.org/getpro/habr/post_images/377/92a/336/37792a33661b080e41297e5c2f1ef177.png" alt="image"><br><a name="habracut"></a><br><br><h4><a name="Monitoring"></a>  Monitoring the quality of already implemented factors </h4><br>  In the <a href="http://habrahabr.ru/company/yandex/blog/174975/">previous post,</a> we dwelled on the fact that with the help of FML we were able to streamline the development of new factors for the ranking formula and an initial assessment of their usefulness.  However, to follow that the factor remains valuable and does not waste the computational resources, it is necessary after its implementation. <br><br>  For this, a special regular automatic check was created - the so-called monitoring of the quality of factors.  Computationally, it is very complex, but it allows to solve a number of problems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first is the identification of applicants for "deletion."  Having once found that the factor makes a great contribution and its price is acceptable, and after taking a decision on its implementation, it is important to ensure that it remains useful over time, despite the appearance of new and new factors.  After all, the new can easily be more general and strong than the old, and not only create new value, but also duplicate it.  For example, when we first introduced the factor ‚Äúthe occurrence of the query words in the URL written in Latin,‚Äù and after some time we made a new one that supports the entry in URLs recorded in both Latin and Cyrillic, the first one lost all value.  The old version should be deleted for at least two reasons: 1) saving on the time of calculation of the old factor;  2) reducing the dimension of signs in learning. <br><br>  Sometimes there is another situation.  The factor used to bring "many benefits", and now it, although it remains useful, does not pass the quality / cost threshold.  This can happen if it has lost its relevance, or has become partially duplicated by newer factors.  Therefore, you need to create a healthy evolution - so that weak factors die and give way to strong ones.  But there is not enough data from the FML, and the final decision on the removal of the factor is made by experts. <br><br>  There is another problem that quality monitoring solves.  By tracking the fact that the utility of a factor once implemented has not decreased, it provides regression testing.  The quality of a factor may fall, for example, due to an accidental modification or a systemic change in the properties of the Internet on which it originally relied.  In this case, the system will notify the developer that this factor needs to be ‚Äúrepaired‚Äù (correct the error or modify it so that it meets the new realities). <br><br>  The third monitoring task that he will soon begin to solve is getting rid of redundancy factors.  Until a certain point, we did not check whether the new factor duplicates any of the already implemented ones.  As a result, it could well turn out that, for example, there are two factors that repeat each other.  But if you measure what contribution each of them alone gives in relation to all the others, it turns out that it is equal to zero.  And if you exclude both factors, the quality will fall.  And the task is precisely to choose which of the duplicating factors are most effectively left, in terms of the same ratio of quality growth to the price of calculations.  Computationally, this is many orders of magnitude more difficult than estimating a new factor.  To solve this problem, we plan to use an <a href="http://habrahabr.ru/company/yandex/blog/174975/">extended cluster of 300 Tflops</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6f2/cbb/54a/6f2cbb54a82fb354d800fbea21ca0b2b.png" alt="image"><br>  <i>A situation in which each of two factors, I and J,</i> <i><br></i>  <i>give zero contribution - (J, K, L) and (I, K, L),</i> <i><br></i>  <i>but removing both of them leads to a deterioration in quality - (K, L).</i> <i><br></i>  <i>You can exclude any one (I or J).</i> <i><br></i>  <i>It is more profitable to exclude J, as more resource-intensive.</i> <br><br><h4><a name="Conveyor"></a>  Distributed computing pipeline </h4><br>  This and <a href="http://habrahabr.ru/company/yandex/blog/174213/">previous</a> <a href="http://habrahabr.ru/company/yandex/blog/174975/">posts</a> talked about specific applications for FML in the context of regular machine learning.  But in the end, the framework went beyond these applications and became a full-fledged platform for distributed computing over a search index. <br><br>  Dedicated readers probably noticed that everywhere where FML is used, we are talking about approximately the same dataset: downloaded documents, saved queries, assessor estimates, and the results of factor calculations.  We also noticed it at one time, and also looked at the number of other tasks that are already being solved in the Search and rely on this data anyway;  and decided to derive additional benefit from this.  Namely, they made a full-fledged pipeline from FML for arbitrary distributed computing on this data set, which are performed on a computing cluster numbering several thousand servers. <br><br>  We have achieved that FML makes it easier to perform distributed calculations on the search index and additional data specific to a particular task.  The search index is updated several times a week, and with each update a substantial part of it is moved between servers for a more optimal use of resources.  FML completely relieves the developer from worries about finding the right index fragment and gives him full and consistent access to it.  The framework diagnoses the integrity of the index and runs the calculations on those servers in the cluster where the data necessary for the developer lies. <br><br>  In contrast to the search index, FML data specific to the current task is decomposed by itself into servers.  It also takes control of the distributed execution of competing user tasks.  As soon as the calculations are started, FML begins to monitor the progress of the calculations and when one of the tasks on a particular server becomes unavailable, it gives a signal to the administrators.  After receiving it, they begin to diagnose a specific situation with this task on this server, whether it is a disk failure, a network failure, or a complete server outage.  In our future plans - to help administrators as much as possible detailed diagnosis and simplify the search for the causes of certain failures.  The latter in terms of several thousand servers is a completely ordinary matter, and they occur many times a day.  Therefore, we will greatly save the manual labor of administrators if we automate it at least a little. <br><br>  At first glance, all this is very similar to the YAMR tasks ‚Äî the same distribution of computations, the collection of results and the assurance of reliability.  But there are two dramatic differences.  First, FML deals with the search index, and not with the classic ‚Äúkey-value‚Äù structure adopted in YAMR.  The search index implies that all samples come from a combination of a large number of keys at once (in the simplest case, several query words).  Working with such samples in the key-value paradigm is fundamentally difficult.  And secondly, if YAMR itself decides how to decompose data into servers, then FML can work with any data distribution predetermined by the external system according to its own laws. <br><br>  The solution turned out to be so successful that most of the Search development teams on their own initiative switched to the use of FML, and, according to our estimates, today about 70% (in terms of processor time) of calculations in Yandex.Search development is managed by FML. <br><br><h4><a name="Applications"></a>  Applications and comparison with analogues </h4><br>  As we have <a href="http://habrahabr.ru/company/yandex/blog/174213/">said</a> , FML and Matrixet are parts of the machine learning technology of Yandex.  And it is used not only in the web search.  For example, with its help, formulas are selected for the so-called ‚Äúvertical‚Äù searches (for images, videos, etc.) and for preliminary screening of completely irrelevant documents in a web search.  It helps to teach the classification algorithm for products by category in Yandex.Market.  In addition, machine learning selects formulas for the search robot (for example, for a strategy that determines in which order to crawl websites).  And in all these cases it solves the same task - it builds the function that best corresponds to the expert data submitted to the input.  We think in the near future we will find for him many more applications in Yandex.  For example, we use in training classifiers, of which we have a lot. <br><br>  FML paired with the Matrixet machine learning library can be useful not only in search engine development, but also in other areas where data processing is required.  With some teams, we have already tried them to build a search for specialized types of data, taking into account specific factors.  For example, CERN (European Nuclear Research Center) <a href="http://habrahabr.ru/company/yandex/blog/166497/">uses Matrixnet</a> to detect rare events in large amounts of data (units per billion).  Traditionally, the TMVA package was used there, based on the Gradient Boosted Decision Trees (GBDT).  Since Matriksnet on our problems and our metrics has long become more accurate than a simple GBDT, we expect that CERN physicists will be able to use it to improve the accuracy of their research. <br><br><div class="spoiler">  <b class="spoiler_title">Why Matriksnet can open the way for the Nobel Prize</b> <div class="spoiler_text"> One of the types of events for which FML / Matrixnet can be applied is the incidence of a strange B-meson into a muon-anti-muon pair.  Physically, the real readings of one of the detectors of the Large Andron Collider after a collision of proton beams are compared with the reference values ‚Äã‚Äãobtained in the event simulator. <br><br>  The standard model considers such decays to be very rare events (approximately 3 events per billion collisions).  And if, as a result of the analysis of experimental data, Matriksnet reliably shows that there are more such events and their number coincides with the predictions of one of the <a href="http://elementy.ru/LHC/LHC/tasks/SUSY">new physicists</a> , this will mean the validity of these theories and could be the first long-awaited reason for awarding the Nobel Prize to their authors. </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/67e/dc5/fba/67edc5fba0ec7b200978f64ce1721829.jpg" alt="image"><br><br>  Looking more broadly at what our technology can do, we are confident that it can be useful in many areas where typical machine learning tasks are encountered - especially if they are dealing with a large data array that changes over time.  For example, in large online stores, online auctions, social networks. <br><br>  Now we know only one industrial solution for a close problem, besides our own, - <a href="https://developers.google.com/prediction/">Google Prediction API</a> .  There are several startups like <a href="https://bigml.com/developers">BigML</a> .  Unfortunately, we could not find information about their effectiveness for various applications.  The Amazon Cloud Service can still serve as a pipeline for computational tasks, but a close examination showed that this is a very general solution for completely arbitrary tasks.  While ours is created specifically for search engines and is maximally revealed in them.  The analogs of FML in solving the problems of ‚ÄúEvaluating the effectiveness of a new factor‚Äù and ‚ÄúMonitoring the quality of factors‚Äù are completely unknown to us. <br><br>  An external observer can indirectly judge the effectiveness of our technology, based on the results of international machine learning competitions.  For example, Yandex specialists occupied high places in the rankings of <a href="http://learningtorankchallenge.yahoo.com/">Yahoo Learning to Rank</a> and <a href="http://www.kaggle.com/c/FacebookRecruiting">Facebook Recruiting</a> , in which the struggle for the accuracy of the ranking function is in terms of thousandths of the ERR / NDCG.  They showed good results at machine learning contests and in other areas. <br><br>  To be sure that our technologies remain the best in their field, we regularly hold our own machine learning contests - in the framework of <a href="http://events.yandex.ru/events/imat/">the ‚ÄúInternet-Mathematics‚Äù series</a> .  Topics include <a href="http://events.yandex.ru/events/imat/2009/">machine learning ranking</a> , <a href="http://events.yandex.ru/events/imat/2010/">traffic jams</a> prediction, <a href="http://imat2011.yandex.ru/datasets">classification of panoramic photos</a> .  Two years ago, our competitions became international, and the final stage of the competition on <a href="http://research.microsoft.com/en-us/um/people/nickcr/wscd2012/">predicting relevance on user behavior was</a> held at the <a href="http://www.wsdm2012.org/">WSDM 2012</a> conference in Seattle (USA).  Quite recently, a competition devoted to <a href="http://events.yandex.ru/events/imat/switchdetect/">predicting search engine switching</a> has ended. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afa/19d/045/afa19d045b2bce238895a5f2856f9174.gif">  Despite the fact that the FML framework, which we told you about in this series of posts, was originally designed to work with Matrixnet, it can be adapted to any other known machine learning library (for example, <a href="http://mahout.apache.org/">Apache Mahout</a> , <a href="http://www.cs.waikato.ac.nz/ml/weka/">Weka</a> , <a href="http://scikit-learn.org/stable/">scikit-learn</a> ). <br><br><h4><a name="Reading"></a>  Recommended literature </h4><br>  Recently, there have been several good online machine learning courses.  In English, we can recommend the <a href="http://see.stanford.edu/see/courseInfo.aspx%3Fcoll%3D348ca38a-3a6d-4052-937d-cb017338d7b1">course of Stanford University</a> , in Russian - the <a href="http://www.machinelearning.ru/wiki/index.php%3Ftitle%3D%25D0%259C%25D0%25B0%25D1%2588%25D0%25B8%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BE%25D0%25B1%25D1%2583%25D1%2587%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_(%25D0%25BA%25D1%2583%25D1%2580%25D1%2581_%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2586%25D0%25B8%25D0%25B9,_%25D0%259A.%25D0%2592.%25D0%2592%25D0%25BE%25D1%2580%25D0%25BE%25D0%25BD%25D1%2586%25D0%25BE%25D0%25B2)">course of Konstantin Vorontsov</a> , which is read in the School of Data Analysis. <br><br>  From the ‚Äúpaper‚Äù editions, we note two editions: <a href="http://www.amazon.com/Elements-Statistical-Learning-Prediction-Statistics/dp/0387848576/">The Elements of Statistical Learning: Data Mining, Inference, and Prediction (Trevor Hastie, Robert Tibshirani, Jerome Friedman)</a> (available <a href="http://www-stat.stanford.edu/~tibs/ElemStatLearn/printings/ESLII_print10.pdf">in electronic form</a> ) and <a href="http://research.microsoft.com/en-us/um/people/cmbishop/PRML/">Pattern Recognition and Machine Learning (Christopher M. Bishop )</a> . <br><br>  In addition, <a href="https://www.kaggle.com/wiki/Tutorials">an extensive selection of courses and textbooks collected at Kaggle</a> will be helpful. </div><p>Source: <a href="https://habr.com/ru/post/175917/">https://habr.com/ru/post/175917/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../175897/index.html">FullHD Butterfly Review: HTC Butterfly</a></li>
<li><a href="../175899/index.html">Script for receiving information from remote unix-like servers</a></li>
<li><a href="../175911/index.html">Win32 / Gapz: the last episode</a></li>
<li><a href="../175913/index.html">How accurate is the demographic targeting of Google?</a></li>
<li><a href="../175915/index.html">Note on Instructions (no claim to world domination)</a></li>
<li><a href="../175919/index.html">Arbor Pravail APS and DDOS</a></li>
<li><a href="../175921/index.html">Address Book Sharepoint 2010 from AD with synchronization</a></li>
<li><a href="../175929/index.html">Correct names and helpful errors</a></li>
<li><a href="../175931/index.html">The digest of interesting news and materials from the world of PHP for the last two weeks, No. 14 (03/26/2013 - 04/08/2013)</a></li>
<li><a href="../175933/index.html">Virality in games</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>