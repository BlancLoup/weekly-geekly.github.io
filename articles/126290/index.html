<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Headtracking or how to see a three-dimensional teapot on a two-dimensional monitor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the past semester, I took a computer vision course and in the end I had to do a final project on any topic that is connected with it. I wondered wh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Headtracking or how to see a three-dimensional teapot on a two-dimensional monitor</h1><div class="post__text post__text-html js-mediator-article">  In the past semester, I took a computer vision course and in the end I had to do a final project on any topic that is connected with it.  I wondered whether it was possible using the webcam to track the user's eyes and show him 3D objects from the right angle, which I decided to do.  Those.  to make such a window out of the monitor into the virtual world.  Now I want to share with the users about how I did it and what pitfalls we encountered on the way. <br><a name="habracut"></a><br><h4>  Where are the eyes? </h4><br>  Then I had a little time, so I didn‚Äôt want to do everything from scratch.  Without hesitation, I pulled off FaceAPI, which was free for educational purposes, and began to torture her.  After some torment, it turned out that it can quite well determine the position of the head, as well as the eye, and, most importantly, it can immediately issue the 3D position and orientation of each eye in the webcam's coordinate system. <br><br><h4>  What do eyes see? </h4><br>  So, we have eye positions, now we need to find out what they see.  By the way, it is assumed that the user will be a cyclops with one working eye just between the two real ones.  The first attempt to make everything easy and simple, screwing a virtual camera in OpenGL to the place where the user's eye should be unsuccessful, as it was not realistic at all. On the video you can see how it looked: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/UjBr7CLJMN4%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhggZOok75_3XacOjQbnJj7Q1AxguA" frameborder="0" allowfullscreen=""></iframe><br><br>  Purely subjective, it was bad that the teapot increased greatly as it approached.  I began to think what was wrong here and even conducted a simple experiment with improvised means: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Rl7WHFVlAv8%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhjLeiid6FHdEHQZ6u8mv31gNZgx3Q" frameborder="0" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Pay attention to the size of the phone relative to the size of the hole.  It turns out that when approaching our kettle should not increase, but, on the contrary, decrease (for the case when it is outside the ‚Äúwindow‚Äù).  This is how it looks like: <br><img src="https://habrastorage.org/storage1/0f3f947b/f0fec47d/8ff5b1ac/6e7792d6.jpg"><br><br>  Immediately there is another problem, when viewed from the side, the proportions are distorted.  The problem is that OpenGL renders us a picture as if it is perpendicular to the view, but the user sees the monitor plane at an angle. <br><img src="https://habrastorage.org/storage1/23c7076f/97467250/94623af8/f7727852.jpg"><br><br>  As a result, the image is distorted. <br><img src="https://habrastorage.org/storage1/bb23f0f1/5084539b/7c55dca8/de42468c.jpg"><br><br>  And in the picture the correct image is on the right, not on the left.  If you look at it to the right of the monitor (approximately there was the user's head), then it will be correct, and the left one distorted. <br><br><h4>  How to correct what he saw? </h4><br>  To fix both problems in one fell swoop, you need to make sure that the user sees on the screen exactly what he would see in the real world, if he looks through the window.  This can be done in different ways, but at that time I came up with this: I need to render everything as before, but look for the rendered image of the area that would correspond to the area of ‚Äã‚Äãthe monitor in the real world.  To do this, we had to arm ourselves with a ruler, measure the display and the position of each angle relative to the camera (our SC is attached to it) and thus get its position in the three-dimensional space of our scene, then calculate the physical position of the window on the monitor.  The picture shows a frame that corresponds to a window on the monitor in three-dimensional space. <br><img src="https://habrastorage.org/storage1/21d64091/856d62d9/0cbd6926/6a0eab18.jpg"><br><br>  Now we need to make the contents of this area stretched across the entire window.  To do this, we project the points corresponding to the corners of the real window on the monitor in 3D space on the display plane, where the OpenGL image is rendered (actually multiply the coordinates of these points on the projection matrix), we find the homography (homography is such a matrix that allows you to map the points to one image points of another, you can find it with the help of OpenCV or write all the pens) between the resulting quadrilateral and the rectangle of the window on the real display and map our rendered image to the rectangle  niku real display window (again OpenCV to help us). <br><br>  The result is a correct picture of what a person would see if this window were a real window into the virtual world. <br><br>  The truth is, there is one more trifle: if the user is far from the monitor, then with a constant FOV it turns out that the useful part of the image (actually what is seen through the monitor) is quite small. <br><img src="https://habrastorage.org/storage1/58cd681e/3446cf3a/30b379e0/c14b0d13.jpg"><br><br>  and the final picture has a low resolution: <br><img src="https://habrastorage.org/storage1/f3e82007/1f48db17/f925242e/864bb5e7.jpg"><br><br>  To combat this, I recalculate FOV so that the useful picture takes slightly less than the largest possible area: <br><img src="https://habrastorage.org/storage1/ceb8cbf8/431bf72e/a0cd4336/2a2a5c40.jpg"><br><br>  The result is a completely decent picture with the correct (I thought so then, but about the details later) image. <br><br><h4>  What happened? </h4><br>  The results of all this can be seen in the video: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/LacyvLV30_I%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhgTnvwY-UoXcClmDuuEA4DZRszv8Q" frameborder="0" allowfullscreen=""></iframe><br><br>  And now a few comments, how it works from a subjective point of view and why: <br><br>  1) The biggest problem is the small viewing angles of the webcam on the laptop.  Therefore, it is quite easy to go out of sight and the image stops.  It is not adapted for this.  But the good news is that everything is fast enough and there are no problems in terms of speed.  There are in nature more wide-angle, but you need to get this. <br><br>  2) It is not so easy to deceive the human brain.  With two eyes, I see for sure that the monitor is flat and without a stereo, this 3D does not work.  Even if you close one eye, the brain, anyway, knows that it is a flat monitor and there can be no teapot there.  But there is one nuance, if you close one eye and constantly imagine a three-dimensional teapot, then after some time you can fool the brain. <br><br>  3) Not everything is so simple with projections, as it seems at first glance.  For me personally, it was rather strange that the object should decrease when approaching if it is located behind the screen.  By the way, there is a bug here, my teapot, after all, is voluminous and was located just in the plane of the screen, so I cannot do what I did.  It is necessary to recalculate the position of each top of the kettle separately. <br><br>  4) In the next semester, I will try to do the same, but with 3D stereo support and a separate picture for each eye.  Let's see if the brain will then believe. <br><br><h4>  <b>UPDATE</b> : </h4><br>  At the request of workers, I spread the <a href="">source code</a> and <a href="">binaries</a> .  I included all dlki in the binaries, so I got 24 meters in the archive. <br><br>  Still, it seems that I broke something there during the experiments, the teapot is now very much elongated (it seems that the sign has changed somewhere when projecting, so the teapot is stretched in the wrong direction), but who are interested, will figure it out. <br><br>  And one more feature, there will be two windows with a kettle, you need to move one to the other (just drag it) so that it‚Äôs right for me to debug it more conveniently). <br><br>  The lost model of the kettle can be found <a href="">here</a> and should lie here: C: \ _ WORK \ __ 3d_Models \ </div><p>Source: <a href="https://habr.com/ru/post/126290/">https://habr.com/ru/post/126290/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126278/index.html">Oatmeal - Be the Apple Owner</a></li>
<li><a href="../126279/index.html">Nintendo received a patent for a "single-player gaming universe"</a></li>
<li><a href="../126282/index.html">New Apple Motherboard Renders</a></li>
<li><a href="../126286/index.html">Do you have a financial crisis?</a></li>
<li><a href="../126289/index.html">Why I do not use the App Store, or a little about the interface</a></li>
<li><a href="../126291/index.html">Youtube configurator update</a></li>
<li><a href="../126293/index.html">4 myths about programmers</a></li>
<li><a href="../126294/index.html">Atomontage voxel engine</a></li>
<li><a href="../126296/index.html">Highlighting words in a link</a></li>
<li><a href="../126297/index.html">Yandex and traffic police have increased the speed of travel at the intersection by 2.5 times</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>