<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>asm.js</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translated help on asm.js. Only the first chapter, Introduction, is published here. An entire article in chm format can be taken on a file sharing ser...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>asm.js</h1><div class="post__text post__text-html js-mediator-article">  Translated help on asm.js.  Only the first chapter, Introduction, is published here.  An entire article in chm format can be taken on a <a href="http://rghost.ru/6S2WgDgVH">file sharing service</a> .  For those who are interested in a different format, take <a href="http://rghost.ru/8ZQcf4J82">here the</a> archived folder with the ‚Äúparsed‚Äù chm'th and redo it as you need.  In this case, it is advisable not to mention me.  The project file asm.hhp is attached to this folder.  If you have installed the program Microsoft¬Æ HTML Help Workshop, you can use it to re-assemble the chm-file after the changes are made. <br><br>  Actually, the asm.js help is just a draft of a help, prepared for asm.js of the first version.  Therefore, some links (few) do not work.  In addition, there is a commented text in the body of the certificate itself - the authors of the certificate were preparing to supplement it.  Some of them have been translated by me, but left commented out.  And yet, the date of the last change to the original is August 18, 2014, maybe it‚Äôs already just abandoned. <br><a name="habracut"></a><br><h2>  1. Introduction </h2><br>  This description defines <b>asm.js</b> , a nested JavaScript complex that can be used as a low-level, rational target language for compilers. <br><br>  The asm.js language provides an abstraction similar to a C / C ++ virtual machine: a large binary heap with efficient loading and storage, arithmetic of integers and floating point numbers, definitions of first-order functions and function pointers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Programming model </h3><br>  The asm.js programming model is built around the arithmetic of integers and floating-point numbers, as well as a virtual heap, represented as a <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Typed_arrays">typed array</a> . <br><br>  Although JavaScript does not directly provide constructs for working with integers, they can be simulated by two ways: <br><br><ul><li>  loading and storing integers can be performed using the API of typed arrays;  and </li><li>  integer arithmetic is equivalent to connecting from JavaScript arithmetic operators for floating point numbers and coercions to integer numbers performed by bitwise operators. </li></ul><br>  As an example of the above, if there is an <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Typed_arrays/Int32Array">Heap32 Int32Array</a> representation called HEAP32, then you can load a 32-bit integer with a byte offset p: <br><br><pre>  HEAP32 [p &gt;&gt; 2] | 0
</pre><br>  The shift converts the byte shift to the shift of the 32-bit element, and the bitwise cast ensures that reversing from the outside will result in the value undefined back to an integer. <br><br>  As an example of integer arithmetic, addition can be performed by obtaining two integer values, adding them with the built-in addition operator and bringing the result back to an integer value via the bitwise OR operator: <br><br><pre>  (x + y) | 0
</pre><br>  This programming model is directly borrowed from the methods first introduced in the <a href="http://emscripten.org/">Emscripten</a> and <a href="http://mandreel.com/">Mandreel compilers</a> . <br><br><h3>  Validation </h3><br>  The dialect of the programming language asm.js is defined by a static type system, which can be checked during JavaScript parsing. <br><br>  The verification (validation) of the asm.js code is designed as ‚Äúpay as you receive‚Äù in that it is never done with code that does not require it. <br><br>  <i>The module</i> (module) asm.js requests validation using a special <a href="http://ecma-international.org/ecma-262/5.1/">introductory directive</a> (prologue directive), similar to <a href="http://ecma-international.org/ecma-262/5.1/">strict mode</a> in ECMAScript Edition 5 version: <br><br><pre>  function MyAsmModule () {
     "use asm";
     // module body
 }
</pre><br>  Such a direct indication allows the JavaScript engines to avoid performing meaningless and possibly costly validation in other JavaScript code, and also to issue windows with validation error messages only when appropriate. <br><br><h3>  "Early" compilation </h3><br>  Since asm.js is a nested complex that strictly adheres to the rules of the JavaScript language, this specification defines only a logic check ‚Äî semantic analysis is left to JavaScript. <br><br>  However, the asm.js code that has been validated is amenable to ‚Äúearly‚Äù (ahead-of-time ‚Äî AOT) compilation.  However, the code generated by the AOT compiler can be quite effective, showing: <br><br><ul><li>  unpacked representations of integers and floating point numbers; </li><li>  no type checks at run time; </li><li>  no garbage collection;  and </li><li>  efficient heap loading and storage (with implementation methods varying by platform). </li></ul><br>  Code that fails to check should return to execution by traditional standards, for example, interpretation and / or operational compilation. <br><br><h3>  Binding </h3><br>  Using the asm.js module requires calling its function to obtain an object containing the export of the module;  this is called <i>binding</i> . <br><br>  The asm.js module, through binding, can also be given access to standard libraries and user-defined JavaScript functions. <br>  An AOT implementation must perform certain dynamic checks to check, at compile time, assumptions about linking libraries for use in compiled code. <br><br>  This figure represents the simplest AOT implementation architecture, which would otherwise use a common interpreter. <br>  If either dynamic or static validation fails, the implementation should return to the interpreter. <br>  But if both types of validation are successful, the export of the module that executes the binary executable code generated by the AOT compilation is called. <br><br><img src="https://habrastorage.org/files/d23/a11/069/d23a11069bab486e948e90e17d64cfe3.png"><br><br><h3>  External code and data </h3><br>  Inside the asm.js module, all code is fully statically typed and limited to the very rigid asm.js dialect.  However, it is possible to interact with recognized standard JavaScript libraries and even custom dynamic JavaScript functions. <br><br>  The asm.js module can take up to three additional parameters, providing access to external JavaScript code and data: <br><br><ul><li>  object <i>standard library</i> (standard library), provides access to a limited nested set of JavaScript's standard libraries; </li><li>  foreign function interface (FFI), provides access to user-defined external JavaScript functions;  and </li><li>  heap buffer, provides a separate <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Typed_arrays/ArrayBuffer">ArrayBuffer</a> , acting as heap <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Typed_arrays/ArrayBuffer">asm.js.</a> </li></ul><br>  These objects allow asm.js to make a call to external JavaScript (and use heaps buffer together with external JavaScript).  Conversely, exporting an object returned from a module allows external JavaScript to make a call to asm.js. <br><br>  So, in general, the declaration of the asm.js module looks like: <br><br><pre>  function MyAsmModule (stdlib, foreign, heap) {
     "use asm"; &lt;br&gt;
     // module body ... &lt;br&gt;
     return {
         export1: f1,
         export2: f2,
         // ...
     };
 }
</pre><br>  The function parameters in asm.js are supplied with type labels, by explicitly affecting the input of the function: <br><br><pre>  function geometricMean (start, end) {
   start = start | 0;  // start variable of type int
   end = end | 0;  // end variable of int type
   return + exp (+ logSum (start, end) / + ((end - start) | 0));
 }
</pre><br>  These labels serve two purposes: first, to provide the function type with a signature, so that the validator can ensure that all calls to the function are correctly typed; <br>  secondly, to ensure that even if the function is exported and called by external JavaScript, its arguments are dynamically cast to the intended type. <br><br>  This ensures that the AOT implementation can use the unpacked values ‚Äã‚Äãof the views, knowing that upon completion of the dynamic cast, the function body will never require any type checks at run time. <br><br><h3>  Put it all together </h3><br>  Below is a small but complete example of the asm.js module. <br><br><pre>  function GeometricMean (stdlib, foreign, buffer) {
   "use asm";
   var exp = stdlib.Math.exp;
   var log = stdlib.Math.log;
   var values ‚Äã‚Äã= new stdlib.Float64Array (buffer);
   function logSum (start, end) {
     start = start | 0;
     end = end | 0;
     var sum = 0.0, p = 0, q = 0; &lt;br&gt;
     // asm.js forces byte addressing of the heap by switching shifting by 3
     for (p = start &lt;&lt; 3, q ‚Äã‚Äã= end &lt;&lt; 3; (p | 0) &lt;(q | 0); p = (p + 8) | 0) {
       sum = sum + + log (values ‚Äã‚Äã[p &gt;&gt; 3]);
     }
     return + sum;
   }
   function geometricMean (start, end) {
     start = start | 0;
     end = end | 0;
     return + exp (+ logSum (start, end) / + ((end - start) | 0));
   }
   return {geometricMean: geometricMean};
 }
</pre><br>  In a JavaScript engine that supports AOT compiling asm.js, invoking a module on its own global object and heap buffer will bind the exported object to use with statically compiled functions. <br><br><pre>  var heap = new ArrayBuffer (0x10000);  // 64k heap
 init (heap, START, END);  // fill a region with input values
 var fast = GeometricMean (window, null, heap);  // produce exports object linked to AOT-compiled code
 fast.geometricMean (START, END);  // computes geometric mean of input values
</pre><br>  On the other hand, calling a module on a standard library object containing something other than true, Math.exp or Math.log will not be able to produce AOT-compiled code. <br><br><pre>  var bogusGlobal = {
   Math: {
     exp: function (x) {return x;  },
     log: function (x) {return x;  }
   },
   Float64Array: Float64Array
 };

 var slow = GeometricMean (bogusGlobal, null, heap);  // produces purely-interpreted / JITted version
 console.log (slow.geometricMean (START, END));  // computes bizarro-geometric mean thanks to bogusGlobal
</pre></div><p>Source: <a href="https://habr.com/ru/post/271891/">https://habr.com/ru/post/271891/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271881/index.html">How to create a round Progress Button</a></li>
<li><a href="../271883/index.html">Palantir 101. What is allowed to ordinary mortals to know about the second most abrupt private company in Silicon Valley</a></li>
<li><a href="../271885/index.html">ARM today 25</a></li>
<li><a href="../271887/index.html">‚ÄúIT is a rather poor industry‚Äù - an interview with Dmitry Nesteruk from JetBrains</a></li>
<li><a href="../271889/index.html">sin 1 ¬∞ on calculator</a></li>
<li><a href="../271895/index.html">Why email will never die</a></li>
<li><a href="../271897/index.html">Creating unique themes for ExtJS 6 applications</a></li>
<li><a href="../271899/index.html">Writing a tactical game about numbers for Android</a></li>
<li><a href="../271901/index.html">Is it possible to develop on the iPad?</a></li>
<li><a href="../271903/index.html">AltegroSIM: we are upgrading the mobile communication service delivery</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>