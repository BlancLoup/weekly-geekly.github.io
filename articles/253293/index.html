<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make friends Google Drive and Google Calendar? We taste Gas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I offer the readers of "Habrakhabr" a story about how I managed to increase my purchasing power in a crisis time using Google Apps Script (GAS). Under...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make friends Google Drive and Google Calendar? We taste Gas</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/be5/0fc/2b8/be50fc2b89204158ac1b28eb57c64fb1.png" alt="GAS Shopping Cart">  I offer the readers of "Habrakhabr" a story about how I managed to increase my purchasing power in a crisis time using Google Apps Script (GAS).  Under the cat you will find a non-standard example of use and learn about the possibilities of working with the Google Drive and Google Calendar services. <br><br>  It all started with the fact that the price of imported goods in Russia has steadily increased.  Working as an IT specialist in a large retail network, I had an idea about how you can take advantage of having access to the product base without violating the established rules of the company and, all the more, of the law.  Of greatest interest in terms of saving personal money are the so-called ‚Äúpromotions‚Äù (discounted rates).  It was necessary to organize the daily unloading of "promotions" for the goods of interest and to realize the possibility of receiving timely notifications about the availability of discounts on the Android-smartphone. <br><a name="habracut"></a><br>  Obviously, there are many options for implementing the necessary functionality.  The options for creating a console application in any language (for example, Java) that connects to the database and then send SMS via the HTTP API of any of the existing free distribution services were considered.  However, I wanted to maximize the use of existing tools, including Google‚Äôs corporate service (Mail, Disk, Calendar, etc.). <br><br>  To achieve the desired result it was necessary to solve the following tasks: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Upload data about promotions to a file; </li><li>  Process a file, add an event to the Google Calendar and set up an SMS alert; </li><li>  Schedule tasks for daily automatic execution. </li></ol><br><h4>  Chapter 1. SQLless </h4><br><blockquote>  There is a goal, there is a distance.  The rest is details. </blockquote><br>  The first point is reduced to writing a non-complex SQL query, which unloads the actual on the day of the promotion for the list of products indicated in the request.  In order to simplify this stage as much as possible and not to write a single line of code, it was decided to use native utilities for working with databases from the manufacturer. The support for uploading to CSV is present out of the box, which fully meets the requirements for the task.  It was enough to compile a valid SQL query and create a configuration file for it from the database unloading utility.  As a result, we have a configuration file, when launched, we get a ready-made CSV file at the output with promotions that are current for the day. <br><img src="https://habrastorage.org/files/63b/60a/f2c/63b60af2cd9b40ff8f52b75cc90354cf.JPG"><br><br><h4>  Chapter 2. Fifty shades of GAS </h4><br>  The main task at this stage was to add information from a CSV file to the Google Calendar.  <b>Google Apps Script (GAS)</b> provides access to the API of many Google services (Drive, Mail, Calendar, Docs, etc.) using a language based on JavaScript.  Thus, for example, you can automate the daily sending of any logs or other files from your Google Drive to Google Mail.  This is just one of many possible uses. <br><br>  I don‚Äôt like to search for complex paths, so when uploading a CSV file, we‚Äôll save it directly in the Google Drive folder that is synchronized on the computer.  Thanks to this elegant solution, the file almost immediately after saving is available to us from GAS.  It remains to read the file, add the event to Google Calendar and enable SMS notification for it. <br><blockquote>  I will write exactly 30 lines of code.  Count aloud ... </blockquote><br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTarifsFromCSVtoCalendar</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> csvFiles = DriveApp.getFilesByName(<span class="hljs-string"><span class="hljs-string">"TarifNotifier.csv"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(csvFiles.hasNext()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> csvFile = csvFiles.next(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastModDate = csvFile.getLastUpdated(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentDate = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); lastModDate.setHours(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); currentDate.setHours(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastModDate.getTime() == currentDate.getTime()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> csvData = csvFile.getBlob().getDataAsString(<span class="hljs-string"><span class="hljs-string">"windows-1251"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> csv2DArray = Utilities.parseCsv(csvData, <span class="hljs-string"><span class="hljs-string">','</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> calendars = CalendarApp.getCalendarsByName(<span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(calendars.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> calendar = CalendarApp.createCalendar(<span class="hljs-string"><span class="hljs-string">""</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> calendar = calendars[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = calendar.getEventsForDay(currentDate); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;events.length; i++) events[i].deleteEvent(); startTime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); endTime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); startTime.setHours(<span class="hljs-number"><span class="hljs-number">09</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); endTime.setHours(<span class="hljs-number"><span class="hljs-number">22</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;csv2DArray.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> event = calendar.createEvent(csv2DArray[i][<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">' - '</span></span> + csv2DArray[i][<span class="hljs-number"><span class="hljs-number">1</span></span>], startTime, endTime); event.setDescription(csv2DArray[i]); event.addSmsReminder(<span class="hljs-number"><span class="hljs-number">30</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Logger.log(<span class="hljs-string"><span class="hljs-string">"No updated data!"</span></span>); } }</code> </pre> <br>  So, let's look at what the code is and how it works: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> csvFiles = DriveApp.getFilesByName(<span class="hljs-string"><span class="hljs-string">"TarifNotifier.csv"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(csvFiles.hasNext()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> csvFile = csvFiles.next(); ... }</code> </pre><br>  <i>Access the</i> file with the name <i>TarifNotifier.csv</i> through the Google Drive API.  Since files with the same name can be stored in different directories, the variable <i>csvFiles</i> will be passed to an array of all files with the name <i>TarifNotifier.csv</i> .  But we know that we have only one file with that name, so we simply appeal to the very first element from the array, if present. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastModDate = csvFile.getLastUpdated(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> currentDate = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); lastModDate.setHours(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); currentDate.setHours(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastModDate.getTime() == currentDate.getTime()) { ... }</code> </pre><br>  Check the date of the last update of the CSV file and compare it with the current date.  The <i>setHours (0,0,0,0)</i> method is used to reset the time in variables, which will allow us to consider only the date when comparing.  Promotions are changed only once a day, so if the CSV file has not been updated ‚Äútoday‚Äù, this means that there are no new promotions of interest to us in the store. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> csvData = csvFile.getBlob().getDataAsString(<span class="hljs-string"><span class="hljs-string">"windows-1251"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> csv2DArray = Utilities.parseCsv(csvData, <span class="hljs-string"><span class="hljs-string">','</span></span>);</code> </pre><br>  We read data from a CSV file and parse it into a two-dimensional array.  We will need this in order to display each item as a separate event in the calendar. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> calendars = CalendarApp.getCalendarsByName(<span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(calendars.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> calendar = CalendarApp.createCalendar(<span class="hljs-string"><span class="hljs-string">""</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> calendar = calendars[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events = calendar.getEventsForDay(currentDate); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;events.length; i++) events[i].deleteEvent();</code> </pre><br>  Check the availability of the calendar with the name "Discounts" and if it does not exist, then create a new one.  Again, since there may be several calendars with the same name, a reference to the array will be passed to the <i>calendars</i> variable.  We have already determined that the calendar with the name "Discounts" we have one?  So, he is alone.  In case the script has already been launched earlier that day, clear the calendar of all events for the current day in order to avoid duplication. <br><br><pre> <code class="javascript hljs">startTime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); startTime.setHours(<span class="hljs-number"><span class="hljs-number">09</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); endTime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(); endTime.setHours(<span class="hljs-number"><span class="hljs-number">22</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;csv2DArray.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> event = calendar.createEvent(csv2DArray[i][<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">' - '</span></span> + csv2DArray[i][<span class="hljs-number"><span class="hljs-number">1</span></span>], startTime, endTime); event.setDescription(csv2DArray[i]); event.addSmsReminder(<span class="hljs-number"><span class="hljs-number">30</span></span>); }</code> </pre><br>  Actually for what it all began.  For each row of the CSV file (for each product) we create a new event in the calendar from 09:30 to 22:00 (store time) and set an SMS notification for it, which should work exactly 30 minutes before the event begins. <br><br><h4>  Chapter 3. Schedueler's list </h4><br><blockquote>  This list is very good.  This list is life itself.  And at the edges of it - a solid abyss. </blockquote><br>  To get the desired result, it remains the smallest - to schedule tasks for daily execution: <br><ol><li>  We are planning a daily launch of the CSV file upload to Google Drive at 07:30 through the Windows Task Scheduler; </li><li>  Use the Project Triggers scheduler in Google Apps Script to set up the daily launch of our <i>addTarifsFromCSVtoCalendar ()</i> function from 08:00 to 09:00 (Google does not allow you to specify the exact start time). </li></ol><br><br><br>  As a result, the information on fresh promotional rates is updated daily in the calendar of the Android phone by 9 am.  At the same time, an SMS notification is sent to the phone associated with the Google account. <br><br><br>  Crisis and sanctions are not so terrible now! <br><br>  If you are interested in this topic, in the following articles I can share other examples of using Google Apps Script: <br><br><ul><li>  How to work with Google Mail with GAS? </li><li>  Transfer employee work schedule from Excel to Google Calendar. </li></ul><br><h4>  Links </h4><br><ul><li>  Google Calendar API Documentation: <a href="https://developers.google.com/apps-script/reference/calendar/">developers.google.com/apps-script/reference/calendar</a> </li><li>  Google Drive API documentation: <a href="https://developers.google.com/apps-script/reference/drive/">developers.google.com/apps-script/reference/drive</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/253293/">https://habr.com/ru/post/253293/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../253281/index.html">Unpleasant surprises from Tinypass or not worth chasing a subscription discount</a></li>
<li><a href="../253283/index.html">Microsoft Technology Expedition Starts March 18 in St. Petersburg</a></li>
<li><a href="../253285/index.html">Finding relationships using the Oil Ruble example</a></li>
<li><a href="../253287/index.html">Update Opera Mini servers: Flexbox, ES5, HTML5 parser</a></li>
<li><a href="../253291/index.html">Some pitfalls of IP Cloud technology in Mikrotik routers</a></li>
<li><a href="../253297/index.html">Do not learn frameworks, learn architecture</a></li>
<li><a href="../253299/index.html">IBM SmartCloud Storage Access Video Demonstration</a></li>
<li><a href="../253303/index.html">More information about the protocol Mail.Ru Agent</a></li>
<li><a href="../253305/index.html">Online translation of the opening of the Microsoft Developer Tour technology expedition</a></li>
<li><a href="../253307/index.html">First look at VMware 6</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>