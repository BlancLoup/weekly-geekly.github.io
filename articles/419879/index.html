<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PWA is easy. Hello joomla</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to study Progressive Web Applications. After the theoretical first part and a simple practical example of Hello Habr, the second part will...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PWA is easy. Hello joomla</h1><div class="post__text post__text-html js-mediator-article">  We continue to study Progressive Web Applications.  After the theoretical <a href="https://habr.com/post/418923/">first part</a> and a simple practical example of Hello Habr, the <a href="https://habr.com/post/419585/">second part</a> will be transferred to the PWA website on CMS Joomla. <br><br>  The type of server framework is not important.  The goal of this article is to show the translation of a regular site in PWA as a concept applicable to arbitrary sites on any frameworks. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e3e/d50/eff/e3ed50eff39c7b5659a6e465bc2315fb.png"><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First, download and install Joomla.  When installing, we indicate that it is necessary to fill the site with demo data - select the option "Blog".  We get this site here - <a href="https://tetta.nut.cc/habr/hello-joomla/original/">https://tetta.nut.cc/habr/hello-joomla/original/</a> .  Then we copy all the site files into the <a href="https://tetta.nut.cc/habr/hello-joomla/">https://tetta.nut.cc/habr/hello-joomla/</a> directory - now we have two working instances of the Joomla site on one database.  We will leave the first one as it is, and the second will be transferred to the PWA version. <br><br>  The source code of the sample of this article can be viewed on <a href="https://github.com/altrusl/habr-pwa/tree/master/hello-joomla">GitHub-e</a> <br><br><div class="spoiler">  <b class="spoiler_title">A little about the structure of Joomla</b> <div class="spoiler_text"><blockquote>  In Joomla, there is the concept of a template - this is a collection of web resources responsible for the presentation layer.  Templates are located in the / templates directory, our out-of-the-box standard is called protostar. <br><br>  In general, after receiving a browser request, Joomla starts the engine, does its work, and then transfers the execution of the request to /templates/protostar/index.php, which already generates HTML to the client.  This file is a simple PHP file, in which it is additionally possible to use two directives: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"component"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position-id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"..."</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  The first one inserts in its stead the main material corresponding to the requested URL (component), the second - the modules prescribed by the administrator for the specified position.  Any page in Joomla consists of a component and modules. <br><br>  If you look <a href="https://tetta.nut.cc/habr/hello-joomla/original/index.php/5-your-modules%3Ftp%3D1">at the site template</a> , you can see the block of basic material in the central part of the page, and there are no modules around.  The top menu is position-1, the right column with two modules ‚ÄúOlder Posts‚Äù and ‚ÄúMost Read Posts‚Äù - position-7 and so on. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba6/52d/6db/ba652d6dbdb81582843279fe01832c53.png" alt="image"><br><br>  Joomla has a peculiarity - if the incoming GET request contains the <i>tmpl</i> parameter with some <i>somePage</i> value, Joomla passes the execution of the request not to the index.php template file, but somePage.php, if it exists.  We use it below. </blockquote><br></div></div><br><h2>  Application shell </h2><br>  Now we need to isolate from the site the app shell - the shell of the application being created.  When developing a PWA site from scratch, there may be different strategies for this, but on a ready-made site it is convenient to use the division into its static and dynamic parts. <br><br>  Static is something that rarely changes and can be part of the app shell.  For example, the top menu on <a href="https://tetta.nut.cc/habr/hello-joomla/original/">our site</a> can be considered static - it is changed only by the administrator, and he can explicitly order an app shell update on client browsers after editing it. <br><br>  At the same time, the content itself, as well as the modules in position-7 and the Breadcrumbs module in position-2, showing where the user is currently on the site, are dynamic.  On the client browser they should be loaded. <br><br><h3>  1. Changes on the server </h3><br>  Replace all dynamic blocks with placeholders.  In the template index.php file, we change the directives: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"component"</span></span></span><span class="hljs-tag"> /&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main-content"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position-id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"..."</span></span></span><span class="hljs-tag"> /&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module-id"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  We also include our javascript file hello-joomla.js in index.php in addition to the template scripts. <br><br>  Create a file main-content.php with the following contents: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"component"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  File module-2.php: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position-2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"none"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  And the module-7.php file: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdoc:include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"modules"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position-7"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"well"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><br>  The meaning of what is done is that when you request <a href="https://tetta.nut.cc/habr/hello-joomla/index.php/5-your-modules%3Ftmpl%3Dmodule-7">https://tetta.nut.cc/habr/hello-joomla/index.php/5-your-modules?tmpl=module-7,</a> we will only receive code for modules that are in postion- 7  The same with content. <br><br>  These are <b>all</b> changes in the "server" part of the site.  In other frameworks, these operations (selection of the app shell) will probably be a little more complicated, but here we are lucky. <br><br><h3>  2. Client part </h3><br>  In hello-joomla.js, we need to implement dynamic loading of content and modules.  In addition, you need to change the behavior of all the tags &lt;A&gt; in order to click on the link to initiate dynamic loading of the page data.  The modules of the right column will be loaded once when the site is opened in the browser, and the breadcrumbs and content - each time you click on an internal link. <br>  This is also easy: <br><br><div class="spoiler">  <b class="spoiler_title">hello-joomla.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   url  HTML  el function loadData(el, url){ url.indexOf("?") &gt;= 0 ? url += "&amp;" : url += "?"; url = url + 'mode=nocache&amp;tmpl=' + el; fetch(url) .then( function(response) { if (response.status == 200) { response.text().then(function(data) { document.getElementById(el).innerHTML = data; }); } }) .catch(); return false; } //    &lt;a&gt;    function handleLinks() { var links = document.querySelectorAll('a'); for (var i = 0; i &lt; links.length; ++i) { links[i].removeEventListener("click", handleLink); links[i].addEventListener("click", handleLink); } } //   function handleLink(e) { e.preventDefault(); loadData("main-content", this.href); loadData("module-2", this.href); handleLinks(); return false; } //      function DOMLoaded() { loadData("main-content", location.pathname); loadData("module-2", location.pathname); loadData("module-7", location.pathname); handleLinks(); } document.addEventListener('DOMContentLoaded', DOMLoaded, true);</span></span></code> </pre> <br></div></div><br>  At the moment we have converted our site into a full-fledged SPA - single page application - application.  Grinding is left - the ‚ÄúBack to Top‚Äù link, the top menu styles, the search form, the animated preloader, etc. <br>  A copy of the site in SPA mode is available at <a href="https://tetta.nut.cc/habr/hello-joomla/spa/">https://tetta.nut.cc/habr/hello-joomla/spa/</a> . <br><br><h3>  3. SPA -&gt; PWA </h3><br>  We connect in index.php the manifesto and sw.js from the <a href="https://habr.com/post/419585/">last example</a> .  To disable the Service Worker from caching dynamic queries, add <i>‚Äúmode = nocache‚Äù</i> to the url in the loadData function in hello-joomla.js. <br><br>  Everything.  Can be attached to the home screen. <br><br><h2>  findings </h2><br>  As you can see, in order to turn a web site into a PWA application, no frameworks or toolkits are needed.  Everything is done by hand, and the code remains clean and clear. <br><br>  In the next article, in the form of useful tips, we will functionally bring the site to the level of production in production.  There are standard SPA-shnye improvements - the title of the page in the browser, Google Analitics, checking that nothing valuable has gone to the search engines.  Let's make a convenient Service Worker caching control for the operative update of app shell elements.  In addition, editors and commentators of the site want to be able to insert images from the Internet, including the http protocol, into the site materials. <br><br><blockquote>  One of the remarkable properties of the PWA concept is that it brings back to life the MVC paradigm long lost in the numerous server and browser frameworks.  ‚ÄúView‚Äù now lives on the client, and the browser is looking to the server for <i>data</i> , not for their <i>presentation</i> . <br><br>  And, unlike conventional SPA, PWA builds this ‚ÄúView‚Äù not with heavy javascript frameworks, but with the good old, fast and understandable html + css. </blockquote></div><p>Source: <a href="https://habr.com/ru/post/419879/">https://habr.com/ru/post/419879/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../419867/index.html">Six more myths about the blockchain, where will it still be used</a></li>
<li><a href="../419869/index.html">The revolution in AI will not produce droids, and toasters</a></li>
<li><a href="../419871/index.html">How Google is trying to develop a censored search engine for China</a></li>
<li><a href="../419873/index.html">Testing only through public methods is bad.</a></li>
<li><a href="../419877/index.html">How we invent smart home again</a></li>
<li><a href="../419883/index.html">Get the difference between binary files using vcdiff</a></li>
<li><a href="../419885/index.html">Translation of Andrew Un's book ‚ÄúPassion for Machine Learning‚Äù Chapter 15 - 19</a></li>
<li><a href="../419893/index.html">How to search for users on Github using VanillaJS</a></li>
<li><a href="../419895/index.html">The new engine will allow microsatellites to perform "adult" tasks.</a></li>
<li><a href="../419897/index.html">"Machine Sound": synthesizers based on neural networks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>