<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple NAS-based Web Server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Due to numerous requests from users, I decided to write instructions on how to organize a practically full-fledged LAMP server based on D-Link DNS-325...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple NAS-based Web Server</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f14/42b/287/f1442b2871fafad6ee1ac22b37c906f3.jpg" alt="image"><br><br>  Due to numerous requests from users, I decided to write instructions on how to organize a practically full-fledged LAMP server based on D-Link DNS-325/345. <br>  Many administration gurus will grab at heart, drink valerian and recommend me to smoke something less downhole;) <br>  And I totally agree with that.  Well, not at the expense of smoking, but about the fact that doing so is very, very not recommended.  The hardware parameters of such a device have not been calculated for the operation of a full-fledged LAMP, it will not pull a good load.  Well, as they say, the owner is a master.  Once the user wants, you need to at least send it in the right direction.  Otherwise, everyone begins to reinvent his own bicycle, build something based on fun_plug &amp; optware, sometimes simply following fragmented instructions, not always understanding what he is doing. <a name="habracut"></a><br>  As a website in this example, one of the most famous CMS of Joomla! Today will be used. Of course, instead of it, you can use other systems (Drupal, WordPress, SugarCRM, etc.) as well as self-written sites using PHP &amp; MySQL. <br>  Why Joomla !?  Well, probably just the first Add-On CMS that caught my eye.  Well, I also found a <a href="http://dlink.vtverdohleb.org.ua/Add-On/Joomla%25202.5%2520-%2520Beginners%2520Guide_rus.pdf">fairly good description of Joomla!</a> <br>  Once there is a good description, talk about setting up and working with Joomla!  I will not, especially myself in it, unfortunately, is not yet strong, I use it simply as a web block. <br>  And so, first we need to install a terminal daemon on the NAS.  I strongly recommend sshd, not telnetd.  Take <a href="http://dlink.ua/dns">dlink.ua/dns</a> here, after installation it is necessary to change the password. <br>  Add-on is placed like this: <br>  1. We download Add-On itself to a local disk.  If it is packed with an archiver, unpack it. <br>  2. Go to the web interface DNS-325/345 section "Application Management / Add-Ons" and install Add-On. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/63c/b35/161/63cb351614bdad6f8a38410db6abc934.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      3. Run it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb0/92f/a2a/bb092fa2ab2b8a441e9a6bc1796ce1cb.jpg" alt="image"><br><br>  4. By the same principle, download, install and run Joomla! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4e2/db3/206/4e2db320674905e150ee2ffeb45b9ae6.jpg" alt="image"><br><br>  5. For MySQL in this Add-On, they did not provide for their own login / password, apparently it is assumed that <a href="http://dlink.vtverdohleb.org.ua/Add-On/">phpMyAdmin Add-On</a> will be installed, which has admin / admin login / password.  Install phpMyAdmin. <br>  6. Check the installed Add-Ons. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/207/ee4/0f7/207ee40f72836cffb504d3cc27e9b940.jpg" alt="image"><br><br>  sshd does not light up here, because it is a pure CLI (command line) client, and has no web interface.  "You do not see the woodchuck, but he is!";) <br>  If we open "Applications / Joomla" we see the following <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d19/a4c/c96/d19a4cc9608060721bae18f354c8271f.jpg" alt="image"><br><br>  Click "Launch" <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a5/d92/0b7/6a5d920b72d106cc6b8f151d8133981b.jpg" alt="image"><br><br>  Click "Next" and follow the instructions. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/199/fe7/c9b/199fe7c9b3fe2a9043f2896d35f36159.jpg" alt="image"><br><br>  MySQL username and password are those used in phpMyAdmin.  The default is admin / admin.  Continue the installation. <br>  In this case, in the "Control Panel" Joomla!  we get <br><br><img src="https://habrastorage.org/getpro/habr/post_images/219/477/d20/219477d204cfaecc6dc3331862c283fa.jpg" alt="image"><br><br>  if we select "Site" we see <br><br><img src="https://habrastorage.org/getpro/habr/post_images/be0/047/00d/be004700d55ab75a052d2ce1e67755fe.jpg" alt="image"><br><br>  Further configuration, Russification and configuration of Joomla!, As I wrote, according to the instructions. <br>  At this stage, the site with Joomla! <pre><code class="bash hljs">http://ip_address_dns-3x5/Joomla/</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/75d/dac/d0f/75ddacd0fa070831048ff328c3ada1b1.jpg" alt="image"><br><br>  All Add-Ons web interfaces and its own are located in the / var / www / directory <br>  That is, if you use, for example, vTigerCRV - this will be the directory / var / www / vTigerCRM, and the link is accordingly <pre> <code class="bash hljs">http://ip_address_dns-3x5/vTigerCRM/</code> </pre> <br>  Now we will decide on TCP port.  The basic interface of the NAS remains on the standard http port - 80. This of course can be changed, which fun_plug does, but I would not recommend it.  Therefore, I will not consider changing the TCP port for the basic NAS interface.  Who wants to change - please, but yourself.  And so I propose port 81. Moreover, I often encounter such a problem - some operators ‚Äúhistorically‚Äù have filters on some ports, including the 80th.  Once it protected the subscriber from unnecessary traffic, at a time when the Internet was considered pomegbyte.  Now it‚Äôs mostly unlimited, but the operators still have filtering rules on most of the basic routers.  Although the support service may not know anything about these filters. <br>  Well, back to setting up the website.  This moment, for ‚Äúnon Linux fans,‚Äù will be the hardest.  If you installed sshd, you need an ssh client.  There are a lot of them, but I personally use PuTTY for Windows.  Someone prefers a setup, but I always use <a href="">the ‚ÄúFor unattended access‚Äù version</a> <br>  And so, we installed the ssh service on your NAS.  Start Putty and do the following. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/903/9a1/a49/9039a1a496904948bd6a918967859759.jpg" alt="image"><br><br>  Click "Open", we get a proposal for the first call to accept the certificate <br><br><img src="https://habrastorage.org/getpro/habr/post_images/83b/20b/156/83b20b1566a65d599cc8b3e4335ebe94.jpg" alt="image"><br><br>  We say "Yes."  On the ‚Äúlogin as‚Äù clause, enter ‚Äúroot‚Äù and 2 times Enter.  We see <br><br><img src="https://habrastorage.org/getpro/habr/post_images/51b/376/d52/51b376d520e065c9cb3685435fc08ec9.jpg" alt="image"><br><br>  Do not forget to change your password! <br>  We create a copy of the config of the basic web server. <br><pre> <code class="bash hljs">cp /etc/lighttpd/lighttpd.conf /mnt/HD/HD_a2/Nas_Prog/Joomla/</code> </pre> <br>  Edit the configuration file. <br><pre> <code class="bash hljs">vi /mnt/HD/HD_a2/Nas_Prog/Joomla/lighttpd.conf</code> </pre> <br>  To enter the editing mode, press "i", to return to the viewing mode, press "Esc".  Change the following lines: <br><pre> <code class="bash hljs">server.document-root = <span class="hljs-string"><span class="hljs-string">"/var/www/"</span></span>  server.document-root = <span class="hljs-string"><span class="hljs-string">"/var/www/Joomla/"</span></span></code> </pre><br><pre> <code class="bash hljs">server.port = 80  server.port = 81</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$SERVER</span></span>[<span class="hljs-string"><span class="hljs-string">"socket"</span></span>] == <span class="hljs-string"><span class="hljs-string">":80"</span></span> {  <span class="hljs-variable"><span class="hljs-variable">$SERVER</span></span>[<span class="hljs-string"><span class="hljs-string">"socket"</span></span>] == <span class="hljs-string"><span class="hljs-string">":81"</span></span> {</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$SERVER</span></span>[<span class="hljs-string"><span class="hljs-string">"socket"</span></span>] == <span class="hljs-string"><span class="hljs-string">"[::]:80"</span></span> {  <span class="hljs-variable"><span class="hljs-variable">$SERVER</span></span>[<span class="hljs-string"><span class="hljs-string">"socket"</span></span>] == <span class="hljs-string"><span class="hljs-string">"[::]:81"</span></span> {</code> </pre><br><pre> <code class="bash hljs">index-file.names = ( <span class="hljs-string"><span class="hljs-string">"web/login.html"</span></span>,<span class="hljs-string"><span class="hljs-string">"index.php"</span></span> )  index-file.names = ( <span class="hljs-string"><span class="hljs-string">"index.html"</span></span>,<span class="hljs-string"><span class="hljs-string">"index.php"</span></span> )</code> </pre><br>  Remove the HTTPS section.  Delete line - 2 times press "d". <br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$SERVER</span></span>[<span class="hljs-string"><span class="hljs-string">"socket"</span></span>] == <span class="hljs-string"><span class="hljs-string">"172.17.17.150:443"</span></span> { ssl.engine = <span class="hljs-string"><span class="hljs-string">"enable"</span></span> ssl.pemfile = <span class="hljs-string"><span class="hljs-string">"/etc/server_v4_bond0.pem"</span></span></code> </pre><br>  Close the file with saving.  Press ": x" + Enter. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc8/316/fdf/cc8316fdf67df2f9700dfa4339cbed3f.jpg" alt="image"><br><br>  If for some reason you need to exit without saving, press ": q!" + Enter. <br>  We check the performance of the web server.  To do this, run <br>  for DNS-345 <br><pre> <code class="bash hljs">/usr/sbin/lighttpd-angel -D -m /usr/lighty_lib -f /mnt/HD/HD_a2/Nas_Prog/Joomla/lighttpd.conf &amp;</code> </pre> <br>  for other models <br><pre> <code class="bash hljs">/usr/sbin/lighttpd-angel -D -m /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib -f /mnt/HD/HD_a2/Nas_Prog/Joomla/lighttpd.conf &amp;</code> </pre> <br>  If the line with ‚Äúserver started‚Äù is displayed, you have done everything correctly.  If ‚Äúexited normally with exitcode: 0‚Äù is an error somewhere, for example, they did something wrong when editing, or port 81 may be busy with another program.  There may be many options, so send me a screenshot or error text, I will try to help. <br>  Well, we assume that the server has started.  Check in the browser <br><pre> <code class="bash hljs">http://ip_address_DNS:81/</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/649/5fd/00d/6495fd00dd69703cfa35b0b71cb67372.jpg" alt="image"><br><br>  Now add a web server to autorun.  To do this, return to PuTTY. <br><pre> <code class="bash hljs">vi /mnt/HD/HD_a2/Nas_Prog/Joomla/init.sh</code> </pre> <br>  Add a start line to the end of the file and exit with saving. <br><pre> <code class="bash hljs">/usr/sbin/lighttpd-angel -D -m /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib -f /mnt/HD/HD_a2/Nas_Prog/Joomla/lighttpd.conf &amp;</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/de1/184/b74/de1184b74d1fd87f063f589240196d33.jpg" alt="image"><br><br>  With the configuration and startup of the web server, everyone, ‚Äúnot Linux lovers‚Äù, can breathe a sigh of relief, and the guru can take another bite of valerian;) <br>  Now we organize access to your site from the Internet.  To do this, you need to do a port forwarding on the router.  Briefly tell on the example of D-Link DIR-651.  For everyone else, read the documentation for your router. <br>  Go to the web interface of the router.  For most, these are default addresses. <pre> <code class="bash hljs">http://192.168.0.1/  http://192.168.1.1/</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/e88/2df/fc9/e882dffc9085527e374211323977b2be.jpg" alt="image"><br><br>  In this case, the username is ‚Äúadmin‚Äù, the password is ‚Äúadmin‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fb1/2f4/fa2/fb12f4fa2080a024e1166e505a728de5.jpg" alt="image"><br><br>  Go to the "Advanced Settings" section "Firewall / Virtual Servers." <br><br><img src="https://habrastorage.org/getpro/habr/post_images/514/bf0/eaf/514bf0eaf6165645d0ccdf743c65bc98.jpg" alt="image"><br><br>  Click "Add". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d59/3c6/0fa/d593c60fac9287cc8411c45adb05f951.jpg" alt="image"><br><br>  "Template" select "Virtual Server HTTP".  "Name" enter any, for example Joomla.  The ‚Äúexternal port‚Äù is standard for HTTP - 80. We change the internal port to the one you assigned to your web server.  In our case, 81. ‚ÄúInternal IP‚Äù is the IP address of your DNS-325/345.  In this example, 192.168.0.100.  Click "Change" and "Save." <br>  If the 80th port is closed by the provider, the ‚ÄúExternal port‚Äù is also changed, for example, to 81. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07f/6ec/6df/07f6ec6dfb73e0c6852a3a629033f740.jpg" alt="image"><br><br>  Now any Internet user, having entered your external static IP address or domain name associated with this IP address in the browser, will see your website. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a1/07a/b7f/7a107ab7f4700d534d1d2974af5aaae3.jpg" alt="image"><br><br>  In conclusion, I want to say a few words. <br>  I repeat that NAS is still not a web server and it is better to do the same on specialized machines.  But on the other hand, if the site does not provide for active visits or is informational intracorporate, in principle it can be so.  Although you should not forget that in your chosen CMS system there may be a hole in security.  And there are a lot of ‚Äúwell-wishers‚Äù on the Internet. <br>  Nevertheless, if you decide to use the NAS as a web server, I hope this guide will help you.  If there are any questions in the process, there is a Feedback form on <a href="http://dlink.ua/dns">dlink.ua/dns</a> .  Write, as they say help than I can.  On the same page there are other interesting Add-Ons.  New Add-Ons are quickly uploaded <a href="https://www.facebook.com/pages/DNS/353374768023411">to the Facebook page</a> .  Use on health! </div><p>Source: <a href="https://habr.com/ru/post/185152/">https://habr.com/ru/post/185152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../185140/index.html">Building a Qt 5.1 Android application on a Mac seriously?</a></li>
<li><a href="../185142/index.html">The digest of interesting news and materials from the world of PHP over the past two weeks, number 20 (06/18/2013 - 06/30/2013)</a></li>
<li><a href="../185144/index.html">Ability to see abstractions</a></li>
<li><a href="../185148/index.html">Changed the time for taking Microsoft exams</a></li>
<li><a href="../185150/index.html">Simple-Science - Simple Experiments (Digest # 24)</a></li>
<li><a href="../185154/index.html">Real time music generation</a></li>
<li><a href="../185160/index.html">Building scalable applications in TypeScript. Part 2 - Events or why you should reinvent your own bike</a></li>
<li><a href="../185162/index.html">Try Windows Server 2012 R2, SQL Server 2014 and Visual Studio 2013 without installation!</a></li>
<li><a href="../185164/index.html">Backward compatibility for losers</a></li>
<li><a href="../185172/index.html">Windows on RAM disk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>