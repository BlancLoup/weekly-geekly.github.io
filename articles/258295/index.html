<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Do-it-yourself analysis of links in a project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In order to begin to understand a large project, you need to understand what logical modules are in the project and how they are related. In the case ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Do-it-yourself analysis of links in a project</h1><div class="post__text post__text-html js-mediator-article">  In order to begin to understand a large project, you need to understand what logical modules are in the project and how they are related.  In the case of using Visual Studio in expensive editions of the product, functions for constructing various dependency graphs are available.  Unfortunately, first of all, the studios with the menu ‚ÄúArchitecture‚Äù are really expensive.  Secondly, in old projects that are still being collected and have project files only for Visual Studio 2008, the studio itself does not offer much. <br><br>  Of course, it is worth noting that for such a purpose there are expensive tools (for example, Understand).  But for starters, I had enough of what I sketched a small script on PowerShell.  This script generates a dot-file for GraphViz based on the sln file.  The result is a scheme as in the figure below, from which you can already begin to understand the project. <br><br><img src="https://habrastorage.org/files/134/828/221/13482822181743558d0f48fa3598e534.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Further I will tell how this script works. <br><a name="habracut"></a><br>  The first thing I needed to do was analyze the sln files and the project files that are written there.  Immediately lucky with the sln files, since  in different studio versions (starting with Visual Studio 2008) the list of projects looks the same, like a set of lines of the following form: <br><br><pre><code class="hljs cmake"><span class="hljs-keyword"><span class="hljs-keyword">Project</span></span>(<span class="hljs-string"><span class="hljs-string">"{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}"</span></span>) = <span class="hljs-string"><span class="hljs-string">"BaseClasses Apr05"</span></span>, <span class="hljs-string"><span class="hljs-string">"..\..\3rd_party\BaseClasses_Apr05\baseclasses90.vcproj"</span></span>, <span class="hljs-string"><span class="hljs-string">"{2A939EC4-235F-4879-9D38-C865FFD54D82}"</span></span> EndProject</code> </pre> <br>  You can pull out the list of all such lines in one line on PowerShell: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">String</span></span> -LiteralPath $slnFile -Pattern <span class="hljs-string"><span class="hljs-string">"Project\(.*vcproj"</span></span></code> </pre> <br>  It is clear that $ slnFile is the path to the file, and ‚ÄúProject \ (. * Vcproj‚Äù is a regular expression for selecting strings. In the sln file, all paths are relative. The next task is to pull out relative paths from the resulting lines and build complete paths on their basis to files. This can be done in one more line: <br><br><pre> <code class="hljs perl">Join-Path -Path $slnPath -ChildPath ($s -<span class="hljs-keyword"><span class="hljs-keyword">split</span></span> <span class="hljs-string"><span class="hljs-string">','</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].Trim().Replace(<span class="hljs-string"><span class="hljs-string">'"'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>)</code> </pre> <br>  Here it is assumed that $ s contains one of the previously received strings.  It is clear that division into substrings, which are separated by a comma, with the command ($ s -split ',') occurs.  The second substring (obtained using [1]) just contains the relative path.  Remove extra spaces with Trim and remove quotes with Replace.  Then attach the path to the relative path to the sln file with the <a href="https://technet.microsoft.com/en-us/library/hh849799.aspx">Join-Path</a> command.  Wrapping it in a loop, we got a set of paths to projects.  Now it's time to look at the project files to find the dependencies between them. <br><br>  Microsoft at the time of transition to Vistual Studio 2010 changed the format of project files.  But the good thing is that the solution files in both VS2008 and VS2010 have XML format.  This allows you to use an XPath query language to easily get the field you want.  In PowerShell, this is done with the <a href="https://technet.microsoft.com/en-us/library/hh849968.aspx">Select-Xml</a> command.  Using it, it is easy to pull out dependencies from a project file.  Also, I want to see different types of projects in the final column displayed in different colors.  For this you need to find out what types are.  This can be done by setting the following command to a directory with a bunch of projects: <br><br><pre> <code class="hljs pgsql">PS D:\test&gt; <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ChildItem -<span class="hljs-type"><span class="hljs-type">Path</span></span> . -<span class="hljs-keyword"><span class="hljs-keyword">Filter</span></span> *.vcxproj -Recurse | <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>-<span class="hljs-type"><span class="hljs-type">Xml</span></span> -XPath "//*[local-name()=`"ConfigurationType`"]/text()" | % { <span class="hljs-keyword"><span class="hljs-keyword">Write</span></span>-Output $_.Node.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> }</code> </pre> <br>  You may notice that in PowerShell, the stream with the results of command execution is conveniently redirected to the next command using the ‚Äú|‚Äù symbol.  The <a href="https://technet.microsoft.com/en-us/library/hh849800.aspx">Get-ChildItem</a> command helps to find all files of the vcxproj type, and Select-Xml selects the type of configuration from them.  For each file, display the type of project on the screen.  With a large number of files, the output is not very informative, but in PowerShell there is a <a href="https://technet.microsoft.com/en-us/library/hh849907.aspx">Group-Object</a> command that saves the situation by grouping the results.  Total we get something like this: <br><br><pre> <code class="hljs pgsql">PS D:\test&gt; <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ChildItem -<span class="hljs-type"><span class="hljs-type">Path</span></span> . -<span class="hljs-keyword"><span class="hljs-keyword">Filter</span></span> *.vcxproj -Recurse | <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>-<span class="hljs-type"><span class="hljs-type">Xml</span></span> -XPath "//*[local-name()=`"ConfigurationType`"]/text()" | % { <span class="hljs-keyword"><span class="hljs-keyword">Write</span></span>-Output $_.Node.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> } | <span class="hljs-keyword"><span class="hljs-keyword">Group</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Object</span></span> Count <span class="hljs-type"><span class="hljs-type">Name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Group</span></span> <span class="hljs-comment"><span class="hljs-comment">----- ---- ----- 92 StaticLibrary {StaticLibrary, StaticLibrary, StaticLibrary, StaticLibrary...} 287 Application {Application, Application, Application, Application...} 424 DynamicLibrary {DynamicLibrary, DynamicLibrary, DynamicLibrary, DynamicLibrary...}</span></span></code> </pre><br>  Similarly, you can do for files of types vcproj, csproj and others.  In vcproj files, configuration types are encoded with numbers, but what is behind them is not difficult to find out by opening a project in Visual Studio. <br><br>  At this stage, we have projects, their types and links between them.  You can generate a GraphViz file.  This is done very simply - we immediately write the following title: <br><br><pre> <code class="hljs pgsql">digraph ProjectName { size="60,60"; rankdir=LR; overlap=<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; splines=<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; dpi=<span class="hljs-number"><span class="hljs-number">300</span></span>; node[color=mediumorchid3, style=filled, shape=<span class="hljs-type"><span class="hljs-type">box</span></span>, fontsize=<span class="hljs-number"><span class="hljs-number">10</span></span>, fontcolor=white]; edge[arrowhead=vee, arrowtail=inv, arrowsize=<span class="hljs-number"><span class="hljs-number">.7</span></span>, fontsize=<span class="hljs-number"><span class="hljs-number">10</span></span>, fontcolor=navy]; labelloc=t; label="Solution: ProjectName.sln"; fontsize=<span class="hljs-number"><span class="hljs-number">14</span></span>;</code> </pre><br>  And then all the projects and links between them: <br><br><pre> <code class="hljs mel"><span class="hljs-string"><span class="hljs-string">"project1.vcproj"</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">color</span></span>=indigo]; <span class="hljs-string"><span class="hljs-string">"project1.vcproj"</span></span> -&gt; <span class="hljs-string"><span class="hljs-string">"project2.vcproj"</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">color</span></span>=<span class="hljs-string"><span class="hljs-string">"#C3E500"</span></span>]; <span class="hljs-string"><span class="hljs-string">"project2.vcproj"</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">color</span></span>=indigo];</code> </pre><br>  The color of the link is tied to the project to make it easier to read the graph.  Those.  each project all outgoing communication of the same color.  You can do this using the HSL (from the English. Hue, Saturation, Lightness) color representation.  We fix S and L components, and H is changed when processing the next project file.  Then HSL convert to RGB and write to the output file. <br><br>  The source code of the color picker function, as well as the rest of the script, can be found on <a href="https://github.com/jia3ep/powertools">GitHub</a> . </div><p>Source: <a href="https://habr.com/ru/post/258295/">https://habr.com/ru/post/258295/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258285/index.html">What is TLS</a></li>
<li><a href="../258287/index.html">Habrahabr appropriated to everyone according to the ‚Äúdog‚Äù</a></li>
<li><a href="../258289/index.html">Cach√© audit log analysis using Cach√© (DeepSee)</a></li>
<li><a href="../258291/index.html">Lamp-rainbow do it yourself</a></li>
<li><a href="../258293/index.html">Object Storage - The Near Future of Storage Systems</a></li>
<li><a href="../258297/index.html">Commercial site security research</a></li>
<li><a href="../258301/index.html">50+ Best Bootstrap Add-ons</a></li>
<li><a href="../258303/index.html">Running load tests made with JMeter using StormRunner Load</a></li>
<li><a href="../258305/index.html">Kerio Connect 8.5 improves collaboration, security and increases usability of mobile devices.</a></li>
<li><a href="../258309/index.html">VeeamON Forum Mos√≥w</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>