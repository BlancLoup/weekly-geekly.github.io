<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Telegram: sending messages to a mobile number to chat with a bot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Like many, I use an asterisk to organize a telephone connection. In addition to their internal number, subscribers also have a mobile number, where re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Telegram: sending messages to a mobile number to chat with a bot</h1><div class="post__text post__text-html js-mediator-article"><p>  Like many, I use an asterisk to organize a telephone connection.  In addition to their internal number, subscribers also have a mobile number, where redirections are made, and SMS are sent in case of a missed call. </p><br><p>  Traditionally, missed call notifications were sent either to email or to mobile in the form of SMS.  With the advent of Telegram, it became possible to send messages to the instant messenger.  One bad luck: we can not send a message to the mobile number. </p><br><p>  And it is more convenient for us, because  we already have mobile numbers (we have hundreds of subscribers who want to receive notifications :), and we still need to find the chat id, and each has its own. </p><br><p>  Solution: a small chat bot. </p><a name="habracut"></a><br><p>  The chat bot accepts the user and asks for his phone number.  Then the received number and the corresponding chat id are saved to the server.  Now we can send a notification to a number to our service, and a bot attached to the service will forward this notification to the corresponding user in telegrams.  It turns out and cheap (we now do not pay for SMS), and angry. </p><br><p>  <em>Two points</em> </p><br><ol><li>  until the user connects to the bot, we cannot send him messages. </li><li>  The user ID of the sender of the number and the identifier of the user with the sent number are compared; in case of discrepancy, the user will not be associated with the specified number. </li></ol><br><p>  The application is small, but extremely useful.  You can send any message (which was previously sent via SMS or email) - notifications about calls, errors, server crashes, etc. </p><br><h3 id="nemnogo-detaley">  Few details </h3><br><p>  Sending occurs by sending an http request to a locally running web server, which in combination implements the chat bot.  The server searches for a match in the mongo database and then sends the data to the Telegram.  It's simple. </p><br><p>  The web server is written in nodejs, and the <a href="https://github.com/telegraf/telegraf">telegraf</a> library is used to interact with Telegrams. </p><br><p>  How to create a bot and get a token already have <a href="https://habrahabr.ru/post/262247/">instructions</a> . </p><br><h3 id="kak-otpravit-soobschenie">  How to send a message? </h3><br><p>  POST request with json message </p><br><p>  For example: </p><br><pre><code class="hljs ruby">curl -X POST \ <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/localhost:3030/send</span></span><span class="hljs-regexp"><span class="hljs-regexp">/&lt;number&gt; \ -H 'content-type: application/json</span></span><span class="hljs-string"><span class="hljs-string">' \ -d '</span></span>{<span class="hljs-string"><span class="hljs-string">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"Ahtung!!"</span></span>}<span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre> <br><p>  How does this work for me?  After the call is completed, the asterisk calls a small script that looks at the call status and sends a message if necessary.  That's all. </p><br><p>  Github sources: <a href="https://github.com/antirek/telegram-alert">telegram-alert</a> <br>  Installation is described in the repository. <br>  For those who want a quick start there is a docker-compose.yml </p><br><p>  Use video (50 seconds) </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/P2ncEptF8HI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Suggestions?  Questions? </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/339704/">https://habr.com/ru/post/339704/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339694/index.html">New 3CX Call Flow Designer: Complicated Call Routing Without Programming</a></li>
<li><a href="../339696/index.html">Knowledge sharing and copyright management platform. Look at the state order?</a></li>
<li><a href="../339698/index.html">Hello World's thorny path</a></li>
<li><a href="../339700/index.html">Why can LLVM call a function that is never called?</a></li>
<li><a href="../339702/index.html">Comparing tick-to-trade delays with CEPappliance and Solarflare TCPDirect</a></li>
<li><a href="../339708/index.html">FrontFest.Vyorstka: let's talk about accessibility, saving traffic and future CSS</a></li>
<li><a href="../339710/index.html">Announcement: Veeam Backup & Replication 9.5 (and beyond) new features</a></li>
<li><a href="../339712/index.html">44 lesson control technicians</a></li>
<li><a href="../339714/index.html">Two pictures with the customer</a></li>
<li><a href="../339716/index.html">Java XML API: we select correctly. StAX: we work with pleasure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>