<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Checking the source code of WPF Samples from Microsoft</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In order to popularize the PVS-Studio code analyzer, which learned to test, in addition to C ++, also C # projects, we decided to check the source cod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Checking the source code of WPF Samples from Microsoft</h1><div class="post__text post__text-html js-mediator-article">  In order to popularize the PVS-Studio code analyzer, which learned to test, in addition to C ++, also C # projects, we decided to check the source code of WPF examples offered by Microsoft. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52a/2d9/c58/52a2d9c585ebf241a2b466f86222438f.png"></div><br><br>  With the release of Windows Vista, a new system for building beautiful client applications was introduced - the Windows Presentation Foundation (WPF).  This graphics subsystem is included in the .NET Framework starting with version 3.0.  It uses the XAML markup language and has replaced the outdated WinForms.  In my opinion, the main disadvantage of WinForms was that it carried out all the drawing on the central processor.  WPF acted more logically and rendered its DirectX components.  Now WPF has practically supplanted WinForms and allows you to make universal interfaces for three platforms at once (PC, XBOXOne, Winphone). <br><a name="habracut"></a><br>  For analyzing the source code of WPF examples from Microsoft ( <a href="https://github.com/Microsoft/WPF-Samples">source</a> ), the <a href="http://www.viva64.com/ru/pvs-studio-download/">PVS-Studio</a> static code analyzer version 6.05 was used. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      An interesting feature of this Solution is that, along with C # projects, it contains projects written in C ++.  I learned about this feature only from the list of errors found by PVS-Studio.  The PVS-Studio plugin for Visual Studio without any additional manipulations from the user analyzed and outputted in messages related to both C # and C ++ code. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/929/7d1/dc4/9297d1dc44d621729b7b1c813d24f63a.png" alt="Figure 1. In the PVS-Studio window, warnings are simultaneously displayed."></div><br><br>  <font color="#999999"><i>Figure 1. In the PVS-Studio window, at the same time, warnings related to both C # and C ++ code of the checked project are displayed (click on the image to enlarge).</i></font> <br><br><h2>  <b>C # Errors</b> </h2><br>  <b>1. Errors in the preparation of the conditions of the if statement</b> <br><br>  Errors when comparing something with something is a very common problem for programmers.  Let's go over them. <br><br>  In this source code there are two absolutely identical conditions: <br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Compare</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GlyphRun a, GlyphRun b</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (aPoint.Y &gt; bPoint.Y) <span class="hljs-comment"><span class="hljs-comment">//&lt;== { return -1; } else if (aPoint.Y &gt; bPoint.Y) //&lt;== { result = 1; } else if (aPoint.X &lt; bPoint.X) { result = -1; } else if (aPoint.X &gt; bPoint.X) { result = 1; } .... }</span></span></code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0382/">V3003</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 418, 422. txtserializerwriter.cs 418 <br><br>  What exactly they wanted to compare in the second case is not entirely clear, but obviously not what they wrote. <br><br>  We politely write checks to <i>null</i> in the conditions, than we protect the program from emergency situations.  It can be said that most of the <i>if</i> conditions consist precisely in checking for <i>null of</i> any fields or variables.  At the same time, sometimes checks are not only superfluous, but can also conceal a logical error: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindNumeric</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> content</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] values = content.Split(<span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> values[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"none"</span></span>; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0081/">V3022</a> Expression 'values! = Null' is always true.  Util.cs 287 <br><br>  We can assume that the author wanted to check that the <i>values</i> contain more than 0 elements, but I could not think of a situation when <i>Split</i> returns an empty array.  In any case, whatever one may say, the check for <i>null</i> here was completely superfluous. <br><br>  As I said, the project contains code from C ++ and C # diagnostics.  I got the impression that the C ++ programmer had a hand in the following code. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadNotes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(<span class="hljs-string"><span class="hljs-string">"NotesFile"</span></span>, FileMode.Open); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fs != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0081/">V3022</a> Expression 'fs! = Null' is always true.  MainWindow.cs 66 <br><br>  In fact, even in C ++ code, this option is erroneous, but in C # it looks ‚Äústrange‚Äù in general.  Why is it wrong to write in C ++ code, described in the article " <a href="http://www.viva64.com/ru/b/0402/">Checking 7-Zip source code with PVS-Studio</a> ", well, we will continue to analyze C # code. <br><br>  Far from such situations, we could not escape.  The Solution found two practically identical functions (thanks to ‚Äúcopy-paste‚Äù) with the same error: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SerializeObjectTree</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> objectTree</span></span></span><span class="hljs-function">)</span></span> { TextWriter writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamWriter(_stream); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fileContent = XamlRtfConverter.ConvertXamlToRtf( XamlWriter.Save(objectTree)); writer.Write(fileContent); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (writer != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) writer.Close(); } }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0081/">V3022</a> Expression 'writer! = Null' is always true.  htmlserializerwriter.cs 324 <br><br>  Well, there will be no zero link <i>writer</i> ... <br><br>  Throwing a mistake in exceptional situations is not a bad decision.  The main thing is not to make a mistake in the condition when you need to throw an exception, because you can create a very unpleasant impression for the user of your application when the program falls out of the blue. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> Size </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SizeParser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> o</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sizeString.Length == <span class="hljs-number"><span class="hljs-number">0</span></span> || sizeString.Length != <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ApplicationException(<span class="hljs-string"><span class="hljs-string">"Error: a size should contain two double that seperated by a space or ',' or ';'"</span></span>); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0081/">V3023</a> Consider inspecting the 'sizeString.Length == 0 ||  sizeString.Length! = 2 'expression.  The expression is misprint.  MainWindow.cs 140 <br><br>  Judging by the text of the error, in this case, checking for 0 is excessive, it was enough to check <i>sizeString.Length</i> for inequality 2. <br><br>  In long bodies, <i>if statements are</i> very difficult to detect meaningless eye checks. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteElement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (htmlWriter == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (htmlWriter != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; htmlElementName != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { .... .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0461/">V3063</a> A part of the conditional expression is always true: htmlWriter! = Null.  HtmlFromXamlConverter.cs 491 <br><br>  For the analyzer this is not a problem.  By the way, thanks to our favorite copy-paste, the error was found in two projects at once: <i>HtmlToXamlDemo</i> and <i>DocumentSerialization</i> . <br><br>  Of course, meaningless checks are found not only in long functions, but also within two or three lines. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnFlipPicTimeline</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> clock = (Clock) sender; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (clock.CurrentState == ClockState.Active) <span class="hljs-comment"><span class="hljs-comment">// Begun case { return; } if (clock.CurrentState != ClockState.Active) // Ended case { .... } }</span></span></code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0081/">V3022</a> Expression 'clock. CurrentState! = ClockState. Active' is always true.  MainWindow.cs 103 <br><br>  In principle, nothing terrible, but when after there is an <i>if statement</i> nested in one <i>if</i> and more and more ... I want to get rid of at least senseless checks for better perception of the code, which, in fact, is read much more often than it is written. <br><br>  Let's take a little rest.  And look at this unusual function that I met.  The body of the function is given in full: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateSavings</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Savings = TotalIncome - (Rent + Misc + Food); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Savings &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Savings &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { } }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0081/">V3022</a> Expression 'Savings&gt; = 0' is always true.  NetIncome.cs 98 <br><br>  It was also found many (more than 60) comparisons of real numbers ( <i>double</i> ) with a specific 0. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (leftConst != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; leftConst.Value == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// 0 + y; return y; return newRight; }</span></span></code> </pre> <br>  For example: <ul><li>  V3024 An odd precise comparison: leftConst.Value == 0. Consider using: Math.Abs ‚Äã‚Äã(A - B) &lt;Epsilon.  AddExpression.cs 34 </li><li>  V3024 An odd precise comparison: leftConst.Value == 1. Consider using a comparison with defined precision: Math.Abs ‚Äã‚Äã(A - B) &lt;Epsilon.  MultExpression.cs 42 </li><li>  V3024 An odd precise comparison: leftConst.Value == -1.  Consider using a precision with a precision: Math.Abs ‚Äã‚Äã(A - B) &lt;Epsilon.  MultExpression.cs 47 </li><li>  and so on... </li></ul><br>  Articles are not enough to bring all the lines.  This warning is on the 3rd level, since  its relevance is highly dependent on the specific program.  If mathematical calculations are performed on numbers (manipulations with a value), it is not guaranteed that we will get a specific number: -1, 0, 1. A deviation of 0.00000000001 will already lead to an incorrect comparison result.  However, if the program's logic involves writing discrete values ‚Äã‚Äãto real numbers ( <i>double</i> ), then such checks are not an error. <br><br>  <b>2. Errors in initialization and in the assignment of variables</b> <br><br>  The function is a great thing, which not only allows you to remove duplicate code, but also simplify the understanding of the section of code where this function is used.  It is especially important that the function performs exactly the task that is described in its name and the call signature.  But this is not always the case.  Take, for example, the following piece of code.  The function is given fully for a better understanding of the situation. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenDocument</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { Microsoft.Win32.OpenFileDialog dialog; <span class="hljs-comment"><span class="hljs-comment">// If there is a document currently open, close it. if (this.Document != null) CloseFile(); dialog = new Microsoft.Win32.OpenFileDialog(); dialog.CheckFileExists = true; dialog.InitialDirectory = GetContentFolder(); dialog.Filter = this.OpenFileFilter; bool result = (bool)dialog.ShowDialog(null); if (result == false) return false; fileName = dialog.FileName; //&lt;== return OpenFile(fileName); }</span></span></code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0468/">V3061</a> Parameter 'fileName' is always rewritten in method body before being used.  ThumbViewer.xaml.cs 192 <br><br>  The name of the file to be opened is ground right before its first use. <i>FileName = dialog.FileName</i> .  Yes, in this case, a dialog box opens and a user file is selected, but then why do you need a parameter that is not actually used? <br><br>  The lack of time and copy-paste sometimes produce very strange constructions: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MailSettingsDialog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... _timerClock = _timerClock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DispatcherTimer(); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0403/">V3005</a> The '_timerClock' variable is assigned to itself.  MailSettingsDialog.cs 56 <br><br>  It would seem, not the most terrible typo, but it suggests the idea whether we are ‚Äúwriting a second time‚Äù.  Well, for example, like this: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DumpAllClipboardContentsInternal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dataObject == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { clipboardInfo.Text = clipboardInfo.Text = <span class="hljs-string"><span class="hljs-string">"Can't access clipboard now! \n\nPlease click Dump All Clipboard Contents button again."</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0403/">V3005</a> The 'clipboardInfo.Text' variable is assigned to itself.  MainWindow.cs 204 <br><br>  In general, the code is replete with strange assignments: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoParse</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> commandLine</span></span></span><span class="hljs-function">)</span></span> { .... strLeft = strRight = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; strLeft = strs[<span class="hljs-number"><span class="hljs-number">0</span></span>]; strRight = strs[<span class="hljs-number"><span class="hljs-number">1</span></span>]; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'strLeft' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 55, 54. CommandLine.cs 55 <br><br>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'strRight' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 56, 54. CommandLine.cs 56 <br><br>  <i>strLeft and strRight</i> are just local variables of type <i>string</i> . <br><br>  Well, or here, a further code sample, more incorrect.  For some reason, so much something was counted in it, and after that it was again counted and recorded in the same variable. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InvokMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { arg = commandLine.Substring( commandLine.IndexOf(<span class="hljs-string"><span class="hljs-string">"("</span></span>, StringComparison.Ordinal) + <span class="hljs-number"><span class="hljs-number">1</span></span>, commandLine.IndexOf(<span class="hljs-string"><span class="hljs-string">")"</span></span>, StringComparison.Ordinal) - (commandLine.IndexOf(<span class="hljs-string"><span class="hljs-string">"("</span></span>, StringComparison.Ordinal) + <span class="hljs-number"><span class="hljs-number">1</span></span>)); arg = commandLine.Substring( commandLine.IndexOf(<span class="hljs-string"><span class="hljs-string">"("</span></span>, StringComparison.Ordinal) + <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'arg' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 176, 173. CommandLine.cs 176 <br><br>  And there are many, many such or similar examples of meaningless primary appropriation: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawFormattedText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DpiScale dpiInfo</span></span></span><span class="hljs-function">)</span></span> { .... Geometry geometry = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PathGeometry(); geometry = formattedText.BuildGeometry( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Windows.Point(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); .... }</code> </pre> <ul><li>  V3008 The 't' variable is assigned twice twice successively.  Perhaps this is a mistake.  Check lines: 141, 115. TrackBall.cs 141 </li><li>  V3008 The 't' variable is assigned twice twice successively.  Perhaps this is a mistake.  Check lines: 141, 115. TrackBall.cs 141 </li><li>  V3008 The 'columnSpan' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 2115, 2101. HtmlToXamlConverter.cs 2115 </li><li>  V3008 The '_timerInterval' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 52, 47. ClientForm.cs 52 </li><li>  V3008 The 'matrix1' variable is assigned twice twice successively.  Perhaps this is a mistake.  Check lines: 126, 125. MainWindow.cs 126 </li><li>  V3008 The 'matrixResult' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 140, 138. MainWindow.cs 140 </li><li>  V3008 The 'matrixResult' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 351, 349. MainWindow.cs 351 </li><li>  V3008 The 'matrixResult' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 369, 367. MainWindow.cs 369 </li><li>  V3008 The 'pointResult' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 480, 478. MainWindow.cs 480 </li><li>  V3008 The 'columnSpan' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 1930, 1917. htmltoxamlconverter.cs 1930 </li><li>  V3008 The 'geometry' variable is assigned twice twice successively.  Perhaps this is a mistake.  Check lines: 56, 55. MainWindow.xaml.cs 56 </li><li>  V3008 The 'pathGeometry' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 66, 65. MainWindow.xaml.cs 66 </li></ul><br>  It makes no sense to write each example, especially since there are still many more important and serious mistakes. <br><br>  <b>3. A pair of mixed errors</b> <br><br>  Throwing exceptions, it is important to save the call stack, so that later you can see from the logs - ‚Äúbut what did the user basically drop?‚Äù  Not everyone knows how to do it correctly. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InvokePropertyOrMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { .... } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (MissingMethodException e) { .... <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (AmbiguousMatchException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resultObject; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0456/">V3052</a> The original exception object 'e' was swallowed.  Stack of original exception could be lost.  ReflectionUtils.cs 797 <br><br>  <a href="http://www.viva64.com/ru/d/0456/">V3052</a> The original exception object 'e' was swallowed.  Stack of original exception could be lost.  ReflectionUtils.cs 806 <br><br>  According to the standard, if you pass exception higher in the function call stack by the method <i>throw e;</i>  , we will lose the call stack that was before the exception was caught in the <i>catch block</i> .  To save the entire call stack and continue it, you just need to write one word <i>throw</i> in the <i>catch block</i> and that's it. <br><br>  Sometimes checks are unnecessary, and sometimes they are simply not enough, as for example in the following code: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParseCssFontFamily</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fontFamilyList == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; fontFamily.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fontFamily[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'"'</span></span> || fontFamily[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'\''</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// Unquote the font family name fontFamily = fontFamily.Substring(1, fontFamily.Length - 2); .... }</span></span></code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0460/">V3057</a> The 'Substring' function could receive the '-1' value while non-negative value is expected.  Inspect the second argument.  HtmlCSSParser.cs 645 <br><br>  There is no check that <i>fontFamily.Length is</i> greater than 1, and as a result of this subtraction from the <i>fontFamily.Length</i> number 2, we can get a value less than 0. And this function throws out an <i>ArgumentOutOfRangeException</i> in such cases. <br><br>  It would be safer to write a check: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fontFamilyList == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; fontFamily.Length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  <b>4. WPF Error</b> <br><br>  DependencyProperty is one of the great features of WPF.  Creating properties out of the box can notify the developer of their change is incredibly convenient.  But the main thing is not to confuse the signature for their description; it is especially important to keep this in mind, showing examples, because it is them who are oriented on. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> Radius { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>) GetValue(RadiusProperty); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetValue(RadiusProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> DependencyProperty RadiusProperty = DependencyProperty.Register( <span class="hljs-string"><span class="hljs-string">"RadiusBase"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> (FireworkEffect), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FrameworkPropertyMetadata(<span class="hljs-number"><span class="hljs-number">15.0</span></span>));</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0441/">V3045</a> WPF: 'RadiusBase', and the property of 'Radius', do not correspond with each other.  FireworkEffect.cs 196 <br><br>  In this particular case, the name that is registered for the dependency property does not match the name of the wrapper property to access with the DependencyProperty from the code.  This option leads to big problems when working from XAML markup.  WPF allows XAML to access the simple <i>Radius</i> property and read the value from there, but changes to this property will not be picked up from the XAML. <br><br>  In fact, in <a href="http://www.viva64.com/ru/pvs-studio-download/">PVS-Studio</a> there are a number of diagnostics for detecting errors in the signature of the creation of the DependencyProperty [ <a href="http://www.viva64.com/ru/d/0440/">3044</a> , <a href="http://www.viva64.com/ru/d/0441/">3045</a> , <a href="http://www.viva64.com/ru/d/0442/">3046</a> , <a href="http://www.viva64.com/ru/d/0443/">3047</a> , <a href="http://www.viva64.com/ru/d/0444/">3048</a> , <a href="http://www.viva64.com/ru/d/0445/">3049</a> ].  Most errors of this kind lead to the crash of the program as soon as the use of the class with these dependency properties begins.  Therefore, these diagnostics are intended precisely to save you from searching and analyzing long signature signatures, especially after copying.  For this, of course, you need regular code checking, and not just analysis of the final version of the program. <br><br>  Consider another interesting trigger.  In this case, the new V3095 diagnostics worked.  This diagnostic shows the places where we first refer to the variable, and then check it for equality <i>null</i> . <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> XmlElement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddOrphanListItems</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { Debug.Assert(htmlLiElement.LocalName.ToLower() == <span class="hljs-string"><span class="hljs-string">"li"</span></span>); .... XmlNode htmlChildNode = htmlLiElement; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> htmlChildNodeName = htmlChildNode == <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? <span class="hljs-literal"><span class="hljs-literal">null</span></span> : htmlChildNode.LocalName.ToLower(); .... }</code> </pre> <br>  V3095 The 'htmlLiElement' object was verified against it.  Check lines: 916, 936. HtmlToXamlConverter.cs 916 <br><br>  In this case, in the condition of the ternary operator, we check that the <i>htmlChildNode</i> variable can be <i>null</i> .  In this case, the <i>htmlChildNode</i> variable is nothing more than a reference to the <i>htmlLiElement</i> variable.  But it was the <i>htmlLiElement</i> variable <i>that</i> we accessed without checking for <i>null</i> .  As a result, we either have code that will never execute, or we generally get a <i>NullReferenceException</i> exception in the <i>htmlLiElement.LocalName.ToLower ()</i> string. <br><br>  In addition to the errors described, a lot of attention is attracted by the diagnostics number <a href="http://www.viva64.com/ru/d/0475/">V3072</a> , which is designed to detect the presence of fields with a type that implements the <i>IDisposable</i> interface, but the class itself, where the fields are declared, does not have a similar implementation. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Email</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> SmtpClient _client; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0475/">V3072</a> The 'Email' class containing IDisposable members doesn‚Äôt itself implement IDisposable.  Inspect: _client.  Email.cs 15 <br><br>  With <i>IDisposable it</i> has always been tight.  From critical errors, due to improper use, is over, often saves <i>Finalize</i> , well, at least in standard classes.  Programmers often slaughter, forget, miss, or simply do not pay attention to the fields with the type that implements this interface.  To justify such a code or to recognize in it the presence of an error is difficult for an outsider look, but there are some patterns that you should pay attention to.  In this Solution, there were not a few such positives. <ul><li>  V3072 The 'HtmlLexicalAnalyzer' class containing IDisposable  Inspect: _inputStringReader.  HtmlLexicalAnalyzer.cs 16 </li><li>  V3072 The 'MainWindow' class containing IDisposable members does not itself implement IDisposable.  Inspect: _customersTableAdapter, _nwDataSet ... MainWindow.cs 15 </li><li>  V3072 The 'MainWindow' class containing IDisposable members does not itself implement IDisposable.  Inspect: _listControl.  MainWindow.cs 14 </li><li>  V3072 The 'ThumbViewer' class containing IDisposable members does not itself implement IDisposable.  Inspect: _annStore, _annotationBuffer.  ThumbViewer.xaml.cs 31 </li><li>  V3072 The 'HtmlLexicalAnalyzer' class containing IDisposable  Inspect: _inputStringReader.  htmllexicalanalyzer.cs 24 </li><li>  V3072 The 'MainWindow' class containing IDisposable members does not itself implement IDisposable.  Inspect: _store.  MainWindow.cs 20 </li><li>  V3072 The 'MainWindow' class containing IDisposable members does not itself implement IDisposable.  Inspect: _customCursor.  MainWindow.cs 14 </li><li>  V3072 The 'MainWindow' class containing IDisposable members does not itself implement IDisposable.  Inspect: _speechSynthesizer.  MainWindow.cs 14 </li></ul><br><h2>  <b>C ++ Errors</b> </h2><br>  <b>1. Errors in the preparation of the conditions of the if statement</b> <br><br>  For me, of course, it was a revelation that I would find projects in this Solution C ++ project, but nevertheless, there are errors in mistakes and let's look at them. <br><br>  As in C #, let's start with various comparisons and immediately consider the very C ++ error I mentioned just above in the C # block. <br><pre> <code class="cpp hljs">STDMETHOD(CreateInstance)(....) { .... T *obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> T(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span> != obj) { .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0293/">V668 has been</a> allocated using the 'new' operator.  The exception will be generated in the case of memory allocation error.  classfactory.h 76 <br><br>  If the <i>new</i> operator could not allocate memory, then, according to the C ++ standard of the language, an exception is thrown std :: bad_alloc ().  Thus, it does not make sense to check for equality to zero, since  pointer <i>obj</i> will never be <i>NULL</i> .  If it is impossible to allocate memory, an exception is raised that can be processed at a higher level, and the test for <i>NULL</i> equality can simply be removed.  If exceptions in the application are undesirable, you can use the <i>new</i> operator, which does not generate exceptions ( <i>T * obj = new (std :: nothrow) T ()</i> ): in this case, you can check the return value to zero.  In Solution, there were 4 more such checks: <ul><li>  V668 66 allocated allocated allocated allocated allocated allocated allocated allocated allocated allocated allocated allocated allocated  The exception will be generated in the case of memory allocation error.  aitdecoder.cpp 182 </li><li>  V668 against '' '' pointer pointer pointer pointer pointer pointer pointer allocated allocated allocated allocated allocated allocated allocated allocated allocated.  The exception will be generated in the case of memory allocation error.  aitencoder.cpp 157 </li><li>  V668 66 allocated allocated allocated allocated allocated allocated allocated allocated allocated allocated allocated allocated allocated  The exception will be generated in the case of memory allocation error.  aitencoder.cpp 221 </li><li>  V668 has been defined as the "bytes".  The exception will be generated in the case of memory allocation error.  aitencoder.cpp 275 </li></ul><br>  The extra conditions are relevant in both programming languages: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bitmapLock &amp;&amp; bitmap) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(bitmapLock) { bitmapLock-&gt;Release(); bitmapLock = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0169/">V571</a> Recurring check.  The 'bitmapLock' condition was already verified in line 104. aitdecoder.cpp 106 <br><br>  Some C # programmers do not know that the following two operations on the <i>Nullable</i> type are equivalent: <ul><li>  _isInDesignMode! = null </li><li>  _isInDesignMode.HasValue </li></ul><br>  And they make similar checks: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_isInDesignMode != null &amp;&amp; _isInDesignMode.HasValue)</code> </pre> <br>  In C ++, it makes no sense to check a null pointer before freeing the memory allocated to the address it points to. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HRESULT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OutputColorContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pixels) <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>[] pixels; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0278/">V809</a> Verifying that a pointer value is not NULL is not required.  The 'if (pixels)' check can be be removed.  aitencoder.cpp 189 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HRESULT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OutputBitmapPalette</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (colors) <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>[] colors; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0278/">V809</a> Verifying that a pointer value is not NULL is not required.  The 'if (colors)' check can be be removed.  aitencoder.cpp 241 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HRESULT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OutputColorContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bytes) <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>[] bytes; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0278/">V809</a> Verifying that a pointer value is not NULL is not required.  The 'if (bytes)' check can be removed.  aitencoder.cpp 292 <br><br>  <b>2. Logical error</b> <br><br>  The following code represents a very interesting situation of logical comparison, although at first glance one cannot say: <br><pre> <code class="cpp hljs">STDMETHODIMP AitDecoder::QueryCapability(....) { .... <span class="hljs-comment"><span class="hljs-comment">// If this is our format, we can do everything if (strcmp(bh.Name, "AIT") == 0) { *pCapability = WICBitmapDecoderCapabilityCanDecodeAllImages || WICBitmapDecoderCapabilityCanDecodeThumbnail || WICBitmapDecoderCapabilityCanEnumerateMetadata || WICBitmapDecoderCapabilitySameEncoder; } .... }</span></span></code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0153/">V560</a> A part of the conditional expression is always true.  aitdecoder.cpp 634 <br><br>  Diagnostics considered that part of the expression is always true and it is right, because  the words <i>WICBitmapDecoderCapabilityCanDecodeXXX</i> are simply <i>enum</i> values ‚Äã‚Äãwith the name <i>WICBitmapDecoderCapabilities</i> : <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> WICBitmapDecoderCapabilities { WICBitmapDecoderCapabilitySameEncoder = <span class="hljs-number"><span class="hljs-number">0x1</span></span>, WICBitmapDecoderCapabilityCanDecodeAllImages = <span class="hljs-number"><span class="hljs-number">0x2</span></span>, WICBitmapDecoderCapabilityCanDecodeSomeImages = <span class="hljs-number"><span class="hljs-number">0x4</span></span>, WICBitmapDecoderCapabilityCanEnumerateMetadata = <span class="hljs-number"><span class="hljs-number">0x8</span></span>, WICBitmapDecoderCapabilityCanDecodeThumbnail = <span class="hljs-number"><span class="hljs-number">0x10</span></span>, WICBITMAPDECODERCAPABILITIES_FORCE_DWORD = <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span> };</code> </pre> <br>  As a result, it is likely that someone just confused the characters and instead of the bitwise OR "|"  wrote a logical OR "||".  Unlike the C # compiler, C ++ is easily swallowed. <br><br>  <b>3. Errors in initialization and assignment of variables</b> <br><br>  Of course, after refactoring, the initialized variables often remain twice in a row. <br><pre> <code class="cpp hljs">STDMETHODIMP BaseFrameEncode::WritePixels(....) { result = S_OK; .... result = factory-&gt;CreateBitmapFromMemory(....); }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0108/">V519</a> The 'result' variable is assigned twice successively.  Perhaps this is a mistake.  Check lines: 269, 279. baseencoder.cpp 279 <br><br>  When variables are initialized in a few lines of code, you can easily understand the person why he missed, but sometimes these two lines go in a row: <br><pre> <code class="cpp hljs">STDMETHODIMP AitFrameEncode::Commit() { HRESULT result = E_UNEXPECTED; result = BaseFrameEncode::Commit(); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0108/">V519</a> The 'result' variable is assigned twice successively.  Perhaps this is a mistake.  Check lines: 320, 321. aitencoder.cpp 321 <br><br><h2>  <b>Conclusion</b> </h2><br>  There is an opinion that C # code is less error prone than C ++;  in certain cases this is true.  However, an interesting fact is that the majority of errors are not in specific constructions, but in simple expressions.  For example, in terms of <i>if statements</i> .  The static code analyzer for <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> C, C ++ and C # will allow you to control the quality of your code and will by all means save you from fatal errors that may reach your user. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0407/"><img src="https://habrastorage.org/getpro/habr/post_images/35e/064/ddf/35e064ddf91f5d99b620384893909ff7.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Alferov Vitalii.  <a href="http://www.viva64.com/en/b/0407/">Source code of WPF samples by Microsoft was checked</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/304206/">https://habr.com/ru/post/304206/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304192/index.html">Progressive simplification</a></li>
<li><a href="../304196/index.html">Confrontation: new format and new reality</a></li>
<li><a href="../304200/index.html">How to increase conversion to ecommerce using exit polls</a></li>
<li><a href="../304202/index.html">Update MS16-072 breaks Group Policy. What to do with it?</a></li>
<li><a href="../304204/index.html">Yandex "Mail for Domain" as a mail gateway for your servers</a></li>
<li><a href="../304208/index.html">AndroidAudit. Your Android application as a crime scene</a></li>
<li><a href="../304210/index.html">On the relative brightness, or how tenacious is Legacy</a></li>
<li><a href="../304212/index.html">The book "Head First. Learning Ruby</a></li>
<li><a href="../304214/index.html">How the principal component method (PCA) works with a simple example</a></li>
<li><a href="../304218/index.html">Harvard CS50 course in Russian: second lecture appeared</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>