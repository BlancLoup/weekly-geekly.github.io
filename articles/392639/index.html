<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developed under the Arduino for fans of the command line: PlatformIO or how to stop using the Arduino IDE</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past year I have written quite a lot of code for Arduino and in the process I changed several development tools. The article mentions the opt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developed under the Arduino for fans of the command line: PlatformIO or how to stop using the Arduino IDE</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/609/41e/ed9/60941eed96084f9d81a6a47cc169ec67.png"><br>  Over the past year I have written quite a lot of code for Arduino and in the process I changed several development tools.  The article mentions the options that I tried and in more detail about where I stopped.  We will talk about a set of tools for the case when&gt; 10 projects for different boards and a little about the development and installation of libraries. <a name="habracut"></a><br><br clear="all"><br><h2>  Development environment </h2><br><h3>  What is the problem? </h3><br>  Probably because Arduino is not focused on professional developers, the ecosystem around the standard IDE is lacking the usual tools for me: <br><ul><li>  Only in the latest versions some kind of library management has appeared, so far without the similarity of Gemfile / requirements.txt / package.json, that is, it is impossible to specify for the project which versions are used. <br></li><li>  no integration with git or other vcs </li><li>  text editor does not compare with <em>my favorite text editor</em> </li><li>  there is no possibility to save the board selection in the project </li><li>  awkward compilation error output </li></ul><br>  The Arduino website has a <a href="http://playground.arduino.cc/Main/DevelopmentTools">list of alternative development tools</a> .  In this list there are options that for various reasons did not begin to try.  For example, Atmel Studio and Visual Studio CE did not consider.  I wanted to find a tool that supports work from the command line. <br><br><br><h3>  What I tried </h3><br><h4>  Ino </h4><br>  <a href="https://github.com/amperka/ino">Ino</a> - a project from the Russian company Amperka, a command line utility for the Arduino firmware. <br>  Quite a popular project was,&gt; 200 forks.  Last commit in April 2014, therefore does not work with fresh versions of IDE (it seems starting from 1.5). <br>  There is a live fork <a href="https://github.com/scottdarch/Arturo">Arturo</a> , used it a little, but there were problems in some exotic cases. <br><br><br><h4>  Arduino-makefile </h4><br>  <a href="https://github.com/sudar/Arduino-Makefile">Arduino-Makefile</a> - compile and load with make.  Arduino Due, Zero and other 32-bit boards are not supported.  The difference from the standard IDE is that the methods must be declared before use, so that when transferring finished projects you may need to edit the source code.  If I remember correctly, I could not make friends with the Arduino-Makefile and SparkFun Pro Micro. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br><h3>  What I use </h3><br><h4>  PlatformIO </h4><br>  <a href="https://github.com/platformio/platformio">PlatformIO</a> is an excellent project created by developers from Ukraine.  It includes a command line utility through which you can start compiling and downloading programs to several microcontroller families (Atmel AVR, Atmel SAM, ST STM32, TI MSP430 and others).  At the same time, different sets of libraries are supported (on the PlatformIO website they are called frameworks): Arduino, Energia, mbed, and also the native code for Atmel AVR, espressif, MSP430. <br>  PlatformIO is initially oriented to work from the command line, there are also plugins for integration with text editors and IDE: <a href="http://docs.platformio.org/en/latest/ide.html">Atom, CLion, Eclipse, Emacs, NetBeans, Qt Creator, Sublime Text, Vim and Visual Studio</a> <br>  PlatformIO is especially suitable if you have: <br><ul><li>  one project for several boards, i.e.  the same code should be compiled for different boards </li><li>  many projects for different fees, i.e.  each project is under one fee, but there are many projects and boards are different </li><li>  there is a need to work via ssh, for example, if PlatformIO is installed on Raspberry Pi </li><li>  keen rejection of the graphical interface </li></ul><br><img src="http://docs.platformio.org/en/latest/_images/platformio-demo-wiring.gif" alt="image"><br><br><br><h5>  Use with Arduino </h5><br>  I will not retell the documentation, <a href="http://docs.platformio.org/en/latest/installation.html">here the installation instructions</a> , you can see the usage in the <a href="http://docs.platformio.org/en/latest/quickstart.html">Quick Start</a> section. <br>  The project folder structure for PlatformIO differs from the Arduino IDE project, each project contains a file platformio.ini which indicates which boards are used.  Thus, it is not necessary to choose the right board each time. <br>  I'll tell you by example how I use PlatformIO when developing a library for Arduino.  The library has two examples, each of them is a project in the PlatformIO format.  The projectio file platformio.ini lists all the cards on which the library should work: <br><pre><code class="hljs mel">[<span class="hljs-keyword"><span class="hljs-keyword">env</span></span>:nanoatmega328] platform = atmelavr framework = arduino board = nanoatmega328 [<span class="hljs-keyword"><span class="hljs-keyword">env</span></span>:sparkfun_promicro16] platform = atmelavr framework = arduino board = sparkfun_promicro16 [<span class="hljs-keyword"><span class="hljs-keyword">env</span></span>:due] platform = atmelsam framework = arduino board = due [<span class="hljs-keyword"><span class="hljs-keyword">env</span></span>:teensy31] platform = teensy framework = arduino board = teensy31 [<span class="hljs-keyword"><span class="hljs-keyword">env</span></span>:nodemcu] platform = espressif framework = arduino board = nodemcu [<span class="hljs-keyword"><span class="hljs-keyword">env</span></span>:uno] platform = atmelavr framework = arduino board = uno</code> </pre> <br>  You can compile an example for all boards using the command: <br><pre> <code class="bash hljs">platformio run</code> </pre> <br>  You can compile only for uno like this: <br><pre> <code class="bash hljs">platformio run -e uno</code> </pre> <br>  Download uno firmware: <br><pre> <code class="bash hljs">platformio run --target upload -e uno</code> </pre> <br>  Start the serial monitor: <br><pre> <code class="bash hljs">platformio serialports monitor</code> </pre> <br>  Added aliases to .zshrc to make the commands shorter: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> compile=<span class="hljs-string"><span class="hljs-string">"platformio run"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> upload=<span class="hljs-string"><span class="hljs-string">"platformio run --target upload"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> serial=<span class="hljs-string"><span class="hljs-string">"platformio serialports monitor"</span></span></code> </pre> <br>  With them the same sequence of actions: <br><pre> <code class="bash hljs">compile <span class="hljs-comment"><span class="hljs-comment">#     compile -e uno #   uno upload -e uno #  uno serial #   </span></span></code> </pre> <br>  There is also integration with Travis CI and other CI tools, <a href="http://docs.platformio.org/en/latest/ci/index.html">more here</a> . <br>  Actually, the Arduino IDE has <a href="">a command line interface</a> , but it is far from perfect. <br><br><br><h5>  Nuances of PlatformIO </h5><br>  PlatformIO speeds up work; it is more flexible than the Arduino IDE and it‚Äôs easier to automate routine tasks.  There are several things to consider: <br><ul><li>  compilation in PlatformIO is not always equivalent to compiling in the Arduino IDE, something that was collected in PlatformIO may not compile in the Arduino IDE and vice versa </li><li>  project folder structure does not match the structure for the Arduino IDE </li><li>  Not all libraries are available for installation via <em>platformio lib</em> </li></ul><br><h2>  Serial.print ("Maybe better"); </h2><br><h3>  What is the problem? </h3><br>  Standard Serial.print () is slightly inconvenient in case you need to type <br>  the name and value of the variable, for example, to display "pin_2 = &lt;pin state 2&gt;, pin_3 = &lt;pin state 3&gt;" you have to do this: <br><pre> <code class="cpp hljs">Serial.print(<span class="hljs-string"><span class="hljs-string">"pin_2 = "</span></span>); Serial.print(digitalRead(<span class="hljs-number"><span class="hljs-number">2</span></span>)); Serial.print(<span class="hljs-string"><span class="hljs-string">", pin_3 = "</span></span>); Serial.println(digitalRead(<span class="hljs-number"><span class="hljs-number">3</span></span>));</code> </pre> <br>  Sometimes you also want to partially or completely disable the output to the series, for example, if it is used only for debugging.  Of course, you can comment on the calls to Serial.print () for this, but I would like a more elegant option. <br><br><br><h3>  What I tried </h3><br><h4>  arduinoLogging </h4><br>  This lib uses printf-like syntax for printing, and also allows you to set LOGLEVEL and thus disable the output of some or all messages.  Messages are displayed using the Error, Info, Debug, and Verbose methods. <br>  Example: <br><pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Logging.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// LOGLEVEL   LOG_LEVEL_X,  X ‚àà { NOOUTPUT, ERRORS, INFOS, DEBUG, VERBOSE } #define LOGLEVEL LOG_LEVEL_INFOS void setup() { Serial.begin(9600); Log.Init(LOGLEVEL, &amp;Serial); //    Log.Info("pin_2 = %d, pin_3 = %d"CR, digitalRead(2), digitalRead(3)); //     Log.Debug("   ,   LOGLEVEL = LOG_LEVEL_INFOS"); }</span></span></span></span></code> </pre> <br><h5>  Available modifiers </h5><br><table><thead><tr><th>  wildcard </th><th>  comment </th><th>  Example </th></tr></thead><tbody><tr><td>  % s </td><td>  replace with an string (char *) </td><td>  Log.Info ("String% s", myString); </td></tr><tr><td>  % c </td><td>  replace with an character </td><td>  Log.Info ("use% c as input", myChar) </td></tr><tr><td>  % d </td><td>  replace with an integer value </td><td>  Log.Info ("current value% d", myValue); </td></tr><tr><td>  % l </td><td>  replace with an long value </td><td>  Log.Info ("current long% l", myLong); </td></tr><tr><td>  % x </td><td>  replace and convert integer value into hex </td><td>  Log.Info ("as hex% x), myValue); </td></tr><tr><td>  % X </td><td>  like% x but combine with 0x123AB </td><td>  Log.Info ("as hex% X), myValue); </td></tr><tr><td>  % b </td><td>  replace and convert integer value into binary </td><td>  Log.Info ("as bin% b), myValue); </td></tr><tr><td>  % B </td><td>  like% x but combine with 0b10100011 </td><td>  Log.Info ("as bin% B), myValue); </td></tr><tr><td>  % t </td><td>  replace and convert boolean value into "t" or "f" </td><td>  Log.Info ("is it true?% T), myBool); </td></tr><tr><td>  % T </td><td>  like% t but convert to "true" or "false" </td><td>  Log.Info ("is it true?% T), myBool); </td></tr></tbody></table><br><h3>  What I use </h3><br><h4>  advancedSerial </h4><br>  The names of the Error, Info, Debug, and Verbose message levels in arduinoLogging are not neutral.  Error does not necessarily print an error, it is just a message that is output on any LOGLEVEL (except NOOUTPUT). <br>  Considering also some disadvantages of printf, I wrote my own version, <a href="https://github.com/klenov/advancedSerial">advancedSerial</a> . <br>  Actually advancedSerial is two things: the ability to call print () and println () in a chain and message levels. <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">2</span></span>; aSerial.print(<span class="hljs-string"><span class="hljs-string">"a = "</span></span>).print(a).print(<span class="hljs-string"><span class="hljs-string">"b = "</span></span>).println(b); <span class="hljs-comment"><span class="hljs-comment">//      aSerial.p("a = ").p(a).p("b = ").pln(b);</span></span></code> </pre> <br>  Full example <a href="">Basic.ino</a> <br>  Since the names of the methods coincide with the names of the standard methods Serial.print () and Serial.println (), then, if desired, in the source code you can simply replace Serial with aSerial. <br>  For the name of the message levels, I chose v, vv, vvv, vvvv, a fairly common way to denote the levels of detail of the output messages, usually found as flags -v, -vv and so on. <br>  With such names it is easier to edit one level to another, for example, vv -&gt; vvv is easier than Info -&gt; Debug. <br><pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"advancedSerial.h"</span></span></span><span class="hljs-meta"> void setup() { Serial.begin(9600); aSerial.setPrinter(Serial); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//       //  ,      v  vv,  vvv  vvvv    aSerial.setFilter(Level::vv); } void loop() { aSerial.l(Level::vv).pln(" "); aSerial.l(Level::vvv).pln("  "); delay(3000); }</span></span></span></span></code> </pre><br>  Full example <a href="">Advanced.ino</a> <br><br><br><h5>  Memory saving </h5><br>  If you wrap a string in the F () macro, it will not be loaded into memory (SRAM), so to save memory, use F (): <br><pre> <code class="cpp hljs"> aSerial.print(F(<span class="hljs-string"><span class="hljs-string">" 16 "</span></span>));</code> </pre> <br>  Of course, using advancedSerial adds some overhead projector compared to the standard Serial, I tried to estimate which one.  Below are the compilation results for the Arduino Uno, since it has 2KB of memory and this is the minimum among the boards that I usually use. <br><br>  <strong>The usual series, without any libraries:</strong> <br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Serial.print(<span class="hljs-string"><span class="hljs-string">"test"</span></span>); Serial.println(<span class="hljs-string"><span class="hljs-string">"test"</span></span>); }</code> </pre> <br>  storage space: 5% <br>  dynamic memory: 9% <br><br>  <strong>advancedSerial:</strong> <br><pre> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;advancedSerial.h&gt; void setup() { Serial.begin(9600); aSerial.setPrinter(Serial); aSerial.setFilter(Level::vv); } void loop() { aSerial.print("test").println("test"); }</span></span></span></span></code> </pre> <br>  storage space: 5% <br>  dynamic memory: 10% <br><br>  <strong>examples / Advanced.ino</strong> <br>  storage space: 9% <br>  dynamic memory: 26% <br><br>  <strong>examples / Advanced.ino using F () macro</strong> <br>  storage space: 9% <br>  dynamic memory: 10% <br>  It turns out that the memory usage increases slightly.  But advancedSerial is not the optimal solution in terms of resources, there are alternative implementations, for example, <a href="https://github.com/AMPWorks/ArduinoLibs/tree/master/Debug">Debug</a> . <br><br><br><h2>  Installing Libraries </h2><br><h3>  What is the problem? </h3><br>  By default, the Arduino IDE installs globally and in the sketch it does not fix exactly which libraries are used (except for #include directives of course) and which versions.  Because of this, in order to compile the sketch on another computer you need to know where to download the necessary libraries, again, the library versions must also be specified.  To avoid such problems, I install libraries only locally, inside the folder with the sketch.  Below are two ways to install libraries locally for the Arduino IDE and for PlatformIO. <br><br><br><h3>  Arduino IDE </h3><br>  I rarely use the Arduino IDE, maybe there is a better way.  The method is as follows: install the libraries in a subfolder of your project and place the symlinks (shortcuts?) For each library in the libraries folder (in the folder where the Arduino IDE libraries are installed). <br>  By the way, if I remember correctly, the Arduino IDE compiles all libraries from the libraries folder when compiling any sketch, so the compile time increases if there are many libraries in libraries.  Another reason not to use the Arduino IDE. <br><br><br><h3>  PlatformIO </h3><br>  Each PlatformIO project has a lib subfolder into which libraries can be placed.  This is when manually installing libraries.  Also, PlatformIO has a separate command to install the platformio lib libraries, unfortunately it defaults to installing libraries globally so that the libraries are installed locally in the lib subfolder you need to add to the platformio.ini of the project: <br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">platformio</span></span>] lib_dir = ./lib</code> </pre> <br>  Read more about platformio lib in the <a href="http://docs.platformio.org/en/latest/userguide/lib/index.html">documentation</a> . <cut></cut></div><p>Source: <a href="https://habr.com/ru/post/392639/">https://habr.com/ru/post/392639/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../392629/index.html">Breathe deeper: astronomers have found a white dwarf with an atmosphere of pure oxygen</a></li>
<li><a href="../392631/index.html">The Swipebuster service offers Tinder user tracking services.</a></li>
<li><a href="../392633/index.html">Cosmonautics Day 2016: events by cities</a></li>
<li><a href="../392635/index.html">Happy Birthday Laptop! 35 years to the first commercially successful laptop</a></li>
<li><a href="../392637/index.html">All IKEA LED bulbs</a></li>
<li><a href="../392645/index.html">Translation difficulties and appleID</a></li>
<li><a href="../392647/index.html">Works well, if not interfere. Lightbridge dji phantom 3</a></li>
<li><a href="../392649/index.html">Astronomers find the first exoplanet in a triple star system</a></li>
<li><a href="../392651/index.html">The computer wrote a new painting by Rembrandt 347 years after the artist‚Äôs death</a></li>
<li><a href="../392657/index.html">Semi-autonomous truck columns successfully passed the test on European roads</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>