<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PSEFABRIC - a new approach to network management and automation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is this article about? 
 This is an open source project: PSEFABRIC 

 PSEFABRIC is short for pseudo fabric and reflects the fact that, from an ad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PSEFABRIC - a new approach to network management and automation</h1><div class="post__text post__text-html js-mediator-article"><h3>  What is this article about? </h3><br>  This is an open source project: <a href="https://github.com/nihole/PSEFABRIC">PSEFABRIC</a> <br><br>  PSEFABRIC is short for pseudo fabric and reflects the fact that, from an administrative point of view, it largely looks like a network factory with the ability to manage the entire network (or part of it) as a single device, but from a control / data plane point of view it is all the same a regular network, with the same architecture as before the PSEFABRIC implementation, with the network solutions that you chose and which you think you need.  That is, in general, this is not a network built on high-speed switches (although your network may contain them), which is a distinctive feature of network factories, and that is why it is a PSEUDO fabric. <br><br>  PSEFABRIC is a logical add-on to your network architecture and does not require the purchase of new hardware or software. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It should be noted that a few years ago, the implementation of this project at a qualitative level would be a much more complicated and time-consuming task.  But the creation of such a wonderful product as <a href="http://www.tail-f.com/">ConfD</a> solved an important interface problem, reducing it (the interface problem) to a completely solvable and simple programming task YANG. <br><a name="habracut"></a><br><h3>  General introduction to the problem </h3><br>  Despite the complexity and diversity of modern computer networks, from the point of view of the application, the main thing is the ability to transmit data.  And for IP networks this, roughly speaking, comes down to two things: <br><br><ul><li>  Creating subnets and connectivity to them </li><li>  Ensuring connectivity between them (on the right ports) </li></ul><br>  But from the point of view of network configuration, everything looks completely uneasy, and all network protocols, technologies and approaches are aimed at solving these two problems. <br><br>  We have a contradiction between the simplicity of the formulation of the problem in terms of the application and the huge number of options and the complexity of its implementation.  This suggests that, in the general case, this contradiction will most likely not be effectively resolved. <br><br>  But the good news is that when you have already created a network, then usually, if your architectural solution was correct, then you have a completely clear and algorithmized sequence of actions to solve both problems. <br><br>  Of course, for each network these actions will be different. <br><br>  This suggests that creating a product that resolves this contradiction requires an approach that: <br><br><ul><li>  Provides a simple, intuitive interface to manage your entire network (or part of it) as a single entity, allowing you to operate on entities important for the application (for example, subnets and accesses between them) and not worry about the private details specific to your particular network solution; </li><li>  It would be so flexible that it would easily adapt to different architectures, vendors, types of equipment. </li></ul><br>  PSEFABRIC is this solution. <br><br><h3>  PSEFABRIC Description </h3><br>  By and large, we need to solve 4 problems. <br><br><ol><li>  Create and provide a convenient and simple interface, sufficient to solve our problem. </li><li>  This interface should have the ability to provide information about the structure of our network, on the basis of which we could make a decision on which equipment and which configuration we should create. </li><li>  We need to provide an opportunity to somehow describe our design, the logic that we need to follow when configuring. </li><li>  We must be able to according to the information described in paragraphs.  2 and 3, create the correct configurations on the right devices. </li></ol><br>  The first problem with the advent of the ConfD product is solved quite easily and flexibly.  For this is used YANG. <br><br>  The key tasks are tasks 2 through 4, and they are common.  Regardless of the implementation, these tasks, one way or another, need to be addressed.  Therefore, the PSEFABRIC is based on 3 concepts: <br><br><ul><li>  Structure </li><li>  <a href="https://github.com/nihole/PSEFABRIC/wiki/Global-Logic">Global Logic</a> </li><li>  PSEFABRIC Management Data Flow Model ( <a href="https://github.com/nihole/PSEFABRIC/wiki/Psefabric-Management-Data-Flow-Model">PMDFM</a> ) </li></ul><br><h3>  Interface </h3><br>  The logic is borrowed from the juniper SRX interface.  She seemed to me the most convenient. <br><br>  To open access between subnets, we must: <br><br><ul><li>  Create addresses </li><li>  Combine these addresses into address-sets.  In contrast to the SRX in this implementation of the interface, this is a prerequisite.  We do not open access between lists of addresses - only between lists of address-sets </li><li>  Create applications </li><li>  Create application-sets.  As with addresses, we should always use application-sets </li><li>  Create a policy </li></ul><br>  Here is an example of what these commands might look like: <br><br><ul><li>  Create addresses (do not pay attention to the structure yet) </li></ul><br><pre><code class="python hljs">addresses dc1-vlan111 ipv4-prefix <span class="hljs-number"><span class="hljs-number">10.101</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> structure dc DC1 zone none device dc1_sw1 interface e0/<span class="hljs-number"><span class="hljs-number">0</span></span> vlan <span class="hljs-number"><span class="hljs-number">111</span></span> vrf VRF1 addresses dc1-vlan112 ipv4-prefix <span class="hljs-number"><span class="hljs-number">10.101</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> structure dc DC1 zone none device dc1_sw1 interface e0/<span class="hljs-number"><span class="hljs-number">0</span></span> vlan <span class="hljs-number"><span class="hljs-number">112</span></span> vrf VRF1 addresses dc2-vlan221 ipv4-prefix <span class="hljs-number"><span class="hljs-number">10.202</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> structure dc DC2 zone none device dc2_sw1 interface e0/<span class="hljs-number"><span class="hljs-number">1</span></span> vlan <span class="hljs-number"><span class="hljs-number">221</span></span> vrf TRUST</code> </pre> <br><ul><li>  Create address-sets </li></ul><br><pre> <code class="python hljs">address-sets dc1-vlan111-set addresses dc1-vlan111 address-sets dc1-vlan112-set addresses dc1-vlan112 address-sets dc2-vlan221-set addresses dc2-vlan221</code> </pre> <br><ul><li>  Create applications </li></ul><br><pre> <code class="python hljs">applications http-app prot <span class="hljs-number"><span class="hljs-number">6</span></span> ports destination-port-range lower-port <span class="hljs-number"><span class="hljs-number">80</span></span> upper-port <span class="hljs-number"><span class="hljs-number">80</span></span> applications https-app prot <span class="hljs-number"><span class="hljs-number">6</span></span> ports destination-port-range lower-port <span class="hljs-number"><span class="hljs-number">443</span></span> upper-port <span class="hljs-number"><span class="hljs-number">443</span></span> applications icmp-app prot <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><ul><li>  Create application-sets </li></ul><br><pre> <code class="python hljs">application-sets web-app-set applications [ http-app https-app ] application-sets icmp-app-set applications [ icmp-app ]</code> </pre> <br><ul><li>  Create access </li></ul><br><pre> <code class="python hljs">policies test match source-address-sets [ dc1-vlan111-set dc1-vlan112-set ] destination-address-sets dc2-vlan221-set application-sets [ icmp-app-set web-app-set ]</code> </pre> <br>  ConfD gives us the full feeling that we are working with a separate network device.  For example, we have the ability to do "commit" and "rollback". <br><br>  PSEFABRIC is not tied to the ConfD functions and does not use the ConfD code anywhere.  The only element that we customize is a set of YANG scripts to create the interface we need.  When ‚Äúcommit‚Äù is performed, PSEFABRIC reads the latest configuration from ConfD over NETCONF and, comparing it with the previous one, creates configuration files for network equipment. <br><br><h3>  Structure </h3><br>  Here we start talking about what makes the PSEFABRIC approach so flexible.  It will discuss how to take into account the architecture of a specific network. <br><br>  It is clear that we must have a set of variables, the values ‚Äã‚Äãof which would accurately indicate what equipment we should configure.  These variables will then be used in conjunction with the global logic on the Demultiplexer Layer of the PMDFM model. <br><br>  This variable set is specified in the YANG file.  In this implementation, we have the following list: <br><br><ul><li>  data centers </li><li>  equipment </li><li>  vrf </li><li>  zone </li><li>  interface </li><li>  vlans </li></ul><br>  For a particular network for which we use PSEFABRIC, you need to set the values ‚Äã‚Äãthat these parameters can take, for example, in our test environment, this is set by the commands: <br><br><pre> <code class="python hljs">conf t structure data-centers [ none DC1 DC2 DC3 ] structure equipment [ none dc1_sw1 dc1_fw1 dc3_r1 dc3_sw1 dc2_fw1 dc2_sw1 ] structure vrf [ none DMZ TRUST VRF1 VRF2 VRF3 ] structure zone [ none ] structure interface [ none e0/<span class="hljs-number"><span class="hljs-number">0</span></span> e0/<span class="hljs-number"><span class="hljs-number">1</span></span> e0/<span class="hljs-number"><span class="hljs-number">2</span></span> e0/<span class="hljs-number"><span class="hljs-number">3</span></span> ] structure vlans none vlan-number <span class="hljs-number"><span class="hljs-number">0</span></span> structure vlans Vlan111 vlan-number <span class="hljs-number"><span class="hljs-number">111</span></span> structure vlans Vlan112 vlan-number <span class="hljs-number"><span class="hljs-number">112</span></span> structure vlans Vlan121 vlan-number <span class="hljs-number"><span class="hljs-number">121</span></span> structure vlans Vlan122 vlan-number <span class="hljs-number"><span class="hljs-number">122</span></span></code> </pre> <br>  ... <br><br>  There are no attachments or hierarchies, although if this seems useful, they can be foreseen.  Now every time you create a subnet, you must bind the structure to the subnet. <br><br>  This and the global logic you define should be enough to know exactly what to do with these grids, where to write them, where to open accesses between them, how to forward the vilans, etc.  If this is not enough, enter additional parameters in your structure. <br><br><h3>  Global logic </h3><br>  The structure we set all the necessary parameters that allow us to unambiguously determine what and how to configure.  But now we need to describe the logic of our network. <br><br>  In this implementation of PSEFABRIC, we use the python dictionary to describe global logic. <br>  With this logic we must describe all possible actions.  In our case it is <br><br><ul><li>  Create / delete addresses </li><li>  Create / delete address-sets </li><li>  Create / delete applications </li><li>  Creating / deleting application-sets </li><li>  Creating / Deleting policies </li></ul><br>  Global logic produces a sequence of commands, depending on the set of elements of the structure.  These commands are described by templates. <br><br><h3>  PSEFABRIC Management Data Flow Model </h3><br>  This is a key element of PSEFABRIC and is perhaps the main result of the study. <br>  We can distinguish 7 levels of this model. <br><br><ol><li>  Configuration Management Engine </li><li>  Configuration Analyzer </li><li>  Demultiplexer </li><li>  Configurator </li><li>  Configuration Encapsulator </li><li>  MOs Configuration Loader </li><li>  Control / Data Plans of MOs </li></ol><br>  The basic principles of PMDFM: <br><br><ul><li>  There are 2 types of control data flow: configuration data and diagnostic data.  They go in opposite directions.  The diagnostic data stream in this example PSEFABRIC is not currently implemented. </li><li>  Configuration data always moves from top to bottom (from level 1 to level 7). </li><li>  The exchange of configuration data always takes place either between adjacent layers or within the same layer. </li></ul><br>  The description of the levels and the scheme can be found on the project <a href="https://github.com/nihole/PSEFABRIC/wiki/Psefabric-Management-Data-Flow-Model">wiki</a> . <br><br><h3>  Hardware configuration </h3><br>  Levels 5,6 of the PMDFM model are automation levels.  You can use any automation that is convenient for you.  If you have already implemented any automation, then this is a good start, and you can integrate it into PSEFABRIC. <br><br>  Level 6 is the level of the scripts themselves and other tools (ansible, pappet, ...). <br><br>  Level 5 is designed to bring the configuration files (which it receives from level 4) to the required format for the tool that you use at level 6. <br><br>  In this example PSEFABRIC, I used python and perl scripts. <br><br>  The following sequence of actions is recommended: <br><br><ul><li>  After performing ‚Äúcommit‚Äù, we analyze the generated configuration files for network equipment. </li><li>  If we do not see any errors, then ‚Äúfill in‚Äù them with QA and carry out the necessary tests. </li><li>  If all is well, then ‚Äúfill‚Äù them with ‚Äúcombat‚Äù equipment. </li><li>  If the procedure is debugged, and we have repeatedly seen the correctness of the results for certain actions, then for them it is possible to exclude paragraphs.  1.2 and ‚Äúcommit‚Äù immediately ‚Äúupload‚Äù configurations to equipment </li></ul><br>  In the end, this should lead to the fact that a large or at least a substantial part of operational processes can proceed without intermediate checks. <br><br><h3>  Example </h3><br>  To test the approach was created laboratory bench.  Its description and the file with the network emulation can be found in the project wiki. <br><br>  I did not try to facilitate the task, so the scheme is as close as possible to the possible ‚Äúcombat‚Äù scenario.  We have several data centers, various vendors (Cisco, Juniper), various types of firewalls (ASA, SRX, ZBF), various types of switches (L2, L3).  I also tried to create a non-trivial topology with different zones and VRF. <br><br>  How it all works can be viewed in the <a href="https://youtu.be/ecKux8eecNU">video</a> , links to which can be found on the project <a href="https://github.com/nihole/PSEFABRIC/wiki">wiki</a> . <br><br>  Of course, this should work not only when creating entities, but also when deleting and modifying, which was not such a trivial task, but still solvable. <br><br><h3>  What do you get from the implementation of PSEFABRIC? </h3><br><ul><li>  It costs nothing but time and effort. </li><li>  If you want to implement NaaS, IaaS, PaaS, then the implementation of PSEFABRIC will help greatly in this. </li><li>  PSEFABRIC gives you a simple, unified administration interface, as in the case of network factories or sdn solutions, but it retains all the strengths of traditional networks (for example, full-fledged firewalls, load balancers). </li><li>  It gives the advantages of conventional automation (perl / python / etc. Scripting, ansible, puppet), but automation is only one of the components of the approach. </li><li>  It makes it possible to easily implement the DevOps approach to configuring the network, embed the change procedure for the network into general procedures. </li><li>  Gives significant advantages for recovery procedures, because  stores information about the network in a universal form.  This should make it easy to change equipment, vendors, and even architecture. </li><li>  And this, of course, is not a complete list. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/331892/">https://habr.com/ru/post/331892/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331882/index.html">How to confuse the analyst. Part one</a></li>
<li><a href="../331884/index.html">What should be the perfect report configurator</a></li>
<li><a href="../331886/index.html">Incident Report: GoldenEye / Petya</a></li>
<li><a href="../331888/index.html">Smart Lock on Android Things and Raspberry Pi3</a></li>
<li><a href="../331890/index.html">Digest of IT events for July</a></li>
<li><a href="../331894/index.html">How does a store in a mall recognize you via Wi-Fi (more precisely, by MAC address) - based on regular hotspots</a></li>
<li><a href="../331896/index.html">"Saved": What is the result of excessive IT cuts in the store?</a></li>
<li><a href="../331898/index.html">Conferences for developers as a way to senior? And what works?</a></li>
<li><a href="../331900/index.html">Developing a new service in Android 7 | Customization of the navigation bar</a></li>
<li><a href="../331902/index.html">Data center operation: what you need to do yourself</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>