<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Old, kind ‚ÄúThe Matrix‚Äù or visualizer for matrix version one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√©, articles with the description of the application from the famous film ‚ÄúThe Matrix‚Äù have repeatedly appeared. As you know, they all belong to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Old, kind ‚ÄúThe Matrix‚Äù or visualizer for matrix version one</h1><div class="post__text post__text-html js-mediator-article">  On Habr√©, articles with the description of the application from the famous film ‚ÄúThe Matrix‚Äù have repeatedly appeared.  As you know, they all belong to the so-called class View Matrix, allow you to visualize the state of the world in which the main characters of the film live.  But unlike previous versions of these computer programs, I want to talk about the visualizer of the matrix of the first version (which was mentioned in the movie by the hero named Morpheus in the first part of the trilogy). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/686/6e7/434/6866e7434d8d56542b72663a93dd1868.png"><br><br>  Dear friends, this article is dedicated to everyone who remembers what Dos is, 80x25 video mode and other ‚Äúwonderful little things‚Äù of an old school application developer.  And also who are interested in meeting this. <br><a name="habracut"></a><br>  The following is the background of this story.  At the beginning of the two thousandths, when I was a student, I had a wonderful device (pocket personal computer): Compaq iPAQ H3800 with the installed Microsoft Windows Pocket PC 2002 operating system. Also, there were long, dark evenings of winter holidays in the village, not having with you neither the internet nor the personal computer in this place.  But only this device and the student‚Äôs great desire to stretch brain cells are not trivial cross / scanwords, but something more interesting.  I confess that before going to the village on this device, I installed the Dos operating system emulator called PocketDOS, and also took with me at that time my ‚Äúreference book‚Äù, this remarkable work of the author Zubkov SV, titled: ‚Äú Assembler for Dos, Windows and UNIX. ‚Äù  Plus, I came in handy: the stylus and the standard notebook of the Windwos Pocket PC operating system. <br>  (At the moment, of course, it would be more appropriate to use TASM in a desktop PC emulator DosBox). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, the results of the recent survey <a href="http://habrahabr.ru/post/66378/">‚ÄúIn what language would you write the Matrix?‚Äù</a> Confirm my conjectures that it is better to visualize the matrix in the same programming language as writing it. <br><br>  So, let's begin to solve the ‚ÄúThe Matrix‚Äù crossword in Assembler language, i80186 processor, in the Dos operating system using the compiler and linker Turbo Assembler (hereinafter TASM) from Borland, on the iPAQ H3800. <br><br>  As is known, the i80186 processor is 16-bit, respectively, the registers of this processor are 16 bits (for example, the AX battery register) and are divided into two parts of 8 bits each (AH is the highest part and AL is the youngest).  We also need BIOS interrupts: 10h and 16h, which will control the video mode and keyboard, respectively.  And the Dos interrupt number 21h, which we need in this case to display the string on the display and correctly end the program. <br><br>  To display the matrix, we need only a small amount of RAM, so we will use the format of the executable file - .com and the memory model tiny.  As written by the assembler classics for Dos, we retreat in memory of 100h. <br><br><pre><code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.model</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tiny</span></span> ;     <span class="hljs-selector-class"><span class="hljs-selector-class">.186</span></span> ;  <span class="hljs-selector-tag"><span class="hljs-selector-tag">i80186</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.code</span></span> ;   ,   <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span> 100<span class="hljs-selector-tag"><span class="hljs-selector-tag">h</span></span> ;   </code> </pre> <br><br>  Next comes the memory in which we declare variables and constants for our code, and immediately jump over this part of the memory in order not to execute it: <br><br><pre> <code class="hljs go">main: jmp start ;          W equ <span class="hljs-number"><span class="hljs-number">1</span></span>Fh H equ <span class="hljs-number"><span class="hljs-number">18</span></span>h OFFS equ <span class="hljs-number"><span class="hljs-number">04</span></span>h cells db W + OFFS dup(<span class="hljs-number"><span class="hljs-number">0</span></span>) c_n db W + OFFS dup(<span class="hljs-number"><span class="hljs-number">0</span></span>) bsymb db <span class="hljs-number"><span class="hljs-number">0</span></span> _sleep dw <span class="hljs-number"><span class="hljs-number">1f</span></span>ffh ;        the_matrix db <span class="hljs-string"><span class="hljs-string">"THEMATRI X"</span></span> ;   ,   the_matrix_len equ $ - the_matrix ;   ,  $       msg_end db <span class="hljs-number"><span class="hljs-number">0</span></span>ah, <span class="hljs-number"><span class="hljs-number">0d</span></span>h, <span class="hljs-string"><span class="hljs-string">"Follow the white rabbit."</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>ah, <span class="hljs-number"><span class="hljs-number">0d</span></span>h, <span class="hljs-string"><span class="hljs-string">"$"</span></span> timer dw <span class="hljs-number"><span class="hljs-number">04f</span></span>fh ;    </code> </pre><br><br>  So, we got to the point where you need to specify the video display mode of our computer in which we will display the matrix characters.  But first, save the current mode to the stack in order to return to it at the end. <br><br><pre> <code class="hljs perl">mov ax, 0f00h ;    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>h <span class="hljs-keyword"><span class="hljs-keyword">push</span></span> ax ;    </code> </pre><br>  We set the video mode: text CGA, EGA 80x25: <br><br><pre> <code class="hljs objectivec">mov ax, <span class="hljs-number"><span class="hljs-number">0003</span></span>h <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>h</code> </pre><br><br>  Next is just a huge piece of code in which incredible magical transformations occur: <br><ol><li>  Determine the position of the character on the screen that you want to wipe </li><li>  Procedure for moving the cursor and rubbing the symbol </li><li>  Determining the position of the character display on the screen </li><li>  Generating a character from an ASCII table </li><li>  Output it with a specific color </li><li>  Delay cycle between next character output </li><li>  Determining the expired timer output value of the inscription "THEMATRIX" </li><li>  The output of the inscription "THEMATRIX" </li></ol><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs cs">main_loop: imul dx, <span class="hljs-number"><span class="hljs-number">4E35</span></span>h inc dx push dx and dh, W <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> dh, OFFS shr dx, <span class="hljs-number"><span class="hljs-number">08</span></span>h mov bx, dx lea di, cells <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> ptr [di+ bx], <span class="hljs-number"><span class="hljs-number">1</span></span> mov dh, <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> ptr [di+ bx] cmp dh, H jne next1 mov <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> ptr [di+ bx], <span class="hljs-number"><span class="hljs-number">0</span></span> next1: cmp dh, <span class="hljs-number"><span class="hljs-number">0</span></span> je draw1 dec dh ;   mov bh, <span class="hljs-number"><span class="hljs-number">00</span></span>h mov ah, <span class="hljs-number"><span class="hljs-number">02</span></span>h ;    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>h mov ah, <span class="hljs-number"><span class="hljs-number">09</span></span>h ;  /     mov al, bsymb ;   mov bx, <span class="hljs-number"><span class="hljs-number">0002</span></span>h ;   ,   mov cx, <span class="hljs-number"><span class="hljs-number">01</span></span>h ; (   ) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>h draw1: inc dh mov bh, <span class="hljs-number"><span class="hljs-number">00</span></span>h mov ah, <span class="hljs-number"><span class="hljs-number">02</span></span>h <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>h mov ah, <span class="hljs-number"><span class="hljs-number">09</span></span>h ;  /     pop dx imul dx, <span class="hljs-number"><span class="hljs-number">4E35</span></span>h inc dx push dx mov bsymb, dh ;   mov al, bsymb mov bx, <span class="hljs-number"><span class="hljs-number">000</span></span>Ah mov cx, <span class="hljs-number"><span class="hljs-number">01</span></span>h <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>h ;... pop dx imul dx, <span class="hljs-number"><span class="hljs-number">4E35</span></span>h inc dx push dx and dh, W <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> dh, OFFS shr dx, <span class="hljs-number"><span class="hljs-number">08</span></span>h mov bx, dx lea di, c_n <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> ptr [di+ bx], <span class="hljs-number"><span class="hljs-number">01</span></span>h mov dh, <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> ptr [di+ bx] cmp dh, H + <span class="hljs-number"><span class="hljs-number">01</span></span>h jne next2 mov <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> ptr [di+ bx], <span class="hljs-number"><span class="hljs-number">00</span></span>h next2: dec dh mov bh, <span class="hljs-number"><span class="hljs-number">00</span></span>h mov ah, <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>h mov ah, <span class="hljs-number"><span class="hljs-number">09</span></span>h ;  /     mov al, <span class="hljs-number"><span class="hljs-number">08</span></span>h ;   mov bh, <span class="hljs-number"><span class="hljs-number">00</span></span>h ;   mov bl, <span class="hljs-number"><span class="hljs-number">00</span></span>h ;   ()   () mov cx, <span class="hljs-number"><span class="hljs-number">0001</span></span>h ;   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>h ; sleep cycle mov cx, _sleep loop2: nop loop loop2 ;draw message cmp timer, <span class="hljs-number"><span class="hljs-number">0</span></span> je no_msg dec timer mov ax, <span class="hljs-number"><span class="hljs-number">1300</span></span>h ;   mov ch, <span class="hljs-number"><span class="hljs-number">00</span></span>h mov cl, the_matrix_len mov bh, <span class="hljs-number"><span class="hljs-number">00</span></span>h ;   mov bl, <span class="hljs-number"><span class="hljs-number">20</span></span>h ;  mov dl, <span class="hljs-number"><span class="hljs-number">0B</span></span>h ;  () mov dh, <span class="hljs-number"><span class="hljs-number">0B</span></span>h ;  () lea bp, the_matrix ;   <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>h inc dh</code> </pre><br></div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff1/464/6dc/ff14646dc8a9aa25e0ccb70ffd463b73.png"><br><br>  And finally, we need to get a signal that we no longer want to look at the matrix and can already follow the white rabbit.  To do this, we use the keyboard key test and if the character was not pressed, then continue to display the matrix characters: <br><pre> <code class="hljs perl">mov ah, <span class="hljs-number"><span class="hljs-number">01</span></span>h <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>h <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> dx jz loop1 jmp end_prog loop1: jmp main_loop</code> </pre><br>  The symbol is pressed and we close the program, but first restore the previous video mode: <br><pre> <code class="hljs perl">end_prog: <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> ax ;     mov ah, <span class="hljs-number"><span class="hljs-number">00</span></span>h mov bh, <span class="hljs-number"><span class="hljs-number">00</span></span>h <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>h</code> </pre><br>  Follow the white rabbit: <br><pre> <code class="hljs objectivec">mov ah, <span class="hljs-number"><span class="hljs-number">09</span></span>h ;     lea dx, msg_end ;  ,   <span class="hljs-string"><span class="hljs-string">'$'</span></span> (ASCII <span class="hljs-number"><span class="hljs-number">24</span></span>H) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>h</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/947/acd/59e/947acd59ec843767532a29ce27bf8e11.png"><br><br>  We finish the program correctly: <br><pre> <code class="hljs pgsql">mov ah, <span class="hljs-number"><span class="hljs-number">4</span></span>ch mov al, <span class="hljs-number"><span class="hljs-number">00</span></span>h ;   <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>h <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> main</code> </pre><br><br>  If you blind all these pieces of code together, then you can compile and link with the help of the commands: <br><pre> <code class="dos hljs">tasm /t /z matrix tlink /t matrix</code> </pre><br><br>  As a result, this is what we have: <br><ul><li>  Display vertically rolling symbols in green </li><li>  The output of the inscription "The Matrix" in the center with the disappearance after some time </li><li>  Waiting for a character from the keyboard to interrupt the output and end the program </li><li>  Compiled version of the application size of 357 bytes </li></ul><br><br><hr><br>  <b>Update:</b> at the request of Habr users, the installation of an ‚Äúhonest‚Äù matrix font was added to the code, with the following result: <br><br><ul><li><img src="https://habrastorage.org/getpro/habr/post_images/9b9/108/b0a/9b9108b0aab224bceb34dc4c79866de9.png"></li><li>  Code to set the font through the function BIOS interrupt 11h 10h <br><pre> <code class="hljs perl">lea bp, font mov bx, <span class="hljs-number"><span class="hljs-number">1000</span></span>h <span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> dx, dx mov cx, <span class="hljs-number"><span class="hljs-number">100</span></span>h mov ax, <span class="hljs-number"><span class="hljs-number">1100</span></span>h <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>h</code> </pre><br></li><li>  The program size is 4,472 bytes. </li><li>  The source code and the compiled .COM file (which can be run on the DosBox emulator) are in the public repository - <a href="https://bitbucket.org/andrey_suharev/the-matrix">bitbucket.org/andrey_suharev/the-matrix</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/198106/">https://habr.com/ru/post/198106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198096/index.html">IB far and wide on ZeroNights</a></li>
<li><a href="../198098/index.html">Write Back in MS SQL Server Analysis Service cubes</a></li>
<li><a href="../198100/index.html">ActiveRecord and transaction rollback in Yii</a></li>
<li><a href="../198102/index.html">We control the webcam with the joystick</a></li>
<li><a href="../198104/index.html">Under the hood at Dictionary and ConcurrentDictionary</a></li>
<li><a href="../198108/index.html">ICMP port knocking in OpenWRT</a></li>
<li><a href="../198110/index.html">Install pyload as standalone rocking for ReadyNAS DUO v2</a></li>
<li><a href="../198112/index.html">Translation of the book ‚ÄúAvailable 3D printing for science, education and sustainable development‚Äù (Low-cost 3D Printing for Science, Education and Sustainable Development), 2013</a></li>
<li><a href="../198114/index.html">Impractical triage - meaningless and merciless</a></li>
<li><a href="../198116/index.html">Compile the code from the code to reproduce the race of the two processes.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>