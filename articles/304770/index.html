<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Python3 serials extension support</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As an introduction I should say that I use macOS and therefore some parts: 


- Autorun (launchd) 
- Configuration File Format (plist) 
- The program ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Python3 serials extension support</h1><div class="post__text post__text-html js-mediator-article"><p>  As an introduction I should say that I use macOS and therefore some parts: </p><br><ul><li>  Autorun (launchd) </li><li>  Configuration File Format (plist) </li><li>  The program used for notifications (terminal-notifier) </li></ul><br><p>  will be specific to this OS.  However, if you are interested in the project, I think, changing a couple of ways and slightly correcting several functions to get this code to work with your notification system, yaml and, say, crown, will not be difficult. </p><br><p>  So, to the point. </p><br><p>  It is annoying to check the trackers for updates of your favorite television shows, to remember when a new episode came out, whether you watched the previous one.  In addition, as you know, everything that needs to be done more than twice is worth automating.  The project was launched in haste and is likely to be improved. </p><a name="habracut"></a><br><p>  What does it contain? </p><br><ol><li>  Parser class in parser.py </li><li>  Loader class in core.py </li><li>  Plugins inheriting bootloader classes in plugins directory </li><li>  Config plugin configuration files in the configs directory </li><li>  The icons directory for notification icons </li><li>  The main.py file jerking plugins </li><li>  Install.py file </li></ol><br><h2 id="klass-parsinga">  Parsing class </h2><br><p>  Since almost all TV series websites have their own RSS feeds, it was decided to simplify the process of writing plugins to blind the parsing function, which allows parsing rss automatically by reference and displaying a list of pairs (title, link) with the possibility of specifying an encoding. </p><br><p>  A little later came the need for simple parsing of html, and then it was thought that some sites could give links via api in json format. </p><br><p>  So the function turned into a class that stores the session (requests Session) for sites that require authorization and returns a response object with the methods <strong>html ()</strong> , <strong>rss ()</strong> , <strong>json ()</strong> and <strong>auto ()</strong> .  The latter tries to guess the contents (xml, html or json) and the encoding by the 'Content-Type' header.  The default is 'utf-8' and html. </p><br><ul><li>  The <strong>html ()</strong> method returns the wholesoup object beautifulsoup </li><li>  The <strong>rss ()</strong> method creates an array of tuples (header, link) </li><li>  The <strong>json ()</strong> method returns an object obtained by the json.loads method of the page text. </li></ul><br><h2 id="klass-zagruzchika">  Loader class </h2><br><p>  Provides plugins with <strong>parse ()</strong> and <strong>download ()</strong> methods. </p><br><ul><li>  The <strong>parse ()</strong> method provides the ability to pass a link and url parameters.  He also checks 'If-Modified-Since' if the site provides data on the latest change.  Returns a response object from the <em>parse.py</em> file. </li><li>  The <strong>download ()</strong> method accepts a dictionary with data on the title of the series, episode, link and other trifles, as well as http-headers and cookies.  And then independently produces all the magic.  Loads the file into the previously created folder "Series_name [name_of the plugin class]", where it is assumed that the class name of the plugin is the name of the voice studio / site from which it is being downloaded.  If the file is a torrent, downloads the episode from the torrent and deletes the torrent file.  The download is performed using <strong>aria2c</strong> , which must be installed on the system and located in one of the directories specified in $ PATH.  After that, the <strong>save ()</strong> method is called, which saves references to the configuration file to prevent reloading. </li><li>  The <strong>__notify ()</strong> method, which is called at the beginning and at the end of the download, if the corresponding application is found on the <em>/ usr / local / bin / terminal-notifier path</em> .  See what it looks like below. </li></ul><br><h2 id="plaginy">  Plugins </h2><br><p>  Classes that inherit the loader class, implement the <strong>start ()</strong> method in which it is necessary to parse and call the <strong>download ()</strong> method with the expected parameters. </p><br><h2 id="fayly-konfiguracii-plaginov">  Plugin configuration files </h2><br><p>  <strong>* .plist</strong> </p><br><p>  Contain: </p><br><ul><li>  Quality of interest </li><li>  List of subscriptions </li><li>  Exception list ("full season", for example) </li><li>  last_modified for sites that give information about the last change </li><li>  A list of links will be recorded here to prevent re-loading. </li></ul><br><h2 id="direktoriya-icons">  Directory icons </h2><br><p>  A folder in which you can put the icon files that will be used when notifying you about downloading / ending the loading of episodes from relevant sources.  The names of the icons should match the names of the plug-ins, but with the extension jpg / ico / png. </p><br><h2 id="mainpy">  main.py </h2><br><p>  Alternately, the <strong>start ()</strong> method of all plugins in the <em>plugins</em> directory is pulled alternately. </p><br><h2 id="installpy">  install.py </h2><br><ul><li>  Install dependencies </li><li>  Move project files to ~ / .NB-series-downloader </li><li>  Will create an autorun file </li><li>  Delete the cloned repository directory </li></ul><br><h2 id="avtozagruzka">  Autoload </h2><br><p>  <em>The <strong>install.py</strong> file will do it for you, but if you decide to do everything manually, then ...</em> </p><br><div class="spoiler">  <b class="spoiler_title">Instruction</b> <div class="spoiler_text"><p>  I was not able to tell <strong>launchd</strong> about $ HOME, therefore you will have to replace the text below <em>$ HOME</em> with the path to your users <em>/ Users / Username</em> home directory and, possibly, change the path to the scripts directory if you put them in another place. </p><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plist</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>Disabled<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">false</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>EnvironmentVariables<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>PATH<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>/usr/local/bin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>KeepAlive<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>SuccessfulExit<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">false</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>Label<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>series_downloader<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>ProgramArguments<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>python3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>$HOME/.NB-series-downloader/main.py<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>RunAtLoad<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">true</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>StartInterval<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span>900<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">integer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>WorkingDirectory<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>$HOME/.NB-series-downloader<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plist</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  The file itself with this content should be called <em>series_downloader.plist</em> and put in <em>~ / Library / LaunchAgents /</em> . <br>  You can download the tasks described in this file immediately with the command </p><br><pre> <code class="hljs sql">launchctl <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> ~/<span class="hljs-keyword"><span class="hljs-keyword">Library</span></span>/LaunchAgents/series_downloader.plist</code> </pre> <br><p>  Otherwise, the tasks are activated the next time the computer boots. <br>  These actions will cause main.py, located in the <em>$ HOME / .NB-series-downloader /</em> directory, to run every 900 seconds (15 minutes). </p></div></div><br><h1 id="itogo">  Total </h1><br><p>  <a href="https://github.com/fantomnotabene/NB-series-downloader">Link to Github</a> . </p><br><p>  Honestly, the first thing I post there, so I could screw it up.  Tell me, if something goes wrong. </p><br><p>  Notification about the start of the download: </p><br><p><img src="https://habrastorage.org/files/429/c78/1ec/429c781ec74146ef979134d7c0204a00.png" alt="Notification about the start of the download"><br>  After downloading, the message "Download started" will change to "Download finished." <br>  That's all that we will see as a result of the plug-in, and the episodes will be neatly folded into a daddy and wait in the wings. </p><br><p>  Series in my case are added to Series in the same directory (you can specify a different place in the <em>self.series_dir</em> class of the <em>downloader</em> in <strong>core.py</strong> ). </p><br><p>  And to view the downloaded series I wrote the workflow for <a href="https://www.alfredapp.com/">Alfred 3</a> : <br><img src="https://habrastorage.org/files/414/a61/41f/414a6141fb12449cbe8d1975fe348467.png" alt="TV series list"><br>  After viewing each episode, he suggests: </p><br><ul><li>  Delete it (I do not store the archive, everything viewed is sent to the trash) </li><li>  Requests an assessment of the episode from 1 to 5, as well as notes the one that I just viewed in my account on <a href="https://myshows.me/">myshows.me</a> and puts the rating of the episode using their <a href="https://api.myshows.me/">api</a> </li><li>  Displays a notification that everything went well. </li><li>  By clicking on the notification, you can open the page of the episode just watched on myshows. </li></ul><br><p>  But this is all - is another story ... </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/304770/">https://habr.com/ru/post/304770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304758/index.html">Who should be afraid of among malware</a></li>
<li><a href="../304760/index.html">Popular logistics trends for e-commerce</a></li>
<li><a href="../304764/index.html">The evolution of threats and defense strategies</a></li>
<li><a href="../304766/index.html">Projecting Google Material Design onto the desktop system ... (part two)</a></li>
<li><a href="../304768/index.html">Direct producer support: the road to hell</a></li>
<li><a href="../304772/index.html">If you work with government organizations</a></li>
<li><a href="../304776/index.html">The relevance of the PaaS model for electronic document management systems</a></li>
<li><a href="../304778/index.html">Platypus and Packages. Create and install programs on macOS</a></li>
<li><a href="../304780/index.html">Repost-modern: a selection of materials on how to generate high-quality content</a></li>
<li><a href="../304782/index.html">Work with Bluetooth LE from Java applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>