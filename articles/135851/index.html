<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>XNA: Display text in system fonts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="XNA assumes text output only in advance prepared raster fonts. And it is right. Fast, regardless of OS, predictable text sizes. 
 In my case, the exac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>XNA: Display text in system fonts</h1><div class="post__text post__text-html js-mediator-article">  XNA assumes text output only in advance prepared raster fonts.  And it is right.  Fast, regardless of OS, predictable text sizes. <br>  In my case, the exact opposite was required.  Arbitrary headset and font size selection, and low performance requirements.  The task was quite difficult.  Information on the Internet was not enough and it was extremely fragmented. <br><a name="habracut"></a><br><br>  Conditions: 2D application, the user at any time should be able to change the headset, font style and size. <br><br>  The solution is quite simple.  Create a bitmap with the desired text, create a texture from it and display it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Bitmap create using GDI. <br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> Draw text on bitmap </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-comment">Bitmap with text</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment"> private System.Drawing.Bitmap Layout() { // Get font var font = new System.Drawing.Font( fontName, fontSize, fontStyle); // Get text size var bitmap = new System.Drawing.Bitmap( 1, 1 ); var graphics = System.Drawing.Graphics.FromImage( bitmap ); var textSize = graphics.MeasureString( text, font ); // Draw text on bitmap bitmap = new System.Drawing.Bitmap( (int) textSize.Width, (int) textSize.Height ); graphics = System.Drawing.Graphics.FromImage( bitmap ); graphics.TextRenderingHint = System.Drawing.Text.TextRenderingHint.AntiAliasGridFit; graphics.DrawString( text, font, new System.Drawing.SolidBrush( this.color ), 0f, 0f ); return bitmap; }</span></span></code> </pre> <br><br>  Convert bitmap to texture <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> Create texture from bitmap </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="gdev"&gt;</span></span></span><span class="hljs-comment">Graphic device</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="bmp"&gt;</span></span></span><span class="hljs-comment">Bitmap</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-comment">Texture</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment"> private static Texture2D TextureFromBitmap(GraphicsDevice gdev, System.Drawing.Bitmap bmp) { Stream fs = new MemoryStream(); bmp.Save(fs, System.Drawing.Imaging.ImageFormat.Png); var tex = Texture2D.FromStream(gdev, fs); fs.Close(); fs.Dispose(); return tex; }</span></span></code> </pre><br><br>  And display the texture <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Draw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spriteBatch = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpriteBatch( graphicsDevice ); spriteBatch.Begin(); spriteBatch.Draw( texture, coordinate, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, texture.Width, texture.Height), Color.White, <span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">1.0f</span></span> / textureDownsizeRatio, SpriteEffects.None, <span class="hljs-number"><span class="hljs-number">0</span></span>); spriteBatch.End(); }</code> </pre><br><br>  As a result, we get a text with torn edges, the complete absence of anti-aliasing. <br><img src="https://habrastorage.org/storage2/0ba/f8b/0c7/0baf8b0c79f9fb9a8eed24db61953141.png"><br><br>  Converting bitmap to texture was not a trivial procedure. <br>  <a href="http://jakepoz.com/jake_poznanski__speeding_up_xna.html">Method found here</a> <br><br>  For correct transfer of the alpha channel, it is required to perform additional actions in the TextureFromBitmap method. <br>  First, we draw the data about the colors of the bitmap into the texture, then the information about the alpha channel. <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> Create texture from bitmap </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="gdev"&gt;</span></span></span><span class="hljs-comment">Graphic device</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="bmp"&gt;</span></span></span><span class="hljs-comment">Bitmap</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-comment">Texture</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment"> private static Texture2D TextureFromBitmap(GraphicsDevice gdev, System.Drawing.Bitmap bmp) { Stream fs = new MemoryStream(); bmp.Save(fs, System.Drawing.Imaging.ImageFormat.Png); var tex = Texture2D.FromStream(gdev, fs); fs.Close(); fs.Dispose(); // Setup a render target to hold our final texture which will have premulitplied alpha values var res = new RenderTarget2D(gdev, tex.Width, tex.Height); gdev.SetRenderTarget(res); gdev.Clear(Color.Black); // Multiply each color by the source alpha, and write in just the color values into the final texture var blendColor = new BlendState { ColorWriteChannels = ColorWriteChannels.Red | ColorWriteChannels.Green | ColorWriteChannels.Blue, AlphaDestinationBlend = Blend.Zero, ColorDestinationBlend = Blend.Zero, AlphaSourceBlend = Blend.SourceAlpha, ColorSourceBlend = Blend.SourceAlpha }; var spriteBatch = new SpriteBatch(gdev); spriteBatch.Begin(SpriteSortMode.Immediate, blendColor); spriteBatch.Draw(tex, tex.Bounds, Color.White); spriteBatch.End(); // Now copy over the alpha values from the PNG source texture to the final one, without multiplying them var blendAlpha = new BlendState { ColorWriteChannels = ColorWriteChannels.Alpha, AlphaDestinationBlend = Blend.Zero, ColorDestinationBlend = Blend.Zero, AlphaSourceBlend = Blend.One, ColorSourceBlend = Blend.One }; spriteBatch.Begin(SpriteSortMode.Immediate, blendAlpha); spriteBatch.Draw(tex, tex.Bounds, Color.White); spriteBatch.End(); // Release the GPU back to drawing to the screen gdev.SetRenderTarget(null); return res; }</span></span></code> </pre><br><br>  Now we get a satisfactory result. <br><img src="https://habrastorage.org/storage2/c53/58a/0e0/c5358a0e02cb44038faeedc6c434b210.png"><br><br>  <a href="http://yadi.sk/d/nQP0Vz6C5Z1Tq">Source</a> <br><br>  Problems: <br>  1. Slowly.  In no case should not use this method in games and especially on mobile devices. <br>  2. Not reliable.  The necessary fonts may not be in the system. <br>  3. It is advisable to track which part of the text will be displayed on the screen and cut off the invisible text.  The maximum size of the texture is 2048x2048.  If the size of the bitmap is larger, the texture will be created to the maximum size and then stretched by the video card to the desired size.  The text will be blurred. <br><br>  You can get rid of the conversion to PNG in TextureFromBitmap using unmanaged code.  An example can be found <a href="http://stackoverflow.com/questions/2869801/is-there-a-fast-alternative-to-creating-a-texture2d-from-a-bitmap-object-in-xna">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/135851/">https://habr.com/ru/post/135851/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135845/index.html">Budget option of virtual PBX with non-budget features</a></li>
<li><a href="../135846/index.html">Recipe cooking 1U server at home</a></li>
<li><a href="../135848/index.html">CRACKL @ B Contest 2010. Analysis of the first task</a></li>
<li><a href="../135849/index.html">Mindbloom Life Game - interactive tree of self-improvement</a></li>
<li><a href="../135850/index.html">Structuring JS Assets in Rails 3.1 (Styx)</a></li>
<li><a href="../135853/index.html">In China, buyers of goods in online stores will be obliged to indicate real data</a></li>
<li><a href="../135855/index.html">Errrr - Simplest Error Recorder</a></li>
<li><a href="../135856/index.html">Improved Android NDK (Native Development Kit)</a></li>
<li><a href="../135857/index.html">Python, scipy.weave and openMP - overclocking the code</a></li>
<li><a href="../135858/index.html">Opening a cloud to new customers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>