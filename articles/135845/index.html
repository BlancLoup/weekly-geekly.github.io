<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Budget option of virtual PBX with non-budget features</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this topic, I will try to tell you about an attempt to organize a budget `virtual telephone office`. 


 And so, initially there is: 


- a couple ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Budget option of virtual PBX with non-budget features</h1><div class="post__text post__text-html js-mediator-article">  In this topic, I will try to tell you about an attempt to organize a budget `virtual telephone office`. <br><br><br>  And so, initially there is: <br><ul><li>  a couple dozen small offices (tenants). </li><li>  telephony coming with them </li><li>  custom SIP phones and softphones. </li><li>  the desire of some clients instead of just a phone on the table, to have features: auto secretary / schedule / voice mail / call recording and unwillingness to have a real PBX and administrator for this business. </li><li>  our desire to do well to customers. </li><li>  a system administrator who knows scary words like linux and asterisk. </li></ul><br><br>  attempt to realize the desires of customers by investing only in the server, under the cut. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  Googling, it was decided to dig in the direction of <a href="http://asterisk.org/">asterisk</a> or <a href="http://www.freeswitch.org/">freeswitch</a> . <br><br><br>  Googling it was also discovered that a large number of 'virtual office' offers for an asterisk are either `five single-level IVR points` or an asterisk with <a href="http://www.freepbx.org/">FreePBX</a> installed in a virtual machine (for some reason they like OpenVZ very much).  It was decided to abandon FreePBX in a virtual machine so far - the interface is not for the user, and an administrator should be attached to each such asterisk, and a bunch of asterisks in virtual machines should not be ice.  There is an interesting thing for FS, which seems to be Multi-Tenant - <a href="">blue.box</a> , but so far we are looking carefully at FS (with an asterisk you have more experience), so, too, so far they have passed by. <br><br><br>  On request, the <em>virtual PBX</em> gives Google a bunch of links, almost all of which are actually providers' offers, for example, something like 'LIGHT' which is now in <a href="http://www.octoline.ru/">octopus</a> and Rostelecom is nice, but it will not work, either expensive or sell only service. <br><br><br>  A little more searching you can google <a href="http://code.google.com/p/virtual-pbx/">VitualPBX</a> , without any frills in the goo, but on the asterisk to which you can finish what is yours. <br><br><br>  Judging by the <a href="http://virtual-pbx.googlecode.com/files/XVB-6707.pdf">documentation</a> Wishlist users: <br><ul><li>  auto secretary </li><li>  schedule </li><li>  voice mail </li><li>  call recording </li></ul><br><br>  and ours: <br><ul><li>  asterisk + user isolation </li><li>  management from one place </li><li>  local calls between offices in the same building </li></ul><br><br>  several dozens of them are not always telephone there, but for some it may be useful features. <br><br><h4>  Actually we will customize it. </h4><br><br>  We look at the current version on the <a href="http://code.google.com/p/virtual-pbx/">main page</a> (latest VMWare image) and download it. <br><br>  Now it is: VM Ware image with the number <strike><a href="">8645</a></strike> <a href="">9613</a> ( <a href="http://virtual-pbx.ru/ru-downloads.html">virtual-pbx.ru/en-downloads.html</a> ). <br><br>  <a href="http://virtual-pbx.ru/updates/vpbx/">Check for updates</a> and if there is, also download the latest .tgz. <br><br>  For those who have installed the previous version, the update will look like this: <br><br><pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp wget http://virtual-pbx.ru/updates/vpbx/VirtualPBX-8645.tgz tar -xzvf VirtualPBX-8645.tgz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> VirtualPBX-8645 rpm -Fvh *.rpm</code> </pre> <br><br><h4>  We make a pre-setting for the <a href="http://virtual-pbx.googlecode.com/files/XVB-AI-6565.pdf">documentation</a> , and then go to the administrator interface: </h4><br><br><br>  _https: // server_ip / ai_ <br><br>  In the list of groups, select the default group and correct the settings we need, we had it: <br><ul><li>  Dialout asterisk context (changed to vpbx-local) </li><li>  Maximum Number of Schedule items in ext </li><li>  + limits </li><li>  We allow the use of all additional features. </li></ul><br><br><img src="https://habrastorage.org/storage2/1ac/598/bf6/1ac598bf69b439d91f5dadcad2e5e50d.png"><br><br><br><h4>  A rough plan of what I want to do as a template for each user: </h4><br><ul><li>  register the number with the provider (transfer from the IP phone to asterisk) </li><li>  get phone numbers (we connect IP phones and softphones to our virtual-pbx) </li><li>  inbound / outbound routing </li><li>  make a standard IVR template with: <br>  - schedule <br>  - black list <br>  - auto secretary <br>  - routing by department <br>  - voice mail <br></li></ul><br><br><h4>  Getting started </h4><br><br>  Add context for outgoing communication, for all users.  (will be used if the dialed number does not fall into the routing configured by the user) <br><br><pre> <code class="bash hljs">tail -5 /etc/asterisk/extensions.conf [vpbx-local] ;     exten =&gt; 0999,1,Goto(xvb-main,<span class="hljs-variable"><span class="hljs-variable">${EXTEN}</span></span>,1) ; <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> DID<span class="hljs-string"><span class="hljs-string">'s exten =&gt;_00XX,1,Goto(xvb-main,${EXTEN},1)</span></span></code> </pre><br><br>  in the users tab we add a user (since each user is a combination of a phone number + access code, we get all users on the number '0999' for ourselves - (if the system asks to enter the access code for it), and for each office we prescribe a 4-digit internal did): <br><br><img src="https://habrastorage.org/storage2/948/e06/399/948e063995de93a44a48ac21f4239cfd.png"><br><br><h5>  Click 'create' and get something like this: </h5><br><br><img src="https://habrastorage.org/storage2/c45/cda/47f/c45cda47f30449b6f98c5dbbb5a87987.png"><br><br><h5>  then go to `user` cabinet`: </h5><br><br><img src="https://habrastorage.org/storage2/a11/1ff/c30/a111ffc30a1e22593414e8ea9e882791.png"><br><br>  change the time zone / language / set the user name / his email / and so on. <br><br><h5>  Set up registration on the provider equipment: </h5><br><br><img src="https://habrastorage.org/storage2/7d8/eb4/bfe/7d8eb4bfe9e84426d7d0eb0b38dc53b8.png"><br><br>  write here: <br><ul><li>  ip address of the provider </li><li>  username on the equipment provider (we have a phone) </li><li>  password </li><li>  put a tick to receive calls </li><li>  put 0 in the column 'to the internal number' </li></ul><br><br>  Now our virtual office 43 must register with the provider‚Äôs equipment to receive incoming calls, check: <br><br><br><pre> <code class="bash hljs">[root@n-test 5701]<span class="hljs-comment"><span class="hljs-comment"># asterisk -rx 'sip show registry' Host dnsmgr Username Refresh State Reg.Time 20-1325847688-14a91d6d49dc91d5c1a9967db N xxxxxxxxxxxp 105 Registered Sat, 07 Jan 2012 00:08:13 1-321ca7dfe1f5aeb15381dcb06a74368c:5060 N 2xxxxxxx 97 Registered Sat, 07 Jan 2012 00:07:55 2 SIP registrations. [root@n-test 5701]#</span></span></code> </pre><br><br><h5>  We will register the client‚Äôs equipment in our 403 virtual office: </h5><br><br><img src="https://habrastorage.org/storage2/5b3/ae0/3a7/5b3ae03a7917321f8c0877f12bef51e4.png"><br><br>  here we have created profiles for 2 user phones with numbers 101 and 102 <br><br><br>  This is how the connection of the Fanvil phone to our virtual office looks like (as number 101): <br><br><img src="https://habrastorage.org/storage2/220/0ab/027/2200ab027d1c8e477a6494de4e5b4f35.png"><br><br>  then we also register the softphone on the number 102. <br><br><h5>  Create a default outbound routing through the phone‚Äôs SIP provider: </h5><br><br><img src="https://habrastorage.org/storage2/728/4fb/de4/7284fbde438797ae2e790f2c43f16311.png"><br><br>  that is, here all the numbers, except 4-digit ones starting with 0, are sent to the provider (if in the future the user wants to send calls, for example, through hoarse, he just needs to make a route with a higher weight) <br><br><h5>  Go to the list of internal numbers: </h5><br><br><img src="https://habrastorage.org/storage2/ead/c25/0c9/eadc250c9c7b549cdd84bf46054b61d4.png"><br><br><h6>  And in particular to number 0: </h6><br><br><img src="https://habrastorage.org/storage2/f01/304/182/f01304182a1e0bfa2a2bf61e0948799d.png"><br><br>  we set the type of internal number - 'Schedule' and created a simple schedule - from Monday to Saturday from 9 to 18 to send calls to internal number 1 (here we will have the IVR itself) otherwise 600 (voice mail) <br><br><h6>  Further, here we configure the filtering of incoming calls by caller number: </h6><br><br><img src="https://habrastorage.org/storage2/bcb/c10/31c/bcbc1031c431078ee1860a609fbb023f.png"><br><br>  This means that when you receive calls from numbers 1234567890 and 0987654321, the system will hang up. <br><br><h6>  Create the number 600 - voicemail: </h6><br><br><img src="https://habrastorage.org/storage2/0e8/737/192/0e873719285d9eaae6c939531ec4db66.png"><br><br>  (instead of a system message, it is better to download a sound file with your own greeting. Out of the box, from Russian voices, TTS voice festival and TTS from google.translate are available) <br><br><h6>  Next, create the number 1, in which we ask the caller to choose who he wants to hear: </h6><br><br><img src="https://habrastorage.org/storage2/bb9/5cc/a4e/bb95cca4ea85a4412867835bb35ea4ca.png"><br><br><h6>  and numbers for accounting (1 * 1) </h6><br><br><img src="https://habrastorage.org/storage2/c09/f4a/6f1/c09f4a6f1ff542844c7ffb5aaf029cbc.png"><br><br><h6>  and technical department (1 * 2) </h6><br><br><img src="https://habrastorage.org/storage2/375/11e/71d/37511e71d90efb1e16e9a138b99c6e0e.png"><br><br>  All together it looks like this: <br><br><img src="https://habrastorage.org/storage2/d35/9dd/33e/d359dd33eb887d21ce313133dc391aec.png"><br><br>  Next, in order not to repeat everything the same for each user, go to the 'User Profile' tab and make backup settings (in xml format) after which it can be downloaded for a new user (after correcting numbers and passwords). <br><br><br>  Actually everything.  We expand the prepared template to the new user and return it with a piece of PBX. <br><br><h4>  So we have: </h4><br><br><ul><li>  the system we have installed and controlled by us </li></ul><br><br><h4>  User has: </h4><br><ul><li>  schedule for all incoming calls. </li><li>  blacklist telephone spammers and hooligans. </li><li>  auto secretary. </li><li>  recording conversations. </li><li>  voice mail. </li><li>  opportunity to call from 101 to 102 or to the city. </li><li>  redirect calls for numbers 101 and 102 to mobile (via a SIP provider). </li><li>  Manage your virtual office with the possibility of expanding the above options. </li><li>  Detailed CDR for each call: </li></ul><br><img src="https://habrastorage.org/storage2/246/b66/b8b/246b66b8bbd8478ae92aee964ae96a8f.png"><br><br><br>  Now all this works in test mode and deadly bugs have not yet got out, about what I want to fix a little lower. <br><br><h4>  A few words about the inconvenience: </h4><br><br><ul><li>  Putting on the server from scratch from rpm is a bit hemorrhaging due to a lot of dependencies, so it‚Äôs easier to copy with tar directly from the vmare image. </li><li>  At some moments there is a strong desire to record your voice messages (TTS goes out of the box) and fix the web interface. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/135845/">https://habr.com/ru/post/135845/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135835/index.html">Audio mixer from two or more sound cards on realtime Linux and Reaper</a></li>
<li><a href="../135837/index.html">Micro ORM do-it-yourself (part one)</a></li>
<li><a href="../135838/index.html">Let's play snowballs?</a></li>
<li><a href="../135840/index.html">PyS60: Tale of how to write a notepad for Symbian</a></li>
<li><a href="../135844/index.html">Who teaches whom: student teacher or student teacher?</a></li>
<li><a href="../135846/index.html">Recipe cooking 1U server at home</a></li>
<li><a href="../135848/index.html">CRACKL @ B Contest 2010. Analysis of the first task</a></li>
<li><a href="../135849/index.html">Mindbloom Life Game - interactive tree of self-improvement</a></li>
<li><a href="../135850/index.html">Structuring JS Assets in Rails 3.1 (Styx)</a></li>
<li><a href="../135851/index.html">XNA: Display text in system fonts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>