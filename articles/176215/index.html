<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>2D scrolling week</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="And how it all began nicely 
 Parallax for scrolling games is common, but the degree of development of parallax differs dramatically from game to game...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>2D scrolling week</h1><div class="post__text post__text-html js-mediator-article"><h4>  And how it all began nicely </h4><br>  Parallax for scrolling games is common, but the degree of development of parallax differs dramatically from game to game.  To get a really beautiful and interesting background is quite difficult.  Many are now switching to 3D and parallax as an effect in general disappears, as it turns out in a natural way. <br>  In the old days, parallax-effect points (stars) were allowed on the background, a little later, backgrounds were made in a couple of different layers.  And now you can not do a couple of layers or scrolling background, you need a little more. <br><br><img src="https://habrastorage.org/storage2/98d/fde/c35/98dfdec35b1224682dbe609551f59798.jpg"><br>  <i>Lightforce, Commodore 64, 1986</i> <br><br>  Attention, under the cut large pictures. <br><a name="habracut"></a><br>  The power of modern computers (and mobile devices) is growing day by day, but the effects often remain quite simple.  Let's try to understand what the problem is: low power of the equipment, complexity of creating complex backgrounds, laziness ... Is it possible that this is just a lack of development?  Lack of attention to detail? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It was easiest to check this by trying to do it yourself.  Overcoming laziness, I started doing.  Since the artist is none of me, I immediately apologize for the fact that my enemies are abstract (mirrored spheres), the background is generated by the noise of the pearl, and the only drawn boat belongs to my old friend Ricardo‚Äôs pen, and I strongly hope that he doesn‚Äôt mind such a scenario. <br><br>  You can rate the result by the video: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/3ASrLccnPDA%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253&amp;usg=ALkJrhjUwjDPArmEUxltWi3iMNgLqpk0cQ" frameborder="0" allowfullscreen=""></iframe><br><br>  The screenshots in the course of the article are slightly different from the video, in fact only the background is changed in them, which is a little prettier. <br><br><h4>  Parallax </h4><br>  The essence of the parallax effect is that the speed (and size) of objects depends on their distance from the observer - the farther the object, the slower it moves relative to the observer and the smaller it is in size.  Of course, this is true only for stationary objects, or moving with one speed (which is generally equivalent).  Thus, we can take as an axiom the fact that our farthest plan will not move at all.  Or will move very slightly.  The second option will give us a better sense of movement, while the first will allow us to show insanely distant objects, such as stars. <br><br><h4>  From theory to practice </h4><br>  So that everything I said in this topic does not seem just a bare theory, I will supply all my calculations with screenshots from the application that runs on my Intel integrated video (HD2000) with at least 60fps.  Since the game (or rather, the prototype will be said) I wrote before writing the article, glasses, fps, health scale fall into the frame.  I apologize, I did not notice right away, so I decided to leave it on the screenshots.  The essence of the matter they do not change. <br><br><h4>  Far plan </h4><br>  The action takes place in space, so the distant plan will be the stars and nebulae.  Of course, I do not want the game to be compared with NASA photos, so the nebulae are bright.  To create a colorful pseudo cosmic background, I used the utility FilterForge 3.0.  She has a trial 30-day period and anyone can feel it. <br><img src="https://habrastorage.org/storage2/ffb/bbc/064/ffbbbc0646899ca386a4dc64cb77ce0d.png"><br>  Also, I placed a star on the background, which is close enough to become the brightest object in the whole scene, but also far enough to move at the speed of the far plane. <br><img src="https://habrastorage.org/storage2/973/361/d8c/973361d8c2a88c5b07d05413ce3f807e.png"><br><br><h4>  Medium plan </h4><br>  The average plan is more decorative appearance, as it is not yet the main, but already attracting attention.  Therefore, he should not be dead.  He must live, an action must take place there, even the most primitive.  To revive the plan, I will take asteroids and huge space farms.  Asteroids are all the same, but for the background now this is not the most important.  Even their blurring will be beneficial so that they do not distract so much. <br>  The farms were drawn by me in Photoshop for a couple of minutes, the asteroids are honestly taken from the Internet. <br><img src="https://habrastorage.org/storage2/c5b/dca/0df/c5bdca0dfb2bea96ea98825e541bf189.png"><br>  That was not empty, add dust.  Ideally, of course, there should be significantly more objects.  Other ships, planets, stations, meteors ... In other words, everything that comes to mind. <br><img src="https://habrastorage.org/storage2/5bd/852/c9b/5bd852c9b81abe58967dbf1d5adc8b6d.png"><br><br><h4>  Main plan </h4><br>  The main plan is a game, so nothing but game objects will not be here.  To make it easier for me not to die and take screenshots, I turned off the enemies, so the effects of explosions and enemies, alas, no. <br><img src="https://habrastorage.org/storage2/11e/736/5bc/11e7365bceb30315b83f93fab21f50ec.png"><br><br><h4>  Foreground </h4><br>  Yes, this is not a mistake, closer to the main plan will be another foreground  So that he does not interfere too much and does not frighten the player, he will be blurred, as if not in focus.  All that will be on it is rubbish.  Nevertheless, in the game, the foreground will also play the role of additional complication, since it will hide part of the main game plan. <br><img src="https://habrastorage.org/storage2/e97/668/5a0/e976685a02439ae87fc9277d056aac51.png"><br><br><h4>  Garbage </h4><br>  Right, trash!  I completely forgot.  It is necessary to add garbage, and mainly in the main, game plan (very small, so as not to present a visual hazard).  The absence of objects in the main plan completely confuses the player.  The player will lose the feeling of depth and will forget in which of the plans the action takes place.  Garbage can also be in any of the above plans. <br>  Since I made this game for the contest and the timing was extremely tight.  For everything, everything was about a week and I had to give up many features.  Garbage got there, under the knife. <br><br><h4>  so </h4><br>  What did I do wrong?  Actually, everything is true, but it looks awful!  You also need to bring beauty and remove shoals.  To begin, distribute objects in brightness, and generally muffle them so that they do not fall out of the scene. <br><img src="https://habrastorage.org/storage2/7c0/e07/054/7c0e070542946941c1669b154033a106.png"><br>  The contrast remained large, but already such obvious color drops are not noticeable.  The most attentive readers noticed that the sun is drawn incorrectly.  It is behind the stage, and it should be in front and overlapped only by game objects and foreground.  We fix. <br><img src="https://habrastorage.org/storage2/038/040/bc7/038040bc75df5d3d2af529f7f4e1a03e.png"><br>  Now I will add just one missing stroke ... <br><img src="https://habrastorage.org/storage2/3ef/210/560/3ef2105607cede43bc888e90271e4a3c.png"><br>  That's so much better.  But this is only one post-process shader.  Bulk light shader  How does it work? <br><br><h4>  How does it work? </h4><br>  The original image for the formation of such a frame is, however strange it may be, the previous image.  However, there is more.  We will put the framed frame aside and prepare an additional texture specifically for the effect, containing information about the light and the objects that overlap it.  It looks like this: <br><img src="https://habrastorage.org/storage2/8cb/cf9/335/8cbcf9335dc30523466d917b573be55a.png"><br>  In this texture, we render the light source and everything that can block the light.  And the darker we draw it, the more it blocks the light.  The light source in this frame is the center of the screen (the coordinates of the source are additionally transmitted to the shader during drawing). <br>  Please note that the scene 1 in 1 repeats the one that we see by the location and size of the objects: <br><img src="https://habrastorage.org/storage2/7a2/9e9/6a2/7a29e96a2a450540d693b8792584ed6b.png"><br>  <i>Above the texture for the rays, below the usual drawing</i> <br>  To transform this texture into rays of bulk light, we must process it with a shader, the code of which I will attach at the end of the article.  The result is very similar to the effect of radial blur from photoshop, which in fact is corrected for the coordinates of the light source. <br><img src="https://habrastorage.org/storage2/b11/987/fcc/b11987fcc307f1baec0d95836488908a.png"><br>  So we got our rays of light.  All that now remains to be done is to impose this texture on top of our entire scene with additive addition, to mix them.  The final result was a little higher, and to see the difference, I will impose the effect on only half of the screen: <br><img src="https://habrastorage.org/storage2/36c/877/557/36c877557ac3c7be76ce5db4a2666576.png"><br>  <i>Left with surround light rays, right without</i> <br><br><h4>  Instead of a resume </h4><br>  Plans painted.  There are only four of them, but since objects in one plane can move at different speeds, this will create the effect of continuous space.  All that is needed for this is to vary their speed and size.  To give greater beauty and volume - the effect of volumetric light. <br>  I do not exclude the use of additional effects, such as motion blur or light aberration.  Since the goal was to create a game that runs at 60fps on the laptop‚Äôs integrated video processor, such complications had to be abandoned.  We must immediately admit that the creation of parallax required not even 60, but all 120 frames per second, since the subsequent implementation of the game itself will reduce the performance.  It is also necessary to take into account the resolution - 1280 * 720, which imposes restrictions on the speed of processing full-screen post-process effects. <br><br><h4>  Tools </h4><br>  I used the development tools I was used to, namely my own framework for Direct3D9, HLSL and the Microsoft compiler for creating binary effects code.  The main code is written in Embarcadero Delphi XE3.  I rendered the background texture in FilterForge 3.0. <br><br><h4>  Shader </h4><br><pre><code class="cpp hljs">sampler2D DiffuseMap : <span class="hljs-keyword"><span class="hljs-keyword">register</span></span>(s0); float2 LightPos : <span class="hljs-keyword"><span class="hljs-keyword">register</span></span>(c0); float4 Params : <span class="hljs-keyword"><span class="hljs-keyword">register</span></span>(c1); <span class="hljs-function"><span class="hljs-function">float4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">std_PS</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vertexOutput Input)</span></span></span><span class="hljs-function"> : COLOR </span></span>{ float4 Output; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> NumSamples = <span class="hljs-number"><span class="hljs-number">20</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Weight = <span class="hljs-number"><span class="hljs-number">1.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Density = <span class="hljs-number"><span class="hljs-number">0.5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Exposure = <span class="hljs-number"><span class="hljs-number">0.25</span></span>; float2 DeltaTexCoord = (Input.TexCoord - LightPos); DeltaTexCoord *= <span class="hljs-number"><span class="hljs-number">1.0</span></span> / NumSamples * Density; float3 Diff = tex2D(DiffuseMap, Input.TexCoord); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> illuminationDecay = <span class="hljs-number"><span class="hljs-number">1.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; NumSamples; i++) { Input.TexCoord -= DeltaTexCoord; float3 sample = tex2D(DiffuseMap, Input.TexCoord); sample *= illuminationDecay * Weight; Diff += sample; illuminationDecay *= <span class="hljs-number"><span class="hljs-number">0.9</span></span>;<span class="hljs-comment"><span class="hljs-comment">//Decay; } Output = float4(Diff * Exposure, 1); return Output; }</span></span></code> </pre> <br><br>  <b>UPD:</b> <br>  Source codes and binaries can be obtained from the <a href="https://bitbucket.org/Darthman/shattered-void">repository</a> at bitbucket.org </div><p>Source: <a href="https://habr.com/ru/post/176215/">https://habr.com/ru/post/176215/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../176203/index.html">10 tips for using AVR microcontrollers in motorized systems</a></li>
<li><a href="../176205/index.html">How to start flying by yourself, at least on something, with a motor</a></li>
<li><a href="../176207/index.html">'Clean' javascript: "Start"</a></li>
<li><a href="../176209/index.html">Websphere mq for beginners</a></li>
<li><a href="../176211/index.html">April 11-12. Online Broadcast Conference Software People 2013</a></li>
<li><a href="../176219/index.html">EB 112.3. Preparing for the delivery of the second group of electrical safety</a></li>
<li><a href="../176223/index.html">Job seeker vs employer: a fresh look at HR approaches</a></li>
<li><a href="../176227/index.html">NASA builds thermonuclear space engine</a></li>
<li><a href="../176229/index.html">D59 - the first Perm conference of software developers</a></li>
<li><a href="../176233/index.html">Lists from lambda functions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>