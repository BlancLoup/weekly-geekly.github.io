<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Enabling BitLocker on Exchange Servers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The optimal security architecture for Exchange for both Exchange Server 2013 and Exchange Server 2016 recommends enabling BitLocker on fixed data driv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Enabling BitLocker on Exchange Servers</h1><div class="post__text post__text-html js-mediator-article">  The optimal security architecture for Exchange for both Exchange Server 2013 and Exchange Server 2016 recommends enabling BitLocker on fixed data drives that store Exchange database files.  In order to configure disk encryption, we first define: <a name="habracut"></a><br><br>  <b>What is BitLocker?</b> <br><br>  BitLocker is a built-in volume encryption solution for Microsoft Windows that provides enhanced protection against data theft, for example, in cases of theft or loss of computers or hard drives. <br>  BitLocker was first introduced in Windows Vista and Windows Server 2008. Since the first release of BitLocker, several improvements have been made, including data volume encryption, encryption of only disk space used, and redundancy flexibility. <br>  By default, BitLocker uses AES encryption in cipher block chaining mode (CBC) with a 128-bit (default) or 256-bit key. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For more information, see BitLocker Overview on <a href="https://technet.microsoft.com/en-us/library/hh831713.aspx">Microsoft TechNet</a> . <br><br>  <i>How can BitLocker be deployed?</i> <br><br>  There are several ways to deploy BitLocker on Exchange servers. <br>  1. Encrypt the operating system volume and Exchange data volumes using either network unlock, Data Recovery agents and PKI infrastructure or using TPM (the recommended approach). <br>  2. Encrypt only Exchange data volumes. <br><br>  To use BitLocker for FIPS compliance, keep in mind: <br><br><ul><li>  Trusted Platform Module (TPM) version 1.2 is not FIPS compliant and uses SHA1.  You must use TPM version 2.0 for FIPS compliance. </li><li>  To effectively use the network unlock function, you must take into account the <a href="https://technet.microsoft.com/en-us/library/jj574173.aspx">basic requirements</a> . </li><li>  If you are not using Windows Server 2012 R2 or later as the base operating system, then you cannot use BitLocker recovery passwords.  For more information, see <a href="https://technet.microsoft.com/en-us/library/dn306081.aspx">What's New in BitLocker</a> and <a href="https://support.microsoft.com/en-us/kb/947249">KB 947249</a> . </li></ul><br>  <i>Volume Encryption Method</i> <br><br>  There are two ways to encrypt a volume: <br>  1. Encryption of the entire volume.  Use this option if you need to encrypt volumes that already contain existing messaging data.  For example, to encrypt an entire 3 TB disk, this will take more than 8 hours. <br>  2. Encrypt only used space.  Use this option for new installations or new disks on which data is not yet available. <br><br>  Before you begin encrypting the entire volume, make sure that the servers are in <a href="https://technet.microsoft.com/en-us/library/dd298065(v%3Dexchg.150).aspx">maintenance mode</a> to prevent exposure to end users.  You can note a significant decrease in performance (~ 90% of processor usage) and a decrease in the free space of the volume with the OS (~ 2 GB) while the volume is encrypted.  In addition, ensure that BitLocker is deployed at the same time on no more than one DAG server to maintain availability. <br><br>  <b>Encryption script volume from OS and Exchange data volumes</b> <br><br>  BitLocker provides maximum protection when used with the TPM module.  The TPM is a hardware component installed on the server, and we recommend using TPM chip version 2.0.  It works with BitLocker, helping to protect user data, as well as ensuring that the server was not tampered with while it was not available. <br><br>  In particular, BitLocker can use TPM to verify the integrity of early boot components and boot configuration data.  This helps ensure that BitLocker makes the encrypted disk available only if these components have not been tampered with and the encrypted disk resides in the source server. <br><br>  BitLocker helps ensure the integrity of the startup process by following these steps: <br><ul><li>  It checks that the integrity of early boot files is preserved and helps ensure that there are no malicious changes to these files (for example, infection of the boot sector virus or rootkits). </li><li>  Strengthens protection to mitigate software attacks while the server is unavailable.  Any alternative software that can run the system does not have access to the decryption keys for the Windows system volume. </li><li>  Lock system in case of forgery.  If any of the monitored files have been changed, the system simply will not start.  If the system does not start normally, then this is a signal to the administrator about the fraud.  In the event that a system lock occurs, follow the BitLocker recovery procedure, which includes the process of unlocking the system with a password or USB key. </li></ul><br><blockquote>  <b>Important:</b> TPM can only be used on physical servers.  Virtual servers are not able to use TPM.  If you have encrypted the guest operating system volume, then without fail, use a password or USB key to boot the guest operating system. </blockquote><br><br>  <b><i>Environment setup</i></b> <br><br>  The steps below assume that Exchange Server is running Windows Server 2012 R2 or later. <br><br><blockquote>  <b>Important:</b> When BitLocker is enabled on existing Exchange servers, it is important to place the servers in <a href="https://technet.microsoft.com/en-us/library/dd298065(v%3Dexchg.150).aspx">maintenance mode</a> to avoid the impact of the encryption process on end users. </blockquote><br>  1. Create an organizational unit (OU) containing the Exchange servers, if one does not exist. <br>  Start PowerShell with the appropriate Active Directory permissions. <br><br><pre><code class="bash hljs">New-ADOrganizationalUnit <span class="hljs-string"><span class="hljs-string">"Exchange Servers"</span></span> -path <span class="hljs-string"><span class="hljs-string">"dc=contoso,dc=com"</span></span> <span class="hljs-variable"><span class="hljs-variable">$ExchangeOU</span></span> = Get-ADOrganizationalUnit -Filter <span class="hljs-string"><span class="hljs-string">'Name -like "Exchange Servers"'</span></span> Get-ADComputer <span class="hljs-string"><span class="hljs-string">"Exchange Server"</span></span> | Move-ADObject -TargetPath <span class="hljs-variable"><span class="hljs-variable">$ExchangeOU</span></span>.DistinguishedName</code> </pre> <br><br>  2. Create a GPO and link it to the OU that contains the Exchange servers. <br><br><pre> <code class="bash hljs">Import-Module grouppolicy <span class="hljs-comment"><span class="hljs-comment">#RSAT    New-GPO -Name "Exchange Server BitLocker Policy" -Domain contoso.com New-GPLink -Name "Exchange Server BitLocker Policy" -Enforced "yes" -Target $ExchangeOU.DistinguishedName</span></span></code> </pre><br><br>  3. Install the BitLocker module on Exchange servers. <br><ul><li>  Start PowerShell with local administrator privileges. </li><li>  Run Install-WindowsFeature BitLocker -Restart. </li><li>  Reboot the server. </li></ul><br>  4. Enable TPM on Exchange servers. <br><ul><li>  Contact the hardware manufacturer of the hardware BIOS for details on how to enable / activate the TPM module. </li><li>  Check TPM status using the Trusted Platform Module Management tool (tpm.msc). </li></ul><br>  5. Enable the storage of TPM recovery information in Active Directory. <br><ul><li>  Open the Exchange console with an account that has the necessary permissions in Active Directory to use the access control entries. </li><li>  Run: <pre> <code class="bash hljs">Add-ADPermission <span class="hljs-variable"><span class="hljs-variable">$ExchangeOU</span></span>.DistinguishedName -User <span class="hljs-string"><span class="hljs-string">"NT AUTHORITY\SELF"</span></span> -AccessRights ReadProperty,WriteProperty -Properties msTPM-OwnerInformation,msTPM-TpmInformationForComputer -InheritedObjectType Computer -InheritanceType Descendents</code> </pre></li></ul><br>  6. Configure Bitlocker settings in a GPO. <br><ul><li>  Open the Group Policy Management Console (gpmc.msc). </li><li>  Navigate the hierarchy to the OU containing the Exchange servers. </li><li>  Right-click the Exchange Server BitLocker Policy and select Edit. </li><li>  Open Computer Configuration, open Policies, open Administrative Templates, open Windows Components, and open BitLocker Drive Encryption. <br>  In the right pane, double-click Choose drive encryption method and cipher strength.  Select the Enabled option.  If you want to use the AES algorithm with 256-bit encryption, select it and click OK. <br><br><img src="https://habrastorage.org/files/59c/866/742/59c8667428fc4923b1af550cf5dc703b.png"><br><br></li><li>  Open Computer Configuration, open Policies, open Administrative Templates, open Windows Components, open BitLocker Drive Encryption, open Operating System Drives. <br><br>  In the right pane, double-click Require additional authentication at startup.  Select the Enabled option.  If you want to disable or change any of the authentication methods, do it, and click OK. <br><br><img src="https://habrastorage.org/files/c3c/1b5/078/c3c1b50788ff46f0ba0c8674d0b99bce.png"><br><br></li><li>  In the right pane, double-click Choose how BitLocker-protected operating system drives can be recovered.  Select the Enabled option.  Select Do not enable BitLocker for operating system drives.  Click OK. <br><br><img src="https://habrastorage.org/files/3b1/1d7/442/3b11d7442fa844efbab550c9b8aac30c.png"><br><br></li><li>  In the right pane, double-click Enforce drive encryption type on operating system drives.  Select the Enabled option.  Select the option Used Space Only encryption for the encryption type.  Click OK. <br><br><img src="https://habrastorage.org/files/313/50b/fd9/31350bfd92724cb1a24e18d113b71db5.png"><br><br></li><li>  Open Computer Configuration, open Policies, then Administrative Templates, then Windows Components, then BitLocker Drive Encryption, now open Fixed Data Drives <br>  In the right pane, double-click Choose how BitLocker-protected fixed drives can be recovered.  Select Enabled.  Select Do not enable BitLocker for fixed data drives.  Click OK. <br><br><img src="https://habrastorage.org/files/e8b/459/76d/e8b45976d8ef4130a7427acb3257ff92.png"><br><br></li><li>  In the right pane, double-click Enforce drive encryption type on fixed drives.  Select Enabled.  Select the option Used Space Only encryption for the encryption type.  Click OK. <br><br><img src="https://habrastorage.org/files/617/3dd/2dc/6173dd2dccbb424eb30681418db81758.png"><br><br></li><li>  Open Computer Configuration, the next step Policies, then Administrative Templates, then open System, then Trusted Platform Module Services. <br><br>  In the right pane, double-click Turn on TPM backup to Active Directory Domain Services.  Select Enabled.  Click OK. <br><br><img src="https://habrastorage.org/files/eb6/d67/5c2/eb6d675c24ef4ae89bf4929a699fbaa9.png"><br><br></li><li>  Ensure that Group Policy applies to Exchange servers. <br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$Servers</span></span> = Get-AdComputer -SearchBase <span class="hljs-variable"><span class="hljs-variable">$ExchangeOU</span></span>.DistinguishedName -Filter Foreach (<span class="hljs-variable"><span class="hljs-variable">$Server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$Servers</span></span>) {invoke-gpupdate -Computer <span class="hljs-variable"><span class="hljs-variable">$Servers</span></span>.Name -Force -Target Computer}</code> </pre></li><li>  Enable OS encryption. <br>  Create a recovery key: <b>manage-bde -protectors -add -RecoveryPassword C:</b> <br>  Run the following command on the system OS disk: <b>manage-bde -on C: ‚Äìusedspaceonly</b> <br></li><li>  Enable data volume encryption (C: \ ExchangeVolumes \ ExVol1 determines the mount point for the Exchange data volume, replace if necessary). <br>  Create a recovery key: <b>manage-bde -protectors -add -RecoveryPassword "C: \ ExchangeVolumes \ ExVol1"</b> <br>  Perform the following steps for each Exchange database volume: <b>manage-bde -on "C: \ ExchangeVolumes \ ExVol1" ‚Äìusedspaceonly</b> <br>  Perform the following steps for each Exchange database volume to enable automatic unlocking: <b>Enable-BitLockerAutoUnlock -MountPoint "C: \ ExchangeVolumes \ ExVol1"</b> <br><blockquote>  Note: Bad disk sectors can lead to volume encryption failures with BitLocker.  For more information, please see <a href="https://technet.microsoft.com/en-us/library/cc734067(v%3Dws.10).aspx">Event ID 24588</a> . </blockquote><br></li></ul><br><br>  <b>Exchange Data Encryption Script</b> <br><br>  In a situation where TPM cannot be used (for example, the server does not have TPM, or is virtualized), encrypting the OS system volume requires the use of a password or USB key to allow the operating system to boot correctly.  Since this can negatively affect the Exchange services, you can refuse to encrypt the OS system volume.  Instead, you can encrypt data volumes.  Since the OS system volume is not encrypted, the OS cannot automatically unlock the encrypted volumes upon boot.  Thus, one of two conditions must be met: <br>  1. The administrator manually enters the recovery key and unlocks each disk after the OS boots. <br>  2. A scheduled task is running to unlock encrypted volumes during OS boot. <br><br>  The following steps describe how to set up a scheduled task and assume that Exchange Server is running Windows Server 2012 R2 or later. <br><ul><li>  Create an organizational unit (OU) containing the Exchange servers, if one does not exist. <br><pre> <code class="bash hljs">New-ADOrganizationalUnit <span class="hljs-string"><span class="hljs-string">"Exchange Servers"</span></span> -path <span class="hljs-string"><span class="hljs-string">"dc=contoso,dc=com"</span></span> <span class="hljs-variable"><span class="hljs-variable">$ExchangeOU</span></span> = Get-ADOrganizationalUnit <span class="hljs-string"><span class="hljs-string">"Exchange Servers"</span></span> Get-ADComputer <span class="hljs-string"><span class="hljs-string">"Exchange Server"</span></span> | Move-ADObject -TargetPath ExchangeOU.DistinguishedName</code> </pre></li><li>  Create a GPO and link it to the OU that contains the Exchange server. <br><pre> <code class="bash hljs">Import-Module grouppolicy <span class="hljs-comment"><span class="hljs-comment">#RSAT    New-GPO -Name "Exchange Server BitLocker Policy" -Domain contoso.com New-GPLink -Name "Exchange Server BitLocker Policy" -Enforced "yes" -Target $ExchangeOU.DistinguishedName</span></span></code> </pre></li><li>  Create a BitLocker service account for a scheduled task (_bitlockersvc). </li><li>  Create a security group to manage BitLocker by placing the security group in a secure container. <br><pre> <code class="bash hljs">New-ADGroup -name <span class="hljs-string"><span class="hljs-string">"Exchange BitLocker Management"</span></span> -groupscope Universal -path <span class="hljs-string"><span class="hljs-string">"cn=users,dc=coe,dc=local"</span></span> Add-ADGroupMember <span class="hljs-string"><span class="hljs-string">"Exchange BitLocker Management"</span></span> -members <span class="hljs-string"><span class="hljs-string">"_bitlockersvc"</span></span>, <span class="hljs-string"><span class="hljs-string">"Organization Management"</span></span></code> </pre></li><li>  Install the BitLocker module on Exchange servers <br><pre> <code class="bash hljs">Install-WindowsFeature BitLocker</code> </pre></li><li>  Reboot the server. </li><li>  Add the BitLocker security group to the local administrators group on all Exchange servers </li><li>  Grant the BitLocker security group access to the <b>msFVE-RecoveryPassword AD</b> object.  This allows accounts to access the recovery password. <br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$ExchangeOU</span></span> = Get-OrganizationalUnit <span class="hljs-string"><span class="hljs-string">"Exchange Servers"</span></span> DSACLS <span class="hljs-variable"><span class="hljs-variable">$ExchangeOu</span></span>.DistinguishedName /I:T /G <span class="hljs-string"><span class="hljs-string">"contoso\Exchange BitLocker Management:CA;msFVE-RecoveryPassword"</span></span></code> </pre></li><li>  Configure BitLocker encryption settings in a GPO. </li><li>  Ensure that Group Policy applies to Exchange servers. <br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$Servers</span></span> = Get-AdComputer -SearchBase <span class="hljs-variable"><span class="hljs-variable">$ExchangeOU</span></span>.DistinguishedName -Filter Foreach (<span class="hljs-variable"><span class="hljs-variable">$Server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$Servers</span></span>) {invoke-gpupdate -Computer <span class="hljs-variable"><span class="hljs-variable">$Servers</span></span>.Name -Force -Target Computer}</code> </pre></li><li>  Enable data volume encryption <b>(C: \ ExchangeVolumes \ ExVol1</b> determines the mount point for the Exchange data volume, replace if necessary). <br>  Perform the following steps for each Exchange database volume: <b>Manage-bde -on "C: \ ExchangeVolumes \ ExVol1" -rp -usedspaceonly</b> </li><li>  Ensure that recovery keys are stored in Active Directory. <br>  a.  Download <a href="http://go.microsoft.com/fwlink/%3FLinkId%3D78953">BitLocker Drive Encryption Configuration Guide: Backing Up BitLocker and TPM Recovery Information to Active Directory</a> <br>  b.  Run <b>Get-BitLockerRecoveryInfo.vbs</b> <br>  c.  If the script does not return any data, back up the recovery keys by loading and executing <a href="http://blogs.technet.com/b/askcore/archive/2010/04/06/how-to-backup-recovery-information-in-ad-after-bitlocker-is-turned-on-in-windows-7.aspx">BDEAdBackup.vbs</a> . <br></li><li>  Create a script that unlocks data volumes when the OS boots. <br>  Save the file below in the scripts directory (for example, c: \ bitlocker). <br><br><pre> <code class="bash hljs">UnlockDrives.ps1 <span class="hljs-variable"><span class="hljs-variable">$computer</span></span> = Get-ADComputer <span class="hljs-variable"><span class="hljs-variable">$env</span></span>:computername <span class="hljs-variable"><span class="hljs-variable">$RecoveryInformations</span></span> = get-ADObject -ldapfilter <span class="hljs-string"><span class="hljs-string">"(msFVE-Recoverypassword=*)"</span></span> -Searchbase <span class="hljs-variable"><span class="hljs-variable">$computer</span></span>.distinguishedname -properties * <span class="hljs-variable"><span class="hljs-variable">$vols</span></span> = gwmi win32_encryptablevolume -Namespace <span class="hljs-string"><span class="hljs-string">"Root\CIMV2\Security\MicrosoftVolumeEncryption"</span></span> <span class="hljs-variable"><span class="hljs-variable">$lockedvols</span></span> = <span class="hljs-variable"><span class="hljs-variable">$vols</span></span> | ? {<span class="hljs-variable"><span class="hljs-variable">$_</span></span>.GetLockStatus().LockStatus -eq 1} <span class="hljs-variable"><span class="hljs-variable">$vols</span></span>[0].GetKeyProtectors().VolumeKeyProtectorID foreach(<span class="hljs-variable"><span class="hljs-variable">$lockedvol</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-variable"><span class="hljs-variable">$lockedvols</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$RecoveryInformations</span></span> | % {<span class="hljs-variable"><span class="hljs-variable">$lockedvol</span></span>.UnlockWithNumericalPassword(<span class="hljs-variable"><span class="hljs-variable">$_</span></span>.<span class="hljs-string"><span class="hljs-string">"msFVE-RecoveryPassword"</span></span>)} }</code> </pre></li><li>  Create a scheduled task that will start at system startup and unlock data volumes, replacing the items highlighted in bold. <br>  a.  Save the file in the scripts directory. <br>  b.  Run <b>schtasks / create / s $ env: computername / ru contoso \ _svcexbitlocker / rp / XML c: \ Bitlocker \ UnlockDrivesAtStart.xml / TN UnlockDrivesAtStart</b> <b><br><br></b> <div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><pre> <code class="bash hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"UTF-16"</span></span>?&gt; &lt;Task version=<span class="hljs-string"><span class="hljs-string">"1.2"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/windows/2004/02/mit/task"</span></span>&gt; &lt;RegistrationInfo&gt; &lt;Date&gt;2015-04-16T12:07:14.9465954&lt;/Date&gt; &lt;Author&gt;contoso\exadmin&lt;/&lt;/Author&gt; &lt;Description&gt;Script unlocks Exchange data drives at OS startup&lt;/Description&gt; &lt;/RegistrationInfo&gt; &lt;Triggers&gt; &lt;BootTrigger&gt; &lt;Enabled&gt;<span class="hljs-literal"><span class="hljs-literal">true</span></span>&lt;/Enabled&gt; &lt;/BootTrigger&gt; &lt;/Triggers&gt; &lt;Principals&gt; &lt;Principal id=<span class="hljs-string"><span class="hljs-string">"Author"</span></span>&gt; &lt;UserId&gt;contoso\_bitlockersvc&lt;/UserId&gt; &lt;LogonType&gt;Password&lt;/LogonType&gt; &lt;RunLevel&gt;HighestAvailable&lt;/RunLevel&gt; &lt;/Principal&gt; &lt;/Principals&gt; &lt;Settings&gt; &lt;MultipleInstancesPolicy&gt;IgnoreNew&lt;/MultipleInstancesPolicy&gt; &lt;DisallowStartIfOnBatteries&gt;<span class="hljs-literal"><span class="hljs-literal">true</span></span>&lt;/DisallowStartIfOnBatteries&gt; &lt;StopIfGoingOnBatteries&gt;<span class="hljs-literal"><span class="hljs-literal">true</span></span>&lt;/StopIfGoingOnBatteries&gt; &lt;AllowHardTerminate&gt;<span class="hljs-literal"><span class="hljs-literal">true</span></span>&lt;/AllowHardTerminate&gt; &lt;StartWhenAvailable&gt;<span class="hljs-literal"><span class="hljs-literal">false</span></span>&lt;/StartWhenAvailable&gt; &lt;RunOnlyIfNetworkAvailable&gt;<span class="hljs-literal"><span class="hljs-literal">false</span></span>&lt;/RunOnlyIfNetworkAvailable&gt; &lt;IdleSettings&gt; &lt;StopOnIdleEnd&gt;<span class="hljs-literal"><span class="hljs-literal">true</span></span>&lt;/StopOnIdleEnd&gt; &lt;RestartOnIdle&gt;<span class="hljs-literal"><span class="hljs-literal">false</span></span>&lt;/RestartOnIdle&gt; &lt;/IdleSettings&gt; &lt;AllowStartOnDemand&gt;<span class="hljs-literal"><span class="hljs-literal">true</span></span>&lt;/AllowStartOnDemand&gt; &lt;Enabled&gt;<span class="hljs-literal"><span class="hljs-literal">true</span></span>&lt;/Enabled&gt; &lt;Hidden&gt;<span class="hljs-literal"><span class="hljs-literal">false</span></span>&lt;/Hidden&gt; &lt;RunOnlyIfIdle&gt;<span class="hljs-literal"><span class="hljs-literal">false</span></span>&lt;/RunOnlyIfIdle&gt; &lt;WakeToRun&gt;<span class="hljs-literal"><span class="hljs-literal">false</span></span>&lt;/WakeToRun&gt; &lt;ExecutionTimeLimit&gt;P3D&lt;/ExecutionTimeLimit&gt; &lt;Priority&gt;7&lt;/Priority&gt; &lt;/Settings&gt; &lt;Actions Context=<span class="hljs-string"><span class="hljs-string">"Author"</span></span>&gt; &lt;Exec&gt; &lt;Command&gt;C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe&lt;/Command&gt; &lt;Arguments&gt;-Command .\UnlockDrives.ps1&lt;/Arguments&gt; &lt;WorkingDirectory&gt;DIRECTORY_FOR_UNLOCKDRIVES.PS1&lt;/WorkingDirectory&gt; &lt;/Exec&gt; &lt;/Actions&gt; &lt;/Task&gt;</code> </pre><br></div></div><br><br>  <b>System changes</b> <br><br>  It is important to remember that any of the following changes in the system can lead to integrity check failures and prevent TPM from releasing the BitLocker key to decrypt protected volumes: <br><ul><li>  Moving a BitLocker encrypted drive to a new computer. </li><li>  Installing a new motherboard with a new TPM module. </li><li>  Shut down, shut down or clear TPM. </li><li>  Change any boot configuration settings. </li><li>  Change the BIOS, UEFI firmware, master boot record, boot sector, boot manager, option ROM, or other components at the start of the boot or boot configuration data. </li><li>  Apply BIOS / UEFI firmware updates. </li></ul><br>  As part of your standard operating procedure, it is better to suspend BitLocker encryption (via the <a href="https://technet.microsoft.com/en-us/library/jj649830(v%3Dwps.630).aspx">Suspend-BitLocker</a> cmdlet) before making any changes to the server.  In addition, make sure that any hardware and software configuration changes are successfully tested in a test environment (with BitLocker enabled) before deploying to production. <br>  In addition, ensure that a standard operating recovery procedure is developed in case there is a need to restore BitLocker.  This will minimize downtime.  For more information, refer to the <a href="https://technet.microsoft.com/en-us/library/dn383583.aspx">BitLocker Recovery Guide</a> . <br><br>  <b>Disk Maintenance Works</b> <br><br>  During the life cycle of the server, the disks fail.  As part of your standard operating procedures, you must make sure that when the disk is replaced with a new one, the volume is formatted and encrypted using BitLocker. <br><br>  In case you use AutoReseed to restore a failed disk, you have two options: formatting and disk encryption before using or encryption after a failure. <br><br>  <i>Formatting and encrypting disks before use</i> <br><br>  In this case, your standard procedure should prevent formatting backup disks via <a href="https://technet.microsoft.com/en-us/library/dn789209(v%3Dexchg.150).aspx">Disk Reclaimer</a> .  Instead, you format and encrypt all backup disks before use. <br>  1. Disable Disk Reclaimer on DAG: Set-DatabaseAvailabilityGroup -AutoDagDiskReclaimerEnabled $ false <br>  2. Format and encrypt all backup disks.  Do not assign mount points or drive letters. <br>  3. As soon as the disks fail, AutoReseed will assign the backup disks, replacing the failed volumes, and re-fill the damaged copies of the databases. <br>  4. Schedule maintenance time.  Replace the failed drives.  Format and encrypt new ones. <br><br>  <i>Encryption after failure</i> <br><br>  In this case, your standard procedure will allow Disk Reclaimer to format backup disks (default behavior).  After the backup disk is formatted and the databases are full, you encrypt the disk. <br><br>  1. In the event of a disk failure, AutoReseed allocates, redistributes, and formats a spare disk. <br>  2. AutoReseed initiates a refill operation. <br>  3. Using SCOM, or another management tool, you monitor events 1127 (initiates a database refill operation) and 826 (completion of the database refill process) that are located on the Microsoft-Exchange-HighAvailability / Seeding channel. <br>  4. Schedule maintenance for the affected server and encrypt the new volume. <br><br>  <b>Conclusion</b> <br><br>  I hope this information will help you better understand BitLocker encryption and settings on Exchange servers.  As indicated, the recommended approach is to use TPM to store recovery information, which allows the operating system to unlock data volumes automatically at boot time.  However, if your servers do not have access to TPM, you can use encryption of data volumes only and develop a mechanism for unlocking volumes during the OS boot phase. <br>  We will be happy to answer any questions you may have. <br><br>  An article based on <a href="http://blogs.technet.com/b/exchange/archive/2015/10/20/enabling-bitlocker-on-exchange-servers.aspx">blogs.technet.com/b/exchange/archive/2015/10/20/enabling-bitlocker-on-exchange-servers.aspx</a> <br><br>  Yours, <a href="http://servilon.com/">Servilon Team</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/270015/">https://habr.com/ru/post/270015/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270001/index.html">Do good code: 8 good code rules</a></li>
<li><a href="../270003/index.html">JetBrains Toolbox came out with all updated desktop products</a></li>
<li><a href="../270005/index.html">Service Locator breaks encapsulation</a></li>
<li><a href="../270009/index.html">Memory Management: A View from the Inside</a></li>
<li><a href="../270011/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ183 (October 26 - November 1, 2015)</a></li>
<li><a href="../270017/index.html">Michael Stonebreaker - Hadoop at the Crossroads</a></li>
<li><a href="../270019/index.html">Vivaldi Beta 1.0 browser release</a></li>
<li><a href="../270023/index.html">Introduction to RxJava: Key Types</a></li>
<li><a href="../270027/index.html">Why ‚Äúerrors are meanings‚Äù in Go</a></li>
<li><a href="../270031/index.html">NSNJSON. ÈÅì (Final article)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>