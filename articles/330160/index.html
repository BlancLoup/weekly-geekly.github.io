<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Reduced read / write operations on the Raspberry Pi</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 

 So, on the Internet you can find articles about the fact that in Raspberry flash drives "live" for 2-3 months, after which they become...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Reduced read / write operations on the Raspberry Pi</h1><div class="post__text post__text-html js-mediator-article">  <b>Introduction</b> <br><br>  So, on the Internet you can find articles about the fact that in Raspberry flash drives "live" for 2-3 months, after which they become unusable.  The proposed solutions are to replace the standard microSD card with a USB HDD.  The solution is simple, reliable, plus increases the speed of reading / writing.  But why flash drives die so fast?  Can the same factors harm the hard drive?  And so begin! <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Materiel</b> <div class="spoiler_text">  Flash drives have a limited number of write cycles.  It means that if linux constantly writes something to it, it can fail prematurely.  Hard drives work on a different principle.  But for them, small read / write operations are also not particularly useful.  The head of the hard disk can be parked if it is not used for a certain period of time, the system can do it, and it can also be embedded in the gland.  In the case of small read / write operations, the hard disk constantly cannot park the head (not critical) or park the head, and immediately starts something to read / write (this is already worse). <br><br>  Information is written in pages.  The usual page size is 4 kB.  So if we want to write one byte, then either it will fit into the buffer, or 4 KB will be written.  If the buffer is full, the page is written and the further record goes to the next page, which is in RAM. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The recording of small pieces of information is used when logging the file system (it gives the opportunity not to lose information in case of failure, for example, power off), as well as logging functions (they store information about certain system events, or program events).  In raspberry, logging is done by rsyslog [ <a href="https://losst.ru/nastrojka-rsyslog-v-linux">1</a> ] <br><br>  There are two daemons in Raspbian that can be disabled to reduce the load on the root media.  Turning them off can win in the write operations, but lose in the reliability and the possibility of recovery.  These are the file system logging daemon and rsyslog.  So if there is valuable data that will be stored in the root disk, then it is better not to disable the logging service.  If raspberry is used as a toy or it is possible to quickly replace the main disk, then file system logging can be disabled.  As for logging, it is similar, if you don‚Äôt know why it is needed, then it‚Äôs enough to say that if something doesn‚Äôt work, then the fault must be looked for initially in the logs.  If you want to ask a question to someone on the forum, you will most likely be asked to drop logs.  So if everything works or it is easier for you to reinstall the system than to figure out what ‚Äúspilled‚Äù - you can safely turn off the logs. <br></div></div><br>  You can use the iotop utility to view drive accesses.  To do this, run it with the parameters: <br><br><pre><code class="bash hljs">sudo iotop -o -a</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Iotop installation</b> <div class="spoiler_text"><pre> <code class="bash hljs">sudo apt-get install iotop</code> </pre> </div></div><br>  <b>Disable logging</b> <br><br>  To disable logging, open: <br><br><pre> <code class="bash hljs">sudo nano /etc/rsyslog.conf</code> </pre> <br>  and comment on it in two lines in the MODULES section: <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$ModLoad</span></span> imuxsock <span class="hljs-comment"><span class="hljs-comment"># provides support for local system logging $ModLoad imklog # provides kernel logging support</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">It should turn out like this:</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/rsyslog.conf Configuration file for rsyslog. # # For more information see # /usr/share/doc/rsyslog-doc/html/rsyslog_conf.html ################# #### MODULES #### ################# #$ModLoad imuxsock # provides support for local system logging #$ModLoad imklog # provides kernel logging support #$ModLoad immark # provides --MARK-- message capability # provides UDP syslog reception #$ModLoad imudp #$UDPServerRun 514 # provides TCP syslog reception #$ModLoad imtcp #$InputTCPServerRun 514 ########################### #### GLOBAL DIRECTIVES #### ########################### # # Use traditional timestamp format. # To enable high precision timestamps, comment out the following line. # $ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat # # Set the default permissions for all log files. # $FileOwner root $FileGroup adm $FileCreateMode 0640 $DirCreateMode 0755 $Umask 0022 # # Where to place spool and state files # $WorkDirectory /var/spool/rsyslog # # Include all config files in /etc/rsyslog.d/ # $IncludeConfig /etc/rsyslog.d/*.conf ############### #### RULES #### ############### # # First some standard log files. Log by facility. # auth,authpriv.* /var/log/auth.log *.*;auth,authpriv.none -/var/log/syslog #cron.* /var/log/cron.log daemon.* -/var/log/daemon.log kern.* -/var/log/kern.log lpr.* -/var/log/lpr.log mail.* -/var/log/mail.log user.* -/var/log/user.log # # Logging for the mail system. Split it up so that # it is easy to write scripts to parse these files. # mail.info -/var/log/mail.info mail.warn -/var/log/mail.warn mail.err /var/log/mail.err # # Logging for INN news system. # news.crit /var/log/news/news.crit news.err /var/log/news/news.err news.notice -/var/log/news/news.notice # # Some "catch-all" log files. # *.=debug;\ auth,authpriv.none;\ news.none;mail.none -/var/log/debug *.=info;*.=notice;*.=warn;\ auth,authpriv.none;\ cron,daemon.none;\ mail,news.none -/var/log/messages # # Emergencies are sent to everybody logged in. # *.emerg :omusrmsg:* # # I like to have messages displayed on the console, but only on a virtual # console I usually leave idle. # #daemon,mail.*;\ # news.=crit;news.=err;news.=notice;\ # *.=debug;*.=info;\ # *.=notice;*.=warn /dev/tty8 # The named pipe /dev/xconsole is for the `xconsole' utility. To use it, # you must invoke `xconsole' with the `-file' option: # # $ xconsole -file /dev/xconsole [...] # # </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">NOTE:</span></span></span><span class="hljs-comment"> adjust the list below, or you'll go crazy if you have a reasonably # busy site.. # daemon.*;mail.*;\ news.err;\ *.=debug;*.=info;\ *.=notice;*.=warn |/dev/xconsole</span></span></code> </pre><br></div></div><br>  After rebooting, the system will stop logging.  Checking: <br><br><pre> <code class="bash hljs">sudo iotop -o -a</code> </pre> <br>  The output is no longer rsyslog. <br><br>  <b>Disable logging</b> <br><br>  There is a small complexity - the partition must be unmounted.  To do this, you can use: <br><br><ul><li>  another computer with linux </li><li>  another drive as the main one (for example, a regular USB flash drive) </li><li>  another computer + LifeCD with Linux </li></ul><br>  In the case when you have a microSD card - the partition on which the system stands will be defined as mmcblk0p2. <br><br>  Here mmcblk0 is the card itself, and p2 is the second partition on it (the first default is boot).  If you are using a USB drive, then the partition is defined as sda2.  If you boot from another computer, then most likely it is defined as sdb2. <br><br>  Next, perform: <br><br><pre> <code class="bash hljs">sudo umount /dev/sdb2 sudo tune2fs -O ^has_journal /dev/sdb2 sudo e2fsck -f /dev/sdb2</code> </pre> <br>  After that we check: <br><br><pre> <code class="bash hljs">dmesg | grep EXT4</code> </pre> <br>  Issues: <br><br><pre> <code class="bash hljs">[ 5890.967580] EXT4-fs (sdb2): mounted filesystem without journal. Opts: (null)</code> </pre> <br>  Boot from our drive, enter: <br><br><pre> <code class="bash hljs">sudo iotop -o -a</code> </pre> <br>  And we see that LXDE only occasionally refers to the hard disk.  Since these messages are not systematic (we will observe minutes 5-10), we can say that the load on the drive has decreased to almost zero. </div><p>Source: <a href="https://habr.com/ru/post/330160/">https://habr.com/ru/post/330160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330150/index.html">Writing Guard</a></li>
<li><a href="../330152/index.html">How data science helps the development of medicine. Lecture in Yandex</a></li>
<li><a href="../330154/index.html">Run systems without test operation</a></li>
<li><a href="../330156/index.html">The release of the beta version of multi-line TAPI driver for Terminal Services and the announcement of the presentation 3CX v15.5</a></li>
<li><a href="../330158/index.html">How to reduce the number of abandoned baskets in online sales</a></li>
<li><a href="../330162/index.html">Dynamic connection of external native modules and plug-ins in Gradle</a></li>
<li><a href="../330164/index.html">Azure-IaaS-Digest # 16 (May)</a></li>
<li><a href="../330166/index.html">Your brand is at EuroPython 2017</a></li>
<li><a href="../330168/index.html">Old technology in a new way. FreeBSD Jails + CBSD Project</a></li>
<li><a href="../330170/index.html">CNC (SEF URLs) in symfony 3 - slug autogeneration, configuration and routing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>