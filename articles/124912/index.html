<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Chosen drop-down list widget: implement dynamic position adding</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Based on the topic Chosen: make drop-down lists more friendly . 

 Pretty nice widget, sometimes it can even be useful (let's say when there are certa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Chosen drop-down list widget: implement dynamic position adding</h1><div class="post__text post__text-html js-mediator-article">  Based on the topic <a href="http://habrahabr.ru/blogs/javascript/124899/">Chosen: make drop-down lists more friendly</a> . <br><br>  Pretty nice widget, sometimes it can even be useful (let's say when there are certain requirements for the design).  But at the moment the widget will not allow to add positions dynamically, which angered comrade <a href="http://habrahabr.ru/blogs/javascript/124899/">alexsrdk</a> , and me too :) Now let's try to fix this. <br><a name="habracut"></a><br>  Sources are presented in raw form, they were written quickly, I think there is something to refactor, I did not waste time on it, since the article was written for educational purposes, to show an approach to solving the problem (which, incidentally, does not exclude the possibility of practical use). <br><br><h4>  Option with jQuery version </h4><br><h5>  Patch widget code </h5><br>  In the jQuery version I did not find a way to get to the main class of the widget ‚ÄúChosen‚Äù, so I had to patch the main source of the widget for a bit (I understand that this is a bad approach). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      You can come up with a lot of options to get to the Chosen class, I have at least 3 thoughts: <br><ol><li>  Change the custom body of jQuery.fn.chosen function in a similar way <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">$.fn.extend({ <br> chosen: <font color="#0000ff">function</font> (data, options) { <br> <font color="#0000ff">var</font> createdInstances = []; <br> $( <font color="#0000ff">this</font> ).each( <font color="#0000ff">function</font> (input_field) { <br> <font color="#0000ff">if</font> (!($( <font color="#0000ff">this</font> )).hasClass( <font color="#A31515">"chzn-done"</font> )) { <br> createdInstances.push( <font color="#0000ff">new</font> Chosen( <font color="#0000ff">this</font> , data, options)); <br> } <br> }); <br> <font color="#0000ff">return</font> createdInstances; <br> } <br> });</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br></li><li>  You can save the created instance in the item repository. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">$.fn.extend({ <br> chosen: <font color="#0000ff">function</font> (data, options) { <br> <font color="#0000ff">return</font> $( <font color="#0000ff">this</font> ).each( <font color="#0000ff">function</font> (input_field) { <br> <font color="#0000ff">if</font> (!($( <font color="#0000ff">this</font> )).hasClass( <font color="#A31515">"chzn-done"</font> )) { <br> <font color="#0000ff">return</font> $( <font color="#0000ff">this</font> ).data( <font color="#A31515">'chosenInstance'</font> , <font color="#0000ff">new</font> Chosen( <font color="#0000ff">this</font> , data, options)); <br> } <br> }); <br> } <br> });</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  You can get the Chosen object in a similar way. <br> <code><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code></code> <blockquote>  <font color="black"><font color="#0000ff">var</font> createdChosenInstance = $ ( <font color="#A31515">'#bears_multiple'</font> ) .chosen (). data ( <font color="#A31515">'chosenInstance'</font> );</font> <br><br>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br></li><li>  You can make a separate function to get the class <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">$.fn.extend({ <br> chosenClass: <font color="#0000ff">function</font> () { <br> <font color="#0000ff">return</font> Chosen; <br> } <br> });</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br></li></ol><br>  I use the jQuery library very rarely (I mostly work with YUI), with the API at hand, so these options are probably not optimal. <br><br>  In the following code, the third option is used to access the widget class.  Modification of the Chosen class will occur at the prototype level (the methods will be common, that is, changes will affect all newly created class instances).  In principle, it is possible to expand already created objects (obtaining created objects by options 1 or 2), but if the changes should affect all widgets, it is better to work with the prototype. <br><br><h5>  The main code for expanding the functional jQuery version of the widget </h5><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">( <font color="#0000ff">function</font> ($, ChosenClass) { <br> <font color="#0000ff">var</font> dynamicItemInstance; <br> <br> <font color="#0000ff">function</font> DynamicItem(chosenInstance) { <br> $(( <font color="#0000ff">this</font> .chosen = chosenInstance).search_results).parent().prepend( <br> <font color="#0000ff">this</font> .elContainer = $( <font color="#0000ff">document</font> .createElement( <font color="#A31515">'div'</font> ))); <br> <font color="#0000ff">this</font> .elContainer.addClass( <font color="#A31515">'chzn-results-additemcontainer'</font> ); <br> <font color="#0000ff">this</font> .elContainer.append( <font color="#0000ff">this</font> .elButton = $( <font color="#0000ff">document</font> .createElement( <font color="#A31515">'button'</font> ))); <br> <font color="#0000ff">this</font> .elButton.click($.proxy( <font color="#0000ff">this</font> .addNewItem, <font color="#0000ff">this</font> )); <br> } <br> DynamicItem.prototype = { <br> constructor: DynamicItem, <br> show: <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> data = <font color="#0000ff">this</font> .chosen.results_data, <br> text = <font color="#0000ff">this</font> .text, <br> isNotSelected = <font color="#0000ff">true</font> ; <br> <br> <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> .chosen.choices) { <br> ( <font color="#0000ff">this</font> .chosen.search_choices.find( <font color="#A31515">"li.search-choice"</font> ).each( <font color="#0000ff">function</font> (el) { <br> <font color="#0000ff">var</font> itemIdx = <font color="#0000ff">this</font> .id.substr( <font color="#0000ff">this</font> .id.lastIndexOf( <font color="#A31515">"_"</font> ) + 1), <br> item = data[itemIdx]; <br> <br> <font color="#0000ff">if</font> (item.value === text) { <br> isNotSelected = !isNotSelected; <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> })); <br> } <br> <br> <font color="#0000ff">this</font> .elContainer[isNotSelected ? <font color="#A31515">'show'</font> : <font color="#A31515">'hide'</font> ](); <br> }, <br> update: <font color="#0000ff">function</font> (terms) { <br> <font color="#0000ff">if</font> (( <font color="#0000ff">this</font> .text = terms).length) { <br> <font color="#0000ff">this</font> .elButton.text( <font color="#A31515">'Add new item "'</font> + <font color="#0000ff">this</font> .text + <font color="#A31515">'"'</font> ); <br> <font color="#0000ff">this</font> .show(); <br> } <font color="#0000ff">else</font> { <br> <font color="#0000ff">this</font> .elContainer.hide(); <br> } <br> }, <br> addNewItem: <font color="#0000ff">function</font> (terms) { <br> <font color="#0000ff">this</font> .chosen.form_field.options.add( <font color="#0000ff">new</font> Option( <font color="#0000ff">this</font> .text, <font color="#0000ff">this</font> .text)); <br> <font color="#0000ff">this</font> .chosen.form_field_jq.trigger( <font color="#A31515">'liszt:updated'</font> ); <br> <font color="#0000ff">this</font> .chosen.result_highlight = <font color="#0000ff">this</font> .chosen.search_results.children().last(); <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> .chosen.result_select(); <br> } <br> }; <br> <br> $.extend(ChosenClass.prototype, { <br> no_results: ( <font color="#0000ff">function</font> (fnSuper) { <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> (terms) { <br> (dynamicItemInstance || (dynamicItemInstance = <font color="#0000ff">new</font> DynamicItem( <font color="#0000ff">this</font> ))).update(terms); <br> <font color="#0000ff">return</font> fnSuper.call( <font color="#0000ff">this</font> , terms); <br> }; <br> })(ChosenClass.prototype.no_results), <br> results_hide: ( <font color="#0000ff">function</font> (fnSuper) { <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> () { <br> dynamicItemInstance &amp;&amp; dynamicItemInstance.elContainer.hide(); <br> <font color="#0000ff">return</font> fnSuper.call( <font color="#0000ff">this</font> ); <br> }; <br> })(ChosenClass.prototype.results_hide), <br> winnow_results_set_highlight: ( <font color="#0000ff">function</font> (fnSuper) { <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> () { <br> dynamicItemInstance &amp;&amp; dynamicItemInstance.elContainer.hide(); <br> <font color="#0000ff">return</font> fnSuper.apply( <font color="#0000ff">this</font> , arguments); <br> }; <br> })(ChosenClass.prototype.winnow_results_set_highlight) <br> }); <br> })(jQuery, jQuery.fn.chosenClass()); <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Having a little analyzed the source code of the widget, I figured out how to implement dynamic position adding.  Chosen methods are redefined using closures, the functionality of adding a position in a separate class.  Of course, if necessary, you can replace the button with a link, add CSS styles (the marking class to the button block is installed) and so on. <br><br>  <a href="http://jsfiddle.net/X8bmt/2/embedded/result/">Demo</a> <br><br><h4>  Option with Prototype version </h4><br>  In the Prototype version of the widget, the Chosen class is available globally (window.Chosen) so there was nothing to patch. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">( <font color="#0000ff">function</font> (Chosen) { <br> <font color="#0000ff">var</font> dynamicItemInstance; <br> <br> <font color="#0000ff">function</font> DynamicItem(chosenInstance) { <br> ( <font color="#0000ff">this</font> .chosen = chosenInstance).search_results.up().insert({ <br> top: <font color="#0000ff">this</font> .elContainer = $( <font color="#0000ff">document</font> .createElement( <font color="#A31515">'div'</font> )) <br> }); <br> <font color="#0000ff">this</font> .elContainer.addClassName( <font color="#A31515">'chzn-results-additemcontainer'</font> ); <br> <font color="#0000ff">this</font> .elContainer.insert( <font color="#0000ff">this</font> .elButton = $( <font color="#0000ff">document</font> .createElement( <font color="#A31515">'button'</font> ))); <br> Event.observe( <font color="#0000ff">this</font> .elButton, <font color="#A31515">'click'</font> , <font color="#0000ff">this</font> .addNewItem.bind( <font color="#0000ff">this</font> )); <br> } <br> DynamicItem.prototype = { <br> constructor: DynamicItem, <br> show: <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> data = <font color="#0000ff">this</font> .chosen.results_data, <br> text = <font color="#0000ff">this</font> .text, <br> isNotSelected = <font color="#0000ff">true</font> ; <br> <br> <font color="#0000ff">if</font> ( <font color="#0000ff">this</font> .chosen.choices) { <br> ( <font color="#0000ff">this</font> .chosen.search_choices.select( <font color="#A31515">"li.search-choice"</font> ).each( <font color="#0000ff">function</font> (el) { <br> <font color="#0000ff">var</font> itemIdx = el.id.substr(el.id.lastIndexOf( <font color="#A31515">"_"</font> ) + 1), <br> item = data[itemIdx]; <br> <br> <font color="#0000ff">if</font> (item.value === text) { <br> isNotSelected = !isNotSelected; <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> })); <br> } <br> <br> <font color="#0000ff">this</font> .elContainer[isNotSelected ? <font color="#A31515">'show'</font> : <font color="#A31515">'hide'</font> ](); <br> }, <br> update: <font color="#0000ff">function</font> (terms) { <br> <font color="#0000ff">if</font> (( <font color="#0000ff">this</font> .text = terms).length) { <br> <font color="#0000ff">this</font> .elButton.update( <font color="#A31515">'Add new item "'</font> + <font color="#0000ff">this</font> .text + <font color="#A31515">'"'</font> ); <br> <font color="#0000ff">this</font> .show(); <br> } <font color="#0000ff">else</font> { <br> <font color="#0000ff">this</font> .elContainer.hide(); <br> } <br> }, <br> addNewItem: <font color="#0000ff">function</font> (terms) { <br> <font color="#0000ff">this</font> .chosen.form_field.options.add( <font color="#0000ff">new</font> Option( <font color="#0000ff">this</font> .text, <font color="#0000ff">this</font> .text)); <br> Event.fire( <font color="#0000ff">this</font> .chosen.form_field, <font color="#A31515">"liszt:updated"</font> ); <br> <font color="#0000ff">this</font> .chosen.result_highlight = <font color="#0000ff">this</font> .chosen.search_results.childElements().pop(); <br> <font color="#0000ff">return</font> <font color="#0000ff">this</font> .chosen.result_select(); <br> } <br> }; <br> <br> Chosen.prototype.no_results = ( <font color="#0000ff">function</font> (fnSuper) { <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> (terms) { <br> (dynamicItemInstance || (dynamicItemInstance = <font color="#0000ff">new</font> DynamicItem( <font color="#0000ff">this</font> ))).update(terms); <br> <font color="#0000ff">return</font> fnSuper.call( <font color="#0000ff">this</font> , terms); <br> }; <br> })(Chosen.prototype.no_results); <br> Chosen.prototype.results_hide = ( <font color="#0000ff">function</font> (fnSuper) { <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> () { <br> dynamicItemInstance &amp;&amp; dynamicItemInstance.elContainer.hide(); <br> <font color="#0000ff">return</font> fnSuper.call( <font color="#0000ff">this</font> ); <br> }; <br> })(Chosen.prototype.results_hide); <br> Chosen.prototype.winnow_results_set_highlight = ( <font color="#0000ff">function</font> (fnSuper) { <br> <font color="#0000ff">return</font> <font color="#0000ff">function</font> () { <br> dynamicItemInstance &amp;&amp; dynamicItemInstance.elContainer.hide(); <br> <font color="#0000ff">return</font> fnSuper.apply( <font color="#0000ff">this</font> , arguments); <br> }; <br> })(Chosen.prototype.winnow_results_set_highlight); <br> })(window.Chosen); <br> <br> <font color="#0000ff">new</font> Chosen($( <font color="#A31515">'bears_multiple'</font> )); <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  <a href="http://jsfiddle.net/WKzCh/3/embedded/result/">Demo</a> <br><br><h4>  Remarks </h4><br>  In the place of the widget's author, I would implement a common kernel (instead of separate versions for Prototype / jQuery / Mootools).  From libraries I would use only the most necessary methods, through a wrapper (interface).  The purpose of this is to have one (common) version of the main widget code.  Now, with the current approach of forks under different frameworks, I do not see much point in committing something on github. <br><br>  Thanks to all those who have put in karma, this allowed us to publish the article. </div><p>Source: <a href="https://habr.com/ru/post/124912/">https://habr.com/ru/post/124912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124905/index.html">Invitation to international research for gamers</a></li>
<li><a href="../124907/index.html">World of Warcraft - a game or a digital drug?</a></li>
<li><a href="../124909/index.html">Comparison of memory consumption for different data storage structures</a></li>
<li><a href="../124910/index.html">Introduction to cycle optimization techniques</a></li>
<li><a href="../124911/index.html">Imperavi: a convenient and really beautiful JS WYSIWYG editor</a></li>
<li><a href="../124913/index.html">MLAA morphological smoothing algorithm for CPU</a></li>
<li><a href="../124915/index.html">Runkit + PHPUnit = 100% test coverage</a></li>
<li><a href="../124916/index.html">GarageBand - What an almost amateur can ‚Äúwrite‚Äù in 8 minutes</a></li>
<li><a href="../124921/index.html">Psychological mistakes startups</a></li>
<li><a href="../124924/index.html">There are personal messages on Google+, but not everyone knows about it.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>