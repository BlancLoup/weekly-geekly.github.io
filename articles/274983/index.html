<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making a wireless network bridge for 2 Mikrotik</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Situation: on the Mikrotik, different grids have their own grids: 


- ether2 - 192.168.2.0/24 
- ether3 - 192.168.3.0/24 
- ether4 - 192.168.4.0/24 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making a wireless network bridge for 2 Mikrotik</h1><div class="post__text post__text-html js-mediator-article">  Situation: on the Mikrotik, different grids have their own grids: <br><ul><li>  ether2 - 192.168.2.0/24 </li><li>  ether3 - 192.168.3.0/24 </li><li>  ether4 - 192.168.4.0/24 </li><li>  ether5 - 192.168.5.0/24 </li><li>  wlan0 - 192.168.10.0/24 </li></ul><br><br>  In these networks Mikrotik (model RB751G-2HnD) distributes the settings via DHCP. <br><br>  Task: using Wi-Fi to connect more equipment so that it is on the network 192.168.3.0/24. <br>  I have such a problem due to the fact that on the balcony of the network storage (NAS) is connected by wire to the router (the router itself is in the hallway).  And in the living room - a media player that should show movies from a NAS device.  But there is no Ethernet cable in the living room (that is, it was, but I refused it). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For this we will use the second Mikrotik (model hAP lite).  Both Mikrotik will form a wireless network bridge.  To do this, on the main Mikrotik we will create another wireless interface - a virtual access point (Virtual AP).  As a result, the scheme should get something like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/41a/5e9/95d/41a5e995de044da5b9bf1190ef6114ae.png"></div><br><br>  Those.  In this scheme, the NAS and Comp hardware must be on the 192.168.3.0/24 network.  In this case, NAS and Comp are physically separated and connected to different Mikrotik. <br>  ether1 on the primary Mikrotik is the source of the internet. <br><br>  At the end of the setting, the average speed between microtices for 5 minutes was 220 Mbps (according to the ping test utility, included in RouterOS): <br><div style="text-align:center;"><img src="https://habrastorage.org/files/e57/6aa/e8b/e576aae8bc2d4bb98a6170a42e7c26d8.png"></div><br><br><a name="habracut"></a><br><br>  Hereinafter, the Comp and the media player are the same. <br><br>  All settings were made through the web administration interface (webfig). <br><br><h1>  Creating VirtualAP on RB751G-2HnD </h1><br><br>  As mentioned above, the RB751G-2HnD is initially configured to distribute different subnets on different physical ports.  I will not consider this in detail.  It is <a href="http://www.securitylab.ru/contest/448565.php">already described here</a> . <br><br>  On RB751G-2HnD we will create and configure VirtualAP. <br>  Go to the section <b>Wireless-&gt; Security Profiles</b> and click the <b>Add New</b> button.  We set the profile name and password for our future virtual access point. <br>  The second router (hAP Lite) is in the living room.  It is for him that the network is created.  Therefore, I called the profile gostinnaya: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ef4/135/e37/ef4135e37365413086cc7042faa8b367.png"></div><br><br>  Next, create the virtual access point itself.  To do this, go to <b>Wireless-&gt; Interfaces</b> and select <b>Add New-&gt; VirtualAP.</b> Specify the previously created profile and set the wizard interface by the name of an existing wireless adapter (mine is wlan1). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8f2/568/527/8f256852778f4a30bd35f74154474e56.png"></div><br><br>  After that, the gostinnaya virtual interface will appear in the list of wireless interfaces besides <b>wlan1</b> . <br><br><h1>  Bridge configuration on RB751G-2HnD between VirtualAP and Ethernet </h1><br><br>  We need to make a network bridge consisting of interfaces: <br><br><ol><li>  ether3 </li><li>  gostinnaya </li></ol><br><br>  To do this, in the <b>Bridge</b> section, click <b>Add New</b> and fill in the parameters.  NAS is on the balcony, so I called the network interface <b>bridge_balcon and gostinnaya_wi-fi</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/6d8/9ce/573/6d89ce5730124b62a7d33a15de8f5c8a.png"></div><br><br>  After that, we will have a new virtual interface (I have this <b>bridge_balcon and gostinnaya_wi-fi</b> ). <br><br>  Now you need to assign which real interfaces will be associated with the created bridge.  Go to <b>Bridge-&gt; Ports</b> , click <b>Add New</b> .  Select the desired Ether (I have <b>ether3-slave-local</b> ).  Click <b>Add New</b> again and select the previously created VirtualAP interface (I have a <b>gostinnaya</b> ).  Now both selected interfaces will be displayed in the <b>Ports</b> tab. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/278/6ce/549/2786ce549ddc421481088fcb2e745cbc.png"></div><br><br>  Setup on RB751G-2HnD is completed. <br><br><h1>  HAP Lite setup </h1><br><br>  I set up hAP Lite so that any equipment connected to any Ethernet port would be on the 192.168.3.0/24 network.  Those.  I need to create a network bridge consisting of all Ethernet ports + wireless connection (through which hAP Lite will connect to the RB751G-2HnD).  So  hAP Lite turns into a switch.  And it will have its address in the grid 192.168.3.0/24. <br><br>  HAP Lite had factory settings that need to be changed. <br><br>  In <b>IP-&gt; Firewall-&gt; NAT we</b> deactivate the network masquerading rule <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/616/b09/dd0/616b09dd0c4c4eb4b7ff74a24e013eab.png"></div><br><br>  In <b>IP-&gt; DHCP Server-&gt; DHCP, we</b> delete (or make inactive) the default distribution setting by DHCP: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f98/27a/052/f9827a0523824beb833d96c2dcb8b33e.png"></div><br><br>  Now you need to configure getting the address itself hAP Lite from his relative (RB751G-2HnD) via DHCP.  In <b>IP-&gt; DHCP Client-&gt; DHCP Client,</b> click <b>Add New</b> and set the interface of the network bridge (I have bridge-local). <br><br>  Ether1 is not yet included in the network bridge - this is the factory setting.  You can add it like this.  Go to <b>Interfaces</b> , click on Ether1 and in the <b>Master Port</b> field select <b>ether2-master-local</b> <br><br><h1>  Connect hAP Lite to RB751G-2HnD via Wi-Fi </h1><br><br>  Setup in <b>Wireless-&gt; Security Profiles is</b> done in the same way as on RB751G-2HnD.  After that, in the <b>Wireless-&gt; Interfaces</b> tab, configure the existing wireless interface (I have <b>wlan1</b> ): <br><div style="text-align:center;"><img src="https://habrastorage.org/files/f42/552/b3c/f42552b3c1d74308a238a6610646cbdf.png"></div><br><br>  If everything is set correctly, then after setting up here you will see the line ‚Äúconnected to ess‚Äù. <br><br>  Next in <b>Bridge-&gt; Ports</b> , click <b>Add New</b> and select the newly configured wireless interface (I have <b>wlan1</b> ) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f7b/e87/e5c/f7be87e5c5504a02a132bc924580997a.png"></div><br><br>  At the same time, on MikroTik hap Lite, to the existing default bridge-local (which was created by pressing the reset on the device to reset to the default settings) added wlan1 and removed the DHCP server. <br><br>  On hAP in wlan1 settings, change Mode from ‚Äústation‚Äù to ‚ÄúStation bridge‚Äù or ‚ÄúStation pseudobridge‚Äù.  Both options work. <br><br>  Hap Lite network bridge tinctures: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/59e/906/ecc/59e906ecc97f48ceb120bb7200af7d2c.PNG"></div><br><br>  As a result, the equipment correctly received the settings via DHCP from the network 192.168.3.0/24.  NAS and Comp see each other perfectly. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2bf/2dc/2de/2bf2dc2defec4ca984b7403a9e1cadcf.png"></div><br><br>  At the time of settings on all Mikrotik was firmware RouterOS 6.29.1.  The configuration feels great on RouterOS 6.33.5 (the latest currently available). <br><br><h1>  Performance tests (version RouterOS 6.33.5 on both devices) </h1><br>  As I pointed out at the very beginning, the average speed between microtices for 5 minutes was 220 Mbit / s (according to the ping test utility. Let me give you a few more figures. All the tests took place without an uncontrolled switch, which is shown in the very first figure. <br><br>  Average speed between RB751G-2HnD and equipment for hAP lite (media player): 54 Mbit / s.  It would seem - a serious drop in speed during transit through hAP lite.  In fact, not everything is so bad: the hAP lite Ethernet port in the settings shows a speed of 100 Mbps.  The speed between the hAP lite and the equipment behind it ((media player) is 85 Mbit / s. Maybe someone will not be satisfied with such a drop in speed. But this channel is enough for me, so that the media player shows movies from NAS, which average size is 30-45 GB . <br><br>  <b>UPD</b> <br>  This was my first experience of creating a wireless bridge, not only on Mikrotik, but in principle.  And the first time I was close to the working solution.  An annoying nuance intervened, taking a lot of time and nerves.  hAP in the wlan1 settings, the Mode position was set to ‚Äústation‚Äù.  After I changed to ‚ÄúStation bridge‚Äù or ‚ÄúStation pseudobridge‚Äù everything was fixed.  Read more <a href="https://toster.ru/q/224882">about the problem and its manifestation here</a> . </div><p>Source: <a href="https://habr.com/ru/post/274983/">https://habr.com/ru/post/274983/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274967/index.html">Monitoring SSL certificate and domain expiration</a></li>
<li><a href="../274975/index.html">Monte Carlo method and its accuracy</a></li>
<li><a href="../274977/index.html">HL7 C-CDA Rendering Tool Challenge (competition from HL7)</a></li>
<li><a href="../274979/index.html">How method scheduling in Ruby works</a></li>
<li><a href="../274981/index.html">Microsoft and Adobe have fixed vulnerabilities in their products.</a></li>
<li><a href="../274985/index.html">I knew how to validate an email address. Not yet read the RFC</a></li>
<li><a href="../274987/index.html">By the year 2060, programmers will not be needed</a></li>
<li><a href="../274989/index.html">IBM Watson improves its cognitive abilities and offers new opportunities for developers.</a></li>
<li><a href="../274995/index.html">My approach to Class Based Views</a></li>
<li><a href="../274997/index.html">We write a simple RESTful service on kotlin and spring boot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>