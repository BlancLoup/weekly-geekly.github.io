<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Software capture from webcam</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I needed to receive data from a webcam for automatic processing. After going through several programs, I found that none of them allows the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Software capture from webcam</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/b9b/b9e/edd/b9bb9eedd2d7f33fb0fcae4556542a35.png" align="left">  Recently, I needed to receive data from a webcam for automatic processing.  After going through several programs, I found that none of them allows the camera to steer the program programmatically - only forms and buttons, at best there is a recording scheduler, but for this you have to keep the program running all the time.  Plus is not cross-platform, binding to specific software in the project.  The solution is to use your favorite programming language. <br><a name="habracut"></a><br><br>  So, we have a webcam and a python.  First of all, one cannot fail to praise the camera that I purchased at <a href="http://www.dealextreme.com/p/compact-usb-pc-webcam-300k-pixel-25948">dealextreme</a> : a baby about half the size of a matchbox, works in Windows and Linux without installing third-party software (checked in Win 7 and Mint 13, turned on - and went), acceptable quality and price.  When working, the camera does not present itself as burning indicators or other effects.  Small sizes contribute to its inconspicuous installation. <br><img src="https://habrastorage.org/storage2/74f/f44/536/74ff445367160982840f51574dda17d8.jpg"><br><br>  Since I work in both Windows and Linux, the solution should satisfy both OSs.  The library of computer vision OpenCV and its binding for Python will help.  An alternative solution could be <a href="http://ru.wikipedia.org/wiki/Video4Linux">video4linux</a> .  But, firstly, it was interesting for me to learn OpenCV, and secondly, about using v4l was already a <a href="http://habrahabr.ru/post/115661/">great habstatia</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Install the numpy and opencv libraries.  Linux users open a terminal and write: <br><br><pre><code class="hljs sql">sudo apt-get <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> python-numpy sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> python-opencv</code> </pre> <br><br>  Those who are under Windows <a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">go here</a> and extort the <a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">numpy</a> and <a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/">opencv</a> distributions under the desired version of Python. <br><br>  For Windows there is an alternative method of installation.  Enough to download the <a href="http://sourceforge.net/projects/opencvlibrary/files/">official distribution of the</a> library.  In the archive we find /build/python/2.x/cv2.pyd.  We throw it in site-packages.  In the same place we create a file cv.py with the contents: <br><br><pre> <code class="hljs swift">from cv2.cv <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> *</code> </pre><br><br>  All is ready.  Test import: <br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv</code> </pre><br><br>  We will use part of the library called <a href="http://opencv.willowgarage.com/documentation/python/highgui_reading_and_writing_images_and_video.html">higui</a> .  We start the experiments.  Trial ball - getting the frame and writing it to the file: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv capture = cv.CaptureFromCAM(0) frame = cv.QueryFrame(capture) cv.SaveImage("capture.jpg", frame)</code> </pre><br><br>  The <a href="http://opencv.willowgarage.com/documentation/python/highgui_reading_and_writing_images_and_video.html">CaptureFromCAM</a> function creates an object from which the capture will occur.  0 is the device index, it can be greater than zero if there are several cameras.  A value of -1 carries the meaning of ‚Äúany available camera.‚Äù <br><br>  Now you can start frame collection in a loop.  It would be great if the frames will be displayed along the way in a separate window: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv capture = cv.CaptureFromCAM(<span class="hljs-number"><span class="hljs-number">-1</span></span>) cv.NamedWindow("capture", cv.CV_WINDOW_AUTOSIZE) i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: frame = cv.QueryFrame(capture) cv.ShowImage("capture", frame) cv.WaitKey(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-type"><span class="hljs-type">path</span></span> = "capture%.4d.jpg" % i #      cv.SaveImage(<span class="hljs-type"><span class="hljs-type">path</span></span>, frame) i += <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br><br>  The <a href="http://opencv.willowgarage.com/documentation/python/highgui_user_interface.html%3Fhighlight%3Dnamedwindow">NamedWindow</a> function creates and displays a window in which it is output in a loop each frame.  The <a href="http://opencv.willowgarage.com/documentation/python/highgui_user_interface.html%3Fhighlight%3Dwaitkey">WaitKey</a> handler sets the delay in milliseconds for handling window events, such as pressing a key or displaying an image.  If you omit it, the window will not display frames (and, possibly, will not appear at all). <br><br><img src="https://habrastorage.org/storage2/127/ded/43d/127ded43d8f8da0fd35e2e38b62a2445.jpg"><br>  <i>Capture frames in action.</i>  <i>The camera looks at the monitor, so a recursion occurs - a deckstop, inside of which is a desktop, inside of which ...</i> <br><br>  Collecting multiple frames is useful when you need to insert a time pause between snapshots, for example, 1 frame every minute.  It is enough to substitute time.sleep (60) into the loop. <br><br>  If continuous shooting is required, you need to record frames in a video stream. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv capture = cv.CaptureFromCAM(<span class="hljs-number"><span class="hljs-number">-1</span></span>) fourcc = cv.CV_FOURCC(<span class="hljs-string"><span class="hljs-string">'M'</span></span>,<span class="hljs-string"><span class="hljs-string">'J'</span></span>,<span class="hljs-string"><span class="hljs-string">'P'</span></span>,<span class="hljs-string"><span class="hljs-string">'G'</span></span>) fps = <span class="hljs-number"><span class="hljs-number">16</span></span> w, h = <span class="hljs-number"><span class="hljs-number">640</span></span>, <span class="hljs-number"><span class="hljs-number">480</span></span> stream = cv.CreateVideoWriter("test.avi", fourcc, fps, (w, h)) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: frame = cv.QueryFrame(capture) cv.WriteFrame(stream, frame)</code> </pre><br><br>  At first glance, everything is also obvious here: the <a href="http://opencv.willowgarage.com/documentation/python/highgui_reading_and_writing_images_and_video.html%3Fhighlight%3Dcreatevideowriter">CreateVideoWriter</a> function creates a stream to which frames are written.  It is enough to interrupt the cycle to get the finished video file.  However, you should understand the input parameters. <br><br>  <b>fourcc</b> is a codec, an integer, the result of mapping a four- <b>character</b> codec name to a numeric index.  For example, CV_FOURCC ('P', 'I', 'M,' 1 ') is MPEG-1 compression.  In Windows, you can pass -1 for selecting the codec interactively in the dialog box or 0 for recording without compression (the file size will turn out th!).  Habrawar <a href="https://habrahabr.ru/users/elsedar/" class="user_link">Elsedar</a> tells you where to see the full list of codecs: <a href="http://www.fourcc.org/codecs.php">www.fourcc.org/codecs.php</a> <br><br>  <b>fps</b> is the frame rate per second.  The parameter directly depends on the model of your camera.  At this point, the real state of affairs went against the documentation.  It is believed that the recording parameters should not be set by eye, but in an exact way, for which the <a href="http://opencv.willowgarage.com/documentation/python/highgui_reading_and_writing_images_and_video.html%3Fhighlight%3Dcreatevideowriter">GetCaptureProperty</a> function <a href="http://opencv.willowgarage.com/documentation/python/highgui_reading_and_writing_images_and_video.html%3Fhighlight%3Dcreatevideowriter">serves</a> .  It can get device parameters for correct initialization of capture.  But if the height and width of the frame are retrieved without problems, then getting fps: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">fps</span></span> = cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FPS)</code> </pre><br><br>  returns -1, which will not satisfy the CreateVideoWriter function, so the frequency is chosen empirically.  As a rule, for most cameras it ranges from 14 to 16 frames per second.  If you set 25, the resulting file will resemble a silent movie of the 20s. <br><br>  The last parameter of <b>frame_size</b> is a pair of integer numbers of the height and width of the frame.  To use the camera settings, initialize them as follows: <br><br><pre> <code class="hljs objectivec">w = cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_WIDTH) h = cv.GetCaptureProperty(capture, cv.CV_CAP_PROP_FRAME_HEIGHT) w, h = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(w), <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(h) <span class="hljs-meta"><span class="hljs-meta">#     float</span></span></code> </pre><br><br>  Now you can touch on the theme of color correction.  If the output frames do not suit you, it is quite reasonable to correct the capture parameters, rather than batching overtaking the mountains of dzhipegov or hours of video.  To set the parameters there is a function <a href="http://opencv.willowgarage.com/documentation/python/highgui_reading_and_writing_images_and_video.html%3Fhighlight%3Dcvgetcaptureproperty">SetCaptureProperty</a> .  It is convenient to fill in several properties by searching the dictionary: <br><br><pre> <code class="hljs cs">config = { cv.CV_CAP_PROP_BRIGHTNESS: <span class="hljs-number"><span class="hljs-number">50</span></span>, cv.CV_CAP_PROP_CONTRAST: <span class="hljs-number"><span class="hljs-number">50</span></span>, cv.CV_CAP_PROP_SATURATION: <span class="hljs-number"><span class="hljs-number">50</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> param, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> config.iteritems(): cv.SetCaptureProperty(capture, param, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)</code> </pre><br><br>  The parameters of brightness, contrast and saturation are set in the range from 1 to 100. Their combination can significantly improve the quality of shooting in darkened rooms. <br><br>  A few examples: <br><br><img src="https://habrastorage.org/storage2/eca/71f/389/eca71f389e152ec75592a1922cfe5d2f.jpg"><br>  <i>Frame with default parameters</i> <br><br><img src="https://habrastorage.org/storage2/0b8/51e/5ba/0b851e5bae915522722a10d9f428b002.jpg"><br>  <i>Brightness, contrast and saturation equal to 50 points.</i> <br><br><img src="https://habrastorage.org/storage2/6d2/232/c1c/6d2232c1c0c0cb32019e12e945064a56.jpg"><br>  <i>Brightness 50, contrast 70, saturation 0</i> <br><br>  It so happens that the frames from the camera need to be processed by the library PIL.  To convert them from cv format to PIL, it is not necessary to save them to disk, just run the code: <br><br><pre> <code class="hljs lua">pil_img = Image.fromstring(<span class="hljs-string"><span class="hljs-string">"L"</span></span>, cv.GetSize(frame), frame.<span class="hljs-built_in"><span class="hljs-built_in">tostring</span></span>())</code> </pre><br><br>  And in the opposite direction: <br><br><pre> <code class="hljs matlab">cv_img = cv.CreateImageHeader(pil_img.<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>, cv.IPL_DEPTH_8U, <span class="hljs-number"><span class="hljs-number">3</span></span>) cv.SetData(cv_img, pil_img.tostring())</code> </pre><br><br>  As a result, we have programmatic access to the camera, we can take shots and send them by mail, do some kind of analysis, write video.  Cross platform solution.  I think it is easy to stream.  Here, by the way, the program with the GUI interface on wx by itself, for example, suggests. <br><br>  References: <br><br>  <a href="http://opencvlibrary.sourceforge.net/">1)</a> OpenCV library <br>  <a href="http://opencv.willowgarage.com/documentation/python/index.html">2)</a> Binding documentation for Python <br>  <a href="http://opencv.willowgarage.com/documentation/python/highgui__high-level_gui_and_media_i_o.html">3)</a> Section "highgui" </div><p>Source: <a href="https://habr.com/ru/post/148692/">https://habr.com/ru/post/148692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148686/index.html">In the beginning was the Word</a></li>
<li><a href="../148688/index.html">Writing PHP programs using fork ()</a></li>
<li><a href="../148689/index.html">Linux - WiFi Starting Script</a></li>
<li><a href="../148690/index.html">The design of the first iPhone was ‚Äúborrowed‚Äù from Sony</a></li>
<li><a href="../148691/index.html">Acer Aspire M3 Ultra - Unusual Ultrabook Review</a></li>
<li><a href="../148693/index.html">OAuth 2.0 editor asked to cross out your name from specifications</a></li>
<li><a href="../148695/index.html">Warsow 1.0</a></li>
<li><a href="../148697/index.html">Traffic monetization: make more money online!</a></li>
<li><a href="../148698/index.html">Winter holidays with benefits</a></li>
<li><a href="../148700/index.html">2GIS Online and API updates: search tips and more</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>