<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Python PID Controller Model</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Looking for a simple PID controller model with an object 
 A large number of publications in the network are devoted to modeling the operation of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Python PID Controller Model</h1><div class="post__text post__text-html js-mediator-article"><h3>  Looking for a simple PID controller model with an object </h3><br>  A large number of publications in the network are devoted to modeling the operation of the PID controller.  Leading the design of PID controller models using Matlab Simulink [1,2] (134 million links in yandex).  The process of creating a model is some kind of uniform.  All new and new blocks are transferred to the model.  One movement of the manual manipulator and here you are a PID controller, another one and that is the transfer function of the object.  You connect the blocks, adjust the parameters, prepare the calculator.  Yes, there are many possibilities, but somehow everything is too artificial.  And it becomes completely incomprehensible to what here the differential equations, the methods for their solution and the operational calculus with which they have long wondered.  I am looking for the implementation of the PID in Mathcad, there are links in the same yandex, smaller, only 81 million, and more mathematics and formulas.  I look at the PID example that comes with the Mathcad 14 package. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/dbc/ab1/e5d/dbcab1e5d39444598f563262f706a209.png"></div><br>  As an object oscillatory link.  Many clever explanations, but as a result two operators laplace and invlaplace.  The total transfer function is in the numerator of the second degree of the operator, and in the denominator of the fourth.  In order for the laplace and invlaplace operators to work when all three components of the PID are connected, the roots of the denominator of the transfer function are also found, these roots are complexly conjugate. <br><br><img src="https://habrastorage.org/web/d7c/84b/774/d7c84b7743244d988ae1e5c4f2197410.PNG">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now looking for a PID implementation in Python.  Quietly rejoiced at 97 million results, but not for long.  About Python 2.7 only in relation to the Arduino firmware on the example of ESP32.  But this also overwhelms the heart with pride in Python. <br><br>  Disappointed in the search, I decided to write the model myself, to the best of my more than modest possibilities. <br><a name="habracut"></a><br><h3>  Structural diagram of the control object </h3><br>  I took the formulation of the problem from [3], in it I was attracted by the variety of the structure of the object of regulation.  In the course corrected several errors.  So, in the final differential equation the square was lost at T2, the tables for a2 did not correspond to the results of the approximation.  In addition, he introduced the control setup in the form of a single infinite impulse to liven up the image of the transition process.  It is somehow not natural for the PID controller, it looks in [3]. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/d0b/6d1/f1a/d0b6d1f1a01a4d72a8a11316e2da37ce.JPG"></div><br>  We will explore the regulatory system with the following structural scheme. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/f75/82d/f3b/f7582df3b15545f2a6b460f0da428897.PNG"></div><br><ol><li>  Oscillatory link [4] is described by a differential equation of the second order. <img src="https://habrastorage.org/web/13f/58b/ba4/13f58bba4c0c4a3987187d39e100c14f.JPG"></li><li>  Linear static link, determining the dependence of the output on the input of which is determined by tabular data.  Data can be obtained experimentally.  Due to the inaccuracies in the data removal, linear approximation should be applied. <img src="https://habrastorage.org/web/517/a6f/b5c/517a6fb5cd5e497f96dcbc504b15449b.JPG">  . </li><li>  The second linear static link - the dependence of the output on the input is determined by tabular data, which can be obtained experimentally. Due to the errors in the data being removed, a linear approximation should be applied <img src="https://habrastorage.org/web/12d/bb8/b44/12dbb8b44ace462ebd7f3165d5ae28a3.JPG">  . </li><li>  Linear dynamic link, the input of which receives the sum of signals from blocks 2,3 <img src="https://habrastorage.org/web/b2a/b7a/8fe/b2ab7a8fe59d494db3f2d67ad0076177.JPG"><br>  The link has a transfer function, which is described by a linear differential equation of the first order. <br><img src="https://habrastorage.org/web/02e/d87/8e2/02ed878e256b4a2ea2a660c3a074d0df.JPG"></li><li>  PID controller with a known regulation law, in which the proportionality factor is used to tune the object of regulation <img src="https://habrastorage.org/web/716/f6c/847/716f6c84700742cf9cb889035dd77cbd.JPG">  with linear function, the coefficient of differentiation <img src="https://habrastorage.org/web/612/6f6/275/6126f6275d424d439a027fde6f152a26.JPG">  with the first derivative and the integration coefficient <img src="https://habrastorage.org/web/2be/952/e4c/2be952e4cfef44e096c8894f4a5b98e3.JPG">  with indefinite integral. <br><img src="https://habrastorage.org/web/74e/a21/316/74ea213168544411a76130104a78e854.JPG"></li></ol><br><br>  A single input action 1 (t) is converted into an operator form as 1 / <i>p</i> .  We translate into an operator form of the equation 1.4 as a result we get. <br><br><img src="https://habrastorage.org/web/935/95e/3f0/93595e3f0f724f26a16534b616caea01.JPG"><br><br>  Differentiate both sides of (5), for this we simply multiply by the operator p, we get. <br><br><img src="https://habrastorage.org/web/b07/465/1c6/b074651c603245fe823c5946b3bcfec5.JPG"><br><br>  We translate equation (2), (3) into an operator form and express y (y1). <br><br><img src="https://habrastorage.org/web/48d/c4b/3af/48dc4b3af1bd4ddf9dd892132b7d98ed.JPG"><br><br>  Substitute (7) in (6) we get: <br><br><img src="https://habrastorage.org/web/0da/cf8/dad/0dacf8dadbf54ea58d4c0f11156e7198.JPG"><br><br>  Let us move (8) into the time domain; for this, we replace the operator form with a differential equation. <br><br><img src="https://habrastorage.org/web/1f8/04f/f1a/1f804ff1a87941979a8a64479843c5f1.JPG"><br><br><h3>  Solving the problem of determining the PID controller settings in Python </h3><br>  Set the following parameters of the control object: <br>  T1 = 7.0;  T2 = 5.0;  s = 0.4;  k1 = 5.5;  k2 = 5.5.  The data for the approximation of the characteristics of links 2,3 are summarized in the table. <br><br><img src="https://habrastorage.org/web/3f0/896/132/3f089613236642b885989aaa125d17fd.JPG"><br><br>  Let us set aside an object without a regulator, for this we accept <img src="https://habrastorage.org/web/634/4ce/140/6344ce1404124da9a07051a9d564267e.JPG">  . <br><br><div class="spoiler">  <b class="spoiler_title">Program code</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python # -*- coding: utf-8 -*- import numpy as np from scipy.integrate import odeint import matplotlib.pyplot as plt def mnkLIN(x,y,q): #      a=round((len(x)*sum([x[i]*y[i] for i in range(0,len(x))])-sum(x)*sum(y))/(len(x)*sum([x[i]**2 for i in range(0,len(x))])-sum(x)**2),3) b=round((sum(y)-a*sum(x))/len(x) ,3) y1=[round(a*w+b ,3) for w in x] s=[round((y1[i]-y[i])**2,3) for i in range(0,len(x))] sko=round((sum(s)/(len(x)-1))**0.5,3) if q==1: plt.subplot(221) plt.plot(x, y, color='r', linewidth=2, marker='o', label=' a= %s'%str(a)) plt.plot(x, y1, color='g', linestyle=' ', marker='o', label=' =%s'%str(sko)) plt.legend(loc='best') plt.grid(True) else: plt.subplot(222) plt.plot(x, y, color='r', linewidth=2, marker='o', label=' a= %s'%str(a)) plt.plot(x, y1, color='g', linestyle=' ', marker='o', label=' =%s'%str(sko)) plt.legend(loc='best') plt.grid(True) return a T1=7.0;T2=5.0;s=0.4;k1=5.5;k2=5.5#   . x=[0,1,2,3,4,5] y=[0,-11,-22,-33,-44,-55] a2=mnkLIN(x,y,1) x=[0,1,2,3,4,5] y=[0,17,34,51,68,85] a3=mnkLIN(x,y,2) #m1=0.5;m2=2.0;m3=0.3#   . m1=0.0;m2=0.0;m3=0.0 a=a2+a3 A=round((s*T1*T2+T1**2)/(T1*T2**2),3) B=round((T2+s*T1+k1*k2*m2*a)/(T1*T2**2),3) C=round((1+k1*k2*m1*a)/(T1*T2**2),3) D=round(k1*k2*m3*a/(T1*T2**2),3) E=round(k1*k2*a/(T1*T2**2),3) def f(y, t):#     . y1,y2,y3,y4 = y return [y2,y3,y4,-A*y4-B*y3-C*y2-D*y1+E] t = np.linspace(0,100,10000) y0 = [0,1,0,0]#  w = odeint(f, y0, t) y1=w[:,0] #    y2=w[:,1] #    plt.subplot(223) plt.plot(t,y1,linewidth=1, label=' p- %s,d- %s,i- %s,'%(str(m1),str(m2),str(m3))) plt.ylabel("z") plt.xlabel("t") plt.legend(loc='best') plt.grid(True) plt.show()</span></span></code> </pre> </div></div><br><br>  <b>Result robots program.</b> <br><br><img src="https://habrastorage.org/web/e2b/973/470/e2b9734706964f1da1bae04a546f3337.png"><br><br>  Without the PID controller, the object went to the "spacing".  After preliminary selection of the PID parameters, we get. <br><br><img src="https://habrastorage.org/web/b39/47c/566/b3947c5665cb4905bc910acd24db270c.png"><br><br>  We will change the table data for the third link, we will double a3. <br><br><img src="https://habrastorage.org/web/849/b42/8ff/849b428ff8014774a86bb89cfe10e2f1.png"><br><br>  The regulator is stable. <br><br><h3>  Choosing a function to solve equation (9) in Python and comparing results with a solution on Matcad </h3><br>  I used the odeint function from the scipy library.  Integrate. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(y, t)</span></span></span><span class="hljs-function">:</span></span><span class="hljs-comment"><span class="hljs-comment">#     . y1,y2,y3,y4 = y return [y2,y3,y4,-A*y4-B*y3-C*y2-D*y1+E] t = np. linspace(0,100,10000) y0 = [0,1,0,0]#  w = odeint(f, y0, t) y1=w[:,0] #    y2=w[:,1] #   </span></span></code> </pre><br>  If equation (9) is restructured so that the derivative on the left side is of higher order, and everything else on the right side, we get. <br><br><img src="https://habrastorage.org/web/0b4/872/b86/0b4872b860b348d6b1c8c04c92ab4e12.JPG"><br><br>  So the function def f (y, t) is built.  The odeint function has three required arguments and looks like this <b>odeint (func, y0, t [, args = (), ...])</b> . <br><br>  For comparison, we derive the values ‚Äã‚Äãof the variables A, B, C, D, E used in the above def f (y, t) function, we get 0.36 7.996 1.994 1.193 3.976.  On Mathcad 14, we compose a program for solving the differential equation (9) and construct a transition characteristic. <br><br><img src="https://habrastorage.org/web/9b5/5d7/807/9b55d78074f8438d97c80ea7b7fad08e.PNG"><br>  Charts and numeric values ‚Äã‚Äãare completely identical.  Thus, the Odesolve Mathcad and odeint Python functions provide the same numerical solutions to the problem presented in the article. <br><br><h3>  Conclusion </h3><br>  At this stage of development, the Python programming language with SciPy and NumPy libraries can be effectively used for numerical simulation of automatic control loops containing dynamic and static links. <br><br><h3>  Links </h3><br><ol><li>  <a href="http://3minut.ru/images/PDF/2015/18/avtomatizirovannaya-nastrojka.pdf">Automated tuning of the PID controller for the control object of the tracking system using the MATLAB Simulink software package A. V. B.1, M. A.2 Kosolapov, I. A.3 Maslov, G. I. Tarasova</a> </li><li>  <a href="http://asutpforum.ru/viewtopic.php%3Ft%3D7345">PID controller tuning methods in matlab simulink.</a> </li><li>  <a href="http://www.ict.edu.ru/ft/002327/mathcad3.pdf">PID selection.</a> </li><li>  <a href="https://habrahabr.ru/post/326296/">Model of an oscillating link in the mode of resonant vibrations in Python.</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/328608/">https://habr.com/ru/post/328608/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328598/index.html">WannaCry: analysis, indicators of compromise and recommendations for prevention</a></li>
<li><a href="../328600/index.html">Unusual application of the bot for Telegram and Telegram security check</a></li>
<li><a href="../328602/index.html">Digest: IaaS provider operation, SSL certificates, data center and our ‚ÄúFriday format‚Äù</a></li>
<li><a href="../328604/index.html">Migrating users and their privileges to MySQL</a></li>
<li><a href="../328606/index.html">Analysis of Wana Decrypt0r 2.0 cipher</a></li>
<li><a href="../328610/index.html">Can Laravel be used for large enterprise solutions?</a></li>
<li><a href="../328612/index.html">Your bot for a few hours, or talk about beer with the machine</a></li>
<li><a href="../328616/index.html">Who needs calls when there are chats and bots?</a></li>
<li><a href="../328620/index.html">Soft Mocks for Go! (redefinition of functions and methods in runtime)</a></li>
<li><a href="../328624/index.html">Elements of functional programming in C ++: mapping compositions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>