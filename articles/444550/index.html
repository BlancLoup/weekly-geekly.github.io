<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>On the issue of division</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We have the opportunity to conduct a small but extremely interesting tactical doctrine. 
 In the process of researching a new MC from a well-known com...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>On the issue of division</h1><div class="post__text post__text-html js-mediator-article"><h3>  We have the opportunity to conduct a small but extremely interesting tactical doctrine. </h3><br>  In the process of researching a new MC from a well-known company based on the Cortex-M4 architecture (I‚Äôll definitely write about this), the question arose how quickly the operation of integer division in hardware implementation can work.  The natural experiment gave a somewhat unexpected result: dividing a 32-bit number into a 32-bit one is performed in 3 clock cycles of the processor frequency ‚Äî well, you can figure out how fast.  It turned out that this is the case only with certain operands, but further studies have shown that never the time it takes to perform a division exceeds 7 clock cycles.  The results obtained caused a slight shock (‚Äúand this is not a certain figure of speech, which is unknown what it means, but a very specific verb‚Äù - Divs, as always, is incomparable). <br><br>  Well, you can not just take and quickly divide such long numbers, strange as that, but the facts are stubborn things.  I imagined a picture that tomorrow the President of the Russian Federation calls me to him and sets before me the task of making MK no worse than that of the ARM (I agree that the picture is delusional, but that does not happen in the world), and I look at him confused and understand that I cannot make such a division of such numbers in such a time, and I will not justify the expectations placed on me (well, in fact, I can always quietly buy a license from ARM, and pretend to have thought everything myself, many do, but from me, the GDP is waiting for something completely different, and even then - I can deceive him then, but I can hardly be myself). <br><a name="habracut"></a><br>  And it became sad for me that in ARM guys are sitting much smarter than me, and I went with a long look in the eye to peep on the Internet, how they do it.  On the ARM website, I did not find any information on the time of execution, one of the materials on STM32 indicated that the division takes from 2 to 7 cycles, which corresponds to observations, but there is no information on how this is done. <br><br>  In general, the Almighty Inet didn‚Äôt help much, there are tricks with division by a constant, he wrote about them in one of the posts, but we have a different situation, there is Newton‚Äôs algorithm and its accelerated version, but this is clearly not the case, there is an algorithm based on Fourier transforms, but this is for very large numbers and is unlikely to be completed in 7 clocks even on the ARM architecture.  I had to invent it myself and the solution was found, and it was so simple and obvious that it becomes somewhat embarrassing that this was not done immediately after the task was formulated. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Before looking at my solution, I suggest you find your own, and then compare it with mine, and if they are different then I am waiting for you in the comments. <br><br>  So, how do we quickly (no more than 7 cycles) divide two 32-bit numbers with a 32-bit result. <br><br>  To begin with, we recall how division is generally carried out in binary arithmetic in <br>  classic form.  The algorithm is quite simple and clear - we subtract the divisor from the dividend.  If the result is non-negative (we divide the unsigned numbers), then the next digit of the result is made equal to one and the result is considered as the next dividend, otherwise the next bit of the result is 0. Before the next clock cycle, we reduce the divisor by two times (or shift it to the right, move the dividend to the left) and reduce the bit weight by 2 times (similar shifts).  Thus, we get one bit of the result in one clock cycle and the whole operation will last 32 clock cycles.  In this process, there is still an initial shift, but it does not affect the assessment of the situation as a whole.  We will accelerate, but how? <br><br>  Note that the resulting algorithm strongly resembles the operation of the ADC with a sequential approximation and recalls that there is another conversion method, a much faster - parallel conversion.  What if‚Ä¶ <br><br>  We will subtract from the divider not only the dividend, but also the dividend * 2 and the dividend * 3 (at the same time, on three adders), then we get three bits (result signs) of information that take 4 different values, so 2 bits can be extracted from them result.  Next, we extrapolate a similar approach for 3,4,5 bits of the result. <br>  To get 5 bits of information in one clock cycle, we need 31 adders, each of which will have a Divisable-Divisor operation * n (1-31), pass the result signs through the encoder and get 5 bits of the result immediately.  Then we shift the dividend by 5 digits to the left and repeat until ready.  Then we need 32/5 = 6.4 =&gt; 7 cycles to complete the operation. <br><br>  To work, we need 31 + x adders, it seems to be a lot, but we already have them, because we have a 32 * 32 multiplication operation per cycle, and to implement it without 32 adders we can't do (well, I think so ... ), so that we already have the necessary equipment, the only question is in constructing a control circuit and heaps of multiplexers for the implementation of the fast shift, but this is completely solved. <br><br>  So, the task to divide in 7 cycles has been solved, the question remains - how can this time be reduced, because in the investigated MC it is less than 7. The promising solution is to determine the number of the most significant digit of the dividend (H) and divisor (W) and immediately it becomes clear how many high bits of the quotient are zero, so that we can skip the first or several phases of the algorithm.  For example, if H &lt;W, then the result is immediately zero and we complete the operation, you can certainly derive a formula for the number of measures, but I was already bored. <br><br>  Interestingly, the operation udiv gives only a partial, although the remainder is clearly somewhere inside remains.  In principle, it is not difficult to get it in two cycles, which was done in the analyzed fragment of machine code by executing the pseudo-code Divisible-Partial * Divisor, but this is on any 2 cycles, why would not it be issued immediately in the register pair - I do not know the answer to this question. <br><br>  In general, you will meet the GDP, tell him that we will definitely do the division unit at MK if it is still interesting to him. <br><br>  PS: By the way, when I was searching for KDPV (as you noticed, I did not find it), I noticed one with the frankly incorrect inscription ‚ÄúIt is impossible to divide by zero‚Äù.  I must say with all certainty that it is possible to divide by zero, it is impossible to divide.  But seriously, in different architectures they divide by zero differently, in x86 we get an exception (about this unforgettable error 200), in some we get a dividend or zero, but I have never seen the maximum integer.  In ARM n / 0 = 0/0 and it turns out 0. </div><p>Source: <a href="https://habr.com/ru/post/444550/">https://habr.com/ru/post/444550/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444534/index.html">Vulnerability scanning and secure development. Part 1</a></li>
<li><a href="../444540/index.html">Intel is ready to start producing MRAM memory</a></li>
<li><a href="../444542/index.html">Live Broadcast and Schedule Conference SmartMail Conf: Machine Learning</a></li>
<li><a href="../444544/index.html">Something about distributed data centers for business</a></li>
<li><a href="../444548/index.html">Personal experience: how we were engaged in the Spanish-speaking startup promotion in Latin America</a></li>
<li><a href="../444552/index.html">TDMS Fairway. Work with expertise</a></li>
<li><a href="../444556/index.html">The color of the moon and sun from space in terms of RGB and color temperature</a></li>
<li><a href="../444560/index.html">We invite you to the conference ‚ÄúClouds. Fashion trends "March 26, 2019</a></li>
<li><a href="../444564/index.html">Digital Product Development with Mental Models</a></li>
<li><a href="../444566/index.html">Sikorsky company held a demonstration of an unmanned helicopter with a man on board</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>