<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Networks for the smallest. Part Five ACL and NAT</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All issues  8. Networks for the smallest. Part Eight BGP and IP SLA 
 7. Networks for the smallest. Part Seven. VPN 
 6. Networks for the smallest. Pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Networks for the smallest. Part Five ACL and NAT</h1><div class="post__text post__text-html js-mediator-article"><div class="spoiler">  <b class="spoiler_title">All issues</b> <div class="spoiler_text">  <a href="http://linkmeup.ru/blog/65.html">8. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/65.html">Part Eight</a>  <a href="http://linkmeup.ru/blog/65.html">BGP and IP SLA</a> <br>  <a href="http://linkmeup.ru/blog/50.html">7. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/50.html">Part Seven.</a>  <a href="http://linkmeup.ru/blog/50.html">VPN</a> <br>  <a href="http://linkmeup.ru/blog/33.html">6. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/33.html">Part six.</a>  <a href="http://linkmeup.ru/blog/33.html">Dynamic routing</a> <br>  <a href="http://linkmeup.ru/blog/16.html">5. Networks for the smallest: Part Five.</a>  <a href="http://linkmeup.ru/blog/16.html">NAT and ACL</a> <br>  <a href="http://linkmeup.ru/blog/15.html">4. Networks for the smallest: Part Four.</a>  <a href="http://linkmeup.ru/blog/15.html">STP</a> <br>  <a href="http://linkmeup.ru/blog/14.html">3. Networks for the smallest: Part Three.</a>  <a href="http://linkmeup.ru/blog/14.html">Static routing</a> <br>  <a href="http://linkmeup.ru/blog/13.html">2. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/13.html">Part two.</a>  <a href="http://linkmeup.ru/blog/13.html">Switching</a> <br>  <a href="http://linkmeup.ru/blog/12.html">1. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/12.html">Part one.</a>  <a href="http://linkmeup.ru/blog/12.html">Connection to the equipment cisco</a> <br>  <a href="http://linkmeup.ru/blog/11.html">0. Networks for the smallest.</a>  <a href="http://linkmeup.ru/blog/11.html">Part zero.</a>  <a href="http://linkmeup.ru/blog/11.html">Planning</a> <br></div></div><br><br>  We continue the development of our small cozy network Elevator mi Up.  We have already discussed issues of routing and stability, and now, finally, have grown to connect to the Internet.  Enough imprisonment within our corporate environment! <br>  But with the development there are new problems. <br>  First, the virus paralyzed the web server, then someone jammed a worm that spread across the network, taking up part of the bandwidth.  And some villain got into the habit of picking up passwords for ssh to the server. <br>  Can you imagine what will begin when we connect to the Internet ?! <br>  So today: <br>  1) learn to configure various access control lists (Access Control List) <br>  2) trying to understand the difference between the restriction of incoming and outgoing traffic <br>  3) understand how NAT works, its pros, cons and opportunities <br>  4) in practice, we organize the connection to the Internet through NAT and increase the network security using access lists. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/OHSmt_TS2j8%3Ffeature%3Doembed&amp;xid=17259,15700002,15700021,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhjs_0uXtHGsKR7vsxXH9HP-wnx-XQ" frameborder="0" allowfullscreen=""></iframe><a name="habracut"></a><h1>  Access Control List </h1><br>  So, what do we have to say about access lists?  In fact, the topic is relatively simple and only the lazy ones from the CCNA course are not copied.  But do not we break our amazing story because of some prejudice? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What is the purpose of access lists?  It would seem that the obvious answer is to restrict access: for example, to forbid something to someone.  In general, this is true, but it is necessary to understand it in a wider sense: it is not only about security.  That is, initially, probably, it was so, hence <b>permit</b> and <b>deny</b> when setting up.  But in fact, ACL is a versatile and powerful filtering mechanism.  With their help, it is possible to determine on whom to hang certain politicians, and on whom not, who will participate in certain processes, and who will not, whom we limit to a speed of up to 56k, and who up to 56M. <br>  To make it a little clearer, we give a simple example.  Relying on access lists, Policy-Based Routing (PBR) works.  Here you can make the packets coming <b>from the</b> network 192.168.1.0/24 go to the next-hop 10.0.1.1, and <b>from the</b> network 192.168.2.0/24 to 10.0.2.1 (note that the usual routing relies on the destination address of the packet and automatically packets are sent to one next-hop): <br><img src="https://habrastorage.org/getpro/habr/post_images/e5d/c51/709/e5dc517095795ceb5e53dc7ca990755d.jpg"><br>  At the end of the article is an example of <a href="https://habr.com/ru/post/147996/">PBR</a> setting and <a href="https://habr.com/ru/post/147996/">ACL-based speed limits</a> . <br><br><h4>  ACL Types </h4><br>  Okay, let's forget this lyrics for a while. <br>  Generally speaking, access lists are different: <br><br>  - Standard <br>  - Extended <br>  - Dynamic <br>  - Reflexive <br>  - timed <br><br>  We will focus our attention today on the first two, and in more detail about all you can read at <a href="http://www.cisco.com/en/US/products/sw/secursw/ps1018/products_tech_note09186a00800a5b9a.shtml">tsiska</a> . <br><br><h4>  Inbound and outbound traffic </h4><br>  For the initiative, let's deal with one thing.  What is meant by incoming and outgoing traffic?  We will need this in the future.  Incoming traffic is the one that comes to the interface from the outside. <br><img src="https://habrastorage.org/getpro/habr/post_images/d18/67b/bfe/d1867bbfead963a1664e80f91ff73101.png"><br>  Outbound - the one that is sent from the interface to the outside. <br><img src="https://habrastorage.org/getpro/habr/post_images/e42/474/270/e42474270da202605e67652bdaeab8ff.png"><br>  You can apply the access list either to incoming traffic, then unwanted packets will not even get to the router and, accordingly, further into the network, or outgoing, then the packets arrive at the router, are processed by it, reach the target interface and only drop on it. <br><br>  A standard access list checks only the sender's address.  Extended - address of the sender, address of the recipient, as well as the port.  Standard ACLs are recommended to be placed as close as possible to the recipient (in order not to cut more than necessary), and extended ones closer to the sender (in order to drop unwanted traffic as soon as possible). <br><br><h2>  Practice </h2><br>  Let's go straight to practice.  What would we do to limit this in our small network ‚ÄúElevator mi Up‚Äù? <br><br>  a) WEB-server.  Allow access to everyone over TCP port 80 (HTTP protocol).  For the device from which management will be performed (we also have an admin), you need to open telnet and ftp, but we will give it full access.  All the rest hang up. <br><br>  b) File server.  We have to get resident Lift me Up on ports for shared folders, and all the rest via FTP. <br><br>  c) Mail Server.  Here we have started SMTP and POP3, that is, TCP ports 25 and 110. We also open access to management for the admin.  Others are blocking. <br><br>  d) For the future DNS server you need to open UDP port 53 <br><br>  e) Allow ICMP messages to the server network <br><br>  e) Since we have the Other network for all non-partisan who have not entered into the EF, VET and Accounting, we will restrict them all, and only give access to some (among them we and the admin) <br><br>  g) In the control network, you need to start again just the admin, and of course yourself a loved one. <br><br>  g) We will not build barriers to communication among the employees of the departments. <br><br><h3>  a) Access to the WEB-server </h3><br>  Here we have a policy that prohibits everything that is not allowed.  Therefore, we now need to open something, and close everything else. <br>  Since we are protecting the network of servers, we will hang the list on the interface going in the direction of them, that is, on FE0 / 0.3. Only in question or <b>out</b> we need to do this?  If we do not want to allow packets towards servers that are already on the router, then this will be outgoing traffic.  That is, we will have destination addresses in the network of servers (of which we will choose which server traffic is going to), and source addresses can be any - both from our corporate network and from the Internet. <br>  One more note: since we will be filtering, including at the destination address (some rules on the WEB server, others on the mail server), we will need an extended (extended) access control list, only it allows us to do this. <br><br>  The rules in the access list are checked in order from top to bottom until the first match.  As soon as one of the rules has worked, regardless of whether to permit this or deny, the check is stopped and the traffic is processed based on the rule that was triggered. <br>  That is, if we want to protect the WEB-server, then first of all we need to give permission, because if we configure <b>deny ip any any</b> in the first line, then it will always work and traffic will not go at all.  <b>Any</b> is a special word that means network address and reverse mask 0.0.0.0 0.0.0.0 and means that absolutely all nodes from any networks fall under the rule.  Another special word - <b>host</b> - it means the mask 255.255.255.255 - that is, it is one single specified address. <br>  So, the first rule: allow access to all on port 80 <br><blockquote>  msk-arbat-gw1 (config) # ip access-list extended Servers-out <br>  msk-arbat-gw1 (config-ext-nacl) # remark WEB <br>  msk-arbat-gw1 (config-ext-nacl) # permit tcp any host 172.16.0.2 eq 80 <br></blockquote><br>  Allowing ( <b>permit</b> ) TCP traffic from any node ( <b>any</b> ) to a host ( <b>host</b> is exactly one address) 172.16.0.2 addressed to port 80. <br>  We try to hang this access list on the FE0 / 0.3 interface: <br><blockquote>  msk-arbat-gw1 (config) # int fa0 / 0.3 <br>  msk-arbat-gw1 (config-subif) # ip access-group Servers- <b>out</b> <br></blockquote><br>  We check from any of our connected computers: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ef6/e99/3ce/ef6e993ce707ff926b5652329c3cf95f.png"><br><br>  As you can see the page opens, but what about our ping? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/39d/04d/834/39d04d83441c5b9b40737c795469a6f1.png"><br><br>  And so from any other node? <br><br>  The fact is that after all the rules in the ciskov ACL at the end implicit <i>deny ip any any</i> (implicit deny) is added.  What does this mean for us?  Any packet leaving the interface and not responding to any rule from the ACL falls under implicit deny and is discarded.  That is, at least ping, at least ftp, at least anything here will not work. <br><br>  Go ahead: you need to give full access to the computer from which the control will be made.  This will be the computer of our admin with the address 172.16.6.66 from the Other network. <br>  Each new rule is added automatically to the end of the list if it already exists: <br><blockquote>  msk-arbat-gw1 (config) # ip access-list extended Servers-out <br>  msk-arbat-gw1 (config-ext-nacl) # permit tcp host 172.16.6.66 host 172.16.0.2 range 20 ftp <br>  msk-arbat-gw1 (config-ext-nacl) # permit tcp host 172.16.6.66 host 172.16.0.2 eq telnet <br></blockquote><br>  That's all.  We check from the right node (since telnet is not supported by servers in RT, we check for FTP): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/838/394/74a/83839474ab4c587bdf8a9019206453a8.png"><br><br>  That is, an FTP message arrived at the router and should go away from the FE0 / 0.3 interface.  The router checks and sees that the packet matches the rule added by us and skips it. <br><br>  And from an outside node <br><br><img src="https://habrastorage.org/getpro/habr/post_images/030/d88/c14/030d88c14f2db26e183808fb4ac1e7e8.png"><br><br>  FTP package does not fall under any of the rules, except for the implicit deny ip any any and is discarded. <br><br><h3>  b) Access to the file server </h3><br>  Here it would be necessary first of all to decide on who will be a ‚Äúresident‚Äù, who needs to be given access.  Of course, those who have an address from the network 172.16.0.0/16 - only they will be given access. <br>  Now with shared folders.  Most modern systems already use the SMB protocol for this, which needs TCP port 445. On older versions, NetBios was used, which was fed through three ports: UDP 137 and 138 and TCP 139. After negotiating with our administrator, we will configure port 445 (though check within RT, of course, will not work).  But besides that, we will need ports for FTP - 20, 21, and not only for internal hosts, but also for connections from the Internet: <br><blockquote>  msk-arbat-gw1 (config) # ip access-list extended Servers-out <br>  msk-arbat-gw1 (config-ext-nacl) # permit tcp <b>172.16.0.0 0.0.255.255</b> host 172.16.0.3 eq 445 <br>  msk-arbat-gw1 (config-ext-nacl) # permit tcp <b>any</b> host 172.16.0.3 range 20 21 <br></blockquote><br>  Here we reapplied the <b>range 20 21</b> construction - in order to specify several ports in one line.  For FTP, generally speaking, port 21 is not enough.  The fact is that if you open only it, then you will be logged in, and there is no file transfer. <br><br>  0.0.255.255 - reverse mask (wildcard mask).  About what it is, let's talk a little later <br><br><h3>  c) Access to the mail server </h3><br>  We continue to turn out the practice - now with the mail server.  Within the same access list, we add new records we need. <br>  Instead of port numbers for common protocols, you can specify their names: <br><blockquote>  msk-arbat-gw1 (config) # ip access-list extended Servers-out <br>  msk-arbat-gw1 (config-ext-nacl) #permit tcp any host 172.16.0.4 eq pop3 <br>  msk-arbat-gw1 (config-ext-nacl) #permit tcp any host 172.16.0.4 eq smtp <br></blockquote><br><br><h3>  d) DNS server </h3><br><blockquote>  msk-arbat-gw1 (config) # ip access-list extended Servers-out <br>  msk-arbat-gw1 (config-ext-nacl) # permit <b>udp</b> 172.16.0.0 0.0.255.255 host 172.16.0.5 eq 53 <br></blockquote><br><br><h3>  e) ICMP </h3><br>  It remains to correct the situation with the ping.  There is nothing wrong with adding rules to the end of the list, but somehow it will be aesthetically more pleasant to see them at the beginning. <br>  Use simple cheat for this.  For this you can use a text editor, for example.  Copy there from the show run a piece about ACL and add the following lines: <br>  <i><b>no ip access-list extended Servers-out</b></i> <i><br></i>  <i>ip access-list extended Servers-out</i> <i><br></i>  <i><b>permit icmp any any</b></i> <i><br></i>  <i>remark WEB</i> <i><br></i>  <i>permit tcp any host 172.16.0.2 eq www</i> <i><br></i>  <i>permit tcp host 172.16.6.66 host 172.16.0.2 range 20 ftp</i> <i><br></i>  <i>permit tcp host 172.16.6.66 host 172.16.0.2 eq telnet</i> <i><br></i>  <i>remark FILE</i> <i><br></i>  <i>permit tcp 172.16.0.0 0.0.255.255 host 172.16.0.3 eq 445</i> <i><br></i>  <i>permit tcp any host 172.16.0.3 range 20 21</i> <i><br></i>  <i>remark MAIL</i> <i><br></i>  <i>permit tcp any host 172.16.0.4 eq pop3</i> <i><br></i>  <i>permit tcp any host 172.16.0.4 eq smtp</i> <i><br></i>  <i>remark DNS</i> <i><br></i>  <i>permit udp 172.16.0.0 0.0.255.255 host 172.16.0.5 eq 53</i> <i><br></i> <br><br>  In the first line we delete the existing list, then create it anew and list all the new rules in the order we need.  Using the command in the third line, we allowed all ICMP packets from any hosts to any hosts. <br><br>  Further simply we copy everything in a crowd and we insert into the console.  The interface interprets each line as a separate command and executes it.  So we replaced the old list with a new one. <br>  Check that ping is: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3d1/f30/982/3d1f309828a0337830c54a5c7c246439.png"><br><br>  Perfectly. <br><br>  <b>This ‚Äúcheat‚Äù is good for the initial configuration or if you understand exactly what you are doing.</b>  <b>On a working network, when you configure an ACL remotely, you risk being left without access to a custom piece of hardware.</b> <b><br></b> <br><blockquote>  To insert a rule at the beginning or at any other desired place, you can resort to this method: <br>  <b>ip access-list extended Servers-out</b> <b><br></b>  <b>1 permit icmp any any</b> <b><br></b> <br>  Each rule in the list is numbered with a certain step, and if before the word permit / deny you put a number, the rule will be added not to the end, but to the place you need.  Unfortunately, this feature does not work in RT. <br>  If it is suddenly necessary (all consecutive numbers between rules are occupied), you can always renumber the rules (in this example, the number of the first rule 10 (the first number) and the increment 10 are assigned): <br>  <b>ip access-list resequence Servers-out 10 10</b> <b><br></b> <br></blockquote><br><br>  As a result, the Access List to the server network will look like this: <br>  <i>ip access-list extended Servers-out</i> <i><br></i>  <i>permit icmp any any</i> <i><br></i>  <i>remark WEB</i> <i><br></i>  <i>permit tcp any host 172.16.0.2 eq www</i> <i><br></i>  <i>permit tcp host 172.16.6.66 host 172.16.0.2 range 20 ftp</i> <i><br></i>  <i>permit tcp host 172.16.6.66 host 172.16.0.2 eq telnet</i> <i><br></i>  <i>remark FILE</i> <i><br></i>  <i>permit tcp 172.16.0.0 0.0.255.255 host 172.16.0.3 eq 445</i> <i><br></i>  <i>permit tcp any host 172.16.0.3 range 20 21</i> <i><br></i>  <i>remark MAIL</i> <i><br></i>  <i>permit tcp any host 172.16.0.4 eq pop3</i> <i><br></i>  <i>permit tcp any host 172.16.0.4 eq smtp</i> <i><br></i>  <i>remark DNS</i> <i><br></i>  <i>permit udp 172.16.0.0 0.0.255.255 host 172.16.0.5 eq 53</i> <i><br></i> <br><br>  Now our admin has access only to the WEB-server.  Open to him full access to the entire network.  This is the first homework. <br><br><h2>  e) Rights of users from the Other network </h2><br>  Until now, we had to <b>not let</b> someone in somewhere, so we paid attention to the destination address and the access list hung on outgoing traffic from the interface. <br><br>  Now we need <b>not to let out</b> : no requests from computers from the Other network should go beyond.  Well, of course, except for those that we specifically allow. <br><blockquote>  msk-arbat-gw1 (config) # ip access-list extended Other-in <br>  msk-arbat-gw1 (config-ext-nacl) # remark IAM <br>  msk-arbat-gw1 (config-ext-nacl) # permit ip host 172.16.6.61 any <br>  msk-arbat-gw1 (config-ext-nacl) # remark ADMIN <br>  msk-arbat-gw1 (config-ext-nacl) # permit ip host 172.16.6.66 any <br></blockquote><br>  Here we could not ban all at first, and then allow the elect, because absolutely all packets would fall under the rule of <b>deny ip any any</b> and would not work at all. <br>  We apply on the interface.  This time to the entrance: <br><blockquote>  msk-arbat-gw1 (config) #int fa0 / 0.104 <br>  msk-arbat-gw1 (config-subif) #ip access-group Other-in <b>in</b> <br></blockquote><br>  that is, all IP packets from the host with the address 172.16.6.61 or 172.16.6.66 are allowed to be transmitted wherever they are intended.  Why are we also using an extended access list here?  After all, it would seem, we only check the address of the sender.  Because we gave the admin full access, but for a guest of the company ‚ÄúElevator mi Up‚Äù, for example, who will get to the same network absolutely nowhere else, except to access the Internet. <br><br><h3>  g) Management Network </h3><br>  Nothing complicated.  The rule will look like this: <br><blockquote>  msk-arbat-gw1 (config) # ip access-list extended Management-out <br>  msk-arbat-gw1 (config-ext-nacl) # remark IAM <br>  msk-arbat-gw1 (config-ext-nacl) # permit ip host 172.16.6.61 172.16.1.0 0.0.0.255 <br>  msk-arbat-gw1 (config-ext-nacl) # remark ADMIN <br>  msk-arbat-gw1 (config-ext-nacl) # permit ip host 172.16.6.66 172.16.1.0 0.0.0.255 <br></blockquote><br>  We apply this ACL on out to the FE 0 / 0.2 interface: <br><blockquote>  msk-arbat-gw1 (config) # int fa0 / 0.2 <br>  msk-arbat-gw1 (config-subif) #ip access-group Management-out <br></blockquote><br><h3>  g) No more restrictions </h3><br>  Is done <br><br><h2>  Mask and reverse mask </h2><br>  So far, without explanation, we have given a strange parameter of the form 0.0.255.255, suspiciously resembling a subnet mask. <br>  A bit difficult to understand, but it is the reverse mask that is used to determine the hosts that fall under the rule. <br>  To understand what a reverse mask is, you need to know what a normal one is. <br><br>  Let's start with the simplest example. <br><br>  A typical network is 256 addresses: 172.16.5.0/24, for example.  What does this record mean? <br>  But it means exactly the following <br><br><table border="1"><tbody><tr><td>  IP address.  Decimal notation </td><td>  172 </td><td>  sixteen </td><td>  five </td><td>  0 </td></tr><tr><td>  IP address.  Binary recording </td><td>  10101100 </td><td>  00010000 </td><td>  00000101 </td><td>  00000000 </td></tr><tr><td>  Subnet mask.  Binary recording </td><td>  11111111 </td><td>  11111111 </td><td>  11111111 </td><td>  00000000 </td></tr><tr><td>  Subnet mask.  Decimal notation </td><td>  255 </td><td>  255 </td><td>  255 </td><td>  0 </td></tr></tbody></table><br><br>  An IP address is a 32-bit parameter divided into 4 parts that you are used to seeing in decimal form. <br>  The subnet mask also has a length of 32 bits - it is actually a template, a stencil, by which the address of a subnet is determined.  Where units are in the mask, the value cannot change, that is, part 172.16.5 is completely unchanged and it will be the same for all hosts on this subnet, but the one where the zeros vary. <br>  That is, in the example we took, 172.16.5.0/24 is the network address, and the hosts will be 172.16.5.1-172.16.5.254 (the last 255 is broadcast), because 00000001 is 1 and 11111110 is 254 (this is the last octet of the address ).  / 24 means that the mask length is 24 bits, that is, we have 24 units - the constant part and 8 zeros. <br>  Another case is when we have a mask, for example, 30 bits, and not 24. <br>  For example, 172.16.2.4/30.  Let's write it like this: <br><table border="1"><tbody><tr><td>  IP address.  Decimal notation </td><td>  172 </td><td>  sixteen </td><td>  2 </td><td>  four </td></tr><tr><td>  IP address.  Binary recording </td><td>  10101100 </td><td>  00010000 </td><td>  00000010 </td><td>  00000100 </td></tr><tr><td>  Subnet mask.  Binary recording </td><td>  11111111 </td><td>  11111111 </td><td>  11111111 </td><td>  11111100 </td></tr><tr><td>  Subnet mask.  Decimal notation </td><td>  255 </td><td>  255 </td><td>  255 </td><td>  252 </td></tr></tbody></table><br><br>  As you can see, only the last two bits can change for this subnet.  The last octet can take the following 4 values: <br>  00000100 - subnet address (4 in decimal) <br>  00000101 - host address (5) <br>  00000110 - node address (6) <br>  00000111 - broadcast (7) <br>  Anything beyond this is another subnet <br><br>  That is, now it should be a little clear to you that the subnet mask is a sequence of 32 bits, where units, meaning the address of the subnet, first come, and then zeros, meaning the host address.  In this case, the zeros alternate and the units in the mask cannot alternate.  That is, the mask 11111111.11100000.11110111.00000000 is <b>impossible</b> <br><br>  And what is the reverse mask (wildcard)? <br>  For the vast majority of administrators and some engineers - this is nothing more than the inverse of the usual mask.  That is, the zeros initially set the address of the part, which must necessarily coincide, and the units on the contrary the free part. <br>  That is, in the first example we took, if you want to filter all hosts from the 172.16.5.0/24 subnet, then you will specify a rule in the Access list: <br>  ...  172.16.5.0 0.0.0.255 <br>  Because the reverse mask will look like this: <br><br>  00000000.00000000.00000000.11111111 <br><br>  In the second example with the network 172.16.2.4/30, the inverse mask will look like this: 30 zeros and two ones: <br><br><table border="1"><tbody><tr><td>  Back mask  Binary recording </td><td>  00000000 </td><td>  00000000 </td><td>  00000000 </td><td>  00000011 </td></tr><tr><td>  Back mask  Decimal notation </td><td>  0 </td><td>  0 </td><td>  0 </td><td>  3 </td></tr></tbody></table><br><br>  Accordingly, the parameter in the access list will look like this: <br>  ...  172.16.2.4 0.0.0.3 <br>  Later, when you eat a dog on the miscalculations of masks and inverse masks, you will remember the most used figures, the number of hosts in one mask or another, you will understand that in the described situations the last octet of the reverse mask is obtained by subtracting the last octet from 255 digits of the usual mask (255-252 = 3), etc.  In the meantime, you need to work hard and count) <br><br>  But in fact, the inverse mask is a somewhat richer tool; here you can combine addresses within one subnet or even combine subnets, but the most important difference is that you can alternate zeros and ones.  This allows you, for example, to filter a specific node (or group) on several subnets in one line. <br><br><h4>  Example 1 </h4><br>  <b>Given:</b> network 172.16.16.0/24 <br>  <b>It is necessary:</b> filter the first 64 addresses (172.16.16.0-172.16.16.63) <br>  <b>Solution:</b> 172.16.16.0 0.0.0.63 <br><br><h4>  Example 2 </h4><br>  <b>Given:</b> Networks 172.16.16.0/24 and 172.16.17.0/24 <br>  <b>Need to:</b> filter addresses from both networks <br>  <b>Solution:</b> 172.16.16.0 0.0.1.255 <br><br><h4>  Example 3 </h4><br>  <b>Given:</b> Networks 172.16.0.0-172.16.255.0 <br>  <b>Necessary:</b> filter the host with the address 4 of all subnets <br>  <b>Solution:</b> 172.16.16.0 0.0.255.4 <br><br>  To admit never in a life it was not necessary to meet the last scenario of application.  These are some terribly specific tasks. <br>  More details about the reverse masks can be found here: <a href="http://habrahabr.ru/post/131712/">http://habrahabr.ru/post/131712/</a> <br><br><h2>  Work ACL in pictures </h2><br>  Hypothetical network: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0cd/e11/f16/0cde11f167f694773db1bce558c38758.jpg"><br><br>  1) On the RT1 router on the FE0 / 1 interface, everything is allowed at the input, except for ICMP. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a4/3dc/7b6/7a43dc7b6b065a5f073f96272b7d65e9.jpg"><br><br>  2) On RT2 router on FE0 / 1 interface, SSH and TELNET are not allowed on the output <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ff/95e/993/4ff95e993a76dcce844d37dd1c00a7c6.jpg"><br><br>  Tests <br>  <i>clickable</i> <br>  1) Ping from PC1 to Server1 <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e98/c53/b4a/e98c53b4aff45244a796c2e56d90a23e.gif"></a> <br>  2) TELNET from PC1 to Server1 <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/7bb/a93/3f6/7bba933f6a27a3abddc2ac87eba6c40c.gif"></a> <br>  3) SSH from PC1 to Server2 <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/44d/07d/3c3/44d07d3c33d35e1c209f3598f31a358e.gif"></a> <br>  4) Ping from Server2 to PC1 <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/93e/6b0/c4f/93e6b0c4f7c65afc0e71875658da1fc6.gif"></a> <br><br><h2>  Additions </h2><br>  1) Rules acting on outgoing traffic (out) will not filter the traffic of the device itself.  That is, if you need to deny access to the tsiska itself, then you will have to filter incoming traffic on this interface (return from where you need to deny access). <br><br>  2) C ACL need to be careful.  If there is a small error in the rule, the wrong order of settings or a badly thought out list in general, you can remain without access to the device. <br>  For example, you want to close access anywhere for the network 172.16.6.0/24, except for your address 172.16.6.61 and set the rules like this: <br><blockquote>  deny ip 172.16.6.0 0.0.0.255 any <br>  permit ip host 172.16.6.61 any <br></blockquote><br>  As soon as you apply an ACL on the interface, you will immediately lose access to the router, because you fall under the first rule and the second is not even checked. <br>  The second is an unpleasant situation that may happen to you: under the ACL will get traffic that should not have come. <br>  Imagine such a situation: we have a FTP server in passive mode in the server.  To access it, you opened the 21st port in the <i>Servers-out</i> ACL.  After the initial connection is established, the FTP server informs the client of the port through which it is ready to transfer / receive files, for example, the 1523rd.  The client is trying to establish a TCP connection to this port, but stumbles upon a Servers-out ACL, where there is no such permission ‚Äî the story ends with a successful transfer.  In our example above, where we set up access to the file server, we opened access only on the 20th and 21st, because for example this is enough.  In real life will have to tinker.  A few ACL configuration examples for common cases. <br><br>  3) A very similar and interesting problem arises from the 2nd point. <br>  I thought up, for example, hang up on the interface on the Internet such ACLs here: <br><blockquote>  access-list out permit tcp host 1.1.1.1 host 2.2.2.2 eq 80 <br>  access-list in permit tcp host 2.2.2.2 any eq 80 <br></blockquote><br>  It would seem: a host with the address 1.1.1.1 is allowed access via port 80 to the server 2.2.2.2 (the first rule).  And back from the server 2.2.2.2 allowed connections inside. <br>  But the nuance here is that computer 1.1.1.1 establishes a connection to port 80, but C from some other, for example, 1054, that is, the response packet from the server comes to socket 1.1.1.1:1054, does not fall under the rule ACL to IN and discarded due to implicit deny ip any any. <br>  To avoid such a situation, and not open ports with the whole bundle, you can resort to such tricks in in ACL: <br><blockquote>  permit tcp host 2.2.2.2 any established. <br></blockquote><br>  Details of such a decision in one of the following articles. <br><br>  4) Speaking about the modern world, it is impossible to bypass such a tool as object groups (Object-group). <br><br>  Suppose you need to create an ACL that issues three specific Internet addresses on three identical ports with the prospect of expanding the number of addresses and ports.  What it looks like without the knowledge of object groups: <br><blockquote>  ip access-list extended TO-INTERNET <br>  permit tcp host 172.16.6.66 any eq 80 <br>  permit tcp host 172.16.6.66 any eq 8080 <br>  permit tcp host 172.16.6.66 any eq 443 <br><br>  permit tcp host 172.16.6.67 any eq 80 <br>  permit tcp host 172.16.6.67 any eq 8080 <br>  permit tcp host 172.16.6.67 any eq 443 <br><br>  permit tcp host 172.16.6.68 any eq 80 <br>  permit tcp host 172.16.6.68 any eq 8080 <br>  permit tcp host 172.16.6.68 any eq 443 <br></blockquote><br>  With an increase in the number of parameters, it becomes more and more difficult to accompany such an ACL; it is easy to make a mistake when setting up. <br>  But, if we turn to object groups, then it takes the following form: <br><blockquote>  object-group service INET-PORTS <br>  description ports for some hosts <br>  tcp eq www <br>  tcp eq 8080 <br>  tcp eq 443 <br><br>  object-group network HOSTS-TO-INET <br>  Hosts allowed to browse the net <br>  host 172.16.6.66 <br>  host 172.16.6.67 <br>  host 172.16.6.68 <br><br>  ip access-list extended INET-OUT <br>  permit object-group INET-PORTS object-group HOSTS-TO-INET any <br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at first glance it looks somewhat threatening, but if you look at it, it is very convenient. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Information that is very useful for troubleshooting can be obtained from the output of the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">show ip access-lists%</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command </font><b><font style="vertical-align: inherit;">name ACL%</font></b><font style="vertical-align: inherit;"> . In addition to the actual list of rules of the specified ACL, this command shows the number of matches for each rule.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nat-inet </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extended IP access list list </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp 172.16.3.0 0.0.0.255 host 192.0.2.2 eq www </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip 172.16.5.0 0.0.0.255 host 192.0.2.3 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip 172.16 .5.0 0.0.0.255 host 192.0.2.4 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip host 172.16.4.123 any </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip host 172.16.6.61 any </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip host 172.16.6.66 any </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(4 match (es))</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permit ip host 172.16.16.222 any </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip host 172.16.17.222 any </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip host 172.16.24.222 any</font></font><br></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And adding at the end of any rule </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">log</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , we will be able to receive messages about every match in the console. </font><font style="vertical-align: inherit;">(the latter does not work in PT)</font></font><br><br><h1>  NAT </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Network Address Translation - a mechanism in the household has been absolutely necessary since 1994. Many sessions about him are broken and packets are lost. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You need it most often to connect your local network to the Internet. The fact is that theoretically there are 255 * 255 * 255 * 255 = 4 228 250 625. 4 billion addresses. Even if each inhabitant of the planet had only one computer, there would not be enough addresses. And here, except that the irons are not connected to the Internet. Smart people realized this in the early 90s and, as a temporary solution, they suggested dividing the address space into public (white) and private (private, gray) addresses. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The latter include three ranges: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.0.0.0/8 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">172.16.0.0/12 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.0.0/16</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can freely use them in your private network, and therefore, of course, they will be repeated. </font><font style="vertical-align: inherit;">How to be with uniqueness? </font><font style="vertical-align: inherit;">Who will be responsible for the WEB-server, which received a request with the return address 192.168.1.1? </font><font style="vertical-align: inherit;">Rostelecom? </font><font style="vertical-align: inherit;">Tatneft companies? </font><font style="vertical-align: inherit;">Or your room Dlinka? </font><font style="vertical-align: inherit;">On the Internet, no one knows anything about private networks - they are not routed. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is where NAT comes into play. </font><font style="vertical-align: inherit;">By and large, this is a hoax, a setup. </font><font style="vertical-align: inherit;">On the device, your private address, roughly speaking, is simply replaced by the white address, which will appear later in the package as it travels to the WEB server. </font><font style="vertical-align: inherit;">But the white addresses are very well routed, and the packet will definitely return back to the tension device. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But how will it in turn understand what to do with it next? </font><font style="vertical-align: inherit;">Here with it we will understand.</font></font><br><br><h2>  NAT types </h2><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Static </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this case, one internal address is converted to one external address. </font><font style="vertical-align: inherit;">And at the same time all requests coming to the external address will be transmitted to the internal one. </font><font style="vertical-align: inherit;">As if this host is the owner of this white IP address. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configured by the following command:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Router (config) # ip nat inside source source static 172.16.6.5 198.51.100.2 </font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What happens: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) Site 172.16.6.5 addresses the WEB server. It sends an IP packet, where the recipient's address is 192.0.2.2, and the sender is 172.16.6.5. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d17/9be/88e/d179be88e49975f8eb8c213c57b247ef.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) On the corporate network, the packet is delivered to the gateway 172.16.6.1, where NAT is configured </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/964/f51/e1d/964f51e1d5dc239c241a630698eab0eb.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) According to the configured command, the router removes the current IP header and changes it to a new one, where the white address 198.51.100.2 already appears as the sender's address. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed5/82e/b8a/ed582eb8a8bca3145ca042980a67505f.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/d73/ce1/ead/d73ce1ead3f9f24e70945939c1857a63.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) On the big Internet, the updated package reaches the server 192.0.2.2. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/610/145/b0b/610145b0b54c922390ef5c9b7e9da617.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5) He sees that the answer must be sent to 198.51.100.2 and prepares a response IP packet. As the address of the sender, the actual address of the server is 192.0.2.2, the destination address is 198.51.100.2 </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/521/cd6/673/521cd6673cdc1b49e64f7ad351bb2e22.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/5f7/570/5f1/5f75705f176eeb22f047f394c49bcc71.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6) The package flies back through the Internet, and not the fact that it is the same way.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7) On the saturating device it is indicated that all requests to the address 198.51.100.2 should be redirected to 172.16.6.5. The router undresses the hidden TCP segment again and sets a new IP header (the sender's address does not change, the destination address is 172.16.6.5). </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/119/db5/ac7/119db5ac7ce968cdcb57e27ffb7bce10.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/2cd/f85/199/2cdf851999ed490687b0d5cac33a669a.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8) On the internal network, the packet is returned to the initiator, who even did not know what miracles were happening to him at the border. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And so it will be with everyone. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this case, if the connection is initiated from the Internet, the packets automatically, passing through the saturating device, get to the internal host.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This approach can be useful when you have a server inside your network that needs full access from the outside. </font><font style="vertical-align: inherit;">Of course, you cannot use this option if you want to release three hundred hosts on the Internet through a single address. </font><font style="vertical-align: inherit;">This option NAT does not help save white IP-addresses, but nevertheless it is useful.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dynamic </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You have a pool of white addresses, for example, the provider allocated to you a network 198.51.100.0/28 with 16 addresses. </font><font style="vertical-align: inherit;">Two of them (the first and the last) are the network and broadcast address, two more addresses are assigned to the equipment to provide routing. </font><font style="vertical-align: inherit;">You can use the 12 remaining addresses for NAT and release your users through them. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The situation is similar to static NAT ‚Äî one private address is translated to one external address ‚Äî but now the external one is not clearly fixed, but will be selected dynamically from the specified range. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is configured as follows:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Router (config) #ip nat pool lol_pool 198.51.100.3 198.51.103.14 </font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Set a pool (range) of public addresses from which the address for a natirovaniye will be selected </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Router (config) # access-list 100 permit ip 172.16.6.0 0.0.0.255 any </font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We specify an access list that passes all packets with source address 172.16.6.x, where </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> varies 0-255.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Router (config) #ip nat inside source list 100 pool lol_pool </font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This team we dock the created ACL and pool. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This option is also not universal, you will not be able to release everyone on the Internet to your 300 users unless you have 300 external addresses. </font><font style="vertical-align: inherit;">Once the white addresses are exhausted, no one will be able to access the Internet anymore. </font><font style="vertical-align: inherit;">At the same time, those users who have already managed to grab their external address will work. </font><font style="vertical-align: inherit;">The </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clear ip nat translation</font></font></b> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command will help you to drop all current translations and free up external addresses. </font><b><font style="vertical-align: inherit;">*</font></b></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In addition to dynamically allocating external addresses, this dynamic NAT is different from static in that without a separate port forwarding setting, an external connection to one of the pool addresses is no longer possible.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Many-to-one </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The following type has several names: NAT Overload, Port Address Translation (PAT), IP Masquerading, Many-to-One NAT. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The last name speaks for itself - through a single external address goes into the world of many private. </font><font style="vertical-align: inherit;">This allows you to solve the problem of lack of external addresses and release into the world of all comers. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here it would be necessary to give an explanation of how this works. </font><font style="vertical-align: inherit;">How two private addresses are translated into one can be represented, but how does the router understand who needs to send a packet that returns from the Internet to this address? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It's very simple: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suppose that from two hosts from the internal network come packets on a natriate device. </font><font style="vertical-align: inherit;">Both with a request to the WEB-server 192.0.2.2. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The data from the hosts look like this:</font></font><br><br><table border="1"><tbody><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sender's address </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sender port </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Address of the recipient </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Receiver port </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 172.16.6.5 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 23761 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 192.0.2.2 </font></font></td><td>  80 </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 172.16.4.5 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 39800 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 192.0.2.2 </font></font></td><td>  80 </td></tr></tbody></table><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The router uncovers the IP packet from the first host, extracts a TCP segment from it, prints it out and finds out from which port the connection is being made. </font><font style="vertical-align: inherit;">He has an external address 198.51.100.2, which will change the address from the internal network. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then he chooses a free port, for example, 11874. And what does he do next? </font><font style="vertical-align: inherit;">It packs all the data of the application level into a new TCP segment, where 80 still remains as the destination port (the WEB-server waits for it), and the port of the sender changes from 23761 to 11874. This TCP-segment is encapsulated into a new IP- packet where the sender's IP address changes from 172.16.6.5 to 198.51.100.2.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The same thing happens for a packet from a second host, only the next free port is selected, for example 11875. ‚ÄúFree‚Äù means that it is not yet occupied by other such connections. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The data that is sent to the Internet, will now look like this.</font></font><br><br><table border="1"><tbody><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sender's address </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sender port </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Address of the recipient </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Receiver port </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 198.51.100.2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11874 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 192.0.2.2 </font></font></td><td>  80 </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 198.51.100.2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11875 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 192.0.2.2 </font></font></td><td>  80 </td></tr></tbody></table><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It enters the senders and recipients data into its NAT table. </font></font><br><br><table border="1"><tbody><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Local Sender Address </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Local Sender Port </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Global Sender Address </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Global Sender Port </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Address of the recipient </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Receiver port </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 172.16.6.5 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 23761 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 198.51.100.2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11874 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 192.0.2.2 </font></font></td><td>  80 </td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 172.16.4.5 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 39800 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 198.51.100.2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11875 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 192.0.2.2 </font></font></td><td>  80 </td></tr></tbody></table><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For a web server, these are two completely different requests that it must process each one individually. </font><font style="vertical-align: inherit;">After that, he sends an answer that looks like this:</font></font><br><br><table border="1"><tbody><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sender's address </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sender port </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Address of the recipient </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Receiver port </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 192.0.2.2 </font></font></td><td>  80 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 198.51.100.2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11874 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 192.0.2.2 </font></font></td><td>  80 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 198.51.100.2 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11875 </font></font></td></tr></tbody></table><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When one of these packets reaches our router, it matches the data in this packet with its entries in the NAT table. </font><font style="vertical-align: inherit;">If a match is found, the reverse procedure occurs ‚Äî the packet and the TCP segment are returned its original parameters only as an assignment:</font></font><br><br><table border="1"><tbody><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sender's address </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sender port </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Address of the recipient </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Receiver port </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 192.0.2.2 </font></font></td><td>  80 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 172.16.6.5 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 23761 </font></font></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 192.0.2.2 </font></font></td><td>  80 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 172.16.4.5 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 39800 </font></font></td></tr></tbody></table><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And now the packets are delivered on the internal network to the initiating computers, which even didn‚Äôt even know that they had been so hard on the border somewhere with their data. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Your every appeal is a separate connection. That is, you tried to open a WEB-page - this is the HTTP protocol that uses port 80. To do this, your computer must establish a TCP session with a remote server. Such a session (TCP or UDP) is defined by two sockets: local IP address: local port and remote IP address: remote port. In a normal situation, you have one server computer connection, in the case of a NAT connection, there will be two: a router-server and the computer thinks that it has a computer-server session. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The setting is completely insignificant: the additional word overload:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Router (config) # access-list 101 permit 172.16.4.0 0.0.0.255 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Router (config) #ip nat inside list source interface 101 fa0 / 1 </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">overload</font></font></b> <br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In this case, of course, it is possible to configure the address pool: </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Router (config) #ip nat pool lol_pool 198.51.100.2 198.51.103.14 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Router (config) # access-list 100 permit 172.16.6.0 0.0.0.255 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Router (config) #ip nat inside list list 100 pool lol_pool </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">overload</font></font></b> <br></blockquote><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Port Forwarding </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Otherwise they say port forwarding or mapping. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When we started talking about NAT, we had one-to-one translation and all requests coming from outside were automatically redirected to the internal host. </font><font style="vertical-align: inherit;">Thus it would be possible to expose the server out to the Internet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But if you do not have such an opportunity - you are limited in white addresses, or do not want to expose the whole bundle of ports to the outside, what should you do? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can specify that all requests coming to a specific white address and a specific port of the router should be redirected to the correct port of the desired internal address.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Router (config) #ip nat inside source source static tcp 172.16.0.2 80 198.51.100.2 80 extendable </font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The use of this command means that a TCP request that comes from the Internet to the address 198.51.100.2 on port 80 will be redirected to the internal address 172.16.0.2 to the same 80th port. </font><font style="vertical-align: inherit;">Of course, you can also forward UDP and redirect from one port to another. </font><font style="vertical-align: inherit;">This, for example, can be useful if you have two computers that need access via RDP from the outside. </font><font style="vertical-align: inherit;">RDP uses port 3389. You cannot forward the same port to different hosts (using the same external address). </font><font style="vertical-align: inherit;">Therefore, you can do this:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Router (config) # ip nat inside source source static tcp 172.16.6.61 3389 198.51.100.2 3389 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Router (config) # ip nat inside source source static tcp 172.16.6.66 3389 198.51.100.2 3398</font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then, to get to the computer 172.16.6.61, you start the RDP-session on port 198.51.100.2:34389, and on 172.16.6.66 - 198.51.100.2:37398. </font><font style="vertical-align: inherit;">The router itself scatters everything where it is necessary. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, this command is a special case of the very first: ip nat inside source static 172.16.6.66 198.51.100.2. </font><font style="vertical-align: inherit;">Only in this case we are talking about forwarding all traffic, and in our examples - specific ports of the TCP protocol. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is how in general it functions NAT. </font><font style="vertical-align: inherit;">A lot of articles have been written about its features, pros and cons, but it is impossible not to mention them.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Weaknesses and strengths of NAT </font></font></h2><br><h3>  + </h3><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- First of all,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NAT allows you to save public IP addresses. Actually for this he was created. Through one address, theoretically, it is possible to release more than 65000 gray addresses (by the number of ports). </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Secondly</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , PAT and dynamic NAT is to some extent a firewall, preventing external connections from reaching end computers where your firewall and antivirus may not be present. The fact is that if a package comes from the outside to the saturating device, which is not expected or not allowed here, it is simply discarded. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order for a packet to be missed and processed, the following conditions must be met: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) The NAT table must have an entry for this external address, specified as the sender's address in the packet</font></font><br>  AND <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2) The sender port in the packet must match the port for this white address in the entry </font></font><br>  AND <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3) The destination port in the packet matches the port in the entry. </font></font><br>  OR <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Port forwarding is configured. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But it is not necessary to consider NAT as a firewall - it is nothing more than an additional bun. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Thirdly</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , NAT hides the internal structure of your network from prying eyes - when you trace a route from the outside, you will not see anything further than the saturating device.</font></font><br><br><h3>  - </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NAT has some disadvantages. The most tangible of them, perhaps, are the following: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Some protocols cannot work through NAT without crutches. For example, FTP or tunneling protocols (despite how simple I set up FTP in the lab, in real life this can create a lot of problems) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Another problem lies in the fact that there are a lot of requests for one server from one address. Many have witnessed this when you go to some Rapidshare, and he says that you already had a connection from your IP, you think that ‚Äúlying, dog‚Äù, and this is your neighbor already sucking. For the same reason, there were problems with ICQ when the server was denied registration.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- The problem is not very relevant now: the load on the processor and RAM. Since the amount of work is quite large compared to simple routing (it‚Äôs not just to look at the IP header, you need to remove it, remove the TCP header, add new headers to the table) in small offices there are problems with this. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I </font></font><a href="http://habrahabr.ru/post/111990/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">came across</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> such a situation. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One of the possible solutions is to bring the NAT function to a separate PC or to a specialized device, such as the Cisco ASA. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For big players who have routers pushing 3-4 BGP full-views, this is not a problem now.</font></font><br><br>  What else do you need to know? <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- NAT is used mainly to provide Internet access to hosts with private addresses. But there is another use - the connection between two private networks with overlapping address spaces. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, your company buys a branch in Aktyubinsk. You have the addressing 10.0.0.0-10.1.255.255, and they have 10.1.1.0-10.1.10.255. The ranges are clearly intersected; it is impossible to configure routing in any way, because the same address can be in Aktyubinsk and at your headquarters. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this case, NAT is configured at the interface. Since we do not have gray addresses, for example, we can single out a range of 10.2.1.0-10.2.10.255 and do one-to-one translation: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.1.1-10.2.1.1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.1.2-10.2.1.2</font></font><br>  ... <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.10.255-10.2.10.255 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- In large adult toys, NAT can be implemented on a separate board (and often it is) and will not work without it. </font><font style="vertical-align: inherit;">And on the office glands, by contrast, there is almost always. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- With the widespread adoption of IPv6, the need for NAT will be eroded. </font><font style="vertical-align: inherit;">Already, large customers are beginning to be interested in the functionality of NAT64 - this is when you have access to the world via IPv4, and the internal network is already on IPv6 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Of course, this is only a superficial look at NAT and there is still a sea of ‚Äã‚Äãnuances that will not help you to educate yourself.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NAT practice </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">What does reality require of us? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) The management network does not have access to the Internet at all </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) Hosts from the VET network have access only to specialized sites, for example, Linkmeup.ru </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) For lovely ladies from accounting, you need to cut down the window into the world of client-banks. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4) Do not release the FDO anywhere except for the financial director </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5) On the Other network, our computer and the administrator's computer - we will give them full access to the Internet. All others can be opened by written request. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6) Do not forget about the branches in St. Petersburg and Kemerovo. For simplicity, we configure full access for the eniki from these subnets. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7) With servers, a separate song. For them, we set up port forwarding. All we need is: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a) The web server should be accessible on port 80</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b) Mail server on the 25th and 110th </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c) File server is accessible from the world via FTP. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8) Admin and our computers should be accessible from the Internet via RDP. Actually, this is the wrong way - for a remote connection, you need to use a VPN connection and already using RDP on the local network, but this is a separate topic for a completely different article. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At first we will prepare a test platform: </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet connection will be organized through an existing link provided by the provider.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">He goes to the network provider. We remind you that everything in this cloud is an abstract network, which in reality can consist of dozens of routers and hundreds of switches. But we need something manageable and predictable, so we are installing another router here. On the one hand there is a link to it from the switch, from another server on the Internet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will need the following servers: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Two client-banks for accountants (sperbank.ru, mmm-bank.ru) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Linkmeup.ru for PTOshchnikov </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Yandex (yandex.ru) </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9e7/bfe/51c/9e7bfe51c689152289c0f3bc42055857.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For such a connection, we will raise one more vlan to msk- arbat-gw1. His number, of course, is consistent with the provider. Let it be VLAN 6 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suppose a provider provides us with a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">subnet 198.51.100.0/28</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The first two addresses are used to organize the link (198.51.100.1 and 198.51.100.2), and we use the remaining ones as a pool for NAT. </font><font style="vertical-align: inherit;">However, no one absolutely prevents us from using the address 198.51.100.2 for the pool. </font><font style="vertical-align: inherit;">So </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">let's</font></font></b> <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do it: </font><b><font style="vertical-align: inherit;">pool: 198.51.100.2-198.51.100.14</font></b></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For simplicity, let's assume that we have public servers on the same subnet: </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.0.2.0/24</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How to set up a link and addresses you are already quite up to date. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since we have only one router in the network of the provider, and all the networks are connected directly to it, there is no need to configure the routing. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But our msk-arbat-gw1 should know where to send packets to the Internet, so we need a default route:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> msk-arbat-gw1 (config) # ip route 0.0.0.0 0.0.0.0 198.51.100.1 </font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now, in order. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First, set up an address pool.</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> msk-arbat-gw1 (config) # ip nat pool main_pool 198.51.100.2 198.51.100.14 netmask 255.255.255.240 </font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now we collect ACL: </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> msk-arbat-gw1 (config) # ip access-list extended nat-inet </font></font><br></blockquote><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1) Management Network </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doesn't have internet access at all </font></font><br>  Is done <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2) Hosts from the PTO network </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> They have access only to specialized sites, for example, Linkmeup.ru </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> msk-arbat-gw1 (config-ext-nacl) # permit tcp 172.16.3.0 0.0.0.255 host 192.0.2.2 eq 80 </font></font><br></blockquote><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 3) Accounting </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We give access to all hosts on both servers. </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-ext-nacl) # permit ip 172.16.5.0 0.0.0.255 host 192.0.2.3 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-ext-nacl) # permit ip 172.16.5.0 0.0.0.255 host 192.0.2.4</font></font><br></blockquote><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4) FEO </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We give permission only to the financial director - this is only one host. </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> msk-arbat-gw1 (config-ext-nacl) # permit ip host 172.16.4.123 any </font></font><br></blockquote><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5) Other </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Our full access computers </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-ext-nacl) # permit ip host 172.16.6.61 any </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-ext-nacl) # permit ip host 172.16.6.66 any</font></font><br></blockquote><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6) Branches in St. Petersburg and Kemerovo </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Let enikiev addresses be the same: 172.16.x.222 </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-ext-nacl) # permit ip host 172.16.16.222 any </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-ext-nacl) # permit ip host 172.16.17.222 any </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-ext- nacl) # permit ip host 172.16.24.222 any</font></font><br></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is what the ACL looks like now: </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip access-list extended nat-inet </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remark PTO </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit tcp 172.16.3.0 0.0.0.255 host 192.0.2.2 eq www </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remark ACCOUNTING </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip 172.16.5.0 0.0.0.255 host 192.0.2.3 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip 172.16.5.0 0.0.0.255 host 192.0.2.4 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remark FEO </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip host 172.16.4.123 any </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remark IAM </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip host 172.16.6.61 any </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remark ADMIN </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip host 172.16.6.66 any </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remark SPB_VSL_ISLAND </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip host 172.16.16.222 any </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remark SPB_OZERKI </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip host 172.16. 17.222 any </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">remark KMR </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">permit ip host 172.16.24.222 any</font></font><br></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Run:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> msk-arbat-gw1 (config) # ip nat inside source list list nat-inet pool main_pool overload </font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But happiness will not be complete without configuring the interfaces: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the external interface, you must give the command </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip nat outside</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> On the inside: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip nat inside</font></font></b> <br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) # int fa0 / 0.101 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-subif) # ip nat inside </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) # int fa0 / 0.102 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-subif) # ip nat inside </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) # int fa0 / 0.103 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-subif) # ip nat inside </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) # int fa0 / 0.104 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 ( config-subif) # ip nat inside </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) # int fa0 / 1.6 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-subif) # ip nat outside</font></font><br></blockquote><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will allow the router to understand where to wait for the packets that need to be processed and where to send them then. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order for servers on the Internet to be accessible by a domain name, it would be nice for us to acquire a DNS server on our network: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/557/f8e/496/557f8e49632d6f395053eec5a939c89c.png"><img src="https://habrastorage.org/getpro/habr/post_images/127/013/278/127013278ac9883917df88e0b1189957.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Naturally, we need to register it on those devices from which we will check access: </font></font><br><img src="https://habrastorage.org/getpro/habr/post_images/af3/2d8/4a7/af32d84a7ffe708d2781210358c30b12.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Show must go on! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything </font></font><br><img src="https://habrastorage.org/getpro/habr/post_images/94a/1dc/8c0/94a1dc8c036ac5c963dfbf05792fe2ef.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is available from the administrator's </font><font style="vertical-align: inherit;">computer: </font><font style="vertical-align: inherit;">From the TVET network there is only access to the site linkmeup.ru on port 80 (HTTP): </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a4e/760/904/a4e760904d01042da62991e98bb36d37.png"><img src="https://habrastorage.org/getpro/habr/post_images/466/817/264/466817264c306f6654a06619563fb67f.png"><img src="https://habrastorage.org/getpro/habr/post_images/0a0/ad2/be8/0a0ad2be8c4d36be5c9c3f5f04054ae0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Only 4.123 goes to the world in the FD network ( </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f46/f25/80e/f46f2580efda48a8951a1c95fd1c0356.png"><img src="https://habrastorage.org/getpro/habr/post_images/65f/8b6/451/65f8b64513c525111010f8d660fcd4b2.png"><img src="https://habrastorage.org/getpro/habr/post_images/d58/dca/742/d58dca7429e54dbf0b6839d1fe158af1.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">financial </font><font style="vertical-align: inherit;">director) </font><font style="vertical-align: inherit;">Only client-bank websites work in the accounting department. </font><font style="vertical-align: inherit;">But, since permission is given entirely on the IP protocol, they can also be pinged:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/895/6ca/917/8956ca917510ae05fc3eb8a7b83b9707.png"><img src="https://habrastorage.org/getpro/habr/post_images/32a/81c/4b0/32a81c4b0d73219a5a29d0c22dbdbe07.png"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7) Server </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Here we need to configure port forwarding so that they can be accessed from the Internet: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb1/4c3/6cf/bb14c36cf4eab72c90eff6444b71e1d8.png"><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a) Web server </font></font></h4><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> msk-arbat-gw1 (config) # ip nat inside static source tcp 172.16.0.2 80 198.51.100.2 80 </font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Immediately check, for example, we can do this with a test PC with ares 192.0.2.7. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now nothing will work, because for the network of servers we have not configured the interface on msk-arbat-gw1:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) # int fa0 / 0.3 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config-subif) # ip nat inside</font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And now: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff1/c57/850/ff1c5785021535cc56f0183866e279e9.png"><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> b) File server </font></font></h4><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) # ip nat inside static source tcp 172.16.0.3 20 198.51.100.3 20 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) # ip nat inside static tcp 172.16.0.3 21 198.51.100.3 21</font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For this purpose, in the servers-out ACL, we also opened ports 20-21 for all </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/453/cff/3eb/453cff3eb85be63efd5663cbd464231a.png"><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> c) Mail Server </font></font></h4><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) # ip nat inside source static tcp 172.16.0.4 25 198.51.100.4 25 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) # ip nat inside source static tcp 172.16.0.4 110 198.51.100.4 110</font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check is also not difficult. </font><font style="vertical-align: inherit;">Follow the instructions: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First, we configure the mail server. </font><font style="vertical-align: inherit;">Specify the domain and create two users. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b8f/d2f/d45/b8fd2fd4551b32111885350a4b482ded.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, make the domain in DNS. </font><font style="vertical-align: inherit;">This step is optional - you can also access the server by IP, but why not? </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/784/92e/7d6/78492e7d68751caabe172f889cb2e03f.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We configure the computer from our network: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/33b/2c6/211/33b2c6211c5c4b3fa5ba778ec665861a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the outside: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/31a/5ab/019/31a5ab019b236f0345f3245570859dc6.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We are preparing a letter: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/462/238/37d/46223837dba13f5a74ee0413bdf2c76a.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the local host, press Receive:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2e5/3c1/402/2e53c14025c94625fb7d7b7062a29564.png"><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8) Access via RDP to the computers of the administrator and ours </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) # ip nat inside static source tcp 172.16.6.61 3389 198.51.100.10 3389 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msk-arbat-gw1 (config) # ip nat inside source static static tcp 172.16.6.66 3389 198.51.100.10 3398</font></font><br><br><h2>  Security </h2><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lastly, one remark. </font><font style="vertical-align: inherit;">Most likely a natatorial device, you have your ip nat outside interface looking outside - on the Internet. </font><font style="vertical-align: inherit;">Therefore, on this interface would not hurt to hang the ACL, where you deny, allow what you need. </font><font style="vertical-align: inherit;">We will not dwell on this question in this article. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At this first acquaintance with the technology of NAT can be considered complete. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As one more remote answer, answer the question why there is no Internet access from enike computers in St. Petersburg and Kemerovo. </font><font style="vertical-align: inherit;">After all, we have already added them to the access list.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Release materials </font></font></h1><br> <a href="https://docs.google.com/spreadsheet/ccc%3Fkey%3D0AooexOHebRpTdHJROEtQcVM1MzcxNXJGeklfQXMxYUE%26amp%3Busp%3Dsharing"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">New IP plan, switching plans for each point and regulations </font></font></a> <br> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File RT with laboratory </font></font></a> <br> <a href="https://docs.google.com/document/pub%3Fid%3D1zrEZnmT2CjPKj36XccnJ30itKKFq70BE0n4BaIpox_Q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Device configuration</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Additional links: </font></font><br> <a href="http://telenetwork.narod.ru/index.html%3FDoc/Cisco/nat.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">General information and TCP load distribution </font></font></a> <br> <a href="http://habrahabr.ru/post/117573/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Two providers + NAT </font></font></a> <br> <a href="http://www.cisco.com/networkers/nw00/pres/2212_6-28.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Useful information from cisco </font></font></a> <br> <a href="http://habrahabr.ru/users/ilyapodkopaev/topics/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Our colleague habrayuzer wrote several articles on the features of NAT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><a href="http://habrahabr.ru/post/84060/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> may be of particular interest </font><font style="vertical-align: inherit;">. </font></font><br> <a href="http://www.cisco.com/en/US/tech/tk648/tk361/technologies_tech_note09186a0080094831.shtml"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But be that as it may, no one will write about cisco better than cisco. </font></font></a> <br> <a href="http://habrahabr.ru/post/131712/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Back mask</font></font></a> <br><br><h1>  Bonuses </h1><br><a name="PBR"></a><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Setting up PBR for an example from the article</font></font></b> <div class="spoiler_text"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In global configuration mode. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add a default route:</font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ip route 0.0.0.0 0.0.0.0 10.0.1.1 </font></font><br></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In the access list, we filter traffic from the 192.168.2.0/24 network. </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> access-list 101 permit ip 192.168.2.0 0.0.0.255 any </font></font><br></blockquote><br>   ,  ,      192.168.2.0/24,     next-hop 10.0.2.1 ( 10.0.1.1) <br><br><blockquote> route-map CLIENT permit 5 <br> match ip address 101 <br> set ip next-hop 10.0.2.1 <br></blockquote><br>    : <br><blockquote> ip policy route-map CLIENT <br></blockquote><br>        Policy-Based Routing, ,  ,        . <br></div></div><a name="rate-limit"></a><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACL-based interface speed limits</font></font></b> <div class="spoiler_text">         192.168.1.0/24  1.5 /,   192.168.2.0/24  64 /. <br>  10.0.1.1    : <br><blockquote> Router(config)# access-list 100 permit ip 192.168.1.0 0.0.0.255 any <br> Router(config)# access-list 101 permit ip 192.168.2.0 0.0.0.255 any <br> Router(config)# interface fa0/0 <br> Router(config-if)# rate-limit output access-group 100 1544000 64000 64000 conform-action transmit exceed-action drop <br> Router(config-if)# rate-limit output access-group 101 64000 16000 16000 conform-action transmit exceed-action drop <br></blockquote><br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Urgent questions bezhabernym people can be realized in the </font></font><a href="http://eucariot.livejournal.com/69563.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LJ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanks to my co-author of </font></font><a href="http://habrahabr.ru/users/thegluck/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">thegluck. Special</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> thanks for helping us with the </font><a href="http://habrahabr.ru/users/jdima/" class="user_link"><font style="vertical-align: inherit;">JDima</font></a><font style="vertical-align: inherit;"> article </font></font><a href="http://habrahabr.ru/users/jdima/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></a> <br></div><p>Source: <a href="https://habr.com/ru/post/147996/">https://habr.com/ru/post/147996/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147987/index.html">Efficiency of the Degasser in Breaking Bad</a></li>
<li><a href="../147988/index.html">Firefox 14 is available for download.</a></li>
<li><a href="../147990/index.html">We translate from Bencode to XML</a></li>
<li><a href="../147991/index.html">Quadcopter-R2. Upgrade</a></li>
<li><a href="../147993/index.html">The largest index of pirated content</a></li>
<li><a href="../147999/index.html">"Toy" cartography or 3D cards do it yourself</a></li>
<li><a href="../148000/index.html">Edit-in-place on Bootstrap components</a></li>
<li><a href="../148001/index.html">Review of fresh materials, April-June 2012</a></li>
<li><a href="../148002/index.html">The ideal student, or what is silent in machine learning</a></li>
<li><a href="../148003/index.html">Completed the contest on VK messenger for Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>