<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Checking WPF source code for examples from Infragistics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to test various C # projects to demonstrate the capabilities of the PVS-Studio static code analyzer. In this article, we will review the r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Checking WPF source code for examples from Infragistics</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/769/104/36b/76910436b663db1f3dc311bc33b9438b.png"></div><br>  We continue to test various C # projects to demonstrate the capabilities of the PVS-Studio static code analyzer.  In this article, we will review the results of testing WPF examples from Infragistics.  Infragistics itself is a global software provider founded in 1989.  The company has made a name for itself in the development of user interface components for third-party developers on all platforms, including .NET. <br><a name="habracut"></a><br>  In PVS-Studio 6.00, we basically implemented C # general diagnostics based on the experience of the C ++ analyzer we created earlier.  Starting from PVS-Studio 6.01, we started creating diagnostics specialized for C # language.  For the start, the dependency properties (DependencyProperty) used in WPF projects were selected.  On DependencyProperty the choice fell due to the complexity of their creation.  The difficulty is that it is very easy to make a typo in the same type of code, which WPF projects.  We have developed a number of diagnostics [ <a href="http://www.viva64.com/ru/d/0440/">3044</a> , <a href="http://www.viva64.com/ru/d/0441/">3045</a> , <a href="http://www.viva64.com/ru/d/0442/">3046</a> , <a href="http://www.viva64.com/ru/d/0443/">3047</a> , <a href="http://www.viva64.com/ru/d/0444/">3048</a> , <a href="http://www.viva64.com/ru/d/0445/">3049</a> ], specializing in the analysis and testing of similar properties. <br><br>  As you know, one of the features of DependencyProperty is that in most cases, any error during their registration will cause the program to crash at the execution stage (at runtime).  Willy-nilly, programmers fix similar errors by running the program again and again.  Thereby, precious minutes are spent searching for a typo in the template code for creating the DependencyProperty, and a total of hours are spent.  At the same time, as the practice of checking WPF projects has shown, not all errors in dependency properties are obvious after the first launch of the program. <br><br>  The first test code for these diagnostics was the code of test examples from <a href="http://www.infragistics.com/">Infragistics</a> .  The archive was loaded 02.02.2016 <a href="http://www.infragistics.com/samples/wpf/application-samples">from here</a> , the number of projects reaches 11 pieces, but you can download them <a href="">all in one archive</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Checking the source code was performed using the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> 6.01 static analyzer. <br><br><h2>  WPF errors </h2><br>  Many projects are based on a common reusable code, in which most errors are found. <br><br>  <b>Error n1</b> <br><br>  In the project ‚ÄúIGExtensions.Common.WPF‚Äù in the file ‚ÄúLambertConformalConic.cs‚Äù the following registration line ‚ÄúDependencyProperty‚Äù was found: <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> DependencyProperty CentralMeridianProperty = DependencyProperty.Register(<span class="hljs-string"><span class="hljs-string">"CentralMeridianProperty"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(LambertConformalConic), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyMetadata(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyChangedCallback(UpdateConstants)));</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0441/">V3045</a> WPF: The Central Meridian Project, and the Central Meridian, do not correspond to each other.  LambertConformalConic.cs 130 <br><br>  As you can see, when registering a DependencyProperty in its name, it was indicated ‚ÄúCentralMeridianProperty‚Äù instead of ‚ÄúCentralMeridian‚Äù.  The error is made quite often due to copying the name of a variable, but it carries the following danger. <br><br>  Namely, for writing / reading in a dependency property, C # code creates the following interlayer property: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> CentralMeridian { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)GetValue(CentralMeridianProperty); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetValue(CentralMeridianProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } }</code> </pre> <br>  When accessing from the xaml markup, the binding write to the "CentralMeridian" property.  WPF is smart enough to find the CentralMeridian property and initially read the value from there, but the value changes in CentralMeridian will not naturally be picked up. <br><br>  <b>N2 error</b> <br><br>  Continuing the topic of typos in the names of the registered dependency properties, we consider the following error in the TransverseMercator.cs file of the IGExtensions.Common.WPF project. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> DependencyProperty CentralMeridianProperty = DependencyProperty.Register(<span class="hljs-string"><span class="hljs-string">"LongitudeOrigin"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(TransverseMercator), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyMetadata(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyChangedCallback(UpdateConstants))); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> CentralMeridian { .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0441/">V3045</a> WPF: 'This is a list of the' LongitudeOrigin ', and of the property of the' CentralMeridian ', do not correspond with each other.  TransverseMercator.cs 95 <br><br>  As practice shows, dependency properties are prescribed en masse, with the help of multiple duplication of one line and subsequent edits.  In other words, using <a href="http://www.viva64.com/ru/t/0068/">Copy-Paste</a> .  And often, somewhere in this block of the same type of code, one variable is passed and another name is written to it, which was next to it in the list.  And given that the list itself is usually located somewhere in the [Notepad, Notepad ++, Sublime Text, etc.] notebook next to another window, you can check the creation of all the necessary objects only with your eyes.  To identify such errors is very difficult, because  The code is quite working, but the truth is only half. <br><br>  <b>Error n3</b> <br><br>  With errors in the names of the registered properties everything seems to be clear, but where else can you make a mistake when creating a DependencyProperty?  Well, for example, in the types of values ‚Äã‚Äãthat should be contained in them, as in the file ‚ÄúPropertyBrushColorEditor.cs‚Äù of the same project ‚ÄúIGExtensions.Common.WPF‚Äù. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> DependencyProperty BrushColorProperty = DependencyProperty.Register(BrushColorPropertyName, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Brush), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(PropertyBrushColorEditor), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyMetadata(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, (sender, e) =&gt; {....}) ); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SolidColorBrush BrushColor { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (SolidColorBrush)GetValue(BrushColorProperty); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetValue(BrushColorProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0442/">V3046</a> WPF: DependencyProperty doesn‚Äôt correspond to the type used for access it. <br><br>  If you have no questions, why it is wrong to specify the parent class "Brush" when registering, and if you use the "BrushColor" property to specify a descendant of the "SolidColorBrush", then this is good.  Otherwise, we describe a simplified case of such a ‚Äúgame‚Äù with stored types. <br><br>  For example, imagine a simple case.  Create a simple WPF project and add the following dependency property to the window class: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> DependencyProperty MyIndexProperty = DependencyProperty.Register(<span class="hljs-string"><span class="hljs-string">"MyIndex"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(MainWindow), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FrameworkPropertyMetadata(<span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MyIndex { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)GetValue(MyIndexProperty); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetValue(MyIndexProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } }</code> </pre> <br>  In the xaml markup we write the following: <br><br><pre> <code class="cs hljs">....Title=<span class="hljs-string"><span class="hljs-string">"MainWindow"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"350"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"525"</span></span> DataContext=<span class="hljs-string"><span class="hljs-string">"{Binding RelativeSource = {RelativeSource Mode=Self}}"</span></span>&gt; &lt;Grid&gt; &lt;Grid.RowDefinitions&gt; &lt;RowDefinition Height=<span class="hljs-string"><span class="hljs-string">"Auto"</span></span> /&gt; &lt;RowDefinition Height=<span class="hljs-string"><span class="hljs-string">"Auto"</span></span> /&gt; &lt;RowDefinition Height=<span class="hljs-string"><span class="hljs-string">"Auto"</span></span> /&gt; &lt;/Grid.RowDefinitions&gt; &lt;TextBlock Grid.Row=<span class="hljs-string"><span class="hljs-string">"0"</span></span> Text=<span class="hljs-string"><span class="hljs-string">"{Binding Path=MyIndex}"</span></span>/&gt; &lt;Slider Grid.Row=<span class="hljs-string"><span class="hljs-string">"1"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"slider1"</span></span> Value=<span class="hljs-string"><span class="hljs-string">"{Binding Path=MyIndex}"</span></span> Maximum=<span class="hljs-string"><span class="hljs-string">"100"</span></span> /&gt; &lt;Button Grid.Row=<span class="hljs-string"><span class="hljs-string">"2"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"Button_Click"</span></span>&gt;   &lt;/Button&gt; &lt;/Grid&gt;</code> </pre> <br>  And add the code for the button press event to the window class: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Button_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Title = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.MyIndex.ToString(); }</code> </pre> <br>  Everything.  How can you make sure everything works?  Move the slider, the number changes.  Click on the button, and the title of the window immediately changed its text to the current value in the slider.  By the way, as you can see, integer values ‚Äã‚Äãare displayed in TextBlock. <br><br>  Now let's replace the type with ‚Äúint‚Äù with the generic ‚Äúobject‚Äù type when registering a DependencyProperty: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> DependencyProperty MyIndexProperty = DependencyProperty.Register(<span class="hljs-string"><span class="hljs-string">"MyIndex"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(MainWindow), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FrameworkPropertyMetadata(<span class="hljs-number"><span class="hljs-number">1</span></span>));</code> </pre> <br>  Leave the rest unchanged and run the program again. <br><br>  The program has started and now, when we move the slider, real values ‚Äã‚Äãare displayed in TextBlock.  As it is easy to guess, if we try to press a button, the program will simply fall, because  it cannot convert a real value into MyIndexProperty into an integer in the property MyIndex.  It would seem a trifle, but it led to sad consequences. <br><br>  <b>Error n4</b> <br><br>  In addition to the above errors, which relate to most projects (which is especially sad, because they have never been noticed or corrected in any project), there are local errors for one project IGEquityTrading.WPF: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> DependencyProperty AxisFinancialIndicatorYTemplateProperty = DependencyProperty.Register(<span class="hljs-string"><span class="hljs-string">"AxisFinancialIndicatorYTemplate"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(DataTemplate), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(DataChartEx), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyMetadata(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(DataTemplate))); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DataTemplate AxisCategoryYTemplate{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (DataTemplate) GetValue(AxisFinancialIndicatorYTemplateProperty); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetValue(AxisFinancialIndicatorYTemplateProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0441/">V3045</a> WPF:  DataChartEx.cs 469 <br><br>  And again Infragistics comes on the same rake, instead of the registered name "AxisFinancialIndicatorYTemplate" create a property with the name "AxisCategoryYTemplate". <br><br>  <b>Error n5</b> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> DependencyProperty FinancialIndicatorSeriesTemplateProperty = DependencyProperty.Register(<span class="hljs-string"><span class="hljs-string">"FinancialIndicatorTemplate"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(DataTemplate), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(DataChartEx), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyMetadata(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(DataTemplate))); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DataTemplate FinancialIndicatorSeriesTemplate { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (DataTemplate) GetValue(FinancialIndicatorSeriesTemplateProperty); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetValue(FinancialIndicatorSeriesTemplateProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0441/">V3045</a> WPF:  DataChartEx.cs 344 <br><br>  In the latter case, the error most likely arose after refactoring, when they decided to concretize the variable, and inserted the word ‚ÄúSeries‚Äù in the middle of the phrase ‚ÄúFinancialIndicatorTemplate‚Äù.  The most interesting thing is that they changed it everywhere, even in the XAML markup and in "#region", but they have forgotten the name of the registered property. <ul><li>  .... \ Infra \ EquityTrading \ IGEquityTrading.WPF \ App.xaml (123): &lt;DataTemplate x: Key = "FinancialIndicatorSeriesTemplate"&gt; </li><li>  .... \ Infra \ EquityTrading \ IGEquityTrading.WPF \ App.xaml (214): FinancialIndicatorSeriesTemplate = "{StaticResource FinancialIndicatorSeriesTemplate}" </li><li>  .... \ Infra \ EquityTrading \ IGEquityTrading.WPF \ Controls \ DataChartEx.cs (189): var financialIndicator = FinancialIndicatorSeriesTemplate.LoadContent () as Series; </li><li>  .... \ Infra \ EquityTrading \ IGEquityTrading.WPF \ Controls \ DataChartEx.cs (330): #region FinancialIndicatorSeriesTemplate (DependencyProperty) </li><li>  .... \ Infra \ EquityTrading \ IGEquityTrading.WPF \ Controls \ DataChartEx.cs (336): public DataTemplate FinancialIndicatorSeriesTemplate </li><li>  .... \ Infra \ EquityTrading \ IGEquityTrading.WPF \ Controls \ DataChartEx.cs (349): #endregion FinancialIndicatorSeriesTemplate (DependencyProperty) </li><li>  .... \ Infra \ EquityTrading \ IGEquityTrading.WPF \ Controls \ StockHistoryChart.xaml (646): FinancialIndicatorSeriesTemplate = "{StaticResource FinancialIndicatorSeriesTemplate}" </li></ul><br>  At the same time, the registered name ‚ÄúFinancialIndicatorTemplate‚Äù is not used anywhere, and we already know what this mistake leads to. <br><br><h2>  Non-C # Errors </h2><br>  There were no more WPF errors in these assemblies from Infragistics.  As already mentioned, most WPF diagnostics are designed specifically for pre-finding errors before compiling and running the project.  And these projects with examples of the use of components have already been tested by programmers and QA specialists.  Additionally, the projects were viewed by users who rated the quality and usability of the product using test examples.  I think if they noticed a mistake, then most likely they notified the developers. <br><br>  Naturally, besides WPF errors, there are others in these assemblies.  The analyzer issued a total of several hundred warnings.  Not all of the messages indicate a real error.  Many warnings (for example, about comparing double type with constant) are simply not relevant for this type of project.  This is not a problem, since the analyzer provides several mechanisms for suppressing uninteresting messages. <br><br>  In any case, there are many warnings, and most of them indicate anomalies in the code.  These are the real errors or the code "with a smell".  Therefore, we recommend the authors of the project to independently carry out a project check and examine the warnings.  Here we will go through only the most interesting of them: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsValid { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> valid = <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.IsNaN(Latitude) || <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.IsNaN(Latitude) || <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Weather.DateTime == Weather.DateTimeInitial; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> valid; } }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0381/">V3001</a> There are identical sub-expressions 'double.IsNaN (Latitude)'  operator.  WeatherStation.cs 25 <br><br>  Programmers live hard.  They should understand not only the programming itself, but also the area where the program should work.  So it turns out that they have to understand the subject area and know words such as ‚ÄúVira‚Äù (Up), ‚ÄúLane‚Äù (Down), ‚ÄúLatitude‚Äù (Latitude), ‚ÄúLongitude‚Äù (Longitude), etc.  This only adds complexity, especially if the concepts are similar in writing.  It turns out that we erroneously write the check of the same variable: double.IsNaN (Latitude) ||  double.IsNaN (Latitude). <br><br>  The following error: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clipSegment</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xmax &gt; rc.Right &amp;&amp; xmax &gt; rc.Right) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0381/">V3001</a> There are identical sub-expressions "xmax&gt; rc.Right" to the left.  Geometry.  Geometry.CubicSpline.cs 529 <br><br>  Checking the extent to which a variable lies is a common thing, but it is rather easy to make mistakes in signs, and then in a variable that needs to be written.  In fact, to eliminate such errors, you just need to adhere to the following pattern: the general variable in the condition is written from different sides in expressions. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xmin &lt; rc.Right &amp;&amp; rc.Right &lt; xmax)</code> </pre> <br>  Making mistakes is harder and easier to read. <br><br>  PS True, such a focus does not work in the Entity Framework, when the LINQ code is converted into an SQL query, the program will crash.  These are the things here :) <br><br>  In fact, in this Infragistics project, I‚Äôve been too smart with such checks.  In addition to the above code, a similar error was repeated in the following lines: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clipSegment</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ymin &lt; rc.Top &amp;&amp; ymin &lt; rc.Top) <span class="hljs-comment"><span class="hljs-comment">//&lt;=  .... if (ymax &gt; rc.Bottom &amp;&amp; ymax &gt; rc.Bottom) //&lt;=   .... }</span></span></code> </pre> <br>  Diagnosis of the <a href="http://www.viva64.com/ru/d/0381/">V3001 is</a> not enough of these errors, and it continues to expand on the project :).  Here is another example of its operation: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsInDesignModeStatic</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Application app</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_isInDesignMode != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; _isInDesignMode.HasValue) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _isInDesignMode.Value; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0381/">V3001</a> There are identical sub-expressions '_isInDesignMode! = Null' operator.  NavigationApp.cs 415 <br><br>  In this case, we are dealing not with an error, but with a redundant code.  It was enough to write: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_isInDesignMode.HasValue)</code> </pre> <br>  Another V3001 trigger sends us to the ‚ÄúIgWord.Infrastructure‚Äù project: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParagraphSettingsPreviewAdapter_PropertyChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, PropertyChangedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (LineSpacingType == Infrastructure.LineSpacingTypes.Exactly || LineSpacingType == Infrastructure.LineSpacingTypes.Exactly){ .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0381/">V3001</a> There are identical sub-expressions 'LineSpacingType == Infrastructure.LineSpacingTypes.Exactly' to the left  operator.  ParagraphSettingsPreviewAdapter.cs 268 <br><br>  What exactly the developer wanted to do here is not very clear, but clearly not what is written. <br><br>  From V3001, in turn, go to V3010. <br><br>  In the IGEarthQuake.WPF project, there are a couple of function calls: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MapViewModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... WeakPropertyChangedListener.CreateIfNecessary(_service, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0406/">V3010</a> CreateIfNecessary 'is required to be utilized.  MapViewModel.cs 42 <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimeLineViewModel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ .... WeakPropertyChangedListener.CreateIfNecessary(_service, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0406/">V3010</a> CreateIfNecessary 'is required to be utilized.  TimeLineViewModel.cs 50 <br><br>  Actually, in both cases one function is called, and it is quite simple.  Let's look at its implementation: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> WeakPropertyChangedListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateIfNecessary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> source, IPropertyChangedListener listener</span></span></span><span class="hljs-function">)</span></span>{ INotifyPropertyChanged inpc = source <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> INotifyPropertyChanged; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> inpc != <span class="hljs-literal"><span class="hljs-literal">null</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WeakPropertyChangedListener(inpc, listener) : <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br>  Indeed, as you can see, the function does not produce any global changes, and its result is also not used.  So the question arises - why was she called at all?  Suspicious of all this ... <br><br>  A similar example is waiting for us in the project ‚ÄúIGHospitalFloorPlan.WPF‚Äù: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParseAllShapefiles</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ShapeFilesMaxBounds.Expand(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thickness(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0406/">V3010</a> The return value of the function 'Expand' is required to be utilized.  HospitalView.xaml.cs 52 <br><br>  Its implementation is a bit more cunning, but in the end it simply returns a new object that is not used anywhere. <br><br>  We are in the middle of the article.  Look at the picture.  Relax, and then we will continue. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac6/160/6ee/ac61606ee2b59a4b244bae2ffcabd131.png"></div><br><br>  One of the most common types of errors is unsuccessful Copy-Paste code: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> EsriMapImageryView </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetImageryView</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EsriMapImageryStyle imageryStyle</span></span></span><span class="hljs-function">)</span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (imageryStyle == EsriMapImageryStyle.UsaPopulationChange2010Overlay) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EsriMapImageryViews.UsaPopulationChange2010Overlay; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (imageryStyle == EsriMapImageryStyle.UsaPopulationChange2010Overlay) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EsriMapImageryViews.UsaPopulationChange2010Overlay; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0390/">V3021</a> There are two 'if' statements with identical conditional expressions.  The first 'if' statement contains method return.  This means that the statement is a senseless statement. EsriMapImageryView.cs 97 <br><br>  In this case, the same code is under the same condition.  At this stage, the error is an unsuccessful (redundant) Copy-Paste code.  But after refactoring, a situation may arise that the programmer will change the body of the lower-level if statement, which is never executed, which will lead to errors in the program logic. <br><br>  And let's see what other errors are found in the code of the company Infragistics. <br><br>  For each line below, warning <a href="http://www.viva64.com/ru/d/0391/">V3022</a> was issued: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateTemperature</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GeoLocation location</span></span></span><span class="hljs-function">)</span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.Latitude &gt; <span class="hljs-number"><span class="hljs-number">10</span></span> || location.Latitude &lt; <span class="hljs-number"><span class="hljs-number">25</span></span>) .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.Latitude &gt; <span class="hljs-number"><span class="hljs-number">-40</span></span> || location.Latitude &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) .... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> WeatherCondition </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateWeatherCondition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.Latitude &gt; <span class="hljs-number"><span class="hljs-number">10</span></span> || location.Latitude &lt; <span class="hljs-number"><span class="hljs-number">25</span></span>) .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location.Latitude &gt; <span class="hljs-number"><span class="hljs-number">-40</span></span> || location.Latitude &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) .... }</code> </pre> <br>  All errors are reduced to the following message: <br><br>  <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'location.Latitude&gt; -40 ||  location.Latitude &lt;10 'is always true.  Probably the '&amp;&amp;' operator should be used here. <br><br>  What can I say?  Probably the same as above, when describing one of the errors V3001.  It is useful to use a pattern when the same variable is written from different sides in the expression: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xmin &lt; rc.Right &amp;&amp; rc.Right &lt; xmax)</code> </pre> <br>  This concludes the description of the first level errors and proceeds to the second and third, because  the same message number, depending on the situation, has a different priority. <br><br>  At the third level, diagnostic messages are collected that the analyzer issues when it is weakly sure that it is right.  Also on level 3 are diagnostics that are not relevant for all projects. <br><br>  In practice, level 3 warnings rarely reveal true errors.  Often, these are still false positives or messages that may indicate a correct code, but having a ‚Äúsmell‚Äù.  In any case, if there is time, these diagnostics should be studied and refactored the code. <br><br>  Let's start with a code with two identical functions: <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 0 reference public static double Ramp(double a) { return a - Math.Floor(a); } // 1 reference public static double Frac(double a) { return a - Math.Floor(a); }</span></span></code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0389/">V3013</a> It is odd that the body of 'Ramp' function is fully equivalent to the body of 'Frac' function (28, line 33).  Math.cs 28 <br><br>  If the Frac function has at least some sense, because  a similar function was in Pascal, but the Ramp function has no equivalent, or I did not find them.  Actually, the counters of the number of places where functions are used speak for themselves (see comments). <br><br>  In order not to go far from the error V3013, consider the case when this error appeared at the second level. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartCurrent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { StartTask(<span class="hljs-string"><span class="hljs-string">"Current"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StopCurrent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { StartTask(<span class="hljs-string"><span class="hljs-string">"Current"</span></span>); }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0389/">V3013</a> It is odd that the body of the StartCurrent function is fully equivalent to the body of the StopCurrent function (503, line 507).  DataViewModel.cs 503 <br><br>  Apparently, in the second case, the ‚ÄúStartTask‚Äù function was confused with ‚ÄúStopTask‚Äù.  These two functions are in the code, and they act quite unequivocally and according to their names. <br><br>  Next, we consider a series of messages related to the code below: <br><pre> <code class="cs hljs">{ IsUpdating = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... IsUpdating = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Such code is found already in 4 places (in each of the assemblies) <ul><li>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'IsUpdating' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 201, 195. GeoRegion.cs 201 </li><li>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'IsUpdating' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 212, 205. GeoRegion.cs 212 </li><li>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'IsUpdating' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 226, 216. GeoRegion.cs 226 </li><li>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'IsUpdating' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 244, 236. GeoRegion.cs 244 </li></ul><br>  Initially, it seems that this variable is used for inter-thread communication.  But as it turned out, in practice, this variable is not found anywhere except for the lines for which the diagnostics worked. <br><br>  Well, suppose we decide to use this variable for inter-stream synchronization.  And here we are just waiting for an unpleasant surprise.  Variable declaration is as follows: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsUpdating = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br>  As you can see, there is no ‚Äúvolatile‚Äù keyword, and as a result, the compiler successfully optimizes it and will not work at all as we would like. <br><br>  What else is interesting in the code?  For example, extra calculations: <br><br>  Example 1: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Normalize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = rect.X &lt; boundingRect.X ? boundingRect.X : rect.X; x = (rect.X + rect.Width) &gt; boundingRect.Right ? boundingRect.X : rect.X; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'x' variable is assigned twice successively.  Perhaps this is a mistake.  Check lines: 96, 95. RectEx.cs <br><br>  Example 2: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> GradientStopCollection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromInterpolation</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span>{ .... Color color=ColorTool.FromAHSV(ahsv[<span class="hljs-number"><span class="hljs-number">0</span></span>], ahsv[<span class="hljs-number"><span class="hljs-number">1</span></span>], ahsv[<span class="hljs-number"><span class="hljs-number">2</span></span>], ahsv[<span class="hljs-number"><span class="hljs-number">3</span></span>]); color = ColorTool.FromARGBInterpolation(min, p, max[i].Color); .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'color' variable is assigned twice twice successively.  Perhaps this is a mistake.  Check lines: 165, 163. BrushTool.cs <br><br>  Sometimes there are generally funny code snippets: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateAutoSavedState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { AutoSaved = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; AutoSaved = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'AutoSaved' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 691, 690. ShellViewModel.cs 691 <br><br>  For those who doubt this code I quote property declaration: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> autoSaved; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> AutoSaved { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> autoSaved; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { autoSaved = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre> <br>  And again, neither ‚Äúvolatile‚Äù nor something like that, which would indicate the hidden meaning of this action - no. <br><br>  Let's <a href="http://www.viva64.com/ru/d/0418/">move</a> on to another group of lines with error <a href="http://www.viva64.com/ru/d/0418/">V3029</a> : <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPropertyChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PropertyChangedEventArgs ea</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SelectedBrushCollectionIndex; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) DebugManager.LogData(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.BrushCollectionList[index].ToText()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SelectedBrushCollectionIndex = index; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0418/">V3029</a> The conditional expressions of the 'if' are located alongside each other are identical.  Check lines: 338, 339. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EnableSeriesMouseDoubleClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> XamGeographicMap geoMap, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isEnabled = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span></span><span class="hljs-function">)</span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (geoMap != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) geoMap.SeriesMouseLeftButtonDown += OnSeriesMouseLeftButtomDown; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (geoMap != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) geoMap.SeriesMouseLeftButtonUp += OnSeriesMouseLeftButtonUp; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (geoMap != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) geoMap.SeriesMouseLeftButtonDown -= OnSeriesMouseLeftButtomDown; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (geoMap != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) geoMap.SeriesMouseLeftButtonUp -= OnSeriesMouseLeftButtonUp; .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0418/">V3029</a> The conditional expressions of the 'if' are located alongside each other are identical.  Check lines: 92, 93. GeoMapAdapter.cs 92 <br><br>  <a href="http://www.viva64.com/ru/d/0418/">V3029</a> The conditional expressions of the 'if' are located alongside each other are identical.  Check lines: 100, 101. GeoMapAdapter.cs 100 <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SyncSeriesViewPropertyChanges</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SeriesView != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SeriesView.PropertyUpdated += OnSeriesViewPropertyUpdated; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SeriesView != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SeriesView.PropertyChanged += OnSeriesViewPropertyChanged; }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0418/">V3029</a> The conditional expressions of the 'if' are located alongside each other are identical.  Check lines: 342, 343. GeoSeriesLayer.cs 342 <br><br>  As they say - "just in case, and then suddenly" ... <br><br>  Although it is not an error, repeated calibrations clutter up the code and complicate its understanding. <br><br>  But the redundant code that appeared most likely during refactoring. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Frame NavigationTarget { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (Frame)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetValue(NavigationTargetProperty); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> targetFrame = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Frame; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (targetFrame != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SetValue(NavigationTargetProperty, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } }</code> </pre> <br>  ‚ÄúValue‚Äù already has the type Frame, the cast is meaningless.  But in this case it is necessary to consider the situation in a more broad sense.  Infragistics checks for null when writing to the DependencyProperty.  For such checks by dependency properties developers, a callback function ‚ÄúValidateValueCallback‚Äù was provided.  This function checks the values ‚Äã‚Äãthat are written to the DependencyProperty, and it is set when the dependency property is registered. <br><br><h2>  Conclusion </h2><br>  Once again, our rainbow unicorn in shining armor revealed a considerable number of problem areas (the article does not list all the errors that we discovered).  Yes, now developers can fix the code and make it better than it was ... What it was, when it was written ... What it was, when it was tested ... What it was, when it was rewritten, launched, and it fell again and again or worked wrong as needed ... <br><br>      ,       ,     ,         .   ,   ,        ,       .  Those.   , ,     ,  .  ,     .     ,           ,    .    -     .    ,  -      ‚Ä¶   ,      Copy-Paste-  15   ‚Ä¶ <br><br>  ,      ,        ,        ,     . <br><br>     .   ,          ,   . <br><br>     ‚Äî   PVS-Studio .       . ,  ,      ,      ,   ,        . <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0375/"><img src="https://habrastorage.org/getpro/habr/post_images/35e/064/ddf/35e064ddf91f5d99b620384893909ff7.png"></a> </div><br>        ,      : Vitaliy Alferov. <a href="http://www.viva64.com/en/b/0375/">Analyzing source code of WPF examples by the Infragistics Company</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/276989/">https://habr.com/ru/post/276989/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276977/index.html">Domain telephony</a></li>
<li><a href="../276979/index.html">PRIMEFLEX vShape - turnkey solution for the implementation of virtualization</a></li>
<li><a href="../276981/index.html">Crash course on interfaces in go</a></li>
<li><a href="../276983/index.html">VK vulnerability: access to previews of photos from dialogues and hidden albums of any user</a></li>
<li><a href="../276987/index.html">Part-to-whole ratio in temporal / event ontology</a></li>
<li><a href="../276991/index.html">List of technical and IT conferences 2016. Part # 2</a></li>
<li><a href="../276995/index.html">Technologies: death and rebirth</a></li>
<li><a href="../276997/index.html">Creating your own theme for Visual Studio Code</a></li>
<li><a href="../277001/index.html">AngularJS adaptation of ui-select under x-editable with the additional ability to add objects on the fly</a></li>
<li><a href="../277003/index.html">Android VIPER on jet propulsion</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>