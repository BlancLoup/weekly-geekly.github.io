<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How ONLYOFFICE has reconciled two generations of Microsoft formulas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When we were developing our document editors, we wanted to give the user the ability to conveniently work with any object. One of the obstacles that a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How ONLYOFFICE has reconciled two generations of Microsoft formulas</h1><div class="post__text post__text-html js-mediator-article">  When we were developing our document editors, we wanted to give the user the ability to conveniently work with any object.  One of the obstacles that arose on the way to editing everything right and right in this window was formulas, or rather their duality.  Students of technical universities faced this phenomenon with almost one hundred percent probability: we are talking about the existence of ‚Äúold‚Äù (binary .doc) and ‚Äúnew‚Äù (progressive XML) formulas in the editors of the MS Office package. <br><br>  In this article we will describe how this problem is solved in the ONLYOFFICE editors.  The answer is simple: K - ‚ÄúConversion‚Äù.  We convert old formulas into editable new formulas and are very happy with our idea.  Why we went this way and how the conversion works, read on. <br><br><img src="https://habrastorage.org/files/7b3/33b/c99/7b333bc99a344b7c97106a3850514367.jpg"><br><a name="habracut"></a><br><h1>  Formula dualism </h1>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In Microsoft editors, you can still type the formulas of two different formats. <br><br>  The old format of formulas is the formulas that were created in MS Office until 2007 using the Microsoft Equation add-on.  For example, to create such a formula in Word, the user calls a third-party editor through the menu ( <b>Insert</b> -&gt; <b>Object</b> -&gt; <b>Microsoft Equation</b> ).  This command opens the formula editor, which is actually a shortened version of the Math Type program from Design Science. <br><br>  So the old formulas are OLE objects.  Word simply gives a certain area of ‚Äã‚Äãthe document to another application, without even knowing what the application does in it.  After closing, MS Equation Word treats the formulas created in it as pictures embedded in text.  They can not be edited in the text itself - you need to call the formula editor again. <br><br>  In 2007, the transition to docx began.  Together with him, Microsoft got its own formula editor, the possibilities of which are much wider.  First, it has more mathematical symbols and patterns.  Secondly, the new editor allows Word to work with formulas as part of the text, and not as with pictures.  Thus, the new formula editor is the WYSIWYG editor. <br><br>  It seemed that the life of mathematicians and all those who needed formulas had to be simplified with the advent of the new editor.  But there was a problem.  The transition to the docx format did not happen instantly - there remained a large array of documents in the doc format.  Moreover, many stubbornly continue to save documents in doc.  And this is not surprising - many still have old computers and old versions of MS Office. <br><br>  So, users still save files in both docx and doc.  In addition, there are a huge number of doc format documents that will never be converted to docx, and a huge number of people who have to deal with these documents and the formulas created in them. <br><br><h1>  How different document editors solve a problem </h1><br><br><ul><li>  <b>Two editors</b> .  Microsoft, for every fireman, keeps two formula editors - the new one on the toolbar and the old one at the same address ( <b>Insert</b> menu -&gt; <b>Object</b> ).  Logically, the old editor is no longer evolving.  It simply exists for the case of opening a document in doc format or a docx file containing old formulas. </li><li>  <b>Zero editors</b> .  The online version of Word doesn't support formulas in principle.  It will show them in the viewer, but in the editing mode, the mysterious inscription ‚ÄúEquation‚Äù will be shown in place of the formulas. </li><li>  <b>Support for new formulas</b> .  Google Docs displays old formulas with pictures, while new ones allow editing.  We‚Äôve written about Google‚Äôs approach to editing formulas in <a href="https://habrahabr.ru/company/teamlab/blog/275471/">a previous article</a> .  In short, editing complex formulas in this editor is physically impossible.  First, creating formulas, the user works in one line (you cannot work with matrices, systems of equations, etc.).  Secondly, to display or type the formulas, symbols of existing fonts are used. </li><li>  <b>Conversion to own format</b> .  OpenOffice converts both types of formulas into its own format and works exclusively with it. </li></ul><br><br><h1>  ONLYOFFICE approach </h1><br><br>  Naturally, we wanted to support both types of formulas.  At the same time, it seemed logical to us to take the new formulas as the basis.  Our main format is still docx. <br><br>  We did not want to make two editors, like Microsoft, - it is resource intensive and hopeless.  In addition, we can ideally display the old formulas stored in docx.  It would be very strange to write a separate editor for them, and this is what we decided: let the user do everything he wants with the new formulas, and show the old ones in the form of vector images.  But this does not mean that now he will not be able to change anything in them - one elegant movement with the mouse (also known as a double click) and the old formulas will be converted into new, fully editable ones. <br><br><h1>  How does the conversion </h1><br><br>  The old formula is stored in the docx document in two versions - as a wmf vector image and as an OLE object (a binary with the old formula).  If the old formula came to us in the document, we show it as a picture, such as recorded Word.  Therefore, in the ONLYOFFICE editors, the file with the old formulas will open in the same way as in Word. <br><br>  When converting something in formatting can go, i.e.  change, because the formats of old and new formulas are radically different.  But this can be easily corrected, because now all the objects of the document are editable. <br><br>  <b>A little secret</b> : in fact, the formulas are converted even before the user wants it.  We parse the binary on the server before opening the file, and show the pictures to save the document view.  But if the user needs, we quickly change these pictures to the converted formula. <br><br>  Here we can be called original: no one will convert the old format into a new one at all.  Even Word.  ONLYOFFICE editors allow you to correct formulas in doc, then translate everything into docx and never think about it again. <br><br>  To make such a conversion, we had to learn how to open a closed format with no specifications anywhere.  By and large, he is using the reverse engineering method.  We had to spend quite a decent amount of time with hundreds of small files with formulas, watching how the behavior of the binary changes, depending on what we add to the formula.  However, it was worth it.  Could we not leave the user with pictures instead of formulas :) <br><br><h1>  Difficulties </h1><br><br>  The only difficulty that may arise when converting old formulas into new ones is the incompatibility of formats with each other.  In such cases, we had to work hard to translate one formula into a similar one. <br><br>  For example, consider a system of three equations in the old format <br><br><img src="https://habrastorage.org/files/4bd/9b5/ccc/4bd9b5ccca1e4806831d602a7c58a2fc.png"><br><br>  For equations, left alignment is set (center / right) in the new format there is no such alignment (equations are placed in the center) <br><br><img src="https://habrastorage.org/files/b5d/1f6/e6b/b5d1f6e6b1834758979f1f2be8796246.png"><br><br>  To realize left-alignment in new formulas, it is enough to put &amp; at the beginning of each equation.  Increasing the minimum distance between the reference lines, we get <br><br><img src="https://habrastorage.org/files/8c8/291/904/8c82919045494dcca853584ed130cedc.png"><br><br>  In principle, an acceptable result of conversion.  After conversion, if needed, you can edit the system a little more by placing &amp; in the right places in front of the variables, we get a result that is difficult to do in the old formulas <br><br><img src="https://habrastorage.org/files/84d/98c/c25/84d98cc25aa646dab5693f41bc0d7855.png"><br><br><h1>  Instead of conclusion </h1><br><br>  We tried to make working with the formulas as convenient for ONLYOFFICE users as possible and quite satisfied with the result.  We hope that by converting the old format formulas into the new one, we have contributed to the universal transition to docx.  Just take the formulas from the docs and never go back there. <br><br>  And also - we continue to improve our editors.  The main priority in the near future will be the work on footnotes.  In addition, a large package of updates for all ONLYOFFICE modules will be released very soon.  Among the main ones is the provision of a docx document with review rights (it appeared in version 3.6 of the editors, but now it has become even more convenient to work with it).  In general, stay with us :) </div><p>Source: <a href="https://habr.com/ru/post/281134/">https://habr.com/ru/post/281134/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281112/index.html">Cybercontrol. How can Palantir catch snowdens?</a></li>
<li><a href="../281118/index.html">Dynamic ontology. How the Palantir engineers explain this to the CIA, the NSA and the military</a></li>
<li><a href="../281124/index.html">We prepare WebP correctly</a></li>
<li><a href="../281126/index.html">Breaking anatomy: Sony</a></li>
<li><a href="../281132/index.html">Webinar recording available: ‚ÄúWhat's new in Windows Server 2016‚Äù</a></li>
<li><a href="../281136/index.html">Omsk! Welcome to the practical StudyJam for Android</a></li>
<li><a href="../281138/index.html">Bad package code for creating Toonz 2D animations</a></li>
<li><a href="../281140/index.html">Genetic programming. ELTRUT problem</a></li>
<li><a href="../281142/index.html">Xamarin for everyone! And other announcements on the topic with Build 2016</a></li>
<li><a href="../281144/index.html">Elastix High Availability - a solution for building a cluster of two PBXs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>