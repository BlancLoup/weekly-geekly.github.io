<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Operation windigo</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post, we publish information about the malicious campaign ‚ÄúWindigo‚Äù, with which the attackers compromised thousands of Linux and UNIX servers....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Operation windigo</h1><div class="post__text post__text-html js-mediator-article">  In this post, we publish information about the malicious campaign ‚ÄúWindigo‚Äù, with which the attackers compromised thousands of Linux and UNIX servers.  Compromised servers were used to steal SSH credentials, redirect web services users to malicious code, and send spam.  This operation began at least in 2011 and led to the compromise of various large servers and companies, including the well-known <a href="http://docs.cpanel.net/twiki/bin/view/AllDocumentation/CompSystem">cPanel</a> - the company that develops the eponymous well-known hosting control panel.  Another major victim of this campaign was the well-known resource <a href="https://lwn.net/Articles/464233/">kernel.org</a> , which is the main source code repository for the Linux kernel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/146/cbe/3c8/146cbe3c81d61310380124e64656b969.jpg"><br><br>  We already partially wrote about the malicious programs that were used in these campaigns, in our reports last year and this year [ <a href="http://habrahabr.ru/company/eset/blog/214733/">1</a> , <a href="http://habrahabr.ru/company/eset/blog/178197/">2</a> , <a href="http://habrahabr.ru/company/eset/blog/179115/">3</a> ], however, now we have a more complete picture of what is happening, as well as an analysis of other malicious programs that used by intruders.  Previously, <b>Linux / Ebury</b> and <b>Linux / Cdorked backdoors</b> were mentioned, which were used to steal the credentials of various services on the server, as well as to redirect visitors to web services to malicious resources.  In addition to these, the <b>Perl / Calfbot</b> malware was involved in the Windigo operation, with which infected servers could generate millions of spam messages per day. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  <b>Key findings</b> <br><br><ul><li>  Operation Windigo began at least in 2011 </li><li>  Over the past two years, more than 25 thousand servers have been compromised. </li><li>  The attackers managed to compromise a wide range of operating systems, including Apple OS X, OpenBSD, FreeBSD, MS Windows and Linux. </li><li>  Some malware are portable at the OS level.  Perl / Calfbot spam bot can work on any OS that has the Perl interpreter installed, and the SSH backdoor can work on both Linux and FreeBSD servers. </li><li>  As we noted at the very beginning, such large organizations as the cPanel and the Linux Foundation were victims of this attack. </li><li>  Windigo is responsible for sending about 35 million spam messages per day. </li><li>  More than 700 web servers currently still redirect users to malicious content. </li><li>  Every day, over half a million visitors to Windigo-compromised web resources were redirected to a set of exploits. </li><li>  The approximate level of infection of users with malicious code as a result of successful redirection is about 1%. </li><li>  Windigo's malicious programs are developed at a fairly high level: they use techniques to hide their presence in the system, portability between different platforms, cryptography, and they also show a high level of knowledge of the attackers in the Linux system. </li><li>  HTTP backdoor is portable between Apache httpd, Nginx and lighttpd services. </li><li>  The attackers use the resources of the compromised server to the maximum, launching various malware and other activities on it, depending on the level of access that they received. </li><li>  To gain access to the servers, the attackers used stolen credentials, as well as backdoored-apps (initially compromised applications) instead of exploiting any vulnerabilities. </li></ul><br>  <b>general information</b> <br><br>  Windigo was discovered by ESET with <a href="https://www.bsi.bund.de/EN/Topics/IT-Crisis-Management/Cert-Bund/cert-bund_node.html">CERT-Bund</a> , <a href="http://www.snic.vr.se/">SNIC</a> Research Center and the European Organization for Nuclear Research (CERN).  To gain access to the attackers' servers, no exploits were used for remote code execution, instead, distributions of various Linux programs that were compromised by malicious content, as well as the authentication credentials of user accounts used to log on to the server, were used.  In the future, the database of stolen account data to compromise the new servers was replenished by newly infected machines. <br><br>  Attackers have benefited from this campaign by performing the following malicious operations: <br><ul><li>  spamming; </li><li>  infection of users of compromised servers (drive-by); </li><li>  redirect users of compromised servers to advertising sites. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/299/35b/785/29935b785ada54e12f9957ef11e2e657.png"><br>  Fig.  The interaction of various components of malware and services used in Windigo. <br><br>  The following malware was used by intruders in Operation Windigo: <br><br><ul><li>  <b>Linux / Ebury</b> compromises <b>Linux</b> servers.  It provides attackers with full access to the system via the command line (root backdoor shell), and also has the ability to steal SSH credentials. </li><li>  <b>Linux / Cdorked</b> compromises <b>Linux</b> web servers.  It provides attackers with full access to the system via the command line and is responsible for infecting with malicious code of Windows users (drive-by). </li><li>  <b>Linux / Onimiki</b> compromises <b>Linux</b> DNS servers.  Responsible for converting domain names that match a specific pattern into the corresponding IP addresses, without the need to modify the configuration settings on the server side. </li><li>  <b>Perl / Calfbot</b> compromises the OS, which incorporates the installed Perl interpreter package.  Responsible for sending spam (spam bot). </li><li>  <b>Win32 / Boaxxe.G</b> is a malicious code for organizing a <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BB%25D0%25B8%25D0%25BA%25D1%2584%25D1%2580%25D0%25BE%25D0%25B4">clickfrod</a> (see <a href="http://habrahabr.ru/company/eset/blog/210192/">Win32 / Boaxxe.BE post</a> ), as well as <b>Win32 / Glupteba.M</b> , used by hackers as a proxy service for Windows.  Spread through the drive-by infected servers. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/474/c2b/eb4/474c2beb4e723b024b3f03aec53f7ad1.png"><br><br>  Below is a chronology of events related to Windigo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/abf/fa9/c3b/abffa9c3b003d26fef0b6ef5260eea19.png"><br><br>  <b>Account Data Theft</b> <br><br>  As we mentioned above, the theft of SSH credentials is the only method found that the attackers used to extend Windigo‚Äôs operation and gain access to new victims.  There are two typical SSH credential theft scenarios.  The first is to steal this data when the user performs a successful login to the infected server.  Another scenario involves theft of data when a user (or administrator) uses an infected server to log on to any other system.  Linux / Ebury is a key element in the Windigo operation, as it is responsible for stealing account data. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e60/7de/c36/e607dec36579ad16c54e299955e351f8.png"><br>  Fig.  The scheme of theft of these accounts using Linux / Ebury. <br><br>  Intercepted Linux / Ebury data is sent to special servers to collect stolen data (exfiltration servers) through special DNS queries.  These credentials will then be used by attackers to further spread infections.  A group of attackers uses special anonymous tunnel services (anonymizing tunnel services) on one of the compromised servers to perform the connection operation to the servers from which account data was obtained.  This allows them to go unnoticed for more time.  The server is also used to retrieve stolen account data. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4b8/8f2/807/4b88f2807ed821cf870f4b523b82ff32.png"><br>  Fig.  The scheme of theft of these accounts by operators Windigo. <br><br>  After stolen account data are in the hands of Windigo operators, they are checked for the level of access that they provide in case of successful login.  If the account does not provide root rights, the server may remain intact, i.e. it will not be compromised, or the Perl / Calfbot malware will be installed on it.  If the account provides root access, then Linux / Ebury is installed on the server, with which attackers gain access to the server for remote control.  In some cases, attackers install Perl / Calfbot even with the root rights received, but this is more of an exception. <br><br>  <b>Traffic redirection and user infection</b> <br><br>  If one or several websites are functioning on a compromised server, then Linux / Cdorked will be installed on this system.  In addition, attackers can deploy other malicious services on the server.  For example, if the server serves the 443rd HTTPS port and is accessible from the Internet, then an instance of the nginx reverse proxy will be installed on this server, it will be used as a link between the Perl / Calfbot bot and the real C &amp; C server. <br><br>  Web servers infected with Linux / Cdorked redirect users to exploit kits servers that attempt to infect them with malicious code.  Below is a diagram of how this happens. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14e/b9d/379/14eb9d379f22808b5f26fe6f8024c56e.png"><br>  Fig.  Infrastructure attackers, which is used to organize the redirection of traffic. <br><br>  The redirection logic is based on three stages: <br><br><ol><li>  A user visits a legitimate site hosted on an infected Linux / Cdorked server, which then redirects it to a special malicious domain, which is formed based on the original domain (the new subdomain).  This redirection is performed through a set of infected Linux / Ebury servers and depends on certain conditions provided by the operators. </li><li>  The previously trusted DNS server is already infected by one of the components of Windigo, which is called Linux / Onimiki, and returns the corresponding IP address for subsequent redirection (the required IP address is encoded into the subdomain that was added in the previous step).  Since as a result of the redirection, a legitimate domain is used, this makes it possible to hide the fact that the address has been changed to a malicious one, which makes the detection of this operation more difficult.  The returned IP address belongs to the reverse proxy server. </li><li>  This server is the entry point to the reverse proxy chain, which terminates on a server serving a set of exploits.  This last server is responsible for installing malicious code on the user's computer, and can also redirect it to advertising sites. </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/4e7/7c5/801/4e77c58019555ce4c570b132da5a338a.png"><br>  Fig.  If the victim works under iOS (iPad, iPhone, iPod), she is redirected to porn content (Linux / Cdorked). <br><br>  The following table shows the statistics on the IP addresses of infected web servers for the last three months from the time of the report, namely, November 2013, December 2013 and January 2014. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/393/206/e1c/393206e1ca206feeda7f561768057c4d.png"><br><br>  Thus, during these three months, we observed 2,183 unique IP addresses that were seen in the distribution of malicious content (infected with Linux / Cdorked).  In this case, 221 of these addresses were active all three months from the beginning of the moment of tracking.  The following map shows the geographical distribution of Linux / Cdorked infections. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0fc/62b/0d7/0fc62b0d7980f196b9c106b97a38d182.png"><br>  Fig.  Distribution of Linux / Cdorked server infections by country. <br><br>  The table below shows the countries with the highest number of Linux / Cdorked infections. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ca/976/d74/0ca976d74314c9ac6cfa67c35594d9e7.png"><br><br>  <b>Spamming</b> <br><br>  One of the main ways that Windigo operators can profit from installing malware is sending spam via e-mail.  Spam is sent either through servers infected with Perl / Calfbot, or through the PC of users who are infected with Win32 / Glupteba.M.  Below we consider the case of spamming with Perl / Calfbot malware. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0d5/0c6/517/0d50c65179910596276ba16c5ebdf930.png"><br>  Fig.  An example of spam message. <br><br>  We used two different approaches to understand the volumes and types of spam generated by Perl / Calfbot bots.  The first approach is to create a fake bot that implements the appropriate protocol for working with the C &amp; C server.  Using the second approach, we processed the captured network traffic received in January 2014 at one of the reverse C &amp; C proxy servers (C &amp; C reverse proxy server) and, further, extrapolated these results. <br><br>  The fake client (bot) was developed based on a real Perl / Calfbot bot.  It is used to retrieve tasks for sending spam from a C &amp; C server.  Spamming tasks consist of several email templates and a mailing list.  We analyzed the data from August 2013 to February 2014. During this period of time, our fake customer received 13,422 different tasks for sending spam to generate 20,683,814 unique email addresses.  The following histogram shows the domains of the email services that were most often used as email addresses to send spam. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3d/a85/d64/c3da85d64e75a785a3b9c40a56126cb9.png"><br>  Fig.  Email services whose users most often sent spam. <br><br>  As a result of analyzing the contents of spam messages, we found out that they have several types of content.  Most of the message templates are about casinos, bonuses and online dating.  Many messages contain words disguised as ‚Äúunsubscribe‚Äù and ‚Äúreport‚Äù (report) in the text, which was probably used to avoid detecting spam messages from security tools.  Perhaps the attackers recorded the addresses of those users who clicked on these links, marking their addresses as active and using them in subsequent mailings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b4/3ee/956/5b43ee95664a322cecbcadab3e243dd4.png"><br>  Fig.  Email entry form for "unsubscribing" from mailing. <br><br>  The regular spamming task that was delivered to the bot contains a list of 3,000 email addresses and uses English message templates, although we also observed the French, German, Spanish and Russian languages ‚Äã‚Äãused.  All spam message templates contain URLs that point to domains that are served by a compromised TinyDNS server. <br><br>  The full ESET report on this malicious campaign can be found <a href="http://www.welivesecurity.com/wp-content/uploads/2014/03/operation_windigo.pdf">here</a> . <br><br>  <b>Drive-by download</b> <br><br>  Last September, we managed to get network traffic from one of the reverse proxy Linux / Cdorked servers.  Despite the fact that this data was obtained from only one proxy server, the analysis of this traffic allowed us to estimate the extent to which users were redirected to malicious content from infected servers.  In just a few days, we observed over a million different IP addresses that accessed this server, i.e., just before the user was redirected to the exploit kit page.  Some of these users, who were redirected to malicious content, were infected.  We managed to get statistics on the OS and browsers of users who were redirected to malicious content during these few days. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/23a/05e/d67/23a05ed675c6898074c499b707d443b1.png"><br>  Fig.  The distribution of OS users who have been victims of websites compromised by Linux / Cdorked. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f7f/731/6da/f7f7316da43a0fdd90772619067587ac.png"><br>  Fig.  Distribution of browsers for users who have become victims of websites compromised by Linux / Cdorked. <br><br>  When the user's computer is redirected to the reverse proxy's external interface, the latter starts a chain of redirects to the server of the exploit kit, which is thus hidden behind the proxy servers that are used for these redirections.  The end result of such a redirection will be that a user hits the page with a set of exploits, from where a malicious code will be installed (in case of OS / software vulnerability for one of the exploits used). <br><br>  At the time of our analysis, the Windigo operators used the Blackhole exploit kit.  In November 2013, the operators switched to the <a href="http://malware.dontneedcoffee.com/2013/03/hello-neutrino-just-one-more-exploit-kit.html">Neutrino</a> exploit kit, most likely this was due to the arrest of the author Blackhole, when Paunch‚Äôs ‚Äúclients‚Äù began to switch to new means of automatic distribution of malware.  We estimate that out of 1.1 million redirected users, the number of infected was 11.108, that is, about 1% (the infection ratio). <br><br>  We observed two different families of malware, which were thus spread by attackers.  Users from the United States, United Kingdom, Canada and Australia were infected with the Win32 / Boaxxe.G malicious code, while others were infected with Win32 / Leechole, a malware that is installed in the Win32 / Glupteba.M system.  Malefactors constantly used these families of malware to infect Windows users, at least for the entire time of our tracking of this campaign. <br><br>  A full analysis of the malware used in the Windigo campaign, indicators of compromise (IOC) and other useful information can be found in our <a href="http://www.welivesecurity.com/wp-content/uploads/2014/03/operation_windigo.pdf">report</a> . </div><p>Source: <a href="https://habr.com/ru/post/216871/">https://habr.com/ru/post/216871/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../216851/index.html">We control the machine via Bluetooth from a tablet or phone for Android</a></li>
<li><a href="../216853/index.html">Gateway between IRC and Google Hangouts</a></li>
<li><a href="../216857/index.html">Synchronization in Android applications. Part two</a></li>
<li><a href="../216865/index.html">Use a hash search, not an array search</a></li>
<li><a href="../216869/index.html">Alternative GDC Arcade: Home-Made Freak Controllers Gallery</a></li>
<li><a href="../216875/index.html">Fighting the Apocalypse: technologies that will save humanity</a></li>
<li><a href="../216877/index.html">New LG monitors of Ultrawide line</a></li>
<li><a href="../216879/index.html">Mobile client for Yandex-Metrics</a></li>
<li><a href="../216881/index.html">Big update</a></li>
<li><a href="../216883/index.html">DevCon 2014: the announcement of the first wave of speakers and reports</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>