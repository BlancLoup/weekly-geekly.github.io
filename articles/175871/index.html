<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Architecture of a highly loaded Dyadok system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Those who are interested in highload-systems, read about the architecture of Twitter, Facebook and others. But there has never been a publication abou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Architecture of a highly loaded Dyadok system</h1><div class="post__text post__text-html js-mediator-article">  Those who are interested in highload-systems, read about the architecture of Twitter, Facebook and others.  But there has never been a publication about systems of a class like Dyadok.  Unlike Twitter, this system is not free and accessible to everyone and contains a fairly large layer of business logic designed to solve problems from a specific subject area. <br><br>  A few words in brief about the system: what it is intended for.  To make it immediately clear what it is, imagine a web-based interface for mail, but this is not exactly mail, or rather, not mail at all.  This system is designed to exchange documents.  The main documents are invoices and invoices.  At the same time, electronic documents are legally significant, have the same force as paper documents with seals and signatures. <br><br><a name="habracut"></a>  The exchange of electronic documents in Russia is only beginning to develop, and in the not too distant future, all invoices are likely to be transmitted electronically.  Every year, 12 billion invoices are created in Russia.  This is an average of 380 documents per second, and at peak load - thousands of documents per second.  Any project that aims to provide electronic document exchange services should count on such volumes and create an appropriate architecture. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In more detail about Diadok from the point of view of business and accounts department <a href="http://www.diadoc.ru/">it is possible to learn on the website of Diadok</a> , and here further technical details will go. <br><br><h3>  Platform </h3>  OS: Windows, Linux <br>  Language: C #, .Net 4.0 <br>  Message Queue: RabbitMQ <br>  Data warehouses: Cassandra, MySQL, Berkeley DB, Kanso (own development) <br>  Protocols: Thrift, Protocol Buffers <br>  Memory caching: Redis <br>  MVC: ASP.NET MVC, Razor (only for admin) <br>  Load balancing: Nginx. <br><br><h3>  Architecture </h3>  The system is service oriented (SOA).  The main data format for interaction is Google's Protocol Buffers, which allows you to efficiently exchange data between services.  The communication protocol is HTTP.  In this case, for publishing services, it is not IIS that is used, but its own implementation of the HTTP handler.  IIS is used only for the web interface of the system. <br>  The deployment scheme contains a list of exe-files that are generally on the system, and when laying out on the working platform, it is determined which services will run on which server.  If any component is required to connect to a service, then a random selection is made from the running replicas of the service and the connection is made. <br><br><h4>  Cassandra </h4>  Cassandra is mainly used for logging due to the high speed of writing data, but recently it has been used for other purposes, for example, if you need to store a key-value persistently.  This is not to say that this is an ideal key-value storage, but we learned to work with it.  To interact with Cassandra, the Thrift protocol is used.  Thrift is an analogue of Protocol Buffers, developed by Facebook, now under the tutelage of the Apache Software Foundation. <br><br><h4>  Kanso </h4>  Own development of fault-tolerant and distributed data storage.  In terms of functionality, it is somewhat similar to the file system, but with a hard limit: you can only write to the file at the end.  What is already recorded cannot be changed.  This restriction increases the amount of data, but ensures that no data is lost. <br><br><h4>  Mysql </h4>  Used only to store data that does not require frequent changes.  Sharding is not used for MySQL, all changes occur through one server, and there are several replicas for reading data. <br><br><h4>  RabbitMQ </h4>  This messaging service performed well enough and is used for asynchronous event processing.  Messages have a limited shelf life and are removed from the queue after a few days.  Here, as in http-services, we transmit structures based on Protocol Buffers. <br><br><h4>  Data caching </h4>  For data caching and quick information retrieval, Redis is used, as well as a whole group of .net services, which, when launched, read data from Kanso and write Berkeley DB to their local database. <br><br><h3>  Integration </h3>  Protocol Buffers is also used for the public API, but it is also possible to interact through OLE Automation.  Many large companies face integration automation problems, and the developers of Diadoc help integrate the project with other systems.  Very often, it is impossible to upload data from external systems in XML or other machine-readable format, and we have to convert data from printed forms (PDF) into our format. <br>  For more information about integration, see: <br>  <a href="https://diadoc.kontur.ru/sdk/IntegrationOptions.html">https://diadoc.kontur.ru/sdk/IntegrationOptions.html</a> <br>  <a href="https://diadoc.kontur.ru/sdk/">https://diadoc.kontur.ru/sdk/</a> <br><br><h3>  Principles of development </h3><ul><li>  Very often used pair programming. </li><li>  Required Code Review. </li><li>  Two-week iteration planning. </li><li>  Daily meeting of the whole team about the current state of affairs (Stand-up meeting). </li><li>  Transparency of information about the state of the project, both in terms of marketing and in terms of development. </li></ul><br><h3>  Development tools </h3><ul><li>  Visual Studio 2012 </li><li>  Resharper </li><li>  TeamCity for Continuous Integration </li><li>  YouTrack as an issue tracker </li></ul><br><h3>  Statistics </h3>  Number of programmers: 24 <br>  Number of servers: ~ 40 <br>  Average document delivery time: 7 seconds <br>  Registered organizations: ~ 160 000 <br><br></div><p>Source: <a href="https://habr.com/ru/post/175871/">https://habr.com/ru/post/175871/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../175859/index.html">An algorithm has been developed that allows a significant increase in the capacity of fiber-optic networks.</a></li>
<li><a href="../175861/index.html">Female look at PocketBook Surfpad</a></li>
<li><a href="../175865/index.html">Vulnerability contest, or Break me completely!</a></li>
<li><a href="../175867/index.html">A cool developer should not write code, others write for him</a></li>
<li><a href="../175869/index.html">Content applications: on the way to the reader</a></li>
<li><a href="../175873/index.html">Where is the money: look for advertising (and competitors)</a></li>
<li><a href="../175875/index.html">Application Competition on open police data</a></li>
<li><a href="../175877/index.html">Hakyll for beginners</a></li>
<li><a href="../175881/index.html">"Human" entropy for a random number generator</a></li>
<li><a href="../175883/index.html">Facebook Game On in Moscow on April 15</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>