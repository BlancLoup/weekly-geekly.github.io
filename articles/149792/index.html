<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>More about Google encodings</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This topic has already raised the issue of coding services Google. However, it dealt with the incorrectness of the texts of the agreements. In one of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>More about Google encodings</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/post/162711/"><b>This</b></a> topic has already raised the issue of coding services Google.  However, it dealt with the incorrectness of the texts of the agreements.  In one of my projects, I ran into encoding problems when working with one of the Google APIs.  The piquancy of the situation is that the problem arose when working with the undocumented API, and did not really want to ‚Äúburn‚Äù in the support service.  Searching online solutions did not give (options with ‚Äúrepeat until it works‚Äù were not taken as serious).  How did I manage to find a way out and decide everything myself? <a name="habracut"></a><br>  <b>First about the project:</b> <br>  In my spare time I develop translators for mobile phones, J2ME, Blackberry and Android platforms.  At some point on the forums where the program is being discussed, the guys started complaining about an incomprehensible bug.  In random order, instead of the translated text, users received some kind of "hieroglyphs".  They appeared in one case from 5-10 translations, and could not bother a person at all for several days.  There was no definitive geography (there were complaints from the CIS countries, and from Latin America, and from Asia, and from Europe).  The only thing that united was the phone model.  The application has a built-in logger, and you can send its contents to me by mail with one click of a button.  I made small changes, and the translation results began to be written there.  Sometimes guys sent logs, but they didn't manage to understand what was going on. <br>  <b>We get acquainted with a bug:</b> <br>  So the problem would not be solved until the Samsung C3510 Corby fell into my hands.  Having installed an application on it, I discovered that there in 100 cases out of 100 the translation comes in ‚Äúhieroglyphs‚Äù.  Ok, problems with Cyrillic are well known.  What was my surprise when even a translation from English to French led to the same result.  But this is unusual. <br>  <b>So what the hell is going on there:</b> <br>  Having fairly mocked the translation, I sent a letter and began to watch it already on the PC. <br>  Some moments turned out to be interesting: <br>  - special characters (colon, parentheses, and so on) came correctly; <br>  - Cyrillic came not true; <br>  -the payer came, too, is not true; <br>  -The installation of User-Agent does not affect the result; <br>  -Installation of the UTF-8 encoding in the body of the POST request helped only partially, English ones appeared; <br>  The conclusion was that a non-standard encoding is used for services, and besides, it is not ASCII-based, since the English would in this case have to be in a normal form.  In addition, the bug is somehow tied to a specific phone model. <br><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//    [[["R\u0457S\u0402ReR\u0406R\u03BCS , R\u0458ReS\u0402","√≤\u0457√≥\u0402√≤¬£√≤\u0406√≤\u00B5√≥\u201A √≤\u0458√≤¬£√≥\u0402","","R\u00ED\u0308S\u0110R\u00EBR\u00CDR\u00B5S\u201A R\u01F0R\u00EBS\u0110"]],,"ru",,[["R\u0457S\u0402ReR\u0406R\u03BCS",[5],1,0,1000,0,1,0],[",",[6],0,0,1000,1,2,0],["R\u0458ReS\u0402",[7],1,0,1000,2,3,0]],[["√≤\u0457√≥\u0402√≤√Ö√≤\u0406√≤\u03BC√≥",5,[["R\u0457S\u0402ReR\u0406R\u03BCS",1000,1,0]],[[0,11]],"√≤\u0457√≥\u0402√≤¬£√≤\u0406√≤\u00B5√≥\u201A √≤\u0458√≤¬£√≥\u0402"],[",",6,[[",",1000,0,0]],[[11,12]],""],["√≤\u0458√≤√Ö√≥\u0402",7,[["R\u0458ReS\u0402",1000,1,0]],[[13,19]],""]],,,[["uk","ru"]],3] //  UTF-8 [[["hello world","√ê√í√â√ó√Ö√î √ç√â√í","","privet mir"]],,"ru",,[["hello world",[5],1,0,954,0,2,0]],[["√ê√í√â√ó√Ö√î √ç√â√í",5,[["hello world",954,1,0],["a hello world",0,1,0]],[[0,10]],"√ê√í√â√ó√Ö√î √ç√â√í"]],,,[["ru"]],23] //   [[["hello world"," ","","privet mir"]],,"ru",,[["hello world",[5],1,0,954,0,2,0]],[[" ",5,[["hello world",954,1,0],["a hello world",0,1,0]],[[0,10]]," "]],,,[["ru"]],1]</span></span></code> </pre> <br><br>  <b>How to solve:</b> <br>  The number of encodings in the phones was initially small (UTF-8, ISO 8859-1 and a couple more, if lucky), so I had to write a ‚Äúmanual‚Äù decoding of the byte array into the text of the desired encoding.  The test application translated "Hello World", and in a cycle went through all the encodings, printing the received text to the console.  CP1251, ISO-8859-7 and so on naturally did not live up to the wait, but the correct text was received (as it turned out, <a href="http://habrahabr.ru/post/162711/"><b>this</b></a> comment was prophetic) with the coding KOI8-RU.  On the other phones, standard UTF-8 is activated. <br><br><div class="spoiler">  <b class="spoiler_title">For those who love technical details.</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> \ u0402 \ u0403 \ u201a \ u201e \ u201e \ u2026 \ u2020 \ u2021 \ u20ac \ u2030 \ u0409 \ u2039 \ u040a \ u040c \ u040b \ u040f \ u0452 \ u2018 \ u2019 \ u201c \ u201d <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> \ u0459 \ u203a \ u045a \ u045c \ u045b \ u045f \ u040e \ u045e \ u0408 \ u00a4 \ u0490 \ u00a6 \ u00a7 \ u0401 \ u00a9 \ u0404 \ u00ab \ u00ac \ u00ad \ u00ae \ u0407 <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> \ u0491 \ u00b5 \ u00b6 \ u00b7 \ u0451 \ u2116 \ u0454 \ u00bb \ u0458 \ u0405 \ u0455 \ u0457 \ u0410 \ u0411 \ u0412 \ u0413 \ u0414 \ u0415 \ u0416 \ u0417 \ u0418 <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> \ u041d \ u041e \ u041f \ u0420 \ u0421 \ u0422 \ u0423 \ u0424 \ u0425 \ u0426 \ u0427 \ u0428 \ u0429 \ u042c \ u042b \ u042a \ u042d \ u042e \ u042f \ u0430 \ u0431 <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> \ u2122 \ u0459 \ u203A \ u045A \ u045C \ u045B \ u045F \ u00A0 \ u040E \ u045E \ u0408 \ u00A4 \ u0490 \ u00A6 \ u00A7 \ u0401 \ u00A9 \ u0404 \ u00AB \ u00AC \ u00AD <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> \ u041B \ u041C \ u041D \ u041E \ u041F \ u0420 \ u0421 \ u0422 \ u0423 \ u0424 \ u0425 \ u0426 \ u0427 \ u0428 \ u0429 \ u042A \ u042B \ u042C \ u042D \ u042E \ u042F <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> \ <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> \ u012B \ u013C \ u0161 \ u0144 \ u0146 \ <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> \ u02DD \ u017E \ u017C \ u0154 \ <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> \ u2265 \ u00A0 \ u2321 \ u00B0 \ u00B2 \ u00B7 \ u00F7 \ u2550 \ u2551 \ u2552 \ u0451 \ u2553 \ u2554 \ u2555 \ u2556 \ u2557 \ u2558 \ u2559 \ u255A \ u255B \ u255C <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> \ u2561 \ u0401 \ u2562 \ u2563 \ u2564 \ u2565 \ u2566 \ u2567 \ u2568 \ u2569 \ u256A \ u256B \ u256C \ u00A9 \ u044E \ u0430 \ u0431 \ u0446 \ u0434 \ u0435 \ u0444 <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> \ u0414 \ u0415 \ u0424 \ u0413 \ u0425 \ u0418 \ u0419 \ u041A \ u041B \ u041C \ u041D \ u041E \ u041F \ u042F \ u0420 \ u0421 \ u0422 \ u0423 \ u0416 \ u0412 \ u042C <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/** *****j2me ****** **/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String sentence = <span class="hljs-string"><span class="hljs-string">" "</span></span>; String qq = encodeSequence(sentence); HttpConnection net = (HttpConnection) Connector.open(query , Connector.READ_WRITE, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); net.setRequestMethod(HttpConnection.POST); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Host"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>, <span class="hljs-string"><span class="hljs-string">"Opera/9.64"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Referer"</span></span>, <span class="hljs-string"><span class="hljs-string">"translate.google.com"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"*/*"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Proxy-Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"close"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"Keep-Alive"</span></span>); net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Charset"</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>); String locale = System.getProperty(<span class="hljs-string"><span class="hljs-string">"microedition.locale"</span></span>); String l = <span class="hljs-string"><span class="hljs-string">"en"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!locale.startsWith(<span class="hljs-string"><span class="hljs-string">"zh-"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>) == -<span class="hljs-number"><span class="hljs-number">1</span></span>) { l = locale; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = l.replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); l = locale.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, locale.indexOf(<span class="hljs-string"><span class="hljs-string">'-'</span></span>)); } l = Utils.toLowerCase(l).trim(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { l = locale; } net.setRequestProperty(<span class="hljs-string"><span class="hljs-string">"Accept-Language"</span></span>, l); OutputStream output = net.openOutputStream(); output.write((<span class="hljs-string"><span class="hljs-string">"sl="</span></span> + <span class="hljs-string"><span class="hljs-string">"ru"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;tl="</span></span> + <span class="hljs-string"><span class="hljs-string">"en"</span></span> + <span class="hljs-string"><span class="hljs-string">"&amp;ie=UTF-8&amp;client=t&amp;text="</span></span> + qq) .getBytes()); output.close(); resp = net.getResponseCode(); resp2 = net.getResponseMessage(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (resp == HttpConnection.HTTP_OK) { InputStream is = net.openInputStream(); ByteArrayOutputStream out = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayOutputStream(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((b = is.read()) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { out.write(b); } out.flush(); is.close(); net.close(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buff = out.toByteArray(); String enc = detectEncoding(buff, sentence); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!enc.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (enc); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { net.close(); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"Invalid ResponseCode "</span></span> + resp + <span class="hljs-string"><span class="hljs-string">" "</span></span> + resp2); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { System.out.println(<span class="hljs-string"><span class="hljs-string">"#### "</span></span> + e.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] charsets = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>, <span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>, <span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-string"><span class="hljs-string">"UNICODE"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_1map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201a\u201e\u201e\u2026\u2020\u2021\u20ac\u2030\u0409\u2039\u040a\u040c\u040b\u040f\u0452\u2018\u2019\u201c\u201d\u2022\u2013\u2014\u2122\u0459\u203a\u045a\u045c\u045b\u045f \u040e\u045e\u0408\u00a4\u0490\u00a6\u00a7\u0401\u00a9\u0404\u00ab\u00ac\u00ad\u00ae\u0407\u00b0Z\u00b1\u0406\u0456\u0491\u00b5\u00b6\u00b7\u0451\u2116\u0454\u00bb\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042c\u042b\u042a\u042d\u042e\u042f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e\u044f"</span></span>.toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1251map = <span class="hljs-string"><span class="hljs-string">"\u0402\u0403\u201A\u0453\u201E\u2026\u2020\u2021\u20AC\u2030\u0409\u2039\u040A\u040C\u040B\u040F\u0452\u2018\u2019\u201C\u201D\u2022\u2013\u2014\uFFFD\u2122\u0459\u203A\u045A\u045C\u045B\u045F\u00A0\u040E\u045E\u0408\u00A4\u0490\u00A6\u00A7\u0401\u00A9\u0404\u00AB\u00AC\u00AD\u00AE\u0407\u00B0\u00B1\u0406\u0456\u0491\u00B5\u00B6\u00B7\u0451\u2116\u0454\u00BB\u0458\u0405\u0455\u0457\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042A\u042B\u042C\u042D\u042E\u042F\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044A\u044B\u044C\u044D\u044E\u044F"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] cp1257map = <span class="hljs-string"><span class="hljs-string">"\u20AC\0\u201A\0\u201E\u2026\u2020\u2021\0\u2030\0\u2039\0\250\u02C7\270\0\u2018\u2019\u201C\u201D\u2022\u2013\u2014\0\u2122\0\u203A\0\257\u02DB\0\240\0\242\243\244\0\246\247\330\251\u0156\253\254\255\256\306\260\261\262\263\264\265\266\267\370\271\u0157\273\274\275\276\346\u0104\u012E\u0100\u0106\304\305\u0118\u0112\u010C\311\u0179\u0116\u0122\u0136\u012A\u013B\u0160\u0143\u0145\323\u014C\325\326\327\u0172\u0141\u015A\u016A\334\u017B\u017D\337\u0105\u012F\u0101\u0107\344\345\u0119\u0113\u010D\351\u017A\u0117\u0123\u0137\u012B\u013C\u0161\u0144\u0146\363\u014D\365\366\367\u0173\u0142\u015B\u016B\374\u017C\u017E\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] iso8859_2map = <span class="hljs-string"><span class="hljs-string">"\200\201\202\203\204\205\206\207\210\211\212\213\214\215\216\217\220\221\222\223\224\225\226\227\230\231\232\233\234\235\236\237\240\u0104\u02D8\u0141\244\u013D\u015A\247\250\u0160\u015E\u0164\u0179\255\u017D\u017B\260\u0105\u02DB\u0142\264\u013E\u015B\u02C7\270\u0161\u015F\u0165\u017A\u02DD\u017E\u017C\u0154\301\302\u0102\304\u0139\u0106\307\u010C\311\u0118\313\u011A\315\316\u010E\u0110\u0143\u0147\323\324\u0150\326\327\u0158\u016E\332\u0170\334\335\u0162\337\u0155\341\342\u0103\344\u013A\u0107\347\u010D\351\u0119\353\u011B\355\356\u010F\u0111\u0144\u0148\363\364\u0151\366\367\u0159\u016F\372\u0171\374\375\u0163\u02D9"</span></span> .toCharArray(); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] koi8rmap = <span class="hljs-string"><span class="hljs-string">"\u2500\u2502\u250C\u2510\u2514\u2518\u251C\u2524\u252C\u2534\u253C\u2580\u2584\u2588\u258C\u2590\u2591\u2592\u2593\u2320\u25A0\u2219\u221A\u2248\u2264\u2265\u00A0\u2321\u00B0\u00B2\u00B7\u00F7\u2550\u2551\u2552\u0451\u2553\u2554\u2555\u2556\u2557\u2558\u2559\u255A\u255B\u255C\u255D\u255E\u255F\u2560\u2561\u0401\u2562\u2563\u2564\u2565\u2566\u2567\u2568\u2569\u256A\u256B\u256C\u00A9\u044E\u0430\u0431\u0446\u0434\u0435\u0444\u0433\u0445\u0438\u0439\u043A\u043B\u043C\u043D\u043E\u043F\u044F\u0440\u0441\u0442\u0443\u0436\u0432\u044C\u044B\u0437\u0448\u044D\u0449\u0447\u044A\u042E\u0410\u0411\u0426\u0414\u0415\u0424\u0413\u0425\u0418\u0419\u041A\u041B\u041C\u041D\u041E\u041F\u042F\u0420\u0421\u0422\u0423\u0416\u0412\u042C\u042B\u0417\u0428\u042D\u0429\u0427\u042A"</span></span> .toCharArray(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detectEncoding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String exemple)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; charsets.length; i++) { String ss = byteArrayToString(bytes, charsets[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ss.indexOf(exemple) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> charsets[i]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byteArrayToString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] bytes, String charSet)</span></span></span><span class="hljs-function"> </span></span>{ String output; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] map = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WIN1251"</span></span>) || charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"CP1251"</span></span>)) { map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"KOI8-R"</span></span>)) { map = koi8rmap; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"WINDOWS-1257"</span></span>)) { map = cp1257map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-1"</span></span>)) { map = iso8859_1map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"ISO-8859-2"</span></span>)) { map = iso8859_2map; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charSet.equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (decodeUTF8(bytes, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception udfe) { } map = cp1251map; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (map != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[bytes.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; bytes.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = bytes[i]; chars[i] = (b &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) b : map[b + <span class="hljs-number"><span class="hljs-number">128</span></span>]; } output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(chars); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes, charSet); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String(bytes); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> output; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeUTF8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> gracious)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> UTFDataFormatException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> a, b, c; StringBuffer ret = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { a = data[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0x80</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) a); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x1F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 2-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xe0</span></span>) { b = data[i + <span class="hljs-number"><span class="hljs-number">1</span></span>]; c = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((b &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>) &amp;&amp; ((c &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { ret.append((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>) (((a &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) | ((b &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>) | (c &amp; <span class="hljs-number"><span class="hljs-number">0x3F</span></span>))); i += <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Illegal 3-byte group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((a &amp; <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) == <span class="hljs-number"><span class="hljs-number">0xf0</span></span>) || ((a &amp; <span class="hljs-number"><span class="hljs-number">0xc0</span></span>) == <span class="hljs-number"><span class="hljs-number">0x80</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException( <span class="hljs-string"><span class="hljs-string">"Illegal first byte of a group"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UTFDataFormatException udfe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> udfe; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ArrayIndexOutOfBoundsException aioobe) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gracious) { ret.append(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UTFDataFormatException(<span class="hljs-string"><span class="hljs-string">"Unexpected EOF"</span></span>); } } } data = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret.toString(); } <span class="hljs-comment"><span class="hljs-comment">/** * * * */</span></span></code> </pre></div></div><br>  <b>Total:</b> <br>  The code has been rewritten so that the first start determines the encoding, is written to the long-term memory, and then each time it is translated with this encoding, the result is checked for correctness, in case of a mismatch, the encodings are searched.  The implementation has been working successfully for several months and I finally forgot about the problem. <br>  <i>Thanks to Stanislav Mayantsev for making me lift my ass and re-do all the code manipulations.</i> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/149792/">https://habr.com/ru/post/149792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149786/index.html">Which editor or IDE do you use for Python?</a></li>
<li><a href="../149787/index.html">GLU ES - GLU 1.3 port for OpenGL ES</a></li>
<li><a href="../149789/index.html">The whole truth about Google Summer of Code - part 1</a></li>
<li><a href="../149790/index.html">The digest of interesting news and materials from the world of ayti for the last week ‚Ññ18 (August 11 - 17, 2012)</a></li>
<li><a href="../149791/index.html">CSS: 256 classes have higher priority than id</a></li>
<li><a href="../149793/index.html">The whole truth about Google Summer of Code - part 2</a></li>
<li><a href="../149794/index.html">The whole truth about Google Summer of Code - part 3</a></li>
<li><a href="../149795/index.html">The whole truth about Google Summer of Code - part 4</a></li>
<li><a href="../149801/index.html">VisualSVN 3.0.2 client for Visual Studio is released and has become more accessible!</a></li>
<li><a href="../149802/index.html">Localization of ASP.NET MVC applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>