<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About porting the MIPSfpga project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Transferring software from one computer architecture to another in principle, with some reservations, is relatively simple. Here well-known tools such...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About porting the MIPSfpga project</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/fn/xr/oy/fnxroyfjcdijovjcifcbnaqm298.png"><br><br>  Transferring software from one computer architecture to another in principle, with some reservations, is relatively simple.  Here well-known tools such as autoconf / automake / libtool / gnulib come to the rescue.  Building a program from source on some kind of Raspberry / ARM is as easy as on a PC with Ubuntu / x86-64. <br><br>  But how to make the FPGA project designed for one board to work on another board?  There the FPGA itself may be different and completely different components may stand on the board.  Simple recompilation of the project is not enough. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I'll tell you about my experience in porting the MIPSfpga project for the Mars Rover3 board with MAX10 Intel FPGA.  Articles about the project MIPSfpga repeatedly appeared on Habr√©.  They were so interesting that I wanted to try this project myself in the board I had.  In my work, I relied on Habrovsk articles <br><br><ul><li>  <a href="https://habrahabr.ru/post/275215/">How to start working with MIPSfpga</a> </li><li>  <a href="https://habrahabr.ru/post/335848/">MIPSfpga - practical experience</a> </li><li>  <a href="https://habrahabr.ru/post/322442/">MIPSfpga and in-circuit debugging</a> </li></ul><br>  And many others‚Ä¶ <br><br>  So, what should be done to port the FPGA project to another board? <a name="habracut"></a><br><br><h2>  1) It is necessary to reassign the type of FPGA used in the project </h2><br>  Lucky if the original project is focused on the exact same FPGA chip as on your board.  The MIPSfpga project has already been ported to boards from different manufacturers, including, there are boards with FPGA Xilinx and boards with FPGA Intel / Altera.  Nevertheless, let's say, I am ‚Äúnot lucky.‚Äù  Yes, there is a project for the DE10-lite board and it uses the MAX10 FPGA, as on my board.  But this is a completely different MAX10 - on the DE10-lite it costs 10M50DAF484C7G, and on the Mars Rover3 there is a FPGA MAX1050SAE144C8.  Both microcircuits have 50 thousand logical elements, but the first one has much more input / output signals.  It is clear that together with the reassignment of the FPGA chip type, all the signal assignments to the specific outputs of the chip ‚Äúfly off‚Äù. <br><br><img src="https://habrastorage.org/webt/sm/lh/4r/smlh4ryq5it85fknd8zp4ofcbuo.png"><br><br>  The type of chip used in the Intel Quartus CAD system is assigned via the menu Assignments =&gt; Device in the Device dialog box. <br><br>  There is also a button Device And Pin Options - go there in the next dialog box and I highly recommend immediately indicating that pins that are not used in the project should be As input tri-state. <br><br><img src="https://habrastorage.org/webt/zn/w1/t6/znw1t6kljmh5e5smkq37hn8zbeu.png"><br><br>  If the board is not very familiar, we have not yet thoroughly studied its scheme, for example, it is better to disconnect the unused FPGA conclusions from the board circuits. <br><br><h2>  2) Make new appointments for entrances and exits </h2><br>  Since the type of the chip has been reassigned, it is now necessary to indicate which inputs / outputs are those or other signals of the FPGA project.  In each FPGA project there is a top-level module.  The signals of this module are connected to the outputs of the FPGA chip, with those to which we indicate in the project settings. <br><br>  For example, in my project: <br><br><pre><code class="hljs lua">module m3 ( <span class="hljs-built_in"><span class="hljs-built_in">input</span></span> MAX10_CLK_100, <span class="hljs-built_in"><span class="hljs-built_in">input</span></span> [ <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] KEY, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> [ <span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] LEDR, <span class="hljs-built_in"><span class="hljs-built_in">input</span></span> wire FTDI_RX, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> wire FTDI_TX, inout wire [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]FTD, `ifdef MFP_USE_SDRAM_MEMORY <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> [<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] DRAM_ADDR, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> [ <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] DRAM_BA, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> DRAM_CAS_N, //<span class="hljs-built_in"><span class="hljs-built_in">output</span></span> DRAM_CKE, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> DRAM_CLK, //<span class="hljs-built_in"><span class="hljs-built_in">output</span></span> DRAM_CS_N, inout [<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] DRAM_DQ, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> DRAM_LDQM, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> DRAM_RAS_N, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> DRAM_UDQM, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> DRAM_WE_N, `endif `ifdef UNUSED <span class="hljs-built_in"><span class="hljs-built_in">input</span></span> ADC_CLK_10, <span class="hljs-built_in"><span class="hljs-built_in">input</span></span> MAX10_CLK1_50, <span class="hljs-built_in"><span class="hljs-built_in">input</span></span> MAX10_CLK2_50, <span class="hljs-built_in"><span class="hljs-built_in">input</span></span> [ <span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] SW, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> [ <span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] HEX0, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> [ <span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] HEX1, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> [ <span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] HEX2, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> [ <span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] HEX3, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> [ <span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] HEX4, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> [ <span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] HEX5, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> [ <span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] VGA_B, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> [ <span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] VGA_G, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> VGA_HS, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> [ <span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] VGA_R, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> VGA_VS, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> GSENSOR_CS_N, <span class="hljs-built_in"><span class="hljs-built_in">input</span></span> [ <span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>] GSENSOR_INT, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> GSENSOR_SCLK, inout GSENSOR_SDI, inout GSENSOR_SDO, inout [<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] ARDUINO_IO, inout ARDUINO_RESET_N, inout [<span class="hljs-number"><span class="hljs-number">35</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] GPIO, `endif inout [<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] GPIO, //HDMI <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> wire [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]TMDS );</code> </pre> <br>  On the Mars Rover3, there are neither SW switches, nor seven-segment indicators HEX0..HEX5, nor a VGA connector.  I did not directly remove these signals from the project, but deleted them by conditional compilation using the `if UNUSED ...` endif construct.  There are LEDs, buttons, signals from FTDI, and even HDMI signals on the Mars Rover3 board ‚Äî here they are in my project. <br><br><img src="https://habrastorage.org/webt/e1/zt/i-/e1zti-kb3pjsg7ivpeegvltzcni.png"><br><br>  In the Quartus environment, through the Assigments =&gt; Assignment Editor menu, you need to set the corresponding signal to the contact number of the chip.  Of course, this should be done according to the circuit diagram of the electric principal.  In addition to specifying the chip output number, you may need to make other assignments like i / O Standard or Pull-Up Resistor, if necessary. <br><br><h2>  3) Attention to the clock frequency </h2><br>  It is likely that the original project was made for a card whose face value of a quartz oscillator is not the same as on our board.  So it turned out in my case.  The DE10-lite has a 50 MHz oscillator, and my board has a 100 MHz one.  What you need to do is re-create an instance of the PLL module for this project.  In the menu of the quarter, select Tools =&gt; IP Catalog, where among the Installed IPs =&gt; Libraries we find basic Functions =&gt; Clocks;  PLLs and Reset =&gt; PLLs =&gt; ALTPLL and run the Wizard. <br><br><img src="https://habrastorage.org/webt/px/pv/b6/pxpvb6eqbdxyy6wy-mbjivgwwy0.png"><br><br>  You need to specify the correct source frequency and set the desired output frequency in the PLL.  There will have to take into account many factors.  I decided to add to the project an output to the HDMI display, which was not in the original project, which means I needed the additional frequencies required directly for the formation of the TMDS video signals (74 MHz and 370 MHz). <br><br>  The created variation of the PLL component must then be inserted into the project. <br><br><h2>  4) Trim or expand functionality? </h2><br>  In the case of porting FPGA projects to other boards, you often encounter the fact that you will not be able to repeat the project one-to-one.  The simplest reason is, for example, the initial project is made for a board that has 16 LEDs and / or seven-segment indicators, but on our board, for example, there is no such thing at all, or there are LEDs, but they are fewer, not sixteen, but only eight.  Or the board has a different amount of RAM or flash ... Then you have to think of something, somehow bypass the restrictions. <br><br>  I decided that since the project MIPSfpga training and display information is really somehow necessary, but otherwise the ‚Äúvisuality of the project‚Äù is lost, then I will display information on the monitor. <br><br>  For this purpose, I wrote a module of virtual LEDs and seven-segment indicators on Verilog. <br><br>  I will give the text of the module here: <br><br><div class="spoiler">  <b class="spoiler_title">Virtual LED and Indicator Module</b> <div class="spoiler_text"><pre> <code class="hljs vhdl">//marsohod3 board has only <span class="hljs-number"><span class="hljs-number">8</span></span> yellow LEDs //but sample MIPS needs red/green LEDs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>-segment indicators //so try display LEDs <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>-segment info <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> HDMI output <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Marsohod3 board module display ( input wire reset, input wire clk_video, //<span class="hljs-number"><span class="hljs-number">74</span></span>MHz input wire clk_hdmi, //<span class="hljs-number"><span class="hljs-number">370</span></span>MHz input wire [NUM_RED_LEDS-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]red_leds, input wire [NUM_GREEN_LEDS-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]green_leds, input wire [NUM_SEGMENTS*<span class="hljs-number"><span class="hljs-number">4</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]segments, //HDMI output output wire [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]TMDS ); <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> NUM_RED_LEDS = <span class="hljs-number"><span class="hljs-number">16</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> NUM_GREEN_LEDS = <span class="hljs-number"><span class="hljs-number">16</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> NUM_SEGMENTS = <span class="hljs-number"><span class="hljs-number">6</span></span>; wire w_hsync; wire w_vsync; wire w_active; wire [<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]w_pixel_count; wire [<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]w_line_count; wire w_video_clk5; assign w_video_clk5 = clk_hdmi; wire w_video_clk; assign w_video_clk = clk_video; hvsync u_hvsync( .reset( reset ), .pixel_clock( w_video_clk ), .hsync(w_hsync), .vsync(w_vsync), .active(w_active), .pixel_count(w_pixel_count), .line_count(w_line_count), .dbg( ) ); reg d_active; reg r_hsync; reg r_vsync; reg r_vsync_; reg [NUM_RED_LEDS-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]red_leds_fixed; reg [NUM_GREEN_LEDS-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]green_leds_fixed; reg [NUM_SEGMENTS*<span class="hljs-number"><span class="hljs-number">4</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]segments_fixed; always @(posedge w_video_clk) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> r_hsync &lt;= w_hsync; r_vsync &lt;= w_vsync; r_vsync_ &lt;= r_vsync; d_active &lt;= w_active; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( r_vsync_==<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span> &amp;&amp; r_vsync==<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> red_leds_fixed &lt;= red_leds; green_leds_fixed &lt;= green_leds; segments_fixed &lt;= segments; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> reg [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]red_word; reg [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]green_word; reg [<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]blue_word; wire led_visible; assign led_visible = w_pixel_count&lt;<span class="hljs-number"><span class="hljs-number">512</span></span> &amp;&amp; w_pixel_count[<span class="hljs-number"><span class="hljs-number">4</span></span>]==<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span>; wire [<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]led_idx; assign led_idx = NUM_RED_LEDS-<span class="hljs-number"><span class="hljs-number">1</span></span>-w_pixel_count[<span class="hljs-number"><span class="hljs-number">8</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span>]; wire current_green_led = (green_leds_fixed &gt;&gt; led_idx)&amp;<span class="hljs-number"><span class="hljs-number">1</span></span>; wire current_red_led = (red_leds_fixed &gt;&gt; led_idx)&amp;<span class="hljs-number"><span class="hljs-number">1</span></span>; wire h_seg_line5; assign h_seg_line5 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">8</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">0</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span>); wire h_seg_line4; assign h_seg_line4 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">2</span></span>-<span class="hljs-number"><span class="hljs-number">8</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span>); wire h_seg_line3; assign h_seg_line3 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">3</span></span>-<span class="hljs-number"><span class="hljs-number">8</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span>); wire h_seg_line2; assign h_seg_line2 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>-<span class="hljs-number"><span class="hljs-number">8</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">3</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span>); wire h_seg_line1; assign h_seg_line1 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">5</span></span>-<span class="hljs-number"><span class="hljs-number">8</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span>); wire h_seg_line0; assign h_seg_line0 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">6</span></span>-<span class="hljs-number"><span class="hljs-number">8</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">5</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span>); wire vl_seg_line5; assign vl_seg_line5 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">0</span></span>+<span class="hljs-number"><span class="hljs-number">24</span></span>); wire vl_seg_line4; assign vl_seg_line4 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">2</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>+<span class="hljs-number"><span class="hljs-number">24</span></span>); wire vl_seg_line3; assign vl_seg_line3 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">3</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">24</span></span>); wire vl_seg_line2; assign vl_seg_line2 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">3</span></span>+<span class="hljs-number"><span class="hljs-number">24</span></span>); wire vl_seg_line1; assign vl_seg_line1 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">5</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>+<span class="hljs-number"><span class="hljs-number">24</span></span>); wire vl_seg_line0; assign vl_seg_line0 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">6</span></span>-<span class="hljs-number"><span class="hljs-number">32</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">5</span></span>+<span class="hljs-number"><span class="hljs-number">24</span></span>); wire vr_seg_line5; assign vr_seg_line5 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">0</span></span>+<span class="hljs-number"><span class="hljs-number">56</span></span>); wire vr_seg_line4; assign vr_seg_line4 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">2</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>+<span class="hljs-number"><span class="hljs-number">56</span></span>); wire vr_seg_line3; assign vr_seg_line3 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">3</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">56</span></span>); wire vr_seg_line2; assign vr_seg_line2 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">3</span></span>+<span class="hljs-number"><span class="hljs-number">56</span></span>); wire vr_seg_line1; assign vr_seg_line1 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">5</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>+<span class="hljs-number"><span class="hljs-number">56</span></span>); wire vr_seg_line0; assign vr_seg_line0 = w_pixel_count&lt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">6</span></span>) &amp;&amp; w_pixel_count&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>*<span class="hljs-number"><span class="hljs-number">5</span></span>+<span class="hljs-number"><span class="hljs-number">56</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]seg7; input [<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]a; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>(a) <span class="hljs-number"><span class="hljs-number">0</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">63</span></span>; <span class="hljs-number"><span class="hljs-number">1</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-number"><span class="hljs-number">2</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">91</span></span>; <span class="hljs-number"><span class="hljs-number">3</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">79</span></span>; <span class="hljs-number"><span class="hljs-number">4</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">102</span></span>; <span class="hljs-number"><span class="hljs-number">5</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">109</span></span>; <span class="hljs-number"><span class="hljs-number">6</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">125</span></span>; <span class="hljs-number"><span class="hljs-number">7</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-number"><span class="hljs-number">8</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">127</span></span>; <span class="hljs-number"><span class="hljs-number">9</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">111</span></span>; <span class="hljs-number"><span class="hljs-number">10</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">119</span></span>; <span class="hljs-number"><span class="hljs-number">11</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">124</span></span>; <span class="hljs-number"><span class="hljs-number">12</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">57</span></span>; <span class="hljs-number"><span class="hljs-number">13</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">94</span></span>; <span class="hljs-number"><span class="hljs-number">14</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">121</span></span>; <span class="hljs-number"><span class="hljs-number">15</span></span>: seg7 = <span class="hljs-number"><span class="hljs-number">113</span></span>; endcase <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endfunction reg [<span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]seg7_0; reg [<span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]seg7_1; reg [<span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]seg7_2; reg [<span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]seg7_3; reg [<span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]seg7_4; reg [<span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]seg7_5; always @(posedge clk_video) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> seg7_0 &lt;= seg7( segments_fixed[ <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>] ); seg7_1 &lt;= seg7( segments_fixed[ <span class="hljs-number"><span class="hljs-number">7</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>] ); seg7_2 &lt;= seg7( segments_fixed[<span class="hljs-number"><span class="hljs-number">11</span></span>: <span class="hljs-number"><span class="hljs-number">8</span></span>] ); seg7_3 &lt;= seg7( segments_fixed[<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>] ); seg7_4 &lt;= seg7( segments_fixed[<span class="hljs-number"><span class="hljs-number">19</span></span>:<span class="hljs-number"><span class="hljs-number">16</span></span>] ); seg7_5 &lt;= seg7( segments_fixed[<span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>] ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> reg [<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]color; always @* <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( w_line_count&gt;<span class="hljs-number"><span class="hljs-number">64</span></span> &amp;&amp; w_line_count&lt;<span class="hljs-number"><span class="hljs-number">80</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> //green led <span class="hljs-literal"><span class="hljs-literal">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(led_visible) color = current_green_led ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> color=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( w_line_count&gt;<span class="hljs-number"><span class="hljs-number">96</span></span> &amp;&amp; w_line_count&lt;<span class="hljs-number"><span class="hljs-number">112</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> //red led <span class="hljs-literal"><span class="hljs-literal">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(led_visible) color = current_red_led ? <span class="hljs-number"><span class="hljs-number">3</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> color=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( w_line_count&gt;<span class="hljs-number"><span class="hljs-number">118</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span> &amp;&amp; w_line_count&lt;<span class="hljs-number"><span class="hljs-number">126</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // <span class="hljs-number"><span class="hljs-number">7</span></span>seg top <span class="hljs-literal"><span class="hljs-literal">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line0) color = seg7_0[<span class="hljs-number"><span class="hljs-number">0</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line1) color = seg7_1[<span class="hljs-number"><span class="hljs-number">0</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line2) color = seg7_2[<span class="hljs-number"><span class="hljs-number">0</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line3) color = seg7_3[<span class="hljs-number"><span class="hljs-number">0</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line4) color = seg7_4[<span class="hljs-number"><span class="hljs-number">0</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line5) color = seg7_5[<span class="hljs-number"><span class="hljs-number">0</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> color=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( w_line_count&gt;<span class="hljs-number"><span class="hljs-number">126</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span> &amp;&amp; w_line_count&lt;<span class="hljs-number"><span class="hljs-number">148</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vr_seg_line0) color = seg7_0[<span class="hljs-number"><span class="hljs-number">1</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vr_seg_line1) color = seg7_1[<span class="hljs-number"><span class="hljs-number">1</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vr_seg_line2) color = seg7_2[<span class="hljs-number"><span class="hljs-number">1</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vr_seg_line3) color = seg7_3[<span class="hljs-number"><span class="hljs-number">1</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vr_seg_line4) color = seg7_4[<span class="hljs-number"><span class="hljs-number">1</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vr_seg_line5) color = seg7_5[<span class="hljs-number"><span class="hljs-number">1</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vl_seg_line0) color = seg7_0[<span class="hljs-number"><span class="hljs-number">5</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vl_seg_line1) color = seg7_1[<span class="hljs-number"><span class="hljs-number">5</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vl_seg_line2) color = seg7_2[<span class="hljs-number"><span class="hljs-number">5</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vl_seg_line3) color = seg7_3[<span class="hljs-number"><span class="hljs-number">5</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vl_seg_line4) color = seg7_4[<span class="hljs-number"><span class="hljs-number">5</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vl_seg_line5) color = seg7_5[<span class="hljs-number"><span class="hljs-number">5</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> color=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( w_line_count&gt;<span class="hljs-number"><span class="hljs-number">148</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span> &amp;&amp; w_line_count&lt;<span class="hljs-number"><span class="hljs-number">156</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // <span class="hljs-number"><span class="hljs-number">7</span></span>seg middle <span class="hljs-literal"><span class="hljs-literal">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line0) color = seg7_0[<span class="hljs-number"><span class="hljs-number">6</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line1) color = seg7_1[<span class="hljs-number"><span class="hljs-number">6</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line2) color = seg7_2[<span class="hljs-number"><span class="hljs-number">6</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line3) color = seg7_3[<span class="hljs-number"><span class="hljs-number">6</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line4) color = seg7_4[<span class="hljs-number"><span class="hljs-number">6</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line5) color = seg7_5[<span class="hljs-number"><span class="hljs-number">6</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> color=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( w_line_count&gt;<span class="hljs-number"><span class="hljs-number">156</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span> &amp;&amp; w_line_count&lt;<span class="hljs-number"><span class="hljs-number">180</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vr_seg_line0) color = seg7_0[<span class="hljs-number"><span class="hljs-number">2</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vr_seg_line1) color = seg7_1[<span class="hljs-number"><span class="hljs-number">2</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vr_seg_line2) color = seg7_2[<span class="hljs-number"><span class="hljs-number">2</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vr_seg_line3) color = seg7_3[<span class="hljs-number"><span class="hljs-number">2</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vr_seg_line4) color = seg7_4[<span class="hljs-number"><span class="hljs-number">2</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vr_seg_line5) color = seg7_5[<span class="hljs-number"><span class="hljs-number">2</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vl_seg_line0) color = seg7_0[<span class="hljs-number"><span class="hljs-number">4</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vl_seg_line1) color = seg7_1[<span class="hljs-number"><span class="hljs-number">4</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vl_seg_line2) color = seg7_2[<span class="hljs-number"><span class="hljs-number">4</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vl_seg_line3) color = seg7_3[<span class="hljs-number"><span class="hljs-number">4</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vl_seg_line4) color = seg7_4[<span class="hljs-number"><span class="hljs-number">4</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(vl_seg_line5) color = seg7_5[<span class="hljs-number"><span class="hljs-number">4</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> color=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( w_line_count&gt;<span class="hljs-number"><span class="hljs-number">180</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span> &amp;&amp; w_line_count&lt;<span class="hljs-number"><span class="hljs-number">188</span></span>+<span class="hljs-number"><span class="hljs-number">32</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> // <span class="hljs-number"><span class="hljs-number">7</span></span>seg bottom <span class="hljs-literal"><span class="hljs-literal">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line0) color = seg7_0[<span class="hljs-number"><span class="hljs-number">3</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line1) color = seg7_1[<span class="hljs-number"><span class="hljs-number">3</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line2) color = seg7_2[<span class="hljs-number"><span class="hljs-number">3</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line3) color = seg7_3[<span class="hljs-number"><span class="hljs-number">3</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line4) color = seg7_4[<span class="hljs-number"><span class="hljs-number">3</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(h_seg_line5) color = seg7_5[<span class="hljs-number"><span class="hljs-number">3</span></span>] ? <span class="hljs-number"><span class="hljs-number">5</span></span> : <span class="hljs-number"><span class="hljs-number">6</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> color=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> color=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> reg [<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>]color_fixed; always @(posedge clk_video) color_fixed&lt;=color; always @* <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>(color_fixed) <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> //gray red_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; green_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; blue_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000111111</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> //bright green red_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; green_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1111111111</span></span>; blue_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> //dark green red_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; green_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000111111</span></span>; blue_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> //bright red red_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1111111111</span></span>; green_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; blue_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> //dark red red_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000111111</span></span>; green_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; blue_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> //bright yellow red_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1111111111</span></span>; green_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1111111111</span></span>; blue_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> //dark yellow red_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000111111</span></span>; green_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000111111</span></span>; blue_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> //gray red_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; green_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000011111</span></span>; blue_word = <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0000111111</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endcase <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> wire w_tmds_bh; wire w_tmds_bl; wire w_tmds_gh; wire w_tmds_gl; wire w_tmds_rh; wire w_tmds_rl; hdmi u_hdmi( .pixclk( w_video_clk ), .clk_TMDS2( w_video_clk5 ), .hsync( r_hsync ), .vsync( r_vsync ), .active( d_active ), .red( red_word ), .green( green_word ), .blue( blue_word ), .TMDS_bh( w_tmds_bh ), .TMDS_bl( w_tmds_bl ), .TMDS_gh( w_tmds_gh ), .TMDS_gl( w_tmds_gl ), .TMDS_rh( w_tmds_rh ), .TMDS_rl( w_tmds_rl ) ); altddio_out1 u_ddio1( .datain_h( w_video_clk), .datain_l( w_video_clk), .outclock(w_video_clk5), .dataout( TMDS[<span class="hljs-number"><span class="hljs-number">1</span></span>] ) ); altddio_out1 u_ddio0( .datain_h(~w_video_clk), .datain_l(~w_video_clk), .outclock(w_video_clk5), .dataout( TMDS[<span class="hljs-number"><span class="hljs-number">0</span></span>] ) ); altddio_out1 u_ddio3( .datain_h( w_tmds_bh), .datain_l( w_tmds_bl), .outclock(w_video_clk5), .dataout( TMDS[<span class="hljs-number"><span class="hljs-number">3</span></span>] ) ); altddio_out1 u_ddio2( .datain_h(~w_tmds_bh), .datain_l(~w_tmds_bl), .outclock(w_video_clk5), .dataout( TMDS[<span class="hljs-number"><span class="hljs-number">2</span></span>] ) ); altddio_out1 u_ddio5( .datain_h( w_tmds_gh), .datain_l( w_tmds_gl), .outclock(w_video_clk5), .dataout( TMDS[<span class="hljs-number"><span class="hljs-number">5</span></span>] ) ); altddio_out1 u_ddio4( .datain_h(~w_tmds_gh), .datain_l(~w_tmds_gl), .outclock(w_video_clk5), .dataout( TMDS[<span class="hljs-number"><span class="hljs-number">4</span></span>] ) ); altddio_out1 u_ddio7( .datain_h( w_tmds_rh), .datain_l( w_tmds_rl), .outclock(w_video_clk5), .dataout( TMDS[<span class="hljs-number"><span class="hljs-number">7</span></span>] ) ); altddio_out1 u_ddio6( .datain_h(~w_tmds_rh), .datain_l(~w_tmds_rl), .outclock(w_video_clk5), .dataout( TMDS[<span class="hljs-number"><span class="hljs-number">6</span></span>] ) ); endmodule</code> </pre></div></div><br>  <a href="https://github.com/marsohod4you/hdmi_leds_seg7">Here is the entire project source code for the Mars Rover 3 board</a> , which demonstrates the display of a binary counter on virtual LEDs. <br><br>  But his video demonstration: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/X0dwqFWkOjI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  It seems to me that it turned out pretty nice. <br><br>  Thus, with the help of virtual LEDs and seven-segment indicators, I managed to save a significant part of the MIPSfpga project when porting to a board that does not physically have 32 LEDs and does not have 7 segment indicators. <br><br>  Next, I will show how the MIPSfpga project is loaded into the board: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/M9bsPha5WzE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  This video demonstration shows how the FPGA board is loaded from a laptop from the Quartus Prime CAD system and immediately after the FPGA download, the connected HDMI monitor receives synchronization.  Then the test program is compiled on the laptop and loaded into the board and launched on the MIPS processor in the FPGA. <br><br>  Here are more examples of programs for MIPS: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6nfNwk0P53g" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><ol><li>  The memory test program 04_memtest starts, then </li><li>  the communication program 05_uart for SoC MIPSfpga and for the serial port from a PC is being investigated, </li><li>  running program 06_timer_irq using hardware interrupts </li><li>  09_adc_0 is a testing program built into the MAX10 FPGA ADC </li></ol><br>  Well, I would also like to show how you can conduct in-circuit debugging of MIPS programs using the external MBFTDI programmer and OpenOCD and GDB programs: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/aQF4hyzxpt4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  You can <a href="https://marsohod.org/projects/proekty-dlya-platy-marsokhod3/mipsfpga">read</a> more about the MIPSfpga project in the Mars Rover3 board <a href="https://marsohod.org/projects/proekty-dlya-platy-marsokhod3/mipsfpga">here</a> . <br><br>  In conclusion, I would like to express my gratitude to <a href="https://habrahabr.ru/users/sparf/" class="user_link">SparF</a> , <a href="https://habrahabr.ru/users/yuripanchul/" class="user_link">YuriPanchul</a> , <a href="https://habrahabr.ru/users/frantony/" class="user_link">Frantony</a> for their wonderful series of articles on MIPSfpga.  Without these articles there would not be this work of mine. </div><p>Source: <a href="https://habr.com/ru/post/351672/">https://habr.com/ru/post/351672/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351660/index.html">API Documentation - Documentation from Tests</a></li>
<li><a href="../351662/index.html">One day in the life of a hardened admin or a story about how to tame the storage system</a></li>
<li><a href="../351664/index.html">DNSCrypt 2.0 and ad blocking</a></li>
<li><a href="../351666/index.html">Cocos2d-x Design Patterns</a></li>
<li><a href="../351670/index.html">LG has announced the release of an open platform WebOS Open Source Edition</a></li>
<li><a href="../351674/index.html">Neoquest 2018: ‚ÄúAirship? Yeah! ‚Äù</a></li>
<li><a href="../351676/index.html">How professional interest stole my weekend</a></li>
<li><a href="../351678/index.html">Angular application architecture. We use NgModules</a></li>
<li><a href="../351680/index.html">DEFCON conference 17. ‚ÄúStealing profits from spammers: how I stopped worrying about spam and loved it‚Äù. Grant jordan</a></li>
<li><a href="../351682/index.html">Graal: how to use the new JIT JIT compiler in real life</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>