<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Website development on Diem CMS: advantages, philosophy, examples and pitfalls</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The story continues about the wonderful initiative of a group of French web developers called Diem CMS. 

 This article is waiting for you 
 - a few e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Website development on Diem CMS: advantages, philosophy, examples and pitfalls</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage/c407d907/ed5830d6/fd2121d5/312dc10c.png">  The <a href="http://habrahabr.ru/blogs/webdev/115362/">story</a> continues about the wonderful initiative of a group of French web developers called Diem CMS. <br><br><h4>  This article is waiting for you </h4><br>  - a few examples of how Diem can make life easier for the webmaster <br>  - pitfalls you may encounter and their possible solutions <br>  - a little philosophical reasoning about how Diem is fundamentally different (for the better) from colleagues <br>  - interesting facts related to topic <br>  - as well as screenshots and code samples <br>  It turned out to be voluminous and informative. <br><a name="habracut"></a><br><h4>  Practice </h4><br>  <b>Foreword</b> <br>  Over the past two months I have written 6 sites on this CMS from 5-page to 2000-page, two sites are located on a virtual hosting, two on a VPS server.  Memory is 128 MB everywhere. <br>  <b>Tar</b> <br>  Oh, this practice, which showed that the use of Diem on conventional virtual hosting at the moment does not promise anything good ... <br>  First, a memory limit of less than 48Mb can cause <code>Fatal error: Allowed memory size of X bytes exhausted</code> , about 8Mb is used when servicing pages, but for system calls (like a configuration update, search engine Zend_Search_Lucene) the memory is used a lot more (it is possible that the developers in some places forgot about the memory filling control when performing long cycles) <br>  Secondly, in the absence of APC caching with standard settings <code>./configure</code> , Diem fulfills the page for about two seconds (this is at 200ms on the same configuration, but with APC) ... <i>approx.</i>  This is my guess, the fact is that the script on the virtual hosting runs 2000ms, and on the VPS 200ms, APC is installed there and there, but the virtual hosting does not have POSIX shared memory system support.  I think this is the case, although other options are not excluded. <br>  In the process of setting up an APC with different configurations, I was helped to figure out what this document is for: <br><img src="https://habrastorage.org/getpro/habr/post_images/2c4/938/f4e/2c4938f4e22190263e8e3b04f3749b25.gif" alt="image">  <a href="http://tekrat.com/talks_files/phpworks2007/apc%40facebook.pdf">in-depth review and study of apc caching from facebook</a> <br>  <b>Honey</b> <br>  From the pleasant: despite the apparent heaviness of the system, on the cheapest VPS from reg.ru I now have five websites that get along quietly, there is enough memory for everyone, the pages are sent 200ms after the request.  I am quite satisfied with this fact, given that Diem is fraught with many more advantages than disadvantages, which I will tell you about later, but not in this, so in the following posts. <br>  Pleases and small, but responsive community.  Judging by the speed of responses, the developers visit the community every day and willingly respond, and do not send to Google.  (Pruvlinki: <a href="http://groups.google.com/group/diem-users/browse_thread/thread/692df7540fd46630">1</a> , <a href="http://groups.google.com/group/diem-users/browse_thread/thread/d359760a68787d47">2</a> ) <br><br>  In the best traditions of Symfony, Diem is supported by high-quality and understandable documentation, which includes: <br>  - week Diem <br>  immersion in development in 7 days, in practice in 2 hours you can do all the steps of the week course <br>  - how-to tips for common tasks <br>  - and a detailed step by step description of all the features of CMS 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition, there is a forum and a Google Group where you can ask the community for advice. <br>  All of this is on off.sayte <a href="http://diem-project.org/">diem-project.org</a> <br><br>  Oh yes.  I completely forgot, those who are not strong in English will be useful <a href="http://diem-project.ru/">diem-project.ru</a> - a partially translated clone diem-project.org, its creator Vladislav Lezhnev got in touch after the last post, we talked a little about Diem and in general agreed in the opinion that this CMS is worthy of attention and should be used. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2c4/938/f4e/2c4938f4e22190263e8e3b04f3749b25.gif" alt="image">  An interesting fact: most of the project was written by one person in the period from 08/23/2009 to 01/31/2010 after which about 5 more developers appeared in the project. <br><br><h4>  Philosophy </h4><br>  The main idea in content management is blocking.  If a conventional CMS has an atomic content unit as a page (whether it is a text or a photo gallery), and the use of blocks on the page is implemented additionally and often very inconvenient, then in Diem the atomic content is a block (also known as a widget). <br><br>  As a result, the content structure is as follows: templates -&gt; zones -&gt; pages -&gt; widgets <br><br>  For example, we create two templates: two-column and three-column, defined page zones on which widgets can be placed.  At this code ends, and begins managing the site.  We can create pages, drag necessary blocks into zones, edit blocks individually.  If you need some special functionality, we write a module (module development example below), the module is responsible for the specific processing of blocks and content for this block.  And then we add new specific blocks where we want and when we want.  This can be done by the client. <br><br>  For example, before I often had the need to swap some of the blocks in the sidebar (the blocks were hardcoded in the template), this was done of course quickly and simply, but in the handles and in the code.  And here are the minuses: a long time change for the customer, the probability of making an error when editing.  Now the client himself can rearrange the blocks in some places, when he pleases. <br><br>  I give examples of managing the content of the page: <br><br><img src="https://habrastorage.org/storage/96e1d3ad/2b5e325b/3906b21b/7c2da7f2.png"><br>  In this figure we see that the page is divided into zones and widgets (blocks), and that they can be dragged. <br><br><img src="https://habrastorage.org/storage/9d3d6377/d2f772de/ef6968b4/3ee37a0f.png"><br>  In this picture, we see an open media gallery, a window for editing the breadcrumbs widget and a panel of widgets that can be added to the page. <br><br><h4>  We try to write our own module </h4><br>  I will give an example from the life of the last project: it is necessary to create a database of hotels with the division by country and of course the possibility of administration.  How do you think it will take time?  We'll see‚Ä¶ <br><br>  <b>Step 1.</b> <br>  First of all, we design the database (using Doctrine and YAML files is a pleasure to do): <br><blockquote> <code><font color="black"><font color="#2b91af">Hotel</font> :&lt;br/&gt; <font color="#2b91af">actAs</font> : <font color="#0000ff">[</font> DmSortable, DmGallery <font color="#0000ff">]</font> &lt;br/&gt; <font color="#2b91af">columns</font> :&lt;br/&gt; <font color="#2b91af">name</font> : <font color="#0000ff">{</font> <font color="#2b91af">type</font> : string( <font color="#008000">255</font> ), <font color="#2b91af">notnull</font> : <font color="#0000ff">true }</font> &lt;br/&gt; <font color="#2b91af">country_id</font> : <font color="#0000ff">{</font> <font color="#2b91af">type</font> : integer <font color="#0000ff">}</font> &lt;br/&gt; <font color="#2b91af">url</font> : <font color="#0000ff">{</font> <font color="#2b91af">type</font> : string( <font color="#008000">255</font> ) <font color="#0000ff">}</font> &lt;br/&gt; <font color="#2b91af">text</font> : <font color="#0000ff">{</font> <font color="#2b91af">type</font> : clob, <font color="#2b91af">extra</font> : ckeditor <font color="#0000ff">}</font> &lt;br/&gt; <font color="#2b91af">is_active</font> : <font color="#0000ff">{</font> <font color="#2b91af">type</font> : boolean, <font color="#2b91af">notnull</font> : <font color="#0000ff">true</font> , <font color="#2b91af">default</font> : <font color="#0000ff">true }</font> &lt;br/&gt; <font color="#2b91af">rating</font> : <font color="#0000ff">{</font> <font color="#2b91af">type</font> : float <font color="#0000ff">}</font> &lt;br/&gt; <font color="#2b91af">status</font> : <font color="#0000ff">{</font> <font color="#2b91af">type</font> : integer( <font color="#008000">4</font> ), <font color="#2b91af">default</font> : <font color="#008000">0</font> <font color="#0000ff">}</font> &lt;br/&gt; <font color="#2b91af">votes</font> : <font color="#0000ff">{</font> <font color="#2b91af">type</font> : integer <font color="#0000ff">}</font> &lt;br/&gt; <font color="#2b91af">relations</font> :&lt;br/&gt; <font color="#2b91af">Products</font> : <font color="#0000ff">{</font> <font color="#2b91af">foreignAlias</font> : Hotels, <font color="#2b91af">class</font> : Product, <font color="#2b91af">refClass</font> : ProductHotel <font color="#0000ff">}</font> &lt;br/&gt; <font color="#2b91af">Country</font> : <font color="#0000ff">{</font> <font color="#2b91af">foreignAlias</font> : Hotels <font color="#0000ff">}</font> &lt;br/&gt; &lt;br/&gt; <font color="#2b91af">Country</font> :&lt;br/&gt; <font color="#2b91af">columns</font> :&lt;br/&gt; <font color="#2b91af">name</font> : <font color="#0000ff">{</font> <font color="#2b91af">type</font> : string( <font color="#008000">255</font> ), <font color="#2b91af">notnull</font> : <font color="#0000ff">true }</font> &lt;br/&gt; <font color="#2b91af">slug</font> : <font color="#0000ff">{</font> <font color="#2b91af">type</font> : string( <font color="#008000">255</font> ), <font color="#2b91af">notnull</font> : <font color="#0000ff">true }</font> &lt;br/&gt;</font></code> </blockquote> <br><br>  It seems that all that we need is indicated: a table of hotels, a table of countries, the relationship between them.  In this code, there are several Diem-notation, which globally for the whole project define the behavior of the table, namely: <code>is_active, DmSortable, DmGallery  extra: ckeditor.</code> <br>  The meaning of <code>is_active</code> lies in the fact that now diem knows that there are "active" and "inactive" objects for hotel lists.  When managing, we will be able to manage the activity via ajax, and when viewed on the page only active records will be displayed. <br>  <code>extra: ckeditor</code> adds when editing WISIWYG. <br>  <code>DmSortable</code> - allows you to manually sort the list of hotels <br>  <code>DmGallery</code> - allows you to attach an unlimited number of photos to each hotel.  All files are stored and managed in Diem using the Media component, i.e.  you do not need to write your own handlers for loading images, trimming to size using different methods, moreover, in templates you can specify any image sizes, Diem will generate a picture of the desired size on the fly. <br><br>  <b>Step 2.</b> <br>  Now we need to tell the system how we want to organize the entries in the <i>modules and components</i> : this is done again with the help of YAML in the corresponding configuration file. <br><br><blockquote> <code><font color="black"><font color="#008000">""</font> :&lt;br/&gt; &lt;br/&gt; <font color="#2b91af">hotel</font> :&lt;br/&gt; <font color="#2b91af">model</font> : Hotel&lt;br/&gt; <font color="#2b91af">page</font> : <font color="#0000ff">true</font> &lt;br/&gt; <font color="#2b91af">name</font> : <font color="#008000">'|'</font> &lt;br/&gt; <font color="#2b91af">admin</font> : <font color="#0000ff">true</font> &lt;br/&gt; <font color="#2b91af">components</font> :&lt;br/&gt; <font color="#2b91af">searchForm</font> :&lt;br/&gt; <font color="#2b91af">name</font> : <font color="#008000">' '</font> &lt;br/&gt; <font color="#2b91af">searchResults</font> :&lt;br/&gt; <font color="#2b91af">name</font> : <font color="#008000">' '</font> &lt;br/&gt; <font color="#2b91af">show</font> :&lt;br/&gt; &lt;br/&gt; <font color="#2b91af">country</font> :&lt;br/&gt; <font color="#2b91af">model</font> : Country&lt;br/&gt; <font color="#2b91af">name</font> : <font color="#008000">'|'</font> &lt;br/&gt; <font color="#2b91af">admin</font> : <font color="#0000ff">true</font> &lt;br/&gt;</font></code> </blockquote> <br><br>  What we did: they said that the hotel-records would be pages, hotels and countries should have an admin interface, and for the frontend we would need blocks: the hotel review, the hotel search form and the search form results.  In addition, the keywords <code>list  show</code> in the name of the frontend components allow you to automatically generate a selection of a list or a single object (no need to write queries to the database), it remains only to complete. <br><br>  After describing the database schema and module schema, execute in the console: <br> <code>symfony doctrine:generate-migrations-diff <br> symfony doctrine:migrate <br> symfony dm:setup</code> <br> <br>  We get the generated ORM models, Doctrine filters and forms, admin modules for hotels and countries with all the necessary set of actions and patterns. <br><img src="https://habrastorage.org/storage/7f47d518/926bdace/b595057b/ae9a7ca4.png"><br><br><img src="https://habrastorage.org/storage/e5eae2ae/1b7b53aa/1afb8a7b/49d2c684.png"><br><br>  Not bad for 20 minutes of time spent and about 200 characters printed.  As a lazy person, I was delighted with the possibilities of generating standard functionality, and as a person who loves powerful and high-quality functionality, I was just shocked, for example, the form of the filter besides its immediate purpose: filtering by specific fields, also allows you to perform full-text search throughout the content module. <br><br>  "And that's not all!" (C) <br>  As a gift, you get the generated templates for the frontend, which are available for dragging to any area of ‚Äã‚Äãthe page.  Unfortunately, Diem doesn‚Äôt know how to read thoughts, impose and create a design; therefore, we have to do this work ourselves, but here we also have some pleasant surprises.  Because  The article has already become inflated, I will just give an example for the block "hotel list": <br><br><blockquote> <code><font color="black"><font color="#cc6633">&lt;?php</font> &lt;br/&gt; &lt;br/&gt; <font color="#0000ff">echo</font> _open( <font color="#008000">'div.product_list'</font> );&lt;br/&gt; &lt;br/&gt; <font color="#0000ff">echo</font> _open( <font color="#008000">'ul.smartcolumns'</font> );&lt;br/&gt; &lt;br/&gt; <font color="#0000ff">foreach</font> ( <font color="#cc6633">$hotels</font> <font color="#0000ff">as</font> <font color="#cc6633">$hotel</font> )&lt;br/&gt;{&lt;br/&gt; <font color="#cc6633">$url</font> = _link( <font color="#cc6633">$hotel</font> )-&gt;getHref();&lt;br/&gt; <font color="#cc6633">$data</font> = <font color="#008000">'infotext'</font> ;&lt;br/&gt; &lt;br/&gt; <font color="#cc6633">?&gt;</font> &lt;br/&gt;    &lt;li style= <font color="#008000">"cursor:pointer;"</font> onclick= <font color="#008000">"window.location = '&lt;?php echo $url ?&gt;';"</font> &gt;&lt;div <font color="#0000ff">class</font> = <font color="#008000">"block hotel"</font> &gt;&lt;br/&gt;        &lt;a href= <font color="#008000">"&lt;?php echo $url ?&gt;"</font> &gt;&lt;br/&gt; <font color="#cc6633">&lt;?php</font> <font color="#0000ff">if</font> ( <font color="#cc6633">$hotel</font> -&gt;getNbMedias()) <font color="#0000ff">echo</font> _media( <font color="#cc6633">$hotel</font> -&gt;getFirstMedia())-&gt;width( <font color="#008000">100</font> ) <font color="#cc6633">?&gt;</font> &lt;br/&gt;        &lt;/a&gt;&lt;br/&gt;        &lt;div <font color="#0000ff">class</font> = <font color="#008000">"txt"</font> &gt;&lt;br/&gt;            &lt;a href= <font color="#008000">"&lt;?php echo $url ?&gt;"</font> &gt;&lt;b <font color="#0000ff">class</font> = <font color="#008000">"name"</font> &gt; <font color="#cc6633">&lt;?php</font> <font color="#0000ff">echo</font> <font color="#cc6633">$hotel</font> -&gt;name <font color="#cc6633">?&gt;</font> &lt;/b&gt;&lt;/a&gt;&lt;br /&gt;&lt;br/&gt;            &lt;div <font color="#0000ff">class</font> = <font color="#008000">"txt2"</font> &gt; <font color="#cc6633">&lt;?php</font> <font color="#0000ff">echo</font> <font color="#cc6633">$hotel</font> -&gt;rating <font color="#cc6633">?&gt;</font> &lt;/div&gt;&lt;br/&gt; <font color="#cc6633">&lt;?php</font> <font color="#0000ff">echo</font> <font color="#cc6633">$data ?&gt;</font> &lt;br /&gt;&lt;br/&gt;        &lt;/div&gt;&lt;br/&gt;    &lt;/div&gt;&lt;/li&gt;&lt;br/&gt; <font color="#cc6633">&lt;?php</font> &lt;br/&gt;}&lt;br/&gt; &lt;br/&gt; <font color="#0000ff">echo</font> _close( <font color="#008000">'ul'</font> );&lt;br/&gt; &lt;br/&gt; <font color="#0000ff">echo</font> _close( <font color="#008000">'div'</font> );&lt;br/&gt; &lt;br/&gt;use_javascript( <font color="#008000">'/js/smartcolumns.js'</font> ); &lt;br/&gt;</font></code> </blockquote> <br><br>  And an example of an action for auto-filling a search form: <br><blockquote>  <font color="#000000">&lt;? php</font> <br><br>  <font color="#009933">/ **</font> <font color="#009933"><br></font>  <font color="#009933">* Hotel actions</font> <font color="#009933"><br></font>  <font color="#009933">* /</font> <br>  <font color="#000000">class</font> hotelActions <font color="#000000">extends</font> myFrontModuleActions <br>  <font color="#009900">{</font> <br><br>  <font color="#000000">public</font> <font color="#000000">function</font> executeAutocomplete <font color="#009900">(</font> dmWebRequest <font color="#000088">$ request</font> <font color="#009900">)</font> <br>  <font color="#009900">{</font> <br>  <font color="#000088">$ query</font> <font color="#339933">=</font> <font color="#000088">$ request</font> <font color="#339933">-&gt;</font> <font color="#004000">getParameter</font> <font color="#009900">(</font> <font color="#0000ff">'query'</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ query</font> <font color="#009900">)</font> <br>  <font color="#009900">{</font> <br>  <font color="#000088">$ limit</font> <font color="#339933">=</font> <font color="#cc66cc">10</font> <font color="#339933">;</font> <br>  <font color="#000088">$ q</font> <font color="#339933">=</font> RequestFilter <font color="#339933">::</font> <font color="#004000">sanitizeString</font> <font color="#009900">(</font> <font color="#000088">$ query</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#000088">$ query</font> <font color="#339933">=</font> Doctrine_Query <font color="#339933">::</font> <font color="#004000">create</font> <font color="#009900">(</font> <font color="#009900">)</font> <br>  <font color="#339933">-&gt;</font> <font color="#004000">select</font> <font color="#009900">(</font> <font color="#0000ff">'h.id, h.name'</font> <font color="#009900">)</font> <br>  <font color="#339933">-&gt;</font> <font color="#004000">from</font> <font color="#009900">(</font> <font color="#0000ff">'Hotel h'</font> <font color="#009900">)</font> <br>  <font color="#339933">-&gt;</font> <font color="#004000">where</font> <font color="#009900">(</font> <font color="#0000ff">"LOWER (name) REGEXP '^ <font color="#006699">{$ q}</font> . * | [^ -] [-] <font color="#006699">{$ q}</font> [^)] * $'"</font> <font color="#009900">)</font> <br>  <font color="#339933">-&gt;</font> <font color="#004000">orderBy</font> <font color="#009900">(</font> <font color="#0000ff">'h.rating DESC, h.name ASC'</font> <font color="#009900">)</font> <br>  <font color="#339933">-&gt;</font> <font color="#004000">limit</font> <font color="#009900">(</font> <font color="#000088">$ limit</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#000088">$ res</font> <font color="#339933">=</font> <font color="#000088">$ query</font> <font color="#339933">-&gt;</font> <font color="#004000">execute</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">count</font> <font color="#009900">(</font> <font color="#000088">$ res</font> <font color="#009900">)</font> <font color="#009900">)</font> <br>  <font color="#009900">{</font> <br>  <font color="#000088">$ json</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <br>  <font color="#0000ff">'suggestions'</font> <font color="#339933">=&gt;</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <br>  <font color="#0000ff">'data'</font> <font color="#339933">=&gt;</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> <br>  <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#b1b100">foreach</font> <font color="#009900">(</font> <font color="#000088">$ res</font> <font color="#b1b100">as</font> <font color="#000088">$ key</font> <font color="#339933">=&gt;</font> <font color="#000088">$ val</font> <font color="#009900">)</font> <br>  <font color="#009900">{</font> <br>  <font color="#000088">$ json</font> <font color="#009900">[</font> <font color="#0000ff">'suggestions'</font> <font color="#009900">]</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$ val</font> <font color="#339933">-&gt;</font> <font color="#004000">name</font> <font color="#339933">;</font> <br>  <font color="#000088">$ json</font> <font color="#009900">[</font> <font color="#0000ff">'data'</font> <font color="#009900">]</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#000088">$ val</font> <font color="#339933">-&gt;</font> <font color="#004000">id</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">getResponse</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">-&gt;</font> <font color="#004000">setContentType</font> <font color="#009900">(</font> <font color="#0000ff">'application / json'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">return</font> <font color="#000088">$ this</font> <font color="#339933">-&gt;</font> <font color="#004000">renderText</font> <font color="#009900">(</font> <font color="#990000">json_encode</font> <font color="#009900">(</font> <font color="#000088">$ json</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#b1b100">return</font> sfView <font color="#339933">::</font> <font color="#004000">NONE</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#009900">}</font> </blockquote><br><br>  The layout and actions for all the described functionality took about two hours. <br><br><h4>  Underwater rocks </h4><br>  In a nutshell, I will point out what difficulties you may face while developing (the system is still raw and open source) <br><br>  1. The Russian-language files are not renamed when loaded, while generating the url-of-course conversion to url-valid characters, but I had problems with the fact that some files simply disappeared after loading.  More precisely, they remained in the file system and in the database, but Diem did not see them.  I think the reason here may be in using outdated functions instead of mb_string_functions.  Although the French had to deal with UTF-8 strings ... In general, I didn‚Äôt dig in particular, being treated by converting the file name to url-valid characters, for example a-z0-9_- <br><br>  2. Memory consumption with each access to the media gallery increases with the growth of files, which is not acceptable for large projects.  For the database of hotels with 500 MB of images, the media library refused to open. <br>  Going deeper into the code, I found a synchronization call every time the media library object was accessed, this is done so that the information about the structure of folders and storage files in the database is up to date (all of a sudden we will load a file over an FTP file). <br>  Thing resource-intensive and not very necessary, because  Files are supposed to be uploaded only through the admin interface, we comment on the synchronization call line and calm down. <br><br>  3. Diem minifitsiruet and combines all CSS and JavaScript files to speed up the rendering of pages.  And javascript is included at the end of the page, as we were <a href="http://developer.yahoo.com/performance/rules.html">taught</a> <s>zadroty</s> specialists from Yahoo.  If you want to use javascript in templates and use, say, jQuery, then it is necessary that the jquery library be included in the page header.  To do this, you need to specify which javascript files should be included in the header in config / dm / config.yml.  You can also specify the use of Google CDN for downloading jquery libraries. <br><br><h4>  Results </h4><br>  1. Now you know what Diem CMS is, what advantages in development you get using this CMS and how the content management paradigm differs from other CMS. <br>  2. You know that you can use Diem on VPS or dedicated servers, and on virtual hosting it is better not to try.  (Although, for the sake of experiment, I think everyone will be interested to know how many milliseconds it takes to generate a page on your hosting) <br>  3. You got acquainted with the example of developing your own module and, I hope, made sure that with Diem you can do it with a full hand easily and quickly. <br>  4. You have learned what difficulties may arise and how to overcome them. <br><br>  Not everything that I wanted to tell fit into the article.  Questions of SEO-optimization, user access control settings and a small modification of CSS eliminating some layout bugs remained unlit.  I plan to fit these topics in the next article. <br><br>  PS: whoever notices an error cannot be silent and writes in a personal - I will be grateful and immediately correct. </div><p>Source: <a href="https://habr.com/ru/post/118955/">https://habr.com/ru/post/118955/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../118948/index.html">IT Festival "de: coded": Lviv, Spring and Intel</a></li>
<li><a href="../118950/index.html">Organization of autorun VPN connections under Windows</a></li>
<li><a href="../118951/index.html">Linux Mint 11 Katya RC Released</a></li>
<li><a href="../118953/index.html">In the Google search for images will be sorted by topic.</a></li>
<li><a href="../118954/index.html">Old but still working 286</a></li>
<li><a href="../118956/index.html">You learn that the familiar term does not sound the way it was thought (for example: SQL sequel, not escuel)</a></li>
<li><a href="../118957/index.html">Orchard CMS for Developer - Part 2</a></li>
<li><a href="../118958/index.html">YouTube will add 3000 movies to its rental service.</a></li>
<li><a href="../118959/index.html">Google Chrome 12 Beta released</a></li>
<li><a href="../118960/index.html">Microsoft released Windows Azure Toolkit for Apple iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>