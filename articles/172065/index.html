<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Universal rating or every voice is important to us</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I faced the task of sorting films by rating. Each film has 2 values ‚Äã‚Äã- this is the average rating and the number of provers (just like at K...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Universal rating or every voice is important to us</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage2/1ae/627/4a7/1ae6274a7e55de024878655b7b31abb2.png" title="The original image from the site caricatura.ru">  Recently, I faced the task of sorting films by rating.  Each film has 2 values ‚Äã‚Äã- this is the average rating and the number of provers (just like at Kinopoisk and IMDB). <br><br>  The first thought, of course, was about the Top 250 Kinopoisk with their formula.  But even at the first glance, it seemed imperfect to me - an incomprehensible choice of the entry threshold and an overall average rating are introduced into a stupor, because under slightly changed conditions (fewer votes or votes), it works extremely poorly. <br><br>  How I decided to specifically this task and in passing for any such ratings, read the article. <br><a name="habracut"></a><br><h4>  The essence of the problem </h4><br>  In theory - the higher the score, the more interesting the film and the higher it should go, but ... <br>  The situation will best describe the examples. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  Example ‚Ññ1 </h6><br>  <b>Movie ‚Ññ1</b> <br>  The number of voters - 2 <br>  Average rating - 10 <br><br>  <b>Movie ‚Ññ2</b> <br>  The number of voters - 100 <br>  Average rating - 7 <br><br>  Yes, film number 1 is cool, but hardly anyone wants to focus on the opinion of two people.  From this it follows that it is stupid to keep the calculation, based only on the average rating, and in the top we will always have ‚Äúfilms for an amateur‚Äù. <br><br><img src="https://habrastorage.org/storage2/8e0/b10/e74/8e0b10e74485cd4b7092e8961219b782.png"><br><br>  There are a lot of low-budget films, and it‚Äôs easy to guess that the majority of them will have high enough ratings (viewers who are already interested, low-quality and looking for pros, not minuses, will watch them). <br><br>  Film search <a href="http://www.kinopoisk.ru/top/">solved this problem</a> by entering the threshold of votes (M = 500) and giving chances to unadvertised films, bringing them closer to the average rating of all films - the lower the views of the film, the higher its rating will rise. <br><br><img src="https://habrastorage.org/storage2/743/566/b1c/743566b1c4dde5d53adeaaad882ba4c9.gif"><br><br>  Where: <br><br>  V - the number of votes for the film <br>  M is the threshold of votes required to participate in the Top 250 rating (now: 500) <br>  R - the arithmetic average of all votes for the film <br>  C - the average rating of all films (now: 7.3837) <br><br><h6>  Example 2 </h6><br>  Now consider the following 2 films and calculate their rating using the Kinopoisk formula: <br><br>  <b>Movie ‚Ññ1</b> <br><br>  V = 500 (number of votes per film) <br>  M = 500 (threshold of votes) <br>  R = 2 (average film score) <br>  C = 7.3837 (average rating of all films) <br><br>  Raiting = 500 / (500 + 500) * 2 + 500 / (500 + 500) * 7.3837 = 4.69185 (by the way, the formula can be immediately inserted into the calculator :-) <br><br>  <b>Movie ‚Ññ2</b> <br><br>  V = 1000 <br>  M = 500 <br>  R = 3 <br>  C = 7.3837 <br><br>  Raiting = 1000 / (1000 + 500) * 3 + 500 / (1000 + 500) * 7.3837 = 4.4612 <br><br>  A film with half the votes and a lower rating received a higher rating!  Most likely, this approach is beneficial for Kinopoisku - it encourages voting and, as a result, in the infinite future gives greater objectivity. <br><br>  But I didn‚Äôt have the task of calling users to vote, and this approach didn‚Äôt fit - after all, in each weight category at a discrete point in time there would be an unfair sorting.  Yes, and the choice of the threshold is not obvious and subjective. <br><br>  So, the task: <br>  <b>Make an honest top movies based on the number of votes and the average rating for the film without using constant values.</b> <br><br><h4>  Decision </h4><br><div class="spoiler">  <b class="spoiler_title">Okay, let's tell</b> <div class="spoiler_text">  For a long time putting the numbers back and forth, we (I and my wife Katya) were looking for the perfect formula, but everywhere we ran across the human factor.  And the truth is, what is more important to count - the number of votes or rating and how to correlate them? <br><br>  As a result, we decided to approach the issue not from a mathematical point of view, but from a philosophical one: <ol><li>  So, people vote more for the advertised film, usually a film with a large budget.  The higher the budget, the higher the technical quality of the film. </li><li>  Yes, in general, the assessment of the film is a subjective concept, but we are interested in the Top for all and, therefore, should focus on popularity (popular - common, generally understood). </li><li>  The more votes for the film - the more objectively we consider the assessment. </li></ol><br><br>  As a result, we came to the conclusion that both the estimate and the number of votes are approximately equal in importance factors, and the decision came by itself. <br><br>  To equalize these two values ‚Äã‚Äã- you must bring them to the same scale.  The maximum number of votes is always different, but the rating (oh yeah!) Is from 1 to N. To simplify, we take N = 10.  Consequently, the task has been reduced to bringing the number of votes of the film to a percentage of the maximum possible among all films. <br><br>  Then I will talk about the implementation of the approach on Mysql - since mathematicians have already solved the problem, and the rest, I hope, it is interesting to touch the ready. <br><br>  So, create a table <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`films`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`raiting`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">float</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`count_votes`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> ;</code> </pre> <br><br>  Add 4 entries from examples <br><br><img src="https://habrastorage.org/storage2/657/156/2f2/6571562f2142be1da665e0837de7b88a.png"><br><br>  You probably already guessed that to calculate the percentage of votes we need the max function and the logarithm. <br><br>  If not, everything is very simple.  If we have already accepted the equivalence of the number of votes and the assessment and decided to bring the scale of votes to a scale from 1 to 10, then it suffices to use the logarithmic scale <br>  <a href="http://ru.wikipedia.org/wiki/%25D0%259B%25D0%25BE%25D0%25B3%25D0%25B0%25D1%2580%25D0%25B8%25D1%2584%25D0%25BC%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25BC%25D0%25B0%25D1%2581%25D1%2588%25D1%2582%25D0%25B0%25D0%25B1">ru.wikipedia.org/wiki/%D0%9B%D0%BE%D0%B3%D0%B0%D1%80%D0%B8%D1%84%D0%BC0D0%B8%D1%87 % B5% D1% 81% D0% BA% D0% B8% D0% B9_% D0% BC% D0% B0% D1% 81% D1% 88% D1% 82% D0% B0% D0% B1</a> <br><br>  So: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> @a:=<span class="hljs-keyword"><span class="hljs-keyword">POW</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(count_votes), <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> films; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>,raiting, count_votes, ((<span class="hljs-keyword"><span class="hljs-keyword">LOG</span></span>(@a,count_votes))+raiting)/<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> actual_raiting <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> films <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> actual_raiting <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span> ;</code> </pre><br><br>  We get the root of the 10th power of the maximum number of votes for the subsequent calculation of the logarithm.  So we get the share of the number of votes of a particular film from the maximum, reduced to 10. Add up with the average rating and divide by 2 - so we correlate them. <br><br>  Welcome to the results: <br><br><img src="https://habrastorage.org/storage2/faa/916/ae9/faa916ae99e840ee6cfe1aa2f8e29816.png"><br><br>  A film with two votes has the least objective rating and is lower than the first two, but a movie with 500 votes is too bad.  Movie number 4, despite the small number of votes, significantly ahead of rivals in the rating. <br><br>  Thus, we have created weight categories of films (by popularity), and in each weight category we sort them by rating.  Films with a roughly equivalent number of votes are ideally sorted by rating. <br><br>  So, we got rid of the threshold and made the films play honestly, while giving a chance to the less advertised but cool films to get up in their weight category. <br><br><h5>  Chef's Compliment: Actor Rating </h5><br>  It's time to explain for the main image of the article.  This is a cast rating. <br><br>  After solving the first problem - here the solution was found instantly according to the same rules: the more an actor appeared in big films, the more popular he plays and the better he plays.  Also, his game affects the rating of the film. <br><br>  So, we took the maximum number of films from an individual actor, counted the number of films and their average rating for each actor and applied the same formula. <br><br>  This is how Top Actors began to look. <br><br><img src="https://habrastorage.org/storage2/402/53c/c9f/40253cc9fcb283d3da6a510a11dce455.png"><br><br>  For those who are interested to see the result: <a href="http://vk.com/droptv">http://vk.com/droptv</a> <br><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/172065/">https://habr.com/ru/post/172065/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../172043/index.html">Correlations for beginners</a></li>
<li><a href="../172045/index.html">Replacing 'on' and back with one click</a></li>
<li><a href="../172051/index.html">The digest of interesting news and materials from the world of ayti for the last week ‚Ññ47 (March 2 - 8, 2013)</a></li>
<li><a href="../172053/index.html">Video lectures of the course "Operating Systems" with Alexei Bragin in MSTU. Bauman</a></li>
<li><a href="../172055/index.html">Philips O'Neill The Stretch - Sport Headphones</a></li>
<li><a href="../172069/index.html">History of Game.EXE 2</a></li>
<li><a href="../172073/index.html">The complexity of ERP systems</a></li>
<li><a href="../172075/index.html">Aggregation of logs from multiple servers with log4j tools</a></li>
<li><a href="../172079/index.html">World Digital Revolution</a></li>
<li><a href="../172081/index.html">Cisco opens EIGRP for third-party</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>