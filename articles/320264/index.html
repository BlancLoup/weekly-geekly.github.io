<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write a wrapper over the API, make a PIP packet out of it, connect Travis CI testing and look at open source licenses</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings, Habrahabr! This article will be useful for those wishing to familiarize themselves not only with the design of their own Python Package Ind...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write a wrapper over the API, make a PIP packet out of it, connect Travis CI testing and look at open source licenses</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/a36/675/8d9/a366758d9cce4775b49aa1d40633c057.png"></div><br>  Greetings, Habrahabr!  This article will be useful for those wishing to familiarize themselves not only with the design of their own Python Package Index (PIP) package, but also with various supporting tools that help accompany development at all stages - using the example of the author‚Äôs work. <br><br>  Required tools: <br><br><ul><li>  Development environment - writing object-oriented code that works closely with the application interface (in our case, a web site), in other words - sending and processing requests to the API, and additional auxiliary files; </li><li>  Uploading their work to the general package directory - <a href="https://pypi.python.org/pypi">PyPI</a> ; </li><li>  <a href="https://github.com/">Github</a> - creating a repository for the purpose of quality control, improvement and permanent updating of the library, general interaction with the open source code area; </li><li>  One of the free software licenses, in our case the <a href="https://en.wikipedia.org/wiki/MIT_License">MIT License</a> ; </li><li>  <a href="https://travis-ci.org/">Travis CI</a> - continuous build and testing of a project under development in various environments (for example, different versions of a language or interpreter). </li></ul><br>  This list can be taken for the content of the article in the appropriate order. <br><a name="habracut"></a><br>  I want to add that it is not necessary to go over the proposed materials, in which a lot of important and interesting information is indicated - you will still receive the necessary data to complete such a project and then decide whether you should use additional links. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Introduction </h2><br>  I am a regular visitor of various Internet resources, including one well-known Ukrainian community of programmers, and a part-time and constantly practicing programmer - therefore, due to a lack of ideas, I rushed to design the implementation of publication statistics (using the example of Habrahabr) (see figure below) for users of the site .  It does not matter in what form the project will be implemented, but the intermediate task is the subject of discussion of the article - working with the <a href="https://api.dou.ua/articles/">API of this site</a> , which is greatly facilitated by writing your own wrapper (PIP package), including undoubted additional advantages from the development - for example, an interesting new area and experience gained. <br><br><img src="https://habrastorage.org/files/207/58e/946/20758e946a8649fd97d373dff3ccb74e.png"><br><br><br>  The design of the project, which is necessary for the implementation of the wrapper and its loading into the general catalog, differs from the final one, which is in turn proper for the quality maintenance of further work. <br><br>  An example of the final version of <a href="https://github.com/DmytryiStriletskyi/DouAPI">DouAPI</a> (link to github, keep it open in parallel with the article and contact for details of the described, do not forget to read the description of the repository).  It does not contain the necessary files for testing and some auxiliary solutions (for example, take out a bulky code that performs formatting of strings or processing additional requests), but only because there is no such requirement at this stage of development. <br><br>  The structure of the package itself should consist of the main directory, a subdirectory with the main and auxiliary files and the distribution file ‚Äúsetup.py‚Äù. <br><br><img src="https://habrastorage.org/files/7dd/65d/75e/7dd65d75e35444d4808bfbe8687a7e41.png"><br><br>  For greater clarity, it is worth starting the implementation description with the api.py module ( <a href="https://github.com/DmytryiStriletskyi/DouAPI/blob/master/dou/api.py">link to github</a> ) - importing the <a href="http://docs.python-requests.org/en/master/">Requests</a> module, which allows you to handle HTTP requests at an improved level. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests</code> </pre> <br>  Creating a separate class directly for accessing a specific method specified by the site‚Äôs API at a given URL.  If your development will be limited by some factors and the creation of an additional class for requests is unnecessary - create a private method already in the main class, but if you don‚Äôt know how far the project goes, what features you want to add and what complexity is waiting for you - you won‚Äôt be , so as not to waste time rewriting code. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DouAPI</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">method</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, method, values=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> values <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: values[<span class="hljs-string"><span class="hljs-string">'limit'</span></span>] = <span class="hljs-number"><span class="hljs-number">10000</span></span> response = requests.get(<span class="hljs-string"><span class="hljs-string">'https://api.dou.ua/{0}/'</span></span>.format(method), params=values) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response.status_code == <span class="hljs-number"><span class="hljs-number">200</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response.json()[<span class="hljs-string"><span class="hljs-string">'results'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: message = <span class="hljs-string"><span class="hljs-string">'A request to the Dou API was unsuccessful. The server returned HTTP {0} {1}.'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> message.format(response.status_code, response.reason)</code> </pre><br>  Calling the ‚Äúmethod‚Äù function, which accepts a method name that matches the required URL and key-value set ( <a href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields">HTTP Headers</a> ), returns the result as a JSON format (the same set of value keys) in a successful case, and just the string with the error code and the reason answer otherwise (try not to do so; it‚Äôs better to create your own custom exceptions separately, <a href="https://www.programiz.com/python-programming/user-defined-exception">as written here</a> or <a href="http://stackoverflow.com/questions/1319615/proper-way-to-declare-custom-exceptions-in-modern-python">here</a> ). <br><br>  The class that the programmer then applies to through the object (everything else that goes beyond the scope of the required tools should be wrapped in private <a href="https://docs.python.org/3.5/tutorial/classes.html">variables</a> and <a href="http://www.diveintopython.net/object_oriented_framework/private_functions.html">methods</a> ) contains one ‚Äúlenta‚Äù function that returns a class object with the query method, passing the name of the ‚Äúarticles‚Äù method and value keys (for example, category and author). <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dou</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> __slots__ = (<span class="hljs-string"><span class="hljs-string">'_dou'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self._dou = DouAPI() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lenta</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, category=None, tag=None, author=None, date_from=None, date_to=None)</span></span></span><span class="hljs-function">:</span></span> values = locals().copy() values.pop(<span class="hljs-string"><span class="hljs-string">'self'</span></span>) values = {header:value <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> header, value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> values.items() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value != <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self._dou.method(<span class="hljs-string"><span class="hljs-string">'articles'</span></span>, values=values)</code> </pre><br>  So in the end, an example of using a wrapper looks like - importing the required class, creating an object, accessing the class method, specifying the parameters of interest, we get back the data in JSON format. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dou <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dou dou = Dou() news = dou.lenta(category = <span class="hljs-string"><span class="hljs-string">'news'</span></span>, date_from=<span class="hljs-string"><span class="hljs-string">'2016-06-01'</span></span>) print(news)</code> </pre><br>  If to illustrate the process, the interaction is as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/211/0aa/c91/2110aac9162045f48440a0ec1173cce8.png"></div><br>  Now consider the moment with the file "__init__.py", which allows to <a href="https://docs.python.org/2/tutorial/modules.html">initialize</a> the implementation class at the directory access level, write the following into it ( <a href="https://github.com/DmytryiStriletskyi/DouAPI/blob/master/dou/__init__.py">link to github</a> ). <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> .api <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dou</code> </pre><br>  The final stage - ‚Äúsetup.py‚Äù ( <a href="https://github.com/DmytryiStriletskyi/DouAPI/blob/master/setup.py">link to github</a> ) describes a series of data that is necessary to build a project from source (more <a href="https://docs.python.org/3/install/index.html">here</a> ) - becomes clearer in practice when interacting with archiving and distribution of a package.  Describe something unnecessarily, everything should be intuitive to understand. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> setuptools <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> setup <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ImportError: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> distutils.core <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> setup setup( name=<span class="hljs-string"><span class="hljs-string">'DouAPI'</span></span>, version=<span class="hljs-string"><span class="hljs-string">'1.0.0'</span></span>, author=<span class="hljs-string"><span class="hljs-string">'DmytryiStriletskyi'</span></span>, author_email=<span class="hljs-string"><span class="hljs-string">'dmytryi.striletskyi@gmail.com'</span></span>, url=<span class="hljs-string"><span class="hljs-string">'https://github.com/DmytryiStriletskyi/DouAPI'</span></span>, description=<span class="hljs-string"><span class="hljs-string">'Dou API wrapper'</span></span>, download_url=<span class="hljs-string"><span class="hljs-string">'https://github.com/DmytryiStriletskyi/DouAPI/archive/master.zip'</span></span>, license=<span class="hljs-string"><span class="hljs-string">'MIT'</span></span>, packages=[<span class="hljs-string"><span class="hljs-string">'dou'</span></span>], install_requires=[<span class="hljs-string"><span class="hljs-string">'requests'</span></span>], classifiers=[ <span class="hljs-string"><span class="hljs-string">'License :: OSI Approved :: MIT License'</span></span>, <span class="hljs-string"><span class="hljs-string">'Programming Language :: Python :: 2.7'</span></span>, <span class="hljs-string"><span class="hljs-string">'Programming Language :: Python :: 3.4'</span></span>, <span class="hljs-string"><span class="hljs-string">'Programming Language :: Python :: 3.5'</span></span>, ] )</code> </pre><br><h2>  Python Package Index (PIP) </h2><br>  There are many instructions for installing packages in a common directory on the net, so in this article I will describe a single method that turned out to be the most convenient and productive for me: <br><br><ol><li>  <a href="https://pypi.python.org/pypi%3F%253Aaction%3Dregister_form">Register the profile in PyPI</a> ; </li><li>  Install the ‚ÄúTwine‚Äù utility to register and download packages (read more <a href="https://pypi.python.org/pypi/twine">here</a> ) right at the root of the project - ‚Äúpip install twine‚Äù; </li><li>  We complete the distribution kit - ‚Äúpython setup.py sdist‚Äù; </li><li>  The next stage is ‚Äúwheels‚Äù, this is a modern distribution format (actually archived data) of packages - ‚Äúpython setup.py bdist_wheel‚Äù (more <a href="http://pythonwheels.com/">here</a> and <a href="https://pypi.python.org/pypi/wheel">here</a> ); </li><li>  <a href="https://pypi.python.org/pypi%3F%253Aaction%3Dsubmit_form">Registration of the project</a> - it is necessary to transfer the specified metadata (‚Äúsetup.py‚Äù), which are located in the PKG-INFO file (located inside the archived project); </li><li>  The final stage - download the package - ‚Äútwine upload dist / *‚Äù. </li></ol><br>  A detailed manual is located <a href="https://packaging.python.org/distributing/">at the link</a> , there is a variant of using also a test server and authorization from the catalog - <a href="http://peterdowns.com/posts/first-time-with-pypi.html">here</a> in the network material is available in Russian. <br><br>  The remaining interactions occur through a personal account in PyPI: deletion, editing, history log, releases, roles, and so on. <br><br><h2>  Package Repository </h2><br>  If the work done in the future can be claimed by the audience, you need to take the following number of measures: create a repository itself, issue the title page of the project (README.md), connect testing and choose a license.  If everything is clear with the first two files, the following require clarification. <br><br><h2>  Open Source License </h2><br>  There are a wide variety of licenses, but <a href="https://choosealicense.com/licenses/mit/">MIT License</a> , <a href="https://choosealicense.com/licenses/apache-2.0/">Apache License,</a> and <a href="https://choosealicense.com/licenses/gpl-2.0/">GPL</a> occupy leading positions.  I use the first one - it allows the use and modification of the code in any way (subject to the availability of copyright), and also has a small size.  There are also disadvantages - there is no patent law inherent in other licenses, but for small projects this license fits well. <br><br>  For example, this is how the license in my repository looks like - <a href="https://github.com/DmytryiStriletskyi/DouAPI/blob/master/LICENSE">MIT License</a> , Github will put the license in the top panel of the repository. <br><br><h2>  Testing the project </h2><br>  <a href="https://travis-ci.org/">Travis CI</a> - if you describe it in simple words, then every change in your project is tested on the environments you specified.  This platform is quite easy to use - we place a file ( <a href="">link to github</a> ) with the name ‚Äú.travis.yml‚Äù in the root directory, which indicates: programming language, necessary versions, language interpreters, which dependencies to install during integration and deployment on the server, plugin testing and some other parameters. <br><br>  There are a lot of advantages, besides the testing itself - a convenient interface with many displays of testing status, errors, history, quick connection, checking user commits to your project before merging.  Travis also reports results by mail. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/add/273/cd2/add273cd254b46c39856356a2b6f49d5.png"></div><br>  First of all, install the hook on the repository, then add the file ‚Äú.travis.yml‚Äù, then push the changes in the project and observe the results. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fed/911/a7e/fed911a7ec924ae3a77abaf1590d63ad.png"></div><br>  I would be glad if this article will help someone in the development of new material or awaken interest in this area.  Send your questions and tips, if you have them, to private messages. </div><p>Source: <a href="https://habr.com/ru/post/320264/">https://habr.com/ru/post/320264/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320252/index.html">Interaction between Blue Print (Interface, Cast To)</a></li>
<li><a href="../320256/index.html">The most popular words in two terabytes of code</a></li>
<li><a href="../320258/index.html">We become professional PHP developers. Part 4: Teamwork in practice</a></li>
<li><a href="../320260/index.html">Return H.264 support in Vivaldi in openSUSE Leap 42.2</a></li>
<li><a href="../320262/index.html">RIGHT kitchen</a></li>
<li><a href="../320266/index.html">JunOS update on EX4500 switches in VirtualChassis - what could go wrong? Part 1</a></li>
<li><a href="../320268/index.html">Generating documents in doc, excel, pdf and other formats on the server</a></li>
<li><a href="../320270/index.html">Internet intelligence in action: who is Mr./Ms. Habraman?</a></li>
<li><a href="../320278/index.html">Hard parting with Net-Tools</a></li>
<li><a href="../320280/index.html">Javascript Video Refactoring</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>