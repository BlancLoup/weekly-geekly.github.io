<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We break iOS-application. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You did a good job, and here is your app in the App Store! 



- Keep user accounts? 
- Do you use in-app purchases? 
- Do not want to show your know-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We break iOS-application. Part 1</h1><div class="post__text post__text-html js-mediator-article">  You did a good job, and here is your app in the App Store! <br><br><ul><li>  Keep user accounts? </li><li>  Do you use in-app purchases? </li><li>  Do not want to show your know-how? </li></ul><br>  Reason to think about the security of the code and data!  We will look for vulnerabilities in the test application.  In this article we will talk about data security, and <a href="http://habrahabr.ru/post/199130/">in the next</a> - let's move on to the code. <a name="habracut"></a><br><br><h2>  Disclaimer </h2><br>  The purpose of this lesson is not to make you a hacker, but to show how intruders can circle you around a finger.  The article missed some infa, necessary for hacking a real application on the device.  We will torment the simulator (by the way, it seems to be even legitimate <sup><u>[citation needed]</u></sup> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Disclaimer from the translator: a lot of ‚Äúwater‚Äù and references to Hollywood (and so long) are removed from the original text.</i>  <i>Added a number of key explanations.</i> <br><br><h2>  so </h2><br>  <b>No application is safe!</b>  If someone really wants to find your vulnerabilities, he will find them.  There is no guaranteed way to prevent an attack.  <s>Is that not to release the application.</s>  But there are great ways to prevent burglars.  (According to the author, they get bored, and they will go to <s>sleep</s> to look for easier prey, yeah. - <i>Approx. Lane.</i> ) <br><br>  Before reading further, you should understand approximately what a terminal is, as well as Objective-C and Cocoa (however, there will not be much code). <br><br><h3>  Let's get started </h3><br>  We will need: <br>  1. <a href="https://code.google.com/p/networkpx/wiki/class_dump_z">Class-dump-z</a> utility; <br>  2. A proxy for debugging over the network, for example, <a href="http://www.charlesproxy.com/download/">Charles</a> (the trial version is distinguished by annoying messages and works for a maximum of 30 minutes in 1 session).  In the comments to the <a href="http://www.raywenderlich.com/45645/ios-app-security-analysis-part-1">source of the</a> article advise an alternative to Charles - <a href="https/">Burpsuite</a> . <br><br>  That you creatively approached the process, I offer you a script.  Imagine: a new application for the iPad - ‚ÄúMeme Collector‚Äù (Meme Collector).  Everyone likes.  But you whispered in your ear that the built-in purchases pulled you a significant amount of money. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d9a/0b3/14c/d9a0b314c9e51ec118c368d373691e37.png"><br><br>  In general, you are thinking of getting paid content (memes) for free.  There are several areas where you can move, we will talk about them - and about the appropriate methods of protection. <br><br><div class="spoiler">  <b class="spoiler_title">Slight simplification</b> <div class="spoiler_text">  Because of the length of this lesson, we initially made some simplifications in the test project.  For example, the ‚Äúpurchase‚Äù of game currency is not a real in-app purchase, but a fake request to StoreKit (everything happens locally on the device). </div></div><br><br><h3>  What is what?  "Map" of the application (application mapping) </h3><br>  Take a look at the application from a bird's eye view!  What does it do from the user's point of view?  What is its main structure? <br><br>  Open <a href="https://github.com/x128/MemeCollector">the Meme Collector project</a> in your favorite IDE or in Xcode (not ads). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f9e/b3f/c90/f9eb3fc90c8e18ffae3e0cac8ff61aa2.png"><br><br>  We will run the application in the Release configuration. <br>  Xcode: <b>Product&gt; Scheme&gt; Edit scheme ...</b> ( <b>‚åò &lt;</b> ) - select Run ... on the left, Info&gt; Build Configuration: Release tab on the right. <br>  AppCode: <b>Run&gt; Edit configurations ...</b> &gt; Configuration: Release. <br><br>  Run the application on the iPad simulator ( <b>‚åòR</b> ).  And now forget that you have the source code, you are the user.  One of two things will open: <br><img src="https://habrastorage.org/getpro/habr/post_images/a98/f5a/ba5/a98f5aba5b52e1e360547f4ff77595f7.png"><br><br><div class="spoiler">  <b class="spoiler_title">Do you have an option on the left?</b> <div class="spoiler_text"> It is habraeffekt or problem with connection.  Memes are taken from <a href="http://version1.api.memegenerator.net/Generators_Select_ByNew">the memegenerator.net API</a> - check that this URL produces <code>{"success":true,"result":[ ]}</code> .  During the translation of the article, they had problems with the server.  If there is a desire to save the project from dependence on this API, velkam github. </div></div><br>  This <s>strange</s> interface allows you to ‚Äúbuy‚Äù a meme by tapu on it, and also shows the number of purchases of this meme and the balance of money in your account.  <i>From the translator:</i> by clicking the ‚ÄúPurchase Currency‚Äù button, I really thought: Did I enter the Apple ID on the simulator? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf8/5b8/3e8/cf85b83e872b4d5e18c6f3bc0baeef96.png"><br><br>  ... but he remembered that my credit card was not attached to my US account.  :) Russian would say the price in rubles. <br><br>  In general, everything is simple.  There is a "game currency", and you (like a cracker) do not want to give real money for it.  Our goal is to get more memes without pressing the ‚ÄúPurchase Currency‚Äù button. <br><br>  We have roughly understood what the application is doing, let's take a deeper look.  What else can we learn? <br><br>  The <b>class-dump-z</b> utility will display all the declarations that it can get from the executable file.  <a href="https://code.google.com/p/networkpx/wiki/class_dump_z">Download the</a> latest version of the utility (for example, 0.2a), unpack the archive.  In the terminal, go to the <code>class-dump-z_0.2a/mac_x86/</code> .  There is a class-dump-z executable file, install it, for example, by copying it to <code>/usr/bin/</code> : <br><br><pre> <code class="bash hljs">sudo cp class-dump-z /usr/bin/</code> </pre><br>  Go to the iOS simulator folder: (instead of 7.0.3 - your version) <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Library/Application\ Support/iPhone\ Simulator/7.0.3/Applications/</code> </pre><br>  Here are all the applications that you run in the simulator.  There may be many of them.  How to find Meme Collector? <br><br>  Option 1. If you just launched the Meme Collector, then it lies in the folder with the newest modification date.  Just go into it: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> `ls -tr | tail -1`</code> </pre><div class="spoiler">  <b class="spoiler_title">What is this magic?</b> <div class="spoiler_text"><ul><li>  The ls command returns the contents of a folder.  The "-tr" flag sorts by time: the newest folder will be the last in the list. </li><li>  This entire list is input to the tail command.  It takes some amount of data from the end.  In this case, exactly one line (the flag "-n 1" or simply "-1"). </li><li>  Next, the cd command goes to this newest folder. </li></ul></div></div><br>  Option 2. Take and find: <br><br><pre> <code class="bash hljs">find . -name <span class="hljs-string"><span class="hljs-string">"Meme Collector"</span></span></code> </pre><br>  In my case, the folder is called <code>9A72F266-8851-4A25-84E4-9CF8EFF95CD4</code> - hereinafter we will call it simply the "application folder".  In it lies: <br><ul><li>  <code>Meme Collector.app</code> - main application bundle <br></li><li>  something else :) </li></ul><br>  A bundle is a folder (namely a folder, yes, with the extension <code>.app</code> ), in which there are one or more executable files plus resources for them (pictures, sounds, digital signature, in general, anything, even other bundles ... <a href="http://en.wikipedia.org/wiki/Application_bundle">read more</a> ).  Go to the main bundle folder: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> Meme Collector.app</code> </pre><br>  There is an executable file, which is called: <code>Meme Collector</code> (without extension).  Let's look at what frameworks and shared libraries there are links to it.  The standard <code>otool</code> utility will help <code>otool</code> : <br><br><pre> <code class="bash hljs">otool -L <span class="hljs-string"><span class="hljs-string">"Meme Collector"</span></span></code> </pre><br>  And that's what we see: <br><br><pre> <code class="bash hljs">Meme Collector: /System/Library/Frameworks/SystemConfiguration.framework/SystemConfiguration (compatibility version 1.0.0, current version 615.0.0) /System/Library/Frameworks/MobileCoreServices.framework/MobileCoreServices (compatibility version 1.0.0, current version 51.0.0) /System/Library/Frameworks/Security.framework/Security (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/StoreKit.framework/StoreKit (compatibility version 1.0.0, current version 1.0.0) /System/Library/Frameworks/QuartzCore.framework/QuartzCore (compatibility version 1.2.0, current version 1.8.0) /System/Library/Frameworks/UIKit.framework/UIKit (compatibility version 1.0.0, current version 2903.23.0) /System/Library/Frameworks/Foundation.framework/Foundation (compatibility version 300.0.0, current version 1047.22.0) /System/Library/Frameworks/CoreGraphics.framework/CoreGraphics (compatibility version 64.0.0, current version 600.0.0) /usr/lib/libobjc.A.dylib (compatibility version 1.0.0, current version 227.0.0) /usr/lib/libSystem.dylib (compatibility version 1.0.0, current version 111.0.0)</code> </pre><br>  Mm, I wonder if the application uses the <a href="https://developer.apple.com/library/ios/documentation/StoreKit/Reference/StoreKit_Collection/_index.html">Store Kit</a> framework - in-app purchases?  Come on, go ahead.  Run the <b>class-dump-z</b> utility: <br><br><pre> <code class="bash hljs">class-dump-z <span class="hljs-string"><span class="hljs-string">"Meme Collector"</span></span> &gt; ClassDump.txt</code> </pre><br>  And open the file in the standard goove editor: <br><br><pre> <code class="bash hljs">open ClassDump.txt</code> </pre><img src="https://habrastorage.org/getpro/habr/post_images/a95/503/5bb/a955035bb17f1d7dac931e310d21cc06.png">  Wow!  Although there is, compared with the example from the <a href="http://www.raywenderlich.com/45645/ios-app-security-analysis-part-1">original article</a> (Xcode 4, iOS 6 SDK) there appeared some unpleasant moments like <code>XXUnknownSuperclass</code> , but still!  We see not only the interface part, but also declarations of private methods, properties, and protocols. <br><br>  Studying the dump classes of a serious project is often a tedious task.  But it can give an amazing picture of the internal device of the application! <br><br>  So, my young tracker!  Find me all the singletons in the app. <br><br><div class="spoiler">  <b class="spoiler_title">hint</b> <div class="spoiler_text">  Signatons often have <a href="http://en.wikipedia.org/wiki/Method_%2528computer_programming%2529">class method</a> declarations with keywords: manager, shared, store. </div></div><br>  If you meet an interesting singleton, learn all his methods. <br>  (Apparently, "interesting" = "seems to be related to the logic of the application." - <i>Note. Trans.</i> ) <br><br><div class="spoiler">  <b class="spoiler_title">Decision</b> <div class="spoiler_text">  Accurately found?  Take a closer look at yourself.  There are about four of them. <br><br><div class="spoiler">  <b class="spoiler_title">Yes all.</b> <div class="spoiler_text"><ul><li>  AFNetworking <br><br></li><li>  MemeManager is an interesting singleton!  He contains: <br><pre> <code class="cpp hljs">@property(retain, nonatomic) AFHTTPClient* client; @property(readonly, assign, nonatomic) NSMutableArray* memes; +(id)sharedManager; -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)memePurchased:(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)purchased; -(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)getMemeInformation; <span class="hljs-comment"><span class="hljs-comment">// ,  private-</span></span></code> </pre><br><br></li><li>  MoneyManager is also an interesting singleton: <br><pre> <code class="cpp hljs">@property(readonly, assign, nonatomic) NSNumber* money; +(id)sharedManager; -(BOOL)saveState; <span class="hljs-comment"><span class="hljs-comment">// ,  private- -(void)loadState; // ,  private- -(BOOL)purchaseCurrency; -(BOOL)buyObject:(id)object;</span></span></code> </pre><br><br></li><li>  SVProgressHUD <br><br></li></ul></div></div></div></div><br>  Crackers often do what you just did ‚Äî look for certain words in a class dump.  For example, if they want to find out if there is logic in the application tied to a jailbreak device, then search by the words 'jailbroken', 'security', etc.  may give a quick answer. <br><br><h4>  How to prevent this? </h4><br>  There are two news.  I'll start with the good. <br><br>  Apple does this for you automatically.  When you send the app to the App Store, they encrypt your binaries using DRM technology called <a href="http://en.wikipedia.org/wiki/FairPlay">FairPlay</a> .  If you dump the class-dump-z'om encrypted binary, you will get ... gibberish. <br><br>  The bad news: getting around this protection is pretty easy!  The case for 10 minutes (manually), but still have the means to automate this process.  In general, be sure your application will be decrypted and will see the names of all your classes, methods, protocols, etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f5/722/406/8f5722406fb5f9c82d3c21bef6574386.png"><br><br><h3>  Plist files: vulnerable! </h3><br>  We learned something about the application.  Now look for all that is bad.  Developers are prone to make mistakes.  It is common for intruders to use these errors for their own purposes. <br><br>  Mistakes ... Let's start with the most stupid!  For example, how do you get the idea: use a .plist file to store critical information?  Crackers always look at the plists: they are easy to see, and studying them can provide the key to the internal logic of the application.  (Plist = property list, text file with serialized objects). <br><br>  Let's see which plists we have? <br>  <i>(remember, we are still in the ‚ÄúMeme Collector.app‚Äù bundle folder)</i> <br><br><pre> <code class="bash hljs">ls *.plist</code> </pre><br>  But what - two things: <br><br><pre> <code class="bash hljs">Info.plist MoneyDataStore.plist</code> </pre><br>  Let's see the first one - Info.plist: <br><br><pre> <code class="bash hljs">plutil -p Info.plist</code> </pre><br>  Result: <br><br><pre> <code class="bash hljs">{ <span class="hljs-string"><span class="hljs-string">"DTSDKName"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"iphonesimulator7.0"</span></span> <span class="hljs-string"><span class="hljs-string">"CFBundleName"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"Meme Collector"</span></span> <span class="hljs-string"><span class="hljs-string">"CFBundleDevelopmentRegion"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"en"</span></span> <span class="hljs-string"><span class="hljs-string">"CFBundleVersion"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> <span class="hljs-string"><span class="hljs-string">"DTPlatformName"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"iphonesimulator"</span></span> ‚Ä¶   ‚Ä¶</code> </pre><br>  Nothing interesting, some general information.  Okay.  Well, and the second: <br><br><pre> <code class="bash hljs">plutil -p MoneyDataStore.plist</code> </pre><br>  And we see: <br><br><pre> <code class="bash hljs">{ <span class="hljs-string"><span class="hljs-string">"userCurrency"</span></span> =&gt; 108 }</code> </pre><br>  Funny!  This .plist contains the <code>userCurrency</code> key with the same value that you just saw on the simulator screen.  Does this mean that the application stores money in .plist?  There is only one way to find out! <br><br><pre> <code class="bash hljs">open MoneyDataStore.plist</code> </pre><br>  Change the <code>userCurrency</code> value, for example, to 1234. Save and close the .plist file. <br><br>  Let's go back to the simulator.  Remove our application from RAM (as they say, "from multitasking"). <div class="spoiler">  <b class="spoiler_title">Just in case the instruction.</b> <div class="spoiler_text">  The combination of the <b>‚áß‚åòH</b> keys in the iOS simulator corresponds to pressing the <b>Home</b> button.  Press this combination twice to show the multitasking screen, and flick the Meme Collector up <s>to nowhere</s> . <br><br>  It seems he is not very pleased that it looks like: <img src="https://habrastorage.org/getpro/habr/post_images/a15/d4d/557/a15d4d557c8e97638fa39c5eaa03d56b.png"></div></div>  In the future, when I say ‚Äúrestart the application‚Äù, I will mean this operation. <br><br>  Run the application again.  1234 virtual tugriks at your disposal! <br>  <i>From the translator:</i> I was waiting <u>for more</u> intrigue.  It is never that easy!  Although your test project write. <br><br><h3>  Custom settings: unsafe! </h3><br>  Well, you understand?  Keeping important information in .plist is not a good idea.  Now guess: what are the user settings ( <code>NSUserDefaults</code> )?  Yeah, plist too!  Physically, it lies at <code>{App Directory}/Library/Preferences/{Bundle Identifier}.plist</code> . <br><br>  This is the place where developers often mistakenly feel safe.  Not only freelancers: large corporations from time to time fall into this trap.  Countless applications store important data in <code>NSUserDefaults</code> .  Let's see what we prepared here Meme Collector? <br><br>  From the terminal (we are still in Meme Collector.app, right?), Open the file: <br><br><pre> <code class="bash hljs">open ../Library/Preferences/com.selander.Meme-Collector.plist</code> </pre><br>  A simple exercise for you: using the methods mentioned above, modify <code>NSUserDefaults</code> to get a bunch of memes from the ‚ÄúYU No ...‚Äù series for free.  Even if you have already guessed everything, I advise you to do it to consolidate. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a1a/4d2/f60/a1a4d2f60df98843961a4e8c486aaf62.png"><br><br>  But after all malefactors can get access to plist-files, even when the iOS-device is blocked - so where it is safe to store data?  One solution is to store the data in <code>NSUserDefaults</code> in encrypted form.  In this case (and not only. - <i>Approx. K..</i> ) you need to check the data read from there for validity. <br><br><h3>  A bunch of keys: the best recipes </h3><br>  Another possible solution is to transfer important data from .plists to the iOS Keychain (Keychain).  How to do it - it is written, for example, <a href="http://www.raywenderlich.com/6475/basic-security-in-ios-5-tutorial-part-1">here</a> . <br><br>  A bunch of keys "raises the stakes" for the hacker.  Attackers will not be able to pull anything off if the device is locked. <br><br>  However, you shouldn‚Äôt rely solely on the Keychain alone!  And that's why.  The keychain is supported by Apple.  (Well, you already understood everything, yes?) The information in it is encrypted with the user's password, which is usually a simple 4-digit numeric code.  And this means that a <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D0%25BB%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B1%25D0%25BE%25D1%2580">brute force</a> attack will take about twenty minutes.  Having found out the password, it is easy to dump the entire keychain. <br><br>  What to do?  Some general recommendations: <br><br><ul><li>  <b>Encrypt data!</b>  A bunch of keys seems to be safe, but this is a priority for hackers, so they break it first.  (There is nothing to say about jailbroken devices at all - there are utilities for them that show the contents of Keychains.) Make life harder for hackers at least a little: encrypt data using the <b>CommonCrypto API</b> , which is part of the standard Security Framework ( <a href="https://developer.apple.com/library/ios/samplecode/CryptoExercise/Introduction/Intro.html">example</a> ). <br><br></li><li>  <b>Do not write the encryption key in the application.</b>  The long line in the data section is of potential interest to the hacker.  And in general: if the private key is registered in the application, the attacker can put it on the network, compromising the data of all users of the application!  Be sure to generate a unique encryption key on each device. <br><br></li><li>  <b>Control the code!</b>  Specifically, monitor the hacker's ability to use your code for your own purposes.  Your encryption / decryption method may be the best solution.  But hackers will take a debugger and apply your decryption method to your encrypted data.  You will see this in the second part of this tutorial (next post). <br><br></li><li>  <b>Is it really necessary to store?</b>  Once an attacker can search, modify and execute your binaries - just ask yourself: do you really need to store this information on the device? <br><br></li></ul><br><h3>  Network: penetration testing </h3><br>  More hackers love to see how the application interacts with the network.  The most stupid way to see if there is any work with the network on the device is to look for URLs in a binary. <br><br>  While in the bundle folder (Meme Collector.app), type in the terminal: <br><br><pre> <code class="bash hljs">strings <span class="hljs-string"><span class="hljs-string">"Meme Collector"</span></span></code> </pre><br>  Stop where so much!  The strings command goes through sections of a binary and prints all data elements that are similar to strings.  Filter the noise: <br><br><pre> <code class="bash hljs">strings <span class="hljs-string"><span class="hljs-string">"Meme Collector"</span></span> | grep http</code> </pre><br>  And, well, one line: <br><br><pre> <code class="bash hljs">http://version1.api.memegenerator.net/Generator_Select_ByUrlNameOrGeneratorID</code> </pre><br>  It seems that at some point the application turns to the meme generator for this urla.  As a hacker, you would like to investigate this matter further by examining the network traffic of the application.  To do this, we need a network monitor that intercepts all incoming and outgoing requests. <br><br>  Charles, mentioned at the beginning of the article is a good option for such a study.  <a href="http://www.charlesproxy.com/download/">Download</a> it if you have not done it yet.  Install and run. <br><br>  Check that Charles catches network interaction with the iOS simulator (by launching Maps, or in Safari, type the URL).  You will see how network requests will run in Charles.  If this does not happen, make sure that the box is checked in the <b>Proxy&gt; Mac OS X Proxy</b> menu. <br><br><div class="spoiler">  <b class="spoiler_title">By the way, Charles perfectly intercepts SSL traffic.</b> <div class="spoiler_text">  We will not do this because we did not see the HTTPS URLs at the output of the <code>strings</code> command.  But this step is required for other applications that can use HTTPS.  In the <b>Proxy&gt; Proxy Settings ...&gt; SSL</b> menu, you need to enable SSL proxy and add domains that need to intercept (and decrypt) HTTPS traffic.  Until you do this, SSL will look something like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cbf/283/dac/cbf283dac7727f9a9babbff368ef7295.png"></div></div><br>  With Charles running, restart the Meme Collector.  After launch, you should see three requests for <code><a href="http://version1.api.memegenerator.net/"></a> version1.api.memegenerator.net</code>  <code><a href="http://version1.api.memegenerator.net/"></a> version1.api.memegenerator.net</code> by clicking on the triangle to the left of the url (see below).  Three queries will open that have different GET parameters.  For example, the first one has a GET parameter: <code>urlName=Foul-Bachelor-Frog</code> ‚Äî this can be seen on the Request tab. <br><br>  Select the Response tab and then JSON at the bottom.  The server response, decrypted from JSON, is presented in the form of a beautiful label: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0d1/b6d/33f/0d1b6d33ff377c837de201c415f5e48c.png"><br><br>  We see here many strings of the key-value type: heading ( <code>displayName</code> ), description ( <code>description</code> ), image URL ( <code>imageUrl</code> ) - in general, some information on this type of memes ‚ÄúFour Bachelor Frog‚Äù from the GET parameter. <br><br>  What happens next?  The application does the same thing three times: an HTTP request for url pictures, tries to download it from <code>cdn.memegenerator.co</code> , receives a 301th redirect to <code>cdn.memegenerator.net</code> and <code>cdn.memegenerator.net</code> from there. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c68/7ce/bda/c687cebda1f44005fdecce0db5c287d3.png"><br><br>  It looks like what we saw in the app, right?  Two other pictures were less fortunate this time, they did not wait for a response from the server (Charles reports this on the Overview tab) and therefore did not appear in the application. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/030/c0b/524/030c0b5245bf21fa3d813d5bc4f6e74f.png"><br><br><div class="spoiler">  <b class="spoiler_title">And I don‚Äôt even see pictures requested!</b> <div class="spoiler_text">  When you restart the pictures can be taken from the simulator cache, Charles does not know this.  Clear the cache and restart the application. <br><br><pre> <code class="bash hljs">rm -R Library/Caches/</code> </pre></div></div><br><br>  So, with a certain probability we conclude: the application takes memes from this API and presents them in the form of paid content.  And what if you try to change the URL in order to acquire some new content besides these three memes?  It is unlikely that there is a check whether the application really receives from the server what the developer expected! <br><br>  Are you already tired of these three memes?  Well, let's try, is it possible to display and ‚Äúbuy‚Äù something new, say, ‚ÄúSuccess Kid‚Äù. <br><br>  Select Charles from the menu: <b>Tools&gt; Rewrite</b> .  This feature allows you to intercept incoming / outgoing requests and modify them according to the rules that you set.  Enable the checkbox <b>Enable Rewrite</b> .  Rules are grouped into ‚Äúsets‚Äù.  Under the Sets list, click <b>Add</b> to add a new rule set.  Optionally, rename (Name).  We have created a set of rules, but it is still empty.  Let's add a rule - in the <b>Rules</b> section there is an <b>Add</b> button, click it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fee/5d6/32e/fee5d632e16462d11413d28b2f29eb10.png"><br><br>  The Rewrite Rule window has opened.  Change <b>Type</b> to ‚ÄúModify Query Param‚Äù and complete two fields: <br><br><ul><li>  <b>Match&gt; Name:</b> <code>urlName</code> </li><li>  <b>Replace&gt; Value:</b> <code>success-kid</code> </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/5f4/e2f/c68/5f4e2fc680c42065f8f93f0f7dc78c80.png"><br><br>  Click OK, OK.  Restart the application ... Success!  We can buy content that was previously unavailable. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/84c/511/263/84c511263d837133edeb34d98acfd0de.png"><br><br>  Interesting: for this new meme a specific price is indicated.  From where  The application had to somehow determine the cost based on the JSON response. <br><br>  Open the Response tab and look at the JSON that the server returns.  What can determine the value of the price? <br><br>  Try to find JSON-keys that can determine the cost of the meme in the application.  Maybe it's generatorID, totalVotesScore, instancesCount, templatesCount or ranking.  As an exercise for you: find the key that affects the cost of the meme. <br><br>  To do this, go to Proxy&gt; Breakpoints.  Click <b>Enable Breakpoints</b> and click <b>Add</b> to add a new breakpoint.  The Edit breakpoint window will appear, enter the following data in it: <br><ul><li>  Protocol: <code>http</code> </li><li>  Host: <code>version1.api.memegenerator.net</code> </li><li>  Response option is on </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/677/20e/81a/67720e81a4de14002c486f0a2a5fb190.png"><br><br>  Now restart the application.  As soon as we receive a response from the server, a breakpoint will work.  When this happens, click on the Edit Response tab, at the bottom select JSON: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a2c/de3/986/a2cde3986bb87d011c7e9d06fd05a5e0.png"><br><br>  Here you can manually modify the JSON response that will go to the application.  Play around with these parameters and try to determine which keys affect the price displayed in the application.  After changing the JSON response, click Execute to send the response.  The application makes three requests to the API, so you will need to click Execute three times. <br><br><div class="spoiler">  <b class="spoiler_title">Found what key affects the price?</b> <div class="spoiler_text">  This is the <code>ranking</code> .  The higher the <code>ranking</code> , the lower the price. <br></div></div><br>  Important: act fast!  <code>AFNetworking</code> has a timeout of 30 seconds.  If you have intercepted the answer, but did not have time to make changes, <code>AFNetworking</code> will return a request timeout error and execute the corresponding handler in the code (which in this case does nothing).  If you have time, restart the application and try again. <br><br><h1>  What's next? </h1>  You <s>discovered hacking abilities and</s> performed simplest penetration tests using the example of the file system and network interaction of a specific application.  You have won simple plists and can even modify server responses. <br><br>  Perhaps this knowledge will enhance the security of your iOS application ... a little bit.  In the next part, we will delve much further into the bowels of the application, we will change its functionality!  And while you're waiting for me to post the translation (until next Friday), you can try a lot of things on the topic of data storage in the application: <br><br><ul><li>  Try tools such as <a href="http://www.macroplant.com/iexplorer/">iExplorer</a> .  iExplorer allows you to explore the contents of files that are used by your real applications.  See what they store there. <br><br>  No jailbreak?  Yah? <br><div class="spoiler">  <b class="spoiler_title">Seriously!</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/f01/ca2/561/f01ca256110bd5d7051781849cfda581.png"></div></div><br></li><li>  Set up SSL proxy in Charles and test it on real applications.  Well, what's sending this app from your device, sitting quietly in the corner with a cute UI?  You will probably be surprised.  And observing the network interaction of competing applications can provide a terrific insight into how they solved network interaction problems similar to yours. <br><br></li><li>  Pull up your knowledge of iOS assembly language (ARM).  The author advises <a href="http://www.raywenderlich.com/37181/ios-assembly-tutorial">this tutorial</a> (in English).  The next part of our lesson will be much more intense!  Get ready. </li></ul><br><br>  Comments on the translation or non-working examples can be sent to the mail <i>dev <code>@</code> x128.ru.</i> </div><p>Source: <a href="https://habr.com/ru/post/199128/">https://habr.com/ru/post/199128/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../199110/index.html">Continuous integration in xcode5</a></li>
<li><a href="../199112/index.html">Interprocedural analysis and optimization (I)</a></li>
<li><a href="../199114/index.html">Remote work is not "freelancing"</a></li>
<li><a href="../199116/index.html">We create the first application on NancyFX. Part Three Nancy modules</a></li>
<li><a href="../199124/index.html">iversity - online courses from the European platform MOOC</a></li>
<li><a href="../199130/index.html">Breaking the iOS application! Part 2</a></li>
<li><a href="../199132/index.html">In Kenya, Wikipedia articles are now available via SMS.</a></li>
<li><a href="../199134/index.html">Firefox 25 release</a></li>
<li><a href="../199136/index.html">Developer Interview</a></li>
<li><a href="../199138/index.html">Network for the smallest. Micro issue ‚Ññ4. Immersion in IOU</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>