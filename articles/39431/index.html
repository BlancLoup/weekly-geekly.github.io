<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tamed GreaseMonkey</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past couple of weeks I have had to work closely with the custom scripts management system for Mozilla products - GreaseMonkey . And since I m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tamed GreaseMonkey</h1><div class="post__text post__text-html js-mediator-article">  Over the past couple of weeks I have had to work closely with the custom scripts management system for Mozilla products - <a href="http://www.greasespot.net/">GreaseMonkey</a> .  And since I myself have appointed the administrator of the blog of the same name, it means to write an introduction to the question - my sacred duty. <br><br><a name="habracut"></a><br><br><h4>  Introduction </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>GreaseMonkey</b> (hereinafter GM) is a system for managing custom scripts for Mozilla products.  In my article I will talk about the browser of this company, about Firefox further (FF).  Also in some places I will touch on its competitors, namely Opera, Safari and of course Internet Explorer (hereafter IE). <br><br>  <b>User Script (User Script)</b> - a script written in JavaScript (hereinafter referred to as JS), installed by the user in the browser and executed when web pages are loaded.  Used to change their design (in the broad sense of the word). <br><br>  Simply put, using custom scripts, you can add / remove / modify elements of a web page, change their behavior, improve User Experience. <br><br><h4>  Installation </h4><br><br>  GM is easily installed as an extension for FF from <a href="https://addons.mozilla.org/ru/firefox/addon/748">the add-ons site</a> .  GM also has an <a href="http://www.greasespot.net/">official website</a> where you can find a lot of useful information. <br><br>  After installing and restarting the FF icon will appear: <br><br><img src="http://tbms.ru/habr/greasemonkey/gm1.png"><br><br>  And this means that you can install custom scripts. <br><br>  The largest <a href="http://userscripts.org/">repository of</a> user scripts is <a href="http://userscripts.org/">userscripts.org</a> .  Installation is very simple.  GreaseMonkey just intercepts the response to the request of the JS-file, and if it has a special header (I will tell about it below), it calls the installation dialog: <br><br><img src="http://tbms.ru/habr/greasemonkey/gm4.png"><br><br><h4>  Overview </h4><br><br>  You can manage GM and installed scripts through the context menu, which is invoked by right clicking on the monkey face: <br><br><img src="http://tbms.ru/habr/greasemonkey/gm2.png"><br><br>  The top of the menu displays a list of scripts active for this page.  Any script can be disabled by removing the check mark. <br><br>  With <a href="http://wiki.greasespot.net/API_reference">the</a> GM <a href="http://wiki.greasespot.net/API_reference">API</a> you can expand this menu.  All actions registered via <a href="http://wiki.greasespot.net/GM_registerMenuCommand">GM_registerMenuCommand</a> will appear in the "Script Commands" submenu. <br><br>  I will skip the ‚ÄúNew Script‚Äù menu item, as I am sure that it is more convenient to make the script in the editor, including editing the meta-information.  In any case, I hope that mastering this master will not cause readers problems. <br><br>  Script Management invokes the following window: <br><br><img src="http://tbms.ru/habr/greasemonkey/gm3.png"><br><br>  In this window, you can customize any installed custom script yourself.  To do this, select it in the left list.  You can add remove URL masks for which this script will be loaded or NOT loaded (classic Allow / Deny), enable / disable / delete the script and, most importantly for the developer, edit it live. <br><br>  To edit the script, click the "Edit" button.  For the first time, GM will ask for an editor.  In the following will automatically open a working copy of the script in the selected editor. <br><br>  On this, the GM tour is considered complete and you can go directly to the subtleties of developing custom scripts. <br><br><h4>  Custom scripts </h4><br><br>  GM scripts are practically nothing (some of the features, I will discuss in the next section) are no different from ordinary JS scripts, so no special knowledge is needed for writing.  But in order for GM to recognize the script as custom, you need to add a special header: <br><br> <code><a href="http://tbms.ru/weborama/inline/"></a> <a href="http://www.fsf.org/licensing/licenses/gpl.html"></a> // ==UserScript== <br> // @name Weborama Inline Player <br> // @namespace tbms.ru/weborama/inline <br> // @description Includes weborama inline player <br> // @author Konstantin Shvydky, Nick Mitin <br> // @include * <br> // @exclude file://* <br> // ==/UserScript== <br> /* <br> This code is licenced under the GPL <br> www.fsf.org/licensing/licenses/gpl.html <br> */ <br></code> <br><br>  With name, author, description everything is clear, we must dwell on the remaining parameters <br><br>  <a href="https://habrahabr.ru/users/namespace/" class="user_link">namespace</a> - any URI (this is not a link, but an analogue of HTML namespace).  You can read this parameter as a unique script identifier. <br>  <a href="https://habrahabr.ru/users/include/" class="user_link">include</a> - mask for pages that will activate this script.  There may be several directives. <br>  @exclude - mask for pages that will NOT activate this script.  There may be several directives. <br><br>  It is also good practice to indicate the license under which the script itself is distributed.  This can be done below the metadata. <br><br>  * About <a href="http://wiki.greasespot.net/Metadata_block">metadata</a> on greasespot.net. <br><br>  The second prerequisite is the end of the file name.  It must end with ".user.js", otherwise GM will not recognize the script. <br><br>  The launch of the script for GM is performed in the order of priority when the <a href="http://developer.mozilla.org/en/Gecko-Specific_DOM_Events">DOMContentLoaded</a> event <a href="http://developer.mozilla.org/en/Gecko-Specific_DOM_Events">occurs</a> at the processed web page.  Keep that in mind. <br><br><h4>  Tips &amp; Tricks </h4><br><br>  We have already found out that user scripts usually change the design of web pages.  Therefore, the main tasks that confront developers are related to DOM programming, namely, the manipulation of the DOM model of web pages.  The problem here is that sometimes it is very difficult to achieve adequate script operation on anti-semantic sites.  And I would like to give a few suggestions for GM developers. <br><br>  Opera, Safari and Firefox have built-in support for XPath, via the document.evaluate () function.  A good <a href="http://developer.mozilla.org/en/DOM/document.evaluate">description of</a> this feature is in <a href="http://developer.mozilla.org/">MDC</a> .  For those who do not know, XPath (XML Path Language) is a language for accessing parts of an XML document.  In the case of the web, this definition is true for HTML.  Excellent tutorial is on <a href="http://zvon.org/xxl/XPathTutorial/General/examples.html">ZVON.org</a> .  The essence of the method is that you create and send a ‚Äúrequest‚Äù to the DOM model, and in return you get an iterator with all the nodes that satisfy this request. <br><br>  It is important to know that you cannot directly modify these nodes in the iterator, since any change rebuilds the DOM, thus making the iterator invalid.  Therefore, first create an array and copy references to these nodes there, and then work with them.  In the example in the MDC, all this is considered. <br><br>  In IE, there is also a partial support for evaluate, which is implemented through a <a href="">hack</a> , created by Dimitri Glazkov and Mehdi Hassan. <br><br>  We added it to our <a href="">JS-Extender</a> , correcting some bugs in it.  However, we did not manage to perform complex XPath queries, so we do not use this function in IE. <br><br>  Another important point worth noting is that when using the element.childNodes property, FF considers text line breaks between tags to be text nodes.  For example, a div with id = container will have not three, but five child nodes: <br><br>  &lt;div id = "container"&gt; <br>  &lt;div&gt; content1 &lt;/ div&gt; <br>  &lt;div&gt; content2 &lt;/ div&gt; <br>  &lt;/ div&gt; <br><br>  Be carefull! <br><br>  And last but most important.  In JS, there is a window object, which, as it were, is a global namespace for all global JS entities.  if we write <br><br>  var myVar = 1; <br><br>  it will be available in <br><br>  window.myVar or window ['myVar']. <br><br>  So, GM also has a window, but it is a wrapper around the window itself of the web page.  This is done to ensure that your code does not overlap with the original page code and does not interfere with it.  But there are situations when you need to directly access the window itself, for example, to get the value of a site variable.  The global property unsafeWindow, which provides access to it, comes to the rescue. <br><br>  If you are writing a cross-browser user script, keep in mind that unsafeWindow is only in GM, it is not in Opera.  Therefore, it is better to start the global variable right away and put the window you need into it, for example: <br><br>  var aWindow = (typeof unsafeWindow! = 'undefined')?  unsafeWindow: window; <br><br><h4>  A spoon of tar </h4><br><br>  Despite the great opportunities, GM has a significant drawback, which is the lack of a centralized mechanism for updating user scripts. <br><br>  There are several attempts to solve this problem: <br><br>  <a href="http://yoast.com/greasemonkey-auto-update-notification/">yoast.com/greasemonkey-auto-update-notification</a> <br>  <a href="http://splintor.wordpress.com/2007/05/01/greasemonkey-wish-auto-update-user-scripts/">splintor.wordpress.com/2007/05/01/greasemonkey-wish-auto-update-user-scripts</a> <br>  <a href="http://userscripts.org/scripts/show/2296">userscripts.org/scripts/show/2296</a> <br><br>  At the moment I am not satisfied with any of them.  We took this question to the development of the poem, and certainly come up with an elegant solution to the problem.  What I will tell you separately. <br><br>  In general, we can say that GreaseMonkey is a special case of the mechanism for managing user scripts.  In Opera, they are supported without any extensions, according to information received from <a href="https://habrahabr.ru/users/pepelsbey/" class="user_link">pepelsbey there is a</a> plugin for Safari, which allows you to run these scripts - <a href="http://8-p.info/greasekit/">GreaseKit</a> , according to information received from <a href="http://jursovet.habrahabr.ru/">jursovet</a> , <a href="http://habrahabr.ru/blogs/google_chrome/39464/">script support is</a> already implemented for Chrome <br><br>  On this I consider my report complete.  Thank you for reading. </div><p>Source: <a href="https://habr.com/ru/post/39431/">https://habr.com/ru/post/39431/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../394301/index.html">Lumen - LED smart-lamp with remote control via Bluetooth</a></li>
<li><a href="../394303/index.html">MTS also rolled out a tariff with unlimited internet</a></li>
<li><a href="../394305/index.html">an old friend is better than two new ones</a></li>
<li><a href="../394307/index.html">Search, vote and some other GT updates</a></li>
<li><a href="../394309/index.html">Iron: Which gadgets are used by online traders</a></li>
<li><a href="../394311/index.html">Babylonian fish in reality: the gadget is inserted into the ear and translates it on the fly</a></li>
<li><a href="../394313/index.html">Crime Prediction Program accused of racism</a></li>
<li><a href="../394315/index.html">The fight of the projectile and armor: how fat programs, games and movies since the days of Windows XP</a></li>
<li><a href="../394317/index.html">How to stay in shape while working in IT</a></li>
<li><a href="../394319/index.html">Outsourcing protection via the Internet as a replacement for the PSCs and PSBs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>