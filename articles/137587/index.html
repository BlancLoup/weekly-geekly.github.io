<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DNS server BIND (theory)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The main goal of DNS is to map domain names to IP addresses and vice versa - IP to DNS. In this article I will look at the work of the BIND DNS server...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DNS server BIND (theory)</h1><div class="post__text post__text-html js-mediator-article">  The main goal of DNS is to map domain names to IP addresses and vice versa - IP to DNS.  In this article I will look at the work of <b>the BIND DNS server</b> (Berkeley Internet Name Domain, earlier: Berkeley Internet Name Daemon), as with (I‚Äôm not afraid of this word) common.  BIND is included with any UNIX distribution.  The basis of BIND is the <b>named</b> daemon, which uses UDP / 53 for its work and for some TCP / 53 requests. <br><br><h4>  Domain Name System Concepts </h4><br>  Historically, before the appearance of the domain name system, the role of the resolver of symbolic names in IP was performed by the / etc / hosts file, which still plays a significant role in this case.  But with the growing number of hosts in the global network, it became unrealistically difficult to monitor and maintain the database of names on all hosts.  As a result, they invented a DNS, which is a hierarchical, distributed system of domain zones.  Let's look at the structure of the Domain Name System in the illustration: <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/699/4aa/64a/6994aa64af1073ce4514b3a5a809e480.png" alt="image"><br>  The DNS domain structure is a tree-like hierarchy consisting of nodes, zones, domains, subdomains, and other elements, which will be discussed below.  The ‚Äútop‚Äù of the domain structure is the root zone.  Root zone settings are located on multiple servers / mirrors located around the world and contain information about all root zone servers, as well as responsible for <b>the first-level domains</b> (ru, net, org, etc.).  Root zone server information is located at this <a href="http://www.root-servers.org/">root server site</a> .  Root zone settings are always available <a href="">here</a> .  Root zone servers process and respond to requests, giving information only about first-level domains (that is, responding to any requests as non-recursive)!  So, the word zone has been repeated many times.  It's time to explain this term. <br><br>  <b>A zone</b> is any part of the domain name system tree that is hosted as a single unit on a <b>DNS server</b> .  For greater understanding, the <i>zone</i> can be called the <i>‚Äúzone of responsibility‚Äù</i> .  <i>The purpose of separating a part of a tree into a separate zone</i> is the transfer of responsibility ( <b>delegation</b> ) for this branch to another person or organization.  In the illustration, zone examples are highlighted with a blue gradient ( <i>name</i> zone, <i>k-max.name</i> zone with all subordinate resources, <a href="http://www.openoffice.org/">www.openoffice.org</a> with all subordinate subdomains and resources).  Not all zones are highlighted in the illustrations, but only some for general understanding and presentation.  Each zone has at least one <b>authoritative DNS server</b> that stores ALL of the information about the zone for which it is responsible. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>A domain</b> is a named branch or subtree in the DNS name tree, that is, it is a specific node that includes all subordinate nodes.  The following quote from the <a href="http://rus-linux.net/MyLDP/BOOKS/nag-20/howdns.htm">Linux Network Administrators Guide</a> clarifies the picture of the difference between a zone and a domain: <br><blockquote>  Thus, the namespace is fragmented into zones (zones), each of which is controlled by its own domain.  Note the difference between zone (zone) and domain (domain): the groucho.edu domain affects all the machines at Groucho Marx University, while the groucho.edu zone only includes hosts that work directly in the computer center, for example, in the department of mathematics .  The host in the physics department belongs to another zone, namely physics.groucho.edu. </blockquote><br>  Each node in the DNS hierarchy is separated from its parent by a dot.  If we draw an analogy with the Linux file system, the domain name system has a similar structure, except that the separator in the file system is a <i>slash</i> , and in the DNS it is a <i>period</i> .  As well as the <b>DNS address</b> is read from right to left (from the root domain to the host name) in contrast to the path in the Linux file system.  <b>The domain name begins with a point</b> (the <i>root domain</i> ) and passes through the domains of the first, second and, if necessary, the third, etc.  levels and ends with the host name.  So  <b>domain name</b> fully reflects the <i>structure of the DNS hierarchy</i> .  Often (I would say always in everyday life), the last dot (designation of the root domain) in the domain name is omitted (that is, in the browser we enter not k-max.nam <u><b>e.</b></u> , But k-max.nam <u><b>e</b></u> ).  So, having analyzed the structure of the domain name, we imperceptibly approached the concept of <b>FQDN</b> . <br><br>  <b>FQDN</b> (English <i>Fully Qualifed Domain Name</i> , <i>Fully Qualified Domain Name</i> ) is a domain name that <b>uniquely</b> identifies a domain name and includes the names of all the parent domains of the DNS hierarchy <b>, including the root one</b> .  A peculiar analogue of the absolute path in the file system.  Let's analyze the above using the domain name mail.k-max.name as an example: <br><blockquote><pre>  mail.k-max.name.
  |  |  |  |  |
  |  |  |  |  + root domain
  |  |  |  + --- first level domain
  |  |  + ------ dot separating domains / parts of FQDN
  |  + --------- second level domain
  + --------------- subdomain / third level domain, possibly - hostname </pre></blockquote><br>  The difference between the <b>FQDN</b> and the usual domain ( <b>non-FQDN</b> ) name appears when naming the domains of the second, third (and so on) level.  To <b>obtain a FQDN,</b> it is <i>necessary</i> to specify higher level domains in the domain name (for example, mail is a domain name, but the FQDN name looks like mail.k-max.name.).  The maximum FQDN size is 255 bytes, with a limit of 63 bytes for each domain name. <br><br>  <b>Subdomains</b> , in short, are <i>subordinate domains</i> .  By and large, all domains on the Internet are subordinate with the exception of the root.  For example, the k-max domain is a subdomain of the name domain, and name, in turn, is a subdomain of the root domain. <br><br>  So, in the diagram above, we looked at the <strong>root domain</strong> , the next in the hierarchy are <strong>the first / top level domains</strong> , they are also <strong>TLDs</strong> , they are also the <strong>Top-Level Domain</strong> .  These domains include <strong><em>national domains</em></strong> ( <em>ru.</em> , <em>Ua.</em> , Etc.) and <em><strong>common domains</strong></em> ( <em>com.</em> , <em>Net.</em> , And others).  There are also <strong>specialized domains</strong> that are not published in the DNS system, but are used by programs (the .onion domain is used by the anonymous Tor network to intercept and then route calls to the hidden services of this network).  There is still a so-called.  <strong>Reserved domain names</strong> defined in RFC 2606 ( <strong>Reserved Top Level DNS Names</strong> ) defines the domain names that should be used as examples (for example, in documentation), as well as for testing.  Such names include, for example, example.com, example.org and example.net, as well as test, invalid, and others. Lower in the hierarchy, as you can see, there are third-level domains, etc.  The domain hierarchy ends <strong>with host names</strong> , which are defined by the corresponding <strong>resource records</strong> or <strong>host records</strong> . <br><br><h4>  Resource records </h4><br>  <strong>A resource record</strong> is that, for the sake of which, ultimately, DNS exists.  <strong>A resource record</strong> is a unit for storing and transferring information in DNS.  Each such record contains <strong><em>information on the correspondence of</em></strong> some <em>name</em> and <em>service information</em> in the DNS, for example, the correspondence of a domain name to an IP address. <br><br><h6>  A resource record consists of the following fields: </h6><br><ul><li>  <strong>Name (NAME)</strong> - the domain name to which this resource record is attached or ‚Äúbelongs‚Äù, or an IP address.  In the absence of this field, the resource record is inherited from the previous record. </li><li>  <strong>Time To Live (</strong> <strong>TTL)</strong> - literally the ‚Äúlifetime‚Äù of the record, the record storage time in the DNS cache (after the specified time the record is deleted), this field may not be indicated in the individual resource records, but then it should be indicated at the beginning of the zone file and will be be inherited by all entries. </li><li>  <strong>class (CLASS)</strong> - defines the type of network, (in 99.99% of cases, IN is used (which means - Internet). This field was created under the assumption that DNS can work in other types of networks besides TCP / IP) </li><li>  <strong>type (TYPE)</strong> - record type syntax and record assignment </li><li>  <strong>data (DATA)</strong> - various information, the format and syntax of which is determined by the type. </li></ul><br>  In this case, it is possible to use the following symbols: <br><ul><li>  ;  - enter comment </li><li>  # - Also introduces comments (only in BIND 4.9 version) </li><li>  @ - Current domain name </li><li>  () - Allow data to span multiple lines </li><li>  * - Metacharacter (name field only) </li></ul><br>  The entire set of resource records can be found in <a href="http://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B5%25D1%2581%25D1%2583%25D1%2580%25D1%2581%25D0%25BD%25D1%258B%25D0%25B5_%25D0%25B7%25D0%25B0%25D0%25BF%25D0%25B8%25D1%2581%25D0%25B8_DNS">wikipedia</a> .  The most commonly used <strong>resource records are as follows</strong> (hereinafter, we will definitely consider them in practice): <br><ul><li>  <strong>A</strong> - ( <em>address record / address record</em> ) maps the host name (domain name) to an IPv4 address.  For each network interface of the machine, one <strong>A-record</strong> must be made.  For example, the following entry displays the <em>domain name k-max.name.</em>  in <em>IPv4, the host address is 81.177.139.65</em> (the <strong>NAME</strong> field is <em>k-max.name.</em> , the <strong>TTL</strong> field is <em>86400</em> , the <strong>CLASS</strong> - <em>IN</em> field, the <strong>DATA</strong> field is <em>81.177.139.65</em> ): <br><blockquote><pre>  k-max.name.  86400 IN A 81.177.139.65 </pre></blockquote></li><li>  <strong>AAAA</strong> ( <em>IPv6 address record</em> ) is similar to A, but for IPv6. </li><li>  <strong>CNAME</strong> ( <em>canonical name record / canonical name record (alias)</em> ) - displays an alias for the real name (to be redirected to another name), for example, the following record defines the ftp alias for the host <a href="http://www.k-max.name/">www.k-max.name</a> .: <br><blockquote><pre>  ftp 86400 IN CNAME www.k-max.name. </pre></blockquote></li><li> <strong>MX</strong> ( <em>mail exchange</em> ) - specifies the hosts for the delivery of mail addressed to the domain.  In this case, the NAME field indicates the destination domain, <em><strong>the TTL field</strong></em> , <strong><em>CLASS</em></strong> <em><strong>field</strong></em> is the standard value, <strong><em>the TYPE field</em></strong> is set to <em>MX</em> , and <strong><em>the DATA field</em></strong> indicates the <em>priority</em> and, after a space, the <em>domain name of the host responsible for receiving mail</em> .  For example, the following entry shows that for the k-max.name domain, send mail first to mx.k-max.name, then to mx2.k-max.name, if any problems occurred with mx.k-max.name .  At the same time, for both MX hosts there must be corresponding A-records: <br><blockquote><pre>  k-max.name.  17790 IN MX 10 mx.k-max.name.
 k-max.name.  17790 IN MX 20 mx2.k-max.name. </pre></blockquote></li><li>  <strong>NS</strong> ( <em>name server / name server</em> ) points to the DNS server serving the domain.  Rather, to say - indicate the server to which this domain is delegated.  If NS records refer to name servers for the current zone, the domain name system practically does not use them.  They simply explain how the zone is organized and which machines play a key role in providing the name service.  For example, the name zone.  Served by the following NS: <br><blockquote><pre>  name.  5772 IN NS l6.nstld.com.
 name.  5772 IN NS m6.nstld.com.
 name.  5772 IN NS c6.nstld.com.
 name.  5772 IN NS j6.nstld.com.
 ...... </pre></blockquote><br>  Zone k-max.name service: <br><blockquote><pre>  k-max.name.  1577 IN NS ns2.jino.ru.
 k-max.name.  1577 IN NS ns1.jino.ru. </pre></blockquote></li><li>  <strong>PTR</strong> ( <em>pointer</em> ) - displays the IP address in the domain name (we will talk about this type of record below in the reverse name resolution section). </li><li>  <strong>SOA</strong> ( <em>Start of Authority / zone entry</em> ) - describes the basic / initial zone settings, it can be said, <em>determines the zone of responsibility of this server</em> .  Only one SOA record should exist for each zone and it should be the first one.  <strong><em>The Name field</em></strong> contains <em>the domain / zone name</em> , <em><strong>the TTL, CLASS fields</strong></em> are the standard value, <strong><em>the TYPE field</em></strong> is set to <em>SOA</em> , and <strong><em>the DATA field</em></strong> consists of several values ‚Äã‚Äãseparated by spaces: the <em>name of the primary DNS (Primary Name Server)</em> , the <em>address of the zone administrator</em> , then in brackets <em>Serial number of the zone file (Serial number)</em> .  Each time you make changes to a zone file, this value needs to be increased, this indicates to the secondary servers that the zone has been changed and that they need to update the zone themselves.  Next - <strong><em>timer values</em></strong> ( <em>Refresh</em> - indicates how often the secondary servers should poll the primary to see if the serial number of the zone has increased, <em>Retry</em> - the waiting time after a failed polling attempt, <em>Expire</em> - the maximum time during which the secondary server can use information about received zone, <em>Minimum TTL</em> - the minimum time during which data remains in the cache of the secondary server).  The example below shows 2 identical SOA records (although the second is written in several lines), but they are the same in meaning and the format of the second record is more understandable due to its structuredness: <br><blockquote><pre>  k-max.name.  86400 IN SOA ns1.jino.ru.  hostmaster.jino.ru.  2011032003 28800 7200 604800 86400
 k-max.name.  86400 IN SOA ns1.jino.ru.  hostmaster.jino.ru.  (
                                                   2011032003;  serial (serial number)
                                                   28,800;  refresh (refresh)
                                                   7200;  retry (retry)
                                                   604800;  expire (expiration date)
                                                   86400);  minimum TTL (minimum) </pre></blockquote></li><li>  <strong>SRV</strong> ( <em>server selection</em> ) - point to the servers providing the work of certain services in this domain (for example, Jabber and Active Directory). </li></ul><br>  Let's take a look at what <strong>Delegation is</strong> .  <strong>Delegation</strong> (more correctly, <strong>delegation of responsibility</strong> ) is the operation of <em>transferring responsibility for a part of the domain name tree (zone) to</em> another person or organization.  Through delegation, the DNS provides for the administration and storage of zones.  Technically, delegation consists in allocating any part of the tree to a separate zone, and placing this zone on a DNS server owned by another person or organization.  At the same time, the ‚Äúgluing‚Äù resource records (NS and A) containing pointers to the authoritative DNS servers of the child zone are included in the parent zone, and all other information relating to the child zone is already stored on the DNS servers of the child zone.  For example, in the illustration, the <strong>root domain</strong> delegates authority to the servers responsible for the TLD, while the TLD in turn delegates the authority to manage the zones ‚Äî second-level servers; sometimes the chain ends there, but it happens that delegation extends to 4 or even 5 levels. <br><br>  For more understanding, I will give an example.  <strong>Delegating the</strong> management of the <em>k-max.name</em> subdomain <em>to</em> another person (in my case, the hoster) leads to the creation of a <strong>new zone</strong> that is administered independently of the rest of the namespace (regardless of the parent name.).  <strong>The zone k-max.name</strong> after delegation of authority is now independent of name.  and may contain all (or rather, any names I want) domain names that end in <em>* .k-max.name.</em>  On the other hand, <strong>the name zone.</strong>  contains only domain names ending in * .name. but not included in delegated to this zone, such as, for example, k-max.name or a-lab.name or any other.  <strong>K-max.name can be divided into subdomains</strong> with names like <em>mail.k-max.name</em> , <em>ftp.k-max.name</em> and some of these subdomains can be allocated to separate zones, and responsibility for these zones can also be delegated .  If ftp.k-max.name is a separate zone, then k-max.name zone will not contain domain records that end in * .ftp.k-max.name. <br><br>  So  <strong>after delegation of responsibility, the</strong> information stored by the delegating zone no longer includes information on the delegated subdomain and its resource records of hosts, but stores information about <strong>name servers</strong> that are authoritative for the delegated subdomain.  These are the ‚Äúgluing‚Äù records, which I have already mentioned above.  In this case, if the DNS server of the parent domain requests information about the address belonging to the delegated subdomain, a list of DNS servers that have the appropriate information is provided in response. <br><br><h4>  DNS servers </h4><br>  Above, when considering the types of resource records, I mentioned the <strong>primary</strong> and <strong>secondary</strong> server.  In addition to these types, there is another type - <strong>caching</strong> . <br><br>  <strong>The main DNS server</strong> (it‚Äôs <em>primary</em> , it‚Äôs <em>master</em> , it‚Äôs <em>primary</em> ) is the <strong><em>authoritative server</em></strong> (sometimes called authoritarian, I don‚Äôt know how to call it right), which stores the <strong>master copy of the zone data file</strong> , followed by the system administrator. <br><br>  <strong>The secondary server</strong> is also <strong><em>authoritative</em></strong> , but it copies the master zone file from the <em>primary server</em> .  <strong>The</strong> only <strong>difference between the</strong> <em>main</em> and <em>secondary is</em> that the main loads its information from the zone configuration files, and the secondary one loads (receives) zone settings from the main server.  <strong>A secondary DNS</strong> can receive its data from another secondary server.  Any request for a host within the zone for which the authoritative server is responsible will eventually be transmitted to one of these servers (the main or secondary).  <em>Secondary servers</em> can be as many as you like.  Depending on the settings, the <strong>main server</strong> can send a signal to the secondary to change the zone, while the <strong>secondary</strong> , receiving the signal, makes a copy.  This action is called <strong>zone transfer.</strong>  There are two mechanisms for <strong>copying a zone</strong> : <em>full copy (AXFR)</em> and <em>incremental (incremental) copy of a zone (IXFR)</em> . <br><br>  <strong>Caching servers are</strong> <em>NOT AUTHORITY</em> , these servers are stored in memory (cache), replies to previous requests, if this server received a request, it first looks at the information in the cache, and if the necessary answer is not found in the cache, then sends the request to a higher-level DNS server. <br><br>  It is also possible to configure DNS in <strong>stels</strong> mode (so-called invisible), information about this server cannot be obtained using direct queries.  This can be useful for organizing a primary server in a secure environment and thus protect the zone from attacks on the zone. <br><br><h4>  DNS clients (resolver) </h4><br>  <em>How do the programs on the end machines know where and in what form to send DNS queries?</em>  They don't know that.  For resolving names and IP addresses by client applications, <strong>the Resolver library is</strong> used.  This is not a special application, it is the functionality of the system (kernel).  So  applications send <em>system calls</em> gethostbyname (2) and gethostbyaddr (2), and the kernel already determines the path to which to proceed further, based on the settings in the /etc/nsswitch.conf file.  This file determines which services (whether it is the <em>/ etc / hosts</em> or <em>DNS</em> <em>file</em> ) and in what order to use.  In earlier versions of the Linux library, <em>libc</em> , the <strong><b>/etc/host.conf</b> file was</strong> used <strong>.</strong>  Here is a fragment of the file that interests us: <br><blockquote><pre>  root @ DNS: ~ # cat /etc/nsswitch.conf
 ......
 hosts: files dns
 networks: files </pre></blockquote><br>  Two lines of this fragment tell the kernel to convert host names to IP ( <em>hosts: files dns</em> string), first from <strong>the hosts file</strong> , then by <strong>DNS</strong> , and also network names to IP (networking <em>: files</em> string) using the / etc / network file. There are also options for <em>nis</em> or <em>nisplu</em> , which determine to use the <em>Network Information System (NIS)</em> to find the address.  The order in which the services are listed determines the order in which they are polled. <br>  If, according to /etc/nsswitch.conf, the DNS request is sent, then the settings from the /etc/resolv.conf file are used, which determines <em><strong>which</strong></em> DNS servers to use.  Here is a typical example of the /etc/resolv.conf file: <br><blockquote><pre>  root @ DNS: ~ # cat /etc/resolv.conf
 nameserver 192.168.1.1
 nameserver 192.168.1.2
 domain examle.com </pre></blockquote><br>  The <strong>nameserver</strong> directive specifies the address of <strong>the domain name server</strong> that will perform recursive resolver queries.  In this file, it is indicated to <strong>use the name north</strong> first 192.168.1.1 then, if the first could not process the request, 192.168.1.2.  It is recommended not to use more than 3 <strong><em>nameserver</em> parameters</strong> .  If the <em>nameserver option is</em> not specified, the resolver will attempt to connect to the server on the local host.  <strong>The domain parameter</strong> specifies the default domain name that will be substituted when DNS cannot find the host name.  There is also <strong>a search option</strong> that specifies additional domains in which the host name must be searched for and resolved.  The search and domain options cannot be shared. <br><br>  In addition to the cache on the <strong>DNS server</strong> , there are <strong>caches for Internet browsers</strong> , <strong>resolver caches</strong> .  A pretty transparent picture is provided by Wikipedia: <br><img src="https://habrastorage.org/getpro/habr/post_images/8a3/03e/2fc/8a303e2fccdaf27e0a642ace38582ed8.png" alt="image"><br><br><h4>  DNS queries </h4><br>  The following types of queries are available in DNS: <strong>iterative</strong> (it is also <em>direct</em> ), <strong>reverse,</strong> and <strong>recursive</strong> . <br><br>  <strong>An iterative</strong> ( <em>direct</em> , <em>non-recursive</em> ) <strong>request</strong> sends the domain name to the DNS server and asks for the return of either the IP address of this domain or the name of the DNS server authoritative for this domain.  However, the DNS server does not poll other servers for a response.  This is how root and TLD servers work. <br><br>  <strong>A recursive query</strong> sends a domain name to the DNS server and asks to return the IP address of the requested domain.  At the same time, the server can access other DNS servers. <br><br>  <strong>The return request</strong> sends the IP and requests to return the domain name. <br><br>  Any <strong>DNS server</strong> must respond to <strong>iterative queries</strong> .  It is possible to configure the DNS to respond to <strong>recursive requests</strong> .  <em>If DNS is not configured to respond to recursive queries, it treats them as <strong>iterative</strong> .</em> <br><br>  Usually, <del>  provider issues </del>  the local network has a DNS server that processes recursive requests, and most likely it is configured to cache requests, which saves traffic and reduces the load on the network.  The client and DNS server interaction scheme can be represented as follows: <br><img src="https://habrastorage.org/getpro/habr/post_images/ef9/491/ddc/ef9491ddc02ccb5997011c3ce8d568f7.png" alt="image"><br>  Let's look at what is drawn in steps: <br><ol><li>  <strong>The client</strong> (browser, email program, or any other application) <em>sends a request to the</em> <strong>resolver</strong> , the resolver determines the address of the configured name server based on the specified configs. </li><li>  <strong>Resolver</strong> <em>sends a request to the</em> specified <strong>name server</strong> . </li><li>  <strong>The name server</strong> accepts this recursive query and, because  has no information about the domain, or perhaps even about the name zone., <em>sends a recursive (or non-recursive depending on the settings) request to the</em> <strong>server responsible for the root zone</strong> . </li><li>  <strong>The root zone server</strong> does not process recursive requests, as a result, it processes this request as iterative and returns the name and address of the <strong>server that is authoritative for the name zone.</strong> </li><li>  The server continues to poll the authoritative servers for the subsequent zones, in descending order of the level of the zones in the name </li><li>  until you get a satisfactory answer, these steps may be longer, depending on the length of the domain name </li><li>  and ‚Äúnesting‚Äù of domain names. </li><li>  As a result, the server receives the necessary response from the name server storing the necessary resource record of the host. </li><li>  Server <del>  provider </del>  the local network returns to the client resolver the requested data. </li></ol><br>  Usually, the number of steps is reduced to a minimum, because  On the way to query flow, there is a caching server that stores the necessary information in the cache.  In this scheme, the question may arise: how does the local DNS server that received the recursive request from the resolver choose a DNS server from the authoritative list?  There are many root DNS servers on the Internet, <strong>which of our root servers will our DNS server send a request to?</strong> <br><br>  To address this issue, <strong>BIND DNS servers</strong> use a <strong>metric</strong> called <strong>response time</strong> ( <em>roundtrip time</em> , or <em>RTT</em> ) to select among authoritative DNS servers of the same zone.  RTT determines the delay with which the response to requests from the remote server comes.  Each time a request is sent to a remote server, the <strong>BIND DNS server</strong> starts an internal timer.  The timer stops when a response is received, and the metric is fixed by the local server.  If you have to choose one of several authoritative servers, the choice falls on the server with the lowest RTT. <br><br>  Before <strong>BIND</strong> first sent a request to a server and received a response from it, a remote RTT value is assigned to the remote server, which is less than all the others received on the basis of measurements.  Thus, <strong>DNS BIND is</strong> guaranteed to poll all authoritative servers for a particular zone randomly, before it starts to choose the preferred one based on the metric. <br><br><h4>  DNS server responses </h4><br>  DNS responses are of the following type: <br><ul><li>  <strong>The authoritative response</strong> comes from the servers that are responsible for the zone. </li><li>  <strong>A non-authoritative response (non-authoritative response)</strong> comes from servers that are not responsible for the zone (from caching). </li></ul><br>  The DNS response usually contains the following information: <br><ul><li>  <strong>Header record</strong> - service information about the request. </li><li>  <strong>Record request</strong> - repeats the sent request. </li><li>  <strong>Record the answer</strong> - actually, the answer itself. </li><li>  <strong>Records of reputable servers</strong> - information about reputable servers that store information on the current request. </li><li>  <strong>Additional information</strong> - additional entries, for example addresses of NS-servers. </li></ul><br>  The above is clearly confirmed by the dig utility: <br><blockquote><pre>  root @ DNS: ~ # dig ya.ru
 ;  &lt;&lt; &gt;&gt; DiG 9.7.3 &lt;&lt; &gt;&gt; ya.ru (heading section)
 ;;  global options: + cmd
 ;;  Got answer:
 ;;  - &gt;&gt; HEADER &lt;&lt; - opcode: QUERY, status: NOERROR, id: 53499
 ;;  flags: qr rd ra;  QUERY: 1, ANSWER: 7, AUTHORITY: 2, ADDITIONAL: 3<font></font>
<font></font>
 ;;  QUESTION SECTION: (query section)
 ; ya.ru.  IN A<font></font>
<font></font>
 ;;  ANSWER SECTION: (response section)
 ya.ru.  4813 IN A 87.250.250.203
 ya.ru.  4813 IN A 87.250.251.3
 ya.ru.  4813 IN A 93.158.134.3
 ya.ru.  4813 IN A 93.158.134.203
 ya.ru.  4813 IN A 213.180.204.3
 ya.ru.  4813 IN A 77.88.21.3
 ya.ru.  4813 IN A 87.250.250.3<font></font>
<font></font>
 ;;  AUTHORITY SECTION: (authoritative servers)
 ya.ru.  4813 IN NS ns1.yandex.ru.
 ya.ru.  4813 IN NS ns5.yandex.ru.<font></font>
<font></font>
 ;;  ADDITIONAL SECTION: (additional information - addresses of authoritative name servers)
 ns5.yandex.ru.  345565 IN A 213.180.204.1
 ns1.yandex.ru.  345565 IN A 213.180.193.1
 ns1.yandex.ru.  3565 IN AAAA 2a02: 6b8 :: 1<font></font>
<font></font>
 ;;  Query time: 7 msec
 ;;  SERVER: 192.168.1.1 # 53 (192.168.1.1)
 ;;  WHEN: Sat Jul 2 23:02:45 2011
 ;;  MSG SIZE rcvd: 238 </pre></blockquote><br><h4>  Inverse name resolution </h4><br>  <strong>DNS is</strong> used primarily to convert domain names to IP addresses, but it can also perform a reverse process, called <strong><em>reverse name translation</em></strong> or <strong>reverse mapping</strong> .  Because  records in the direct DNS database are hierarchically structured by domain names; <strong>DNS</strong> cannot effectively search by IP address in such a database.  <strong>For the reverse conversion to the DNS, the special domain in-addr.arpa is used.</strong>  Resource records in this domain in <strong>the Name field</strong> contain <em>IP-addresses,</em> in <strong>the Type field</strong> - <em>PTR</em> , and in <strong>the Data field</strong> - <em>FQDN-name</em> corresponding to this IP. <br><br>  The diagram shows the <strong>structure of the arpa domain.</strong>  I think that everything is pretty clear here.  <strong>Domain arpa.</strong>  It has 2 sub <strong>-</strong> domains <strong>in-addr</strong> and <strong>ip6</strong> , responsible for <em>IPv4</em> and <em>IPv6</em> addresses, respectively.  <strong>Domain in-addr.arpa.</strong>  has from * .0.in-addr.arpa.  to * .255.in-addr.arpa.  subdomains, each of which also has 256 subdomains. <br><img src="https://habrastorage.org/getpro/habr/post_images/e76/c68/f6c/e76c68f6c0548edd54740ef542dca68f.png" alt="image"><br>  In order to reduce the amount of unwanted correspondence (spam), many mail servers can check for PTR records for the host from which they are sent.  In this case, the PTR record for the IP address must match the name of the sending mail server, which it represents during the SMTP session. <br><br>  Visually presented scheme can be represented by commands: <br><blockquote><pre>  [root @ DNS ~] # dig www.ru
 ...
 ;;  QUESTION SECTION:
 ; www.ru IN A<font></font>
<font></font>
 ;;  ANSWER SECTION:
 www.ru 52119 IN A 194.87.0.50
 ...
 [root @ DNS ~] # dig -x 194.87.0.50
 ...
 ;;  QUESTION SECTION:
 ; 50.0.87.194.in-addr.arpa.  IN PTR<font></font>
<font></font>
 ;;  ANSWER SECTION:
 50.0.87.194.in-addr.arpa.  30385 IN PTR www.ru
 .... </pre></blockquote><br>  In this case, the dig -x 194.87.0.50 command would be more correctly represented as dig 50.0.87.194.in-addr.arpa., That is, entries in the subdomains * .in-addr.arpa.  presented in the so-called reverse notation (or reverse form), that is, a PTR record with the FQDN 50.0.87.194.in-addr.arpa., which in turn indicates the <a href="http://www.ru/">www.ru</a> domain, would correspond to a host with IP 194.87.0.50, which in turn indicates the <a href="http://www.ru/">www.ru</a> domain <a href="http://www.ru/">.</a> Note that most often the Internet provider is responsible for the reverse zone and its editing. <br><br>  As promised, I describe the <strong>PTR resource record</strong> in the <strong>IN-ADDR.ARPA</strong> domain, corresponding to the above A record for the <a href="http://www.ru/">www.ru.</a>  will look like this: <br><blockquote><pre>  50.0.87.194 IN PTR www.ru </pre></blockquote><br><br>  The name 50.0.87.194 does not end with a period and therefore is relative.  Question: relative to what?  In no case is relative to " <a href="http://www.ru/">www.ru</a> ".  In order for this entry to be a FQDN, the default domain must be called ‚ÄúIN-ADDR.ARPA.‚Äù.  This can be achieved either by placing the PTR records in a separate file, in which the default domain name of the zone is <strong>IN-ADDR.ARPA.</strong>  (specified in the bootstrap daemon of the named daemon), or by changing this domain using the $ ORIGIN directive.  If the default domain is defined as 0.87.194.IN-ADDR.ARPA., Then the record can be represented as follows: <br><blockquote><pre>  80 IN PTR www.ru </pre></blockquote><br><br><h4>  Domain Name Registration </h4><br>  In a nutshell, I would like to raise the issue <strong>of domain name registration</strong> . <br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain registration</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is the action by which the client informs the registrar which DNS servers to delegate the subdomain to, and also provides the registrar with contact and payment information. </font><font style="vertical-align: inherit;">The registrar sends the information to the appropriate registry. </font><font style="vertical-align: inherit;">Most often, this is the process of registering </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the first level zone</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (that is, in the TLD of the ru, com, or other zones) with the record of a new domain name. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A domain name registrar</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is an organization that has the authority to create (register) new domain names and extend the validity of already existing domain names in the domain for which mandatory registration is established. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain levels for which mandatory registration of the person responsible for the domain is necessary are as follows:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> root domain </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> all first level domains (tld) </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> some second-level domains (for example, com.ru or co.uk) </font></font></li></ul><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The registrar for the root domain</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is the </font></font><a rel="nofollow" title="ICANN" href="http://www.icann.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ICANN</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> organization </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">To become a domain registrar in second-level zones (.com .net .org .biz .info .name .mobi .asia .aero .tel .travel .jobs ...), you need to get ICANN accreditation.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registration rules in international (gTLD - com., Org, etc.) domains are established by ICANN. Registration rules in national (ccTLD - ru, us, etc.) domains are set by their registrars and / or authorities of the respective countries, for example, uniform rules for all registrars in .ru, and .rf domains are set by the Coordination Center of the national Internet domain. For many domains (including ru), the registrar is not the only one. If there are several registrars, all of them should use a single (centralized or distributed) database to eliminate conflicts and ensure the uniqueness of the domain name.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In most cases, the domain registration service is paid, the registrar determines the price and terms of registration. To register a domain, you must select a free name and send an application for registration with one of the registrars (for example, nic.ru), pay for the provision of services. After registration is confirmed, it is necessary to determine (delegate) the server dns in the registrar's interface, most likely it will be your hoster‚Äôs DNS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the end of the article I want to note the same about such marketing nuance that sometimes second-level domains are called domain names of the FIRST level, thereby ‚Äúomitting‚Äù the root domain value and taking it as the root domain - TLD domains.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I also want to note that the domain address and IP address are not identical - a single IP address can have multiple names, which allows you to maintain multiple websites on one computer (this is called virtual hosting). </font><font style="vertical-align: inherit;">The reverse is also true ‚Äî multiple IP addresses can be mapped to a single name: this allows you to create load balancing.</font></font><br><br><h4>  Summary </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, in today's article I tried to describe the work of the domain name system as clearly as possible. </font><font style="vertical-align: inherit;">I hope I did it. </font><font style="vertical-align: inherit;">We reviewed the hierarchical structure of the DNS database, as well as the processes of interaction between clients and DNS servers, as well as types of DNS servers. </font><font style="vertical-align: inherit;">In the next article I will discuss the practical issues of installing and configuring the BIND DNS server on Linux. </font><font style="vertical-align: inherit;">I will be glad to your comments.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> What else to read: </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">man (5) resolver: </font></font><a href="http://www.opennet.ru/man.shtml%3Ftopic%3Dresolver%26amp%3Bcategory%3D5%26amp%3Brussian%3D0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.opennet.ru/man.shtml?topic=resolver&amp;category=5&amp;russian=0</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> man (3) gethostbyname: </font></font><a href="http://www.opennet.ru/cgi-bin/opennet/man.cgi%3Ftopic%3Dgethostbyname%26amp%3Bcategory%3D3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://www.opennet.ru/cgi-bin/opennet/man .cgi? topic = gethostbyname &amp; category = 3 </font></font></a> <br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux Network Administrators Guide v2 Russian: </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">download</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RFC882, 1035, 1183 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Placed with the permission of </font></font><a href="https://habrahabr.ru/users/mcsim85/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mcsim85</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which does not yet have a full-fledged account on Habr√©, but which for such high-quality articles definitely deserves it! </font><font style="vertical-align: inherit;">Just in case the </font></font><a href="http://www.k-max.name/linux/dns-server-bind/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to the original.</font></font></div><p>Source: <a href="https://habr.com/ru/post/137587/">https://habr.com/ru/post/137587/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137578/index.html">Opera Mini update - even if it is not installed</a></li>
<li><a href="../137581/index.html">Dynamic Access Control for ASP.NET MVC</a></li>
<li><a href="../137582/index.html">Mysterious indents between inline elements</a></li>
<li><a href="../137584/index.html">Create a datepicker similar to the standard in Harmattan</a></li>
<li><a href="../137585/index.html">IT in tourism is a myth</a></li>
<li><a href="../137588/index.html">Weigh CSS selectors</a></li>
<li><a href="../137589/index.html">fbi.gov also uses nginx</a></li>
<li><a href="../137590/index.html">How to protect against unexpected commenting by Ctrl + Enter?</a></li>
<li><a href="../137593/index.html">Another step to PyCon.RU - ekb.py</a></li>
<li><a href="../137594/index.html">One more video glasses from Nabes LLC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>