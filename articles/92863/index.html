<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development using WEB SQL DB and Local Storage</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most recently, Habr√© was a post dedicated to working with WEB SQL DB. One of the useful applications of local databases is working offline. In additio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development using WEB SQL DB and Local Storage</h1><div class="post__text post__text-html js-mediator-article">  Most recently, Habr√© was a <a href="http://www.ridev.ru/g1R">post</a> dedicated to working with WEB SQL DB.  One of the useful applications of local databases is working offline.  In addition, I will show another way of working when local storage is used instead of sql, which is already supported by a large number of browsers. <br><a name="habracut"></a><br><h4>  Definition of offline mode </h4><br>  To begin with, we define that we work in offline mode.  There are several ways.  First, we can send a request, and in case of failure, start working in the right mode.  But HTML5 allows you to define it in a simpler way, namely <br><blockquote><code><font color="black">navigator.onLine</font></code> </blockquote> <br>  Unfortunately, this will only work in Opera and Firefox ( <a href="http://www.ridev.ru/gHA">www.html5demos.com/ is a</a> good site that shows support for a particular feature by browsers). <br>  Having determined that we are offline, we can proceed to further work.  It is important to remember that by this time, all the resources we need should be zapped.  More information about creating a cache for offline applications can be found <a href="http://www.ridev.ru/gHg">here</a> .  And on StackOverflow, you can read a <a href="http://www.ridev.ru/gHj">discussion</a> about which method is still more convenient. <br><br><h4>  We work with WEB SQL DB </h4><br><br>  Working with the base is easy enough 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First create it. <br><blockquote> <code><font color="black">db = openDatabase( <font color="#A31515">"TestDB"</font> , <font color="#A31515">"1.0"</font> , <font color="#A31515">"HTML5 Database"</font> , 200000);</font></code>  . </blockquote><br>  The following parameters are passed to the database creation function: <br><ul><li>  Database name </li><li>  Her version </li><li>  Display Name </li><li>  Size in bytes </li></ul><br>  Next, open the transaction and perform the actions we need. <br><blockquote> <code><font color="black">db.transaction( <font color="#0000ff">function</font> (tx) <br> { <br> tx.executeSql( <font color="#A31515">"DELETE FROM tbl_test WHERE id = ?"</font> , [item.id]); <br> }); <br></font></code> </blockquote><br><br>  And then everything like that.  I would like to suggest an alternative, namely the jQT Database library. <br>  Here you can read how this plugin works.  And you can download it <a href="">here</a> if you try to download it from the link given in the first source, nothing will come out. <br>  In short, how it works. <br><br>  Initialize the database: <br><blockquote> <code><font color="black">jQT.dbOpen(‚Äúname‚Äù, ‚Äúversion‚Äù,‚Äùdescriptione‚Äù, size);</font></code> </blockquote> <br>  Create a table: <br><blockquote> <code><font color="black">jQT.dbCreateTables(json);</font></code> </blockquote> <br>  Insert the lines: <br><blockquote> <code><font color="black">jQT.dbInsertRows(json);</font></code> </blockquote> <br>  Select lines: <br><blockquote> <code><font color="black">jQT.dbSelectAll(‚Äútable‚Äù, callback(result));</font></code> </blockquote> <br>  Delete the lines: <br><blockquote> <code><font color="black">jQT.dbDeleteRow(‚Äútable‚Äù,‚Äùkey‚Äù,‚Äùvalue‚Äù);</font></code> </blockquote> <br>  Delete the table: <br><blockquote> <code><font color="black">jQT.dbDropTable(‚Äútable‚Äù);</font></code> </blockquote> <br>  Run query: <br><blockquote> <code><font color="black">jQT.dbExecuteQuery(‚ÄúQuery‚Äù,‚ÄùDebug text‚Äù, callback(result));</font></code> </blockquote> <br><br>  IMHO, very comfortable. <br>  A couple of comments.  The jQT variable is created when working with jQTouch.  If you do not want to use extra libraries, then the easiest way is to get into the source code and tear out the necessary code for yourself, since it is written very well. <br><br><h4>  We work with local storage </h4><br><br>  Now let's do all the same work, but only using local storage.  At first we will start the storage itself. <br><br><blockquote> <code><font color="black"><font color="#0000ff">var</font> storage = window.localStorage;</font></code> </blockquote> <br><br>  Now to get an empty variable, it is enough to write the following code. <br><br><blockquote> <code><font color="black">storage.operations = <font color="#A31515">""</font></font></code> </blockquote> <br><br>  Now we are faced with the question of how to organize data storage.  My solution was to store the text version of xml and its subsequent conversion.  (Actually, in my case, the solution was quite obvious and probably the only one, since the web service returned xml to me) <br><br>  We execute a request to the server (I use jQuery and, I think, it will be easy to use this code in other frameworks). <br><br><blockquote> <code><font color="black">$.ajax({ <br> url: <font color="#A31515">'/operations/get/'</font> , <br> type: <font color="#A31515">'POST'</font> , <br> success: <font color="#0000ff">function</font> (res) { <br> <font color="#0000ff">var</font> successful = $(res).find( <font color="#A31515">"successful"</font> ).text(); <br> <font color="#0000ff">if</font> (successful == <font color="#A31515">"true"</font> ) { <br> storage.operations = <font color="#A31515">"&lt;result&gt;"</font> ; <br> <font color="#0000ff">var</font> jobz = $(res).find( <font color="#A31515">"return"</font> ).children(); <br> jobz.each( <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> nodName = $( <font color="#0000ff">this</font> )[0].nodeName; <br> <font color="#0000ff">if</font> (nodName == <font color="#A31515">"OPERATIONS"</font> ) { <br> <font color="#0000ff">var</font> operation = $( <font color="#0000ff">this</font> ); <br> storage.operations += <font color="#A31515">"&lt;operations&gt;"</font> + operation.html() + <font color="#A31515">"&lt;/operations&gt;"</font> ; <br> } <br> }); <br> storage.operations += <font color="#A31515">"&lt;/result&gt;"</font> ; <br> <br> } <font color="#0000ff">else</font> { <br> storage.operations += <font color="#A31515">"&lt;?xml version='1.0' encoding='utf-8'?&gt;&lt;result&gt;&lt;/result&gt;"</font> ; <br> } <br> } <br> });</font></code> </blockquote> <br><br>  So, we have executed the request.  Since the result is xml, in order to work with it as a DOM object in jQuery, it is enough to simply wrap it with $ ().  Unfortunately, this does not work in Internet Explorer, where the following code is needed to translate text into a DOM object <br><br><blockquote> <code><font color="black"><font color="#0000ff">function</font> getXml(text) { <br> <font color="#0000ff">try</font> { <br> <font color="#0000ff">var</font> xmlDocument = <font color="#0000ff">new</font> ActiveXObject( <font color="#A31515">"Microsoft.XMLDOM"</font> ); <br> xmlDocument.async = <font color="#A31515">"false"</font> ; <br> xmlDocument.loadXML(text); <br> <font color="#0000ff">return</font> xmlDocument; <br> } <font color="#0000ff">catch</font> (e) { <br> alert(e.description); <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">null</font> ; <br> }</font></code> </blockquote> <br><br>  You can read about working with web services in IE <a href="http://www.ridev.ru/gvu">here</a> . <br><br>  If the request is successful, then we select all descendants of the root node (in my case they can be of several types) and wrap it with the necessary tags.  I note that the .html () call will return exactly the code with the tags, while .text () will return only the content inside the tags. <br><br>  Now to get what we have saved we are doing the following function. <br><br><blockquote> <code><font color="black"><font color="#0000ff">function</font> getOperationsFromStorage() { <br> <font color="#0000ff">return</font> $(storage.operations).find( <font color="#A31515">'operations'</font> ); <br> }</font></code> </blockquote> <br><br>  You can work with it as follows. <br><br><blockquote> <code><font color="black">getOperationsFromStorage().each( <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> id = $( <font color="#0000ff">this</font> ).find( <font color="#A31515">'id'</font> ).text(); <br> alert( <font color="#A31515">"Find entitie with id "</font> +id); <br> });</font></code> </blockquote> <br><br>  As you can see, every time we wrap this $ () and call its .find () method.  If we have nested entities, then we can get to them as follows. <br><br><blockquote> <code><font color="black">$( <font color="#0000ff">this</font> ).find( <font color="#A31515">"otherInfo"</font> ).each( <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> name = $( <font color="#0000ff">this</font> ).find( <font color="#A31515">"name"</font> ).text(); <br> alert(‚ÄúFound inline tag value ‚Äù+name); <br> });</font></code> </blockquote> <br><br>  There is one more question, how to update our object.  I do it like this. <br><br><blockquote> <code><font color="black"><font color="#0000ff">var</font> s = <font color="#A31515">"&lt;operations&gt;"</font> ; <br> s += <font color="#A31515">"&lt;id&gt;"</font> + someId+ <font color="#A31515">"&lt;/id&gt;"</font> ; <br> s += <font color="#A31515">"&lt;type&gt;"</font> +type+ <font color="#A31515">"&lt;/type&gt;"</font> ; <br> s += <font color="#A31515">"&lt;/operations&gt;"</font> ; <br> <font color="#0000ff">var</font> text = storage. operations; <br> text = text.substring(0, text.length - 9); <br> text += s + <font color="#A31515">"&lt;/result&gt;"</font> ; <br> storage. operations = text;</font></code> </blockquote> <br><br>  As you can see, I cut off the closing tag, append a new object and at the end close it again with a wrapping tag. <br><br>  I hope that now the work on creating offline applications will become easier. <br><br>  PS: In conclusion, I would like to talk about the <a href="http://www.ridev.ru/gHZ">Modernizr</a> library, which allows you to determine if a browser supports one feature or another. </div><p>Source: <a href="https://habr.com/ru/post/92863/">https://habr.com/ru/post/92863/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../92851/index.html">Memo for installing and configuring Google Analytics</a></li>
<li><a href="../92852/index.html">How to use "unused" keys / indicators on the keyboard</a></li>
<li><a href="../92857/index.html">ASUS Eee Keyboard Review</a></li>
<li><a href="../92860/index.html">Credit</a></li>
<li><a href="../92862/index.html">Amiga 1200, maximum upgrade</a></li>
<li><a href="../92864/index.html">TBDB, or write a database in BASH</a></li>
<li><a href="../92865/index.html">Apple and prices</a></li>
<li><a href="../92866/index.html">Chronicle of diving habrasila, script rating, attention vampirism and the 25th day of judgment</a></li>
<li><a href="../92867/index.html">Execution of SQL-like queries on the data - both in the browser and on the server</a></li>
<li><a href="../92868/index.html">Quake 3 on the Moorestone platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>