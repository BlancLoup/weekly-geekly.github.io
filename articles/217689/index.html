<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ansible and Docker, why and why?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There is a lot of interest among the technical community in Docker and Ansible , I hope that after reading this article, you will also share this inte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ansible and Docker, why and why?</h1><div class="post__text post__text-html js-mediator-article">  There is a lot of interest among the technical community in <a href="https://www.docker.io/">Docker</a> and <a href="https://github.com/ansible/ansible">Ansible</a> , I hope that after reading this article, you will also share this interest.  You will also gain practical skills in the use of Ansible and Docker in setting up a server and environment for a Rails application. <br><br>  ‚ÄúWhy not just take and use Heroku?‚Äù, You ask. <br>  First of all, I can run Docker and Ansible on any machine, with any hosting provider.  Secondly, I prefer flexibility, convenience.  I can, in the same way, run anything, not just web applications.  And finally, because I am an experimenter in the shower, I enjoy the understanding of how it all works together.  The fundamental basis of Heroku is a Linux container.  The same technology lies at the heart of Docker.  In fact, one of Docker‚Äôs mottos is ‚ÄúContainerization is new virtualization.‚Äù <br><a name="habracut"></a><br><h4>  Why Ansible? </h4><br>  After 4 years of active use of Chef, infrastructure as a code has become really tedious for me.  I spent more time behind the code that ran my infrastructure, but not behind the infrastructure itself.  Any change, no matter how small, will require a lot of effort for a slight benefit. <br><br>  With Ansible, on the one hand there is data describing the infrastructure, on the other hand there are restrictions between the interaction of other components.  This model is much simpler, it allows you to move much faster, allowing you to focus on what my infrastructure is doing.  As in the Unix model, Anisible provides modules with a single responsibility, which can be combined in an infinite number of ways. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Ansible has no dependencies except Python and SSH.  She does not need to install agents on remote machines, she does not leave any kind of garbage after her work.  Moreover, it comes with a standard library of modules for managing everything from the package manager in the cloud to the databases. <br><br><h4>  Why docker? </h4><br>  Docker positions itself as the most reliable and convenient way to deploy a process on a machine.  This can be anything from mysqld to redis, ending with a Rails application.  In the same effective way as git snapshots and code distribution, Docker does the same with processes.  It guarantees that everything you need to run this process will be provided, regardless of the machine on which it is running. <br><br>  The basic but understandable mistake is comparing the Docker container with the VM.  Here the principle of sole responsibility applies; launching one process per container gives ease of changeability and support.  This model has stood the test of time in the Unix philosophy; it provides a solid foundation for action. <br><br><h4>  Customization </h4><br>  Without leaving my terminal, I can get a customized machine from Ansible on one of the following hosts: AWS, Linode, Rackspace, or DigitalOcean.  More specifically, with the help of Ansible, I create a new droplet with 2 GB of memory on DigitalOcean in the Amsterdam 2 region in 1 minute 25 seconds.  For another 1 minute and 50 seconds, I can get a tuned system with Docker and some other settings.  Now that I have a base system, I can deploy my application.  Note that I did not set up any programming language or database.  Docker himself took care of this. <br><br>  Ansible executes all commands on remote machines via SSH.  My SSH keys lying in the local ssh-agent will be remotely shared via the Ansible SSH session.  When, on a remote machine, the code of my application will be cloned or updated, no data will be required for authorization in git, for authorization a forwarding ssh-agent from the local machine will be used. <br><br><h4>  Docker and application dependencies </h4><br>  I find it amusing that most developers specify the PL version, modules for Python, Ruby gems, or node.js modules needed for their application, but when it comes to something important, for example, a database server or a queue server, they use what is available at the moment.  I think this is one of the reasons for the <a href="http://en.wikipedia.org/wiki/DevOps">DevOps</a> movement, developers take responsibility for the environment in which they run the application.  Docker makes this task easier and simpler by adding a slice of pragmatism and confidence to existing practices. <br><br>  My application defines dependencies on processes such as MySQL 5.5 and Redis 2.8 including the <code>.docker_container_dependencies</code> file <br><pre> <code class="bash hljs">gerhard/mysql:5.5 gerhard/redis:2.8</code> </pre><br><br>  Ansible playbook will see this file and tell Docker to take the correct images from the image index and run them as containers.  Also, these containers are linked to the container of my application.  If you want more details about container linking, check out the <a href="http://blog.docker.io/2013/10/docker-0-6-5-links-container-naming-advanced-port-redirects-host-integration/">Docker 0.6.5 announcement.</a> <br><br>  My application also comes with a Dockerfile that is specific to the Ruby Docker image.  When the image is installed, the steps in the Dockerfile ensure that the correct version of Ruby is installed. <br><br><pre> <code class="bash hljs">FROM howareyou/ruby:2.0.0-p353 ADD ./ /terrabox RUN \ . /.profile ;\ rm -fr /terrabox/.git ;\ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /terrabox ;\ bundle install --<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> ;\ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'. /.profile &amp;&amp; cd /terrabox &amp;&amp; RAILS_ENV=test bundle exec rake db:create db:migrate &amp;&amp; bundle exec rspec'</span></span> &gt; /<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-terrabox ;\ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'. /.profile &amp;&amp; cd /terrabox &amp;&amp; export RAILS_ENV=production &amp;&amp; rake db:create db:migrate &amp;&amp; bundle exec unicorn -c config/unicorn.rails.conf.rb'</span></span> &gt; /run-terrabox ;\ <span class="hljs-comment"><span class="hljs-comment"># END RUN ENTRYPOINT ["/bin/bash"] CMD ["/run-terrabox"] EXPOSE 3000</span></span></code> </pre><br><br>  The first step is to copy all the code of my application into the Docker image and load global environment variables added by the previous images.  A Ruby Docker image, for example, adds paths to the PATH to load the correct version of Ruby correctly. <br><br>  Next, I delete the git history because it is not needed in this context.  I install all the gems and then create a / test-terrabox file that runs only for tests.  The goal of all this is to have a ‚Äúcanary‚Äù version that checks the application and all its dependencies, that all Docker containers are linked correctly and all tests passed successfully, before the actual launch of the application. <br><br>  The command that is called when a new container is started is defined in step CMD. <br>  Running the / run-terrabox command, defined as part of the build process, immediately after the test launch process. <br><br>  The last instruction in the Dockerfile forwards port 3000 from inside the Docker container to the host machine from which Docker is running.  Which can be used by the server or the load balancer for proxying requests to my container application. <br><br><h4>  Running a Rails application inside the Docker container </h4><br>  For an average Rails application, with about 100 gems somewhere and a lot of integration tests running from under Rails, all of this takes 8 minutes 16 seconds per 2GB and 2 kernel machines, without any local Docker images.  If I already have a Ruby, Mysql and Redis image on this machine, it will take 4 minutes and 45 seconds.  Moreover, if I already have a reference image of my application, then it takes 2 minutes 23 seconds.  If you look, in perspective, deploying a new Rails application, including dependencies such as MySQL and Redis, takes no more than 2 minutes. <br><br>  It should also be noted that the deployment of the application includes the launch of all tests that take up the minute of time. <br>  Without exaggeration, Docker becomes a simple means of continuous integration, which reserves only test containers for research if tests do not pass, or a new application container starts with the latest version when tests pass.  Suddenly, I can check the new code with my customers in minutes, which is guaranteed to be isolated from other versions of the application at the operating system level.  Unlike traditional VMs that load in minutes, the Docker spends seconds.  Moreover, once I created the Docker image and made sure that all the tests were passed for a specific version of my application, I can upload the image to a private registry, which in turn can be loaded by other Docker machines and launched as a new container, and all this in seconds. <br><br><h4>  Conclusion </h4><br>  Ansible let me take a fresh look at the infrastructure management process.  Docker gave me confidence and stability when it comes to one of the most important development steps, the delivery phase.  In combination, they are unmatched. <br><br>  Getting a fully customized Rails application from scratch in just 12 minutes is impressive for any standard.  Getting the basic Continuous Integration system for free with the ability to preview different versions of an application side by side, without affecting the ‚Äúworking‚Äù version running on the same machine, is incredibly powerful.  It makes me happy, and having reached the end of the article, I can only hope that you will share my joy with me. </div><p>Source: <a href="https://habr.com/ru/post/217689/">https://habr.com/ru/post/217689/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../217675/index.html">BAKU 898D soldering station overview</a></li>
<li><a href="../217679/index.html">Why do companies refuse top staff?</a></li>
<li><a href="../217683/index.html">Fun facts about data loss</a></li>
<li><a href="../217685/index.html">Overview of Multifactor Authentication in the Microsoft Azure Cloud</a></li>
<li><a href="../217687/index.html">YotaPhone Idea Camp: together we are power!</a></li>
<li><a href="../217691/index.html">Code sharing between WP7, WP8, Win8 platforms. The basics</a></li>
<li><a href="../217693/index.html">Trolling detector: how we increased productivity using a speech analyzer</a></li>
<li><a href="../217695/index.html">Current trends in the development of DDoS attacks and protection against them using DefensePro Radware</a></li>
<li><a href="../217697/index.html">Antiblog: diary only for yourself</a></li>
<li><a href="../217699/index.html">Yandex.Mail will allow you to unsubscribe from mailings</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>