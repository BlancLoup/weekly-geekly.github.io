<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ruby, SmallTalk and class variables</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article is a translation of the Pat Shaughnessy note, originally sounded like Ruby, Smalltalk and Class Variables . 

 A couple of weeks ago an ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ruby, SmallTalk and class variables</h1><div class="post__text post__text-html js-mediator-article">  <i>The article is a translation of the Pat Shaughnessy note, originally sounded like <a href="http://patshaughnessy.net/2012/12/17/ruby-smalltalk-and-class-variables">Ruby, Smalltalk and Class Variables</a></i> . <br><br>  A couple of weeks ago <a href="http://erniemiller.org/2012/11/29/ruby-tidbit-include-vs-extend-with-module-class-variables/">an article by Ernie Miller</a> (Ernie Miller) pushed me to the question: how do class variables work in Ruby?  After a little research, it turned out that class variables can be a potential source of problems.  In fact, John Nunemaker has already written the article <a href="http://railstips.org/blog/archives/2006/11/18/class-and-instance-variables-in-ruby/">‚ÄúRuby class and instance variables‚Äù</a> , which dates from 2006 and remains relevant today.  The fundamental problem of class variables is that they are divided between the class itself and all its subclasses ‚Äî as John explained six years ago, and this can lead to confusion and strange code behavior. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For me, the main question is: ‚ÄúWhy?‚Äù.  Why does Ruby divide this value between all subclasses?  Why is there a difference between class variables and instance variables?  Where do these ideas come from?  It turns out that the answer is simple: class variables work the same as they did in a much more ancient language called <a href="http://en.wikipedia.org/wiki/Smalltalk">Smalltalk</a> .  Smalltalk was invented in the early 1970s by renowned computer scientist <a href="http://en.wikipedia.org/wiki/Alan_Kay">Alan Kay</a> and a group of colleagues working at the <a href="http://www.parc.com/">Xerox PARC</a> laboratory.  With the invention of Smalltalk, Allan did not just invent a programming language;  he came up with the whole concept of Object Oriented Programming (OOP) and first implemented it.  Although not widely spoken now, Smalltalk has influenced many other object-oriented languages ‚Äã‚Äãthat are widely spoken today - the most important of which are Object C and Ruby. <br><br>  Today I want to take a look at how class variables work in Smalltalk, and compare versus how they work in Ruby.  You will see that the idea of ‚Äã‚Äãclass variables is not the only borrowing from Smalltalk.  Most of the Ruby object model was also taken from Smalltalk. <br><br><h4>  Class variables in ruby </h4><br>  First, let's look at what class variables are and how they work in Ruby, using the <a href="http://railstips.org/blog/archives/2006/11/18/class-and-instance-variables-in-ruby/">example of John Nunmeker of 2006</a> : here is a simple Ruby class, <code>Polygon</code> , which contains a single class variable <code>@@sides</code> . <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class"> @@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> = 10 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> @@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> =&gt;10</span></span></code> </pre><br><br>  This example is quite simple: <code>@@sides</code> is a variable to which any class or method of an instance of the <code>Polygon</code> class has access.  In the example, <code>sides</code> is a class method that returns it. <br>  At the conceptual level, inside, Ruby associates the <code>@@sides</code> variable with the same memory section that the <code>Polygon</code> class represents: <br><img src="https://habrastorage.org/getpro/habr/post_images/19f/c53/4f4/19fc534f48f4e7df1cb7cb50bca040ed.jpg" alt="image"><br><br>  Trouble starts when you define a subclass;  another example of john's: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Triangle</span></span></span><span class="hljs-class"> &lt; Polygon @@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> = 3 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Triangle</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> =&gt;3 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> =&gt;3</span></span></code> </pre><br><br>  Notice that both class variables, <code>Triangle.sides</code> and <code>Polygon.sides</code> , have been changed to 3. In essence, Ruby creates a single variable inside itself that is shared by both classes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/943/d83/54f/943d8354f39857fe27966de7aa3510b7.jpg" alt="image"><br><br>  I can write in more detail about the internal implementation of class variables in Ruby in the next post of my blog, but for the time being I will use the simplest diagrams.  Instead, let's switch and learn a little more about Smalltalk ... <br><br><h4>  What is Smalltalk? </h4><br>  As I said above, Alan Kay invented Smalltalk at the same time as object-oriented programming when working at Xerox PARC in the early 1970s.  This is the same lab that invented the personal computer, graphical user interface, and Ethernet and many many other things.  Against this background, the invention of OOP seems the least important of the inventions! <br><br>  In Smalltalk, Kay proposed terminology and ideas that go without saying today.  Each value in Smalltalk, including language constructs such as blocks, is an object.  A Smalltalk program consists of these objects and the way they interact;  To call a specific function on Smalltalk, you 'send a message' to an object that implements this function.  In Smalltalk, functions are called 'methods'.  The object implements a series of methods.  All this should sound very similar, of course. <br><br>  From the very beginning, Kay's PLO concept incorporated the idea of ‚Äã‚Äã'class' objects.  Object classes were described as a series of behaviors (methods), each instance of which could be invoked.  Smalltalk also implemented the concept of polymorphism, which allows the developer to define 'subclasses', to inherit the behavior of their 'superclasses'.  All these concepts that we often use today were invented by Kay and his colleagues 40 years ago. <br><br>  Smalltalk, however, is more than a programming language - it is a whole graphical development environment.  I consider Smalltalk a forerunner of Visual Studio and XCode, developed when Microsoft and Apple did not even exist, in a world where computers were used only for academic or government purposes.  Another impressive goal of Alan Kay and the Smalltalk team, originally set, was to use their visual environment to educate children in schools.  This is a truly amazing story! <br><br>  To learn more about the history and origin of Smalltalk, I highly recommend reading The Early History of Smalltalk ( <a href="http://www.smalltalk.org/smalltalk/TheEarlyHistoryOfSmalltalk_Abstract.html">html</a> , or <a href="http://www.smalltalk.org/downloads/papers/SmalltalkHistoryHOPL.pdf">pdf</a> , or <a href="http://samizdat.cc/shelf/documents/2004/08.02-historyOfSmalltalk/historyOfSmalltalk.pdf">pdf but without diagrams</a> ), a retrospective review Kay wrote later in the 1990s.  This is a fascinating story about how Kay and his colleagues borrowed ideas from even the earlier past, but their combination was hard work, creative, where she could make a huge step forward with pure talent and make a revolution in the computer science world of their days, as well as ours. <br><br>  Alan Kay created the first working version of Smalltalk in 1972 - in his own words, how it happened: <br>  <i>I expected the new Smalltalk to be a landmark language, and its development will take at least two years, but fate intervened in the plans.</i>  <i>One fine day, during a typical male conversation in the hallway of PARC, Ted Kaehler, Dan Ingalls and I stood and talked about programming languages.</i>  <i>It was time to discuss the power of the language and now they were interested in how to make the language super powerful.</i>  <i>Drawing myself in front of them, I said that 'the most powerful language in the world' they can capture 'in pages with code'.</i>  <i>Their cue was: "create or shut up."</i>  <i>Ted went back to CMU, but Dan was still there and continued to push me further.</i>  <i>The next two weeks I came to PARC at four o'clock in the morning and worked until eight, then Dan together with Henry Fuchs, John Shoch, and Steve Purcell began discussing morning work.</i>  <i>I boasted in advance because the interpreter LISP (LISP) McCarthy (John McCarthy) was written in LISP-e.</i>  <i>It was about that very ‚Äúpage with code‚Äù, and over time, when the power of the language grew, it became everything for functional languages.</i>  <i>I was absolutely sure that I could do the same for object-oriented languages.</i> <br><br>  Here Kay refers to <a href="http://en.wikipedia.org/wiki/John_McCarthy_(computer_scientist)">John McCarthy</a> , who invented LISP ten years earlier.  Kay took only eight mornings to complete the first version of Smalltalk: <br>  The first few versions had flaws that were loudly criticized by the group.  But by the eighth morning, or somewhere around that, the code was working ... <br><br>  I would like to be as creative, versatile and productive as Alan Kay and his PARC colleagues were 40 years ago. <br><br><h4>  Class variables in smalltalk </h4><br>  To find out how class variables directly work in Smalltalk, I installed GNU Smalltalk, a command-line version of the language that is easy to download and run under the Linux Box.  At the beginning, Smalltalk seemed to me very strange and unfriendly;  its syntax is a bit strange at first glance.  For example, to remember to the end every command, and also, when defining a method, you need to specify only a list of arguments ... without the name of the method!  I suppose the first argument is the name of the method, or something like that.  But after a couple of days I got used to a kind of syntax, and the language became more meaningful for me. <br><br>  Here, the same Polygon class ‚Äî Smalltalk code on the left, on Ruby on the right. <br><table><tbody><tr><td><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Object</span></span> subclass: <span class="hljs-type"><span class="hljs-type">Polygon</span></span> [ <span class="hljs-type"><span class="hljs-type">Sides</span></span> := <span class="hljs-number"><span class="hljs-number">10.</span></span> ] <span class="hljs-type"><span class="hljs-type">Polygon</span></span> class extend [ sides [ ^<span class="hljs-type"><span class="hljs-type">Sides</span></span> ] ] <span class="hljs-type"><span class="hljs-type">Polygon</span></span> sides printNl. =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre><br></td><td><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class"> @@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> = 10 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> @@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> =&gt; 10</span></span></code> </pre><br></td></tr></tbody></table><br><br>  Further, a small explanation of what Smalltalk code does: <br>  ‚Ä¢ <code>Object subclass: Polygon</code> - this means sending a subclass of a message to the Object class and passing the name Polygon.  This will create a new class that is a subclass of the Object class.  This is an analogy of the expression class Polygon &lt;Object in Ruby.  Of course, in Ruby, specifying Object as a superclass is optional. <br>  ‚Ä¢ <code>Sides := 10.</code> - a Sides class variable is declared here, and a value is assigned to it.  Ruby uses a different syntax: @@ sides. <br>  ‚Ä¢ <code>Polygon class extend</code> - here the <code>Polygon class extend</code> expands;  those.  The Polygon class opens to give me the opportunity to add a class method.  In Ruby, I use the construct: class Polygon;  def self.sides <br>  ‚Ä¢ <code>printNl</code> method displays the value in the console;  this works in the same way as puts in Ruby, except that the printNl method is a method of the <code>Sides</code> object.  Imagine just calling <code>@@sides.puts</code> in Ruby! <br><br>  In addition to superficial differences in syntax, if you take a step back and think, you will discover how amazing Smalltalk and Ruby are!  Both languages ‚Äã‚Äãnot only share the concept of class variables, but also the writing of the Polygon class, the declaration of a class variable and the output of the values ‚Äã‚Äãin them in the same way.  In fact, you can think of Ruby as a new version of Smalltalk with a simplified, and more convenient syntax! <br><br>  As I said above, Smalltalk shares class variables between subclasses, in the same way Ruby does.  Here is an example of how I declare the Triangle subclass in Smalltalk and Ruby. <br><table><tbody><tr><td><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Polygon</span></span> subclass: <span class="hljs-type"><span class="hljs-type">Triangle</span></span> [ ] <span class="hljs-type"><span class="hljs-type">Triangle</span></span> class extend [ set_sides: num [ <span class="hljs-type"><span class="hljs-type">Sides</span></span> := num ] ] <span class="hljs-type"><span class="hljs-type">Polygon</span></span> sides printNl. =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre><br></td><td><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Triangle</span></span></span><span class="hljs-class"> &lt; Polygon </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class">=(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">num</span></span></span><span class="hljs-class">) @@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">num</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Triangle</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> =&gt; 10</span></span></code> </pre><br></td></tr></tbody></table><br>  Here I declare the Triangle subclass and its method to set the value of its class variable.  Now, let's try changing its value from a subclass. <br><table><tbody><tr><td><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Triangle</span></span> set_sides: <span class="hljs-number"><span class="hljs-number">3.</span></span> <span class="hljs-type"><span class="hljs-type">Triangle</span></span> sides printNl. =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br></td><td><pre> <code class="ruby hljs">Triangle.sides = <span class="hljs-number"><span class="hljs-number">3</span></span> puts Triangle.sides =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br></td></tr></tbody></table><br>  No surprises;  By calling the class method set_slides ( <code>slides=</code> in Ruby), I can update the value.  But since Triangle and Polygon share a class variable, this also changes the Polygon class: <br><table><tbody><tr><td><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Polygon</span></span> sides printNl. =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br></td><td><pre> <code class="ruby hljs">puts Polygon.sides =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br></td></tr></tbody></table><br>  Languages ‚Äã‚Äãdiffer in one: Smalltalk allows you to create separate class variables for each subclass, if you want.  If you continue to declare a class and its access method in the parent class and its successor, they will become separate variables.  At least in GNU Smalltalk, which I use: <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Object</span></span> subclass: <span class="hljs-type"><span class="hljs-type">Polygon</span></span> [ <span class="hljs-type"><span class="hljs-type">Sides</span></span> := <span class="hljs-number"><span class="hljs-number">10.</span></span> ] <span class="hljs-type"><span class="hljs-type">Polygon</span></span> class extend [ sides [ ^<span class="hljs-type"><span class="hljs-type">Sides</span></span> ] ] <span class="hljs-type"><span class="hljs-type">Polygon</span></span> subclass: <span class="hljs-type"><span class="hljs-type">Triangle</span></span> [ <span class="hljs-type"><span class="hljs-type">Sides</span></span> := <span class="hljs-number"><span class="hljs-number">3.</span></span> ] <span class="hljs-type"><span class="hljs-type">Triangle</span></span> class extend [ sides [ ^<span class="hljs-type"><span class="hljs-type">Sides</span></span> ] ] <span class="hljs-type"><span class="hljs-type">Polygon</span></span> sides printNl. &gt;= <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-type"><span class="hljs-type">Triangle</span></span> sides printNl. &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br>  This is not so in Ruby.  As we saw above, <code>@@sides</code> always refers to the same value. <br><br><h4>  Class instance variables </h4><br>  In Ruby, if you want to have separate values ‚Äã‚Äãfor each class, then you must use class instance variables instead of class variables.  What does it mean?  Let's take a look at another example of John Nunmeker: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> = 8 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">puts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> =&gt; 8</span></span></code> </pre><br>  Now, when I use <code>@sides</code> instead of <code>@@sides</code> , Ruby creates a class instance variable instead of a class variable: <br><img src="https://habrastorage.org/getpro/habr/post_images/43c/7df/169/43c7df16950af3ee0db55e091901a383.jpg"><br>  Conceptually, there is no difference, until I create a subclass of Triangle again: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Triangle</span></span></span><span class="hljs-class"> &lt; Polygon @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> = 3 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  The class now owns its own copy of the <code>@sides</code> value: <br><img src="http://habrastorage.org/storage2/e0b/543/ac8/e0b543ac82a95a5239bbafcc09393f6a.jpg"><br>  Now let's try the same in Smalltalk.  In Smalltalk, to declare an instance variable, you call the instanceVariableNames method in a class: <br><table><tbody><tr><td><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Object</span></span> subclass: <span class="hljs-type"><span class="hljs-type">Polygon</span></span> [ ] <span class="hljs-type"><span class="hljs-type">Polygon</span></span> instanceVariableNames: <span class="hljs-string"><span class="hljs-string">'Sides '</span></span>! <span class="hljs-type"><span class="hljs-type">Polygon</span></span> extend [ sides [ ^<span class="hljs-type"><span class="hljs-type">Sides</span></span> ] ]</code> </pre><br></td><td><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br></td></tr></tbody></table><br>  In this example, I created a new <code>Polygon</code> class, a subclass of the <code>Object</code> class.  Then, I send an <code>instanceVariableNames</code> message to this new class, telling Smalltalk to create a new instance variable called <code>Sides</code> .  Finally, I reopen the <code>Polygon</code> class and add the <code>sides</code> method to it.  Nearby I wrote the corresponding code on Ruby. <br><br>  Thus, <code>Sides</code> and <code>@sides</code> are instance variables of the Polygon class.  To create a class variable in Smalltalk, you need to send a class message to Polygon before calling <code>instanceVariableNames</code> or <code>extend</code> , as shown below: <br><table><tbody><tr><td><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Object</span></span> subclass: <span class="hljs-type"><span class="hljs-type">Polygon</span></span> [ ] <span class="hljs-type"><span class="hljs-type">Polygon</span></span> class instanceVariableNames: <span class="hljs-string"><span class="hljs-string">'Sides '</span></span>! <span class="hljs-type"><span class="hljs-type">Polygon</span></span> class extend [ sides [ ^<span class="hljs-type"><span class="hljs-type">Sides</span></span> ] ]</code> </pre><br></td><td><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sides</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br></td></tr></tbody></table><br>  Notice again the two different code snippets (Ruby and Smalltalk) that the same commands execute in two different ways.  In Smalltalk, you write <code>Polygon class extend [ sides</code> ..., while Ruby: <code>class Polygon; def self.sides</code>  <code>class Polygon; def self.sides</code> .  Ruby seems to me a shorter form of Smalltalk. <br><br><h4>  Metaclasses in Smalltalk and Ruby </h4><br>  Let's take another look at the lines of code that I used to create class instance variables in Smalltalk: <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Polygon</span></span> instanceVariableNames: <span class="hljs-string"><span class="hljs-string">'Sides '</span></span>!</code> </pre><br>  Translated from programming language into Russian, it means: <br>  ‚Ä¢ Take the <code>Polygon</code> class <br>  ‚Ä¢ Helm him a message called instanceVariableNames <br>  ‚Ä¢ and pass the string <code>Sides</code> , as a parameter. <br><img src="http://habrastorage.org/storage2/4dd/438/784/4dd4387848312b3c70c7e1ac3ea11418.jpg"><br>  This is an example of how to create instance variables in Smalltalk.  I will create instances of the <code>Polygon</code> class, and they will all have an instance variable of the <code>Sides</code> class.  In other words, to create a class instance variable for each polygon instance created, I call a method on the <code>Polygon</code> class. <br>  As I explained above, to create a class instance variable in Smalltalk, you must use the 'class' keyword.  For example: <br><pre> <code class="smalltalk hljs"><span class="hljs-type"><span class="hljs-type">Polygon</span></span> class instanceVariableNames: <span class="hljs-string"><span class="hljs-string">'Sides '</span></span>!</code> </pre><br>  This code literally means the following: calling the <code>instanceVariableNames</code> method on the class 'Polygon' class.  In a similar way, all instances of the <code>Polygon</code> class will contain an instance variable of the class.  But what does it mean: 'class class Polygon' in Smalltalk?  After spending a few moments in the GNU Smalltalk REPL, we find: <br><pre> <code class="smalltalk hljs"><span class="hljs-string"><span class="hljs-string">$ </span></span>gst <span class="hljs-type"><span class="hljs-type">GNU</span></span> <span class="hljs-type"><span class="hljs-type">Smalltalk</span></span> ready st&gt; <span class="hljs-type"><span class="hljs-type">Polygon</span></span> printNl. =&gt; <span class="hljs-type"><span class="hljs-type">Polygon</span></span> st&gt; <span class="hljs-type"><span class="hljs-type">Polygon</span></span> class printNl. =&gt; <span class="hljs-type"><span class="hljs-type">Polygon</span></span> class</code> </pre><br>  In the example, first, I display an object of the <code>Polygon</code> class.  Then, I try to find out what the class of the Polygon class is.  And this is the 'Polygon class'.  But what kind of object is this?  Let's call the class on it: <br><pre> <code class="smalltalk hljs">st&gt; <span class="hljs-type"><span class="hljs-type">Polygon</span></span> class class printNl. =&gt; <span class="hljs-type"><span class="hljs-type">Metaclass</span></span></code> </pre><br>  Ah ... that's it.  Class class is a metaclass.  Above, when I called <code>instanceVariableNames</code> to create a class instance variable, I actually used the <code>Polygon</code> metaclass, an instance of the <code>Metaclass</code> class. <br><br>  The diagram below shows how all these classes relate to Smalltalk: <br><img src="http://habrastorage.org/storage2/d9f/9aa/847/d9f9aa8471c84e9c5383a348076bf735.jpg"><br>  Now, it should not come as a surprise that Ruby uses the same model.  Here‚Äôs how classes are organized inside Ruby: <br><img src="http://habrastorage.org/storage2/2c5/182/8a9/2c51828a96a5a1c6958a7649c291f35a.jpg"><br>  In Ruby, whenever you create a class, Ruby creates an appropriate metaclass inside.  Unlike Smalltalk, Ruby does not use this for class instance variables, but only for tracking class methods.  Also, Ruby does not have a <code>Metaclass</code> class, but instead of all metaclasses, it creates instances of the <code>Class</code> class. <br><br>  In Ruby, the metaclass is hidden, being a 'mysterious concept'.  Ruby silently creates it, without telling you about it, and does not use it directly.  In Smalltalk, however, metaclasses are hidden and play a huge role in the language.  Creating a class instance variable, as shown above, is just one example of using metaclasses in Smalltalk.  Another good example is how you add class methods by invoking <code>extend</code> . <br><br>  When you request a class class in Ruby, you just get a Class.  Ruby tells you nothing about metaclasses: <br><pre> <code class="ruby hljs">$ irb &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> &gt; Polygon.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Class</code> </pre><br>  To see Ruby's metaclass, try the following trick: <br><pre> <code class="ruby hljs">$ irb &gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class"> &gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">metaclass</span></span></span><span class="hljs-class"> &gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> &lt;&lt; self &gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class"> &gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> &gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> &gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nil</span></span></span><span class="hljs-class"> &gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Polygon</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">metaclass</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#&lt;Class:Polygon&gt;</span></span></span></span></code> </pre><br>  ‚Äú# &lt;Class: Polygon&gt;‚Äù is the metaclass of the Polygon class.  This syntax means a ‚ÄúClass instance for the Polygon class‚Äù or a metaclass for the Polygon. </div><p>Source: <a href="https://habr.com/ru/post/167457/">https://habr.com/ru/post/167457/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167445/index.html">Saturday morning reluctant to sleep</a></li>
<li><a href="../167449/index.html">Say a good word about high salary</a></li>
<li><a href="../167451/index.html">Top 5 annoying moments in the work of the programmer</a></li>
<li><a href="../167453/index.html">Google allocates millions of dollars to new Chrome hacking contest</a></li>
<li><a href="../167455/index.html">Unbound Jailbreak for iOS 6.1 coming out on Sunday</a></li>
<li><a href="../167459/index.html">Raspberry Pi: measure humidity and temperature with DHT11 / DHT22</a></li>
<li><a href="../167461/index.html">Report on the seventh Kiev habrebe</a></li>
<li><a href="../167465/index.html">Review of Assistant AE-601 reader</a></li>
<li><a href="../167467/index.html">Zopo launches Sailfish OS smartphone for the Indian market</a></li>
<li><a href="../167469/index.html">SXB: MySQL incremental backup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>