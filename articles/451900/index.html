<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The first contribution to the browser API from Facebook</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Our position as the owners of a popular website ‚Äî and our work in supporting the popular React platform ‚Äî gives us unique capabilities and insights in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The first contribution to the browser API from Facebook</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/ot/me/yt/otmeytc2idaafvqyj9c3dcekdw4.jpeg" alt="cover"></p><br><p>  Our position as the owners of a popular website ‚Äî and our work in supporting the popular React platform ‚Äî gives us unique capabilities and insights into working with the browser that we want to use to solve the ‚Äúqueuing‚Äù problem.  As an active member of the Web Standards Community (W3C), we participated in the discussion of many innovations, including <a href="https://developers.google.com/web/updates/2017/02/navigation-preload">service workers</a> and <a href="https://drafts.csswg.org/static/css-overscroll-behavior-1/">CSS-overscroll</a> , but until recently we never created our own initiatives to improve the web browser.  In order to achieve a significant increase in productivity, a new API was proposed, which, as a result of close cooperation with our colleagues from Google Chrome, was provided for a <a href="https://github.com/GoogleChrome/OriginTrials">trial version</a> .  <strong>Chrome v74</strong> will include the <a href="https://github.com/WICG/is-input-pending">isInputPending API</a> , and can be used to improve both the overall JavaScript runtime and the response time to events.  This is just the first step to better scheduling javascript on the web.  We hope to get feedback from developers and use them to create the final version of the API. </p><a name="habracut"></a><br><p>  One of the most important performance indicators in the modern web is the time it takes to respond to a user event (pressing a button or entering a field), with its full visualization.  On Facebook, we divide and measure events in four steps: </p><br><ul><li>  operating system receives data </li><li>  actual start of processing </li><li>  start displaying changes on screen in response to an event </li><li>  processing is complete and the result is visualized </li></ul><br><p>  When we evaluated our most productive products, it was noticed that the waiting time in the queue gives the greatest delays.  The queue refers to the time between when the user interacts with the page (for example, click or tap), and when the actual event handling begins.  In some cases, this delay can be quite substantial.  Imagine that you click on the notification icon, and then wait a minute for the button to respond.  Probably no one will wait for an answer. </p><br><h2 id="bystraya-zagruzka-ili-bystroe-reagirovanie-vyberite-odin">  Fast download or fast response: select one </h2><br><p>  There is a difficult trade-off between fast page loading and interactivity.  If a website requires javascript, one option is to run it all in one block.  But it can create problems.  JavaScript engines within web browsers are usually single-threaded, that is, they can perform only one operation on a page at a time.  In the case of a page loading, this means that if a user clicks on something, the browser must put a click event in the queue until the entire block of JavaScript is launched. </p><br><p>  Like many other sites, we solve this problem by breaking the javascript into small blocks.  While the page loads, we run a little javascript and then return control to the browser.  The browser can then check its queue for input events and see if there is anything to handle.  The browser can then return to executing JavaScript blocks as they are added.  It helps, but can cause other problems.  Each time we return control to the browser, it takes some time to check its turn in input events, process the events, and select the next block of JavaScript.  Thus, even though the browser responds to events faster, we still need to find a balance between the size of the code blocks and the frequency with which we are inferior to the browser.  If we change control too often, the page loads too slowly, if on the contrary - less often, the browser takes more time to respond to user events, and people get frustrated. </p><br><p><img src="https://habrastorage.org/webt/ta/sw/ue/taswuexpvwj5q5lpns2qmoyi0ue.jpeg" alt="loadfast"></p><br><blockquote>  If we run large blocks of JavaScript, the browser can send custom events with a long delay (at the top);  if we run smaller blocks, the page loads longer (bottom). </blockquote><br><h2 id="isinputpending-reshenie">  isInputPending solution </h2><br><p>  When we first discovered delays in the queue, we turned to our colleagues in Chrome.  We wanted to see how everything will look if we come up with a new approach to downloading that will eliminate this dilemma of compromise.  After talking with them, we suggested isInputPending.  <em>The isInputPending API</em> is the first to use the interrupt concept for user events on the web. </p><br><p>  Under the hood, <em>isInputPending</em> listens to the Chrome input queue on the compiler side to intercept events before they are added to the main thread.  Since this listen is performed outside the main thread, <em>isInputPending</em> calls <em>do</em> not use a lot of computational resources and should be very fast.  This allows developers to invoke APIs frequently and maximize responsiveness. </p><br><p>  As soon as we prepared this proposal, we turned to the W3C working group on web productivity and got the consent of various browser vendors that our idea is worth exploring.  Later, we collaborated with our colleagues in Chrome, independently implemented a new API and sent the appropriate code fixes to Chrome.  Thanks to Chrome engineers, we received trial patches that allow you to test changes and get feedback from developers before a full release.  This version will allow us to understand how important this API is for developers and will determine our future conversations about this API with web browser vendors.  This is the first time we have gone through all the steps of developing a web API, from discussing a proposal on a forum to sending code to a web browser. </p><br><h2 id="kak-rabotaet-isinputpending">  How isInputPending works </h2><br><p>  <em>As the</em> name suggests, <em>isInputPending</em> tells you if there are any events waiting to be entered.  Developers can use this information while JavaScript is running to decide if they want to return control to the browser.  When properly used, <em>isInputPending</em> can completely eliminate the dilemma of fast loading and interactivity. </p><br><p> To work with API, <code>navigator.scheduling.isInputPending()</code> .  In fact, if the browser expects the event to be sent, this method returns <code>true</code> .  When called without any arguments, all supported event types are checked.  In addition, it is possible to manually specify a list of event types: mouse, wheel, touch, which should be checked for pending input. </p><br><h3 id="primer-proverka-lyubyh-tipov-sobytiy">  Example: checking any types of events </h3><br><pre> <code class="plaintext hljs">while (workQueue.length &gt; 0) { if (navigator.scheduling.isInputPending()) { //       break; } let job = workQueue.shift(); job.execute(); }</code> </pre> <br><h3 id="primer-proverka-na-konkretnye-vhodnye-sobytiya">  Example: checking for specific input events </h3><br><pre> <code class="plaintext hljs">while (workQueue.length &gt; 0) { if (navigator.scheduling.isInputPending(['mousedown', 'mouseup', 'keydown', 'keyup'])) { //       'mousedown'  'mouseup'  'keydown'  'keyup' break; } let job = workQueue.shift(); job.execute(); }</code> </pre> <br><h2 id="chto-dalshe">  What's next? </h2><br><p>  If the community review is positive, <em>isInputPending</em> can become fully available in Chrome.  Then we can get rid of these noticeable delays in the queue and make work on the Internet faster and more flexible for people on our sites.  For developers who also want to get rid of delays in queues and improve interaction and download performance, a trial version will be available soon.  Sign up <a href="https://developers.chrome.com/origintrials/">here</a> and share your opinion on the trial version as soon as it is available. </p><br><p>  The transfer process <em>isInputPending</em> to Chrome is a new method for developing web standards on Facebook.  We hope to continue developing new APIs and increase our contribution to open source web browsers.  In the future, we could potentially embed this API directly into React so that developers can take advantage of the API out of the box.  In addition, <em>isInputPending is</em> now part of the great work of creating primitives for scheduling on the web.  We look forward to continuing our collaboration with Chrome.  In the end, we hope to see browser tools that allow developers to integrate more deeply into the browser‚Äôs task queue and even allow developers to understand browser priorities for various network requests and tasks. </p><br><h2 id="primechanie-avtora">  Author's note </h2><br><p>  To try the new API you need: </p><br><ul><li>  install the Google Chrome browser 74-76 version </li><li>  enable flag <a href="http://chrome//flags/">Experimental Web Platform features</a> </li></ul><br><div class="spoiler">  <b class="spoiler_title">Chrome v74</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/66/bb/yq/66bbyqirlqgfzupbobwovk_ozv4.png" alt="v74"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Chrome v76 (develop)</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/u9/1j/du/u91jdu5dbgtrt6gsrj2d-5mrbze.png" alt="v76"></p></div></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/451900/">https://habr.com/ru/post/451900/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451890/index.html">Delegating the reverse zone subnet less than / 24 in BIND. How it works</a></li>
<li><a href="../451894/index.html">A brief and vigorous overview of the architecture of compilers</a></li>
<li><a href="../451896/index.html">The ‚Äúunbreakable‚Äù eyeDisk is protected by an iris scan, but transmits the password in clear text</a></li>
<li><a href="../451898/index.html">Innovations in Russian</a></li>
<li><a href="../4519/index.html">"Fat" investment hinders a good startup</a></li>
<li><a href="../451902/index.html">Microsoft Azure Developer Camp Russia</a></li>
<li><a href="../451904/index.html">Sometimes more is less. When reducing the load increases the delay</a></li>
<li><a href="../451906/index.html">Exchange Vulnerability: How to Detect Privilege Elevation by Domain Administrator</a></li>
<li><a href="../451908/index.html">The history of computers: night at the Yandex Museum</a></li>
<li><a href="../451912/index.html">MuseNet Deep Neural Network Writes Music</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>