<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Network game on bash: chess</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have long wanted to write some kind of online game on bash, and it is desirable that the control be convenient, from the keyboard, with the usual cu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Network game on bash: chess</h1><div class="post__text post__text-html js-mediator-article">  I have long wanted to write some kind of online game on bash, and it is desirable that the control be convenient, from the keyboard, with the usual cursor keys.  In general, the interaction topic in bash is deeper than ‚Äúenter a number, press‚Äû Enter ‚Äú‚Äù is not excavated.  I had to invent and explore everything myself.  I tried very hard to find something similar in the level of interactivity, but I did not find it. <br><br>  Since the subtleties of control with the keyboard ate a lot of my time, I did not bother with the subtleties of compatibility, so the game was tested only under Mac OS X, there is a non-zero probability that it will work under Linux and certainly it can be finished there to working condition. <br><br>  To work, the game requires nc (aka <a href="http://ru.wikipedia.org/wiki/Netcat">Netcat</a> ) and a terminal with support for 256 colors (for Mac OS, I recommend <a href="http://www.iterm2.com/">iTerm2</a> ).  If there is interest in the game, I finish the terminal with 16 colors and / dev / tcp.  By the way, he began to lay out all his go-crafts on the <a href="https://github.com/bolknote/shellgames">GitHub</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a13/fe6/621/a13fe6621496822a2eb6620e24ad794c.png" alt="Network Chess on Bash" width="590" height="181"></div><br><br>  Since the game is networked, it needs to specify two parameters, which it will tell about if it is launched without them.  The first is the address of the enemy machine, the second is the port.  The port is chosen the same on both machines.  The game can be run on one machine, in two consoles (in the screenshot just such a case). <br><br>  It is easy to play - only one board is active at a time (the right one in the screenshot, it has brighter letters and numbers around the board), on the active board the cursor moves the cursor keys - ‚Üê, ‚Üí, ‚Üë and ‚Üì, take a piece and put it on the board - on the space bar or Enter.  As soon as you put the piece on the board, the move goes to the opponent.  "Eat" the opponent's shape is easy - just put your piece on someone else's.  The game has a defense - you can not "eat" your figure. <br><br>  There is nothing besides this in the game - the correctness of the control of moves is not performed, there is no check for the completion of the game, you can even walk the opponent's pieces.  It was very difficult to figure out how to handle clicks in the shell, so I just didn‚Äôt have time to do the rest, it didn‚Äôt fit in the ‚Äútoy in the evening‚Äù format. <br><br>  I tried to provide my code with comments and write quite structured to be able to figure out how everything works independently. <br><br><a name="habracut"></a><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # Network chess by Evgeny Stepanischev http://bolknote.ru 2011 if [ $# -ne 2 ]; then echo Usage: $0 host-of-opponent port exit fi #   HOST="$1" #   PORT="$2" #     SEQLEN=(1b5b4. [2-7]. [cd]... [89ab].{5} f.{7}) #  WHITE=(‚ôô ‚ôô ‚ôô ‚ôô ‚ôô ‚ôô ‚ôô ‚ôô ‚ôñ ‚ôò ‚ôó ‚ôï ‚ôî ‚ôó ‚ôò ‚ôñ) BLACK=(‚ôú ‚ôû ‚ôù ‚ôõ ‚ôö ‚ôù ‚ôû ‚ôú ‚ôü ‚ôü ‚ôü ‚ôü ‚ôü ‚ôü ‚ôü ‚ôü) #  ? OURMOVE= #    ? MYCOLOR= #  declare -a XY #  CX=1 CY=7 TAKEN= #     KUP=1b5b41 KDOWN=1b5b42 KLEFT=1b5b44 KRIGHT=1b5b43 KSPACE=20 #   function Restore { echo -ne "\033[5B\033[5B\033[?25h\033[m" stty "$ORIG" 2&gt;/dev/null (bind '"\r":accept-line' 2&gt;/dev/null) } trap Restore EXIT #  Enter (bind -r '\r' 2&gt;/dev/null) #    ORIG=`stty -g` stty -echo #   echo -e "\033[?25l" #      function ToNet { echo $1 | nc "$HOST" "$PORT" } #     function React { case $1 in $KLEFT) if [ $CX -gt 1 ]; then CX=$(($CX-1)) PrintBoard fi ;; $KRIGHT) if [ $CX -lt 8 ]; then CX=$(($CX+1)) PrintBoard fi ;; $KUP) if [ $CY -gt 1 ]; then CY=$(($CY-1)) PrintBoard fi ;; $KDOWN) if [ $CY -lt 8 ]; then CY=$(($CY+1)) PrintBoard fi esac #      [ "$OURMOVE" ] &amp;&amp; ToNet $1 } #       function CheckCons { local i for i in ${SEQLEN[@]}; do if [[ $1 =~ ^$i ]]; then return 0 fi done return 1 } #    ,  React    , #  KSPACE ‚Äî     function PressEvents { local real code action #   ,    , #         #   while true; do #     read      # akw NR==1||NR==4    ‚Ññ1 (  real)  ‚Ññ4 ( ) eval $( (time -p read -r -s -n1 ch; printf 'code %d\n' "'$ch") 2&gt;&amp;1 | awk 'NR==1||NR==4 {print $1 "=" $2}' | tr '\r\n' ' ') # read    Enter  ,    20, #        UTF8 if [ "$code" = 0 ]; then code=20 else [ $code -lt 0 ] &amp;&amp; code=$((256+$code)) code=$(printf '%02x' $code) fi if [ $code = $KSPACE ]; then [ "$OURMOVE" ] &amp;&amp; ToNet $KSPACE SpaceEvent &amp;&amp; return continue fi #     (   ) if [ $real = 0.00 ]; then seq="$seq$code" if CheckCons $seq; then React $seq seq= fi #     (      ), #   ,    else [ "$seq" ] &amp;&amp; React $seq seq=$code #       if CheckCons $seq; then React $seq seq= fi fi done } #      function CheckColor { echo -n ${1:0:1} } #    function FillBoard { local xy ch for y in {1..8}; do for x in {1..8}; do ch='S ' if [ $y -le 2 ]; then ch=B${BLACK[$x+8*$y-9]} else if [ $y -ge 7 ]; then ch=W${WHITE[$x+8*$y-57]} fi fi XY[$x+100*$y]=$ch done done } #      function PrintBoardLetters { local letters=abcdefgh [ -z "$OURMOVE" ] &amp;&amp; echo -ne "\033[30m" || echo -ne "\033[0m" echo -n ' ' for x in {0..7}; do echo -n "${letters:$x:1} " done echo } #      function PrintBoardDigit { [ -z "$OURMOVE" ] &amp;&amp; echo -ne "\033[30m" echo -en " $((9-$1))\033[0m " } #   function PrintBoard { local xyc ch local colors=('48;5;209;37;1' '48;5;94;37;1') PrintBoardLetters for y in {1..8}; do PrintBoardDigit $y for x in {1..8}; do c=${colors[($x+$y) &amp; 1]} ch=${XY[$x+100*$y]} if [[ $CX == $x &amp;&amp; $CY == $y ]]; then c="$c;7" [ "$TAKEN" ] &amp;&amp; ch=$TAKEN [ $MYCOLOR == B ] &amp;&amp; c="$c;38;5;16" fi [[ $(CheckColor "$ch") == "B" ]] &amp;&amp; c="$c;38;5;16" echo -en "\033[${c}m${ch:1:1} \033[m" done PrintBoardDigit $y echo done PrintBoardLetters echo -e "\033[11A" } #   function NetListen { nc -l $PORT } #     function NetEvents { local code while true; do code=$(NetListen) [[ "$code" == "$KSPACE" ]] &amp;&amp; SpaceEvent &amp;&amp; return React $code done } #    Space  Enter ‚Äî     function SpaceEvent { local xy # ,      let xy="$CX+$CY*100" #   if [ "${XY[$xy]:-S }" = "S " ]; then if [ -z "$TAKEN" ]; then echo -en "\007" else #   XY[$xy]=$TAKEN TAKEN= return 0 fi #   else #     ¬´¬ª   if [[ $(CheckColor "$TAKEN") == $(CheckColor "${XY[$xy]}") ]]; then echo -en "\007" else #   ¬´ ¬ª,  ¬´¬ª  if [ "$TAKEN" ]; then XY[$xy]=$TAKEN TAKEN= return 0 else # ¬´ ¬ª   ,    TAKEN=${XY[$xy]} XY[$xy]="S " fi fi fi return 1 } #    function ClearKeyboardBuffer { #  ‚Äî  zsh which zsh &amp;&gt;/dev/null &amp;&amp; zsh -c 'while {} {read -rstk1 || break}' &amp;&amp; return #  ‚Äî  bash local delta while true; do delta=`(time -p read -rs -n1 -t1) 2&gt;&amp;1 | awk 'NR==1{print $2}'` [[ "$delta" == "0.00" ]] || break done } FillBoard #     ToNet HI [[ "$(NetListen)" == "HI" ]] &amp;&amp; OURMOVE=1 sleep 0.2 ToNet ULOOSE [ "$OURMOVE" ] &amp;&amp; MYCOLOR=W || MYCOLOR=B PrintBoard #   ‚Äî        while true; do if [ -n "$OURMOVE" ]; then ClearKeyboardBuffer PressEvents OURMOVE= else NetEvents OURMOVE=1 fi PrintBoard done</span></span></code> </pre> <br><br>  I recorded a small video to show how it looks, unfortunately, all recordings put a heavy strain on my computer and the game begins to slow down, but you can get a general idea. <br><br><video>  http://video.yandex.ru/users/bolknote/view/10/ </video></div><p>Source: <a href="https://habr.com/ru/post/128549/">https://habr.com/ru/post/128549/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128541/index.html">Image enhancement based on Matlab frequency filtering</a></li>
<li><a href="../128543/index.html">Asynchronous unit testing for C ++</a></li>
<li><a href="../128545/index.html">Graduate and Postgraduate Studies in Japan</a></li>
<li><a href="../128546/index.html">ProfitConf - conference of web developers in Novosibirsk on September 25-26</a></li>
<li><a href="../128548/index.html">A dream to get to the states - how it came true ...</a></li>
<li><a href="../128551/index.html">Yahoo has received several offers to sell its assets.</a></li>
<li><a href="../128552/index.html">Loading a page using Ajax as VKontakte</a></li>
<li><a href="../128553/index.html">HP and Universal launched their own music service in Russia</a></li>
<li><a href="../128555/index.html">Analysis of the malware for Android on the example of Trojan-Spy.AndroidOS.Zbot.a / Android.Smssniffer / Android / SpySMS / AndroidOS_SMSREP.B</a></li>
<li><a href="../128556/index.html">The secret of object-oriented development in Rails</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>