<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Stream in NodeJS - rivers that you enter twice</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A stream is a concept that was first implemented on UNIX systems for transferring data from one program to another in I / O operations. This allows ea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Stream in NodeJS - rivers that you enter twice</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/59/de/7b/59de7b878a4a2295330937.jpeg" alt="image"><br><br>  A stream is a concept that was first implemented on UNIX systems for transferring data from one program to another in I / O operations.  This allows each program to be very specialized in what it does ‚Äî to be an independent module.  The combination of such simple programs helps to create more complex systems by "combining" them into a chain of calls. <br><br>  Streams allow you to exchange data in small parts, which in turn makes it possible in your work not to spend a lot of memory.  Of course, this depends on how you implement the internal flow functionality. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A common task is parsing a large file.  For example, in a text file with these logs, you need to find a line containing certain text.  Instead of loading the file completely into memory, and then begin to sort the lines in it looking for the right one, we can read it in small portions.  Thus, we do not occupy the memory beyond the necessary, but only as much memory as is necessary for buffering the read data.  As soon as we find the required entry, immediately stop further work.  Or we can transfer the found record to another stream along the chain, for example, to convert to another format, or save to another file. <br><br>  The stream module provides a basic streaming API in Node.JS.  Documentation of Node.JS is quite enough to sort out this issue, but we will try to make up something like a cheat sheet with explanations of some points. <br><a name="habracut"></a><br><h2>  Types of threads </h2><br>  There are four types of threads: <br><br><ul><li>  Readable - a stream that provides data for reading; </li><li>  Writable - a stream in which data can be written; </li><li>  Duplex - a stream from which you can both read data (Readable) and write to it (Writable), while the process of reading and writing proceeds independently of each other; </li><li>  Transform is a type of Duplex stream that can change data when it is written and read to / from a stream (most commonly used as an intermediate in the data transfer chain). </li></ul><br><h2>  Stream instanceof EventEmitter </h2><br>  All streams are EventEmitter instances, that is, you can generate StreamClass.emit ('eventName', data) events and process them StreamClass.on ('eventName', (data) =&gt; {}); <br><br><h2>  Pipe method </h2><br>  To transfer data from one stream to another, the easiest way to call the pipe method over threads is: <br><br><pre><code class="javascript hljs">Readable.pipe(Writable);<span class="hljs-comment"><span class="hljs-comment">//,  "" DataBase -&gt; File Readable.pipe(Transform).pipe(Writable);//DataBase -&gt;   JSON  -&gt;  JSON  File Duplex.pipe(Transform).pipe(Duplex);//  DataBase -&gt;  -&gt;    DataBase </span></span></code> </pre> <br>  The last chain of calls shows that it is better to implement your thread classes in such a way that each of them performs its own task. <br><br>  As you can see, the pipe method returns an instance of the stream that was passed to it, which allows the threads to be combined with each other. <br><br>  The pipe method is implemented in such a way that it solves the problem of controlling the ‚Äúspeed‚Äù of data transfer from one stream to another (exceeding the volume of the internal stream buffer).  For example, the Writable stream works on writing slower than the Readable data source sends them.  In this case, the data transfer is ‚Äúsuspended‚Äù until Writable ‚Äúinforms‚Äù (the internal buffer is cleared) that it is ready to receive the next piece of data. <br><br><h2>  Buffering </h2><br>  Streams store data in their internal buffer.  The buffer size can be specified using the <b>highWaterMark</b> parameter, which can be specified in the class constructor. <br><br>  The physical meaning of the value of highWaterMark depends on another option - <b>objectMode</b> . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamObject({<span class="hljs-attr"><span class="hljs-attr">objectMode</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">highWaterMark</span></span>: __}); <span class="hljs-comment"><span class="hljs-comment">//  16384 (16kb) new StreamObject({objectMode: true, highWaterMark: __});//  16</span></span></code> </pre><br>  In the Readable stream, data is buffered when the push (data) method is invoked on it, and remains in the buffer until it is read by calling the read () method.  As soon as the total size of the internal buffer of the Readable stream reaches the threshold specified in highWaterMark, the stream will temporarily stop reading data. <br><br>  For Writable, buffering occurs when the write (data) method is called over it.  The method returns true until the buffer size reaches the highWaterMark value, and false when the buffer is full. <br>  When using the pipe () method, just at this moment it ‚Äústops‚Äù data reading, waits for the ‚Äúdrain‚Äù event, after which the data transfer is resumed. <br><br><h2>  Object mode </h2><br>  By default, streams work with data in the form of a buffer, but they can also work with strings as well as with other JavaScript objects (for example, {‚Äúuser‚Äù: {‚Äúname‚Äù: ‚ÄúIvan‚Äù, ‚Äúlast_name‚Äù: ‚ÄúPetrov‚Äù }}), except for the null object that plays a separate role in data transfer (if the stream receives null, it is a signal that there is no more data to process and reading or writing of data is completed).  How to set one or another stream mode during its initialization will be shown in the examples below. <br><br><h2>  State of flowing or paused stream Readable </h2><br><ul><li>  flowing - data flows continuously and as quickly as possible for a process that reads them; </li><li>  paused - the default mode for all types of streams, data is transmitted only if they are explicitly requested - an explicit call to the read () method (the read () method is implicitly called "inside" the pipe () method). </li></ul><br>  Flowing state === true - automatically if: <br><br><ul><li>  data is transferred to other flows through the pipe () method; </li><li>  and / or it has an event handler 'data'; </li><li>  and / or the resume () method is called above it. </li></ul><br>  From flowing to paused state, you can switch (flowing === false): <br><br><ul><li>  if we ‚Äúbreak‚Äù the connection between the data source and its consumer (Readable.pipe (Writable); Readable. <b>unpipe</b> (Writable)), and / or remove the 'data' event handler; </li><li>  or call the Readable.pause () method. </li></ul><br>  At the time of initialization of the class Readable flowing === null, that is, a data reading mechanism has not yet been implemented, and no data is generated. <br><br><h2>  Readable Streams - streams as a data source </h2><br><img src="https://habrastorage.org/webt/59/de/81/59de8197855e4553952185.jpeg" width="300" align="left"><br><br>  Readable flows work in one of two states: flowing and paused.  In the paused state, it is necessary to explicitly call the read () method to read data.  When you transfer data from one stream to another (R.pipe (W)), the read () method is called automatically. <br><br>  The entire current data buffer can be obtained using the Readable._readableState.buffer property. <br><br><br clear="all"><br clear="all"><div class="spoiler">  <b class="spoiler_title">Readable.js example</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { Readable } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'stream'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/** *     Readable ,    _read(). *       *    (_readableState)   ,      (on('end', ()=&gt;{})) */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Source</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Readable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(array_of_data = [], opt = {}) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(opt); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._array_of_data = array_of_data; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'objectMode '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._readableState.objectMode);<span class="hljs-comment"><span class="hljs-comment">//false  ,      console.log('highWaterMark ', this._readableState.highWaterMark);//16384 console.log('buffer ', this._readableState.buffer);//[] -   console.log('length ', this._readableState.length);//0 - -   console.log('flowing ', this._readableState.flowing);//null //  ,      this.on('data', (chunk)=&gt; { //   'data' -         console.log('\n---'); console.log('Readable on data '); // chunk     console.log(`chunk = ${chunk} chunk isBuffer ${Buffer.isBuffer(chunk)} and chunk.length is ${chunk.length}`); //-     (-  ) console.log('buffer.length ', this._readableState.buffer.length); console.log(': ', chunk.toString(), ' buffer of chunk ', this._readableState.buffer, ' buffer of chunk   ', this._readableState.buffer.toString()); }) .on('error',(err)=&gt; { console.log('Readable on error ', err); }) .on('end',()=&gt; { console.log('Readable on end '); console.log('objectMode ', this._readableState.objectMode);//false console.log('highWaterMark ', this._readableState.highWaterMark);//16384 console.log('buffer ', this._readableState.buffer);//[] -   console.log('buffer.length ', this._readableState.buffer.length);//0 console.log('flowing ', this._readableState.flowing);//true !!!       'data' }) .on('close',()=&gt; { console.log('Readable on close      '); }); } _read() { let data = this._array_of_data.shift() if (!data) { //,    this.push(null); } else { this.push(data); } } } /*   , ..       ,   .         this.push(data) Readable on error TypeError: Invalid non-string/buffer chunk */ let array_of_data = ['1', '2', '3', '4', '5']; let opts = {/*     */}; const R = new Source(array_of_data, opts); array_of_data = ['1', '2', '3', '4', '5']; opts = { objectMode: false, highWaterMark: 1//1      _readableState.buffer.length  === 1 }; const R2 = new Source(array_of_data, opts); array_of_data = ['1', '2', '3', '4', '5']; opts = { objectMode: false , encoding: 'utf8'//   ( NodeJS),         ,      }; const R3 = new Source(array_of_data, opts);//        .setEncoding('utf8') array_of_data = [1, 2, 3, 4, 5]; /*  ""   .  objectMode: true      -   ,    Readable.setEncoding('utf8')*/ opts = { objectMode: true , encoding: 'utf8' }; const R4 = new Source(array_of_data, opts); // objectMode: true    ,    (Number) array_of_data = [1, 2, 3, 4, 5]; opts = { objectMode: true }; const R5 = new Source(array_of_data, opts); //highWaterMark 16 -      /*     (    Writable.write(someData) === false).      Node.JS.  ,      ,    ,    */ array_of_data = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]; opts = { objectMode: true }; const R6 = new Source(array_of_data, opts); R6.on('data', (chunk) =&gt; { //    1  R6.pause(); setTimeout(() =&gt; { R6.resume();//   }, 1000); });</span></span></code> </pre><br></div></div><br><br><h2>  Writable Streams - streams for writing data </h2><br><img src="https://habrastorage.org/webt/59/de/84/59de845953db2914960874.jpeg" width="300" align="left"><br><br>  The entire current data buffer can be obtained using the writable._writableState.getBuffer () method. <br><br clear="all"><br clear="all"><div class="spoiler">  <b class="spoiler_title">Example writable.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Source = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./readable.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { Writable } = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'stream'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Writer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Writable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(opt = {}) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(opt); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'objectMode '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._writableState.objectMode);<span class="hljs-comment"><span class="hljs-comment">//false  ,     true console.log('highWaterMark ', this._writableState.highWaterMark);//16384 console.log('decodeStrings ', this._writableState.decodeStrings);//true  ;    Buffer ,      _write() console.log('buffer ', this._writableState.getBuffer());//[] -   this.on('drain', ()=&gt; { console.log('\n------ writable on drain'); }) .on('error', (err)=&gt; { console.log('\n------ writable on error', err); }) .on('finish', ()=&gt; { console.log('\n------ writable on finish'); console.log('_writableState.getBuffer()', this._writableState.getBuffer()); }); } /** * @param chunk - || * @param encoding -   .  objectMode === true,  encoding   * @param done - callback -.     ,     ,    *   _write,  ,       chunk,      *  : done(err) -     new Error(...) * @private */ _write(chunk, encoding, done) { console.log('_writableState.getBuffer()', this._writableState.getBuffer()); console.log(typeof chunk ); //    Transform   if (typeof chunk === 'object') { console.log('chunk = ', chunk.get(), chunk.get() +' in pow '+ chunk.get() +' = '+ chunk.inPow(chunk.get())); } else { console.log(`chunk = ${chunk}; isBuffer ${Buffer.isBuffer(chunk)}; chunk.length is ${chunk.length}; encoding = ${encoding}`); } /*     . , : 1)     on('error', (err)=&gt;{...}) 2)   ,    Readable    .         - ,  Readable.emit('error', err);     Readable.puse(),      Readable.remuse().    ,           //if (chunk &gt; 3) return done(new Error('chunk &gt; 3'));*/ done(); } } let array_of_data = ['1', '2', '3', '4', '5']; let r_opts = {/*    */}; const R = new Source(array_of_data, r_opts); let w_opts = {/*    */}; const W = new Writer(w_opts); R.pipe(W); array_of_data = ['1', '2', '3', '4', '5']; r_opts = {encoding: 'utf8'}; const R1 = new Source(array_of_data, r_opts); w_opts = { decodeStrings: false//  _write     'utf8',      -  (  r_opts), }; const W1 = new Writer(w_opts); R1.pipe(W1); array_of_data = [1, 2, 3, 4, 5]; r_opts = {objectMode: true}; const R2 = new Source(array_of_data, r_opts); w_opts = { objectMode: true// false,       ( r_opts),   "TypeError: Invalid non-string/buffer chunk" }; const W2 = new Writer(w_opts); R2.pipe(W2); array_of_data = [1, 2, 3, 4, 5]; r_opts = {objectMode: true}; const R3 = new Source(array_of_data, r_opts); w_opts = { objectMode: true// false,       ( r_opts),   "TypeError: Invalid non-string/buffer chunk" , highWaterMark: 1 // ;          'drain' }; const W3 = new Writer(w_opts); R3.pipe(W3); //  pipe() const R3_1 = new Source(array_of_data, r_opts); const W3_1 = new Writer(w_opts); R3_1.on('data', (chunk)=&gt; { //R3_1._readableState.flowing === true console.log('R3_1 in flowing mode', R3_1._readableState.flowing, 'R3_1 _readableState.buffer', R3_1._readableState.buffer); toWriteOrNotToWriteThatIsTheQuestion(chunk, onDrain); }); function onDrain() { //R3_1._readableState.flowing === false,      R3_1.pause()  toWriteOrNotToWriteThatIsTheQuestion console.log('R3_1 in flowing mode', R3_1._readableState.flowing); R3_1.resume(); } /** *           Writable,       Readable (R3_1.pause()) *     ( 'drain'),       Readable ( cb R3_1.resume(); ),    Writable * @param data * @param cb */ function toWriteOrNotToWriteThatIsTheQuestion(data, cb) { // " "     write(...),    _write(...) if (!W3_1.write(data)) { R3_1.pause(); W3_1.once('drain', cb); } else { process.nextTick(cb); } }</span></span></code> </pre><br></div></div><br><br><h2>  Transform Streams - data change streams </h2><br><img src="https://habrastorage.org/webt/59/de/86/59de8603f3c52433545967.jpeg" width="300" align="left"><br>  Transform is a variation of Duplex streams.  We decided to first set an example with him. <br><br><br clear="all"><br clear="all"><div class="spoiler">  <b class="spoiler_title">Transform.js example</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Readable = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./readable.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Writable = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./writable.js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {Transform} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'stream'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*  ,      , ,  JS ,    */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Chunk</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(chunk) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.set(chunk); } set(chunk) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._chunk = chunk; } get() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._chunk; } inPow(pow = <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.pow(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.get(), pow); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transformer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transform</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(opt = {}) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(opt); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'\n -------- Transform in constructor'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'objectMode '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._writableState.objectMode);<span class="hljs-comment"><span class="hljs-comment">//false  ,     true console.log('highWaterMark ', this._writableState.highWaterMark);//16384 console.log('decodeStrings ', this._writableState.decodeStrings);//true  ;    Buffer ,      _write() console.log('buffer ', this._writableState.getBuffer());//[] -   this.on('close', ()=&gt; { console.log('\n------ Transform on close'); }) .on('drain', ()=&gt; { console.log('\n------ Transform on drain'); }) .on('error', (err)=&gt; { console.log('\n------ Transform on error', err); }) .on('finish', ()=&gt; { console.log('\n------ Transform on finish'); }) .on('end', ()=&gt; { console.log('\n------ Transform on end'); }) .on('pipe', ()=&gt; { console.log('\n------ Transform on pipe'); }); } /** * ,      (chunk    Transform), *    -      Transform * @param chunk * @param encoding * @param done -    done(err, chunk) * @private */ _transform(chunk, encoding, done) { /*    chunk,         done(null, chunk); done(err, chunk); -       error  ,    : this.push(chunk); done(); this.push(chunk); done(err);*/ //      Chunk (.  writable.js) this.push(new Chunk(chunk)); done(); } /** *  transform     _flush.   ,      ,    'end'  Readable (  Transform,       ,    ). * @param done - done(err)     Error * @private */ _flush(done) { //TODO ... -       done(); } } let array_of_data = ['1', '2', '3', '4', '5']; let r_opts = { encoding: 'utf8' }; const R = new Readable(array_of_data, r_opts); let t_opts = { readableObjectMode: true //   Transform   , writableObjectMode: false//   Transform      , decodeStrings: false }; const T = new Transformer(t_opts); let w_opts = { objectMode: true// false,    }; const W = new Writable(w_opts); R.pipe(T).pipe(W);</span></span></code> </pre><br></div></div><br><br><h2>  Duplex Streams - write and read streams </h2><br>  Duplex is implemented in itself as Readable and Writable threads.  In this case, their "work" occurs independently of each other. <br><br>  If you are interested in the topic of threads, we suggest experimenting with the implementation of your Duplex streams yourself. <br><br><div class="spoiler">  <b class="spoiler_title">new stream.Duplex (options)</b> <div class="spoiler_text">  new stream.Duplex (options) <br>  The options Object is passed to the Duplex stream's Writable and Readable constructors. <br><br><ul><li>  allowHalfOpen default boolean true.  If false, then when the read stream completes its work, it automatically terminates the work and write stream; </li><li>  readableObjectMode boolean defaults to false.  mode objectMode for stream readable.  property value is ignored if objectMode property = true; </li><li>  writableObjectMode boolean defaults to false.  mode objectMode for stream writable.  property value is ignored if objectMode property = true. </li></ul><br></div></div><br><h2>  Error processing </h2><br>  When an 'error' event was triggered in one of the links, and if you need to notify the ‚Äúprevious‚Äù streams in the chain, you also need to trigger the 'error' event: StreamClass.emit ('error', err), and handle the situation.  Or use the pump module (https://github.com/mafintosh/pump), with which you can solve this issue. <br><br><h3>  Summing up </h3><br>  Using threads, you can solve almost any problem: <br><br><ul><li>  save / read data to / from a file or database; </li><li>  archiving files; </li><li>  data encryption; </li><li>  data transmission over the network (real-time messaging modules, implement broadcast video, audio files) </li></ul><br>  As they say - for every taste. </div><p>Source: <a href="https://habr.com/ru/post/339900/">https://habr.com/ru/post/339900/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339878/index.html">Uneducated youth. What's left overs</a></li>
<li><a href="../339882/index.html">How do we at Tutu.ru achieve the effectiveness of each of the 9000+ UI tests?</a></li>
<li><a href="../339892/index.html">Vraytap autumn crackme from Kaspersky Lab</a></li>
<li><a href="../339894/index.html">What every developer should know about the search</a></li>
<li><a href="../339896/index.html">Instructions on how to compile the dynamic ngx_pagespeed module for Nginx to Debian</a></li>
<li><a href="../339902/index.html">Maven, where are my artifacts? Another article about dependency management</a></li>
<li><a href="../339904/index.html">Overview of the Luigi Framework for building sequences of tasks</a></li>
<li><a href="../339906/index.html">Home Minecraft server in Azure part 2 - Azure Automation</a></li>
<li><a href="../339908/index.html">Killer feature Vim</a></li>
<li><a href="../339910/index.html">We break the modified AES-256</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>