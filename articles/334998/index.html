<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Protection of the site against attacks using Nemesida WAF: from signatures to artificial intelligence</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article will discuss the practice of protecting a vulnerable web application - from the signature method to artificial intelligence using the Web ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Protection of the site against attacks using Nemesida WAF: from signatures to artificial intelligence</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/59/e7/75/59e775120eb32190002675.png"><br><br>  The article will discuss the practice of protecting a vulnerable web application - from the signature method to artificial intelligence using the <a href="https://waf.pentestit.ru/">Web Application Firewall</a> (commercial and Opensource versions).  We will use Nemesida WAF as a commercial solution, and NAXSI as a non-commercial solution.  The article contains general and technical information on the work of WAF, as well as a comparison of attack detection methods, analysis of their features and disadvantages. <br><br><h2>  Attack detection </h2><br>  The first and main task of any WAF is to determine the most accurate attack with the minimum number of false positives (false positive).  In NAXSI, there is only a signature-based mechanism for determining attacks (behavioral analysis is in the initial state, so we will not consider it), in Nemesida WAF - three: signature-based, qualitative behavioral analysis and machine learning.  Speaking about the complex method of determining attacks, we mean a symbiosis of these three methods.  Why three?  Let's see. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Signature method for determining attacks </h3><br>  Despite the rapid development of technology, most attacks are detected by the signature method, and the quality of all methods based on signature analysis (including machine learning) depends on how well the signatures are written.  Consider an example of defining a web application attack by the signature method: <br><br> <code>index.php?id=-1'+union+select+1,2,3,4,5+--+1</code> <br> <br>  In this case, the signature of the attack will be the entry of the "union + select" chain. <br><br>  An example of an attack that NAXSI will miss: <br><br> <code>index.php?id=-1'+Union+Select+1,2,3,4,5+--+1</code> <br> <a name="habracut"></a><br>  NAXSI will skip such an attack, because when processing a request due to an error in the code, the first letter of the ‚Äústop word‚Äù indicated in the upper case is not taken into account, and the request does not match the ‚Äúunion‚Äù and ‚Äúselect‚Äù signatures. <br><br>  NAXSI will skip the direct access to get the DBMS version: <br><br> <code>id=version();+--+</code> <br> <br>  This also applies to other service functions - ‚ÄúCURRENT_USER ()‚Äù, ‚ÄúDATABASE ()‚Äù, ‚ÄúROW_COUNT ()‚Äù and others.  NAXSI does not convert (does not normalize) ‚ÄúURLENCODED‚Äù data or binary strings for comparison with the signature database, so such attacks will also be skipped: <br><br> <code>id=concat_ws%23%0a(0b00111010,database%0b(%0b),database%09(%09)</code> <br> <code>id=1 anD 0 unio%6e %23def%0a sELEc%74%23zxc%0a</code> <br> <br>  And such attacks also miss: <br><br> <code> 1: &lt;iframe/onload='this[¬´src¬ª]=¬´javas cript:al¬ª+¬´ert``¬ª';&gt;</code> <br> <code> 2: &lt;img/src=q onerror='new Function`al\ert\`1\``'&gt;</code> <br> <br>  It is worth noting that NAXSI signatures do not take into account all modern methods of masking a peylod and require significant refinement.  And given the regular expressions on the MySQL command syntax, there is a considerable likelihood of adding to the white list (with false positives) a bunch of ‚Äúdangerous occurrences‚Äù, for example: <br><br> <code>MainRule "rx:select|union|update|delete|insert|table|from|ascii|hex|unhex|drop" "msg:sql keywords" "mz:BODY|URL|ARGS|$HEADERS_VAR:Cookie" "s:$SQL:4" id:1000;</code> <br> <br><h4>  False Positive </h4><br>  In order to reduce the number of false positives to zero, you must accurately set the threat level for each signature (scoring).  Consider a rule with incorrect scoring (for example, ‚Äúorder‚Äù and ‚Äúby‚Äù operators), leading to the appearance of false positives: <br><br> <code>The New World Order is a book written by HG Wells</code> <br> <br>  The reason for False Positive in the example above is the high scoring of the entry of MySQL statements without regard to applicability and the request zone. <br><br>  Here is an example of a rule with correct scoring (chain entry): <br> <code>index.php?id=1+order+by+10+--+</code> <br> <br><h4>  Signature analysis: conclusions </h4><br>  1. Developing signatures requires high competencies and an understanding of how an attacker works.  We have such knowledge of employees of the security analysis department. <br>  2. Signatures must be constantly updated. <br>  3. Using signatures without specialized processing (behavioral analysis) will lead to false positives (False Positive). <br><br>  Even with an accurate and complete set of rules, the signature method of detecting attacks has 2 main drawbacks, which will lead to the appearance of false positives, or will completely miss the attack: <br><br><ol><li>  False positive if the signature method detects the inclusion of the union and select operators in the URI will have a high scoring, which will lead to an erroneous blocking of the query: /weareunion/sub/select_your_choice.php </li><li>  False negative if the signature or chain of attack signatures has low scoring, but allows you to get "sensitive" information: some.php? Size = version% 28% 29% 20;% 20- </li></ol><br>  To eliminate both shortcomings, we need an advanced attack definition model ‚Äî behavioral analysis and machine learning. <br><br><h3>  Behavioral analysis </h3><br>  Let's go straight to practice: <br><br> <code> 1: index.php?id=1 <br>  2: index.php?id=3-2 <br>  3: index.php?id=-1 <br>  4: index.php?id=1' <br>  5: index.php?id='1 <br>  6: index.php?id=1 and sleep(5)</code> <br> <br>  In this example, we see an attempt to detect the SQL injection by manipulating the parameters, adding the quotation mark and the ‚Äúsleep‚Äù function.  By themselves, these scattered signs do not contain an explicit attack vector, but their combination clearly indicates that the attacker is trying to ‚Äúprobe‚Äù the web application.  The mathematical model summarizes the signs of user behavior over a period of time and based on this blocking occurs, which allows not to miss the start of the attack, while requests of legitimate visitors to the site are not blocked. <br><br><h3>  Artificial Intelligence </h3><br>  Machine Learning is an extensive subsection of artificial intelligence that studies methods for constructing algorithms capable of learning.  There are two types of training: <br><br><ul><li>  precedent training, or inductive learning, based on the identification of general regularities according to particular empirical data </li><li>  deductive training, involving the formalization of expert knowledge and their transfer to a computer as a knowledge base.  Deductive learning is usually referred to the field of expert systems, so the terms machine learning and learning from precedents can be considered synonymous. </li></ul><br>  In simple words, we use all the accumulated experience (both in the field of protection of web applications and penetration testing) to build the basis of the learning model, that is, we use deductive training. <br><br><h2>  An additional source of attack is penetration testing laboratories. </h2><br>  In 2013, the first penetration testing lab ‚ÄúTest lab‚Äù was launched, which is a copy of a real corporate network of a virtual company containing common vulnerabilities and configuration errors.  Over 4 years of laboratory development, their concept has not changed, only its dimensions have changed.  The latest laboratories are distributed networks of the head office and branches, and the number of nodes has increased to 50 units (servers, workstations, network equipment etc).  In contrast to the CTF, the emphasis in the ‚ÄúTest lab‚Äù is made on realism, and the actions of the attackers are identical to those of the external intruder, which allowed 18,000 participants to gather around the ‚ÄúTest lab‚Äù. <br><br>  For us, the laboratories have become not only just for fun, but also an excellent testing ground for debugging and improving the work of Nemesida WAF.  Just imagine - 40-50 Mbit / s of traffic of "clean" attacks, which need to be processed and filtered without delay. <br><br><h2>  Nemesida WAF </h2><br>  Being a company that provides services and solutions in the field of practical information security - penetration testing, security analysis, etc., having a high-quality search base for vulnerabilities (in 8 out of 10 pentests are completed with access to critical data), we made Nemesida WAF - an integrated detection of attacks based on artificial intelligence, accurately detecting and blocking attacks on web applications with almost 0% of false positives. <br><br><h4>  Personal Area </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/ac6/b65/6a8/ac6b656a8fa25baad25abf33bacac577.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/f76/d65/b1f/f76d65b1fe93e5eb3bff385daaf51021.png"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/2lb07fuBawY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  <a href="https://waf.pentestit.ru/">Nemesida WAF is</a> provided either as a cloud service (when traffic to a protected application passes through a protected module located in our infrastructure), or as a standalone solution (when WAF is installed in a client's infrastructure). </div><p>Source: <a href="https://habr.com/ru/post/334998/">https://habr.com/ru/post/334998/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334988/index.html">Struct, union, and enum types in Modern C ++</a></li>
<li><a href="../334990/index.html">Introduction to octree</a></li>
<li><a href="../334992/index.html">How to view 20 million domain names and be satisfied</a></li>
<li><a href="../334994/index.html">I want to like YouTube</a></li>
<li><a href="../334996/index.html">Usability card product. Scenario profitable for business</a></li>
<li><a href="../335002/index.html">Lecture by Vladimir Iglovikov at machine training for Yandex</a></li>
<li><a href="../335006/index.html">[Archeology Live] Shameful talk about singletons</a></li>
<li><a href="../335008/index.html">We give the user of the application game currency using AdMob Rewarded Video</a></li>
<li><a href="../335010/index.html">[UPDATED + Comments] At first they steal, and when you win, they kill you</a></li>
<li><a href="../335012/index.html">SHA2017 CTF: Need More Traffic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>