<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make friends java-ws and php4 without using any additions and a little popuit your brain.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I read about working with web services in php using SOAP . 
 I want to tell a very entertaining story. Once I faced the task of picking up the admin p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make friends java-ws and php4 without using any additions and a little popuit your brain.</h1><div class="post__text post__text-html js-mediator-article">  I read about <a href="http://habrahabr.ru/blogs/php/38370/">working with web services in php using SOAP</a> . <br>  I want to tell a very entertaining story.  Once I faced the task of picking up the admin <a href="http://fastsearch.com/">panel of the FastSearch search engine</a> .  As they say - do not get used.  The only thing that confused me was that the admin panel was written in pkhp 4.0, and I am writing in Java. <br>  Well, pkhp so pkhp.  Naturally, Google immediately gave me Pear: Soap.  How would you feed him wsld from a web service and everyone will start laughing and crying with happiness.  Either because I can‚Äôt read examples, or because the web service was written in Java and hung out on IBM WebSphere Application Server 6.0, and IBM, as you know, is ahead of the rest, loves to do standardized things in its own way. in general, Pear: Soap did not work. <br><br>  Well, the web service is you, or not a web service, but you work on http and send xml-ku. <br>  I think so - it is unlikely that php4 will not allow me to send xml-ku by http. <br>  In order not to reinvent the wheel and not step on a rake, I pop the header of the soap message that the Toad ws-client sends.  This bastard, by the way, eats a link to wsdl (web service description) and offers available service methods, indicating their type. <br><a name="habracut"></a>  It turned out this: <br><br>  <i>/ * sniffed HEADER of SOAP message</i> <i><br></i>  <i>POST / AuditServiceEAR / services / AuditService HTTP / 1.1</i> <i>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </i>  <i>Host: superhost.ru:9081</i> <i><br></i>  <i>Content-Type: text / xml;</i>  <i>charset = utf-8</i> <i><br></i>  <i>Content-Length: 589</i> <i><br></i>  <i>Accept: application / soap + xml, application / dime, multipart / related, text / *</i> <i><br></i>  <i>User-Agent: IBM Web Services Explorer</i> <i><br><br></i>  <i>Cache-Control: no-cache</i> <i><br></i>  <i>Pragma: no-cache</i> <i><br></i>  <i>SOAPAction: ""</i> <i><br></i>  <i>Connection: close</i> <i><br></i>  <i>* /</i> <br>  This is already something. <br>  Now it's time to talk a little code. <br>  To make it easier for Javista colleagues, I write simply and without taste: <br><br><blockquote>  <font color="black"><font color="#008000">/ * CONSTANTS * /</font></font> <font color="black"><br></font>  <font color="black">$ URL_TO_WEB_SERVICE = <font color="#A31515">" <a href="http://superhost.ru/AuditServiceEAR/services/AuditService">superhost.ru/AuditServiceEAR/services/AuditService</a> "</font> ;</font>  <font color="black"><font color="#008000">// path to web-service</font></font> <font color="black"><br></font>  <font color="black">$ PORT_NUMBER = 9081;</font>  <font color="gray">* This source code was highlighted with <a href="http://source.virtser.net/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br><br>  Now we‚Äôll get the function that will send a dirty soap message to the web service.  Praise the balls, I do not need to get an answer from this monster. <br><br><blockquote>  <font color="black"><font color="#008000">/ **</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">function opens socket, prepares and sends SOAP message.</font></font>  <font color="black"><font color="#008000">It doesn't read response.</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">$ data is a SOAP message &lt;Envelope&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">* /</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">function</font> do_post_request ($ data) {</font> <font color="black"><br></font>  <font color="black">global $ PORT_NUMBER, $ URL_TO_WEB_SERVICE;</font> <font color="black"><br><br><br></font>  <font color="black">$ url = $ URL_WEB_SERVICE;</font> <font color="black"><br></font>  <font color="black">$ start = strpos ($ url, <font color="#A31515">'//'</font> ) +2;</font> <font color="black"><br></font>  <font color="black">$ end = strpos ($ url, <font color="#A31515">'/'</font> , $ start);</font> <font color="black"><br></font>  <font color="black">$ host = substr ($ url, $ start, $ end- $ start);</font> <font color="black"><br></font>  <font color="black">$ domain = substr ($ url, $ end);</font> <font color="black"><br><br></font>  <font color="black">$ fp = pfsockopen ($ host, $ PORT_NUMBER);</font>  <font color="black"><font color="#008000">// it is a persistent version of fsockopen ().</font></font>  <font color="black"><font color="#008000">It behaves the same way.</font></font>  <font color="black"><font color="#008000">But it doesn't close connection</font></font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">if</font> (! $ fp) {</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> <font color="#0000ff">null</font> ;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">fputs ($ fp, <font color="#A31515">"POST $ domain HTTP / 1.1 \ n"</font> );</font> <font color="black"><br></font>  <font color="black">fputs ($ fp, <font color="#A31515">"Host: $ host \ n"</font> );</font> <font color="black"><br></font>  <font color="black">fputs ($ fp, <font color="#A31515">"Content-type: text / xml; charset = utf-8 \ n"</font> );</font> <font color="black"><br><br></font>  <font color="black">fputs ($ fp, <font color="#A31515">‚ÄúContent-length:‚Äû</font> .strlen ($ data). <font color="#A31515">‚Äú\ n‚Äù</font> );</font> <font color="black"><br></font>  <font color="black">fputs ($ fp, <font color="#A31515">"Accept: application / soap + xml, application / dime, multipart / related, text / * \ n"</font> );</font> <font color="black"><br></font>  <font color="black">fputs ($ fp, <font color="#A31515">‚ÄúCache-Control: no-cache \ n‚Äù</font> );</font> <font color="black"><br><br></font>  <font color="black">fputs ($ fp, <font color="#A31515">"Pragma: no-cache \ n"</font> );</font> <font color="black"><br></font>  <font color="black">fputs ($ fp, <font color="#A31515">'SOAPAction: "" \ n'</font> );</font> <font color="black"><br></font>  <font color="black">fputs ($ fp, <font color="#A31515">‚ÄúConnection: close \ n \ n‚Äù</font> );</font> <font color="black"><br></font>  <font color="black">fputs ($ fp, <font color="#A31515">"$ data \ n \ n"</font> );</font> <font color="black"><br></font>  <font color="black">fclose ($ fp);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="gray">* This source code was highlighted with <a href="http://source.virtser.net/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br><br>  chic, now we need to form a soap message.  In general, there is such a web service envelope (envelope) where I stuff my data.  I'll do one more function.  Suddenly the web service method signature will change?  And in any case, even though I am not on kfp4 and do not code, but I must introduce the elementary element of reuseability. <br><br><blockquote>  <font color="black"><font color="#0000ff">function</font> write_audit_message ($ source, $ evt, $ server, $ message, $ userIP, $ action) {</font> <font color="black"><br></font>  <font color="black">$ data = <font color="#A31515">'&lt;soapenv: Envelope xmlns: q0 = " <a href="http://audit.service.company/">audit.service.company</a> " xmlns: soapenv = " <a href="http://schemas.xmlsoap.org/soap/envelope/">schemas.xmlsoap.org/soap/envelope</a> " xmlns: xsd = " <a href="http://www.w3.org/2001/XMLSchema">www.w3.org/2001/XMLSchema</a> " xmlns : xsi = " <a href="http://www.w3.org/2001/XMLSchema-instance">www.w3.org/2001/XMLSchema-instance</a> "&gt; '</font></font> <font color="black"><br><br></font>  <font color="black">.</font>  <font color="black"><font color="#A31515">'&lt;soapenv: Body&gt;'</font></font> <font color="black"><br></font>  <font color="black">.</font>  <font color="black"><font color="#A31515">'&lt;q0: addEvent&gt;'</font></font> <font color="black"><br></font>  <font color="black">.</font>  <font color="black"><font color="#A31515">'&lt;arg_0_0&gt;'</font> . $ source.</font>  <font color="black"><font color="#A31515">'&lt;/ arg_0_0&gt;'</font></font> <font color="black"><br></font>  <font color="black">.</font>  <font color="black"><font color="#A31515">'&lt;arg_1_0&gt;'</font> . $ evt.</font>  <font color="black"><font color="#A31515">'&lt;/ arg_1_0&gt;'</font></font> <font color="black"><br></font>  <font color="black">.</font>  <font color="black"><font color="#A31515">'&lt;arg_2_0&gt;'</font> . $ server.</font>  <font color="black"><font color="#A31515">'&lt;/ arg_2_0&gt;'</font></font> <font color="black"><br></font>  <font color="black">.</font>  <font color="black"><font color="#A31515">'&lt;arg_3_0&gt;'</font> . $ message.</font>  <font color="black"><font color="#A31515">'&lt;/ arg_3_0&gt;'</font></font> <font color="black"><br></font>  <font color="black">.</font>  <font color="black"><font color="#A31515">'&lt;arg_4_0&gt;'</font> . $ userIP.</font>  <font color="black"><font color="#A31515">'&lt;/ arg_5_0&gt;'</font></font> <font color="black"><br></font>  <font color="black">.</font>  <font color="black"><font color="#A31515">'&lt;arg_5_0&gt;'</font> . $ action.</font>  <font color="black"><font color="#A31515">'&lt;/ arg_6_0&gt;'</font></font> <font color="black"><br></font>  <font color="black">.</font>  <font color="black"><font color="#A31515">'&lt;/ q0: addEvent&gt;'</font></font> <font color="black"><br></font>  <font color="black">.</font>  <font color="black"><font color="#A31515">'&lt;/ soapenv: Body&gt;'</font></font> <font color="black"><br></font>  <font color="black">.</font>  <font color="black"><font color="#A31515">'&lt;/ soapenv: Envelope&gt;'</font> ;</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// now send prepared envelope</font></font> <font color="black"><br></font>  <font color="black">do_post_request ($ data);</font> <font color="black"><br></font>  <font color="black">}</font> <font color="gray">* This source code was highlighted with <a href="http://source.virtser.net/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br><br>  In general, everything is ready.  The web service is located, receives the message and remains satisfied. <br><br>  Sometimes, having the most modern means, you can be in the ass.  Yes, you can send a soap message in three lines, and pkhp4 is the day before yesterday, but what to do now if you have the most primitive means at hand and the header and body of the soap message. <br><br>  So it's not so simple what is written in two lines! <br><br></div><p>Source: <a href="https://habr.com/ru/post/38461/">https://habr.com/ru/post/38461/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../38449/index.html">"What would Jesus do?"</a></li>
<li><a href="../38452/index.html">Fantasy client or who works in a hosting company</a></li>
<li><a href="../384543/index.html">Undocumented Mastertronics board features. Part 2: MC2 3D Printer</a></li>
<li><a href="../38457/index.html">ASP.NET MVC Preview 5 released</a></li>
<li><a href="../38460/index.html">M.video: a full-fledged laptop with Windows Vista is cheaper than 10 000 rubles?</a></li>
<li><a href="../38463/index.html">SAP on Twitter - an enterprise level social experiment</a></li>
<li><a href="../384641/index.html">Portable hiking weather station MiniBTH2 / 2M</a></li>
<li><a href="../38467/index.html">Draft Alternative Curriculum</a></li>
<li><a href="../384681/index.html">Selection of pedometers not on the wrist: choose non-obvious models</a></li>
<li><a href="../38470/index.html">Pixar Tour</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>