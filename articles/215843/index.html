<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google Docs Add-on. Expanding Google Docs Editor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day, Google announced the release of a new platform that allows developers to create applications that work within Google Docs and expand th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google Docs Add-on. Expanding Google Docs Editor</h1><div class="post__text post__text-html js-mediator-article">  The other day, Google <a href="https://developers.google.com/apps-script/add-ons/">announced the</a> release of a new platform that allows developers to create applications that work within Google Docs and expand the basic functionality of Google Docs editor. <br>  We will understand what it is, how it works and write a small application that will allow us to translate the text of the document without leaving Google Docs. <br><a name="habracut"></a><br><h5>  A bit of theory. </h5><br>  Google Docs dd-on is an application written in javascript that exists and works in Google Drive (currently only for Google Docs), which has its own UI ('sidebar' to the right of the document or a modal window on top), extending the functionality of Google Docs editor .  Google Docs Add-on is the next step in the development of Google Apps Script.  In fact, this is a Google Apps Script project with the ability to distribute and install it by other Google Docs users. <br><br>  There are several types of Google Apps Script projects, the main ones are a separate project file in Google Drive (in Google Drive you see it as a separate file, 'standalone script') or a project with a container document ( <a href="https://developers.google.com/apps-script/scripts_containers">'container-bounds script'</a> ).  You can see it by opening the document container, menu 'Tools' -&gt; 'Script editor'.  Google Docs Add-on is just the second option; to create it, you need a document container that you will use to test and debug your application. <br><br><h5>  Spread </h5><br>  Distributed Google Docs Add-on through the Chrome Web store (although not a browser extension).  Before adding your add-on to the Chrome Web Store, you must <a href="https://developers.google.com/apps-script/add-ons/publish">review</a> Google.  For Google Docs users, all add-ons are available for installation through the new menu item - 'Add-ons' -&gt; 'Get Add-ons'. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Development environment </h5><br>  For Google Apps Script projects, Google provides a development environment integrated into Google Drive, with the ability to run, debug, and code completion.  Is it possible to use another development environment and store the code not in Google Drive, but in CVS?  This would allow several developers to work on the project at the same time and support versioning.  For 'standalone' projects there is such an opportunity, for 'Sontainer-bounds' - unfortunately not yet.  Therefore, for the development of Google Docs Add-on'a have to use an integrated development environment.  Here is <a href="https://bitbucket.org/alexandr_baran/google-apps-script-sync">an example of a python script</a> that allows you to ‚Äúdump‚Äù the 'standalone' project to the file system and update it in Google Drive after the change. <br><br><h5>  What's inside </h5><br>  A little more about how Google Apps Script works.  Project files contain the ‚Äúserver‚Äù (.gs) and ‚Äúclient‚Äù (.html) parts of the application.  The ‚Äúserver‚Äù part is a set of javascript functions that can <a href="https://developers.google.com/apps-script/guides/services/external">access third-party services</a> , various Google APIs (Drive, GMail, Calendar), including the API of the document in which this add-on is installed. <br>  Also, the '.gs' files contain predefined functions that are called when the user sets / opens an add-on, which allows you to create your application's UI within the standard Google Docs editor.  In turn, the ‚Äúclient part‚Äù is standard html files, with the possibility of calling any function from any ‚Äúserver‚Äù file.  And also, of course, with the ability to connect third-party CSS / javascript files. <br><br><h5>  Example </h5><br>  We will write an application that will translate the selected text in the document from English to Russian.  Create a new Google Docs document in Google Drive, open the 'Tools' -&gt; 'Script editor' menu.  In the dialog that appears, select 'Create script for -&gt; Document'.  After that you will see that integrated development environment.  In the project, by default, the file 'Code.gs' is created, containing a sample application from Google.  We do not need it yet, so I immediately propose to clear its contents, and rename the file itself to 'Server.gs'.  It is also better to immediately rename the project from the 'Untitled project', say in 'Translate example'. <br><br>  So, in 'Server.gs' we define the functions that will create our add-on UI.  To do this, simply declare the function 'onOpen'. <br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ DocumentApp.getUi().createAddonMenu() .addItem(<span class="hljs-string"><span class="hljs-string">'Translate'</span></span>, <span class="hljs-string"><span class="hljs-string">'openSidebar'</span></span>) .addToUi(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openSidebar</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">) </span></span>{}</code> </pre> <br><br>  Now, when you open the document in which the given add-on is installed, the 'Translate' item will appear in the special 'Add-ons' menu.  Clicking on this menu item will call the 'openSidebar' function, which does nothing so far.  To test this, in the development environment, select the ‚ÄúonOpen‚Äù function and click 'Run' <br><img src="https://habrastorage.org/getpro/habr/post_images/f1d/90d/ee1/f1d90dee10b81243082cb73382dc0fc3.png"><br><br>  Now your document has a menu item 'Add-ons' -&gt; 'Translate example' (the name of your project) -&gt; 'Translate' <br><br>  Let's develop the UI for our add-on.  Since the add-on UI is an html page, it makes sense to immediately separate the HTML markup, CSS and javascript code into different files.  To do this, we will create the files 'Sidebar.html', 'Styles.html', 'Scripts.html' and 'Content.html'.  'Sidebar.html' will be a template file that includes the rest of the files. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5f1/c3b/fe6/5f1c3bfe6973c701b72f600bf46fbe17.png"><br><br>  The UI of all add-ons must follow a certain <a href="https://developers.google.com/apps-script/add-ons/style">style guide</a> , so Google provides a special CSS file with predefined styles, which you see a link to in the example. <br><br>  Open 'Content.html' and 'Styles.html' and create markup. <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"content"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Select text and click 'Translate'<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action btn-block"</span></span></span><span class="hljs-tag">&gt;</span></span>Translate<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"result"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  and styles <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-class"><span class="css"><span class="hljs-selector-class">.content</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">20px</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">margin </span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">20px</span></span></span><span class="css">; } </span><span class="hljs-selector-class"><span class="css"><span class="hljs-selector-class">.btn-block</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">display</span></span></span><span class="css">: block; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">width</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">100%</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding-left</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">; </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">padding-right</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">0</span></span></span><span class="css">; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  and in 'Server.gs' we add the body of the function 'openSidebar' <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpen</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ DocumentApp.getUi().createAddonMenu() .addItem(<span class="hljs-string"><span class="hljs-string">'Translate'</span></span>, <span class="hljs-string"><span class="hljs-string">'openSidebar'</span></span>) .addToUi(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openSidebar</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> html = HtmlService.createTemplateFromFile(<span class="hljs-string"><span class="hljs-string">'Sidebar'</span></span>) .evaluate() .setSandboxMode(HtmlService.SandboxMode.NATIVE) .setTitle(<span class="hljs-string"><span class="hljs-string">'Translate example'</span></span>) .setWidth(<span class="hljs-number"><span class="hljs-number">300</span></span>); DocumentApp.getUi().showSidebar(html); }</code> </pre><br>  Now by pressing the menu item "Translate" in the document on the left, the 'sidebar' opens. <br><img src="https://habrastorage.org/getpro/habr/post_images/e57/408/45b/e5740845b5a17861c1d193df94d2685e.png"><br>  It remains to add logic to translate the text.  To do this, we will use the various Google services APIs that are available to us in the '.gs' files and allow us to find the text selected in the document and translate it into the selected language. <br>  'Server.gs' <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pollingCounter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = getSelectedText(getSingleSeletetedElement()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> LanguageApp.translate(text, <span class="hljs-string"><span class="hljs-string">'en'</span></span>, <span class="hljs-string"><span class="hljs-string">'ru'</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSelectedText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">rangeElement</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!rangeElement) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> element = rangeElement.getElement(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> = rangeElement.getStartOffset(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> to = rangeElement.getEndOffsetInclusive() + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (element.getType() === DocumentApp.ElementType.TEXT || element.getType() === DocumentApp.ElementType.PARAGRAPH) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = element.getText(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> text.substring(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>, to); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSingleSeletetedElement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> selection = DocumentApp.getActiveDocument().getSelection(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (selection) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elements = selection.getSelectedElements(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (elements.length === <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elements[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } } }</code> </pre><br>  The 'translate' function searches for the selected element in the document, and if it is a text or a text block, it receives the selected part of the text and translates it from English to Russian.  Now we need to somehow call this function from our UI.  For this, the javascript code running in the sidebar has access to the global google.script.run object, which allows you to call any function from any .gs file. <br>  'Scripts.html' <br><pre> <code class="javascript hljs"> $(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'.action'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ google.script.run.withSuccessHandler(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text) { $(<span class="hljs-string"><span class="hljs-string">'.result'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'Result: '</span></span> + text); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $(<span class="hljs-string"><span class="hljs-string">'.result'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'Please, select text to translate'</span></span>); } }).translate(); }); });</code> </pre><br>  Done, now our add-on can translate the selected text by pressing the 'Translate' key. <br><br>  On the move, you can make 2 improvements.  First, when opening the 'sidebar', while all the files necessary for it are loaded, it would be nice to add some loading indicator.  Create the file 'Loading.html', add a link to it in our 'Sidebar.html', and hide the main content until all resources are fully loaded.  Once everything is ready - we hide the indicator and show our UI. <br>  'Loading.html' <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app-loading"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-align:center"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> Loading... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Content.html <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display:none"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Select text and click 'Translate'<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"action btn-block"</span></span></span><span class="hljs-tag">&gt;</span></span>Translate<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"result"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Sidebar.html <br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- styles --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://ssl.gstatic.com/docs/script/css/add-ons.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?</span></span></span><span class="php">!= HtmlService.createHtmlOutputFromFile(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'Styles'</span></span></span><span class="php">).getContent(); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- layout --&gt;</span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?</span></span></span><span class="php">!= HtmlService.createHtmlOutputFromFile(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'Loading'</span></span></span><span class="php">).getContent(); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?</span></span></span><span class="php">!= HtmlService.createHtmlOutputFromFile(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'Content'</span></span></span><span class="php">).getContent(); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--3rd party scripts --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- application scripts --&gt;</span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?</span></span></span><span class="php">!= HtmlService.createHtmlOutputFromFile(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'Scripts'</span></span></span><span class="php">).getContent(); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  and finally in Scripts.html <br><pre> <code class="javascript hljs"> $(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'.app-loading'</span></span>).hide(); $(<span class="hljs-string"><span class="hljs-string">'.content'</span></span>).show(); $(<span class="hljs-string"><span class="hljs-string">'.action'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ google.script.run.withSuccessHandler(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text) { $(<span class="hljs-string"><span class="hljs-string">'.result'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'Result: '</span></span> + text); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $(<span class="hljs-string"><span class="hljs-string">'.result'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'Please, select text to translate'</span></span>); } }).translate(); }); });</code> </pre><br>  And secondly, it would be nice to automatically receive a translation of the selected text from the document, without pressing the 'Translate' button.  To solve this problem, you need to figure out how to get around one of the limitations that currently exists in Google Docs Add-on - there is no event model that would allow Google Script Add-on to respond to user actions in the document.  We will have to mimic add-on interactivity using long polling - constant requests from the UI, which will force our 'Server.gs' to check the document for selection and translate the text.  To do this, we write in the 'Script.html' function, which will run 2 processes with a certain interval.  The first process will call the 'translate' function and simply save the translation result.  The second process will check for the result of the translation and update the UI. <br>  'Scripts.html' <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> LongPollingManager = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> process = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pollingTimeout = <span class="hljs-number"><span class="hljs-number">1500</span></span>, notificationTimeout = <span class="hljs-number"><span class="hljs-number">1500</span></span>, pollingCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>, pollingStopped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, pollingResult, pollingProcess, notificationProcess; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> start = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ pollingStopped = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; pollingProcess = setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pollingStopped) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } pollingCounter++; google.script.run.withSuccessHandler(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pollingStopped) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!pollingResult || response.pollingCounter &gt; pollingResult.pollingCounter) { pollingResult = response; } })[options.method](pollingCounter); }, pollingTimeout); setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ notificationProcess = setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pollingStopped) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } options.notification(getLastResult()); }, notificationTimeout); }, notificationTimeout/<span class="hljs-number"><span class="hljs-number">2</span></span>); }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getLastResult = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pollingResult; }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stop = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ pollingResult = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; pollingStopped = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; clearInterval(pollingProcess); clearInterval(notificationProcess); }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">start</span></span>: start, <span class="hljs-attr"><span class="hljs-attr">stop</span></span> : stop, <span class="hljs-attr"><span class="hljs-attr">isActive</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !pollingStopped; }, <span class="hljs-attr"><span class="hljs-attr">getLastResult</span></span> : getLastResult };; }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">process</span></span>: process }; })(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> showResult = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result &amp;&amp; result.text) { $(<span class="hljs-string"><span class="hljs-string">'.result'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'Result: '</span></span> + result.text); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $(<span class="hljs-string"><span class="hljs-string">'.result'</span></span>).text(<span class="hljs-string"><span class="hljs-string">''</span></span>); } }; $(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'.loading'</span></span>).hide(); $(<span class="hljs-string"><span class="hljs-string">'.content'</span></span>).show(); $(<span class="hljs-string"><span class="hljs-string">'.action'</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ google.script.run.withSuccessHandler(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text) { $(<span class="hljs-string"><span class="hljs-string">'.result'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'Result: '</span></span> + text); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $(<span class="hljs-string"><span class="hljs-string">'.result'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'Please, select text to translate'</span></span>); } }).translate(); }); LongPollingManager.process({ <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'translate'</span></span>, <span class="hljs-attr"><span class="hljs-attr">notification</span></span>: showResult }).start(); });</code> </pre><br>  'Server.gs' <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pollingCounter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = { <span class="hljs-attr"><span class="hljs-attr">pollingCounter</span></span> : pollingCounter }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = getSelectedText(getSingleSeletetedElement()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text) { result.text = LanguageApp.translate(text, <span class="hljs-string"><span class="hljs-string">'en'</span></span>, <span class="hljs-string"><span class="hljs-string">'ru'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre><br><br>  Done, now our add-on automatically translates the selected text. <br>  <a href="https://docs.google.com/document/d/18CJvCHv3h5-6YbbU0qt2pwlT9ICAJ5sgCoQbCNSEf4I/edit%3Fusp%3Dsharing">Document + project code on Google Drive</a> <br>  <a href="https://github.com/abaran/google-docs-add-on-example">Github code</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a50/ea8/f02/a50ea8f02b260d3d3b0222b549b132a8.jpg"><br><br><h5>  Conclusion </h5><br>  So, Google Docs add-on is a new platform that allows you to create applications that extend the capabilities of the basic Google Docs editor. <br>  Pros and cons, in my opinion: <br><ul><li>  + Huge audience of Google Docs users. </li><li>  + Developing an application entirely in javascript. </li><li>  + Access to numerous Google API and any third-party service (HTTP requests). </li><li>  - Development of the project within Google Docs, there is no possibility to conduct development locally, it is difficult to divide the work among several developers. </li><li>  - Lack of interactive interaction with the document (there is no possibility to receive notifications about any user actions in the document. </li></ul><br><br>  PS <br><br>  I think that in the rivalry of MS Office - Google Drive, Google decided to bet on simplicity, convenience and the developer community.  Let me explain with the example of MS Word vs Goodle Docs.  MS Word has a huge number of user-accessible functions (and as a result, an overloaded and complicated UI) and does not have an open API.  Google Docs - on the contrary, has the minimum necessary set of tools and an open API.  Now you can find any missing function in the Google Docs gallery of add-ons or write it yourself.  And the user can add to his document only the functions he needs. </div><p>Source: <a href="https://habr.com/ru/post/215843/">https://habr.com/ru/post/215843/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../215831/index.html">Pwn2Own 2014: results</a></li>
<li><a href="../215835/index.html">Compiling sources (cpp, cs) with Visual Studio compiler without running IDE on Windows</a></li>
<li><a href="../215837/index.html">Documentation in software development</a></li>
<li><a href="../215839/index.html">Adding HDD to the "moody" laptop</a></li>
<li><a href="../215841/index.html">Part 2. HID device for camera rotation</a></li>
<li><a href="../215845/index.html">Mysterious pCell, or DIDO under the microscope</a></li>
<li><a href="../215849/index.html">Site Lenta.ru has undergone a hacker attack</a></li>
<li><a href="../215851/index.html">A little bit of CeBIT 2014</a></li>
<li><a href="../215859/index.html">Rikor.IT is one of the first in the world to develop energy-efficient servers!</a></li>
<li><a href="../215861/index.html">Webinar Algorithms and Data Structures of Innopolis University from Professor David Vernon</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>