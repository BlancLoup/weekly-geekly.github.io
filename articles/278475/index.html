<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we automate testing with release management - Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part of this article, I fully described the test automation setup process using RM. In the second (and last) part of the article I will t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we automate testing with release management - Part 2</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="https://habrahabr.ru/company/microsoft/blog/277601/">first part of this article,</a> I fully described the test automation setup process using RM.  In the second (and last) part of the article I will talk about some design solutions, problems that we encountered when setting up the system, and ways to overcome these problems. <br><br><h2>  One or more agent pools? </h2>  <b>Question</b> : how to redirect the release definition to the appropriate agent computer, i.e.  on a computer with the resources needed by this release definition? <br>  <b>Solution</b> : when we started to create release definitions, it became obvious that it was necessary to direct each release definition to the appropriate agent, since the requirements of all test suites were different.  At first, we created a separate agent pool for each release definition, but managing a large number of agent pools turned out to be difficult.  Ultimately, we followed the advice of Chris Patterson from the build group and developed a system that used a single agent pool called RMAgentPool.  All agents of this pool differed from each other by the user's capabilities.  Each release definition and assembly definition is now performed by the appropriate agent using the RmCdpCapability feature.  For example, a computer that is prepared for RM.CDP.TfsOnPrem has the ability RmCdpCapability = TfsOnPrem: <br><img src="https://habrastorage.org/getpro/habr/post_images/7e0/cb3/f24/7e0cb3f2453a268a8bbeccde7ea452c5.png"><br><br>  RM.CDP.TfsOnPrem RD directs its execution to this agent using the requirement RmCdpCapability = TfsOnPrem: <br><img src="https://habrastorage.org/getpro/habr/post_images/84d/24f/4c2/84d24f4c2c96767fd32892817f96791b.png"><br><a name="habracut"></a><br><h2>  JIT debugging </h2>  <b>Question</b> : how to debug intermittent crashes when log files contain insufficient data?  By the time developers find a problem, the next test run removes the ‚Äúerror state‚Äù from the test computer. <br>  <b>Solution</b> : when the test suite behavior is unpredictable, we include the ‚ÄúPause Agent on test failure‚Äù task in the issue definition: <br><img src="https://habrastorage.org/getpro/habr/post_images/bc6/dbb/8a9/bc6dbb8a90172d3ee5e8c7ac243ddf61.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This task suspends release when an error occurs in an unpredictable test.  In this situation, the developer can remotely connect to the agent's computer, the state of which will be exactly the same as his state at the time of the error.  Please note that this is only possible if the value of the environment wait time is 0 (there is no waiting time). <br>  The Pause task takes the following arguments (highlighted in the illustration above): <br>  -AlternateCredentialsUserName $ (release.alternateusername) -AlternateCredentialsPassword $ (release.alternatepassword) -ReleaseId $ (Release.ReleaseId) -TaskName <b>$ (TaskToDebugName)</b> -NumberOfSeconds $ (TaskToDebugTeteb <br>  The key argument here is $ (TaskToDebugName): it has the value <b>"Run RMCDPOnPrem tests"</b> for RM.CDP.TfsOnPrem, i.e.  the name of the task in which intermittent failures occur.  All RM.CDP. * Release definitions include the same task with the same arguments, but the value of $ (TaskToDebugName) in each release definition corresponds to the task whose alternate failures we want to debug. <br>  The source code for this task can be found <a href="">here</a> (instead of ‚ÄúYourAccount‚Äù, you should substitute the account name and use it). <br><br><h2>  How to perform tests in administrator mode on the agent's computer? </h2>  <b>Question</b> : even if the agent is running with administrator rights, it performs the task in a mode other than administrator mode.  This makes it impossible to perform a task that must be performed in administrator mode (for example, installing a service on an agent computer). <br>  <b>Solution</b> : we solved this problem using the ‚ÄúPowershell on Target Machines‚Äù task (‚ÄúPowershell on target computers‚Äù) and remote access to the current agent's computer as an administrator.  For example, we set the TFS service to RM.CDP.RmEqTfs as follows: <br><img src="https://habrastorage.org/getpro/habr/post_images/d4b/99d/d31/d4b99dd31341461cc5313a382d121ebb.png"><br><br><h2>  Tests that can not reuse the task VsTest </h2>  <b>Question</b> : some tests were created relatively long ago (we will call them ‚Äúobsolete‚Äù) and are not compatible with the VsTest task.  How in such situations to take advantage of the preparation of reports that provide tests that are compatible with the task VsTest? <br>  <b>Solution</b> : to solve this problem, we have taken the following actions: <ol><li>  We performed obsolete tests using a batch script or powershell task (whichever is more convenient) and determined the location of the output log file. </li><li>  We added the VsTest task, which analyzed the output log file detected in the previous step and determined whether the test was successful. </li></ol><br>  Our definition of the RM.CDP.DevFabricUpgrade release is as follows: the main test is performed using the powershell script RunAOConfigTest.ps1. <br><img src="https://habrastorage.org/getpro/habr/post_images/fe4/5cd/37d/fe45cd37dd67b948e0dfa558c39342ae.png"><br><br>  It then runs the VsTest task, which analyzes the log file and checks if there are any errors in it. <br>  Note: until recently, the test code RM.CDP.DevFabricUpgrade, compatible with VsTest, simply placed the text ‚ÄúExpected True, but found False‚Äù (‚ÄúTrue expected, but False detected‚Äù) into the log file, which seriously complicated debugging.  The developers were forced to open the output log file RunAOConfigTest.ps1, which in itself was time consuming because the file was very large, and look for a real error in it, as shown in the screenshot below: <br><img src="https://habrastorage.org/getpro/habr/post_images/f33/f67/6ff/f33f676ff8cca542637dc4934cfe6253.png"><br><br>  We recently changed this code to more thoroughly analyze the output log file RunAOConfigTest.ps1.  Now, when testing fails, more detailed error information is displayed: <br><img src="https://habrastorage.org/getpro/habr/post_images/027/b20/11d/027b2011d4ef5d945d7910532bb369dd.png"><br><br><h2>  How to eliminate bottlenecks when performing tests? </h2>  <b>Question</b> : the implementation of some definitions of release takes a very long time, which leads to the appearance of the queue and significantly increases the processing time.  What can be improved in this situation? <br>  <b>Solution</b> : since most of our tests are designed for service deployment and test execution performed on an agent PC, we can simply install additional hardware (with the right RmCdpCapability capability) on the problematic release definitions. <br><br><h2>  How to perform user interface tests? </h2>  <b>Question</b> : how to perform user interface tests on the agent's computer? <br>  <b>Solution</b> : a quick and primitive way to solve this problem is to start the agent interactively (and not in service mode), because in service mode the agent cannot interact with the desktop computer.  The disadvantage of this method is that when the agent runs in interactive mode, the automatic update function is not supported ‚Äî to update the agent, you must log in to the agent‚Äôs computer and restart the agent. <br>  A more automated approach is to start the agent in service mode and use the tasks of the ‚ÄúVisual Studio Test Agent Deployment‚Äù (‚ÄúDeployment of the test agent Visual Studio‚Äù) and ‚ÄúVisual Studio Test using Test Agent‚Äù (‚ÄúRun a Visual Studio test using a test agent "), respectively.  We use a method similar to the ‚ÄúPowershell on Target Machines‚Äù task described above (‚ÄúPowershell on Target Computers‚Äù), in which we log in remotely to the current agent's computer with administrator rights.  These tasks are performed on the agent by a testing service configured to interact with the desktop computer. <br>  In order to use this method, we first create a group of suitable computers in the Test section: <br><img src="https://habrastorage.org/getpro/habr/post_images/ed8/0ac/6c8/ed80ac6c82ba7912de553511790e14e5.png"><br><br>  Then we use this group of computers in the two tasks of the VS test agent mentioned above.  In the VsTest Agent Deployment task, you need to select the "Interactive Process": <br><img src="https://habrastorage.org/getpro/habr/post_images/b9f/36d/9bf/b9f36d9bff2f4f01c217f9353cc170de.png"><br><br>  At the end, the ‚ÄúVs Test using Test Agent‚Äù task (‚ÄúTest Vs using a test agent‚Äù) performs tests using our group of computers, using the same filters as in the standard VsTest task: <br><img src="https://habrastorage.org/getpro/habr/post_images/26f/719/516/26f7195166c24e15251b4680b95c2826.png"><br><br>  It is worth noting that in the near future this process will become more consistent;  we will no longer need to create computer groups for test agent tasks and it will be sufficient to specify the computer name in the $ parameter (Agent.MachineName). <br><br><h2>  What variables are available at runtime? </h2>  <b>Question</b> : What variables are available at runtime? <br>  <b>Solution</b> : Variables that are available at runtime and that can be used in the release definition are listed at the beginning of the following logs: <br><img src="https://habrastorage.org/getpro/habr/post_images/999/e03/abd/999e03abdd172ee9e62e4081b8eb438f.png"><br><br><h2>  Is it possible to scale RM according to the needs of our group? </h2>  <b>Question</b> : As we approach the end of the sprint, the number of checks in our group increases exponentially, and we have doubts that RMO will cope with these loads.  Performing 15 checks per day at the release stage is common practice and implies 15 * 9 = ~ 135 deployments per day (since each check activates nine release definitions). <br>  <b>Solution</b> : At first, the RMO service showed some instability under high loads, but in the second half of 2015 we eliminated it using a series of stress tests.  Now RMO easily handles the tasks of our group.  The screenshot below shows about 20 issues of RM.CDP.DevFabircUpgrade, made in the last 24 hours, which corresponds to 20 * 9 = 180 releases of our group for the same period of time. <br><img src="https://habrastorage.org/getpro/habr/post_images/040/13b/37f/04013b37f57633107b18a94b0cce4c05.png"><br><br><h2>  Conclusion </h2><br>  I hope that this publication will help you solve most of the problems encountered in test automation with RM. </div><p>Source: <a href="https://habr.com/ru/post/278475/">https://habr.com/ru/post/278475/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278463/index.html">What you need to know when configuring the power of the ePMP 1000 transmitter from Cambium Networks</a></li>
<li><a href="../278465/index.html">Protection at all stages of cyber attack</a></li>
<li><a href="../278467/index.html">What is bad to be a full stack developer</a></li>
<li><a href="../278469/index.html">IoC: Another Scala implementation</a></li>
<li><a href="../278473/index.html">Vector graphics for free - selection of sites</a></li>
<li><a href="../278477/index.html">CSS cascading and specificity</a></li>
<li><a href="../278479/index.html">Photo tour of the "cloud" of 1cloud</a></li>
<li><a href="../278481/index.html">April 28 will be the fifth international mobile conference MBLT16</a></li>
<li><a href="../278483/index.html">Special folders. Translation from Richard Siddaway's Blog</a></li>
<li><a href="../278485/index.html">What is bad to be full stack by the enterprise administrator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>