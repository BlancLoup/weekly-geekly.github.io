<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>TDD on the example of UrlBuilder</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TDD on the example of UrlBuilder 
 In this article, I would like to tell you about the use of development techniques through testing in a simple but v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>TDD on the example of UrlBuilder</h1><div class="post__text post__text-html js-mediator-article"><h1>  TDD on the example of UrlBuilder </h1><br>  In this article, I would like to tell you about the use of development techniques through testing in a simple but vital example.  The main advantage of this approach, which I would like to draw attention to - at the time of the start of development, we already know what we need to develop, and we have a very specific criterion for the efficiency of the code. <br><a name="habracut"></a><br>  We will develop a builder that creates a url for the specified parameters - protocol, host, etc.  All matches with real web services please consider the fruit of a sick fantasy. <br><br><h4>  Problem </h4><br>  Not so long ago, I finished developing a fairly large application for Android.  I will not go into details, since the article is not about that, I will only say that the application is a fat client.  The web service accessed by the application has many parameters that are transmitted using the GET method.  For example, to search the entire database: <br><br> <code><a href="http://server.com/%3Faction%3Dsearch%26query%3D%25D0%25BF%25D0%25BE%25D0%25B8%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B9%2520%25D0%25B7%25D0%25B0%25D0%25BF%25D1%2580%25D0%25BE%25D1%2581"></a> http://server.com?action=search&amp;query=%20</code> <br> <br>  To search all database filtering by document type: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code><a href="http://server.com/%3Faction%3Dsearch%26query%3D%25D0%25BF%25D0%25BE%25D0%25B8%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B9%2520%25D0%25B7%25D0%25B0%25D0%25BF%25D1%2580%25D0%25BE%25D1%2581%26document_type_id%3DN"></a> http://server.com?action=search&amp;query=%20&amp;document_type_id=N</code> <br> <br>  To search for a specific document: <br><br> <code><a href="http://server.com/%3Faction%3Dsearch%26query%3D%25D0%25BF%25D0%25BE%25D0%25B8%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B9%2520%25D0%25B7%25D0%25B0%25D0%25BF%25D1%2580%25D0%25BE%25D1%2581%26document_id%3DM"></a> http://server.com?action=search&amp;query=%20&amp;document_id=M</code> <br> <br>  And so on.  Just a few dozen classes of possible queries.  Plus, each request can be both to the production and to the dev server. <br><br>  There was a question how to create a url to access this web service.  To keep a mask for each specific request, as the iPhone programmer did, solving the same task is clearly not an option.  If you add a single parameter, you would have to edit a few dozen lines.  And in general, if you do not do it yourself right away on your own will, then you will be forced to make properly disgruntled users. <br><br>  Uri.Builder does not fit, if only because there is no way to set the host port. <br><br>  So, I decided to write a class to build a url. <br><br><h4>  Analysis </h4><br>  First, we define what we want from our class?  We want him to construct a url by which we would be able to access our web services and return them as java.lang.String.  I would like to be able to build a url from scratch, sequentially specifying the protocol, host, path and parameters, and on the basis of some preset (for example, url to search the entire database, for a specific document, etc.). <br><br><h4>  Development: class interfaces and unit tests </h4><br>  Of these requirements, you can select at least 2 classes.  The first will build an arbitrary url, the second will be the url of some predefined classes.  This is quite enough to describe the interfaces of our classes.  Obviously, we are using the ‚Äúbuilder‚Äù and ‚Äúfluent interface‚Äù patterns. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">protocol</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String protocol)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">host</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String host)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">port</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String port)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">path</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String path)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">param</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String key, String value)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre> <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServerUrlBuilder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlBuilder</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fullSearch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String query)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fullSearch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String query, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> documentTypeId)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">documentSearch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String query, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> documentId)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }</code> </pre><br><br>  And immediately write unit tests.  First for UrlBuilder ... <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlBuilderTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testRootUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ UrlBuilder builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlBuilder(); String expected = <span class="hljs-string"><span class="hljs-string">"http://server.com/"</span></span>; String actual = builder1.protocol(UrlBuilder.HTTP).host(<span class="hljs-string"><span class="hljs-string">"server.com"</span></span>).build(); assertEquals(expected, actual); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testRootUrlWithOneParam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ UrlBuilder builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlBuilder(); String expected = <span class="hljs-string"><span class="hljs-string">"http://server.com/?a=b"</span></span>; String actual = builder.protocol(UrlBuilder.HTTP).host(<span class="hljs-string"><span class="hljs-string">"server.com"</span></span>).param(<span class="hljs-string"><span class="hljs-string">"a"</span></span>,<span class="hljs-string"><span class="hljs-string">"b"</span></span>).build(); assertEquals(expected, actual); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testFullUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ UrlBuilder builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlBuilder(); String expected = <span class="hljs-string"><span class="hljs-string">"http://server.com/folder/?a=b"</span></span>; String actual = builder.protocol(UrlBuilder.HTTP).host(<span class="hljs-string"><span class="hljs-string">"server.com"</span></span>).path(<span class="hljs-string"><span class="hljs-string">"folder"</span></span>).param(<span class="hljs-string"><span class="hljs-string">"a"</span></span>,<span class="hljs-string"><span class="hljs-string">"b"</span></span>).build(); assertEquals(expected, actual); } }</code> </pre><br><br>  ... and then for ServerUrlBuilder. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SereverUrlBuilderTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testFullSearch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ServerUrlBuilder builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServerUrlBuilder(); String expected = <span class="hljs-string"><span class="hljs-string">"http://server.com?action=search&amp;query= "</span></span>; String actual = builder.fullSearch(<span class="hljs-string"><span class="hljs-string">" "</span></span>); assertEquals(expected, actual); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testFullSearchWithDocumentTupeId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ServerUrlBuilder builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServerUrlBuilder(); String expected = <span class="hljs-string"><span class="hljs-string">"http://server.com?action=search&amp;query= &amp;document_type_id=123"</span></span>; String actual = builder.fullSearch(<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-number"><span class="hljs-number">123</span></span>); assertEquals(expected, actual); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testDocumentSearch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ ServerUrlBuilder builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServerUrlBuilder(); String expected = <span class="hljs-string"><span class="hljs-string">"http://server.com?action=search&amp;query= &amp;document_id=123456"</span></span>; String actual = builder.documentSearch(<span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-number"><span class="hljs-number">123456</span></span>); assertEquals(expected, actual); } }</code> </pre><br><br>  For full coverage, it would be good to write about a dozen more tests for different combinations, as well as to check negative scenarios when one of the parameters is not entered or an incorrect value is entered.  But dear readers can not forgive such code sheets. <br><br>  Run our tests.  Of course, none of them will be passed.  But now we have a clear criterion for the efficiency of the code.  It remains to add a couple of lines. <br><br><h4>  Implementation </h4><br>  Add constants to the UrlBuilder class - several protocols and delimiters used in the url.  Let's program the logic of each method. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HTTP = <span class="hljs-string"><span class="hljs-string">"http"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HTTPS = <span class="hljs-string"><span class="hljs-string">"https"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String FTP = <span class="hljs-string"><span class="hljs-string">"ftp"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String sProtocolHostSeparator = <span class="hljs-string"><span class="hljs-string">"://"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String sPathSeparator = <span class="hljs-string"><span class="hljs-string">"/"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String sParamSeparator = <span class="hljs-string"><span class="hljs-string">"?"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String sParamEquals = <span class="hljs-string"><span class="hljs-string">"="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String sParamConcotinator = <span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String mProtocol; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String mHost; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ArrayList&lt;String&gt; mPath = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;String&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ArrayList&lt;String&gt; mParamKeys = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;String&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ArrayList&lt;String&gt; mParamValues = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;String&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UrlBuilder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">protocol</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String protocol)</span></span></span></span>{ mProtocol = protocol; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">host</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String host)</span></span></span></span>{ mHost = host; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">path</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String path)</span></span></span></span>{ mPath.add(path); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">param</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String key, String value)</span></span></span></span>{ mParamKeys.add(key); mParamValues.add(value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> StringBuilder builder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); builder.append(mProtocol); builder.append(sProtocolHostSeparator); builder.append(mHost); builder.append(sPathSeparator); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(String path : mPath){ builder.append(path); builder.append(sPathSeparator); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(mParamKeys.size()&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){ builder.append(sParamSeparator); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;mParamKeys.size(); i++){ String key = mParamKeys.get(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(i!=<span class="hljs-number"><span class="hljs-number">0</span></span>){ builder.append(sParamConcotinator); } String value = mParamValues.get(i); builder.append(key); builder.append(sParamEquals); builder.append(value); } } String result = builder.toString(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } }</code> </pre><br><br>  Run the test again.  Hurray, some of them are successful.  It remains to implement the ServerUrlBuilder logic. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServerUrlBuilder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlBuilder</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SERVER_HOST = <span class="hljs-string"><span class="hljs-string">"server.com"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String PARAM_ACTION = <span class="hljs-string"><span class="hljs-string">"action"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String ACTION_SEARCH = <span class="hljs-string"><span class="hljs-string">"search"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String PARAM_QUERY = <span class="hljs-string"><span class="hljs-string">"query"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String PARAM_DOCUMENT_TYPE_ID = <span class="hljs-string"><span class="hljs-string">"document_type_id"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String PARAM_DOCUMENT_ID = <span class="hljs-string"><span class="hljs-string">"document_id"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fullSearch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String query)</span></span></span></span>{ protocol(HTTP); host(SERVER_HOST); param(PARAM_ACTION, ACTION_SEARCH); param(PARAM_QUERY, query); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fullSearch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String query, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> documentTypeId)</span></span></span></span>{ protocol(HTTP); host(SERVER_HOST); param(PARAM_ACTION, ACTION_SEARCH); param(PARAM_QUERY, query); param(PARAM_DOCUMENT_TYPE_ID, documentTypeId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">documentSearch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String query, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> documentId)</span></span></span></span>{ protocol(HTTP); host(SERVER_HOST); param(PARAM_ACTION, ACTION_SEARCH); param(PARAM_QUERY, query); param(PARAM_DOCUMENT_ID, documentId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }</code> </pre><br><br>  Run the tests again - they all pass.  This suggests that we implemented exactly what was required.  Of course, to the extent that the tests were complete and accurate. <br><br><h4>  Conclusion </h4><br>  In this article, we implemented the UrlBuilder class and its ServerUrlBuilder derived from it using the TDD methodology.  All development stages were shown: problem detection, analysis, test writing, and finally implementation.  Of course, much more needs to be improved.  For example, you can add the transfer of arrays as parameters, UrlEncode for special characters.  It would be great to build not only a String, but also a URI and Uri.  But this is a separate conversation, beyond the scope of this article. </div><p>Source: <a href="https://habr.com/ru/post/130574/">https://habr.com/ru/post/130574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130567/index.html">MS SQL 2008, margin notes. A lot of random numbers</a></li>
<li><a href="../130569/index.html">How to build an entry-level home media system? Choosing a TV, player, audio</a></li>
<li><a href="../130570/index.html">GitLab: open source version of Github</a></li>
<li><a href="../130572/index.html">Point-rating technology assessment of knowledge</a></li>
<li><a href="../130573/index.html">Free VMware vSphere Storage Appliance replacement based on DRBD</a></li>
<li><a href="../130577/index.html">CAP-theorem simple, accessible language</a></li>
<li><a href="../130578/index.html">FPGA. The first steps</a></li>
<li><a href="../130579/index.html">5th meeting of the DEFCON-Russia group</a></li>
<li><a href="../130580/index.html">Bare Metal Deployment - how to look at one of the most interesting innovations of System Center Virtual Machine Manager 2012 RC closer</a></li>
<li><a href="../130581/index.html">Recirculating Neural Networks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>