<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Updating strings on the fly in mobile apps: part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 I will begin my article with a confession: I envy people whose native language is English a little. In the modern world, it has become ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Updating strings on the fly in mobile apps: part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/wv/ry/qx/wvryqxbyer9hz4qyifajpaacruc.png"><br><br><h2>  Introduction </h2><br>  I will begin my article with a confession: I envy people whose native language is English a little.  In the modern world, it has become the language of international communication, the unspoken standard.  Almost any popular application supports English.  English-speaking people hardly ever downloaded the long-awaited game from the App Store and were disappointed that it did not support their native language. <br><br>  Games and applications are more pleasant and easier to use in your native language, and for some people it is generally the only one available.  That is why companies operating in the international market translate their applications into common languages. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This article is for those developers who have already thought about localizing their application, made the first steps in this direction, and stepped on their first rake.  In today's article, I will briefly describe the approaches to localizing applications, I‚Äôll dwell more on localization on the client side, talk about the shortcomings of this approach, and suggest a way to get around them.  And in the next part, my colleagues will talk in more detail about the details of the implementation of our approach in mobile OS. <br><br>  We already wrote about web application localization <a href="https://habrahabr.ru/company/badoo/blog/317484/">here</a> . <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/rj/ix/xf/rjixxfsijepgkltilipy8jrwdeu.png" align="right" width="800"><br><br>  <i>Badoo Language Screen</i> <br><br><h2>  Localization methods </h2><br>  Mobile applications can be divided into three groups from the point of view of the approach to storing the lines to be translated: <br><br><ul><li>  all lines come from the server; </li><li>  all strings are stored in the application itself; </li><li>  part of the lines is stored in the application, part - comes from the server. </li></ul><br>  Applications that we develop in Badoo belong to the third group, but the approaches discussed in the article can be successfully applied to the second group, provided that the application still has a server part.  Therefore, I will devote the article to just such applications. <br><br>  Popular mobile operating systems have built-in tools for localizing applications.  For example, in Android, you can create a resource file with strings for each of the supported languages, and the OS will automatically select values ‚Äã‚Äãfor strings first from the file corresponding to the current locale, and only if there is no such value (or not the file itself) will it roll back to default file: <br><br><pre><code class="php hljs">res/values-en-rGB/strings.xml ‚Üí res/values-en/strings.xml ‚Üí res/values/strings.xml</code> </pre> <br>  <i>Ô∏è Later in the article I will illustrate what was said with examples for Android, although a similar scheme is used in iOS.</i> <br><br>  This method is used in many applications due to its simplicity and convenience.  But what is convenient for developers is not always convenient for copywriters and translators.  It‚Äôs hard to imagine a translator who commits translation changes directly to Git.  Therefore, many companies (including, of course, ours) invent their own <s>bicycles</s> to simplify the lives of translators. <br><br><h2>  Advanced localization </h2><br><img src="https://habrastorage.org/webt/md/7t/uu/md7tuulmyk7xeylujq0co7bp6pu.png"><br>  <i>Screenshot from our translation management system</i> <br><br>  Let's think about what we would like from such a system. <br><br><ul><li>  <b>Developers can conveniently add new lines to the system during the development of features.</b> <br><br>  There are two possible approaches: either the developer adds lines to the resource file (that is, directly into the source code), and the system automatically pulls the file to itself and adds the created lines to its database, or vice versa: the developer adds lines to the system database via a user-friendly interface , and the system then generates resource files for the application and adds them to the source code. <img src="https://habrastorage.org/webt/aa/kp/8m/aakp8mtbkh9qy3fg2r3aw482ah4.png"></li><li>  <b>Translators in the system see the added lines and can translate them into various languages.</b> <br><br>  It is desirable that translators understand the context in which the phrase is used.  The best option is a screenshot of the application screen on which this phrase appears. </li><li>  <b>The system is able to work with substitutions, as well as with strings that depend on gender and numbers (‚ÄúYou have 1 friend‚Äù vs ‚ÄúYou have 15 friends‚Äù).</b> </li><li>  <b>Translated strings enter the application during the build process.</b> <br><br>  Resource files with strings are automatically generated from the finished translations, one for each language <code>(res/values-en-rXX/strings.xml)</code> , as well as a default resource file <code>(res/values/strings.xml)</code> - there are strings in it , not translated into any languages, in the form in which the developer added them. </li><li>  <b>By the time of release, features are already ready to translate at least into the main languages.</b> <br><br>  This is achieved by parallelizing the work of translators and developers.  Additional translations can be added in future releases. </li></ul><br>  <i>More details about our translation system can be found <a href="https://habrahabr.ru/company/badoo/blog/223767/">here</a> and <a href="https://habrahabr.ru/company/badoo/blog/338814/">here</a> .</i> <br><br><h2>  Life after release </h2><br>  The lines included in the application code have a significant disadvantage: in order to update them, you have to release a new version of the application.  Given that sometimes the process of approving a new version may take a week ( <a href="https://habrahabr.ru/company/badoo/blog/338760/">hello, Apple!</a> ), This is not always the right option. <br><br>  Therefore, the product team needs a way to change the text in the application, without waiting for the release.  For example, before Valentine's Day, we changed the text in countries celebrating this day from ‚ÄúLooking for: dates‚Äù to ‚ÄúLooking for: Valentine's dates‚Äù. <br><br>  In addition, there are many other situations when emergency updates of translations may be needed.  It happens that the translated phrase turns out to be too long and does not fit in the space allotted to it, because of which the interface is leaving or the phrase is cut off.  Sometimes it happens that translators misunderstand the context of the phrase, and the translated phrase looks out of place.  Or, say, in some country, a new law regulating payments is issued, and you have to change the text on the payment page. <br><br><img src="https://habrastorage.org/webt/1w/jk/rz/1wjkrztige8qybdpetxjpz_mzhi.png" align="right" width="220">  Well, it doesn‚Äôt do without curiosities: in one of our partner projects in the process of redesign, the font size for the notification window for a new contact was greatly increased, but they did not have time to update the translation.  The French word Connexion (Connection) above the image of the new contact was clipped to Con.  Those interested can search for the translation and present what the reaction of the French users was. <br><br>  Of course, this kind of lining requires immediate intervention, and you cannot wait a week before the release of the release. <br><br>  Applications that receive all the lines from the server instead of using local resources do not have such a problem, but it does not always make sense to drive kilobytes of text through the Network every time the application is used, especially if this text rarely changes.  In addition, there are applications that need to be able to work without connecting to the Web (for example, many applications include such games). <br><br><h2>  "Hot" update translations </h2><br>  Of course, the idea immediately came up with the idea of ‚Äã‚Äãcombining approaches: use local translations stored in the application itself, but be able to update them in the background when there is an Internet connection. <br><br>  If you already have a translation system similar to the one I described above, then with minor modifications it can also solve this problem.  Here are the changes you need: <br><br><ul><li>  <b>The status of transfers at any time should be described by a certain version.</b> <br>  Each translation change should increase the version (added a new line to version 25 - we believe that we now have version 26; we translated the line into Portuguese - we increase the version to 27; and so on).  This is similar to the version control system behavior: translation changes are commits.  In practice, you can build a translation system on top of the version control system and get the described functionality out of the box. </li><li>  <b>Ability to mark versions as ‚Äúready for release in production‚Äù.</b> <br>  This is not a prerequisite, but very useful.  For example, imagine that we decided to rename the heroine in the game: make Anna from Anna.  Obviously, you need to change all the lines where the name occurs, and only after that give the new version of the translation to the release, otherwise it may happen that some application will receive a non-consistent version of the translation, where Anna meets in half of the plot, and Elena in the other half .  This can be avoided by making changes to the common database not atomically, but in large chunks, but then the problem of change conflicts arises if there are several translators (and this usually happens).  On the other hand, the version control system can be useful here. </li><li>  <b>The ability of the system to generate diff between two versions of translations.</b> <br>  Diffs can be large, and their generation can take a lot of time, so it would be nice to make a line of generating diffs and store ready diffs somewhere instead of counting them on the fly every time. </li></ul><br>  The mobile application must know the version of the translations it currently possesses, and be able to transfer this version to the server at the moment when it has an active connection. <br><br><pre> <code class="javascript hljs">AppStartup { <span class="hljs-attr"><span class="hljs-attr">translation_version</span></span>: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">client_version</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, //      ... //  ,     }</span></span></code> </pre><br>  Having received the translation version from the mobile application, the server checks if the new version is available.  If a new version is available, the server checks if there is a ready diff between the two versions.  If not, then a task is created in the diff generation queue (if there is no such task in the queue, of course). <br><br>  At the moment when the diff is ready, the server notifies the application that a new version of the translations is available.  Now the application can request diff and save it locally. <br><br><img src="https://habrastorage.org/webt/y2/pn/hk/y2pnhk2hh0podz-xi50k1dosajs.png"><br>  Below is an example of how a server response might look.  It includes all the lines (we historically call them ‚Äútokens‚Äù, although this is not quite the correct use of the term), modified from the version that the application currently has. <br><br><pre> <code class="javascript hljs">Lexemes { <span class="hljs-attr"><span class="hljs-attr">server_version</span></span>: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">server_version</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, //    lexemes: [ Lexeme { //   key: "badoocredits.profile.button.topup", mode: LEXEME_MODE_SIMPLE, value: LexemeValue { text: " ", } }, Lexeme { // ,    key: "cmd.deleteselected", mode: LEXEME_MODE_NUM_DEPENDANT, value: LexemeValue { plural_forms: [ PluralForm { category: PLURAL_CATEGORY_ZERO, text: "   ", }, PluralForm { category: PLURAL_CATEGORY_ONE, text: " %d ", }, PluralForm { category: PLURAL_CATEGORY_TWO, text: " %d ", }, PluralForm { category: PLURAL_CATEGORY_MANY, text: " %d ", }, ] } } ] }</span></span></code> </pre><br>  As you can see, phrases can be simple, and may depend on the number.  In phrases depending on the number, substitutions can be used.  For number-dependent strings, we use six forms: zero, one, two, few, many, other. <br><br>  Here's how, for example, the phrase ‚ÄúN dogs, N cats‚Äù in Welsh looks like (Wales, United Kingdom): <br><br><img src="https://habrastorage.org/webt/n0/pk/ts/n0pktsnh6ityti8wdmj4nopa7p0.png"><br><br>  As you can see, all six forms are used.  Read more about it <a href="http://cldr.unicode.org/index/cldr-spec/plural-rules">here</a> . <br><br><h2>  A / B testing </h2><br>  The translation update system on the fly has another distinct advantage.  In addition to correcting translation errors and solving other problems with localization, we get the opportunity to conduct A / B testing of various translation options. <br><br><pre> <code class="javascript hljs">Lexemes { <span class="hljs-attr"><span class="hljs-attr">server_version</span></span>: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">server_version</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, //    lexemes: [ Lexeme { //   /  key: "popularity.share.title", mode: LEXEME_MODE_SIMPLE, value: LexemeValue { //  - text: " !", }, test_id: "popularity_test_android", //  id  variations: [ LexemeVariation { variation_id: "control", value: LexemeValue { text: " !", } }, LexemeVariation { variation_id: "rock", value: LexemeValue { text: " !", } }, LexemeVariation { variation_id: "cool", value: LexemeValue { text: " !", } }, ] } ] }</span></span></code> </pre> <br>  In the example above, there is the phrase ‚ÄúYou are popular!‚Äù, Which can be used, for example, as the text in a notification.  In order to increase the click rate of this notification, our product team decided to conduct an A / B test and see how the changed text will affect the percentage of clicks on the notification.  Without an update system on the fly, we would have to set the task for the developers of the application, then release a new version (another week of waiting) and then test it.  With the new system, analysts can conduct a test on their own, check the result and in all applications replace the text with the winning option. <br><br><h2>  Conclusion </h2><br>  Once again in brief: if you store translations in the application itself, you lose the ability to quickly change them.  We offer the idea of ‚Äã‚Äãupdating translations in the background, which allows you to quickly correct translation errors and test various phrases. <br><br>  If you are interested in our approach and you are already thinking about how to implement it in your application on iOS or Android, then the second part of the article, which we will publish in the near future, is for you.  In it, we will describe how to change your mobile application so that it can use the received diff, but at the same time avoid laborious and long rewriting of all places in the code where translations are used. </div><p>Source: <a href="https://habr.com/ru/post/346458/">https://habr.com/ru/post/346458/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346444/index.html">Meltdown & Specter vulnerabilities patches cause problems with downloading Ubuntu 16.04</a></li>
<li><a href="../346446/index.html">Data Modeling Zone EU 2017</a></li>
<li><a href="../346448/index.html">Financial Times: How Traders Try to Survive the HFT Trading Decline</a></li>
<li><a href="../346450/index.html">About honors on sober head</a></li>
<li><a href="../346452/index.html">Testing with JUnit 5 on Kotlin</a></li>
<li><a href="../346460/index.html">PostgreSQL Indexes - 9</a></li>
<li><a href="../346462/index.html">Startup of the day (December 2017)</a></li>
<li><a href="../346464/index.html">Fresh utilities, plugins and tools for designer and developer to note. Fifth release</a></li>
<li><a href="../346466/index.html">How to protect your IT infrastructure: 7 basic tips</a></li>
<li><a href="../346468/index.html">5 small talk technician to communicate with foreign colleagues</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>