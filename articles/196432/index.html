<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write a platformer in Python. Part 2. Part 1, preparation for creating a level editor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello friends! 

 We continue to deal with our MarioBoy. Start here , continued here . In this part of the second part we will prepare to create a lev...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write a platformer in Python. Part 2. Part 1, preparation for creating a level editor</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/5c6/ee4/99a/5c6ee499a7741735c29993558ec2a94f.png"><br>  Hello friends! <br><br>  We continue to deal with our MarioBoy.  Start <a href="http://habrahabr.ru/post/193888/">here</a> , continued <a href="http://habrahabr.ru/post/204112/">here</a> .  In this part of the second part we will prepare to create a level editor, namely: add a turbo run mode to the hero, deadly platforms, moving monsters, teleporters, a princess and a level parser so as not to be distracted by all this in the second part. <br><a name="habracut"></a><br><h4>  Hero upgrade </h4><br>  Add our hero the opportunity to accelerate.  To do this, change the code of the <b>update</b> method. <br><br>  First, add constants <br><pre><code class="python hljs">MOVE_EXTRA_SPEED = <span class="hljs-number"><span class="hljs-number">2.5</span></span> <span class="hljs-comment"><span class="hljs-comment">#  JUMP_EXTRA_POWER = 1 #    ANIMATION_SUPER_SPEED_DELAY = 0.05 #     </span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, add a motion animation left - right in accelerated mode.  We will insert the same pictures, but with a different frame rate. <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    boltAnim = [] boltAnimSuperSpeed = [] for anim in ANIMATION_RIGHT: boltAnim.append((anim, ANIMATION_DELAY)) boltAnimSuperSpeed.append((anim, ANIMATION_SUPER_SPEED_DELAY)) self.boltAnimRight = pyganim.PygAnimation(boltAnim) self.boltAnimRight.play() self.boltAnimRightSuperSpeed = pyganim.PygAnimation(boltAnimSuperSpeed) self.boltAnimRightSuperSpeed.play() #    boltAnim = [] boltAnimSuperSpeed = [] for anim in ANIMATION_LEFT: boltAnim.append((anim, ANIMATION_DELAY)) boltAnimSuperSpeed.append((anim, ANIMATION_SUPER_SPEED_DELAY)) self.boltAnimLeft = pyganim.PygAnimation(boltAnim) self.boltAnimLeft.play() self.boltAnimLeftSuperSpeed = pyganim.PygAnimation(boltAnimSuperSpeed) self.boltAnimLeftSuperSpeed.play()</span></span></code> </pre><br>  Added 2 sets of animations when accelerating <b>self.boltAnimRightSuperSpeed</b> , <b>self.boltAnimLeftSuperSpeed</b> , we will display them just below <br><br>  Now let's do the <b>update</b> method itself. <br><br>  Add an input parameter <b>running</b> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, left, right, up, running, platforms)</span></span></span><span class="hljs-function">:</span></span></code> </pre><br><br>  Modify the handling of character movements by adding behavior during acceleration. <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> up: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.onGround: <span class="hljs-comment"><span class="hljs-comment"># ,       self.yvel = -JUMP_POWER if running and (left or right): #       self.yvel -= JUMP_EXTRA_POWER #    self.image.fill(Color(COLOR)) self.boltAnimJump.blit(self.image, (0, 0)) if left: self.xvel = -MOVE_SPEED #  = x- n self.image.fill(Color(COLOR)) if running: #   self.xvel-=MOVE_EXTRA_SPEED #    if not up: #     self.boltAnimLeftSuperSpeed.blit(self.image, (0, 0)) #     else: #    if not up: #    self.boltAnimLeft.blit(self.image, (0, 0)) #    if up: #    self.boltAnimJumpLeft.blit(self.image, (0, 0)) #    if right: self.xvel = MOVE_SPEED #  = x + n self.image.fill(Color(COLOR)) if running: self.xvel+=MOVE_EXTRA_SPEED if not up: self.boltAnimRightSuperSpeed.blit(self.image, (0, 0)) else: if not up: self.boltAnimRight.blit(self.image, (0, 0)) if up: self.boltAnimJumpRight.blit(self.image, (0, 0))</span></span></code> </pre><br><br>  And in the main file, add handling of the left shift event. <br><pre> <code class="python hljs">running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> *** <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.type == KEYDOWN <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> e.key == K_LSHIFT: running = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> *** <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> e.type == KEYUP <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> e.key == K_LSHIFT: running = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre><br>  All key codes <a href="http://www.pygame.org/docs/ref/key.html">here</a> <br><br>  And don't forget to add arguments when calling the <b>hero.update ()</b> method <br><pre> <code class="python hljs">hero.update(left, right, up, running, platforms)</code> </pre><br><br>  See the results <i>(I changed the background color to black <s>, brutal color for brutal MarioBoy</s> )</i> <br>  No acceleration <br><img src="https://habrastorage.org/getpro/habr/post_images/347/aeb/945/347aeb945fc73da38375b4dd30799811.gif"><br>  Accelerated jump <br><img src="https://habrastorage.org/getpro/habr/post_images/1fb/83c/082/1fb83c08270b3c6dbf051a1293938c7d.gif"><br><br><h4>  Deadly Spikes </h4><br>  A real hero is a real danger.  Let's create a new kind of blocks, in contact with which instant death will occur. <br><br>  Create a class that inherits from Platform. <br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlockDie</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Platform)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y)</span></span></span><span class="hljs-function">:</span></span> Platform.__init__(self, x, y) self.image = image.load(<span class="hljs-string"><span class="hljs-string">"%s/blocks/dieBlock.png"</span></span> % ICON_DIR)</code> </pre><br><br>  Next, add the behavior of the hero in contact with him.  To do this, add 2 methods to the character class.  The first method is death behavior, the second is moving to the specified coordinates (which will be useful to us once again just below) <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">die</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> time.wait(<span class="hljs-number"><span class="hljs-number">500</span></span>) self.teleporting(self.startX, self.startY) <span class="hljs-comment"><span class="hljs-comment">#     def teleporting(self, goX, goY): self.rect.x = goX self.rect.y = goY</span></span></code> </pre><br>  Those.  when we die, the game stops for a while, then we move to the beginning of the level and play on. <br><br>  Well, we describe the behavior itself when crossing with the death block in the collide () method <br><pre> <code class="python hljs">*** <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(p, blocks.BlockDie): <span class="hljs-comment"><span class="hljs-comment">#    - blocks.BlockDie self.die()#  ***</span></span></code> </pre><br><br>  Now, basically the class will change the level <br><pre> <code class="python hljs">level = [ <span class="hljs-string"><span class="hljs-string">"----------------------------------"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- * -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"-- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- ---- --- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"-- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- * -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- --- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- * --- * -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- ------- ---- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- - -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- *** -"</span></span>, <span class="hljs-string"><span class="hljs-string">"- -"</span></span>, <span class="hljs-string"><span class="hljs-string">"----------------------------------"</span></span>]</code> </pre><br><br>  And add the creation of a block of death, if the level has a symbol "*" <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> col == <span class="hljs-string"><span class="hljs-string">"*"</span></span>: bd = BlockDie(x,y) entities.add(bd) platforms.append(bd)</code> </pre><br>  Result: <br><img src="https://habrastorage.org/getpro/habr/post_images/a1d/1df/25f/a1d1df25fb2d6553a0e1f96501ff6deb.gif"><br><br><h4>  Portals </h4><br>  What modern plumber does without teleport?  So let's not make our hero a black sheep. <br><br>  Create a new block type.  We work in the <b>blocks.py</b> file <br><br>  First add constants. <br><pre> <code class="python hljs">ANIMATION_BLOCKTELEPORT = [ (<span class="hljs-string"><span class="hljs-string">'%s/blocks/portal2.png'</span></span> % ICON_DIR), (<span class="hljs-string"><span class="hljs-string">'%s/blocks/portal1.png'</span></span> % ICON_DIR)]</code> </pre><br>  Then create a new class. <br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlockTeleport</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Platform)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, x, y, goX,goY)</span></span></span><span class="hljs-function">:</span></span> Platform.__init__(self, x, y) self.goX = goX <span class="hljs-comment"><span class="hljs-comment">#    self.goY = goY #    boltAnim = [] for anim in ANIMATION_BLOCKTELEPORT: boltAnim.append((anim, 0.3)) self.boltAnim = pyganim.PygAnimation(boltAnim) self.boltAnim.play() def update(self): self.image.fill(Color(PLATFORM_COLOR)) self.boltAnim.blit(self.image, (0, 0))</span></span></code> </pre><br>  There is nothing new here.  When creating, not only the coordinates of the location of the portal are specified, but also the coordinates of the hero‚Äôs movement when it hits the teleporter. <br><br>  Next, we add to our hero's behavior in contact with the portal <br><pre> <code class="python hljs">*** <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(p, blocks.BlockTeleport): self.teleporting(p.goX, p.goY) ***</code> </pre><br>  And add one portal to the map.  Only now we will describe the coordinates manually.  When we make the level editor it will be easier. <br>  Add another group of sprites, which will contain animated blocks <br><pre> <code class="python hljs">animatedEntities = pygame.sprite.Group() <span class="hljs-comment"><span class="hljs-comment">#   ,   </span></span></code> </pre><br>  And create a teleporter. <br><pre> <code class="python hljs">tp = BlockTeleport(<span class="hljs-number"><span class="hljs-number">128</span></span>,<span class="hljs-number"><span class="hljs-number">512</span></span>,<span class="hljs-number"><span class="hljs-number">800</span></span>,<span class="hljs-number"><span class="hljs-number">64</span></span>) entities.add(tp) platforms.append(tp) animatedEntities.add(tp)</code> </pre><br>  Finally, add a call to the <b>update ()</b> method on all animated sprites. <br><pre> <code class="python hljs">animatedEntities.update() <span class="hljs-comment"><span class="hljs-comment">#  </span></span></code> </pre><br><br>  Something like this <br><img src="https://habrastorage.org/getpro/habr/post_images/1c4/68f/d27/1c468fd27a2704f9d21391d0aa2f64fa.gif"><br><br><h4>  Monsters </h4><br>  Scary, moving, deadly <i>lights.</i> <br><br>  The difference between monsters and deadly blocks is that monsters can move. <br><br>  Let's start. <br><br>  We will work in the new file, so as not to get confused.  Let's call it very original - <b>monsters.py</b> <br><br>  Create a new class <b>Monster</b> .  There is nothing in it that we have not used before. <br>  Whole file content <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python # -*- coding: utf-8 -*- from pygame import * import pyganim import os MONSTER_WIDTH = 32 MONSTER_HEIGHT = 32 MONSTER_COLOR = "#2110FF" ICON_DIR = os.path.dirname(__file__) #       ANIMATION_MONSTERHORYSONTAL = [('%s/monsters/fire1.png' % ICON_DIR), ('%s/monsters/fire2.png' % ICON_DIR )] class Monster(sprite.Sprite): def __init__(self, x, y, left, up, maxLengthLeft,maxLengthUp): sprite.Sprite.__init__(self) self.image = Surface((MONSTER_WIDTH, MONSTER_HEIGHT)) self.image.fill(Color(MONSTER_COLOR)) self.rect = Rect(x, y, MONSTER_WIDTH, MONSTER_HEIGHT) self.image.set_colorkey(Color(MONSTER_COLOR)) self.startX = x #   self.startY = y self.maxLengthLeft = maxLengthLeft #  ,       self.maxLengthUp= maxLengthUp #  ,      ,  self.xvel = left # c   , 0 -    self.yvel = up #    , 0 -   boltAnim = [] for anim in ANIMATION_MONSTERHORYSONTAL: boltAnim.append((anim, 0.3)) self.boltAnim = pyganim.PygAnimation(boltAnim) self.boltAnim.play() def update(self, platforms): #    self.image.fill(Color(MONSTER_COLOR)) self.boltAnim.blit(self.image, (0, 0)) self.rect.y += self.yvel self.rect.x += self.xvel self.collide(platforms) if (abs(self.startX - self.rect.x) &gt; self.maxLengthLeft): self.xvel =-self.xvel #    ,      if (abs(self.startY - self.rect.y) &gt; self.maxLengthUp): self.yvel = -self.yvel #    ,     ,  def collide(self, platforms): for p in platforms: if sprite.collide_rect(self, p) and self != p: #   -  -  self.xvel = - self.xvel #      self.yvel = - self.yvel</span></span></code> </pre><br>  When creating a monster, you need to specify 6 arguments: <b>x</b> , <b>y</b> - coordinates, <b>left</b> - horizontal movement speed, <b>up</b> - vertical movement speed, <b>maxLengthLeft</b> - maximum distance to one side that the monster can go, <b>maxLengthUp</b> - similar to the previous one, but vertical. <br><br>  Now add the death of the hero from contact with fire. <br><br>  Replace strings <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(p, blocks.BlockDie): <span class="hljs-comment"><span class="hljs-comment">#    - blocks.BlockDie self.die()# </span></span></code> </pre><br>  On <br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(p, blocks.BlockDie) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> isinstance(p, monsters.Monster): <span class="hljs-comment"><span class="hljs-comment">#   - blocks.BlockDie  Monster self.die()# </span></span></code> </pre><br>  And do not forget to add import from the file <b>monsters.py</b> <br><br>  And, of course, add the creation of a monster in the main file. <br><br>  Create another group of sprites, which will put our monsters. <br><pre> <code class="python hljs">monsters = pygame.sprite.Group() <span class="hljs-comment"><span class="hljs-comment">#   </span></span></code> </pre><br>  Question: <i>Why do we need another group?</i>  <i>Why did not have the previous one?</i>  <i>After all, in the group of <b>animatedEntities</b> sprites we call the <b>update</b></i> () <i>method.</i> <br>  Answer: In the previous group, we call the <b>update ()</b> method with no arguments, and in the <b>monsters</b> group, this method will be called with an argument. <br><br>  Create the monster itself. <br><pre> <code class="python hljs">mn = Monster(<span class="hljs-number"><span class="hljs-number">190</span></span>,<span class="hljs-number"><span class="hljs-number">200</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">150</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>) entities.add(mn) platforms.append(mn) monsters.add(mn)</code> </pre><br>  And move it <br><pre> <code class="python hljs">monsters.update(platforms) <span class="hljs-comment"><span class="hljs-comment">#   </span></span></code> </pre><br>  We look at the result. <br><img src="https://habrastorage.org/getpro/habr/post_images/c5b/fab/ab9/c5bfabab939eaa95e3156f53941fa924.gif"><br><br><h4>  Princess </h4><br>  It is a matter of honor for any plumber to save the princess. <br><br>  The princess class does not contain anything interesting for us, so I will not show the code.  Who will be interested - look in the <b>blocks.py</b> file <br><br>  Our character will add the property <b>winner</b> , by which we will judge that it is time to complete the level. <br><pre> <code class="python hljs">self.winner = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span></code> </pre><br>  And make changes to the <b>collide ()</b> method <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(p, blocks.Princess): <span class="hljs-comment"><span class="hljs-comment">#    self.winner = True # !!!</span></span></code> </pre><br><br>  And further, we will write the code for creating a princess <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> col == <span class="hljs-string"><span class="hljs-string">"P"</span></span>: pr = Princess(x,y) entities.add(pr) platforms.append(pr) animatedEntities.add(pr)</code> </pre><br><br>  Do not forget to insert the symbol "P" in the level. <br><br>  We look <br><img src="https://habrastorage.org/getpro/habr/post_images/4b7/ee4/f4a/4b7ee4f4a9259fcc5fa0550a0a506e2a.gif"><br><br><h4>  Level </h4><br>  Finally we got to the parsing level.  We will keep them in the <b>levels</b> catalog.  I give an example of the level from the file <b>1.txt</b> <br><pre> <code class="css hljs"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[ ----------------------------------| - * -| - * *P -| ---- *--** --| - -- -| - -| - -| - -| -- ---- | - -| -- -| - ** -| - --- -| - -| - -| - --- -| - -| - -------- * ---- -| - -| - - -| - ** -- -| - * -| - ** -| --------------- *** -- -| - -| - -| ----------------------------------| ]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">player</span></span> 55 44 <span class="hljs-selector-tag"><span class="hljs-selector-tag">portal</span></span> 128 512 900 35 <span class="hljs-selector-tag"><span class="hljs-selector-tag">portal</span></span> 170 512 700 64 <span class="hljs-selector-tag"><span class="hljs-selector-tag">monster</span></span> 190 250 2 1 150 10 <span class="hljs-selector-tag"><span class="hljs-selector-tag">monster</span></span> 190 400 2 3 150 150 <span class="hljs-selector-tag"><span class="hljs-selector-tag">monster</span></span> 150 200 1 2 150 100 /</code> </pre><br><br>  What do we see here?  Neither of which is not considered in this post (including the first part).  First, generate static platforms using the characters <b>"[", "-", "*", "]", "|"</b> <br>  Where <b>"["</b> - shows the parser to the beginning of the level <br>  <b>"]"</b> - respectively, end of level <br>  <b>"|"</b>  - end of line <br>  <b>"-"</b> is a common platform <br>  <b>"*"</b> - studded platform <br><br>  Then, in the line <b>"player 55 44"</b> we indicate the initial coordinates of our hero <br>  <b>"Portal 128 512 900 35"</b> - the first two numbers - the coordinates of the portal, the second - the coordinates of the movement <br>  <b>"Monster 150 200 1 2 150 100"</b> - the first two numbers, similarly, the coordinates of the monster, then the second two - the horizontal and vertical speed, and the last - the maximum distance in one direction horizontally and vertically. <br>  As you have already noticed, there can be as many portals and monsters as you like. <br>  The symbol <b>"/"</b> means the end of the file.  All data after it will not be read. <br><br>  Now, let's write the parser itself. <br>  We work in the main file. <br><br>  To begin, transfer all arrays and groups from the main () function to the body of the main program. <br><pre> <code class="python hljs">*** level = [] entities = pygame.sprite.Group() <span class="hljs-comment"><span class="hljs-comment">#   animatedEntities = pygame.sprite.Group() #   ,    monsters = pygame.sprite.Group() #    platforms = [] # ,        if __name__ == "__main__": main()</span></span></code> </pre><br>  Then, remove the level, the variable should be empty.  Also, delete the creation of monsters and portals. <br><br>  And add a new feature <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadLevel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> playerX, playerY <span class="hljs-comment"><span class="hljs-comment">#   ,    levelFile = open('%s/levels/1.txt' % FILE_DIR) line = " " commands = [] while line[0] != "/": #       line = levelFile.readline() #  if line[0] == "[": #      while line[0] != "]": # ,       line = levelFile.readline() #    if line[0] != "]": #       endLine = line.find("|") #      level.append(line[0: endLine]) #          "|" if line[0] != "": #     commands = line.split() #      if len(commands) &gt; 1: #    &gt; 1,     if commands[0] == "player": #    - player playerX= int(commands[1]) #     playerY = int(commands[2]) if commands[0] == "portal": #    portal,    tp = BlockTeleport(int(commands[1]),int(commands[2]),int(commands[3]),int(commands[4])) entities.add(tp) platforms.append(tp) animatedEntities.add(tp) if commands[0] == "monster": #    monster,    mn = Monster(int(commands[1]),int(commands[2]),int(commands[3]),int(commands[4]),int(commands[5]),int(commands[6])) entities.add(mn) platforms.append(mn) monsters.add(mn)</span></span></code> </pre><br>  Do not forget to call this function and specify the variables <b>startX</b> and <b>startY</b> as starting coordinates for our hero. <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> loadLevel() *** hero = Player(playerX,playerY) <span class="hljs-comment"><span class="hljs-comment">#    (x,y)  ***</span></span></code> </pre><br><br>  <a href="">Download the result</a> . <br><br>  Now it‚Äôs not very interesting to edit the level file with your hands, therefore, in the next part we will write the level editor itself. <br>  <b>PS</b> Level created above, quite passable, go for it. </div><p>Source: <a href="https://habr.com/ru/post/196432/">https://habr.com/ru/post/196432/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196418/index.html">CodeNotes - Clojure Cup 2013 winner</a></li>
<li><a href="../196420/index.html">Oracle DBMS data clustering outside the cluster table</a></li>
<li><a href="../196422/index.html">The Large Hadron Collider with my own eyes. Part 2</a></li>
<li><a href="../196424/index.html">Four-legged robot WildCat on an autonomous engine runs at a gallop</a></li>
<li><a href="../196426/index.html">A passion for programming. How I refused the $ 300,000 Microsoft offered me in exchange for a full-time job on GitHub</a></li>
<li><a href="../196436/index.html">What do advertising specialists say about new domain zones?</a></li>
<li><a href="../196442/index.html">In search of cryptographic GPSN</a></li>
<li><a href="../196444/index.html">Hardware virtualization. Theory, reality and support in processor architectures</a></li>
<li><a href="../196448/index.html">Derek Sivers: "The method of interval repetition is the best way to learn programming languages"</a></li>
<li><a href="../196450/index.html">Intelligent traffic lights save motorists time and money</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>