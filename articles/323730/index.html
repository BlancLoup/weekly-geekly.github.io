<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Predicting the future with the Facebook Prophet library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Forecasting time series is quite a popular analytical task. Forecasts are used, for example, to understand how many servers an online service will nee...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Predicting the future with the Facebook Prophet library</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/812/803/40b/81280340b5c74e018e764a4dbea13f42.jpeg" align="right">  Forecasting time series is quite a popular analytical task.  Forecasts are used, for example, to understand how many servers an online service will need in a year, what will be the demand for each product in a hypermarket, or for setting goals and evaluating team work (for this you can build a baseline forecast and compare the actual value with the predicted one). </p><br><p>  There are many different approaches for predicting time series, such as <a href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average">ARIMA</a> , <a href="https://en.wikipedia.org/wiki/Autoregressive_conditional_heteroskedasticity">ARCH</a> , regression models, neural networks, etc. </p><br><p> Today we will get acquainted with the library for predicting the time series of <code>Facebook Prophet</code> ( <em>translated from English, "prophet", <a href="https://research.fb.com/prophet-forecasting-at-scale/">released in open-source</a> on February 23, 2017</em> ), and also try in the task of life - predicting the number of posts on Habrehabr. </p><br><a name="habracut"></a><br><h2 id="biblioteka">  Library </h2><br><p>  According <a href="https://research.fb.com/prophet-forecasting-at-scale/">to the Facebook</a> <code>Prophet</code> <a href="https://research.fb.com/prophet-forecasting-at-scale/">article</a> , it was designed to predict a large number of different business indicators and builds fairly good default forecasts.  In addition, the library makes it possible, by changing the human-readable parameters, to improve the forecast and does not require deep knowledge of the device from the analysts of the predictive models. </p><br><p>  Let's discuss a little how the <code>Prophet</code> library works.  In essence, this is an <a href="https://en.wikipedia.org/wiki/Additive_model">additive regression model</a> consisting of the following components: </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font></span><span class="MJXp-mo" id="MJXp-Span-3" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mo" id="MJXp-Span-5" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g </font></font></span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-9"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="MJXp-mo" id="MJXp-Span-11" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mo" id="MJXp-Span-13" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mo" id="MJXp-Span-15" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mo" id="MJXp-Span-20" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="MJXp-mo" id="MJXp-Span-21" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-23"><font style="vertical-align: inherit;">e </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24"><font style="vertical-align: inherit;">p </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25"><font style="vertical-align: inherit;">s </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26"><font style="vertical-align: inherit;">i </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27"><font style="vertical-align: inherit;">l </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28"><font style="vertical-align: inherit;">o </font></span><span class="MJXp-msubsup" id="MJXp-Span-29"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">n </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-29"><span class="MJXp-mrow MJXp-script" id="MJXp-Span-31" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32"><font style="vertical-align: inherit;">t</font></span></span></span></font><span class="MJXp-mtext" id="MJXp-Span-22">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-23"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-29"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-31" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32"><font style="vertical-align: inherit;"></font></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="35.684ex" height="2.66ex" viewBox="0 -832 15364 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-79" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-28" x="497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-74" x="887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-29" x="1248" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-3D" x="1915" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-67" x="2972" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-28" x="3452" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-74" x="3842" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-29" x="4203" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-2B" x="4815" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-73" x="5816" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-28" x="6285" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-74" x="6675" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-29" x="7036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-2B" x="7648" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-68" x="8648" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-28" x="9225" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-74" x="9614" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-29" x="9976" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-2B" x="10588" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-65" x="11838" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-70" x="12305" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-73" x="12808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-69" x="13278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-6C" x="13623" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-6F" x="13922" y="0"></use><g transform="translate(14407,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-74" x="849" y="-213"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> y (t) = g (t) + s (t) + h (t) + \ epsilon_ {t} </script></p><br><ol><li>  <strong>Seasonal ingredients</strong> <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-33"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mo" id="MJXp-Span-35" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mo" id="MJXp-Span-37" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.739ex" height="2.66ex" viewBox="0 -832 1610 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-73" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-28" x="469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-74" x="859" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-29" x="1220" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> s (t) </script>  responsible for modeling periodic changes associated with weekly and annual seasonality.  Weekly seasonality is modeled using <code>dummy variables</code> .  6 additional attributes are added, for example, <code>[monday, tuesday, wednesday, thursday, friday, saturday]</code> , which take the values ‚Äã‚Äã0 and 1 depending on the date.  The sign of <code>sunday</code> , corresponding to the seventh day of the week, is not added, because it will linearly depend on other days of the week and this will affect the model. <br>  The annual seasonality is modeled by Fourier series. </li><li>  <strong>Trend</strong> <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-38"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g </font></font></span><span class="MJXp-mo" id="MJXp-Span-40" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mo" id="MJXp-Span-42" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.765ex" height="2.66ex" viewBox="0 -832 1621 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-67" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-28" x="480" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-74" x="870" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-29" x="1231" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> g (t) </script>  Is a piecewise linear or logistic function.  With linear function everything is clear.  Logistic function of the form <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-43"><span class="noError" id="MJXp-Span-44" style="display: inline-block;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g (t) = \ frac {C} {1 + exp (-k (tb))</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><span class="noError" style="display: inline-block;">g&nbsp;(t)&nbsp;=&nbsp;\&nbsp;frac&nbsp;{C}&nbsp;{1&nbsp;+&nbsp;exp&nbsp;(-k&nbsp;(t-b))</span></span><script type="math/tex" id="MathJax-Element-4"> g (t) = \ frac {C} {1 + exp (-k (t-b)) </script>  allows you to simulate growth with saturation, when with an increase in the rate of its growth decreases.  A typical example is the growth of an application or site audience. <br>  Among other things, the library is able to choose the optimal points of trend change based on historical data.  But they can also be set manually (for example, if you know the release dates of the new functionality, which greatly influenced the key indicators). </li><li>  Component <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-45"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mo" id="MJXp-Span-47" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mo" id="MJXp-Span-49" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.988ex" height="2.66ex" viewBox="0 -832 1717 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-68" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-28" x="576" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-74" x="966" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMAIN-29" x="1327" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> h (t) </script>  responsible for user-defined <strong>anomalous days</strong> , including irregular <strong>days</strong> , such as, for example, Black Fridays. </li><li>  <strong>Mistake</strong> <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-50"><span class="MJXp-mtext" id="MJXp-Span-51">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-55"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-58"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-60" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.768ex" height="2.419ex" viewBox="0 -780.1 3775.1 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-65" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-70" x="716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-73" x="1220" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-69" x="1689" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-6C" x="2035" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-6F" x="2333" y="0"></use><g transform="translate(2819,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-74" x="849" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-6"> \ epsilon_ {t} </script>  contains information that is not considered by the model. </li></ol><br><p>  More information about the algorithms can be found in the publication <em>Sean J. Taylor, Benjamin Letham <a href="https://facebookincubator.github.io/prophet/static/prophet_paper_20170113.pdf">"Forecasting at scale"</a></em> . </p><br><p>  This publication also presents a comparison of <code>mean absolute percentage error</code> for various methods of automatic time series prediction, according to which <code>Prophet</code> has a significantly lower error. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/491/363/dfa/491363dfa9da400686ce13018a167b7f.png"></div><br><p>  Let's first look at how the quality of the models is assessed in the article, and then proceed to the algorithms with which <code>Prophet</code> compared. </p><br><p>  <code>MAPE (mean absolute percentage error)</code> is the average absolute error of our prediction.  Let be <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-62"><span class="MJXp-msubsup" id="MJXp-Span-63"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-65" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-66"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.939ex" height="1.817ex" viewBox="0 -520.7 834.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/323730/&amp;xid=17259,15700002,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTYIs4DZDJ1cXl7quwY8onQT0xQQ#MJMATHI-69" x="693" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> y_ {i} </script>  - is an indicator, and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-67"><span class="MJXp-mtext" id="MJXp-Span-68">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mrow" id="MJXp-Span-72"><span class="MJXp-msubsup" id="MJXp-Span-73"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-75" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-8"> \ hat {y_ {i}} </script>  - this is the corresponding forecast of our model.  Then <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-77"><span class="MJXp-msubsup" id="MJXp-Span-78"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-79" style="margin-right: 0.05em;">e</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-80" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-82" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-83"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-85" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-87" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-88">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91">t</span><span class="MJXp-mrow" id="MJXp-Span-92"><span class="MJXp-msubsup" id="MJXp-Span-93"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-95" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">i</span></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9"> e_ {i} = y_ {i} - \ hat {y_ {i}} </script>  - this is a forecast error, a <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-97"><span class="MJXp-msubsup" id="MJXp-Span-98"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-100" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-101">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-102" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-103">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-105">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107">c</span><span class="MJXp-mrow" id="MJXp-Span-108"><span class="MJXp-msubsup" id="MJXp-Span-109"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-110" style="margin-right: 0.05em;">e</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-111" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-112">i</span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-113"><span class="MJXp-msubsup" id="MJXp-Span-114"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-116" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">i</span></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> p_ {i} = \ frac {e_ {i}} {y_ {i}} </script>  - This is a relative forecast error. </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-118"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">M</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">P</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">E</span><span class="MJXp-mo" id="MJXp-Span-123" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-124">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">n</span><span class="MJXp-mo" id="MJXp-Span-128" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-129"><span class="MJXp-mo" id="MJXp-Span-130" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-131"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-133" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-135"><span class="MJXp-mo" id="MJXp-Span-136" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mo" id="MJXp-Span-137" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-11"> MAPE = mean (| p_ {i} |) </script></p><br><p>  <code>MAPE</code> often used to assess quality, since this value is relative and it is possible to compare quality even across different data sets. </p><br><p>  In addition, it is useful to look at the absolute error <code>MAE - mean absolute error</code> , in order to understand how much the model is mistaken in absolute terms. </p><br><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-138"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139">M</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">E</span><span class="MJXp-mo" id="MJXp-Span-142" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-144">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-145">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">n</span><span class="MJXp-mo" id="MJXp-Span-147" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mrow" id="MJXp-Span-148"><span class="MJXp-mo" id="MJXp-Span-149" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-msubsup" id="MJXp-Span-150"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151" style="margin-right: 0.05em;">e</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-152" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">i</span></span></span><span class="MJXp-mrow" id="MJXp-Span-154"><span class="MJXp-mo" id="MJXp-Span-155" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mo" id="MJXp-Span-156" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-12"> MAE = mean (| e_ {i} |) </script></p><br><p>  It is worth saying a few words about the algorithms with which <code>Prophet</code> compared in the publication, especially since most of them are very simple and are often used as a baseline: </p><br><ul><li>  <code>naive</code> is a naive forecast, when we forecast all subsequent values ‚Äã‚Äãby the last point; </li><li>  <code>snaive - seasonal naive</code> - this forecast is suitable for data with a pronounced seasonality.  For example, if we are talking about indicators with weekly seasonality, then for each subsequent Monday we will take the value for the last Monday, for Tuesday - for the last Tuesday, and so on; </li><li>  <code>mean</code> - the average value of the indicator is taken as a forecast; </li><li>  <code>arima - autoregressive integrated moving average</code> - details on the <a href="https://en.wikipedia.org/wiki/Autoregressive_integrated_moving_average">wiki</a> ; </li><li>  <code>ets - exponential smoothing</code> - details on the <a href="https://en.wikipedia.org/wiki/Exponential_smoothing">wiki</a> . </li></ul><br><h2 id="praktika">  Practice </h2><br><h3 id="ustanovka">  Installation </h3><br><p>  First you need to install the library.  The <code>Prophet</code> library is available for <code>python</code> and <code>R</code>  I prefer <code>python</code> , so I used it.  For <code>python</code> library is <code>PyPi</code> using <code>PyPi</code> as follows: </p><br><pre> <code class="bash hljs">pip install fbprophet</code> </pre> <br><p>  Under <code>R</code> , the library has a <code>CRAN package</code> .  Detailed installation instructions can be found in the <a href="https://facebookincubator.github.io/prophet/docs/installation.html">documentation</a> . </p><br><h3 id="dannye">  Data </h3><br><p>  As an indicator for prediction, I chose the number of posts published in Habrahabr.  I took the data from the educational competition on Kaggle <a href="https://inclass.kaggle.com/c/howpop-habrahabr-favs-lognorm">"Forecast of the popularity of an article on Habr√©"</a> .  <a href="https://habrahabr.ru/company/ods/blog/323890/">It</a> tells more about the competition and <a href="https://habrahabr.ru/company/ods/blog/322626/">the</a> machine learning course in which it is held. </p><br><div class="spoiler">  <b class="spoiler_title">Preprocessing Code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd habr_df = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'howpop_train.csv'</span></span>) habr_df[<span class="hljs-string"><span class="hljs-string">'published'</span></span>] = pd.to_datetime(habr_df.published) habr_df = habr_df[[<span class="hljs-string"><span class="hljs-string">'published'</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span>]] aggr_habr_df = habr_df.groupby(<span class="hljs-string"><span class="hljs-string">'published'</span></span>)[[<span class="hljs-string"><span class="hljs-string">'url'</span></span>]].count() aggr_habr_df.columns = [<span class="hljs-string"><span class="hljs-string">'posts'</span></span>] aggr_habr_df = aggr_habr_df.resample(<span class="hljs-string"><span class="hljs-string">'D'</span></span>).apply(sum)</code> </pre> </div></div><br><p>  First, let's look at the data and build a <code>time series plot</code> for the entire period.  On such a long period it is more convenient to look at the weekly points. </p><br><p>  For visualization, as usual, I will use the <code>plot.ly</code> library, which allows you to build interactive graphics in <code>python</code> .  You can read more about it and visualization in general in the article <a href="https://habrahabr.ru/company/ods/blog/323210/">Open Machine Learning Course.</a>  <a href="https://habrahabr.ru/company/ods/blog/323210/">Topic 2: Data Visualization with Python</a> . </p><br><div class="spoiler">  <b class="spoiler_title">Code for visualization</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> plotly.offline <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> download_plotlyjs, init_notebook_mode, plot, iplot <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> plotly <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> graph_objs <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> go <span class="hljs-comment"><span class="hljs-comment">#  plotly init_notebook_mode(connected = True) #  ,      dataframe   line plot def plotly_df(df, title = ''): data = [] for column in df.columns: trace = go.Scatter( x = df.index, y = df[column], mode = 'lines', name = column ) data.append(trace) layout = dict(title = title) fig = dict(data = data, layout = layout) iplot(fig, show_link=False) plotly_df(aggr_habr_df.resample('W').apply(sum), title = '   ')</span></span></code> </pre> </div></div><br><img src="https://habrastorage.org/files/cba/53b/cf7/cba53bcf789b43b18e55931554ea50a7.png"><br><h3 id="postroenie-prognoza">  Forecasting </h3><br><p>  The <code>Prophet</code> library has an interface similar to <code>sklearn</code> , first we create a model, then we call its <code>fit</code> method and then we get a prediction.  As an input to the <code>fit</code> method, the library takes a <code>dataframe</code> with two columns: </p><br><ul><li>  <code>ds</code> - time, the field must be of type <code>date</code> or <code>datetime</code> , </li><li>  <code>y</code> is the number we want to predict. </li></ul><br><p>  In order to measure the quality of the forecast, we remove the last month of data from the training and predict it.  The creators are advised to make predictions for several months of data, ideally a year or more (in our case there are several years of history for learning). </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  from fbprophet import Prophet predictions = 30 #  dataframe    df = aggr_habr_df.reset_index() df.columns = ['ds', 'y'] #      30 ,      train_df = df[:-predictions]</span></span></code> </pre> <br><p>  Next, create an object of the <code>Prophet</code> class (all the parameters of the model are set in the class constructor, first we take the default parameters) and train it. </p><br><pre> <code class="python hljs">m = Prophet() m.fit(train_df)</code> </pre> <br><p>  Using the auxiliary function <code>Prophet.make_future_dataframe</code> we create a <code>dataframe</code> that contains all the historical time points and another 30 days for which we wanted to build a forecast. </p><br><p>  In order to build a forecast, we call the model <code>predict</code> function and pass the <code>dataframe future</code> obtained at the previous step <code>dataframe future</code> . </p><br><pre> <code class="python hljs">future = m.make_future_dataframe(periods=predictions) forecast = m.predict(future)</code> </pre> <br><p>  The <code>Prophet</code> library has built-in visualization tools that allow you to evaluate the result of the constructed model. </p><br><p>  First, the <code>Prophet.plot</code> method displays the forecast.  Honestly, in this case, this visualization is not very revealing.  The main conclusion from this graph that I made is in the data of many <code>outlier</code> 's.  However, if the prediction will be less historical points, then it will be possible to understand something. </p><br><pre> <code class="python hljs">m.plot(forecast)</code> </pre> <br><img src="https://habrastorage.org/files/c50/b7d/fb8/c50b7dfb80924f27bc7e193eba4112b4.png"><br><p>  The second function <code>Prophet.plot_components</code> , in my opinion, is much more useful.  It allows you to look separately at the components: trend, annual and weekly seasonality.  If anomalous days / holidays were specified when building the model, they will also be displayed on this graph. </p><br><pre> <code class="python hljs">m.plot_components(forecast)</code> </pre> <br><img src="https://habrastorage.org/files/667/bd5/b26/667bd5b265774c4188f166d239609351.png"><br><p>  The graph shows that <code>Prophet</code> well adjusted to the growth of the number of posts by the ‚Äústep‚Äù at the beginning of 2015.  By weekly seasonality, it can be concluded that fewer posts fall on Sunday and Monday.  On the graph of annual seasonality, the failure of activity during the New Year holidays is most prominent, the decline is also visible at the May holidays. </p><br><h3 id="ocenka-kachestva-modeli">  Model quality assessment </h3><br><p>  Let's evaluate the quality of the algorithm and calculate <code>MAPE</code> for the last 30 days we predicted.  For the calculation we need observations <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-157"><span class="MJXp-msubsup" id="MJXp-Span-158"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-159" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-160" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">i</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> y_ {i} </script>  and forecasts for them <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-162"><span class="MJXp-mtext" id="MJXp-Span-163">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166">t</span><span class="MJXp-mrow" id="MJXp-Span-167"><span class="MJXp-msubsup" id="MJXp-Span-168"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-169" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-170" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-171">i</span></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> \ hat {y_ {i}} </script>  . </p><br><p>  First, look at the <code>forecast</code> object that the library generates.  In fact, this <code>dataframe</code> , which has all the information we need for the forecast. </p><br><pre> <code class="python hljs">print(<span class="hljs-string"><span class="hljs-string">', '</span></span>.join(forecast.columns))</code> </pre> <br><pre> <code class="hljs">ds, t, trend, seasonal_lower, seasonal_upper, trend_lower, trend_upper, yhat_lower, yhat_upper, weekly, weekly_lower, weekly_upper, yearly, yearly_lower, yearly_upper, seasonal, yhat</code> </pre> <br><p>  Before proceeding, we need to combine the <code>forecast</code> with our original observations. </p><br><pre> <code class="python hljs">cmp_df = forecast.set_index(<span class="hljs-string"><span class="hljs-string">'ds'</span></span>)[[<span class="hljs-string"><span class="hljs-string">'yhat'</span></span>, <span class="hljs-string"><span class="hljs-string">'yhat_lower'</span></span>, <span class="hljs-string"><span class="hljs-string">'yhat_upper'</span></span>]].join(df.set_index(<span class="hljs-string"><span class="hljs-string">'ds'</span></span>))</code> </pre> <br><p>  Let me remind you that we initially postponed the data for the last month in order to build a forecast for 30 days and measure the quality of the resulting model. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np cmp_df[<span class="hljs-string"><span class="hljs-string">'e'</span></span>] = cmp_df[<span class="hljs-string"><span class="hljs-string">'y'</span></span>] - cmp_df[<span class="hljs-string"><span class="hljs-string">'yhat'</span></span>] cmp_df[<span class="hljs-string"><span class="hljs-string">'p'</span></span>] = <span class="hljs-number"><span class="hljs-number">100</span></span>*cmp_df[<span class="hljs-string"><span class="hljs-string">'e'</span></span>]/cmp_df[<span class="hljs-string"><span class="hljs-string">'y'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'MAPE'</span></span>, np.mean(abs(cmp_df[-predictions:][<span class="hljs-string"><span class="hljs-string">'p'</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'MAE'</span></span>, np.mean(abs(cmp_df[-predictions:][<span class="hljs-string"><span class="hljs-string">'e'</span></span>]))</code> </pre> <br><p>  As a result, we got a quality of about <code>37.35%</code> , and on average, the model makes a mistake in the forecast for <code>10.62</code> posts. </p><br><h3 id="vizualizaciya">  Visualization </h3><br><p>  Let's make our visualization of the model built by <code>Prophet</code> : with actual values, forecast and confidence intervals. </p><br><p>  First, I want to leave the data for a shorter period so that they do not turn into a mash of points.  Secondly, I want to show the results of the model only for the period in which we made the prediction - it seems to me that the schedule will be more readable.  Third, make the plot interactive with <code>plot.ly</code> </p><br><div class="spoiler">  <b class="spoiler_title">Code for visualization</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#      def show_forecast(cmp_df, num_predictions, num_values): #      upper_bound = go.Scatter( name='Upper Bound', x=cmp_df.tail(num_predictions).index, y=cmp_df.tail(num_predictions).yhat_upper, mode='lines', marker=dict(color="444"), line=dict(width=0), fillcolor='rgba(68, 68, 68, 0.3)', fill='tonexty') #  forecast = go.Scatter( name='Prediction', x=cmp_df.tail(predictions).index, y=cmp_df.tail(predictions).yhat, mode='lines', line=dict(color='rgb(31, 119, 180)'), ) #     lower_bound = go.Scatter( name='Lower Bound', x=cmp_df.tail(num_predictions).index, y=cmp_df.tail(num_predictions).yhat_lower, marker=dict(color="444"), line=dict(width=0), mode='lines') #   fact = go.Scatter( name='Fact', x=cmp_df.tail(num_values).index, y=cmp_df.tail(num_values).y, marker=dict(color="red"), mode='lines', ) #       -   data = [lower_bound, upper_bound, forecast, fact] layout = go.Layout( yaxis=dict(title=''), title='   ', showlegend = False) fig = go.Figure(data=data, layout=layout) iplot(fig, show_link=False) show_forecast(cmp_df, predictions, 200)</span></span></code> </pre> <br><p>  As you can see, the function described above allows you to flexibly customize the visualization and display an arbitrary number of observations and predictions of the model. </p></div></div><br><img src="https://habrastorage.org/files/fd8/1a9/80e/fd81a980ecdb49c6ad53d648bba52d95.png"><br><p>  Visually, the forecast of the model seems to be quite good and reasonable.  Most likely, such a low quality rating is due to the anomalous high number of posts on October 13 and 17 and a decrease in activity from October 7. </p><br><p>  Also, according to the schedule, it can be concluded that most of the points lie within the confidence interval. </p><br><h2 id="sravnenie-s-arima-modelyu">  Comparison with ARIMA model </h2><br><p>  The forecast turned out to be quite reasonable, but let's compare it with the classic <code>SARIMA - Seasonal autoregressive integrated moving average</code> model <code>SARIMA - Seasonal autoregressive integrated moving average</code> with a weekly period. </p><br><p>  On Habrahabr, there are already several articles about <code>ARIMA</code> <a href="https://habrahabr.ru/post/210530/">models, I</a> advise anyone interested to read them: <a href="https://habrahabr.ru/post/210530/">Building a SARIMA model using Python + R</a> and <a href="https://habrahabr.ru/post/207160/">Analyzing time series using python</a> . </p><br><p>  To build a forecast, I was also inspired by the course materials <a href="https://www.coursera.org/learn/data-analysis-applications/home/week/1">Applied data analysis tasks</a> atoursera, which describes in detail <code>ARIMA</code> models and how to build them in <code>python</code> . </p><br><p>  It is worth noting that building the <code>ARIMA</code> model is much more expensive than <code>Prophet</code> : you need to investigate the original series, bring it to a stationary one, pick up initial approximations and spend a lot of time selecting the hyper-parameters of the algorithm (on my computer the model was chosen for almost 2 hours). </p><br><p>  But in this case, the efforts were not in vain, and the prediction of <code>SARIMA</code> turned out to be more accurate: <code>MAPE=16.54%, MAE=7.28 </code> .  The best model with parameters: <code>D=1, d=1, Q=1, q=4, P=1, p=3</code> . </p><br><img src="https://habrastorage.org/files/331/0dc/ff3/3310dcff35b8496ba98512a73ade4e9c.png"><br><p>  But <code>Prophet</code> , of course, can still be pushed.  For example, if we predict not the original series in this library, but after <a href="http://www.machinelearning.ru/wiki/index.php%3Ftitle%3D%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%2591%25D0%25BE%25D0%25BA%25D1%2581%25D0%25B0-%25D0%259A%25D0%25BE%25D0%25BA%25D1%2581%25D0%25B0">the Box-Cox transformation</a> , which normalizes the dispersion of the series, we will get a quality increase: <code>MAPE=26.79%, MAE=8.49 </code> . </p><br><div class="spoiler">  <b class="spoiler_title">Code for prediction of the Box-Cox Transformation Series</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scipy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> stats <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> statsmodels.api <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sm <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invboxcox</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(y,lmbda)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lmbda == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(np.exp(y)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(np.exp(np.log(lmbda*y+<span class="hljs-number"><span class="hljs-number">1</span></span>)/lmbda)) train_df2 = train_df.copy().fillna(<span class="hljs-number"><span class="hljs-number">14</span></span>) train_df2 = train_df2.set_index(<span class="hljs-string"><span class="hljs-string">'ds'</span></span>) train_df2[<span class="hljs-string"><span class="hljs-string">'y'</span></span>], lmbda_prophet = stats.boxcox(train_df2[<span class="hljs-string"><span class="hljs-string">'y'</span></span>]) train_df2.reset_index(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) m2 = Prophet() m2.fit(train_df2) future2 = m2.make_future_dataframe(periods=<span class="hljs-number"><span class="hljs-number">30</span></span>) forecast2 = m2.predict(future2) forecast2[<span class="hljs-string"><span class="hljs-string">'yhat'</span></span>] = invboxcox(forecast2.yhat, lmbda_prophet) forecast2[<span class="hljs-string"><span class="hljs-string">'yhat_lower'</span></span>] = invboxcox(forecast2.yhat_lower, lmbda_prophet) forecast2[<span class="hljs-string"><span class="hljs-string">'yhat_upper'</span></span>] = invboxcox(forecast2.yhat_upper, lmbda_prophet) cmp_df2 = forecast2.set_index(<span class="hljs-string"><span class="hljs-string">'ds'</span></span>)[[<span class="hljs-string"><span class="hljs-string">'yhat'</span></span>, <span class="hljs-string"><span class="hljs-string">'yhat_lower'</span></span>, <span class="hljs-string"><span class="hljs-string">'yhat_upper'</span></span>]].join(df.set_index(<span class="hljs-string"><span class="hljs-string">'ds'</span></span>)) cmp_df2[<span class="hljs-string"><span class="hljs-string">'e'</span></span>] = cmp_df2[<span class="hljs-string"><span class="hljs-string">'y'</span></span>] - cmp_df2[<span class="hljs-string"><span class="hljs-string">'yhat'</span></span>] cmp_df2[<span class="hljs-string"><span class="hljs-string">'p'</span></span>] = <span class="hljs-number"><span class="hljs-number">100</span></span>*cmp_df2[<span class="hljs-string"><span class="hljs-string">'e'</span></span>]/cmp_df2[<span class="hljs-string"><span class="hljs-string">'y'</span></span>] np.mean(abs(cmp_df2[-predictions:][<span class="hljs-string"><span class="hljs-string">'p'</span></span>])), np.mean(abs(cmp_df2[-predictions:][<span class="hljs-string"><span class="hljs-string">'e'</span></span>]))</code> </pre> </div></div><br><h2 id="itog">  Total </h2><br><p>  We got acquainted with the open-source library <code>Prophet</code> and its use to predict time series in practice. <br>  I would not say that this library works wonders and perfectly predicts the future.  In our case, the forecast turned out worse than the standard <code>SARIMA</code> .  However, the <code>Prophet</code> library is quite convenient, it is easy to customize (which only makes it possible to add previously known anomalous days), so it is useful to have it in your analytic <code>toolbox'e</code> . </p><br><h2 id="poleznye-ssylki">  useful links </h2><br><p>  Some materials for more in-depth study of the <code>Prophet</code> library and time series predictions, in general: </p><br><ul><li>  <code>Prophet</code> GitHub <a href="https://github.com/facebookincubator/prophet">repository</a> </li><li>  <code>Prophet</code> <a href="https://facebookincubator.github.io/prophet/docs/quick_start.html">documentation</a> </li><li>  <em>Sean J. Taylor, Benjamin Letham <a href="https://facebookincubator.github.io/prophet/static/prophet_paper_20170113.pdf">"Forecasting at scale"</a></em> is a scientific publication explaining the algorithm based on the <code>Prophet</code> library </li><li>  <em><a href="http://pbpython.com/prophet-overview.html">Forecasting Website Traffic Using Facebook's Prophet Library</a></em> - a case study for predicting traffic to a website </li><li>  <em>Rob J Hyndman, George Athanasopoulos <a href="https://www.otexts.org/fpp">"Forecasting: principles and practice"</a></em> - and finally, a good online book on the basics of time series forecasting </li><li>  <a href="http://nbviewer.jupyter.org/github/miptgirl/habra_materials/blob/master/prophet/habra_data.ipynb">jupyter notebook</a> with the code for the example analyzed in this article </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/323730/">https://habr.com/ru/post/323730/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323714/index.html">Reliable authorization for web service in one evening</a></li>
<li><a href="../323716/index.html">A revolution in radio engineering? RF-ARM-FPGA SoC</a></li>
<li><a href="../323718/index.html">The digest of interesting materials for the mobile # 194 developer (March 6-12)</a></li>
<li><a href="../323722/index.html">US Air Force uses IBM's neuromorphic chip to detect tanks and ground air defense systems</a></li>
<li><a href="../323724/index.html">Chronic Fatigue Syndrome. How hormones we get tired</a></li>
<li><a href="../323734/index.html">Choosing the right imaging method according to the IBCS standard</a></li>
<li><a href="../323740/index.html">Asterisk and not only. Virtual file systems. Step back or two forward?</a></li>
<li><a href="../323742/index.html">CrateDB: outside as PostgreSQL, and inside Elasticsearch</a></li>
<li><a href="../323744/index.html">Four main threats that allow you to turn IoT gadgets into an army of botnets</a></li>
<li><a href="../323746/index.html">Cach√© Containerization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>