<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The taste and color 2 - not RGB one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings to all readers. Let's try to continue our venture, the beginning of which is here . 

 So, we have a custom View with a multicolored circle,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The taste and color 2 - not RGB one</h1><div class="post__text post__text-html js-mediator-article">  Greetings to all readers.  Let's try to continue our venture, the beginning of which is <a href="http://habrahabr.ru/post/254797/">here</a> . <br><br>  So, we have a custom View with a multicolored circle, from which it is now necessary to pull out the color selected by the user.  Before plunging into the wilds of calculations, let's start by organizing some markers, pointers of a selected color. <a name="habracut"></a>  We will not complicate and make them in the form of simple lines - arrows.  For them, we need a new Paint and sizes.  In order not to repeat in the future, let's calculate all the necessary parameters at once.  I deliberately write a bunch of separate variables for clarity. <br><br>  Our ads and methods take the form: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// ,         protected static final int SET_COLOR = 0; protected static final int SET_SATUR = 1; protected static final int SET_ALPHA = 2; //  ,        . // (-   ) private int mMode; float cx; float cy; float rad_1; // float rad_2; // float rad_3; // float r_centr; //    float r_sel_c; // float r_sel_s; // float r_sel_a; //    //   private Paint p_color = new Paint(Paint.ANTI_ALIAS_FLAG); private Paint p_satur = new Paint(Paint.ANTI_ALIAS_FLAG); private Paint p_alpha = new Paint(Paint.ANTI_ALIAS_FLAG); private Paint p_white = new Paint(Paint.ANTI_ALIAS_FLAG); private Paint p_handl = new Paint(Paint.ANTI_ALIAS_FLAG); private Paint p_centr = new Paint(Paint.ANTI_ALIAS_FLAG); private float deg_col; //   private float deg_sat; //  -  private float deg_alp; // ******************** private float lc; // private float lm; //     private float lw; // private void calcSizes() { // // cx = size * 0.5f; cy = cx; lm = size * 0.043f; lw = size * 0.035f; rad_1 = size * 0.44f; r_sel_c = size * 0.39f; rad_2 = size * 0.34f; r_sel_s = size * 0.29f; rad_3 = size * 0.24f; r_sel_a = size * 0.19f; r_centr = size * 0.18f; lc = size * 0.08f; p_color.setStrokeWidth(lc); p_satur.setStrokeWidth(lc); p_alpha.setStrokeWidth(lc); }</span></span></code> </pre> <br><br>  First you need to make sure that we choose the color on the outer ring.  To do this to the coordinates of the distance from the center horizontally and vertically (in our code it is a and b in ACTION_DOWN), add another one - the distance from the center in a straight line.  According to all the laws of geometry we call it "c".  And then we calculate, remembering the works of citizen Pythagoras: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> c = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) Math.sqrt(a * a + b * b);</code> </pre><br><br>  It now remains to verify that the point of contact is on the outer ring, that is, with a larger inner radius of the ring.  At the same time, running ahead, we will perform these checks for the remaining rings that are not yet existing.  And set the flags.  In the end: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MotionEvent.ACTION_DOWN: <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a = Math.abs(event.getX() - cx); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> b = Math.abs(event.getY() - cy); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> c = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) Math.sqrt(a * a + b * b); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &gt; r_sel_c) mode = SET_COLOR; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &lt; r_sel_c &amp;&amp; c &gt; r_sel_s) mode = SET_SATUR; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &lt; r_sel_s &amp;&amp; c &gt; r_sel_a) mode = SET_ALPHA; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &lt; r_centr) listener.onDismiss(mColor, alpha); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre><br><br>  Note - we only check the distance from the center in ACTION_DOWN.  That is, by poking a finger into the outer ring, we can then crawl along our View as much as possible even outside of the color selection zone, the color will change.  Until we finger again and change the mode flag. <br><br>  Now in ACTION_MOVE we will receive new coordinates and determine the selected color, saturation or transparency.  In order not to litter onTouch we will take out the math in separate methods.  Well and call invalidate () I think it is better to place here.  We made it: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MotionEvent.ACTION_MOVE: <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = event.getX() - cx; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = event.getY() - cy; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (mMode) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SET_COLOR: setColScale(getAngle(x, y)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SET_SATUR: setSatScale(getAngle(x, y)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SET_ALPHA: setAlphaScale(getAngle(x, y)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } invalidate(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre><br><br>  Methods of type two in one.  Consider more.  getAngle (x, y) - based on the coordinates, we determine the angle between the position of the finger and the center of the View.  Something like this: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAngle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> deg = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x != <span class="hljs-number"><span class="hljs-number">0</span></span>) deg = y / x; deg = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) Math.toDegrees(Math.atan(deg)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) deg += <span class="hljs-number"><span class="hljs-number">180</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) deg += <span class="hljs-number"><span class="hljs-number">360</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> deg; }</code> </pre><br><br>  At the output we get the angle in degrees, which now needs to be somehow linked to the color in this sector of our gradient.  At the thought came to a standstill.  Perverted ideas of calculating the coordinates of the pixels and analyzing their color, I somehow immediately dropped.  In his head the words of a penguin from Madagascar were spinning - ‚ÄúKowalski, suggest options ...‚Äù.  Google played the role of Kowalski.  And that's what he said. <br><br>  It turns out there is life on other planets.  And instead of such a native and understandable ARGB, they use some kind of incomprehensible HSV there.  What kind of animal is this?  For example, his first letter?  Wiki declares that this is ‚ÄúHue - color tone ... Varies between 0 - 360 ...‚Äù.  Do you think what a coincidence?  And the rest of the letters?  S - Saturation - yes this is our second ring!  And V - Value is brightness.  And Android immediately offers us a couple of functions: <br><br><pre> <code class="java hljs">Color.HSVToColor(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[]); Color.colorToHSV(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[]);</code> </pre><br><br>  The int parameter in the first function is transparency, remembering about our third ring.  In the second function, int is the color itself.  And in both functions, float [] is an array of three elements, the first of which, respectively, for the letters HSV is the color value of the palette from 0 to 360. Life seems to be getting better. <br><br>  We declare argb and hsv arrays for storing our color components: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] argb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] { <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] hsv = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>};</code> </pre><br><br>  And simply substitute the previously obtained angle in degrees as the first element of the array. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setColScale</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f)</span></span></span><span class="hljs-function"> </span></span>{ deg_col = f; hsv[<span class="hljs-number"><span class="hljs-number">0</span></span>] = f; mColor = Color.HSVToColor(argb[<span class="hljs-number"><span class="hljs-number">0</span></span>], hsv); p_center.setColor(mColor); }</code> </pre><br><br>  Now we have the color, the angle and the full right to draw the second ring and arrows.  Here is the code: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawSaturGradient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas c)</span></span></span><span class="hljs-function"> </span></span>{ SweepGradient s = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] sg = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] { Color.HSVToColor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {deg_col, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}), Color.HSVToColor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {deg_col, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}), Color.HSVToColor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] { hsv[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}), Color.HSVToColor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] { hsv[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>}), Color.HSVToColor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] {deg_col, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}) }; s = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SweepGradient(cx, cy, sg, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); p_satur.setShader(s); c.drawCircle(cx, cy, rad_2, p_satur); }</code> </pre><br><br>  Very similar to the previous code, the same array for the shader, the same gradient.  Only now it has 5 colors, each of which we tear out of HSV.  Moreover, we set the saturation and brightness manually from 0 to 1, and for some reason I put the angle value into the first (in the sense of zero) array element.  It would be more correct to see the value hsv [0] we have, but this is the same value.  As proof, I even ferried in two places.  So don't forget that deg_col == hsv [0].  Well, the corner came first to me, sorry. <br><br>  Result: <br><br><img src="http://gelocod-ru.1gb.ru/images/sat.png" alt="image"><br><br>  I think everyone understands that this method should be called in onDraw (), like the following.  Dada, we can already quite draw the third ring: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawAlphaGradient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//           //    c.drawCircle(cx, cy, rad_3 - lw, p_white); c.drawCircle(cx, cy, rad_3, p_white); c.drawCircle(cx, cy, rad_3 + lw, p_white); //   RGB    int ir = Color.red(mColor); int ig = Color.green(mColor); int ib = Color.blue(mColor); //     ‚Äì       int e = Color.argb(0, ir, ig, ib); int[] mCol = new int[] {mColor, e}; //     Shader sw = new SweepGradient(cx, cy, mCol, null); p_alpha.setShader(sw); c.drawCircle(cx, cy, rad_3, p_alpha); }</span></span></code> </pre><br><br>  And arrows: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> d = deg_col; c.rotate(d, cx, cy); c.drawLine(cx + rad_1 + lm, cy, cx + rad_1 - lm, cy, p_handl); c.rotate(-d, cx, cy); d = deg_sat; c.rotate(d, cx, cy); c.drawLine(cx + rad_2 + lm, cy, cx + rad_2 - lm, cy, p_handl); c.rotate(-d, cx, cy); d = deg_alp; c.rotate(d, cx, cy); c.drawLine(cx + rad_3 + lm, cy, cx + rad_3 - lm, cy, p_handl); c.rotate(-d, cx, cy); }</code> </pre><br><br>  Did anyone have a question - why in the last method is the local variable d?  Perhaps these are signs of my paranoia.  If you use the global variable deg_col or others directly, during the drawing time, the user can change them by running a finger across the screen.  It is clear that changes will be negligible over those microseconds of drawing.  But nevertheless functions <br><pre> <code class="java hljs">c.rotate(deg_col, cx, cy);</code> </pre><br>  and <br><pre> <code class="java hljs">c.rotate(-deg_col, cx, cy);</code> </pre><br><br>  will rotate the canvas by a different amount.  And this difference will gradually accumulate. <br><br>  Well, do not forget, of course, set the properties for our Paint to taste.  I have this somehow: <br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ setFocusable(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); p_color.setStyle(Style.STROKE); p_satur.setStyle(Style.STROKE); p_alpha.setStyle(Style.STROKE); p_center.setStyle(Style.FILL_AND_STROKE); p_white.setStrokeWidth(<span class="hljs-number"><span class="hljs-number">2</span></span>); p_white.setColor(Color.WHITE); p_white.setStyle(Style.STROKE); p_handl.setStrokeWidth(<span class="hljs-number"><span class="hljs-number">5</span></span>); p_handl.setColor(Color.WHITE); p_handl.setStrokeCap(Cap.ROUND); setOnTouchListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre><br><br>  setFocusable (true) I missed in the last article. <br><br>  Back to our OnTouch. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSatScale</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f)</span></span></span><span class="hljs-function"> </span></span>{ deg_sat = f; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f &lt; <span class="hljs-number"><span class="hljs-number">90</span></span>) { hsv[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>; hsv[<span class="hljs-number"><span class="hljs-number">2</span></span>] = f / <span class="hljs-number"><span class="hljs-number">90</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f &gt;= <span class="hljs-number"><span class="hljs-number">90</span></span> &amp;&amp; f &lt; <span class="hljs-number"><span class="hljs-number">180</span></span>) { hsv[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span> - (f - <span class="hljs-number"><span class="hljs-number">90</span></span>) / <span class="hljs-number"><span class="hljs-number">90</span></span>; hsv[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { hsv[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; hsv[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span> - (f - <span class="hljs-number"><span class="hljs-number">180</span></span>) / <span class="hljs-number"><span class="hljs-number">180</span></span>; } mColor = Color.HSVToColor(argb[<span class="hljs-number"><span class="hljs-number">0</span></span>], hsv); p_center.setColor(mColor); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAlphaScale</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> f)</span></span></span><span class="hljs-function"> </span></span>{ deg_alp = f; argb[<span class="hljs-number"><span class="hljs-number">0</span></span>] = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (<span class="hljs-number"><span class="hljs-number">255</span></span> - f / <span class="hljs-number"><span class="hljs-number">360</span></span> * <span class="hljs-number"><span class="hljs-number">255</span></span>); mColor = Color.HSVToColor(argb[<span class="hljs-number"><span class="hljs-number">0</span></span>], hsv); alpha = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) Color.alpha(mColor) / <span class="hljs-number"><span class="hljs-number">255</span></span>; p_center.setColor(mColor); }</code> </pre><br><br>  Well, we have to somehow get the result.  Here again, a matter of taste and a specific use case.  For some, it is more convenient to write a value in the Preference, to send someone an Intent in all directions.  I propose to organize our View interface, like a real adult and independent controls.  The color value we can send once by pressing the center of the circle, we can in real-time, as the color changes in OnTouch.  Walk so walk, do both, and another: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> OnColorChangeListener listener; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnColorChangeListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDismiss</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> val, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> alpha)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onColorChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> val, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> alpha)</span></span></span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOnColorChangeListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OnColorChangeListener l)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listener = l; }</code> </pre><br><br><pre> <code class="java hljs"> OnTouch: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MotionEvent.ACTION_DOWN: ‚Ä¶ ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &lt; r_centr) { listener.onDismiss(mColor, alpha); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MotionEvent.ACTION_MOVE: ‚Ä¶ ‚Ä¶ listener.onColorChanged(mColor, alpha); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br><br>  I hope I have not forgotten anything.  Oh yes.  It is desirable to be able to transfer the current color value to our ColorPicker.  Add: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUsedColor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> color, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a)</span></span></span><span class="hljs-function"> </span></span>{ mColor = color; Color.colorToHSV(mColor, hsv); setColScale(hsv[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> deg = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hsv[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-number"><span class="hljs-number">1</span></span>) deg = <span class="hljs-number"><span class="hljs-number">90</span></span> * hsv[<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hsv[<span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-number"><span class="hljs-number">1</span></span>) deg = <span class="hljs-number"><span class="hljs-number">180</span></span> - <span class="hljs-number"><span class="hljs-number">90</span></span> * hsv[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hsv[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span>) deg = <span class="hljs-number"><span class="hljs-number">360</span></span> - <span class="hljs-number"><span class="hljs-number">180</span></span> * hsv[<span class="hljs-number"><span class="hljs-number">2</span></span>]; setSatScale(deg); setAlphaScale(<span class="hljs-number"><span class="hljs-number">360</span></span> - <span class="hljs-number"><span class="hljs-number">360</span></span> * a); }</code> </pre><br><br>  PS: Another nuance was found in practical use.  Attempting to apply the resulting color to images (in the form of ColorFilter) does not change their transparency.  Or did I miss something?  If so, I hope more experienced comrades will correct me.  I had to use the setAlpha method, previously getting the value of transparency using the Color.alpha (mColor) method.  The value of int is 0-255, and setAlpha (int) has recently been deprecated.  A float from 0 to 1 is required (of type setAlpha ((float) Color.alpha (mColor) / 255)); <br><br>  Since we pretend to the universality of our control, it makes sense to stick these calculations into it.  And give out the transparency of the float format 0-1.  It is possible by a separate method in the interface, it is possible by the second parameter in addition to color - a matter of taste.  Added it to the code. <br><br>  Although for complete versatility, you can force it to give out separately all the components - you never know where it is needed.  I will not implement it now, I think this is not a problem even for a teapot. <br><br>  Now that's it. </div><p>Source: <a href="https://habr.com/ru/post/254895/">https://habr.com/ru/post/254895/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254883/index.html">We optimize web form usability</a></li>
<li><a href="../254885/index.html">Description of digital machines on VHDL</a></li>
<li><a href="../254887/index.html">WPF: Using Attached Property and Behavior</a></li>
<li><a href="../254889/index.html">Matreshka.js 2: From simple to simple</a></li>
<li><a href="../254891/index.html">We facilitate the support of iOS applications. Part 2 - location and network</a></li>
<li><a href="../254897/index.html">Lectures of the Technosphere. 1 semester Algorithms for intelligent processing of large amounts of data</a></li>
<li><a href="../254899/index.html">Encryption in NQ Vault turned out to be an ordinary XOR, and this is not the worst</a></li>
<li><a href="../254901/index.html">Universal Nixie-module on IN-12</a></li>
<li><a href="../254905/index.html">State Mandate to Kill the Universe and Counteract This (report at Bitcoin Conference Russia 2015)</a></li>
<li><a href="../254907/index.html">Web Bundle - the case of RarJPEG lives</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>