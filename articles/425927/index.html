<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Weather Station on Arduino from A to Z. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continued. The previous part . 


 Table of contents: 


- Part 1. Requirements. The choice of iron. General scheme 
- Part 2. Software. Central unit,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Weather Station on Arduino from A to Z. Part 2</h1><div class="post__text post__text-html js-mediator-article"><p>  Continued.  <a href="https://habr.com/post/425901/">The previous part</a> . </p><br><p>  Table of contents: </p><br><ul><li>  <a href="https://habr.com/post/425901/">Part 1. Requirements.</a>  <a href="https://habr.com/post/425901/">The choice of iron.</a>  <a href="https://habr.com/post/425901/">General scheme</a> </li><li>  <a href="https://habr.com/post/425927/">Part 2. Software.</a>  <a href="https://habr.com/post/425927/">Central unit, iron</a> </li><li>  <a href="https://habr.com/post/425953/">Part 3. Central unit, software</a> </li><li>  <a href="https://habr.com/post/425963/">Part 4. Transom Sensor</a> </li><li>  <a href="https://habr.com/post/426019/">Part 5. MySQL, PHP, WWW, Android</a> </li></ul><br><h1 id="soft-vybor-komponentov">  Soft  Component selection </h1><br><p><img src="https://habrastorage.org/webt/ew/mv/xw/ewmvxwk-6m-horit-imnrso2jn0.jpeg"></p><br><p>  The choice of hardware and software is closely interrelated as "chicken and egg".  Where to start, with iron, with software?  If you have good hardware, but there are no drivers, libraries and software for it (IDE, firmware utilities, etc.), then it is useless, and vice versa. </p><a name="habracut"></a><br><p>  Therefore, I am telling once again about the choice between the nRF24L01 + and ESP8266 for the connection of remote sensors with the central unit. </p><br><p>  The fact is that the ESP8266 is not just a stupid WiFi adapter, it has a microcontroller onboard that is <em>superior to</em> Arduino in terms of power and memory.  By default, the ESP8266 has a firmware in the form of a set of AT commands; in this case, ESP is used as a simple modem.  But there are more advanced firmware, here ESP8266 can even act as a web server, and, of course, control sensors like Arduino. </p><br><p>  However, all these advanced firmware have flaws that did not allow (in total with the hardware questions about which I already wrote) to apply ESP8266 in this project: </p><br><ul><li>  all firmwares are still very raw (as of 2016) </li><li>  some ready are not free </li><li>  The entry threshold for debugging and making changes is much higher than that of the Arduino. </li></ul><br><p>  As a result, I did not find a ready-made suitable firmware, and I am not ready to create my own yet.  The ESP8266 chip is an extensive and interesting topic. </p><br><p>  In turn, standard AT firmware also has disadvantages: </p><br><ul><li>  they are still damp (as of 2016) </li><li>  I could not find a normal library for Arduino to control the ESP8266 module using AT commands, I had to ‚Äúcollective farm‚Äù myself. </li></ul><br><p>  On the other hand, the nRF24L01 + radio module is simple and straightforward, there is a RadioHead super library for working with it and <em>no</em> programming <em>problems</em> .  The library is well documented, which is important. </p><br><p>  RadioHead allows you to transfer data structures (and not just individual numbers), which is implemented in this project.  Looking ahead, I‚Äôll say RadioHead can <strong>reliably</strong> transfer data, with repetitions if it hasn‚Äôt reached the first time.  All these things the library takes over. </p><br><p>  To save energy, I use the <a href="https://github.com/rocketscream/Low-Power">Low Power Library</a> , it is simple and contains only what you need. </p><br><p>  Here is a piece of code: </p><br><pre><code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/    2.402 GHz ( 2), 2Mbps, 0dBm rfdata.init(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     ( ,  ) rfdata.sendtoWait((uint8_t*)&amp;dhtData, sizeof(dhtData), SERVER_ADDRESS); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  LowPower.powerDown(SLEEP_8S, ADC_OFF, BOD_OFF);`</span></span></code> </pre> <br><p>  Everything! </p><br><p>  In the case of the use of ESP8266 in the out-of-window sensor, I would be forced to create a WiFi access point and somehow transfer data (where is the firmware, where is the software?).  Or allow the sensor to send data directly to the web server, and the central unit (which in this case stops playing the role of ‚Äúcentral‚Äù) learn to read the data from there in order to display it on the board. </p><br><p>  In other words, I went through more autonomy from the WiFi Internet and PHP + MySQL server.  You can start ‚Äúriveting‚Äù the weather station already without access to the Internet and / or hosting for the server, in this case you don‚Äôt need ESP8266, just add it later. </p><br><p>  The <a href="https://github.com/adafruit/DHT-sensor-library">Adafruit DHT Sensor Library is available</a> for reading data from DHT sensors.  Working with it is simple and straightforward. </p><br><p>  The <a href="https://github.com/adafruit/Adafruit_BMP085_Unified">Adafruit BMP085 Unified</a> library is suitable for the pressure sensor, which requires an abstract level library <a href="https://github.com/adafruit/Adafruit_Sensor">Adafruit Sensor</a> . </p><br><p>  All libraries have examples of sketches. </p><br><p>  That's all with the theoretical part.  <em>‚ÄúOur goals are clear, the objectives are defined.</em>  <em>For the work, comrades! ‚Äù</em> </p><br><h1 id="centralnyy-blok-zhelezo">  Central unit.  Iron </h1><br><p>  Well, finally, after all the misrepresentations, we proceed to the assembly! </p><br><p>  <em>Note</em>  If you have never collected a weather station (oh well!), Then you can start without all the details at hand.  For example, you can start without having a radio module and / or ESP8266.  The barometric pressure sensor BMP180 may also be missing.  Add later.  True, in this case you will have to independently comment out in the sketch those code sections that are responsible for interacting with the missing blocks, but this is not so difficult.  I'll show you how. </p><br><p>  The main thing is that at least something gathered and earned, then more fun to continue. </p><br><p>  As already mentioned, the central unit is based on the Arduino MEGA.  We will also need: </p><br><ul><li>  temperature and humidity sensor DHT11 </li><li>  barometric pressure sensor type BMP180 </li><li>  WiFi module ESP8266 </li><li>  radio module type nRF24 2.4 GHz </li><li>  LCD1604 type display (4 lines of 16 characters each), you can buy for $ 5 </li><li>  power supply with output of 5-12 V DC (I used charging from mobile with USB output which is convenient) </li><li>  breadboard for soldering, soldering iron, rosin, solder or ordinary solderless arduino breadboard.  Personally, I soldered for reliability, because the project was clearly long-playing and did not want to suffer because of the wiring that was accidentally pulled out of the model. </li></ul><br><p>  You can buy a prototype card for desoldering from $ 1.  Take a larger size to be enough for all connections.  And once again: read the description before buying, not the picture. </p><br><p>  A bounce-free fee can be purchased from $ 2.  Take a larger size to be enough for all connections. </p><br><p>  Connecting wires are of the types we need: </p><br><ul><li>  Dupont cable "father-mother" (there is also "father-father", "mother-mother").  This is a train of several wires with different colors of insulation and connectors for the pin contacts for Arduino.  With such wires it is convenient to connect boards and sensors directly to Arduino without using a breadboard. </li><li>  Conventional connecting wires for solderless prototyping board for Arduino. </li><li>  Wire bundle for soldering. </li></ul><br><p>  First of all, I disassembled the LCD-1604 scoreboard.  First I soldered the pins to the board, then the connectors to the breadboard. </p><br><p><img src="https://habrastorage.org/webt/xo/_f/0t/xo_f0tjxqbyoizk9ckx4ctmevfs.jpeg"></p><br><p>  Bottom view. </p><br><p><img src="https://habrastorage.org/webt/bi/ra/x7/birax7qohcjnglgpnl-ak3w0v0i.jpeg"></p><br><p>  Payal on influx without prior layout, so here no scheme will not be given.  Do as it is more convenient, it will not be worse.  Adhere only to the principle that the black wire is always the earth, the red is the ‚Äúplus‚Äù of the power, the other colors as it is.  It turned out so. </p><br><p><img src="https://habrastorage.org/webt/v7/ig/ls/v7iglsiyr7br9z8xzkf9rxtcgd0.jpeg"></p><br><p><img src="https://habrastorage.org/webt/yd/_f/68/yd_f68ohr4drxg8re9mp9jehljk.jpeg"></p><br><p>  In order not to forget where there are any connectors, I ‚Äúpainted‚Äù with the white corrector sections of the board in the neighborhood and made the appropriate inscriptions.  Ugly?  But practical and fast, it's a prototype! </p><br><p><img src="https://habrastorage.org/webt/lr/8i/vd/lr8ivdlywq6bwkcgpemm03hopsg.jpeg"></p><br><h1 id="raspinovka--i-soedinenie">  Pinout and connection </h1><br><h2 id="displey-164-lcd1604">  16 √ó 4 LCD1604 display </h2><br><p>  For more information about the display and how to work with it, google ‚ÄúWorking with symbolic LCDs based on HD44780‚Äù.  Note that you need to carefully consider the polarity of the power supply to the LCD indicator and that the supply voltage is in the range of + 4.5 ... 5.5 V. Inattentive attitude to this can lead to the indicator failure! </p><br><table><thead><tr><th>  Pin LCD 1604 </th><th>  Arduino MEGA </th><th>  Arduino uno </th><th>  Description </th></tr></thead><tbody><tr><td>  VSS </td><td>  GND </td><td>  GND </td><td>  GND </td></tr><tr><td>  Vdd </td><td>  5 V </td><td>  5 V </td><td>  4.7 - 5.3V </td></tr><tr><td>  RS </td><td>  22 </td><td>  four </td><td>  A high level means that the signal at the outputs DB0 ‚Äî DB7 is data, a low one ‚Äî the command </td></tr><tr><td>  Rw </td><td>  GND </td><td>  GND </td><td>  Defines the direction of the data (read / write).  Since the operation of reading data from the indicator is usually unclaimed, it is possible to set a low level permanently at this input. </td></tr><tr><td>  E </td><td>  23 </td><td>  five </td><td>  A pulse with a duration of at least 500 ms on this pin determines the signal for reading / writing data from the pins DB0-DB7, RS and WR </td></tr><tr><td>  DB4 </td><td>  24 </td><td>  eight </td><td>  Incoming / outgoing data </td></tr><tr><td>  DB5 </td><td>  25 </td><td>  9 </td></tr><tr><td>  DB6 </td><td>  26 </td><td>  ten </td></tr><tr><td>  DB7 </td><td>  27 </td><td>  eleven </td></tr><tr><td>  LED A + </td><td></td><td></td><td>  + 5V or 220 ohm resistor ‚Üí + 5VLED-A <img src="https://habrastorage.org/webt/xo/d8/wr/xod8wrcrzmudwuh6kqtf62suwva.jpeg"></td></tr><tr><td>  LED B- </td><td></td><td></td><td>  GND </td></tr><tr><td>  V0 </td><td></td><td></td><td>  GND or 10kŒ© trimmer <img src="https://habrastorage.org/webt/l0/pq/r5/l0pqr5u_zmcwoeyjipkzucc3wzs.jpeg"></td></tr></tbody></table><br><p>  Software initialization will look like this: </p><br><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">// Arduino MEGA LiquidCrystal lcd(22, 23, 24, 25, 26, 27); // Arduino UNO LiquidCrystal lcd(4, 5, 8, 9, 10, 11);</span></span></code> </pre> <br><h1 id="temperatura-vlazhnost-dht11">  Temperature, humidity DHT11 </h1><br><p>  Connecting temperature and humidity sensor DHT11 (SainSmart).  Position the sensor face up, the findings will be described from left to right. </p><br><table><thead><tr><th>  DHT11 </th><th>  Arduino mega </th></tr></thead><tbody><tr><td>  DATA </td><td>  Digital pin 2 (PWM) (see below DHTPIN) </td></tr><tr><td>  VCC </td><td>  3.3‚Äî5 V (5 V recommended, better external power) </td></tr><tr><td>  GND </td><td>  GND </td></tr></tbody></table><br><p>  Software initialization </p><br><pre> <code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DHTPIN 2 //   Digital pin 2 (PWM) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DHTTYPE DHT11 // . DHT.h //  DHT dht(DHTPIN, DHTTYPE);</span></span></code> </pre> <br><h1 id="barometr-bmp180">  Barometer BMP180 </h1><br><p>  Connection of atmospheric pressure sensor BMP180 (barometer) + temperature via I2C / TWI interface. </p><br><table><thead><tr><th>  BMP180 </th><th>  Arduino mega </th></tr></thead><tbody><tr><td>  VCC </td><td>  not connected </td></tr><tr><td>  GND </td><td>  GND </td></tr><tr><td>  SCL </td><td>  21 (SCL) </td></tr><tr><td>  SDA </td><td>  20 (SDA) </td></tr><tr><td>  3.3 </td><td>  3.3 V </td></tr></tbody></table><br><p>  For UNO: A4 (SDA), A5 (SCL). </p><br><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">//  Adafruit_BMP085_Unified bmp = Adafruit_BMP085_Unified(10085); // sensorID</span></span></code> </pre> <br><h1 id="nrf24l01">  nRF24L01 + </h1><br><p>  Brief specifications: </p><br><ul><li>  The frequency range of 2.401 - 2.4835 GHz </li><li>  126 channels.  The zero channel starts at 2400 MHz and further with a step of 1 MHz, for example, channel 70 is located at 2470 MHz, respectively.  When setting the transmission speed of 2Mbps, the channel width is 2 MHz. </li><li>  Power supply 1.9 - 3.6 V (3.3 V recommended) </li></ul><br><p>  Here is the pinout of the module. </p><br><p><img src="https://habrastorage.org/webt/nd/m7/e_/ndm7e_9peiyjl2nbbqcyuqk_s-e.jpeg" alt="Pinout nRF2401L +"></p><br><p>  Some advise you to immediately solder a 100nF ceramic capacitor (1¬µF, 10¬µF possible) to the RF power pins to avoid electrical interference. </p><br><p>  Pinout nRF24L01 + (look at the top of the board where the chip, pins should be below): </p><br><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>  pin <strong>2</strong> 3.3V </td><td>  pin <strong>4</strong> CSN </td><td>  pin <strong>6</strong> MOSI </td><td>  pin <strong>8</strong> IRQ </td></tr><tr><td>  pin <strong>1</strong> gnd </td><td>  pin <strong>3</strong> CE </td><td>  pin <strong>5</strong> sck </td><td>  pin <strong>7</strong> MISO </td></tr></tbody></table><br><p>  Connection for weather station: </p><br><table><thead><tr><th>  Arduino mega </th><th>  nRF24L01 + </th></tr></thead><tbody><tr><td>  3.3 V </td><td>  VCC pin 2 (better external power) </td></tr><tr><td>  pin D8 </td><td>  CE pin 3 (chip enable in) </td></tr><tr><td>  SS pin D53 </td><td>  CSN pin 4 (chip select in) </td></tr><tr><td>  SCK pin D52 </td><td>  SCK pin 5 (SPI clock in) </td></tr><tr><td>  MOSI pin D51 </td><td>  SDI pin 6 (SPI Data in) </td></tr><tr><td>  MISO pin D50 </td><td>  SDO pin 7 (SPI data out) </td></tr><tr><td>  IRQ pin 8 (Interrupt output) is not connected </td></tr><tr><td>  GND </td><td>  GND pin 1 (ground in) </td></tr></tbody></table><br><p>  Programming of the radio module will be described in detail in the program part. </p><br><h1 id="esp8266">  ESP8266 </h1><br><p>  Pinout ESP8266 (look at the top of the board where the chips, pins should be below): </p><br><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>  GND </td><td>  GPIO2 </td><td>  GPIO0 </td><td>  Rx </td></tr><tr><td>  Tx </td><td>  CH_PD </td><td>  RESET </td><td>  VCC </td></tr></tbody></table><br><p>  ESP8266 Connection for Weather Station: </p><br><table><thead><tr><th>  ESP8266 </th><th>  Arduino mega </th></tr></thead><tbody><tr><td>  Tx </td><td>  10 pin (SoftwareSerial RX) </td></tr><tr><td>  Rx </td><td>  11 pin (SoftwareSerial TX) </td></tr><tr><td>  VCC </td><td>  3.3 V </td></tr><tr><td>  GND </td><td>  GND </td></tr><tr><td>  CH_PD </td><td>  Through 10K to 3.3V Arduino Resistor </td></tr><tr><td>  GPI0 </td><td>  Not necessary.  Through 10K to 3.3V Arduino Resistor </td></tr><tr><td>  GPI2 </td><td>  Not necessary.  Through 10K to 3.3V Arduino Resistor </td></tr></tbody></table><br><h1 id="kdpv">  KDPV </h1><br><p>  Central unit assembly.  "Motherboard" cut out of a cardboard box from under the shoes and cogs for 3 screwed everything else to it. </p><br><p><img src="https://habrastorage.org/webt/sl/sy/2i/slsy2inw-eaew1_mnsubhm0jqk4.jpeg" alt="Central unit assembly"></p><br><p>  As we see in this place, all the power is supplied from Arduino pins, i.e.  Nothing goes directly to the power supply, and so far there is enough power. </p><br><p>  Look like that's it.  Forgot nothing. </p><br><p>  Solder, connect.  In the next part, a working sketch for the central unit will be shown and our weather station will already show something. </p><br><p><img src="https://habrastorage.org/webt/jm/jv/oo/jmjvoopeldqn24qk8rdu6xuibym.jpeg"></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/425927/">https://habr.com/ru/post/425927/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../425917/index.html">The fighter for justice did not give Waymo to patent the key technology of lidar</a></li>
<li><a href="../425919/index.html">Hexagon maps in Unity: save and load, textures, distances</a></li>
<li><a href="../425921/index.html">Meet the .NET community at CLRium # 4 + online</a></li>
<li><a href="../425923/index.html">25 years DOOM</a></li>
<li><a href="../425925/index.html">3D printing in creating layouts on the example of STUDIO 911</a></li>
<li><a href="../425929/index.html">Google Corporation has abandoned the struggle for the billionth Pentagon contract</a></li>
<li><a href="../425931/index.html">‚ÄúI want to leave the factory on the web‚Äù - 10 questions for a programmer, issue 8</a></li>
<li><a href="../425933/index.html">The humidity level in the data center: why it matters</a></li>
<li><a href="../425935/index.html">Suspension of the system unit under the standing table</a></li>
<li><a href="../425937/index.html">CoreBluetooth in practice</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>