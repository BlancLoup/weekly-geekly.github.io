<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing your Xcode plugin</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Often there are situations when you want to expand the functionality of the used IDE. Lucky if the developer provided the tools and documentation to d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing your Xcode plugin</h1><div class="post__text post__text-html js-mediator-article">  Often there are situations when you want to expand the functionality of the used IDE.  Lucky if the developer provided the tools and documentation to do this.  Unfortunately, this is not the case with Xcode.  Documenting capabilities has stopped at <a href="http://maxao.free.fr/xcode-plugin-interface/">Xcode 3.0</a> , so no one can guarantee that the plugin you write will work in the next version. <br><br><a name="habracut"></a>  Note: The plugin <a href="https://github.com/omz/ColorSense-for-Xcode">ColorSense-for-Xcode</a> was taken as the basis for writing this topic. <br><br>  As I said, officially, Xcode does not provide a public API for writing plugins.  When the application starts, Xcode scans the plugins folder (~ / Library / Application Support / Developer / Shared / Xcode / Plug-ins) and loads the found (.xcplugin) files. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In fact, a simple plugin is written in a few hours, which you will see later. <br><br><h5>  Create a new Xcode project </h5><br>  Plugin - just an OS X bundle, we will create a new project with the type of 'bundle'. <br><br><img src="https://habrastorage.org/storage2/963/64d/a78/96364da785d737ab8813632389e283ee.jpg"><br><br>  When creating a project, you need to make sure that ARC is turned off, since Xcode is running under the garbage collector, the same applies to the plugin. <br><br>  Open the target of the plugin and set the following settings: <br><br><ul><li>  XC4Compatible = YES </li><li>  XCPluginHasUI = NO </li><li>  XCGCReady = YES </li><li>  Principal class = {name of the main class of the plugin} </li></ul><br><br><img src="https://habrastorage.org/storage2/1aa/246/c2f/1aa246c2f7b336bde876bcdb3c7badd5.jpg"><br><br><h5>  Configuring Build Settings </h5><br>  Go to build settings and set the following settings: <br><ul><li>  Installation Build Products Location = $ {HOME} </li><li>  Installation Directory = / Library / Application Support / Developer / Shared / Xcode / Plug-ins </li><li>  Deployment Location = YES </li><li>  Wrapper extension = xcplugin </li></ul><br><br>  Also, add some user-definded settings: <br><ul><li>  GCC_ENABLE_OBJC_GC = supported </li><li>  GCC_MODEL_TUNING = G5 </li></ul><br><br>  We have indicated where our plugin should be installed after assembly.  <b>Important:</b> debugging plug-ins is all sad, and you will have to restart Xcode after each build. <br><br><h5>  Writing a plugin </h5><br>  Let's create a new class and name it by the name that was specified in the Principal class setting.  When Xcode loads a plugin, the <i>+ (void) pluginDidLoad: (NSBundle *) plugin</i> method will be invoked, in which you can make the initial configuration of the plugin (as a rule, the plugin is a singleton). <br><br><pre><code class="objectivec hljs">+ (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) pluginDidLoad: (<span class="hljs-built_in"><span class="hljs-built_in">NSBundle</span></span>*) plugin { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> sharedPlugin = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">dispatch_once_t</span></span> once; <span class="hljs-built_in"><span class="hljs-built_in">dispatch_once</span></span>(&amp;once, ^{ sharedPlugin = [[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> alloc] init]; }); } - (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)init { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> = [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> init]) { [[<span class="hljs-built_in"><span class="hljs-built_in">NSNotificationCenter</span></span> defaultCenter] addObserver:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> selector:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(applicationDidFinishLaunching:) name:<span class="hljs-built_in"><span class="hljs-built_in">NSApplicationDidFinishLaunchingNotification</span></span> object:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; }</code> </pre> <br>  in the <i>applicationDidFinishLaunching</i> handler: we can directly execute the logic of the plugin.  In our case, we will subscribe to notifications for changing the cursor position in the editor, and also add a new item in the Edit menu. <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)applicationDidFinishLaunching:(<span class="hljs-built_in"><span class="hljs-built_in">NSNotification</span></span>*)notification { [[<span class="hljs-built_in"><span class="hljs-built_in">NSNotificationCenter</span></span> defaultCenter] addObserver:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> selector:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(selectionDidChange:) name:<span class="hljs-built_in"><span class="hljs-built_in">NSTextViewDidChangeSelectionNotification</span></span> object:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">NSMenuItem</span></span>* editMenuItem = [[<span class="hljs-built_in"><span class="hljs-built_in">NSApp</span></span> mainMenu] itemWithTitle:<span class="hljs-string"><span class="hljs-string">@"Edit"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (editMenuItem) { [[editMenuItem submenu] addItem:[<span class="hljs-built_in"><span class="hljs-built_in">NSMenuItem</span></span> separatorItem]]; <span class="hljs-built_in"><span class="hljs-built_in">NSMenuItem</span></span>* newMenuItem = [[<span class="hljs-built_in"><span class="hljs-built_in">NSMenuItem</span></span> alloc] initWithTitle:<span class="hljs-string"><span class="hljs-string">@"Show autoresizing masks"</span></span> action:<span class="hljs-keyword"><span class="hljs-keyword">@selector</span></span>(toggleMasks:) keyEquivalent:<span class="hljs-string"><span class="hljs-string">@"m"</span></span>]; [newMenuItem setTarget:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>]; [newMenuItem setKeyEquivalentModifierMask:<span class="hljs-built_in"><span class="hljs-built_in">NSAlternateKeyMask</span></span>]; [[editMenuItem submenu] addItem:newMenuItem]; [newMenuItem release]; } }</code> </pre> <br>  For example, we will output a line by changing the cursor position: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)selectionDidChange:(<span class="hljs-built_in"><span class="hljs-built_in">NSNotification</span></span>*)notification { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([[notification object] isKindOfClass:[<span class="hljs-built_in"><span class="hljs-built_in">NSTextView</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]]) { <span class="hljs-built_in"><span class="hljs-built_in">NSTextView</span></span>* textView = (<span class="hljs-built_in"><span class="hljs-built_in">NSTextView</span></span> *)[notification object]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (![[<span class="hljs-built_in"><span class="hljs-built_in">NSUserDefaults</span></span> standardUserDefaults] boolForKey:kDLShowSizingsPreferencesKey]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span>* selectedRanges = [textView selectedRanges]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (selectedRanges.count &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">NSRange</span></span> selectedRange = [[selectedRanges objectAtIndex:<span class="hljs-number"><span class="hljs-number">0</span></span>] rangeValue]; <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *text = textView.textStorage.string; <span class="hljs-built_in"><span class="hljs-built_in">NSRange</span></span> lineRange = [text lineRangeForRange:selectedRange]; <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *line = [text substringWithRange:lineRange]; } <span class="hljs-built_in"><span class="hljs-built_in">NSAlert</span></span> *alert = [[[<span class="hljs-built_in"><span class="hljs-built_in">NSAlert</span></span> alloc] init] autorelease]; [alert setMessageText:line]; [alert runModal]; }</code> </pre> <br>  The simplest, nothing useful plugin is ready! <br><br><h5>  Remarks </h5><br>  As I said above, debugging of the plugin is possible only by restarting Xcode (when I wrote the plugin, I put NSAlert everywhere and output the necessary information).  Due to the fact that there is no documentation as such, in order to find the desired view in the hierarchy, or to find out which notifications are being sent, it is necessary to perform the same trick: output the information either to a log or to an alert.  If the plugin crashes, Xcode will not start, and the plugin must be removed from '~ / Library / Application Support / Developer / Shared / Xcode / Plug-ins'. <br><br><h5>  More functional example </h5><br>  The prerequisite for writing this article was a small plugin written by me that displays the auto-sizing masks for UIView: <br><br><img src="https://habrastorage.org/storage2/0ff/527/d0c/0ff527d0c0acdbc1b0e9cfb2b48da851.png"><br><br>  Source code on <a href="https://github.com/garnett/AutoresizeMask-for-Xcode">github</a> . <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/163795/">https://habr.com/ru/post/163795/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../163773/index.html">The thorny path in the Windows Store</a></li>
<li><a href="../163775/index.html">Frame-by-frame animations and shaders in iOS</a></li>
<li><a href="../163777/index.html">EBS Performance Tests</a></li>
<li><a href="../163791/index.html">Game Patcher Development</a></li>
<li><a href="../163793/index.html">Ultrabook Review MicroXperts MXP U400</a></li>
<li><a href="../163797/index.html">Manifesto of free information space</a></li>
<li><a href="../163807/index.html">Facebook? Twitter? Instagram? We all did it 40 years ago.</a></li>
<li><a href="../163811/index.html">How to become a puppeteer or Puppet for beginners</a></li>
<li><a href="../163813/index.html">Introduction to the development of WinRT applications in HTML / JavaScript. Styling applications</a></li>
<li><a href="../163815/index.html">New IBM programs for students and IT professionals</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>