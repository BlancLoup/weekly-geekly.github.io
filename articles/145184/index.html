<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Electronic thermometer with web interface based on UniPing RS-485</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As is known, the phenotype of an organism is formed under the influence of a genotype and the environment. One of my projects is the WheatPGE system f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Electronic thermometer with web interface based on UniPing RS-485</h1><div class="post__text post__text-html js-mediator-article">  As is known, the phenotype of an organism is formed under the influence of a genotype and the environment.  One of my projects is the <a href="http://wheatdb.org/">WheatPGE</a> system for analyzing the relationship between the genotype, phenotype and the environment in wheat.  In summer, plants are grown in the field.  After the season, I wanted to have access to detailed meteorological data, precisely in the place where the plants grew.  These data are necessary for comparing them with genotypes and various phenotypic characteristics of plants and conducting various statistical analyzes. <br><br>  The field where biologists work is located at some distance from the building into which we could get access, the ability to install our equipment and use the Internet. <br><a name="habracut"></a><br>  In the diagram, the sensor installation location is indicated by a red dot.  The main sights are also noted: the cooling fountains of the Institute of Nuclear Physics, the Karasik shop and the field where plants are grown.  All this is in the Novosibirsk Academgorodok. <br><br><img src="https://habrastorage.org/storage2/463/cf5/320/463cf5320e12e719f233c5d53a0c8e89.png" alt="sensor installation location">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Device selection </h4><br>  The task was to find a device capable of reading environmental parameters and transmit data over an Ethernet network.  At the same time, there was almost no time for experiments and reflections, since  After two weeks, the sowing campaign was to begin, and by that time everything was supposed to work.  On eBay, they sell a huge array of inexpensive Chinese devices that cost about $ 100, and there are projects like pywws that provide data reading from such devices.  However, shipping from eBay would take a lot of time.  At the same time, it‚Äôs not a fact that in the end we would get what we wanted.  In the meantime, I came across an article with a positive review about <a href="http://www.netping.ru/">NetPing devices</a> .  In general, they specialize in devices for security systems and administration, but among other things they produce temperature and humidity sensors.  It was decided to order from them. <br><br><h4>  Order and description of UniPing RS-485 </h4><br>  A device was ordered that reads data from various sensors, the temperature and humidity sensor itself, and the sensor extension for 4 meters: <br><ul><li>  WS-1 humidity sensor (1 m) - 1,056 p. </li><li>  Extension (4 m) - 160 p. </li><li>  UniPing RS-485 device - 2,700 r. </li><li>  Delivery of the order (Express mail), SERVICE - 1 130 r. </li><li>  Total - 5 046 p. </li></ul><br>  For our purposes, RS-485 and RS-232 are completely identical.  The choice of RS-485 due to its presence in stock. <br><img src="https://habrastorage.org/storage2/541/b34/87c/541b3487ca11276c88459b9bd2ea9987.png" alt="RS-485"><br>  In the photo UniPing RS-485.  Delivery set: device, power adapter, mating connector, adapter for contact sensors.  The humidity sensor is not a contact.  Thermal sensors - are.  Here is such a strange logic.  Therefore, the adapter for contact sensors will not be used. <br><br>  To UniPing RS-485, you can connect one humidity sensor and 4 temperature sensors.  To connect several sensors, it is better to use the NetPing Connection board, otherwise you will have to solder everything yourself.  It is not included in the delivery package and must be ordered separately. <br><br>  The humidity sensor allows you to get the value of the relative humidity in percent.  Also, the humidity sensor allows you to measure temperature.  Accuracy of humidity measurement + -4.5%.  Accuracy of temperature measurement 0,5. <br><br><img src="https://habrastorage.org/storage2/f21/e9a/000/f21e9a000748d1351bbe1d1ded0b7a67.png" alt="humidity sensor"><br><br>  Just a temperature sensor is cheaper than a humidity sensor: 352.  in a waterproof case and 176r.  for the usual. <br><br><h4>  Connection of the humidity sensor </h4><br>  To connect the humidity sensor, you must use the counterpart of the DHS-44 connector.  Below is a wiring diagram: <br><table><tbody><tr><td>  Color loop </td><td>  DHS-44 contact number </td></tr><tr><td>  Yellow </td><td>  28 </td></tr><tr><td>  Green </td><td>  32 </td></tr><tr><td>  Red </td><td>  23 </td></tr><tr><td>  The black </td><td>  24 </td></tr></tbody></table><br>  DHS-44M numbering (numbers are indicated on the connector itself and its counterpart) <br><br><img src="https://habrastorage.org/storage2/819/221/876/819221876993afb79a9746e732c7de09.png" alt="DHS-44M"><br><br>  The documentation says that for long loops, more than 2 meters, it is recommended to additionally include a 10K resistor between pins 28 and 24. But I didn‚Äôt have to do that, because  and without that, everything works well, although I use a 5-meter-long train. <br><br><h4>  Communication with customer support </h4><br>  When trying to turn on the device revealed the first and only trouble.  The device did not turn on.  Diagnostics showed that the power supply is not working.  Posted in NetPing support.  He asked what we would do.  They offered to come to them in Moscow with a non-working unit and replace them.  I objected that this option is not acceptable to me.  They offered to send a block that does not work by mail, they will check it and if there is a problem, they will send a new one.  At the same time transfer back and forth at my expense!  Again he objected that at the same time the cost of shipping would exceed the cost of the unit itself many times.  After that, they made concessions: they suggested that I send them not a working unit at their own expense, but they will send a new one for me.  After that, I thanked the support, went to the radio store and found a unit with exactly the same characteristics and connector for 250 rubles.  Lucky. <br><br>  The summary of this short story is as follows: NetPing does not test its products before sending it to the customer.  Even does not try to include!  There are no complaints about support - they simply follow the guidelines of the company.  But it could be all very different, <a href="http://habrahabr.ru/post/143718/">here is a great example</a> . <br><br><h4>  Device setup </h4><br>  UniPing RS-485 has a built-in web-interface for editing settings.  We go there and change the network settings and administrator password.  Network settings can only be set statically.  Here you can see which sensors are connected to the device and make sure that they work.  At this setting is over. <br><br><h4>  We read data from the sensor </h4><br>  NetPing devices support SNMP v1 operation.  Data acquisition via the SNMP v1 protocol is reduced to reading special addresses inside the device, called OIDs.  To obtain the values ‚Äã‚Äãof humidity and temperature, you need to know the OID, which correspond to these parameters.  A list of all OIDs supported by the device can be read from a MID file.  In fact, a MID file is a firmware, or rather its description.  It can be downloaded from the device manufacturer's website.  To work with a MID file, I used the iReasoning MIB Browser program - it is free.  With its help, the necessary OIDs were obtained.  I quote a perl script that receives data via SNMP and writes it to the MySQL database.  This script is placed in cron, which is triggered every hour. <br><br><pre><code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl use strict; use warnings; use DBI; use Net::SNMP; #     my $database_login = 'login'; my $database_passwd = 'password'; my $database_name = 'db_name'; #    my $dbh = DBI -&gt; connect("DBI:mysql:$database_name;host=localhost;", $database_login, $database_passwd) || die $DBI::errstr; #    my $snmp_host = '172.25.13.5'; # IP  hostname my $snmp_community = 'SWITCH'; # SNMP Community # my $snmp_oid_temperature = '.1.3.6.1.4.1.25728.8400.2.4.0'; # OID   #  my $snmp_oid_humidity = '.1.3.6.1.4.1.25728.8400.2.2.0'; # OID   #    #  -varbindlist      OID' #  $result     : OID =&gt;  my $snmp_session = Net::SNMP-&gt;session( -hostname =&gt; $snmp_host, -community =&gt; $snmp_community, -version =&gt; 1, #     ) or die "can't connect"; my $result = $snmp_session-&gt;get_request(-varbindlist =&gt; [$snmp_oid_temperature,$snmp_oid_humidity]) or die "can't execute request\n"; #   print "$result-&gt;{$snmp_oid_temperature}\n$result-&gt;{$snmp_oid_humidity}\n"; #     $dbh -&gt; do("INSERT INTO netping1 SET temperature=\"$result-&gt;{$snmp_oid_temperature}\", humidity=\"$result-&gt;{$snmp_oid_humidity}\"") || die $DBI::errstr;</span></span></code> </pre> <br><br><h4>  API </h4><br>  To access the database data, a simple API was implemented that returns data in JSON format.  The data is returned as a two-dimensional array and sorted by time.  An example of such an array of two elements: <br><br><pre> <code class="javascript hljs">[[ <span class="hljs-number"><span class="hljs-number">1338541272000</span></span>, #       <span class="hljs-number"><span class="hljs-number">12</span></span>, #  <span class="hljs-number"><span class="hljs-number">53</span></span> #  ], [ <span class="hljs-number"><span class="hljs-number">1338544861000</span></span>, #       <span class="hljs-number"><span class="hljs-number">14</span></span>, #  <span class="hljs-number"><span class="hljs-number">49</span></span> #  ]]</code> </pre><br><br>  The following is now available: <br><br><pre> <code class="javascript hljs">http:<span class="hljs-comment"><span class="hljs-comment">//wheatdb.org/weather/json/now -     http://wheatdb.org/weather/json/1 -       http://wheatdb.org/weather/json/3 -      3  http://wheatdb.org/weather/json/7 -       http://wheatdb.org/weather/json/30 -      30  http://wheatdb.org/weather/json/0 -      </span></span></code> </pre><br><br><h4>  Web interface </h4><br>  The implemented web-interface is available by <a href="http://wheatdb.org/weather">reference</a> .  In the case of the Habro Effect I also provide a screenshot. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f1/66f/b6d/4f166fb6d88d2555843a8dfbc8b59dde.png" alt="Web interface"><br><br>  The interface shows the current values ‚Äã‚Äãof humidity, temperature and graphs of changes in these values.  For the construction of graphs used library HighStock, free for non-commercial use.  Given the already implemented API, the client-side code looks very simple: <br><br><pre> <code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"http://wheatdb.org/static/js/stock/highstock.js"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span> src=<span class="hljs-string"><span class="hljs-string">"http://wheatdb.org/static/js/stock/modules/exporting.js"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $.getJSON(<span class="hljs-string"><span class="hljs-string">"http://wheatdb.org/weather/json/3"</span></span>,{}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// split the data set var t = [], h = [], dataLength = data.length; for (i = 0; i &lt; dataLength; i++) { t.push([ data[i][0], // date data[i][1] // temperature ]); h.push([ data[i][0], // date data[i][2] // humidity ]) } // Create the chart window.chart = new Highcharts.StockChart({ chart : { renderTo : 'container' }, rangeSelector : { selected : 1 }, title : { text : '' }, yAxis: [{ title: { text: 'Temperature' }, height: 150, lineWidth: 2 }, { title: { text: 'Humidity' }, top: 220, height: 150, offset: 0, lineWidth: 2 }], series : [{ name : 'Temperature', type : 'area', data : t, marker : { enabled : true, radius : 3 }, shadow : true, tooltip : { valueDecimals : 0 }, fillColor : { linearGradient : { x1: 0, y1: 0, x2: 0, y2: 1 }, stops : [[0, Highcharts.getOptions().colors[0]], [1, 'rgba(0,0,0,0)']] } } , { name : 'Humidity', type : 'area', data : h, marker : { enabled : true, radius : 3 }, shadow : true, tooltip : { valueDecimals : 0 }, fillColor : { linearGradient : { x1: 0, y1: 0, x2: 0, y2: 1 }, stops : [[0, Highcharts.getOptions().colors[1]], [1, 'rgba(0,0,0,0)']] }, yAxis: 1 }] }); }); }); &lt;/script&gt; &lt;div id="container" style="height: 500px; min-width: 500px"&gt;&lt;/div&gt;</span></span></code> </pre><br><br><h4>  findings </h4><br>  The system has been running for about a month.  No failures were detected, the data is read correctly.  In general, the selected device showed its applicability to the task.  I would be very grateful if in the comments you share your experience of automatically obtaining data on the state of the environment.  Particularly interested in wireless solutions. </div><p>Source: <a href="https://habr.com/ru/post/145184/">https://habr.com/ru/post/145184/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145177/index.html">Comparative performance testing of OpenOffice and LibreOffice</a></li>
<li><a href="../145178/index.html">Effective use of WebAPI: self hosting REST services</a></li>
<li><a href="../145180/index.html">Who works here or how to quickly find out information about callback for Drupal‚Äôs menu</a></li>
<li><a href="../145181/index.html">Pay mobile tax?</a></li>
<li><a href="../145183/index.html">Upgrade to Windows 8 inexpensively. Opening of the Russian portal</a></li>
<li><a href="../145185/index.html">How to withdraw Paypal in Russia? How to open a virtual account in the US?</a></li>
<li><a href="../145186/index.html">Podcast "Notes on Qt" s01e05</a></li>
<li><a href="../145187/index.html">Cross platform work with strings in C ++</a></li>
<li><a href="../145188/index.html">What is silent about the Random Number Generator from Intel?</a></li>
<li><a href="../145189/index.html">Troubleshooting Apache Ports on Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>