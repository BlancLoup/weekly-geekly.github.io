<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I did not hack "Habrahabr" or 10+ active XSS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seeing how everyone rushed to look for XSS on a beautiful blue Habrahabr decided to try his luck. POST self-xss, useless in many contexts and vectors,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As I did not hack "Habrahabr" or 10+ active XSS</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/1c9/d0b/fdd/1c9d0bfddde628eea0f43e550089538f.png" alt="image"><br>  Seeing how everyone rushed to look for XSS on a beautiful blue Habrahabr decided to try his luck.  POST self-xss, useless in many contexts and vectors, starting with filtering in the most popular browsers (chrome / safari / ie etc) and ending with the complexity of their application and operation, it was decided to leave the rest of the pioneers and go in search of something more standing <br><a name="habracut"></a><br><h4>  Attempt number one </h4><br>  First, it was decided to check the authorization and registration.  I missed that ‚Äúwonderful‚Äù XSS found in <a href="http://habrahabr.ru/post/197466/">this post</a> , apparently being late for several days (and what would have happened if the thought came to search a little earlier?).  I'm not a fan of abstruse XSS search and test tools, and I prefer the very convenient functionality built into Chrome, which allows you to copy all the headers in curl and use them through the console. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4e6/1ee/53e/4e61ee53ef01e6954eb2c860e81d484c.png" alt="image"><br><br>  After playing with the parameters and finding nothing, out of habit, I checked how the 302 redirect works in the wrong way and it turned out that it was not at all like on the main domain. <br>  Sending to the server: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>curl 'https://auth.habrahabr.ru//%22%3E%3Ch1%3Etest'</code> <br> <br>  A very interesting answer was received: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> !<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://habrahabr.ru/auth/"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>test/"&gt;http://habrahabr.ru/auth/&amp;quot;&amp;gt;&amp;lt;h1&amp;gt;test/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  As you can see from the request, the first insertion of uri is not filtered, the second is filtered, which at first glance causes XSS.  However, having tried the attack through normal browsers and not seeing the promised XSS, I decided to dig deeper and saw that the tricky server not only adds slash to the end, because of which the server showed us 404 instead of a redirect (rather strange rule for a web server?), So also throws on <a href="http://habrahabr.ru/auth/%25xss%25">habrahabr.ru/auth/%xss%</a> before it has time to execute js from our bugs.  The first problem was solved easily and quickly - all that had to be done was to put the "?", So that everything else would be ‚Äúdropped‚Äù as the GET parameter: <br><br> <code>curl 'https://auth.habrahabr.ru//%22%3E%3Ch1%3Etest?'</code> <br> <br>  Now the answer was: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> !<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://habrahabr.ru/auth/"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>test?/"&gt;http://habrahabr.ru/auth/&amp;quot;&amp;gt;&amp;lt;h1&amp;gt;test?/<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  The second problem I did not manage to solve.  The code stubbornly did not have time to execute, except on IE &lt;8 or through the same Kurl. <br>  What I just did not try with grief, for example, to remove the meta-refresh: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mr = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"meta-refresh"</span></span>); mr.parentNode.removeChild(mr);</code> </pre><br><br>  But, unfortunately, the zero refresh time did not leave me any chances and I went on a further search, as I was not satisfied with such a lack of vulnerability. <br><br><h4>  Attempt number 2 </h4><br>  After the first file, it was decided not to give up and try their hand at other parts of the site.  Using the magical and timeless Google found several old and new pages of paid promo various companies.  The latest promo pages resisted all attacks very seriously, the output data was escaped, in some places even twice.  Remembering the various contests where Habr allows ordinary mortals to register, I went to <a href="http://habrahabr.ru/special/miss/">habrahabr.ru/special/miss</a> , tried to use a nickname with special characters in the registration: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d6e/9ce/006/d6e9ce00646d39a15099b33bc5e50700.png" alt="image"><br><br>  Confirming the registration, I saw a long-awaited alert: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/785/d66/209/785d66209a9d507d3b08042600f0a6b0.png" alt="image"><br><br>  It was impossible to dwell on it, because it is displayed after authorization, in the block that the user sees.  You could of course authorize the user through CSRF (it was just in the form of authorization), and then redirect him to our XSS, but these are not our methods. <br><br>  Not finding my ID in any cookie or anywhere else, I began to search through the maximum profile id and found it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/33f/126/a88/33f126a888e168daab435897bd31f3ea.png" alt="image"><br><br>  Perhaps it was possible to stop at this and report to the administration, there is an active XSS, she is not afraid of any browser filters ... but ... but we wanted more! <br><br><h4>  Google power </h4><br>  habrahabr active xss dork: <br> <code>site:.habrahabr.ru/special inurl:register <br></code> <br><br>  Google gave about 10+ results, of which the majority were, some were barely working at all, were partially covered, such as <a href="http://habrahabr.ru/special/panasonic/3d/">habrahabr.ru/special/panasonic/3d</a> . <br>  I tried to register and saw a bummer: the panel with the username did not open, the comments were not sent ... nothing worked.  Nothing worked until I looked at the source of the page and saw a wonderful thing: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb7/2e1/181/bb72e118177d79e0d9e669be9f2fa6db.png" alt="image"><br><br>  An attentive person would immediately add the nickname to the beginning when registering "-&gt;" and get a fully working website: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b3e/9c2/763/b3e9c276374f16add50fa89bd4efb6ae.png" alt="image"><br><br>  What in html-ke looked like: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d12/1d7/787/d121d7787d8ec11fee42a9d800701eed.png" alt="image"><br><br>  Then I walked through all sorts of hurry pages and collected screenshots for the administration and this article. <br>  XSS in profile output in comments: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/33a/dd8/1e5/33add81e57bd8d9f17d140779b2d4169.png" alt="image"><br><br><div class="spoiler">  <b class="spoiler_title">Similar XSS on a couple more projects:</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/194/1cb/673/1941cb673e5eb183705e6ea242ba3432.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/254/ae3/0de/254ae30de66cd5d04d9b0dd52c2ab681.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c4/68d/509/6c468d50967b9bbe614cd7f2bb797e4d.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/215/e25/f97/215e25f97841c7b4eb41502004fd5703.png" alt="image"><br></div></div><br><br><h4>  Results </h4><br>  As a result, more than 10 active XSSs were found (there were about three different types of truth, though, and one passive XSS under one, for which I received 100,500 gift invites!)  Maybe I missed the non-indexed pages, or simply did not notice the unfiltered output of data in some places of these promo, but at the moment everything is promptly corrected by the administration, for which she thanks a lot! </div><p>Source: <a href="https://habr.com/ru/post/197672/">https://habr.com/ru/post/197672/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../197656/index.html">Meeting of IT managers in Kazan: combining business with pleasure</a></li>
<li><a href="../197658/index.html">A 13-year-old teenager solved a cryptographic puzzle of the British government communications headquarters.</a></li>
<li><a href="../197666/index.html">Package Caching for Composer</a></li>
<li><a href="../197668/index.html">The new 280-megawatt "solar" power plant can operate for 6 hours after sunset</a></li>
<li><a href="../197670/index.html">Drupal 8 - Revolutionary Changes</a></li>
<li><a href="../197674/index.html">AppCode 2.5 released</a></li>
<li><a href="../197676/index.html">Tale of traffic</a></li>
<li><a href="../197680/index.html">Target-Oriented Automation of Control Systems - DIACS / GOMA</a></li>
<li><a href="../197684/index.html">The worst thing about Microsoft</a></li>
<li><a href="../197688/index.html">Video review smartphone Cat B15</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>