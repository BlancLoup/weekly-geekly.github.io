<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Deployer - convenient and flexible application deployment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Undoubtedly, the topic, I think, has been jaded by many holes - nevertheless, it must be done for each project - but I will raise it and tell you abou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Deployer - convenient and flexible application deployment</h1><div class="post__text post__text-html js-mediator-article"><p>  Undoubtedly, the topic, I think, has been jaded by many holes - nevertheless, it must be done for <em>each</em> project - but I will raise it and tell you about one wonderful tool, which, for some strange reason, is still not wrote on Habr√©, and indeed in the Russian-language segment somehow there is little written about him.  Correct this misunderstanding. </p><br><p>  Deployer is good in many ways.  The script code for deployment is short.  It is written in good old Pykhchansky - that is, most likely, you will not have to install any other tools separately on the server.  If it does, then PHP is usually installed by a single command on any server.  Why not use it in your projects? <a name="habracut"></a></p><br><p>  I wrote a utility, a certain Anton Medvedev, by the way, he has a <a href="http://medv.io/">rather nice blog</a> .  Thank you, Anton :) </p><br><p>  <a href="https://github.com/deployphp/deployer/commit/383572dc3dc8828acde6ef12500249a0cbc6ca74">The first commit</a> was made already in 2013, and so far the tool is slowly developing.  He also has a <a href="http://deployer.org/">nice website</a> where you can find all the documentation about him. </p><br><p>  What I personally like the most about what this tool gives is the ability to quickly roll back to the last ‚Äúworking‚Äù release if the new release was unsuccessful.  It is also quite convenient that if you try to ‚Äúroll out‚Äù a new release, something will go wrong (the migrations did not apply, the front-end files did not compile, the tests did not get out ..) - then your current running application will not affect it - it will work as if nothing had happened.  The fact is that Deployer will not change the link in the directory denoting the current active release until your new "release" is fully installed and ready to go. </p><br><p>  The only thing that Deployer does not solve is possible problems with applying migrations to your database.  But this is generally a difficult topic, I don‚Äôt know if there are any elegant solutions in this case at all.  If it exists, I will be glad to know which one. </p><br><h1>  Release folder structure </h1><br><p> The whole project is divided into three folders: <code>current</code> , <code>releases</code> and <code>shared</code> .  In general, this is a fairly common form for such tools, and it is really convenient.  Say, in one of my projects on Laravel, this structure looks like this: </p><br><p><img src="https://habrastorage.org/files/ad3/5ac/e37/ad35ace374a644e6b5cf8e9f149d095b.png"></p><br><p>  <code>current</code> - link to the folder of the last successfully collected release, i.e.  current application. <br>  <code>releases</code> - all releases that have been compiled.  By default, only the last three releases are saved, and this value can be easily changed. <br>  <code>shared</code> is the folder where all the "common" files are located, which apply to all releases at the same time and should not be created anew each time.  For example, an <code>.env</code> file, user-uploaded files, and so on. </p><br><h1>  Sample Laravel Deploy Application Script </h1><br><p>  I like to personally go to my server, run the deployment script and watch the process of its work.  Simply, I am so much safer to live, since I can always take some urgent measures if something goes wrong with the Deploy.  And as I know, people usually run a similar script from their local machine, which connects via SSH to the server and produces warmth.  If this needs to be done on several machines at once, then this approach will certainly be more convenient.  By the way, Deployer allows deploying multiple machines at once. </p><br><p>  Naturally, before you can run this script, you must first <a href="http://deployer.org/docs/installation">install Deployer</a> on your system. </p><br><p>  In one of my projects on Laravel 5 the deployment script <code>deploy.php</code> looks like this: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//     Deployer' require 'recipe/common.php'; require 'recipe/laravel.php'; //     localServer('local', 'localhost') -&gt;user('{-}') -&gt;env('deploy_path', '/path/to/project/dir') -&gt;stage('local') ; set('repository', '{-git-.git}'); env('branch', '{--}'); env('git_cache', true); //     ,       //        ,     //        shared set('shared_dirs', [ 'storage/app', 'storage/framework/cache', 'storage/framework/sessions', 'storage/framework/views', 'storage/logs', 'public/uploads', 'node_modules', ]); //  .    ,    //    Laravel    ""   //  - .env set('shared_files', ['.env']); // ,       //  .    -    set('writable_dirs', ['storage', 'vendor', 'public/uploads' ]); set('http_user', '{-}'); set('composer_command', '/usr/local/bin/composer'); //    Composer' //   .  NPM  task('deploy:install-npm', function() { run('cd {{release_path}} &amp;&amp; npm i'); }); //   :    ,    //    Grunt.js task('deploy:compile-assets', function() { run('cd {{release_path}} &amp;&amp; grunt deploy-production'); }); //   task('deploy:migrations', function() { run('cd {{release_path}} &amp;&amp; php artisan migrate --force'); }); //      task('deploy:create-route-cache', function() { run('cd {{release_path}} &amp;&amp; php artisan route:cache'); }); //      task('deploy:create-config-cache', function() { run('cd {{release_path}} &amp;&amp; php artisan config:cache'); }); //     task('deploy:clean-cached-data', function() { run('cd {{release_path}} &amp;&amp; rm bootstrap/cache/*'); }); //  PHP    task('reload:php-fpm', function() { run('sudo /usr/sbin/service php7.0-fpm restart'); }); task('deploy', [ 'deploy:prepare', 'deploy:release', 'deploy:update_code', //      'deploy:shared', //      'deploy:vendors', //    'deploy:clean-cached-data', //     'deploy:create-route-cache', //      'deploy:create-config-cache', //      'deploy:install-npm', //  NPM  'deploy:compile-assets', //    'deploy:migrations', //   'deploy:symlink', //       'cleanup', //    ])-&gt;desc('Deploy your project'); after('deploy', 'success'); //    php after('deploy', 'reload:php-fpm'); //      -    after('rollback', 'reload:php-fpm');</span></span></code> </pre> <br><p>  I also have a couple of small files next to the above file: <code>start-deploy.sh</code> and <code>rollback-deploy.sh</code> .  In order to quickly launch the patch or, accordingly, roll it back. </p><br><p>  File <code>start-deploy.sh</code> : </p><br><pre> <code class="bash hljs">dep deploy <span class="hljs-built_in"><span class="hljs-built_in">local</span></span></code> </pre> <br><p>  File <code>rollback-deploy.sh</code> : </p><br><pre> <code class="bash hljs">dep rollback <span class="hljs-built_in"><span class="hljs-built_in">local</span></span></code> </pre> <br><p>  Therefore, in order to start the deployment process, we need to type only one command in Bash: </p><br><pre> <code class="bash hljs">./start-deploy.sh</code> </pre> <br><p>  Thus, as we see, having entered only one command, we will force the server to execute all necessary steps for expansion of our project.  And only if everything went well, the <code>current</code> folder will change the link to the new release and restart PHP after all this. </p><br><p>  In general, this is all that I wanted to tell and show.  I hope it will be useful to someone.  And of course it will be interesting to know the opinion of other people about how they are engaged in deploying their applications. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/302442/">https://habr.com/ru/post/302442/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302426/index.html">Broadcaster for MacBook. Facebook Edition</a></li>
<li><a href="../302428/index.html">Model-View in QML. Part Four: C ++ Models</a></li>
<li><a href="../302430/index.html">Habrahabr articles citation graph</a></li>
<li><a href="../302432/index.html">We use HTML and WebBrowser control as a UI for ordinary windows applications in C #</a></li>
<li><a href="../302438/index.html">Creating a blog on symfony 2.8 lts [Part 3]</a></li>
<li><a href="../302448/index.html">‚ÄúNo longer means better‚Äù: counterintuitive case from Google</a></li>
<li><a href="../302456/index.html">Haordic Organization Visa (Part 3)</a></li>
<li><a href="../302458/index.html">We write our malware. Part 1: Learn to write a completely ‚Äúundetectable‚Äù keylogger</a></li>
<li><a href="../302460/index.html">Migrating HipChat Server data from self-hosted VM to Amazon EC2</a></li>
<li><a href="../302462/index.html">Year with Runkeeper: Analysis and visualization of geodata about your travels</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>