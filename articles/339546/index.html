<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Program copy counter or usage statistics collection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I carried out an order for one office. The essence of the project is not important now (it was a certain appendage to their corporate sy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Program copy counter or usage statistics collection</h1><div class="post__text post__text-html js-mediator-article">  Some time ago I carried out an order for one office.  The essence of the project is not important now (it was a certain appendage to their corporate system, which they put on computers to their clients), one of the requirements was that the application sent a report on its use.  And simply speaking, the guys wanted to know how much their program is in demand among customers.  And on this wave, I had a question - but really, you wrote the program, gave it | sold it in good hands, or simply put it on the Internet.  So, what is next?  How many real users have seen it? <br><a name="habracut"></a><br>  If the program is sold, then the number of buyers can be easily calculated by the sold licenses or keys - this is someone like that.  But if it is free, then there will be problems.  Count the number of downloads from offsite (if any) is meaningless, because  If something hits the Internet, it will begin to multiply and crawl along wares resources and torrent trackers. <br><br>  The solution attached here gives a not-so-detailed report, and does not collect as much data (I simply did not need it), such as Software Statistics Service (but it, if it does not change me, is also paid).  But there is a plus: the system can always be finished to its own need. <br><br>  I do not pretend to originality, probably something like that already exists, I didn‚Äôt particularly look for it.  I tried to write in detail, it even became like a student's term paper.  In general, perhaps someone will come in handy and it will be interesting. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Individuality </h2><br>  So, our program has spread all over the world, and now we want to know how global it is.  First you need to decide how we will distinguish one copy from another.  The first thing that comes to mind is a GUID.  For example, generate it when installing or when you first start the application, and save it to a file or to the registry.  The advantage of this option is simplicity, but the downside is that the GUID every time you start the installer will be new.  Those.  If the poor fellow should reinstall the system (or, even easier, our program), we will get an overestimated result.  Such a solution is more suitable for counting the number of program installations, rather than the actual number of users, but it is quite acceptable to use it for a rough estimate.  A GUID can be obtained, for example, like this: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> guid = Guid.NewGuid().ToString(); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"guid: {0}"</span></span>, guid);</code> </pre> <br>  A more accurate result will be given by linking a copy of the program to the computer hardware.  But, here we must keep in mind that when upgrading (for example, replacing the HDD) HardwareID will also change.  Therefore, it is better to take as a data source what lasts the longest.  This may be a motherboard or processor, since  they tend to change when the computer is completely replaced.  Below is the code that extracts the CPU ID and MotherBoard ID, and calculates the md5 hash from them. <br><br>  The result can already be used for identification. <br><br><div class="spoiler">  <b class="spoiler_title">Gethid</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHID</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> CPUid = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> MtbId = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> DiskId = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> HID = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; ManagementObjectSearcher mos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ManagementObjectSearcher(); <span class="hljs-comment"><span class="hljs-comment">//  mos.Query = new ObjectQuery("Select * From Win32_processor"); foreach (ManagementObject mo in mos.Get()) { try { CPUid = mo["ProcessorID"].ToString(); } catch { } } //   mos.Query = new ObjectQuery("SELECT * FROM Win32_BaseBoard"); foreach (ManagementObject mo in mos.Get()) { try { MtbId = mo["SerialNumber"].ToString(); } catch { } } //   ManagementObject dsk = new ManagementObject(@"win32_logicaldisk.deviceid=""C:"""); try { DiskId = dsk["VolumeSerialNumber"].ToString(); } catch { } Byte[] Bytes = Encoding.ASCII.GetBytes(CPUid + MtbId + DiskId); if (Bytes.Length == 0) return ""; MD5 md5 = MD5.Create(); Byte[] HidBytes = md5.ComputeHash(Bytes); foreach (Byte b in HidBytes) HID += b.ToString("X2"); return HID; }</span></span></code> </pre><br></div></div><br>  The method has added another Volume Serial hard disk, because  in virtual environments, CpuID and the serial number of the motherboard may not be detected (I, at least, flew zeroes or exceptions). <br><br>  For information about hardware, WMI is used.  Do not forget to connect the corresponding namespace: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Management;</code> </pre> <br>  And in References add the WMI assembly of the same name contains a <a href="https://msdn.microsoft.com/en-us/library/aa389273%2528v%3Dvs.85%2529.aspx">huge number of classes</a> that allow you to pull out almost any information about the system, so if you want, you can expand the list. <br><br><h2>  How it works </h2><br>  Now it's time to set the algorithm of work, and determine what data will take part in the life cycle of our system.  In order not to complicate the decision for data exchange we will use the HTTP protocol.  After all, WEB is the most common service on the Internet, many now have rented or own hosting, so why not expand its functionality?  Therefore, we will not reinvent the wheel, but just sit on it and go. <br>  I was not lazy, and drew a scheme (forgive me UML experts).  As mentioned above, the client and server communicate via HTTP, the client collects the necessary data, and in a POST request sends it to the server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d7e/171/a5b/d7e171a5bc1e1c2833ce0b47ae9250df.png" alt="image"><br><br>  The server is ultimately a PHP script, the task of which is to receive data from the client, check them for validity, and if everything is fine, then save this data in the database, finally, inform the client about the result of the operation performed.  We will determine the following server responses: <br><br><ul><li>  <b>OK</b> - the data passed the test, and successfully saved to the database.  In this case, the client no longer needs to attempt to register the program. </li><li>  <b>COPY_EXIST</b> is a program with the <b>AppName</b> , <b>AppVersion</b> and <b>MachineID</b> already registered.  This suggests that in the previous session, something went wrong.  The program was registered, but the client did not complete the server response.  In this case, the client also no longer needs to break into the server. <br></li><li>  <b>APP_NOT_EXIST</b> ‚Äî The server is not configured to register this program.  The meaning of this answer will become clear later. <br></li></ul><br>  All other server responses will be perceived as an error.  In our case, the client is a software module located inside the application, statistics about which we will collect.  Here is the data that the client sends: <br><br><ul><li>  <b>AppName</b> , <b>AppVer</b> - the name and version of the program. </li><li>  <b>MachineID</b> is that unique identifier. </li><li>  <b>OsVer</b> - operating system version. </li></ul><br>  That was enough for me, but everything is easily expandable. <br>  In addition to the data transmitted by the client, the server also registers the ip address from which the data came and the date. <br><br><h2>  Customer </h2><br>  I wrapped all the client code in a class and called it <b>AppCopy</b> .  Working with him is extremely simple, consider the sequence diagram: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/31d/5f3/dbe/31d5f3dbef270bef0c60415015d11a41.png" alt="image"><br><br>  Here APP is our program, statistics about which we collect.  First, a representative of the AppCopy class is created, and all necessary parameters are passed. <br>  Then you need to call the Registration method, and the class will start doing its thing.  Upon completion, it will initiate the OnRegistrationComplite event, to which the result of the work will be transmitted.  Next, the client decides if the registration is successful, then there is no more need for it, if unsuccessfully, then obviously you need to try again, for example, the next time you start the program.  It all depends on the implementation and the result we want to achieve. <br><br><div class="spoiler">  <b class="spoiler_title">Appcopy</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AppCopy</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   .  Sender -      , // ResultStatus -    public delegate void OnRegistrationRef (AppCopy Sender, RegResult ResultStatus); // .     public event OnRegistrationRef OnRegistrationComplete; //  public string MachineId; //   public string AppName; //   public string AppVersion; //   public string OsVersion; // URL   public string RegUrl; //     public int NumbersAttempts; //     () public int AttemtsInterval; //   public enum RegResult { //   Ok, //  ,     NetworkError, //    id   AlreadyExist, //    . NoAttempts }; //   Thread.       private Thread RegistrationThread; //   public RegResult ResultStatus { get; private set; } //   .    . public string HttpResponsetData { get; private set; } //  public AppCopy(string RegUrl, string MachineId, string AppName, string AppVersion, string OsVersion) { this.MachineId = MachineId; this.OsVersion = OsVersion; this.AppName = AppName; this.AppVersion = AppVersion; this.RegUrl = RegUrl; //===   === NumbersAttempts = 1; AttemtsInterval = 60000; ResultStatus = RegResult.NoAttempts; // ThreadMotion -  . RegistrationThread = new Thread(ThreadMotion); } //   public void Registration() { RegistrationThread.Start(); } //  .     private void ThreadMotion() { //  NumbersAttempts   for (int cntAttemps = 0; cntAttemps &lt; NumbersAttempts; cntAttemps++) { SendRegistrationData(); //      if (ResultStatus == RegResult.Ok || ResultStatus == RegResult.AlreadyExist) break; // ,    AttemtsInterval . Thread.Sleep(AttemtsInterval); } //     OnRegistrationComplete.       OnRegistrationComplete(this, ResultStatus); } //      web .     private RegResult SendRegistrationData() { //  = string postString = "MachineID=" + this.MachineId + "&amp;AppName=" + this.AppName + "&amp;AppVersion=" + this.AppVersion + "&amp;OsVersion=" + this.OsVersion; //     byte[] postBytes = Encoding.UTF8.GetBytes(postString); //     Stream dataStream = null; WebResponse response = null; StreamReader reader = null; try { //      HttpWebRequest request = (HttpWebRequest)WebRequest.Create(this.RegUrl); // ,     POST request.Method = "POST"; //   request.ContentType = "application/x-www-form-urlencoded"; //     request.ContentLength = postBytes.Length; //      dataStream = request.GetRequestStream(); // ""    dataStream.Write(postBytes, 0, postBytes.Length); // ,     response = request.GetResponse(); //       dataStream = response.GetResponseStream(); //     reader = new StreamReader(dataStream); this.HttpResponsetData = reader.ReadToEnd(); /*        .    ""  "EXIST_ID",       ResultStatus   .       . ""     HttpResponsetData */ switch (HttpResponsetData) { //    case "OK": ResultStatus = RegResult.Ok; break; //    case "COPY_EXIST": ResultStatus = RegResult.AlreadyExist; break; //     , APP_NOT_EXISTS,      (40*, 50*) default: ResultStatus = RegResult.NetworkError; break; } } catch { //   . ResultStatus = RegResult.NetworkError; } finally { //===  === if (dataStream != null) dataStream.Close(); if (reader != null) reader.Close(); if (response != null) response.Close(); } return ResultStatus; } }</span></span></code> </pre><br></div></div><br>  I will explain a little.  Working with the network is considered to be ‚Äúlong-playing‚Äù, if the connection is poor (or even without the Internet), the application can ‚Äúhang‚Äù, and the user will press the red cross, or even three buttons.  Therefore, the code working with the web server, I made a separate thread.  Now the interaction with the server will not be noticeable, and will not affect the operation of the main program.  The code is well commented, so I will not linger on it, I will show only an example of how to work with it. <br><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    AppCopy appCopy = new AppCopy("http://test.info/reg_url.php", GetHID(), "Program_name", "Program_ver", GetOsVersion()); //    appCopy.OnRegistrationComplete += RegistrationFinish; appCopy.AttemtsInterval = 10; //  appCopy.Registration(); Console.Read(); } //   private static void RegistrationFinish(AppCopy Sender, AppCopy.RegResult ResultStatus) { Console.WriteLine("Registration result: {0} \nInformation: {1}", ResultStatus, Sender.HttpResponsetData); } private static string GetOsVersion() { ManagementObjectSearcher mos = new ManagementObjectSearcher("SELECT Caption FROM Win32_OperatingSystem"); string name = ""; foreach (ManagementObject mobj in mos.Get()) { try { name = mobj.GetPropertyValue("Caption").ToString(); } catch { }; } return name; }</span></span></code> </pre><br></div></div><br>  The GetOsVersion () function works in the same way as GetHID (), it returns not the version, but rather the name of the OS in the form of ‚ÄúWindows 10 Corporate ...‚Äù.  You can go a simpler way, and just pull out the OS version via .NET: <br><br><pre> <code class="cs hljs">Environment.OSVersion</code> </pre> <br>  But, this option seemed to me less informative. <br><br><h2>  Server </h2><br>  So, our program has collected all the necessary information and sent it to the server.  Now, we have to take this data, check it and, if successful, save it in the database in the proper form.  This will be the server.  In addition, the server should be able to give the collected information, and generate reports in a convenient form. <br><br>  But first, let's look into the database.  Our database consists of three tables: <b>copies</b> , <b>apps,</b> and <b>sum</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/37e/05a/6d1/37e05a6d1a9aed83bbd276697c5b0b71.png" alt="image"><br><br>  The <b>copies</b> table includes 6 fields, the meaning of which is clear from the title.  I will just note that date and ip client is not transmitted, the server script receives them, <b>appid</b> is the program identifier, is an external (FOREIGN KEY) key and forms a link to the <b>apps</b> table.  The latter has three fields: the already known <b>appid</b> , here it is the primary key, <b>appname</b> and <b>appver</b> , respectively, the name and version of the program.  Our system will count only the program name and version of which is listed in this table.  And finally, <b>sum</b> - this is the summary table, the resulting statistics will be stored here.  The table has two fields <b>appid</b> and <b>sum</b> .  It is in the <b>sum</b> field that the total number of registrations is stored. <br><br>  A trigger (tg_new_copy) is attached to the <b>copies</b> table, which is triggered after adding (AFTER INSERT) new data (when registering the next copy).  It increases the value of the <b>sum</b> field in the <b>sum</b> table by one.  Naturally, the change in <b>sum</b> is only that whose <b>appid</b> corresponds to <b>appname</b> and <b>appver of the</b> program <b>being</b> registered. <br><br>  There is a trigger in the <b>apps</b> table (tg_new_app), which also works after adding data.  The task of this trigger is to initialize the <b>sum</b> table. <br><br>  The logic of work is obtained as follows.  Let, we have the application "Program1", version "1.0.0.0".  To let the system know about this program, and start registering it, the first thing to do is add <b>appname</b> and <b>appver</b> to the <b>apps</b> table.  Here is another scheme: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/01b/1e6/46f/01b1e646f2c334bd318bcaf85b918437.png" alt="image"><br><br>  When a new record is added, it is automatically assigned appid (in the diagram above - 1), then the trigger <b>tg_new_app is triggered</b> , which in turn adds a new record sum = 0 with the appid obtained earlier to the table <b>sum</b> . <br><br>  Now everything is ready to collect data about our program.  After adding a new row to the <b>copies</b> table, the <b>tg_new_copy</b> trigger increases the <b>sum</b> field in the table of the same name by one <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f26/5a7/e97/f265a7e97f4e1385646773813a836bdb.png" alt="image"><br><br>  I think enough circuits, let's do programming.  First you need to prepare our database: create tables and triggers, define relationships.  To do this, I made a separate script, which will need to be run only once when the system is deployed.  Database connection parameters, table names, etc.  I rendered it in a separate file, because  They will be needed in several scripts. <br><br><div class="spoiler">  <b class="spoiler_title">config.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//     //    $db_name = 'db_regapps'; //  $db_login = 'db_regapps'; //  $db_pass = '12345678'; //  $db_host = 'localhost'; //  $apps_table_name = 'tb_apps'; $stat_table_name = 'tb_copies'; $sum_table_name = 'tb_sum';</span></span></code> </pre><br></div></div><br>  Now the database setup script: <br><br><div class="spoiler">  <b class="spoiler_title">setup.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'config.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    $db_handle = new mysqli($db_host, $db_login, $db_pass, $db_name); echo "   : &lt;b&gt; "; if ($db_handle-&gt;connect_errno) die(" &lt;/b&gt; ($db_handle-&gt;connect_error)"); else echo " &lt;/b&gt;"; // ===  === echo "&lt;br&gt;  $apps_table_name: &lt;b&gt;"; //     (app) $sql_query = "CREATE TABLE $apps_table_name (appid INT AUTO_INCREMENT NOT NULL PRIMARY KEY, appname VARCHAR(20) NOT NULL, appver VARCHAR(20) NOT NULL) CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB"; $result = $db_handle-&gt;query($sql_query); show_result(); echo "&lt;br&gt;  $stat_table_name: &lt;b&gt;"; //    $sql_query = "CREATE TABLE $stat_table_name (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY, machineid VARCHAR (32) NOT NULL, osver VARCHAR (128), appid INT NOT NULL, date DATETIME, ip VARCHAR(15), FOREIGN KEY fk_stat(appid) REFERENCES $apps_table_name(appid) ON UPDATE CASCADE ON DELETE CASCADE) CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB"; $db_handle-&gt;query($sql_query); show_result(); echo "&lt;br&gt;  $sum_table_name: &lt;b&gt;"; //   $sql_query = "CREATE TABLE $sum_table_name(appid INT NOT NULL , sum INT NOT NULL DEFAULT 0, FOREIGN KEY fk_sum(appid) REFERENCES $apps_table_name(appid) ON UPDATE CASCADE ON DELETE CASCADE) CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB"; $db_handle-&gt;query($sql_query); show_result(); // === === echo "&lt;br&gt;  tg_new_app: &lt;b&gt;"; $sql_query = "CREATE TRIGGER tg_new_app AFTER INSERT ON $apps_table_name FOR EACH ROW BEGIN INSERT INTO $sum_table_name SET appid=NEW.appid; END"; $db_handle-&gt;query($sql_query); show_result(); echo "&lt;br&gt;  tg_new_copy: &lt;b&gt;"; $sql_query = "CREATE TRIGGER tg_new_copy AFTER INSERT ON $stat_table_name FOR EACH ROW BEGIN UPDATE $sum_table_name SET sum= $sum_table_name.sum + 1 WHERE appid=NEW.appid; END"; $db_handle-&gt;query($sql_query); show_result(); $db_handle-&gt;close(); function show_result() { global $db_handle; if($db_handle-&gt;errno) die(" &lt;/b&gt; ($db_handle-&gt;error)"); else echo " &lt;/b&gt;"; }</span></span></code> </pre><br></div></div><br>  I turned the main code into the appstat class: <br><br><div class="spoiler">  <b class="spoiler_title">appstat.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">appstat</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $db_handle; <span class="hljs-comment"><span class="hljs-comment">//       private $last_error; //    private $apps_table_name; //   apps private $stat_table_name; //   copies private $sum_table_name; //   sum //  function __construct($db_name, $db_host, $db_login, $db_pass, $apps_table_name, $stat_table_name, $sum_table_name) { $this-&gt;apps_table_name = $apps_table_name; $this-&gt;stat_table_name = $stat_table_name; $this-&gt;sum_table_name = $sum_table_name; //     $this-&gt;db_handle = mysqli_connect($db_host, $db_login, $db_pass, $db_name); //   $this-&gt;last_error = mysqli_connect_error(); } //    .     ,    appid,  null public function add_app($app_name, $app_ver) { $app_id = $this-&gt;app_exist($app_name, $app_ver); if ($app_id != 0) return $app_id; //        ,   $sql_query = "INSERT INTO $this-&gt;apps_table_name(appname, appver) VALUES('$app_name', '$app_ver')"; mysqli_query($this-&gt;db_handle, $sql_query); $this-&gt;last_error = mysqli_error($this-&gt;db_handle); } //   .        public function delete_app($app_name, $app_ver) { // ,    ,    id $app_id = $this-&gt;app_exist($app_name, $app_ver); if ($app_id != 0) { $sql_query = "DELETE FROM $this-&gt;apps_table_name WHERE appid=$app_id"; mysqli_query($this-&gt;db_handle, $sql_query); } $this-&gt;last_error = mysqli_error($this-&gt;db_handle); } //      ,  0   . // ,  appid    private function app_exist($app_name, $app_ver) { $sql_query = "SELECT appid FROM $this-&gt;apps_table_name WHERE appname='$app_name' AND appver='$app_ver'"; $result = mysqli_query($this-&gt;db_handle, $sql_query); $this-&gt;last_error = mysqli_error($this-&gt;db_handle); if($result-&gt;num_rows === 0) { return 0; } else{ return $result-&gt;fetch_assoc()['appid']; } } //       . app_id -     //  0,    ,   id    private function copy_exist ($machine_id, $app_id) { $sql_query = "SELECT id FROM $this-&gt;stat_table_name WHERE appid='$app_id' AND machineid='$machine_id'"; $result = mysqli_query($this-&gt;db_handle, $sql_query); if ($result-&gt;num_rows != 0){ return $result-&gt;fetch_assoc()['id']; } return 0; } //    .  ,    , COPY_EXIST -    , //  APP_NOT_EXIXST -       . public function add_copy($machine_id, $os_ver, $app_name, $app_ver, $ip) { // ,       $app_id = $this-&gt;app_exist($app_name, $app_ver); if ($app_id != 0){ //  // ,        if ($this-&gt;copy_exist($machine_id, $app_id) === 0){ $sql_query = "INSERT INTO $this-&gt;stat_table_name(machineid, osver, appid, date, ip) VALUES('$machine_id', '$os_ver', $app_id, NOW(), '$ip')"; mysqli_query($this-&gt;db_handle, $sql_query); $this-&gt;last_error = $this-&gt;db_handle-&gt;error; return "OK"; } else{ //    return "COPY_EXIST"; } } else //    return "APP_NOT_EXIST"; } //   public function db_close() { mysqli_close($this-&gt;db_handle); } //         arr['appid', 'appname', 'appver', 'sum'] public function get_sum_apps_list() { $arr_result = array(); $sql_query = "SELECT $this-&gt;apps_table_name.appid, appname, appver, sum FROM $this-&gt;sum_table_name, $this-&gt;apps_table_name WHERE $this-&gt;sum_table_name.appid=$this-&gt;apps_table_name.appid"; $result = mysqli_query($this-&gt;db_handle, $sql_query); //    while ($row = $result-&gt;fetch_array(MYSQLI_ASSOC)) { $arr_result[] = $row; } $this-&gt;last_error = mysqli_error($this-&gt;db_handle); return $arr_result; } //         arr['machineid', 'osver', 'date', 'ip'] //          public function get_copys_list($app_name, $app_ver) { $appid = $this-&gt;app_exist($app_name, $app_ver); if ($appid != 0) { $sql_query = "SELECT machineid, osver, date, ip FROM $this-&gt;stat_table_name WHERE appid=$appid"; $result = mysqli_query($this-&gt;db_handle, $sql_query); $arr_result = array(); while ($row = $result-&gt;fetch_array(MYSQLI_ASSOC)) { $arr_result[] = $row; } return $arr_result; } } //    ,      arr['appname', 'appver', 'date', 'ip'] // machine_id - hardware ID  public function get_client_apps($machine_id) { $sql_query = "SELECT appname, appver, date, ip FROM $this-&gt;apps_table_name JOIN $this-&gt;stat_table_name ON $this-&gt;stat_table_name.appid=$this-&gt;apps_table_name.appid WHERE machineid='$machine_id'"; $result = mysqli_query($this-&gt;db_handle, $sql_query); $arr_result = array(); while ($row = $result-&gt;fetch_array(MYSQLI_ASSOC)) { $arr_result[] =$row; } return $arr_result; } //    . public function get_error() { return $this-&gt;last_error; } }</span></span></code> </pre><br></div></div><br>  Here the code is also well commented, so I will not dwell on it. <br><br><h2>  How to work with it </h2><br>  I will show you how to work with all this.  First, you need to register the program, for this you can use the form shown below: <br><br><div class="spoiler">  <b class="spoiler_title">appform.html</b> <div class="spoiler_text"><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">titl</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">titl</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://test.info/regapp.php?Action=AddApp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>AppName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AppName"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>AppVersion<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AppVersion"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> &gt;</span></span>Send<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br>  The data flies to the regapp.php script in the POST method, and the Action parameter is passed to it, which tells the script what we want from it.  The parameter is passed by the GET method. <br><br><div class="spoiler">  <b class="spoiler_title">regapp.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'config.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'appstat.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    $app_stat = new appstat($db_name, $db_host, $db_login, $db_pass, $apps_table_name, $stat_table_name, $sum_table_name ); if ($app_stat-&gt;get_error()) die("    ($app_stat-&gt;get_error())"); //      switch ($_GET['Action']) { //      case 'AddApp': //    if ((strlen($_POST['AppName']) == 0 || strlen($_POST['AppVersion']) == 0 )) { $app_stat-&gt;db_close(); die('   '); } else { $app_name = $_POST['AppName']; $app_ver = $_POST['AppVersion']; if ($app_stat-&gt;add_app($app_name, $app_ver) == false) echo " $app_name ($app_ver)  "; else echo '     '; } break; //   case 'AddCopy': //    if (strlen($_POST['MachineID']) == 0 || strlen($_POST['AppName']) == 0 || strlen($_POST['AppVersion']) == 0 || strlen($_POST['OsVersion']) == 0) { $app_stat-&gt;db_close(); die('   '); } else { $app_name = $_POST['AppName']; //   $machine_id = $_POST['MachineID']; // HardwarID $app_ver = $_POST['AppVersion']; //   $client_ip = $_SERVER['REMOTE_ADDR']; // Ip   $os_ver = $_POST['OsVersion']; //   //   echo $app_stat-&gt;add_copy($machine_id, $os_ver, $app_name, $app_ver, $client_ip); } break; } $app_stat-&gt;db_close();</span></span></code> </pre><br></div></div><br>  ,      ‚Äî      ,  Action=AddApp,    ‚Äì    ,    Action    AddCopy. <br><br>     ,    : <br><br><div class="spoiler"> <b class="spoiler_title">copyform.html</b> <div class="spoiler_text"><pre> <code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://test.info/regapp.php?Action=AddCopy"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>AppName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AppName"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>AppVersion<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AppVersion"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>MachineID<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MachineID"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span>OsVersion<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OsVersion"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> &gt;</span></span>Send<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br><img src="https://habrastorage.org/getpro/habr/post_images/0af/157/4da/0af1574da9898188ba22df3bfdb04f4e.png" alt="image"><br><br>      ,     <b>APP_NOT_EXIST</b> . ,   : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e3d/a87/b27/e3da87b276f2eb72cbc7bd38bf9d986b.png" alt="image"><br><br>    ‚Äì <b>OK</b> <br><br>  Further more.   appstat          .    : <br><br><div class="spoiler"> <b class="spoiler_title">showstat.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"config.php"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"appstat.php"</span></span>; $app_stat = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> appstat($db_name, $db_host, $db_login, $db_pass, $apps_table_name, $stat_table_name, $sum_table_name); <span class="hljs-comment"><span class="hljs-comment">//   $result = $app_stat-&gt;get_sum_apps_list(); echo " &lt;br&gt;"; echo "&lt;table border='1'&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt; &lt;/th&gt;&lt;/tr&gt;"; for ($i = 0; $i &lt; count($result); $i++) { $app = $result[$i]; echo "&lt;tr&gt;&lt;td&gt;$app[appname] &lt;/td&gt;&lt;td&gt;$app[appver]&lt;/td&gt;&lt;td&gt;$app[sum]&lt;/td&gt;&lt;/tr&gt;"; } echo "&lt;/table&gt;"; echo "&lt;br&gt;"; //      echo "   &lt;br&gt;"; $result = $app_stat-&gt;get_copys_list('Program#1', '1.0.0.0'); echo "&lt;table border='1'&gt;&lt;tr&gt;&lt;th&gt;Machine ID&lt;/th&gt;&lt;th&gt; &lt;/th&gt;&lt;th&gt; &lt;/th&gt;&lt;th&gt;IP&lt;/th&gt;&lt;/tr&gt;"; for ($i = 0; $i &lt; count($result); $i++) { $copy = $result[$i]; echo "&lt;tr&gt;&lt;td&gt;$copy[machineid]&lt;/td&gt;&lt;td&gt;$copy[osver]&lt;/td&gt;&lt;td&gt;$copy[date]&lt;/td&gt;&lt;td&gt;$copy[ip]&lt;/td&gt;&lt;/tr&gt;"; } echo "&lt;/table&gt;"; echo "&lt;br&gt;"; //    echo "  &lt;br&gt;"; $result = $app_stat-&gt;get_client_apps('666'); echo "&lt;table border='1'&gt;&lt;tr&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;IP&lt;/th&gt;&lt;/tr&gt;"; for ($i = 0; $i &lt; count($result); $i++) { $app = $result[$i]; echo "&lt;tr&gt;&lt;td&gt;$app[appname]&lt;/td&gt;&lt;td&gt;$app[appver]&lt;/td&gt;&lt;td&gt;$app[date]&lt;/td&gt;&lt;td&gt;$app[ip]&lt;/td&gt;&lt;/tr&gt;"; } echo "&lt;/table&gt;";</span></span></code> </pre></div></div><br>   : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9e2/b3f/075/9e2b3f075d99767c7a36cd781d218c7b.png" alt="image"><br><br>      , css,  ..    ,     .     ,   ,   . <br><br>   ,      .          appCopy  : <br><br><pre> <code class="cs hljs">AppCopy appCopy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AppCopy(<span class="hljs-string"><span class="hljs-string">"http://test.info/regapp.php?Action=AddCopy"</span></span>, GetHID(), <span class="hljs-string"><span class="hljs-string">"Program#1"</span></span>, <span class="hljs-string"><span class="hljs-string">"1.0.0.0"</span></span>, GetOsVersion());</code> </pre><br>  Everything!   .    : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20b/474/534/20b474534860ba26a5290300c0d0b71b.png" alt="image"><br><br>   ,   showstat.php: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a31/768/20b/a3176820baa1a2d91d6d06155c55955d.png" alt="image"><br><br>    ,   .     ,    ,     : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b0e/496/1f3/b0e4961f3de16ce20d0c96bf233fb7dc.png" alt="image"><br><br>     .   ,  , ,    ,        (   ),     Java,    Android . <br><br><h4>  Links </h4><br><ul><li> <a href="https://www.codeproject.com/Articles/28678/Generating-Unique-Key-Finger-Print-for-a-Computer">Generating Unique Key (Finger Print) for a Computer for Licensing Purposes</a> </li><li> <a href="http://www.compdoc.ru/bd/access/guid/">  GUID</a> </li><li> <a href="https://professorweb.ru/my/csharp/web/level7/7_2.php"> HttpWebRequest  HttpWebResponse</a> </li><li> <a href="http://my-files.ru/i4hvai">  </a> </li><li> <a href="http://my-files.ru/wdc8pq">  </a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/339546/">https://habr.com/ru/post/339546/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339532/index.html">Multimodal Emotion Recognition Challenge by Neurodata Lab</a></li>
<li><a href="../339534/index.html">Classic 2D quest or how our two years of development went. Part of the final</a></li>
<li><a href="../339536/index.html">Security Week 40: Yahoo, do not leak, Google is caulking holes, as Netgear bugs catches</a></li>
<li><a href="../339538/index.html">Part 2: MVVM: Complete Understanding (+ WPF)</a></li>
<li><a href="../339544/index.html">ruby -e for easy console operation</a></li>
<li><a href="../339548/index.html">Will high-frequency trading disappear?</a></li>
<li><a href="../339550/index.html">Uneducated youth. Life in the outback</a></li>
<li><a href="../339552/index.html">Lower bones? Easy</a></li>
<li><a href="../339554/index.html">How to create a quality map for metro</a></li>
<li><a href="../339556/index.html">Setting tasks for beginners timlidov</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>