<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Encryption and decryption - accessing the OpenSSL API using JNI calls</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This blog lists steps for integrating Intel AES-NI instructions into an Android application using the OpenSSL library. By following the instructions h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Encryption and decryption - accessing the OpenSSL API using JNI calls</h1><div class="post__text post__text-html js-mediator-article">  This blog lists steps for integrating Intel AES-NI instructions into an Android application using the OpenSSL library.  By following the instructions here, you can create a JNI application using AES-NI acceleration. <br><a name="habracut"></a><br><h2>  <font color="#0071c5">New encryption instructions standard AES (Intel AES-NI)</font> </h2><br>  Intel AES-NI instructions were proposed in March 2008 as an extension of the x86 architecture instruction set for Intel microprocessors.  The purpose of this instruction set is to improve the performance, security, and energy efficiency of applications that encrypt and decrypt data using the AES standard. <br><br><h2>  <font color="#0071c5">Using Intel AES-NI in Android</font> </h2><br>  The AES algorithms as part of the OpenSSL library have demonstrated significantly better performance compared to the native Java algorithms.  The reason is that this library is optimized for Intel processors and uses AES-NI instructions.  Below is a step-by-step description of file encryption using the OpenSSL provider. <br><br>  Beginning with Android 4.3, OpenSSL has Intel AES-NI support in AOSP, so you just need to compile the code with the desired configuration.  You can also download it from the official website and compile it yourself, and then use the * .a / *. So file directly in your project.  You can get encryption libraries in two ways. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you do not have the AOSP source code, you can download OpenSSL <a href="http://www.openssl.org/source/">here</a> .  Use the latest version to avoid all known vulnerabilities found in previous versions of OpenSSL.  AOSP includes the openssl integrated library, which can be placed in the jni folder of the application to access its member folders. <br>  If you download openssl source code for self-compilation and library creation, use the following. <br>  1. Download the source code: <br><br>  wget <a href="">https://www.openssl.org/source/openssl-1.0.1j.tar.gz</a> . <br><br>  2. Compile: run the following command in the console (note that you need to set the NDK variable to the full path to your distribution): <br><pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> NDK=~/android-ndk-r9d <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> TOOL=arm-linux-androideabi <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> NDK_TOOLCHAIN_BASENAME=<span class="hljs-variable"><span class="hljs-variable">${TOOLCHAIN_PATH}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${TOOL}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CC=<span class="hljs-variable"><span class="hljs-variable">$NDK_TOOLCHAIN_BASE</span></span>-gcc <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CXX=<span class="hljs-variable"><span class="hljs-variable">$NDK_TOOLCHAIN_BASENAME</span></span>-g++ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LINK=<span class="hljs-variable"><span class="hljs-variable">${CXX}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LD=<span class="hljs-variable"><span class="hljs-variable">$NDK_TOOLCHAIN_BASENAME</span></span>-ld <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> AR=<span class="hljs-variable"><span class="hljs-variable">$NDK_TOOLCHAIN_BASENAME</span></span>-ar <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> STRIP=<span class="hljs-variable"><span class="hljs-variable">$NDK_TOOLCHAIN_BASENAME</span></span>-strip <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ARCH_FLAGS=‚Äù-march=armv7<span class="hljs-_"><span class="hljs-_">-a</span></span> ‚Äìmfloat-abi=softfp ‚Äìmfpu=vfpv3-d16‚Äù <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ARCH_LINK=‚Äù-march=armv7<span class="hljs-_"><span class="hljs-_">-a</span></span> ‚ÄìWl, --flx-cortex<span class="hljs-_"><span class="hljs-_">-a</span></span>‚Äù <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CPPFLAGS=‚Äù<span class="hljs-variable"><span class="hljs-variable">${ARCH_FLAGS}</span></span> ‚Äìfpic ‚Äìffunction-sections ‚Äìfunwind-tables ‚Äìfstack-protector ‚Äìfno-strict-aliasing ‚Äìfinline-limited=64‚Äù <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LDFLAGS=‚Äù<span class="hljs-variable"><span class="hljs-variable">${ARCH_LINK‚Äù}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CXXFLAGS=‚Äù<span class="hljs-variable"><span class="hljs-variable">${ ARCH_FLAGS}</span></span> ‚Äìfpic ‚Äìffunction-sections ‚Äìfunwind-tables ‚Äìfstack-protector ‚Äìfno-strict-aliasing ‚Äìfinline-limited=64 ‚Äìfrtti ‚Äìfexceptions‚Äù <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$OPENSSL_SRC_PATH</span></span> <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CC=‚Äù<span class="hljs-variable"><span class="hljs-variable">$STANDALONE_TOOCHAIN_PATH</span></span>/bin/i686-linux-android-gcc ‚Äìmtune=atome ‚Äìmarch=atom ‚Äìsysroot=<span class="hljs-variable"><span class="hljs-variable">$STANDALONE_TOOCHAIN_PATH</span></span>/sysroot‚Äù <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> AR=<span class="hljs-variable"><span class="hljs-variable">$STANDALONE_TOOCHAIN_PATH</span></span>/bin/i686-linux-android-ar <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> RANLIB=<span class="hljs-variable"><span class="hljs-variable">$STANDALONE_TOOCHAIN_PATH</span></span>/bin/i686-linux-android-ranlib ./Configure android-x86 ‚ÄìDOPENSSL_IA32_SSE2 ‚ÄìDAES_ASM ‚ÄìDVPAES_ASM make</code> </pre> <br>  After this, the file libcrypto.a appears in the top-level folder.  To use the * .so file, enter Configure shared android-x86 ***. <br>  With the AOSP source code, the ndk tool chain is not needed. <br><pre> <code class="bash hljs"> <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> build/envsetiup.sh lunch &lt;options&gt; make ‚Äìj8 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> external/openssl mm</code> </pre><br>  At the same time, libcrypto.a is compiled and placed in the out / host / linux_x86 / bin directory. <br>  Use OpenSSL via NDK in the Android project <br>  Create an Android project to encrypt files in your favorite development environment.  This is an example of Eclipse. <br><ol><li>  Declare functions related to OpenSSL as the native function in the Android.mk file. </li><li>  Create a jni folder in the original Android project. </li><li>  Create precompiled include folders inside the jni folder. </li><li>  Include the OpenSSL library folder created in &lt;OpenSSL source / include /&gt; in the jni folder. </li><li>  Then implement encryption by writing the C function to jni / *. C.  After that, you need to copy the * .a / *. So files and the header file into the project. </li><li>  Download the library and the implementation in C to the jni folder, as a function of the android class, created in step 1 as a system library. </li></ol><br>  The section below describes how to include the OpenSSL library in an application and call it in the java class. <br><br>  Create a new project in Eclipse, for example, EncryptFileOpenSSL.  Either using eclipse (right-click the project name in the project browser), or use the terminal to create the jni folder and inside it two subfolders: pre-compiled and include. <br>  Using terminal: <br><pre> <code class="bash hljs"> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> &lt;workspace/of/Project&gt; mkdir jni/pre-compiled/ mkdir jni/include cp <span class="hljs-variable"><span class="hljs-variable">$OPENSSL_PATH</span></span>/libcrypto.a jni/pre-compiled cp ‚ÄìL -rf <span class="hljs-variable"><span class="hljs-variable">$OPENSSL_PATH</span></span>/include/openssl jni/include gedit jni/Android.mk</code> </pre><br>  Then add the following line to the jni / Android.mk file: <br><pre> <code class="cpp hljs"> ‚Ä¶ LOCAL_MODULE := <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> LOCAL_SRC_FILES := pre-compiled/libcrypto.a ‚Ä¶ LOCAL_C_INCLUDES := include LOCAL_STATIC_LIBRARIES := <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ‚Äìlcrypto ‚Ä¶</code> </pre><br>  You can then use the functions provided in OpenSSL to implement your encrypt / decrypt / SSL functions.  To use Intel AES-NI, use the EVP_ * series feature as shown below.  In this case, the hardware module Intel AES-NI will be automatically used to encrypt and decrypt AES, if the CPU supports it.  For example, when creating a class for encrypting files using the OpenSSL provider, the encryption function in the * .java class will look like this (this source code is taken from Christopher Byrd's blog called <a href="https://software.intel.com/en-us/android/articles/sample-code-data-encryption-application">Sample Code: Data Encryption Application</a> ). <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encryptFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String encFilepath, String origFilepath)</span></span></span><span class="hljs-function"> </span></span>{ File fileIn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(origFilepath); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fileIn.isFile()) { ret = encodeFileFromJNI(encFilepath, origFilepath); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Log.d(TAG, <span class="hljs-string"><span class="hljs-string">"ERROR*** File does not exist:"</span></span> + origFilepath); seconds = <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ret == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"encrypt file execution did not succeed."</span></span>); } } <span class="hljs-comment"><span class="hljs-comment">/* native function available from encodeFile library */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> native </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encodeFileFromJNI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String fileOut, String fileIn)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> native </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBlocksizeFromJNI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> blocksize)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> native byte[] generateKeyFromJNI(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> keysize); <span class="hljs-comment"><span class="hljs-comment">/* To load the library that encrypts (encodeFile) on application startup. * The Package manager would have alredy unpacked the library has into /data/data/com.example.openssldataencryption/lib/libencodeFile.so * at installation time. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { System.loadLibrary(<span class="hljs-string"><span class="hljs-string">"crypto"</span></span>); System.loadLibrary(<span class="hljs-string"><span class="hljs-string">"encodeFile"</span></span>); }</code> </pre><br>  The encryption function in the encodeFile.cpp file that we downloaded using System.loadLibrary will be this: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encodeFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* filenameOut, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* filenameIn)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ret = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> filenameInSize = <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(filenameIn)*<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)+<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> filenameOutSize = <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(filenameOut)*<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)+<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> filename[filenameInSize]; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> encFilename[filenameOutSize]; <span class="hljs-comment"><span class="hljs-comment">// create key, if it's uninitialized int seedbytes = 1024; memset(cKeyBuffer, 0, KEYSIZE ); if (!opensslIsSeeded) { if (!RAND_load_file("/dev/urandom", seedbytes)) { //__android_log_print(ANDROID_LOG_ERROR, TAG, "Failed to seed OpenSSL RNG"); return -1; } opensslIsSeeded = 1; } if (!RAND_bytes((unsigned char *)cKeyBuffer, KEYSIZE )) { //__android_log_print(ANDROID_LOG_ERROR, TAG, "Faled to create OpenSSSL random integers: %ul", ERR_get_error); } strncpy(encFilename, filenameOut, filenameOutSize); encFilename[filenameOutSize-1]=0; strncpy(filename, filenameIn, filenameInSize); filename[filenameInSize-1]=0; EVP_CIPHER_CTX *e_ctx = EVP_CIPHER_CTX_new(); FILE *orig_file, *enc_file; printf ("filename: %s\n" ,filename ); printf ("enc filename: %s\n" ,encFilename ); orig_file = fopen( filename, "rb" ); enc_file = fopen ( encFilename, "wb" ); unsigned char *encData, *origData; int encData_len = 0; int len = 0; int bytesread = 0; /** * ENCRYPT */ //if (!(EVP_EncryptInit_ex(e_ctx, EVP_aes_256_cbc(), NULL, key, iv ))) { if (!(EVP_EncryptInit_ex(e_ctx, EVP_aes_256_cbc(), NULL, cKeyBuffer, iv ))) { ret = -1; printf( "ERROR: EVP_ENCRYPTINIT_EX\n"); } // go through file, and encrypt if ( orig_file != NULL ) { origData = new unsigned char[aes_blocksize]; encData = new unsigned char[aes_blocksize+EVP_CIPHER_CTX_block_size(e_ctx)]; // potential for encryption to be 16 bytes longer than original printf( "Encoding file: %s\n", filename); bytesread = fread(origData, 1, aes_blocksize, orig_file); // read bytes from file, then send to cipher while ( bytesread ) { if (!(EVP_EncryptUpdate(e_ctx, encData, &amp;len, origData, bytesread))) { ret = -1; printf( "ERROR: EVP_ENCRYPTUPDATE\n"); } encData_len = len; fwrite(encData, 1, encData_len, enc_file ); // read more bytes bytesread = fread(origData, 1, aes_blocksize, orig_file); } // last step encryption if (!(EVP_EncryptFinal_ex(e_ctx, encData, &amp;len))) { ret = -1; printf( "ERROR: EVP_ENCRYPTFINAL_EX\n"); } encData_len = len; fwrite(encData, 1, encData_len, enc_file ); // free cipher EVP_CIPHER_CTX_free(e_ctx); // close files printf( "\t&gt;&gt;\n"); fclose(orig_file); fclose(enc_file); } else { printf( "Unable to open files for encoding\n"); ret = -1; return ret; } return ret; }</span></span></code> </pre><br>  Then use ndk-build to compile in &lt;source of Application&gt;. <br>  <i>/ &lt;path to android-ndk7&gt; / ndk-build APP_ABI = x86</i> <br>  Copy the <i>/ &lt;PATH \ TO \ OPENSSL&gt; / include / openssl</i> folder inside the <i>&lt;/ PATH \ to \ PROJECT \ workspace&gt; / jni / folder</i> . <br>  The * .so / *. A files must be in <i>/ &lt;/ PATH \ to \ PROJECT \ workspace&gt; / libs / x86 /</i> or <i>/ &lt;/ PATH \ to \ PROJECT \ workspace&gt; / libs / armeabi /</i> . <br>  The encode.cpp file used for encryption and decryption should be located in the <i>&lt;/ PATH \ to \ PROJECT \ workspace&gt; / jni / folder</i> . <br><br><h2>  <font color="#0071c5">Performance analysis</font> </h2><br>  The following features allow you to analyze CPU usage, memory usage, and time taken to encrypt a message.  This source code is also taken from Christopher Byrd's blog. <br><br><h4>  <b>CPU usage</b> </h4><br>  The code below helps to read the average CPU load data stored in / proc / stat. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readCPUusage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { RandomAccessFile reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RandomAccessFile(<span class="hljs-string"><span class="hljs-string">"/proc/stat"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>); String load = reader.readLine(); String[] toks = load.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> idle1 = Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">5</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> cpu1 = Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">2</span></span>]) + Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">3</span></span>]) + Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">4</span></span>]) + Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">6</span></span>])+ Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">7</span></span>]) +Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">8</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Thread.sleep(<span class="hljs-number"><span class="hljs-number">360</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { } reader.seek(<span class="hljs-number"><span class="hljs-number">0</span></span>); load = reader.readLine(); reader.close(); toks = load.split(<span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> idle2 = Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">5</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> cpu2 = Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">2</span></span>]) + Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">3</span></span>])+ Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">4</span></span>]) + Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">6</span></span>]) + Long.parseLong(toks[<span class="hljs-number"><span class="hljs-number">7</span></span>]) + ong.parseLong(toks[<span class="hljs-number"><span class="hljs-number">8</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) (cpu2 - cpu1) / ((cpu2 + idle2) - (cpu1 + idle1)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException ex) { ex.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br><h4>  <b>Memory usage</b> </h4><br>  The following code snippet reads the available system memory. <br>  Memory Info is an Android API that allows you to get information about available memory. <br>  So, 1024 bytes = 1 KB, and 1024 KB = 1 MB.  Therefore, to convert available memory to megabytes: 1024 * 1024 == 1048576 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readMem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActivityManager am)</span></span></span><span class="hljs-function"> </span></span>{ MemoryInfo mi = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryInfo(); am.getMemoryInfo(mi); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> availableMegs = mi.availMem / <span class="hljs-number"><span class="hljs-number">1048576L</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> availableMegs; }   start = System.currentTimeMillis(); <span class="hljs-comment"><span class="hljs-comment">// Perform Encryption. stop = System.currentTimeMillis(); seconds = (stop - start);</span></span></code> </pre><br><br>  For more information on compiler optimization, see our <a href="https://software.intel.com/en-us/articles/optimization-notice">optimization notice</a> . </div><p>Source: <a href="https://habr.com/ru/post/255525/">https://habr.com/ru/post/255525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255509/index.html">The French TV channel was hacked after an interview with an employee on the background of stickers with passwords.</a></li>
<li><a href="../255511/index.html">Pure CSS3 Calculator</a></li>
<li><a href="../255513/index.html">We are switching from STM32 to the Russian K1986BE92QI microcontroller. Practical application: Generate and reproduce sound. Part one: we generate a square and sinusoidal signal. Mastering the DAC (DAC)</a></li>
<li><a href="../255519/index.html">Return oriented programming. We collect exploit in pieces</a></li>
<li><a href="../255523/index.html">SQL Language Tutorial (DDL, DML) on the example of MS SQL Server dialect. Part two</a></li>
<li><a href="../255527/index.html">Ordinary Primes: The Secrets of the Weavers' Secret Society</a></li>
<li><a href="../255529/index.html">Use Java smart cards to protect software. Chapter 1. General Information</a></li>
<li><a href="../255531/index.html">Use Java smart cards to protect software. Chapter 2. Java smart card from the applet developer's point of view</a></li>
<li><a href="../255533/index.html">Use Java smart cards to protect software. Chapter 3. Installing and Configuring IDE</a></li>
<li><a href="../255535/index.html">Use Java smart cards to protect software. Chapter 4. We write the first applet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>