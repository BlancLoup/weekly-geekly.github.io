<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Guitar effects: algorithms, first experience in hardware implementation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The electric guitar has long become an integral attribute of almost every musical group. At the same time, the market of devices whose main function i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Guitar effects: algorithms, first experience in hardware implementation</h1><div class="post__text post__text-html js-mediator-article">  The electric guitar has long become an integral attribute of almost every musical group.  At the same time, the market of devices whose main function is guitar sound processing has also been actively developed.  As you might have guessed, this article is about guitar effects. <br><br>  In the article there is a description of some guitar effects, as well as a compilation of the <s>bitter</s> experience we obtained in developing the guitar processor.  By the way, we developed the guitar processor as a course project at the university. <br><a name="habracut"></a><br>  What are guitar effects?  What are they needed for?  Let the following video answer for us: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/e2Tl0zwYUaA%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjQCXGsEZTCZFO10wa4cyUbJ5G1Wg" frameborder="0" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Sound effects </h2><br>  Below is a classification of effects, depending on the characteristics of their implementation: <br><br>  1) Filters - low pass filter, high pass filter, bandpass filter, equalizer <br>  2) Parametric filters - wah-wah (frog), phaser <br>  3) Effects over the delay line - vibrato, flanger, chorus, echo <br>  4) Modulators - tremolo, vibrato <br>  5) Nonlinear effects - overdrive, distortion, fuzz <br>  6) Spatial effects - reverb <br><br><h4>  Filters </h4><br>  Filters, by definition, remove part of the spectrum above or below the cutoff frequency.  For many situations, this is too gross an intervention. <br>  The equalizer, on the other hand, amplifies or weakens certain frequency bands without changing the rest of the spectrum.  Equalizers are based on a series of shelving and peak filters. <br><br><div class="spoiler">  <b class="spoiler_title">List of frequently used filters</b> <div class="spoiler_text">  Lowpass filter <br><img src="https://habrastorage.org/files/87b/1b8/d6e/87b1b8d6ec9d4c15a74d9891faff1fab.gif"><br><br>  Highpass filter <br><img src="https://habrastorage.org/files/352/5bd/eee/3525bdeeecc244bb96586eabdc31634e.gif"><br><br>  Bandpass filter <br><img src="https://habrastorage.org/files/02b/bf3/730/02bbf37305d24d9397ad3cd67f2ba996.gif"><br><br>  Bandreject filter <br><img src="https://habrastorage.org/files/a96/842/a9a/a96842a9a62548f2a0aff44912774984.gif"><br><br>  Shelving filter <br><img src="https://habrastorage.org/files/b5a/367/44d/b5a36744d8cf49968d4fc1ff0b4908f2.gif"><br><br>  Peak filter <br><img src="https://habrastorage.org/files/105/c14/1c0/105c141c094b4c158c9e77f265f202a9.gif"><br></div></div><br><br><h4>  Parametric filters </h4><br>  Some effects can be realized by changing the parameters of simple filters over time. <br><br>  <b>The ‚ÄúWah-wah‚Äù effect</b> is a narrow bandpass filter in which the center (resonant) frequency moves with time.  The filtered sound is mixed with the original.  <a href="https://www.youtube.com/watch%3Fv%3DR87mpsSAHXg">Demo</a> . <br><img src="https://habrastorage.org/files/771/9e7/a9b/7719e7a9b66f455096ee34cdd9aacd27.gif"><br><br><h4>  Effects over the delay line </h4><br>  All effects of this class are united by one principle of operation.  The input signal is stored in the section of memory, which is here called the delay line.  The output is the sum of the input sample and the sample from somewhere in the delay line.  The number and location of samples from the delay line determine the unique sound of the effect. <br><br>  Effects that do not save the result of their work to the delay line (that is, it contains only a clean input signal) are described by filters with a finite impulse response.  Effects that change the delay line are described by filters with infinite impulse response. <br><br>  <b>The ‚ÄúFlanger‚Äù effect</b> is a selection from the delay line in the region from 0 to 15 ms, and the exact location is determined by the low-frequency (about 1 Hz) sinusoidal law.  The use of low frequency sine waves is a popular technique for creating effects and has its own name - Low Frequency Oscillator or simply LFO.  <a href="https://www.youtube.com/watch%3Fv%3D1CZwZkHJje8">Demo</a> . <br><br>  <b>The ‚ÄúEcho‚Äù effect</b> is one or several samples at the same distance, more than 50 ms.  The one sample option allows you to actually double the number of notes played.  With the help of several samples, you can simulate a game in a spacious room.  Reverb effect achieves a similar goal.  <a href="https://www.youtube.com/watch%3Fv%3DVTjvDD54WoM">Demo</a> . <br><br>  <b>The ‚ÄúChorus‚Äù effect</b> is an imitation of playing multiple tools.  Several samples (by the number of instruments) at a random distance of 10-25 ms.  <a href="https://www.youtube.com/watch%3Fv%3D7cVYlCU0siE">Demo</a> . <br><br><h4>  Modulation </h4><br>  Modulation is the process by which the parameters of a sinusoidal signal (amplitude, frequency, and phase) change based on the audio signal. <br>  Amplitude modulation is defined as <i>y (n) = (1 + a LFO (n)) x (n)</i> , where a is the modulation depth, a number from 0 to 1. <br><br>  <b>The ‚ÄúTremolo‚Äù effect</b> is amplitude modulated sound with an LFO up to 20 Hz.  <a href="https://www.youtube.com/watch%3Fv%3Dcn-AH9t7mEw">Demo</a> . <br><br><h4>  Nonlinear effects </h4><br>  The essence of nonlinear effects is reduced to the introduction of new harmonics into the sound.  Nonlinear sound processing allows, for example, to weaken loud areas, so that subsequent equipment does not introduce unwanted distortion (or so as not to wake the neighbors when watching a movie);  Enhance quiet areas, making the sound more saturated. <br><br>  However, such filters are not included in the article, so in this section we will focus on a line of three similar, very guitar, very effective effects - overdrive, distortion, fuzz.  In fact, this is one effect with different strength and different goals. <br><br>  Overdrive You could hear at the beginning of the article.  How his older brother sounds, the king of metal - distortion, can be found under the spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Distortion example</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/5s85XIqV4BQ%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhis9mm4_NYg6C5OHvIrhmYwJtlPVw" frameborder="0" allowfullscreen=""></iframe><br></div></div><br>  The implementation of this effect is simple, and at the same time full of tricks, which makes the creation of a good distortion a kind of art.  The effect is based on a simple idea - sounds of too high amplitude should be cut off.  At first it was an undesirable effect from the output of electronic components in non-linear modes of operation, but over time, the musicians began to take advantage of this. <br><br><h2>  Hardware implementation: theory </h2><br>  In general, the architecture of the guitar processor can be represented as: <br><br><img src="https://habrastorage.org/files/4a4/5a8/c72/4a45a8c72f1447ba9086ee2806ea8ae3.png"><br><br>  The guitar processor is a digital device.  This means that the incoming analog signal (sound) must be converted to a digital signal.  This is done by a special <a href="https://www.google.by/">ADC</a> chip.  After processing, it is necessary to return the signal to an analog form.  DAC does this.  DAC and ADC can be executed in one chip - in this case it is called a Codec.  Obviously, the same requirements are imposed on all three microcircuits: <br><br><ul><li>  <b>Sample rate</b> : 44.1 kHz or 48 kHz.  This follows from the Kotelnikov theorem and the fact that when working with sound we are interested in frequencies from 20 Hz to 20 kHz.  There are codecs for working with sound and sampling frequency of 96 kHz and 192 kHz.  They can also be used, but they create an increased computational burden on the DSP, which is undesirable if the developer wants to get by with budget components.  A lower sampling rate will cut out the human-perceived harmonics from the signal, distorting the signal. </li><li>  <b>Bit rate</b> : 24 bits.  This, according to observations, is the standard for audio codecs.  A bit too low cuts out useful information.  Too high bit is useless if it is not a precision or low-noise device.  Otherwise, only the noise will fall into the low bits of the digital signal. </li></ul><br><br>  A guitar processor is a real-time device.  A musician should not feel the delay between striking the strings and the sound from the speakers.  In the first approximation, this also means that the overlay block must receive a 24-bit sample from the ADC, process it, and transfer the result to the DAC before a new sample appears on the ADC.  Let us now try to generalize the requirements for such an - for the time being purposely abstract - handler. <br><ul><li>  Simple calculations show that at a sampling rate of 48 kHz, the processor has 21 microseconds per sample. </li><li>  If the codec is not built into the processor, then you will need to connect to the codec using one of the generally accepted protocols.  Most often these are SPI or I2C protocols.  SPI and I2C buses are consecutive, transmit bit by bit per clock.  This means that the frequency of I / O operation must be at least 24 times higher than the ADC sampling rate.  For 48 kHz, this is at least 1.152 MHz. </li></ul><br><br><img src="https://habrastorage.org/files/35d/786/423/35d786423eb34768b2ef40f32d7ea85b.png"><br>  <i>Typical SPI connection</i> <br><br>  As practice shows, microcontrollers with sound processing in real time can not cope.  Here come to the aid specialized processors called DSP (digital signal processor).  As in the case of codecs, there are general purpose DSPs and specialized DSPs. <br><br>  General Purpose DSP: <br><ul><li>  Easy to program.  Most likely, for such DSP there is a compiler C. </li><li>  Computational power from modest to "on the verge of the possible" + a large number of interfaces.  For example, the <a href="http://www.ti.com/product/66AK2H14">top DSP from Texas Instruments</a> contains 12 cores (8 DSP cores and 4 ARM architects).  Budget DSP as a rule do not contain ARM cores. </li><li>  Powerful DSPs place high demands on the surrounding circuitry, they cannot be used ‚Äúon the knee‚Äù. </li></ul><br><br>  Sound DSPs: <br><ul><li>  Provide a guaranteed number of instructions per sample.  As a rule, the user is given from 256 to 6000 instructions.  This simple warranty satisfies the two handler requirements listed above. </li><li>  Low cost - up to $ 30. </li><li>  Simple installation on the board. </li><li>  Not programming, but a circus of some kind.  DSPs are built on different architectures than x86 and ARM - often VLIW.  The architecture of a sound DSP may be so different that writing the C compiler loses all meaning.  Therefore, it is often used here to use assembler or graphical programming languages. </li><li>  Most likely there is no interface for external RAM. </li></ul><br><br><img src="https://habrastorage.org/files/590/645/7b0/5906457b09e242faa03634fc48e4708d.png"><br>  <i>Typical DSP firmware of the ADAU family.</i> <br><br><h2>  Hardware implementation: practice </h2><br>  Let us now turn to the scheme of a specific implementation of the guitar processor: <br><br><img src="https://habrastorage.org/files/249/b07/a80/249b07a803e645d7b5469df754c0d10c.png"><br><br>  The project consists of three main blocks - FreeDSP, Arduino, LCD.  Here it is worth making an important note right away - the FreeDSP project can hardly be called a good choice for creating a guitar processor.  Why this is so below, but in general any developer who is inexperienced in electronics is recommended to replace FreeDSP with another evaluation board with specialized DSPs. <br><br>  The key advantage of the project is its simplicity;  the developer does not need the ability to dilute the board.  At the electronics level, basic knowledge and some common sense are required.  Also, the developer is free from working with ADC / DAC - both are built into ADAU1701. <br><br>  Here we will not dwell on the Arduino and display.  What I would like to note - Arduino Due here is preferable to other options due to the fact that the level of the logical unit here is equal to 3.3 V, not 5 V. This is important because many modern DSP five volts can not stand.  LCD can be used any, but the model with the driver SSD1305 is recommended - firstly, excellent OLED displays are produced with this driver, and secondly, the corresponding <a href="https://github.com/adafruit/Adafruit_SSD1305_Library">high-level library</a> is available for the Arduino. <br><br><h3>  FreeDSP </h3><br><img src="https://habrastorage.org/getpro/geektimes/post_images/264/9ed/a71/2649eda71f77b978e9a560291cabf8ed.png" alt="image"><br>  FreeDSP is a low-cost, real-time digital signal processing solution designed for researchers and the DIY community.  The fee is based on <a href="http://www.analog.com/en/products/processors-dsp/sigmadsp-audio-processors/adau1701.html">ADAU1701</a> .  The programming of the ADAU1701 is done in the SigmaStudio IDE.  More information about the project can be found at <a href="http://www.freedsp.cc/">www.freedsp.cc</a> . <br><br>  The creators of the project offer for a modest amount to purchase from them all the components for assembly.  However, we decided to do everything on our own.  The benefit of the project site contains all the necessary schemes, as well as lists of components. <br><br>  Below is a list of pitfalls when working with FreeDSP: <br><ol><li>  Firmware for ADAU1701 is stored in the EEPROM 24LC256 chip.  To write data to this chip, you can use the Arduino Nano (for it there is a slot in the project) or write it yourself.  For self-firmware fit programmer PICKit v2 or its clone.  When using PICKit: SigmaStudio compiles the project to a file with the .hex extension.  <b>This is not true</b> .  This is not a file in Intel Hex format, it is a text file with a comma separated hexadecimal numbers.  A <a href="http://www.360customs.de/en/2015/01/sigmadsp-programmieren-sigma-studio-adau17011401a-eeprom-standalone-self-boot/">special utility is</a> used to convert Sigma Hex to Intel Hex. </li><li>  The ADAU1701 has very low I / O capabilities.  Coupled with an unusual graphical programming language, it gives a lot of headaches when trying to create a guitar processor with truly custom effects. </li><li>  The ADAU1701 has very little internal memory ‚Äî only 21 milliseconds.  Nothing but the Chorus effect with such a delay line is possible.  ADAU1701 is designed to work with a signal in the frequency range (filters and the like).  You can bypass this drawback by replacing ADAU1701 with ADAU1452 (the older chip in the line has a delay line of 800 milliseconds, which is a lot).  The fee should undergo major changes. </li></ol><br><br><h2>  Hardware implementation: work on bugs </h2><br>  The following diagram is a summary of our modest experience and is proposed as a starting point for novice workers with real-time sound. <br><br><img src="https://habrastorage.org/files/193/39c/32e/19339c32ee1c48288c5f6c4639bc67a8.png"><br><br>  Here is how to avoid problems with short delay lines and IO.  We suggest replacing ADAU1701 with something from the ADAU14xx family, since these chips have enough internal memory (up to 800 ms).  Since it turned out that in one ADAU all the options and settings of the guitar processor do not fit, there are several of them.  When setting up the effects, the microcontroller gets the firmware with different effects from NVRAM and writes them into the EEPROM chips, and then restarts the ADAU. <br><br>  From the expected advantages of such a scheme, I would like to note the high configurability of the processor.  Among the shortcomings - ready-made boards are not enough here and you will have to spend considerable time on development. <br><br><h3>  Conclusion </h3><br>  In the end, we still managed to make a modest guitar processor, but the final version was fundamentally different from the one originally planned and deserves a separate article.  Part of the processor features shown in the video: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/scAfVW65cGw%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhj_XSFgFgSeGJLSBtKwzYPGmd_psA" frameborder="0" allowfullscreen=""></iframe><br><br><div class="spoiler">  <b class="spoiler_title">Photos of the development process</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/geektimes/post_images/c0c/0bd/465/c0c0bd4655621f04cef19b119fbe80f2.jpg" alt="freedsp development"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/a45/dff/9a3/a45dff9a385e2c1b2afba968a10b1631.jpg" alt="freedsp development"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/721/33a/4bb/72133a4bb3a4e22891df5dc9ec211f64.jpg" alt="freedsp development"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/c03/cef/115/c03cef115e808893b5c8ea964e54647f.jpg" alt="image"><br></div></div><br><br>  We hope that with this article we will help people who are starting to develop their own guitar effects, to avoid those rakes that we stepped on. </div><p>Source: <a href="https://habr.com/ru/post/369391/">https://habr.com/ru/post/369391/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../369379/index.html">Electricity monitoring with Eastron SDM220-Modbus meter</a></li>
<li><a href="../369381/index.html">Which of these platforms are suitable for the laboratory of robotics and intelligent systems?</a></li>
<li><a href="../369383/index.html">New War Formats: Television HDR</a></li>
<li><a href="../369387/index.html">Smart Home - Universal Automation</a></li>
<li><a href="../369389/index.html">DE0-Nano-SoC is another minicomputer for creativity</a></li>
<li><a href="../369393/index.html">Lenovo Ideacentre Y900 Review</a></li>
<li><a href="../369395/index.html">Where does corvids and parrots have cognitive abilities? Recent research scientists</a></li>
<li><a href="../369397/index.html">Perfect silent killer - chameleon</a></li>
<li><a href="../369399/index.html">Hyperloop One goes to Russia</a></li>
<li><a href="../369401/index.html">Bio Ring: ring tracker with heart rate monitor and non-invasive calculation of calories consumed</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>