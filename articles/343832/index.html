<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Designing a system for reading data from input devices (Part Two)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part of the article , steps were given to create a system for reading data from input devices based on aliases. But the first article did...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Designing a system for reading data from input devices (Part Two)</h1><div class="post__text post__text-html js-mediator-article">  In the first part of the <a href="https://habrahabr.ru/post/343258/">article</a> , steps were given to create a system for reading data from input devices based on aliases.  But the first article did not describe the process of creating an application that would show the benefits of using such a system.  This article will discuss the creation of a simple Pong game, designed for playing together, with the ability to reassign management and the ability to assign not one but several keys to an action, not limited to just the keyboard.  We will consider not only the mouse and several connected joysticks, but also the ability to assign a key combination, such as the W + Left Mouse Button, i.e.  maximum flexibility in working with input devices will be demonstrated. <br><a name="habracut"></a><br>  To create a game, let's change the system code described in the first part. <br><br>  First, we will consider working with joysticks, including handling the case when several joysticks are connected to the system.  We will implement the work by means of XIpnut, since  Work with this library is as simple as possible. <br><br>  The following block is added to the file describing hardware aliases: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Alias ‚Äã‚Äãdescription</b> <div class="spoiler_text"><pre><code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"joystick"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_DPAD_UP"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_DPAD_DOWN"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_DPAD_LEFT"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">4</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_DPAD_RIGHT"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">8</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_START"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">16</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_BACK"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">32</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_THUMB"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">64</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_RIGHT_THUMB"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">128</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_SHOULDER"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">256</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_RIGHT_SHOULDER"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">512</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_A"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">4096</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_B"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">8192</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_X"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">16384</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_Y"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">32768</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_STICK_H"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">100</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_STICK_NEGH"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">101</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_STICK_V"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">102</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_STICK_NEGV"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">103</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_TRIGER"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">104</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_RIGHT_STICK_H"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">105</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_RIGHT_STICK_NEGH"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">106</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_RIGHT_STICK_V"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">107</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_RIGHT_STICK_NEGV"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">108</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"JOY_RIGHT_TRIGER"</span></span>, <span class="hljs-string"><span class="hljs-string">"index"</span></span> : <span class="hljs-number"><span class="hljs-number">109</span></span> } ]</code> </pre> <br></div></div><br>  To work with the states themselves, we define the following arrays <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">XINPUT_STATE</span></span> joy_prev_states[XUSER_MAX_COUNT]; <span class="hljs-attribute"><span class="hljs-attribute">XINPUT_STATE</span></span> joy_states[XUSER_MAX_COUNT]; <span class="hljs-attribute"><span class="hljs-attribute">bool</span></span> joy_active[XUSER_MAX_COUNT];</code> </pre> <br>  When initializing, we say that there are no active joysticks: <br><br><pre> <code class="hljs matlab"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>&lt; XUSER_MAX_COUNT; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) { joy_active[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] = <span class="hljs-built_in"><span class="hljs-built_in">false</span></span>; }</code> </pre><br>  In the function of the update, we collect the states from the joysticks that are currently connected: <br><br><pre> <code class="hljs matlab">... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (DWORD <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> &lt; XUSER_MAX_COUNT; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (joy_active[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]) { memcpy(&amp;joy_prev_states[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>], &amp;joy_states[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>], sizeof(XINPUT_STATE)); } ZeroMemory(&amp;joy_states[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>], sizeof(XINPUT_STATE)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (XInputGetState(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>, &amp;joy_states[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]) == ERROR_SUCCESS) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!joy_active[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]) { memcpy(&amp;joy_prev_states[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>], &amp;joy_states[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>], sizeof(XINPUT_STATE)); } joy_active[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] = <span class="hljs-built_in"><span class="hljs-built_in">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { joy_active[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] = <span class="hljs-built_in"><span class="hljs-built_in">false</span></span>; } } ...</code> </pre><br>  We may have several joysticks, so when polling hardware aliases, it is necessary to transfer the index of the device from which we want to read data.  The methods will look like this: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHardwareAliasState</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">alias</span></span></span></span><span class="hljs-function"><span class="hljs-params">, AliasAction action, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> device_index</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHardwareAliasValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">alias</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delta, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> device_index</span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  At the same time, we assume that if device_index is -1, it means that if two joysticks are connected and we interrogate whether the A button is pressed, then the presses from both joysticks will be taken into account, i.e.  we want to get active value from any connected joystick. <br><br>  And now we give the handling code for hardware joysticks aliases: <br><br><div class="spoiler">  <b class="spoiler_title">Handling hardware aliases</b> <div class="spoiler_text"><pre> <code class="hljs kotlin">bool Controls::GetHardwareAliasState(int index, AliasAction action, int device_index) { HardwareAlias&amp; halias = haliases[index]; switch (halias.device) { case Joystick: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.index&lt;<span class="hljs-number"><span class="hljs-number">100</span></span> || halias.index &gt; <span class="hljs-number"><span class="hljs-number">109</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; XUSER_MAX_COUNT; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!joy_active[i]) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } bool res = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (device_index != -<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; device_index != i) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } int index = i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action == Activated) { res = (!(joy_prev_states[index].Gamepad.wButtons &amp; halias.index) &amp;&amp; joy_states[index].Gamepad.wButtons &amp; halias.index); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action == Active) { res = joy_states[index].Gamepad.wButtons &amp; halias.index; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (res) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { float <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = GetHardwareAliasValue(index, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, device_index); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action == Active) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0.99f</span></span>; } float prev_val = <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> - GetHardwareAliasValue(index, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, device_index); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0.99f</span></span>) &amp;&amp; (prev_val &lt; <span class="hljs-number"><span class="hljs-number">0.99f</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } ... } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> float GetJoyTrigerValue(float <span class="hljs-keyword"><span class="hljs-keyword">val</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> / <span class="hljs-number"><span class="hljs-number">255.0f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> float GetJoyStickValue(float <span class="hljs-keyword"><span class="hljs-keyword">val</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = fmaxf(-<span class="hljs-number"><span class="hljs-number">1</span></span>, (float)<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> / <span class="hljs-number"><span class="hljs-number">32767</span></span>); float deadzone = <span class="hljs-number"><span class="hljs-number">0.05f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = (abs(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>) &lt; deadzone ? <span class="hljs-number"><span class="hljs-number">0</span></span> : (abs(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>) - deadzone) * (<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> / abs(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> /= <span class="hljs-number"><span class="hljs-number">1.0f</span></span> - deadzone; } float Controls::GetHardwareAliasValue(int index, bool delta, int device_index) { HardwareAlias&amp; halias = haliases[index]; switch (halias.device) { case Joystick: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.index &gt;= <span class="hljs-number"><span class="hljs-number">100</span></span> &amp;&amp; halias.index &lt;= <span class="hljs-number"><span class="hljs-number">109</span></span>) { float <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; XUSER_MAX_COUNT; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!joy_active[i]) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (device_index != -<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; device_index != i) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } int index = i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.index == <span class="hljs-number"><span class="hljs-number">100</span></span> || halias.index == <span class="hljs-number"><span class="hljs-number">101</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = GetJoyStickValue((float)joy_states[index].Gamepad.sThumbLX); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> - GetJoyStickValue((float)joy_prev_states[index].Gamepad.sThumbLX); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.index == <span class="hljs-number"><span class="hljs-number">101</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = -<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.index == <span class="hljs-number"><span class="hljs-number">102</span></span> || halias.index == <span class="hljs-number"><span class="hljs-number">103</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = GetJoyStickValue((float)joy_states[index].Gamepad.sThumbLY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> - GetJoyStickValue((float)joy_prev_states[index].Gamepad.sThumbLY); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.index == <span class="hljs-number"><span class="hljs-number">103</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = -<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.index == <span class="hljs-number"><span class="hljs-number">104</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = GetJoyTrigerValue((float)joy_states[index].Gamepad.bLeftTrigger); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> - GetJoyTrigerValue((float)joy_prev_states[index].Gamepad.bLeftTrigger); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.index == <span class="hljs-number"><span class="hljs-number">105</span></span> || halias.index == <span class="hljs-number"><span class="hljs-number">106</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = GetJoyStickValue((float)joy_states[index].Gamepad.sThumbRX); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> - GetJoyStickValue((float)joy_prev_states[index].Gamepad.sThumbRX); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.index == <span class="hljs-number"><span class="hljs-number">106</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = -<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.index == <span class="hljs-number"><span class="hljs-number">107</span></span> || halias.index == <span class="hljs-number"><span class="hljs-number">108</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = GetJoyStickValue((float)joy_states[index].Gamepad.sThumbRY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> - GetJoyStickValue((float)joy_prev_states[index].Gamepad.sThumbRY); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.index == <span class="hljs-number"><span class="hljs-number">108</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = -<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.index == <span class="hljs-number"><span class="hljs-number">109</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = GetJoyTrigerValue((float)joy_states[index].Gamepad.bRightTrigger); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> - GetJoyTrigerValue((float)joy_prev_states[index].Gamepad.bRightTrigger); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fabs(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0.01f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetHardwareAliasState(index, Active, device_index) ? <span class="hljs-number"><span class="hljs-number">1.0f</span></span> : <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } ... } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; }</code> </pre><br></div></div><br>  The last thing that is necessary for full-fledged work with several devices is the ability to set the required device number in the alias itself.  Therefore it is necessary to update the structure: <br><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AliasRefState</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> aliasIndex = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> refer2hardware = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> device_index = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   };</span></span></code> </pre><br>  Reading aliases now looks like this: <br><br><div class="spoiler">  <b class="spoiler_title">Read aliases</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">bool</span></span> Controls::LoadAliases(const <span class="hljs-type"><span class="hljs-type">char</span></span>* name_aliases) { JSONReader* reader = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> JSONReader(); <span class="hljs-type"><span class="hljs-type">bool</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reader-&gt;Parse(name_aliases)) { res = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (reader-&gt;EnterBlock("Aliases")) { std::string <span class="hljs-type"><span class="hljs-type">name</span></span>; reader-&gt;<span class="hljs-keyword"><span class="hljs-keyword">Read</span></span>("name", <span class="hljs-type"><span class="hljs-type">name</span></span>); <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = GetAlias(<span class="hljs-type"><span class="hljs-type">name</span></span>.c_str()); <span class="hljs-keyword"><span class="hljs-keyword">Alias</span></span>* <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { aliases.push_back(<span class="hljs-keyword"><span class="hljs-keyword">Alias</span></span>()); <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> = &amp;aliases.back(); <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>-&gt;<span class="hljs-type"><span class="hljs-type">name</span></span> = <span class="hljs-type"><span class="hljs-type">name</span></span>; aliasesMap[<span class="hljs-type"><span class="hljs-type">name</span></span>] = (<span class="hljs-type"><span class="hljs-type">int</span></span>)aliases.size() - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> = &amp;aliases[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>-&gt;aliasesRef.clear(); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (reader-&gt;EnterBlock("AliasesRef")) { <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>-&gt;aliasesRef.push_back(AliasRef()); AliasRef&amp; aliasRef = <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>-&gt;aliasesRef.back(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (reader-&gt;EnterBlock("names")) { string <span class="hljs-type"><span class="hljs-type">name</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reader-&gt;IsString("") &amp;&amp; reader-&gt;<span class="hljs-keyword"><span class="hljs-keyword">Read</span></span>("", <span class="hljs-type"><span class="hljs-type">name</span></span>)) { aliasRef.refs.push_back(AliasRefState()); aliasRef.refs.back().name = <span class="hljs-type"><span class="hljs-type">name</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (aliasRef.refs.size() != <span class="hljs-number"><span class="hljs-number">0</span></span>) { reader-&gt;<span class="hljs-keyword"><span class="hljs-keyword">Read</span></span>("", aliasRef.refs.back().device_index); } } reader-&gt;LeaveBlock(); } reader-&gt;<span class="hljs-keyword"><span class="hljs-keyword">Read</span></span>("modifier", aliasRef.modifier); reader-&gt;LeaveBlock(); } reader-&gt;LeaveBlock(); } ResolveAliases(); } reader-&gt;<span class="hljs-keyword"><span class="hljs-keyword">Release</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; }</code> </pre><br></div></div><br>  A file that describes aliases that handle deviations of sticks from two joysticks looks like this: <br><br><div class="spoiler">  <b class="spoiler_title">Alias ‚Äã‚Äãdescription</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"Aliases"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Player1.Up"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_STICK_V"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ] } ] }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Player1.Down"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_STICK_NEGV"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ] } ] }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Player2.Up"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_STICK_V"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> ] } ] }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Player2.Down"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_STICK_NEGV"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> ] } ] } ] }</code> </pre><br></div></div><br>  I described in detail the input of the code that works with joysticks in order to show how to organize the survey operation, if there are several devices of the same type.  If you need to support the work with 4 keyboards and 3 mice, then questions about how to do this should arise. <br><br>  Now consider the addition of the functionality that is needed to implement the control override.  The first method we need is: <br><br><pre> <code class="hljs axapta">const <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* Controls::GetActivatedKey(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&amp; device_index) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (auto&amp; halias : haliases) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = &amp;halias - &amp;haliases[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (halias.device == Joystick) { <span class="hljs-keyword"><span class="hljs-keyword">count</span></span> = XUSER_MAX_COUNT; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (device_index = <span class="hljs-number"><span class="hljs-number">0</span></span>; device_index&lt;<span class="hljs-keyword"><span class="hljs-keyword">count</span></span>; device_index++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GetHardwareAliasState(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>, Activated, device_index)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> halias.name.c_str(); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nullptr; }</code> </pre><br>  The method passes through all hardwired aliases, and if the alias becomes active, its string name will return.  This method is necessary to track the key pressed while the key is expected to be pressed by the user in the control key settings menu. <br><br>  And now we will describe the mechanism that allows you to do the opposite: say which hardware buttons are assigned for the alias.  To do this, we describe the structure: <br><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AliasMappig</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> alias = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BindName</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> device_index = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> name; }; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;BindName&gt;&gt; bindedNames; AliasMappig(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* name); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsContainHAlias</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* halias)</span></span></span></span>; };</code> </pre><br>  This structure will store the name of the alias itself, its id, all associated aliases (for example, the W and Up keys are responsible for moving forward) and combinations of aliases (to perform a roll in the direction, you must press Left Shift and A).  All this is filled in the constructor.  Also, this structure has the IsContainHAlias ‚Äã‚Äãmethod defined to understand if the hardware alias is zapinden to this alias.  This method may be necessary, for example, to avoid the assignment of an already assigned hardware alias.  The implementation of these methods is as follows: <br><br><pre> <code class="hljs pgsql">Controls::AliasMappig::AliasMappig(const <span class="hljs-type"><span class="hljs-type">char</span></span>* <span class="hljs-type"><span class="hljs-type">name</span></span>) { this-&gt;<span class="hljs-type"><span class="hljs-type">name</span></span> = <span class="hljs-type"><span class="hljs-type">name</span></span>; this-&gt;<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> = controls.GetAlias(<span class="hljs-type"><span class="hljs-type">name</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this-&gt;<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> != <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">Alias</span></span>&amp; <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span> = controls.aliases[this-&gt;<span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>]; <span class="hljs-type"><span class="hljs-type">int</span></span> count = <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>.aliasesRef.size(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count) { bindedNames.resize(count); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (auto&amp; bindedName : bindedNames) { <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> = &amp;bindedName - &amp;bindedNames[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-type"><span class="hljs-type">int</span></span> bind_count = <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>.aliasesRef[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>].refs.size(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bind_count) { bindedName.resize(bind_count); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (auto&amp; bndName : bindedName) { <span class="hljs-type"><span class="hljs-type">int</span></span> bind_index = &amp;bndName - &amp;bindedName[<span class="hljs-number"><span class="hljs-number">0</span></span>]; bndName.name = <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>.aliasesRef[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>].refs[bind_index].name; bndName.device_index = <span class="hljs-keyword"><span class="hljs-keyword">alias</span></span>.aliasesRef[<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>].refs[bind_index].device_index; } } } } } } <span class="hljs-type"><span class="hljs-type">bool</span></span> Controls::AliasMappig::IsContainHAlias(const <span class="hljs-type"><span class="hljs-type">char</span></span>* halias) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (auto bindedName : bindedNames) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (auto bndName : bindedName) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (StringUtils::IsEqual(bndName.name.c_str(), halias)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre><br>  Now go to the implementation of the game itself.  It consists of several screens: the start menu, the menu with the control override, the game itself with the pause menu.  Since  In all screens there is a menu, we describe the basic menu class, which will contain the functionality of navigating through the menu items and activating the menu item.  The logic of each of the screens will be implemented in the classes derived from the class Menu. <br><br>  First we give a file that describes the aliases that will be used in the menu itself: <br><br><div class="spoiler">  <b class="spoiler_title">Description of aliases for the menu</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"Aliases"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Menu.Up"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [<span class="hljs-string"><span class="hljs-string">"KEY_UP"</span></span>]}, { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [<span class="hljs-string"><span class="hljs-string">"JOY_LEFT_STICK_V"</span></span>] } ] }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Menu.Down"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [<span class="hljs-string"><span class="hljs-string">"KEY_DOWN"</span></span>]}, { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [<span class="hljs-string"><span class="hljs-string">"JOY_LEFT_STICK_NEGV"</span></span>] } ] }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Menu.Action"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [<span class="hljs-string"><span class="hljs-string">"KEY_RETURN"</span></span>]}, { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [<span class="hljs-string"><span class="hljs-string">"JOY_A"</span></span>] } ] } , { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Menu.AddHotkey"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [<span class="hljs-string"><span class="hljs-string">"KEY_LCONTROL"</span></span>]} ] } , { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Menu.StopEdit"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [<span class="hljs-string"><span class="hljs-string">"KEY_ESCAPE"</span></span>]} ] } , { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Menu.PauseGame"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [<span class="hljs-string"><span class="hljs-string">"KEY_ESCAPE"</span></span>]} ] } ] }</code> </pre><br></div></div><br>  File of aliases that will be used to control the players bits: <br><br><div class="spoiler">  <b class="spoiler_title">Description of alias player management</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"Aliases"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Player1.Up"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_STICK_V"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ] } ] }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Player1.Down"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"JOY_LEFT_STICK_NEGV"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ] } ] }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Player2.Up"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"KEY_P"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ] } ] }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Player2.Down"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AliasesRef"</span></span> : [ { <span class="hljs-attr"><span class="hljs-attr">"names"</span></span> : [ <span class="hljs-string"><span class="hljs-string">"KEY_L"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ] } ] } ] }</code> </pre><br></div></div><br>  Now we give the implementation of the base Menu class: <br><br><div class="spoiler">  <b class="spoiler_title">class menu</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Menu</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*MunuItemAction)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> alias_menu_up; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> alias_menu_down; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> alias_menu_act; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> alias_add_hotkey; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> alias_pause_game; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> alias_stop_edit; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sel_elemenet = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Item</span></span></span><span class="hljs-class"> {</span></span> Vector2 pos; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> text; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> data = <span class="hljs-number"><span class="hljs-number">-1</span></span>; MunuItemAction action; Item(Vector2 pos, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* text, MunuItemAction action, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> data = <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;pos = pos; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;text = text; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;action = action; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;data = data; } }; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;Item&gt; items; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Work</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dt)</span></span></span><span class="hljs-function"> </span></span>{ DrawElements(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (controls.GetAliasState(alias_menu_down)) { sel_elemenet++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sel_elemenet &gt;= items.size()) { sel_elemenet = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (controls.GetAliasState(alias_menu_up)) { sel_elemenet--; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sel_elemenet &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { sel_elemenet = items.size() - <span class="hljs-number"><span class="hljs-number">1</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (controls.GetAliasState(alias_menu_act) &amp;&amp; items[sel_elemenet].action) { items[sel_elemenet].action(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawElements</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; item : items) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = &amp;item - &amp;items[<span class="hljs-number"><span class="hljs-number">0</span></span>]; Color color = COLOR_WHITE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index == sel_elemenet) { color = COLOR_GREEN; } render.DebugPrintText(item.pos, color, item.text.c_str()); } } };</code> </pre><br></div></div><br>  We proceed to the implementation of the first screen, namely, the start screen.  It will only have two items: Start and Controls.  For this screen, the basic functionality is more than enough, so we only give the initialization and kalbeki for pressing each item: <br><br><pre> <code class="hljs java"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowControls</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ cur_menu = &amp;controls_menu; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowGame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ cur_menu = &amp;game_menu; game_menu.ResetGame(); } .. start_menu.items.push_back(Menu::Item(Vector2(<span class="hljs-number"><span class="hljs-number">365</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>), <span class="hljs-string"><span class="hljs-string">"Start"</span></span>, ShowGame)); start_menu.items.push_back(Menu::Item(Vector2(<span class="hljs-number"><span class="hljs-number">350</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>), <span class="hljs-string"><span class="hljs-string">"Controls"</span></span>, ShowControls));</code> </pre><br>  The second screen, the implementation of which we will consider, is the control settings screen.  Since  we consider a simple game Pong, which is designed for the game together, then our task is to redefine the actions of moving up and down the cue ball for each player, i.e.  There are a total of 4 actions.  Therefore, we define an array in which we will store data about the aliasing, and initialize it: <br><br><div class="spoiler">  <b class="spoiler_title">class ControlsMenu</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;Controls::AliasMappig&gt; controlsMapping; ... controlsMapping.push_back(Controls::AliasMappig(<span class="hljs-string"><span class="hljs-string">"Player1.Up"</span></span>)); controlsMapping.push_back(Controls::AliasMappig(<span class="hljs-string"><span class="hljs-string">"Player1.Down"</span></span>)); controlsMapping.push_back(Controls::AliasMappig(<span class="hljs-string"><span class="hljs-string">"Player2.Up"</span></span>)); controlsMapping.push_back(Controls::AliasMappig(<span class="hljs-string"><span class="hljs-string">"Player2.Down"</span></span>)); controlsMapping.push_back(Controls::AliasMappig(<span class="hljs-string"><span class="hljs-string">"Menu.AddHotkey"</span></span>)); controls_menu.items.push_back(Menu::Item(Vector2(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-string"><span class="hljs-string">"Up"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); controls_menu.items.push_back(Menu::Item(Vector2(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>), <span class="hljs-string"><span class="hljs-string">"Down"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)); controls_menu.items.push_back(Menu::Item(Vector2(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>), <span class="hljs-string"><span class="hljs-string">"Up"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)); controls_menu.items.push_back(Menu::Item(Vector2(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">350</span></span>), <span class="hljs-string"><span class="hljs-string">"Down"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)); controls_menu.items.push_back(Menu::Item(Vector2(<span class="hljs-number"><span class="hljs-number">370</span></span>, <span class="hljs-number"><span class="hljs-number">450</span></span>), <span class="hljs-string"><span class="hljs-string">"Back"</span></span>, HideControls)); ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ControlsMenu</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Menu { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sel_mapping = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> first_key = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> make_hotkey = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Work</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dt)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sel_mapping == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { Menu::Work(dt); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (controls.GetAliasState(alias_menu_act)) { sel_mapping = items[sel_elemenet].data; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sel_mapping != <span class="hljs-number"><span class="hljs-number">-1</span></span>) { first_key = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { make_hotkey = controls.GetAliasState(alias_add_hotkey, Controls::Active); DrawElements(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (controls.GetAliasState(alias_stop_edit)) { sel_mapping = <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> device_index; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* key = controls.GetActivatedKey(device_index); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (key &amp;&amp; !controlsMapping[<span class="hljs-number"><span class="hljs-number">4</span></span>].IsContainHAlias(key)) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> allow = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first_key) { controlsMapping[sel_mapping].bindedNames.clear(); first_key = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { allow = !controlsMapping[sel_mapping].IsContainHAlias(key); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (allow) { Controls::AliasMappig::BindName bndName; bndName.name = key; bndName.device_index = device_index; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (first_key || !make_hotkey) { <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;Controls::AliasMappig::BindName&gt; names; names.push_back(bndName); controlsMapping[sel_mapping].bindedNames.push_back(names); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { controlsMapping[sel_mapping].bindedNames.back().push_back(bndName); } } } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sel_mapping != <span class="hljs-number"><span class="hljs-number">-1</span></span>) { render.DebugPrintText(Vector2(<span class="hljs-number"><span class="hljs-number">180</span></span>, <span class="hljs-number"><span class="hljs-number">510</span></span>), COLOR_YELLOW, <span class="hljs-string"><span class="hljs-string">"Hold Left CONTROL to create key combination"</span></span>); render.DebugPrintText(Vector2(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">550</span></span>), COLOR_YELLOW, <span class="hljs-string"><span class="hljs-string">"Press ESCAPE to stop adding keys to alias"</span></span>); } render.DebugPrintText(Vector2(<span class="hljs-number"><span class="hljs-number">360</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>), COLOR_WHITE, <span class="hljs-string"><span class="hljs-string">"Player 1"</span></span>); render.DebugPrintText(Vector2(<span class="hljs-number"><span class="hljs-number">360</span></span>, <span class="hljs-number"><span class="hljs-number">250</span></span>), COLOR_WHITE, <span class="hljs-string"><span class="hljs-string">"Player 2"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; item : items) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = &amp;item - &amp;items[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.data != <span class="hljs-number"><span class="hljs-number">-1</span></span>) { Color color = COLOR_WHITE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index == sel_elemenet) { color = COLOR_GREEN; } <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> text[<span class="hljs-number"><span class="hljs-number">1024</span></span>]; text[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.data != sel_mapping || !first_key) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; bindedName : controlsMapping[item.data].bindedNames) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-number"><span class="hljs-number">0</span></span>) { StringUtils::Cat(text, <span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-string"><span class="hljs-string">", "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; bndName : bindedName) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = &amp;bndName - &amp;bindedName[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index != <span class="hljs-number"><span class="hljs-number">0</span></span>) { StringUtils::Cat(text, <span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-string"><span class="hljs-string">" + "</span></span>); } StringUtils::Cat(text, <span class="hljs-number"><span class="hljs-number">1024</span></span>, bndName.name.c_str()); } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.data == sel_mapping) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!make_hotkey) { StringUtils::Cat(text, <span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-string"><span class="hljs-string">", "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { StringUtils::Cat(text, <span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-string"><span class="hljs-string">" + "</span></span>); } } StringUtils::Cat(text, <span class="hljs-number"><span class="hljs-number">1024</span></span>, <span class="hljs-string"><span class="hljs-string">"_"</span></span>); } render.DebugPrintText(item.pos + Vector2(<span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), color, text); } } } };</code> </pre><br></div></div><br>  This code implements the assignment of an alias by polling GetActivatedKey.  If the Menu.AddHotkey (Left Control) alias is active, then the shortcut is set.  When the Menu.StopEdit (Escape) alias is activated, the alias job is terminated.  When returning to the main menu, you need to save the mapping, and we do it in the callback: <br><br><div class="spoiler">  <b class="spoiler_title">Saving mapping</b> <div class="spoiler_text"><pre> <code class="hljs php">void SaveMapping() { JSONWriter* writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JSONWriter(); writer-&gt;Start(<span class="hljs-string"><span class="hljs-string">"settings/controls/game_pc"</span></span>); writer-&gt;StartArray(<span class="hljs-string"><span class="hljs-string">"Aliases"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (auto cntrl : controlsMapping) { writer-&gt;StartBlock(nullptr); writer-&gt;Write(<span class="hljs-string"><span class="hljs-string">"name"</span></span>, cntrl.name.c_str()); writer-&gt;StartArray(<span class="hljs-string"><span class="hljs-string">"AliasesRef"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (auto&amp; bindedName : cntrl.bindedNames) { writer-&gt;StartBlock(nullptr); writer-&gt;StartArray(<span class="hljs-string"><span class="hljs-string">"names"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (auto&amp; bndName : bindedName) { writer-&gt;Write(nullptr, bndName.name.c_str()); writer-&gt;Write(nullptr, bndName.device_index); } writer-&gt;FinishArray(); writer-&gt;FinishBlock(); } writer-&gt;FinishArray(); writer-&gt;FinishBlock(); } writer-&gt;FinishArray(); writer-&gt;Release(); } void HideControls() { cur_menu = &amp;start_menu; SaveMapping(); controls.LoadAliases(<span class="hljs-string"><span class="hljs-string">"settings/controls/game_pc"</span></span>); }</code> </pre><br></div></div><br>  The last step is the description of the class that implements the game screen: <br><br><div class="spoiler">  <b class="spoiler_title">class GameMenu</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GameMenu</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Menu { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> paused = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> player_speed = <span class="hljs-number"><span class="hljs-number">500.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> player_size = <span class="hljs-number"><span class="hljs-number">16.0f</span></span> * <span class="hljs-number"><span class="hljs-number">4.0f</span></span>; Vector2 ball_start_pos = Vector2(<span class="hljs-number"><span class="hljs-number">400.0f</span></span>, <span class="hljs-number"><span class="hljs-number">300.0f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ball_speed = <span class="hljs-number"><span class="hljs-number">450.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ball_radius = <span class="hljs-number"><span class="hljs-number">8.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> player1_pos; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> player2_pos; Vector2 ball_pos; Vector2 ball_dir; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> player1_score; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> player2_score; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResetBall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ball_pos = ball_start_pos; ball_dir.x = rnd_range(<span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>); ball_dir.y = rnd_range(<span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>); ball_dir.Normalize(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResetGame</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ player1_pos = <span class="hljs-number"><span class="hljs-number">300.0f</span></span> - player_size * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; player2_pos = <span class="hljs-number"><span class="hljs-number">300.0f</span></span> - player_size * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; player1_score = <span class="hljs-number"><span class="hljs-number">0</span></span>; player2_score = <span class="hljs-number"><span class="hljs-number">0</span></span>; ResetBall(); paused = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdatePlayer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dt, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;pos)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (controls.GetAliasState(controlsMapping[index + <span class="hljs-number"><span class="hljs-number">0</span></span>].alias, Controls::Active)) { pos -= dt * player_speed; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pos &lt; <span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { pos = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (controls.GetAliasState(controlsMapping[index + <span class="hljs-number"><span class="hljs-number">1</span></span>].alias, Controls::Active)) { pos += dt * player_speed; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pos &gt; <span class="hljs-number"><span class="hljs-number">600.0f</span></span> - player_size) { pos = <span class="hljs-number"><span class="hljs-number">600.0f</span></span> - player_size; } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateBall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dt)</span></span></span><span class="hljs-function"> </span></span>{ ball_pos += ball_dir * ball_speed * dt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ball_pos.y &lt; ball_radius) { ball_pos.y = ball_radius; ball_dir.y = -ball_dir.y; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ball_pos.y &gt; <span class="hljs-number"><span class="hljs-number">600</span></span> - ball_radius) { ball_pos.y = <span class="hljs-number"><span class="hljs-number">600</span></span> - ball_radius; ball_dir.y = -ball_dir.y; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (player1_pos &lt; ball_pos.y &amp;&amp; ball_pos.y &lt; player1_pos + player_size &amp;&amp; ball_pos.x &lt; <span class="hljs-number"><span class="hljs-number">15.0f</span></span> + ball_radius) { ball_pos.x = <span class="hljs-number"><span class="hljs-number">16.0f</span></span> + ball_radius; ball_dir.x = <span class="hljs-number"><span class="hljs-number">1.0</span></span>; ball_dir.y = (ball_pos.y - (player1_pos + player_size * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>)) / player_size; ball_dir.Normalize(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (player2_pos &lt; ball_pos.y &amp;&amp; ball_pos.y &lt; player2_pos + player_size &amp;&amp; ball_pos.x &gt; <span class="hljs-number"><span class="hljs-number">785.0f</span></span> - ball_radius) { ball_pos.x = <span class="hljs-number"><span class="hljs-number">784.0f</span></span> - ball_radius; ball_dir.x = <span class="hljs-number"><span class="hljs-number">-1.0</span></span>; ball_dir.y = (ball_pos.y - (player2_pos + player_size * <span class="hljs-number"><span class="hljs-number">0.5f</span></span>)) / player_size; ball_dir.Normalize(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ball_pos.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { player2_score++; ResetBall(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ball_pos.x &gt; <span class="hljs-number"><span class="hljs-number">800</span></span>) { player1_score++; ResetBall(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawPlayer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Vector2 pos)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>; i++) { render.DebugPrintText(pos + Vector2(<span class="hljs-number"><span class="hljs-number">0</span></span>, i * <span class="hljs-number"><span class="hljs-number">16.0f</span></span>), COLOR_WHITE, <span class="hljs-string"><span class="hljs-string">"8"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Work</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dt)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (paused) { Menu::Work(dt); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { UpdatePlayer(dt, <span class="hljs-number"><span class="hljs-number">0</span></span>, player1_pos); UpdatePlayer(dt, <span class="hljs-number"><span class="hljs-number">2</span></span>, player2_pos); UpdateBall(dt); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (controls.GetAliasState(alias_pause_game)) { paused = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } DrawPlayer(Vector2(<span class="hljs-number"><span class="hljs-number">3</span></span>, player1_pos)); DrawPlayer(Vector2(<span class="hljs-number"><span class="hljs-number">785</span></span>, player2_pos)); render.DebugPrintText(ball_pos - Vector2(ball_radius), COLOR_WHITE, <span class="hljs-string"><span class="hljs-string">"O"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> str[<span class="hljs-number"><span class="hljs-number">16</span></span>]; StringUtils::Printf(str, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-string"><span class="hljs-string">"%i"</span></span>, player1_score); render.DebugPrintText(Vector2(<span class="hljs-number"><span class="hljs-number">375</span></span>, <span class="hljs-number"><span class="hljs-number">20.0f</span></span>), COLOR_WHITE, str); render.DebugPrintText(Vector2(<span class="hljs-number"><span class="hljs-number">398</span></span>, <span class="hljs-number"><span class="hljs-number">20.0f</span></span>), COLOR_WHITE, <span class="hljs-string"><span class="hljs-string">":"</span></span>); StringUtils::Printf(str, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-string"><span class="hljs-string">"%i"</span></span>, player2_score); render.DebugPrintText(Vector2(<span class="hljs-number"><span class="hljs-number">415</span></span>, <span class="hljs-number"><span class="hljs-number">20.0f</span></span>), COLOR_WHITE, str); } };</code> </pre><br></div></div><br>  That's all.  With a simple example, we demonstrated simplicity and flexibility when working with an input device polling system.  The system is not cluttered with code and is not replete with unnecessary methods. <br><br>  ‚Üí <a href="https://github.com/ENgineE777/Controls2">Link to an example of using a working system</a> <br><br>  Also, this system was written for an engine called Atum.  <a href="https://github.com/ENgineE777/Atum">The repository of all the sources of the engine</a> - they have a lot of interesting things. </div><p>Source: <a href="https://habr.com/ru/post/343832/">https://habr.com/ru/post/343832/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343822/index.html">Heading "We read articles for you." October - November 2017</a></li>
<li><a href="../343824/index.html">MySQL and partitioning</a></li>
<li><a href="../343826/index.html">Russia's first mitap on Apache Ignite, December 12</a></li>
<li><a href="../343828/index.html">Writing a simple Linux kernel module</a></li>
<li><a href="../343830/index.html">Dependency injection in .Net Mark Siman 1 - Dependencies between application layers</a></li>
<li><a href="../343834/index.html">Introduction to reinforcement training: from a multi-armed gangster to a full-fledged RL agent</a></li>
<li><a href="../343836/index.html">EU GDPR: Compliance with the requirements of regulators in the field of cloud computing</a></li>
<li><a href="../343838/index.html">Analyze it - Lenta.ru</a></li>
<li><a href="../343840/index.html">Renga development team: how we reached the idyll, working without managers</a></li>
<li><a href="../343842/index.html">WD (Western Digital) plans to create a 40 TB disk, but is this enough?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>