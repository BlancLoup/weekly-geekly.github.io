<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Object initializers in using block</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Object Initializers (Object Initializers) is a useful feature of the C # language, which allows you to initialize the necessary properties of an objec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Object initializers in using block</h1><div class="post__text post__text-html js-mediator-article">  Object Initializers (Object Initializers) is a useful feature of the C # language, which allows you to initialize the necessary properties of an object right at the time of its creation.  Since, syntactically, this ‚Äúfeature‚Äù is very close to initializing an object with passing parameters through a constructor, many developers begin to hammer on OOP principles (in particular, on the concept of an invariant) and use it wherever possible. <br><br>  But even if we don‚Äôt go over to holivars and obscure terms, let's consider a small example and consider whether it can lead to problems or not: <br><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// position     -  long position = -1; using (var file = new FileStream("d:\\1.txt", FileMode.Append) { //   ,     //   ! Position = position }) { //  -   }</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this fragment, a resource (file) is created inside the <b>using</b> directive and one of its properties ( <b>Position</b> ) is set using the object initializer.  In this case, the most important thing in this code is that the <b>setter of</b> this property can generate an exception. <br><a name="habracut"></a><br>  Unlike C ++ in .NET, we rarely encounter exceptions security problems, but this is one of those rare cases where code <b>is unsafe from the point of view of exceptions</b> . <br><br>  To understand this, let's see how the object's initializer is implemented by the compiler: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Person</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Age { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">// ... var person = new Person {Name = "John", Age = 42};</span></span></code> </pre><br><br>  At first glance, it may seem that the object's initializer is nothing more than a call to the constructor and then change its properties.  And, in fact, the way it is, with only a small clarification: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person(); tmp.Name = <span class="hljs-string"><span class="hljs-string">"Jonh"</span></span>; tmp.Age = <span class="hljs-number"><span class="hljs-number">42</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> person = tmp;</code> </pre><br><br>  A temporary variable is a necessary condition for the "atomicity" of initialization, without which third-party code (for example, from another thread) could get a reference to an object in an intermediate state.  In addition, the absence of a temporary variable would make the code even less safe from the point of view of exceptions, because then generating an exception from the setter property would result in partial initialization of the variable: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person(); tmp.Name = <span class="hljs-string"><span class="hljs-string">"John"</span></span>; tmp.Age = <span class="hljs-number"><span class="hljs-number">42</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> person = tmp;</code> </pre><br><br>  In this case, if the setter of one of the properties falls with the exception, then the <b>_</b> <b>person</b> field will already be initialized, but not completely, which would violate the "atomicity" of the object initializer, which is so familiar with the use of constructors. <br><br>  However, although the temporary variable solves a number of problems, this does not happen when using an object initializer within the <b>using</b> directive.  As you know, the <b>using</b> directive expands to this code: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(<span class="hljs-string"><span class="hljs-string">"d:\\1.txt"</span></span>, FileMode.OpenOrCreate); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) ((IDisposable)file).Dispose(); }</code> </pre><br><br>  Now, if we add up 2 and 2, then we get that our original example turns into the following: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> position = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tmpFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(<span class="hljs-string"><span class="hljs-string">"d:\\1.txt"</span></span>, FileMode.OpenOrCreate); <span class="hljs-comment"><span class="hljs-comment">// !    ,  Dispose   ! tmpFile.Position = position; var file = tmpFile; try { } finally { if (file != null) ((IDisposable)file).Dispose(); }</span></span></code> </pre> <br><br>  And this means that if a property initialized with an object's initializer falls with an exception, the <b>Dispose</b> method of our object will not be called. <br><br>  <b>Conclusion</b> <br><br>  Object initializers are a useful feature, but you need to be able <s>to</s> use it as well.  Although syntactically (and semantically, by the way, too) this possibility is very close to calling the constructor, but, unfortunately, they are not always equivalent.  As for the principles of OOP, then it is up to you to decide when to use an object initializer, and when not, but when it comes to exceptions security and resource management, then you definitely need to understand how this feature works and what follows from this. <br><br>  C # language has a rather predictable behavior in most cases (although there are exceptions, such as subtleties with <a href="http://sergeyteplyakov.blogspot.com/2011/07/blog-post.html">variable significant types</a> ), but mixing object initializers with a <strong>using</strong> block doesn‚Äôt differ by intuitiveness and it is desirable to understand exactly how this combination works so as not to shoot yourself carelessness. </div><p>Source: <a href="https://habr.com/ru/post/144240/">https://habr.com/ru/post/144240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144231/index.html">Leap Motion gesture controller - a new word in gesture recognition</a></li>
<li><a href="../144232/index.html">Ultra-precise gesture recognition controller for $ 70</a></li>
<li><a href="../144233/index.html">GitHub released Windows client</a></li>
<li><a href="../144237/index.html">We write and optimize the life of Conway on JS</a></li>
<li><a href="../144239/index.html">4G LTE Internet Megaphone</a></li>
<li><a href="../144241/index.html">Development and adaptation of games for mobile platforms</a></li>
<li><a href="../144243/index.html">Collection of Opera Mini User Signatures</a></li>
<li><a href="../144244/index.html">Mod for Minecraft, adding microprocessor</a></li>
<li><a href="../144245/index.html">Notepad ++ site flaw</a></li>
<li><a href="../144248/index.html">Another copter: part two, frame collection</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>