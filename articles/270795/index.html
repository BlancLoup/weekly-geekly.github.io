<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Share experience. FirePOWER Services Integration on Cisco ASA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi habr! In this article, I wanted to share my experience in implementing FirePOWER services on the Cisco ASA firewall. What is FirePOWER, SourceFIRE,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Share experience. FirePOWER Services Integration on Cisco ASA</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/fbb/502/d3e/fbb502d3ed6149129b7f150500f54ab2.jpg"><br><br>  Hi habr!  In this article, I wanted to share my experience in implementing FirePOWER services on the Cisco ASA firewall.  What is FirePOWER, SourceFIRE, etc.  Already a lot has been written on Habr√© in the blog of the company cisco <a href="http://habrahabr.ru/company/cisco/blog/229195/">here</a> and <a href="http://habrahabr.ru/company/cisco/blog/237759/">here</a> .  In this article I will try first to describe the process of initialization of a solution from a practical point of view, to tell about the nuances and problems that had to be encountered. <br><a name="habracut"></a><br>  The description of the initial system initialization steps described in this article is based on the FirePOWER Services for ASA POV Best Practices document. <br><br>  The article will be divided into two parts.  In the first part, I will describe points that, in my opinion, should be paid special attention to during the planning and implementation stages of the solution.  The first point is the FirePOWER licensing features of Cisco ASA, the second is the user authentication and system integration features with Microsoft Active Directory.  In the second part I will go through all the implementation steps, highlighting as little as possible nuances. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Immediately make a small comment.  At the time of implementing FirePOWER on the Cisco ASA, described in this article, the FirePOWER services on the ASA5515 were configured only with the help of the stand-alone Defense Center (FireSIGHT) management system.  The preferred option was the Defense Center virtual machine.  This option is described in the article.  However, almost before the moment of publication of the article, a new version of FirePOWER 6.0.0.0 was released.  Judging by the <a href="http://www.cisco.com/c/en/us/td/docs/security/firepower/60/relnote/firepower-system-release-notes-version-600.html">Release Notes</a> , in the new version of FirePOWER, management can be carried out using the ASA-ASDM graphical interface, that is, the use of a separate management system is not a prerequisite. <br><br><h2>  FirePOWER Licensing Features on Cisco ASA </h2><br>  Since there is a confusion with licenses from time to time, I will try to clarify. <br><br>  All licenses are installed using FireSIGHT.  The following set of licenses is required to implement FirePOWER services on Cisco ASA: <br><ol><li>  FireSIGHT license; </li><li>  License PROTECT + CONTROL; </li><li>  Subscription licenses (Protection, URL Filtering, Malware); </li></ol><br>  Now we‚Äôll focus on each type of license in more detail. <br><br>  <b>FireSIGHT license</b> <br><br>  This license provides the ability to detect devices and users on the network (Discovery Policies).  The license has no restrictions on the term of validity.  An example of a FireSIGHT license partner number for managing up to two Cisco ASAs with a FirePOWER module: <br><br>  FS-VMW-2-SW-K9 = <br>  Cisco FireSIGHT Management Center, (VMWare) for 2 devices <br><br>  In the FireSIGHT interface in the System -&gt; Licenses tab, this license will open the following items: <br><br><img src="https://habrastorage.org/files/f3a/863/3b2/f3a8633b293c444083284ad7fbef7dcc.jpg"><br><br>  The number 50,000 is the maximum possible number of detectable devices and users supported by a particular model of the Defense Center (FireSIGHT).  For virtual FireSIGHT, this is exactly the limit - 50 thousand. <br><br>  By the way, we didn‚Äôt notice anywhere in FireSIGHT, where the limit on the number of connected managed devices (FirePOWER modules) is indicated ... <br><br>  <b>PROTECT + CONTROL license</b> <br><br>  This license opens functionality: <br><ul><li>  PROTECT: IPS, file monitoring (file type detection, the ability to block download / upload files by type), Security Intelligence (bot network detection / blocking, Open Proxy, Spam distributors, TOR, etc.).  Here you need to make a reservation.  For full IPS operation, in addition to the PROTECT license, a subscription license is required to access the Cisco cloud, from which IPS signature updates will be downloaded.  Subscription licenses will be discussed below. </li><li>  CONTROL: Recognition and control of applications, access control for users. </li></ul>  The license has no restrictions on the term of validity. <br><br>  Example of license number PROTECT + CONTROL for ASA5515: <br><br>  ASA5515-CTRL-LIC = <br>  Cisco ASA5515 Control License <br><br>  On FireSIGHT in the System -&gt; Licenses tab, this license will open the following items: <br><br><img src="https://habrastorage.org/files/ce6/19d/cb0/ce619dcb0953409095e256b6e337a8d0.jpg"><br><br>  <u>Nuance license PROTECT + CONTROL.</u>  I want to pay special attention, this partnumber has zero cost.  I recommend very carefully tracking the specifications at the time of the order so that this partnumber is not lost anywhere.  In my case, this is exactly what happened.  PAK for the license ASA5515-CTRL-LIC is not available.  I had to write a letter to licensing@cisco.com with a request to generate a missing license for me.  We must pay tribute to Cisco TAC, the missing license was sent within six hours, without asking any unnecessary questions. <br><br>  <b>Subscription Licenses (Protection, URL Filtering, Malware)</b> <br><br>  These licenses open functionality: <br><ul><li>  Protection.  Subscribe to IPS signature updates; </li><li>  URL Filtering.  Subscribe to update URL categories and reputations; </li><li>  Malware.  Subscription to AMP functionality - checking files for the presence of malicious code based on the analysis of the reputation of files passing through the device (reputation is requested for the value of the hash function applied to the file). </li></ul><br>  Subscription licenses may be valid for 1 year and 3 years.  For new ASA models (5506, 5508, 5516), subscriptions for 5 years are available. <br><br>  <u>The nuance of subscription licenses</u> .  A very important point.  Subscription licenses take effect from the moment of ordering, and not from the moment of installation on the device.  Thus, if work on the implementation of the system began 3 months after the moment of ordering the licenses, then these 3 months of validity of the license will be irretrievably lost. <br><br>  <u>Update</u> <br>  FirePOWER Subscription Licenses are valid 31 days after ordering.  Recently it became known that since November 2015, when ordering FirePOWER license-subscriptions, it became possible to indicate a shift in the beginning and end of the license validity in months.  The maximum shift period is 2 months (60 days). <br><br>  Licenses are combined into various bundle options (URL Filtering + Protection, Protection + Malware, URL Filtering + Protection + Malware).  In my case, the URL Filtering + Protection license was used.  The partnumber looked like this: <br><br>  L-ASA5515-TAC = <br>  Cisco ASA5515 FirePOWER IPS and URL Licenses <br><br>  On FireSIGHT in the System -&gt; Licenses tab, this license will open the following items: <br><br><img src="https://habrastorage.org/files/11d/999/ac9/11d999ac9c08456495997cfd76467c6a.jpg"><br><br>  I draw your attention, although this subscription includes a subscription to IPS (Protection), the presence of the Protection license is displayed elsewhere, for which the PROTECT + CONTROL license is responsible. <br><br><h2>  Features user authentication and integration with AD </h2><br>  Since we want to be able to authenticate users and apply Internet access policies to specific accounts and / or groups of AD, system integration with AD is necessary. <br><br>  At the time of our FirePOWER implementation on the Cisco ASA, user authentication only occurs in passive mode.  Passive authentication implies that the ‚Äúagent‚Äù software is installed separately, which ‚Äúlistens‚Äù to user activity in AD logs, forms the IP address matching database - the users, and transmits this information to the system (in our case, FireSIGHT).  The big plus of passive authentication is the fact that the User Experience for the end user does not change at all.  But there are also disadvantages, which I will try to tell you. <br><br>  The lack of a passive authentication approach is manifested primarily if a company has several users simultaneously using the same domain machine (or more precisely, one IP address) to access the Internet.  Such an authentication scheme may lead to incorrect access restriction rules.  The simplest example of a problem situation is the use of a terminal farm (built on the basis of Microsoft RDS).  The problem manifests itself if users of the same terminal server should have different access restrictions to the Internet.  Each new user logging into the terminal server system grants the entire IP address of the server (and, therefore, all other working users) its own access to the Internet. <br><br>  Also, the problem with the incorrect granting of access rights may occur if at the time of the user's login to the system the PC was disconnected from the network.  Thus, in theory, the new user will be able to get the access rights of the previous PC user, if after some time the PC is connected back to the network. <br><br>  Another approach to the authentication procedure is active user authentication.  Active user authentication was announced for FirePOWER almost before the moment of publication of this article.  Active authentication implies that the user, in order to gain access to the Internet, must independently enter his credentials at the request of the system. <br><br>  Active authentication can be enhanced with Single Sign On (SSO).  In this case, the user does not need to enter anything.  We had experience implementing a previous Cisco solution in the NGFW class - ASA CX.  Due to the interface of several technologies, namely, active authentication in SSO mode, IP Virtualization on terminal servers and special DHCP configuration, ASA CX was able to solve the problem of correct authentication of terminal server users.  The solution of the described task by means of the ASA + FirePOWER product has not yet been verified by us. <br><br>  By the way, some time ago we compared various systems that provide firewall functions for a new generation.  Products such as ASA CX, ASA FirePOWER, Cisco WSA (despite the fact that this is a web proxy, and not NGFW, WSA provides similar capabilities in terms of controlling Internet access), Checkpoint and Fortigate were compared.  In the process of testing, we paid special attention to user authentication procedures and, in particular, to the problem of authentication of terminal server users.  As a result, we found out that the Cisco WSA web proxy server and Checkpoint software and hardware systems are able to correctly recognize users of terminal servers. <br><br>  Cisco WSA is able to identify client sessions not only by source IP address, but also by so-called session fingerprints (Session Cookies).  Simply put, Cisco WSA sends information to the user browser, which is then used on the WSA to determine if a session belongs to a particular user.  Therefore, Internet access filtering rules will correctly apply to users of terminal servers that access the Internet from the same IP address. <br><br>  Checkpoint proposes to use special software - Identity Agent, which can also be installed on the terminal server (hereinafter TC).  The principle of operation of the TS agent differs from the principle of operation of the WSA.  TS Agent installs a TDI driver (Transport Driver Interface), which intercepts all requests from all user processes to a new connection.  As soon as TDI receives such a request, it tells the system to assign the user to this new connection and selects the outgoing port for it from the port pool allocated specifically to this user. <br><br>  But back to FireSIGHT and FirePOWER.  As noted earlier, user authentication in our case works in a passive mode.  The agent is software FireSIGHT User Agent.  What is this agent, and what settings you need to perform, will be discussed later in the "Implementation Process" section.  At the moment, I want to add only one thing: in the step of integrating the system with the corporate Active Directory, you will probably need the support of Microsoft specialists, Active Directory administrators.  First, it may be necessary to check the settings and / or reconfigure Active Directory in accordance with the requirements of the User Agent.  User Agent requirements can be found in <a href="http://www.cisco.com/c/dam/en/us/td/docs/security/firesight/user-agent/FireSIGHT-User-Agent-Configuration-Guide-v2-2.pdf">the User Guide</a> in the ‚Äú <i>Configuring Permissions to Connect to an Active Directory Server</i> ‚Äù section. <br><br>  Secondly, if something does not work: (and we did not work a couple of times), we will need help in diagnosing the problem. <br><br><h2>  Implementation process </h2><br>  So, let's proceed to the description of the implementation process.  I was lucky to implement the FirePOWER solution on the Cisco ASA5515.  The introduction of the Cisco ASA 5515 firewall into the network infrastructure in this article is omitted and I begin the story from the stage when it was necessary to implement FirePOWER services directly. <br><br>  First of all, I highlighted the following plan, which I followed later: <br><ul><li>  Install FireSIGHT Management System: <br>  1. Deploy and configure the FireSIGHT management virtual machine; <br>  2. Install the necessary licenses; <br>  3. Install the patch for FireSIGHT; <br></li><li>  Install the FirePOWER software module on Cisco ASA: <br>  4. Upgrade IOS on Cisco ASA to version 9.2.2 (4) or higher; <br>  5. Install the SSD disk on the Cisco ASA; <br>  6. Install and configure the FirePOWER software module on the Cisco ASA; <br></li><li>  Further settings: <br>  7. Connect the FirePOWER software module to the FireSIGHT control system; <br>  8. Install the patch for the FirePOWER module using the FireSIGHT management system; <br>  9. Install FireSIGHT User Agent for system integration with corporate server AD; <br>  10. Set up the implemented system in accordance with best practice; <br>  11. Configure user access policies on the Internet. <br></li></ul><br>  So, <b>step number 1</b> - Deploy and configure the virtual machine of the FireSIGHT management system.  You need to deploy a virtual machine from the OVF-template on the ESXi server.  I will not describe this step in detail, there is a <a href="http://www.cisco.com/c/en/us/td/docs/security/firesight/541/virtual-install-guide/FireSIGHT-Virtual-Installation-Guide/V-Install.html">detailed instruction</a> . <br><br>  System requirements for FireSIGHT: <br><table><tbody><tr><th>  Option </th><th>  Default value </th><th>  Custom value </th></tr><tr><td>  RAM </td><td>  4 GB </td><td>  4 GB - minimum <br>  7 GB - maximum (recommended when using filtering by categories and site reputation and using Security Intelligence functionality) </td></tr><tr><td>  Virtual processors </td><td>  four </td><td>  until 6 </td></tr><tr><td>  Hard drives </td><td>  250 GB </td><td>  not customizable </td></tr></tbody></table>  Officially supported virtualization environments: <br><ul><li>  VMware ESXi 5.5 (vSphere 5.5) </li><li>  VMware ESXi 5.1 (vSphere 5.1) </li><li>  VMware vCloud Director 5.1 </li></ul><br>  <u>Nuances</u> . At this step, I did not single out any interesting nuances.  The only time I wanted to mention is that the first launch of FireSIGHT takes a long time. <br><br>  First, during the boot process, FireSIGHT will offer to wait 30 minutes: <br><br><img src="https://habrastorage.org/files/654/5d2/5e1/6545d25e1f734928825ed836f09cba91.png"><br><br>  And then another 10 minutes: <br><br><img src="https://habrastorage.org/files/1ce/72d/b4c/1ce72db4cfbb4a31960a3097918727e5.png"><br><br>  After loading FireSIGHT in the console, we see the standard linux-like command shell.  To carry out the initial initialization and installation of network settings, you must run the appropriate script and complete all the proposed steps: <br><br><img src="https://habrastorage.org/files/2f9/a27/f41/2f9a27f41ec94d19a641c92db9ae24cb.png"><br><br>  And now, we finally get the long-awaited FireSIGHT Web interface: <br><br><img src="https://habrastorage.org/files/ed7/c8e/9f4/ed7c8e9f490c452b8f48400b4979b274.png"><br><br>  After the first login to the Web interface, FireSIGHT will prompt you to change the administrator password and perform / confirm additional initialization settings (network settings, date / time settings, update settings, backup settings, etc.) <br><br>  <b>Step # 2</b> - Install the necessary licenses. <br>  All required licenses are supplied in the Product Activation Key (PAK) format: <br><br><img src="https://habrastorage.org/files/a7a/8e2/2d4/a7a8e22d4f57433091a64aaa3180b149.png"><br><br>  In order to generate license files from the PAK data, you need to go through the standard procedure for almost any Cisco Systems product on the <a href="https://www.cisco.com/go/license">Product License Registration</a> site. <br><br>  In the case of a FireSIGHT virtual machine, licenses are tied to a specific instance.  If you want to deploy a second copy from the same OVF-template, to complete the work you will need to purchase an additional set of licenses.  The unique identifier of the virtual machine is the <i>License Key</i> parameter.  You can learn the <i>License Key of the</i> FireSIGHT virtual machine on the <i>System -&gt; Licenses</i> tab by clicking the <i>Add New License</i> button: <br><br><img src="https://habrastorage.org/files/5c5/765/342/5c57653426cd48e2985650cdd7720d48.png"><br><br>  This License Key must be entered together with PAK during the process of generating a license file on the above site: <br><br><img src="https://habrastorage.org/files/bae/786/112/bae786112f4546cbac7702e673c90e77.png"><br><br>  If you later need to obtain license files for another FireSIGHT instance with a different <i>License Key</i> parameter, you will need to carry out the License Rehosting procedure (similar to the situation when Cisco equipment is replaced by RMA). <br>  After completing the PAK registration procedure on the site, the contents of the obtained license files must be entered into FireSIGHT: <br><br><img src="https://habrastorage.org/files/0a6/bfd/b0b/0a6bfdb0b8df497e84db8990b7d14760.png"><br><br>  I have already described the <u>nuances of</u> licensing in detail in the first part of the article.  Here I will remind again two main ideas: <br>  1. Do not lose the CTRL license for Cisco ASA (free position in the specification); <br>  2. Subscription licenses take effect from the moment an order is completed. <br><br>  <b>Step # 3</b> - Install the patch for FireSIGHT.  It is recommended to install the latest patch for your version of FireSIGHT.  Intermediate patches do not need to be installed, because they are embedded in the last patch. <br>  Patches are installed on the <i>System -&gt; Updates</i> tab: <br><br><img src="https://habrastorage.org/files/6c2/347/13a/6c234713a7c443dfabcfb3be8aa34110.png"><br><br>  After installing the patch, the system will automatically reboot. <br><br>  <u>Nuances</u>  At this step, there are no nuances.  The only point that I again wanted to mention is that the installation of patches is a long process, therefore I recommend to perform this step in advance. <br><br>  <b>Step 4</b> - Upgrade IOS to Cisco ASA to version 9.2.2 (4) or higher.  FirePOWER module support on Cisco ASA is claimed starting with IOS version 9.2.2 (4) and higher, so an IOS upgrade is required.  This information is described in <a href="http://www.cisco.com/c/en/us/td/docs/security/asa/compatibility/asamatrx.html">Cisco ASA Compatibility</a> , Table 8, ‚Äú <i>ASA Module Compatibility</i> .‚Äù <br><br>  <u>Nuances</u>  Special nuances again, no.  Ways to upgrade ASA to version 9.2.2 are described in the <a href="http://www.cisco.com/c/en/us/td/docs/security/asa/asa92/release/notes/asarn92.html">Release Notes</a> in the <i>Upgrading</i> section of <i>the Software</i> . <br><br>  If any other software modules (Legacy IPS or ASA CX) were used on the Cisco ASA prior to FirePOWER deployment, you must uninstall these modules. <br><br>  <b>Step # 5</b> - Install the SSD on the Cisco ASA. <br><br><img src="https://habrastorage.org/files/172/036/1c8/1720361c853c4419bfdfd0c4c522e102.jpg"><br><br>  <u>Nuances</u>  The SSD drive is Hot-swappable, but in order for the ASA to see it, a reboot is required.  The status of the SSD drive can be checked with the command inventory inventory: <br><br><img src="https://habrastorage.org/files/4d7/88a/1a0/4d788a1a04df40119a9c18e828888476.png"><br><br>  <b>Step 6</b> ‚Äî Install and Configure the FirePOWER Software Module on the Cisco ASA.  First you need to install the boot image: <br><br><img src="https://habrastorage.org/files/8e0/07b/eb0/8e007beb01e44d098f9706cc15eb92c0.png"><br><br>  The installation process will take 10-15 minutes.  You can check whether the installation has completed or not by using the session sfr console command.  If an error message is displayed, wait.  If the boot image fails on the command line, the download completed successfully. <br>  Next, you need to perform network settings and run the installation system package: <br><br><img src="https://habrastorage.org/files/dd9/fb5/3f7/dd9fb53f71904271a988d0e58e3df7be.png"><br><br>  After installing the system package, you need to repeat the network settings again and specify the management system for this FirePOWER module, i.e.  specify the IP address of our FireSIGHT system, which we deployed in the previous steps: <br><br><img src="https://habrastorage.org/files/ff7/a0a/58a/ff7a0a58ab7948c9bb0173028a57e550.png"><br><br>  <u>Nuance.</u>  To get to the FirePOWER command line from the Cisco ASA command line, enter the session sfr console command from enable mode (privileged mode).  To return to the Cisco ASA command line, you need to hold down the CTRL + SHIFT + 6 combination, release this combination and press the letter key "x". <br><br>  <b>Step # 7</b> - Connect the FirePOWER software module to the FireSIGHT control system.  In the previous step, during the configuration of the FirePOWER module, we specified for it the control system of the command configure manager add.  Now, on the FireSIGHT management system, we also need to add a new managed device.  This can be done on the <i>Devices -&gt; Device Management</i> tab by clicking the <i>Add Device</i> button: <br><br><img src="https://habrastorage.org/files/985/82e/3e5/98582e3e514d4fe5b375bb7ef8a70da3.png"><br><br>  After adding ASA5515 FirePOWER to the FireSIGHT management system, you need to apply the existing licenses to the managed module: <br><br><img src="https://habrastorage.org/files/b39/b77/a2c/b39b77a2cf8d4085b98e6759f1671d97.png"><br><br>  <u>Nuance.</u>  At this step, there are no nuances. <br><br>  <b>Step # 8</b> - Install the patch for the FirePOWER module using the FireSIGHT management system.  In step 3, we have already installed a patch for FireSIGHT.  Now you need to install a patch for the managed device - the FirePOWER module.  As usual, it is recommended to install the latest patch for your version.  Intermediate patches do not need to be installed, because they are embedded in the last patch. <br>  Patches are installed on the <i>System -&gt; Updates</i> tab: <br><br><img src="https://habrastorage.org/files/e8c/925/600/e8c92560082f4bb7aea1402d0eab9ee4.png"><br><br>  After installing the patch, the FirePOWER module will automatically restart. <br>  <u>Nuance.</u>  At this step, there are no nuances.  The only time, again, installing patches is a long process. <br><br>  <b>Step # 9</b> - Install the FireSIGHT User Agent to integrate the system with the corporate AD server.  I already described the features of integrating the system with AD and the user authentication process in the first part of the article.  Here I will show what and how you need to configure. <br>  First you need to perform two actions on FireSIGHT in the <i>Policies -&gt; Users</i> tab: <br><br><img src="https://habrastorage.org/files/fd5/a9b/d9e/fd5a9bd9ed5f47fd9f87816c26394088.png"><br><br>  The first step is to create a direct FireSIGHT connection to Active Directory (the Add LDAP Connection button) and set the necessary LDAP parameters in the menu that appears (IP addresses / ports AD, BASE DN, user account).  A direct FireSIGHT connection is necessary so that you can create access policies for specific users and groups from AD.  In addition, a direct connection is necessary to determine the membership of users to groups. <br><br>  The second action is to specify the FireSIGHT User Agent (the <i>Add User Agent</i> button). <br><br>  Further, to integrate with AD, you need to install the small FireSIGHT User Agent software on any computer in the domain or directly on the Active Directory server.  The appearance of the main tab of the agent is shown in the figure below: <br><br><img src="https://habrastorage.org/files/36d/6e9/4af/36d6e94af87c43ddbc02e2c35029e718.png"><br><br>  Next, you need to perform two simple agent settings.  On the Active Director Servers tab, you need to add corporate AD servers: <br><br><img src="https://habrastorage.org/files/664/289/9af/6642899af3114df28df21601b5862739.png"><br><br>  <i>Authorized User / Password</i> - user account under which the agent will enter Active Directory to read Security logs.  The user account must have some rights and permissions, which are described in detail in the <a href="http://www.cisco.com/c/en/us/support/docs/security/firesight-management-center/118637-configure-firesight-00.html">Grant Minimum Permission to An Active Directory User Account</a> document. <br><br>  On the FirePOWER Management Centers tab, you must specify the IP address of the FireSIGHT system: <br><br><img src="https://habrastorage.org/files/e54/c5a/4c1/e54c5a4c1a1b4a3181ddb7bc28488720.png"><br><br>  If everything is configured correctly, on the <i>Analysis</i> tab <i>-&gt; Users -&gt; User Activity</i> we will be able to see the current user activity: <br><br><img src="https://habrastorage.org/files/c78/d16/c77/c78d16c7790a4303a3d58227cc50e654.png"><br><br>  <u>Nuances</u>  In my case, it was necessary to deploy the User Agent directly on the Active Directory server.  The AD administrator independently performed and verified the necessary AD settings and provided the user accounts.  However, when trying to add an AD server to the FireSIGHT User Agent, we always got the error ‚ÄúUnable to read security logs‚Äù: <br><br><img src="https://habrastorage.org/files/46c/302/8dd/46c3028ddf494c9e8f988e145bf7c631.png"><br><br>  The impression was that the user‚Äôs account did not have all the necessary rights.  However, when we tried to install the User Agent on a remote computer, the AD server was added to the User Agent without problems.  As a result, it turned out that I just did not carefully read the User Guide.  It turned out that if the agent is installed directly on the AD server, the ‚Äúlocalhost‚Äù keyword should be specified in the Server Name / IP Address field, and not the IP address or domain name of the server. <br><br>  In parallel with writing the article, my colleague implemented FirePOWER and also lost some time during the integration of the agent with AD.  In his case, the AD administrator also fulfilled the necessary requirements for the user account used in the agent.  However, the AD server refused to send the necessary data to the agent, despite the <s>poor</s> efforts of the agent's efforts ( <i>Polling Status - available</i> ‚Äî the agent sends requests to AD at the specified interval): <br><br><img src="https://habrastorage.org/files/ecd/667/1fd/ecd6671fd3e1411dbe2c3a15d14ea10b.png"><br><br>  <b>The highlighted column is only present in agent version 2.2</b> (displays information about when data from the AD server was last received).  In addition, when <i>Real-time</i> mode is on, <i>Real-time Status is</i> displayed as <i>unavailable</i> (and as it turned out later, this was not related to the problems described in <a href="http://www.cisco.com/c/en/us/support/docs/security/firesight-management-center/118674-technote-useragent-00.html">this document</a> , despite the corresponding messages in the agent log): <br><br><img src="https://habrastorage.org/files/bc3/6f3/ad8/bc36f3ad893141b0a40ed3112eca5310.png"><br><br>  The figure shows the agent version 2.3 and it is <i>Real-time Status</i> and the absence of the <i>Last Reported</i> column in this version of the agent, initially, they let us in the wrong place. <br><br>  But in the end, it turned out that, in addition to the <i>Default Domain Controllers Policy</i> , another group policy was used on the AD server, and the AD administrator added permissions to the user through the tools of this separately created group policy.  Microsoft specialists have suggested that the permissions on the <i>Manage auditing and security log</i> in the <i>Default Domain Controllers Policy</i> always take precedence over other group policies.  As soon as permission was added to the user directly in the <i>Default Domain Controllers Policy, the</i> problem was resolved.  Here I would like to note that in the Cisco documentation we have not found an exact indication anywhere to use the <i>Default Domain Controllers Policy</i> .  Although the document in the example in the screenshot shows that this particular group policy is used. <br><br>  <b>Step 10</b> - Set up the implemented system in accordance with best practice.  At this step, the following policies are supposed to be configured: <br><ul><li>  System Policy (NTP, DNS, Database, etc.); </li><li>  Health Policy (parameters and thresholds for various indicators of the "vital activity" of the system); </li><li>  Network Discovery (network discovery policies); </li><li>  Intrusion Policy (intrusion detection system policies); </li><li>  File Policy (file type detection policies, blocking download / upload files, policies for detecting malicious code in files). </li></ul><br>  I will not dwell on the settings of all these policies.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These policies are configured based on the company's security policy requirements and Cisco recommendations. At the same step, alerts, configuration backup policies and logs of network transactions, report templates and much more are configured. </font></font><br><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuances</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The time zone of Moscow in FireSIGHT is still incorrect (UTC + 4). To correctly display events, it is necessary to use a different time zone UTC + 3. I chose Bahrain (Asia -&gt; Bahrain). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step 11</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Configure user access policies.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The system offers very wide possibilities for creating access control policies. </font><font style="vertical-align: inherit;">These include access control to various types of applications (Web applications, Client Applications, Application Protocols, etc.), access control by categories and URL reputations, file policies, Security Intelligence (detection / blocking of Bot networks, Open Proxy, Spam- distributors, TOR, etc.), IPS. </font><font style="vertical-align: inherit;">Issues of system capabilities are already material for other articles and discussions.</font></font><br><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this article, I tried to talk about the main nuances of FirePOWER implementation on the Cisco ASA and briefly go through the implementation steps. </font><font style="vertical-align: inherit;">I hope this article will help in more detail about the product and some aspects of its work. </font><font style="vertical-align: inherit;">Well, in conclusion about the FirePOWER I would like to say: ‚ÄúMay the force be with you ... FIRE.‚Äù</font></font></div><p>Source: <a href="https://habr.com/ru/post/270795/">https://habr.com/ru/post/270795/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270787/index.html">Early detection of cyber threats in the enterprise</a></li>
<li><a href="../270789/index.html">Sublime Text as IDE for ARM using STM32 as an example</a></li>
<li><a href="../27079/index.html">Business development in startups</a></li>
<li><a href="../270791/index.html">DataTalks # 4: Predictive Analytics</a></li>
<li><a href="../270793/index.html">New formats of mobile advertising, disassembling iOS - Android, and a lot of analytics in the news of the week for mobile developers</a></li>
<li><a href="../270797/index.html">We write a simple virtual machine in Python</a></li>
<li><a href="../2708/index.html">Prove you're smart</a></li>
<li><a href="../27080/index.html">Podcasts and programming</a></li>
<li><a href="../270801/index.html">Was there anyone on the server?</a></li>
<li><a href="../270803/index.html">Lab penetration testing "Test lab v.8": welcome to hell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>