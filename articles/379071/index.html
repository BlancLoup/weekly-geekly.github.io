<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Determine whether the toilet is free, and display the status in the web</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Intro 
 There are about 30 people in our office, and we all have 1 toilet to visit which we need to go through the corridor, pull the handle and, i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Determine whether the toilet is free, and display the status in the web</h1><div class="post__text post__text-html js-mediator-article"><h5>  1. Intro </h5><br>  There are about 30 people in our office, and we all have 1 toilet to visit which we need to go through the corridor, pull the handle and, if the door does not open, put up with it and wait for it to be released. <br><br>  The switched on light is not an indicator of the freedom of the given object, since  next to him there is still a sink that can be occupied, but the toilet itself is not. <br><br>  1.1 If you do not want to read the entire text, you can immediately proceed to the demonstration <br><a name="habracut"></a><br><h5>  2. Purpose </h5><br>  While I work in this office (almost 4 years), this problem has matured quite strongly, and therefore an obvious and simple solution was needed in order to find out if the toilet is free or not. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  3. The simplest scheme </h5><br>  A simple diagram of the whole structure looks like this: <br>  The door is closed - the red light is on <br>  Open door - green light is on <br><br><h5>  4. Start adding items </h5><br>  Our company is engaged in the development and implementation of software, so everyone is at computers all day, which means that you need to display the status of free toilet on a web page.  The most reliable and simple to implement seemed to take the switch from the car, twisted pair and a server with two network cards. <br><br><h6>  4.1.  How to know that the door is closed or not </h6><br>  The simplest thing is to go and see. <br>  <a href="http://geektimes.ru/users/bryulchik/" class="user_link">Bryulchik</a> proposed to use the car's <a href="http://geektimes.ru/users/bryulchik/" class="user_link">trailer</a> (Trailer Russia PS-116 R (PS 2B, AU-30B)) to determine the door status. <br><br><img src="https://habrastorage.org/files/6d2/243/502/6d2243502f5842efb8926593ff683a87.jpg" alt="image"><br><br>  He has a sufficiently simple scheme - if the door is closed, then he opens the circuit, otherwise, the circuit is closed and the door is open, which means everything is free. <br><br><h6>  4.2.  We pull the twisted pair and connect </h6><br>  There is such a thing, called RJ-45 Loopback, it is needed for testing, and there is no need to use a second network card or tester to, for example, check if the cable is interrupted. <br><br><img src="https://habrastorage.org/files/77b/78b/354/77b78b354ac54d0890bed63cf6b57ba2.png" alt="image"><br><br>  We will use this knowledge for our project. <br>  Stretched a twisted pair to the entrance, the other end is compressed and inserted into the server. <br><br>  Link, of course, not yet. <br>  We take the 1st and 3rd veins and close, with the -2nd and 6th residential we do the same. <br><br>  A second later, a link appears on the port at the server, now we open 2 and 6, the link is gone, in general, this is what we need. <br><br><h6>  4.3.  Fasten </h6><br>  We take the switch and hang it on the doorframe at the door, we look so that our powerful guards do not pull it out, pushing the door close to the doorframe, but at the same time there was contact when the door was open. <br><br>  We leave the 1st and 3rd cores twisted, hide them under the door clerk, onto the 2nd core and fasten the moving part of the trailer, the 6th core on the end itself and carefully wrap everything with electrical tape. <br><br><h6>  4.4.  Need more tape </h6><br>  As practice has shown, there is no adequate explanation as to why this is happening, but the bottom line is that if you take hold of the open areas of copper with your fingers (at the end of the 2nd and 6th core), then a link will appear (!), And if you release the cores , the link will not disappear (!!!).  This we could not explain, but if you do not touch anything with your fat fingers, then everything will work as intended. <br><br><h6>  5. software </h6><br>  The most fascinating (for me) part is writing software. <br><br>  The whole complex is divided into 2 parts - a server that polls the sensor and the web page. <br>  Every 3 seconds, the mii-tool, on the server with a sensor and two network cards, looks at the interface and its status, and then resets this status with the -R option <br><br>  If the status has changed from the previous one, then it makes a simple HTTP GET request to the server with a web page. <br><br>  In turn, a script hangs on the server with a web page, which writes the changed status to a file, and the usual html page polls this file and displays a green or red light bulb on the screen. <br><br><h6>  6. Demonstration </h6><br>  Everything that we have done can be seen in the video: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/8GaFjzjI9xc%3Ffeature%3Doembed&amp;xid=17259,15700002,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgURh0r-LI8TrJsmeD1Ep2DNHOJ8A" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/379071/">https://habr.com/ru/post/379071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../378685/index.html">We get real 3D video from Raspberry Pi</a></li>
<li><a href="../378799/index.html">New hope: MtGox users promise to return money</a></li>
<li><a href="../378861/index.html">How many robots do you need to drag a whale?</a></li>
<li><a href="../378875/index.html">Chameleon weekdays in the office DataArt</a></li>
<li><a href="../379055/index.html">GTA fans shot a GTA-like video using a drone</a></li>
<li><a href="../379207/index.html">Overview of sitting-standing tables</a></li>
<li><a href="../379337/index.html">The most interesting events of astronautics and astronomy for the week (02.05-09.05)</a></li>
<li><a href="../379453/index.html">Dying carbon stars - source of material for our DNA?</a></li>
<li><a href="../379683/index.html">The best photos of the cosmos in a week (May 18-24)</a></li>
<li><a href="../379837/index.html">Xperia E4 Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>