<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What lives mobile islet</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. My name is Max Degterev (I don‚Äôt have an account here, so here‚Äôs my twitter: @suprMax and maxdegterev.name site). We recently launched a new co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What lives mobile islet</h1><div class="post__text post__text-html js-mediator-article">  Hello.  My name is Max Degterev (I don‚Äôt have an account here, so here‚Äôs my twitter: <a href="https://twitter.com/suprMax">@suprMax</a> and <a href="http://maxdegterev.name/">maxdegterev.name</a> site).  We recently launched a new cool version of a mobile site.  I'll tell you about him now. <a name="habracut"></a><br><br><img src="https://habrastorage.org/storage2/2f2/c81/0bc/2f2c810bc0ce9db08195848bca598339.jpg"><br><br><img src="https://habrastorage.org/storage2/d46/60c/0a0/d4660c0a0458a13b8bfd9db93d554602.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/ded/07e/f1f/ded07ef1f4d1071c537d5a899e76ab02.jpg"><br><br><br><h3>  Main basis </h3><br>  Working on a new mobile site, I already had the experience of developing the old.  At the time of writing these letters, it should still be available at <a href="http://ostrovok.ru/m" title="Good old Ostrovok.ru">http://ostrovok.ru/m</a> , but I don‚Äôt know how long it will work.  The old site worked very simply.  He lives in a common OTA project and, accordingly, uses the same Back-end (Django), standard media generator, simple HTML templates (server-side), some JavaScipt templates on underscore, SCSS, and regular JavaScipt.  This is all we have already passed a hundred times, it's all very boring. <br><br>  Before developing a new site, I had the following tasks: <br><ul><li>  Make a website in a new design, at the same time to see how this new design will work at all, and whether it is worth using it for a mobile application in the future. </li><li>  The site should work well on iPhone and Android 2.x, 4.x, default browsers. </li><li>  Add some new features that are not on the old.  For example, filter by hotel name and add hotels to favorites.  Of course, a large site should not be completely copied. </li><li>  Make it fun and interesting. </li></ul><br>  So historically, the site is always designed with the design of a mobile application, this design is tested on it.  Like this experiment.  And here the design was completely new, flat (iOS 7 style, fashionable!).  Therefore, do not be surprised that the colors, and indeed the appearance, are slightly different from the rest of the Islet. <br><br>  I did not want to depend on OTA, like last time.  Plus, I worked on the site alone, and learning Django is not at all interesting, but constantly distracting one of the OTA developers is not comme il faut.  So I decided to think like a pirate.  The island already has a mobile API that covers most of what is required from the mobile site.  By combining this with parts of the API from the desktop site, you can get quite a good solution.  This is the approach I have chosen. <br><br>  I took NodeJS as a basis.  Always wanted to try.  The framework was ExpressJS, which is very similar to Sinatra (hello Ruby!).  I needed to conduct user sessions, so I can't do without Redis.  For less typing, instead of using regular JavaScript, I used CoffeeScript.  For templates, I took Jade, and for CSS, Stylus.  We need a trendy website, and on mobile phones you can get a big gain in speed, so everyone decided to do a singlepage.  At first I thought to take SpineJS, but his community is not very big, so the classic bundle: Backbone, Lo-Dash, Zepto. <br><br><img src="https://habrastorage.org/storage2/43e/e4a/3c1/43ee4a3c102464c515f03f21f5f3a23f.jpg"><br><br><br>  I had to tinker with the assembly of assets.  I want everything to be cool, automatically, like the rails.  The asset-rack turned out to be a quite good solution, which completely takes over the tasks of building JS, CSS and even Jade templates.  Of course, he knows how to precompile the templates, puts them in the specified namespace (I chose app.templates).  He also takes on the headache of precompiling CoffeeScript and the system requirements, providing 2 options: Snockets (Sprockets) and the classic NodeJS version with RequireJS (Browserify).  Nevertheless, NodeJS is a new thing, so there were problems: <br><ul><li>  Statics are compiled at the time of server startup.  Something has changed in the file - please restart the server.  There are no problems in production, but during development it is not particularly convenient.  It is solved by installing nodemon.  Next, just write a simple instruction in Cakefile and start the server, for example, like this: `cake dev`.  And no problem. <br></li><li>  Static is compiled, but not put on the disk.  Asset-rack can upload files to the hosting (Amazon S3 etc.), but if you want to give them yourself, for example, through nginx, you have to be creative: <br><pre><code class="hljs coffeescript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compressAsset</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename, contents)</span></span></span><span class="hljs-function">-&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"[</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{(</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">new</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> Date()).toUTCString()}</span></span></span><span class="hljs-string">] </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{logPrefix}</span></span></span><span class="hljs-string"> Compressing asset </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{filename}</span></span></span><span class="hljs-string">.gz"</span></span>) zlib.gzip(contents, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e, buffer)</span></span></span><span class="hljs-function"> -&gt;</span></span> fs.writeFile(filename + <span class="hljs-string"><span class="hljs-string">'.gz'</span></span>, buffer)) generateAssets = <span class="hljs-function"><span class="hljs-function">-&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> asset <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> assets.assets filename = __dirname + <span class="hljs-string"><span class="hljs-string">'/public'</span></span> + asset.url.replace(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-string"><span class="hljs-string">"-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{asset.md5}</span></span></span><span class="hljs-string">."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> fs.existsSync(filename) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"[</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{(</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">new</span></span></span></span><span class="hljs-string"><span class="hljs-subst"> Date()).toUTCString()}</span></span></span><span class="hljs-string">] </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{logPrefix}</span></span></span><span class="hljs-string"> Saving asset </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{filename}</span></span></span><span class="hljs-string">"</span></span>) fs.writeFileSync(filename, asset.contents, encoding: <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>) compressAsset(filename, asset.contents) assets.<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'complete'</span></span>, <span class="hljs-function"><span class="hljs-function">-&gt;</span></span> generateAssets() <span class="hljs-keyword"><span class="hljs-keyword">unless</span></span> config.is_dev</code> </pre> </li></ul><br>  Subtotal: <br><br><ul><li>  Back-end and Front-end are written in the same language.  One codestyle, and you can also connect the same files.  For example, data validation and helpers templates.  Well, as an additional bonus, front-end vendors can read the backend code and understand what is happening. </li><li>  Speaking of patterns.  Jade can be used both on the client and on the server.  In my case, I connect one layout.jade to all pages.  But if I want, I can give absolutely any page, generating it on the back-end.  Skipping the correct data structure of course, but the convenience is obvious. </li><li>  Stylus is simply divine.  You can completely copy the Jade template to the Stylus file, delete everything unnecessary from there and write styles.  This is how the web should be designed. </li><li>  Simple clear JSON configs on the Back-end, Front-end, anywhere. </li></ul><br>  The task in order to be fashionable, youth and fun, I, thus, decided. <br><br><h3>  How it all worked </h3><br>  A little bit about how the project is organized.  A picture is worth a thousand words: <br><img src="https://habrastorage.org/storage2/68f/54d/95d/68f54d95dda742e006a310ba2b87b745.jpg"><br><img src="https://habrastorage.org/storage2/a7a/db4/698/a7adb469899dd6edb57b7c1add6980a8.jpg"><br>  I will not go into the details of the development on Backbone and CoffeeScript.  Thousands of articles have been written about this.  I will speak very briefly about the structure of the modules, and in general, as I did, so as not to go crazy. <br><br>  Obviously, Backbone has collections, models, and views.  I put them in different folders.  I also needed modules.  These are things that are needed all the time, regardless of which page I'm on.  They are loaded at the start of the application and are no longer unloaded when the view, for example, is destroyed immediately upon switching to another page.  Like some models / collections (for example, a list of bookings when you click "Exit").  My modules are modal windows, sidebars, information about the physical location of the phone, etc. <br><br>  As a result, this is how my main app.coffee file looks like: <br><pre> <code class="hljs haskell"> #= require ../../<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/app.config.js #= require ../helpers.js #= require app.utils.js #= require_tree modules #= require router.coffee #= require_tree models #= require_tree collections #= require_tree views app = _.extend(@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">app</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Backbone</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Events</span></span></span><span class="hljs-class">) # ... # </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Layout</span></span></span><span class="hljs-class"> modules app.size = new app.modules.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Size</span></span></span><span class="hljs-class">() # </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Data</span></span></span><span class="hljs-class"> modules app.geo = new app.modules.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Geo</span></span></span><span class="hljs-class">() app.user = new app.modules.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class">() app.analytics = new app.modules.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Analytics</span></span></span><span class="hljs-class">() # </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Modals</span></span></span><span class="hljs-class"> and extra views app.overlay = new app.modules.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Overlay</span></span></span><span class="hljs-class">() app.modal = new app.modules.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Modal</span></span></span><span class="hljs-class">() # </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Router</span></span></span><span class="hljs-class"> relies heavily on stuff above app.router = new app.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Router</span></span></span><span class="hljs-class">() # ... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Backbone</span></span></span><span class="hljs-class">.history.start(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pushState</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hashChange</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">false</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br>  Here is helpers.js, which is also used on the Back-end.  Connecting folders through require_tree makes it possible not to think about connecting individual files, but this does not guarantee the boot order, so you will need to make additional require if you need to inherit from some other class (for example, view).  I didn‚Äôt have such a task, but by the time Backbone.history.start is called, all the modules and components of the system are already in memory, so the router can do its job, call view, etc. <br><br>  Now a little about Stylus.  It is very similar to SASS, but has a number of additional features.  Obviously, it is identation based.  This makes it possible not to bother about the intersection of class names.  But we all saw this a long time ago, it is boring.  How about being able to use the value of any CSS rule as a variable? <br><br><pre> <code class="hljs vhdl"> .my-awesome-<span class="hljs-keyword"><span class="hljs-keyword">block</span></span> <span class="hljs-literal"><span class="hljs-literal">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>px height: <span class="hljs-number"><span class="hljs-number">100</span></span>px margin: (@<span class="hljs-literal"><span class="hljs-literal">width</span></span> / <span class="hljs-number"><span class="hljs-number">2</span></span>) auto <span class="hljs-literal"><span class="hljs-literal">line</span></span>-height: @height</code> </pre><br>  Not bad.  What about vendor prefixes support?  We live in a terrible world of competition.  Fortunately, it looks like this: <br><br><pre> <code class="hljs pgsql"> .my-awesome-block <span class="hljs-type"><span class="hljs-type">box</span></span>-sizing: border-<span class="hljs-type"><span class="hljs-type">box</span></span> transition: <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> <span class="hljs-number"><span class="hljs-number">.2</span></span>s ease</code> </pre><br>  Stylus itself looks at what mixin it has, and if it finds properties with the same name, it performs a replacement.  Accordingly, if you no longer need to fill in vendor prefixes, for example, for border-radius (which, by the way, is true), you can simply delete one mixin and not even open other files.  I'm not sure, but it seems to me that this can save about a hundred times in the future.  Well, a small example of how my app.styl looks like: <br><br><pre> <code class="hljs scala"> <span class="hljs-meta"><span class="hljs-meta">@import</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'confi</span></span>g' <span class="hljs-meta"><span class="hljs-meta">@import</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'includes</span></span>/reset.css' <span class="hljs-meta"><span class="hljs-meta">@import</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'includes</span></span>/fonts.css' <span class="hljs-meta"><span class="hljs-meta">@import</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'includes</span></span>/mixins' <span class="hljs-meta"><span class="hljs-meta">@import</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'plugins</span></span>/iswipe' <span class="hljs-meta"><span class="hljs-meta">@import</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'plugins</span></span>/zepto.sidebarify' <span class="hljs-meta"><span class="hljs-meta">@import</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'plugins</span></span>/zepto.calendar.css' <span class="hljs-meta"><span class="hljs-meta">@import</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'plugins</span></span>/zepto.input.numselect.css' <span class="hljs-meta"><span class="hljs-meta">@import</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'plugins</span></span>/zepto.listselect.css' <span class="hljs-meta"><span class="hljs-meta">@import</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'plugins</span></span>/zepto.textarea_autogrow' <span class="hljs-meta"><span class="hljs-meta">@import</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'partials</span></span>/partial_date' <span class="hljs-meta"><span class="hljs-meta">@import</span></span> <span class="hljs-symbol"><span class="hljs-symbol">'partials</span></span>/partial_spinner' <span class="hljs-comment"><span class="hljs-comment">// ...</span></span></code> </pre> <br>  It turns out that mixed imports are not a problem either.  The only flaw at the moment is that in order to call mixin, arguments are needed.  Without this, the call did not work for me, although it could already be fixed.  I have written this: <br><br><pre> <code class="hljs vhdl"> html, <span class="hljs-keyword"><span class="hljs-keyword">body</span></span> // lol! noselect plz <span class="hljs-keyword"><span class="hljs-keyword">body</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>, input, button, textarea color: #<span class="hljs-number"><span class="hljs-number">4</span></span>b5c66 font: normal <span class="hljs-number"><span class="hljs-number">14</span></span>px Helvetica, Arial, sans-serif <span class="hljs-literal"><span class="hljs-literal">line</span></span>-height: <span class="hljs-number"><span class="hljs-number">1.4</span></span>em //...</code> </pre> <br>  For styling, I always use only classes to defeat the evil <a href="">specificity of the Sith.</a> To give a 146% guarantee that the classes would never intersect, I used the SMACSS approach.  Well, or not at all, but very similar.  Everything that relates to the structure of the page, and does not change during transitions, I did with the prefix l (layout).  I also have p (page), blocks inside b (block) pages, etc.  If an element is nested in an element, its class will inherit in itself a part of the name of the parent.  Or it may not inherit, but the root class is always inherited.  Here is an example of styles: <br><br><pre> <code class="hljs ruby"> .p-awesomepage .pa-header /<span class="hljs-regexp"><span class="hljs-regexp">/ styles .pah-soopermenulink color: hotpink .pa-content /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ styles .pa-loading /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ styles .pa-title /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ styles</span></span></code> </pre> <br>  For this markup: <br><pre> <code class="hljs css"> <span class="hljs-selector-class"><span class="hljs-selector-class">.p-awesomepage</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">header</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pa-header</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">wow</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">header</span></span>! <span class="hljs-selector-class"><span class="hljs-selector-class">.pa-content</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.pa-title</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">my</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">awesome</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">title</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.pa-loading</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.pa-title</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loading</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">is</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">being</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loaded</span></span></code> </pre><br>  If you combine this approach with the nesting of rules in Stylus (the main thing is not to re-invest, otherwise there will be a sausage at the exit), then there should be no intersections. <br><br>  About Jade especially nothing to tell.  Quite a template engine.  Who used Slim - the same.  Supports include and partial.  Helpers I just threw a file through the common helpers.js.  Although you can register your own.  For example, there is already: markdown. <br><br><h3>  A little about Deploy </h3><br>  If about how to develop the development, everything is clear almost immediately, here's how to deploy deploys have to think a little.  9999999 solutions like capistrano were already invented by the railmen, but for the node so far I could not find anything workable. <br>  I decided on a test VPS to lay out just cake with the instruction: `cake deploy`, which literally does the following: <br><br><pre> <code class="hljs mel"> task <span class="hljs-string"><span class="hljs-string">'update'</span></span>, <span class="hljs-string"><span class="hljs-string">'[VPS]: Update current state with new from repo'</span></span>, -&gt; console.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>(<span class="hljs-string"><span class="hljs-string">'[Cake]: Pulling updates from repo'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span>(<span class="hljs-string"><span class="hljs-string">'git pull'</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">error</span></span>, stdout, stderr) -&gt; unless <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> console.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>(<span class="hljs-string"><span class="hljs-string">'[Cake]: Installing npm packages'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span>(<span class="hljs-string"><span class="hljs-string">'npm install'</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">error</span></span>, stdout, stderr) -&gt; unless <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> console.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>(<span class="hljs-string"><span class="hljs-string">'[Cake]: Restarting forever'</span></span>) # <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span>(<span class="hljs-string"><span class="hljs-string">'forever restartall'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span>(<span class="hljs-string"><span class="hljs-string">'killall forever'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span>(<span class="hljs-string"><span class="hljs-string">'killall nodejs'</span></span>) console.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>(<span class="hljs-string"><span class="hljs-string">'[Cake]: Cleaning up old assets'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span>(<span class="hljs-string"><span class="hljs-string">'find ./public/assets -regextype posix-egrep -regex ".*\.(js|css|gz|gzip)$" -delete'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span>(<span class="hljs-string"><span class="hljs-string">'cake forever'</span></span>) sendMail() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> console.warn(<span class="hljs-string"><span class="hljs-string">"[Cake]: Installation failed with error: #{error}"</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> console.warn(<span class="hljs-string"><span class="hljs-string">"[Cake]: Update failed with error: #{error}"</span></span>) ) task <span class="hljs-string"><span class="hljs-string">'deploy'</span></span>, <span class="hljs-string"><span class="hljs-string">'[DEV]: Deploy current repo state to dev VPS'</span></span>, -&gt; console.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>(<span class="hljs-string"><span class="hljs-string">'[Cake]: Connecting to VPS mobota@mobota-dev.ostrovok.ru &amp;&amp; running update'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">exec</span></span>(<span class="hljs-string"><span class="hljs-string">'ssh mobota@mobota-dev.ostrovok.ru \'cd /var/www/mobota &amp;&amp; cake update\''</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">error</span></span>, stdout, stderr) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> console.warn(<span class="hljs-string"><span class="hljs-string">"[Cake]: Deploy failed with error: #{error}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> console.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>(<span class="hljs-string"><span class="hljs-string">'[Cake]: Deployed!'</span></span>) )</code> </pre><br>  To roll out to production, Denis Orlikhin set up a debian package collector.  Works teampics, runs tests before building.  Very cool.  I will not tell the details, but maybe he will somehow tell. <br><br>  Speaking of tests.  I usually do not write tests, because haha-frontend and, in principle, very lazy.  But here integration tests were really needed, since you have to depend on a third-party API.  I wrote tests for mocha + chaiJS.  Very simple and convenient, and most importantly a good reporter: <br><img src="https://habrastorage.org/storage2/5eb/2ae/ac6/5eb2aeac6f8d25f10a9f910e5cac283b.png"><br>  (I sit in the park, so the Internet is not super fast and tests have fallen down) <br><br><h3>  This is all very interesting, but where is the mobile development? </h3><br>  And indeed, it would be time to talk about the most important thing.  What differences have I noticed when developing for mobile devices in comparison with full-featured browsers.  Given that we have to work under several platforms at once, and each platform has its own problems, it turns out not so easy.  I can say that the situation has not changed much since last year.  The main problem is Android phones of the 2nd version, and early 4-ki.  With iOS, everything is much simpler, although they have miracles. <br><br>  First, more about the problems.  Some quite obvious, but I repeat.  Some were new to me, which means they could be useful to someone else. <br><br><ul><li>  Brakes with clicks.  Everyone knows about the 300ms delay in clicks.  Any clicks on regular links on the site will be processed approximately 300ms after clicking.  This is to understand that this is really a click, and not some other gesture.  As a bonus, if you try to add a touchstart event listener to the link, we will see a so-called  ghost click in the same area after exactly 300ms, even if the content of the page has already changed.  And on Android 2 it even happens on a completely different page.  There are several solutions to the problem.  You can invent ingenious schemes for catching these ghost-click, as they do in Google.  And you can just refuse links and click event in principle.  In my case, I chose the second option.  In Zepto, there is a custom tap event just for this, only it is broken.  I wrote my solution, and probably post it on GitHub. <br></li><li>  Blurry pictures on the Retina.  Now more and more devices with pixel-ratio&gt; 1.5, which means that there are several physical ones per virtual pixel.  To prevent pictures from being smeared on such devices, it is enough to load images for them several times larger and scale.  Approach for the lazy - always upload large images and scale (background-size FTW). <br></li><li>  Hardware-accelerated animations with transition / transform.  It seems that everything is obvious here, use translate everywhere or even translate3d and you will be happy.  In fact, it goes wrong.  First, not all properties will be accelerated with the help of a GPU, there are only a few of them.  Position, transparency, etc.  Secondly, Android 2 has serious problems with translate3d in the form of periodic flickering of an animated block, the appearance of fir trees, and generally brakes.  Well, iOS has a problem if you need to re-render the block that is on the GPU layer.  For example, on my website there is a sidebar, and it can be dragged, as well as it animates / leaves on a click.  A cool thing, there is little where there is, and with the animation I have never seen anywhere.  But the problem is that if the content is transferred to the GPU, then when switching to some pages it starts to flicker, disappear from the screen for half a second, until the browser renders it and again throws it onto the GPU.  I had to go back to using left / top.  In addition, if you show native select elements on the block that was pulled out from somewhere using the translate, then they will not work fully on Android 2.  Keep in mind (the drop-down list is shown where the unit was originally, and not where it is on the screen). <br></li><li>  Fixed positioning.  I would not even try.  With overflow: scroll, the situation seems to be better, so solving the problem of fixed elements requires tricky layout.  When I watched the last time, redrawing with the open keyboard on iOS didn‚Äôt really work. <br></li><li>  Android 2 works just fine with JSON.parse (null).  Try to validate the string before parsing.  And he does not know how to fully draw text with text-shadow.  Shifts may not work, some letters fly away and anything happens at all.  I always do: <br><pre> <code class="hljs pgsql"> .android2 * <span class="hljs-type"><span class="hljs-type">text</span></span>-shadow: <span class="hljs-keyword"><span class="hljs-keyword">none</span></span> !important;</code> </pre> <br>  Saves a lot of time and nerves. <br></li><li>  There are some differences in how the window behaves.  Firstly, it is very easy to change the scale, which on large browsers almost never do.  I advise to lock the scale, it will become easier to live.  It works like this: <br><pre> <code class="hljs lisp"> meta(<span class="hljs-name"><span class="hljs-name">name=</span></span><span class="hljs-string"><span class="hljs-string">"viewport"</span></span>, content=<span class="hljs-string"><span class="hljs-string">"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"</span></span>)</code> </pre><br>  You also need to look at the preventZoom () method at the <a href="http://html5boilerplate.com/mobile/">mobile html5boilerplate</a> .  Helps a lot.  Anyway, from there a lot of cool things can be taken. <br><br>  There may be problems with determining the height / width of the screen.  Android / iOS are inconsistent in their responses.  Android, in particular, can generally say that it is 2 times wider and higher than it actually is.  I prefer to use CSS whenever possible, and I advise you. But if I really want to, I did it like this: <br><pre> <code class="hljs mel"> class Size _min_width: <span class="hljs-number"><span class="hljs-number">320</span></span> _min_height: <span class="hljs-number"><span class="hljs-number">416</span></span> _iOS_toolbar_height: <span class="hljs-number"><span class="hljs-number">44</span></span> _android_delay: <span class="hljs-number"><span class="hljs-number">300</span></span> constructor: -&gt; @width = null @height = null <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $.os.ios app.dom.win.on(<span class="hljs-string"><span class="hljs-string">'orientationchange load'</span></span>, @orientationChange) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> app.dom.win.on(<span class="hljs-string"><span class="hljs-string">'orientationchange resize load'</span></span>, =&gt; <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>.setTimeout(@orientationChange, @_android_delay) ) @orientationChange() orientationChange: =&gt; prevWidth = @width prevHeight = @height <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $.os.ios and not <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>.orientation @width = <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>.screen.availWidth @height = <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>.screen.availHeight - @_iOS_toolbar_height <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> @width = app.dom.win.width() @height = app.dom.win.height() @width = Math.<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(@_min_width, @width) @height = Math.<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(@_min_height, @height) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> @width isnt prevWidth or @height isnt prevHeight app.trigger(<span class="hljs-string"><span class="hljs-string">'size:resize'</span></span>, width: @width height: @height )</code> </pre> <br>  With the definition of the height of the content / window, expect a lot of adventures, mobile browsers in this plan are very cool and it is normal to do something full screen and overlay / modal will not be easy. <br></li><li>  Network requests are very slow, especially if nothing has been requested for a long time.  Parallel requests may also not be a very good idea, one of them can easily be spilled, and as it turned out, this is not at all faster.  I try to make few requests with great answers.  (large is 500kb-1mb maximum, still mobile communication).  It seems to work better.  DOM operations are the same story.  Everything is very slow, because the device is very stupid.  Especially Android, I do not understand what their problem is.  Even the new 4-ki lose the same iPhone 4S.  In general, the usual rules work here - fewer requests and grouping of read / write. <br></li><li>  Earlier versions of Android 4 do not support the History API.  This means that Backbone will have to use hashes instead of the normal state update.  The new versions should already support everything as it should, and Android 2 has always supported, so I just did not bother. <br></li><li>  If your page is scrolled down and you change the content - Android will not return the scroll position to its original position.  Depending on the height of the new content there may be visible problems. <br></li><li>  If you have a block with position: absolute, which flew somewhere off the screen, make sure that it is not very large in height.  Otherwise, ‚Äúholes‚Äù will appear on the page as if it still occupies some height.  Actual for iOS. <br></li><li>  If you want to do something on the full screen in iOS, then you need to set the height of one of the root elements, equal to the actual height of the screen.  Otherwise, the status bar will not disappear anywhere no matter how hard you try.  height: 100% doesn't work as well. <br></li><li>  If the parent block has overflow: scroll, and the children have position: absolute, there may be problems when drawing on Android.  It is solved only by disabling overflow: scroll. <br></li></ul><br>  In general, the approach to development is similar to working with large sites on very weak machines.  We must not forget that the battery and processor / memory resources are very limited, and always check the performance on real devices.  Of course, this is only my personal experience, based on the devices that were available for testing.  I could be wrong on some points. <br><br>  Development bonuses for mobile, as opposed to desktop browsers: <br><ul><li>  Although the device and brake, but still modern and a lot of that is supported.  This means animations through keyframes / transition and modern JavaScript etc. <br></li><li>  Only 3 platforms.  iOS works quite well by itself, and for debugging we have the Developer Tools in Safari, I advise you to use it.  Android is worse, few give browser log to the adb console, but all the same there are only 2 platforms and a similar browser engine.  You can forget about many vendor prefixes. <br></li><li>  It is always interesting to play with new toys.  And mobile sites can be wrapped up as native apps, or at least added to homescreen.  Cool. <br></li></ul><br><br><h3>  Conclusion </h3><br>  We live in a great time to be a developer.  An idea has come to my mind, and you will easily implement it.  The rest of the people live with ideas that for them are not to be realized.  So write the code and use NodeJS - quickly, conveniently, asynchronously, youth.  And more time will be left to come up with ideas, rather than typing letters. <br><br>  I think I will post something from the site on GitHub, it will be possible to see and use it at my place.  Good luck to everyone, potsy. </div><p>Source: <a href="https://habr.com/ru/post/183746/">https://habr.com/ru/post/183746/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../183732/index.html">Public discussion of the GOST project on the protection of digitized video data from accidental and deliberate distortion</a></li>
<li><a href="../183734/index.html">Utilities for Windows Azure for every day!</a></li>
<li><a href="../183736/index.html">Free webinar from the series "Fundamentals of modern server architecture"</a></li>
<li><a href="../183738/index.html">Repl - a tiny open player for Mac</a></li>
<li><a href="../183744/index.html">Layout: the transition to semantic markup is the main goal of HTML</a></li>
<li><a href="../183750/index.html">List of 3d printing services</a></li>
<li><a href="../183752/index.html">About modern web design and the ‚ÄúUp‚Äù button</a></li>
<li><a href="../183754/index.html">Some secrets of connecting the web interface 1C 8.2</a></li>
<li><a href="../183756/index.html">"Solar" screens as a solution to the problem of fast power consumption by smartphones</a></li>
<li><a href="../183760/index.html">Little British Spy - Bookmark on Raspberry Pi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>