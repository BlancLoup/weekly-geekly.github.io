<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Static Analysis of Wireshark with PVS-Studio</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will explain how to use PVS-Studio for static analysis of program code in C / C ++ using the example of the open-source Wireshark pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Static Analysis of Wireshark with PVS-Studio</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/9ef/e26/cfd/9efe26cfdf23cc97f9de43a72176737a.png"><br><br>  In this article I will explain how to use PVS-Studio for static analysis of program code in C / C ++ using the example of the open-source Wireshark project.  I will start with a brief description of the Wireshark network traffic analyzer and the PVS-Studio product.  I will describe the pitfalls of the assembly process and the preparation of the project for static analysis.  I will try to form an overall picture of the PVS-Studio product, its advantages and usability, giving analyzer warnings, code samples and own comments. <br><a name="habracut"></a><br><h2>  Network traffic analyzer Wireshark </h2><br>  To demonstrate the capabilities of PVS-Studio, it was required to find a well-known, useful and interesting open-source project, the analysis of which no one has done before.  I stopped at Wireshark, because  He himself is not indifferent to him, and if you still do not know about him, then perhaps after reading this article, share my feelings for him. <br><br>  The rapid development of the Internet and a large number of films about hacker programmers have long attracted my attention to computer networks.  And now, it seems to me that any qualified system administrator and security programmer is required to understand network technologies. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Networks are based on the reception and transmission of data over certain protocols.  In order to conduct research of network applications and protocols, as well as to find problems in the network, and, importantly, to find out the causes of these problems, you must use the tools for capturing and analyzing network traffic or sniffers. <br><br>  Wireshark is a well-known tool for capturing and analyzing network traffic with a graphical user interface.  The program is based on the library for capturing network traffic Pcap, and allows you to parse the packets of the vast majority of known network protocols, displaying the value of each protocol field at any level. <br><br>  Wireshark is a cross-platform tool distributed under the free GNU GPL license, designed to work on Windows and Linux.  The GTK + and Qt libraries are used to form the graphical interface. <br><br>  Documentation and source code of the program can be found on the <a href="http://www.viva64.com/go.php%3Furl%3D1618">site</a> . <br><br><h2>  PVS-Studio static code analyzer </h2><br>  Static code analysis allows you to find bugs in the software without running applications and regardless of the working environment.  Using static analysis, you can improve the quality of a software product, reduce development and testing time, and ensure security. <br><br>  PVS-Studio is a static code analyzer C / C ++ / C ++ 11 that supports the compilers MS Visual C ++, GNU GCC (MinGW), Clang, Borland C ++. <br><br>  PVS-Studio contains the following diagnostics: <ul><li>  general purpose diagnostics; </li><li>  diagnostics of 64-bit errors; </li><li>  diagnostics of possible optimizations. </li></ul>  Additional information about PVS-Studio can be found on the <a href="http://www.viva64.com/ru">website</a> . <br><br><h2>  Building the Wireshark project </h2><br>  For static analysis, download the source code of the latest stable version of Wireshark 1.12.4.  The build will be carried out in the Windows 7 operating system for the Win64 platform using the compiler included in Visual Studio 2013. Additionally, install the Qt SDK 5.4.1 and WinPcap 4.1.3 libraries. <br><br>  We will build from the command line using nmake.  For proper operation of the build scripts, install Cygwin and Python 2.7.9. <br><br>  Additional information about the assembly can be found on the <a href="http://www.viva64.com/go.php%3Furl%3D1620">website</a> . <br><br>  Despite the fact that the assembly was carried out in full accordance with the instructions, a number of errors occurred.  To eliminate them, it took: <ul><li>  Write the path to Cygwin in the PATH environment variable to make the bash command shell accessible from the console. </li><li>  Disable ACL access control for NTFS in Cygwin to give the owner rights to write, read, and run files. </li><li>  Install the optional dos2unix package in Cygwin.  Since  for compilation u2d utility was required. </li><li>  It was necessary to copy the Makefile.nmake file from ‚Äúasn1 \ hnbap‚Äù to ‚Äúasn1 \ kerberos‚Äù to get the ‚Äúclean‚Äù cleaning command for nmake to work. </li></ul><br><h2>  Conducting static analysis with PVS-Studio tools </h2><br>  I have installed PVS-Studio 5.25 with a license, but for an initial acquaintance with the program, you can download and install a <a href="http://www.viva64.com/ru/pvs-studio-download/">demo version</a> . <br><br>  In introductory mode, only warnings of the first level are available; you can make only 50 code transitions after installation and 50 transitions after sending information about yourself.  After 100 transitions you will need a license, the terms of which you can find on the site.  Of course, these 100 transitions are not enough to use, and they are given for the first acquaintance with the program.  If you want to get to know the analyzer more closely, you can <a href="http://www.viva64.com/ru/about-feedback/">write in support</a> and get a registration key for a few days. <br><br>  Since the Wireshark project is being built using nmake from the command line, we will need a monitoring system, which is included in the PVS-Studio package.  It keeps track of compiler launches and collects information about their environment: working directory, command line, full path to the compiled file, process environment variables. <br><br>  To monitor, launch ‚ÄúStart \ PVS-Studio \ PVS-Studio Standalone‚Äù, select the menu item ‚ÄúTools \ Analyze Your Files ...‚Äù and press the ‚ÄúStart Monitoring‚Äù button.  Next, from the command line, run the build of the project ‚Äúnmake -f Makefile.nmake all‚Äù, as described above.  Check that the build was successful and complete monitoring by clicking on the ‚ÄúStop monitoring‚Äù button. <br><br>  Reserve patience, tk.  then the static analysis will automatically start.  After it is completed, save the plog file of the report in order not to run the assembly and static analysis several times. <br><br>  Already at this stage in the PVS-Studio Standalone program, you can start searching for errors.  But in order to use the advanced features of IntelliSense code navigation, I recommend opening our report in Microsoft Visual Studio. <br><br>  To do this, perform a series of actions: <ol><li>  Create an empty Visual C ++ project in the Wireshark source folder. </li><li>  In Solution Explorer go to the file display mode. </li><li>  Add source to our project. </li><li>  Open the plog file of the report using the plugin: ‚ÄúPVS-Studio \ Open Analysis Report‚Äù. </li></ol>  Well, here we come to the most interesting - the search for errors. <br><br><h2>  Finding errors in the Wireshark project </h2><br>  Let's start searching for errors by looking at the PVS-Studio warnings and using IntelliSense navigation. <br><br>  From the very beginning I was attracted by the comments in the code: <br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decode_ex_CosNaming_NamingContext_NotFound</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)item; <span class="hljs-comment"><span class="hljs-comment">/* Avoid coverity param_set_but_unused parse warning */</span></span> .... <span class="hljs-comment"><span class="hljs-comment">/* coverity[returned_pointer] */</span></span> item = proto_tree_add_uint(....); .... }</code> </pre> <br>  Probably, the Wireshark project is already regularly checked by the static Coverity analyzer, which is used in projects requiring high reliability.  Such projects include: software for medical devices, for nuclear stations, aviation, and more recently for embedded systems.  So it‚Äôs curious to find bugs that Coverity missed. <br><br>  In order to form an overall picture of the capabilities of PVS-Studio, we will look for errors of various types that are difficult to detect due to indeterminate behavior during testing, requiring advanced knowledge of the C / C ++ language and just interesting.  To do this, we will be sufficient warnings of the first and a quick view of the warnings of the second level. <br><br>  Code: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AIRPDCAP_SEC_ASSOCIATION</span></span></span><span class="hljs-class"> {</span></span> .... AIRPDCAP_KEY_ITEM *key; .... }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AirPDcapWepMng</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....,AIRPDCAP_KEY_ITEM* key, AIRPDCAP_SEC_ASSOCIATION *sa, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(key, &amp;sa-&gt;key, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(AIRPDCAP_KEY_ITEM)); .... }</code> </pre> <br>  Warning: <a href="http://www.viva64.com/ru/d/0101/">V512</a> A call of the memcpy function will lead to the '&amp; sa-&gt; key' buffer becoming out of range.  airpdcap.c 1192 <br><br>  C / C ++ languages ‚Äã‚Äãprovide efficient low-level working with RAM due to the lack of built-in checks for array boundaries when reading and writing.  Errors filling, copying and comparing memory buffers can lead to undefined program behavior or segmentation errors that are hard to detect. <br><br>  To fill the 'AIRPDCAP_KEY_ITEM' structure located at the 'key' address, not the address 'sa-&gt; key' to the same structure is used, but the address of the pointer to it.  To correct this error, it is enough to remove the extra operation of obtaining the address '&amp;'. <br><br>  Code: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h323_calls_info</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">e_guid_t</span></span> *guid; .... } <span class="hljs-keyword"><span class="hljs-keyword">h323_calls_info_t</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">e_guid_t</span></span> guid_allzero = {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">q931_calls_packet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">h323_calls_info_t</span></span> *tmp2_h323info; .... <span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(&amp;tmp2_h323info-&gt;guid, &amp;guid_allzero, <span class="hljs-number"><span class="hljs-number">16</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>; .... }</code> </pre> <br>  Warning: <a href="http://www.viva64.com/ru/d/0101/">V512</a> A call of the "memcmp" function will lead you to tmp2_h323info-&gt; guid.  voip_calls.c 1570 <br><br>  Another example with incorrect use of the buffer.  In one of the arguments of the 'memcmp ()' function, a pointer is passed to a pointer to the 'e_guid_t' structure, instead of a pointer to it. <br><br>  Code: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ETHERCAT_MBOX_HEADER_LEN ((int) sizeof(ETHERCAT_MBOX_HEADER)) void dissect_ecat_datagram(....) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (len &gt;= sizeof(ETHERCAT_MBOX_HEADER_LEN) &amp;&amp; ....) { .... } }</span></span></code> </pre> <br>  Warning: <a href="http://www.viva64.com/ru/d/0163/">V568</a> It's an odd that it is the operator of the sizeof () operator is the '(int) sizeof (ETHERCAT_MBOX_HEADER)' expression.  packet-ethercat-datagram.c 519 <br><br>  When working with memory in C ++, the 'sizeof ()' operator is used, which returns the size of the object or buffer in bytes.  In our case, 'sizeof ()' will return the size of the 'int' type in bytes, instead of the size of the 'ETHERCAT_MBOX_HEADER' structure.  To correct the error, remove the extra operation 'sizeof ()'. <br><br>  Code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Proto_new</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!name[<span class="hljs-number"><span class="hljs-number">0</span></span>] || !desc[<span class="hljs-number"><span class="hljs-number">0</span></span>]) luaL_argerror(L,WSLUA_ARG_Proto_new_NAME, <span class="hljs-string"><span class="hljs-string">"must not be an empty string"</span></span>); .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( name ) { .... loname_a = g_ascii_strdown(name, <span class="hljs-number"><span class="hljs-number">-1</span></span>); .... } .... }</code> </pre> <br>  Warning: <a href="http://www.viva64.com/ru/d/0205/">V595</a> The 'name' of the pointer was used before it was verified against nullptr.  Check lines: 1499, 1502. wslua_proto.c 1499 <br><br>  Usually, in order to show that the pointer does not refer to an object, a special zero value is written into it, and additional checks are made before using the pointer.  Static analysis allows you to find the missing checks that can violate security, and redundant checks that are heavily cluttering the code. <br><br>  Checking the 'name' pointer is done after using 'name [0]'.  On the one hand, this check is redundant if the pointer is not zero, and on the other hand, if it is zero, an error will still occur. <br><br>  Code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_byte_graph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... u_data-&gt;assoc=(<span class="hljs-keyword"><span class="hljs-keyword">sctp_assoc_info_t</span></span>*)g_malloc( <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sctp_assoc_info_t</span></span>)); u_data-&gt;assoc=userdata-&gt;assoc; .... }</code> </pre> <br>  Warning: <a href="http://www.viva64.com/ru/d/0108/">V519</a> The 'u_data-&gt; assoc' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 1526, 1527. sctp_byte_graph_dlg.c 1527 <br><br>  In C / C ++ languages, allocating and freeing memory is done manually.  Failure to allocate allocated errors can lead to memory leaks. <br><br>  The 'g_malloc ()' function allocates a section of dynamic memory of the size 'sizeof (sctp_assoc_info_t)' bytes and returns a pointer to it.  But after changing the value of the variable storing this pointer, we will not be able to either access this section or release it, which will lead to a memory leak. <br><br>  Code: <br><pre> <code class="cpp hljs">PacketList::PacketList(QWidget *parent) { QMenu *submenu; .... submenu = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QMenu(tr(<span class="hljs-string"><span class="hljs-string">"Colorize with Filter"</span></span>)); <span class="hljs-comment"><span class="hljs-comment">/*ctx_menu_.addMenu(submenu);*/</span></span> submenu = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QMenu(tr(<span class="hljs-string"><span class="hljs-string">"Copy"</span></span>)); ctx_menu_.addMenu(submenu); .... }</code> </pre> <br>  Warning: <a href="http://www.viva64.com/ru/d/0108/">V519</a> The 'submenu' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 287, 363. packet_list.cpp 363 <br><br>  In the constructor, the visual interface elements are dynamically created and added to the Qt object hierarchy.  This allows recursive destruction of created objects when deleting a top-level object.  However, one of the menu items was never added to the object hierarchy, which would lead to a memory leak. <br><br>  Code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dissect_display_switch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(gint offset, guint msg_len, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((address_byte&amp;DISPLAY_WRITE_ADDRESS_LINE_FLAG) !=DISPLAY_WRITE_ADDRESS_LINE_FLAG) offset+=<span class="hljs-number"><span class="hljs-number">1</span></span>;msg_len-=<span class="hljs-number"><span class="hljs-number">1</span></span>; .... }</code> </pre> <br>  Warning: <a href="http://www.viva64.com/ru/d/0258/">V640</a> The code's operational logic does not correspond with its formatting.  The second statement will always be executed.  It is possible that curly brackets are missing.  packet-unistim.c 1134 <br><br>  Incorrect placement of curly brackets '{}' to select blocks of conditional 'if' statements can lead to errors. <br><br>  The body of the conditional operator 'if' will consist of one instruction, although the formatting and logic of the program require several.  To correct the error, you need to enclose a few instructions in curly brackets '{}'. <br><br>  Code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dissect_ssc_readposition</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (service_action) { .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LONG_FORM: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(flags &amp; MPU)) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-comment"><span class="hljs-comment">/*offset += 16;*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... } .... }</code> </pre> <br>  Warning: <a href="http://www.viva64.com/ru/d/0344/">V705</a> It is possible that 'else' block was forgotten or commented out, thus altering the program's operation logics.  packet-scsi-ssc.c 831 <br><br>  It's funny, but just one comment can lead to a change in the logic of the program.  Exit from the 'case LONG_FORM' block will be executed only when 'else' is triggered, which will inevitably lead to an error. <br><br>  Code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_has_console</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(gboolean set_has_console)</span></span></span><span class="hljs-function"> </span></span>{ has_console = has_console; }</code> </pre> <br>  Warning: <a href="http://www.viva64.com/ru/d/0168/">V570</a> The 'has_console' variable is assigned to itself.  console_win32.c 235 <br><br>  Also errors due to inattention.  The 'set_has_console ()' function is supposed to change the value of 'has_console' to 'set_has_console', but this does not happen.  To correct the error, you need to assign a value to the 'has_console' variable that is passed using the 'set_has_console' argument. <br><br>  Code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dissect_dcc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">tvbuff_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *tvb, packet_info *pinfo, proto_tree *tree, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *data _U_)</span></span></span><span class="hljs-function"> </span></span>{ client_is_le = ( (tvb_get_guint8(tvb, offset+<span class="hljs-number"><span class="hljs-number">4</span></span>) | tvb_get_guint8(tvb, offset+<span class="hljs-number"><span class="hljs-number">4</span></span>)) &amp;&amp;(tvb_get_guint8(tvb, offset+<span class="hljs-number"><span class="hljs-number">8</span></span>) | tvb_get_guint8(tvb, offset+<span class="hljs-number"><span class="hljs-number">9</span></span>)) &amp;&amp; (tvb_get_guint8(tvb, offset+<span class="hljs-number"><span class="hljs-number">12</span></span>) | tvb_get_guint8(tvb, offset+<span class="hljs-number"><span class="hljs-number">13</span></span>)) ); }</code> </pre> <br>  Warning: <a href="http://www.viva64.com/ru/d/0090/">V501</a> There are identical sub-expressions 'tvb_get_guint8 (tvb, offset + 4)' to the left  operator.  packet-dcc.c 272 <br><br>  The expression tvb_get_guint8 (tvb, offset + 4) is repeated.  By analogy, we can assume that we planned to write tvb_get_guint8 (tvb, offset + 5). <br><br>  There were other mistakes that I did not write about so as not to clutter up the article.  The given examples should be enough to show the possibilities of static analysis and to draw people's attention to PVS-Studio.  If you need to get a complete picture of the capabilities of PVS-Studio, you can find a <a href="http://www.viva64.com/ru/d/">list of all possible warnings</a> on the site.  A more thorough analysis of Wireshark can be carried out by the developers themselves.  It will be much easier for them to understand whether something is a mistake or not. <br><br><h2>  Conclusion </h2><br>  There were not many suspicious code sections.  This is probably due to the use of the Coverity static analyzer, comments on which we have seen.  Therefore, I recommend everyone to regularly use static analyzers in their projects in order to detect errors even before testing at the stage of writing code. <br><br>  I wish you all success in programming and fewer errors. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0328/"><img src="https://habrastorage.org/getpro/habr/post_images/35e/064/ddf/35e064ddf91f5d99b620384893909ff7.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Kalashnikov.  <a href="http://www.viva64.com/en/b/0328/">Static Analysis of Wireshark by PVS-Studio</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio and CppCat, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/259553/">https://habr.com/ru/post/259553/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259541/index.html">How we created a universal business management system</a></li>
<li><a href="../259545/index.html">9 usability testing tools</a></li>
<li><a href="../259547/index.html">Primer Programming Tutorial</a></li>
<li><a href="../259549/index.html">How to identify duplicate pictures using PHP</a></li>
<li><a href="../259551/index.html">Dell comes to the rescue of video production studio.</a></li>
<li><a href="../259555/index.html">Attackers use Linux / Moose to compromise Linux-embedded systems, part 3</a></li>
<li><a href="../259559/index.html">Investigating a single hack or how to quickly and easily spend a billion</a></li>
<li><a href="../259561/index.html">A selection of courses on the development of games from Microsoft</a></li>
<li><a href="../259563/index.html">Localization RC (C ++, MFC, Win32)</a></li>
<li><a href="../259565/index.html">Talking with first customers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>