<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A simple algorithm for determining the intersection of two segments</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In the old days, I was fond of computer graphics, both 2x and 3-dimensional, including mathematical visualizations. What is called just...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A simple algorithm for determining the intersection of two segments</h1><div class="post__text post__text-html js-mediator-article"><h5>  Introduction </h5><br>  In the old days, I was fond of computer graphics, both 2x and 3-dimensional, including mathematical visualizations.  What is called just for fun, as a student, wrote a program visualizing N-dimensional figures, rotating in any dimensions, although I was only enough to identify points for a 4-D hypercube.  But this is only a saying.  The love of geometry has remained with me since then to this day, and I still love to solve interesting problems in interesting ways. <br>  One of these tasks came to me in 2010.  The task itself is rather trivial: it is necessary to find out if two 2-D segments intersect, and if they intersect, find their intersection point.  More interesting is the decision, which, I think, turned out to be quite elegant, and which I want to offer to the reader.  I do not pretend to the originality of the algorithm (although I would like to), but I could not find such solutions online. <br><a name="habracut"></a><br><h5>  Task </h5><br>  Two segments are given, each of which is given by two points: (v11, v12), (v21, v22).  It is necessary to determine whether they intersect, and if they intersect, find their intersection point. <br><br><h5>  Decision </h5><br>  First you need to determine whether the segments intersect.  The necessary and sufficient intersection condition that must be met for both segments is as follows: the end points of one of the segments must lie in different half-planes if the plane is divided by the line on which lies the second of the segments.  Let's demonstrate this by drawing. <br><img src="https://habrastorage.org/getpro/habr/post_images/ec9/649/df2/ec9649df296cb179eedc5ff9262faf3d.jpg" alt="image"><br>  In the left figure (1) two segments are shown, for both of which the condition is met, and the segments intersect.  In the right (2) figure, the condition is met for segment b, but for segment a, it is not met, and the segments do not intersect, respectively. <br>  It may seem that to determine which side of the line the point lies from is a non-trivial task, but fear has large eyes and everything is not so difficult.  We know that the vector multiplication of two vectors gives us a third vector, the direction of which depends on whether the positive or negative angle between the first and second vectors, respectively, such an operation is anti-commutative.  And since all the vectors on the XY plane, their vector product (which must be perpendicular to the vectors to be multiplied) will have only non-zero component Z, respectively, and the difference between the products of vectors will be only in this component.  Moreover, when changing the order of multiplication of vectors (read: the angle between the multiplied vectors), it will consist solely in changing the sign of this component. <br>  Therefore, we can multiply the pairwise vectorial vector of the dividing segment by vectors directed from the beginning of the dividing segment to both points of the segment under test. <br><img src="https://habrastorage.org/getpro/habr/post_images/9a8/3ae/494/9a83ae494b51f73c225d236dabd28d87.jpg" alt="image"><br>  If the Z components of both products have a different sign, then one of the angles is less than 0 but greater than -180, and the second is greater than 0 and less than 180, respectively, the points lie on opposite sides of the line.  If the components Z of both products have the same sign, then they also lie on one side of the line. <br>  If one of the components of Z is zero, then we have a boundary case where the point lies exactly on the line being checked.  Let the user decide whether he wants to consider this an intersection. <br>  Then we need to repeat the operation for another segment and a straight line, and make sure that the location of its end points also satisfies the condition. <br>  So, if everything is good and both segments satisfy the condition, then the intersection exists.  Let's find it, and the vector product will also help us in this. <br>  Since in the vector product we only have a nonzero component Z, its module (the length of the vector) will be numerically equal to this component.  Let's see how to find the intersection point. <br><img src="https://habrastorage.org/getpro/habr/post_images/359/897/3d5/3598973d5cea218e766f09e62d2e4c61.jpg" alt="image"><br>  The length of the vector product of vectors a and b (as we found out, numerically equal to its component Z) is equal to the product of the moduli of these vectors and the sine of the angle between them (| a | | b | sin (ab)).  Accordingly, for the configuration in the figure we have the following: | AB x AC |  = | AB || AC | sin (Œ±), and | AB AB AD |  = | AB || AD |  sin (Œ≤).  | AC | sin (Œ±) is the perpendicular dropped from point C to segment AB, and | AD | sin (Œ≤) is perpendicular dropped from point D to segment AB (leg ADD ').  Since the angles Œ≥ and Œ¥ are vertical angles, they are equal, which means that the triangles PCC 'and PDD' are similar, and, accordingly, the lengths of all their sides are equally proportional. <br>  Having Z1 (AB x AC, which means | AB || AC | sin (Œ±)) and Z2 (AB x AD, which means | AB || AD | sin (Œ≤)), we can calculate CC '/ DD' ( which will be equal to Z1 / Z2), and also knowing that CC '/ DD' = CP / DP, you can easily calculate the location of point P. Personally, I do it as follows: <br><br>  Px = Cx + (Dx-Cx) * | Z1 | / | Z2-Z1 |; <br>  Py = Cy + (Dy-Cy) * | Z1 | / | Z2-Z1 |; 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      That's all.  It seems to me that it is really very simple and elegant.  In conclusion, I want to give the function code that implements this algorithm.  The function uses a homemade template vector &lt;typename, int&gt;, which is a vector template of dimension int with components like typename.  Those interested can easily adjust the function to their vector types. <br><br><pre><code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt;  <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">are_crossing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;T, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;v11, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;T, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;v12, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;T, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;v21, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;T, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;v22, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;T, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; *crossing)</span></span></span><span class="hljs-function">  3 </span></span>{  <span class="hljs-number"><span class="hljs-number">4</span></span>   <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;T, 3&gt; cut1(v12-v11), cut2(v22-v21);  <span class="hljs-number"><span class="hljs-number">5</span></span>   <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;T, 3&gt; prod1, prod2;  <span class="hljs-number"><span class="hljs-number">6</span></span>  <span class="hljs-number"><span class="hljs-number">7</span></span>   prod1 = cross(cut1 * (v21-v11));  <span class="hljs-number"><span class="hljs-number">8</span></span>   prod2 = cross(cut1 * (v22-v11));  <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(sign(prod1[Z]) == sign(prod2[Z]) || (prod1[Z] == <span class="hljs-number"><span class="hljs-number">0</span></span>) || (prod2[Z] == <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-comment"><span class="hljs-comment">//      11     return false; 12 13   prod1 = cross(cut2 * (v11-v21)); 14   prod2 = cross(cut2 * (v12-v21)); 15 16   if(sign(prod1[Z]) == sign(prod2[Z]) || (prod1[Z] == 0) || (prod2[Z] == 0)) //      17     return false; 18 19   if(crossing) { // ,      20     (*crossing)[X] = v11[X] + cut1[X]*fabs(prod1[Z])/fabs(prod2[Z]-prod1[Z]); 21     (*crossing)[Y] = v11[Y] + cut1[Y]*fabs(prod1[Z])/fabs(prod2[Z]-prod1[Z]); 22   } 23 24   return true; 25 }</span></span></code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/267037/">https://habr.com/ru/post/267037/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267025/index.html">git punish - whose team I always lacked</a></li>
<li><a href="../267027/index.html">FZ-188: who will soon categorically not be able to buy foreign software, if there is a Russian equivalent</a></li>
<li><a href="../267029/index.html">We make a network printer from HP LJ1000</a></li>
<li><a href="../267033/index.html">Simple Optimization Technique Using Intel System Studio</a></li>
<li><a href="../267035/index.html">The time series forecasting model for the maximum similarity sample: an explanation and an example</a></li>
<li><a href="../267039/index.html">Private Cloud Appliance - the best virtualization and private cloud for data centers</a></li>
<li><a href="../267041/index.html">Dissect t-SNE</a></li>
<li><a href="../267045/index.html">System backup of virtual machines or how to save money organization</a></li>
<li><a href="../267047/index.html">Bot for sapper with a twist</a></li>
<li><a href="../267049/index.html">Ice started off: KC published a draft document on paperless transfer of .RU domains between registrars</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>