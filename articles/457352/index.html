<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Information output on the customer‚Äôs display</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Appeared customer display. It became interesting to try to use it as an information board for displaying information about the current day, time until...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Information output on the customer‚Äôs display</h1><div class="post__text post__text-html js-mediator-article"><p>  Appeared customer display.  It became interesting to try to use it as an information board for displaying information about the current day, time until the end of the working day / week, weather information, and exchange rates. </p><br><p>  At the same time, I did not want to use resource-intensive applications and my PC.  I stopped at a bunch of mini-PC Raspberry + Linux + Customer Display. </p><br><p><img src="https://habrastorage.org/webt/3n/qb/mt/3nqbmt8mqlfr1-dx4qt2ryruaga.jpeg" alt="@ Customer display with information | center | 700x0"></p><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/hh/hf/za/hhhfza4bszzcgeya6vwwxljx1vy.jpeg" alt="@Raspberry Pi 2 | center | 300x0"></p><br><h2 id="neobhodimye-zamechaniya">  Necessary comments </h2><br><blockquote>  I don‚Äôt consider installing and configuring Linux on a Raspberry device in this article. <br><br>  To edit text in the Linux environment, I used nano and mcedit editors. <br>  To access a mini-PC based on Linux OS from a Windows environment, I used clients for remote access via the SSH protocol - KiTTY / PuTTY. <br>  To transfer files between Windows and Linux, I used WinSCP. <br><br>  Bash - command interpreter (command shell). <br>  Bash is an abbreviation of "Bourne-Again Shell" ("revived" shell).  Keywords, syntax, and other basic features of the language were borrowed from another sh command interpreter (short for shell). <br>  Bash is also a powerful programming language. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I am engaged in maintenance of software products based on 1C and for me it was an opportunity to get acquainted with programming in the Linux environment. <br>  To the best of my understanding, I will explain the commands being executed.  This is done for the purpose of a large audience. </blockquote><br><h2 id="chto-ispolzoval">  What did you use? </h2><br><ul><li>  Single board computer Raspberry Pi 2 Model B v1.1 with installed OS Raspbian GNU / Linux 9.4 (stretch). </li><li>  Customer Display POSUA LPOS-VFD USB. </li><li>  Bash shell </li></ul><br><h2 id="1-etap-podklyuchenie-i-nastroyka-displeya-pokupatelya">  Stage 1.  Connecting and setting up customer display </h2><br><p>  After you have attached a customer display (PD) to the USB port, find out the parameters of the connected device.  In the terminal, execute the command: </p><br><pre><code class="bash hljs">usb-devices</code> </pre> <br><p>  Get the list of attached USB devices to the Raspberry: </p><br><pre> <code class="bash hljs">T: Bus=01 Lev=00 Prnt=00 Port=00 Cnt=00 Dev<span class="hljs-comment"><span class="hljs-comment">#= 1 Spd=480 MxCh= 1 D: Ver= 2.00 Cls=09(hub ) Sub=00 Prot=01 MxPS=64 #Cfgs= 1 P: Vendor=1d6b ProdID=0002 Rev=04.14 S: Manufacturer=Linux 4.14.69-v7+ dwc_otg_hcd S: Product=DWC OTG Controller S: SerialNumber=3f980000.usb C: #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=0mA I: If#= 0 Alt= 0 #EPs= 1 Cls=09(hub ) Sub=00 Prot=00 Driver=hub T: Bus=01 Lev=01 Prnt=01 Port=00 Cnt=01 Dev#= 2 Spd=480 MxCh= 5 D: Ver= 2.00 Cls=09(hub ) Sub=00 Prot=02 MxPS=64 #Cfgs= 1 P: Vendor=0424 ProdID=9514 Rev=02.00 C: #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=2mA I: If#= 0 Alt= 1 #EPs= 1 Cls=09(hub ) Sub=00 Prot=02 Driver=hub T: Bus=01 Lev=02 Prnt=02 Port=00 Cnt=01 Dev#= 3 Spd=480 MxCh= 0 D: Ver= 2.00 Cls=ff(vend.) Sub=00 Prot=01 MxPS=64 #Cfgs= 1 P: Vendor=0424 ProdID=ec00 Rev=02.00 C: #Ifs= 1 Cfg#= 1 Atr=e0 MxPwr=2mA I: If#= 0 Alt= 0 #EPs= 3 Cls=ff(vend.) Sub=00 Prot=ff Driver=smsc95xx T: Bus=01 Lev=02 Prnt=02 Port=01 Cnt=02 Dev#= 4 Spd=12 MxCh= 0 D: Ver= 2.00 Cls=00(&gt;ifc ) Sub=00 Prot=00 MxPS= 8 #Cfgs= 1 P: Vendor=0000 ProdID=0131 Rev=01.00 S: Manufacturer=www.posua.com S: Product=POSua LPOS-II-VFD USB CDC C: #Ifs= 2 Cfg#= 1 Atr=a0 MxPwr=16mA I: If#= 0 Alt= 0 #EPs= 3 Cls=02(commc) Sub=02 Prot=01 Driver=usbserial_generic I: If#= 1 Alt= 0 #EPs= 2 Cls=03(HID ) Sub=00 Prot=00 Driver=usbhid</span></span></code> </pre> <br><p>  From the information received by the command, we find the line <strong>Product = POSua LPOS-II-VFD USB CDC</strong> .  This is our customer display.  In this section, we need the string Vendor = 0000 ProdID = 0131 Rev = 01.00.  And specifically <strong>vendor = 0000 prodID = 0131</strong> .  This is how the device identifies itself. </p><br><p>  For correct work with DP, it is necessary to load the work module from USB into the system core.  We execute the command with elevated rights: </p><br><pre> <code class="bash hljs">sudo modprobe usbserial vendor=0x0000 product=0x0131</code> </pre> <br><p>  <code>modprobe</code> is a program for adding modules to the Linux kernel.  <code>usbserial</code> is a kernel module that emulates a COM port on USB devices.  0x is a hexadecimal format. </p><br><p>  Since I have one USB device connected, the Linux system automatically receives the <em>ttyUSB0</em> file.  This is an important feature of interaction with devices in Linux OS - working with the device as a file.  Device files are stored in the <code>/dev</code> . </p><br><p>  To work correctly with DP, set the data transfer rate: </p><br><pre> <code class="bash hljs">stty -F /dev/ttyUSB0 9600</code> </pre> <br><p>  <code>stty</code> - the command sets the terminal input / output parameters for the device.  <code>-F</code> - device.  In our case, the customer display is <code>/dev/ttyUSB0</code> .  And for this device is set to 9600 baud. </p><br><p>  Now you can try to display a welcome message (while in English): </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Hello!"</span></span> &gt; /dev/ttyUSB0</code> </pre> <br><p>  If everything is done correctly, then our message will appear on the screen.  Read more about the team below. </p><br><h2 id="2-etap-programmirovanie">  Stage 2  Programming </h2><br><p>  In the previous step, we displayed a message in English on top of the device‚Äôs splash message.  And it is not very beautiful. </p><br><p>  To clear the display screen, execute the command: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -e -n <span class="hljs-string"><span class="hljs-string">"\x0c\x0b"</span></span> &gt; /dev/ttyUSB0</code> </pre> <br><p>  <code>echo</code> - command output to the terminal.  The option <code>-e</code> - includes support for outputting escape sequences, <code>-n</code> - indicates that it is not necessary to print a line break.  A <code>-en</code> entry is allowed. </p><br><blockquote>  A combination of characters consisting of a backslash <code>\</code> followed by a letter or a set of numbers is called escape sequences. </blockquote><p>  <code>0</code> - clears the display screen and cancels line mode, <code>0b</code> - moves the cursor to the upper leftmost position.  Symbol <code>&gt;</code> - flow control (redirects output).  In this case, in the <em>/ dev / ttyUSB0</em> file of our device.  If you just run the <code>echo "Hello!"</code> command <code>echo "Hello!"</code>  then the text in quotes will appear in the terminal window. </p><br><p>  By the way, the command changing the speed for transferring data to the device could be written like this: </p><br><pre> <code class="bash hljs">stty 9600 &lt; /dev/ttyUSB0</code> </pre> <br><p>  Well, to display messages in Russian, let's execute: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -n <span class="hljs-string"><span class="hljs-string">"!"</span></span> | iconv -f UTF-8 -t CP866 &gt; /dev/ttyUSB0</code> </pre> <br><p> <code>|</code>  - redirects the output of one command to the input of another (pipeline).  In our case, the sequence of characters "Hello!"  It is not displayed in the device file immediately, but is transferred to the "convert" utility iconv.  <code>iconv</code> - converts from one encoding to another. <br>  The bash command interpreter allows you not only to execute commands directly in the terminal, but also to write script files. </p><br><blockquote>  A script is a plain text file with a sequence of commands executed. </blockquote><p>  In order for bash to understand that this "it" at the beginning of the file is indicated <strong>#! / Bin / bash</strong> .  To execute the script directly, execute the command: </p><br><pre> <code class="bash hljs">sudo chmod u+x namefile.sh</code> </pre> <br><p>  Where namefile.sh is a script file.  The sh extension means that it is a bash script file.  <code>chmod</code> is a program for changing permissions of files and directories.  <code>u+x</code> - sets the right to execute the file for the current user. </p><br><p>  The solution of the problem will be executed by two scripts.  The first script is the main ( <em>dispos.sh</em> ).  It displays all the necessary information on the display of the buyer.  The second - auxiliary ( <em>parse.sh</em> ) receives weather data, currency quotation services and writes data to intermediate files.  Intermediate data files are used in the first script. </p><br><p>  In order for scripts to run, you need to run the following commands: </p><br><pre> <code class="bash hljs">sudo chmod +x dispos.sh sudo chmod +x parse.sh</code> </pre> <br><p>  Note that it uses just <code>+x</code> .  This is the shortened version of <code>u+x</code> . </p><br><p>  Scripts must be run at regular intervals.  To do this, we use the standard crontab scheduler.  To edit the command: </p><br><pre> <code class="bash hljs">crontab -e</code> </pre> <br><p>  Add two lines to the scheduler: </p><br><pre> <code class="bash hljs">*/20 * * * * /home/pi/parse.sh */1 * * * * /home/pi/dispos.sh</code> </pre> <br><p>  The <em>parse.sh</em> script runs every 20 minutes, and the <em>dispos.sh</em> script <em>runs</em> every minute. </p><br><p>  Before the initial output to the customer‚Äôs display, one must first execute the <em>parse.sh</em> script which will receive the primary weather and currency data. </p><br><pre> <code class="bash hljs">./parse.sh</code> </pre> <br><p>  Further I will give the full texts of scripts with short comments. </p><br><h2 id="opisanie-faylov-skriptov">  Script Files Description </h2><br><h3 id="fayl-dispossh">  Dispos.sh file </h3><br><div class="spoiler">  <b class="spoiler_title">dispos.sh file</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #        POSua LPOS-VFD. # -  ttyUSB0. #     tty  : # modprobe usbserial vendor=0x0000 product=0x0131. #  0x0000  0x0131  ,   # usb-devices, lsusb  dmesg. #    stty 9600 &lt; /dev/ttyUSB0. #          parse.sh #     crontab      . # **************************************************************** #   # ttyUSB -      (POS-) DEV_DISPLAY="/dev/ttyUSB0" #        #   ,  ,   18:00:00 #    17:00:00 TIME_OF_WORKDAY="18:00:00" if (( $(date "+%u") &gt;= 5 )); then TIME_OF_WORKDAY="17:00:00" fi #      ( 17:00:00) #      DAY_OF_WEEKEND=`date +"%s" --date="friday 17:00:00"` # **************************************************************** #       #    disp_clear(){ echo -en "\x0c\x0b" &gt; "${DEV_DISPLAY}" } #       disp_cr(){ echo -e "\x0b" &gt; "${DEV_DISPLAY}" } #       disp_print(){ echo -n $1 | iconv -f UTF-8 -t CP866 &gt; "${DEV_DISPLAY}" } # **************************************************************** #    # 1.    disp_clear #   disp_print ": `date "+%A"`" disp_cr #     disp_print " `date "+%d.%m.%Y %H:%M"`" sleep 8 # **************************************************************** # 2.       disp_clear disp_print "   . :" disp_cr HOURS=$(( ( $(date +%s --date=$TIME_OF_WORKDAY) - $(date +%s) ) / 3600 )) MINUTES=$(( (( $(date +%s --date=$TIME_OF_WORKDAY) - $(date +%s) ) - $HOURS * 3600) / 60 )) #       if (( $MINUTES &gt; -1 )); then OUTPUT_TIME=" ${HOURS} . ${MINUTES} ." else OUTPUT_TIME=" !" fi #       disp_print "${OUTPUT_TIME}" sleep 8 # **************************************************************** # 3.       disp_clear disp_print "  . :" disp_cr DAYS=$(( ($DAY_OF_WEEKEND-$(date +%s)) / (24*3600) )) HOURS=$(( (($DAY_OF_WEEKEND-$(date +%s)) - ($DAYS*24*3600)) / 3600 )) MINUTES=$(( (($DAY_OF_WEEKEND-$(date +%s)) - ($DAYS*24*3600) - ($HOURS*60*60)) / 60 )) #       if (( $MINUTES &gt; -1 )); then OUTPUT_TIME="${DAYS} . ${HOURS} . ${MINUTES} " else OUTPUT_TIME=" !" fi #       disp_print "${OUTPUT_TIME}" sleep 8 # **************************************************************** # 4.     # 4.1.      LINE1=$(sed -n '1{p;q}' /tmp/weather.txt) DISPLAY_LINE1=${LINE1:0:19} DISPLAY_LINE2=${LINE1:19:19} #     (2 ) disp_clear disp_print "${DISPLAY_LINE1}" disp_cr disp_print "${DISPLAY_LINE2}" sleep 4 # 4.2.    LINE1=$(sed -n '2{p;q}' /tmp/weather.txt) DISPLAY_LINE1=${LINE1:0:14} DISPLAY_LINE2=${LINE1:14:19} #     (2 ) disp_clear disp_print " ${DISPLAY_LINE1}" disp_cr disp_print "${DISPLAY_LINE2}" sleep 8 # **************************************************************** # 5.      #      #  DOLLAR=$(sed -n '1{p;q}' /tmp/ex.txt) DOLLAR=${DOLLAR//‚Äì/-} #  EURO=$(sed -n '2{p;q}' /tmp/ex.txt) EURO=${EURO//‚Äì/-} #     disp_clear disp_print ": ${DOLLAR}" disp_cr disp_print ": ${EURO}" sleep 8 # **************************************************************** # 6.      #      # BTC while read line do BTC=${line:0:13} done &lt;/tmp/bitcoin.txt # ETH while read line do ETH=${line:0:13} done &lt;/tmp/ethereum.txt #     #      disp_clear disp_print "BTC: ${BTC//./,}" disp_cr disp_print "ETH: ${ETH//./,}" #sleep 8 # **************************************************************** # 7.      #      (.  20 ) #DISPLAY_LINE1="  !" #DISPLAY_LINE2="  !" #      #disp_clear #disp_print "${DISPLAY_LINE1:0:19}" #disp_cr #disp_print "${DISPLAY_LINE2:0:19}"</span></span></code> </pre> </div></div><br><p>  <strong>Comments</strong> </p><br><p>  To display the current date, use the <code>date</code> command.  Example, </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> `date <span class="hljs-string"><span class="hljs-string">"+%d.%m.%Y %H:%M"</span></span>`</code> </pre> <br><p>  After the execution, we get the date of the form: 05/20/2019 12:11. </p><br><p>  To calculate the time until the end of the day, we use the additional variable <code>TIME_OF_WORKDAY</code> and set the value <code>TIME_OF_WORKDAY="18:00:00"</code> .  Well, then we calculate the hours and minutes until the end of the working day: </p><br><pre> <code class="bash hljs">HOURS=$(( ( $(date +%s --date=<span class="hljs-variable"><span class="hljs-variable">$TIME_OF_WORKDAY</span></span>) - $(date +%s) ) / 3600 )) MINUTES=$(( (( $(date +%s --date=<span class="hljs-variable"><span class="hljs-variable">$TIME_OF_WORKDAY</span></span>) - $(date +%s) ) - <span class="hljs-variable"><span class="hljs-variable">$HOURS</span></span> * 3600) / 60 ))</code> </pre> <br><p>  The <code>$</code> symbol indicates that this is a variable. <br>  The <code>#</code> symbol is a comment. </p><br><p>  <code>date +%s</code> - we get the current date and time in seconds. <br>  <code>date +%s --date=$TIME_OF_WORKDAY</code> - we get the time in seconds to <code>TIME_OF_WORKDAY ("18:00:00")</code> . </p><br><p>  Calculate the time until the end of the work week: </p><br><pre> <code class="bash hljs">DAYS=$(( (<span class="hljs-variable"><span class="hljs-variable">$DAY_OF_WEEKEND</span></span>-$(date +%s)) / (24*3600) )) HOURS=$(( ((<span class="hljs-variable"><span class="hljs-variable">$DAY_OF_WEEKEND</span></span>-$(date +%s)) - (<span class="hljs-variable"><span class="hljs-variable">$DAYS</span></span>*24*3600)) / 3600 )) MINUTES=$(( ((<span class="hljs-variable"><span class="hljs-variable">$DAY_OF_WEEKEND</span></span>-$(date +%s)) - (<span class="hljs-variable"><span class="hljs-variable">$DAYS</span></span>*24*3600) - (<span class="hljs-variable"><span class="hljs-variable">$HOURS</span></span>*60*60)) / 60 ))</code> </pre> <br><p>  Where <code>DAY_OF_WEEKEND=`date +"%s" --date="friday 17:00:00"`</code> is the time in seconds from the current time to Friday 17:00:00. </p><br><p>  Part of the script is implemented using functions.  For example, </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    disp_clear(){ echo -en "\x0c\x0b" &gt; "${DEV_DISPLAY}" }</span></span></code> </pre> <br><p>  <code>disp_clear()</code> is the name of the function.  <code>{}</code> Specifies the commands to be executed. </p><br><p>  The variable <code>DEV_DISPLAY</code> is "global" and is specified at the beginning of the script and accordingly <code>DEV_DISPLAY="/dev/ttyUSB0"</code> . </p><br><p>  Reading data from a file, for example a specific line (1): </p><br><pre> <code class="bash hljs">LINE1=$(sed -n <span class="hljs-string"><span class="hljs-string">'1{p;q}'</span></span> /tmp/weather.txt)</code> </pre> <br><p>  <code>sed</code> is a text editor that performs editing operations on information in a standard input stream or file.  The <code>-n</code> displays the current selected line.  <code>'1{p;q}'</code> - prints 1 line and leaves without reading the rest ( <code>p</code> - print, <code>q</code> - exit). </p><br><p>  Another option to read from the file (line by line): </p><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> BTC=<span class="hljs-variable"><span class="hljs-variable">${line:0:13}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> &lt;/tmp/bitcoin.txt</code> </pre> <br><p>  And thus <code>DISPLAY_LINE1=${LINE1:0:14}</code> from the line <code>LINE1</code> extract a substring 14 characters long starting from 0. </p><br><p>  Replacing characters is done by a <code>//</code> combination, for example, <code>DOLLAR//‚Äì/-</code> .  Replaced the symbol "-" by "-". </p><br><h3 id="fayl-parsesh">  Parse.sh file </h3><br><div class="spoiler">  <b class="spoiler_title">parse.sh file</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #      RSS   http://rp5.ru/rss/1859/ru # 1859 -    #       conv(){ #        CURRENCY=$(sed -n '1!G;h;$p' /tmp/ex.xml | sed -n "${1}{p;q}") CURRENCY=${CURRENCY//[^,^(^)^0-9^‚Äì^+]/} echo $CURRENCY } #   c     # 1.  wget -q -O /tmp/rp5weather.xml http://rp5.ru/rss/1859/ru # 2.      wget -q -O /tmp/ex.xml http://currr.ru/rss/ # 3.   bitcoin/ethereum wget -q -O /tmp/bitcoin.json https://api.coinmarketcap.com/v1/ticker/bitcoin/ wget -q -O /tmp/ethereum.json https://api.coinmarketcap.com/v1/ticker/ethereum/ #   #   ,  ,    #     LINE31=$(sed -n '31{p;q}' /tmp/rp5weather.xml) LINE33=$(sed -n '33{p;q}' /tmp/rp5weather.xml) WEATHER1=${LINE31//"&lt;/title&gt;"} WEATHER1=${WEATHER1//" ¬∞C"} WEATHER1=${WEATHER1//"  "} WEATHER1=${WEATHER1:29} WEATHER2=${LINE33##*} WEATHER2=${WEATHER2//"¬∞"} echo "${WEATHER1}" &gt; /tmp/weather.txt echo ${WEATHER2%.*} &gt;&gt; /tmp/weather.txt #   Bitcoin LINEBTC=$(sed -n '7{p;q}' /tmp/bitcoin.json) echo "${LINEBTC//[^.^0-9]/}" &gt; /tmp/bitcoin.txt #   Ethereum LINEETH=$(sed -n '7{p;q}' /tmp/ethereum.json) echo "${LINEETH//[^.^0-9]/}" &gt; /tmp/ethereum.txt #   DOLLAR=$(conv 8) echo $DOLLAR &gt; /tmp/ex.txt EURO=$(conv 6) echo $EURO &gt;&gt; /tmp/ex.txt</span></span></code> </pre> </div></div><br><p>  <strong>Comments</strong> </p><br><p>  The <code>wget</code> command allows you to download files, pages, etc. from the network.  Option <code>-q</code> - displays a minimum of information, <code>-O</code> - saves to the specified file. </p><br><p>  The lines below are written to the file: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${WEATHER1}</span></span></span><span class="hljs-string">"</span></span> &gt; /tmp/weather.txt <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">${WEATHER2%.*}</span></span> &gt;&gt; /tmp/weather.txt</code> </pre> <br><p>  Moreover, if the output stream is redirected to the file <code>&gt;</code> , then the contents of the file are overwritten, and the use <code>&gt;&gt;</code> adds data to the file. </p><br><p>  An example of using a parameter in a function: </p><br><pre> <code class="bash hljs">conv 6</code> </pre> <br><p>  Directly in function: </p><br><pre> <code class="bash hljs">CURRENCY=$(sed -n <span class="hljs-string"><span class="hljs-string">'1!G;h;$p'</span></span> /tmp/ex.xml | sed -n <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${1}</span></span></span><span class="hljs-string">{p;q}"</span></span>)</code> </pre> <br><p>  Where <code>{1}</code> is a parameter.  The number 6 is transmitted. </p><br><p>  Pay attention to the complicated function of substring substitution, for example: </p><br><pre> <code class="bash hljs">LINEBTC//[^.^0-9]/</code> </pre> <br><p>  Only the "."  and all numbers from 0 to 9. </p><br><p>  <strong>Afterword</strong> </p><br><p>  In the bash language, almost all features of "ordinary" programming languages ‚Äã‚Äãare available.  And some teams, compared to their counterparts in 1C, are surprised by their brevity and functionality. </p><br><p>  At the moment, the customer display as an information board stably works for more than six months. </p><br><h2 id="spisok-resursov">  Resource list </h2><br><ol><li>  <a href="https://posua.com/ru/displej-pokupatelya/22-lpos-vfd.html">LPOS-VFD customer display page</a> </li><li>  <a href="https://habr.com/ru/post/235105/">We program currency symbols for customer display</a> </li><li>  <a href="https://habr.com/ru/post/47163/">Basics of BASH (Part 1)</a> </li><li>  <a href="https://habr.com/ru/post/52871/">Basics of BASH (Part 2)</a> </li><li>  <a href="https://losst.ru/kak-polzovatsya-putty">How to use PuTTY</a> </li><li>  <a href="https://losst.ru/tekstovyj-redaktor-nano-v-linux-dlya-novichkov">Linux nano text editor for newbies</a> </li><li>  <a href="https://supercomputer.susu.ru/users/instructions/winscp/">Instructions for WinSCP users</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/457352/">https://habr.com/ru/post/457352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45734/index.html">Discuss how to deal with automatic spam?</a></li>
<li><a href="../457340/index.html">10 PostCSS plugins that will save time for your coder</a></li>
<li><a href="../457342/index.html">Signs from above: how did we save cartographers from unnecessary work and red eyes</a></li>
<li><a href="../457348/index.html">Deploy to PythonAnywhere from GitHub</a></li>
<li><a href="../457350/index.html">Why does the oscilloscope support cryptography?</a></li>
<li><a href="../457354/index.html">Obfuscation of data for performance tests</a></li>
<li><a href="../45736/index.html">nginx: another allocator</a></li>
<li><a href="../457362/index.html">Action from RUVDS: prepare the server in the summer</a></li>
<li><a href="../457366/index.html">A fanatic, a iron player or a spectator - what kind of gamer are you?</a></li>
<li><a href="../45737/index.html">Mumbai terrorists and new US IT policy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>