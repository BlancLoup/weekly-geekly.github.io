<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The fastest reports in the wild west. And a handful of bugs to boot ...</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not only Microsoft has recently been putting open source code for its own projects - other companies are also following this trend. For us, the PVS-St...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The fastest reports in the wild west. And a handful of bugs to boot ...</h1><div class="post__text post__text-html js-mediator-article"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e31/a8a/e21/e31a8ae21e6997c220a18cf2ac49b67b.png" alt="Picture 3"></div><br>  Not only Microsoft has recently been putting open source code for its own projects - other companies are also following this trend.  For us, the PVS-Studio developers, this is a great way to test the analyzer again, see what interesting it can find, and inform the project authors about it.  Today we are looking inside the Fast Reports project. <br><a name="habracut"></a><br><h2>  What was checked? </h2><br>  FastReport is a report generator developed by <a href="https://www.fast-report.com/en/">Fast Reports</a> .  Written in C # and compatible with .NET Standard 2.0+.  The source code of the project was recently <a href="https://github.com/FastReports/FastReport">posted on GitHub</a> , from where it was uploaded for further analysis. <br><br>  The reports support the use of text, images, lines, shapes, diagrams, tables, bar codes, etc. They can be single-page and multi-page, including, in addition to the data, a cover and a back page.  XML, CSV, Json, MS SQL, MySql, Oracle, Postgres, MongoDB, Couchbase, RavenDB, SQLite can be used as data sources. <br><br>  There are various ways to create report templates: from code;  as an xml file;  using an online designer or FastReport Designer Community Edition. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If necessary, the library can be downloaded as <a href="https://www.nuget.org/profiles/FastReports">NuGet packages</a> . <br><br>  You can read more about the product features on <a href="https://github.com/FastReports/FastReport">the project's GitHub page</a> . <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/8c1/5d8/102/8c15d8102287436e600f08f4362d5970.png" alt="Picture 8"></p><br>  There were no problems with the build of the project - I collected it from Visual Studio 2017, from where I checked it later using the PVS-Studio plugin. <br><br>  PVS-Studio is a static analyzer that looks for errors in C, C ++, C #, Java code.  When analyzing C # code, you can use the Visual Studio IDE analyzer using the PVS-Studio plugin for this, or you can <a href="https://www.viva64.com/ru/m/0035/">check projects from the command line</a> , for which the command-line utility PVS-Studio_Cmd.exe is used.  If you wish, you can <a href="https://www.viva64.com/ru/m/0005/">set up the analysis on the assembly server</a> or <a href="https://www.viva64.com/ru/m/0037/">pick up the analysis results to the SonarQube</a> . <br><br>  Well, let's see what was interesting this time. <br><br>  Since the project is small, you should not count on a lot of typos and suspicious places.  Let's look at what has been found, and even try to reproduce something in practice. <br><br><h2>  Ochepyatki and not only </h2><br>  I met the following method: <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_value == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.String; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3108/">warning</a> : <a href="https://www.viva64.com/ru/w/v3108/">V3108</a> It is not recommended to return the 'null' from 'ToSting ()' method.  Variant.cs 1519 <br><br>  Yes, returning <i>null</i> from the overridden <i>ToString ()</i> method is not in itself an error, but it‚Äôs still a bad style.  This is indicated, among other things, in <a href="https://docs.microsoft.com/en-us/dotnet/api/system.object.tostring%3Fview%3Dnetcore-2.1">the Microsoft documentation</a> : <i>Your <a href="https://docs.microsoft.com/en-us/dotnet/api/system.object.tostring%3Fview%3Dnetcore-2.1"><i>ToString ()</i></a> should not return. <a href="https://docs.microsoft.com/en-us/dotnet/api/system.string.empty%3Fview%3Dnetcore-2.1"><i>Empty</i></a> or a null string</i> .  Developers who do not expect to return <i>null</i> as a return value of <i>ToString ()</i> can be unpleasantly surprised when an <i>ArgumentNullException</i> exception is thrown during the execution of the code below (provided that the extension method for <i>IEnumerable &lt;T&gt; is</i> called). <br><br><pre> <code class="cs hljs">Variant varObj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Variant(); varObj.ToString().Contains(character);</code> </pre> <br>  You can find fault with the fact that the example is synthetic, but the essence does not change. <br><br>  Moreover, this code is commented as follows: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Returns </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see cref="String"/&gt;</span></span></span><span class="hljs-comment"> property unless the value on the right </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> is null. If the value on the right is null, returns "". </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span></span></code> </pre> <br>  Oops.  Returns "" instead of <i>null</i> . <br><br>  We continue. <br><br>  The library has a class <i>FastString</i> .  Description: <i>Fast alternative of StringBuilder</i> .  Actually, this class contains a field of type <i>StringBuilder</i> .  The constructors of the <i>FastString</i> class call the <i>Init</i> method, which initializes the corresponding field. <br><br>  Code of one of the designers: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FastString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Init(initCapacity); }</code> </pre> <br>  And the code of the <i>Init</i> method: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> iniCapacity</span></span></span><span class="hljs-function">)</span></span> { sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(iniCapacity); <span class="hljs-comment"><span class="hljs-comment">//chars = new char[iniCapacity]; //capacity = iniCapacity; }</span></span></code> </pre> <br>  If desired, you can access the <i>sb</i> field via the <i>StringBuilder</i> property: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StringBuilder StringBuilder { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb; } }</code> </pre> <br>  In total, <i>FastString</i> has 3 constructors: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FastString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FastString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> iniCapacity</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FastString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> initValue</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br>  I have already shown the body of the first designer, what the other two are doing to guess, I think, it‚Äôs also easy.  And now, attention.  Guess what output the following code: <br><br><pre> <code class="cs hljs">FastString fs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FastString(<span class="hljs-number"><span class="hljs-number">256</span></span>); Console.WriteLine(fs.StringBuilder.Capacity);</code> </pre> <br>  Attention answer: <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b5c/e6f/c54/b5ce6fc542490a9d10c0d7596d5b354c.png" alt="Picture 2"></p><br>  Suddenly?  Let's look at the body of the corresponding constructor: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FastString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> iniCapacity</span></span></span><span class="hljs-function">)</span></span> { Init(initCapacity); }</code> </pre> <br>  Regular readers of our articles should already have an eye to find a problem here.  At the eye analyzer (scent, logic, call it what you want) exactly planted, and he found the problem: <a href="https://www.viva64.com/ru/w/v3117/">V3117</a> Constructor parameter 'iniCapacity' is not used.  FastString.cs 434 <br><br>  What a coincidence that the class code contains a constant field <i>initCapacity</i> , which is passed as an argument to the <i>Init</i> method instead of the <i>iniCapacity</i> constructor <i>parameter</i> ... <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> initCapacity = <span class="hljs-number"><span class="hljs-number">32</span></span>;</code> </pre> <br>  When using similar names you need to be very, very attentive.  Wherever there are errors associated with the use of similar names - projects in C, C ++, C #, Java - there were typos of this kind everywhere ... <br><br>  By the way, about typos. <br><br>  Let's make the following simple example and see how it works: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { TextObject textObj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextObject(); textObj.ParagraphFormat = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Ok"</span></span>); }</code> </pre> <br>  As you may have guessed, the output will be different than the string ‚ÄúOk‚Äù :) <br><br>  How?  So, for example: <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/658/a69/551/658a6955138c038413502033c79ebbbe.png" alt="Picture 1"></p><br>  The problem lies in the <i>ParagraphFormat</i> property and in the use of similar names: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ParagraphFormat ParagraphFormat { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> paragraphFormat; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { ParagraphFormat = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3110/">warning</a> : <a href="https://www.viva64.com/ru/w/v3110/">V3110</a> Possible infinite recursion inside 'ParagraphFormat' property.  TextObject.cs 281 <br><br>  The <i>ParagraphFormat</i> property is a wrapper over the <i>paragraphFormat</i> field.  Moreover, its get property accessor is written correctly, but the set property accessor contains an annoying typo: instead of a field, an entry occurs in the same property, which causes recursion.  Again the error associated with similar names. <br><br>  Consider the following code snippet. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Run </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Split</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> availableWidth, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Run secondPart</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (r.Width &gt; availableWidth) { List&lt;CharWithIndex&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;CharWithIndex&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = point; i &lt; size; i++) list.Add(chars[i]); secondPart = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RunText(renderer, word, style, list, left + r.Width, charIndex); list.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; point; i++) list.Add(chars[i]); r = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RunText(renderer, word, style, list, left, charIndex); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { List&lt;CharWithIndex&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;CharWithIndex&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = point; i &lt; size; i++) list.Add(chars[i]); secondPart = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RunText(renderer, word, style, list, left + r.Width, charIndex); list.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; point; i++) list.Add(chars[i]); r = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RunText(renderer, word, style, list, left, charIndex); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r; } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3004/">warning</a> : <a href="https://www.viva64.com/ru/w/v3004/">V3004</a> The 'then' statement is equivalent to the 'else' statement.  HtmlTextRenderer.cs 2092 <br><br>  A little copy-paste, and now the same actions will be performed regardless of the value of the expression <i>r.Width&gt; availableWidth</i> .  It is necessary either to remove the <i>if statement</i> , or to change the logic in one of the branches. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetExpression</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">FindTextArgs args, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> skipStrings</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (args.StartIndex &lt; args.Text.Length) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!FindMatchingBrackets(args, skipStrings)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> args.FoundText; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; }</code> </pre> <br>  <b>Analyzer warning</b> : <a href="https://www.viva64.com/ru/w/v3020/">V3020</a> An unconditional 'return' within a loop.  CodeUtils.cs 262 <br><br>  Due to the unconditional <i>return</i> operator for the above loop, no more than one iteration will be executed.  Perhaps this code was obtained after refactoring, or maybe it is just an unusual way to do something that could be done without a loop. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindBarItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; tabelle_cb.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == tabelle_cb[i].c) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPattern</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> result = tabelle_cb[FindBarItem(<span class="hljs-string"><span class="hljs-string">"A"</span></span>)].data + <span class="hljs-string"><span class="hljs-string">"0"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> text) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> idx = FindBarItem(c.ToString()); result += tabelle_cb[idx].data + <span class="hljs-string"><span class="hljs-string">"0"</span></span>; } result += tabelle_cb[FindBarItem(<span class="hljs-string"><span class="hljs-string">"B"</span></span>)].data; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3106/">warning</a> : <a href="https://www.viva64.com/ru/w/v3106/">V3106</a> Possible negative index value.  The value of 'idx' index could reach -1.  BarcodeCodabar.cs 70 <br><br>  Potentially dangerous code.  The <i>FindBarItem</i> method can return <i>-1</i> if it does not find the item passed as a parameter.  In the calling code ( <i>GetPattern</i> method), this value is written to the <i>idx</i> variable and used as the index of the array <i>tabelle_cb</i> without prior checking.  When accessing by index <i>-1, an</i> exception of type <i>IndexOutOfRangeException</i> will be generated. <br><br>  We continue. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Finish</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (saveStreams) { FinishSaveStreams(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (singlePage) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (saveStreams) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fileIndex = GeneratedFiles.IndexOf(singlePageFileName); DoPageEnd(generatedStreams[fileIndex]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .... } .... } .... } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v3022/">warning</a> : <a href="https://www.viva64.com/ru/w/v3022/">V3022</a> Expression 'saveStreams' is always false.  HTMLExport.cs 849 <br><br>  The given code with getting the <i>fileIndex</i> value and calling the <i>DoPageEnd</i> method <i>will</i> never be executed, since the result of the second <i>saveStreams</i> given in the code will always be <i>false</i> . <br><br>  From the most interesting is, perhaps, everything (you did not wait for the article in the spirit of the <a href="https://www.viva64.com/ru/b/0431/">analysis of Mono</a> ?).  There were other analyzer warnings, but they did not seem interesting enough to include them in the article (some always remain behind the scenes). <br><br>  Knowledge of the project would be useful for analyzing them, so ideally the authors should look at these warnings on their own.  These are warnings such as <a href="https://www.viva64.com/ru/w/v3083/">V3083</a> (a potentially dangerous invocation of event handlers), <a href="https://www.viva64.com/ru/w/v3022/">V3022</a> (the condition is always true / false (in this case, often because of methods that return one value)), <a href="https://www.viva64.com/ru/w/v3072/">V3072</a> , <a href="https://www.viva64.com/ru/w/v3073/">V3073</a> (working with <i>IDisposable</i> ) and others. <br><br>  If any of this is irrelevant, you can: <br><br><ul><li>  <a href="https://www.viva64.com/ru/m/0013/">turn off diagnostics</a> if the pattern it detects is exactly correct on the project; </li><li>  <a href="https://www.viva64.com/ru/m/0017/">mark warnings as false positives</a> if they are not very many; </li><li>  <a href="https://www.viva64.com/ru/m/0032/">add warnings to the suppression database</a> if you do not want to insert comments into the code.  But then you need access to the base of suppression for all who work with the analyzer. </li></ul><br><h2>  Conclusion </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f9f/6c9/11d/f9f6c911df453cc009855322f4c9632f.png" alt="Picture 4"></p><br>  Despite the fact that the article came out small, I was pleased to ‚Äútouch‚Äù the warnings of the analyzer with my hands - to see how what the analyzer curses is manifested in practice. <br><br>  I wish success to the authors of the project, correcting the problems found and want to praise the step towards the open-source community! <br><br>  I advise the rest to try the analyzer on your code and see what interesting things you can find. <br><br>  All the best! <br><br><p> <a href="https://www.viva64.com/en/b/0595/"><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Sergey Vasiliev.  <a href="https://www.viva64.com/en/b/0595/">The Fastest Reports in the Wild West - and a Handful of Bugs ...</a> </div><p>Source: <a href="https://habr.com/ru/post/431370/">https://habr.com/ru/post/431370/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431350/index.html">Plans for the development of a line of processors from Baikal Electronics</a></li>
<li><a href="../431354/index.html">The first video codec on machine learning radically surpassed all existing codecs, including H.265 and VP9</a></li>
<li><a href="../431360/index.html">We explain backdoor in event-stream</a></li>
<li><a href="../431362/index.html">How a designer get rid of his routine and keep his interest in his work</a></li>
<li><a href="../431366/index.html">Rumors: Corel buys Parallels, the deal will be closed in December, employees were informed yesterday</a></li>
<li><a href="../431372/index.html">Interrupts from external devices in the x86 system. Part 2. Linux kernel boot options</a></li>
<li><a href="../431374/index.html">The last judgment: an analysis of the financial performance of the game in the early access</a></li>
<li><a href="../431376/index.html">Data migration in a bloody enterprise: what to analyze, so as not to overwhelm the project</a></li>
<li><a href="../431378/index.html">The whole truth about the RTOS. Article # 23. Queues: introduction and basic services</a></li>
<li><a href="../431380/index.html">Mitap Netologii and Skyeng about soft skills "What a developer needs to know, except for the code"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>