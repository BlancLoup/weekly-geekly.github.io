<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to work on Chromium</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Preface from the author of the original: 
 In March 2011, I wrote a draft article about how the team responsible for Google Chrome develops and releas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to work on Chromium</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/post/267559/"><img src="https://habrastorage.org/getpro/habr/post_images/801/5cb/7c5/8015cb7c5ac9211fbcd17c21436dcebf.jpg" alt="image"></a> <br>  <i>Preface from the author of the original:</i> <br><blockquote>  <i>In March 2011, I wrote a draft article about how the team responsible for Google Chrome develops and releases its product - after which I safely forgot about it.</i>  <i>Only a few days ago I stumbled upon it.</i>  <i>Let it be outdated in some places (Chrome forked WebKit in Blink in 2013, and I no longer work for Google myself), I‚Äôm inclined to believe that the ideas contained in it are still valid.</i> </blockquote>  Today I am going to tell you about how Chromium works.  No, it's not really about <a href="http://www.google.com/chrome/">Chrome</a> , but rather about <a href="http://www.chromium.org/Home">Chromium</a> - a group of people involved in creating a browser. <br><br>  Over the Chromium project work hundreds of engineers.  Together we commit approximately 800 changes to the code base every week.  We are also dependent on many other large and actively developing projects like <a href="http://code.google.com/p/v8">V8</a> , <a href="http://code.google.com/p/skia">Skia</a> and <a href="http://www.webkit.org/">WebKit</a> . <br><br>  We send a new stable release to hundreds of millions of users every six weeks, clearly on schedule.  And we support several other channels of early access, which are updated even faster - the fastest channel, <i>canary</i> , ‚Äúquietly‚Äù auto-updates almost every weekday. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How does all this work?  Why are the ‚Äúwheels‚Äù of this ‚Äúbus‚Äù not yet ‚Äúfallen off‚Äù?  Why not all developers are crazy? <br><a name="habracut"></a><br>  From a technological point of view, the speed of the Chromium team was achieved through reliable, efficient and ‚Äúsilent‚Äù auto-updates. <br><br>  From the point of view of human resources, this is the merit of dedicated, hardworking and intelligent QA teams and release engineers, without whom the entire project would have fallen apart in a matter of weeks.  And also - designers, product managers, writers, PR, lawyers, information security and all others who work together smoothly on each stable release.  Today I will not talk about everyone, focusing only on engineering topics, so as not to slip into a giant post in the spirit of Steve Jegg. <br><br>  I'm going to talk about the Chromium development process, which is built specifically to make quick releases possible.  It will be a question of interesting finds which can be useful to other projects regardless of what their release schedule looks like;  I will mention our difficulties. <br><br><h4>  No branches </h4><br>  In many projects, a common practice is to create a branch to work on new major features.  The idea with this choice is that destabilization due to the new code will not affect other developers and users.  Once the feature is complete, it mergitsya back to the <i>trunk</i> , after which usually follows a period of instability while integration issues are eliminated. <br><br>  With Chrome, this approach will not work, as we are releasing every day.  We cannot allow the appearance of large chunks of new code in our <i>trunk</i> , because in this case it is likely that the update channels <i>canary</i> or <i>dev</i> will go into denial for a long time.  In addition, the <i>trunk</i> in Chrome is moving forward so fast that it is impractical for developers to remain isolated on their branch for too long a period of time.  By the time they shake off their branch, the <i>trunk</i> will look so different that integration will be time consuming and easily error prone. <br><br>  We create operational branches before each of our beta releases, but they live a very short time ‚Äî a maximum of just six weeks, until the next beta release.  And we never develop directly in these branches - all late fixes that should be included in the release are first made to the <i>trunk</i> , after which cherry-pick will be made to the branch. <br><br>  A pleasant side effect of this process: the project does not have a special <i>‚Äúsecond-class‚Äù</i> development team that deals exclusively with the operational branch.  All developers always work with the latest actual version of the source code. <br><br><h4>  Runtime switches </h4><br>  Suppose we do not create branches, but still need a way to hide unfinished features from users.  The natural way to do this is to use compile-time checks;  its problem is that this approach is not very different from creating branches with code - in fact, you still have two independent code bases that must be checked once.  And, since the new default code was not compiled or tested, developers will not have difficulty accidentally breaking this code. <br><br>  Instead, the Chromium project uses runtime checks.  Each feature that is under development is compiled and tested on all configurations from the very beginning.  We have <a href="http://git.chromium.org/gitweb/%3Fp%3Dchromium/chromium.git%3Ba%3Dblob%3Bf%3Dchrome/common/chrome_switches.cc%3Bhb%3DHEAD">command line flags</a> , which we test at the very beginning;  in other places, the code base for the most part has no idea what functions are available.  This strategy means that the work on new features is integrated into the project code from the very beginning to the maximum extent possible.  At least, the new code is compiled, so all changes in the main code that need to be made for the new function to work have been tested, and the user believes that everything works as usual and does not notice the difference.  Well, we can easily write automated tests that check the operation of unavailable features, temporarily <a href="http://git.chromium.org/gitweb/%3Fp%3Dchromium/chromium.git%3Ba%3Dblob%3Bf%3Dchrome/test/base/scoped_command_line_override.h%3Bhb%3DHEAD">‚Äúoverriding‚Äù the command line</a> . <br><br>  When the feature gets closer to completion, we present the option in the form of a flag in <a href="http://lifehacker.com/5667846/chromes-aboutlabs-renamed-to-aboutflags-adds-a-warning">chrome: // flags</a> , so that advanced users can start testing it and give us feedback.  As a result, when we think that the feature is ready for release, we just remove the command line flag and make it available by default.  By this time, the code is usually tested far and wide, as well as run-in by many users, so that the potential damage from its activation is minimized. <br><br><h4>  Huge amount of automatic testing </h4><br>  In order to be released every day, we must be sure that our code base is always in proper condition.  This requires automated tests, and a very large number of them.  At the time these lines are written, Chrome has 12k class-level unit tests, 2k automated integration tests and a huge range of performance tests, bloat tests, thread safety and memory safety tests, and possibly many others, about which I do not remember now.  And all this for just one Chrome;  WebKit, V8 and the rest of our dependencies are tested independently;  One WebKit has approximately 27k tests that verify that web pages are displayed and functioning correctly.  Our basic rule is that every change must go along with the tests. <br><br>  We use a public <a href="http://build.chromium.org/">buildbot</a> , which constantly <a href="http://build.chromium.org/">rolls</a> out new changes in our code on the <i>test suite</i> .  We adhere to the "green tree" policy: if the change "breaks" the test, then it immediately rolls back, and the developer must fix the changes and re-distribute them.  We do not leave such ‚Äúcritical‚Äù changes in the tree, because: <br><br><ul><li>  This makes it easier for you to accidentally make even more ‚Äúcritical‚Äù changes ‚Äî if a tree is red, no one notices when it becomes even redder. </li><li>  This slows down development, as everyone will have to work on what is broken. </li><li>  This encourages developers to do careless quick fixes in order to pass tests. </li><li>  This does not allow us to be released! </li></ul><br><br>  To help developers get away with the tree, we have <a href="http://www.chromium.org/developers/testing/try-server-usage">try-bots</a> , which are a way to "get rid" of the change under all tests and configurations before releasing it.  Results are sent to the email developer.  We also have a <a href="http://www.chromium.org/developers/testing/commit-queue">commit queue</a> , which serves to test the change and apply it automatically if all the tests pass successfully.  I like to use it after a long night of hacking - I press the button, go to bed, and after a while I wake up with the hope that my change has affected. <br><br>  Thanks to all the automated testing performed, we can get rid of the minimum amount of manual testing on our <i>dev</i> channel, and not do it at canaries. <br><br><h4>  Ruthless refactoring </h4><br>  Since we have a fairly extensive test coverage, we can allow ourselves to be aggressive in refactoring.  In the Chrome project, all the time we are working on refactoring in several main areas - for example, for the period of 2013, those were <a href="http://code.google.com/p/chromium/issues/list%3Fcan%3D1%26q%3Dlabel%253Acarnitas">Carnitas</a> and <a href="http://code.google.com/p/chromium/issues/detail%3Fid%3D84070">Aura</a> . <br><br>  With our scope and pace, it is crucial to keep the code base clean and easy to understand.  For us, these qualities are more important than preventing regressions.  Engineers of the entire Chrome project have the right to make improvements anywhere in the system (however, we can also request a mandatory review of the module owner).  If as a result of refactoring, something eventually breaks down, and this cannot be detected at the testing stage, then from our point of view this is not the fault of the engineer who did the refactoring - but the one whose feature was not sufficiently covered with tests. <br><br><h4>  Deps </h4><br>  WebKit is evolving at an equally fast pace.  And, similarly to the fact that we cannot afford to have branches for features that will suddenly merge into the mainstream one day, we cannot afford to try to keep the monthly set of changes in WebKit all at once, because it destabilizes the tree for several days. <br><br>  Instead, we try to compile Chrome with the latest version of WebKit (almost always, this version is not older than half a day) until we achieve success.  At the <a href="http://src.chromium.org/viewvc/chrome/trunk/src/DEPS%3Fview%3Dmarkup">root of the Chrome project</a> is a file that contains the version of WebKit with which it is now successfully compiled.  When you checkout and create a working copy, or update the Chrome source code, the <a href="http://www.chromium.org/developers/how-tos/depottools">gclient</a> tool automatically gets the version of WebKit specified in the file. <br><br>  Every day, several times a day, the engineer updates the version number, finds out if new problems have arisen during the integration, and assigns bugs to the appropriate engineers.  As a result, we always get small changes in WebKit all at once, and with a similar approach, the effect on our source tree is usually minimal.  We also added bots to WebKit's buildbot, so when WebKit engineers make a change that Chrome breaks, they will know about it immediately. <br><br>  The great advantage of the DEPS system is that we can add changes to our web platform very quickly.  The feature that appeared in WebKit will be available to Chrome users on the <i>canary</i> channel in just a few days.  This encouraged us to make improvements right away in WebKit upstream, where they will be useful to anyone who uses WebKit in their applications, rather than applying them locally in Chrome.  Honestly, our basic rule is that we generally do not make local changes in WebKit (as in other projects that Chrome depends on). <br><br><h4>  Problems </h4><br>  Thorough testing remains an unresolved issue.  In particular, ‚Äúunstable‚Äù integration tests ( <i>flaky integration tests</i> ) have become a constant problem for us.  Chrome is large, complex, asynchronous, multiprocess, and multi-threaded.  So for integration tests, it‚Äôs easy to fail because of subtle synchronization problems, which happens from time to time.  On a project of our size, a test that fills 1% of the time, as a result, it will be guaranteed to fayl several times a day. <br><br>  As soon as the test becomes ‚Äúunstable‚Äù, the team quickly acquires the habit of ignoring it, and as a result, it is easy to miss the file of another, working test for the same part of the code.  Therefore, we tend to turn off ‚Äúunstable‚Äù tests and lose as a percentage of coverage, making it easier to issue basic regressions for the user. <br><br>  Another problem is that at such a speed it becomes hard to ‚Äúinduce beauty‚Äù.  As for me, the team is easier to achieve the correct implementation of all the details in the rare "loud" releases, rather than trying to keep and constantly keep the focus of attention on every little thing for an indefinite time.  Since it is often hard to test small details like the distance between the buttons in the toolbar, errors easily creep in such places. <br><br>  Finally, it seems to me that stress is quite a real problem.  Considering all this code, which is constantly changing, even if a person tries to focus only on his area of ‚Äã‚Äãresponsibility, this does not mean that he is not touched by something happening in another part of the project.  If you are constantly trying to keep your part of Chrome in working condition, then sooner or later you will begin to feel that you live like a volcano, and you can not afford a single moment of peace. <br><br>  We deal with the latter problem by breaking the code base into the main modules.  The engineers at Carnitas are trying to establish clearer and more robust interfaces between some of our main components.  At the moment, much of the code has become cleaner and clearer, but it is too early to talk about how much this will help reduce stress at the global level. <br><br><h4>  Finally </h4><br>  So, thanks to which the "wheels" have not yet "fallen off"?  In short: thanks to life without branches, switches to the runtime environment, tons of automatic tests, ruthless refactoring, and holding positions as close as possible to the HEAD of our dependencies. <br><br>  These techniques will be most useful for large projects that have fast-changing upstream dependencies, but it is possible that some of them will be applicable to smaller projects. </div><p>Source: <a href="https://habr.com/ru/post/267559/">https://habr.com/ru/post/267559/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267543/index.html">Moscow Python Meetup at Rambler & Co</a></li>
<li><a href="../267547/index.html">The company D-Link mistakenly published the secret keys for signing firmware</a></li>
<li><a href="../267549/index.html">Accordion on AngularJS and Bootstrap</a></li>
<li><a href="../267555/index.html">New telephony from "OnLime"</a></li>
<li><a href="../267557/index.html">We fasten the multimedia keys in Yandeks.Radio</a></li>
<li><a href="../267561/index.html">How we developed a 3D people scanning system using Intel RealSense 3D cameras and Intel Edison technology</a></li>
<li><a href="../267563/index.html">Technical method of protection against unauthorized issuance of duplicate SIM cards (and personal data in general), implemented at the operator level</a></li>
<li><a href="../267565/index.html">How to create an image slider in a mail message</a></li>
<li><a href="../267567/index.html">Telegram check using PVS-Studio and vice versa</a></li>
<li><a href="../267569/index.html">Software design</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>