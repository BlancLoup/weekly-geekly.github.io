<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Liscript - REPL bots online</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago, inspired by the reading of SICP, I wrote a couple of my implementations of Lisp-like interpreters with strict semantics, added a deskto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Liscript - REPL bots online</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/c1e/d1e/e2b/c1ed1ee2b6fb443fb66faf0b5e45d987.png"><br><br>  Some time ago, inspired by the reading of SICP, I wrote a couple of my implementations of Lisp-like interpreters with strict semantics, added a desktop GUI, a console interface, wrote Tetris on it and much more, and published a couple of articles on Habr about it. <br><br>  Recently, I added the opportunity for a wide audience to get acquainted with this language - I wrote REPL bots for the following messengers: IRC, Telegram, Slack, Gitter.  The bots are located on channels specially created for them, but in most cases they can be added / invited to other channels and you can conduct personal correspondence with them.  This format allows for online textual reports on the basics of functional programming, accompanied by a real-time demonstration of the interpreter. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Of course, graphic windows with animation can be created only in the desktop version of the application.  Therefore, for a greater disclosure of the possibilities of language and REPL, I wrote a textual implementation of the game Maze, in which any number of people can play with the bot.  Details and some lyrics under the cut. <br><a name="habracut"></a><br><h3>  Description and rules of the game </h3><br>  When I was a schoolboy (and these were the 80s of the last century), computers and the Internet were, to put it mildly, not as widespread and accessible as they are now.  Therefore, friends and classmates and I played normal children's games with a pen on a piece of paper ‚Äî sea battle, dots, etc.  Among others there was such a game, which we called the Labyrinth. <br><br>  The rules are as follows: the leader is selected, who makes a map and draws it on his piece of paper, without showing it to anyone.  The card is a rectangular grid n for m cells, the cell can be empty, there can be a pit in the cell - an object of the teleport type - when it gets into one cell of the pit the player moves to another and the leader calls the player the number of the pit, there are rivers on the map - they flow only in adjacent cells (diagonally not allowed), when it enters the river, the player is transferred to the end of the river and the leader informs the player of the fact of the swim <i>without specifying the river number</i> .  When you try to go in the direction of the wall, the presenter says this.  Map parameters, number of rivers / holes and length of rivers are known to all players.  At the beginning of the game, each player tells the leader their desired starting coordinates, the leader answers the character‚Äôs fate (empty cell, river, pit-1) and then the players take their turns in turn, pronouncing one of 4 possible options: left / right / up / down, and the leader moves the corresponding players to the chips on the map, taking into account movements along the rivers and teleportation through the pits.  You can supplement the rules with internal walls that can be blown up with grenades replenished in special arsenal cells, enter into the game treasure hunt and exit missions, various new objects - like a mirrored cell, when hit by which the leader declares it as an empty cell, but during <i>where the</i> leader silently moves the player in the direction opposite to the player‚Äôs move, etc. <br><br>  But even the minimal basic rules of the game create enough interest and mission - to find out the map!  It is not as simple as it seems at first glance.  You can listen to the answers of the leader and other players, accumulating information about the pieces of the card, trying to glue it together.  But any mistake on this path is fraught with the fact that the map is ‚Äúnot going‚Äù, and in which piece of error it is impossible to find out, and you have to cross out all the available information and start accumulating it again.  But when one manages to figure out the map, a qualitatively new sensation appears (at least for me) - instead of random poking around the walls, swimming down the rivers and flying through the pits, when reality in the form of a master‚Äôs response constantly breaks your illusions and predictions to pieces and dust. you already begin to suspect him of mistakes, there is a feeling of complete enlightenment, harmony and comprehension of dao - you can make moves meaningfully, knowing their consequences, build on this tactics and strategy of the game (with a mission), and generally experience incomparable pleasure from  Replies reality to your ideas about it :) <br><br>  In general, I strongly recommend trying it - for example, we with the older-middle 9-year-old son love to play it on walks, without any pens and paper, just from memory - the level of the field is 3 * 3, one river has 3 cells and two holes (2 empty cells remain) he already decides with ease in his mind, and 4 * 4 is still hard for him.  We in high school comfortably felt on the field 6 * 6 with an adequate set of objects, and the fields 8 * 8 did not master to pass to the end. <br><br><h3>  Little about bots </h3><br>  At the end of the article there is a link to the main page of the application that launches and maintains bots.  She has a very spartan design, because  I have never done web development, much less frontend.  But it doesn‚Äôt require much - just a brief description, several links, and most importantly - launching an application that falls asleep, if you don‚Äôt go to this page for half an hour - so the heroku, where the application is published, saves a limited set of application hours at a free rate. <br><br>  For each room / personal correspondence, a separate bot session is created with its own namespace, which can change during the request / response process - the standard REPL format (read-eval-print loop).  When an application goes to sleep, all user information is erased, and when you wake up, sessions are created anew and a standard library is loaded into each one.  Within each room, the global namespace is common to all users, but each user‚Äôs command is launched in a separate thread.  There are no restrictions on the execution time of commands, but the user cannot start a new command stream until the previous one is completed.  To force an interruption of the current stream, use the bot command <b>!</b>  .  This allows all channel participants to have access to the overall mutable state, and at the same time to start cyclic processes inside the lambda with their local state. <br><br>  Separately, I want to mention one problem that arose during the implementation of the chat bot interface.  If, when calculating with the command print, output the result to the chat immediately, then it is possible to write spam bombs with infinitely looped output cluttering up the general chat.  Therefore, it was decided to print "on the table" - in a separate variable to accumulate all the printing results, and at the end of the calculations output them along with the result of the calculation.  But then it becomes impossible to start an interactive cyclic process, in which the bot writes an intermediate output to the chat without finishing the calculation, waiting for input from the user in blocking mode.  As a result, I came up with the following option, which absolutely suits me in all parameters - the function blocking the calculation of input from the user read also now can print - but unlike print, it prints not ‚Äúto the table‚Äù, but immediately to the chat window, providing interactivity of interaction .  But the spam bomb does not work, because after printing, read waits for the user to enter the blocking mode, so even if there is an endless loop of text, there will be no text without user confirmation. <br><br><h3>  About the implementation of the game </h3><br>  The entire game code consists of two functions - generating the playing field, and starting the game on the generated field.  The text of the functions is quite voluminous, and for example in Telegram I could not download it with one message - the message was split into 2, the bot responded to them separately, of course the syntactic and semantic integrity of the code was lost.  But the solution is simple - download each function as a separate message :) <br><br>  Of course, this does not apply to IRC, where strong restrictions (maximum 512 characters and the absence of multi-line messages) do not allow the bot to load any nontrivial pieces of code.  But in the other three listed messengers everything works - and you can see the results in the starting picture of the article.  Actually, after loading functions into the REPL, the start of the game may look like this: <br><br><pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">join</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-field <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br>  This means running the game on a 5 * 5 field inaccessible to anyone else with 3 rivers 4, 2 wells long and a starting row 2 row / 3 column cell.  Or so: <br><br><pre> <code class="hljs scala"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">common-field</span></span></span><span class="hljs-function"> </span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-field <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br>  followed by a call <br><br><pre> <code class="hljs swift"><span class="hljs-built_in"><span class="hljs-built_in">join</span></span> common-field <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br>  any number of users, each with their own starting coordinates - everyone will walk in one common field.  Of course, you can create another field in the global namespace with a different variable name, and connect to it. <br><br>  The description of the control commands is displayed in the chat when the game starts.  The texts of the functions are listed below: <br><br><div class="spoiler">  <b class="spoiler_title">Code for generating a new field</b> <div class="spoiler_text"><pre> <code class="hljs scala">;   -  - , , ,    -  ; (defn <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-field (max-r max-c rivers-count river-length holes-count) ;       <span class="hljs-number"><span class="hljs-number">0</span></span> - (n<span class="hljs-number"><span class="hljs-number">-1</span></span>) ; (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">random-int-object</span></span></span><span class="hljs-function"> </span></span>(java (<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">util</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Random</span></span></span><span class="hljs-class">") "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">")) (</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">defmacro random-int (n</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">random-int-object</span></span></span><span class="hljs-class"> "</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nextInt</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">n</span></span></span><span class="hljs-class">) </span></span>;    : (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) -&gt; <span class="hljs-number"><span class="hljs-number">2</span></span> ; (defn list-rand (l) cond (<span class="hljs-literal"><span class="hljs-literal">null</span></span>? l) nil (list-ref (random-int (length l)) l)) ;     : (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) -&gt; (<span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>)) ; (defn get-rand-cell (l) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-function"> </span></span>(list-rand l)) (cond (<span class="hljs-literal"><span class="hljs-literal">null</span></span>? l) nil (cons c (filter (lambda (x) not (eq? xc)) l) nil) )) ;    ,    / ; (defn get-free-neighbours (p free-cs) (defn good (p) and (and (&lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> (car p) max-r) (&lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> (cadr p) max-c)) (elem p free-cs)) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">neighbours</span></span></span><span class="hljs-function"> </span></span>(map (lambda (x) zipwith + px) '((<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>) (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) )) (filter good neighbours) ) ;     ,    : ; ; ((<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>)) -&gt; ((<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>)) ; (defn get-next-river-cell (river-free-cs) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">river</span></span></span><span class="hljs-function"> </span></span>(car river-free-cs) free-cs (cadr river-free-cs)) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cs</span></span></span><span class="hljs-function"> </span></span>(cond (<span class="hljs-literal"><span class="hljs-literal">null</span></span>? river) free-cs (get-free-neighbours (car river) free-cs))) (cond (<span class="hljs-literal"><span class="hljs-literal">null</span></span>? cs) nil ((<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-function"> </span></span>(list-rand cs)) (cons (cons c river) (filter (lambda (x) not (eq? xc)) free-cs) nil)) )) ;    : (() (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>)) -&gt; ((<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>)) ; (defn get-river (len river-free-cs) cond (= <span class="hljs-number"><span class="hljs-number">0</span></span> len) river-free-cs (<span class="hljs-literal"><span class="hljs-literal">null</span></span>? state) nil (get-river (- len <span class="hljs-number"><span class="hljs-number">1</span></span>) (get-next-river-cell river-free-cs))) ;          ; (defn <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>-get-river (trys len river-free-cs) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">river</span></span></span><span class="hljs-function"> </span></span>(get-river len river-free-cs)) (cond (= <span class="hljs-number"><span class="hljs-number">0</span></span> trys) nil (<span class="hljs-literal"><span class="hljs-literal">null</span></span>? river) (<span class="hljs-keyword"><span class="hljs-keyword">try</span></span>-get-river (- trys <span class="hljs-number"><span class="hljs-number">1</span></span>) len river-free-cs) river) ) ;      ,     ; (defn add-river (rivers-free-cs) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rivers</span></span></span><span class="hljs-function"> </span></span>(car rivers-free-cs) free-cs (cadr rivers-free-cs)) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">river</span></span></span><span class="hljs-function"> </span></span>(<span class="hljs-keyword"><span class="hljs-keyword">try</span></span>-get-river <span class="hljs-number"><span class="hljs-number">50</span></span> river-length (cons nil free-cs nil))) (cond (<span class="hljs-literal"><span class="hljs-literal">null</span></span>? river) nil (cons (cons (car river) rivers) (cadr river) nil) )) ;      ,     ; (defn add-hole (holes-free-cs) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">holes</span></span></span><span class="hljs-function"> </span></span>(car holes-free-cs) free-cs (cadr holes-free-cs)) (cond (<span class="hljs-literal"><span class="hljs-literal">null</span></span>? (cdr free-cs)) nil ((<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span></span>(get-rand-cell free-cs) b (get-rand-cell (cadr a))) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hole</span></span></span><span class="hljs-function"> </span></span>(cons (car a) (car b) nil)) (cons (cons hole holes) (cadr b) nil) ))) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">all-cells</span></span></span><span class="hljs-function"> </span></span>(concat (map (lambda (r) map (lambda (c) cons rc) (list-from-to <span class="hljs-number"><span class="hljs-number">1</span></span> max-c)) (list-from-to <span class="hljs-number"><span class="hljs-number">1</span></span> max-r) ))) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rivers-free-cs</span></span></span><span class="hljs-function"> </span></span>(ntimes rivers-count add-river (cons nil all-cells nil))) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">holes-free-cs</span></span></span><span class="hljs-function"> </span></span>(ntimes holes-count add-hole (cons nil (cadr rivers-free-cs) nil))) (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rivers</span></span></span><span class="hljs-function"> </span></span>(car rivers-free-cs) holes (car holes-free-cs)) (cond (or (<span class="hljs-literal"><span class="hljs-literal">null</span></span>? rivers-free-cs) (<span class="hljs-literal"><span class="hljs-literal">null</span></span>? holes-free-cs)) ((print <span class="hljs-string"><span class="hljs-string">"   "</span></span>) nil) (make '((max-r max-c) rivers holes)) ) )</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Start function code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">;   -        ; (defn <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> (field <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> col) (match field <span class="hljs-string"><span class="hljs-string">'((max-r max-c) rivers holes)) ;  -         ; (defn show-field (cur-p) (def rows (map (lambda (r) map (lambda (c) cons rc) (list-from-to 1 max-c)) (list-from-to 1 max-r) )) (def h-divider (foldl ++ "+" (replicate max-c "+----"))) (def alphabet '</span></span>("" "A" "B" "C" "D" "E" "F" "G" "H" "I" "J")) (defn <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">row</span></span>) foldl (lambda (xa) ++ a (<span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-<span class="hljs-type"><span class="hljs-type">point</span></span> x) (cond (eq? x cur-p) "#" " ") "| ") "| " <span class="hljs-keyword"><span class="hljs-keyword">row</span></span>) (defn <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-<span class="hljs-type"><span class="hljs-type">point</span></span> (p) (def rr (<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">by</span></span>-p p rivers (lambda (oi ei) ++ (list-<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> oi alphabet) ei))) (def rh (<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">by</span></span>-p p holes (lambda (oi ei) ++ "." oi))) (cond (<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>? rr)) rr (<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>? rh)) rh " ") ) (defn <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">by</span></span>-p (p objects v) (defn go (li) (def ei (+ <span class="hljs-number"><span class="hljs-number">1</span></span> (elem-<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> p (car l)) )) (cond (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>? l) nil (&gt; ei <span class="hljs-number"><span class="hljs-number">0</span></span>) (vi ei) (go (cdr l) (+ <span class="hljs-number"><span class="hljs-number">1</span></span> i)) )) (go objects <span class="hljs-number"><span class="hljs-number">1</span></span>)) (foldl (lambda (xa) ++ a \n (<span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">row</span></span> x) \n h-divider) h-divider <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>) ) ;   ,      ; (defn elem-<span class="hljs-keyword"><span class="hljs-keyword">index</span></span> (el) (defn go (li) cond (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>? l) <span class="hljs-number"><span class="hljs-number">-1</span></span> (eq? e (car l)) i (go (cdr l) (+ <span class="hljs-number"><span class="hljs-number">1</span></span> i))) (go l <span class="hljs-number"><span class="hljs-number">0</span></span>)) (defn last (l) cond (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>? (cdr l)) (car l) (last (cdr l)) ) ;       ; (defn co-hole (p hole) (def a (car hole) b (cadr hole)) (cond (eq? pa) b (eq? pb) ap) ) ;     ; (defn <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> (p <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-flag <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span>) (def c (cond <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-flag (<span class="hljs-keyword"><span class="hljs-keyword">read</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-field p) \n <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span>) (<span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span>))) (cond (eq? c <span class="hljs-string"><span class="hljs-string">'a) (move p show-flag "" 0 -1) (eq? c '</span></span>d) (<span class="hljs-keyword"><span class="hljs-keyword">move</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-flag "" <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (eq? c <span class="hljs-string"><span class="hljs-string">'w) (move p show-flag "" -1 0) (eq? c '</span></span>s) (<span class="hljs-keyword"><span class="hljs-keyword">move</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-flag "" <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) (eq? c <span class="hljs-string"><span class="hljs-string">'show) (user-input p (not show-flag) "") (eq? c '</span></span>quit) " " (<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-flag " ") )) ;           ; (defn <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> (p-pred <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-flag dir dr dc) (def r (+ dr (car p-pred)) c (+ dc (cadr p-pred)) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>-field (<span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (&lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> r max-r) (&lt;= <span class="hljs-number"><span class="hljs-number">1</span></span> c max-c)) p (cons rc)) (def rr (<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">by</span></span>-p p rivers (lambda (oi river) cons (last river) ""))) (def rh (<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">by</span></span>-p p holes (lambda (oi hole) cons (co-hole p hole) (++ " " oi)))) (cond (<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>-field) (<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> p-pred <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-flag (++ dir " - ")) (<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>? rr)) (<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> (car rr) <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-flag (++ dir " - " (cadr rr))) (<span class="hljs-keyword"><span class="hljs-keyword">not</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>? rh)) (<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> (car rh) <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-flag (++ dir " - " (cadr rh))) (<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">input</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>-flag (++ dir " - ")) )) ;       (  ),    ; (defn <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">by</span></span>-p (p objects v) (defn go (li) cond (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>? l) nil (elem p (car l)) (vi (car l)) (go (cdr l) (+ <span class="hljs-number"><span class="hljs-number">1</span></span> i)) ) (go objects <span class="hljs-number"><span class="hljs-number">1</span></span>)) ;          ; (<span class="hljs-keyword"><span class="hljs-keyword">read</span></span> "adws - ///, show - / , quit - " \n " -   ") (<span class="hljs-keyword"><span class="hljs-keyword">move</span></span> (cons <span class="hljs-keyword"><span class="hljs-keyword">row</span></span> col) <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> "" <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) )</code> </pre> </div></div><br>  Threat This code does not claim protection from incorrect input, although it is not difficult to do.  Moreover, you can add an automatic control of the strict order of the moves of the participants, in the order of their joining the common field.  You can add everything that only fantasy tells!  But I wrote this code for example in a few hours, and did not over-complicate it with logic.  The only thing I wanted was to write in the most functional style, without mutable states and variables, deviating from pure <s>silky</s> OP only in 2 points I / O along the course of calculations and generating random numbers when creating the field - but we can assume that we live in IO monad, and there is no crime :) Although of course you could use the built-in mutable java-collections, ArrayList / Map / HashMap, etc., no one interferes.  But on this example, I want to bring a simple idea - that you yourself can change it or even write your own programs or your games, and run them online in chat rooms :) <br><br>  ZZY starting page of the application that launches bots: <a href="https://liscript.herokuapp.com/">liscript.herokuapp.com</a> <br><br>  All impressions, advice, opinions, suggestions, etc.  You can voice in any of the common home channels of bots in all messengers.  Well, except for IRC - there when the last online user leaves, the channel is deleted as such along with the entire message history. </div><p>Source: <a href="https://habr.com/ru/post/324166/">https://habr.com/ru/post/324166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324156/index.html">Cisco Smart Install. We study technology, we look for attack vectors</a></li>
<li><a href="../324158/index.html">Harmonic Linearization with Python Tools</a></li>
<li><a href="../324160/index.html">Parametric modeling in CAD SolveSpace: Introduction</a></li>
<li><a href="../324162/index.html">Direct charity: children - toys, adults - the right to drawings</a></li>
<li><a href="../324164/index.html">Using scripts in Openvpn to integrate it with other system services (Firewall, DB, etc.)</a></li>
<li><a href="../324170/index.html">Names or semantics of classes in programming</a></li>
<li><a href="../324172/index.html">Filtering and chaining in functional JavaScript</a></li>
<li><a href="../324174/index.html">What should we build an email marketing service? An inside look, part two</a></li>
<li><a href="../324176/index.html">Create a web application using VueJS and .NET</a></li>
<li><a href="../324178/index.html">Download trusted environment or easy way to paranoia in IT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>