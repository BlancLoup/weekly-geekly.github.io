<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Maniac Minimization (chasing the byte)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello World, 

 This topic is about how you can pre-code the code so as to improve its minimization. I recently minimized the library before the relea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Maniac Minimization (chasing the byte)</h1><div class="post__text post__text-html js-mediator-article">  Hello World, <br><br>  This topic is about how you can pre-code the code so as to improve its minimization.  I recently minimized the library before the release. <a href="http://home.gna.org/helios/kernel/"><img src="https://habrastorage.org/getpro/habr/post_images/b72/33e/0e7/b7233e0e75492a8b15cbe32937744f11.png"></a>  <a href="http://home.gna.org/helios/kernel/">Helios Kernel</a> (about which he <a href="http://habrahabr.ru/blogs/javascript/127557/">wrote the day before yesterday</a> ).  The library source code weighs 28112 bytes, it has generous comments, and therefore it is <a href="http://developer.yahoo.com/yui/compressor/">compressed</a> from the floor with a <a href="http://developer.yahoo.com/yui/compressor/">YUI compressor</a> to 7083 bytes.  Not that it seemed to me that 7 kilobytes is too fat.  But just by looking at the minimized code with my own eyes, I could see a bunch of places where I could save more: <br><br><img src="https://habrastorage.org/storage1/5cf39ecb/03766350/0a2bfd43/54dc7e17.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's see what can be done with the code to turn 7083 bytes into <s>4009</s> 3937. <br><a name="habracut"></a><br>  But before you begin, two reservations: <br><ul><li>  We will not use all sorts of dirty tricks (like <b>var a = this</b> or <b>var f = false</b> ) that theoretically lead to a slowdown.  It is assumed that the speed is still more important than the file size. </li><li>  At each step, I ran the code through a set of tests.  It often happens that after a change, everything stops working.  If you do not test the code during the manual optimization process (or if you don‚Äôt have any tests at all), then the code that will end up will most likely not work. <br><br><img src="https://habrastorage.org/storage1/019599d4/31f01097/321cf0e5/ac06a218.png"></li></ul><br><h4>  Minimizer selection </h4><br>  In general, this article is not about the comparison of minimizers, but in the process I noticed that the <a href="http://developer.yahoo.com/yui/compressor/">YUI compressor</a> has a <s>bug</s> feature: it does not remove the curly brackets from code blocks consisting of one line.  Moreover, it adds braces, even if they were not in the original (in the first picture it is marked with a <b>WTF</b> tag).  I took it as rudeness and, without hesitation, switched to using the online minimizer <a href="http://jscompress.com/">http://jscompress.com/</a> .  However, the rest of the reasoning applies to any minimizer of your choice. <br><br><h4>  Big Anonymous Function </h4><br>  To begin with, let's wrap all the code in a large anonymous function that will be immediately called (if this was not done initially).  Then we can use the local scope of this function.  How this will save bytes will be shown below.  The most compact way to wrap code in an anonymous function is as follows: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// </span></span></code> </pre> </td><td><pre> <code class="javascript hljs">!<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  }()</span></span></code> </pre></td></tr></tbody></table><br><h4>  "Private" objects </h4><br>  Surely the code has a large number of auxiliary objects that are not included in the public API.  Since there is no native way in Javascript to indicate that an object is private, usually some kind of convention is used.  Most often such objects are named starting with an underscore: " <b>_</b> ".  Usually the minimizer replaces the names of local variables with single-letter ones, but leaves the names of ‚Äúprivate‚Äù objects unchanged, because it does not make bold assumptions about how we designate ‚Äúprivate‚Äù objects.  But it doesn‚Äôt matter to us how these objects will be called in the minimized code, so you can rename them manually: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre> <code class="javascript hljs">myObject._somethingPrivate = { <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td><td><pre> <code class="javascript hljs">myObject.a = { <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td></tr><tr><td><pre> <code class="javascript hljs">MyObj = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.somePublicProperty = ...; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._somePrivateProperty = ...; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._anotherPrivateProperty = ...; }</code> </pre></td><td><pre> <code class="javascript hljs">MyObj = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.somePublicProperty = ...; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a = ...; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.b = ...; }</code> </pre></td></tr><tr><td><pre> <code class="javascript hljs">MyObj.prototype._privateMethod = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td><td><pre> <code class="javascript hljs">MyObj.prototype.c = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td></tr></tbody></table><br>  Here you need to be careful.  First, do not forget to replace the names of private functions and variables not only in declarations, but also where they are used.  Secondly, you need to keep track of the logic of the code, and avoid intersections of names.  For example, if a type has a function <b>a</b> already declared in the prototype, you cannot call the private property of this object by the same name.  This is an obvious thing, but it is easy to miss it if you do not pay special attention to it. <br><br>  In addition, private objects are often declared not only in all constructors / initializers.  Javascript allows you to add objects on the fly.  In theory, all private identifiers in the code can be carefully replaced with single-letter ones: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre> <code class="javascript hljs">MyObj.prototype.getSomething = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._prop == <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._prop = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._prop; }</code> </pre></td><td><pre> <code class="javascript hljs">MyObj.prototype.getSomething = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x == <span class="hljs-string"><span class="hljs-string">"undefined"</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x; }</code> </pre></td></tr></tbody></table><br><h4>  "Public" objects </h4><br>  ‚ÄúPublic‚Äù objects are those that are part of the API, and we need them to be called exactly as they were originally called.  But if a ‚Äúpublic‚Äù object is used too often inside the code (well, let's say, at least once), and its name is too long (well, let's say, more than two bytes), then it makes sense to give it an alias: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre> <code class="javascript hljs">myObject = { ... }</code> </pre></td><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = myObject = { ... }</code> </pre></td></tr></tbody></table><br>  In this example, after such a change, the variable <b>a</b> will be declared as local, and the variable <b>myObject</b> as global (assuming that the identifier <b>myObject is</b> used for the first time. <br><br>  Now you can run through the code, find all the objects that are not only declared, but also used, and make it an alias: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre> <code class="javascript hljs">MyObj = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.somePublicProperty = ...; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a = ...; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.b = ...; }</code> </pre></td><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = MyObj = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.somePublicProperty = ...; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a = ...; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.b = ...; }</code> </pre></td></tr><tr><td><pre> <code class="javascript hljs">MyObj.prototype.someMethod = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td><td><pre> <code class="javascript hljs">b.prototype.d = b.prototype.someMethod = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td></tr><tr><td><pre> <code class="javascript hljs">someStorage.someMethod = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = someStorage.someMethod = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td></tr></tbody></table><br>  And again, the main thing is not to get confused in scopes and not to name variables from the same scope with the same name.  In the examples above, an object of type <b>MyObj</b> already has a private property <b>b</b> and a private method <b>c</b> , and the new local variables <b>b</b> and <b>c</b> fall into the scope of the Big Anonymous Function, into which we wrapped all the code at the very beginning (we wrapped it, didn't we? ?) <br><br>  In addition, we can make aliases to some public properties, but only to those that contain complex objects: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre> <code class="javascript hljs">AnotherObj = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.someProperty = [ <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ]; <span class="hljs-comment"><span class="hljs-comment">//  this.secondProperty = { a: 1 }; //  this.thirdProperty = 0; //  this.fourthProperty = true; // - this.fifthProperty = "hello"; //  }</span></span></code> </pre></td><td><pre> <code class="javascript hljs">AnotherObj = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.someProperty = [ <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.b = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.secondProperty = { <span class="hljs-attr"><span class="hljs-attr">a</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.thirdProperty = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fourthProperty = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fifthProperty = <span class="hljs-string"><span class="hljs-string">"hello"</span></span>; }</code> </pre></td></tr></tbody></table><br>  If we make aliases for simple objects, it will copy the contents, and the alias will point to another object. <br><br><h4>  Putting <b>var</b> 's </h4><br>  Now we use the fact that you can declare variables separated by commas, using the word <b>var</b> once.  In the simplest case, it looks like this: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre> <code class="javascript hljs">someFunction = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = something(); <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td><td><pre> <code class="javascript hljs">someFunction = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>, b = something(); <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td></tr><tr><td><pre> <code class="javascript hljs">anotherFunction = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c; <span class="hljs-comment"><span class="hljs-comment">// -  var d = something(); //  -  for ( var i = 0; i &lt; ... //   -  }</span></span></code> </pre></td><td><pre> <code class="javascript hljs">anotherFunction = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c, d = something(), i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">// -  //  -  for ( ; i &lt; ... //   -  }</span></span></code> </pre></td></tr></tbody></table><br>  In general, you need to pull out all the declarations to the beginning of the function and write them using one <b>var</b> .  I will write about optimization of the <b>for ()</b> loop below.  And still it is necessary to collect all local announcements inside our Large Hadron Function and also to shove them under one <b>var</b> at the beginning.  These are the aliases we created in the previous section.  All code should transform like this: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre> <code class="javascript hljs">!<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// -  var b = MyObj = function() { this.somePublicProperty = ...; this.a = ...; this.b = ...; } //  -  var c = b.prototype.someMethod = function() { // ... } //   -  }()</span></span></code> </pre></td><td><pre> <code class="javascript hljs">!<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = MyObj = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.somePublicProperty = ...; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.a = ...; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.b = ...; }, c = b.prototype.someMethod = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }, //      // -  //  -  //   -  }()</span></span></code> </pre></td></tr></tbody></table><br>  Note that in this example, the variables <b>b</b> , <b>c</b> and the like remain declared as local to the Big Function.  Thus, we will save as many <b>vars</b> as there were in the function (well, except for one). <br><br>  And you need to make sure that the code logic does not change.  We after all change the order of lines, therefore theoretically it can happen so that some object will be used before it is initialized, this cannot be allowed. <br><br><h4>  Prototypes </h4><br>  For each declared type and its constructor, it is possible to save a <b>lot</b> on the word <b>protoype</b> - it is too long.  To do this, we describe the entire prototype for future objects of this type in the form of a single hash: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre> <code class="javascript hljs">MyObj = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... } MyObj.prototype.someMethod = function() { // ... } MyObj.prototype.anotherMethod = function() { // ... } MyObj.prototype.thirdMethod = function() { // ... }</span></span></code> </pre></td><td><pre> <code class="javascript hljs">MyObj = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... } MyObj.prototype = { someMethod : function() { // ... }, anotherMethod : function() { // ... }, thirdMethod : function() { // ... } }</span></span></code> </pre></td></tr></tbody></table><br>  As you can see, for this you need to remember to replace the " <b>=</b> " with " <b>:</b> " and separate the method declarations with commas.  This method does not work for the case when you need to add some prototype for a type constructor declared somewhere else (because we completely redefine the prototype with such a record). <br><br><h4>  Cycle and condition optimization </h4><br>  Almost all cycles and many conditions can be optimized: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre> <code class="javascript hljs">a--; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( a == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( --a == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( --a == <span class="hljs-number"><span class="hljs-number">0</span></span> ) { <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !--a ) { <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre></td></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; a; i++ ) { b( c[ i ] ); }</code> </pre></td><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; a; ) { b( c[ i++ ] ); }</code> </pre></td></tr></tbody></table><br>  But here, too, you need to be careful not to violate the logic of the code. <br><br><h4>  Commonly used values </h4><br>  It happens that there are values ‚Äã‚Äãthat are used more than once.  They can also be put into variables: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ... if ( typeof a == "undefined" ) ... // ... if ( typeof b == "undefined" ) ... // ...</span></span></code> </pre></td><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> z = <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... if ( typeof a == z ) ... // ... if ( typeof b == z ) ... // ...</span></span></code> </pre></td></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> a != <span class="hljs-string"><span class="hljs-string">"function"</span></span> ) { a = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{} } <span class="hljs-comment"><span class="hljs-comment">// ... if ( typeof b != "function" ) { b = function(){} }</span></span></code> </pre></td><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f = <span class="hljs-string"><span class="hljs-string">"function"</span></span>, g = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{} <span class="hljs-comment"><span class="hljs-comment">// ... if ( typeof a != f ) { a = g; } // ... if ( typeof b != f ) { b = g; }</span></span></code> </pre></td></tr><tr><td><pre> <code class="javascript hljs">el = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement( <span class="hljs-string"><span class="hljs-string">"script"</span></span> ); el.type = <span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>;</code> </pre></td><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-string"><span class="hljs-string">"script"</span></span>; el = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement( x ); el.type = <span class="hljs-string"><span class="hljs-string">"text/java"</span></span> + x;</code> </pre></td></tr></tbody></table><br><br><h4>  Throw away all unnecessary </h4><br>  It often happens that the code contains extra information ‚Äúfor clarity‚Äù, which can be eliminated.  But here, as elsewhere, you need to carefully monitor what we delete: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( a.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { b = a.pop() }</code> </pre></td><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( a.length ) { b = a.pop() }</code> </pre></td></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someEnum = { <span class="hljs-attr"><span class="hljs-attr">foo</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">bar</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">buz</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span> } <span class="hljs-comment"><span class="hljs-comment">// ... var a = []; for ( var i in someEnum ) { a[ someEnum[ i ] ] = 0; } // ... a[ someEnum.bar ] = getSomething(); // ... if ( c.state == someEnum.foo ) { // ... }</span></span></code> </pre></td><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someEnum = { <span class="hljs-attr"><span class="hljs-attr">foo</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">bar</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">buz</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span> } <span class="hljs-comment"><span class="hljs-comment">// ... var a = [ 0, 0, 0 ]; // ... a[ 1 ] = getSomething(); // ... if ( !c.state ) { // ... }</span></span></code> </pre></td></tr></tbody></table><br><h4>  Bonus: remove <b>var</b> 's </h4><br>  This is an interesting trick that is useful in cases where one local variable is declared inside a function (or if the variable is declared without initialization).  Here we save on one <b>var</b> 'e, but we have to duplicate the name of a variable: <br><table><tbody><tr><th>  It was </th><th>  has become </th></tr><tr><td><pre> <code class="javascript hljs">doSomething = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> param1, param2 </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// .... }</span></span></code> </pre></td><td><pre> <code class="javascript hljs">doSomething = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> param1, param2, i </span></span></span><span class="hljs-function">) </span></span>{ i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// .... }</span></span></code> </pre></td></tr><tr><td><pre> <code class="javascript hljs">doSomething = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> param1, param2 </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a, b, c; <span class="hljs-comment"><span class="hljs-comment">// .... }</span></span></code> </pre></td><td><pre> <code class="javascript hljs">doSomething = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> param1, param2, a, b, c </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// .... }</span></span></code> </pre></td></tr></tbody></table><br>  Here we use parameters instead of local variables, but they behave the same way.  This trick is not suitable in cases where the function takes an unknown number of parameters.  Most often, it allows to get rid of almost all <b>var</b> 's in the code. <br><br><h4>  What happened in the end </h4><br>  After processing the code in the ways described, I fed the script to the <a href="http://jscompress.com/">jscompress.com</a> service.  A little thought, he gave me just such a porridge for 4009 bytes.  Enjoy your meal! <br><br><img src="https://habrastorage.org/storage1/a80a645d/3eb11ada/c56a9687/17dd796a.png"><br><br>  By the way, I will distribute the advantages in karma to those who find and describe in the comments what else can be cut in this mess :-) <br><br><h6>  Update </h6><br>  <a href="http://habrahabr.ru/users/nano_freelancer/" class="user_link">nano_freelancer</a> suggested some good ideas: <ul><li>  replace all <b>true</b> and <b>false</b> with <b>1</b> and <b>0</b> respectively </li><li><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (initial;condition;loop statement) {statements}</code> </pre>  you can put a comma after the loop statement and place all statements from statements separated by commas (instead of a semicolon) - save 2 bytes (braces).  But this is only applicable when the <b>statement</b> itself does not contain complex statements. <br></li></ul><br>  In addition, most <b>nulls</b> can also be replaced by 0 (but not all). <br><br>  Code size reduced to 3937 bytes :-) <br><br>  Offtopic: the source and minimized codes with which I worked are available for download on the project‚Äôs home page: <a href="http://home.gna.org/helios/kernel/">http://home.gna.org/helios/kernel/</a> </div><p>Source: <a href="https://habr.com/ru/post/127672/">https://habr.com/ru/post/127672/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127663/index.html">What prevents to hold large-scale conferences?</a></li>
<li><a href="../127665/index.html">Button Google +1 became visible and "mobile" users</a></li>
<li><a href="../127666/index.html">Samsung removed the Galaxy Tab 7.7 from its booth at IFA 2011, possibly due to a dispute with Apple</a></li>
<li><a href="../127668/index.html">KDE 4.7 for Windows released</a></li>
<li><a href="../127669/index.html">Learning to program XNA games for Windows Phone 7 "Mango" - the beginning</a></li>
<li><a href="../127675/index.html">ŒºTorrent is able to complete the distribution of the file when the specified volume is distributed. How did you adjust this volume?</a></li>
<li><a href="../127676/index.html">Google Chrome Extension - Tabs Cart</a></li>
<li><a href="../127677/index.html">Convert lib.ru library to epub format using Java tools.</a></li>
<li><a href="../127678/index.html">IFA 2011, day 4: Sony 3D Viewer, NEX-7, PS Vita and Toshiba Z830</a></li>
<li><a href="../127681/index.html">Stereo image is just</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>