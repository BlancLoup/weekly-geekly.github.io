<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Detecting Fuzzy Duplicates for Short Documents</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to share a simple but effective algorithm for determining fuzzy copies of documents. There are many articles on the use of the shingle algorith...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Detecting Fuzzy Duplicates for Short Documents</h1><div class="post__text post__text-html js-mediator-article">  I want to share a simple but effective algorithm for determining fuzzy copies of documents.  There are many articles on the use of <a href="http://www.codeisart.ru/python-shingles-algorithm/">the shingle algorithm</a> for this purpose.  It is rumored that large search engines use a very similar algorithm for themselves.  However, everyone acknowledges that shingles are poorly suited for short (3-5 sentences) documents.  And in my task I had to work with such documents.  As a solution, they suggest looping the text in order to make it a long one, but it seems to me that this is not a very correct decision, the accuracy of duplicate recognition will still be low. <br><br>  So, the description of the algorithm that I used: <br><a name="habracut"></a><br><h4>  First you need to index the collection of texts. </h4><br><ol><li>  Let's transform each collection text into an array of words from this text, after cutting out html-tags, numbers and other unnecessary information. <br></li><li>  We will select the 15 longest words, and those that are shorter than 4 characters are not taken anyway, even if the text itself is shorter than 15 words. <br></li><li>  For each selected word, we calculate the checksum, for example crc32, and write the sums to the database in the format: ‚Äúid amount‚Äù, ‚Äúdocument id‚Äù, ‚Äúamount‚Äù. <br></li><li>  In another table, we write down some characteristics of the text itself: "md5" and "number of words that fell into the table with checksums".  The second field is needed for those texts for which 15 words of the appropriate length could not be found, conventionally it is the length of the document in words. <br></li></ol><br><br>  I use tables with the following structure: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>CREATE TABLE `items_hashes` ( <br> `id` int(11) NOT NULL auto_increment, <br> `doc_id` int(11) NOT NULL, <br> `word_hash` int(11) NOT NULL, <br> PRIMARY KEY (`id`) <br> ); <br> <br> CREATE TABLE `items_hashes_summary` ( <br> `doc_id` int(11) NOT NULL, <br> `full_hash` char(32) NOT NULL, <br> `length` smallint(11) NOT NULL, <br> PRIMARY KEY (`doc_id`) <br> ); <br></code> <br><h4>  Uniqueness text checking </h4><br>  After all documents are indexed, we can check any text for uniqueness within our collection.  For this you need: <br><ol><li>  Check for a complete match with any document from the collection using the data in the items_hashes_summary table.  If such a coincidence is found, then the following steps have no meaning, otherwise we go further. <br></li><li>  For the text to be checked perform the first three steps from the previous list, but for the time being do not write the checksums into the database <br></li><li>  Find documents in the database that contain words that match the document being analyzed and the number of these matches.  You can do this with this query: <br><br> <code>SELECT doc_id, COUNT(id) as intersects FROM items_hashes <br> WHERE (word_hash = %cur_doc_hash1% OR word_hash = %cur_doc_hash2% OR ... ) <br> GROUP BY doc_id <br> HAVING intersects &gt; 1 <br></code> <br>  (on large collections you should write, for example, HAVING intersects&gt; 5 or even more, because otherwise further processing can be slow) <br></li><li>  Now we find the ‚Äúdegree of similarity‚Äù in percentage with each of the found documents, which is calculated by the formula: <br><br>  $ similarity = ($ intersecs / $ length) * 100, <br><br>  where $ length is the shortest of the compared documents; <br>  $ intersecs - the number of matching words. <br><br>  I believe that a document is not unique if its ‚Äúdegree of similarity‚Äù with any document of the collection is more than 80%, it may be necessary to select a different value for your tasks. <br></li></ol><br><br>  If you have a task to find pairs of similar texts already inside the indexed collection, this can also be done; you just need to modify the query in the penultimate step so that the intersection of the document with yourself is not searched. <br><br>  It all works pretty fast.  In any case, there are no problems on the collection of 12 thousand documents and a very weak VPS.  I also tested 70 thousand documents in a virtual machine, everything was very fast too. <br><br>  Feel like it really works <a href="http://www.terdo.ru/">here</a> .  You can take any ad, change something and try to add as new.  It should immediately say that a very similar one already exists in the database.  Only if suddenly you change the ad too much and it will be added, then do not forget to delete it then please;) <br><br>  Users still manage to publish the same content ads, but for this they have to rewrite almost all in other words.  False positives have not yet been noticed. <br><br><h4>  PHP implementation </h4><br>  To make it clearer, I tore out two classes from the project that implement this algorithm and put it on pastebin.com: a <a href="http://pastebin.com/f34ba590d">class, to get a hash of a document</a> (universal and ready to use in any project) and <a href="http://pastebin.com/f68bfa0ce">a model class</a> (not quite ready for use in any project, but I think it will not be difficult to modify). <br><br>  PS This is my first topic on Habr√©, so do not hurt if something is wrong. <br><br>  <b>UPD:</b> Thank you all for your karma, now I can move it to the ‚ÄúDevelopment‚Äù blog. </div><p>Source: <a href="https://habr.com/ru/post/52120/">https://habr.com/ru/post/52120/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../52114/index.html">There is an idea and a prototype - feedback is needed.</a></li>
<li><a href="../52116/index.html">/ 3GB / Userva = 2900</a></li>
<li><a href="../52117/index.html">Working quality</a></li>
<li><a href="../52118/index.html">Advise shared hosting with MySQL 5.1</a></li>
<li><a href="../52119/index.html">Program for graduate students</a></li>
<li><a href="../52121/index.html">Google Maps. Small optimization</a></li>
<li><a href="../52127/index.html">Mini-wrapper for Java applications under * nix</a></li>
<li><a href="../52129/index.html">A simple slideshow on jQuery.</a></li>
<li><a href="../52132/index.html">Secure code in Drupal: Cross-site request forgery</a></li>
<li><a href="../52133/index.html">Parking</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>