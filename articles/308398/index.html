<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we wrote a chat for the application of the bank "Opening"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We have built a chat for customer support into the Otkrytie Bank application , and this has become perhaps one of the largest and most complex stories...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we wrote a chat for the application of the bank "Opening"</h1><div class="post__text post__text-html js-mediator-article">  We have built a chat for customer support into the <a href="https://habrahabr.ru/company/redmadrobot/blog/306116/">Otkrytie Bank application</a> , and this has become perhaps one of the largest and most complex stories within the framework of a large-scale update.  Making a chat that meets the requirements of the bank in terms of functionality and information protection turned out to be not a trivial task at all. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/72b/6e8/74f/72b6e874f2f0465f8b8fd3861824ebaa.png"></div><br><a name="habracut"></a><br><h1>  <font color="red">Why can chat</font> </h1><br>  Fortunately, many issues with the bank can be solved remotely, for example, by calling the call center or writing a letter.  But the apogee of distance is a chat with a support service operator: in online correspondence, the client quickly, confidentially (no one will overhear the conversation) and even sometimes fun (the operators in the chat are joking!) Manage their finances.  Over the past couple of years, mobile messengers have become a familiar way of communication, and for modern banking services, chat is an absolute must have. <br><br><img src="https://habrastorage.org/files/e47/476/ae9/e47476ae9ed94bb4b35da94a0ce13a81.jpg" alt="image" align="left">  <b>Alexey Kruglov, senior vice president and director of digital products at Otkritie Bank</b> <br>  <i>‚ÄúChat for any modern service is a transformation of the approach to communication with the client.</i>  <i>People moved to instant messengers, they live there.</i>  <i>And each time, forcing them to get out of this world to call the call center or write an email, we strain them.</i>  <i>By investing in chat development now, we hope to get a long-term effect - not so much a reduction in the cost of other communication channels with customers, but a reduction in the outflow of customers from the bank in principle, as well as an influx of new customers who are impressed by the service, striving to be as convenient as possible. ‚Äù</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And, of course, chat is also a valuable feedback channel. <br><br><img src="https://habrastorage.org/files/c8c/240/993/c8c240993ff94601b878b1ef43a6b341.jpg" alt="image" align="left">  <b>Anastasia Grafskaya, Project Manager, ‚ÄúDiscovery Digital‚Äù</b> <br>  <i>‚ÄúMostly they write to the chat on two occasions: either with a request for service (financial and informational issues), or with some kind of complaint.</i>  <i>In our case, the chat played a very important role in collecting feedback on the recent redesign of the application.</i>  <i>People write about what they like or don‚Äôt like, ask when this or that function will be added.</i>  <i>Chat is a completely new application functionality.</i>  <i>He made us stand up and learn to walk on his hands.</i>  <i>In addition to introducing chat into the application itself, it took a lot of time and effort to deploy it in the bank infrastructure.</i>  <i>Many moments had to be coordinated with the security service for a long time, colleagues from the claim department also did a tremendous job: it was necessary to hire and train new employees and teach them to communicate with customers in a living language. ‚Äù</i> <br><br><h1>  <font color="red">Preprepilot</font> </h1><br>  The idea that you need a chat in the Discovery mobile app originated in a bank about a year ago.  Then, long before the start of development and the emergence of the design concept, the Discovery Digital team decided to conduct an experiment, a kind of ‚Äúpredpedilot‚Äù.  Professionals who in the future had to communicate with customers via chat, it was necessary to convey the features of this communication channel, in which operators are living people who respond with a living language and not extracts from charters, rules and regulations. <br><br><img src="https://habrastorage.org/files/3f8/8a3/779/3f88a3779cb142ae89d9baac134bee8c.jpg" alt="image" align="left">  <b>Kirill Kurashev, Project Administrator, ‚ÄúDiscovery Digital‚Äù</b> <br>  <i>‚ÄúI bought a sim card, registered an account with Telegram and created a group chat for a digital team and a support service there.</i>  <i>When the free moment was given out, we with the whole team ‚ÄúDiscovery Digital‚Äù sent requests to this general chat.</i>  <i>The operators answered, and then we mailed or by phone (the Otkrytie support service is based in Saratov) together with them analyzed the answers.</i>  <i>Initially, there were super-detailed parsing letters, then just small comments.</i>  <i>Then we set the standard for communicating with customers in the chat. ‚Äù</i> <br><br>  Then there were personal meetings, trainings and a special guide appeared in which recommendations for support service operators were collected - how to contact and greet, which words to use and which are not, whether emoji is relevant depending on the age of the client, as well as other factors. <br><br><h1>  <font color="red">Difference from the usual messenger</font> </h1><br>  From the user's point of view, the chat in the bank‚Äôs mobile application is no different from the usual messenger.  It also allows you to send text, links, photos and location.  If for some reason the chat is unavailable, the user can still contact the bank through one of the usual channels: by mail or phone. <br><br><img src="https://habrastorage.org/files/9f6/53f/668/9f653f668f974e7488d2002386fe864a.png"><br><br>  Chat is available only in the authorized zone of the application, and this allows support specialists to immediately identify the client and get all the information necessary for working with his request (as well as to choose the style of communication).  The user is free from the need to go through an additional identification procedure. <br><br>  For operators, the chat looks like the HelpDesk system they are used to: with tickets, routing tools, analysis and access statistics. <br><br><img src="https://habrastorage.org/files/d48/4bd/441/d484bd4417e943a2930c032cc3aa22ff.png"><br><br>  At the moment, support specialists are playing in two roles: <br><br><ul><li>  <i>Operators</i> are those who directly correspond with users, solve their problems and close their tickets. </li><li>  <i>Administrators</i> are essentially controllers of the work of operators who monitor the speed and quality of work. </li></ul><br>  Each new client request creates a ticket in the system, which is automatically assigned to one of the free operators.  The operator receives a notification in the browser and responds to the user.  When the issue is resolved, the operator says goodbye to the user and closes the ticket. <br><br><img src="https://habrastorage.org/files/4f3/f29/18b/4f3f2918b33a4bacaf33da3501d3b675.png"><br><br><img src="https://habrastorage.org/files/068/a8c/f3d/068a8cf3d46a44ee918a325a7cd21a7b.jpg" alt="image" align="left">  <b>Yulia Belonogova, Head of Claims Management, Otkritie Bank</b> <br>  <i>‚ÄúIn total for the month, the bank receives 17-18 thousand calls from all channels: telephone, email, social networks, chat.</i>  <i>Through social networks comes about 200 hits.</i>  <i>Our chat started working on July 6, and in the first 24 hours over one and a half thousand questions were asked through it, that's a lot.</i>  <i>We started in the afternoon and did not expect such a response.</i>  <i>On the first night, all the operators were busy supporting the customers diligently.</i>  <i>Now we have six operators, and they process about 150 tickets every day.</i>  <i>A ticket is not a single request, but a dialogue, which can contain from one to 20-30 client questions.</i>  <i>A ticket is closed when a customer says that he has no more questions. ‚Äù</i> <br><br>  To answer the first call through the chat, the operator is given one minute.  During this time, the client should be made to understand that he is not alone, and the bank has already begun to delve into the essence of the issue and raise information.  Time to resolve the issue varies depending on its essence.  If this is a standard information request - for example, how interest is charged on a card or when you need to make a minimum payment, the response rate, as a rule, does not exceed three minutes.  If we are talking about financial reimbursement, it can take from 20 minutes to a day. <br><br>  The administrator can perform as a manager with the ability to view and upload all dialogs and statistics, as well as the operator, responding to the tickets forwarded to him.  Also, the administrator can create new operators and suspend access to existing ones. <br><br><img src="https://habrastorage.org/files/dde/71f/395/dde71f3959a745619795235e722d93c3.png"><br><br>  Statistics collected on the server include: <br><br><ul><li>  number of tickets processed and open </li><li>  first response time </li><li>  call processing time </li></ul><br>  All this makes it possible to assess the effectiveness of the work of both the individual operator and the team as a whole.  The schedule of distribution of calls on the hours and days of the week allows administrators to better plan the work of the department. <br><br><h1>  <font color="red">Ready solution VS custom development</font> </h1><br>  The market for instant messaging is now boiling and seemingly finding the right component and integrating it into your product is easy.  But when you need to build a customer support channel based on the chat, you have to take into account many nuances, including: <br><br>  For security reasons, the solution should be deployed in the internal IT infrastructure of the bank.  The chat should be able to integrate with the bank's systems in order to obtain information about customers, view the history of their operations, include tickets in the general circuit to measure the effectiveness of the entire support service.  Metrics and reporting must comply with HelpDesk-based corporate standards. <br><br>  We <a href="https://drive.google.com/file/d/0B4dZTVKoxwkiRmM5LVBpZEVfaTQ/view">analyzed the</a> open source products available on the market, and for various reasons, none of them came up to us.  Either they did not pass on the security criteria, or did not arrange the implementation language, or a large number of improvements to the code were required, since the existing solutions are more focused on the functionality of ordinary instant messengers - client correspondence with the client.  It is necessary to make a reservation that this analysis was carried out exactly a year ago, and during this time the functionality of some solutions could undergo changes.  As a result, they decided to write a chat on their own. <br><br>  We didn‚Äôt bind to existing message passing protocols, such as XMPP or WAMP, due to their bulkiness, redundancy and high complexity.  Most third-party solutions are overloaded with unnecessary details for all occasions, we would have to support all this and still explain to the security service why the extra parameters are transmitted.  The quality of libraries under all the languages ‚Äã‚Äãwe need was also in question.  Therefore, we implemented chat via WebSocket on our own JSON specification. <br><br><h1>  <font color="red">Implementing and deploying a chat</font> </h1><br>  Chat consists of three blocks: <br><br><ul><li>  Directly the server where all logic works and messages are routed. </li><li>  The client part is an SDK embedded in mobile applications (iOS and Android) and on the site. </li><li>  Workplaces of support operators and administrators - web panels for conducting correspondence with clients and viewing and uploading message statistics. </li></ul><br><img src="https://habrastorage.org/files/e4c/f2e/6c1/e4cf2e6c1caa4156934a032f42814e14.png"><br><img src="https://habrastorage.org/files/800/645/443/800645443d9e4a3594e3aaa37e109bf8.jpg" alt="image" align="left">  <b>Vladimir Vyalov, backend developer, Redmadrobot</b> <br>  <i>‚ÄúThe need to write our own asynchronous chat server set this project apart from others.</i>  <i>At the very beginning it was necessary to choose a framework: the main choice was between nodejs, asyncio and Tornado.</i>  <i>Asyncio is only available with Python 3.4, but we already used the latest generation language in production in other projects, so we chose it.</i>  <i>It was necessary to implement asynchronous interaction with PostgreSQL, Redis, RabbitMQ, transfer of messages through web sockets and cover asynchronous code with tests.</i>  <i>As a result, the experience with asyncio was successful, and I will again select it for the following projects. ‚Äù</i> <br><br>  For the first month and a half, all components of the system were developed in parallel and were not interconnected.  Managers nervously walked through the corridors in anticipation of the start of integration :) Finally this moment came, and after a few filings, the chat started working!  Initially, the opportunity to write to each other, and we were able to connect the QA department.  However, it was hardly possible to call the system in that version of it stable ‚Äî messages were lost, connections were torn, the server was falling.  It took us some time to stabilize the system and find the causes of the problems.  Between the browser and the server, I had to ping / pong to determine the connection status, for several iterations I fixed bugs in the RabbitMQ / chat server bundle and learned how to deal with duplicate messages on mobile devices.  But at the initial stage, we missed some of the bugs, because they only make themselves known when hundreds of people start writing to the operators at the same time, and it‚Äôs difficult to fully emulate such activity on the test environment. <br><br>  Expanding the chat was not easy, because the bank has many security requirements and its own view on the organization of the backend. <br><br><img src="https://habrastorage.org/files/c17/0a4/0ab/c170a40abe2e417cafec701c10d0fb6e.png" alt="image" align="left">  <b>Arthur Sakharov ( <a href="https://habrahabr.ru/users/mc_murphy/" class="user_link">mc_murphy</a> ), CTO, Redmadrobot</b> <br>  <i>‚ÄúOf course, not all of our technology stack is used in the bank.</i>  <i>We usually write in Python, take the Postgres database, connect the RabbitMQ queues, keep the cache on Redis, raise the Docker containers on Linux ‚Äî for the bank, this whole environment is considered untrusted by default.</i>  <i>They got used to MS SQL everywhere, applications are written in .Net or in Java, and a lot of things are deployed on Windows Server.</i>  <i>For this stack, all the necessary procedures have been worked out, analyzers are set up, the bank's specialists are able to independently support and deploy them.</i> <i><br></i>  <i>As a result, we found a compromise with the security service, replaced a small part of our standard components, and for most solutions (for example, we left Python and Postgres) did not fit into the current bank stack, but in future plans for updating the IT infrastructure.</i>  <i>It turned out that this project also became a training ground for the Security Council, architects and support, at which they lifted the necessary procedures.</i>  <i>Thanks to the dedicated team and the help of Discovery Digital, we managed to do this as soon as possible. ‚Äù</i> <br><br><h1>  <font color="red">How it works</font> </h1><br>  Recently, through the chat, the client wrote.  He was in Georgia and could not get money from an ATM due to exceeding the cash withdrawal limit, which is set for security purposes.  ‚ÄúUnderstand‚Äù - says - ‚ÄúI have five days left to be here, but I cannot withdraw money, I have nothing to buy a return ticket for, and the money on the phone has run out‚Äù.  It was technically impossible to increase the limit, so the operator had to be smart: <br><br><img src="https://habrastorage.org/files/761/ff5/38f/761ff538fdb2488d863b09e41dd042b9.jpg"><br><br>  Everyone in the bank understands that communication through chat should be simple and humane, but punctures happen :) One of the clients asked a question via chat and received an excerpt from banking conditions instead of a friendly answer.  The client was surprised, scored a correspondence and sent to Twitter.  In parallel, he asked the question: ‚ÄúHow can you close the account with your bank?‚Äù.  In response to this, he was sent full detailed instructions on how to do this.  It was epic fail. <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: absolute; visibility: hidden; display: block; transform: rotate(0deg); width: 500px; margin: 10px auto; max-width: 100%; min-width: 220px;" data-tweet-id="758606301509328896"></twitter-widget><blockquote class="twitter-tweet" align="center" data-twitter-extracted-i1553003152013678286="true"><p lang="ru" dir="ltr">  <a href="https://twitter.com/otkritie">@otkritie</a> don't care about customers, respond with prepared text with quotes from the agreement. <a href="https://twitter.com/rocketbank">Returned</a> to the favorite <a href="https://twitter.com/rocketbank">@rocketbank</a> <a href="https://t.co/pIg9JFbnYf">pic.twitter.com/pIg9JFbnYf</a> </p>  - Oleg Pirogov (@pirogovoe) <a href="https://twitter.com/pirogovoe/status/758606301509328896">July 28, 2016</a> </blockquote><script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-1" style="position: absolute; visibility: hidden; display: block; transform: rotate(0deg); width: 500px; margin: 10px auto; max-width: 100%; min-width: 220px;" data-tweet-id="758629560997048320"></twitter-widget><blockquote class="twitter-tweet" align="center" data-twitter-extracted-i1553003152013678286="true"><p lang="ru" dir="ltr">  <a href="https://twitter.com/pirogovoe">@pirogovoe</a> sorry, we are just learning to talk to Lyudmila so that the mistakes do not recur. </p>  - Otkritie Bank (@otkritie) <a href="https://twitter.com/otkritie/status/758629560997048320">July 28, 2016</a> </blockquote><script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div><br>  The problem of the client, who was rightly angry with Ctrl C + Ctrl V, of course, was solved.  And for the bank, this case became the reference case for how to learn from their mistakes. <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-2" style="position: absolute; visibility: hidden; display: block; transform: rotate(0deg); width: 500px; margin: 10px auto; max-width: 100%; min-width: 220px;" data-tweet-id="760815728916324352"></twitter-widget><blockquote class="twitter-tweet" align="center" data-twitter-extracted-i1553003152013678286="true"><p lang="ru" dir="ltr">  <a href="https://twitter.com/otkritie">@otkritie</a> corrected, returned the money and even invited to visit.  Good and good team.  <a href="https://t.co/ZqqOOaQYMP">pic.twitter.com/ZqqOOaQYMP</a> </p>  - Oleg Pirogov (@pirogovoe) <a href="https://twitter.com/pirogovoe/status/760815728916324352">August 3, 2016</a> </blockquote><script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><h1>  <font color="red">Results and plans</font> </h1><br>  Some of the plans for the future: <br><br><ul><li>  Running chat on Android and in the login area (in limited mode); </li><li>  Automate answers using a bot; </li><li>  Analytical Dashboard Administrator, which allows real-time tracking of the load of a particular operator, and the entire department, as well as the speed of processing requests; </li><li>  Integration with various backends on the customer side.  First of all - with banking CRM; </li><li>  Adding a second level of support: new support specialist roles and ticket routing scenarios (tickets will be distributed after evaluating their complexity and will start flying even faster); </li><li>  Connecting IP-telephony: call routing is similar to phone calls. </li></ul><br>  In the meantime, the bank continues to experiment with a new communication channel and sometimes it is <a href="http://www.sravni.ru/novost/2016/8/10/bitva-chatov-v-kakom-banke-bystree-otvechajut-na-soobshhenija/">necessary to understand not only financial matters</a> ... <br><br><img src="https://habrastorage.org/files/706/64a/d23/70664ad238e44d2c825aa694c06210ce.jpg"><br><br>  ... and tear the templates :) <br><br><img src="https://habrastorage.org/files/f66/31c/24d/f6631c24d2324742b49cb9e7534e14e9.png"><br>  Stay tuned! </div><p>Source: <a href="https://habr.com/ru/post/308398/">https://habr.com/ru/post/308398/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308382/index.html">Trello Clone on Phoenix and React. Parts 8-9</a></li>
<li><a href="../308386/index.html">7 helpful morning habits of psychologically enduring people</a></li>
<li><a href="../308388/index.html">How to keep healthy relationships by being a developer</a></li>
<li><a href="../308392/index.html">Back to basics or a step forward? HPE StoreVirtual VSA</a></li>
<li><a href="../308394/index.html">Programs become more important than iron</a></li>
<li><a href="../308400/index.html">Step-by-step instructions for setting up LXD on Ubuntu 16.04</a></li>
<li><a href="../308402/index.html">Docker: flexible network without NAT for all occasions</a></li>
<li><a href="../308406/index.html">New course on Stepic platform: "Advanced C / C ++ Programming"</a></li>
<li><a href="../308410/index.html">JavaScript Performance, databases and searches for the "silver bullet": video TOP-5 reports of HolyJS 2016</a></li>
<li><a href="../308412/index.html">SAP F & R: Order Creation Process. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>