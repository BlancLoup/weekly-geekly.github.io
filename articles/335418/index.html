<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is common between finite automata, animation, and Xamarin.Forms</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you were a student of a technical specialty, then surely remember the course devoted to finite automata . This simple but very capacious model (the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is common between finite automata, animation, and Xamarin.Forms</h1><div class="post__text post__text-html js-mediator-article">  If you were a student of a technical specialty, then surely remember the course devoted to <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BD%25D0%25B5%25D1%2587%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B0%25D0%25B2%25D1%2582%25D0%25BE%25D0%25BC%25D0%25B0%25D1%2582">finite automata</a> .  This simple but very capacious model (the finite state machine, it‚Äôs also the finite state machine, it‚Äôs the FSM) is used quite widely, although most programmers unfairly forget about it.  Today we will talk about state machines and their application in creating complex animations in applications on Xamarin.Forms. <br><br><img src="https://habrastorage.org/web/29f/896/aa3/29f896aa3e2641559f918fb0cf66d522.jpg"><br><a name="habracut"></a><br><h2>  Animations in Xamarin.Forms </h2><br><p>  If you are already using Xamarin.Forms in real projects, then you are probably faced with the built-in animation mechanism.  If not, then we recommend starting the acquaintance with the articles <a href="https://blog.xamarin.com/creating-animations-with-xamarin-forms/">‚ÄúCreating Animations with Xamarin.Forms‚Äù</a> and <a href="http://xfcomplete.net/animation/2016/01/18/compound-animations/">‚ÄúCompound Animations‚Äù</a> . </p><br><p>  Most often you want to animate the following properties: </p><br><ul><li>  Scale, the scale of the element; </li><li>  Opacity, transparency; </li><li>  Translation, an additional offset in x, y, relative to that obtained when composing the position; </li><li>  Rotation, rotation around the x, y, z axes. </li></ul><br><p>  In Xamarin.Forms, low-level OS mechanisms are used to set the indicated properties, which has a great effect on performance - there is no problem to animate a whole bunch of objects at once.  In our example, we will focus on these properties, but if you wish, you can independently expand the mechanisms described below. </p><br><h2>  State machines </h2><br><p>  If we describe a finite automaton in human language, then this is an object that may be in different stable states (for example, ‚Äúloading‚Äù or ‚Äúerror‚Äù).  Their state machine changes under the influence of external events.  The number of states of course.  Examples of such machines are elevators and traffic lights. </p><br><br><img src="https://habrastorage.org/web/115/e49/f8e/115e49f8e91b4d4294a94086b68b1cac.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>  If for some reason you did not study at the institute on a technical specialty or did not study theory, then we recommend starting your acquaintance <a href="https://tproger.ru/translations/finite-state-machines-theory-and-implementation/">with this article</a> . </p><br><p>  What does all this have to do with animations and especially with Xamarin.Forms?  Let's get a look. </p><br><h2>  One screen, many states, there are transition animations </h2><br><p>  In the article <a href="https://habrahabr.ru/company/microsoft/blog/307890/">‚ÄúWorking with screen states in Xamarin.Forms‚Äù,</a> we have already described the StateContainer component, which simplifies the development of complex interfaces and is suitable for most screens in business applications.  This component works well when we have all the states independently of each other and a rather simple transition ‚Äúone disappeared - the second appeared‚Äù between them. </p><br><img src="https://habrastorage.org/web/d89/bec/b99/d89becb9925f43eb8c40dc64c174ce5a.png"><br><br><p>  But what if you need to implement a complex and animated transition from one state to another?  To go, rotate and jump. </p><br><p>  As an example, let's look at the screen for entering an address and working with a map, as it is implemented in most navigators. </p><br><p>  Imagine that we have animated transitions between the following states of a SINGLE screen: </p><br><img src="https://habrastorage.org/web/46d/bd0/43f/46dbd043f9d84a08b0a03279a17621d2.png"><br><p>  As you can see, we have such a state machine: </p><br><img src="https://habrastorage.org/web/519/b1a/7ac/519b1a7ac51f49c5a6095eac196240ca.png"><br><p>  You need to implement the following animations when transitioning from state to state: </p><br><ul><li>  When entering FindAddress, you need to hide the old content with animation and smoothly show the new one.  Plus for piquancy we will animate the buttons during the appearance; </li><li>  When you go to ShowRoute, you need to hide the old state, and a sign with information about the route should come out from the bottom of the screen; </li><li>  When you go to Drive, you must hide the old state and the plate with the information about the route should go up; </li><li>  When switching to Main (except for the first launch), you need to hide the current state and smoothly display the button, add a small zoom animation to it as well. </li></ul><br><p><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/8qDfWoq-zpg&amp;xid=17259,15700023,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjCZFhAB-SNYJwgF7jWNPFZ0BHhNA"></iframe></p><br><h2>  We write your machine </h2><br><p>  We will take the simplest implementation: </p><br><ul><li>  An automaton has a fixed set of states that are set during initialization; </li><li>  Each of the states is described by a set of necessary animations (final properties) for UI elements; </li><li>  When entering a new state, all animations from the array added during automaton initialization are launched in parallel. </li></ul><br><p>  We will not keep any history of transitions, neither does it matter for which user event the machine has moved from one state to another.  There is only a transition to a new state, which is accompanied by animations. </p><br><p>  So, the simplest machine gun, which we call the Storyboard, will look like this: <br><br></p><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> AnimationType { Scale, Opacity, TranslationX, TranslationY, Rotation } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Storyboard</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, ViewTransition[]&gt; _stateTransitions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, ViewTransition[]&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> state, ViewTransition[] viewTransitions</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stateStr = state?.ToString().ToUpperInvariant(); _stateTransitions.Add(stateStr, viewTransitions); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Go</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newState, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> withAnimation = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newStateStr = newState?.ToString().ToUpperInvariant(); <span class="hljs-comment"><span class="hljs-comment">// Get all ViewTransitions var viewTransitions = _stateTransitions[newStateStr]; // Get transition tasks var tasks = viewTransitions.Select(viewTransition =&gt; viewTransition.GetTransition(withAnimation)); // Run all transition tasks Task.WhenAll(tasks); } } public class ViewTransition { // Skipped. See complete sample in repository below public async Task GetTransition(bool withAnimation) { VisualElement targetElement; if( !_targetElementReference.TryGetTarget(out targetElement) ) throw new ObjectDisposedException("Target VisualElement was disposed"); if( _delay &gt; 0 ) await Task.Delay(_delay); withAnimation &amp;= _length &gt; 0; switch ( _animationType ) { case AnimationType.Scale: if( withAnimation ) await targetElement.ScaleTo(_endValue, _length, _easing); else targetElement.Scale = _endValue; break; // See complete sample in repository below default: throw new ArgumentOutOfRangeException(); } } }</span></span></code> </pre> <br><p>  In the example above, input checks are omitted, the full version can be found in the repository (link at the end of the article). </p><br><p>  As we see, in the transition to a new state, smooth changes in the required properties just occur in parallel.  It is also possible to go to a new state without animation. </p><br><h2>  We use the state machine </h2><br><p>  So, we have an automaton and we can connect it to set the necessary state of the elements.  An example of adding a new state: </p><br><pre> <code class="cs hljs">_storyboard.Add(States.Drive, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewTransition(ShowRouteView, AnimationType.TranslationY, <span class="hljs-number"><span class="hljs-number">200</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewTransition(ShowRouteView, AnimationType.Opacity, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, delay: <span class="hljs-number"><span class="hljs-number">250</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewTransition(DriveView, AnimationType.TranslationY, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>, delay: <span class="hljs-number"><span class="hljs-number">250</span></span>), <span class="hljs-comment"><span class="hljs-comment">// Active and visible new ViewTransition(DriveView, AnimationType.Opacity, 1, 0) // Active and visible });</span></span></code> </pre> <br><p>  As you can see, for the Drive state, we set an array of individual animations.  ShowRouteView and DriveView are the normal views defined in XAML, as shown below. </p><br><p>  But to switch to a new state, simply call the Go () method: </p><br><pre> <code class="cs hljs">_storyboard.Go(States.ShowRoute);</code> </pre> <br><p>  The code turns out to be relatively small and group animations are created in fact simply by a set of numbers.  Our finite state machine can work not only with pages, but also with individual View, which expands its application options.  It is better to use Storyboard inside the page code (Page), without mixing it with business logic. </p><br><p>  We also give an example of XAML, which describes all the elements of the user interface. </p><br><img src="https://habrastorage.org/web/c1e/4c7/fc0/c1e4c7fc0e824a10a271fab1c7636eb9.png"><br><br><p>  If you decide to add the ability to change the color of elements using animations, we recommend that you familiarize <a href="https://blog.xamarin.com/building-custom-animations-in-xamarin-forms/">yourself</a> with the implementation described in the article <a href="https://blog.xamarin.com/building-custom-animations-in-xamarin-forms/">‚ÄúBuilding Custom Animations in Xamarin.Forms‚Äù</a> . </p><br><p>  <b>The full project code from the article can be found in our repository:</b> <b><br></b>  <b><a href="https://bitbucket.org/binwell/statemachine">https://bitbucket.org/binwell/statemachine</a> .</b> </p><br><p>  And as always, ask your questions in the comments.  Before communication! </p><br><h4>  about the author </h4><br><img src="https://habrastorage.org/files/f70/e9c/e7a/f70e9ce7a2bd45a98e19652a08b15e26.JPG" align="left" width="120">  Vyacheslav Chernikov - head of development at <a href="http://www.binwell.com/">Binwell</a> , Microsoft MVP and Xamarin Certified Developer.  In the past, he was one of the Nokia Champion and Qt Certified Specialists, currently he is the Xamarin and Azure platform specialist.  He came to the sphere of mobile in 2005, since 2008 he has been developing mobile applications: he started with Symbian, Maemo, Meego, Windows Mobile, then switched to iOS, Android and Windows Phone.  Articles Vyacheslav you can also read the <a href="https://medium.com/binwell/public/home">blog on Medium</a> . <br><br>  <b>Other articles by the author:</b> <br><br><ul><li>  <a href="https://habrahabr.ru/company/microsoft/blog/335418/">What is common between finite automata, animation, and Xamarin.Forms</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/333606/">7 best device farm for mobile app testing</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/327900/">Automate non-automated, or about Xamarin in real projects</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/332970/">OAuth Authorization for Xamarin Applications</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/329908/">Deploy mobile software with Microsoft devops pipeline</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/325184/">DevOps in the service of man</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/310704/">Convenient REST for Xamarin Applications</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/281897/">Quickly create MVP (minimum viable product) based on Microsoft Azure and Xamarin.Forms</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/303630/">Preparing Xamarin.Forms: Setting Up the Environment and First Steps</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/304678/">Increase work efficiency in Xamarin.Forms</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/307890/">Working with screen states in Xamarin.Forms</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/321454/">Connecting Facebook SDK for Xamarin.Forms</a> </li><li>  <a href="https://habrahabr.ru/company/microsoft/blog/323296/">We connect VKontakte SDK for Xamarin.Forms</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/335418/">https://habr.com/ru/post/335418/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335406/index.html">Will AR / VR replace tourism and travel?</a></li>
<li><a href="../335408/index.html">Social Organism - as a form of effective team interaction. Part 1</a></li>
<li><a href="../335410/index.html">Monitoring as a service: a modular system for microservice architecture</a></li>
<li><a href="../335414/index.html">Passive device, routing and Barcode-Print</a></li>
<li><a href="../335416/index.html">The evolution of the site - a look Linux-admin data center</a></li>
<li><a href="../335420/index.html">Automate it: How the market for the destruction of routine is formed</a></li>
<li><a href="../335424/index.html">Turkey Mobile Market Review</a></li>
<li><a href="../335426/index.html">System prisoners</a></li>
<li><a href="../335428/index.html">Let's learn tcpdump with Julia Evans</a></li>
<li><a href="../335430/index.html">IT-school SAMSUNG on behalf of the student</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>