<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android + Arduino = ‚ô•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, Google opened an API for Android devices to work with USB. Today it's time to feel what it is and find out what opportunities are ope...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android + Arduino = ‚ô•</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago, Google <a href="http://habrahabr.ru/blogs/android/119208/">opened an API</a> for Android devices to work with USB.  Today it's time to feel what it is and find out what opportunities are opening up for us. <br><br><img src="https://habrastorage.org/storage1/dd5bce74/a652f3e4/669c346d/def81ca8.jpg"><br><br><a name="habracut"></a><br>  So, we have Arduino Mega 2560, <a href="http://www.sparkfun.com/products/9947">USB Host Shield</a> and HTC Desire with firmware <a href="http://www.cyanogenmod.com/">cyanogen</a> 7.1.0 RC1 (Android 2.3.4).  Just in case, let me remind you that everything that will be described further - works only starting from Android 2.3.4 for phones and Android 3.1 for tablets. <br><blockquote>  <i>It is worth noting that this USB Host Shield is not entirely successful, especially in combination with the Arduino Mega 2560. The first problem was that this expansion card was made for the Arduino UNO, and it differs from the Mega in the SPI pin positions, so I had to throw jumpers (see a photo).</i>  <i>The second problem, although quite expected, was the need for an external power source for the operation of this expansion card.</i>  <i><a href="http://www.circuitsathome.com/products-page/arduino-shields/usb-host-shield-2-0-for-arduino/">USB Host Shield 2.0</a> from Circuits @ Home is considered more successful, but it is also more expensive.</i> </blockquote><br><img src="https://habrastorage.org/storage1/9466aaad/6dc108bb/59d5153a/a8c5abc5.jpg"><br>  <i>SPI-Billed Board</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Configuring Arduino software </h2><br>  1. If not already installed, then download and install <a href="http://arduino.cc/en/Guide/HomePage">software for Arduino</a> . <br>  2. Download and unpack <a href="">the ADK package</a> (contains the DemoKit application).  The <code>app</code> , <code>firmware</code> , and <code>hardware</code> folders should appear. <br>  3. Download <a href="http://www.arduino.cc/playground/Main/CapSense">the CapSense library</a> <br>  4. Copy <code>firmware/arduino_libs/AndroidAccessory</code> and <code>firmware/arduino_libs/USB_Host_Shield</code> to <code>&lt;arduino_installation_root&gt;/libraries/</code> . <br>  5. Create a CapSense directory at <code>&lt;arduino_installation_root&gt;/libraries/</code> and copy <code>CapSense.cpp</code> and <code>CapSense.h</code> into it from the CapSense archive. <br><br><h2>  Firmware download </h2><br>  Google kindly provides its DemoKit sketch for Arduino.  All you need is to open it from <code>firmware/demokit/demokit.pde</code> , compile it and <code>firmware/demokit/demokit.pde</code> to the board. <br><br><h2>  Test Android application </h2><br>  The DemoKit package also contains the source code of the Android application to demonstrate the capabilities.  Google offers us to create our own Android project and build this application.  First we need to install <a href="http://code.google.com/android/add-ons/google-apis/installing.html">API Level 10</a> .  Then everything is simple - we create an Android project and specify the path to the <code>app</code> folder, in the Build Target we specify Google APIs (Platform <b>2.3.3</b> , API Level 10).  We assemble the application and install it on the phone.  Who does not want to mess with the assembly - can <a href="http://narod.ru/disk/17719606001/DemoKit.apk.html">download the finished APK</a> . <br><br><h2>  Launch </h2><br>  Just connect our phone to USB Host Shield.  If we did everything correctly, then the screen will ask you to launch the DemoKit application. <br><br> <a href=""><img src="https://habrastorage.org/storage1/1f97f26b/90c9e500/55c4e4b9/3cc7a6df.png"></a> <br><br>  The application itself contains two tabs - In (buttons, joystick and sensors) and Out (LEDs, relays and servo drives). <br><br> <a href=""><img src="https://habrastorage.org/storage1/cd2fb8e2/d16a11aa/b75bedf3/4521fc1a.png"></a> <a href=""><img src="https://habrastorage.org/storage1/2aebb8c9/c22f3983/8f50052b/54f4102e.png"></a> <br><br>  I decided that a couple of LEDs and a button are enough to demonstrate.  How this miracle works can be seen on video. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/3-Tc89LyVaE%3Ffeature%3Doembed&amp;xid=25657,15700019,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhjVTF0lotIwonV5uJ--e2sxJ2jPTQ" frameborder="0" allowfullscreen=""></iframe><br><br><h2>  Some code </h2><br>  In this example, messages transmitted via USB consist of three bytes: <br>  The 1st byte defines a command or group of devices, for example, LEDs - 0x2 <br>  The 2nd byte indicates a specific device, for example a green LED - 0x1 <br>  The 3rd byte contains the value transmitted to the device, for example, the maximum brightness - 0xff <br><br><h4>  Arduino </h4><br><pre> <code class="hljs cs">... <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> <span class="hljs-function"><span class="hljs-function">AndroidAccessory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">acc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Google, Inc."</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"DemoKit"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"DemoKit Arduino Board"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"1.0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"http://www.android.com"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"0000000012345678"</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... acc.powerOn(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> msg[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (acc.isConnected()) { <span class="hljs-comment"><span class="hljs-comment">/*    Android  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len = acc.read(msg, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(msg), <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (len &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (msg[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-number"><span class="hljs-number">0x2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (msg[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-number"><span class="hljs-number">0x0</span></span>) analogWrite(LED3_RED, msg[<span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (msg[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-number"><span class="hljs-number">0x1</span></span>) analogWrite(LED3_GREEN, msg[<span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (msg[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-number"><span class="hljs-number">0x2</span></span>) analogWrite(LED3_BLUE, msg[<span class="hljs-number"><span class="hljs-number">2</span></span>]); } } msg[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0x1</span></span>; b = digitalRead(BUTTON1); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b != b1) { msg[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>; msg[<span class="hljs-number"><span class="hljs-number">2</span></span>] = b ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> acc.write(msg, <span class="hljs-number"><span class="hljs-number">3</span></span>); b1 = b; } } }</code> </pre><br><br><h4>  Android </h4><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.android.future.usb.UsbAccessory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.android.future.usb.UsbManager; ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DemoKitActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runnable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UsbManager mUsbManager; UsbAccessory mAccessory; FileInputStream mInputStream; FileOutputStream mOutputStream; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openAccessory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UsbAccessory accessory)</span></span></span><span class="hljs-function"> </span></span>{ mFileDescriptor = mUsbManager.openAccessory(accessory); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mFileDescriptor != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { mAccessory = accessory; FileDescriptor fd = mFileDescriptor.getFileDescriptor(); mInputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(fd); mOutputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(fd); Thread thread = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"AccessoryThread"</span></span>); thread.start(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ret = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] buffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">16384</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (ret &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//    ret = mInputStream.read(buffer); i = 0; while (i &lt; ret) { int len = ret - i; switch (buffer[i]) { case 0x1: //    if (len &gt;= 3) { Message m = Message.obtain(mHandler, MESSAGE_SWITCH); m.obj = new SwitchMsg(buffer[i + 1], buffer[i + 2]); mHandler.sendMessage(m); } i += 3; break; } } } } //   -      : // mActivity.sendCommand((byte)2, (byte)0, (byte)255) public void sendCommand(byte command, byte target, int value) { byte[] buffer = new byte[3]; if (value &gt; 255) value = 255; buffer[0] = command; buffer[1] = target; buffer[2] = (byte) value; if (mOutputStream != null &amp;&amp; buffer[1] != -1) { try { mOutputStream.write(buffer); } catch (IOException e) { ... } } } }</span></span></code> </pre><br><br><h2>  findings </h2><br>  Opening such opportunities, Google primarily counts on the appearance of a large number of active Android accessories, but the fact that we get a convenient device for interacting with various sensors, sensors and actuators is far from the last.  Such a device can easily become the brain of something robotic. <br><br>  Also, we must not forget that the Android device for the Arduino can serve as an expansion card, which has GPS, Bluetooth, WiFi, an accelerometer and much more. <br><br><h3>  Links </h3><br>  1. <a href="http://developer.android.com/guide/topics/usb/accessory.html">Android USB Accessory</a> <br>  2. <a href="http://developer.android.com/guide/topics/usb/adk.html">Android Open Accessory Development Kit</a> </div><p>Source: <a href="https://habr.com/ru/post/123361/">https://habr.com/ru/post/123361/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123353/index.html">Life in a black hole or how to interact with large Russian companies</a></li>
<li><a href="../123356/index.html">How to develop your brand?</a></li>
<li><a href="../123358/index.html">AD and its weakness to the communication channel</a></li>
<li><a href="../123359/index.html">New release platform for creating online stores Synergy 0.60.0</a></li>
<li><a href="../123360/index.html">Working with commons-cli 1.2</a></li>
<li><a href="../123362/index.html">On-line webinar "Modern approaches to the organization of software development processes: Lean and Agile"</a></li>
<li><a href="../123363/index.html">Simple words about e-government</a></li>
<li><a href="../123364/index.html">Think twice before clicking the ‚ÄúBuy it now‚Äù button on Ebay</a></li>
<li><a href="../123365/index.html">Using the iPad 2 with and without the Digital AV Adapter</a></li>
<li><a href="../123367/index.html">We write a game for Android using AndEngine. Part 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>