<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fenwick tree with a modification on the segment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This data structure can be found in this post and its modification to find the maximum in it . But I never met the implementation with the change of e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fenwick tree with a modification on the segment</h1><div class="post__text post__text-html js-mediator-article">  This data structure can be found in <a href="http://habrahabr.ru/post/112828/">this</a> post and its modification to find the maximum in <a href="http://habrahabr.ru/post/160099/">it</a> .  But I never met the implementation with the change of elements in the segment, so I decided to share what I managed to get on my own. <br><a name="habracut"></a><br><h4>  1. Statement of the problem </h4><br>  There is an array.  You must be able to fulfill two types of requests: <br><ol><li>  Modification - add d to each element of the segment [l, r] </li><li>  Amount - calculate the sum of the elements of the segment [l, r] </li></ol><br><h4>  2. Description of the solution </h4><br>  It is easy to see that both types of queries can be ‚Äúfacilitated‚Äù to the segment [0, r] by breaking the segment [l, r] into two prefixes.  As for the segment tree, we will create the second array, in which we will store as much as necessary to add to all the numbers of this segment. <br><br>  Create a Fenwick class with prototypes of future methods. <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fenwick</span></span></span><span class="hljs-class">{</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *m, *mt, N; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Fenwick(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n); Fenwick(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a[], <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> r, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> d)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> r, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> d)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> r)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> r)</span></span></span></span>; };</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the first constructor, it suffices to allocate memory and zero the elements of the array.  And in the second we will go through the array a and convert the values ‚Äã‚Äãin the tree. <br><br><pre> <code class="cpp hljs">Fenwick::Fenwick(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n){ N = n; m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[N]; mt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[N]; <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(m, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)*N); <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(mt, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)*N); } Fenwick::Fenwick(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a[], <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n){ N = n; m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[N]; mt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[N]; <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(m, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)*N); <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(mt, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)*N); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;N;++i){ m[i] += a[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((i|(i+<span class="hljs-number"><span class="hljs-number">1</span></span>))&lt;N) m[i|(i+<span class="hljs-number"><span class="hljs-number">1</span></span>)] += m[i]; } }</code> </pre><br><br>  Consider now the change operation.  Suppose the query came "add 1 to the elements of the segment [0, 9]."  This segment is completely covered by non-intersecting segments [0, 7] and [8, 9], therefore in 7 and 9 elements of the mt array we add 1. But there are segments containing [0, 9] (or part of it) as a subsegment.  They are all located on the right.  For them, it is necessary to change the value in the array m to as many as the elements of the segment [0, 9] they contain.  That is, in m [11] add 2, and to m [15] - 10. <br><br><img src="http://habrastorage.org/storage2/559/ee5/244/559ee5244e56fc5791da8d9a40b296fe.jpg"><br><br>  It can be seen from the figure that the movements occur according to the same laws as in the trivial implementation of the Fenwick tree, so we will immediately move on to the code. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Fenwick::add_range(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> d){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=r;i&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span>;i=(i&amp;(i+<span class="hljs-number"><span class="hljs-number">1</span></span>))<span class="hljs-number"><span class="hljs-number">-1</span></span>) mt[i] += d; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=r|(r+<span class="hljs-number"><span class="hljs-number">1</span></span>);i&lt;N;i|=i+<span class="hljs-number"><span class="hljs-number">1</span></span>) m[i] += d*(r-(i&amp;(i+<span class="hljs-number"><span class="hljs-number">1</span></span>))+<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Fenwick::add_range(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> l, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> d){ add_range(r, d); add_range(l<span class="hljs-number"><span class="hljs-number">-1</span></span>, -d); }</code> </pre><br><br>  For the sum on the prefix, the same picture is suitable with the only explanation that for green elements you need to add both m and mt, and for blue ones only mt (that is, take into account large covering segments). <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Fenwick::sum(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> res = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=r;i&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span>;i=(i&amp;(i+<span class="hljs-number"><span class="hljs-number">1</span></span>))<span class="hljs-number"><span class="hljs-number">-1</span></span>) res += m[i] + mt[i]*(i-(i&amp;(i+<span class="hljs-number"><span class="hljs-number">1</span></span>))+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=r|(r+<span class="hljs-number"><span class="hljs-number">1</span></span>);i&lt;N;i|=i+<span class="hljs-number"><span class="hljs-number">1</span></span>) res += mt[i]*(r-(i&amp;(i+<span class="hljs-number"><span class="hljs-number">1</span></span>))+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Fenwick::sum(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> l, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> r){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sum(r) - sum(l<span class="hljs-number"><span class="hljs-number">-1</span></span>); }</code> </pre><br><h4>  3. Results </h4><br>  We managed to get a data structure with initialization for O (N), modification and sum on a segment for O (logN).  On a random test with 10,000,000 items and 10,000,000 requests received the following figures: <br><table><tbody><tr><th>  Data structure </th><th>  Initialization </th><th>  Modification </th><th>  Amount </th></tr><tr><td>  Fenwick </td><td>  0.13 s </td><td>  9.12 s </td><td>  8.90 s </td></tr><tr><td>  RSQ ( <a href="http://e-maxx.ru/algo/segment_tree">implementation</a> with <a href="http://e-maxx.ru/">e-maxx</a> ) </td><td>  0.25 s </td><td>  17.13 s </td><td>  13.53 seconds </td></tr></tbody></table></div><p>Source: <a href="https://habr.com/ru/post/170933/">https://habr.com/ru/post/170933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../170921/index.html">Detector of sites that infect visitors' computers using malicious Java applets</a></li>
<li><a href="../170923/index.html">Atlassian Confluence 5 - Towards the Ideal</a></li>
<li><a href="../170925/index.html">The naked truth about a failed startup</a></li>
<li><a href="../170927/index.html">Sharp SH631W smartphone review</a></li>
<li><a href="../170931/index.html">RedDwarf (formerly DarkStar) and Unity3D</a></li>
<li><a href="../170935/index.html"># MBLT13 - International Mobile Conference in Moscow</a></li>
<li><a href="../170937/index.html">Migration to Grunt v0.4</a></li>
<li><a href="../170945/index.html">Mobile Development Tools</a></li>
<li><a href="../170949/index.html">Wi-Fi with username and password for each user or do WPA2-EAP / TLS with improvised tools</a></li>
<li><a href="../170951/index.html">Badoo development process</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>