<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Warm lamp text interface. Just about simple</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From time to time looking through the topics in the Habr√©, I constantly find myself thinking that even a little bit and some neural interface in a lap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Warm lamp text interface. Just about simple</h1><div class="post__text post__text-html js-mediator-article">  From time to time looking through the topics in the Habr√©, I constantly find myself thinking that even a little bit and some neural interface in a laptop will become a reality.  In my work, I constantly come across the fact that modern people do not really understand and love a simple command line.  And reading them manuals is all the more lazy. <br>  But in my practice it often happens that you need a small utility that performs one or two functions.  And where exactly it will be executed is unknown.  It can be Windows, it can be exclusively terminal Linux, boot media - whatever.  I'm not a programmer, but sometimes you need to make life easier for yourself or others.  And preferably as clearly as possible.  At first I tried to do just console utilities.  Actually, from this, probably, everything begins.  But it quickly turned out that using printf / sprintf / puts and other tools (and I write in C) it is not very convenient to format the text, display some information.  A window with a constant ‚Äúscrolling‚Äù does not look very nice, and if there is a lot of information, it is completely unreadable.  Then I remembered ncurses. <br><img src="https://habrastorage.org/getpro/habr/post_images/9d4/3a4/72a/9d43a472ab72060edd7302fe80455f4d.png"><br><a name="habracut"></a><br>  Usually curses / ncurses is associated with Linux, although in fact there are compatible implementations for many platforms, in particular under Windows.  Initially, most of the utilities were needed under Win, and I did not know any graphical frameworks and desperately looked for ways to properly format the text, make it beautifully and visually.  That's when I came across a <a href="http://sourceforge.net/projects/pdcurses/">Public Domain Curses</a> .  Designed to be compatible with ncurses, it allows you to write cross-platform applications using most of the capabilities of the original curses / ncurses.  But, unfortunately, no bugs and restrictions can not do.  But it is not as scary as it seemed at first.  I want to show that creating a console-friendly pseudo-window application that is pleasing to the eye is not so difficult;  and at the exit we get a warm tube TUI.  It would be desirable, that people did not forget about such methods of work with the user. <br>  In this post, I will describe the work compatible with PDcurses, so these examples should be collected without problems and under Windows and under Linux. <br><h5>  Start </h5><br>  As we work with the text interface, the unit of dimension will be one character.  You can work with both ordinary ASCII and Wide characters.  It should be remembered that only that terminal can display curses.  Unfortunately, personally, my 80% of pseudographics is not displayed adequately.  Slightly better on Linux, really bad on Windows.  Fortunately, simple lines are displayed normally. <br>  We can work with windows, panels, colors and text (including scrolling, copying, etc.). <br>  Before starting work, we need to get ready for work, turn on (not) the necessary options in (s). <br><br><div class="spoiler">  <b class="spoiler_title">This is what my usual start of work looks like.</b> <div class="spoiler_text"><pre><code class="cpp hljs">initscr(); <span class="hljs-comment"><span class="hljs-comment">//  cbreak(); //     getch() raw(); nonl(); noecho(); //    ,      curs_set(0); //  keypad(stdscr, TRUE); //    (,     ) if (has_colors() == FALSE) //    ,      . { endwin(); puts("\nYour terminal does not support color"); return (1); } start_color(); //   use_default_colors(); // stscr  "" init_pair(1, COLOR_WHITE, COLOR_BLUE); //   (background-foreground)    ,    init_pair(2, COLOR_WHITE, COLOR_RED); ......</span></span></code> </pre> <br></div></div><br><br><h5>  At first there was a window </h5><br>  When we start the emulator / instance of the terminal, we are in stdscr.  This is our base, initial window.  We can work in it or build our windows. <br>  Enough words, let's get down to business.  Create a window.  Just want to note an important nuance - everywhere, in all functions, first goes Y, then X 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs">WINDOW *win = newwin(height, width, y, x);</code> </pre><br><br>  Each new window has its own relative coordinates, which you will operate with in the future.  It is important and convenient. <br><img src="https://habrastorage.org/getpro/habr/post_images/644/262/43b/64426243b84633d4fb9bfa5a61917246.jpg"><br><br>  The window was created, but nothing appeared in the console.  Because the window inherits the attributes of the parent - stdscr in our case. <br>  Immediately show how I do.  There is a structure that describes the "virtual window", I will tell about the panels later <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cursed_window</span></span></span><span class="hljs-class"> {</span></span> WINDOW *background; WINDOW *decoration; WINDOW *overlay; PANEL *panel; }; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cursed_window</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">curw</span></span></span><span class="hljs-class">;</span></span></code> </pre><br>  I do this in order to first make a design that will not change and which is static.  We change only the working data, while not overwriting the design. <br>  Window background - transparent background and shadow from the window. <br>  decoration - frame, it is drawn automatically <br>  overlay is the working field itself.  The origin of it will be 0,0, since this is a new window, you do not need to amend the frame and the shadow. <br>  about the panel - later. <br><br><div class="spoiler">  <b class="spoiler_title">Create our virtual window</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">curw *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tui_new_win</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sy, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> h, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> w, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *label)</span></span></span><span class="hljs-function"> </span></span>{ curw *<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>-&gt;background = newwin(h, w, sy, sx);<span class="hljs-comment"><span class="hljs-comment">//      wattron(new-&gt;background, COLOR_PAIR(7));// ,  .    //     for (int i= w*0.1; i&lt;w;i++) mvwaddch(new-&gt;background, h-1, i, ' '); for (int i= h*0.2; i&lt;h;i++) mvwaddch(new-&gt;background, i, w-1, ' '); wattroff(new-&gt;background, COLOR_PAIR(7)); //   ,      .    //   new-&gt;decoration = derwin(new-&gt;background, h-2, w-2, 1, 1); wbkgd(new-&gt;decoration, COLOR_PAIR(1)); //  box(new-&gt;decoration, 0, 0); int x, y; getmaxyx(new-&gt;decoration, y, x); new-&gt;overlay = derwin(new-&gt;decoration, y-4, x-2, 3, 1);//   wbkgd(new-&gt;overlay, COLOR_PAIR(1)); new-&gt;panel = new_panel(new-&gt;background); tui_win_label(new-&gt;decoration, label, 0); //       update_panels(); doupdate(); return new; }</span></span></code> </pre><br></div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5d3/ad3/641/5d3ad36417f8c5f07cdd31602b05250e.png"><br><br>  In fact, if we create a second window on top of this, then our background will ‚Äúpull‚Äù on the bottom window.  It's not beautiful.  But disposable.  But this is a topic for another conversation.  Remove shadows for simplicity and create multiple windows. <br><img src="https://habrastorage.org/getpro/habr/post_images/beb/499/662/beb499662fdf053ef46ec46234175fd2.png"><br>  And now we can say about the panel.  A panel is a container stack containing a window and all its child windows.  With the panel you can spend a lot of interesting manipulations. <br><h5>  Panels </h5><br>  Now you can demonstrate the capabilities of the panels in practice.  The topmost window in the stack is available for default operation.  We can also access any windows and panels in the stack below, write in them, without affecting the windows in the stack above.  We can sort the windows ourselves whatever we want, move them, resize them.  Sorry for the primitive code, but I tried to make it clearer. <br><br><div class="spoiler">  <b class="spoiler_title">Finally create the main loop.</b> <div class="spoiler_text"><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x, y; getmaxyx(stdscr, y, x); curw *wins[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//   wins[0] = tui_new_win(0, 0, y - 5, x - 5, "-=Hello Habr=-", 1); wins[1] = tui_new_win(y / 3, x / 2, 15, 30, "-=Data=-", 4); wins[2] = tui_new_win(5, 5, 10, 20, "-=Memo=-", 5); PANEL *TOP = wins[0]-&gt;panel; int panel_counter = 0; do { switch ( user_key ) { case 0x9: //TAB if(++panel_counter &gt; 2) { panel_counter=0; } TOP = wins[panel_counter]-&gt;panel; break; case KEY_UP: case KEY_DOWN: case KEY_LEFT: case KEY_RIGHT: tui_move_panel(wins[panel_counter], user_key); default: if(isalpha(user_key)) waddch(wins[panel_counter]-&gt;overlay, user_key); break; } //         top_panel(TOP); touchwin(panel_window(TOP)); update_panels( ); doupdate( ); } while (( user_key = getch( )) != KEY_F(12));</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">But the window moving routine</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tui_move_panel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(curw *win, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> begy, begx, maxx, maxy, x, y; getbegyx(panel_window(win-&gt;panel), begy, begx); getmaxyx(panel_window(win-&gt;panel), maxy, maxx); getmaxyx(stdscr, y, x); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (ch) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KEY_UP: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((begy - <span class="hljs-number"><span class="hljs-number">1</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) begy--; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KEY_DOWN: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((begy + <span class="hljs-number"><span class="hljs-number">1</span></span>) + maxy) &lt;= y) begy++; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KEY_LEFT: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((begx - <span class="hljs-number"><span class="hljs-number">1</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) begx--; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> KEY_RIGHT: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((begx + <span class="hljs-number"><span class="hljs-number">1</span></span>) + maxx) &lt;= x) begx++; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } move_panel(win-&gt;panel, begy, begx); }</code> </pre><br></div></div><br><br>  Well, as a result <br><br><img src="https://habrastorage.org/getpro/habr/post_images/508/044/705/508044705f587ce6140c718c5c56a562.gif"><br><br>  I thought of describing more, but apparently, it would have been too big and boring post, I just wanted to draw attention to this "ancient technology", which has enough features.  Behind the frame there are manipulations with the text, with attributes and other things.  For example, it is possible to copy a string of text from any window, find out its color and mode.  And much more. <br>  Hope this was not too boring. </div><p>Source: <a href="https://habr.com/ru/post/205222/">https://habr.com/ru/post/205222/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../205210/index.html">Flightstats API: We write our board of arrivals with Boeing and Airbus</a></li>
<li><a href="../205212/index.html">The digest of interesting materials from the world of web development and IT for the last week No. 86 (December 1 - 7, 2013)</a></li>
<li><a href="../205214/index.html">Kindle Fire HDX - affordable tablet from Amazon</a></li>
<li><a href="../205218/index.html">SharePoint Code Check (SPCop) is a free code analysis tool.</a></li>
<li><a href="../205220/index.html">ShareJS hook logic</a></li>
<li><a href="../205230/index.html">The best textbook on Meteor - "Discover Meteor" - one day for free</a></li>
<li><a href="../205232/index.html">Anonymous Santa Claus 2014. Post boasting Christmas gifts</a></li>
<li><a href="../205234/index.html">The largest torrent trackers hit the Kaspersky Lab's parental control database</a></li>
<li><a href="../205236/index.html">WCF RIA Services. Receiving data. Part 2</a></li>
<li><a href="../205238/index.html">The easiest way to grab statics for free on Heroku</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>