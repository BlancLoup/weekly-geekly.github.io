<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Translation SDL Game Framework Series. Part 6 - SDL Entities</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this lesson, as promised, I will tell you about such a thing as "Entities". ‚ÄúEntities‚Äù for all game processes are a kind of game objects that can i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Translation SDL Game Framework Series. Part 6 - SDL Entities</h1><div class="post__text post__text-html js-mediator-article">  In this lesson, as promised, I will tell you about such a thing as "Entities".  ‚ÄúEntities‚Äù for all game processes are a kind of game objects that can interact in some form or in some way with each other and with the game world.  Examples of ‚ÄúEntities‚Äù are monsters that you will encounter on your difficult path, treasure chests you can open, coins you can collect, walls to kill, etc.  Thus, any object of the game world that somehow moves, exhibits interactivity, can be represented in the form of these ‚ÄúEntities‚Äù. <br><a name="habracut"></a><br>  Well, let's say this: you have some kind of ‚ÄúMountain‚Äù, which is part of your map, stands still and simply exists.  It is not an "Entity."  But if you want to make this ‚ÄúMountain‚Äù move, fall on your hero (simply to interact with the objects of the game world), then it is naturally advisable to present it in the form of ‚ÄúEssence‚Äù.  The author decided to break the narration into 3 articles (and I understand it perfectly, there is a lot of text and code, the translation will take a lot of time, so wait).  In this lesson, everything will be quite simple - we will create a class for working with ‚ÄúEntities‚Äù and sort it out by the bones.  In the next lesson we will learn how to create a map using tilesets and manage it.  Well, at the end of the cycle - a detailed analysis of the interaction processes of game objects (processing of intersections (or collisions) of the ‚ÄúEntities‚Äù with other ‚ÄúEntities‚Äù and with the card itself). <br><br>  In the meantime, create, as you already know, two <i>CEntity.cpp</i> and <i>CEntity.h files</i> with the following contents: <br><br><div class="spoiler">  <b class="spoiler_title">CEntity.h</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;vector&gt; #include "CAnimation.h" #include "CSurface.h" class CEntity { public: static std::vector&lt;CEntity*&gt; EntityList; protected: CAnimation Anim_Control; SDL_Surface* Surf_Entity; public: float X; float Y; int Width; int Height; int AnimState; public: CEntity(); virtual ~CEntity(); public: virtual bool OnLoad(char* File, int Width, int Height, int MaxFrames); virtual void OnLoop(); virtual void OnRender(SDL_Surface* Surf_Display); virtual void OnCleanup(); };</span></span></span></span></code> </pre> <br></div></div><br>  Well and accordingly: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">CEntity.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CEntity.h"</span></span></span><span class="hljs-meta"> std::vector</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;CEntity*&gt; CEntity::EntityList; CEntity::CEntity() { Surf_Entity = NULL; X = Y = 0.0f; Width = Height = 0; AnimState = 0; } CEntity::~CEntity() { } bool CEntity::OnLoad(char* File, int Width, int Height, int MaxFrames) { if((Surf_Entity = CSurface::OnLoad(File)) == NULL) { return false; } CSurface::Transparent(Surf_Entity, 255, 0, 255); this-&gt;Width = Width; this-&gt;Height = Height; Anim_Control.MaxFrames = MaxFrames; return true; } void CEntity::OnLoop() { Anim_Control.OnAnimate(); } void CEntity::OnRender(SDL_Surface* Surf_Display) { if(Surf_Entity == NULL || Surf_Display == NULL) return; CSurface::OnDraw(Surf_Display, Surf_Entity, X, Y, AnimState * Width, Anim_Control.GetCurrentFrame() * Height, Width, Height); } void CEntity::OnCleanup() { if(Surf_Entity) { SDL_FreeSurface(Surf_Entity); } Surf_Entity = NULL; }</span></span></span></span></code> </pre><br></div></div><br>  As usual, it is time for me to explain to you what is going on here.  I encapsulated from <i>CApp</i> 5 previously used by me (and you) methods (except for event handling - I will tell in the next lesson as I promised).  Such an approach will allow us to ‚Äúseparate the wheat from the chaff‚Äù and process the ‚ÄúEntities‚Äù in a more transparent and simple way than if they were all pushed into a pile in the main ( <i>CApp</i> ) class.  Also, we can easily handle something other than ‚ÄúEntities‚Äù.  Have you already noticed the static vector <i>EntityList</i> ?  It is designed to store the list of our game entities and is directly accessible through <i>CEntity :: EntityList</i> , all because it is static.  Important: I specifically declared <i>EntityList</i> exactly in <i>CEntity</i> , since this approach will allow to avoid circular dependencies in the future.  For example, the interaction of the Card with Entities, when the CMap class is declared as a member of CEntity and CEntity is declared as a member of CMap (here I myself did not understand a little what the author means), will lead to an error at the compilation stage. <br><br>  So, this vector will store all our game ‚ÄúEntities‚Äù in the form of references to them (made with an emphasis on the future, when other classes are inherited from the CEntity class).  So, for example, if we were going to make the game <i>Megaman</i> , we would have the <i>CMegaMan</i> class inherited from <i>CEntity</i> .  And with the help of polymorphism, we can store objects of the <i>CMegaMan</i> class in an <i>EntityList</i> .  This is the reason why we declared the above functions as virtual, and some members of the class are protected. <br><br>  Our "Entity" has common parameters for all "Entities" - coordinates, dimensions, surface for drawing a picture.  There is also a method for downloading this image, the default is just a transparent area.  Lyrical digression: do not be afraid to change this code, it is not a postulate, it is not cut out of stone.  Change it as you like, and if you make a mistake, the original is always there, will not go anywhere! <br><br>  In the <i>OnLoop</i> method, we need to implement the basic calculations.  But for now we will leave there only the calculation of the animation frames.  Also note that we set only the <i>MaxFrames</i> variable for the animation, and left everything else as default.  <i>Get accustomed</i> to <i>OnRender</i> .  Instead of doing a stupid drawing on the screen, I entered a parameter to make it possible to point to any surface into which we would like to draw the ‚ÄúEntity‚Äù.  Thus, you can even overlay the rendering of Entities on each other. <br><br>  And finally, we have <i>OnCleanup</i> , my favorite cleaning of everything and everything (Purgatory is crying for me), the liberator of memory, a small economy. <br><br>  As I said at the very beginning - we created only the basic structure of the class for the ‚ÄúEntities‚Äù, and, without truth, I‚Äôll say that while this monster can do little (but will be able to do the following lessons).  But we can make it work now!  Open <br>  <i>CApp.h</i> and add a couple of ‚ÄúEntities‚Äù: <br><br><div class="spoiler">  <b class="spoiler_title">CApp.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CEntity.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//...      private: CEntity Entity1; CEntity Entity2;</span></span></span></span></code> </pre><br></div></div><br>  Load them by writing the code in <i>CApp_OnInit.cpp</i> .  (here you will need a picture from the last lesson, or rather 2 copies of it): <br><br><div class="spoiler">  <b class="spoiler_title">CApp_OnInit.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Entity1.OnLoad(<span class="hljs-string"><span class="hljs-string">"./entity1.bmp"</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>) == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Entity2.OnLoad(<span class="hljs-string"><span class="hljs-string">"./entity2.bmp"</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>) == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } Entity2.X = <span class="hljs-number"><span class="hljs-number">100</span></span>; CEntity::EntityList.push_back(&amp;Entity1); CEntity::EntityList.push_back(&amp;Entity2);</code> </pre><br></div></div><br>  Remember how I said that we basically encapsulate the main functions of the game in an entity class?  Now you need to call them a little bit.  Edit the <i>CApp_OnLoop.cpp</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>;i &lt; CEntity::EntityList.size();i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!CEntity::EntityList[i]) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; CEntity::EntityList[i]-&gt;OnLoop(); }</code> </pre><br>  Those.  we go over our vector with ‚ÄúEntities‚Äù and call the <i>OnLoop</i> method for each ‚ÄúEntity‚Äù (and also perform a small check in order not to run into the null pointer).  It remains to do the same in <i>CApp_OnRender.cpp</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>;i &lt; CEntity::EntityList.size();i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!CEntity::EntityList[i]) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; CEntity::EntityList[i]-&gt;OnRender(Surf_Display); }</code> </pre><br>  Cleansing, dear, well, hello: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>;i &lt; CEntity::EntityList.size();i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!CEntity::EntityList[i]) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; CEntity::EntityList[i]-&gt;OnCleanup(); } CEntity::EntityList.clear();</code> </pre><br>  <i>With the</i> final stroke ( <i>CEntity :: EntityList.clear ()</i> ) we nullify the ‚ÄúEntities‚Äù vector ... Compile, run, admire! <br>  Thank you all for your attention. <br><br>  Links to source code: <br><ul><li>  <a href="">Win32</a> </li><li>  <a href="">* nix</a> </li></ul><br><br>  Links to all lessons: <br><ul><li>  <a href="http://habrahabr.ru/post/166875/">Developing a game framework.</a>  <a href="http://habrahabr.ru/post/166875/">Part 1 - The Basics of SDL</a> </li><li>  <a href="http://habrahabr.ru/post/167035/">Developing a game framework.</a>  <a href="http://habrahabr.ru/post/167035/">Part 2 - Coordinates and Mapping</a> </li><li>  <a href="http://habrahabr.ru/post/167245/">Developing a game framework.</a>  <a href="http://habrahabr.ru/post/167245/">Part 3 - Events</a> </li><li>  <a href="http://habrahabr.ru/post/167443/">Developing a game framework.</a>  <a href="http://habrahabr.ru/post/167443/">Part 4 - Tic-Tac-Toe</a> </li><li>  <a href="http://habrahabr.ru/post/169197/">Developing a game framework.</a>  <a href="http://habrahabr.ru/post/169197/">Part 5 - Animation</a> </li><li>  Developing a game framework.  Part 6 - Entities </li></ul></div><p>Source: <a href="https://habr.com/ru/post/169295/">https://habr.com/ru/post/169295/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169271/index.html">Black Hole War, or the Battle of the Black Hole</a></li>
<li><a href="../169277/index.html">Inheritance without Prototype</a></li>
<li><a href="../169283/index.html">Samsung 700G7C-T02 laptop video review</a></li>
<li><a href="../169287/index.html">Comparison Browser css3 & html5</a></li>
<li><a href="../169293/index.html">Overview of the inverter APSX-1250</a></li>
<li><a href="../169297/index.html">Linux at the sight of intruders</a></li>
<li><a href="../169301/index.html">Static class members. Do not let them ruin your code</a></li>
<li><a href="../169303/index.html">Runetology (185): Andrey Soloviev, founder of Babyblog.ru</a></li>
<li><a href="../169305/index.html">LangPrism - web content crowdsourcing translation service</a></li>
<li><a href="../169307/index.html">It is cheaper for Australians to fly to the USA to buy software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>