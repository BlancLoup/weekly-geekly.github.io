<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MXML compiler. Part 2. Non-string parameter initializers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 In the previous article, I spent some kind of educational program on the insides of the Flex-compiler (in terms of MXML) and told how to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MXML compiler. Part 2. Non-string parameter initializers</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  In the <a href="http://habrahabr.ru/blogs/Flash_Platform/128703/">previous article,</a> I spent some kind of educational program on the insides of the Flex-compiler (in terms of MXML) and told how to save myself from the problems of working with classes in MXML that require constructor parameters.  Now we will analyze the other side of the question - setting the parameters to custom values ‚Äã‚Äã(for example, constants) without using the Binding mechanism (although it is very similar to it). <br><br><a name="habracut"></a><br><h4>  opening speech </h4>  I want to apologize in advance for the fact that this article came out later than I said - literally the very next day after the article I was hired, and there was simply no time :) Now everything was resolved, and I am ready to continue the cycle of articles. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I think everyone who somehow worked with Flex has come across something like this: <br><blockquote><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextField</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flash.text.*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{TextFieldAutoSize.CENTER}"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> </blockquote><br>  If you look at the code that generates mxmlc, then it will look something like this: <br><blockquote><pre> <code class="javascript hljs">private <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_MyOwnFlexFrameworkTest_TextField1_i</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flash</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">text</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TextField</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> temp : flash.text.TextField = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> flash.text.TextField(); _MyOwnFlexFrameworkTest_TextField1 = temp; mx.binding.BindingManager.executeBindings(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"_MyOwnFlexFrameworkTest_TextField1"</span></span>, _MyOwnFlexFrameworkTest_TextField1); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> temp; } <span class="hljs-comment"><span class="hljs-comment">// binding mgmt private function _MyOwnFlexFrameworkTest_bindingsSetup():Array { var result:Array = []; result[0] = new mx.binding.Binding(this, function():String { var result:* = (TextFieldAutoSize.CENTER); return (result == undefined ? null : String(result)); }, null, "_MyOwnFlexFrameworkTest_TextField1.autoSize" ); return result; }</span></span></code> </pre></blockquote><br>  Isn't there a bit too much code for such a trivial task of specifying a constant property, which by definition does not change? <br><br><h4>  Let's do it! </h4><br>  Our goal is to make a backward compatible version that would support autocomplete in the civil IDE, plus it would be visually familiar to Flex programmers.  Considering all the listed requirements, I decided that the solution would look like this: <br><blockquote><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextField</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flash.text.*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${TextFieldAutoSize.CENTER}"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre></blockquote><br>  The idea to use the dollar symbol came from the ANT scripts, conveniently and clearly, as well as already familiar to a good half of the flashers. <br><br>  I admit honestly, I started the process by searching all classes in the java.flex2.compiler.mxml.lang package (why in it? See the first article from the cycle;)) for the entry of the string "@ {", since  it is from it that the so-called two-way bindings begin, and our implementation could build on it.  And I was lucky!  Immediately the parseBindingExpression method was found in <a href="">java.flex2.compiler.mxml.lang.TextParser</a> . <br><br>  To designate the Binding expression, objects of the <a href="">BindingExpression</a> type are <a href="">used</a> , therefore, by analogy, we will create next to it (in the flex2.compiler.mxml.rep package) the ExactValueExpression class: <br><blockquote><pre> <code class="javascript hljs">package flex2.compiler.mxml.rep; public <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExactValueExpression</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** The source expression for this value */</span></span> private <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> exactValue; public ExactValueExpression(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> exactValueExpression) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.exactValue = exactValueExpression; } public <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> getValueExpression() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exactValue; } }</code> </pre></blockquote><br>  We will use it in our own class method <a href="">java.flex2.compiler.mxml.lang.TextParser</a> , which I decided to call parseExactValueExpression: <br><blockquote><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @param s the string to be parsed * @return ExactValueExpression or null */</span></span> protected ExactValueExpression parseExactValueExpression(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> s) { int dollarIdx; int openBraceIdx = <span class="hljs-number"><span class="hljs-number">-1</span></span>; dollarIdx = StringUtils.findNextUnescaped(<span class="hljs-string"><span class="hljs-string">'$'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, s); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dollarIdx == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// String doesn't start with "$" return null; } openBraceIdx = StringUtils.findNextUnescaped('{', dollarIdx + 1, s); if (openBraceIdx != dollarIdx + 1) { // open bracet not in place return null; } int closeBraceIdx = StringUtils.findClosingToken('{', '}', s, openBraceIdx); if (closeBraceIdx == -1) { return null; } String contents = s.substring(openBraceIdx + 1, closeBraceIdx); if (contents.length() == 0) { // Convert ${} to null contents = "null"; } //Don't include the braces (or parens since they will just get stripped). return new ExactValueExpression( contents ); }</span></span></code> </pre></blockquote><br>  Which will be called BEFORE calling parseBindingExpression: <br><blockquote><pre> <code class="javascript hljs">protected <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span> parse(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> text, Type type, Type arrayElementType, int flags) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!inCDATA(flags)) { ExactValueExpression exactValueExpression = parseExactValueExpression(text); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(exactValueExpression != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exactValueExpression; } <span class="hljs-comment"><span class="hljs-comment">// binding? if (!ignoreBinding(flags)) { BindingExpression result = parseBindingExpression(text); if (result != null) { return result; } else { text = cleanupBindingEscapes(text); } }</span></span></code> </pre></blockquote><br><br>  Now our construction is correctly parsed, it remains only to process it.  We go to the <a href="">java.flex2.compiler.mxml.rep.init.ValueInitializer</a> method formatExpr already familiar to us from the previous article.  Add 3 lines to it: <br><blockquote><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(value <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ExactValueExpression) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((ExactValueExpression) value).getValueExpression(); }</code> </pre></blockquote><br>  We compile the project with the ant compiler <b>command</b> , waiting for the <b>BUILD SUCCESSFUL</b> (if you have not received such a result, check all the steps from the beginning). <br><br><h4>  Result </h4><br>  Let's change our original example by adding a dollar symbol: <br><blockquote><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextField</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flash.text.*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${TextFieldAutoSize.CENTER}"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre></blockquote><br>  If you did everything correctly, the result would be something like this: <br><blockquote><pre> <code class="javascript hljs">private <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_MyOwnFlexFrameworkTest_TextField1_i</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flash</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">text</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TextField</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> temp : flash.text.TextField = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> flash.text.TextField(); temp.autoSize = TextFieldAutoSize.CENTER; _MyOwnFlexFrameworkTest_TextField1 = temp; mx.binding.BindingManager.executeBindings(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"_MyOwnFlexFrameworkTest_TextField1"</span></span>, _MyOwnFlexFrameworkTest_TextField1); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> temp; }</code> </pre></blockquote><br><br><h4>  Conclusion </h4><br>  I spent this modification today at the end of the lunch break (about 20‚Äì30 minutes), of which about 3/4 times were spent on determining where to <s>shove</s> to enter.  Do not be afraid to delve into the opensource projects, try to modify them and do better, especially if you have to work with them. <br><br>  Thank you all for your attention, I will be glad to hear the wishes, about what to write in the next articles of the cycle! </div><p>Source: <a href="https://habr.com/ru/post/131434/">https://habr.com/ru/post/131434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131429/index.html">Quick entry into the rack</a></li>
<li><a href="../131430/index.html">Microtouch</a></li>
<li><a href="../131431/index.html">Digit of the month: 70K. Daily</a></li>
<li><a href="../131432/index.html">Tuenti News - Updates in the Spanish social programs</a></li>
<li><a href="../131433/index.html">Nmap - Beginner's Guide</a></li>
<li><a href="../131436/index.html">Why your site probably should not work</a></li>
<li><a href="../131437/index.html">Codecademy programming school received $ 2.5 million</a></li>
<li><a href="../131442/index.html">Motorola XOOM - how to disassemble the tablet and what it consists of</a></li>
<li><a href="../131446/index.html">Design patterns for Android development. Part 2 - MVP and Unit tests. Jedi Way</a></li>
<li><a href="../131447/index.html">IPhone 4S finally hacked</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>