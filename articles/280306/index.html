<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learn to command</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I wanted to share a wonderful development process, which I recently met. I have not seen such an approach before, and people, as soon as they get acqu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learn to command</h1><div class="post__text post__text-html js-mediator-article">  I wanted to share a wonderful development process, which I recently met.  I have not seen such an approach before, and people, as soon as they get acquainted with it, cannot long understand and accept this method of building games.  And, honestly, I myself did not understand everything in the first week.  But after some mastering, I already forgot how to make games differently.  There are plans to write a series of articles, but we will start small and gradually we will increase our understanding of what and why and with what it is. <br><br>  As someone could already guess, today I will tell you about the ‚ÄúCommand‚Äù pattern and how to use it to develop games using the Unity 3D engine.  This is one of the key patterns in this approach.  The code will be simplified, but working and should give an understanding of the process. <br><a name="habracut"></a><br><h4>  Prologue </h4><br>  You probably sometime already saw articles in which developers tell how to use Actor-s in Unity?  If not, I will now quickly explain the essence with an example: in your game there are a dozen game characters who should, for example, jump in different ways.  Of course, the task can be solved through everyone‚Äôs favorite polymorphism: make a base unit and simply overload the virtual Jump method for each unit. <br><br><div class="spoiler">  <b class="spoiler_title">Something like this</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UnitController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Rigidbody AttachedRigidbody; <span class="hljs-comment"><span class="hljs-comment">//... public virtual void Jump() { rigidbody.velocity = new Vector3 (0, 10, 0); } //... }</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RabitUnitController</span></span> : <span class="hljs-title"><span class="hljs-title">UnitController</span></span> { <span class="hljs-comment"><span class="hljs-comment">//... public override void Jump () { //very high jump } //... }</span></span></code> </pre><br></div></div><br>  But in this case, if you need to have several ready-made units, which jumped in different ways, began to jump the same way, then you have to either slightly correct the class hierarchy, or just copy the appropriate piece of code into all the necessary classes (which is terrifying). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      With the help of Actor-ov this problem is solved differently.  Applying this approach ^ it would also be necessary to write a class of a unit, only now, instead of the virtual Jump method, write a series of separate UnitJumper components and simply hook a suitable component onto the correct unit.  And at the moment of the jump, call the Jump method on the attached component: <br><br><div class="spoiler">  <b class="spoiler_title">Actor code</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UnitJumper</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jump</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Rigidbody rigidbody</span></span></span><span class="hljs-function">)</span></span> {} } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RegularJumper</span></span> : <span class="hljs-title"><span class="hljs-title">UnitJumper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jump</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Rigidbody rigidbody</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Jump (rigidbody); rigidbody.velocity = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3 (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MajesticAFJumper</span></span> : <span class="hljs-title"><span class="hljs-title">UnitJumper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Jump</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Rigidbody rigidbody</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Jump (rigidbody); rigidbody.velocity = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3 (<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* * some magic here */</span></span> } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">And so was the controller</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UnitController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UnitJumper _unitJumper; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Rigidbody AttachedRigidbody; <span class="hljs-comment"><span class="hljs-comment">//... public virtual void Jump() { if (_unitJumper != null) _unitJumper.Jump (AttachedRigidbody); else Debug.Log("UnitJumper Component is missing"); } //... }</span></span></code> </pre><br></div></div><br>  Now everything is simple and beautiful.  There are fewer problems with hierarchy, the jump code is in a separate small class, which makes it easy to change.  Each jump method can have any number of parameters and you will be sure that changing them will not break, for example, running.  Also, the modification of the jump mode for the unit is now also very simple.  In addition, the environment itself pushes us to follow such an architecture, and with the help of the [RequireComponent ()] attribute it is possible to tinker with the editor even less.  Now you have to ask why I am telling all this and what is the connection.  So it's time for a logical transition to the Command pattern. <br><br><h4>  Logical transition </h4><br>  We have already moved away from writing all the jump code in our example into one class, but what if we need the units to not only jump themselves in different ways, but also, for example, to change the jump method depending on the circumstances ( do somersaults, run along the wall)?  This is where we will need a team. <br><br>  The essence remains the same - to carry out all the elementary actions in separate classes.  Only now we will add the necessary component to the unit immediately before use and this will allow us to change the unit's behavior at any time and there will not be such a strong connection as in the case with Actors.  Let's write a small base class for a command, which so far will only serve to call a command on a given object. <br><br><div class="spoiler">  <b class="spoiler_title">Basic team</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Command</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T ExecuteOn&lt;T&gt;(GameObject target) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Command { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> target.AddComponent &lt;T&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { OnStart (); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {} }</code> </pre><br></div></div><br>  The above code serves only to conveniently add components to an object, and the OnStart () method so far (but only so far) exclusively for intellisense. <br><br>  Now that we have a base class, we can implement a simple jump. <br><br><div class="spoiler">  <b class="spoiler_title">Approximate class jump</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RegularJumpCommand</span></span> : <span class="hljs-title"><span class="hljs-title">Command</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnStart (); gameObject.GetComponent &lt;Rigidbody&gt;().velocity = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } }</code> </pre><br></div></div><br>  And now, in order to make the unit jump, we only need to execute the command on it: <br><br><div class="spoiler">  <b class="spoiler_title">Command call</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SomeController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-comment"><span class="hljs-comment">//don't forget to set this in editor public UnitController _targetUnit; private void Start() { if (_targetUnit != null) { Command.ExecuteOn&lt;RegularJumpCommand&gt; (_targetUnit.gameObject); } } }</span></span></code> </pre><br></div></div><br>  The first thing that catches your eye is that the velocity values ‚Äã‚Äãare constant.  So just to make the jump a little higher will not work.  Previously, we would solve this by passing arguments to the jump method, and let's do it here.  Let's rewrite our beautiful team: <br><br><div class="spoiler">  <b class="spoiler_title">Command with arguments</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Command</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] _args; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T ExecuteOn&lt;T&gt;(GameObject target, <span class="hljs-keyword"><span class="hljs-keyword">params</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] args) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Command { T result = target.AddComponent &lt;T&gt;(); result._args = args; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { OnStart (_args); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> {} }</code> </pre><br></div></div><br>  Now the height and direction of our jump can be changed by passing arguments to the team (don't forget to quote).  Since Start () is called a little after the creation of the object, the arguments are passed correctly to our OnStart (object [] args) method. <br><br>  The jump command will remain almost unchanged, but now we can use in it the arguments passed from the outside: <br><br><div class="spoiler">  <b class="spoiler_title">Use of arguments in the command</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RegularJumpCommand</span></span> : <span class="hljs-title"><span class="hljs-title">Command</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnStart (args); gameObject.GetComponent &lt;Rigidbody&gt; ().velocity = (Vector3)args [<span class="hljs-number"><span class="hljs-number">0</span></span>]; } }</code> </pre><br></div></div><br>  The command call changes a bit more: <br><br><div class="spoiler">  <b class="spoiler_title">Call command with arguments</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SomeController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-comment"><span class="hljs-comment">// don't forget to set this in editor public UnitController _targetUnit; private void Start() { if (_targetUnit != null) { Command.ExecuteOn&lt;RegularJumpCommand&gt; (_targetUnit.gameObject, new object[]{new Vector3(0, 10, 0)}); } } }</span></span></code> </pre><br></div></div><br>  After the manipulations, the teams became flexible and a separate class will now only be needed for flips.  But to initialize the parameters, you will only need to use the OnStart (object [] args) method. <br><br>  The second problem that we still have is that every time we jump, we will call the expensive GetComponent () method.  To solve this, let us remember that we still have a controller with Actors, which holds links to all important components and in the team we will ask him everything we need.  We can also pass the controller to the arguments, and I suggest making it a little more formalized.  Let's write for the team a child class with a controller: <br><br><div class="spoiler">  <b class="spoiler_title">Command with controller</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CommandWithType</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">Command</span></span> <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> T Controller { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnStart (args); Controller = args [<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> T; } }</code> </pre><br></div></div><br>  In the command itself, after this, only the number of the argument that we use has changed, but do not forget about that either.  But there was a convenient way to get the controller without resorting to GetComponent ().  And be sure to call base.OnStart (args), otherwise we will not be able to use the controller: <br><br><div class="spoiler">  <b class="spoiler_title">Controller use</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RegularJumpCommand</span></span> : <span class="hljs-title"><span class="hljs-title">CommandWithType</span></span>&lt;<span class="hljs-title"><span class="hljs-title">UnitController</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnStart (args); Controller.AttachedRigidbody.velocity = (Vector3)args [<span class="hljs-number"><span class="hljs-number">1</span></span>]; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Calling the team also became a little different:</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SomeController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-comment"><span class="hljs-comment">//don't forget to set this in editor public UnitController _targetUnit; private void Start() { if (_targetUnit != null) { Command.ExecuteOn&lt;RegularJumpCommand&gt; (_targetUnit.gameObject, new object[]{_targetUnit ,new Vector3(0, 10, 0)}); } } }</span></span></code> </pre><br></div></div><br>  Now everything has become quite good: we have teams that can do without a controller (show advertising, post something somewhere) and commands that need a controller (to go, run, fly).  Commands with a controller are sharpened for work with a family of classes and will not be available for other families, which introduces additional orderliness.  And also we still have the advantages of Actor-in.  And you could not help but notice how small and neat they are.  The controllers also benefited from this: they became the same laconic receptacles for references to the components we need (later, of course, we will give them more weight).  But this is still only the beginning and with such functionality we will not go very far. <br><br>  In order not to go far from the jump, let's see what else we missed.  We bring this awkward, but useful example to a logical conclusion. <br><br>  The first thing that catches your eye: after ten jumps, ten absolutely useless teams will hang on the object.  The second thing to notice is that the velocity changes at the start and this does not guarantee the correct operation of the physics engine. <br><br>  Let's focus on the first, go second and decide on its own, as it happens.  The most logical thing for the team to clean itself is as soon as it fits.  Let's add the command completion functionality and two flags to know if the command completed its execution (more on that later).  And after small transformations, the team evolves (but this is not even its last form). <br><br><div class="spoiler">  <b class="spoiler_title">Team cleaning</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Command</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] _args; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _started = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _isReleased = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsRunning { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _started &amp;&amp; !_isReleased;} } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T ExecuteOn&lt;T&gt;(GameObject target, <span class="hljs-keyword"><span class="hljs-keyword">params</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] args) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Command { T result = target.AddComponent &lt;T&gt;(); result._args = args; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _started = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; OnStart (_args); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDestroy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_isReleased) OnReleaseResources (); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnReleaseResources</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _isReleased = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FinishCommand</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { OnReleaseResources (); Destroy (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnFinishCommand</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{} }</code> </pre><br></div></div><br>  Now, at the right moment, the team, as a decent citizen and a member of society, will self-destruct, just call the FinishCommand () method after all the necessary manipulations.  Destroy () is slightly delayed so that everyone who needs it can use the command before the disappearance (take data from it, but more on that later), and the IsRunning flag is needed by the team itself so that it does not start working ahead of time and does not continue after complete.  All unsubscribing from events and freeing resources can be easily done in OnReleaseResources () or OnFinishCommand ().  And do not be afraid that you accidentally write On <b>Destory</b> () and you will suffer for a long time (as I once did). <br><br>  Now with this all we can solve the second problem: <br><br><div class="spoiler">  <b class="spoiler_title">Change in velocity in FixedUpdate</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RegularJumpCommand</span></span> : <span class="hljs-title"><span class="hljs-title">CommandWithType</span></span>&lt;<span class="hljs-title"><span class="hljs-title">UnitController</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3 _velocity; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnStart (args); _velocity = (Vector3)args [<span class="hljs-number"><span class="hljs-number">1</span></span>]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsRunning) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; Controller.AttachedRigidbody.velocity = _velocity; FinishCommand (); } }</code> </pre><br></div></div><br>  Now the value of velocity will change at the moment of the first iteration of the physics engine after Start-a.  The team at this stage of its development will wonderfully cope with tasks like casting spells, running, various jumps and visual effects. <br><br><h4>  But how ?! </h4><br>  This is not going to take advantage of wherever they want.  If you need to download the config or validate the user's actions (do not let the children buy buns for parental money) or simply use the commands as part of running in zigzags.  Quite often, when it is necessary to know if the team has completed, if it has completed successfully, and if so, take the necessary data from it (for which the destruction was delayed).  In short: you can't figure out here without callbacks.  Personally, I like the new Unity UI system because of them, but only when adding or deleting them comes from the code (it‚Äôs a sin to do this in the editor, don‚Äôt do so). <br><br>  You can do everything on events, you don‚Äôt even need to think, but you don‚Äôt really want to unsubscribe at the right moment to keep references to all running commands.  And the pain just below the back, in the case when I forgot to unsubscribe, very few people can bring pleasure.  Let's first stipulate what we need to do in order to start using the commands in full force and so that there will be no changes.  The main task is to make a callback for successful and not successful completion of the command.  Make them convenient for signing and without having to follow the unsubscribe.  It will also be convenient to transfer the command itself to the callback argument, in order not to keep it as a separate field in the class.  And we have not implemented a way to stop the command from the outside. <br><br>  First: let's make a small wrapper for those same callbacks.  No sooner said than done, we are programmers - simple people.  It turned out like this: <br><br><div class="spoiler">  <b class="spoiler_title">Callback</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Callback</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span> : <span class="hljs-title"><span class="hljs-title">Command</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Action&lt;T&gt; Succeed; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Action&lt;T&gt; Fault; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Callback</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action&lt;T&gt; succeed</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Succeed = succeed; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Callback</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action&lt;T&gt; succeed, Action&lt;T&gt; fault</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Succeed = succeed; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Fault = fault; } }</code> </pre><br></div></div><br>  Simple and convenient.  Note that by default if the callback is one, then we automatically assume that we are only interested in the successful completion of the command and it will be called only in this case.  The next logical step is to make a container for these same callbacks, because one will always be small.  And we got this: <br><br><div class="spoiler">  <b class="spoiler_title">Callbacktoken</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CallbackToken</span></span> &lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">T</span></span> : <span class="hljs-title"><span class="hljs-title">Command</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Callback&lt;T&gt;&gt; _callbacks; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> T _command; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CallbackToken</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T _command</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._command = _command; _callbacks = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Callback&lt;T&gt;&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Callback&lt;T&gt; callback</span></span></span><span class="hljs-function">)</span></span> { _callbacks.Add (callback); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Callback&lt;T&gt; callback</span></span></span><span class="hljs-function">)</span></span> { _callbacks.Remove (callback); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FireSucceed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Callback&lt;T&gt; calback <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _callbacks) { calback.Succeed(_command); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FireFault</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Callback&lt;T&gt; callback <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _callbacks) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (callback.Fault != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { callback.Fault (_command); } } } }</code> </pre><br></div></div><br>  It remains only to add CallbackToken to our team and call it at the right moment.  And do not forget to make the ability to complete the command successfully, not successfully from the outside.  And immediately the final code: <br><br><div class="spoiler">  <b class="spoiler_title">Team with Callback</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Command</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] _args; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _started = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> _isReleased = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CallbackToken&lt;Command&gt; CallbackToken { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { CallbackToken = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CallbackToken&lt;Command&gt; (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsRunning { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _started &amp;&amp; !_isReleased;} } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T ExecuteOn&lt;T&gt;(GameObject target, <span class="hljs-keyword"><span class="hljs-keyword">params</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] args) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Command { T result = target.AddComponent &lt;T&gt;(); result._args = args; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _started = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; OnStart (_args); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDestroy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_isReleased) OnReleaseResources (); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnReleaseResources</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _isReleased = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FinishCommand</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> result = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">true</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsRuning) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; OnReleaseResources (); OnFinishCommand (); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result) CallbackToken.FireSucceed (); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> CallbackToken.FireFault (); Destroy (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-number"><span class="hljs-number">1f</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnFinishCommand</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Terminate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> result = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span> { FinishCommand (result); }</code> </pre><br></div></div><br>  Now the FinishCommand () method will accept the success argument, and the Terminate () method will be used to terminate the command from the outside. <br><br>  Now let's see what a subscription looks like: <br><br><div class="spoiler">  <b class="spoiler_title">Subscribe to Callback</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SomeController</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-comment"><span class="hljs-comment">//don't forget to set this in editor public UnitController _targetUnit; private void Start() { if (_targetUnit != null) { Command.ExecuteOn&lt;RegularJumpCommand&gt; (_targetUnit.gameObject, new object[]{_targetUnit ,new Vector3(0, 10, 0)}) .CallbackToken.AddCallback (new Callback&lt;Command&gt;(OnJumpFinish)); } } private void OnJumpFinish (Command command) { Debug.Log(string.Format("{0}", "Successfully jumped")); } }</span></span></code> </pre><br></div></div><br>  Now we can easily solve the second task: pick up the data from the command (after all, we get it in the callback method), simply by making a public get-er for the necessary information and - voila. <br><br><h4>  The end! </h4><br>  In conclusion, I would like to say that the approach is very good for developing games on Unity.  Everything is simple and beautiful, easy to modify, and utilitarian commands (download, post) are easily transferred to any project.  If you like this article, I will not only be pleased, but also will have an incentive to talk about state machines, MVC, strategies and how it lives and coexists in one project. <br><br>  PS: do not forget that the code here is for informational purposes only and has been tested only in the editor. </div><p>Source: <a href="https://habr.com/ru/post/280306/">https://habr.com/ru/post/280306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280296/index.html">How to clean up the mailbox using a neural network. Part 2</a></li>
<li><a href="../280298/index.html">Pitfalls .load () and .get ()</a></li>
<li><a href="../280300/index.html">Beeline Data School: Spring, Knowledge, New Course</a></li>
<li><a href="../280302/index.html">RSA encryption through the OpenSSL library in Delphi</a></li>
<li><a href="../280304/index.html">Implement a try macro for gcc under win32</a></li>
<li><a href="../280308/index.html">Hackathon Angelhack 2016: a week later in the first of 4 cities</a></li>
<li><a href="../280310/index.html">Simple Yii2 application to send mail</a></li>
<li><a href="../280312/index.html">On the value of cards in the game "Drunkard"</a></li>
<li><a href="../280316/index.html">Flow ... or not serious post about serious things</a></li>
<li><a href="../280318/index.html">Creating your own editing mode in the Unreal Engine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>