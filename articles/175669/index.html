<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PXE boot menu with System Center Configuration Manager</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We consider extending the capabilities of System Center Configuration Manager (product for managing IT infrastructure) when loading custom PCs over th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PXE boot menu with System Center Configuration Manager</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/b63/554/e4c/b63554e4c0ef8ab91c209f402d9216d6.png"><br><br>  We consider extending the capabilities of System Center Configuration Manager (product for managing IT infrastructure) when loading custom PCs over the network using PXE.  Create a boot menu based on PXELinux with System Center functionality and add anti-virus scanning capabilities, diagnostic and repair images.  At the end of the article, we are concerned with the features of the work of System Center 2012 Configuration Manager in conjunction with Windows Deployment Services (WDS) when booting via PXE. <br><br>  All actions are performed on a test environment in which there is already an installed System Center 2012 Configuration Manager SP1, a domain controller and a number of test machines.  It is assumed that SCCM is already deploying over a network using PXE. <br><a name="habracut"></a><br><h3>  Introduction </h3><br>  The test environment consists of several virtual machines.  All machines have Microsoft Windows Server 2008 R2 guest OS (x64), E1000 network adapter, SCSI Controller: LSI Logic SAS <br><table><tbody><tr><th>  Name (Roles) </th><th>  IP address / DNS name </th><th>  Functional </th></tr><tr><td>  SCCM (System Center Configuration Manager) </td><td>  192.168.57.102 <br>  sccm2012.test.local <br></td><td>  Installed System Center Configuration Manager 2012 SP1 </td></tr><tr><td>  DC (AD, DHCP, DNS) </td><td>  192.168.57.10 <br>  dc1.test.local <br></td><td>  The role of the domain controller, DHCP server and DNS server </td></tr><tr><td>  TEST (Test machine) </td><td>  192.168.57.103 <br>  test.test.local <br></td><td>  For testing </td></tr><tr><td>  GW (Gateway) </td><td>  192.168.57.1 </td><td>  Routing between networks.  Gateway role </td></tr></tbody></table><br><h3>  1. Add PXELinux to SCCM </h3><br>  We perform actions on the machine where System Center Configuration Manager is installed <ul><li> Determine the directory where the WDS files are located for download; for this, look at the value of the <code>RootFolder</code> parameter in the <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\WDSServer\Providers\WDSTFTP</code> <br>  The default is <code>C:\RemoteInstall</code> <br>  Downloadable files from the SCCM deployment point are located in the <code>smsboot\x86\</code> and <code>smsboot\x64\</code> directories depending on the architecture. <br>  First, configure the directory for the 32-bit architecture, the default is <code>c:\Remoteinstall\smsboot\x86\</code> </li><li>  Download the archive with the latest <a href="http://www.kernel.org/pub/linux/utils/boot/syslinux/">syslinux</a> .  Copy the following files from syslinux-5.01.zip to <code>c:\Remoteinstall\smsboot\x86\</code> : <br> <code>memdisk, chain.c32, ldlinux.c32, libcom32.c32, libutil.c32, pxechn.c32, vesamenu.c32, pxelinux.0</code> <br>  Additional files are needed to avoid a similar error. <br> <a href=""><img src="https://habrastorage.org/storage2/b19/adb/295/b19adb29531101009506cb3567f5de53.png"></a> <br></li><li>  In <code>c:\Remoteinstall\smsboot\x86\</code> rename <code>pxelinux.0</code> to <code>pxelinux.com</code> <br>  In the folder <code>c:\remoteinstall\smsboot\x86\</code> make a copy of <code>abortpxe.com</code> and rename it to <code>abortpxe.0</code> <br>  If you do not rename the extension <code>.0</code> , then for example the instruction <pre> <code class="bash hljs">Kernel abortpxe.com</code> </pre>  will be executed with an error: Booting kernel failed: Bad file number <br>  For PXELINUX the file extension of the download should be set according to the plate <br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">none</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">or</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">other</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Linux</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">kernel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">image</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">PXE</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bootstrap</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">program</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">NBP</span></span>) <span class="hljs-selector-attr"><span class="hljs-selector-attr">[PXELINUX only]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.bin</span></span> "<span class="hljs-selector-tag"><span class="hljs-selector-tag">CD</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">boot</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sector</span></span>" <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ISOLINUX only]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.bs</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Boot</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sector</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[SYSLINUX only]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.bss</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Boot</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sector</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">DOS</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">superblock</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">will</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">be</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">patched</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">in</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[SYSLINUX only]</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.c32</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">COM32</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">image</span></span> (32<span class="hljs-selector-tag"><span class="hljs-selector-tag">-bit</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">COMBOOT</span></span>) <span class="hljs-selector-class"><span class="hljs-selector-class">.cbt</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">COMBOOT</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">image</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">not</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">runnable</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DOS</span></span>) <span class="hljs-selector-class"><span class="hljs-selector-class">.com</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">COMBOOT</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">image</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">runnable</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DOS</span></span>) <span class="hljs-selector-class"><span class="hljs-selector-class">.img</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Disk</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">image</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ISOLINUX only]</span></span></code> </pre>  <i>Source: <a href="http://www.syslinux.org/wiki/index.php/SYSLINUX">http://www.syslinux.org/wiki/index.php/SYSLINUX#KERNEL_file</a> section ‚ÄúKernel file‚Äù</i> </li><li>  In order not to press the F12 key several times when loading SCCM through the menu, rename pxeboot.com to pxeboot.com.f12, copy pxeboot.n12 to pxeboot.com <br>  If this is not done, then when choosing we will receive such a message every time. <br> <a href=""><img src="https://habrastorage.org/storage2/998/6cb/449/9986cb449a40d1b3318333600a7a7e45.png"></a> <br>  <i>Note: Do not forget to rename these files in the x64 folder too.</i>  <i>when <code>x86\wdsnbp.com</code> from the x86 folder, the boot loader determines the processor architecture and loads the next file from the folder with the corresponding architecture.</i>  <i>Thus, for x64, the following file will not be <code>x86\pxeboot.com</code> , but <code>x64\pxeboot.com</code></i> </li><li>  Download / create <a href="">background.png</a> , resolution 640x480, copy to the same folder.  Create a folder <code>\ISO</code> where we will place the ISO images.  Create a folder <code>\pxelinux.cfg</code> for configs. </li><li>  In the \ pxelinux.cfg folder we create the default file, in a non-unicode encoding, with the contents <br><div class="spoiler">  <b class="spoiler_title">default (Click to display)</b> <div class="spoiler_text"><pre> <code class="hljs dos">#    DEFAULT vesamenu.c32 PROMPT <span class="hljs-number"><span class="hljs-number">0</span></span> timeout <span class="hljs-number"><span class="hljs-number">80</span></span> TOTALTIMEOUT <span class="hljs-number"><span class="hljs-number">9000</span></span> MENU <span class="hljs-built_in"><span class="hljs-built_in">TITLE</span></span> PXE Boot Menu (x86) MENU INCLUDE pxelinux.cfg/graphics.conf MENU AUTOBOOT Starting Local System <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> seconds # Boot local HDD (default) <span class="hljs-built_in"><span class="hljs-built_in">LABEL</span></span> bootlocal menu <span class="hljs-built_in"><span class="hljs-built_in">label</span></span> Boot Local menu default localboot <span class="hljs-number"><span class="hljs-number">0</span></span>x80 # <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> it doesn't work #kernel chain.c32 #<span class="hljs-built_in"><span class="hljs-built_in">append</span></span> hd0 #      Qwerty,  MD5 <span class="hljs-built_in"><span class="hljs-built_in">label</span></span> av menu <span class="hljs-built_in"><span class="hljs-built_in">label</span></span> Antivirus and tools menu PASSWD $<span class="hljs-number"><span class="hljs-number">1</span></span>$<span class="hljs-number"><span class="hljs-number">15</span></span>opgKTx$dP/IaLNiCbfECiC2KPkDC0 kernel vesamenu.c32 <span class="hljs-built_in"><span class="hljs-built_in">append</span></span> pxelinux.cfg\av.conf <span class="hljs-built_in"><span class="hljs-built_in">label</span></span> sccm menu <span class="hljs-built_in"><span class="hljs-built_in">label</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Start</span></span> to SCCM COM32 pxechn.c32 <span class="hljs-built_in"><span class="hljs-built_in">APPEND</span></span> sccm2012.test.local::smsboot\x86\wdsnbp.com -W <span class="hljs-built_in"><span class="hljs-built_in">label</span></span> pxe64 menu <span class="hljs-built_in"><span class="hljs-built_in">label</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Start</span></span> to x64 pxelinux COM32 pxechn.c32 <span class="hljs-built_in"><span class="hljs-built_in">APPEND</span></span> sccm2012.test.local::smsboot\x64\pxelinux.com <span class="hljs-built_in"><span class="hljs-built_in">LABEL</span></span> Abort MENU <span class="hljs-built_in"><span class="hljs-built_in">LABEL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span> KERNEL abortpxe.<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> </div></div>  In the <code>\pxelinux.cfg</code> folder, create the file <code>graphics.conf</code> with the contents <br><div class="spoiler">  <b class="spoiler_title">graphics.conf (Click to display)</b> <div class="spoiler_text"><pre> <code class="cs hljs">MENU MARGIN <span class="hljs-number"><span class="hljs-number">10</span></span> MENU ROWS <span class="hljs-number"><span class="hljs-number">16</span></span> MENU TABMSGROW <span class="hljs-number"><span class="hljs-number">21</span></span> MENU TIMEOUTROW <span class="hljs-number"><span class="hljs-number">26</span></span> MENU COLOR BORDER <span class="hljs-number"><span class="hljs-number">30</span></span>;<span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-meta"><span class="hljs-meta">#00000000 #00000000 none MENU COLOR SCROLLBAR 30;44 #00000000 #00000000 none MENU COLOR TITLE 0 #ffffffff #00000000 none MENU COLOR SEL 30;47 #40000000 #20ffffff MENU BACKGROUND background.png NOESCAPE 0 ALLOWOPTIONS 0</span></span></code> </pre> </div></div>  In the <code>\pxelinux.cfg</code> folder, create an <code>av.conf</code> file with the contents <br><div class="spoiler">  <b class="spoiler_title">av.conf (Click to display)</b> <div class="spoiler_text"><pre> <code class="cs hljs">DEFAULT vesamenu.c32 PROMPT <span class="hljs-number"><span class="hljs-number">0</span></span> MENU TITLE Antivirus and tools MENU INCLUDE pxelinux.cfg/graphics.conf label main menu menu label <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> to main menu kernel vesamenu.c32 append pxelinux.cfg/<span class="hljs-keyword"><span class="hljs-keyword">default</span></span> label drweb menu label DrWeb kernel memdisk append iso raw initrd=iso\drweb.iso label eset menu label Eset kernel memdisk append iso raw initrd=iso\eset_sysrescue.iso label kav menu label KAV Rescue CD KERNEL kav/rescue APPEND initrd=kav/rescue.igz root=live rootfstype=auto vga=<span class="hljs-number"><span class="hljs-number">791</span></span> init=/init kav_lang=ru udev liveimg doscsi nomodeset quiet splash <span class="hljs-meta"><span class="hljs-meta"># ISO   ,     TFTP label winpe menu label WinPE from another TFTP kernel sccm2012.test.local::smsboot\x86\memdisk append iso raw initrd=sccm2012.test.local::smsboot\x86\iso\WinPE_RaSla.iso label clonezilla menu label Clonezilla kernel memdisk append iso raw initrd=iso\clonezilla.iso</span></span></code> </pre></div></div></li><li>  As a result, the directory c: \ remoteinstall \ smsboot \ x86 \ contains the structure <table><tbody><tr><th></th><th>  c: \ remoteinstall \ smsboot \ x86 \ </th><th>  pxelinux.cfg \ </th></tr><tr><td>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br>  \ <br></td><td>  chain.c32 <br>  ldlinux.c32 <br>  libcom32.c32 <br>  libutil.c32 <br>  pxechn.c32 <br>  vesamenu.c32 <br>  pxelinux.com <br>  background.png <br>  pxelinux.cfg \ <br>  pxelinux.cfg \ <br>  pxelinux.cfg \ <br>  ISO \ <br>  abortpxe.0 <br>  <i>wdsnbp.com</i> <i><br></i>  <i>bootmgfw.efi</i> <i><br></i>  <i>wdsmgfw.efi</i> <i><br></i>  <i>bootmgr.exe</i> <i><br></i>  <i>pxeboot.n12</i> <i><br></i>  <i>pxeboot.com</i> <i><br></i>  <i>abortpxe.com</i> <br></td><td>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br><br><br><br><br><br>  default <br>  av.conf <br>  graphics.conf <br>  * .iso <br><br><br><br><br><br><br><br><br></td></tr></tbody></table></li><li>  For x64 architecture, we similarly copy and create the same structure in the folder <code>c:\remoteinstall\smsboot\x64\</code> </li></ul><br><blockquote>  <b>Addition</b> <br>  When using the <code>menu PASSWD</code> you can set the password either as is, or use a hashing algorithm by adding the appropriate signature at the beginning of the parameter <br><table><tbody><tr><th>  Algorithm </th><th>  Signature </th></tr><tr><td>  MD5 </td><td>  $ 1 $ </td></tr><tr><td>  SHA-1 </td><td>  $ 4 $ </td></tr><tr><td>  SHA-2-256 </td><td>  $ 5 $ </td></tr><tr><td>  SHA-2-512 </td><td>  $ 6 $ </td></tr></tbody></table>  Thus for the <code>Qwerty</code> password and MD5 algorithm <pre> <code class="cs hljs">menu PASSWD $<span class="hljs-number"><span class="hljs-number">1</span></span>$<span class="hljs-number"><span class="hljs-number">15</span></span>opgKTx$dP/IaLNiCbfECiC2KPkDC0</code> </pre>  You can generate a password, for example, through an online hash generator <a href="http://www.insidepro.com/hashes.php%3Flang%3Drus">www.insidepro.com/hashes.php?lang=rus</a> , the string <code>MD5(Unix)</code> </blockquote><br><h3>  2. Customize PXELinux boot </h3><br>  Now we specify how to download pxelinux.com and get the menu. <br>  Specifying the pxelinux.com bootloader via WDS functionality does not work in SCCM.  View commands <pre> <code class="vbscript hljs">wdsutil /<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">server</span></span> /bootprogram:boot\x86\pxeboot.com /architecture:x86</code> </pre>  not processed.  Make sure that boot images are not specified by running the WDS server configuration output command <pre> <code class="dos hljs">wdsutil /get-server /show:images</code> </pre> <img src="https://habrastorage.org/storage2/9b3/4ae/cc2/9b34aecc212b4a9c596fa07d124e7ad3.png"><br>  Thus, in SCCM 2012, you cannot specify your download file via PXE for the SMSPXE provider.  Therefore, we will configure the active area of ‚Äã‚Äãthe DHCP server. <br>  In the parameters of the active DHCP area, set the parameters according to the plate <table><tbody><tr><th>  DHCP option </th><th>  Parameter name </th><th>  Value </th></tr><tr><td>  066 </td><td>  Boot server host name </td><td>  sccm2012.test.local </td></tr><tr><td>  067 </td><td>  Bootfile name </td><td>  smsboot \ x86 \ pxelinux.com </td></tr><tr><td>  006 </td><td>  DNS Servers </td><td>  192.168.57.10 </td></tr><tr><td>  015 </td><td>  DNS Domain Name </td><td>  test.local </td></tr></tbody></table>  In option 066 we specify the FQDN name of the sccm server, in option 067 we specify the path to the x86 bootloader pxelinux.com starting from the TFTP root, in option 006 we specify the IP address of the DNS server.  If the option 066 uses the short server name, in option 015 we specify the DNS suffix of the domain. <br><blockquote>  <b>Addition</b> <br>  More details on the DHCP configuration described by <a href="https://habrahabr.ru/users/mvgolubev/" class="user_link">mvgolubev</a> <a href="http://habrahabr.ru/post/82552/">here</a> .  But on <code>DC</code> option 150, the IP address of the TFTP server was missing in the settings of the DHCP area and the indication of option 150 via netsh did not work. <a href=""><img src="https://habrastorage.org/storage2/0a2/918/b3c/0a2918b3cdb953da6e2e436739de52ff.png"></a> </blockquote><br><br><h3>  3. Verification of work </h3><br>  The basic settings are complete and you can start testing.  Indicate on the test computer in the BIOS is loaded over the network and boot into the menu <br> <a href=""><img src="https://habrastorage.org/storage2/c7d/1d0/39e/c7d1d039edde414075b1f62bc072a883.jpg"></a> <br><br>  Select the <code>¬´Start to SCCM¬ª</code> item and if a task sequence is assigned to the computer, then after some time the ‚ÄúTask Sequence Creation Wizard‚Äù window will appear asking you to enter a password <br><img src="https://habrastorage.org/storage2/05e/8b5/f99/05e8b5f99d2f0503e6cd5c5234ed0320.png"><br><br>  Reboot the machine, go back to the menu, select <code>¬´Antivirus and tools¬ª</code> in the menu and enter the password <code>Qwerty</code> <br> <a href=""><img src="https://habrastorage.org/storage2/e32/303/97c/e3230397c5b74e35cc49f81c9577a54a.jpg"></a> <br><br>  Select an arbitrary item and observe the loading of an ISO image into memory <br> <a href=""><img src="https://habrastorage.org/storage2/cc2/838/b85/cc2838b850841513a8559f626483d314.jpg"></a> <br><br>  We are waiting and seeing the result <br> <a href=""><img src="https://habrastorage.org/storage2/a6e/9cc/dbe/a6e9ccdbe62407c77cd879b79ec2fee1.jpg"></a> <br><br>  Verification complete <br><img src="https://habrastorage.org/storage2/352/89b/b0a/35289bb0a50a1b7e0320ca071e7c9ff6.jpg"><br><br><h3>  4. Advanced Settings and Features </h3><br><h5>  Routing Setup </h5><br>  If the client, DHCP server and the server containing the network bootloader are in the same network segment, then no additional configuration is required.  If the client and the DHCP server or the WDS / SCCM server are located in different network segments, it is recommended to configure the routers to forward the broadcast packets from the client to the existing DHCP server and the existing WDS / SCCM server.  In English-language literature, this process is known as ‚ÄúIP Helper table updates‚Äù.  In this case, the client, after receiving the IP address, communicates with the server containing the network bootloader directly through DHCP packets in order to download the network bootloader. <br>  For Cisco routers, use the command <pre> <code class="xml hljs">ip helper-address {ip address}</code> </pre>  where <code>{ip address}</code> address of the DHCP server or the WDS / SCCM server.  When using this command, the following UDP broadcast packets are also sent. <table><tbody><tr><th>  Port </th><th>  Protocol </th></tr><tr><td>  69 </td><td>  Tftp </td></tr><tr><td>  53 </td><td>  Domain Name System (DNS) </td></tr><tr><td>  37 </td><td>  Time service </td></tr><tr><td>  137 </td><td>  NetBIOS Name Server </td></tr><tr><td>  138 </td><td>  NetBIOS Datagram Server </td></tr><tr><td>  67 </td><td>  Bootstrap Protocol (BOOTP) </td></tr><tr><td>  49 </td><td>  Tacacs </td></tr></tbody></table>  The second method for the client to obtain information about the network loader directly from the DHCP server is to specify options 60.66.67 on the DHCP server.  Using DHCP option 60 with <code>¬´PXEClient¬ª</code> value in all DHCP <code>¬´PXEClient¬ª</code> only if the DHCP server is located on the same server as the Windows Deployment Services.  In this case, the client communicates with the Windows Deployment Services server directly via TFTP protocol over UDP port 4011, and not via DHCP.  This method is not recommended by Microsoft due to problems with load balancing, incorrect processing of DHCP parameters and Windows Deployment Services response parameters on the client side.  And also because using only two options 66 and 67 DHCP allows you to bypass the parameters set on the network boot server. <br>  You must also open the following UDP ports on the Windows Deployment Services server. <br>  port 67 (DHCP) <br>  port 69 (TFTP) <br>  port 4011 (PXE) <br>  and port 68, if DHCP authorization is required on the server. <br><blockquote>  The configuration process and the nuances of redirection between different WDS servers are described in more detail in the sources below: <br>  Managing network boot programs <a href="http://technet.microsoft.com/ru-ru/library/cc732351(v%3Dws.10).aspx">http://technet.microsoft.com/ru-ru/library/cc32321 (v=ws.10 ).aspx</a> <br>  Server management <a href="http://technet.microsoft.com/ru-ru/library/cc770637(v%3Dws.10).aspx">http://technet.microsoft.com/ru-ru/library/cc770637(v=ws.10).aspx</a> <br>  Microsoft Product Support Services (PSS) support Microsoft Windows Preinstallation Environment (Windows PE) 2.0 support boundaries <a href="http://support.microsoft.com/kb/926172/en-us">http://support.microsoft.com/kb/926172/en-us</a> <br>  How to forward UDP broadcast (BOOTP / DHCP) on Cisco <a href="http://www.cisco-faq.com/163/forward_udp_broadcas.html">http://www.cisco-faq.com/163/forward_udp_broadcas.html</a> <br>  Features of work and DHCP settings on Cisco routers (Part 2) <a href="http://habrahabr.ru/post/89997/">http://habrahabr.ru/post/89997/</a> </blockquote><br><br><h5>  Additional local boot features </h5><br>  On a test environment, the team <pre> <code class="cs hljs">localboot <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre>  gives this error <br><img src="https://habrastorage.org/storage2/9fd/72f/383/9fd72f383692c8d889f72ab52996c488.png"><br>  From the syslinux documentation, it follows that when <pre> <code class="cs hljs">localboot <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre>  boot will go from local disk.  And if you specify a specific value of 0x00 from the main (primary) floppy disk, if you specify 0x80 from the main (primary) hard disk.  Changing the command to <pre> <code class="cs hljs">localboot <span class="hljs-number"><span class="hljs-number">0x80</span></span></code> </pre>  local OS booted. <br>  If there is a need to boot from a specific disk, partition or <code>localboot</code> command <code>localboot</code> not work, then you can use the capabilities of the <code>chain.c32</code> module.  After it is loaded, the append command specifies a specific disk or partition of the disk, the numbering of the disks starts from 0, the numbering of sections from 1 because  specifying section 0 loads the MBR.  When specifying the disk partition can be omitted. <pre> <code class="cs hljs">KERNEL chain.c32 APPEND hd0 <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre>  or <br><pre> <code class="cs hljs">KERNEL chain.c32 APPEND hd0</code> </pre> <br>  Sources: <a href="http://www.syslinux.org/wiki/index.php/SYSLINUX">http://www.syslinux.org/wiki/index.php/SYSLINUX#LOCALBOOT_type_.5BISOLINUX.2C_PXELINUX.5D</a> <br>  <a href="http://www.gossamer-threads.com/lists/syslinux/users/7127">http://www.gossamer-threads.com/lists/syslinux/users/7127</a> <br><br><h5>  Order and description of downloading files via PXE </h5><br>  As mentioned at the beginning of the article, the directory where the WDS files are located for downloading is contained in the value of the <code>RootFolder</code> parameter in the registry branch <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\WDSServer\Providers\WDSTFTP</code> <br>  The default is <code>C:\RemoteInstall</code> <br>  Here, in the <code>ReadFilter</code> parameter, <code>ReadFilter</code> are directories where the TFTP server searches for files to download, starting from the root.  With SCCM 2012 SP1 installed, this parameter is <pre> <code class="cs hljs">\boot\* \tmp\* \SMSBoot\* \SMSTemp\* \SMSImages\*</code> </pre> <br>  If you change the value of the parameter to <code>\*</code> then all files located in the <code>RemoteInstall</code> directory will be processed. <br><br>  The role of the SCCM 2012 deployment point is specified in the <code>ProvidersOrder</code> registry key located in the <code>HKLM\System\CurrentControlSet\WDSServer\Providers\WDSPXE</code> <br>  <code>ProvidersOrder</code> may be <table><tbody><tr><td>  SMSPXE </td><td>  PXE service point in SCCM </td></tr><tr><td>  SMS.PXE.Filter </td><td>  PXE Script Handler from MDT (Microsoft Deployment Toolkit) </td></tr><tr><td>  BINLSVC </td><td>  Standard handler WDS and RIS </td></tr></tbody></table>  When SCCM is set, the <code>ProvidersOrder</code> parameter is set to <code>SMSPXE</code> .  By changing the parameter, you can change the order of loading providers. <br><br>  The following standard files are located in the <code>RemoteInstall</code> directory. <br><table><tbody><tr><td><pre>  wdsnbp.com </pre></td><td>  A network boot program developed for Windows Deployment Services that performs the following tasks: <br>  1. Discovery architecture. <br>  2. Maintenance of waiting computers.  When the auto-add policy is enabled, this network boot program is sent to the waiting computers to pause the network boot and inform the server of the client computer architecture. <br>  3. Using network boot links (including using parameters 66 and 67 of DHCP) <br></td></tr><tr><td><pre>  PXEboot.com </pre></td><td>  (Default) Requires user to press F12 key to continue network boot </td></tr><tr><td><pre>  PXEboot.n12 </pre></td><td>  Does not require the user to press the F12 key and immediately starts the network boot </td></tr><tr><td><pre>  AbortPXE.com </pre></td><td>  Boot the computer using the next boot item in the BIOS without waiting </td></tr><tr><td><pre>  Bootmgr.exe </pre></td><td>  Windows boot manager (Bootmgr.exe or Bootmgr.efi).  Using the firmware, loads the Windows boot loader from a specific disk partition or via a network connection (in the case of network booting) </td></tr><tr><td><pre>  Bootmgfw.efi </pre></td><td>  The EFI version of the PXEboot.com and PXEboot.n12 programs (in EFI, the choice to load or not load PXE is done in the EFI shell, not by the network boot program).  Bootmgfw.efi combines the features of PXEboot.com, PXEboot.n12, abortpxe.com and bootmgr.exe.  At the moment, it only exists for x64 and Itanium architectures. </td></tr><tr><td><pre>  Default.bcd </pre></td><td>  The boot configuration data store (BCD), REGF format, can be loaded into REGEDIT, replaces the text file Boot.ini </td></tr></tbody></table>  Download takes place in the following order as described above. <br>  1. Loading wdsnbp.com. <br>  2. Next, pxeboot.com of the appropriate architecture is loaded. <br>  3. PXEBoot.com downloads bootmgr.exe and BCD boot configuration data store <br>  4. Bootmgr.exe reads the entries for the operating system BCD boot configuration data and loads the Boot.sdi file and the Windows PE image (boot.wim) <br>  5. Bootmgr.exe starts loading Windows PE by accessing Winload.exe in the Windows PE image <br><br>  If there are folders in <code>RemoteInstall</code> <pre> <code class="cs hljs">\Boot \Images \Mgmt \Templates \Tmp \WdsClientUnattend</code> </pre>  their presence means that before adding the distribution point role to SCCM 2012 (PXE service points in SCCM 2007), there was some action to configure the installed Windows Deployment Services (WDS) that automatically created these folders. <br>  For the distribution point role (PXE service points in SCCM 2007), only the following folders are sufficient <pre> <code class="cs hljs">\SMSBoot \SMSIMAGES \SMSTemp \Stores</code> </pre>  This does not mean that SCCM is installed incorrectly, but may indicate a possible source of errors. <br>  A very detailed solution to the various problems of the WDS, SCCM and PXE bundles is described in the article <a href="http://blogs.technet.com/b/system_center_configuration_manager_operating_system_deployment_support_blog/archive/2011/10/14/troubleshooting-the-pxe-service-point-and-wds-in-configuration-manager-2007.aspx">Troubleshooting the PXE Service Point and WDS in Configuration Manager 2007.</a> <br><br><h3>  Total </h3><br>  In the IT infrastructure managed by System Center Configuration Manager, a new tool has been added for the work of system administrators in the field. <br><br><div class="spoiler">  <b class="spoiler_title">List of links to ISO images (Click to display)</b> <div class="spoiler_text">  <a href="">download.f-secure.com/estore/rescue-cd-3.16-52606.iso</a> <br>  <a href="">git.ipxe.org/releases/wimboot/wimboot-latest.zip</a> <br>  <a href="">download.geo.drweb.com/pub/drweb/livecd/drweb-livecd-602.iso</a> <br>  <a href="">rescuedisk.kaspersky-labs.com/rescuedisk/updatable/kav_rescue_10.iso</a> <br>  <a href="">esetsupport.ru/eset_sysrescue.iso</a> <br>  <a href="">boot.ipxe.org/ipxe.iso</a> <br>  <a href="">citylan.dl.sourceforge.net/project/clonezilla/clonezilla_live_alternative/20130226-quantal/clonezilla-live-20130226-quantal-i386.iso</a> <br>  <a href="">ftp.rasla.ru/_Distr_/WinPE/RaSla/WinPE_RaSla.iso</a> <br>  <a href="">www.kernel.org/pub/linux/utils/boot/syslinux/syslinux-5.01.zip</a> </div></div><br><br>  Thanks for attention! <br><img src="https://habrastorage.org/storage2/5b2/fe6/8fe/5b2fe68fec99b167e53cbabafab4af86.jpg"></div><p>Source: <a href="https://habr.com/ru/post/175669/">https://habr.com/ru/post/175669/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../175657/index.html">Code as an argument in Cach√© ObjectScript</a></li>
<li><a href="../175659/index.html">Globals MUMPS: Extreme Database Programming. Part 1</a></li>
<li><a href="../175661/index.html">Windows Phone and continuous integration into TeamCity</a></li>
<li><a href="../175663/index.html">Installing Nexus 1000V on vSphere 5.1 (Part One)</a></li>
<li><a href="../175665/index.html">Browser Games (Poll)</a></li>
<li><a href="../175671/index.html">Petman from Boston Dynamics is ready to serve</a></li>
<li><a href="../175677/index.html">Counter of individual time counting on pure JavaScript</a></li>
<li><a href="../175681/index.html">The digest of interesting news and materials from the world of ayti for the last week ‚Ññ51 (March 30 - April 5, 2013)</a></li>
<li><a href="../175683/index.html">The first real Russian smartphone?</a></li>
<li><a href="../175685/index.html">GitHub Pages are moving to github.io</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>