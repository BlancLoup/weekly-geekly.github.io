<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Document protection with Scribd, Ruby and Prawn in no more than 15 minutes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="scribd.com - many people know that Scribd allows you to download up to 50,000 files for free and converts them to pdf + provides a good widget for dis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Document protection with Scribd, Ruby and Prawn in no more than 15 minutes</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://scribd.com/">scribd.com</a> - many people know that Scribd allows you to download up to 50,000 files for free and converts them to pdf + provides a good widget for displaying files. <br><br>  But how to make it so that the document was visible only to parts of users, and the other part could see only a small piece of the document?  Of course, everything is extremely simple, as is almost always the case with Ruby and Rails. <br><a name="habracut"></a><br>  The whole process will take 2 iterations, which should be stuffed into the Background job - any one of your choice.  Imagine that a file of any format is already on your server ‚Äî for example, you used Carrierwave to download a file or something your soul likes. Here it is worth clarifying that the file may not be exactly any format, but only - (doc, docx, ppt, pptx, pps, ppsx, xls, xlsx, pdf, ps, odt, odp, sxw, sxi, txt, rtf, epub).  Next, we need to add to the bundler: <br><br><pre><code class="ruby hljs">gem <span class="hljs-string"><span class="hljs-string">'rscribd'</span></span> gem <span class="hljs-string"><span class="hljs-string">'prawn'</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      and don't forget bundle install. <br>  After that, you need to register in Scribd and get the key and secret, which are placed in initializers / scribd.rb (for example) in the form: <br><br><pre> <code class="ruby hljs"> Scribd::API.instance.key = <span class="hljs-string"><span class="hljs-string">'xxxxxxxxxxxxxx'</span></span> Scribd::API.instance.secret = <span class="hljs-string"><span class="hljs-string">'xxxxxxxxxxxxxx'</span></span></code> </pre><br><br>  Everything is ready, now let's move on to the main iterations. <br><br>  1 iteration - loading on scribd of a document that you received in its pure form: <br><br><pre> <code class="ruby hljs"> <span class="hljs-comment"><span class="hljs-comment">#path_to_document -       def scribd_upload path_to_document Scribd::Document.upload file: path_to_document, access: :private end scribd = upload_document path_to_document</span></span></code> </pre><br><br>  The output of the function is written to the scribd variable, which contains doc_id and access_key <br>  We save these variables and with the help of them we can then show a clean document to users. <br>  scribd.doc_id <br>  scribd.access_key <br><br>  Great, we have a clean document uploaded to the Scrybd.  Now the second iteration - creating a document with stubs - for partial display. <br><br>  Here, the Prawn and the second delay job come into force in all its glory.  Her call is worth adding to the end of the first. <br>  So we have scribd_id of your file.  - find it in the scribde - <br><br><pre> <code class="ruby hljs"> scribd = Scribd::Document.find scribd_id</code> </pre><br><br>  Next, download the pdf version of your document to your server via the link that scribd kindly provides us with: <br>  scribd.download_url 'pdf' <br><br>  After that use prawn to add a stub file: <br><br><pre> <code class="ruby hljs"> Prawn::Document.generate(path_to_template_file, <span class="hljs-symbol"><span class="hljs-symbol">:template</span></span> =&gt; path_to_real_file) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|doc|</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>..doc.page_count).each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|page_number|</span></span> doc.image(path_to_gap, <span class="hljs-symbol"><span class="hljs-symbol">:vposition</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:center</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:position</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:center</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:width</span></span> =&gt; x, <span class="hljs-symbol"><span class="hljs-symbol">:height</span></span> =&gt; y) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  path_to_template_file - the path to the file that will be saved with the stubs (it does not exist yet, but prawn will create it for us) <br>  path_to_real_file is the path to a real clean file that we downloaded from scribd in pdf format. <br>  path_to_gap - the path to the picture stub <br><br>  Well, do not forget to put the width and height of this stub (x, y) <br>  Great, now we have a stub file that we upload to the scribed and pick up the id and secret_key, as is the case with the clean file. <br>  Now we have 2 sets of key / secret for displaying the file in its pure form and with stubs, and we can decide which option to show to whom. <br>  Clearly these things are as follows: <br><img src="https://habrastorage.org/storage2/f83/925/b29/f83925b29b97b288dbf09bc70ccafb41.jpg"><br>  This option of working with scribd I personally see, probably, the most promising, because  the user will see the entire file, even if with stubs that do not show him all the content, and will block the main part (the size of the part depends on your choice of the stub). </div><p>Source: <a href="https://habr.com/ru/post/161487/">https://habr.com/ru/post/161487/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../161469/index.html">PHP API in javascript. PHP.JS Overview</a></li>
<li><a href="../161471/index.html">Receive congratulations from radio listeners for listeners</a></li>
<li><a href="../161475/index.html">How to download course materials from coursera.org - quick start guide</a></li>
<li><a href="../161477/index.html">DCIM Automation or Data Center Inventory</a></li>
<li><a href="../161483/index.html">PHP errors: classification, examples, handling</a></li>
<li><a href="../161489/index.html">Silicon freedom: open processor</a></li>
<li><a href="../161493/index.html">Twitter and SMS sender substitution</a></li>
<li><a href="../161495/index.html">Windows Phone 8 for $ 249: Nokia Lumia 620</a></li>
<li><a href="../161497/index.html">Samsung NX cameras: ample opportunities for documentaries</a></li>
<li><a href="../161499/index.html">TCP Models</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>