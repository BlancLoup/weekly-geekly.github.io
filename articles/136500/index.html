<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We investigate protection on the basis of certificates (utm5)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article does not tell about how to make a crack or keygen. There will be a simple study of the protection of a fairly expensive software product....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We investigate protection on the basis of certificates (utm5)</h1><div class="post__text post__text-html js-mediator-article"> This article does not tell about how to make a crack or keygen.  There will be a simple study of the protection of a fairly expensive software product. <br><br>  It so happened that the choice fell on utm5. <br>  The goal was to understand what protection method this software uses, especially since this complex of programs is available both under windows and under linux / freebsd. <br><a name="habracut"></a><br>  I took the unix version, since it was the first experience of researching programs not under windows. <br>  And we will use all the same IDA launched from under wine. <br><br>  Assume that utm5 is loaded, there is a demo key, everything is set up and working.  Well, let's get started: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We take the core of the system (utm5_core) and feed it with IDA.  Let's drink some tea and go back to the computer where IDA will happily report that it has fully analyzed the file. <br><br>  We look at the reg.sql file, and we come to the conclusion that the kernel of the system reads the license from mysql. <br>  Carefully looking at the data, we decide that we are interested in the "hash1, hash2, data" fields. <br><br>  Do a search for the string hash1 in strings, we find: <br><img src="https://habrastorage.org/getpro/habr/post_images/bfe/a70/c98/bfea70c98252bdcd7551007b766749a6.jpg" alt="image"><br><br>  Great, this is a query in the database, so we go to where this string is used, that is, in UTM :: DBAccess :: get_license_info (there are <i>such names only in the unix version, in the windows version there are no such amenities, only abstract names functions</i> ) <br><br>  Having rotated back and forth in UTM :: DBAccess :: get_license_info, we see that data from the table is read here, and at the end either all is good or all is bad: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91d/732/2a9/91d7322a90e553ca94112fb0f61c204d.jpg" alt="image"><br><br>  Therefore, we go to a higher level in main + ABC: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db0/0dc/329/db00dc32964d0e5e4a4d339290260f6d.jpg" alt="image"><br><br>  And we come across a very interesting thing - ‚ÄúCirtificationCenterImpl‚Äù: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cfe/97e/c80/cfe97ec806f37b3f1d8da34ccc5fe632.jpg" alt="image"><br><br>  There is nothing interesting in UTM :: CertificationCenterImpl :: instance (void), so let's enter UTM :: CertificationCenterImpl :: init and see what might be interesting inside: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f3f/f8a/9f0/f3ff8a9f005c4253b6c4a9907bfcd9d5.jpg" alt="image"><br><br>  We see "_d2i_X509" and "_X509_get_pubkey".  A quick search leads us to the fact that these functions are needed to work with <a href="http://ru.wikipedia.org/wiki/X.509">X.509</a> . <br><br>  And now we will pay attention, what data get in _d2i_X509. <br><br>  Just above, we see two functions - ‚ÄúUTM :: HiddenData :: get_data (void)‚Äù and ‚ÄúUTM :: HiddenData :: size (void)‚Äù <br><br>  Open UTM :: HiddenData :: get_data (void): <br><img src="https://habrastorage.org/getpro/habr/post_images/fce/787/227/fce787227a0433a72f04479624a7246d.jpg" alt="image"><br><br>  It is clearly seen that the developers did not want to just "put" the data into the executable file, but did it with the help of a number of mov'ov. <br><br>  The second function simply returns the size of this data: <br><img src="https://habrastorage.org/getpro/habr/post_images/0ec/296/b98/0ec296b98fb833d66846fbb20cca7ce9.jpg" alt="image"><br><br>  Put a breakpoint in GDB in this place: <br><img src="https://habrastorage.org/getpro/habr/post_images/443/cac/255/443cac255f02695ff44c78382834c868.jpg" alt="image"><br><br>  After stopping at this place, you can dump 0x49B characters from memory to an address that is located in eax. <br><br>  We look through either through gcr-viewer, or through console openssl x509 and we see: <br><img src="https://habrastorage.org/getpro/habr/post_images/897/9c4/420/8979c442037daa1742ee594e0f582b5c.jpg" alt="image"><br><br>  Well, we have some kind of certificate, now let's go ahead and examine what happens next: <br><img src="https://habrastorage.org/getpro/habr/post_images/fb9/3a3/cf2/fb93a3cf2dfd68a3cc52dcce590105b1.jpg" alt="image"><br><br>  Next, the program receives the public key from this certificate, and sends it all to "_ZN3UTM23CertificationCenterImpl23CertificateFromKeyStoreEi", and below you can see that the error message is already coming, then the check is here, go to this function and scroll through, stumble on: <br><img src="https://habrastorage.org/getpro/habr/post_images/32f/88d/db0/32f88ddb039f595949dbae80a749b0f1.png" alt="image"><br><br>  Now we can come to the idea that in mysql, in the data field there is another certificate in the pkcs12 format. <br><br>  We extract this data from the reg.sql file, translate into a binary format, since  This is an ascii-hex entry. <br><br>  After saving the data, let's say in the ‚Äúkey‚Äù file, use the command to extract a lot of certificates: <br> <code>openssl pkcs12 -in key -out key.pem</code> <br> <br>  Openssl will ask us for a password.  Give her the password, which came with the key in reg.sql, because  we did not see anything like this in the asm listing. <br><br>  Having entered passwords several times, we get key.pem. <br><br>  We take all the same gcr-viewer, review this key.pem and see: <br><br>  <i>utm5_core</i> <i><br></i>  <i>Authenticity: utm5_core</i> <i><br></i>  <i>Checked: UTM5 SUB CA</i> <i><br></i>  <i>Expires on 03/01/2012</i> <i><br><br></i>  <i>utm5_dealer</i> <i><br></i>  <i>Authenticity: utm5_dealer</i> <i><br></i>  <i>Checked: UTM5 SUB CA</i> <i><br></i>  <i>Expires on 03/01/2012</i> <i><br><br></i>  <i>utm5_dynashape</i> <i><br></i>  <i>Authenticity: utm5_dynashape</i> <i><br></i>  <i>Checked: UTM5 SUB CA</i> <i><br></i>  <i>Expires on 03/01/2012</i> <i><br><br></i>  <i>utm5_hotspot</i> <i><br></i>  <i>Authenticity: utm5_hotspot</i> <i><br></i>  <i>Checked: UTM5 SUB CA</i> <i><br></i>  <i>Expires on 03/01/2012</i> <i><br><br></i>  <i>utm5_radius</i> <i><br></i>  <i>Authenticity: utm5_radius</i> <i><br></i>  <i>Checked: UTM5 SUB CA</i> <i><br></i>  <i>Expires on 03/01/2012</i> <i><br><br></i>  <i>utm5_tel</i> <i><br></i>  <i>Authenticity: utm5_tel</i> <i><br></i>  <i>Checked: UTM5 SUB CA</i> <i><br></i>  <i>Expires on 03/01/2012</i> <i><br><br></i>  <i>Key</i> <i><br></i>  <i>RSA secret key</i> <i><br></i>  <i>Reliability: 1024 bits</i> <br><br>  After reading the <a href="http://citforum.ru/security/cryptography/certificate_authority/">"Practical Guide to Creating a Certification</a> Authority <a href="http://citforum.ru/security/cryptography/certificate_authority/">"</a> , it becomes clear that the license for utm5 is made using certificates, and we have certificates of licenses + pulled out of the program a certificate to verify the authenticity of license certificates. <br><br>  If you select each certificate from the key.pem file into a separate file, then you can view additional fields in the same console utility ‚Äúopenssl x509‚Äù, which contain the limitations of various modules. <br><br>  At this step, the study can be completed, since it is quite clear that it is impossible to generate the necessary license certificate without having a private key, which only NetUP has. <br><br>  Although, in fact, protection has a very large vulnerability further, when those very restrictions are read out - they are transmitted to the program in the form of regular strings, which can be easily changed, either for very large values, or even for ‚Äú-1‚Äù. <br><br>  The license validity period is also limited by the certificate validity period, so this place can also be patched, and the program will work even after the certificate expires. <br><br>  But a more elegant method would be to create your own certificates, with the values ‚Äã‚Äãwe need.  The program will be able to accept them, since we simply take and insert our verification certificate into the program, replacing the code of the functions ‚ÄúUTM :: HiddenData :: get_data (void)‚Äù and ‚ÄúUTM :: HiddenData :: size (void)‚Äù with your own, and utm5 will work even until 2050, but is it necessary? </div><p>Source: <a href="https://habr.com/ru/post/136500/">https://habr.com/ru/post/136500/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136492/index.html">Search on a site is not only search on a site</a></li>
<li><a href="../136493/index.html">One step closer to Star Trek, OLED panels at CES</a></li>
<li><a href="../136494/index.html">New service Payoneer: First of all cards, and partners only then ...</a></li>
<li><a href="../136495/index.html">Withdrawal of funds from freelance exchanges</a></li>
<li><a href="../136499/index.html">Jerry Yang permanently left Yahoo</a></li>
<li><a href="../136501/index.html">Two startups</a></li>
<li><a href="../136502/index.html">NXP Semiconductors Introduces Solar Lighting System</a></li>
<li><a href="../136504/index.html">Why the UEFI Secure boot is a challenge for Linux</a></li>
<li><a href="../136505/index.html">impress.js - CSS3 presentations tearing up the template</a></li>
<li><a href="../136506/index.html">ABBYY Labs - what's new?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>