<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>IOS widget development widget</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Notification Center is a convenient and easy-to-use feature in iOS, but it is limited only by standard widgets. It's no secret that jailbreak lovers h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>IOS widget development widget</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/974/b6b/aae/974b6baaebfcbb196b604a9769f217c9.jpg"><br><br>  Notification Center is a convenient and easy-to-use feature in iOS, but it is limited only by standard widgets.  It's no secret that jailbreak lovers have long been using third-party tweaks, but there is practically no information about their development.  In this article I will try to fix it and describe the process of creating a widget to check the balance of my Internet provider using the example. <br><a name="habracut"></a><br><br>  To develop a widget, we need Xcode, an experimental device with iOS 5.x and access to its file system, and we will use <a href="http://iosopendev.com/">iOSOpenDev</a> as a template for the widget, detailed instructions for installing it are on the developer‚Äôs website. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If everything is ready, proceed! <br><br>  Launch Xcode and create a new project: <br>  Open iOSOpenDev item in the iOS category and select NotificationCenter Widget. <br><br><img src="https://habrastorage.org/storage2/4fc/bdf/028/4fcbdf028a34437fadd303c5c52421cc.png"><br><br>  So, we have the code of the ready (but empty) widget.  We can already compile it by clicking Cmd + Shift + I (or selecting Product&gt; Build for&gt; Build for profiling in the menu), as a result of which we will get the installation .deb file, which is located in the Our Project / Packages directory. <br><br>  In the properties of the project, you can make the file immediately installed on the device, you need SSH and Wi-Fi, but this article was written where there was no wireless network, so we need any iOS file manager (for example, iExplorer) installed on iFile device <br><br>  We copy our (yet empty) widget to the device at any place convenient for you, and install it via iFile, then do Respring or reboot the device, it is necessary that the Notification Center see our widget. <br><br>  Now, if you open Notification Center, then ... the widget will not be there, it still needs to be turned on.  Open Settings&gt; Notifications&gt; Your Widget and turn it on! <br><img src="https://habrastorage.org/storage2/2b5/23d/f28/2b523df28fedb8d123be1721f69a6243.png"><br><br>  On this introduction is over. <br>  Start writing a balance check widget! <br><br>  Officially, my provider does not provide an API to check the status of an account, but I spied the necessary code in the Windows gadget. <br>  The process is quite simple, https opens, the address of which contains the login and password, and xml is answered. <br><br>  The standard weather widget has an interesting feature; you can ‚Äúflip through‚Äù it to view the weather for a week; we will take this idea to place two UITextFiled (login / password). <br><br>  Add the following code to the .h file: <br><pre><code class="bash hljs">UIScrollView *sv; UIView *balanceView, *settingsView; UITextField * loginField; UITextField * passField;</code> </pre> <br><br>  And in the .m file, add a few UILabel and fix the code for this one: <br><br><pre> <code class="bash hljs">- (UIView *)view { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_view == nil) { _view = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 320, 71)]; UIImage *<span class="hljs-built_in"><span class="hljs-built_in">bg</span></span> = [[UIImage imageWithContentsOfFile:@<span class="hljs-string"><span class="hljs-string">"/System/Library/WeeAppPlugins/balance.bundle/WeeAppBackground.png"</span></span>] stretchableImageWithLeftCapWidth:5 topCapHeight:71]; UIImageView *bgView = [[UIImageView alloc] initWithImage:<span class="hljs-built_in"><span class="hljs-built_in">bg</span></span>]; bgView.frame = CGRectMake(2, 0, 316, 71); UIImageView *bgSet = [[UIImageView alloc] initWithImage:<span class="hljs-built_in"><span class="hljs-built_in">bg</span></span>]; bgSet.frame = CGRectMake(6, 0, 316, 71); sv = [[[UIScrollView alloc] initWithFrame:CGRectMake(0, 0, 320, 71)] autorelease]; sv.contentSize = CGSizeMake(2 * 320, 71); sv.pagingEnabled = YES; sv.delegate = self; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int i = 0; i &lt; 1; i++) { balanceView = [[UIView alloc] initWithFrame:CGRectMake(i * 316, 0, 316, 71)]; [balanceView addSubview:bgView]; lblName = [[UILabel alloc] initWithFrame:CGRectMake(9, 5, 285, 15)]; lblName.backgroundColor = [UIColor clearColor]; lblName.textColor = [UIColor whiteColor]; lblName.font = [UIFont systemFontOfSize: 12.0]; lblName.text = @<span class="hljs-string"><span class="hljs-string">"  "</span></span>; lblName.alpha = 1; [balanceView addSubview:lblName]; [lblName release]; lblText = [[UILabel alloc] initWithFrame:CGRectMake(9, 18, 75, 15)]; lblText.backgroundColor = [UIColor clearColor]; lblText.textColor = [UIColor whiteColor]; lblText.font = [UIFont systemFontOfSize: 12.0]; lblText.text = @<span class="hljs-string"><span class="hljs-string">" :"</span></span>; lblText.alpha = 0.6; [balanceView addSubview:lblText]; [lblText release]; lblDate = [[UILabel alloc] initWithFrame:CGRectMake(9, 38, 114, 28)]; lblDate.backgroundColor = [UIColor clearColor]; lblDate.textColor = [UIColor whiteColor]; lblDate.font = [UIFont systemFontOfSize: 12.0]; lblDate.numberOfLines = 2; lblDate.text = @<span class="hljs-string"><span class="hljs-string">"   0 "</span></span>; lblDate.alpha = 0.6; [balanceView addSubview:lblDate]; [lblDate release]; lblBalance = [[UILabel alloc] initWithFrame:CGRectMake(135, 22, 175, 45)]; lblBalance.backgroundColor = [UIColor clearColor]; lblBalance.textColor = [UIColor whiteColor]; lblBalance.font = [UIFont fontWithName: @<span class="hljs-string"><span class="hljs-string">"Helvetica-Light"</span></span> size: 45.0]; lblBalance.textAlignment = UITextAlignmentRight; lblBalance.text = @<span class="hljs-string"><span class="hljs-string">"0.0"</span></span>; lblBalance.alpha = 1; [balanceView addSubview:lblBalance]; [lblBalance release]; [sv addSubview:balanceView]; [balanceView release]; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int i = 1; i &lt; 2; i++) { settingsView = [[UIView alloc] initWithFrame:CGRectMake(i * 316, 0, 316, 71)]; [settingsView addSubview:bgSet]; loginField = [[UITextField alloc] initWithFrame:CGRectMake(330, 7, 300, 25)]; loginField.borderStyle = UITextBorderStyleRoundedRect; loginField.textColor = [UIColor blackColor]; loginField.font = [UIFont systemFontOfSize:14.0]; loginField.placeholder = @<span class="hljs-string"><span class="hljs-string">""</span></span>; loginField.backgroundColor = [UIColor whiteColor]; loginField.autocorrectionType = UITextAutocorrectionTypeNo; loginField.keyboardType = UIKeyboardTypeDefault; loginField.returnKeyType = UIReturnKeyNext; loginField.clearButtonMode = UITextFieldViewModeWhileEditing; loginField.keyboardAppearance = UIKeyboardAppearanceAlert; loginField.delegate = self; loginField.tag = 999; [sv addSubview:loginField]; passField = [[UITextField alloc] initWithFrame:CGRectMake(330, 39, 300, 25)]; passField.borderStyle = UITextBorderStyleRoundedRect; passField.textColor = [UIColor blackColor]; passField.font = [UIFont systemFontOfSize:14.0]; passField.placeholder = @<span class="hljs-string"><span class="hljs-string">""</span></span>; passField.secureTextEntry = TRUE; passField.backgroundColor = [UIColor whiteColor]; passField.autocorrectionType = UITextAutocorrectionTypeNo passField.keyboardType = UIKeyboardTypeDefault; passField.returnKeyType = UIReturnKeyDone; passField.clearButtonMode = UITextFieldViewModeWhileEditing; passField.keyboardAppearance = UIKeyboardAppearanceAlert; passField.delegate = self; [sv addSubview:passField]; [sv addSubview:settingsView]; [settingsView release]; } [bgView release]; [_view addSubview:sv]; [[loginField superview] bringSubviewToFront:loginField]; [[passField superview] bringSubviewToFront:passField]; [sv setShowsHorizontalScrollIndicator:NO]; [sv setShowsVerticalScrollIndicator:NO]; } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> _view; }</code> </pre><br><br>  Thus, we created a UIScrollView, added 2 normal Views to it, assigned them a background and placed not the first several labels, but on the second two UITextFields to enter the login and password. <br>  Next, we will add functionality to our UITextField, make a transition from the Login field to the Password field via the Next button and save the data to the Done button on the keyboard: <br><br><pre> <code class="bash hljs">-(BOOL)textFieldShouldReturn:(UITextField *)textField { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (textField.tag == 999) { [passField becomeFirstResponder]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { NSUserDefaults *prefs = [NSUserDefaults standardUserDefaults]; [prefs setObject:loginField.text forKey:@<span class="hljs-string"><span class="hljs-string">"login"</span></span>]; [prefs setObject:passField.text forKey:@<span class="hljs-string"><span class="hljs-string">"pass"</span></span>]; [prefs synchronize]; [textField resignFirstResponder]; } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> YES; }</code> </pre><br><br>  And it is also necessary to make the keyboard hide if the user changes his mind to enter data: <br><br><pre> <code class="bash hljs">- (void) scrollViewDidScroll: (UIScrollView *) aScrollView { [loginField resignFirstResponder]; [passField resignFirstResponder]; }</code> </pre><br><br>  Now we will start the parser, at the beginning we will do so that the widget's activity does not begin when the user only starts opening NC, but after a certain time.  Use the timer.  Run it at the time of opening NC: <br><br><pre> <code class="bash hljs">- (void)viewWillAppear { [NSTimer scheduledTimerWithTimeInterval:1 target:self selector:@selector(getBalance) userInfo:nil repeats:NO]; }</code> </pre><br><br>  And in one second we execute getBalance: <br><br><pre> <code class="bash hljs">- (void)getBalance { NSUserDefaults *prefs = [NSUserDefaults standardUserDefaults]; NSString *gnLookup = [NSString stringWithFormat: @<span class="hljs-string"><span class="hljs-string">"https://billing.novotelecom.ru/billing/user/api/?method=userInfo&amp;login=%@&amp;password=%@"</span></span>, [prefs objectForKey:@<span class="hljs-string"><span class="hljs-string">"login"</span></span>], [prefs objectForKey:@<span class="hljs-string"><span class="hljs-string">"pass"</span></span>]]; NSXMLParser *gnParser = [[NSXMLParser alloc] initWithContentsOfURL: [NSURL URLWithString:gnLookup]]; [gnParser setDelegate:self]; [gnParser parse]; } - (void)parser:(NSXMLParser *)parser didStartElement:(NSString *)elementName namespaceURI:(NSString *)namespaceURI qualifiedName:(NSString *)qualifiedName attributes:(NSDictionary *)attributeDict { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([elementName compare:@<span class="hljs-string"><span class="hljs-string">"name"</span></span>] == NSOrderedSame) { ntkUser = [[NSMutableString alloc] initWithCapacity:4]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([elementName compare:@<span class="hljs-string"><span class="hljs-string">"days2BlockStr"</span></span>] == NSOrderedSame) { ntkUpToDate = [[NSMutableString alloc] initWithCapacity:4]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([elementName compare:@<span class="hljs-string"><span class="hljs-string">"balance"</span></span>] == NSOrderedSame) { ntkBalance = [[NSMutableString alloc] initWithCapacity:4]; } } - (void)parser:(NSXMLParser *)parser foundCharacters:(NSString *)string { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ntkUser &amp;&amp; string) { [ntkUser appendString:string]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ntkUpToDate &amp;&amp; string) { [ntkUpToDate appendString:string]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ntkBalance &amp;&amp; string) { [ntkBalance appendString:string]; } } - (void)parser:(NSXMLParser *)parser didEndElement:(NSString *)elementName namespaceURI:(NSString *)namespaceURI qualifiedName:(NSString *)qName { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([elementName compare:@<span class="hljs-string"><span class="hljs-string">"name"</span></span>] == NSOrderedSame) { lblName.text = [NSString stringWithFormat:@<span class="hljs-string"><span class="hljs-string">"%@"</span></span>, ntkUser]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([elementName compare:@<span class="hljs-string"><span class="hljs-string">"days2BlockStr"</span></span>] == NSOrderedSame) { lblDate.text = [NSString stringWithFormat:@<span class="hljs-string"><span class="hljs-string">"%@"</span></span>, ntkUpToDate]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([elementName compare:@<span class="hljs-string"><span class="hljs-string">"balance"</span></span>] == NSOrderedSame) { lblBalance.text = [NSString stringWithFormat:@<span class="hljs-string"><span class="hljs-string">"%@"</span></span>, ntkBalance]; } }</code> </pre><br><br>  Click Cmd + Shift + I, copy deb, install and do respring (you need it every time if you install the widget through the deb file). <br><br><img src="http://habrastorage.org/storage2/d9f/be9/a7d/d9fbe9a7dec9b154cb0f25e9d4e2b7dd.png"><img src="http://habrastorage.org/storage2/1d0/293/736/1d0293736fe96edbc702babb82cbff1c.png"><br><br>  On this, perhaps, everything, the widget can and should be improved, add a check for internet connection, improve the display of textfields, add a shadow to the labels, etc., both visual and software.  But the essence of the article is to push people to write widgets, and maybe, one day, Apple will open us the API Notification Center. <br><br>  <b><a href="https://github.com/iSheeZ/Novotelecom-Balance-iOS-5-Widget">GitHub</a> Code</b> <br><br>  Successes! </div><p>Source: <a href="https://habr.com/ru/post/138032/">https://habr.com/ru/post/138032/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138021/index.html">Samsung and Apple control over 90% of the mobile phone market</a></li>
<li><a href="../138024/index.html">A bit of history: who is Anonymous</a></li>
<li><a href="../138025/index.html">Violations of Nielsen heuristics on Mac OS</a></li>
<li><a href="../138027/index.html">Planning a campaign launch in Yandex.Direct? It is better to lose a day, then fly in five minutes!</a></li>
<li><a href="../138030/index.html">Flash, Flex, ActionScript - share options for setting up a programming environment in Ubuntu GNU \ Linux</a></li>
<li><a href="../138033/index.html">Experts from Zvelo Labs found a vulnerability in Google Wallet</a></li>
<li><a href="../138035/index.html">Google creates its own home media system</a></li>
<li><a href="../138037/index.html">A closer look at mobile interface templates</a></li>
<li><a href="../138039/index.html">Reddwarf on the example of the online game "Stone-Scissors-Paper": Client</a></li>
<li><a href="../138042/index.html">Project ‚ÄúSolve for X‚Äù: a new way to increase the range of radio communications is presented</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>