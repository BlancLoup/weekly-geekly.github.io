<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kalman filter - is it difficult?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I recently read a post from Augmented Reality that mentions Kalman Filter in comparison to a simpler alpha beta filter. I have long been planning to c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kalman filter - is it difficult?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/3f0b63a5/904c18e4/78239d3d/71694f41.gif" align="left">  I recently read a post from Augmented Reality that mentions Kalman Filter in comparison to a simpler alpha beta filter.  I have long been planning to compose something like a snippet for compiling a FC, and now I think it's about time.  In the article I will tell you how in practice you can make an advanced FC without particularly troubling yourself with highly scientific reflections and deep theoretical research. <br clear="left"><a name="habracut"></a><br><h4>  Basic concepts </h4><br><ol><li>  The input-output equation is a differential equation (for example, composed by the Lagrange equations of the second kind), in which the left side of the equal sign contains terms depending on the output variable (the generalized coordinates of the system‚Äôs own motion), and on the right side the terms with input variable or free members.  For simplicity, we can give the following example: for the pendulum, the left side of the "input-output" equation will be composed of terms with an angle of deviation of the load from the rest position, and on the right-hand side - the terms with gravity and other external forces.  How I get such equations I will not describe - there is no need to complicate the publication of useless theoretical calculations.  Below I will show that you can get by using convenient methods. </li><li>  The transfer function (PF) is the ratio of the output to the input, or rather, the output variable to the input.  According to the rule of proportion, after the removal of <s>brain</s> variables by brackets, the transfer function will be equal to the ratio of the left part, recorded in the operator form, to the right part. </li><li>  Operator form of the record - the equation ‚Äúinput-output‚Äù is written in it after changing the form: s = d / dt and x (t) -&gt; x (s).  As a result, the equation of the form: <br>  a1 * x '' + a2 * x '+ a3 * x = b1 * u' + b2 * u, <br>  converted to the form: <br>  (a1 * s ^ 2 + a2 * s + a3) * x (s) = (b1 * s + b2) * u (s). <br>  In this case, the transfer function will be: <br>  W (s) = x (s) / u (s) = (b1 * s + b2) / (a1 * s ^ 2 + a2 * s + a3) </li></ol><br><h4>  Task </h4><br>  As an application for the FC, we take the task of processing information of the sensor unit (see <a href="http://habrahabr.ru/blogs/algorithm/114513/">[1]</a> ).  We have four units of two-axis micromechanical accelerometers (MMA).  Only 8 measuring channels, for each of which you can make a separate equation of the type "input-output".  Here it should be noted that some of the manufacturers of sensors (for example, Analog Devices) provide an approximate linearized (this is important in our case) mathematical model.  When working on a diploma, I received a model for MatLab from my colleagues.  But even if the manufacturer <s>clicks vigorously</s> guards his secrets, the trouble is small.  If we talk about accelerometers from AD, then their bandwidth for many practical tasks is large.  For example, the ADXL203 band, if memory does not change, 10kHz.  As an acoustic sensor, it does not roll (does not reach hundreds of kHz), and for civilian use on mobile objects (cars, yachts, scooters, bicycles, baby carriages) or in the gaming industry (it‚Äôs hardly possible for a person to wave with a frequency of 10 Hz ) such a band is excessive. <br>  Thus, we ourselves can make the model of sensors we need.  And in this way we kill two birds with one stone: we make up a simple linearized model and introduce noise filtering at the lowest level.  About the simplicity of the model, it should be noted that when using an equation that accurately describes the dynamics of the sensor, we will be forced to compose the Kalman filter matrices from numbers whose orders are very different.  In the ‚Äúfrom the manufacturer‚Äù model for the accelerometers mentioned, the ratio of the maximum to the minimum coefficient is of the order of 1e + 10.  This leads to severely low conditional calculations, i.e.  a small error in setting the coefficient value can lead to a very large computational error.  Narrowing the bandwidth embedded in the mathematical model, we essentially increase the stability of the calculations. <br>  So how to make this very model?  Yes, very simple.  Using MatLab or Octave packages and specifying the bandwidth we need (LPF, HPF or bandpass filter), using a spear method or using plug-ins in packets, we synthesize the PF.  It should be noted here that the MatLab package includes a visual means of synthesis of a discrete filter.  In Octave, I haven‚Äôt found an analogue yet.  In both packets, you can build frequency response and phase response graphs, which need to pay attention to the frequency (or frequencies) of the cutoff, as well as fluctuations in the frequency response graph in and out of the passband.  In general, the shaman with the coefficients of the transfer function until the graphs of the frequency response and phase response does not satisfy us.  For myself, I have already outlined another, more <s>lazy</s> simple way, namely, to use genetic algorithms for identification.  It is only necessary to implement the reference samples "input - output" and organize the evolutionary process.  But from a scientific point of view, the stated ‚Äúmethods‚Äù are invalid. <br><h4>  Mathematical model </h4><br>  And so for simplicity, we agree that there is an equation in operator form: <br><img src="https://habrastorage.org/storage/2c6ca920/2cda7caa/dda35d01/13eaf555.png"><br>  This is one of the most common second order dynamic equations.  In this equation a2 - plays the role of the spring constant (the stiffness force is directly proportional to the distance of the position of the sensitive element from the rest position);  1 - damping coefficient (force proportional to the speed of movement; think of honey - it is easier to move the spoon in it slowly than quickly);  a0 - characterizes inertia.  In the coefficients to the right of the equal sign, a slightly different meaning is inserted.  These coefficients characterize the effectiveness of exposure in different orders of derivatives.  Here it is important to understand that the requirement of physical realizability limits the maximum order of the right derivative to the maximum order of the derivative of the left side. <br>  Having obtained such an equation, we can begin the preparation for compiling the Kalman filter.  To do this, we first need to convert the input-output equation to the state-space model.  This is done using a transformation to the ‚ÄúCauchy form‚Äù. <br>  First you need to convert to the form of proportions and introduce a new (dummy) variable: <br><img src="https://habrastorage.org/storage/93552d3e/a3c10ac6/96e028c5/77a4774c.png"><br>  As a result, we obtain the system of equations: <br><img src="https://habrastorage.org/storage/14375ab7/56e99ea5/68fb91d1/33c5ac90.png"><br>  In this system, the first equation is the equation of the dynamic process, and the second is the equation of observation. <br>  We give the first equation to the Cauchy form (to the system of first order differential equations) by replacing x1 = x: <br><img src="https://habrastorage.org/storage/4212e2b0/f62e8da4/9a836e7d/1fef1137.png"><br>  For the convenience of recording replacements in this system, the inverse transformation was performed. <br>  Laplace (transition from operator to differential form).  As a result, we broke <br>  original equation for two first order equations.  The input variables x1 and x2 are called ‚Äústate variables‚Äù or ‚Äúphase coordinates‚Äù.  The resulting system operates with "continuous" time.  We made it according to the initial differential equations.  But we need to build a difference algorithm (algorithm in discrete time) to calculate the value of phase coordinates in a recurrent way in a computer.  Therefore, before using the Kalman filter, this system will need to be "sampled."  But more about that later. <br>  Now we need to make the observation equation for the entered phase coordinates.  Taking into account <br>  introduced substitutions and in differential form we get: <br><img src="https://habrastorage.org/storage/3105bdc8/b80e0907/fcf50b04/1937f4fc.png"><br>  It remains to rewrite the resulting equations in vector-matrix form, pre-arranging the terms in accordance with the indices of the phase coordinates: <br><img src="https://habrastorage.org/storage/3ee74c3f/736f9ae9/b156c938/4f791b80.png"><br>  In this equation <br><img src="https://habrastorage.org/storage/372e676d/03638686/6944a3a0/ab00fc3e.png"><br>  To discretize these equations, use the following expressions: <br><img src="https://habrastorage.org/storage/76a7326a/c4dd35ba/e21d9408/3c5cecb9.png"><br>  where I is the identity matrix, F and R are the desired discretized matrices of the state space model (difference equations), ts is the quantization period. <br>  The quantization period is a key element in discretization.  The smaller it is, the more accurate <br>  repeats the discrete model behavior of the model with continuous time.  Also, when <br>  too large ts values ‚Äã‚Äãdue to computational errors, the discrete model will become <br>  unstable.  If the object is not highly dynamic (for example, a low-pass filter with <br>  bandwidth up to 10 Hz), then the quantization period can be chosen large enough.  For <br>  The quantization period mentioned in the low-pass filter can be selected with a large margin of 0.01 sec. <br>  So, we have a discrete model of the form: <br><img src="https://habrastorage.org/storage/8cc9cccb/54ba3259/443655b8/e7b083dc.png"><br>  Now everything is ready for drawing up the FK model.  We just have to build diagonally the F, R, and C matrixes for each measuring channel. For 8 measuring channels, for each of which a discrete own matrix F with dimensions of 2x2 is composed, we get our own Kalman filter matrix A (see the image at the beginning of the publication ) with sizes 16x16.  We also deal with the column vector R: 2x1 * 8 channels = 16x8 - matrix B in the FK model.  From the row vectors C, the matrix H is composed of a Kalman filter (8x16). <br>  Done!  Next you need to program it all.  Personally, I prefer to use Ruby + NArray for this - it is a pleasure to prototype with this bundle, but this is my personal opinion ... as someone.  Just keep in mind that you should not program these equations in the forehead - the resulting matrices are strongly sparse with zeros.  If you think about it, then all matrix expressions can be divided into block operations.  Here you need to optimize a lot of things at the implementation stage. <br><br><h4>  Conclusion </h4><br>  Sorry for some confusion in notation.  Formulas were twitching from different works.  I will try to briefly explain what is what in the equations of FC on the image at the beginning of the post. <br>  The first thing that can be noticed is the matrices P, Q, R, K. These are, respectively, the covariance matrix of estimation errors (errors in solving the FK problem), the dynamic process noise and measurement noise covariations matrix, and the Kalman filter gain matrix.  Vectors "x" and "z" are the phase vector of the PC (imitation of the phase vector of the sensor unit inside the FC model) and the vector of the output signals of the real sensors (in fact, it is a channel for receiving information from the outside in the FC).  From the presented diagram it is easy to understand the principle of operation of FC. <br>  It seems nothing complicated.  However, in the work of FC there are a number of important nuances.  So FC is designed as an algorithm that gives the smallest root-mean-square error if several conditions (hypotheses) are observed.  First, the noises are white (uniform spectral characteristic) with a Gaussian distribution of random variables.  But in practice, this hypothesis does not hold, because  It is difficult to find a source of noise with such ideal parameters.  In addition, the measuring systems themselves have finite bandwidths.  In this case, the phase vector FC need to include more and variables for noise processes.  An artificial approach is used: it is believed that we have a source of white noise, the signal from which passes through a filter.  Thus, a model of two more dynamic objects is added to the FK model - filters that convert a pair of white noise processes into colored noise of the dynamic process and measurement noise. <br>  The second hypothesis is the uncorrelated noise of different measuring channels.  It is also rarely performed and again there are artificial methods to circumvent this limitation.  All these methods lead to an increase in the dimensionality of the FK =&gt; increase the computational load. <br>  The subtleties of the work of FC complicate the lives of <s>botanists of</s> scientists, but often for practical applications it is more important to reduce the dimension of FC rather than meet certain theoretical requirements.  We are looking for an approximate solution by numerical methods, rather than an exact analytical solution with a clear theoretical justification.  Although someone like ... <br><br><h4>  Bibliography </h4><br><ol><li>  <a href="http://habrahabr.ru/blogs/algorithm/114513/">Non-orthogonal bees for small UAVs</a> </li><li>  <a href="http://habrahabr.ru/blogs/augmented_reality/118192/">habrahabr.ru/blogs/augmented_reality/118192</a> </li><li>  Brammer K., Ziffling G. Kalman-Bucy Filter.  Per.  with him.  - M .: Science.  the main <br>  editors of physical and mathematical literature.  1982 </li><li>  Sizikov V.S.  Sustainable methods of processing measurement results.  Tutorial. <br>  - SPb .: ‚ÄúSpecLit‚Äù, 1999. - 240 p. </li><li>  Greg Welch, Gary Bishop.  An Introduction to the Kalman Filter.  TR 95-041, Department of <br>  Computer Science, University of North Carolina at Chapel Hill.  April 5, 2004. </li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/120133/">https://habr.com/ru/post/120133/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120126/index.html">Some kindness and songs</a></li>
<li><a href="../120128/index.html">Minus to minus gives ...</a></li>
<li><a href="../120130/index.html">WebVisor stops working: good replacement provided, but the sediment remained</a></li>
<li><a href="../120131/index.html">Scanning electron microscopy of a fly's eye in artificial colors</a></li>
<li><a href="../120132/index.html">Selection of a company for detailed overlay of processes according to the ITIL model</a></li>
<li><a href="../120139/index.html">Google Chrome no longer supports the Gmail Offline feature.</a></li>
<li><a href="../120140/index.html">Many sites on one page</a></li>
<li><a href="../120143/index.html">Why not buy Duke Nukem Forever in the original on Steam?</a></li>
<li><a href="../120145/index.html">ChucK - sound programming</a></li>
<li><a href="../120146/index.html">Overview of the needs of customers sites</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>