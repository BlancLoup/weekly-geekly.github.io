<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Windows Server 2008 R2 - The King Is Dead, Long Live The King</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 14/01/2020 is approaching and this date marks the end of extended support for Windows Server 2008 R2, and if you are still using Windows Ser...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Windows Server 2008 R2 - The King Is Dead, Long Live The King</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/8y/mw/mb/8ymwmb8srnrvkgraayebcfvtg1s.png"><br><br>  Hi, Habr!  14/01/2020 is approaching and this date marks the end of extended support for Windows Server 2008 R2, and if you are still using Windows Server 2008 R2, you should think about migrating to a more up-to-date platform. <br><br>  Under the cat there is a small comparison of the consumed resources of the old and new Windows Server platforms - the role of RDSH.  First of all, I was interested in the opportunity to continue using the already available HP G6 / G7 servers running VMware Vsphere 5.5. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Information about Windows Server Lifecycle is available at this link <a href="https://support.microsoft.com/en-us/lifecycle/search/1163">Search Product Lifecycle</a> . <br><a name="habracut"></a><br><h4>  I will have two test stands: </h4><br><ol><li>  HP DL120 G7, 1 * cpu <a href="https://ark.intel.com/content/www/us/en/ark/products/52273/intel-xeon-processor-e3-1240-8m-cache-3-30-ghz.html">Intel Xeon E3-1240</a> </li><li>  HP ML350 <a href="https://ark.intel.com/content/www/us/en/ark/products/47925/intel-xeon-processor-e5620-12m-cache-2-40-ghz-5-86-gt-s-intel-qpi.html">G6,2</a> * cpu <a href="https://ark.intel.com/content/www/us/en/ark/products/47925/intel-xeon-processor-e5620-12m-cache-2-40-ghz-5-86-gt-s-intel-qpi.html">Intel Xeon E5620</a> </li></ol><br>  Servers will run under VMware ESXi 5.5, VMware-ESXi-5.5.0-Update1-1746018-HP-5.75.4-Dec2014 image.  I also tried using the VMware-ESXi-5.5.0-Update3-3116895-HP-550.9.4.26-Nov2015 image, but this does not affect the results. <br><br>  But the image of VMware-ESXi-5.5.0-Update2-2403361-HP-550.9.2.40.2-Sep2015 gives distorted results, for some reason, the statistics shown by the server differ from the real one by two times.  With this image, the maximum that the server shows is 50 percent of the load on the processor, apparently some kind of bug.  At first I was delighted when I received the first results, but then I realized that something was wrong ... <br><br>  It should also be mentioned that support for VMware Vsphere 5.5 is also not eternal, and the platform is no longer relevant, and it is worth thinking about the update.  Information about VMware Lifecycle is available in this <a href="https://www.vmware.com/content/dam/digitalmarketing/vmware/en/pdf/support/product-lifecycle-matrix.pdf">VMware Lifecycle Product Matrix</a> document. <br><br><img src="https://habrastorage.org/webt/3b/eq/_i/3beq_ihj_p9wxkw4zvg-tbbdwd4.png"><br><br>  And do not forget about the <a href="https://www.vmware.com/resources/compatibility/search.php">VMware Compatibility Guide</a> .  If we talk about the server HP DL120 G7, this server has never been present in the compatibility matrices, but on the server HP ML350 G6 is officially allowed to install ESXi 5.5 U3. <br><br><h4>  Guest OS </h4><br>  Information about ESXi compatibility with guest OSs is also available in the <a href="https://www.vmware.com/resources/compatibility/search.php%3FdeviceCategory%3Dsoftware%26details%3D1%26keyword%3Dwindows%2520server%26page%3D1%26display_interval%3D10%26sortColumn%3DPartner%26sortOrder%3DAsc%26testConfig%3D16">VMware Compatibility Guide</a> . <br><br>  ESXi 5.5 U3 allows you to install Windows Server 2016 as a guest OS, and even version 5.5 will be enough for this.  But to install Windows Server 2019, you will need ESXi version 6+, but this will not prevent me from testing my plans. <br><br>  I will have the following test VMs: WS2008R2SP1, WS2012R2, WS2016, and WS2019. <br><br>  VMware Tools 5.5.0-10.2.5.8068406 are installed on all VMs.  Installed all updates from Microsoft in May 2019, and even some in June 2019, after which the update service was disabled. <br><br>  For my tests, I performed the minimum tuning, I want everything to work with the most standard parameters.  For this, I will use local group policies, a little more detail about this, I will write at the end. <br><br><ol><li>  disconnected "desktop composition" </li><li>  allowed audio and video redirect </li><li>  Enabled RemoteFX for WS2008R2SP1 and WS2008R2SP1 Clients </li><li>  disabled font smoothing </li><li>  limited the color depth of the color palette to 32 </li><li>  limited the number of monitors to 1 </li></ol><br><blockquote>  In order for the RemoteFX codec to start working on WS2008R2SP1, you must install the RDSH role, for newer versions this can be not done.  Perhaps, RemoteFX is used on WS2008R2SP1 without installing RDSH, but there are no events in the logs about the activation of this codec. </blockquote><br><h4>  Test 1 </h4><br>  As a test, I will use a 720p YouTube movie <a href="https://www.youtube.com/watch%3Fv%3D8XSqVEKKuco">, the BRK2242</a> . <br><br>  On each of the servers, I will in turn open one rdp session and a test video in Chrome (version 75.0.3770.80 (64bit)). <br><br>  In this test, the HP t510 thin client running on the HP ThinOS 4.4 OS and with the Freerdp-1.1hp10d-all-4.4-x86-SQ package will be used as a client.  This unit is connected to a Full HD monitor, and the thin client profile has been reset to factory. <br><br>  I shot the graphs from the host; all the first tests will be performed on the HP DL120G7 server. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ys/py/oa/yspyoaqc-lg1stpfaswzdveqrhq.png"></div><br>  <b>Comments on the results of the first test:</b> <br><br>  In this test, ws2008 consumes three times less CPU resources, but at the same time three times more traffic than other test participants. <br><br>  With current traffic, one gigabit can be placed 66 sessions, but the transition to the new version of the server will probably reduce three times the number of users who can work with this processor consumption. <br><br>  Visually, the picture in this presentation is acceptable on all versions of Windows Server.  Of course, if you run something more dynamic, the newer versions of the servers show a much better picture.  I suppose that this is due to the number of frames, more frames = smooth playback = more CPU load. <br><br><h4>  Test 2 </h4><br>  The script for the second test remains unchanged, except for the use of Firefox (version 67.0.2 (64bit)) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/3g/0p/gw3g0phogvrhasadejts3wle3uw.png"></div><br>  <b>Comments on the results of the second test:</b> <br><br>  Firefox paired with ws2019 shows not a bad result, consumes slightly more CPU and noticeably less traffic than ws2008. <br><br><h4>  Test 3 </h4><br>  In this test, Chrome will be used, but the client will already be a laptop with Windows 10 1903, the laptop is connected to a monitor with FullHD resolution. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i8/ns/fc/i8nsfcbu2s3gwaa90locpi6zmfw.png"></div><br>  <b>Comments on the results of the third test:</b> <br><br>  In the cases with ws2008 less traffic is consumed, other changes are not significant ... <br><br>  I also noticed that Chrome, when displaying a progress bar on the background of a video, consumes 1,000 MHz more, but I did not notice this effect in Firefox, and drawing the progress of the bar does not affect the amount of resources consumed. <br><br><h4>  Test 4 </h4><br>  Laptop with Windows 10 paired with Firefox <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zo/8m/wl/zo8mwlxg1yf3z2m9cmlwflhixwi.png"></div><br>  <b>Comments on the results of the fourth test:</b> <br><br>  In this combination of server-client-browser, ws2019 + Firefox consumes less resources than with Chrome, but began to consume significantly more processor compared to the results of Test 2. <br><br>  In the cases with ws2012 and ws2016, the results of all tests performed are much smoother, there is no such spread as ws2019. <br><br><h4>  Test 5 </h4><br>  This test is concluded in running the maximum number of rdp sessions and launching the presentation in each of the sessions.  <a href="https://www.microsoft.com/en-us/download/details.aspx%3Fid%3D44989">Remote Desktop Connection Manager</a> will help me in this, RDCM will run on a laptop with Windows 10. <br><br>  Resolution sessions had to be reduced to 1440 * 900.  As results, I‚Äôll just give a summary table: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hx/vq/vs/hxvqvslz4p1skrmddvv9pfmite0.png"></div><br>  <b>Comments on the results of the fifth test:</b> <br><br>  Suddenly, the 2019 server showed worse results than ws2012 and ws2016.  Server 2008 was able to open 8 sessions while 2012/2016 servers could open 4 sessions, and the 5th one increases the load to 100%.  Server 2019 was able to work with a maximum of 4 sessions. <br><br>  Firefox is not a priority browser for me, and therefore I only ran it in ws2019 to verify the numbers I received. <br><br><h4>  Test 6 </h4><br>  In this test, the HP ML350G6 server with two E5620 processors comes into play, I will test only 2008 and 2019 servers.  The test is the same, the launch of the maximum number of sessions will be used only by Chrome. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/p2/dz/qq/p2dzqqt6bunqeznn6cuyjnobox0.png"></div><br>  <b>Comments on the results of the sixth test:</b> <br><br>  To run 10 sessions on server 2008, it took 60 percent of the processor resources, and to launch just 5 sessions on 2019 the server needs more than 90 percent. <br><br><h4>  The final part - Tuning </h4><br>  I returned all the test VMs to the HP DL120G7 server and as a client I used a laptop with Windows 10 and its regular screen with a resolution of 1366 * 768. <br><br>  Unfortunately, I would not have called attempts to reduce CPU consumption successful, but I can‚Äôt say that there are no results either.  Here is a list of all available parameters of local group policies that can be used for tyunig: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fz/di/lb/fzdilbns_mntqxophz-c3gzoaws.png"></div><br>  In Windows Server 2008R2, the ‚ÄúOptimize visual experience when using RemoteFX‚Äù parameters allow you to control the picture quality and the number of frames, and this gives a noticeable result.  Reducing the number of frames reduces the load on the processor and network.  For Windows Server 2019, these options do not work. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/k-/db/rk/k-dbrks-k4ac01ipqkfmiffviwy.png"></div><br>  The quality of the picture in Windows Server 2019 can be controlled by the parameter ‚ÄúConfigure image quality for RemoteFX Adaptive Graphics‚Äù, but there is nothing to change the number of frames, or I have not found such a parameter. <br><br>  I tried various combinations of parameters, but I could get noticeable changes in the results only in a few cases.  And the most interesting thing is that you can notice changes in traffic, but at the same time the load on the processor varies only slightly. <br><br>  - Prioritization of H.264 / AVC 444 increased the load on the processor, but at the same time the traffic significantly decreased from 2x to 1 megabit. <br><blockquote>  This policy setting prioritizes the H.264 / AVC 444 graphics mode for non-RemoteFX vGPU scenarios.  H.264 / AVC 444 server can use H.264 / AVC 444 when you use it. </blockquote><br>  - Disabling RDP compression did not reduce the load on the processor, but traffic increased from 2x to 7 megabits. <br><br>  - The inclusion of the Losles parameter for image quality results in inadequate traffic consumption, without changing the processor load.  For which scenarios, this option was added to me is not entirely clear. <br><blockquote>  If you use the RemoteFX Adaptive Graphics uses lossless encoding.  In this mode, it is not impacted.  However, this is a significant increase in network bandwidth consumption.  We recommend that you set this for very specific cases only. </blockquote><br><br><img src="https://habrastorage.org/webt/xq/zm/nr/xqzmnrlocn2gyxeyc930sdxg5zy.png"><br><br><h4>  Results </h4><br>  If earlier for the work of 10 active users there were enough 8 nuclear servers and there was still free space, now such a server is only enough for 5 users. <br><br>  I think it's time to prepare to replace the HP G6 and G7 generation servers.  It is a pity to part with servers in which&gt; 100 GB of RAM is installed, I assumed that they would serve further. <br><br>  I do not rule out that the old processors do not have enough hardware instructions, so I plan to get a modern server to the test in the near future.  But to be honest, my forecast is pessimistic, I think that getting the desired result will be possible only by brute force, an increase in the number of processor cores, and this will entail an increase in the number of licenses and cost. <br><br>  <b>The end</b> </div><p>Source: <a href="https://habr.com/ru/post/459068/">https://habr.com/ru/post/459068/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459050/index.html">Powerful module for typing Vuex</a></li>
<li><a href="../459052/index.html">How to compare: ‚Äúamazing cars‚Äù and ‚Äúugly barracks‚Äù, in a marketing survey and in big data</a></li>
<li><a href="../459054/index.html">Heat map of clicks - how users behave on the site</a></li>
<li><a href="../459062/index.html">The digest of interesting materials for the mobile # 305 developer (July 1 - 7)</a></li>
<li><a href="../459066/index.html">Balancing write and read in the database</a></li>
<li><a href="../45907/index.html">Whom ‚ÄúOdnoklassniki‚Äù scared ‚ÄúGoogle‚Äù?</a></li>
<li><a href="../459070/index.html">Creating a Tower Defense game in Unity: turrets and shooting at enemies</a></li>
<li><a href="../459074/index.html">Small python joy # 7: three things for the price of one - console animation, algorithms and debugging</a></li>
<li><a href="../459078/index.html">CERN switches to open source software - why?</a></li>
<li><a href="../459080/index.html">Features HttpUrlConnection from java.net</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>