<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we developed a chat framework for Android applications - Chateau</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Badoo is primarily a social network with a convenient full-featured chat. However, the requirements for such a chat are constantly growing. Developers...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we developed a chat framework for Android applications - Chateau</h1><div class="post__text post__text-html js-mediator-article">  Badoo is primarily a social network with a convenient full-featured chat.  However, the requirements for such a chat are constantly growing.  Developers of popular applications for network communication all the time add new features to please users and to compete. <br><br><img src="https://habrastorage.org/files/9f0/0cf/d04/9f00cfd04c7141a5b1d34984f2023833.png"><img src="https://habrastorage.org/files/863/ff1/97e/863ff197ed5f44a89a6bf1ab2ed7b0a0.png"><br><br>  Of course, Badoo does not remain aloof from these trends.  We are constantly improving our chat and expanding its functionality, but the capabilities of the existing code base and architecture barely keep up with the requirements of modernity.  The once-ordered and well-tested code grows in an unpredictable way, accumulating "technical debt."  Analyzing ways to solve this problem, we are faced with a dilemma that any developer is familiar with: rewrite the code or do a refactoring? <br><a name="habracut"></a><br>  In the end, we decided that it was better to rewrite it.  This choice was due to the following reasons: <br>  <a href="https://github.com/badoo/Chatto">Chatto's</a> impressive success (Badoo chat framework for iOS) helped us understand what we can achieve. <br>  Since the development of our chat code base, several architectural concepts for Android have appeared and gained popularity, and some of them would help us greatly simplify the code. <br>  Our commitment to the open source concept.  We have always sought to take part in such projects and ourselves have initiated the development of solutions with open source.  In addition, we had a chance to occupy an almost free niche for Android. <br>  But this was only the beginning of a long way, there were still many questions.  What kind of architecture do we want to create?  How, when and which code will we open?  What specific results do we want to achieve? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Goal setting </h2><br>  From the very beginning, we perfectly understood our internal needs and requirements.  However, despite the fact that we initially set a goal to make Chateau an open source project, at the design stage we also had to lay the flexibility and extensibility of the framework.  This approach is reflected in our design goals: <br><br><ul><li>  <b>Ease of expansion</b> .  It is necessary to simplify the addition of new features as much as possible (for example, support for GIF files, stickers, voice messages) and ensure that adding them does not affect other chat features. </li><li>  <b>Easy integration</b> .  It is necessary to provide a simple integration of the framework into applications, regardless of the type of architecture used or the server platform. </li><li>  <b>Ease of understanding</b> .  The code should be simple and clear so that a person who is not a member of our development team can understand it. </li><li>  <b>Ease of testing</b> .  Chat provides various complex functions of user interaction and, as a result, there is a wide scope for potential errors.  To ensure the possibility of refactoring and expanding the code base, it is necessary to simplify testing as much as possible (both modular and integration). </li><li>  <b>High performance</b> .  In the framework should not be used abstractions or templates that significantly reduce performance. </li></ul><br>  To solve the tasks, it was necessary to choose the right tools and the optimal architecture ... <br><br><h2>  Optimal architecture for Chateau </h2><br>  The Chateau framework itself was written from scratch, but its architecture used many years of experience in writing components and functions for the Badoo chat. <br><br><img src="https://habrastorage.org/files/8b8/7b4/fff/8b87b4fff38a46b7a00fa8addba24c10.png"><br><br>  Since we have already used the MVP (Model-View-Presenter) design pattern in our other applications and it allowed us to create well-tested code, this was a natural choice for Chateau.  Of course, not all implementations of the MVP pattern are the same, and we needed to choose one of the many existing options.  Read more about this in our <a href="https://github.com/badoo/Chateau">documentation</a> . <br><br>  Another element of the mosaic was the concept of <a href="https://blog.8thlight.com/uncle-bob/2012/08/13/the-clean-architecture.html">Clean Architecture</a> ("pure architecture"), proposed by Robert Martin (Robert C. Martin), who is also known as @ unclebobmartin.  In accordance with this concept, we divide the application into several layers, and for all interactions between layers the ‚Äúdependency rule‚Äù should be followed.  Dependencies in the code should always go from top to bottom (in our case, the upper layers are the user interface, and from top to bottom we go through the layers of views (View), "presenters" (Presenter), use cases (Data use cases) and data warehouses / sources) . <br><br>  The benefits of the Clean Architecture concept for us were similar to those of the MVP concept implemented at the top levels of the application.  Thanks to this, we were able to create independent components that can be tested separately using fast unit tests instead of tests on the Android platform.  In addition, this approach allowed the Chateau framework to be completely modular, which allows the use of another data store, user interface or an alternative implementation of the network code. <br><br><h2>  What we have learned </h2><br>  The development of Chateau was very exciting (by the way, we are not finished yet!) And fun.  In the process, we laughed, cried and stuffed cones.  Here are some of the lessons learned: <br><br><ul><li>  It is not easy to find a middle ground between the two extremes - a full-featured chat (with user interface, caching and network code) and a platform that could be used as the basis for your own chat.  Of course, it‚Äôs great to create something immediately ready for use, but still we must not forget about the possibility of completely replacing individual modules (for example, the user interface or the network layer).  We decided to create a sample application for Chateau to show how we imagine a full-featured chat; </li><li>  Studying the RxJava library directly during the development of the framework in which it is used is not an easy task.  In addition, in our case, this led to more frequent refactoring (another excellent reason for providing good code coverage); </li><li>  It is better to plan the creation of the library and its use options in advance to ensure that the development process meets both internal and external needs.  We wanted to distribute libraries through <a href="https://bintray.com/kingamajick/maven/chateau/1.0.0-preview2/view">jCenter</a> , and also include them as a normal Gradle project dependency when creating our applications (to simplify cross-module refactoring).  In addition, with the help of <a href="https://github.com/ingydotnet/git-subrepo">git subrepo</a> we made it so that the Chateau libraries were displayed as a separate folder of the main git. </li></ul><br><br><h2>  What's next? </h2><br>  For the time being, Chateau does not implement all the functionality (for example, user interface and view implementations, as well as support for certain server platforms).  These functions must be added or implemented in the application itself, which uses Chateau.  In the future, we plan to reduce the amount of code required for full integration with Chateau.  Ideally, we would like to maximize the versatility of Chateau - assuming compatibility with the server platform, of course. <br>  We are also working on creating an optimal test layout or platform that can be used with a sample application.  Follow the news in our blog on Habr√©, as well as on the <a href="https://github.com/badoo/Chateau">GitHub</a> project page. </div><p>Source: <a href="https://habr.com/ru/post/302534/">https://habr.com/ru/post/302534/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302522/index.html">Event model based on async and await</a></li>
<li><a href="../302524/index.html">Billion dollar injection: banks' worst nightmares</a></li>
<li><a href="../302528/index.html">What traffic actually comes to Direct, even if you are an honest person</a></li>
<li><a href="../302530/index.html">Fixed a serious error in the official documentation for setting up SSL in Microsoft Azure web roles</a></li>
<li><a href="../302532/index.html">Basics of game design: 20 board games. Part Two: Backgammon, Monopoly, Scrabble</a></li>
<li><a href="../302536/index.html">World of Tanks: what does the win rate of tanks depend on?</a></li>
<li><a href="../302538/index.html">Experience of using Liferay Portal in eCommerce</a></li>
<li><a href="../302542/index.html">10,000 virtual servers on RU VDS</a></li>
<li><a href="../302544/index.html">Unwanted DNS Unlocker uses the DNS hijack method to trick users</a></li>
<li><a href="../302548/index.html">Security Week 22: Microsoft against passwords, legal issues with Tor, crypto-fiber attacks Amazon customers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>