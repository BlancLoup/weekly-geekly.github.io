<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tale of coursework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. I want to talk about my coursework or what causes curiosity. 


 It‚Äôs been a long time from nothing to do writing a program for simbian. And fr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tale of coursework</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello.  I want to talk about my coursework or what causes curiosity. </p><br><p>  It‚Äôs been a long time from nothing to do writing a program for simbian.  And from time to time faced with the oddities in the assembly.  Everything pointed to the elf2e32 utility.  Her task is to convert the input binary file of elf format into another, specific for Symbian - e32 image.  I was curious for a long time - how does this utility work at all and why is it sometimes buggy?  A little later, I began to pester another question - the topic of the course work =) I decided to combine business with pleasure and downloaded its source code.  And it started ... </p><a name="habracut"></a><br><p>  The first commit is not going to </p><br><p>  Second, we include non-standard gcc extensions, add the missing classes, functions, constants from the sources.  Subject happily going and falling.  Progress however.  We start under the debugger - the debugger enters the class that only initializes another, which initializes the next ... Hurray!  This function!  We enter.  Oops.  Where are we?!!!  Stop debugger!  Surgeon!  Scalpel!  Alcohol!  Cucumber!  Classes, appendix f furnace!  You give nullptr instead of NULL!  We have C ++ 14!  Wow what awesome constructor initializes everything with zeros!  And also, and also, and again - but with us C ++ 14 calls for initialization by default for classes!  What is all laconic now ... </p><br><p>  Laadno.  We fix as much as possible at a time.  I figured out why the debugger jumps on the sources of the aki-prichin source code - the aftar hit its head on abstraction, having grown the inheritance of 80 levelers from the UseCaseBase class :) Then, apparently, the constructor classes of static instances for Message &amp; ParameterManager classes flew out of their eyes.  Singleton Myers?  No, not heard.  F furnace abstraction!  Viva revolucion !!!  Viva POD !!! </p><br><p>  Wow!  How interesting this tree was growing.  The main work is done by the BuildAll () function.  If all parameters are specified, the function collects the import library, the file specifying the names of functions and variables and the order in which they are available in the import library and the binary itself.  All descendants of UseCaseBase changed its algorithm through overload.  Sometimes in descendants we prepare auxiliary data, but more often we simply turned off the creation of some files.  For example, the file name for building something is not specified - a new class is created.  Idiots  It is enough to interrupt the execution of such a collector function if necessary.  Easy to understand my actions B-) </p><br><p>  We continue to delete empty classes, replace NULL with nullptr_t, replace range iterators with for (auto x: *). </p><br><p>  We correct errors in the processing of command line parameters. </p><br><p>  It is necessary to check the code with a static analyzer.  Where to begin?  Hmm, under the XPshka, the selection is small - cppcheck, and the codeblock supports it out of the box.  Wow, what a catch!  There is even a delete for char []!  Damn, I know where half the gig of free RAM has gone =) </p><br><p>  So we add the files generated from the elf-file libcrypto.dll and the file itself describing the parameters of the command line to create them. </p><br><p>  Oops.  CPPCheck was wrong ... It must be (a || b) ... </p><br><p>  I will try to collect in Visual Studio 15 and Win10 would be poked with a stick.  We put on a virtual machine.  Made, download and run the online installer studio.  What?  Doesn't want to save the jump to the shared folder with the host ?!  Yes, you choke!  Download to where you were taught ... And now we transfer the downloaded to the folder and run the installation.  What?  Again ignores shared folder ??!  Yes, you choke!  Become where you were taught ... </p><br><p>  In principle, a dozen well-whispers on one core and 3 gigs of the frame.  Studio in the studio!  Wondered, but not for long.  Open my project in the studio Again, swears at the folder ... How much can you already?  Yes, you choke ... We collect, swears on non-standard extensions STL hash_set.  Remote  Deleted ???  Turn on the brain =) <br>  Wow what zaboristy code: </p><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ElfFileSupplied::UnWantedSymbolp(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * aSymbol) { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> hash_set&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*, hash&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*&gt;, eqstr&gt; aSymbolSet; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> symbollistsize=<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Unwantedruntimesymbols)/<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Unwantedruntimesymbols[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> FLAG=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(!FLAG) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;symbollistsize;i++) { aSymbolSet.insert(Unwantedruntimesymbols[i]); } FLAG=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; } hash_set&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*, hash&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*&gt;, eqstr&gt;::const_iterator it = aSymbolSet.find(aSymbol); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(it != aSymbolSet.end()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  Let's think a little ... And voila: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ElfFileSupplied::UnWantedSymbolp(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * aSymbol) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> symbollistsize = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Unwantedruntimesymbols) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Unwantedruntimesymbols[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;symbollistsize; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strstr</span></span>(Unwantedruntimesymbols[i], aSymbol)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  My preliness ... </p><br><p>  So why the program throws an exception if this flag is incorrectly set or not set at all?  Why are you so cruel, beautiful far away ... Let's just drop this flag to a safe value.  And this flag would also be nice ... And this, and this, and these.  Or maybe it is better to make a separate function?  A good idea!  Let's call it ParameterManager :: CheckOptions ()! </p><br><p>  Step to the left - fall, step to the right - unreported exception, jump on the spot - thanks at least BSOD =) </p><br><p>  Dull ... Glitches and curvature ... </p><br><p>  Olya-la !!!  SymbU CleanUpStack emulation on STL ?: <br>  In principle, nothing special: </p><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*&gt; cleanupStack;</code> </pre> <br><p>  Cleaning: </p><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*&gt;::iterator aPos; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *aPtr; aPos = cleanupStack.begin(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( aPos != cleanupStack.end() ) { aPtr = *aPos; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>[] aPtr; ++aPos; }</code> </pre> <br><p>  Some kind of light head instead of left / right used l / r.  Thank you cppcheck. </p><br><p>  Ay, lazily in front of the monitor, the cppcheck logs can be disassembled ... What will the gitkhb offer us? .. Codacy ... We are connecting the project ... I have thought a little and are ready!  Now you can read messages about success in dealing with errors lying on the couch ^^ </p><br><p>  So, with the like is not buggy ... Let's collect something, such as libcrypto.dll.  It works, although the uncompressed file is more than one hundred bytes than the one created by the utility from the SDK.  Further, the binaries created by this version of the utility and from the SDK will be constantly compared.  The command line parameters are themselves identical. <br>  Tax, where can I get analog diff for binary files?  Hmm, I'm writing a script on the piston.  Too much information - you need something much simpler.  Dll to recognize pdf / djvu - AlternateReaderRecog.dll - a good option, the exhaust is less than 4 kilobytes.  Taxes, offsets are different in the import section.  Open them in a hex editor.  The beginning is the same, in my version there is more garbage, just after the end of the section in the original version.  But in my version the next section starts 100 bytes later.  On the same value in bytes files and differ!  Offsets further indicate the correct addresses ... The binary is correct !!!  Ahhhh !!! </p><br><p>  A mounth later.  So where did this one hundred byte come from? <br>  Well, if it is not clear how it works, we are starting to break the algorithm for creating E32Image.  We continue to mock AlternateReaderRecog.dll.  Increasing the size of the binary at the output - no way, overwriting the memset of the section - no way, reducing the size of the binary - no way.  Grrrr.  What the?!!!  I break the exhaust in the release version, and run the debug? !!!  Hi bast, start over ... Taaak section is wiped up - good!  Increased the size of the binary!  Good!!!  Reduce the size of the import section!  There is!!!  It is byte-identical to the same section in the exhaust of this utility from the SDK! <br>  We look into the creation code of this section.  "sizeof (char *)" - something was remembered by the articles of Andrei Karpov, one of the developers of Pvs-studio, that types can occupy different memory sizes - and how much space does it take?  MinGW - 8 bytes, Visual Studio - 4 !!!  We divide in half these 8 bytes, business.  Ffse!  And how is the code section?  This dllka without global variables.  There are no global variables - there is no section either ... Take something heavier - libcrypto.dll. <br>  The file on the output of my utility is now less than 100+ bytes ... What the ???  The import section is byte identical - good.  Code section - no? !! </p><br><p>  I don‚Äôt bother to compare such a wall of text ... I‚Äôm going to look for diff for a byte comparison ... <br>  After a couple of days of playing with Google, I still found it.  vbindiff is a console utility with the Norton Commander interface, showing the difference between two files in two horizontal panels.  To go to the place of difference, press enter.  Good!  You can drag two files to the icon for comparison and the program will open them!  Fine!!! <br>  Compare - soooo in the title differ in its crc and creation time.  Nothing.  That baytik is different, another hundred ... Wow !!!  Tens, hundreds, thousands of bytes of difference? !!!  Taak, we look we look what section they belong to ... We look at offsets ... Aha, data section ... <br>  We cranked up the trick, as for the import section ... We reset the memset, there is.  Increasing section size ... Falling ... Increasing.  Offers the hand and heart of the debugger ... Damn.  We open function creating section - porridge from functions ... Grr. <br>  ... Aw, tomorrow ... For the time being, I'll fix something else ... </p><br><p>  For example, add tests, but there is such a mess that it is impossible to divide the program into small modules.  You can‚Äôt insert tests directly into the code - then the hell will figure it out.  Idea!  Constant launches of programs with different arguments - I have been testing the program all the time ... But let's do it better, we will issue a separate python script.  Yes, a great idea, just great.  The script for test execution errors should continue to work, reporting them but not falling.  That's it! </p><br><p>  We return to our sheep ... This function calls this, then this, go here ... So, where did it go?  Ugh, confused ... ... Ay, tomorrow ... While I‚Äôll fix something else ... </p><br><p>  And so it took two months ... </p><br><p>  Damn, where is this section of code formed?  I had to go on academic leave, so at least I will deal with you !!!  Taak.  This is where the characters for the section come in ... What will printf show?  I‚Äôm not putting everything in the console buffer ... Let's save the exhaust to a file ... So, so far nothing special ... Stop!  Same lines !!!  Many identical lines !!!  Where from ?!  We add printf on each data source (patience was enough for 3 of five, ha).  Is empty  We look at one of the remaining function calls ... Taak.  Incrementing iterator after loop ???  And todo on warning codacy ???  Transferred to the loop.  Run !!!  There is a size match!  There is a byte coincidence !!!  Fixed!!!  git blame the name of the hero refuses to name ... We look at the original - I did not create this.  Or was it a ‚Äúbomb‚Äù for non-Nokia developers?  Grrr. </p><br><p>  Carefully check the exhaust tests, check byte-byte files.  Everything works as it should!  In the release! </p><br><p>  Olya!  It is time for a Great Purge !!!  It's time to uproot the UseCaseBase tree with the root !!! <br>  Most of the descendants have already exhausted, we bring useful functions to the class generator.  Only UseCaseBase and its descendant ElfFileSupplied are left.  UseCaseBase - is a wrapper for a class that processes command parameters and declares several pure virtual functions for the ElfFileSupplied class.  In short, the violinist is not needed ... What a sky is blue, well ... Another hour ... I will deal with this class and you can go for a walk ... And get some air, warm up, well ... Let's go!  So, comment out this feature.  We collect!  Soooo, you have to think about how beautiful it is to remake ... Done !!!  Next feature!  Done!  Next!  Done!  Done!  Yes!  Yes!  Yes!  The last function ... Ufff.  We start after assembly ... Seven-fold acceleration of work? !!!  The exhaust is correct ... It's funny.  Debug version also shrunk by 2 meters? !!!  Wow!!!  You can walk.  At night?!!!  Kaak ???  Where is my day? !!!  Laadno run tests and relax ... Tests have quietly worked - you can relax ... </p><br><p>  Let me write something now ... Oh, the class that works with functions and variables accessible from the outside looks scary.  The principle of operation: reading from a file, parsing lines and saving to a file.  Under the line analysis, a whole class of selected noodles was already allocated to C ... Soooo ... Let's think ... What beauty came out: <br>  read the string std :: getline (), remove spaces from the edges of the lines and the parsim. </p><br><p>  To be continued ... The source code is <a href="https://github.com/fedor4ever/elf2e32">https://github.com/fedor4ever/elf2e32</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/430794/">https://habr.com/ru/post/430794/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../430780/index.html">Sequence-to-Sequence Part 1 models</a></li>
<li><a href="../430784/index.html">From junior to director: one security officer</a></li>
<li><a href="../430788/index.html">My story of an interview at IB IT (Java developer, investment bank) in London with examples of typical tasks</a></li>
<li><a href="../430790/index.html">Ledger Nano S: key to the room where 710 tokens and cryptocurrencies can lie</a></li>
<li><a href="../430792/index.html">Creating an outline for LWRP in Unity</a></li>
<li><a href="../430798/index.html">Lithium Ion UPS: Which type of battery to choose, LMO or LFP?</a></li>
<li><a href="../430800/index.html">Creating a game "Like Coins" on Godot Engine. Part 2</a></li>
<li><a href="../430802/index.html">PMI RU: Study on the salaries of project managers in Russia for 2017</a></li>
<li><a href="../430804/index.html">Tesla / Panasonic batteries are the most affordable batteries for electric vehicles on the market.</a></li>
<li><a href="../430806/index.html">We started to learn English - we wrote the application: EWM - the experience of creating a learning project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>