<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Transparent proxying in I2P and Tor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 I wanted to install a caching proxy based on Polipo, and at the same time set up transparent proxying for i2p and Tor. Of all the services th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Transparent proxying in I2P and Tor</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br>  I wanted to install a caching proxy based on Polipo, and at the same time set up transparent proxying for i2p and Tor.  Of all the services that exist in these anonymous networks (mail, torrents, etc.) I use only the web, so most likely you will not be able to use services that use the non-http protocol if you follow this instruction. <br>  I have a home server on Debian that distributes the Internet.  I used TinyProxy as a distributor based on domains, two polipo daemons - one for caching the Internet, the second for (mostly) converting socks5 to http proxy, to register it in TinyProxy, and also caching Tor traffic separately;  dnsmasq for resolving .i2p and .onion addresses (I have used it before for both DNS and DHCP). <br>  We assume that I2P and Tor are already configured and working. <br><br>  I2P (4444) <br>  / <br>  LAN port - TinyProxy (8888) - Polipo-WAN (8123) <br>  \ <br>  Polipo-Tor (8124) - Tor (9050) <br><a name="habracut"></a><br><br><h4>  Let's start! </h4><br><h5>  dnsmasq </h5><br>  To begin, configure dnsmasq so that the browser can get some non-existent ip for .i2p and .onion domains <br>  Excerpt from /etc/dnsmasq.conf: <br><blockquote><code>address=/.i2p/192.168.99.99 <br> address=/.onion/192.168.99.99</code> </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  TinyProxy </h5><br>  Now configure TinyProxy.  In this server, upstream rules are executed according to the principle ‚Äúthe last - the main thing‚Äù, so if we put upstream to the Internet after upstream for .i2p and .onion, nothing will work. <br>  Excerpt from /etc/tinyproxy.conf: <br><blockquote> <code>upstream 127.0.0.1:8123 <br> upstream 127.0.0.1:4444 ".i2p" <br> upstream 127.0.0.1:8124 ".onion"</code> </blockquote> <br><br><h5>  Polipo </h5><br>  Everything is simple here.  We configure Polipo for WAN to taste, and in Polipo for Tor everything is the same, just add the lines: <br><blockquote> <code>socksParentProxy = "localhost:9050" <br> socksProxyType = socks5</code> </blockquote> <br><br><h5>  iptables </h5><br>  Probably the most important part.  Without it will not work.  Execute the command: <br><blockquote> <code>sudo iptables -t nat -I PREROUTING -i <b>_LANETH_</b> -d ! <b>192.168.4.0/24</b> -p tcp --dport 80 -j REDIRECT --to-ports 8888</code> </blockquote> <br>  Where <b>_LANETH_</b> is the network interface of the locale, and <b>192.168.4.0/24</b> is your local subnet. <br><br>  That's all!  You can walk on .i2p and .onion sites without additional browser settings from any device. </div><p>Source: <a href="https://habr.com/ru/post/122835/">https://habr.com/ru/post/122835/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122829/index.html">Data binding in JavaScript applications: auto-authoring events</a></li>
<li><a href="../122830/index.html">Checkout right</a></li>
<li><a href="../122831/index.html">Qt. Creating a console widget for a graphics application</a></li>
<li><a href="../122832/index.html">Conference site DevCon'11 published conference materials</a></li>
<li><a href="../122834/index.html">OAuth VKontakte: mercenary use</a></li>
<li><a href="../122836/index.html">Check for monopoly</a></li>
<li><a href="../122839/index.html">The game "Terraria" and its "good" profile encryption system</a></li>
<li><a href="../122840/index.html">Implementation of the backend in multiplayer online games</a></li>
<li><a href="../122842/index.html">Home bookkeeping using Google Docs</a></li>
<li><a href="../122850/index.html">Startups Fertilization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>