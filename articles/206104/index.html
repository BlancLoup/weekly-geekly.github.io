<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quantization Matrix Manipulation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will be of interest primarily to those who for some reason prefer AVI and XVID, rather than MKV and H264. At the doom9 and ixbt forums, q...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quantization Matrix Manipulation</h1><div class="post__text post__text-html js-mediator-article">  This article will be of interest primarily to those who for some reason prefer AVI and XVID, rather than MKV and H264.  At the doom9 and ixbt forums, questions were raised about the use of different matrices, as well as the use of their own, but no one gave an intelligible answer, except for deepening the theory of discrete cosine transform.  There is <a href="http://rutracker.org/forum/viewtopic.php%3Ft%3D760085">an article</a> where good matrices are given, but their advantages and disadvantages are not explained there.  So I will be glad if I find myself a pioneer. <br><a name="habracut"></a><br>  So, the task was as follows: to select the coefficients of the matrix in such a way as to remove the quadraticity when encoding with a constant quantizer&gt; 2.  At the same time, the file size should be smaller than with the same quantizer with the standard H263 matrix. <br><habracut><br>  In order not to torment you with a deepening in the nuances of the study, here is a photo of the resulting matrix, and below the explanation. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b5d/eb5/a98/b5deb5a9809c236934ae0631dd386d00.png"><br><br>  Red squares are the most important parts.  They are responsible for macroblocks, which are almost entirely composed of the same color.  Since most of these units are in the video stream, the file size and visual perception of quality depend on their packaging.  Therefore, the task was reduced to the selection of such factors at which the ratio quality / size will be maximum.  The remaining coefficients were set on the principle of "slightly more than the previous one", small details of the image were neglected.  Especially important is the number 12 in the second square.  With quantizer 4, if we increase this ratio, then there will be squares in the background, and a decrease will lead to a sharp increase in file size. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A little more about coding features. <br>  In order for this matrix to become effective, you need to keep some settings.  First, it is necessarily a constant quantizer of 2, 3, or 4. Less than 2, there is no point, and more than 4, background distortions appear.  No fractional quantizers!  Photo 2. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b98/b3d/275/b98b3d27574ebab57907ef7ce13fcab7.png"><br><br>  Secondly, the additional quantizer settings that appear when you click on the upper ‚Äúmore‚Äù button. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/331/711/833/3317118339bdc6b4a66d81486fcc6367.png"><br><br>  Red outlined important settings.  Quantizer ratio - the multiplier of the main quantizer specified earlier (photo 2), is mandatory 1. Quantizer offset - the quantizer increment for non-key frames is optimal 2. For quality maniacs, 0 is possible, for greater compression you can increase, but I do not advise. <br>  I also strongly recommend that you disable Adaptive quantization and Trellis quantization (lower ‚Äúmore‚Äù button). <br><br>  For example, I took a small piece of the film with good quality, the resolution is 720x304, the original bitrate is 1300 (without audio).  Encoding options and received bitrate: <br>  H263 matrix, quantizer 2 = bitrate 953 <br>  my matrix, quantizer 2 = 883 bitrate <br>  my matrix, quantizer 4 = bitrate 433 <br><br>  With quantizer 2, it is almost impossible to find differences in quality, while with quantizer 4 with my matrix, differences are visible in frame-by-frame viewing, and with quantizer 4 with matrix H263 - squares, squares. <br><br>  Conclusion: the matrix is ‚Äã‚Äãusable at any resolutions, you can focus on quality or smaller size.  Especially useful at low resolutions, since quadraticity is minimal, and at large ones with quantizer 4, it is enough to upload movies to the Internet.  At low resolutions, you can slightly reduce the coefficients in the red square and it will be candy.  And forget about two passes. <br><br>  It is possible that someone is not satisfied that the details (all coefficients that are&gt; 20) are too smoothed out in my matrix, but there are two reasons for this.  First, it contributes to good compression and small size, and secondly, sharpness, in fact, is not lost forever.  If the video is encoded with high quality, then during the viewing you can turn on the Sharpen sharpness filter.  I prefer the msharpen from the K-Lite Codec Pack.  There you can adjust the sharpness very smoothly and it works more correctly than others.  In most cases, smoothed video with a sharpness filter produces a better impression than if you encode the sharpness into a video stream.  This is due to the peculiarities of signal coding by quantization, which I will not discuss in detail. <br><br>  Now about the useful filters VirtualDub'a smoother and temporal smoother, both built-in. <br>  The first is smoothed by the Gauss method, so the picture is more animated.  If you use a value in the range of 1-5, then you can successfully smooth out quadraticity and noise at the borders of objects.  Slows down coding by 10-20%. <br>  The second one does not actually smooth, but rather stabilizes the image, makes the current frame dependent on the previous one.  The value sets the number of previous frames for the approximation.  It is recommended 1 or 2. If you set&gt; 4, then the wave of the hand will look like a fan.  Indispensable for stabilizing the jerking background.  Slows coding by 30-50%. <br><br>  Finally, it remains to say only one thing: Le XVID Est Mort?  Vive Le XVID! <br>  Encode on health. </habracut></div><p>Source: <a href="https://habr.com/ru/post/206104/">https://habr.com/ru/post/206104/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../206090/index.html">Legality of translation</a></li>
<li><a href="../206092/index.html">Feathers.js - a reactive JavaScript framework on top of Express</a></li>
<li><a href="../206096/index.html">CSS variables in Firefox 29</a></li>
<li><a href="../206098/index.html">Install SteamOS on a virtual machine</a></li>
<li><a href="../206100/index.html">3G Internet at 33 km</a></li>
<li><a href="../206106/index.html">Derek Sivers: Why are my programs and ideas public?</a></li>
<li><a href="../206108/index.html">First Steam Machines arrived to owners</a></li>
<li><a href="../206110/index.html">The digest of news from the world of mobile development for the last week ‚Ññ33 (December 9-15, 2013)</a></li>
<li><a href="../206112/index.html">FrontendSimpleEdit - a simple content editor for the external part of the site on MODX Revolution</a></li>
<li><a href="../206116/index.html">Algorithm for Improved Self-Organizing Growing Neural Network (ESOINN)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>