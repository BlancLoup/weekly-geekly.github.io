<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Step-by-step instructions for setting up LXD on Ubuntu 16.04</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This instruction contains a step-by-step algorithm for installing and configuring LXD. The instructions cover the following topics: 


 - Installation...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Step-by-step instructions for setting up LXD on Ubuntu 16.04</h1><div class="post__text post__text-html js-mediator-article"><p>  This instruction contains a step-by-step algorithm for installing and configuring LXD.  The instructions cover the following topics: </p><br><p>  - Installation and launch of the container. <br>  - Network configuration. <br>  - Configure static IP addresses for containers. <br>  - Configure NAT and Iptables. <br>  - Create backups and restore them. <br>  - Distinctive features from Docker. </p><a name="habracut"></a><br><h1>  Introduction </h1><br><p>  LXD is a container hypervisor that is based on LXC [1].  The main difference from LXC is that LXD introduces the concept of container images, and builds the infrastructure around these two concepts. </p><br><p>  Simply put, LXD is a Docker for virtual OS.  The principle is the same: the OS image can be downloaded from the repositories and deploy instances on the host as containers.  One image can be ‚Äúcloned‚Äù across multiple virtual machines. </p><br><p>  Differences from Docker: </p><br><ol><li>  Docker is application virtualization, and LXD is operating system virtualization. </li><li>  When the container is started, a full-fledged linux environment is started: the scripts in init.d and various installed services are started (mysql, apache, nginx, cron, etc.). </li><li>  It is possible to set a static ip address to the container. </li><li>  After starting the container, you can change the configuration of the container ("forward" a folder, etc.). </li><li> When you exit the container with the <code>exit</code> it continues its work. </li><li>  You can directly access the container file system from the host machine.  The container root system is located in the <code>/var/lib/lxd/containers/&lt; &gt;/rootfs</code> . </li><li>  By default, the LXD service works through a unix socket, but it can be opened to an external network and distribute its images.  In other words, you can raise a personal server with images. </li></ol><br><p>  Other LXD features: </p><br><ol><li>  You can integrate with OpenStack through the nova-lxd plugin. </li><li>  There is the possibility of hibernation (hibernation) of the container. </li><li>  There is a container management API [4]. </li><li>  You can run Docker inside LXD [5]. </li></ol><br><h1>  LXD installation </h1><br><p>  LXD currently works fine on Ubuntu 16.04 LTS.  You can run on other systems, but there may be difficulties or something will not work as it should.  For example, on Centos 7, containers run only in privileged mode, there are no ready-made lxd builds and you need to compile them manually. </p><br><p>  In the latest Ubuntu version, by default, lxd is already built in.  If it is not installed, you can put it like this: </p><br><pre> <code class="bash hljs">aptitude install lxd</code> </pre> <br><h1>  LXD Setup </h1><br><p>  Update the system and install the necessary packages for work: </p><br><pre> <code class="bash hljs">aptitude update aptitude upgrade aptitude install lxd zfs zfsutils-linux</code> </pre> <br><h2>  LXD Initialization </h2><br><p>  LXD initialization needs to be done before you start using containers. </p><br><p>  Before doing the initialization, you need to decide which backend storage will be used.  Backend repositories are where all containers and images are located.  There are two main types of storage: ZFS and Dir. </p><br><ul><li>  ZFS allows you to instantly create and restore container snapshots, and create containers from images.  With ZFS, LXD images take up much less space than the container itself. </li><li>  Dir stores images in the usual way on disk.  Each shot will occupy as much as the container itself. </li></ul><br><p>  ZFS is mounted in a file as a loop device, so you need to monitor the size of the storage and increase the place if there is not enough of it.  ZFS makes sense to use if you have a private remote image repository, where you send, from time to time, container snapshots as backups, and then download them from there to install new versions or to restore containers from backups. </p><br><p>  I decided to put Dir on the production server.  ZFS I test in my local computer.  I will do backups with regular scripts - pack them into a tar and send them to Amazon S3. </p><br><p>  Once you have decided which backend repository to use, begin the initialization process.  This is done by the command: </p><br><pre> <code class="bash hljs">lxd init</code> </pre> <br><p>  The utility will ask questions that you will need to answer.  The first question the utility asks: what type of storage to use? </p><br><pre> <code class="bash hljs">Name of the storage backend to use (dir or zfs): dir</code> </pre> <br><p>  If your answer is Dir, then the utility will immediately go to network configuration.  If your answer is ZFS, then the system will ask the following questions: </p><br><pre> <code class="bash hljs">Create a new ZFS pool (yes/no)? yes Name of the new ZFS pool: lxd Would you like to use an existing block device (yes/no)? no Size <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> GB of the new loop device (1GB minimum): 10</code> </pre> <br><p>  "Size in GB of the new loop device" is the size of the ZFS storage.  All images and containers will be stored in this storage, so if you intend to store many images or containers, then you need to increase this number. </p><br><p>  Then the utility will ask: do you need to open access to LXD from outside?  The answer is "no."  If you want to create a public or private repository, then you need to answer "yes." </p><br><pre> <code class="bash hljs">Would you like LXD to be available over the network (yes/no)? no</code> </pre> <br><h2>  LXD bridge setup </h2><br><p>  After configuring the storage type, the utility will ask: ‚ÄúWould you like to configure the LXD bridge?‚Äù.  The answer is "yes." </p><br><pre> <code class="bash hljs">Do you want to configure the LXD bridge (yes/no)? yes</code> </pre> <br><p>  Start the network configuration interface.  Answer questions like this: </p><br><pre> <code class="bash hljs">Would you like to setup a network bridge <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> LXD containers now? Yes Bridge interface name: lxdbr0 Do you want to setup an IPv4 subnet? Yes IPv4 address: 10.200.0.1 IPv4 CIDR mask: 16 First DHCP address: 10.200.100.1 Last DHCP address: 10.200.255.254 Max number of DHCP clients: 25399 Do you want to NAT the IPv4 traffic? Yes Do you want to setup an IPv6 subnet? No</code> </pre> <br><p>  The network will use the bridge with the lxdbr0 interface. </p><br><p>  Network mask 10.200.0.0/16. <br>  IP address of the host 10.200.0.1. <br>  Automatically DHCP will distribute IP for containers from 10.200.100.1 to 10.200.255.254, but you can manually set it from 10.200.0.2. <br>  The ip6 protocol for containers can be omitted. </p><br><p>  You can rerun the LXD bridge configuration utility with the command: </p><br><pre> <code class="bash hljs">dpkg-reconfigure -p medium lxd</code> </pre> <br><h2>  Setting a static IP for a container </h2><br><p>  Open the file: </p><br><pre> <code class="bash hljs">nano /etc/default/lxd-bridge</code> </pre> <br><p>  Uncomment the line LXC_DHCP_CONFILE and list: </p><br><pre> <code class="bash hljs">LXD_CONFILE=<span class="hljs-string"><span class="hljs-string">"/etc/lxd-dnsmasq.conf"</span></span></code> </pre> <br><p>  Create a static IP address configuration file: </p><br><pre> <code class="bash hljs">nano /etc/lxd-dnsmasq.conf</code> </pre> <br><p>  Register the static IP address for the test container: </p><br><pre> <code class="bash hljs">dhcp-host=<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>,10.200.1.1</code> </pre> <br><p>  Further, in this file you can add other static IP addresses for other containers. </p><br><p>  After each change of the /etc/lxd-dnsmasq.conf file, you will need to reload lxd-bridge with the command: </p><br><pre> <code class="bash hljs">service lxd-bridge restart</code> </pre> <br><p>  If this does not help, then you need to stop the containers with the wrong IPs, delete the dnsmasq.lxdbr0.leases file, and then reload the lxd-bridge: </p><br><pre> <code class="bash hljs">lxc stop <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> rm /var/lib/lxd-bridge/dnsmasq.lxdbr0.leases service lxd-bridge restart</code> </pre> <br><h2>  NAT setup </h2><br><p>  To make NAT work by executing the commands: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> 1 &gt; /proc/sys/net/ipv4/ip_forward <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"net.ipv4.ip_forward=1"</span></span> &gt;&gt; /etc/sysctl.conf</code> </pre> <br><h2>  Grub Setup </h2><br><p>  Edit the file </p><br><pre> <code class="bash hljs">nano /etc/default/grub</code> </pre> <br><p>  Change the line </p><br><pre> <code class="bash hljs">GRUB_CMDLINE_LINUX=<span class="hljs-string"><span class="hljs-string">"swapaccount=1 quiet"</span></span></code> </pre> <br><p>  Without this line, when I started lxd, I got a warning that the cgroup swap account would not work.  I decided to turn on the option swapaccount = 1.  quiet - this is a quiet boot system (optional) </p><br><h2>  Adding LXD to autorun </h2><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> lxd</code> </pre> <br><h2>  System restart </h2><br><p>  Reboot Ubuntu: </p><br><pre> <code class="bash hljs">init 6</code> </pre> <br><h1>  Installing and running a virtual machine image </h1><br><p>  Add repository (optional, by default images have already been added): </p><br><pre> <code class="bash hljs">lxc remote add images images.linuxcontainers.org:8443</code> </pre> <br><p>  Download image: </p><br><pre> <code class="bash hljs">lxc image copy images:centos/6/amd64 <span class="hljs-built_in"><span class="hljs-built_in">local</span></span>: --<span class="hljs-built_in"><span class="hljs-built_in">alias</span></span>=centos-image</code> </pre> <br><p>  centos-image - a synonym for the image to make it easier to access it </p><br><p>  Run the image: </p><br><pre> <code class="bash hljs">lxc launch <span class="hljs-built_in"><span class="hljs-built_in">local</span></span>:centos-image <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br><p>  test - the name of the future container </p><br><p>  You can run images in two commands: </p><br><pre> <code class="hljs bash">lxc init <span class="hljs-built_in"><span class="hljs-built_in">local</span></span>:centos-image <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> lxc start <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br><p>  The first command will create a container, and the second will launch it.  The first command is useful if you just want to create a container, but not run it. </p><br><p>  View the status of running containers. </p><br><pre> <code class="bash hljs">lxc list</code> </pre> <br><p>  The team should show the following information: </p><br><pre> <code class="bash hljs">(Ubuntu)[root@ubuntu /]<span class="hljs-comment"><span class="hljs-comment"># lxc list +------+---------+-------------------+------+------------+-----------+ | NAME | STATE | IPV4 | IPV6 | TYPE | SNAPSHOTS | +------+---------+-------------------+------+------------+-----------+ | test | RUNNING | 10.200.1.1 (eth0) | | PERSISTENT | 0 | +------+---------+-------------------+------+------------+-----------+</span></span></code> </pre> <br><p>  Please note that LXD has generated a static IP for the container that you configured in /etc/lxc-dnsmasq.conf </p><br><h2>  Folder forwarding </h2><br><p>  This command mounts the / data / test / folder folder into the test container in the / folder folder </p><br><pre> <code class="bash hljs">mkdir -p /data/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/folder chown 100000:100000 /data/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/folder lxc config device add disk_name <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> disk path=/folder <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>=/data/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/folder</code> </pre> <br><p>  Folder mounting does not change the contents of the / var / lib / lxd / containers / test folders, but is mounted in a separate / var / lib / lxd / devices / test folder.  Therefore, backups and container images will not contain mounted folders and files.  Updating the container from the backup or image will not affect the contents of the mounted folders. </p><br><p>  You can view configuration information through the command: </p><br><pre> <code class="hljs sql">lxc config <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span></code> </pre> <br><h2>  Connect to a virtual machine </h2><br><p>  Log in to the running test container: </p><br><pre> <code class="bash hljs">lxc <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> -- /bin/bash</code> </pre> <br><p>  Check the connection: </p><br><pre> <code class="bash hljs">ifconfig</code> </pre> <br><p>  Conclusion: </p><br><pre> <code class="bash hljs">[root@<span class="hljs-built_in"><span class="hljs-built_in">test</span></span> ~]<span class="hljs-comment"><span class="hljs-comment"># ifconfig eth0 Link encap:Ethernet HWaddr 00:16:3E:23:21:3F inet addr:10.200.1.1 Bcast:10.200.255.255 Mask:255.255.0.0 inet6 addr: fe80::216:3eff:fe23:213f/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:15078 errors:0 dropped:0 overruns:0 frame:0 TX packets:15320 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:28090645 (26.7 MiB) TX bytes:841975 (822.2 KiB) lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1 RX bytes:0 (0.0 b) TX bytes:0 (0.0 b)</span></span></code> </pre> <br><p>  Check NAT: </p><br><pre> <code class="bash hljs">ping ya.ru</code> </pre> <br><p>  Conclusion: </p><br><pre> <code class="bash hljs">[root@<span class="hljs-built_in"><span class="hljs-built_in">test</span></span> ~]<span class="hljs-comment"><span class="hljs-comment"># ping ya.ru PING ya.ru (93.158.134.3) 56(84) bytes of data. 64 bytes from www.yandex.ru (93.158.134.3): icmp_seq=1 ttl=50 time=105 ms 64 bytes from www.yandex.ru (93.158.134.3): icmp_seq=2 ttl=50 time=106 ms 64 bytes from www.yandex.ru (93.158.134.3): icmp_seq=3 ttl=50 time=105 ms 64 bytes from www.yandex.ru (93.158.134.3): icmp_seq=4 ttl=50 time=105 ms 64 bytes from www.yandex.ru (93.158.134.3): icmp_seq=5 ttl=50 time=104 ms 64 bytes from www.yandex.ru (93.158.134.3): icmp_seq=6 ttl=50 time=106 ms ^C --- ya.ru ping statistics --- 6 packets transmitted, 6 received, 0% packet loss, time 6671ms rtt min/avg/max/mdev = 104.942/105.845/106.664/0.568 ms</span></span></code> </pre> <br><p>  Install the base packages: </p><br><pre> <code class="bash hljs">yum install mc nano openssh-server epel-release wget -y yum update -y chkconfig sshd on service sshd start</code> </pre> <br><p>  Set root password </p><br><pre> <code class="bash hljs">passwd</code> </pre> <br><p>  Disconnect from the container: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br><h2>  Connect via ssh </h2><br><p>  Copy host ssh key to container </p><br><pre> <code class="bash hljs">ssh-copy-id root@10.200.1.1</code> </pre> <br><p>  If Ubuntu swears that it cannot find the key, then first generate the ssh key, and then copy it with the ssh-copy-id command.  If the key was copied successfully, then skip this step (key generation). </p><br><pre> <code class="bash hljs">ssh-keygen</code> </pre> <br><p>  Now you can enter the container via ssh without a password (via certificates): </p><br><pre> <code class="bash hljs">ssh root@10.200.1.1</code> </pre> <br><h2>  Forwarding ssh over NAT </h2><br><p>  Often you need to be able to connect via ssh to the container directly, bypassing the host (so that you do not go to the host each time to go to the container). </p><br><p>  To do this, execute the command: </p><br><pre> <code class="bash hljs">iptables -t nat -A PREROUTING -p tcp --dport 22001 -j DNAT --to-destination 10.200.1.1:22</code> </pre> <br><h2>  Autosave iptables after Ubuntu boot </h2><br><p>  In Ubuntu, by default, iptables is lost after a host reboot.  To solve this problem you need to create a file: </p><br><pre> <code class="bash hljs">nano /etc/network/<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-up.d/00-iptables</code> </pre> <br><p>  Write file contents: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh iptables-restore &lt; /etc/default/iptables #ip6tables-restore &lt; /etc/default/iptables6</span></span></code> </pre> <br><p>  Set launch permissions: </p><br><pre> <code class="bash hljs">chmod +x /etc/network/<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>-up.d/00-iptables</code> </pre> <br><p>  Save current settings: </p><br><pre> <code class="bash hljs">iptables-save &gt; /etc/default/iptables</code> </pre> <br><p>  Reboot and try to connect to the container via ssh: </p><br><pre> <code class="bash hljs">ssh root@&lt; ip  &gt; -p22001</code> </pre> <br><h2>  Iptables fine tuning </h2><br><p>  If you use iptables recovery when booting, then LXD will add its commands to iptables, and iptables will contain duplicate entries.  In addition, it is required to prohibit incoming connections on various servers and open only necessary ports. </p><br><p>  The ready listing <code>/etc/default/iptables</code> , which solves two tasks at once, is presented below: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Generated by iptables-save v1.6.0 on Fri Aug 19 16:21:18 2016 *mangle :PREROUTING ACCEPT [129:9861] :INPUT ACCEPT [129:9861] :FORWARD ACCEPT [0:0] :OUTPUT ACCEPT [102:11316] :POSTROUTING ACCEPT [102:11316] COMMIT # Completed on Fri Aug 19 16:21:18 2016 # Generated by iptables-save v1.6.0 on Fri Aug 19 16:21:18 2016 *nat :PREROUTING ACCEPT [0:0] :INPUT ACCEPT [0:0] :OUTPUT ACCEPT [0:0] :POSTROUTING ACCEPT [0:0] #  ssh    test -A PREROUTING -p tcp -m tcp --dport 22001 -j DNAT --to-destination 10.200.1.1:22 COMMIT # Completed on Fri Aug 19 16:21:18 2016 # Generated by iptables-save v1.6.0 on Fri Aug 19 16:21:18 2016 *filter :INPUT ACCEPT [128:9533] :FORWARD ACCEPT [0:0] :OUTPUT ACCEPT [102:11316] -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT -A INPUT -p icmp -j ACCEPT -A INPUT -i lo -j ACCEPT #    http  ssh -A INPUT -p tcp -m tcp --dport 80 -j ACCEPT -A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT #     -A INPUT -j REJECT --reject-with icmp-host-prohibited -A FORWARD -j REJECT --reject-with icmp-host-prohibited COMMIT # Completed on Fri Aug 19 16:21:18 2016</span></span></code> </pre> <br><h1>  Creating backups </h1><br><p>  This method creates container backups as LXD images, ready for import.  Ideally, take snapshots and send them to the LXD private repository.  But sometimes, this can not be done.  For example, a small company does not have the opportunity to buy another server.  In this case, you can do with a simple tar + Amazon S3 solution. </p><br><p>  Download ready-made scripts for creating and restoring backups: </p><br><pre> <code class="bash hljs">wget https://github.com/vistoyn/lxd_backup/raw/1.1/scripts/lxc-backup -O <span class="hljs-string"><span class="hljs-string">"/usr/local/bin/lxc-backup"</span></span> wget https://github.com/vistoyn/lxd_backup/raw/1.1/scripts/lxc-restore -O <span class="hljs-string"><span class="hljs-string">"/usr/local/bin/lxc-restore"</span></span></code> </pre> <br><p>  Set the execution flag for scripts: </p><br><pre> <code class="bash hljs">chmod +x /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/lxc-restore chmod +x /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/lxc-backup</code> </pre> <br><p>  Before creating and restoring backups, you need to stop the running container.  You can, in principle, make a backup on a running container, but when creating a backup, some data may be lost (depending on the installed programs in the container). </p><br><h2>  For dir </h2><br><p>  This command will create a backup of the test container, compress the file into an archive and save it to disk in the / backup / lxc / test folder: </p><br><pre> <code class="bash hljs">lxc stop <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> lxc-backup <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br><p>  Restore backup from snapshot: </p><br><pre> <code class="bash hljs">lxc-restore <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> /backup/lxc/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/snap-test-2016-08-19.tar.bz2</code> </pre> <br><h2>  For zfs </h2><br><p>  For ZFS, add ‚Äú.zfs‚Äù after the container name </p><br><p>  Creating backup: </p><br><pre> <code class="bash hljs">lxc stop <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> lxc-backup test.zfs</code> </pre> <br><p>  Restore backup from snapshot: </p><br><pre> <code class="bash hljs">lxc-stop <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> lxc-restore test.zfs /backup/lxc/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/snap-test.zfs-2016-08-19.tar.bz2</code> </pre> <br><h1>  Import backup </h1><br><p>  On a new host, you sometimes need to create a container from a backup.  To do this, you must first import the image, and then run it as a container. </p><br><p>  Import backup command as LXD image: </p><br><pre> <code class="bash hljs">lxc image import /backup/lxc/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/snap-test-2016-08-19.tar.bz2 --<span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> my-new-image</code> </pre> <br><p>  The command to run the image as a container: </p><br><pre> <code class="bash hljs">lxc launch me-new-image test2</code> </pre> <br><h1>  Materials </h1><br><p>  This article does not address many other LXD related issues.  Additional LXD literature can be read here: </p><br><ol><li>  <a href="https://linuxcontainers.org/ru/lxd/introduction/">LXD official website.</a> </li><li>  <a href="https://images.linuxcontainers.org:8443/">List of available images.</a> </li><li>  <a href="http://vasilisc.com/lxd-2-0-series">A series of articles about LXD 2.0 in Russian.</a> </li><li>  <a href="http://vasilisc.com/lxd-api-direct-interaction">Interact directly with LXD API.</a> </li><li>  <a href="http://vasilisc.com/lxd-2-0-docker-in-lxd">Run Docker in LXD container.</a> </li><li>  <a href="https://yahz.ru/article/15/nastrojka-statichnogo-adresa-dlya-lxc-kontejnera-v-ubuntu-1604">Setting up a static address for an LXC container in Ubuntu 16.04.</a> </li><li>  <a href="https://yahz.ru/article/8/nastrojka-zfs-dlya-lxd-v-ubuntu">Configure ZFS for LXD in Ubuntu.</a> </li><li>  <a href="https://yahz.ru/article/9/spravochnaya-informaciya-po-zfs">ZFS reference information.</a> </li><li>  <a href="https://toster.ru/q/34551">How to keep iptables rules after rebooting Ubuntu?</a> </li><li>  <a href="https://github.com/vistoyn/lxd_backup">The utility for creating and restoring backups for LXD</a> . </li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/308400/">https://habr.com/ru/post/308400/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308386/index.html">7 helpful morning habits of psychologically enduring people</a></li>
<li><a href="../308388/index.html">How to keep healthy relationships by being a developer</a></li>
<li><a href="../308392/index.html">Back to basics or a step forward? HPE StoreVirtual VSA</a></li>
<li><a href="../308394/index.html">Programs become more important than iron</a></li>
<li><a href="../308398/index.html">How we wrote a chat for the application of the bank "Opening"</a></li>
<li><a href="../308402/index.html">Docker: flexible network without NAT for all occasions</a></li>
<li><a href="../308406/index.html">New course on Stepic platform: "Advanced C / C ++ Programming"</a></li>
<li><a href="../308410/index.html">JavaScript Performance, databases and searches for the "silver bullet": video TOP-5 reports of HolyJS 2016</a></li>
<li><a href="../308412/index.html">SAP F & R: Order Creation Process. Part 1</a></li>
<li><a href="../308418/index.html">We work with a hybrid cloud: VMware vCloud Connector, part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>