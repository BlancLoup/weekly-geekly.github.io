<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Typical billing scheme</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As a person, I was exhausted by various ASRs and I myself took part in the development of ASR regularly faced with the absence of some typical scheme ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Typical billing scheme</h1><div class="post__text post__text-html js-mediator-article">  As a person, I was exhausted by various ASRs and I myself took part in the development of ASR regularly faced with the absence of some typical scheme that could be looked at to evaluate the ASR, as well as before creating my own ASR.  There are a number of works on the network on this topic. For example, I once studied this diploma while writing a diploma. <a href="http://tekhnosfera.com/metody-modelirovaniya-i-razrabotki-billingovyh-sistem">Methods of modeling and developing billing systems</a> .  A diploma is a diploma and it is a strange task to drag out schemes from it, since it does not respond to the realities. <br><a name="habracut"></a><br>  As a result, now having quite a lot of experience with ASR, I decided to make my own scheme.  But since I am still one person, then it should be shown to others and criticized.  So I hope they will be interested in this topic and they will tell me what else to do and how.  The scheme that I publish here has already been improved and corrected, and it is already possible to download it from <a href="https://github.com/norguhtar/cake-billing">github</a> .  Both as a file for Power Architect and as a ready-made DDL file for PostgreSQL.  The only thing I did not have time to fill out reference books, but everything has its time.  Now go to the scheme. <br><br>  The first step is to look at the ER-diagram, as the most convenient means of representation of the scheme. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b09/edb/8c2/b09edb8c203faf0cc91dc3eb1cecac39.png" alt="ER diagram"><br></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you can see, although there are quite a lot of tables, in fact, the functionality is quite small. <br>  And consists of the following features: <br><br><ul><li>  Storage of the client‚Äôs contract and its balance sheet </li><li>  Storage of services and their cost management </li><li>  Charges for the services provided </li><li>  Discounts </li><li>  Making payments </li><li>  Money transfer from contract to contract </li><li>  Entering customer balances when transferring them from another system </li><li>  Storage of billed customer </li><li>  Redemption of invoices </li></ul><br>  It is a necessary minimum for correct carrying out charges for services and accounting of funds. <br>  But before proceeding to the description, it is worth mentioning the agreements used in the scheme: <br><ul><li>  All foreign keys have the format <i>&lt;primary key&gt; _ &lt;table name&gt;</i> .  If there are several foreign keys or they point to the table itself, it is allowed either addition to the name of the form <i>id_ &lt;table name&gt; _ &lt;explanatory addition&gt;</i> or <i>id_ &lt;explanatory addition&gt;</i> .  As an example, id_trx_from, id_trx_to for the first case and <i>id_revoke</i> , <i>id_revokedby</i> for the second case in the bill.transfer table. <br></li><li>  Fields with money are defined as numeric (18,4). </li><li>  Fields with a date have the prefix dt without fail. </li><li>  Fields with date and time are prefixed with ts. </li><li>  If there is a time interval (dtfrom, dtto or tsfrom, tsto), then the first date is always set and defaults to now (), the second date can be empty and in this case the interval is considered valid at the moment. </li><li>  In some cases, reference books use a text mnemonic key instead of a numeric primary key.  Such keys are denoted as sid.  Used exclusively for convenience when working with data directly through the RDBMS console. </li></ul><br>  And now the description <s>slides</s> . <br><br>  Reference tables are: <br><ul><li>  Contracts (bill.contract) - the minimum required to use description of the contract </li><li>  Postings (bill.trx) - Log of transactions.  In fact, the amount of money has come or gone from the account. </li><li>  Used accounting side (bill.ledgertype) - indicates where the posting is going (debit, credit) </li><li>  Reporting periods (bill.period) - reports in the accounting sense of the word.  Although it contains the start date and the end date, in fact it is always equal to the month </li><li>  The invoices issued to the client (bill.invoice) are the same invoices that are issued to the client during the reporting period. </li></ul><br>  Although these tables are quite enough for billing to work, but for convenience, tables of primary documents are added.  The primary documents are those documents on the basis of which the entries are made to under the client's contract. <br><br>  Now in the scheme there are the following primary documents: <br><ul><li>  Balances (bill.remain) - incoming balances from another system.  These documents must always be available, otherwise if you are migrating from another system, you will never know what the client balance was at the time of the migration.  By the way, many ASRs suffer from this, as the developers believe that it is enough to introduce a balance.  But this is not the case, as in the normal system the client‚Äôs balance is a calculated value. </li><li>  Payments (bill.payment) - incoming cash from customers. </li><li>  Transfers (bill.transfer) - transfer of funds from one account to another.  I note right away that it is worth explicitly prohibiting the transfer of funds in their absence.  Those.  if the client‚Äôs balance is negative, the transfer should be prohibited. </li><li>  Charges (bill.charge) - charges for consumed or provided (in advance) services </li><li>  Discounts (bill.discount) - Discounts for services.  Although in general there is no consensus on how to express a discount.  I believe that the discount should be expressed in monetary terms to a specific charge.  It simplifies working with her. </li><li>  VAT (bill.vat) - VAT from the accrual, is issued a separate document.  All transactions from accruals are without VAT, while the accrual itself may include VAT.  This is for example required for individuals.  In this case, bill.charge has an explicit flag that the charge includes VAT.  In this case, the accrual posting does not include VAT and the full amount of the accrual is made up of two postings, the posting on the original document is the accrual + posting on VAT. </li></ul><br>  Primary documents have both general fields and general rules for working with them.  Let's start with the general fields: <br><ul><li>  id_contract (id_contract_from, id_contract_to) - indicates the contract or document contract </li><li>  id_trx (id_trx_from, id_trx_to) - indicates the posting or posting of the document </li><li>  id_period - during which reporting period the document is posted. </li><li>  ts - document date </li><li>  tscreate is the date the document was created. </li><li>  amount - document amount </li><li>  id_revoke is a corrected document.  Indicates the document that is being corrected by this. </li><li>  id_revokedby - corrective document.  Indicates the document that has corrected the current one. </li></ul><br>  As for the reporting period and the corrected and correctional document, I‚Äôll stop by more detail. <br><br>  Reporting period. <br>  At the end of the month, you may have two open reporting periods due to the fact that, for example, the last days fall on a weekend, and the payments to the bank have not yet been posted.  Plus, this is required in cases such as when the actual document date is January 2014, and the period used is June 2015, held in early July 2015. That is,  in the period June 2015, in the creation date July 2, 2015, and in the document date January 2014. Because of this, the document actually has three dates. <br><br>  Corrected and corrective documents. <br>  In fact, if you have a document in your system that is in error, you cannot delete it.  It can only be canceled.  Those.  create a corrective document which is strictly opposite to the incorrect document.  For this purpose, these two fields are used.  <i>id_revoke</i> - filled in the correction document, and <i>id_revokedby</i> in the corrected one.  Otherwise, for example, a part of the document is not recommended, as well as deleting documents.  Instead, hide such documents, if they are in the same period.  If the documents are in different periods, then you don‚Äôt need to hide them.  Also note that the wiring of such fields is not, they are not adjustable. <br><br>  In addition to general fields, primary documents have their own specific fields: <br><ul><li>  Charging documents (bill.charge) - <i>count</i> and <i>vatincluded</i> .  The first indicates the number of services provided, the second does not include VAT in the amount of the document. </li><li>  VAT documents (bill.vat) - <i>id_charge</i> and <i>id_vatrate</i> indicating the document of charges to which the VAT applies and what percentage of VAT was at the time of the document of charges. </li><li>  Discount documents (bill.discount) - <i>id_charge</i> indicating the charge applied. </li><li>  Residual documents (bill.remain) - <i>sid_ledgertype</i> that allows you to specify the accounting side to use when conducting a document. </li></ul><br><br>  Remaining fields I think are clear from a context and the selected names.  This concludes the conversation about primary documents and go to the remaining reference tables. <br><br>  The schema contains the following reference tables: <br><ul><li>  Payment types (bill.paymenttype) - for dividing payments by types.  Cash, cashless payment, payment agents, etc. </li><li>  Units of measurement (bill.unit) - units of measurement of services used.  For example, you can take from the directory OKEI.  Self reference is used for units that include others. </li><li>  Services (bill.service) - the name of the services provided under the contract. </li><li>  Prices (bill.price) - Cost of services.  Time intervals have been added to account for changes in value. </li><li>  Posting type (bill.trxtype) - Indicates the type of transaction used for primary documents, as well as the default accounting side.  If the default party is not specified, the selection takes place when the document is posted.  For example, these are leftover documents. </li></ul><br>  As well as two auxiliary tables: <br><ul><li>  Balance history (bill.balance) - the history of the change in the balance of the contract with reference to the postings. </li><li>  Turnover (Balance) for the reporting period (bill.saldo) - a table with aggregated data on turnover related to the period.  It is often used in various analytics. </li></ul><br>  And that is all.  If you do not mind to answer the survey.  The results will be taken into account when writing the next post in the series :) Well, ask your questions in the comments. </div><p>Source: <a href="https://habr.com/ru/post/259921/">https://habr.com/ru/post/259921/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259909/index.html">How-to: Typography in the design of email-letters</a></li>
<li><a href="../259911/index.html">How we tested a static analysis on our project of a training simulator of endovascular surgery</a></li>
<li><a href="../259915/index.html">Processing Russian text data in Azure Machine Learning</a></li>
<li><a href="../259917/index.html">Welcome to the Softlayer Workshop June 16</a></li>
<li><a href="../259919/index.html">USB adapter for a B7-28 digital voltmeter based on Arduino Mega</a></li>
<li><a href="../259923/index.html">Preparing reports for the board of directors in 20 minutes</a></li>
<li><a href="../259925/index.html">Arduino + ESP8266 from scratch on the example of a Wi-Fi thermometer, part one</a></li>
<li><a href="../259927/index.html">‚ÄúAlfa-Bank, Microsoft, VISA and IIDF gather developers for the 8-week hackaton‚Äú AlfaCamp 2.0 ‚Äù</a></li>
<li><a href="../259929/index.html">Video of reports from Golang Moscow</a></li>
<li><a href="../259937/index.html">Limiting outgoing messages on a server with postfix and postfwd</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>