<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Traffic lights in the garage. Present</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It was a fine and nasty rain. The mood was vile. 
 He lay on the side of the road and quietly rusted. Nearby on the post a young fellow gleamed with l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Traffic lights in the garage. Present</h1><div class="post__text post__text-html js-mediator-article">  It was a fine and nasty rain.  The mood was vile. <br>  He lay on the side of the road and quietly rusted.  Nearby on the post a young fellow gleamed with lights. <br>  I stopped and put it in the trunk. <br>  I'm not alone anymore. <br>  And he is not alone. <br><a name="habracut"></a><br>  Brought to the country, dismantled, laundered from the dirt and painted from the spray. <br><br>  Application was found immediately.  The new car turned out to be wider than the previous one and check-in to the garage became more problematic.  Any "bells-on-strings" - this is not for us.  So - stationary parking sensors. <br><br><h5>  Equipment </h5><br>  1. Widespread ultrasonic sensors HC-SR04.  2 pieces, one for each wall.  The Internet is full of information about them.  Description below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i><u>Ultrasonic Ranging Module HC - SR04</u></i> <br><br><h6>  Product features: </h6><br>  <i>Can be up to 3mm.</i>  <i>The modules include ultrasonic transmitters, receiver and control circuit.</i>  <i>The basic principle of work:</i> <i><br></i>  <i>Using IO trigger for at least 10us high level signal.</i> <i><br></i>  <i>If there is a pulse signal back.</i> <i><br></i>  <i>If you‚Äôre trying to get back to your car, you‚Äôll find out how to get back.</i> <i><br></i>  <i>Test distance = (high level time velocity of sound (340M / S) / 2</i> <br><br><h6>  Wire connecting direct as following: </h6><br>  <i>5V Supply</i> <i><br></i>  <i>Trigger Pulse Input</i> <i><br></i>  <i>Echo pulse output</i> <i><br></i>  <i>0V Ground</i> <br><h6>  Electric parameter </h6><br>  <i>Working Voltage DC 5 V</i> <i><br></i>  <i>Working Current 15mA</i> <i><br></i>  <i>Working Frequency 40Hz</i> <i><br></i>  <i>Max Range 4m</i> <i><br></i>  <i>Min Range 2cm</i> <i><br></i>  <i>Measuring Angle 15 degree</i> <i><br></i>  <i>Trigger Input Signal 10uS TTL pulse</i> <i><br></i>  <i>Echo Output Signal</i> <i><br></i>  <i>Dimension 45 * 20 * 15mm</i> <br><br><img src="https://habrastorage.org/files/d16/0b6/72a/d160b672a5a44d9fb0c4f887c707a07a.jpg" alt="image"><br><br><h6>  Timing diagram </h6><br>  <i>The Timing diagram is shown below.</i>  <i>If you want to take a bit of energy, you‚Äôll be able to get back over the cycle of 10 kHz, and then you will be able to bang the pulse.</i>  <i>This is the distance between the counting and the echo signal.</i>  <i>Formula: uS / 58 = centimeters or uS / 148 = inch;</i>  <i>or: the range = high-level time * velocity (340M / S) / 2;</i>  <i>In order to prevent the echo signal.</i> <br><br><img src="https://habrastorage.org/files/8f5/3bb/31b/8f53bb31b423458080f9ca88647fda2c.jpg" alt="image"><br><br>  Fixed on the side walls at the entrance to the garage using strips of galvanized tin.  The mount should allow you to adjust the sensors "in place" depending on the size of the car (height, width of the hood, the shape of the wings ...). <br><br><img src="https://habrastorage.org/files/01e/2a6/c87/01e2a6c873044f79be8cddcfbb1a05a6.JPG" alt="image"><br><br>  2. The controller - PIC16f84a.  Why this: <br>  a) I have them; <br>  b) it has 2 I / O ports, a total of 13 bits, which is exactly what is needed.  3 pcs.  - traffic light control (Red - Yellow - Green), 6pcs.  - left and right LEDs (K-ZHZ), 2 pieces.  - pulse location (Trig) on ‚Äã‚Äãthe left and right sensors, 2 pcs.  - reflected pulse (Echo) from the left and right sensors. <br><br>  3. Two three-color LEDs, one for each wall.  LEDs Red - Yellow - Green not found.  Maybe it does not happen, and maybe it was looking bad.  Therefore, the role of yellow in LEDs plays blue.  For complete identity, of course, it was possible to use separate LEDs.  And there would be no problems with yellow.  But I considered such a compromise admissible. <br><br><img src="https://habrastorage.org/files/388/9a0/333/3889a0333be9411eafbe0c5c6dec0aa5.JPG" alt="image"><br><br>  4. Control units for traffic lights.  3 pieces, one for each lamp. <br>  Ideal control unit on-off TV. <br><br><img src="https://habrastorage.org/files/c5c/f2d/ef0/c5cf2def0f994534aa9336f780889a82.JPG" alt="image"><br><br>  It consists of a low-power power transformer (220 to 7 volts), a diode rectifier, a stabilizer on 1425 (or equivalent), a transistor switch and a relay.  When a logical ‚Äú1‚Äù is fed to the input, the key opens, the relay is activated and 220v is output.  In addition, since the KREN provides stabilized 5v, it is reasonable to power the microcontroller from one of these units.  They are full on any radio market.  If someone is annoyed by clicking the relay, it is easy to make a circuit on the thyristors. <br><br>  5. Quartz resonator at 4 MHz. <br>  This is a very convenient frequency for those microcontrollers that I have.  It is easy to count the time parameters.  The period of clock pulses = 250ns, the machine cycle consists of four cycles, therefore, equal to 1 Œºs.  Commands in RISC controllers are executed in 1 or 2 machine cycles, so the calculation of the time that passes ‚Äúfrom how ... to‚Äù is no problem.  You can use another within the allowed frequencies, but you will have to recalculate the timeouts.  This is quite a small problem. <br><br>  6. Several resistors and capacitors recommended by the standard PIC16f84a switching circuit and two current-limiting resistors for LEDs.  Datashit watch, for example, here: <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/35007b.pdf">link</a> . <br><br>  General view of the assembled device: <br><br><img src="https://habrastorage.org/files/aab/36c/332/aab36c33254040589f899b4fedb61ea1.JPG" alt="image"><br><img src="https://habrastorage.org/files/e45/ff8/b2b/e45ff8b2b1a347cd9175327baa4d5d05.JPG" alt="image"><br><br>  Board with a microcontroller: <br><br><img src="https://habrastorage.org/files/d2e/90c/e34/d2e90ce3437c41e3ba812608cab6f998.JPG" alt="image"><br><br><h5>  Schematic diagram </h5><br><img src="https://habrastorage.org/files/976/a08/8fb/976a088fb0ab4cd0a7744a265114583d.jpg" alt="image"><br><br><h5>  Algorithm </h5><br>  Simple, almost linear.  On power-up test equipment is carried out.  Ostensibly test, more for beauty.  With an interval of 1s red-yellow-green switches, then with the same interval all the lights turn on three times.  After that - the transition to an infinite loop of polling the left and right channels.  When each channel passes, depending on the result, the corresponding bit (flag) PORTB is set and one of the LEDs of this channel turns on.  At the end of the full cycle, an analysis is made of the state of the Red-Yellow-Green flags of both channels and, based on this, the corresponding traffic light is turned on.  The truth table looks like this: <br><br>  Any channel <i>Red</i> .  Traffic light - <i>Red</i> . <br>  Both channels are <i>Green</i> .  Traffic light - <i>Green</i> . <br>  All other cases.  Traffic light - <i>Yellow</i> . <br><br>  In a few words, the core of the algorithm "step by step": <br><br>  1. We form the impulse Trig; <br>  2. We expect the arrival of the response pulse Echo; <br>  3. We start timeout 1ms; <br>  4. After the timeout expires, we check if there is still ‚Äúlog.1‚Äù at the input of Echo; <br>  5. If not, then we are on a dangerous approach to the sensor of the corresponding channel.  Turn on the red flag of this channel and switch to another channel; <br>  6. If Echo is still there, repeat pp.3 and 4; <br>  7. If not, then we are at an average distance from the sensor.  Turn on the yellow flag and go to another channel; <br>  8. If Echo is still there, then we are far away.  We are waiting for it to end, turn on the green flag and go to another channel. <br><br><img src="https://habrastorage.org/files/5e1/ec0/07b/5e1ec007b97a43aa9ed4860a37b9c566.jpg" alt="image"><br><br>  What is the point?  We do not need to calculate the exact distance to the object.  That is, it is not necessary to divide the pulse width Echo by 58, as indicated in the sensor description.  We are not building a rangefinder.  We need to know only the position of the object in relation to two identical ranges of distances from the object to the sensor.  For this, a timeout of 1ms is used (see section 3), which ultimately results in: 1000¬µs: 58 = 17cm.  So - closer 17cm - red, from 17 to 34cm - yellow, then 34cm - green.  Changing the constants in the subprogram ‚ÄúPause 1ms‚Äù, you can vary the distance depending on the size of the car, the width of the gate and driving skills. <br><br><h5>  Firmware </h5><br>  The firmware listing is shown below.  Assembler  The constants, except for those in timeouts, are in binary, because the device is bit-oriented.  And when debugging or analyzing, you would still have to translate into a binary system.  To prevent freezes in the program, Watchdog Timer is used. <br><div class="spoiler">  <b class="spoiler_title">Listing</b> <div class="spoiler_text"><pre><code class="hljs dos">list p=<span class="hljs-number"><span class="hljs-number">16</span></span>F84A ; list directive to define processor #include &lt;p16F84A.inc&gt; ; processor specific variable definitions __CONFIG _CP_OFF &amp; _WDT_ON &amp; _PWRTE_ON &amp; _XT_OSC ;********************** Contact Assignment ***************************** ; Contact # Name Function ; <span class="hljs-number"><span class="hljs-number">17</span></span> RA0 output TrigLeft ; <span class="hljs-number"><span class="hljs-number">18</span></span> RA1 output TrigRight ; <span class="hljs-number"><span class="hljs-number">01</span></span> RA2 input EchoLeft ; <span class="hljs-number"><span class="hljs-number">02</span></span> RA3 input EchoRight ; <span class="hljs-number"><span class="hljs-number">03</span></span> RA4 output GenRed ; <span class="hljs-number"><span class="hljs-number">06</span></span> RB0 output RedLeft ; <span class="hljs-number"><span class="hljs-number">07</span></span> RB1 output YellowLeft ; <span class="hljs-number"><span class="hljs-number">08</span></span> RB2 output GreenLeft ; <span class="hljs-number"><span class="hljs-number">09</span></span> RB3 output RedRight ; <span class="hljs-number"><span class="hljs-number">10</span></span> RB4 output YellowRight ; <span class="hljs-number"><span class="hljs-number">11</span></span> RB5 output GreenRight ; <span class="hljs-number"><span class="hljs-number">12</span></span> RB6 output GenYellow ; <span class="hljs-number"><span class="hljs-number">13</span></span> RB7 output GenGreen ; ;******************* Constants ************************** ; Red <span class="hljs-number"><span class="hljs-number">00000001</span></span> Left channel ; Yellow <span class="hljs-number"><span class="hljs-number">00000010</span></span> Left channel ; Green <span class="hljs-number"><span class="hljs-number">00000100</span></span> Left channel ; ; Red <span class="hljs-number"><span class="hljs-number">00001000</span></span> Right channel ; Yellow <span class="hljs-number"><span class="hljs-number">00010000</span></span> Right channel ; Green <span class="hljs-number"><span class="hljs-number">00100000</span></span> Right channel ;***** VARIABLE DEFINITIONS ***************************** CBLOCK <span class="hljs-number"><span class="hljs-number">0</span></span>x0C Reg_1 ; <span class="hljs-number"><span class="hljs-number">0</span></span>x0C use within <span class="hljs-built_in"><span class="hljs-built_in">Pause</span></span> subroutine Reg_2 ; <span class="hljs-number"><span class="hljs-number">0</span></span>x0D use within <span class="hljs-built_in"><span class="hljs-built_in">Pause</span></span> subroutine Reg_3 ; <span class="hljs-number"><span class="hljs-number">0</span></span>x0E use within <span class="hljs-built_in"><span class="hljs-built_in">Pause</span></span> subroutine ENDC #define bank0 bcf STATUS,RP0 ; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> bank0 #define bank1 bsf STATUS,RP0 ; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> bank1 #define TrigLeft_1 bsf PORTA,<span class="hljs-number"><span class="hljs-number">0</span></span> ; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> Trigleft #define TrigLeft_0 bcf PORTA,<span class="hljs-number"><span class="hljs-number">0</span></span> ; clean Trigleft #define TrigRight_1 bsf PORTA,<span class="hljs-number"><span class="hljs-number">1</span></span> ; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> Trigright #define TrigRight_0 bcf PORTA,<span class="hljs-number"><span class="hljs-number">1</span></span> ; clean Trigright #define EchoLeft PORTA,<span class="hljs-number"><span class="hljs-number">2</span></span> #define EchoRight PORTA,<span class="hljs-number"><span class="hljs-number">3</span></span> #define RedLeft b'<span class="hljs-number"><span class="hljs-number">00000001</span></span> #define YellowLeft b'<span class="hljs-number"><span class="hljs-number">00000010</span></span> #define GreenLeft b'<span class="hljs-number"><span class="hljs-number">00000100</span></span> #define RedRight b'<span class="hljs-number"><span class="hljs-number">00001000</span></span> #define YellowRight b'<span class="hljs-number"><span class="hljs-number">00010000</span></span> #define GreenRight b'<span class="hljs-number"><span class="hljs-number">00100000</span></span> ;********************************************************************** ORG <span class="hljs-number"><span class="hljs-number">0</span></span>x000 ; processor reset vector <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> main ; go to beginning of program ;---------------------------------------------------------------------- ;------------------ SUBROUTINE Pulse -------- ;delay = <span class="hljs-number"><span class="hljs-number">10</span></span> machine cycles = <span class="hljs-number"><span class="hljs-number">10</span></span> ¬µs Pulse movlw .<span class="hljs-number"><span class="hljs-number">3</span></span> movwf Reg_1 wr0 decfsz Reg_1,F <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wr0 return ;------------------ SUBROUTINE <span class="hljs-built_in"><span class="hljs-built_in">Pause</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>ms -------- ;delay = <span class="hljs-number"><span class="hljs-number">1</span></span>'<span class="hljs-number"><span class="hljs-number">000</span></span> machine cycles <span class="hljs-built_in"><span class="hljs-built_in">Pause</span></span> movlw .<span class="hljs-number"><span class="hljs-number">75</span></span> movwf Reg_1 movlw .<span class="hljs-number"><span class="hljs-number">3</span></span> movwf Reg_2 wr1 decfsz Reg_1,F <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wr1 clrwdt decfsz Reg_2,F <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wr1 nop return ;-------------------- SUBROUTINE <span class="hljs-built_in"><span class="hljs-built_in">Pause</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>sec --- ;delay = <span class="hljs-number"><span class="hljs-number">1</span></span>'<span class="hljs-number"><span class="hljs-number">000</span></span>'<span class="hljs-number"><span class="hljs-number">000</span></span> machine cycles Pause1 movlw .<span class="hljs-number"><span class="hljs-number">254</span></span> movwf Reg_1 movlw .<span class="hljs-number"><span class="hljs-number">17</span></span> movwf Reg_2 movlw .<span class="hljs-number"><span class="hljs-number">6</span></span> movwf Reg_3 wr2 decfsz Reg_1,F <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wr2 clrwdt decfsz Reg_2,F <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wr2 decfsz Reg_3,F <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wr2 nop nop return ;-------------------- SUBROUTINE <span class="hljs-built_in"><span class="hljs-built_in">Pause</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span>ms -------- ;delay = <span class="hljs-number"><span class="hljs-number">50</span></span>'<span class="hljs-number"><span class="hljs-number">000</span></span> machine cycles Pause2 movlw .<span class="hljs-number"><span class="hljs-number">216</span></span> movwf Reg_1 movlw .<span class="hljs-number"><span class="hljs-number">65</span></span> movwf Reg_2 wr3 decfsz Reg_1,F <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wr3 clrwdt decfsz Reg_2,F <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> wr3 return ;--------------------- SUBROUTINE General Red --------------- GenRed bsf PORTA,<span class="hljs-number"><span class="hljs-number">4</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">6</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">7</span></span> return ;--------------------- SUBROUTINE General Green ------------- GenGreen bsf PORTB,<span class="hljs-number"><span class="hljs-number">7</span></span> bcf PORTA,<span class="hljs-number"><span class="hljs-number">4</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">6</span></span> return ;--------------------- SUBROUTINE General Yellow ------------ GenYellow bsf PORTB,<span class="hljs-number"><span class="hljs-number">6</span></span> bcf PORTA,<span class="hljs-number"><span class="hljs-number">4</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">7</span></span> return ;--------------------- SUBROUTINE General All ------------ GenAll bsf PORTA,<span class="hljs-number"><span class="hljs-number">4</span></span> bsf PORTB,<span class="hljs-number"><span class="hljs-number">6</span></span> bsf PORTB,<span class="hljs-number"><span class="hljs-number">7</span></span> return ;--------------------------------------------------------- main bank1 ; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> Bank <span class="hljs-number"><span class="hljs-number">1</span></span> movlw <span class="hljs-number"><span class="hljs-number">0</span></span>x00 movwf TRISB ; PORTB - out movlw b'<span class="hljs-number"><span class="hljs-number">00001100</span></span> movwf TRISA ; RA2,RA3 - input; RA0,RA1,RA4 - output bank0 ; return to Bank <span class="hljs-number"><span class="hljs-number">0</span></span> clrf PORTA clrf PORTB ; turn off all lights ;---------------------- TEST ----------------------------- <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> GenRed <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pause1 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> GenYellow <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pause1 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> GenGreen <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pause1 bcf PORTA,<span class="hljs-number"><span class="hljs-number">4</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">6</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pause1 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> GenAll <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pause1 bcf PORTA,<span class="hljs-number"><span class="hljs-number">4</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">6</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pause1 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> GenAll <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pause1 bcf PORTA,<span class="hljs-number"><span class="hljs-number">4</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">6</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pause1 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> GenAll <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pause1 bcf PORTA,<span class="hljs-number"><span class="hljs-number">4</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">6</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pause1 <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SoundRight ;------------------LEFT---------------------- SoundLeft TrigLeft_1 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pulse TrigLeft_0 btfss EchoLeft <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> $-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Pause</span></span> btfss EchoLeft <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SetRedLeft <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Pause</span></span> btfss EchoLeft <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SetYellowLeft <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SetGreenLeft SetRedLeft movlw RedLeft iorwf PORTB,<span class="hljs-number"><span class="hljs-number">1</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">1</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SoundRight SetYellowLeft movlw YellowLeft iorwf PORTB,<span class="hljs-number"><span class="hljs-number">1</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">0</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SoundRight SetGreenLeft movlw GreenLeft iorwf PORTB,<span class="hljs-number"><span class="hljs-number">1</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">0</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">1</span></span> clrwdt btfsc EchoLeft ; wait <span class="hljs-built_in"><span class="hljs-built_in">Echo</span></span> end <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> $-<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SoundRight ;----------------RIGHT--------------------- SoundRight <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pause2 TrigRight_1 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Pulse TrigRight_0 btfss EchoRight <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> $-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Pause</span></span> btfss EchoRight <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SetRedRight <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Pause</span></span> btfss EchoRight <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SetYellowRight <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SetGreenRight SetRedRight movlw RedRight iorwf PORTB,<span class="hljs-number"><span class="hljs-number">1</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">4</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SetGenLight SetYellowRight movlw YellowRight iorwf PORTB,<span class="hljs-number"><span class="hljs-number">1</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">3</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SetGenLight SetGreenRight movlw GreenRight iorwf PORTB,<span class="hljs-number"><span class="hljs-number">1</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">3</span></span> bcf PORTB,<span class="hljs-number"><span class="hljs-number">4</span></span> clrwdt btfsc EchoRight ; wait <span class="hljs-built_in"><span class="hljs-built_in">Echo</span></span> end <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> $-<span class="hljs-number"><span class="hljs-number">2</span></span> ;------------------------ <span class="hljs-built_in"><span class="hljs-built_in">Set</span></span> General Lights ---------------- SetGenLight btfss PORTB,<span class="hljs-number"><span class="hljs-number">0</span></span> ; check RedLeft <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> CheckRedRight <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> GenRed <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SoundLeft CheckRedRight btfss PORTB,<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> CheckGreenLeft <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> GenRed <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SoundLeft CheckGreenLeft btfss PORTB,<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SetGenYellow btfss PORTB,<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SetGenYellow <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> GenGreen <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SoundLeft SetGenYellow <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> GenYellow <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> SoundLeft END</code> </pre> </div></div><br><br><h5>  Video </h5><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://rutube.ru/play/embed/7303690&amp;xid=17259,15700022,15700186,15700191,15700253&amp;usg=ALkJrhgzzXdIAKPL4yeZJ7Ve9CGR1MEDjQ" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://rutube.ru/play/embed/7311250&amp;xid=17259,15700022,15700186,15700191,15700253&amp;usg=ALkJrhio_HrusG0dwUbVsTPv6OOyxYHwcQ" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe><br><br><h5>  Thanks and commitment </h5><br>  The author expresses his gratitude to his wife, who during real tests stood fearlessly at the garage door and ensured that the author did not drive either the left or the right wing of the car into the wall at the entrance.  If there are fearless followers who want to repeat the project, the author will answer all. </div><p>Source: <a href="https://habr.com/ru/post/242097/">https://habr.com/ru/post/242097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242085/index.html">How programmers look for apartments</a></li>
<li><a href="../242087/index.html">How to become a Fulbright Fellow and go to magistracy in the United States [Practical Guide]</a></li>
<li><a href="../242089/index.html">Layout of business cards in LaTeX</a></li>
<li><a href="../242091/index.html">Using the MVC approach in WinForms for the smallest</a></li>
<li><a href="../242095/index.html">The path of the developer: stories about my fabulous failures, part 1</a></li>
<li><a href="../242099/index.html">Orb. DIY news server</a></li>
<li><a href="../242101/index.html">Patch update FFCMS 2.0.4</a></li>
<li><a href="../242103/index.html">JetBrains took another step towards education by releasing the PyCharm Educational Edition.</a></li>
<li><a href="../242105/index.html">Intel INDE 2015 - a new useful tool for developing cross-platform applications</a></li>
<li><a href="../242109/index.html">Speech recognition in FreePBX using Yandex Speechkit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>