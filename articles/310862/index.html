<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Toyota: 81,514 code violations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="People: - Hey, Toyota, we counted here, you have 89 people died from 2000 to 2010 because of clumsy electronics and software. 
 Toyota: - Yes, they ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Toyota: 81,514 code violations</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/0fe/85e/901/0fe85e901da457c1326a98fab1a0914f.jpg"><br><br>  People: - Hey, Toyota, we counted here, you have 89 people died from 2000 to 2010 because of clumsy electronics and software. <br>  Toyota: - Yes, they are to blame, they confuse the pedals. <br>  People: - Houston, we have problems. <br>  NASA: ‚ÄúWe'll figure it out, we need 10 months and 3 million dollars. <br>  People: - On. <br>  Toyota: - 3 million few, here's another top of the cache. <br>  <em>(10 months have passed)</em> <br>  NASA: - Hey, Toyota, we have found a couple of errors in the code, or rather 7134 violations of the MISRA standards, recursion, a function of 740 lines and 9000 global variables. <br>  Toyota: - And we have our own standards.  And you finally flew to the moon? <br>  NASA (publicly): - Toyota is not guilty of anything. <br>  <em>(Toyota shares jumped 4.6%)</em> <br>  People: - Well, ee-mine. <br>  <em>(3 years later)</em> <br>  Two American testers (whose grandfathers died at Pearl Harbor): - No bugs?  And if we find? <br><a name="habracut"></a><br><br>  The National Highway Traffic Safety Administration (NHTSA) estimated that from 2000 to 2010, 89 people died in accidents and 57 were injured due to electronics malfunctions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Toyota denies the fault of electronics and believes, on the basis of <a href="http://pressroom.toyota.com/article_download.cfm%3Farticle_id%3D3597">its own investigation</a> , that the "sticking" gas pedal and poorly fitted floor mats are to blame, but recalls 8.5 million cars around the world. <br><br>  Complaints continue to come. <br><br><div class="spoiler">  <b class="spoiler_title">Watch out for the faint of heart</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/cOWdWHSgI-4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br>  NHTSA begin <a href="http://www.nhtsa.gov/PR/DOT-16-11">their own investigation</a> , are attracted to the aid of NASA. <br><br>  During the ten-month investigation, NASA specialists revealed that the software does not meet the standards of the <a href="https://ru.wikipedia.org/wiki/MISRA_C">MISRA</a> (Motor Industry Software Reliability Association) and contains 7134 violations.  Toyota responded that they have their own standards. <br><br>  December 20, 2010 Toyota rejects all charges, but pays <a href="http://www.nhtsa.gov/PR/DOT-16-11"><strong>$ 16 billion</strong></a> in pre-trial claims and issues an update of software for some models of cars and withdraws 5.5 million cars. <br><br>  After the announcement of the NASA study, Toyota shares on the Tokyo Stock Exchange increased by 4.6%. <br><br>  In 2013, the 2007 Oklahoma court filed a lawsuit about the accident, in which two girls were hit on a 2005 Toyota Camry.  One of them died, the other spent five months in hospital with back and head injuries.  Toyota did not admit its guilt.  They said that the cause of the accident was that the driver mixed up the gas and brake pedals, and when she realized her mistake and started to slow down, it was too late. <br><br><img src="https://habrastorage.org/files/243/34f/4a9/24334f4a9c604603944c6efef229fa48.jpg" align="left"><br>  Two engineers are connected to the case: <a href="https://en.wikipedia.org/wiki/Michael_Barr_(software_engineer)">Michael Barr</a> and <a href="https://users.ece.cmu.edu/~koopman/">Philip Coopman</a> .  For 20 months, parse 280,000 lines of code, write a report of 800 pages.  Each. <br><br>  The address was classified.  The hotel room, in which the engineers worked, was guarded round the clock - the security guard ensured that no one contributed or endured any papers.  All phones and internet have been disconnected. <br><br>  Toyota has <a href="https://en.wikipedia.org/wiki/Sudden_unintended_acceleration">withdrawn more than 10 million cars worldwide</a> .  Guilt is not recognized. <br><br><br clear="left">  According to Michael Barr, their report is classified.  Also, the terms of the contract, on the terms of which they were provided with the source code of Toyota, were coded.  But Barr recommends google a transcript of the hearing materials. <br><br><ul><li>  <a href="http://www.safetyresearch.net/Library/Bookout_v_Toyota_Barr_REDACTED.pdf">TRANSCRIPT OF MORNING TRIAL PROCEEDINGS HAD ON THE 14TH DAY OF OCTOBER, 2013</a> </li><li>  <a href="http://www.safetyresearch.net/Library/BarrSlides_FINAL_SCRUBBED.pdf">BOOKOUT V. TOYOTA 2005 Camry L4 Software Analysis</a> </li><li>  <a href="http://www.barrgroup.com/files/killer_apps_barr_keynote_eelive_2014.pdf">KILLER APPS Embedded Software's Greatest Hit Jobs</a> </li></ul><br>  It was in such conditions that analysts worked: <br><br><img src="https://habrastorage.org/files/984/3c1/514/9843c15144b0475fb1949b3687920fa8.jpg"><br><br>  And such a report was written: <br><br><img src="https://habrastorage.org/files/f69/73a/9f7/f6973a9f79e8433891d241a7b7144cb8.jpg"><br><br><h2>  How you searched and found </h2><br>  The main test subject is the Electronic Throttle Control System (ETCS). <br><br><img src="https://habrastorage.org/files/c37/2e3/5dd/c372e35ddeac4fd8b2fdc3be6e58ad74.jpg"><br><br><img src="https://habrastorage.org/files/e32/188/1c8/e321881c85bf4a8bbe262deb7610ee0b.jpg"><br>  <em>NASA specialists scanned the chip with an x-ray.</em> <br><br><img src="https://habrastorage.org/files/714/7e2/056/7147e20567f04625888097eb0a0076fc.jpg"><br>  <em>Even cosmic rays are considered causes of errors.</em> <br><br>  And the code on the C check: <br><br><img src="https://habrastorage.org/files/4b6/464/5b0/4b64645b0e204bf7bf0c3095c5176e24.jpg"><br><br>  And then the turn came to the code. <br><br><h2>  Violations of MISRA (and NASA) standards </h2><br>  By estimation, for every 30 violations of MISRA standards they lead to one ‚Äúserious bug‚Äù. <br><ul><li>  In MISRA-C: 1998, 127 rules are listed (93 mandatory and 34 recommendatory). </li><li>  In MISRA-C: 2004 141 rules (121 mandatory and 20 recommendatory).  The rules are divided into 21 categories. </li><li>  In MISRA-C: 2012, there are 143 rules (each of which can be verified by a static code analyzer) and 16 directives (rules whose compliance is open to interpretation or related to processes and procedures).  Rules are divided into mandatory, required and recommendatory;  can be distributed to individual broadcast units or to the whole system.  Also, the rules are divided into Decidable and Undecidable. </li></ul><br><br>  Toyota has borrowed only 11 MISRA rules into its standards. <br><br><img src="https://habrastorage.org/files/8a9/290/0b5/8a92900b52ec4c52a79068f79f9f445c.jpg"><br><br><img src="https://habrastorage.org/files/cfa/a15/bef/cfaa15bef7204f6b8c53ab7ce99d4491.jpg"><br><br>  NASA's analysis tools could check 35 MISRA rules and 14 of them were violated. <br><br><img src="https://habrastorage.org/files/0a5/b8e/edb/0a5b8eedb5c0413abff5310afbfe9e84.jpg"><br>  [Source - <a href="http://www.nhtsa.gov/staticfiles/nvs/pdf/NASA_FR_Appendix_A_Software.pdf">NASA Report, Appendix A: Software</a> , page 28] <br><br>  <u>Total:</u> 7134 violations (as calculated by NASA) or 81,514 (as calculated by Michael Barr). <br><br>  <strong>10 rules of NASA</strong> <br>  Article on Habr√© - <a href="https://habrahabr.ru/company/hexlet/blog/303160/">"10 rules that allow NASA to write millions of lines of code with minimal errors"</a> <br><div class="spoiler">  <b class="spoiler_title">The Power of Ten - 10 Rules for Writing Safety Critical Code</b> <div class="spoiler_text"><ol><li>  Restrict to simple control flow constructs. </li><li>  Give all loops a fixed upper-bound. </li><li>  Do not use dynamic memory allocation after initialization. </li><li>  Limit functions to no more than 60 lines of text. </li><li>  Use minimally two assertions per function. </li><li>  Declare data objects at the smallest possible level of scope. </li><li>  Check the return value of the function parameters. </li><li>  Limit the use of the preprocessor to file inclusion and simple macros. </li><li>  Limit the use of pointers.  Use of dereferencing per expression. </li><li>  Code analyzers. </li></ol><br>  [Source - <a href="http://spinroot.com/p10/">spinroot.com/p10</a> ] <br></div></div><br><img src="https://habrastorage.org/files/3a8/5ac/547/3a85ac547bf040c68d11cd7aaaa65703.jpg"><br><br>  The length of the function is limited to 60-75 lines of code, after deleting empty lines and comments.  More than 200 functions in the Camry05 code exceeded the specified length.  One of the functions was 740 lines. <br><br><h2>  Variables </h2><br>  31 names have been announced several times in different areas (in different scopes).  The most common name is sts_flags1, which appeared in 57 different areas <br><img src="https://habrastorage.org/files/052/cfc/55b/052cfc55b00e4d1e9b04385ab08e967a.jpg"><br><br><img src="https://habrastorage.org/files/bdf/6fa/b03/bdf6fab03be24632b24fcb1bffcc6790.jpg"><br><br>  But it is worth to show larger. <br><br><img src="https://habrastorage.org/files/410/650/439/410650439d38465482ededf143f6a35d.jpg"><br><br><img src="https://habrastorage.org/files/580/912/490/58091249076542438319bb347cfb8cb0.jpg"><br><br><h2>  Code confusion </h2><br><img src="https://habrastorage.org/files/455/221/542/4552215421fc4d9bb5fb04b4b0245820.jpg"><br>  Flow control graph simple program. <br><br>  <a href="https://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B8%25D0%25BA%25D0%25BB%25D0%25BE%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D1%2581%25D0%25BB%25D0%25BE%25D0%25B6%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C">The cyclomatic complexity of a program</a> above 50 is an indicator that the program is not amenable to testing. <br><br><img src="https://habrastorage.org/files/e74/68b/80e/e7468b80e0c749638bbca6fb8c4b7284.jpg"><br><br>  In Toyota in ETCS-code: <br><ul><li>  67 functions with over 50 complexity </li><li>  Difficulty Throttle angle function = 146;  1300 lines of code, no plan for unit test </li></ul><br><br><h2>  Recursion </h2><br><img src="https://habrastorage.org/files/900/3d1/1f7/9003d11f78664958af1f31def99d5f32.jpg"><br>  A recursion was used in the Toyota code, and every problem with it led to a CPU reset. <br><br><h2>  So what? </h2><br>  The amount of <s>shit</s> code on which people's lives depend, is growing.  The example with Toyota shows that system developers can mess up at an elementary level, not to mention at the level of ethical decision-making of AI.  But the main problem is not that there are mistakes, but that the parties concerned hinder their search and correction.  And these parties are powerful enough to put pressure on NASA. <br><br><img src="https://habrastorage.org/files/c6e/8d5/2e1/c6e8d52e13474bc3bca28b8aa991e78a.jpg"><br><br>  <i>‚ÄúProgramming today is a race in which developers compete to build large and foolproof programs, and the universe spawns more and more high-quality fools.</i>  <i>At the moment, the universe is winning. ‚Äù</i> <br>  - Rich Cook, science fiction writer <br><hr><br><br>
<h2>  mass media </h2><br><ul><li>  <a href="http://kommersant.ru/Doc/1582030">US authorities acquitted Toyota</a> ("Kommersant" from 02/09/2011) </li><li>  <a href="http://www.nhtsa.gov/PR/DOT-16-11">Releases Results from the NHTSA-NASA Study of Unintended Acceleration in Toyota Vehicles</a> (February 8, 2011) </li><li>  <a href="http://www.latimes.com/business/la-fi-toyota-recall18-2009oct18-story.html">Toyota's runaway car worries</a> </li><li>  <a href="http://www.nhtsa.gov/UA">NHTSA-NASA Study of Unintended Acceleration in Toyota Vehicles</a> </li><li>  <a href="http://pressroom.toyota.com/article_download.cfm%3Farticle_id%3D3597">Analysis of Toyota ETCS-1 System Hardware and Software</a> </li><li>  <a href="http://www.toyota-lawsuit.com/toyota-recall-timeline/">Toyota Recall Timeline</a> </li></ul><br><br><h2>  Investigation Reports </h2><br>  Philip Coopman's colorful presentation: <br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  <strong>NASA Report on Toyota Unintended Acceleration Investigation</strong> <br>  <a href="http://www.nhtsa.gov/staticfiles/nvs/pdf/NASA_report_execsum.pdf">NASA Executive Summary</a> <br>  <a href="http://www.nhtsa.gov/staticfiles/nvs/pdf/NASA-UA_report.pdf">NASA Full Report</a> <br><ul><li>  <a href="http://www.nhtsa.gov/staticfiles/nvs/pdf/NASA_FR_Appendix_A_Software.pdf">Appendix A: Software</a> </li><li>  <a href="http://www.nhtsa.gov/staticfiles/nvs/pdf/NASA_FR_Appendix_B_Fishbone_Diagrams.pdf">Appendix_B_Fishbone_Diagrams</a> </li><li>  <a href="http://www.nhtsa.gov/staticfiles/nvs/pdf/NASA_FR_Appendix_C_Hardware.pdf">Appendix C: Hardware</a> </li><li>  <a href="http://www.nhtsa.gov/staticfiles/nvs/pdf/NASA_FR_Appendix_D_Test_Scenarios.pdf">Appendix D: Test Scenarios</a> </li></ul><br><br>  <strong>NHTSA Report on Toyota Unintended Acceleration Investigation</strong> <br><ul><li>  <a href="http://www.nhtsa.gov/staticfiles/nvs/pdf/NHTSA_report_execsum.pdf">NHTSA Executive Summary</a> </li><li>  <a href="http://www.nhtsa.gov/staticfiles/nvs/pdf/NHTSA-UA_report.pdf">NHTSA Full Report</a> </li></ul><br><br><img src="https://habrastorage.org/files/ffb/9d0/261/ffb9d0261cd14c0f9e11e589b25743b1.jpg"><br><br><h2>  PS </h2><br><div class="spoiler">  <b class="spoiler_title">4 years before</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/e78/b9e/f88/e78b9ef888543516d5697eec2f3ce01d.jpg"><br><br><blockquote>  <em>Wherever I come, my job is to apply one simple formula.</em>  <em>I keep secrets.</em> <em><br><br></em>  <em>This is elementary arithmetic.</em> <em><br><br></em>  <em>The task of the textbook.</em> <em><br><br></em>  <em>If the car of my company, made by my company, drove from Chicago to the west at a speed of 60 miles per hour, and the rear axle is wedged, the car crashes and burns with everyone who fell into the trap of its cabin, is it worth it for my company to return the model for revision ?</em> <em><br><br></em>  <em>We take the total number of produced cars of this model (A), multiply by the probable number of machines with a malfunction (B), then multiply the result by the average cost of solving the issue without a court (C).</em>  <em>A multiplied by B multiplied by C. Equals X. So much is not to return the model for revision.</em> <em><br><br></em>  <em>If X is more than the cost of the return, we return the cars, and no one will suffer anymore.</em> <em><br><br></em>  <em>If X is less than the cost of return, there will be no return.</em> <br></blockquote>  - Chuck Palahniuk "Fight Club", 1996. <br><br><blockquote>  <em>- And often there are such accidents?</em> <em><br></em>  <em>- You can not even imagine.</em> <em><br></em>  <em>- What company do you work for?</em> <em><br></em>  <em>- In a very large one.</em> </blockquote>  - To \ f "Fight Club", 1999. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/310862/">https://habr.com/ru/post/310862/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310850/index.html">In the tunnel under my house, I meet with elves. They give me advice on how to make supercomputers better.</a></li>
<li><a href="../310852/index.html">GitHub will open the GLB own load balancer code</a></li>
<li><a href="../310854/index.html">Redux Action Creators. No constant and headache</a></li>
<li><a href="../310856/index.html">Our first million rubles on upwork - personal experience</a></li>
<li><a href="../310860/index.html">MMO in the real world, or instructions for creating live games, or How to make children in the camp interesting</a></li>
<li><a href="../310864/index.html">We return to AMD drivers support for DirectX12 old processors</a></li>
<li><a href="../310866/index.html">Y Combinator: What to do before the explosive growth</a></li>
<li><a href="../310868/index.html">Fast rendering with DOM template engines</a></li>
<li><a href="../310870/index.html">The dark side of TypeScript - @ decorators on examples</a></li>
<li><a href="../310872/index.html">ROAD audio codec analysis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>