<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Marathon puzzles in C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings to all! 

 In this post we will discuss the solution of several puzzles that I spied from the ‚ÄúMarathon of C ++ tasks‚Äù (I think the links ca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Marathon puzzles in C ++</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/9e2/ad6/602/9e2ad660282a1cdda310cacf3948ccdb.jpg" align="left">  Greetings to all! <br><br>  In this post we will discuss the solution of several puzzles that I spied from the ‚ÄúMarathon of C ++ tasks‚Äù (I think the links can easily be found by a search engine).  No, I have absolutely no relation to the site, but I learned about it from Habr: either I had someone in my profile, or there was a link in the comments, though I doubt that this would prevent the followers of the local conspiracy theory from easily minus the topic.  He exhaled ... So, we will define the tasks, the solutions of which will be considered (only 9 problems, but these seemed interesting to me): <br><br><ul><li>  Forgot how to multiply.  Help! <br>  <i>Multiply the number by 7 without using the multiplication operation.</i> <br></li><li>  Two in one. <br>  <i>Some clever swap buttons in the elevator.</i>  <i>I put the second floor instead of the first floor, and the first one instead of the second floor.</i>  <i>Honestly, I'm too lazy to pick buttons.</i>  <i>I'd rather reprogram the elevator.</i>  <i>But I'm too lazy to program.</i>  <i>You have all the hope.</i>  <i>Write, please, a switch function that returns 1 if input 2 and 2, if input 1.</i> <br></li></ul><br><a name="habracut"></a><h4>  Training </h4><br>  Usually, I am not at all pulling (not pulling) to solve problems of such an ‚Äúentertaining‚Äù (and, possibly, informative) kind, but this time, then the beautiful weather outside the window, or the working-smoothly flowing-in-non-working day did their job and I decided.  As I have already described, I came across an article (it would be better to write a cycle of 3 articles) about a certain marathon of tasks in C ++.  Curiosity took over and decided to sketch solutions: but not in the head, as usual, but on paper.  And, as you might guess, after the first line crossed out, I finished this crazy work (writing on paper) and decided this: I use only a simple text editor (gedit) and, in extreme cases, google. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Go </h4><br><h5>  Task number one: </h5><blockquote>  Forgot how to multiply.  Help!  Multiply the number by 7 without using the multiplication operation. </blockquote>  The solution for a single-flow execution model suggests itself: <br><ul><li>  the function, which takes as an argument a number to multiply by 7, performs 7 consecutive additions, and then returns the result <i>(runtime)</i> : <br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      typedef unsigned long long TCurrentCalculateType; inline TCurrentCalculateType mulby7(TCurrentCalculateType value) { return value + value + value + value + value + value + value; } //  ,  assert()   // #include &lt;assert.h&gt; #ifdef DEGUB assert(mulby7(1) == 7); assert(mulby7(7) == 49); #endif //DEBUG</span></span></code> </pre> <br></li></ul>  An article on this can not be pulled out.  Let's take a broader look: in general, what a limitation is this - to multiply an arbitrary number by exactly 7?  Disorder: give the multiplication of an arbitrary number by an arbitrary number without using multiplication: <br><ul><li>  An iteration function that takes as an argument a number to multiply by N, performs N consecutive additions in a loop, and then returns the result (runtime): <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    // typedef unsigned long long TCurrentCalculateType; inline TCurrentCalculateType mulbyN(unsigned long long times, TCurrentCalculateType value) { TCurrentCalculateType result = 0; for(unsigned long long i = 0; i &lt; times; ++i) result += value; return result; } //  ,  assert()   // #include &lt;assert.h&gt; #ifdef DEGUB assert(mulbyN(7, 1) == mulbyN(1, 7)); assert(mulbyN(7, 7) == 49); #endif //DEBUG</span></span></code> </pre><br></li><li>  the parameterized class, which receives as an argument a number to multiply by N, performs N consecutive additions, recursively instantiating templates, and then the result is available in the <i>static const</i> class member (compiletime): <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    // typedef unsigned long long TCurrentCalculateType; // : , , : , ... //  N + 1   ( ) template &lt;typename T, T value, int step&gt; struct mulStep { static const T partSumm = value + mulStep&lt;T, value, step - 1&gt;::partSumm; }; //  ,   template &lt;typename T, T value&gt; struct mulStep&lt;T, value, 0&gt; { static const T partSumm = 0; }; template &lt;unsigned long long times, TCurrentCalculateType value&gt; struct mulbyNct { static const TCurrentCalculateType result = mulStep&lt;TCurrentCalculateType, value, times&gt;::partSumm; }; static_assert(mulbyNct&lt;7, 7&gt;::result == 49, "Imposible!"); static_assert(mulbyNct&lt;10, 10&gt;::result == 100, "Imposible!");</span></span></code> </pre></li></ul><br>  Yes, the third option was not written ‚Äúfrom the fly‚Äù: we had to refresh in memory a very similar to our problem example of <a href="http://en.wikipedia.org/wiki/Template_metaprogramming">calculating factorial</a> .  Sighted what to do.  But, in fact, I originally wrote the following code, which, although it looks more organic in use than the one proposed above, is not going to, due to some (logical) restrictions: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> times, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mulbyNct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mulStep&lt;T, value, times&gt;::partSumm; } <span class="hljs-comment"><span class="hljs-comment">//  ... // std::cout &lt;&lt; mulbyNct&lt;7&gt;(calcMeDigit) &lt;&lt; std::endl; //  .   :(</span></span></code> </pre><br>  ‚ÄúFreak, kid,‚Äù the attentive reader will notice.  I agree that you can optimize bread crumbs: if you initialize <code>result</code> initial value equal to <code>value</code> , you will be able to save at one step of the cycle.  We get: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    // typedef unsigned long long TCurrentCalculateType; inline TCurrentCalculateType mulbyNlittleFast(unsigned long long times, TCurrentCalculateType value) { TCurrentCalculateType result = value; //   for(unsigned long long i = 1; i &lt; times; ++i) //   result += value; return result; } //     //     ,   #undef mulbyN #define mulbyN mulbyNlittleFast //  ,  assert()   // #include &lt;assert.h&gt; #ifdef DEGUB assert(mulbyN(7, 1) == mulbyN(1, 7)); assert(mulbyN(7, 7) == 49); #endif //DEBUG</span></span></code> </pre><br>  ‚ÄúAll the same, there are few options,‚Äù I thought, and, opening <a href="http://www.cplusplus.com/reference/functional/">this saytik</a> , looking at the functors, I realized the fourth option: <br><ul><li>  Oh, this fourth option: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    // typedef unsigned long long TCurrentCalculateType; inline TCurrentCalculateType mulbyNSTL(unsigned long long times, TCurrentCalculateType value) { TCurrentCalculateType result = value; std::binder1st&lt;std::plus&lt;TCurrentCalculateType&gt; &gt; plus1st(std::plus&lt;TCurrentCalculateType&gt;(), value); for(unsigned long long i = 1; i &lt; times; ++i) result = plus1st(result); return result; } //  ,  assert()   // #include &lt;assert.h&gt; #ifdef DEGUB assert(mulbyNSTL(7, 1) == mulbyNSTL(1, 7)); assert(mulbyNSTL(7, 7) == 49); #endif //DEBUG</span></span></code> </pre></li></ul><br>  I know, I need to marry, and not to invent such monsters ... but not about that now.  In order to talk about which solution is ‚Äúbetter,‚Äù you first need to decide on the comparison metric.  On good - the metric of the minimum product of the used memory and runtime: <br> <code>algo_diff = used_mem * calc_time; <br> algo_winner = min(algo_diff(1, 2, 3, ..., N)) <br></code> <br>  And the weather is excellent, so I decided to stop only at minimizing the execution time: faster - better. <br><br><h4>  Prepare to fight </h4><br>  Let's start with the things that I didn't want to write myself - the ‚Äútimer‚Äù of the runtime.  For the measurement we will use the class found once on the Internet.  This class is small and simple, but even it uses the semblance of the RAII principle (yes, google help again).  Place it on the stack and voila: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;string&gt; #include &lt;sys/time.h&gt; #include &lt;sys/timeb.h&gt; class StackPrinter { public: explicit StackPrinter(const char* msg) : msMsg(msg) { fprintf(stdout, "%s: --begin\n", msMsg.c_str()); mfStartTime = getTime(); } ~StackPrinter() { double fEndTime = getTime(); fprintf(stdout, "%s: --end (duration: %.10f sec)\n", msMsg.c_str(), (fEndTime-mfStartTime)); } void printTime(int line) const { double fEndTime = getTime(); fprintf(stdout, "%s: --(%d) (duration: %.10f sec)\n", msMsg.c_str(), line, (fEndTime-mfStartTime)); } private: double getTime() const { timeval tv; gettimeofday(&amp;tv, NULL); return tv.tv_sec + tv.tv_usec / 1000000.0; } ::std::string msMsg; double mfStartTime; }; // Use case // //{ // StackPrinter("Time to sleep") sp; // sleep(5000); //}</span></span></span></span></code> </pre><br>  But, this "printer" is suitable for output to the console, but I want a more convenient output for later analysis using LabPlot ( <a href="http://labplot.sourceforge.net/">LabPlot sourceforge</a> ).  Here you can cry in bloody tears, for I maliciously violate DRY (let the bloody tears flow from the one who saw this. And in general, make allowances for warm weather and cold head): <br><div class="spoiler">  <b class="spoiler_title">StackPrinterTiny</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StackPrinterTiny</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">explicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StackPrinterTiny</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* msg)</span></span></span><span class="hljs-function"> </span></span>{ mfStartTime = getTime(); } ~StackPrinterTiny() { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> fEndTime = getTime(); <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span>, <span class="hljs-string"><span class="hljs-string">"%g\n"</span></span>, (fEndTime-mfStartTime)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printTime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> line)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> fEndTime = getTime(); <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stdout</span></span>, <span class="hljs-string"><span class="hljs-string">"(%d) %g\n"</span></span>, line, (fEndTime-mfStartTime)); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ timeval tv; gettimeofday(&amp;tv, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tv.tv_sec + tv.tv_usec / <span class="hljs-number"><span class="hljs-number">1000000.0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> mfStartTime; }; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> OutToAnalyze typedef StackPrinterTiny usedStackPrinter; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> typedef StackPrinter usedStackPrinter; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Use case // //{ // usedStackPrinter("Time to sleep") sp; // sleep(5000); //}</span></span></span></span></code> </pre></div></div><br><h4>  At the finish line </h4><br>  Now, to get the craft together, we need a little ‚Äúbinding‚Äù code - let's respect the compiler: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; #include &lt;functional&gt; #include &lt;stdio.h&gt; #include &lt;string&gt; #include &lt;sys/time.h&gt; #include &lt;sys/timeb.h&gt; #include &lt;climits&gt; typedef unsigned long long TCurrentCalculateType; // Closured: result, fiMax // loop, loooop, loooooooop #define LOOP_LOOP(what) \ for(unsigned long long fi = 0; fi &lt; fiMax; ++fi) \ for(unsigned long long fi2 = 0; fi2 &lt; fiMax; ++fi2) \ for(unsigned long long fi3 = 0; fi3 &lt; fiMax; ++fi3) \ result = what int main() { //     mulbyNct&lt;&gt; const TCurrentCalculateType calcMeDigit = 9000000; const unsigned long long fiMax = ULLONG_MAX; #ifndef OutToAnalyze std::cout &lt;&lt; "Calculate: " &lt;&lt; calcMeDigit &lt;&lt; " with fiMax = " &lt;&lt; fiMax &lt;&lt; std::endl; #endif currentCalculateType result = 0; #ifdef CALCULATE_IN_COMPILE_TIME std::cout &lt;&lt; "compile time " &lt;&lt; calcMeDigit &lt;&lt; " * " &lt;&lt; calcMeDigit &lt;&lt; " = " &lt;&lt; mulbyNct&lt;calcMeDigit, calcMeDigit&gt;::result &lt;&lt; std::endl; #endif { usedStackPrinter sp("1"); // on image - mulby7 LOOP_LOOP(mulby7(calcMeDigit)); #ifndef OutToAnalyze std::cout &lt;&lt; "by x7 = " &lt;&lt; result &lt;&lt; std::endl; #else std::cout &lt;&lt; "=" &lt;&lt; result &lt;&lt; std::endl; #endif } { usedStackPrinter sp("2"); // on image - mulbyN LOOP_LOOP(mulbyN(calcMeDigit, calcMeDigit)); #ifndef OutToAnalyze std::cout &lt;&lt; "x*x where x is " &lt;&lt; calcMeDigit &lt;&lt; " = " &lt;&lt; result &lt;&lt; std::endl; #else std::cout &lt;&lt; "=" &lt;&lt; result &lt;&lt; std::endl; #endif } { usedStackPrinter sp("3"); // on image - mulbyNSTL LOOP_LOOP(mulbyNSTL(calcMeDigit, calcMeDigit)); #ifndef OutToAnalyze std::cout &lt;&lt; "STL x*x where x is " &lt;&lt; calcMeDigit &lt;&lt; " = " &lt;&lt; result &lt;&lt; std::endl; #else std::cout &lt;&lt; "=" &lt;&lt; result &lt;&lt; std::endl; #endif } return 0; } // Compile with // // clear &amp;&amp; g++ main.1.cpp -O3 -std=c++0x -o main.1 // PS      -Ofast.    -  .</span></span></span></span></code> </pre><br>  We have everything you need to successfully build and get results.  If gathered (and it should) - we continue. <br><br><h4>  We thought, we thought - our nuclei are tired </h4><br>  By the way, I haven‚Äôt forgotten yet: I <b>couldn‚Äôt</b> calculate more than 498 * 498 in <i>compile time.</i> In other words, if I set calcMeDigit = 499 (and more) for ifif <code>#if defined(CALCULATE_IN_COMPILE_TIME)</code> , I received a compilation error: I‚Äôm not stack overflow when deploying templates?  I repent, did not understand.  So, we return to the tests at <i>run time</i> : the figures are, in my opinion, meaningless, because  on your machine, they will be different: but to visualize in a picture - it will go.  Hmm, I see you began to forget how to cry with bloody tears - I‚Äôm happy to remind you.  The following is a script that helped collect the numbers into a file for later analysis and building pictures in LabPlot (I warned you): <br><div class="spoiler">  <b class="spoiler_title">main.1.to.out.sh</b> <div class="spoiler_text">  # / bin / sh <br>  ./main.1&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  ./main.1 &gt;&gt; out.txt <br>  # And what did you expect?  }: -&gt; <br></div></div><br>  Results on my machine (Intel¬Æ Core (TM) i5 CPU @ 2.8 GHz CPU, 8 GiB Memory): <br><img src="http://habrastorage.org/storage2/057/8a2/8e6/0578a28e68792f02085b519ad9d2724c.png"><br><br>  Scott Meyers tip 43 says "Use algorithms instead of cycles."  In a broader sense, advice can be understood as using standard algorithms, collections, and objects to get more readable, supported and secure, and, sometimes, more efficient code.  What the fuck ... dozhnik, you ask (I have already stopped asking this question), the average time of the <code>mulbyNSTL</code> variant is less than that of its parent <code>mulbyN</code> .  I sin on my not completely straight arms ... but that is, that is. <br><br><h4>  The first one, I'm the second. </h4><br><h5>  Problem number two: </h5><blockquote>  Two in one.  Some clever swap buttons in the elevator.  I put the second floor instead of the first floor, and the first one instead of the second floor.  Honestly, I'm too lazy to pick buttons.  I'd rather reprogram the elevator.  But I'm too lazy to program.  You have all the hope.  Write, please, a switch function that returns 1 if input 2 and 2, if input 1. </blockquote>  Pokumekav, I came up with only 1 solution: <br><ul><li>  the function that takes the floor number as an argument produces a bitwise modulo-two addition and returns the result: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">worker1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (n xor <span class="hljs-number"><span class="hljs-number">3</span></span>); } <span class="hljs-comment"><span class="hljs-comment">//  ,  assert()   // #include &lt;assert.h&gt; #ifdef DEGUB assert(worker1(2) == 1); assert(worker1(1) == 2); #endif //DEBUG</span></span></code> </pre><br></li></ul>  One option is not enough.  One option is not to compare, so I decided to come up with a second idiotic option: it makes a bitwise ‚ÄúAND‚Äù, increments the result and returns the resulting value: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">worker2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (n &amp; <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//  ,  assert()   // #include &lt;assert.h&gt; #ifdef DEGUB assert(worker2(2) == 1); assert(worker2(1) == 2); #endif //DEBUG</span></span></code> </pre><br>  And, to my misfortune, I had a peek at the elegant answer of this problem (according to the version of the one who produced it): we return the result of subtracting the number of the floor from 3: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">worker3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> - n; } <span class="hljs-comment"><span class="hljs-comment">//  ,  assert()   // #include &lt;assert.h&gt; #ifdef DEGUB assert(worker3(2) == 1); assert(worker3(1) == 2); #endif //DEBUG</span></span></code> </pre><br>  Teperich, using the already known script for data collection (you could not forget the bloody tears), we will write a program to test the speed of execution of these tiny functions (worker1, worker2, worker3).  It seems that you have already suspected my unhealthy craving for patterns - I hurry to upset you, this is not true.  And what about us?  This is a helper class for using generators in the <code>std::generate</code> algorithm: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Like binder1st // require #include &lt;numeric&gt;, #include &lt;random&gt; template &lt;class Operation, class TRandomEngine&gt; class binderRandom: public std::unary_function &lt;void, typename Operation::result_type&gt; { protected: Operation op; TRandomEngine&amp; y; public: binderRandom ( const Operation&amp; x, TRandomEngine&amp; y) : op (x), y (y) {} typename Operation::result_type operator()() { return op(y); } };</span></span></code> </pre><br>  The idea is as old as C ++ world: we construct a vector of random numbers (floor numbers, i.e. [1, 2]) and perform the proposed functions for each element of the sequence ... Total: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; #include &lt;functional&gt; #include &lt;stdio.h&gt; #include &lt;string&gt; #include &lt;sys/time.h&gt; #include &lt;sys/timeb.h&gt; #include &lt;climits&gt; #include &lt;vector&gt; #include &lt;algorithm&gt; #include &lt;numeric&gt; #include &lt;random&gt; #include &lt;iterator&gt; int main() { static std::mt19937 _randomNumbersEngine; std::vector&lt;unsigned int&gt; _vectorNumbers(50000000); //    ? std::uniform_int&lt;unsigned int&gt; uiRandomNumber(1, 2); std::generate(_vectorNumbers.begin(), _vectorNumbers.end(), binderRandom&lt;std::uniform_int&lt;unsigned int&gt;, std::mt19937&gt;(uiRandomNumber, _randomNumbersEngine)); //    - //    // { usedStackPrinter sp("1"); std::transform(_vectorNumbers.begin(), _vectorNumbers.end(), _vectorNumbers.begin(), worker1); } { usedStackPrinter sp("2"); std::transform(_vectorNumbers.begin(), _vectorNumbers.end(), _vectorNumbers.begin(), worker2); } { usedStackPrinter sp("3"); std::transform(_vectorNumbers.begin(), _vectorNumbers.end(), _vectorNumbers.begin(), worker3); } return 0; }</span></span></span></span></code> </pre><br>  Results on my machine (Intel¬Æ Core (TM) i5 CPU @ 2.8 GHz CPU, 8 GiB Memory): <br><img src="http://habrastorage.org/storage2/56e/d2a/dad/56ed2adad96bc96b4a8f944d1ca7bbdf.png"><br><br>  Here the result is adequate: both (normal) variants are performed in the same time (we will throw off the difference as the measurement error).  Interestingly, and if you look at the generated code, it will be similar or even the same?  This is a topic for another conversation, so it remains for the reader to do the homework. <br>  In any case - I liked to do this garbage, which means that time was not wasted (personal value judgment). <br><br>  <b>Update:</b> <br>  Added by: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> TCurrentCalculateType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mulby7fast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TCurrentCalculateType value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (value &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) - value; }</code> </pre>  Updated results on my machine (Intel¬Æ Core (TM) i5 CPU @ 2.8 GHz CPU, 8 GiB Memory): <br><img src="http://habrastorage.org/storage2/0d8/679/fcf/0d8679fcfad26aefb2b6f172e23b1ddf.png"><br><br>  Updated results on my machine (Intel¬Æ Core (TM) i5 CPU @ 2.8 GHz CPU, 8 GiB Memory): <br><img src="http://habrastorage.org/storage2/a0b/004/7ea/a0b0047ea435d100400ecebdcaf53951.png"><br><br>  <b>Update # 2</b> <br>  Awesome distribution of cons and pros: <br><ul><li>  If someone knows in which compiler it will meet: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mulby7fast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (value &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) - value; }</code> </pre>  please do not hesitate to write. </li><li>  Yes, I did not know (and I can‚Äôt think of such a thing) that: <br><blockquote>  Multiplication by an arbitrary number is done as the sum of the shifts at the position where in the multiplier there is one </blockquote>  Learn with the help of Google - not to learn, but to spy. </li><li>  Quiet downsides - very inspiring </li></ul><br><br><h4>  Conclusion </h4><br><ul><li>  It turns out that writing without IDE with all kinds of auto complete (such as Visual Assist X from Whole Tomato) is not so deadly difficult (apparently no more than 200+ lines and simple logic).  Yes, there are a lot of things missing: clever alignment, paired brackets and quotation marks, but there is something in it ... something that tells me: correct and convenient IDE is cool! </li><li>  Version gcc 4.4.5 and therefore I did not use lambda - and in fact in cases with ‚ÄúworkerN‚Äù it would have looked great <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::transform(_vectorNumbers.begin(), _vectorNumbers.end(), _vectorNumbers.begin(), [](<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n xor <span class="hljs-number"><span class="hljs-number">3</span></span>; } );</code> </pre> </li></ul><br>  So it goes.  Thank you for your attention and good luck! <br><br>  <sup>PS Errors or typographical errors, please write to the PM.</sup> </div><p>Source: <a href="https://habr.com/ru/post/177111/">https://habr.com/ru/post/177111/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../177095/index.html">Impressions of the Hannover Messe</a></li>
<li><a href="../177097/index.html">How does LTE cope with inter-cell interference</a></li>
<li><a href="../177099/index.html">Methods for assessing the subjective quality of speech</a></li>
<li><a href="../177105/index.html">Pichmongi and maglutes</a></li>
<li><a href="../177109/index.html">Formal languages ‚Äã‚Äãand grammar</a></li>
<li><a href="../177113/index.html">Hormonal holywar Admin and Development PHP or REMOTE_ADDR vs HTTP_X_FORWARDED_FOR</a></li>
<li><a href="../177115/index.html">Comparing Angular, Backbone, CanJS and Ember</a></li>
<li><a href="../177117/index.html">Success in Indie: A Beginner's Guide</a></li>
<li><a href="../177121/index.html">Failsafe resource allocator over DHT</a></li>
<li><a href="../177125/index.html">"Beeline" is updated: first - a personal account. We invite you to beta tests</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>