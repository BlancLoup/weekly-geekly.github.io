<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenFOAM for dummies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I was looking for a description of operations, processes occurring in the library of numerical modeling OpenFOAM. I found many abstract ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenFOAM for dummies</h1><div class="post__text post__text-html js-mediator-article"> Some time ago I was looking for a description of operations, processes occurring in the library of numerical modeling OpenFOAM.  I found many abstract descriptions of the work of the finite volume method, classical difference schemes, and various physical equations.  I also wanted to know in more detail - where did such values ‚Äã‚Äãcome from in such an output file at such and such an iteration, what expressions are behind these or other parameters in the fvSchemes, fvSolution settings files? <br>  For those to whom it is also interesting - this article.  Those who are familiar with OpenFOAM or with the methods implemented in it - write about the errors and inaccuracies found in the PM. <br><br>  On Habr√© already had a couple of articles about OpenFOAM: <br>  <a href="http://habrahabr.ru/post/215391/">OpenFOAM in practice</a> <br>  <a href="http://habrahabr.ru/company/intel/blog/170675/">OpenFOAM in terms of programmer physics</a> <br><br>  Therefore, I will not dwell on the fact that it is ‚Äúan open (GPL) platform for numerical simulation, intended for simulation related to solving partial differential equations by the finite volume method, and widely used for solving problems of continuum mechanics.‚Äù 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Today I am using a simple example to describe the operations that occur during the calculation in OpenFOAM. <br><br>  So, given the geometry - a cube with a side of 1 meter: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ac7/482/bae/ac7482baee39980d792e66224de5f65d.png"><br><br><a name="habracut"></a><br><br>  We are faced with the task of simulating the flow-propagation of a certain scalar field (temperature, amount of matter), which is given by the following transport equation (1) within the volume of the body. <br><br>  (one) <br><img src="https://habrastorage.org/getpro/habr/post_images/acd/4f1/b6c/acd4f1b6c80559b854a557fc0a69406a.gif" alt="image">  , <br><br>  Where <img src="https://habrastorage.org/getpro/habr/post_images/11c/689/3e8/11c6893e80d2cdc7493b74e3c5c8cf79.gif" alt="image">  a scalar value, for example, expresses the temperature [K] or the concentration of a certain substance, and <img src="https://habrastorage.org/getpro/habr/post_images/5d3/6e3/d98/5d36e3d98a04dfe49d6f3c42e86957de.png" alt="image">  expresses substance transfer, mass flow [kg / s]. <br><br>  This equation, for example, is used to model the propagation of heat. <br><img src="https://habrastorage.org/web/255/b3f/4ba/255b3f4bacc1476ab81c0cabbf1e0341.gif">  , <br>  where k is thermal conductivity, and <img src="https://habrastorage.org/web/a1a/be1/1db/a1abe11db80f49bfb2caa744d6f9dd30.gif">  - temperature [K]. <br><br><div class="spoiler">  <b class="spoiler_title">Divergence operator is actually this</b> <div class="spoiler_text">  operator <img src="https://habrastorage.org/getpro/habr/post_images/679/551/f22/679551f229368b21318023ef55b26e76.gif" alt="image">  . <br>  Let me remind you that there is an operator nabla (Hamilton operator), which is written as follows: <br><img src="https://habrastorage.org/getpro/habr/post_images/4a1/780/06c/4a178006c32c145a7d81519eed63ada2.png" alt="image">  , <br><br>  where i, j, k are unit vectors. <br>  If we multiply the operator by a scalar by a vector value, we get the divergence of this vector: <br><img src="https://habrastorage.org/getpro/habr/post_images/6cd/3e3/6a7/6cd3e36a7a97d559b1c030c96c886a00.gif" alt="image"><br>  ‚ÄúFrom the point of view of physics, the divergence of a vector field is an indicator of the extent to which a given point of space is the source or sink of this field‚Äù <br><br>  If we multiply the operator nabla by a scalar, we get the gradient of this scalar: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/161/c88/9fd/161c889fdc766b74203b021bf4191723.gif" alt="image"><br>  The gradient shows the increase or decrease in any direction of the magnitude of the scalar <img src="https://habrastorage.org/getpro/habr/post_images/e29/d5e/d71/e29d5ed711f77486139d487f86678be5.png" alt="image">  . <br></div></div><br>  The boundary conditions of the problem are as follows: there is a face-entrance, a face-exit, the other faces are smooth walls. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/992/8de/00b/9928de00bdfbfea8d3f654da65b1ecf1.png"><br><br><h3>  Splitting cube volume into finite volumes </h3><br>  Our grid will be very simple - we divide the cube into 5 equal cells along the Z axis. <br><br><img src="https://habrastorage.org/files/e53/5f6/582/e535f658254b481485a3fdeb9db07dea.png" width="500"><br><br><h3>  Many formulas </h3><br>  The finite volume method provides that (1) in integral form (2) will be performed for each finite volume <img src="https://habrastorage.org/getpro/habr/post_images/455/535/0d6/4555350d665b9ed12237360b998d8346.png" alt="image">  . <br><br>  (2) <br><img src="https://habrastorage.org/getpro/habr/post_images/cd4/494/1d0/cd44941d0b54c0faa5333988cf8e1ac7.gif" alt="image">  , <br><br>  Where <img src="https://habrastorage.org/getpro/habr/post_images/ead/c09/114/eadc0911454d52971a73f975f8d2acce.png" alt="image">  - the geometric center of a finite volume. <br><br><div class="spoiler">  <b class="spoiler_title">Center of final volume</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/321/6ea/ad0/3216eaad0fa54bf4ee69afc538c64dc3.png"><br></div></div><br><br>  Simplify, transform the first term of expression (2) as follows: <br><br>  (2.1) (HJ-3.12) * <br><img src="https://habrastorage.org/getpro/habr/post_images/c9e/88e/7b6/c9e88e7b6e90c8abc0abd9f2cbe6c5cf.gif" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c3/4e6/518/8c34e6518a5929b7e30dd5b5fdb381cf.gif" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/870/24f/8f3/87024f8f3bc0155d134c199e0596282f.gif" alt="image"><br><br>  As you can see, we have assumed that the scalar quantity changes linearly within the final volume and the magnitude of <img src="https://habrastorage.org/getpro/habr/post_images/7e5/a3e/f9b/7e5a3ef9b1c3b1ee9bab0f964945e675.png" alt="image">  at some point <img src="https://habrastorage.org/getpro/habr/post_images/d24/0a0/c52/d240a0c525756f8e51e82256c0ae03bc.png" alt="image">  inside the final volume can be calculated as: <br><br>  (2.2) <br><img src="https://habrastorage.org/getpro/habr/post_images/da1/14d/2e1/da114d2e14f507d655775a4d1ba58dcc.png" alt="image">  , <br><br>  Where <img src="https://habrastorage.org/getpro/habr/post_images/af3/b78/6f7/af3b786f71452ce832396f24daf640f2.png" alt="image"><br><br>  To simplify the second term of expression (2), we use the generalized <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2580%25D0%25BC%25D1%2583%25D0%25BB%25D0%25B0_%25D0%2593%25D0%25B0%25D1%2583%25D1%2581%25D1%2581%25D0%25B0_%25E2%2580%2594_%25D0%259E%25D1%2581%25D1%2582%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25B4%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B3%25D0%25BE">Gauss-Ostrogradsky theorem</a> : the integral of the divergence of a vector field <img src="https://habrastorage.org/getpro/habr/post_images/e3b/8e9/d9e/e3b8e9d9ec326c4a0eec457f3d434bc1.png" alt="image">  by volume <img src="https://habrastorage.org/getpro/habr/post_images/05a/d9d/506/05ad9d5065fe0804149af83fa324ba32.gif" alt="image">  , is equal to the flow of the vector through the surface <img src="https://habrastorage.org/getpro/habr/post_images/960/581/d21/960581d2147fb9a77d5d6d9b9e69e816.gif" alt="image">  limiting this volume.  In human language, "the sum of all streams to / from a finite volume is equal to the sum of streams through the edges of this finite volume": <br><br>  (2.3) <br><img src="https://habrastorage.org/getpro/habr/post_images/fb0/93c/a10/fb093ca10212c9d40f1290efe26147bd.gif" alt="image">  , <br><br>  Where <img src="https://habrastorage.org/getpro/habr/post_images/801/700/c2a/801700c2a3560fc3b1bbea023b1fa70f.gif" alt="image">  closed surface limiting volume <img src="https://habrastorage.org/getpro/habr/post_images/05a/d9d/506/05ad9d5065fe0804149af83fa324ba32.gif" alt="image">  , <br><img src="https://habrastorage.org/getpro/habr/post_images/2a7/b1b/019/2a7b1b0191b7bbe17addd4a5cd87fa2a.png" alt="image">  - vector directed along the normal from the volume <img src="https://habrastorage.org/getpro/habr/post_images/b5d/bff/719/b5dbff71944551dfe9c4e775cb916817.png" alt="image">  . <br><div class="spoiler">  <b class="spoiler_title">S vector</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/c6d/96b/3bd/c6d96b3bd7200355d38022cc21ec82e1.png"><br></div></div><br>  Taking into account that the final volume is limited by a set of flat edges, it is possible to transform expression (2.3) to the sum of integrals over the surface: <br><br>  (2.4) (HJ-3.13) <br><img src="https://habrastorage.org/getpro/habr/post_images/d07/c05/0a3/d07c050a3235aee169d1c2919dc756b6.gif" alt="image">  , <br><br>  Where <img src="https://habrastorage.org/getpro/habr/post_images/6ec/e58/cfc/6ece58cfc91e68cdbf62726f6d1fa82d.png" alt="image">  expresses the value of the variable in the center of the face, <br><img src="https://habrastorage.org/getpro/habr/post_images/960/581/d21/960581d2147fb9a77d5d6d9b9e69e816.gif" alt="image">  - vector of area, going out from the center of the face, directed away from the cell (locally), away from the cell with a smaller index to the cell with a larger index (globally). <br><br><h3>  A little more about the vector S </h3><br>  Not to store the same vector parameters <img src="https://habrastorage.org/getpro/habr/post_images/960/581/d21/960581d2147fb9a77d5d6d9b9e69e816.gif" alt="image">  twice, because  Obviously, for two neighboring cells, the vector-normal to the edge between the cells, directed away from the center of the cell, will differ only in the direction-sign.  Therefore, the owner-neighbor relationship between the face and the cell was created.  If the area vector <img src="https://habrastorage.org/getpro/habr/post_images/960/581/d21/960581d2147fb9a77d5d6d9b9e69e816.gif" alt="image">  (global, positive direction from a cell with a smaller index to a cell with a large index) indicates FROM the center <img src="https://habrastorage.org/getpro/habr/post_images/e73/a08/7df/e73a087dfb2989a6f5c5417fc2a8ba90.gif" alt="image">  cells is the relationship between cell and vector <img src="https://habrastorage.org/getpro/habr/post_images/960/581/d21/960581d2147fb9a77d5d6d9b9e69e816.gif" alt="image">  or, more precisely, between the cell and the edge, denoted by the owner).  In case this vector <img src="https://habrastorage.org/getpro/habr/post_images/c81/4f1/0ad/c814f10ad0214e9b056ac854d9053c70.png" alt="image">  points inside the cell in question, then the neighbor relationship.  The direction affects the sign of the magnitude (+ for the owner and - for the neighbor) and this is important when summarizing, see below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf0/392/da1/cf0392da11904117474501a6821bec0e.png"><br><br>  (HJ-3.16) <br><img src="https://habrastorage.org/getpro/habr/post_images/225/9b6/310/2259b6310c08e387010314799f34a48b.gif" alt="image"><br><br><h3>  About difference schemes </h3><br>  Value <img src="https://habrastorage.org/getpro/habr/post_images/6ec/e58/cfc/6ece58cfc91e68cdbf62726f6d1fa82d.png" alt="image">  in the center of the face is calculated through the values <img src="https://habrastorage.org/getpro/habr/post_images/e3b/8e9/d9e/e3b8e9d9ec326c4a0eec457f3d434bc1.png" alt="image">  in the centers of adjacent cells - the method of such an expression is called the difference scheme.  In OpenFOAM, the type of difference scheme is specified in the <b>/ system / fvSchemes file</b> : <br><br><pre><code class="cpp hljs">divSchemes { <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> none; div(phi,psi) Gauss linear; }</code> </pre> <br><br>  <b>Gauss</b> - means that the central difference scheme is selected; <br>  <b>linear</b> - means that the interpolation from the centers of the cells to the centers of the faces will occur linearly. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3fc/2c3/55d/3fc2c355d1807256ec02ab1ce57eb147.png"><br><br>  Suppose that our scalar quantity varies linearly within the final volume from the center to the faces.  Then the value approximated in the center of the face will be calculated according to the formula: <br><br><img src="https://habrastorage.org/web/a85/65f/fb4/a8565ffb4d5d4517aad7186ac9d5de4a.gif"><br><br>  Where are the weights <img src="https://habrastorage.org/web/b94/84b/d64/b9484bd6402c448896224ea66f2e827a.gif">  and <img src="https://habrastorage.org/web/51c/8b4/2ea/51c8b42eab304cfcaf29c70e91b54da5.gif">  calculated as <br><br><img src="https://habrastorage.org/web/806/5ea/62d/8065ea62d9ae4afa9c977c8e60678d86.gif"><br><br>  Where <img src="https://habrastorage.org/web/ba6/47a/a17/ba647aa17fb042c591258784384df8a8.gif">  - the volume of cells. <br>  For cases of beveled cells, there are more complex formulas for calculating the weights of the approximation. <br><br>  Thus, the values ‚Äã‚Äãof phi_f at the centers of the faces of the cells are calculated based on the values ‚Äã‚Äãat the centers of the cells.  The grad (phi) gradient values ‚Äã‚Äãare calculated based on the phi_f values. <br>  And this whole algorithm can be represented as the following pseudocode. <br><pre> <code class="bash hljs">1.     ,    2.      (  ) &gt;  flux_f = phi_f*S_f.  phi_f     phi    &gt;  flux_f   -owner  -flux_f   -neighbour 3.      &gt;  flux_f = phi_f*S_f &gt;  flux_f   -owner (neighbour-    ) 4.     &gt;   -   </code> </pre><br><br><h3>  Time discretization </h3><br><br><img src="https://habrastorage.org/web/e79/9a0/80b/e799a080b0364796a135f24c29ccdf0f.gif"><br><br>  Considering (2.1) and (2.4), expression (2) takes the form: <br><br>  (3) <br><img src="https://habrastorage.org/getpro/habr/post_images/528/637/10c/52863710c92693299cd71d36ca886aff.gif" alt="image"><br><br>  According to the finite volume method, time discretization is performed and expression (3) is written as: <br><br>  (four) <br><img src="https://habrastorage.org/getpro/habr/post_images/e9b/66e/b14/e9b66eb14590ccbce034a3828e7695d6.gif" alt="image"><br><br>  Integrating (4): <br><br>  (4.1) <br><img src="https://habrastorage.org/getpro/habr/post_images/638/a6b/ef6/638a6bef63599ac8634d844359b86050.gif" alt="image"><br><br>  Divide the left and right side into <img src="https://habrastorage.org/getpro/habr/post_images/395/136/d1d/395136d1dac58e139d546342c1f25cb9.png" alt="image">  : <br><br>  (five) <br><img src="https://habrastorage.org/getpro/habr/post_images/eba/320/6f3/eba3206f33dcd2a01735fbac9c1fe1dc.gif" alt="image"><br><br><h3>  Data for the sampling matrix </h3><br>  Now we can get a system of linear equations for each finite volume <img src="https://habrastorage.org/getpro/habr/post_images/1a6/b85/d36/1a6b85d36cd12fff44911a7d3aeb6dc9.gif" alt="image">  . <br><br>  Below is the numbering of the grid nodes that we will use. <br><img src="https://habrastorage.org/files/5d6/5db/886/5d65db8863bf4dd5968d0732d4e48358.png" width="500"><br><br><div class="spoiler">  <b class="spoiler_title">The coordinates of the nodes are stored in / constant / polyMesh / points</b> <div class="spoiler_text"><pre> <code class="cpp hljs"> <span class="hljs-number"><span class="hljs-number">24</span></span> ( (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.2</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.2</span></span>) (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.2</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.2</span></span>) (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.4</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.4</span></span>) (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.4</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.4</span></span>) (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.6</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.6</span></span>) (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.6</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.6</span></span>) (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.8</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0.8</span></span>) (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.8</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.8</span></span>) (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) )</code> </pre><br></div></div><br><br>  The numbering of the node-centers of the cells (50, 51 - the centers of the boundary faces): <br><img src="https://habrastorage.org/files/7b3/aaf/e5f/7b3aafe5f29249b38160bc5b9fb52e95.png" width="500"><br><br>  Numbering of facet point centers: <br><img src="https://habrastorage.org/files/890/2b6/a6c/8902b6a6c61d4be6904b75c1f962ddd4.png" width="500"><br><br>  The volume of items: <br><br><img src="https://habrastorage.org/files/a85/5ca/2c4/a855ca2c4aa1489a9f839c1ba6b29a9c.gif"><br><br>  The interpolation coefficients required to calculate the values ‚Äã‚Äãon the faces of the cells.  The index "e" means "right edge of the cell."  Right relative to the view, as in the figure ‚ÄúNumbering of node centers of cells‚Äù: <br><br><img src="https://habrastorage.org/files/e3d/76f/065/e3d76f065ca74cceb43a2207469a588b.gif"><br><br><h3>  Forming a discretization matrix </h3><br><br>  <b>For P = 0.</b> <br>  Expression (5) describing the behavior of the quantity <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eba/320/6f3/eba3206f33dcd2a01735fbac9c1fe1dc.gif" alt="image"><br><br>  will be transformed into a system of linear algebraic equations, each of which of the form: <br><br><img src="https://habrastorage.org/web/243/afe/960/243afe960aa14f5ebbb04ee469173743.gif"><br><br>  or according to indices of points on the edges <br><br><img src="https://habrastorage.org/web/871/0b3/061/8710b30618b641dda84d3eede8dd4c2a.gif"><br><br>  And all the flows to / from the cell can be expressed as a sum <br><br><img src="https://habrastorage.org/web/98b/c0c/3d3/98bc0c3d36e24eb88f82c7021ee3b935.gif"><br><br>  where for example <img src="https://habrastorage.org/web/d73/8f6/b59/d738f6b59b41455b87e14594775af142.gif">  - the coefficient of linearization of the flow at the point-center of the cell E, <br><img src="https://habrastorage.org/web/bba/303/8d5/bba3038d528d482e8f9ea04dd14fea96.gif">  - the coefficient of linearization of the flow at the point-center of the face, <br><img src="https://habrastorage.org/web/b25/cfc/475/b25cfc475ded4973b2ce5a6318816cb5.gif">  - nonlinear part (for example, a constant). <br><br>  According to the numbering of faces, the expression will look like: <br><img src="https://habrastorage.org/web/b3e/718/0a3/b3e7180a35fe459789b769767d781abc.gif"><br><br>  Given the boundary conditions for the element P_0, a linear algebraic equation can be represented as <br><br><img src="https://habrastorage.org/web/8ef/fb1/db0/8effb1db08cf4d8bab5efa7fc10b5c5e.gif"><br><br>  ... we substitute the previously obtained coefficients ... <br><br><img src="https://habrastorage.org/web/f76/849/53e/f7684953e418410db45c25508bfb9135.gif"><br><br>  The flow from inlet'a is directed to the cell, therefore it has a negative sign. <br><br><img src="https://habrastorage.org/web/39d/b5c/1a4/39db5c1a461e476285273881a87487fd.gif"><br><br>  Since in our control expression there is, besides a diffusion term, a temporary term as well, but the final equation looks like <br><br><img src="https://habrastorage.org/web/2fa/75a/315/2fa75a315d3f49918711ee97c1001c60.gif"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/efc/00a/adf/efc00aadf262ee6b809cbfa2698a34cf.gif" alt="image"><br><br>  <b>For P = 1.</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fba/e5c/8f6/fbae5c8f69464997f30642880dcdd89b.gif" alt="image"><br><br>  <b>For P = 4.</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fbe/5c4/28c/fbe5c428c151dd91aed19f04f5affd8c.gif" alt="image"><br><br>  The system of linear algebraic equations (SLAE) can be represented in a matrix form as <br><br><img src="https://habrastorage.org/getpro/habr/post_images/90c/247/e4e/90c247e4e367a5b1e7cc5e5dc448c93d.gif" alt="image">  , <br><br>  Where <br><br><pre> <code class="cpp hljs">=== A(i,j) === <span class="hljs-number"><span class="hljs-number">40.5</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-0.5</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-0.5</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-0.5</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">0.5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-0.5</span></span> <span class="hljs-number"><span class="hljs-number">40.5</span></span></code> </pre><br><br><pre> <code class="cpp hljs">=== b(i,j) === <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br><br>  Further, the obtained SLAE is solved by the solver specified in <b>fvSchemes</b> . <br>  And the result is a vector of values. <img src="https://habrastorage.org/getpro/habr/post_images/c2d/e20/075/c2de2007553d90564a81d159b95b164f.gif" alt="image"><br><br><pre> <code class="cpp hljs">psi = dimensions [<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>]; internalField nonuniform List&lt;scalar&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>(<span class="hljs-number"><span class="hljs-number">0.0246875</span></span> <span class="hljs-number"><span class="hljs-number">0.000308546</span></span> <span class="hljs-number"><span class="hljs-number">3.85622e-06</span></span> <span class="hljs-number"><span class="hljs-number">4.81954e-08</span></span> <span class="hljs-number"><span class="hljs-number">5.95005e-10</span></span>);</code> </pre><br><br>  on the basis of which the values ‚Äã‚Äãfor the vector are obtained <img src="https://habrastorage.org/getpro/habr/post_images/797/e0a/c22/797e0ac22a1a1edfcbc7212b027b9cff.gif" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9c6/520/c1e/9c6520c1e77fe8443c902ccced610ef3.gif" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/74c/646/e8c/74c646e8c229b5a69736c57d06244305.gif" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/83e/ecf/18e/83eecf18e338b6480a8652d6576c05d5.gif" alt="image"><br><br>  Then vector <img src="https://habrastorage.org/getpro/habr/post_images/797/e0a/c22/797e0ac22a1a1edfcbc7212b027b9cff.gif" alt="image">  substituted in SLAU <img src="https://habrastorage.org/getpro/habr/post_images/90c/247/e4e/90c247e4e367a5b1e7cc5e5dc448c93d.gif" alt="image">  and there is a new iteration of the vector calculation <img src="https://habrastorage.org/getpro/habr/post_images/c2d/e20/075/c2de2007553d90564a81d159b95b164f.gif" alt="image">  . <br><br>  And so on until the residual reaches the required limits. <br><br><h3>  Links </h3><br>  * Some equations in this article are taken from Yasak Hrvoe's dissertation (HJ is the equation number) and if anyone wants to read more about them ( <a href="http://powerlab.fsb.hr/ped/kturbo/OpenFOAM/docs/HrvojeJasakPhD.pdf">http://powerlab.fsb.hr/ped/kturbo/OpenFOAM/docs/HrvojeJasakPhD.pdf</a> ) <br><br>  Download task files here: <br>  <a href="https://github.com/j-avdeev/case">github.com/j-avdeev/case</a> <br>  Solver files: <br>  <a href="https://github.com/j-avdeev/matrHyper1Foam">github.com/j-avdeev/matrHyper1Foam</a> <br><br>  As a bonus - video, how the concentration spreads. <img src="https://habrastorage.org/getpro/habr/post_images/c2d/e20/075/c2de2007553d90564a81d159b95b164f.gif" alt="image">  . <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/n5SRdJVVO-g" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/218483/">https://habr.com/ru/post/218483/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../218469/index.html">Diet for server processor</a></li>
<li><a href="../218471/index.html">Accelerate PHP development with overload</a></li>
<li><a href="../218473/index.html">Particles System in crowd modeling</a></li>
<li><a href="../218477/index.html">Watching IP-TV from Rostelecom on the computer</a></li>
<li><a href="../218481/index.html">Intl comes to us!</a></li>
<li><a href="../218485/index.html">Organization of js code for juniors</a></li>
<li><a href="../218489/index.html">About website blocking</a></li>
<li><a href="../218495/index.html">Smart watch do it yourself for 1500 rubles</a></li>
<li><a href="../218497/index.html">Conditional loading for responsive web design</a></li>
<li><a href="../218499/index.html">The Russian national payment system has all chances to be more successful than the existing ones.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>