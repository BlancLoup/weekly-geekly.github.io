<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to use frame-by-frame photography with a GoPro camera for the Mapillary service</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past six months, the popularity of the Mapillary web service has grown: over half a million photos have been uploaded, and more than 100 thou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to use frame-by-frame photography with a GoPro camera for the Mapillary service</h1><div class="post__text post__text-html js-mediator-article">  Over the past six months, the popularity of the Mapillary web service has grown: over half a million photos have been uploaded, and more than 100 thousand pieces - in the last 10 days only! <br><br>  At first glance it seems that only an ordinary smartphone is suitable for this business.  But what if you could use an action camera, such as a GoPro, to collect photos for Mapillary?  Mounted on a bike, helmet or even a car?  As it turned out, this is possible. <br><a name="habracut"></a><br>  And last week I took a small trip and collected about 1,700 photos in half an hour, using the TimeLapse function.  On my 32GB SD card, it ate just 3.4 gigabytes.  I could still ride for more than 4 hours and take about 150 thousand photos before my memory card is full! <br><br>  However, this is not a trivial matter, so I think you need to explain in more detail how all this is done.  The main problem is that GoPro does not contain a GPS receiver.  How does the map service know where to display photos on the map?  We ourselves must give him this information, so we will have to use a separate GPS receiver.  Personally, I used my HTC One smartphone - the same one I used before to take regular photos for Mapillary. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In short, the procedure is as follows: <br><ul><li>  Mount the camera in a bicycle or car with a variety of fasteners. </li><li>  Run a program to record a GPS track.  I used the program geopaparazzi, but there are many others that work just as well. </li><li>  Set up GoPro for single-frame shooting.  I chose the settings: 5MP, medium, narrow, 1s. </li><li>  Launch GoPro and ride. </li><li>  Upload photos and GPX track to computer. </li><li>  Using the gpx2exif program, link photos to geographic coordinates by synchronizing the shooting time with the GPX track. </li><li>  Upload photos to Mapillary. </li></ul><br>  It seems to be not too difficult.  Let us write out these actions in more detail on the example of my trip last week. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc9/e9c/87f/cc9e9c87f3371aab2b7b13de3944e981.jpg" alt="image"><br><br>  I secured the GoPro to the front left wing of my Mazda RX8 to get a good view of the middle of the road. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/395/13d/b88/39513db88fb14afe2c1bd030fe94dae6.jpg" alt="image"><br><br>  Then I fixed my HTC One smartphone in the car for a special fastener.  Using the program " <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.gopro.smarty">GoPro App</a> ", I joined the camera and previewed a picture of the terrain, as GoPro sees it.  This is convenient, but, in fact, not very necessary, because  when the recording starts, the preview disappears.  It is only necessary that the smartphone was in the car in the place where the signal of GPS-satellites is well caught.  If you use the GoPro App, take a little time to adjust the time on the camera: the difference between the current time on devices should be as little as possible.  As you will see later, you will have to take into account the time difference in order to synchronize the track and the photo.  And the less correction you have to make, the easier it will be to do the work. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4f/082/cc6/e4f082cc6b9f7f97376e95bb7db02d94.jpg" alt="image"><br><br>  Let's check the camera settings again: the time-lapse shooting mode should be enabled.  This is easily done using the GoPro App, but you can do it on GoPro itself.  I chose 5MB, Medium, Narrow Field of View (Narrow) to get a look similar to the one I shoot using the phone.  Equivalent focal length (in terms of 35-mm camera) will be approximately 20 mm.  GoPro settings by default provide a wide field of view, with large optical distortions, so on this trip I gave up this mode.  I plan to describe another scenario in another article when I took photos for Mapillary from a wide-angle 4K video stream.  It was harder, so for now let's skip the story. <br><br>  With the selected setting of 1 frame per second, the distance between photos will be 10‚Äì20 meters at a speed of 40‚Äì80 km / h.  A Mapillary recommendation about one frame every two seconds is more suitable for a bike, and I plan, of course, to move faster than by bike! <br><br>  Launch the GPS tracker application.  In this case, I used the program <a href="http://geopaparazzi.github.io/geopaparazzi/">geopaparazzi</a> .  In this application there is a button to start recording.  I pressed this button and confirmed the suggested file name for saving the track.  OK.  Now everything is ready.  It remains only to start shooting, and forward! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/355/534/bf2/355534bf29eb4e2fe8ff9cc4777c2994.png" alt="image"><br><br>  Rolling over, stop recording on the camera and on the GPS receiver.  Now the real work begins!  We need to geo-reference before we can load our material into Mapillary.  In Geopaparazzi, I exported the track to a GPX file and sent it to myself by mail.  From GoPro, I just pulled out a card and copied photos from it onto a laptop. <br><br>  The first thing I wanted to do was to see what my trip looked like.  I executed the command: <br><br><pre><code class="bash hljs">geotag -g v√§la_to_billesholm.gpx \ -o v√§la_to_billesholm.png \ -D 1 -s 2048x2048</code> </pre> <br><br>  The result was a good high resolution image of the entire map.  Note the use of the -D option to specify a larger gap between the markers on the map.  This is necessary because geotag is configured by default for short tracks, like, for example, a fast bike ride.  On the resulting image you can see the time and position of the key points of the trip.  We need to enlarge the scale in several characteristic places, where we can manually check the time match on the camera and the GPS receiver and more precisely determine the accuracy of the clock between them.  At the synchronization stage we will be able to correct this difference, and it is important to determine it correctly. <br><br>  I executed the command: <br><br><pre> <code class="bash hljs">geotag -R 20140505T12:39:00+02-20140505T12:41:00+02 \ -g v√§la_to_billesholm.gpx \ -o krop.png -D 0.1</code> </pre>  which generated this image: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/537/1ad/b32/5371adb32787a0ada9b40b55107815c4.png" alt="image"><br><br>  I can find a photo where I drive under the bridge, and check the clocks. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/46e/9cd/d43/46e9cdd4360782423fef225c7fd11ed7.jpg" alt="image"><br><br>  The EXIF ‚Äã‚Äãdata of this photo shows that it was taken at 12:39:11.  Looking at the map, we see that we passed under the tunnel at 12:39:14.  Thus, the error is 3 seconds.  You can use this value in the process of geo-referencing, but it is better to first check with another photo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba9/5f9/c7e/ba95f9c7e8590243c122c86975b50d0f.png" alt="image"><br><br>  I generated a map of the path through Morarp, because I can identify objects such as buildings and intersections.  Do not use the crossroads where you stopped (like, for example, my turn to the right).  Look for such landmarks, near which you were in motion.  I searched for the first passage on the right, at the top of the map, and found a photo taken at 12:46:10. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/850/4d2/4a2/8504d24a25728d61737a20cf5fb1faa9.jpg" alt="image"><br><br>  I took note of several landmarks, about which I know exactly where they are: a warning sign in the middle, white marking at the intersection, a pillar of street lighting. <br><br>  Another interesting way to check, which you can also use - if you were in a place where there are pictures of Google street view, you can compare two images. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e77/b87/692/e77b87692e02f3833e9766a2aa273819.png" alt="image"><br><br>  Google‚Äôs street view pictures show a road sign, a markup at a crossroads, a tree and a lighting pole.  But note that there is no fence, trees are growing instead.  It is clear that the construction began after Google drove through this place.  Google says the picture was taken in September 2011 - about 2.5 years ago - of course, something has changed. <br><br>  From the data of the GPX track through Merarp one can see that the intersection passed at 12:46:13, which is 3 seconds later than it was recorded by the camera in the photo.  And again we have an error of 3 seconds.  This is good: it turns out that the error is the same throughout the entire track.  You can continue and sync all 1500 photos using the command: <br><br><pre> <code class="bash hljs">geotag -g v√§la_to_billesholm.gpx \ 20140505_TimeLapse/*JPG -t 3 -v</code> </pre><br><br>  I set the time shift using the "-t -3" option and used the "-v" option to monitor the process.  Since the script is a wrapper for the command line program ‚Äúexif_file‚Äù, several processes start processing each file;  this takes some time, but at the end all your photos will contain georeference information taken from GPX. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f2a/10c/893/f2a10c893d620f4de187e847d4330491.png" alt="image"><br><br>  When the binding of geo-information to photos is completed, you can upload photos to mapillary.com.  Enter the site, click on your name, select ‚ÄúUpload images‚Äù, click on the ‚ÄúChoose files‚Äù button.  After selecting all the files, scroll down the page and click the ‚ÄúStart Uploading‚Äù button.  The color scheme on the site is such that it is not always clear whether the download has started.  Just scroll up the page and you will see red loading indicators under each image. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14b/12b/f55/14b12bf553a7c16b8b7df4038552cabb.png" alt="image"><br><br>  Finally, when the download is complete, click on your name, select ‚Äúmy uploads‚Äù ', and you will see new images for your track. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eba/90d/656/eba90d656c16647a2322c0843339817a.png" alt="image"><br><br>  Click on your latest download to view photos in Mapillary! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d6/5ba/054/1d65ba054ce7756241c417df5e402c9f.png" alt="image"><br><br>  Full processing of photos may take some time, so do not worry if they are not immediately available.  Get back to them later. <br><br><h5>  And now - slow motion video </h5><br>  The settings in GoPro for the described method of photographing are not for nothing called ‚ÄúTime Lapse‚Äù - ‚ÄúSlow Motion‚Äù.  From the photos you can make a video.  Because we shot one frame per second - if we make a video at 25 frames per second, we will get 25-fold acceleration.  This is great!  See what I did: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/CGn7KmUiozk%3Ffeature%3Doembed&amp;xid=25657,15700022,15700043,15700186,15700191,15700253&amp;usg=ALkJrhgic06Jk9rgTMxzJoD4MqUraS95UA" frameborder="0" allowfullscreen=""></iframe><br><br>  This video was made like this: <br><ul><li>  Rename all the photos so that the file names have numbers starting with 0000. I asked names like foo-0000.jpeg.  To make my life easier, I wrote a ruby ‚Äã‚Äãscript that creates hard links with the necessary names.  You can then use the ffmpeg command to compile the video: <br><br><pre> <code class="bash hljs">ffmpeg -f image2 -i foo-%04d.jpeg \ -r 25 -s 1280x960 ../myvid.mp4</code> </pre><br></li><li>  This command compresses 4-megapixel 4: 3 photos into a 960p HD movie. </li><li>  Then, using OpenShot video editor, I trimmed to 16: 9, added sound, added a map, and pinned to 720p resolution with medium quality for faster uploading to the web. </li></ul><br><br><h5>  Install gpx2exif </h5><br>  The geotag command was widely used in this article.  This command is included in the ruby ‚Äã‚Äãgem "gpx2exif".  The article used the features available in version 0.3.6.  However, at the time of publication of the article version 0.3.1 was available.  Therefore, I will explain how to install the latest version. <br><br><h5>  Installing Ruby on Ubuntu </h5><br>  The first thing you need is Ruby.  Installation depends on the operating system.  I use Ubuntu 14.04 and RVM, here I will give instructions appropriate for my OS.  And I recommend that you go to the sites ruby-lang.org and rvm.io for advice that is appropriate for your platform. <br><br><pre> <code class="bash hljs">sudo apt-get install curl curl -sSL https://get.rvm.io | sudo bash -s stable --ruby sudo usermod -g rvm craig <span class="hljs-comment"><span class="hljs-comment"># logout and login to get RVM group source /etc/profile.d/rvm.sh</span></span></code> </pre><br>  The part of the program that creates images in PNG format uses ImageMagick for its work.  For Ubuntu, this means that you first need to install several dependencies: <br><br><pre> <code class="bash hljs">sudo apt-get install imagemagick imagemagick-doc libmagickwand-dev gem install rmagick <span class="hljs-comment"><span class="hljs-comment"># Requires libmagickwand-dev to compile</span></span></code> </pre><br><br><h5>  Installing from rubygems.org </h5><br>  When ruby ‚Äã‚Äãis installed, simply install the gem: <br><pre> <code class="bash hljs">gem install gpx2exif</code> </pre> <br>  Then output the list with the command ‚Äúgem list‚Äù to find out which version was installed as a result.  If it is older than 0.3.5, then follow the instructions below. <br><br><h5>  Installing from github </h5><br>  Install git and then execute the commands: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/craigtaverner/gpx2exif <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> gpx2exif bundle install rake build gem install pkg/gpx2exif-0.3.6.gem</code> </pre><br>  If everything went well, then you have compiled and installed the latest version of Ruby Gem. <br><br><blockquote>  <b>Notes from the translator</b> : <br>  1) What is ‚ÄúMapillary‚Äù?  As <a href="http://habrahabr.ru/users/zverik/" class="user_link">Zverik</a> put it: ‚ÄúMapillary for images is like OpenStreetMap for maps.‚Äù  In short, this is an analogue of Google street view and Yandex-panorama, which works on the principle of crowdsourcing.  Users upload their geolocated photos, which are then displayed on the map along with a line of distance traveled.  A content license permits the use of information obtained from photographs in OpenStreetMap. <br>  2) For geo-referencing of photos there is also such a script on Python: <a href="https://github.com/mapillary/mapillary_tools/blob/master/python/geotag_from_gpx.py">https://github.com/mapillary/mapillary_tools/blob/master/python/geotag_from_gpx.py</a> <br>  3) About everything, mentioned in paragraphs 1 and 2, I learned from the article " <a href="http://shtosm.ru/all/mapillary/">Folk panoramas</a> " in the blog of the user <a href="http://habrahabr.ru/users/zverik/" class="user_link">Zverik</a> . <br>  4) The most convenient way to fix the discrepancy in the clock is to take a picture of the clock on the GPS device with the camera. <br></blockquote></div><p>Source: <a href="https://habr.com/ru/post/242463/">https://habr.com/ru/post/242463/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242449/index.html">Samsung Gear App Challenge Finalists</a></li>
<li><a href="../242455/index.html">Using angular-translate to localize AngularJS applications</a></li>
<li><a href="../242457/index.html">Initially defective system of preparation for negotiations</a></li>
<li><a href="../242459/index.html">Date and Time Issues in JS</a></li>
<li><a href="../242461/index.html">IOS8 update rates, Unity web player lock on Chrome and new Puzzle & Dragons records - and other news of the week for a mobile developer</a></li>
<li><a href="../242465/index.html">Payment POS-terminal Poynt Smart Terminal with a dual screen on Android</a></li>
<li><a href="../242467/index.html">Infographics. Visual presentation of data</a></li>
<li><a href="../242469/index.html">How to use psychological principles to increase conversion</a></li>
<li><a href="../242471/index.html">LEGO and online courses: training as a constructor</a></li>
<li><a href="../242475/index.html">Ubiquitous Supercomputing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>