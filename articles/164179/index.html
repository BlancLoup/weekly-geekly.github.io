<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Marmalade Framework (pause mode)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Earlier, I already talked about developing a small gaming framework using the Marmalade tool platform. Of course, in the form in which it is posted on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Marmalade Framework (pause mode)</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/post/161681/">Earlier,</a> I already talked about developing a small gaming framework using the <a href="http://www.madewithmarmalade.com/">Marmalade</a> tool platform.  Of course, in the form in which it is posted on <a href="http://github.com/GlukKazan/mf">GitHub,</a> it is hardly suitable for developing something more complex than the demo application.  It lacks many of the features needed to develop a more or less serious application.  Fortunately, the Framework is designed flexibly enough so that the missing features can be easily added. <br><a name="habracut"></a><br>  It will be about the implementation of the pause mode.  I think this feature will be useful in almost any game.  When activating the pause, the whole game process should freeze indefinitely, and when it is removed, continue from the same place where it stopped. <br><br>  The main thing that needs to be done is to stop processing all events (the update method) for sprites, the animation of which should be suspended for the duration of the pause.  Also, some mechanism is needed that determines whether the object will pause its animation for the duration of the pause.  It is clear that if we suspend event handling for a button that disables pause mode, we will never be able to get out of the pause. <br><br>  Less obvious is that we have to correct the state of all objects that participated in the animation at the time the pause began, when it was removed.  The fact is that the Framework is designed in such a way that all the timestamps that control the animation of the sprites are calculated in advance, even before the animation begins.  If we spend a sufficiently long time in a state of pause, then all these timestamps will become obsolete and the animation will end sooner than we can see some continuation of it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's start with the interfaces.  In the IObject.update method, add the isPaused flag, which will be set to true if pause mode is activated: <br><br><div class="spoiler">  <b class="spoiler_title">IObject.h</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IObject</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint64 timestamp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isPaused)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; };</code> </pre> <br></div></div><br>  In AbstractSpriteOwner, we will add a similar flag and method that we will call to adjust the timestamps of animated objects when the pause is completed: <br><br><div class="spoiler">  <b class="spoiler_title">AbstractSpriteOwner.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractSpriteOwner</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ISpriteOwner { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint64 timestamp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isPaused)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">correctPauseDelta</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint64 pauseDelta)</span></span></span></span>; };</code> </pre><br></div></div><br>  Implementing the correctPauseDelta method is trivial.  We simply pass the duration of the pause in milliseconds to all nested sprites: <br><br><div class="spoiler">  <b class="spoiler_title">AbstractSpriteOwner.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs">... <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AbstractSpriteOwner::correctPauseDelta(uint64 pauseDelta) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (ZIter p = zOrder.begin(); p != zOrder.end(); ++p) { p-&gt;second-&gt;addPauseDelta(pauseDelta); } }</code> </pre><br></div></div><br>  In the AnimatedSprite implementation, we add the resulting pause length to all timestamps of current animations.  We also add an early exit from the update method if pause mode is in effect: <br><br><div class="spoiler">  <b class="spoiler_title">AnimatedSprite.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs">... <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AnimatedSprite::addPauseDelta(uint64 pauseDelta) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (CIter p = currentMessages.begin(); p != currentMessages.end(); ++p) { p-&gt;timestamp += pauseDelta; } } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AnimatedSprite::update(uint64 timestamp, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isPaused) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isPaused &amp;&amp; isPausable()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; ... }</code> </pre><br></div></div><br>  The default isPausable method is defined in AbstractScreenObject and, if necessary, will be redefined in those of its heirs, which should not be turned off: <br><br><div class="spoiler">  <b class="spoiler_title">AbstractScreenObject.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractScreenObject</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IScreenObject { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPauseDelta</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint64 pauseDelta)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPausable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>;} };</code> </pre><br></div></div><br>  To make changes to the CompositeSprite, you need to remember that, on the one hand, it is a container of sprites, while on the other hand, it is the successor of AnimatedSprite and can handle animation rules: <br><br><div class="spoiler">  <b class="spoiler_title">CompositeSprite.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs">... <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CompositeSprite::addPauseDelta(uint64 pauseDelta) { AbstractSpriteOwner::correctPauseDelta(pauseDelta); AnimatedSprite::addPauseDelta(pauseDelta); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CompositeSprite::update(uint64 timestamp, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isPaused) { AnimatedSprite::update(timestamp, isPaused); AbstractSpriteOwner::update(timestamp, isPaused); }</code> </pre><br></div></div><br>  The main work on the suspension and resumption of animation will take the class Scene. <br><br><div class="spoiler">  <b class="spoiler_title">Scene.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Scene</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AbstractSpriteOwner { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: ... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsPaused; uint64 pauseTimestamp; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uint64 timestamp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isPaused)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isPaused</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsPaused;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">suspend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; };</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Scene.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs">... <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Scene::update(uint64 timestamp, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsPaused &amp;&amp; (pauseTimestamp == <span class="hljs-number"><span class="hljs-number">0</span></span>)) { pauseTimestamp = pauseTimestamp; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsPaused &amp;&amp; (pauseTimestamp != <span class="hljs-number"><span class="hljs-number">0</span></span>)) { uint64 pauseDelta = timestamp - pauseTimestamp; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pauseDelta &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { correctPauseDelta(pauseDelta); } pauseTimestamp = <span class="hljs-number"><span class="hljs-number">0</span></span>; } ... AbstractSpriteOwner::update(timestamp, IsPaused); } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Scene::sendMessage(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> id, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (AbstractSpriteOwner::sendMessage(id, x, y)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsPaused) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (background != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> background-&gt;sendMessage(id, x, y); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Scene::suspend() { desktop.suspend(); IsPaused = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Scene::resume() { desktop.resume(); IsPaused = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br></div></div><br>  It remains to add the background music pause code to the Desktop class: <br><br><div class="spoiler">  <b class="spoiler_title">Desktop.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Desktop</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: ... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isMusicStarted; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Desktop(): touches(), names(), currentScene(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>), isMusicStarted(<span class="hljs-literal"><span class="hljs-literal">false</span></span>) {} ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startMusic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* res)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopMusic</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">suspend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; };</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Desktop.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs">... <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Desktop::startMusic(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* res) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s3eAudioIsCodecSupported(S3E_AUDIO_CODEC_MP3) &amp;&amp; s3eAudioIsCodecSupported(S3E_AUDIO_CODEC_PCM)) s3eAudioPlay(res, <span class="hljs-number"><span class="hljs-number">0</span></span>); isMusicStarted = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Desktop::stopMusic() { isMusicStarted = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; s3eAudioStop(); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Desktop::suspend() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isMusicStarted) { s3eAudioPause(); } } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Desktop::resume() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isMusicStarted) { s3eAudioResume(); } }</code> </pre><br></div></div><br>  Now, the Scene.suspend method can pause the animation of all game sprites and background music, and the Scene.resume method can resume them from the same place. <br></div><p>Source: <a href="https://habr.com/ru/post/164179/">https://habr.com/ru/post/164179/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../16417/index.html">LinuXPC: another Linux based desktop</a></li>
<li><a href="../164171/index.html">One way to backup the TrueCrypt container</a></li>
<li><a href="../164173/index.html">Coroutines in PHP and working with non-blocking functions</a></li>
<li><a href="../164175/index.html">Technology to quickly create backgrounds for 2D games based on 3D blanks (48 hours of development)</a></li>
<li><a href="../164177/index.html">One small optimization</a></li>
<li><a href="../16418/index.html">Iphone or 400 tanks?</a></li>
<li><a href="../164181/index.html">JOBS Act promises explosive growth for IT companies in the US</a></li>
<li><a href="../164183/index.html">Happy New Year</a></li>
<li><a href="../164185/index.html">What is not written in Wikipedia on global navigation satellite systems</a></li>
<li><a href="../16419/index.html">Cybersquatting: Vital</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>