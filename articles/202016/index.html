<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Java web start issues when upgrading to j7u45</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As you can guess from the title, the post will be devoted to the security update of Java, which will most likely break / launch the web start applicat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Java web start issues when upgrading to j7u45</h1><div class="post__text post__text-html js-mediator-article">  As you can guess from the title, the post will be devoted to the security update of Java, which will most likely break / launch the web start application.  All not indifferent - I ask under cat. <br><br>  Our company has adopted the practice of updating Java on all servers as soon as new versions are released.  Actually, this is what we did this time.  But something went wrong, the client‚Äôs web start client stopped running and the application, without a declaration of war, was simply shutting down. <br>  Rolling up their sleeves, it was necessary to figure out what caused this behavior. <br><a name="habracut"></a><br>  Having started the client locally, previously unknown warnings appeared that there are no properties in the manifest files: Permissions, Application-Name, Codebase.  After reading a little about them, as a test, it was decided to add them to the fool in all manifestos, approximately in the following form: <br><br><pre><code class="java hljs">Permissions: all-permissions Application-Name: AppName Codebase: *</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Not too beautiful, got rid of warnings, but did not solve the problem. <br>  Further, during the long debugs (thank you Eclipse RCP for a happy childhood), it was noticed that the system parameters are transferred somehow wrong, which led to the next post on stackoverflow: <a href="http://stackoverflow.com/questions/19400725/with-java-update-7-45-the-system-properties-no-more-set-from-jnlp-tag-property">stackoverflow.com/questions/19400725/with-java-update- 7-45-the-system-properties-no-more-set-from-jnlp-tag-property</a> . <br>  Summarizing it, we can say that now you can‚Äôt just take it and transfer it to the JNLP file. <br><br>  3 solutions were found: <br>  1) Sign the JNLP file - <a href="http://docs.oracle.com/javase/7/docs/technotes/guides/jweb/signedJNLP.html">docs.oracle.com/javase/7/docs/technotes/guides/jweb/signedJNLP.html#signedJnlp</a> - in short - just put jnlp in a signed jarik in the JNLP-INF folder with the name APPLICATION.JNLP and will be happiness. <br>  The main problem with this method was that we have a different JNLP for each client and, generally speaking, it is generated on the fly. <br><br>  2) Create a signed JNLP file template - <a href="https://blogs.oracle.com/thejavatutorials/entry/signing_jar_files_with_a">blogs.oracle.com/thejavatutorials/entry/signing_jar_files_with_a</a> <br>  Initially, I settled on this method, nothing complicated: the same as in the previous paragraph, only the file name APPLICATION_TEMPLATE.JNLP and the places that can be changed are replaced by '*'. <br>  But everything turned out to be not so rosy, nothing worked.  I had a little bit to shaman and get into the inside of the web start, to see how the template and the jnlp file itself are compared.  As a result, the following code was found in com.sun.javaws.jnl.XMLFormat: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isBlacklisted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XMLNode paramXMLNode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (paramXMLNode == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (paramXMLNode.getName() != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { XMLAttribute localXMLAttribute; String str; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((paramXMLNode.getName().equals(<span class="hljs-string"><span class="hljs-string">"java"</span></span>)) || (paramXMLNode.getName().equals(<span class="hljs-string"><span class="hljs-string">"j2se"</span></span>))) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (localXMLAttribute = paramXMLNode.getAttributes(); localXMLAttribute != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; localXMLAttribute = localXMLAttribute.getNext()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (localXMLAttribute.getName().equals(<span class="hljs-string"><span class="hljs-string">"java-vm-args"</span></span>)) { str = localXMLAttribute.getValue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((str != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) &amp;&amp; (str.indexOf(<span class="hljs-string"><span class="hljs-string">"*"</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>)) { Trace.println(<span class="hljs-string"><span class="hljs-string">"Blacklisted - a = "</span></span> + localXMLAttribute, TraceLevel.SECURITY); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (paramXMLNode.getName().equals(<span class="hljs-string"><span class="hljs-string">"property"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (localXMLAttribute = paramXMLNode.getAttributes(); localXMLAttribute != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; localXMLAttribute = localXMLAttribute.getNext()) { str = localXMLAttribute.getValue(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((str != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) &amp;&amp; (str.indexOf(<span class="hljs-string"><span class="hljs-string">"*"</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>)) { Trace.println(<span class="hljs-string"><span class="hljs-string">"Blacklisted - a = "</span></span> + localXMLAttribute, TraceLevel.SECURITY); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isBlacklisted(paramXMLNode.getNested())) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isBlacklisted(paramXMLNode.getNext()); }</code> </pre><br><br>  It checks something like this: when comparing a template with a file, whether the current tag is in the black list, if not, it does not miss such a jnlp file.  In the current implementation, you cannot add templates to the java-vm-args property of java or j2se tags, nor can you pass parameters that contain a pattern to the value. <br><br>  And again, the failure, many properties for each client are unique and are passed just through the parameters in the form: <br><pre> <code class="java hljs">&lt;property name=<span class="hljs-string"><span class="hljs-string">"client.specific.property"</span></span> value=<span class="hljs-string"><span class="hljs-string">"client.specific.value"</span></span>/&gt;</code> </pre><br><br>  And we can not just write in the template: <br><pre> <code class="java hljs">&lt;property name=<span class="hljs-string"><span class="hljs-string">"client.specific.property"</span></span> value=<span class="hljs-string"><span class="hljs-string">"*"</span></span>/&gt;</code> </pre><br><br>  Only the last (at that time) option remains: <br><br>  3) In accordance with <a href="https://bugs.openjdk.java.net/browse/JDK-8023821">bugs.openjdk.java.net/browse/JDK-8023821</a> , properties can be transferred by adding the prefix 'jnlp' to them, they will be successfully transferred to the system properties and then in our code it will be possible to shift them to their place .  Since no other alternative was found, the code found <a href="http://stackoverflow.com/questions/19407102/java-7-update-45-broke-my-web-start-swt-application">here</a> was added to the very beginning of the application launch: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initializeSystemProperiesFromJnlp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//Hack for not signing JNLP file Properties properties = System.getProperties(); // copy properties to avoid ConcurrentModificationException Properties copiedProperties = new Properties(); copiedProperties.putAll(properties); Set&lt;Object&gt; keys = copiedProperties.keySet(); for (Object key : keys) { if (key instanceof String) { String keyString = (String) key; if (keyString.startsWith("jnlp.")) { //$NON-NLS-1$ // re set all properties starting with the jnlp-prefix // and set them without the prefix String property = System.getProperty(keyString); String replacedKeyString = keyString.replaceFirst("jnlp.", ""); //$NON-NLS-1$ //$NON-NLS-2$ System.setProperty(replacedKeyString, property); } } } }</span></span></code> </pre><br><br>  After this manipulation, everything worked. <br>  Please note that the code given above is not a good tone rule, and at a minimum, it is worth checking the values ‚Äã‚Äãthat are in the properties, suddenly they poked and replaced them. <br><br>  In addition, there is another, more thorny, but the right way, which I learned about later.  He is described <a href="https://forums.oracle.com/message/11253994">here</a> . <br><br>  I hope this post will be useful to someone. </div><p>Source: <a href="https://habr.com/ru/post/202016/">https://habr.com/ru/post/202016/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202002/index.html">Sort Android application icons installed on a smartphone (tablet) by color (idea)</a></li>
<li><a href="../202004/index.html">A brief and instructive history of video games</a></li>
<li><a href="../202010/index.html">Realization of a dream, or Radio 86RK - 25 years later</a></li>
<li><a href="../202012/index.html">The monitoring system in the car for him on the Raspberry Pi. Part 1</a></li>
<li><a href="../202014/index.html">Snake on Canvas</a></li>
<li><a href="../202018/index.html">OWIN and Katana: First Look</a></li>
<li><a href="../202020/index.html">Our tanks. The history of load testing in Yandex</a></li>
<li><a href="../202022/index.html">Building your own JS SDK - why and how?</a></li>
<li><a href="../202024/index.html">ScienceHub # 05: Biophysics of excitable systems</a></li>
<li><a href="../202026/index.html">What is a lawn mower? We disassemble Robomow RS 630</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>