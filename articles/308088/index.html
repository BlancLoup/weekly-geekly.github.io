<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Safely use Go language in web programming</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article was written for developers who are beginning to master the Go programming language in order to meet their safe code requirements for writi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Safely use Go language in web programming</h1><div class="post__text post__text-html js-mediator-article">  The article was written for developers who are beginning to master the Go programming language in order to meet their safe code requirements for writing web applications.  The article describes possible vulnerabilities that can be left by web programmers, as well as ways to fix it either using standard libraries or using third-party solutions that have already shown themselves. <br><br><img src="https://habrastorage.org/files/4ca/a52/54d/4caa5254dac144f0b5ae650a666e28ed.png"><br><a name="habracut"></a><br>  The Go programming language is a fairly young programming language ‚Äî developed by Google in 2007 and officially introduced in 2009.  Programmers really liked this language: compiled, multi-threaded, structured and imperative.  It is used by companies such as Microsoft, GitHub, Cloudflare, Heroku, Vkontakte, Mail.Ru.  Immediately after the release of the language, libraries and tools that help in developing on Go appeared and continue to be created.  Libraries for protecting web applications also appeared among these tools.  Many libraries, written by individual developers, are also built into the standard set of libraries. <br><br>  We give the most typical methods of attacks on sites and the main ways to avoid them or at least minimize these threats: <br><ol><li>  Predictable session identifier value (Credential / Session Prediction). </li><li>  Cross-site request forgery (CSRF). </li><li>  Cross-site Scripting (XSS). </li><li>  Clickjacking </li><li>  Implementation of SQL statements (SQL Injection). </li></ol><br>  I would like to make an overview of the tools to protect against these types of attacks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  <b>Protect session and cookie correctly</b> </h5><br>  Sessions are a clear target for a hacker, since they can be used to access a web server without the need for authentication.  And it turns out that not competent implementation of the sessions may expose your entire service.  If you decide to use sessions on your web service, then the <a href="http://www.gorillatoolkit.org/pkg/sessions">gorilla</a> library is useful to you.  Session Gorilla's helps to cope with the storage of your cookies on the server, as well as simply transfer unique tokens.  In addition, the <a href="http://www.gorillatoolkit.org/pkg/securecookie">SecureCookie</a> library may be useful.  Such secure cookies cannot be tampered with, because their values ‚Äã‚Äãare checked using the HMAC. <br>  Recently, <a href="https://jwt.io/introduction/">JSON WebTokens</a> technology is also very often used.  This will help you library <a href="https://github.com/dgrijalva/jwt-go">jwt-go</a> .  Read more about JWT in Go <a href="http://dghubble.com/blog/posts/json-web-tokens-and-go/">here</a> . <br><br><h5>  <b>CSRF</b> </h5><br>  Now consider the fight against intersite request forgery or CSRF attacks on the site.  A CSRF attack is performed on an authorized user of a web application using a vulnerability in this application.  For example, an attacker could force (with the help of a letter a link) to transfer a user to a specially prepared site that performs some kind of malicious operation (for example, transferring money to an attacker‚Äôs account or changing a password).  To carry out this attack, the victim must be authenticated on the server where the request is sent.  To prevent a CSRF attack, generate a special secret key and save it to the user session and, based on this secret key, create a token according to a specific rule.  The token is made so that, on the one hand, it is different from the key (in particular, there can be many tokens for one key), on the other, to make it easy to check by token whether it is generated based on this key or not.  In 2015, researcher Mikhail Firstov stumbled upon a <a href="http://2015.zeronights.org/assets/files/32-Firstov.pdf">similar vulnerability</a> on the Yota website.  Recently, finding csrf vulnerabilities on many Microsoft services brought in $ 13,000 to a British <a href="https://xakep.ru/2016/04/06/microsoft-auth-csrf/">researcher</a> .  This suggests that developers are still poorly solve this problem and not always competently. <br>  This task in Go does the <a href="https://github.com/justinas/nosurf">NoSurf</a> library very well.  For an example of the library, we give the program code. <br><br><img src="https://habrastorage.org/files/edf/f9a/90f/edff9a90f65c4dbea5081d9e22a43352.png"><br><br>  As you can see, based on the request context, a token is formed, which is subsequently inserted into the required fields and headers. <br><br><img src="https://habrastorage.org/files/807/16b/260/80716b2609994be881aaf2e54917132d.png"><br><br>  Source code html document: <br><br><img src="https://habrastorage.org/files/3c5/2d1/74e/3c52d174ee9a41ebba365158022f73f9.png"><br><br>  When you try to change the token in the request form, the server returns the error number 400 BadRequest. <br><br>  I also found a similar <a href="https://github.com/goji/csrf">GojiCSRF</a> library.  It works out of the box immediately with SecureCookie and generates tokens 32 bytes long.  It works only with requests that can modify data and does not work with secure http methods (GET, HEAD, OPTIONS, TRACE). <br>  Almost the same, but only in the simplified mode, allows the standard Go <a href="https://godoc.org/golang.org/x/net/xsrftoken">XSRFtoken</a> library to be generated.  It has only two functions - funcGenerate and funcValid, as well as the ability to set the token lifetime. <br><br><h5>  <b>Xss</b> </h5><br>  An XSS attack or cross-site scripting is a type of attack on a web system, consisting of embedding a malicious code page into a web-page.  The most famous example is the hijacking of user cookies by an attacker. <br>  In this case, quite good, in my opinion, libraries with consonant titles have been written.  This is <a href="https://github.com/russross/blackfriday">blackfriday</a> and <a href="https://github.com/microcosm-cc/bluemonday">bluemonday</a> .  Libraries are quickly configured and conveniently run.  They can work both together and separately.  He gave a sample code of a simple program that receives a string from the console, escapes certain characters, and some simply overwrites.  I took a few <a href="https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet">examples of JS scripts</a> that can be used to implement an attack.  An example of the program is shown in the screenshot below, the filtered sequence is displayed between the tags <pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Program Code: <br><br><img src="https://habrastorage.org/files/fcf/e01/b0e/fcfe01b0ea0c4837bac67893d1b19a34.png"><br><br>  The output of the work of the two libraries together: <br><br><img src="https://habrastorage.org/files/bfc/19e/4ed/bfc19e4edecd4f659328dd00d3b07800.png"><br><br>  And if you don‚Äôt want to use third-party libraries, then Go out of the box contains a couple of useful functions contained in the html / template package: <br><br>  ‚Ä¢ funcHTMLEscape (w io.Writer, b [] byte) sends to w version b replacing potentially dangerous characters with their escape sequences. <br>  ‚Ä¢ funcHTMLEscapeString (s string) string returns version s, replacing potentially dangerous characters with their escape sequences. <br>  ‚Ä¢ funcHTMLEscaper (args ... interface {}) string forms a string from a set of arguments, replacing potentially dangerous characters with escape sequences. <br><br>  Also, your input parameters can easily ‚Äúclean‚Äù <a href="https://github.com/kennygrant/sanitize">Sanitizing</a> .  On the githaba of this library there is a fairly complete test with input from the same <abbr title="Open Web Application Security Project is an open source web application security project.">OWASP</abbr> . <br><br><h5>  <b>Clickjacking</b> </h5><br>  There is also an attack known as <a href="https://www.owasp.org/index.php/Clickjacking">Clickjacking</a> .  The clickjacking attack (Clickjacking) allows a hacker to click on the victim site ‚Äúon behalf of the visitor‚Äù, also known as a substitution of the user interface.  Thus, a hacker can come up with various scenarios and, for example, transfer money from your mobile bank to his account in just a couple of clicks.  Strangely enough, such vulnerabilities are still found even in <a href="http://www.ptsecurity.ru/download/Analitika_DBO.pdf">DBO</a> remote banking <a href="http://www.ptsecurity.ru/download/Analitika_DBO.pdf">systems</a> , although it would seem that banking systems should be protected much better than regular web applications. <br><br>  Also for protection, it is recommended to attach the X-Frame-Options header to each response of your server.  Now all modern browsers support the X-Frame-Options header.  It allows or denies displaying the page if it is open in a frame.  The header can have three values: <br>  ‚Ä¢ SAMEORIGIN - Rendering a document, when opened in a frame, is performed only if the top (top) document is from the same domain. <br>  ‚Ä¢ DENY - Rendering a document within a frame is prohibited. <br>  ‚Ä¢ ALLOW-FROM domain - Allows rendering if an external document from this domain (not supported in Safari, Firefox). <br><br>  An example of the implementation of adding the response header in Go. <br><br><img src="https://habrastorage.org/files/95c/a92/40c/95ca9240c4e248c7a5dd101c9fef373b.png"><br><br>  <a href="https://github.com/unrolled/secure">Secure</a> - a small layer for easy configuration of the secure parameters of your service.  Secure can work with a large number of frameworks, as well as with the standard net / http package. <br><br><h5>  <b>SQL injection</b> </h5><br>  SQl-injection is one of the most common ways to hack websites and programs that work with databases, based on the introduction of arbitrary <abbr title="formal non-procedural programming language used to create, modify and manage data in an arbitrary relational database managed by an appropriate database management system (DBMS)">SQL-</abbr> code into a query. <br>  In Go, you can use parameterized queries or as they also call prepared expressions.  which help to avoid some problems with SQL-injection. <br><br><img src="https://habrastorage.org/files/68f/c9a/dcb/68fc9adcb09943d59058f017eb9bc7c8.png"><br><br>  You can also use regular expression filtering.  In this case, we use a working link containing only numbers in id and uid.  An example of how Go can do this beautifully. <br><br><img src="https://habrastorage.org/files/0a0/28e/f6e/0a028ef6e1a743b2a59d8c0ca3c8c485.png"><br><br>  We use shielding of certain characters.  For example, a single quote. <br><br><img src="https://habrastorage.org/files/8c3/bba/873/8c3bba873951469aa35edf6d977d6c4a.png"><br><br>  The output of the program.  It is seen that the symbol "'" is replaced by a sequence of characters "'". <br>  But you also should not forget that when implementing sql-injection we don‚Äôt have to have a quotation mark.  The variable vuln1 just contains the given string and, passing through the EscapeString function, does not change at all. <br><br><img src="https://habrastorage.org/files/0b3/9ab/6a4/0b39ab6a487044a7b95dd812d1dc800b.png"><br><br>  <b>SafeSQL</b> <br><br>  <a href="https://github.com/stripe/safesql">SafeSQL</a> is a static code analyzer for Go that allows you to find SQL injections. <br><br><h5>  Conclusion </h5><br>  Despite the fact that Go is a fairly new programming language, the community is growing rapidly and implements basic solutions that are found in almost every project.  Including solutions based on web application security.  The article discussed ways to avoid SQL-injection, CSRF, XSS, Clickjacking.  The considered methods are not a panacea for complete web application security.  But help to solve most of the fundamental problems associated with information security. <br><br><h4>  References </h4><br>  <a href="http:">https://learn.javascript.ru/csrf</a> <br>  <a href="http:">https://nvisium.com/blog/2014/11/26/developing-secure-applications-with/</a> <br>  <a href="http:">https://astaxie.gitbooks.io/build-web-application-with-golang/content/en/09.1.html</a> <br>  <a href="http:">https://learn.javascript.ru/clickjacking</a> <br>  <a href="http:">http://0xdabbad00.com/2015/04/18/go_code_auditing/</a> <br>  <a href="http:">http://dghubble.com/blog/posts/json-web-tokens-and-go/</a> </div><p>Source: <a href="https://habr.com/ru/post/308088/">https://habr.com/ru/post/308088/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308076/index.html">Microsoft opened the source code of PowerShell</a></li>
<li><a href="../308080/index.html">Website development based on ASP.NET Core and Platformus CMS</a></li>
<li><a href="../308082/index.html">Analysis of the Quran with AI</a></li>
<li><a href="../308084/index.html">SObjectizer: from simple to complex. Part III</a></li>
<li><a href="../308086/index.html">Individual daily limit for outgoing calls (limitation of paid directions)</a></li>
<li><a href="../308090/index.html">About the division of labor and its consequences</a></li>
<li><a href="../308092/index.html">It's time to tell you how I was Beeline for 4 years on Habr√© - and what I learned about Habr during that time</a></li>
<li><a href="../308094/index.html">Training with reinforcements for the smallest</a></li>
<li><a href="../308098/index.html">CsvLogWriter plugin for JMeter</a></li>
<li><a href="../308100/index.html">Trello Clone on Phoenix and React. Parts 4-5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>