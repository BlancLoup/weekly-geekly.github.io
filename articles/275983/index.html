<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Checking the source code of the C # /. NET component kit from Sony</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As some of you remember, we recently released a version of the analyzer that supports checking C # code . With the advent of analyzing the verificatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Checking the source code of the C # /. NET component kit from Sony</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/eae/94b/458/eae94b4580e942eaa95c40f18ec25a7c.png"></div><br>  As some of you remember, we recently released a version of the analyzer that <a href="http://www.viva64.com/ru/b/0363/">supports checking C # code</a> .  With the advent of analyzing the verification of projects written in C #, a new space for creativity opens up.  On the analysis of one of these projects, developed by Sony Computer Entertainment (SCEI), and will be discussed in this article. <br><a name="habracut"></a><br><br><h2>  What was checked? </h2><br>  <a href="http://www.scei.co.jp/index_e.html">Sony Computer Entertainment</a> is a video game company, one of the divisions of Sony Corporation that specializes in video games and game consoles.  This company develops video games, hardware and software for the PlayStation consoles. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c11/fd4/3a2/c11fd43a2fa44c5db0a51b48b84dbd23.png"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The Authoring Tools Framework (ATF) is a set of C # /. NET components for developing tools for Windows.  ATF is used by most of the advanced studios from SCEI that develop video games for making customized tools.  This set of components is used by such studios as Naughty Dog, Guerrilla Games, Quantic Dream.  In particular, the tools developed using these software components were used to create well-known games such as The Last of Us and Killzone.  ATF is an open source project that is available in the <a href="https://github.com/SonyWWS/ATF">repository on GitHub</a> . <br><br><h2>  Analysis tool </h2><br>  For analyzing the source code, the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> static analyzer was used.  This tool can validate source code written in C / C ++ / C # languages.  Each diagnostic message is described in detail in the documentation, which provides examples of incorrect code and ways to correct it.  Many diagnostic descriptions have a link to the corresponding section of <a href="http://www.viva64.com/ru/examples/">the error database</a> , which contains information about what errors in real projects could be detected with the help of various diagnostics. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/0a2/49b/cb8/0a249bcb8d514c1c89f7c3ecabfd7858.png"></div><br><br>  Download and try the analyzer on your (or someone else's) project, you can <a href="http://www.viva64.com/ru/pvs-studio-download/">link</a> . <br><br><h2>  Error examples </h2><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DefaultGiveFeedback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IComDataObject data, GiveFeedbackEventArgs e</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (setDefaultDropDesc &amp;&amp; (DropImageType)e.Effect != currentType) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Effect != DragDropEffects.None) { SetDropDescription(data, (DropImageType)e.Effect, e.Effect.ToString(), <span class="hljs-literal"><span class="hljs-literal">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { SetDropDescription(data, (DropImageType)e.Effect, e.Effect.ToString(), <span class="hljs-literal"><span class="hljs-literal">null</span></span>); } .... } }</code> </pre> <br>  Analyzer Warning: <a href="http://www.viva64.com/ru/d/0402/">V3004</a> The 'then' statement is equivalent to the 'else' statement.  Atf.Gui.WinForms.vs2010 DropDescriptionHelper.cs 199 <br><br>  As can be seen from the code, regardless of the truth of the condition 'e.Effect! = DragDropEffects.None', the same method will be called with the same arguments.  Not being a programmer who wrote this code, it is sometimes quite difficult to say how to fix this place correctly, but I think no one doubts that something needs to be fixed.  What exactly - to decide the author of the code. <br><br>  Consider the following code snippet: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProgressCompleteEventArgs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Exception progressError, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> progressResult, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cancelled</span></span></span><span class="hljs-function">)</span></span> { ProgressError = ProgressError; ProgressResult = progressResult; Cancelled = cancelled; }</code> </pre> <br>  Analyzer Warning: <a href="http://www.viva64.com/ru/d/0403/">V3005</a> The 'ProgressError' variable is assigned to itself.  Atf.Gui.Wpf.vs2010 StatusService.cs 24 <br><br>  The implication was that when the method was called, the properties would be assigned the values ‚Äã‚Äãpassed as arguments, and the names of the properties and parameters differ only in the case of the first letter.  As a result, the 'ProgressError' property is written to itself instead of getting the value of the 'progressError' parameter. <br><br>  What is interesting is not an isolated case of confusion between upper and lower case letters.  Some proven projects encountered errors of exactly the same type.  There is a suspicion that we will soon reveal a new sample error pattern, typical of programs written in C #.  There is a tendency to initialize properties in a method whose parameter names differ from the name of the properties being initialized only by the first letter register.  As a result, errors like this one appear.  In the following code example, if it is not erroneous, then it looks at least strange: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> Left { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> Top { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ApplyLayout</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">XmlReader reader</span></span></span><span class="hljs-function">)</span></span> { .... FloatingWindow window = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FloatingWindow( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, reader.ReadSubtree()); .... window.Left = window.Left; window.Top = window.Top; .... }</code> </pre> <br>  Analyzer Warnings: <ul><li>  <a href="http://www.viva64.com/ru/d/0403/">V3005</a> The 'window.Left' variable is assigned to itself.  Atf.Gui.Wpf.vs2010 DockPanel.cs 706 </li><li>  <a href="http://www.viva64.com/ru/d/0403/">V3005</a> The 'window.Top' variable is assigned to itself.  Atf.Gui.Wpf.vs2010 DockPanel.cs 707 </li></ul><br>  From the code and warnings of the analyzer you can see that the properties of the 'Left' and 'Top' of the 'window' object are written into themselves.  For some cases, this option is acceptable, for example, when special logic is 'hung' on the property access method.  However, there is no additional logic for these properties, therefore the reasons for writing such code remain unclear. <br><br>  The following example: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnBoundPasswordChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DependencyObject d, DependencyPropertyChangedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { PasswordBox box = d <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> PasswordBox; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || !GetBindPassword(d)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// avoid recursive updating by ignoring the box's changed event box.PasswordChanged -= HandlePasswordChanged; .... }</span></span></code> </pre> <br>  Analyzer warning: <a href="http://www.viva64.com/ru/d/0388/">V3019</a> Possibly incorrect variable is compared to null after type conversion using 'as' keyword.  Check variables 'd', 'box'.  Atf.Gui.Wpf.vs2010 PasswordBoxBehavior.cs 38 <br><br>  This type of error has also been repeatedly encountered in proven C # projects.  As a result of casting an object to a compatible type using the 'as' operator, a new object is obtained; however, further in the code, the original object is checked for equality to 'null'.  This code can work quite correctly if it is known that the object 'd' will always be compatible with the type 'PasswordBox'.  But if this is not the case (now, or later something will change in the program), then you will easily get a 'NullReferenceException' on the code that used to work normally.  So in any case, this code is worth fixing. <br><br>  In the following example, the programmer, on the contrary, tried to protect himself by all available means, only a little wondering why: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Rect Extent { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _extent; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Top &lt; <span class="hljs-number"><span class="hljs-number">-1.7976931348623157E+308</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Top &gt; <span class="hljs-number"><span class="hljs-number">1.7976931348623157E+308</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Left &lt; <span class="hljs-number"><span class="hljs-number">-1.7976931348623157E+308</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Left &gt; <span class="hljs-number"><span class="hljs-number">1.7976931348623157E+308</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Width &gt; <span class="hljs-number"><span class="hljs-number">1.7976931348623157E+308</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.Height &gt; <span class="hljs-number"><span class="hljs-number">1.7976931348623157E+308</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentOutOfRangeException(<span class="hljs-string"><span class="hljs-string">"value"</span></span>); } _extent = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; ReIndex(); } }</code> </pre> <br>  Analyzer Warning: <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression is always false.  Atf.Gui.Wpf.vs2010 PriorityQuadTree.cs 575 <br><br>  This condition will always be false.  If it is not clear - let's understand why. <br><br>  This is an implementation of a property of type 'Rect', therefore, 'value' is also of type 'Rect'.  'Top', 'Left', 'Width', 'Height' are properties of this type that are of type 'double'.  In this code, it is checked whether the values ‚Äã‚Äãof these properties are outside the range of values ‚Äã‚Äãthat the 'double' type can take.  Moreover, for comparison, 'magic numbers' are used, rather than constants defined in the 'double' type.  Since values ‚Äã‚Äãof type 'double' are always in this range, this condition will always be false. <br><br>  Apparently the programmer wanted to protect his program from a non-standard implementation of the 'double' type in the compiler.  Nevertheless, it looks strange, so the analyzer quite reasonably issued a warning, prompting the programmer to double-check the code. <br><br>  Go ahead: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DispatcherOperationStatus Status { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> DispatcherOperationStatus { Pending, Aborted, Completed, Executing } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EndInvoke</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IAsyncResult result</span></span></span><span class="hljs-function">)</span></span> { DispatcherAsyncResultAdapter res = result <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> DispatcherAsyncResultAdapter; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (res == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidCastException(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (res.Operation.Status != DispatcherOperationStatus.Completed || res.Operation.Status == DispatcherOperationStatus.Aborted) { Thread.Sleep(<span class="hljs-number"><span class="hljs-number">50</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.Operation.Result; }</code> </pre><br>  Analyzer Warning: Consider inspecting this expression <a href="http://www.viva64.com/ru/d/0411/">V3023</a> .  The expression is misprint.  Atf.Gui.Wpf.vs2010 SynchronizeInvoke.cs 74 <br><br>  The condition for executing the 'while' loop is redundant, it could be simplified by removing the second subexpression.  Then the cycle could be simplified to the following form: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (res.Operation.Status != DispatcherOperationStatus.Completed) Thread.Sleep(<span class="hljs-number"><span class="hljs-number">50</span></span>);</code> </pre> <br>  The following interesting example: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Vec3F </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProjectToArcball</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Point point</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)point.X / (m_width / <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Scale so bounds map // to [0,0] - [2,2] float y = (float)point.Y / (m_height / 2); x = x - 1; // Translate 0,0 to the center y = 1 - y; // Flip so +Y is up if (x &lt; -1) x = -1; else if (x &gt; 1) x = 1; if (y &lt; -1) y = -1; else if (y &gt; 1) y = 1; .... }</span></span></code> </pre> <br>  Analyzer Warnings: <ul><li>  <a href="http://www.viva64.com/ru/d/0425/">V3041</a> The expression was an implicitly cast from 'int' type to 'float' type.  Consider using a fractional part.  An example: double A = (double) (X) / Y ;.  Atf.Gui.OpenGL.vs2010 ArcBallCameraController.cs 216 </li><li>  <a href="http://www.viva64.com/ru/d/0425/">V3041</a> The expression was an implicitly cast from 'int' type to 'float' type.  Consider using a fractional part.  An example: double A = (double) (X) / Y ;.  Atf.Gui.OpenGL.vs2010 ArcBallCameraController.cs 217 </li></ul><br>  This is again one of those cases where it is very difficult for a third-party developer to say for sure whether the code contains an error or not.  On the one hand, the implementation of integer division followed by an implicit reduction to the real type looks strange.  On the other hand, sometimes they do it intentionally, neglecting lost accuracy. <br><br>  What was meant here is hard to say.  Probably, they didn‚Äôt want to lose accuracy at all, but as a result of the operation 'm_width / 2' this loss will still occur.  Then the code would need to be fixed to the following: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = point.X / ((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)m_width / <span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre> <br>  On the other hand, it is possible that they wanted to write an integer number in 'x', since further comparison operations with integer values ‚Äã‚Äãare performed.  In this case, it was not necessary to perform an explicit conversion of the code to the type 'float': <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = point.X / (m_width / <span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre> <br>  Our analyzer grows and develops, respectively, updated with new interesting diagnostics.  The next error was just found one of these new diagnostics.  Since this diagnosis is not included in the release at the time of this writing, I can‚Äôt provide a link to the documentation.  I hope, here and so everything is clear: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> QuatF </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Slerp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">QuatF q1, QuatF q2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> t</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> dot = q2.X * q1.X + q2.Y * q1.Y + q2.Z * q1.Z + q2.W * q1.W; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dot &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) q1.X = -q1.X; q1.Y = -q1.Y; q1.Z = -q1.Z; q1.W = -q1.W; .... }</code> </pre> <br>  Analyzer Warning: V3043 does not correspond with its formatting.  The statement is indented.  It is possible that curly brackets are missing.  Atf.Core.vs2010 QuatF.cs 282 <br><br>  From the code you can see that the sum of several products is calculated and the result of this operation is written to the variable 'dot', after which, if the value of 'dot' is negative, the inversion of all values ‚Äã‚Äãinvolved in the operation is performed.  More precisely, it was meant inversion, judging by the formatting of the code.  In fact, in this case only the property 'X' of the object 'q1' will be inverted, and all other properties will be inverted regardless of the value of the variable 'dot'.  The solution to the problem is braces: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dot &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { q1.X = -q1.X; q1.Y = -q1.Y; q1.Z = -q1.Z; q1.W = -q1.W; }</code> </pre> <br>  Go ahead: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> X; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Y; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Z; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Matrix4F m</span></span></span><span class="hljs-function">)</span></span> { .... ww = <span class="hljs-number"><span class="hljs-number">-0.5</span></span> * (m.M22 + m.M33); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ww &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ww &gt;= EPS2) { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> wwSqrt = Math.Sqrt(ww); X = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)wwSqrt; ww = <span class="hljs-number"><span class="hljs-number">0.5</span></span> / wwSqrt; Y = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(m.M21 * ww); Z = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(m.M31 * ww); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { X = <span class="hljs-number"><span class="hljs-number">0</span></span>; Y = <span class="hljs-number"><span class="hljs-number">0</span></span>; Z = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } X = <span class="hljs-number"><span class="hljs-number">0</span></span>; ww = <span class="hljs-number"><span class="hljs-number">0.5</span></span> * (<span class="hljs-number"><span class="hljs-number">1.0f</span></span> - m.M33); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ww &gt;= EPS2) { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> wwSqrt = Math.Sqrt(ww); Y = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)wwSqrt; <span class="hljs-comment"><span class="hljs-comment">//&lt;= Z = (float)(m.M32 / (2.0 * wwSqrt)); //&lt;= } Y = 0; //&lt;= Z = 1; //&lt;= }</span></span></code> </pre> <br>  Analyzer Warnings: <ul><li>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'Y' variable is assigned twice successively.  Perhaps this is a mistake.  Check lines: 221, 217. Atf.Core.vs2010 QuatF.cs 221 </li><li>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'Z' variable is assigned twice twice successively.  Perhaps this is a mistake.  Check lines: 222, 218. Atf.Core.vs2010 QuatF.cs 222 </li></ul><br>  I deliberately cited an additional piece of code to make the error more visual.  'Y' and 'Z' are instance fields.  Depending on certain conditions, these or those values ‚Äã‚Äãare written to these fields, after which the method is terminated.  But in the body of the last 'if' operator, they forgot to write the 'return' operator, which is why the fields will not be assigned the same values ‚Äã‚Äãthat were meant.  Then the correct code might look like this: <br><pre> <code class="cs hljs">X = <span class="hljs-number"><span class="hljs-number">0</span></span>; ww = <span class="hljs-number"><span class="hljs-number">0.5</span></span> * (<span class="hljs-number"><span class="hljs-number">1.0f</span></span> - m.M33); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ww &gt;= EPS2) { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> wwSqrt = Math.Sqrt(ww); Y = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)wwSqrt; Z = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(m.M32 / (<span class="hljs-number"><span class="hljs-number">2.0</span></span> * wwSqrt)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } Y = <span class="hljs-number"><span class="hljs-number">0</span></span>; Z = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  On this, perhaps, we will stop.  These places seemed the most interesting, so I decided to write them out and make out.  Other errors were found, in particular - I didn‚Äôt consider warnings with a low level of importance at all, I wrote out a few warnings from medium and high levels. <br><br><h2>  Conclusion </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/files/02b/f5e/686/02bf5e6862e4427e8ec2f49261dc7968.png"></div><br><br>  As you can see, no one is insured against errors, and due to carelessness it is easy to assign the object to oneself or to miss some operator.  In a large amount of code, such errors are often difficult to detect visually, moreover, not all of them manifest themselves immediately - some of them will shoot you in the foot a couple of years later.  To prevent this, a static analyzer is needed to detect errors at an early stage, reduce the cost of project development, protect your nerves and keep your feet intact. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0371/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Sergey Vasiliev.  <a href="http://www.viva64.com/en/b/0371/">Sony C # /. NET component set analysis</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/275983/">https://habr.com/ru/post/275983/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275965/index.html">Instagram Like Bot</a></li>
<li><a href="../275967/index.html">How does the world's largest stock exchange from Chicago: infrastructure and technology</a></li>
<li><a href="../275969/index.html">Some freebies in Microsoft Azure or create free SQL Database in the cloud</a></li>
<li><a href="../275979/index.html">Alteration of RC-cars in a smart machine using Arduino</a></li>
<li><a href="../275981/index.html">Office as a platform: how the project Notegram for OneNote is developing</a></li>
<li><a href="../275985/index.html">Who are the Microsoft partner students?</a></li>
<li><a href="../275987/index.html">Site CrashSafari.com sends iPhones to reboot</a></li>
<li><a href="../275989/index.html">Automate word processing using the Microsoft Word API</a></li>
<li><a href="../275993/index.html">Where do bad programmers come from and what is their problem</a></li>
<li><a href="../275995/index.html">Software licensing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>