<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pylons. Alternative routing.py</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good time of day. Not so long ago, we started writing a big project on Pylons and one of the main requirements was the quick connection and removal of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pylons. Alternative routing.py</h1><div class="post__text post__text-html js-mediator-article">  Good time of day.  Not so long ago, we started writing a big project on Pylons and one of the main requirements was the quick connection and removal of controllers without changes to routing.py.  One of our employees has already encountered similar and made this functionality through plugins.  But, as it seemed to me, the decision was rather cumbersome and it was hard to transfer it from project to project in the future. <br><br>  Because  I‚Äôve dealt with the Catalyst (Perl MVC framework) in the past, and I liked that it was possible to add a URL to each method.  Actually I decided to write something similar. <br><a name="habracut"></a><br><br>  Demand.  ‚ÄúWe need minimal functionality, with a minimum of gestures.  Call the decorator from a URL (or an empty string).  Also, so that the already prepared buns with the parameters in the URL are not lost. ‚Äù 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The solution came through decorators.  And it turned out that actually there wasn‚Äôt much to write and the solution was very portable. <br><br>  Actually, I'll start with the fact that pylons need to be patched.  Harm this patch will not bring your current projects, so you can safely patch. <br><pre> --- pylons / util.py 2009-12-29 14: 28: 20.000000000 +0600
 +++ dev / null 2010-02-05 03: 44: 26.000000000 +0600
 @@ -122.6 +122.8 @@
          'Oneword'
 
      "" "
 + module_name = module_name.split ('.') [- 1]
      words = module_name.replace ('-', '_'). split ('_')
      return '' .join ([w.title () for w in words])
</pre><br><br>  The patch fixes a Pylons bug that prevents you from having a substructure in the project_name / controllers / *.  For some reason, they made it so that if you write the way to the method of an object with a point, then this point disappears.  Actually with this patch you can make any structure in your pylons project. <br><br>  Next, you need to add the library file to the project (or if you decide to do all projects on our principle, you can put it in a separate lib). <br><br>  # PROJECT / lib / controllers.py <br><pre> # - * - coding: utf-8 - * - 
                                                                                                                                                             
 import os                                                                                                                                                                               
                                                                                                                                                                                        
 def scan_folder_recurse (folder, excl_names = ['__']):
     "" "Recurse search for PY files in given folder" ""                                                                                                                                   
     all_files = []                                                                                                                                                                      
     for root, dir, files in os.walk (folder):                                                                                                                                            
         filelist = \                                                                                                                                                                    
             [os.path.join (root, fi) for files in files if fi.endswith ('. py')                                                                                                               
               and not any (fi.startswith (prefix) for prefix in excl_names)]                                                                                                              
         for f in filelist:                                                                                                                                                              
             all_files.append (f)                                                                                                                                                         
     return all_files                                                                                                                                                                                                                                                                                                                                                      
</pre><br>  This function allows you to get a recursive list of all * .py files in the desired directory.  Those.  if you want, you can not store controllers only in the controllers folder.  It will certainly be a bad idea, but the cases are different. <br><br>  Next, we modify the config / routing.py file and the make_map () function <br><br><pre>     map = Mapper (directory = config ['pylons.paths'] ['controllers'],
                  always_scan = config ['debug'])
     map.minimization = False

     proj_root = os.path.dirname (config ['pylons.paths'] ['root'])
     sep = os.path.sep

     "" "GETTING ALL FILES ENTIRE CONTROLLERS FOLDER" ""
     all_files = scan_folder_recurse (
             config ['pylons.paths'] ['controllers'],
             excl_names = ['__', 'daemon', 'models'])

     log.debug ("Found% d controllers"% len (all_files))
     log.debug ("Building route map")

     cfg = ConfigParser.RawConfigParser ()
     cfg.read (config ['global_conf'] ['__ file__'])

     for file in all_files:
	 t_controller_name = module_path.split ('.') [- 1]
         controller_name = '/'.join(module_path.split('.')[2:])

         "" "IMPORTING MODULE" ""
	 controller = __import __ (module_path)
         "" "IMPORTING MODULE ENVIRONMENT" ""
	 controller = sys.modules [module_path]

	 my_list = dir (controller)
	 name_re = re.compile (t_controller_name, re.IGNORECASE)
        
         "" "We need classes with methods" ""
	 control = None
	 for element in my_list:

	     if name_re.search (element) and controller_re.search (element):
	         control = getattr (controller, element)
         "" "If class found" ""
	 if control:
           "" "Searching for need property" ""
	   for item in control .__ dict__:
	       try:
	           attrib = control .__ dict __ [item] .__ dict __ ['method']

                   "" "If Class has method property" ""
	           if attrib == 'path':
	               route_path = getattr (control, item) .route_path

	           else:
	               route_path = "/% s ‚Äã‚Äã/% s"% (controller_name, item)

	           route_path = route_path.rstrip ('/')

                   "" "Two method to create variations of path" ""
	           map.connect (
	                   route_path,
	                   controller = controller_name,
	                   action = item)
	           map.connect (
	                   "% s /"% route_path,
	                   controller = controller_name,
	                   action = item)

	           log.info ("% s ::% s ---- &gt;&gt;&gt;&gt;% s ..... connected"% \
	               (controller_name, item, route_path))
	       except:
	           pass


     log.info ('Route map complite ...')
     # The ErrorController route (handles 404/500 error pages);  it should
     # likely to be resolved
     map.connect ('/ error / {action}', controller = 'error')
     map.connect ('/ error / {action} / {id}', controller = 'error')

     return map

</pre><br><br>  This code snippet can replace the entire make_map () function.  Now the function takes a list of * .py files recursively from the folder with the controllers.  Makes a check on the existence of properties for each method in each class.  If the necessary properties are present, then it is considered that the method should be present in the MAP controllers.  Next, the methods found are passed to the MAP.  Finally we connect the error controller.  Yes, by the way, I was a little unnerved by the feature, with the prescription of 2 maps for each URL: with and without a slash.  Now she fixed <br><br>  So, we now have to do the decorator and apply it. <br><br>  And so, the lib / decorators.py decorator itself: <br><br><pre> # - * - coding: utf-8 - * -
 "" "Decorators for project
 "" "

 def route_action (path = None):
     def decorate (f):
         if path == None:
             setattr (f, 'method', 'local')
         else:
             setattr (f, 'method', 'path')
             setattr (f, 'route_path', path)
         return f
     return decorate

</pre><br><br>  Those.  if you call the decorator without a parameter, the default path will be applied.  If with parameter - then customized. <br><br>  And the actual use of controllers / sample.py <br><br><pre> from PROJECT.lib.decorators import route_action

 class SampleController (BaseController):
     @route_action ('/ sample / hello_world')                                                                                                                                                  
     def hello (self):
         return "This is Sample / Hello method"

     @route_action ()                                                                                                                                                  
     def hello_to_me (self):
         return "This is Sample / Hello_to_me local method"

     @route_action ('/ sample / hello_world / {id}')                                                                                                                                                  
     def hello (self, id):
         return "This is the Sample / Hello World with ID:% d method"% id
</pre><br><br>  The principle of operation of this whole scheme is extremely simple.  The decorator creates two additional properties, one of which contains your method.  The second indicates exactly how to handle this method.  If no arguments were given, the decorator records only that the method is local, i.e.  the path must be generated.  If there are no such properties (there is no decorator on the method), then the method is not considered active and there will be no calls to it. <br><br>  Actually, starting the project, you will see in the console a list of what you have connected and the path to this method. <br>  Following the link, having done everything correctly, you should see the expected result. <br><br>  It seems to be all that could write.  Tips, wishes? </div><p>Source: <a href="https://habr.com/ru/post/94413/">https://habr.com/ru/post/94413/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../94407/index.html">USB "heirs" of Faberge - KM2009, category "Modification of USB-media"</a></li>
<li><a href="../94408/index.html">Cleaning windows from viruses using Ubuntu</a></li>
<li><a href="../94409/index.html">What should we build a Merce? KM2009, category "Creating a custom-buildings"</a></li>
<li><a href="../94410/index.html">Mayor of London has promised full coverage of the city with Wi-Fi networks by 2012</a></li>
<li><a href="../94411/index.html">Forgivably having an average salary and a desire to read, extort e-books without buying them?</a></li>
<li><a href="../94416/index.html">Bespin goes to node.js</a></li>
<li><a href="../94417/index.html">Skype and Google Adwords</a></li>
<li><a href="../94420/index.html">Web Standards Days 2010 in Riga</a></li>
<li><a href="../94421/index.html">10 unnatural ways to calculate Fibonacci numbers</a></li>
<li><a href="../94422/index.html">Google Chrome bug or unbelievable features UA-IX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>