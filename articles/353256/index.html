<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How fast is AMP really?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Google's Accelerated Mobile Pages (AMP) project has caused some confusion for ideological reasons, but the technology itself has not been disassembled...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How fast is AMP really?</h1><div class="post__text post__text-html js-mediator-article">  Google's Accelerated Mobile Pages (AMP) project has caused some confusion for ideological reasons, but the technology itself has not been disassembled in detail.  A few weeks ago, Ferdy Cristant wrote about the <a href="https://ferdychristant.com/amp-the-missing-controversy-3b424031047">unfair advantage that AMP content gets by preloading</a> .  It made me think: how well does the AMP <i>really work</i> ?  I have seen tests like Ferdi‚Äôs when comparing one or two pages, but haven‚Äôt yet met with comprehensive objective tests. <br><br>  Assessing AMP performance is actually not as simple as it seems.  You need to consider at least four contexts: <br><br><ol><li>  <a href="https://habr.com/ru/post/353256/">How well does AMP work in the context of Google search?</a> </li><li>  <a href="https://habr.com/ru/post/353256/">How well does the AMP library work as a standalone framework?</a> </li><li>  <a href="https://habr.com/ru/post/353256/">How well does AMP work when loading from cache?</a> </li><li>  <a href="https://habr.com/ru/post/353256/">How well does AMP work compared to a canonical document?</a> </li></ol><a name="habracut"></a><br><a name="1"></a><h1>  How well does AMP work in the context of Google search? </h1><br>  As Ferdy noted, when you navigate the AMP article from Google search, it loads instantly.  A small lightning icon AMP is more appropriate here than ever.  But you do not notice that Google provides such an instantaneous transition by actively preloading AMP documents in the background. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the search carousel, this is literally a frame where the entire AMP document is loaded.  If you click on this AMP page, then it is already loaded in the background - and immediately displayed on the screen. <br><br>  AMP works great in the context of Google search.  Like any page preloaded in the background.  The only advantage of AMP in this context is the <i>initial launch provided by Google</i> . <br><br>  In other words, an AMP performance assessment based on how these pages are loaded in the search results does not say anything about the effectiveness of AMP itself, but rather about the effectiveness of preloading content. <br><br><a name="2"></a><h1>  How well does the AMP library work as a standalone framework? </h1><br>  In his post, Ferdy analyzed a page from Scientas.  He found that without preloading it opens far from instantly.  On the 3G emulation article Scientas AMP shows you a white screen for 3.3 seconds. <br><br>  You might think that this happens with only one page.  Like, there is a large variation in speed and, perhaps, Scientas is only a single example.  Just a remark, so let's see. <br><br>  The first thing I looked at the news.  I do not recommend it to anyone, but I had to. <br><br>  When the AMP article came across, I added its URL to the table.  It doesn't matter which topic or from which site: if AMP is indicated, the link was placed in a table.  The only filtering was to not include more than two URLs from one domain. <br><br>  In the end, after this filtering turned out a list of 50 different articles of AMP.  I drove them through <a href="http://www.webpagetest.org/">WebPageTest</a> to emulate a 3G connection on Nexus 5. Each page was built via AMP, and <i>also downloaded from the source server</i> . <br><br>  AMP consists of three main parts: <br><br><ul><li>  AMP HTML </li><li>  AMP JS </li><li>  Amp cache </li></ul><br>  When we talk about the AMP library, we mean AMP JS and AMP HTML together.  HTML AMP is both a subset of HTML (there are limitations that you can and can‚Äôt use) and an addition to it (HTML AMP includes a number of custom AMP components and properties).  AMP JS is a library that gives you these custom elements, and also produces various optimizations for AMP-based documents.  Since HTML, CSS and JS are the basis, you can completely build a document using the AMP library without using the Google AMP cache. <br><br>  The AMP library must provide some level of consistency in performance.  For the most part she copes. <br><br>  Most test pages loaded within a reasonable range of each other.  But at both ends of the spectrum, some deviations were observed: the minimum values ‚Äã‚Äãturned out to be rather low, and the maximum values ‚Äã‚Äã- frighteningly large. <br><br><table cellspacing="3"><tbody><tr><th>  Metrics </th><th>  Min </th><th>  Max. </th><th>  Median </th><th>  90th percentile </th></tr><tr><td>  Start rendering </td><td>  1765 ms </td><td>  8130 ms </td><td>  4617 ms </td><td>  5788 ms </td></tr><tr><td>  Visually complete view </td><td>  4604 ms </td><td>  35,096 ms </td><td>  7475 ms </td><td>  21,432 ms </td></tr><tr><td>  Speed ‚Äã‚Äãindex </td><td>  3729 </td><td>  16 230 </td><td>  6171 </td><td>  10,144 </td></tr><tr><td>  The size </td><td>  273 KB </td><td>  10,385 KB </td><td>  905 KB </td><td>  1,553 KB </td></tr><tr><td>  Requests </td><td>  14 </td><td>  308 </td><td>  61 </td><td>  151 </td></tr></tbody></table><br>  Basically, AMP performance is relatively predictable.  However, the numbers also indicate that AMP support does not give a 100% guarantee that the page will be quick or easy.  As with <i>any</i> other technology, it is possible to create an AMP document that will be slow and heavy. <br><br>  Any statement that AMP provides a certain level of performance depends on the attitude to extremes and on what you consider ‚Äúperformance‚Äù.  If you are trying to build an entire site on the basis of AMP, then it should be understood: although it is unlikely to turn out to be too bloated, it will not immediately load at lightning speed.  This will require some work. <br><br>  At least this applies to the library itself.  Perhaps the AMP cache will show a significant increase in speed? <br><br><a name="3"></a><h1>  How well does AMP work when loading from cache? </h1><br>  The AMP library itself helps, but not as much as one might think.  Maybe Google cache will add speed? <br><br>  The Google AMP Cache is an AMP document delivery CDN.  Like most CDNs, it caches documents and applies a number of optimizations to them.  The cache also includes a verification system that the document is a valid AMP document.  When you see an AMP icon, for example, in a Google search, the document is downloaded from Google AMP Cache. <br><br>  I again drove the same 50 pages through WebPagetest.  This time I downloaded every page from Google AMP CDN.  <a href="https://twitter.com/patmeenan">Pete Minen</a> did me a favor and shared a script for WebPagetest, which preheats connections with Google CDN, so that the result would look more like what you see in reality. <br><br> <code>logdata 0 <br> navigate https://cdn.ampproject.org/c/www.webpagetest.org/amp.html <br> logdata 1 <br> navigate %URL%</code> <br> <br>  When loaded from the cache, AMP pages showed a noticeable performance improvement in all respects. <br><br><table cellspacing="3"><tbody><tr><th>  Metrics </th><th>  Min </th><th>  Max. </th><th>  Median </th><th>  90th percentile </th></tr><tr><td>  Start rendering </td><td>  1427 ms </td><td>  4828 ms </td><td>  1933 ms </td><td>  2291 ms </td></tr><tr><td>  Visually complete view </td><td>  2036 ms </td><td>  36,001 ms </td><td>  4924 ms </td><td>  19,626 ms </td></tr><tr><td>  Speed ‚Äã‚Äãindex </td><td>  1966 </td><td>  18,677 </td><td>  3277 </td><td>  9004 </td></tr><tr><td>  The size </td><td>  177 KB </td><td>  10,749 KB </td><td>  775 KB </td><td>  2.079 KB </td></tr><tr><td>  Requests </td><td>  13 </td><td>  305 </td><td>  53 </td><td>  218 </td></tr></tbody></table><br>  In general, the benefits of the cache are quite substantial.  Although the maximum values ‚Äã‚Äãare still depressing (the slightly increased maximum is explained mainly by the difference in banners in different tests).  But the median average, which corresponds to most AMP documents, is better for all indicators. <br><br>  The improvement is not surprising, given the various performance optimizations that the CDN automatically performs, including: <br><br><ul><li>  Caching images and fonts </li><li>  Limit the maximum size of images </li><li>  Compression of images on the fly, as well as the generation of options of different sizes with the addition of srcset for them </li><li>  Using HTTP / 2 and HTTPS </li><li>  Clearing HTML Comments </li><li>  Auto-enable hints for resources like <code>dns-prefetch</code> and <code>preconnect</code> </li></ul><br>  Once again, it is worth noting that <i>none of these optimizations</i> require the use of AMP.  Most of the major CDN providers do the same.  You yourself can automate all these optimizations during the build process. <br><br>  I'm not saying that you need to drop the Google cache, just keep in mind that you can and should use these optimization methods, whether you use AMP or not.  There is nothing unique about AMP itself or even AMP cache. <br><br><a name="4"></a><h1>  How well does AMP work compared to a canonical document? </h1><br>  We made sure that the AMP library itself gives only a small performance boost, but the cache with all the optimizations takes the download speed to a new level. <br><br>  One of the arguments in favor of AMP is that it does not need to be an ‚Äúexpert‚Äù to make a productive website.  Although I would argue with the fact that many of the sites we have seen can be called "productive", it makes sense to compare AMP documents with their canonical equivalents. <br><br>  For the next test round, I took the canonical version of each page and checked it under the same conditions.  It turned out that AMP documents more often outperform their equivalents without AMP, which indicates insufficient optimization of the latter. <br><br><table cellspacing="3"><tbody><tr><th>  Metrics </th><th>  Min </th><th>  Max. </th><th>  Median </th><th>  90th percentile </th></tr><tr><td>  Start rendering </td><td>  1763 ms </td><td>  7469 ms </td><td>  4227 ms </td><td>  6298 ms </td></tr><tr><td>  Visually complete view </td><td>  4231 ms </td><td>  108 006 ms </td><td>  20,418 ms </td><td>  54,546 ms </td></tr><tr><td>  Speed ‚Äã‚Äãindex </td><td>  3332 </td><td>  45 362 </td><td>  8152 </td><td>  21 495 </td></tr><tr><td>  The size </td><td>  251 KB </td><td>  11,013 KB </td><td>  2762 KB </td><td>  5229 KB </td></tr><tr><td>  Requests </td><td>  24 </td><td>  1743 </td><td>  318 </td><td>  647 </td></tr></tbody></table><br>  For a second, let's forget about the Google cache and again compare the AMP library with the canonical pages. <br><br>  The metrics "Start Download" and "Speed ‚Äã‚ÄãIndex" do not notice much benefit from the library.  In fact, the start of rendering in AMP documents is even <i>slower</i> . <br><br>  This is not too surprising.  As mentioned above, AMP documents use the AMP JS library for many optimizations and resource loading.  When you rely on this JavaScript to display the page, you immediately get hit on the visualization indicators.  This is observed until the AMP cache comes into play, which returns normal values ‚Äã‚Äãfor the start of rendering and the speed index. <br><br>  However, according to other indicators, AMP is clearly superior to the canonical version. <br><br><h1>  Increased productivity ... but for whom? </h1><br>  The verdict on the effectiveness of AMP is a bit ambiguous.  On the one hand, for all equal, the use of AMP does not necessarily accelerate page loading.  There is no guarantee that AMP will not slow down or wipe your data. <br><br>  On the other hand, AMP documents are usually faster than the original versions.  More efficient distribution of load in AMP significantly reduces overhead.  Suddenly, publishers who like to include third-party scripts on canonical pages dramatically reduce (at least, they are forced to do so) the number of third-party scripts for AMP pages. <br><br>  The biggest advantage of AMP is not the library, because its functions can be implemented independently.  This is not a cache - many of its optimizations are implemented through a good build script, and any decent CDN provider has all of them.  This does not mean that in the AMP JS library or the cache there are not really the right things - they are.  They just do not give the biggest difference in terms of performance. <br><br>  The main advantage of AMP is restrictions on how much content can be squeezed into one page. <br><br>  For example, here is a graph showing all the requests for the same page, written under the AMP requirements (right), compared to the canonical version (left).  Sorry for scrolling. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf6/26b/43e/cf626b43e6ef8a61368b8b649d72e03a.png"></div><br>  <i><font color="gray">Comparison of load charts for the canonical version of the article (left) and the AMP version (right).</font></i>  <i><font color="gray">AMP restrictions minimize the number of requests</font></i> <br><br>  The page size in the 90th percentile for the canonical version is 5229 KB.  The size in the 90th percentile for AMP documents from the same source is 1553 KB, the difference is about 70%.  The number of requests in the 90th percentile for canonical versions of pages is 647, for AMP documents - 151. A decrease of almost 77%. <br><br>  The limitations of AMP really reduce the size of the pages and remove extraneous trash from them.  Publishers are ready to make this concession for the sake of content distribution services from Google, but are hesitant to do so for canonical versions of pages. <br><br>  If we evaluate AMP in terms of speeding up the Web, then the evidence is not particularly convincing.  For all sites, the AMP version works <i>in addition</i> to the non-AMP version. <br><br>  Absolutely.  Everyone has.  Sites. <br><br>  And usually these versions without AMP are heavy and slow.  If you read the news on these sites and did not specifically click on the AMP button, then AMP will not improve the page loading.  AMP does not solve the main problem;  he just hides her a little. <br><br>  Time will tell if anything will change.  Perhaps, as in the beginning of the transition from mobile sites <code>http://m.</code>  to adaptive sites, publishers slowly harness.  But right now it seems that the calls for the transition to AMP do exactly what you think: they promote AMP, not productivity. </div><p>Source: <a href="https://habr.com/ru/post/353256/">https://habr.com/ru/post/353256/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353246/index.html">We invite you to a lecture evening on game design on April 18th at VSBI</a></li>
<li><a href="../353248/index.html">Reachability of the lower limit of the execution time of a commit distributed fault-tolerant transactions</a></li>
<li><a href="../353250/index.html">Dofoil Hunt with Windows Defender ATP</a></li>
<li><a href="../353252/index.html">Manage copying Active Directory attributes when duplicating user accounts</a></li>
<li><a href="../353254/index.html">How in hh.ru test job search</a></li>
<li><a href="../353258/index.html">About decorators, end-to-end functionality, CQRS and layered architecture</a></li>
<li><a href="../353262/index.html">JS DevDay: about titanium, workers and hybrids</a></li>
<li><a href="../353264/index.html">Kubernetes developers answer questions from Reddit users</a></li>
<li><a href="../353266/index.html">The latest version of updates for our superpowers. Review of the book by Dan Roham "Draw to win"</a></li>
<li><a href="../353268/index.html">JPoint 2018: Debriefing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>