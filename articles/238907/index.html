<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Manage household appliances ("smart home") via chat bot on Raspberry Pi</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this project, we launch our iOS, Android or Web application, and also write (or rather, add a little) a chat bot on python that manages sockets thr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Manage household appliances ("smart home") via chat bot on Raspberry Pi</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b6e/e84/273/b6ee8427395447e5bbe9ee34338e463e.jpg" align="left">  In this project, we launch our iOS, Android or Web application, and also write (or rather, add a little) a chat bot on python that manages sockets through a radio module connected to Raspberry Pi. <br><br>  As a result, we can manage home appliances and receive statuses from them remotely and with other users through a general chat. <br><br>  Interesting? <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  What for? </h4><br>  The question ‚Äúwhy do you need it?‚Äù Is not always urgent for projects from the ‚Äúsmart home‚Äù series and all the Internet of Things, there is often a lot of time and money spent on automating something that in practice is more convenient to switch in the old way with a regular wall switch: -) But at the same time you get a lot of pleasure and useful experience in the process and then you rejoice in the proper operation of the mechanism that you made yourself. <br><br>  But besides the above-mentioned pleasures, it seems to me that managing the home and communicating devices through chat, specifically the XMPP protocol, has the right to life for the following reasons: <br><br><ul><li>  <b>Human language</b> - it's quite easy to make chat bot communicate with you in human language, which is quite convenient, especially for less technical family members.  It also allows you to connect voice control in perspective. </li><li>  <b>Universal remote access</b> - you can connect to the XMPP chat server from anywhere and from any Jabber compatible IM client.  People are comfortable, and how to connect the device described in this article. </li><li>  <b>Convenient control for the whole family</b> - connect home to a single group chat, where the bots are responsible for the house or appliances in the house.  You can discuss your family issues and manage your home at the same time.  Everyone can see who gave what commands to the instruments, you can see their (bots) answers and reports, view the previous history, etc.  It's comfortable. </li><li>  <b>A system of independent distributed agents</b> .  Each device or set of sensors that have representation (in fact, the user) in the chat, respectively, are independent agents and can communicate with other devices and be managed by them or you directly.  A single server is optional.  You can raise your chat bot for each important device or sensor, as well as set up the main bot with AI elements, such a ‚Äúbutler‚Äù or ‚Äúmajordomo‚Äù who will manage all the devices, and they will communicate in the chat available to you and other family members you understand the language, so that you can always track what happened or intervene in the process. </li></ul><br><br><h4>  Props </h4><br>  For this mini-project, we need the following components: <br><br>  <b>1. Raspberri P.</b> <br>  I have a model B, I ordered literally the day before the announcement of the B + release, but in principle, any model is suitable here, the main thing is to see that the GPIO pins are compatible with the control module that you choose.  About this below. <br>  Well and so, the main requirement is to start the chat bot on python. <br><br><img src="https://habrastorage.org/files/495/0d6/00e/4950d600e7d348a7a115303c73552e60.jpg"><br><br>  <b>2. Accessories to your Pi.</b> <br>  WiFi module, simple USB keyboard and mouse, SD memory card with the Raspbian distribution, power supply, optional plastic case. <br>  This is the standard for ‚Äúraspberry‚Äù, but because  I bought it for the first time, specifically for this project, I did not know that WiFi and SD card are not included in the standard kit, and I had to order it, so keep in mind.  You also need a monitor or TV with an HDMI cable to set up. <br><br><img src="https://habrastorage.org/files/b2d/ce7/d2f/b2dce7d2f64f40c5bc4c95c873ae7fb9.jpg"><br><br>  <b>3. Control module (RF transmitter) and sockets or other devices with a receiver (RF receiver).</b> <br>  Here you need to say that I went on a fast or lazy way, and ordered a ready-made RF module for Pi and a set of radio-controlled sockets from <a href="https://energenie4u.co.uk/index.php/catalogue/product/ENER002-2PI">Energenie</a> .  Included is a ready-made RF transmitter that plugs into your raspberry on the GPIO.  To whom this path is not to their liking, there are alternatives, in the internet a lot of guides on how to pick up a code to existing radio-controlled devices and control them through a simple cheap Chinese RF transmitter.  Alternatively, you can control devices via Pi directly by direct wired connection with GPIO, as well as via WiFi and other channels. <br><br>  Here is a photo of my Energenie kit: <br><img src="https://habrastorage.org/files/ba5/494/6c9/ba54946c952e4686ac2802f55333020a.jpg"><br><br><img src="https://habrastorage.org/files/d22/dc3/1eb/d22dc31eb7eb4487a27f0869c388257c.jpg"><br><br>  <b>4. Chat client.</b> <br>  This tutorial uses <a href="http://q-municate.com/">Q-municate</a> , this is an open source messenger from our platform QuickBlox, which can be downloaded from github and scored for iOS, Android or run the Web version on the desktop and other platforms.  The advantage of using Q-municate is that you can customize the interface for yourself and make your own application, for example, only for your family. <br>  But it is absolutely not necessary.  You can use any Jabber / XMPP compatible client, for example Adium. <br><br>  So, let's begin. <br><br><h4>  Install distributions / dependencies for Raspbian </h4><br>  Log in to the raspberry and put the following things under the root: <br><pre><code class="bash hljs">apt-get install python-dev pip install sleekxmpp pip install dnspython pip install pyasn1 pyasn1-modules apt-get install python-rpi.gpio</code> </pre> <br>  We actually need sleekxmpp, this is the basic project for the chat bot, and the rest solves issues with different dependencies for this project.  Well, plus python-rpi.gpio allows you to control the GPIO pins of the raspberry from our python script. <br><br><h4>  We connect and check the radio control module </h4><br>  If you use a different module, not from Energenie, then you will have to explore this part yourself. <br><br>  When using the same ready-made Pi-mote module, everything is simple and well described in the official manufacturer's instructions: <a href="https://energenie4u.co.uk/res/pdfs/ENER314%2520UM.pdf">energenie4u.co.uk/res/pdfs/ENER314%20UM.pdf</a> <br><br>  Personally, I spent an inadmissibly long time trying to determine if my set of radio-controlled outlets works, measuring voltage on a raspberry, trying unofficial scripts, etc., because the Energenie sockets for some reason did not want to be controlled by a script, as described by the manufacturer and multiple blogs.  It did not immediately come to look at the manual again and read this time carefully, and there it says in English and white that you need to start the sockets first in the training mode.  Is logical.  In my defense, I can only say that the project was done early in the morning on weekends, while the family was sleeping, apparently it was not enough sleep :-) <br><br>  So, we train.  According to the instructions, run the script <br><br><pre> <code class="bash hljs">sudo python ENER002.py</code> </pre><br>  we insert sockets into sockets) and if the lights on them do not blink, then we switch to learning mode by pressing the off button for 5 seconds.  The lights blink, press ‚ÄúEnter‚Äù on the keyboard to give a signal from the script and see the fast blinking of the light, this means that the training was successful.  Repeat the same with the rest of the outlets.  One Pi-mote module can supply 4 different codes, i.e.  You can manage 4 different sets of Energenie outlets, while no one bothers to use one code for several outlets at the same time. <br><br><h4>  Raise chat server </h4><br>  We need an XMPP / Jabber compatible chat server with the ability to create a MUC (group chat or chat room) in it to connect our chat bot and human users to it. <br><br>  In principle, on Pi you can raise your chat server, for example, here <a href="http://box.matto.nl/raspberryjabberd.html">http://box.matto.nl/raspberryjabberd.html</a> describes the installation of ejabberd on Raspberri Pi. <br><br>  In this article, we again follow the path of least resistance and use a ready-made free chat server from <a href="http://quickblox.com/">QuickBlox</a> .  You just need to create an account to get your own chat server and web admin to it. <br><br>  The steps below describe the registration and at the same time creating a user for our chat bot and MUC rooms for communication. <br><br>  1. We register on <a href="http://quickblox.com/signup/">http://quickblox.com/signup/</a> or log in via GitHub / Google <br><br>  2. Create an application in the admin panel. <br><img src="https://habrastorage.org/files/00f/5d1/464/00f5d1464063494799542cbad8ec7d70.png"><br><br>  3. Create a user for our chat bot (Users -&gt; Add new user) <br><img src="https://habrastorage.org/files/8eb/2f1/181/8eb2f1181f254960a0583adc34371139.png"><br><br>  4. Create a MUC room for communication (Chat -&gt; New dialog) <br><img src="https://habrastorage.org/files/b45/fc8/900/b45fc89002c344c9b47e0ea7271a6fc2.png"><br><br>  Everything, your own XMPP chat server is ready to receive citizens and bots, 24 hours a day, without lunch breaks. <br><br><h4>  We write and set up chat bot </h4><br>  We have already installed the library SleekXMPP, which implements the XMPPshny chat bot on python. <br>  The project site has a good example for MUC chat bot: <a href="http://sleekxmpp.com/getting_started/muc.html">http://sleekxmpp.com/getting_started/muc.html</a> <br>  source can be found here: <a href="https://github.com/fritzy/SleekXMPP/blob/develop/examples/muc.py">https://github.com/fritzy/SleekXMPP/blob/develop/examples/muc.py</a> <br><br>  Next we need to take and modify it to fit our needs. <br>  If you also use Energenie for managed outlets and QuickBlox for the chat server, then you can take my ready-made script here: <a href="https://github.com/QuickBlox/sample-powerbot-python-rpi" title="xmpp chat bot to control electrical appliances">https://github.com/QuickBlox/sample-powerbot-python-rpi</a> . <br>  You will only need to change the credentials at the beginning of the script, writing there your application and user keys (the one we created above). <br><br>  Below we will go through in more detail on the changes that have been made, but briefly what has been done (I apologize in advance for the level of the python code - not a programmer for a long time and certainly not a programmer - I will be grateful for any improvements and pull requests): <br><br>  1. Added auto-join by invitation to other chat rooms. <br><br>  2. Fixed compatibility with QuickBlox and Q-municate (trivia such as the format of the name of the chat rooms, etc.) <br><br>  3. Added the actual command parsing for controlling the instruments - in our case, these are ‚Äúlamp on‚Äù, ‚Äúlamp off‚Äù, ‚Äúall on‚Äù and ‚Äúall off‚Äù - and the call of the switch_on / switch_off functions from the python module of energenie, which already gives commands to radio transmitter board via GPIO. <br>  Who works directly with GPIO, look in <a href="https://github.com/QuickBlox/sample-powerbot-python-rpi/blob/master/energenie.py">energenie.py</a> how work with GPIO is implemented. <br><br><h5>  Auto-join to other chat rooms </h5><br>  An optional feature, but personally I didn‚Äôt have enough of it, for example, when you have this bot-butler in your messenger as a friend and you can create new chats and invite it there.  Without it will work, but then the bot will be tied to the chat, in which you launched it. <br><br>  How to implement auto-join - parsing stanzas of incoming XML messages, since  we will surely receive a message that such a MUC chat was created, if this user was invited there. <br><br>  In our case, we use the QuickBlox platform and a specific Q-municate application, where the invitation to a new group chat looks like this: <br><pre> <code class="xml hljs">RECV: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">message</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">to</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1265350-7232@chat.quickblox.com"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">from</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1234040-7232@chat.quickblox.com/098CA696-A60A-480D-B744-BE7DFC4FE6D3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1404538064.385079"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"chat"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span>Taras Filatov created new chat<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extraParams</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_id</span></span></span><span class="hljs-tag">&gt;</span></span>53b78c0c535c12798d005055<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_id</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">occupants_ids</span></span></span><span class="hljs-tag">&gt;</span></span>1234040,1258466,1265350<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">occupants_ids</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">date_sent</span></span></span><span class="hljs-tag">&gt;</span></span>1404538064<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">date_sent</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>Yanus Poluektovich, Sergey Fedunets<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xmpp_room_jid</span></span></span><span class="hljs-tag">&gt;</span></span>7232_53b78c0c535c12798d005055@muc.chat.quickblox.com<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xmpp_room_jid</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">notification_type</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">notification_type</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extraParams</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">message</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  We track the phrase ‚Äúcreated new chat‚Äù in XMPP stations, and if it occurs, then parsim from there xmpp_room_jid, this will be the id of the newly created room. <br>  Then we run the process with the same script. <br>  Keep in mind that for this to work, you need to make the script executable: <br><br><pre> <code class="bash hljs">chmod +x powerbot.py</code> </pre><br>  The implementation code is presented below: <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> msg[<span class="hljs-string"><span class="hljs-string">'mucnick'</span></span>] != self.nick <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-string"><span class="hljs-string">"Create new chat"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> msg[<span class="hljs-string"><span class="hljs-string">'body'</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bs4 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BeautifulSoup y = BeautifulSoup(str(msg)) roomToJoin = y.xmpp_room_jid.string <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"Got an invite to join room"</span></span>) botId = subprocess.Popen([selfPath + <span class="hljs-string"><span class="hljs-string">" -d -j "</span></span> + qbChatLogin + <span class="hljs-string"><span class="hljs-string">" -r "</span></span> + str(roomToJoin) + <span class="hljs-string"><span class="hljs-string">" -n "</span></span> + qbChatNick + <span class="hljs-string"><span class="hljs-string">" -p "</span></span> + qbUserPass], shell=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"spawned new bot ID="</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> botId self.send_message(mto=msg[<span class="hljs-string"><span class="hljs-string">'from'</span></span>].bare, mbody=<span class="hljs-string"><span class="hljs-string">"Thank you for your kind invitation, joining your new room now!"</span></span>, mtype=<span class="hljs-string"><span class="hljs-string">'groupchat'</span></span>)</code> </pre><br><br><h5>  Welcome + instructions </h5><br>  We define the code word, in this case ‚Äúpowerbot‚Äù, and issue in reply a greeting and a hint on how to use / communicate with our bot. <br>  The check ‚Äúif msg ['from']! = Self.nick‚Äù is needed so that the bot does not respond to messages from itself. <br><br><pre> <code class="python hljs"> <span class="hljs-comment"><span class="hljs-comment"># # Reply to help request (any message containing "powerbot" in it) # if msg['mucnick'] != self.nick and "powerbot" in msg['body']: reply_test_message = self.make_message(mto=msg['from'].bare, mbody="Powerbot is greeting you, %s! Usage: [powerbot] lamp [on|off] to control socket 1, [powerbot] all [on:off] to control all sockets. Example: 'lamp on' switched socket 1 on." % msg['mucnick'], mtype='groupchat') self.copy_dialog_id(msg, reply_test_message) reply_test_message.send() print "Sent help text: " + str(reply_test_message)</span></span></code> </pre><br><br><h5>  Turn on / off the lamp and other devices </h5><br>  We monitor the ‚Äúlamp on‚Äù command (turn on the lamp), if the command is received, then turn on the switch_on socket (lampSocket) and report on its implementation. <br><br><pre> <code class="python hljs"> <span class="hljs-comment"><span class="hljs-comment"># # Handle "lamp on" command # if msg['mucnick'] != self.nick and "lamp on" in msg['body']: switch_on(lampSocket) confirmation_message = self.make_message(mto=msg['from'].bare, mbody="Lamp has been switched on, %s." % msg['mucnick'], mtype='groupchat') self.copy_dialog_id(msg, confirmation_message) confirmation_message.send() print "Lamp switched on, sent confirmation: " + str(confirmation_message)</span></span></code> </pre><br>  ‚ÄúLamp off‚Äù, ‚Äúall on‚Äù and ‚Äúall off‚Äù are implemented in the same way (the latter are responsible for turning on or off all controllable outlets). <br><br><h5>  Start chat bot </h5><br>  From bash on raspberry we execute a simple command: <br><br><pre> <code class="bash hljs">sudo python powerbot.py -d -r &lt;  MUC &gt;</code> </pre><br>  Sudo need to access gpio.  If you used QuickBlox, then as the MUC of the room, simply copy the JID address from the Chat Dialogs label. <br><br>  As a result, the screen will display the authentication and XMPP status logs with the server: <br><br><img src="https://habrastorage.org/files/9af/47b/e3e/9af47be3e7fa49eb85a4987f8614a6c3.jpg"><br><br>  That's it, the bot is ready and waiting for your instructions in the chat room. <br><br>  By the way, you might have noticed that the reaction functions to commands are duplicated simultaneously in <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, msg)</span></span></span><span class="hljs-function">:</span></span></code> </pre><br>  and <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">muc_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, msg)</span></span></span><span class="hljs-function">:</span></span></code> </pre><br>  The first block processes private messages 1: 1, and the second one - group ones. <br>  That is, you can control the bot in private chat, although in my opinion it is less interesting. <br><br><h4>  We collect chat client for iOS (options: Android, Web) </h4><br>  As I wrote above, you can communicate with the bot through any Jabber / XMPP compatible chat client. <br>  We are not looking for easy ways, so we are building our application - a client to control the bot, and at the same time to communicate with family and friends. <br>  Your own messenger with a bot and group chats :-) <br><br>  However, as you will see, here we are also following a fast and lazy path and we take a ready-made open-source project of our own development, <br>  which is called q-municate. <br><br>  1. Draw a project for the corresponding platform from the game: <br>  iOS: <a href="https://bitbucket.org/quickblox/qmunicate-ios">bitbucket.org/quickblox/qmunicate-ios</a> <br>  Android: <a href="https://github.com/QuickBlox/q-municate-android">github.com/QuickBlox/q-municate-android</a> <br>  Web: <a href="https://github.com/QuickBlox/q-municate-web">github.com/QuickBlox/q-municate-web</a> <br><br>  2. Open the IDE. <br><br>  3. The rule is creditors - we change standard constants with application keys to QuickBlox copied from the admin panel.  In iOS, this changes in AppDelegate.m, in Android in Consts.java. <br><img src="https://habrastorage.org/files/119/324/b5c/119324b5c3e44b4d88ea9213a3f7952a.png"><br><br>  4. Compile, build on the device. <br>  Optionally customize the interface and stuff, <a href="http://quickblox.com/developers/Q-municate">here is a more detailed manual</a> . <br><br>  5. PROFIT !!! <br><br><h4>  Demonstration </h4><br>  Screenshots: <br><br><img src="https://habrastorage.org/files/561/2ef/f6a/5612eff6ad5a42a4ae77a50a70764a12.jpg"><br>  I named my Q-municate build proudly ‚ÄúQ-Power‚Äù <br><br><img src="https://habrastorage.org/files/757/c6c/ceb/757c6cceb01d44fabf5e727bdc926cc0.png"><br>  find a bot in friends or group chat <br><br><img src="https://habrastorage.org/files/a6f/960/f07/a6f960f07ceb4db8b1096ae58d327c2d.jpg"><br>  communicate with the bot <br><br><br>  Video lamp control via chat: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/fdiLDTecKdc%3Ffeature%3Doembed&amp;xid=17259,15700002,15700023,15700186,15700190,15700253&amp;usg=ALkJrhgSUTZvsLiAHDIOvh9Po56sFj_rNQ" frameborder="0" allowfullscreen=""></iframe><br><br>  Thank you for your attention, I hope it will come in handy, and even better if this ‚Äúproof of concept‚Äù encourages someone to realize the idea to the end, and the microwave suddenly talks to the toaster, and the wife will give commands to all of them through your homemade Siri :-) <br><br>  Successes! </div><p>Source: <a href="https://habr.com/ru/post/238907/">https://habr.com/ru/post/238907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238897/index.html">We test VoCore in hackspace - a micro computer with WiFi on Linux / OpenWrt</a></li>
<li><a href="../238899/index.html">Google continues to etch unwanted Android developers?</a></li>
<li><a href="../238901/index.html">Multicontext in core data</a></li>
<li><a href="../238903/index.html">Fix shellshock vulnerability for legacy systems</a></li>
<li><a href="../238905/index.html">The United States retains part of the nuclear warheads intended for the destruction of an asteroid threat to Earth</a></li>
<li><a href="../238911/index.html">FAQ about data center cooling: how to make it cheap, cheerful, reliable and fit into the dimensions of the site</a></li>
<li><a href="../238913/index.html">Trust the team, but verify</a></li>
<li><a href="../238915/index.html">Why is Windows 10, not 9. Explanation with a single line of code</a></li>
<li><a href="../238917/index.html">Positive Education: we will teach practical safety</a></li>
<li><a href="../238921/index.html">How to convince people in the network: seventeen little-known Jedi tricks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>