<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parse security in iOS application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Parse is the most beautiful BaaS, allowing you to quickly raise a full-fledged server infrastructure for a mobile application. Perhaps it is because o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parse security in iOS application</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/624/f47/176/624f471763b441a3b6db04a55edd9b69.png"><br><br>  <a href="http://parse.com/">Parse</a> is the most beautiful BaaS, allowing you to quickly raise a full-fledged server infrastructure for a mobile application.  Perhaps it is because of this simplicity that many developers forget about emerging security issues and emerging vulnerabilities. <br><a name="habracut"></a><br>  For those who are not familiar with the service, take a short excursion into what it is.  Parse provides the developer with services such as cloud storage, push notifications, writing your own API, collecting statistics, crash logs, and more.  In this study, we are interested in exactly the data warehouse, called Cloud Core. <br>  All data in Parse is stored in classes (in fact - tables), between the records of which you can make full connections. <br><br><img src="https://habrastorage.org/files/138/760/2cf/1387602cf37549bcb647ed855fe27379.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For each of the classes, client access rights are configured that affect the ability to search, add new entries, modify existing ones, and so on.  By default, all actions are allowed.  Of course, as usual, most developers, once setting up the tables they need, forget about setting up client permissions. <br><br><img src="https://habrastorage.org/files/f75/2ab/91e/f752ab91ecd04fe2863564f09b9348b4.png"><br><br>  Closely confronted with Parse on one of the work projects and fiddling with the ACL setting, I decided to play around with other people's applications.  I chose the object for research right at <a href="https://parse.com/customers">parse.com/customers</a> .  They became <a href="http://cubefreeapp.com/">Cubefree</a> - a search service for coworking sites. <br><br>  To connect to the Parse account in the iOS application, a combination of two keys is used - <i>Application ID</i> and <i>Client Key</i> .  To perform any actions on data in Cloud Core, the first thing you need to know this data.  With the help of the smart <a href="https://github.com/dmayer/idb">idb</a> utility, which automates many routine actions during pentesting, we will decipher the executable file of the application.  While the process is underway, we <i>‚Äôll</i> check <i>NSUserDefaults</i> , the likely place to store the keys of interest. <br><img src="https://habrastorage.org/files/7eb/ef7/fd6/7ebef7fd678047a39c680fb9f1b6bd42.png"><br>  In this case, everything is quite harmless - no confidential data.  Let's go back to the decoded binary and feed it to <a href="http://www.hopperapp.com/">Hopper disassembler</a> , which specializes in reverse engineering of applications written in Objective-C.  We‚Äôll start searching for keys with the <i>application: didFinishLaunchingWithOptions:</i> method in <i>AppDelegate</i> .  One of the great features of Hopper is the pseudo-code method representation, which significantly lowers the threshold for understanding decrypted code. <br><br><img src="https://habrastorage.org/files/52c/e91/634/52ce91634f90410283b96034f16c00db.png"><br><br>  As expected, the connection to the Parse account is happening here.  Using these keys, we will analyze the data structure of the application and access rights to them. <br><br>  The next step is to find the names of the Parse tables.  In fact, where to find them, it becomes clear from the same screenshot - immediately after connecting to the server, you should call the <i>registerSubclass</i> methods of several classes that inherit from the root <i>PFObject</i> .  Each of them must necessarily implement the <i>parseClassName</i> method, which gives us the name of the table on the server. <br><br><img src="https://habrastorage.org/files/d25/746/ee3/d25746ee3e5d4d67bc2fad4e536344ee.png"><br><br>  Let us study the structure of each of the classes thus obtained: <br><pre><code class="objectivec hljs">PFQuery *query = [PFQuery queryWithClassName:<span class="hljs-string"><span class="hljs-string">@"ParseClassName"</span></span>]; [query findObjectsInBackgroundWithBlock:^(<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *objects, <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error) { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"%@"</span></span>, objects); }];</code> </pre> <br>  However, knowledge of structure alone is not enough.  To understand how we can affect the operation of the application, you need to determine the access rights to all Parse classes.  This is done quite simply - we just execute requests to the server corresponding to various permissions and analyze their results.  To simplify these routine actions, I wrote a simple <a href="https://github.com/igrekde/ParseRevealer">Parse Revealer</a> utility that automatically determines access levels to all known classes. <br><img src="https://habrastorage.org/files/2ed/be6/05f/2edbe605f24c4dee9096b712a796cfc5.png"><br>  Based on our data, we can build a table: <br><table><tbody><tr><th>  Class name </th><th>  Data structure </th><th>  Access rights </th></tr><tr><td>  ChatRoom </td><td>  chatId (string) <br>  user1 (User) <br>  user2 (User) </td><td>  GET: False <br>  FIND: True <br>  UPDATE: True <br>  CREATE: True <br>  DELETE: False <br>  ADD FIELDS: True </td></tr><tr><td>  Checkin </td><td>  availableToShareTable (Bool) <br>  date (Date) <br>  invisible (Bool) <br>  statusCheckin (String) <br>  statusUser (String) <br>  user (User) <br>  workspace (Workspace) </td><td>  GET: True <br>  FIND: True <br>  UPDATE: True <br>  CREATE: True <br>  DELETE: True <br>  ADD FIELDS: True </td></tr><tr><td>  Chatmessage </td><td>  chatId (string) <br>  Message (String) <br>  sender (User) <br>  unread (Bool) </td><td>  GET: False <br>  FIND: True <br>  UPDATE: True <br>  CREATE: True <br>  DELETE: False <br>  ADD FIELDS: True </td></tr><tr><td>  Notification </td><td>  date (Date) <br>  sendUser (User) <br>  chekin (cheking) <br>  status (Bool) <br>  type (Number) <br>  accepted (Bool) </td><td>  GET: True <br>  FIND: True <br>  UPDATE: True <br>  CREATE: True <br>  DELETE: False <br>  ADD FIELDS: True </td></tr><tr><td>  Review </td><td>  date (Date) <br>  parkingStatus (Number) <br>  powerStatus (Number) <br>  soundStatus (Number) <br>  user (PFUser) <br>  wifiStatus (Number) <br>  workspace (Workspace) </td><td>  GET: True <br>  FIND: True <br>  UPDATE: False <br>  CREATE: True <br>  DELETE: False <br>  ADD FIELDS: True </td></tr><tr><td>  Workspace </td><td>  address (String) <br>  cc (string) <br>  city ‚Äã‚Äã(String) <br>  country (String) <br>  foursquareId (String) <br>  lat (string) <br>  lng (string) <br>  location (PFGeoPoint) <br>  name (String) <br>  postalCode (String) <br>  state (String) </td><td>  GET: True <br>  FIND: True <br>  UPDATE: True <br>  CREATE: True <br>  DELETE: False <br>  ADD FIELDS: True </td></tr></tbody></table><br>  As can be seen from the obtained access rights, the developers have implemented a certain security policy, but, all the same, insufficient.  We show what results can be achieved by playing with the <i>ChatMessage</i> class. <br><br>  The most obvious vulnerability - in any of the open chats, you can change both your own and other people's messages.  After executing this code, a nice greeting turns into a habrasuicid: <br><pre> <code class="objectivec hljs">PFQuery *query = [PFQuery queryWithClassName:<span class="hljs-string"><span class="hljs-string">@"ChatMessage"</span></span>]; [query whereKey:<span class="hljs-string"><span class="hljs-string">@"message"</span></span> equalTo:<span class="hljs-string"><span class="hljs-string">@", !"</span></span>]; [query findObjectsInBackgroundWithBlock:^(<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *objects, <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error) { PFObject *object = [objects firstObject]; object[<span class="hljs-string"><span class="hljs-string">@"message"</span></span>] = <span class="hljs-string"><span class="hljs-string">@",   !"</span></span>; [object saveInBackground]; }];</code> </pre><br><img src="https://habrastorage.org/files/541/42b/bc9/54142bbc9c4e4c76a37bbb9b554ca7d7.png"><br><br>  Similarly, you can add new messages, you just need to provide the new <i>PFObject with the</i> correct <i>chatId</i> .  But It is worth noting that <i>Delete</i> , set to <i>false</i> , will not allow us to delete any of the created objects. <br><br>  A much more serious vulnerability is incorrect mapping of data obtained from Parse.  If the newly created <i>ChatMessage</i> object <i>has</i> no <i>sender</i> field, the application crashes.  Thus, nothing prevents us from running through all the watches ever created, adding an invalid message to them - and the application will crash for all users.  This is already fraught with low ratings in the App Store, outflow of users and the failure of the project as a whole. <br>  Other classes have similar vulnerabilities - but they are already beyond the scope of the current study. <br><br>  As for security, everything is quite transparent here.  Only a few rules need to be followed: <br><ul><li>  Always adjust access levels for all created classes. </li><li>  For user-created data, use ACLs, allowing you to change them only to a specific circle of people. </li><li>  If the client needs to change only one of the properties (for example, the unread flag), then it is worth thinking about separating it into a separate table.  Thus, it will be possible to bypass the possibility of changing other parameters of the object. </li><li>  Do not rely on the fact that Parse will always give valid data - do not forget to embed the appropriate checks. </li><li>  Do not forget that, in theory, the <i>applicationId</i> and <i>clientKey</i> can be accessed by any attacker, and consider a security policy based on this knowledge. </li><li>  The previous rule does not mean that you need to completely forget about obfuscation of lines in the code :) </li><li>  In especially difficult cases, feel free to use the Cloud Code. </li></ul><br>  If you see the features of your applications in this study, you should not blame Parse - as I said before, this is an excellent service that minimizes the costs of creating the server part of the application.  And all considered vulnerabilities are solely the responsibility of the developers of the application. <br><br>  <b>Useful links:</b> <br><ul><li>  <a href="https://www.parse.com/docs">Parse Documentation</a> </li><li>  <a href="http://blog.parse.com/2014/06/30/parse-security-i-are-you-the-key-master">Series of mini articles "Parse Security"</a> </li><li>  <a href="https://github.com/igrekde/ParseRevealer">Parse revealer</a> </li><li>  <a href="https://www.mikeash.com/pyblog/friday-qa-2012-01-06-the-hopper-disassembler.html">The Hopper Disassembler by Mike Ash</a> </li></ul><br>  <b>Other materials dedicated to the security of iOS applications:</b> <br><ul><li>  <a href="http://habrahabr.ru/post/244143/">Bypassing the protection of the iOS client Dropbox</a> </li><li>  <a href="http://habrahabr.ru/post/222487/">Database Security in iOS</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/247541/">https://habr.com/ru/post/247541/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247521/index.html">Release Rust 1.0 Alpha</a></li>
<li><a href="../247527/index.html">Padding Oracle Attack or why cryptography scares</a></li>
<li><a href="../247533/index.html">Programming tutorial for kids</a></li>
<li><a href="../247535/index.html">We do tetris under FPGA</a></li>
<li><a href="../247539/index.html">ROS Speech Recognition with Google Speech API</a></li>
<li><a href="../247543/index.html">Impress Application Server in simple terms</a></li>
<li><a href="../247545/index.html">Introduction to the development of web-applications on PSGI / Plack</a></li>
<li><a href="../247547/index.html">Creating an environment for web development based on Docker</a></li>
<li><a href="../247551/index.html">Five popular myths about C ++, part 2</a></li>
<li><a href="../247553/index.html">network-enabled single-mode on FreeBSD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>