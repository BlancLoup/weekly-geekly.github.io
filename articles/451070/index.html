<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Artificial intelligence on the example of a simple game. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- This time the game "Snake" is chosen. 
- A library for the neural network in the Go language has been created. 
- Found the principle of learning, d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Artificial intelligence on the example of a simple game. Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/hw/lo/8l/hwlo8lzjxf08eebmebxewu9jgji.png"><br><br><ul><li>  This time the game "Snake" is chosen. </li><li>  A library for the neural network in the Go language has been created. </li><li>  Found the principle of learning, dependent on the "depth" of memory. </li><li>  Written server for games between developers. </li></ul><br><a name="habracut"></a><br><h2>  The essence of the game </h2><br>  Perhaps many people remember the game "Snake", which was a standard application on Nokia phones.  Its essence is as follows: a snake moves in the field, which decreases if it does not find food, or increases if it finds it.  If a snake bumps into an obstacle, then it dies. <br><br>  I slightly changed the rules: the snake does not die if it cuts, but simply stops, continuing to decrease.  In addition, the snake can be divided in half.  If a snake has only one cell of the body left and it did not find food in 10 moves, then it dies, turning into food. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will train the bot that controls the snake.  If the snake splits, the bot will get another snake in control, which in turn can split. <br><br>  The experiment with the snakes of cyber-biologist Mikhail Tsarkov was taken as a basis. <br><br><h2>  Neural network </h2><br>  As part of the task, a library for the neural network was written in the Go language.  Studying the work of the neural network, I use the video diary <a href="https://habr.com/ru/users/foo52ru/" class="user_link">foo52ru</a> and the book of Tariq Rashid - Create a neural network. <br><br>  The <code>CreateLayer(L []int)</code> function creates a neural network with the required number of layers and their size.  On each layer, except the last one, a displacement neuron is added.  On the first layer we submit data, and from the last layer we get the result. <br><br>  Example: <pre> <code class="go hljs">CreateLayer([]<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>{<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">57</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>})</code> </pre> <br>  Here we created a neural network with nine inputs.  Two hidden layers of 57 and 3 neurons and one neuron to get the result.  Offset neurons are automatically added to the ones we set. <br><br>  The library allows you to: <br><br><ul><li>  Submit data to the network input. </li><li>  Get the result, referring to the last layer. </li><li>  Ask the right answers and conduct training on adjusting the link weights. </li></ul><br>  The initial link weights are given by random values ‚Äã‚Äãclose to zero.  To activate, we used the logistic function. <br><br><h2>  Bot training </h2><br>  The bot receives at the entrance a field in the size of 9x9 cells, in the middle of which there is a snake's head.  Accordingly, our neural network will have 81 inputs.  The order of the cells supplied to the input does not matter.  The network, when learning, will ‚Äúfigure it out for itself‚Äù where what is located. <br><br>  To indicate obstacles and other snakes, I used the values ‚Äã‚Äãfrom -1 to 0 (not inclusive).  Empty cells were designated as 0.01, and food was 0.99. <br><br>  At the output of the neural network, 5 neurons were used for actions: <br><ol><li>  move left on the x-axis; </li><li>  to the right; </li><li>  up the y axis; </li><li>  way down; </li><li>  share in half. </li></ol><br>  The movement of the bot determined the neuron that is most important at the output. <br><br><h3>  Step 0. Randomizer </h3><br>  The bot randomizer was first created.  So I call a bot that walks randomly.  It is necessary to verify the effectiveness of the neural network.  With proper training, the neural network should easily beat it. <br><br><h3>  Step 1. Learning without using memory </h3><br>  After each move, we adjust the weights of connections for the output neuron that has indicated the highest value.  Other output neurons do not touch. <br><br>  For learning the following values ‚Äã‚Äãwere given: <br><ul><li>  Found food: 0.99 </li><li>  made movement in any direction: 0.5 </li><li>  lost a cage of a body without finding food (10 moves are given for this): 0.2 </li><li>  standing still (hit an obstacle or stuck): 0.1 </li><li>  standing still with one cell of the body: 0.01 </li></ul><br>  Having passed such training, bots began to quickly beat the randomizer, and I set the task: to create bots that would beat these. <br><br><h4>  A / b testing </h4><br>  To perform this task, a program was created that divides the snakes into two parts, depending on the configuration of the neural network.  On the field produced 20 snakes of each configuration. <br><br>  All snakes that are under the control of one bot, had the same neural network.  The more snakes there were in his management and the more often they encountered different tasks, the faster they were trained.  If, for example, one snake has learned to avoid dead ends or to share in half, hitting a dead end, then automatically all the snakes of this bot acquired these skills. <br><br>  By changing the configuration of the neural network, you can get good results, but this is not enough.  To further improve the algorithm, I decided to use memory for several turns. <br><br><h3>  Step 2. Learning with memory </h3><br>  For each bot, I created a memory for 8 turns.  The state of the field and the move suggested by the bot were recorded in memory.  After that, I adjusted the weights for all eight states that preceded the move.  For this, I used a single correction factor, independent of the depth of the stroke.  Thus, each move led to the adjustment of weights not once, but eight. <br><br>  As expected, the memory bots quickly began to beat the bots that were trained without using memory. <br><br><h3>  Step 3. Reducing the correction factor depending on the depth of memory </h3><br>  Then I tried to reduce the correction factor, depending on the depth of the memory.  For the last move made, the largest scale adjustment factor was established.  In the course that preceded it, the correction factor decreased and so on throughout the memory. <br><img src="https://habrastorage.org/webt/e6/0f/cb/e60fcbmlddlafl3eocr4dxmxx6a.png"><br>  The linear decrease in the coefficient of adjustment depending on the depth of the memory led to the fact that new bots began to beat those who used a single coefficient. <br><br>  Next, I tried to use a logarithmic reduction of the correction factor.  The coefficient decreased twice, depending on the depth of memory for each turn.  Thus, the moves that were made ‚Äúlong ago‚Äù had a much smaller impact on learning than the ‚Äúfresh‚Äù moves. <br><br>  Bots with a logarithmic decrease in the correction factor began to beat linearly dependent bots. <br><br><h2>  Server for bots </h2><br>  As it turned out, improving the level of "boostering" bots can be infinite.  And I decided to create a server where developers could compete with each other (regardless of programming language) in writing an effective algorithm for Snakes. <br><br><h3>  Protocol </h3><br>  For authorization, you need to send a GET request to the ‚Äúgame‚Äù directory and specify the user name, for example: <br><pre> <code class="xml hljs">.../game/?user=masterdak</code> </pre> <br>  Instead of "..." you need to specify the address of the site and the port where the server is deployed. <br><br>  Next, the server will issue a response in JSON format with the session: <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"answer"</span></span>:<span class="hljs-string"><span class="hljs-string">"Hellow, masterdak!"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"session"</span></span>:<span class="hljs-string"><span class="hljs-string">"f4f559d1d2ed97e0616023fb4a84f984"</span></span>}</code> </pre> <br>  After that, you can request the map and the coordinates of the snake on the field, adding to the request session: <br><pre> <code class="xml hljs">.../game/?user=masterdak&amp;session=f4f559d1d2ed97e0616023fb4a84f984</code> </pre> <br>  The server will produce something like this: <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"answer"</span></span>: <span class="hljs-string"><span class="hljs-string">"Sent game data."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"area"</span></span>: [ [<span class="hljs-string"><span class="hljs-string">"...  ..."</span></span>] ], <span class="hljs-attr"><span class="hljs-attr">"snakes"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"num"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"body"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-attr"><span class="hljs-attr">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-attr"><span class="hljs-attr">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-attr"><span class="hljs-attr">"y"</span></span>: <span class="hljs-number"><span class="hljs-number">24</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"energe"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dead"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } ] } }</code> </pre><br>  The <b>area</b> field will indicate the state of the playing field with the following values: <br><pre> <code class="go hljs"><span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">//  -1 // -2 // 2 //  1 // </span></span></code> </pre><br>  This is followed by an array of snakes that are in your control. <br><br>  The body of the snake is in the <b>body</b> array.  As you can see, the whole body of a snake (including the head - the first cell) at the beginning is in the same position ‚Äúx‚Äù: 19, ‚Äúy‚Äù: 24. This is due to the fact that at the beginning of the game, the snake climbs out of the hole, which is determined by a single cell on the field .  Further, the coordinates of the body and head will be different. <br><br>  The following structures (Go example) define all server response options: <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> respData <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Answer <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Session <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Data <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Area [][]<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Snakes []<span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Num <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Body []Cell Energe <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Dead <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> } } } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Cell <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { X <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Y <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> }</code> </pre><br>  Next, you need to send the move that the snake makes by adding <b>move</b> to the GET request, for example: <br><pre> <code class="xml hljs">...&amp;move=u</code> </pre> <br>  <b>u</b> - means command up; <br>  <b>d</b> - down; <br>  <b>l</b> - to the left; <br>  <b>r</b> - right; <br>  <b>/</b> - division in half. <br><br>  The command for several snakes (for example, for seven) will look like this: <br><pre> <code class="xml hljs">...&amp;move=ud/urld</code> </pre> <br>  One character - one team.  The answer should contain a command for all snakes under your control.  Otherwise, some snakes may not receive the command and will continue the old action. <br><br>  The field is updated with an interval of 150 ms.  If no command is received within 60 seconds, the server closes the connection. <br><br><h2>  Links </h2><br>  To avoid habraeffekt, those who will be interested to see, send me a message.  In response, I will send the ip address of my server.  Or you can deploy your server using the source code of the program. <br><br>  I am not a specialist in programming or in neural networks.  Therefore, I can make gross mistakes.  I spread the code "as is".  I would be glad if more experienced developers show up on the mistakes made. <br><br><ol><li>  <a href="https://github.com/masterdakgit/neuronetxo">Library for the neural network with the game "Tic-tac-toe"</a> </li><li>  <a href="https://github.com/masterdakgit/Snake-Master">Snake Master - Server</a> </li><li>  <a href="https://github.com/masterdakgit/SnakeMasterBot">Snake Master - Bot</a> </li><li>  <a href="https://github.com/masterdakgit/SnakeWorld2">SnakeWorld2</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/451070/">https://habr.com/ru/post/451070/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45105/index.html">Russian group order for Neo FreeRunners arrived</a></li>
<li><a href="../451056/index.html">Introduction to MS Dynamics CRM</a></li>
<li><a href="../451058/index.html">Corporate workshop</a></li>
<li><a href="../451066/index.html">We disassemble the ending of "Alien"</a></li>
<li><a href="../45107/index.html">Chapter 3. Animate the jQuery page</a></li>
<li><a href="../451072/index.html">In Yandex Direct appeared adjustment rates for weather</a></li>
<li><a href="../451074/index.html">Python PIL from easy to hard</a></li>
<li><a href="../45108/index.html">The story of how life was born on the gift of the gift, or the significance of the advanced communities of Runet and their inhabitants</a></li>
<li><a href="../4511/index.html">Google launches office suite</a></li>
<li><a href="../45110/index.html">Spy passions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>