<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>More about Python descriptors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago on Habr√© there was already a translation of the article by Raymond Hettinger Guide to descriptors . In this article I will try to cons...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>More about Python descriptors</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago on Habr√© there was already a translation of the article by Raymond Hettinger <a href="http://habrahabr.ru/blogs/python/122082/">Guide to descriptors</a> .  In this article I will try to consider the questions that have arisen after reading me.  There will be some code examples, actually questions and answers to them.  To understand what this is about, you need to know what descriptors are and why they are. <br><br><a name="habracut"></a><h4>  When are handles called? </h4><br>  Consider the following code: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&gt;&gt;&gt;</font> class M(type): <br> ...  def __new__(cls, name, bases, dct): <br> ...      dct['test'] = lambda self, x: x*2 <br> ...      return type.__new__(cls, name, bases, dct) <br> ... <br> <font color="#0000ff">&gt;&gt;&gt;</font> class A(object): <br> ...  def __init__(self): <br> ...      self.__dict__['test2'] = lambda self, x: x*4 <br> ...  __metaclass__ = M <br> ... <br> <font color="#0000ff">&gt;&gt;&gt;</font> A().test(2) <br> 4 <br> <font color="#0000ff">&gt;&gt;&gt;</font> A().test2(2) <br> Traceback (most recent call last): <br> File " <font color="#0000ff">&lt;</font> <font color="#800000">stdin</font> <font color="#0000ff">&gt;</font> ", line 1, in <font color="#0000ff">&lt;</font> <font color="#800000">module</font> <font color="#0000ff">&gt;</font> <br> TypeError: <font color="#0000ff">&lt;</font> <font color="#800000">lambda</font> <font color="#0000ff">&gt;</font> () takes exactly 2 arguments (1 given)</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  What's wrong?  It seems to add the function in the same way, using the object dictionary.  Why is the handle for the function "test2" not called?  The point is that the function ‚Äútest‚Äù is defined for the class dictionary, and the function ‚Äútest2‚Äù is defined for the object dictionary: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&gt;&gt;&gt;</font> 'test' in A.__dict__ <br> True <br> <font color="#0000ff">&gt;&gt;&gt;</font> 'test2' in A.__dict__ <br> False <br> <font color="#0000ff">&gt;&gt;&gt;</font> 'test' in A().__dict__ <br> False <br> <font color="#0000ff">&gt;&gt;&gt;</font> 'test2' in A().__dict__ <br> True</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Hence the first answer: the function "__get__" is called only for descriptors that are properties of a class, and not properties of objects of this class. <br><br><h4>  What is a handle? </h4><br>  The previous answer immediately raises the question - what does ‚Äúonly for descriptors‚Äù mean?  I did not create any descriptors, I created only a function! <br><br>  The answer is expected - functions in Python are descriptors (to be more precise, data descriptors are not): <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&gt;&gt;&gt;</font> def foo(x): <br> ...  return x * 2 <br> ... <br> <font color="#0000ff">&gt;&gt;&gt;</font> '__get__' in dir(foo) <br> True</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><h4>  Bound / Unbound methods </h4><br>  And finally, the most delicious.  <b>Task:</b> <br><br>  There is an object of a certain class to which you need to dynamically add a method to which, of course, the ‚Äúself‚Äù parameter must be passed.  It is not possible to add this method to the class dictionary (we do not want to affect other objects). <br><br>  To decide "in the forehead" does not go: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&gt;&gt;&gt;</font> class A(object): <br> ...  def __init__(self): <br> ...      self.x = 3 <br> ... <br> <font color="#0000ff">&gt;&gt;&gt;</font> def add_x(self, add): <br> ...  self.x += add <br> ...  print 'Modified value: %s' % (self.x,) <br> ... <br> <font color="#0000ff">&gt;&gt;&gt;</font> a = A() <br> <font color="#0000ff">&gt;&gt;&gt;</font> a.add_x = add_x <br> <font color="#0000ff">&gt;&gt;&gt;</font> ax <br> 3 <br> <font color="#0000ff">&gt;&gt;&gt;</font> a.add_x(3) <br> Traceback (most recent call last): <br> File " <font color="#0000ff">&lt;</font> <font color="#800000">stdin</font> <font color="#0000ff">&gt;</font> ", line 1, in <font color="#0000ff">&lt;</font> <font color="#800000">module</font> <font color="#0000ff">&gt;</font> <br> TypeError: add_x() takes exactly 2 arguments (1 given)</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  We get the expected error, which confirms the first answer - when accessing the property descriptor of the object, __get__ is not used.  What to do? <br><br>  Let's play a little with the "__get__" method of the function we just created: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&gt;&gt;&gt;</font> add_x.__get__ <br> <font color="#0000ff">&lt;</font> <font color="#800000">method-wrapper</font> <font color="#0000ff">'__get__'</font> <font color="#ff0000">of</font> <font color="#ff0000">function</font> <font color="#ff0000">object</font> <font color="#ff0000">at</font> <font color="#ff0000">0x800f2caa0</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&gt;&gt;&gt;</font> add_x.__get__(a) <br> <font color="#0000ff">&lt;</font> <font color="#800000">bound</font> <font color="#ff0000">method</font> ?. <font color="#ff0000">add_x</font> <font color="#ff0000">of</font> &amp;# <font color="#ff0000">60</font> ; <font color="#ff0000">__main__</font> . <font color="#ff0000">A</font> <font color="#ff0000">object</font> <font color="#ff0000">at</font> <font color="#ff0000">0x800f2dc50</font> <font color="#0000ff">&gt;&gt;</font> <br> <font color="#0000ff">&gt;&gt;&gt;</font> add_x.__get__(a, A) <br> <font color="#0000ff">&lt;</font> <font color="#800000">bound</font> <font color="#ff0000">method</font> <font color="#ff0000">A</font> . <font color="#ff0000">add_x</font> <font color="#ff0000">of</font> &amp;# <font color="#ff0000">60</font> ; <font color="#ff0000">__main__</font> . <font color="#ff0000">A</font> <font color="#ff0000">object</font> <font color="#ff0000">at</font> <font color="#ff0000">0x800f2dc50</font> <font color="#0000ff">&gt;&gt;</font> <br> <font color="#0000ff">&gt;&gt;&gt;</font> add_x.__get__(None, A) <br> <font color="#0000ff">&lt;</font> <font color="#800000">unbound</font> <font color="#ff0000">method</font> <font color="#ff0000">A</font> . <font color="#ff0000">add_x</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Oh, that seems to be what we need!  In the penultimate line, we received the ‚Äúbound‚Äù method - that would be the way the ‚ÄúA (). Add_x‚Äù would look if the ‚Äúadd_x‚Äù method were defined in the ‚ÄúA‚Äù class.  And in the last line we see the ‚Äúexpected‚Äù result of the ‚ÄúA.add_x‚Äù call.  Now we know how to add a method to an object: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&gt;&gt;&gt;</font> a.add_x = add_x.__get__(a, A) <br> <font color="#0000ff">&gt;&gt;&gt;</font> a.add_x(3) <br> Modified value: 6</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Bingo! <br>  And so, it is the "__get__" method for descriptor functions that creates the "bound / unbound" methods of classes and objects.  And there is no magic here :) <br><br><h4>  Literature </h4><br>  What else to read?  In fact - a bit.  There are several chapters about descriptors in the Python Data Model ( <a href="http://docs.python.org/reference/datamodel.html">implementing-descriptors</a> ), and you can again recall a really good article by Hettinger ( <a href="http://users.rcn.com/python/download/Descriptor.htm">original</a> ). <br><br>  PS Russian is not a native language, I ask for comments in a personal. </div><p>Source: <a href="https://habr.com/ru/post/123216/">https://habr.com/ru/post/123216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123209/index.html">Court and EMS</a></li>
<li><a href="../123210/index.html">Opera Extension: Radio</a></li>
<li><a href="../123213/index.html">Ricoh bought Pentax</a></li>
<li><a href="../123214/index.html">Inviter: how to remove topics with 1500+ comments about invites</a></li>
<li><a href="../123215/index.html">Automation through integration. Promotional version. UPD</a></li>
<li><a href="../123217/index.html">Competition from iLab: prize - Playbook!</a></li>
<li><a href="../123219/index.html">One-two-three-four-five, I am going to present</a></li>
<li><a href="../123220/index.html">The play "Developing a multiplayer online game." Part 1: Architecture</a></li>
<li><a href="../123221/index.html">Solaris Container (zone). Creation and administration. Part 1</a></li>
<li><a href="../123222/index.html">My experience with AOP and PostSharp</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>