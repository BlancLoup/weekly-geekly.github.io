<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Arduino Ethernet Thermometer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A lot has been said about Arduino digital thermometers. All of them either connected to a computer, or displayed the temperature immediately on the di...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Arduino Ethernet Thermometer</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/b1/52/b152614034e25b53f44f22a52f0277e9.jpg" alt="Arduino"><br><br>  A lot has been said about Arduino digital thermometers.  All of them either connected to a computer, or displayed the temperature immediately on the display. <br>  But I needed a street thermometer, which is autonomous and sends data to the site.  So let's get started. <br><a name="habracut"></a><br><h5>  What we need: </h5><br><ul><li>  Arduino Duemilanove (Freeduino 2009) </li><li>  Ethernet Shield v2 </li><li>  digital temperature sensor - DS18B20 </li><li>  case fan (120 mm) </li><li>  can of water emulsion or PVA glue (2 liters) </li><li>  Light-emitting diode </li><li>  twisted pair </li></ul><br><br><h5>  Tasks </h5><br>  Interrogate the temperature sensor on the <a href="http://ru.wikipedia.org/wiki/1-Wire" title="Technology description">1-Wire</a> bus and send the results every 3 seconds to the Web server where they will be stored. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  The algorithm of the device: </h5><br><ol><li>  assign our Ethernet Shield `s MAC address and ip-address </li><li>  we initialize connection with the server on port 80 </li><li>  get data from a digital temperature sensor, on a 1-wire bus </li><li>  form GET request </li><li>  send GET request </li><li>  break the connection </li></ol><br><br><h5>  Sketch source code: </h5><br>  Comments on the code should clarify. <br><br><blockquote><code><font color="black">include &lt;Ethernet.h&gt; <br> <font color="#008000">//         Arduino.</font> <br> <font color="#008000">//   .</font> <br> include &lt;DallasTemperature.h&gt; <br> <br> <font color="#008000">// MAC-  </font> <br> <font color="#0000ff">byte</font> mac[] = { 0x00, 0x3A, 0xF1, 0x19, 0x69, 0xFC }; <br> <font color="#008000">// ip- </font> <br> <font color="#0000ff">byte</font> ip[] = { 192, 168, 1, 156 }; <br> <font color="#008000">// ip-  </font> <br> <font color="#0000ff">byte</font> server[] = { 79, 140, 28, 20 }; <font color="#008000">//   </font> <br> <font color="#0000ff">char</font> temp[6]; <br> <font color="#0000ff">byte</font> isdata=0; <br> <br> Client client(server, 80); <font color="#008000">// 80-.</font> <br> DallasTemperature tempSensor; <br> <br> <font color="#0000ff">void</font> setup() <br> { <br> Ethernet.begin(mac, ip); <font color="#008000">//  Ethernet Shield</font> <br> tempSensor.begin(7); <font color="#008000">//    7- </font> <br> Serial.begin(9600); <font color="#008000">//    9600 (  )</font> <br> } <br> <br> <font color="#0000ff">void</font> loop() <br> { <br> delay(3000); <font color="#008000">//   3 .</font> <br> <font color="#008000">// </font> <br> <font color="#0000ff">if</font> (client.connect()) { <br> Serial.println( <font color="#A31515">"connecting..."</font> ); <font color="#008000">// Serial.println  .   ,   ,    ,   .</font> <br> <font color="#008000">//   </font> <br> <font color="#0000ff">switch</font> (tempSensor.isValid()) <br> { <br> <font color="#0000ff">case</font> 1: <br> Serial.println( <font color="#A31515">"Invalid CRC"</font> ); <font color="#008000">//   </font> <br> tempSensor.reset(); <font color="#008000">//  </font> <br> <font color="#0000ff">return</font> ; <br> <font color="#0000ff">case</font> 2: <br> Serial.println( <font color="#A31515">"Invalid device"</font> ); <font color="#008000">// - ""  :)</font> <br> tempSensor.reset(); <font color="#008000">//  </font> <br> <font color="#0000ff">return</font> ; <br> } <br> <br> Serial.println( <font color="#A31515">"connected"</font> ); <br> <font color="#0000ff">char</font> buf[80]; <br> <font color="#0000ff">float</font> f=tempSensor.getTemperature(); <font color="#008000">//  </font> <br> <br> Serial.println(tempSensor.getTemperature()); <br> <br> <font color="#008000">//        . - Arduino     float.</font> <br> <font color="#008000">//    . ,       </font> <br> <font color="#008000">//      Arduino.        .</font> <br> <font color="#0000ff">int</font> temp1 = (f - ( <font color="#0000ff">int</font> )f) * 100; <font color="#008000">//   </font> <br> <font color="#008000">//  GET .  code   ,        .</font> <br> <font color="#008000">//    Web-.</font> <br> sprintf(buf, <font color="#A31515">"GET /class/backend/meteo.php?temp=%0d.%d&amp;code=123456 HTTP/1.0"</font> , ( <font color="#0000ff">int</font> )f, abs(temp1)); <br> <br> Serial.println(buf); <br> client.println(buf); <font color="#008000">//  GET </font> <br> client.println( <font color="#A31515">"Host: opck.info"</font> ); <font color="#008000">// ,   host   ip  .</font> <br> client.println(); <br> <br> } <font color="#0000ff">else</font> { <br> Serial.println( <font color="#A31515">"connection failed"</font> ); <br> } <br> <br> <font color="#0000ff">while</font> (client.available()) { <br> isdata=1; <br> <font color="#0000ff">char</font> c = client.read(); <font color="#008000">// ,    Web-</font> <br> Serial.print(c); <br> <br> } <br> <br> <font color="#0000ff">if</font> (!client.connected()) { <br> isdata=0; <br> Serial.println(); <br> Serial.println( <font color="#A31515">"disconnecting."</font> ); <br> client.stop(); <font color="#008000">//  </font> <br> } <br> }</font> <br></code> </blockquote><br><br><h5>  Build device: </h5><br><ol><li>  the first "foot" of the sensor we catch on the "minus" GND </li><li>  second leg (DQ) on the 7th pin </li><li>  third for a plus </li><li>  The second and third need to be connected by a resistor of ~ 4.7 K. <i>But I replaced the resistor with a LED and got a sensor bus access indicator (ATTENTION! Nothing will work without a resistor or LED. Do not forget!)</i> </li></ol><br><br>  In theory, that's all.  Should work. <br>  It works, but the combat conditions showed that when the sunlight falls on the sensor, it can heat up and show the temperature much higher than the real one.  That's right - he will show the temperature in the sun.  And we need air temperature. <br><br>  The first time for this was assembled body from under the can of coffee, wrapped in foil.  But it did not help. <br><br>  Studying photographs of real weather stations helped find a solution.  The body for the sensor must be larger, and also have active ventilation for such cases. <br><br><h5>  Making the case for the sensor </h5><br>  Bank of water-based paint turned out to be suitable in size (the same can be from PVA glue, 2-3 liters in volume).  At the bottom of the banks make a hole under the fan.  And attach it to the bank.  In the center of the can, we place a pad under the sensors, with a diameter slightly smaller than the can itself, so that air can circulate. <br>  <strong>A few photos:</strong> <br><br><img src="http://img.opck.info/pic/2010/12/c_500_6d6968ac.jpg" alt="Water emulsion can"><br><br>  <i>Water emulsion can</i> <br><img src="http://img.opck.info/pic/2010/12/c_500_e197c198.jpg" alt="Details and the bank with the lead"><br>  <i>Details and the bank with the lead</i> <br><br><img src="http://img.opck.info/pic/2010/12/c_500_ebce26b4.jpg" alt="Installing the sensor in the housing"><br>  <i>Installing the sensor in the housing</i> <br><br><img src="http://img.opck.info/pic/2010/12/c_500_e6250618.jpg" alt="Sensor in the housing, top view"><br>  <i>Sensor in the housing, top view</i> <br><br>  As you remember, I replaced the resistor with an LED, so we also make a hole for it so that the operation of the device is always visible. <br><br> <a href="http://pic.opck.info/view/4984"><img src="http://img.opck.info/pic/2010/12/c_500_2c547280.jpg" alt="Corps, side view"></a> <br>  <i>Corps, side view</i> <br><br>  We do not need a lid from the can; instead, we need a canopy, such that air is allowed to pass and atmospheric precipitations do not fall inside (the sensor will be located on the street). <br><br>  I made an Arduino case from a plastic box from an Explay C360 mp3 player. <br><br> <a href="http://pic.opck.info/view/4985"><img src="http://img.opck.info/pic/2010/12/c_500_18c202b6.jpg" alt="Arduino"></a> <br>  <i>Arduino</i> <br><br><h5>  Backend receiving data: </h5><br>  On the server side the script is running, which is accessed by the thermometer.  The script verifies the correctness of the secret code so that the testimony cannot be changed. <br>  And then adds a new entry to the MySql table.  Then this data can be displayed as you like.  At the same time, every minute the data for the past minute is averaged and added to another table. <br>  <strong>It is necessary in order to:</strong> <br>  1. it was easier to make samples in the database (isn‚Äôt it more convenient to specify a specific minute and get the result) <br>  2. samples were faster (for the year ~ 500,000 records instead of 10,000,000) <br><br>  During the long-term operation of the sensor, a problem was discovered, sometimes it spontaneously (once every 3-4 hours) gives a random value.  Therefore, I added a check for a temperature change of more than 1 degree for 15 seconds.  Such values ‚Äã‚Äãare ignored. <br><br><h5>  What came of it all: </h5><br>  On my website I posted a page with a thermometer and added a temperature chart for the last 24 hours. <br>  You can see here: <a href="http://opck.info/weather/">Ethernet thermometer</a> . <br><br><h5>  Disadvantages: </h5><br>  The accuracy of the sensor is 0.5 * C, which is not enough for me.  But there is a way to improve its characteristics.  It will take one more or more sensors (preferably from different batches).  We obtain data from all sensors and count the arithmetic average.  So you can achieve accuracy to hundredths of a degree. <br><br><h5>  Future plans: </h5><br><ul><li>  humidity sensor </li><li>  pressure meter </li><li>  wind speed sensor </li><li>  light sensor </li><li>  put a few of these in the city and make your own weather forecasts </li><li>  power Arduino on Power over Ethernet </li><li>  automate the switching on and rotational speed of the fan depending on the lighting </li><li>  remote control </li><li>  data reset in case of lack of communication (for me it is critical) </li></ul><br><br><h5>  Known to me disadvantages: </h5><br>  - high price - 2180 rubles.  (Freeduino 2009 (800 p.) + Ethernet Shield v2 (1300 p.) + 1 sensor (80 p.)) <br>  - if the fan is turned on too quickly, then he himself introduces an error in the temperature, blowing the sensor.  It should not blow, but only push the air. <br><br><h5>  Related Links: </h5><br>  <a href="http://habrahabr.ru/blogs/arduino/">Blog Arduino on Habr√©</a> <br>  <a href="http://opck.info/weather/">Online thermometer</a> <br>  <a href="http://datasheets.maxim-ic.com/en/ds/DS18B20.pdf">DS18B20 Datasheet</a> <br><br>  PS: the article entirely belongs to the <a href="https://geektimes.ru/users/liderman/" class="user_link">liderman</a> - all questions to him </div><p>Source: <a href="https://habr.com/ru/post/110610/">https://habr.com/ru/post/110610/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../110602/index.html">Firefox 4 Beta 3 for Android is released</a></li>
<li><a href="../110603/index.html">Streaming JSON-parser YAJL</a></li>
<li><a href="../110604/index.html">Promotional design: accent errors</a></li>
<li><a href="../110605/index.html">Dynamic forms without using JavaScript in a couple of minutes</a></li>
<li><a href="../110609/index.html">The world's largest Android-based phone - the 42-inch Nexus S</a></li>
<li><a href="../110611/index.html">I blinded him from what was</a></li>
<li><a href="../110612/index.html">Xmas Time: nice girl draws time</a></li>
<li><a href="../110614/index.html">60 million tabs on good deeds</a></li>
<li><a href="../110616/index.html">Linux is under load. High performance shaper</a></li>
<li><a href="../110617/index.html">We use Javascript engine from IE9 without IE9</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>