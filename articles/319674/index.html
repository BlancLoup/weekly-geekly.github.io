<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We form images from the text in PhantomJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good evening, Habrovchane! New Year's holidays died down and everyone slowly enters the working rhythm after the weekend, which means that it's time t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We form images from the text in PhantomJS</h1><div class="post__text post__text-html js-mediator-article"><p>  Good evening, Habrovchane!  New Year's holidays died down and everyone slowly enters the working rhythm after the weekend, which means that it's time to describe your New Year's fun. </p><br><p>  If you are interested in learning how to generate images from simple pictures using PhantomJS and a little magic, then welcome under the cat! </p><a name="habracut"></a><br><h3 id="nemnogo-predystorii">  A bit of background </h3><br><p>  This new year my friends and I decided to spend an unusual, add some interactive, which would not depend on anyone.  Since the majority in my social circle are somehow connected with computer games, it was decided by me and my friend (hereinafter Nikita) to come up with a list of New Year's achievements (or achivok).  The list was compiled within a few days and it was decided to somehow arrange and issue them so that the achievements would not be forgotten five minutes after they were received.  For the result, they decided to print, stick on watercolor paper, make two holes in the upper right and left corners and hang cards with eyelets on the neck.  Having completely understood the technical process, Nikita drew a simple design that would be perfectly printed on a black-and-white printer, and we started to fill in the achiv. </p><br><p>  I immediately decided that I didn‚Äôt want to add text to the PSD file more than fifty times more than any other, and like any adequate programmer, I spent a little more than two hours to automate the hourly task. </p><br><p>  <strong>Example of achivka design:</strong> </p><br><p><img src="http://ipic.su/img/img7/fs/peisatel.1484261116.png" alt="image"></p><br><h3 id="realizaciya">  Implementation </h3><br><p>  The technology pool was selected instantly.  Node.js for generating text and html pages, PhantomJS for drawing and saving. </p><br><h4 id="parsim-fayl">  Parse file </h4><br><p> The format for specifying the progress was set as follows: <br>  <code> --  -- </code> (Quote is optional) <br>  It is necessary to translate a file entirely consisting of such strings into a JS object. </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">contents</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resolve(contents.toString().split(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>).filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> e).map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> contents = e.split(<span class="hljs-string"><span class="hljs-string">' -- '</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   const achieve = {}; const achieveName = capitalizeFirstLetter(contents[0].trim()); let quote = capitalizeFirstLetter(contents[1].trim()); let achieveDescr = capitalizeFirstLetter((contents[2] || '').trim()); if (!achieveDescr) { //   ,    . achieveDescr = quote; quote = null; } achieve.name = achieveName; achieve.description = achieveDescr; if (quote) { achieve.quote = quote; } return achieve; })); }); }</span></span></code> </pre><br><p>  The input of the function is <code>Buffer</code> , which is returned by <code>fs.readFile</code> , and the output is an array: </p><br><pre> <code class="hljs json">[{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"quote"</span></span>: <span class="hljs-string"><span class="hljs-string">"-  "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"   ."</span></span> }]</code> </pre> <br><p>  Great, working on. </p><br><h4 id="sozdayom-html-stranicy">  Create html pages </h4><br><p>  In order to get PhantomJS to open the pages, we first need the pages themselves. <br>  I created a simple template.html </p><br><div class="spoiler">  <b class="spoiler_title">template.html</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/index.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"achieve"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"achieve__wrapper"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"achieve__text"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"achieve__heading-text{{extraHtmlClass}}"</span></span></span><span class="hljs-tag">&gt;</span></span> {{name}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"achieve__main-text"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"achieve__artistic"</span></span></span><span class="hljs-tag">&gt;</span></span> {{quote}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"achieve__description"</span></span></span><span class="hljs-tag">&gt;</span></span> {{description}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"achieve__image"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clearfix"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><p>  and a small style file to it, which is exactly the same design. </p><br><div class="spoiler">  <b class="spoiler_title">index.css</b> <div class="spoiler_text"><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">917px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-number"><span class="hljs-number">#b3b4b3</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: relative; } <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__wrapper</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding-top</span></span>: <span class="hljs-number"><span class="hljs-number">35px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__text</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__image</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">float</span></span>: left; } <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__text</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding-top</span></span>: <span class="hljs-number"><span class="hljs-number">15px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding-left</span></span>: <span class="hljs-number"><span class="hljs-number">50px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">550px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#353534</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">min-height</span></span>: <span class="hljs-number"><span class="hljs-number">293px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__heading-text</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">70pt</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">40px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: <span class="hljs-string"><span class="hljs-string">'Impact'</span></span>, sans-serif; <span class="hljs-attribute"><span class="hljs-attribute">font-style</span></span>: italic; } <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__heading-text--small</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">50pt</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">line-height</span></span>: <span class="hljs-number"><span class="hljs-number">50pt</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">50px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__heading-text--super-small</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">45pt</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">line-height</span></span>: <span class="hljs-number"><span class="hljs-number">50pt</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">50px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__main-text</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">30px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__artistic</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__description</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: <span class="hljs-string"><span class="hljs-string">'Verdana'</span></span>, sans-serif; } <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__artistic</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-style</span></span>: italic; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">20pt</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__image</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">url</span></span>(<span class="hljs-string"><span class="hljs-string">'/image.png'</span></span>) no-repeat; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">300px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">309px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-size</span></span>: contain; <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute; <span class="hljs-attribute"><span class="hljs-attribute">bottom</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">right</span></span>: <span class="hljs-number"><span class="hljs-number">20px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.achieve__description</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">25pt</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.clearfix</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">clear</span></span>: both; }</code> </pre> </div></div><br><p>  In the text of template.html there is some text, framed {{and}}.  These are the beginnings of our future template engine, which will change to create an html file for the animation based on data from the parser. <br>  The template engine itself fit in 8 lines: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">template</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">template, data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> templateKey = <span class="hljs-string"><span class="hljs-string">'{{'</span></span> + key + <span class="hljs-string"><span class="hljs-string">'}}'</span></span>; template = template.replace(templateKey, data[key]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> template; }</code> </pre> <br><p>  I also added a few rules by which classes should be added to the name of the class.  (Achivka with the name The experimenter did not want to fit in and climbed onto the cup all the time) </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (element.name.split(<span class="hljs-string"><span class="hljs-string">' '</span></span>).length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> || element.name.length &gt;= <span class="hljs-number"><span class="hljs-number">9</span></span>) { data.extraHtmlClass = <span class="hljs-string"><span class="hljs-string">' achieve__heading-text--small'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (element.name.split(<span class="hljs-string"><span class="hljs-string">' '</span></span>).length === <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; element.name.length &gt;= <span class="hljs-number"><span class="hljs-number">14</span></span>) { data.extraHtmlClass = <span class="hljs-string"><span class="hljs-string">' achieve__heading-text--super-small'</span></span>; }</code> </pre> <br><p>  This is a clipping from a file that generates html, the full version of the file is <a href="">here</a> . </p><br><p>  As a result, we need to generate the number of html files, in which the title, quote and description of the file are substituted. </p><br><p>  <strong>I</strong> hasten to <strong>add</strong> that I could not get PhantomJS to read the directory, although it should be easy.  Therefore, together with the html files, I generate the <code>names.json</code> file, which contains all the names of the generated pages. </p><br><h4 id="sozdayom-kartinki">  Create pictures </h4><br><p>  The simplest part, we need to copy the example code from the docks by PhantomJS, modify it a bit and run it. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../data/names.json'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../config/config.json'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pageCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; data.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    const page = require('webpage').create(); //  phantomjs  page.open('http://127.0.0.1:' + config.port + '/pages/' + e + '.html', function(status) { //  html setTimeout(function() { if(status === "success") { page.render('achievements/' + e + '.png'); //  html   pageCount++; if (pageCount === data.length) { phantom.exit(); } } }, 2000); }); page.onResourceError = function(resourceError) { console.log('Unable to load resource (#' + resourceError.id + 'URL:' + resourceError.url + ')'); console.log('Error code: ' + resourceError.errorCode + '. Description: ' + resourceError.errorString); }; });</span></span></code> </pre> <br><p>  Run this <code>phatnom lib/phantom.js</code> and generate images from html files. </p><br><h4 id="chto-to-tut-ne-tak">  Something is wrong here ... </h4><br><p>  Truly something is wrong!  PhantomJS downloads data via HTTP, but we don‚Äôt have an HTTP server with static files, and we won‚Äôt be able to get pictures.  This means that you need to make a small static server, which we kill at the end of the program. </p><br><p>  Thank God that a static server has already been written for us, and we just have to use it. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'node-static'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>.Server(<span class="hljs-string"><span class="hljs-string">'./public'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports.spawnServer = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">port</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    ,   const server = require('http').createServer(function (request, response) { request.addListener('end', function () { file.serve(request, response); }).resume(); }).listen(port, () =&gt; { resolve(server); }); }); }; module.exports.killServer = (server) =&gt; { server.close(); //   .   . }</span></span></code> </pre> <br><p>  Now we have a parser that makes a JS array from the text, there is a page generator, a static server and a phantomjs script that creates the pages.  It remains to put together and Christmas entertainment is ready! </p><br><p>  Since all the code is written in Promises, and there is a Promise <a href="">wrapper</a> above all the functions used, the layout of the methods will not take us much time: </p><br><pre> <code class="javascript hljs">staticServer.spawnServer(config.port).then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">serverInstance</span></span></span><span class="hljs-function">) =&gt;</span></span> { staticServerInstance = serverInstance; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> folderManager.create(); }) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> promiseFuncs.readFile(listFile)) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">buffer</span></span></span><span class="hljs-function"> =&gt;</span></span> parser(buffer)) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all(data.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> pageGenerator(e)))) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">names</span></span></span><span class="hljs-function"> =&gt;</span></span> promiseFuncs.writeFile(<span class="hljs-string"><span class="hljs-string">'./data/names.json'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(names))) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> promiseFuncs.execAndOnClose(<span class="hljs-string"><span class="hljs-string">'./node_modules/.bin/phantomjs'</span></span>, [<span class="hljs-string"><span class="hljs-string">'lib/phantom.js'</span></span>])) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { staticServer.killServer(staticServerInstance); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Achievements generated!'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (config.removeFolders) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> folderManager.remove(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }).catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(e); });</code> </pre> <br><p>  That's all.  It remains to show a bit of creativity and come up with original names for achievements (preferably using local memes), and fun is guaranteed.  Suffice it to celebrate the receipt of each achievement festive "Hurray!"  and solemnly issue it. </p><br><p>  Unfortunately, even half of the achivok could not be distributed, even though we tried very hard when we embodied the pictures in real life.  (More than 50 achievements were pasted on paper, holed with a hole punch and neatly tied with a thread). </p><br><p>  I hope that this article has helped you figure out how to generate images from simple text with minimal cost. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/319674/">https://habr.com/ru/post/319674/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319662/index.html">How we re-opened TFS</a></li>
<li><a href="../319664/index.html">What to fix in the layout before release in production?</a></li>
<li><a href="../319666/index.html">About consumers and types of Threat Intelligence</a></li>
<li><a href="../319668/index.html">Architectural pain manifesto</a></li>
<li><a href="../319670/index.html">Console to the masses. Go to the bright side. Bash</a></li>
<li><a href="../319676/index.html">Facebook's tragic images</a></li>
<li><a href="../319678/index.html">Remote AJAX Components for ReactJS</a></li>
<li><a href="../319680/index.html">Scala.js is easy and simple</a></li>
<li><a href="../319682/index.html">Notify user with 99% probability</a></li>
<li><a href="../319684/index.html">Welcome to Moscow Python Meetup January 19</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>