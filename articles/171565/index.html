<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google Chrome Extensions: Making Hot Keys</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear habravchane. 
 I continue a series of posts with personal experience and tips on developing Google Chrome browser extensions. 
 In this re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google Chrome Extensions: Making Hot Keys</h1><div class="post__text post__text-html js-mediator-article">  Hello, dear habravchane. <br>  I continue a series of posts with personal experience and tips on developing Google Chrome browser extensions. <br>  In this release - ‚Äúglobal‚Äù hotkeys at the browser level. <br><a name="habracut"></a><br>  So, the task is to implement in the expansion support for global keyboard shortcuts to perform some expansion functions with the ability to customize each user. <br>  To begin with, the browser does not have native support for global hotkeys. <br><div class="spoiler">  <b class="spoiler_title">Refinement</b> <div class="spoiler_text">  So it was at the time of writing my extensions, so I thought until the writing of the article.  Now the API has expanded, added support for commands.  But they are rigidly prescribed in the manifest and do not provide sufficient flexibility.  Also, in the settings of extensions in the browser, hotkeys are configured to activate the extension windows. <br>  This is beyond the scope of the post, so I send it to Google and the <a href="http://developer.chrome.com/extensions/commands.html">documentation</a> . </div></div><br>  But the task can be solved by adding keystroke event handling to all browser windows.  This option is not fully functional, as it depends on the presence of focus in the body of the document, but in most cases it works. <br>  <b>Important.</b>  It should be borne in mind that handlers embedded in this way override most of the standard browser hotkeys.  For example, if the document contains the processing of a click of Ctrl + digit with preventDefault, then a similar browser hot key for switching between tabs will not work if there is focus in the document with such a handler.  The same should be warned the user if he is given the opportunity to customize the combinations. <br><br>  For implementation, you need to create a content-script that will be embedded in the pages, register it in the manifest, register processing in the background-page of the extension, and implement the ability to customize keyboard shortcuts.  Unfortunately, it is not possible to arrange this in a more convenient and portable form. <br><br>  It all looks something like this. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  mainfest.json </h6><pre><code class="javascript hljs">{ ... <span class="hljs-string"><span class="hljs-string">"content_scripts"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"all_frames"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-comment"><span class="hljs-comment">//,       ,     iframe "js": ["js/hotkeys.js" ], //,     "matches": [ "http://*/*", "https://*/*" ], //    "run_at": "document_end" } ], ...</span></span></code> </pre> <br>  It's all clear.  It is prescribed to add a handler to all opened pages. <br><br><h6>  The general structure of hotkeys.js </h6><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!EXT_HOTKEY_JS_INSERTED){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> EXT_HOTKEY_JS_INSERTED = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hotkeys = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> messages = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timeout = <span class="hljs-string"><span class="hljs-string">''</span></span>; chrome.extension.sendRequest({<span class="hljs-attr"><span class="hljs-attr">operation</span></span>: <span class="hljs-string"><span class="hljs-string">"hotkeys"</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       if (response) if (response.hotkeys){ hotkeys = JSON.parse(response.hotkeys); var d = document.createElement('DIV'); //       d.id = "hotkeyresponder"; //+: , ,  z-index document.body.appendChild(d); } }); document.addEventListener('keydown', event_handleKeyDownEvent, true); //,        function event_handleKeyDownEvent(e){ if (!hotkeys) return true; var c=0; var a=0; var s=0; var k = e.keyCode; if (e.shiftKey) s = 1; if (e.altKey) a = 1; if (e.ctrlKey) c = 1; if (k==27 &amp;&amp; !c &amp;&amp; !a &amp;&amp; !s){ if (document.getElementById('hotkeyresponder').style.display!='none'){ //    Esc document.getElementById('hotkeyresponder').style.display="none"; e.preventDefault(); e.cancelBubble = true; e.bubbles = false; return false; } } for (var name in hotkeys){ if (hotkeys.hasOwnProperty(name)){ if (hotkeys[name].c == c &amp;&amp; hotkeys[name].a == a &amp;&amp; hotkeys[name].s == s){ // ,   ,  if (name == 'selectProfile' &amp;&amp; k &gt; 48 &amp;&amp; k &lt; 58 &amp;&amp; (c || a || s)){ //   &lt;+&gt; chrome.extension.sendRequest({operation: "hotkey", key:name, id:(k-48)}, function(response) { responseHotkey(name,response.status,response.message); }); e.preventDefault(); e.cancelBubble = true; e.bubbles = false; return false; } else if (hotkeys[name].k==k){ //       .     ,     if (name=='toggleBodyi'){ document.getElementById('togglebody').onclick(); } //  ,       (toggle - ,  DOM, etc.) else{ // ,      chrome.extension.sendRequest({operation: "hotkey", key:name}, function(response) { responseHotkey('pp',response.status,response.message); }); } e.preventDefault(); e.cancelBubble = true; e.bubbles = false; return false; } else{ continue; } } } } } function responseHotkey(type,status,message){ //     if (status == 'OK' &amp;&amp; message){ document.getElementById('hotkeyresponder').innerHTML = message; document.getElementById('hotkeyresponder').style.display = 'block'; if (timeout) clearTimeout(timeout); timeout = setTimeout(function(){document.getElementById('hotkeyresponder').style.display='none';},2000); } } }</span></span></code> </pre><br>  The above script is a synthesis of slightly different hotkey scripts from two extensions.  Clearly, when reused, you need to modify to fit your needs.  For example, if all keys are specified uniquely (without universal modifiers), you only need to make one if block, where you can compare all 4 parameters of a hot key.  If your extension does not perform any actions in the DOM - it is clear that conditional blocks, depending on the name of the hot key, must be abolished before a simple request to the extension. <br><br><h6>  Fragment background.js </h6><pre> <code class="javascript hljs">chrome.extension.onRequest.addListener(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">request, sender, sendResponse</span></span></span><span class="hljs-function">) </span></span>{ loadSettings(); <span class="hljs-comment"><span class="hljs-comment">//  if (request.operation == 'hotkeys'){ //     sendResponse({hotkeys:localStorage.hotkeys}); } else if (request.operation == 'hotkey'){ //   if (request.key == 'selectProfile'){ //  } //    } else{ //sendResponse({}); } });</span></span></code> </pre><br>  <a href="http://stackoverflow.com/questions/13709409/">It is said</a> that <code>sendRequest</code> and <code>onRequest</code> deprecated in favor of <code>sendMessage</code> with similar syntax and functionality.  At the time of writing this post, I didn‚Äôt test this completely, but my extensions still work without any visible problems. <br><br>  In this form (if you manually drive the settings into the extension), the keys are already operational. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf5/620/26a/bf562026a4be6b9a3c21f1042edaa0b3.png"></div><br><br>  Left settings.  Here, in general, there are many options, everything is up to you.  If there are a lot of keys, it makes sense to automate this business as much as possible. <br>  In case someone is going to repeat in his creations, I‚Äôll give you code snippets. <br>  The settings page itself is made by adding a parameter in the manifest: <pre> <code class="javascript hljs">{ ... <span class="hljs-string"><span class="hljs-string">"options_page"</span></span>: <span class="hljs-string"><span class="hljs-string">"options.html"</span></span>, ... }</code> </pre><br>  There is nothing special in HTML, just placeholder.  Everything is formed in JavaScript. <br>  <i>options.html</i> <pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Hotkeys<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/tools.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/options.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  header'  . --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tab1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"margin-top:0;"</span></span></span><span class="hljs-tag">&gt;</span></span> -   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <i>options.js</i> <br>  The required data: the names of the keys, the current settings of the hot keys, and just an array of internal names of supported combinations. <pre> <code class="javascript hljs">... var keycodes = [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'Tab'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'Enter'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'Escape'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'Space'</span></span>,<span class="hljs-string"><span class="hljs-string">'Page Up'</span></span>,<span class="hljs-string"><span class="hljs-string">'Page Down'</span></span>,<span class="hljs-string"><span class="hljs-string">'End'</span></span>,<span class="hljs-string"><span class="hljs-string">'Home'</span></span>,<span class="hljs-string"><span class="hljs-string">'Left'</span></span>,<span class="hljs-string"><span class="hljs-string">'Up'</span></span>,<span class="hljs-string"><span class="hljs-string">'Right'</span></span>,<span class="hljs-string"><span class="hljs-string">'Down'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'Insert'</span></span>,<span class="hljs-string"><span class="hljs-string">'Delete'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>,<span class="hljs-string"><span class="hljs-string">'2'</span></span>,<span class="hljs-string"><span class="hljs-string">'3'</span></span>,<span class="hljs-string"><span class="hljs-string">'4'</span></span>,<span class="hljs-string"><span class="hljs-string">'5'</span></span>,<span class="hljs-string"><span class="hljs-string">'6'</span></span>,<span class="hljs-string"><span class="hljs-string">'7'</span></span>,<span class="hljs-string"><span class="hljs-string">'8'</span></span>,<span class="hljs-string"><span class="hljs-string">'9'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'A'</span></span>,<span class="hljs-string"><span class="hljs-string">'B'</span></span>,<span class="hljs-string"><span class="hljs-string">'C'</span></span>,<span class="hljs-string"><span class="hljs-string">'D'</span></span>,<span class="hljs-string"><span class="hljs-string">'E'</span></span>,<span class="hljs-string"><span class="hljs-string">'F'</span></span>,<span class="hljs-string"><span class="hljs-string">'G'</span></span>,<span class="hljs-string"><span class="hljs-string">'H'</span></span>,<span class="hljs-string"><span class="hljs-string">'I'</span></span>,<span class="hljs-string"><span class="hljs-string">'J'</span></span>,<span class="hljs-string"><span class="hljs-string">'K'</span></span>,<span class="hljs-string"><span class="hljs-string">'L'</span></span>,<span class="hljs-string"><span class="hljs-string">'M'</span></span>,<span class="hljs-string"><span class="hljs-string">'N'</span></span>,<span class="hljs-string"><span class="hljs-string">'O'</span></span>,<span class="hljs-string"><span class="hljs-string">'P'</span></span>,<span class="hljs-string"><span class="hljs-string">'Q'</span></span>,<span class="hljs-string"><span class="hljs-string">'R'</span></span>,<span class="hljs-string"><span class="hljs-string">'S'</span></span>,<span class="hljs-string"><span class="hljs-string">'T'</span></span>,<span class="hljs-string"><span class="hljs-string">'U'</span></span>,<span class="hljs-string"><span class="hljs-string">'V'</span></span>,<span class="hljs-string"><span class="hljs-string">'W'</span></span>,<span class="hljs-string"><span class="hljs-string">'X'</span></span>,<span class="hljs-string"><span class="hljs-string">'Y'</span></span>,<span class="hljs-string"><span class="hljs-string">'Z'</span></span>,<span class="hljs-string"><span class="hljs-string">'MainM Left'</span></span>,<span class="hljs-string"><span class="hljs-string">'MainM Right'</span></span>,<span class="hljs-string"><span class="hljs-string">'Menu'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad 0'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad 1'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad 2'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad 3'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad 4'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad 5'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad 6'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad 7'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad 8'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad 9'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad *'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad +'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad -'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad ,'</span></span>,<span class="hljs-string"><span class="hljs-string">'NumPad /'</span></span>,<span class="hljs-string"><span class="hljs-string">'F1'</span></span>,<span class="hljs-string"><span class="hljs-string">'F2'</span></span>,<span class="hljs-string"><span class="hljs-string">'F3'</span></span>,<span class="hljs-string"><span class="hljs-string">'F4'</span></span>,<span class="hljs-string"><span class="hljs-string">'F5'</span></span>,<span class="hljs-string"><span class="hljs-string">'F6'</span></span>,<span class="hljs-string"><span class="hljs-string">'F7'</span></span>,<span class="hljs-string"><span class="hljs-string">'F8'</span></span>,<span class="hljs-string"><span class="hljs-string">'F9'</span></span>,<span class="hljs-string"><span class="hljs-string">'F10'</span></span>,<span class="hljs-string"><span class="hljs-string">'F11'</span></span>,<span class="hljs-string"><span class="hljs-string">'F12'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'='</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'-'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'~'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'\\'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hotkeys = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(localStorage.hotkeys); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> phk = [<span class="hljs-string"><span class="hljs-string">'prevProfile'</span></span>, <span class="hljs-string"><span class="hljs-string">'nextProfile'</span></span>, <span class="hljs-string"><span class="hljs-string">'selectProfile'</span></span>, <span class="hljs-string"><span class="hljs-string">'openOpts'</span></span>, <span class="hljs-string"><span class="hljs-string">'toggleHideWidget'</span></span>, <span class="hljs-string"><span class="hljs-string">'toggleWidget'</span></span>, <span class="hljs-string"><span class="hljs-string">'toggleInCT'</span></span>, <span class="hljs-string"><span class="hljs-string">'toggleBody'</span></span>, <span class="hljs-string"><span class="hljs-string">'openWidget'</span></span>, <span class="hljs-string"><span class="hljs-string">'toggleBodyi'</span></span>, <span class="hljs-string"><span class="hljs-string">'actMC'</span></span>, <span class="hljs-string"><span class="hljs-string">'actMG'</span></span>];</code> </pre> <br>  Page initialization function: filling in HTML, hanging handlers, displaying current settings. <pre> <code class="javascript hljs">initt = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ... for (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; phk.length;i++){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'DIV'</span></span>); d.innerHTML = <span class="hljs-string"><span class="hljs-string">'&lt;h4 style="margin:0;"&gt;'</span></span>+_getMessage(phk[i]+<span class="hljs-string"><span class="hljs-string">'_title'</span></span>)+<span class="hljs-string"><span class="hljs-string">'&lt;/h4&gt;&lt;input type="checkbox" id="'</span></span>+phk[i]+<span class="hljs-string"><span class="hljs-string">'_c"&gt;&lt;label for="'</span></span>+phk[i]+<span class="hljs-string"><span class="hljs-string">'_c"&gt;Ctrl &lt;b&gt;+&lt;/b&gt;&lt;/label&gt;&lt;input type="checkbox" id="'</span></span>+phk[i]+<span class="hljs-string"><span class="hljs-string">'_a"&gt;&lt;label for="'</span></span>+phk[i]+<span class="hljs-string"><span class="hljs-string">'_a"&gt;Alt &lt;b&gt;+&lt;/b&gt;&lt;/label&gt;&lt;input type="checkbox" id="'</span></span>+phk[i]+<span class="hljs-string"><span class="hljs-string">'_s"&gt;&lt;label for="'</span></span>+phk[i]+<span class="hljs-string"><span class="hljs-string">'_s"&gt;Shift &lt;b&gt;+&lt;/b&gt;&lt;/label&gt;'</span></span>+((phk[i]==<span class="hljs-string"><span class="hljs-string">'selectProfile'</span></span>)?(<span class="hljs-string"><span class="hljs-string">'&lt;key 1-9&gt;&lt;input type="hidden" id="'</span></span>+phk[i]+<span class="hljs-string"><span class="hljs-string">'_k" value="$"&gt; '</span></span>):(<span class="hljs-string"><span class="hljs-string">'&lt;input type="text" id="'</span></span>+phk[i]+<span class="hljs-string"><span class="hljs-string">'_k"&gt;'</span></span>))+<span class="hljs-string"><span class="hljs-string">'&lt;img src="img/delete.gif" id="'</span></span>+phk[i]+<span class="hljs-string"><span class="hljs-string">'_imgerr" class="err_disp" style="height:16px;display:none;" /&gt;&lt;img src="img/ok.png" id="'</span></span>+phk[i]+<span class="hljs-string"><span class="hljs-string">'_imgok" class="err_disp" style="height:16px;display:none;" /&gt;&lt;br/&gt;&lt;span id="result_'</span></span>+phk[i]+<span class="hljs-string"><span class="hljs-string">'" class="err_disp" style="color:red"&gt;&lt;/span&gt;'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'tab1'</span></span>).appendChild(d); } <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'tab1'</span></span>).innerHTML+=<span class="hljs-string"><span class="hljs-string">'&lt;button&gt;'</span></span>+_getMessage(<span class="hljs-string"><span class="hljs-string">'opts_13'</span></span>)+<span class="hljs-string"><span class="hljs-string">'&lt;/button&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; phk.length;i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hotkeys[phk[i]]){ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(phk[i]+<span class="hljs-string"><span class="hljs-string">'_c'</span></span>).checked = (hotkeys[phk[i]][<span class="hljs-string"><span class="hljs-string">'c'</span></span>]?<span class="hljs-literal"><span class="hljs-literal">true</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(phk[i]+<span class="hljs-string"><span class="hljs-string">'_a'</span></span>).checked = (hotkeys[phk[i]][<span class="hljs-string"><span class="hljs-string">'a'</span></span>]?<span class="hljs-literal"><span class="hljs-literal">true</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(phk[i]+<span class="hljs-string"><span class="hljs-string">'_s'</span></span>).checked = (hotkeys[phk[i]][<span class="hljs-string"><span class="hljs-string">'s'</span></span>]?<span class="hljs-literal"><span class="hljs-literal">true</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (phk[i]!=<span class="hljs-string"><span class="hljs-string">'selectProfile'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(phk[i]+<span class="hljs-string"><span class="hljs-string">'_k'</span></span>).value = keycodes[hotkeys[phk[i]][<span class="hljs-string"><span class="hljs-string">'k'</span></span>]]; } } ... var m = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'input[type=text]'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; m.length; i++){ m[i].addEventListener(<span class="hljs-string"><span class="hljs-string">'keydown'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value=(keycodes[event.keyCode]?keycodes[event.keyCode]:<span class="hljs-string"><span class="hljs-string">''</span></span>);prevDef(event);<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>},<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } ... }</code> </pre><br>  Save function  It also implemented a check for validity and conflicts.  And the correct combinations are immediately saved, and the wrong ones are marked accordingly. <pre> <code class="javascript hljs">save = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     var err_els = document.getElementsByClassName('err_disp'); for (var i = 0; i &lt; err_els.length; i++){ if (i%3==2) err_els[i].innerHTML = ''; else err_els.style.display = 'none'; } var hktp = {}; var hkts = {}; //      for (var i = 0; i &lt; phk.length; i++){ if ((document.getElementById(phk[i]+'_c').checked || document.getElementById(phk[i]+'_a').checked || document.getElementById(phk[i]+'_s').checked) &amp;&amp; document.getElementById(phk[i]+'_k').value){ //  hktp[phk[i]] = { c:document.getElementById(phk[i]+'_c').checked, a:document.getElementById(phk[i]+'_a').checked, s:document.getElementById(phk[i]+'_s').checked, k:document.getElementById(phk[i]+'_k').value, }; } else{ //   -  if (document.getElementById(phk[i]+'_c').checked || document.getElementById(phk[i]+'_a').checked || document.getElementById(phk[i]+'_s').checked || (document.getElementById(phk[i]+'_k').value &amp;&amp; document.getElementById(phk[i]+'_k').value!='$')){ document.getElementById('result_'+phk[i]).innerHTML = _getMessage('opts_12'); document.getElementById(phk[i]+'_imgerr').style.display = 'inline'; } } } //  for (var i = 0; i &lt; phk.length-1; i++){ for (var j = i+1; j &lt; phk.length; j++){ if (hktp[phk[i]] &amp;&amp; hktp[phk[j]]) if (hktp[phk[i]].c == hktp[phk[j]].c &amp;&amp; hktp[phk[i]].a == hktp[phk[j]].a &amp;&amp; hktp[phk[i]].s == hktp[phk[j]].s &amp;&amp; (hktp[phk[i]].k == hktp[phk[j]].k || ((hktp[phk[i]].k == '$' || hktp[phk[j]].k == '$') &amp;&amp; ((hktp[phk[i]].k*1&gt;0 &amp;&amp; hktp[phk[i]].k*1&lt;=9) || (hktp[phk[j]].k*1&gt;0 &amp;&amp; hktp[phk[j]].k*1&lt;=9))))){ document.getElementById('result_'+phk[i]).innerHTML = _getMessage('opts_11'); document.getElementById(phk[i]+'_imgerr').style.display = 'inline'; document.getElementById('result_'+phk[j]).innerHTML = _getMessage('opts_11'); document.getElementById(phk[j]+'_imgerr').style.display = 'inline'; hktp[phk[i]] = false; hktp[phk[j]] = false; } } } // ""    for (var name in hktp){ if (hktp.hasOwnProperty(name) &amp;&amp; hktp[name]){ document.getElementById(phk[i]+'_imgok').style.display = 'inline'; hkts[name] = { c:(document.getElementById(name+'_c').checked?1:0), a:(document.getElementById(name+'_a').checked?1:0), s:(document.getElementById(name+'_s').checked?1:0), k:keycodes.in_array(document.getElementById(name+'_k').value), } } } localStorage.hotkeys = JSON.stringify(hkts); // }</span></span></code> </pre><br>  If you are confused by functions like _getMessage, these are wrappers for functions i18n (see my <a href="http://habrahabr.ru/post/171491/">previous post</a> ) <br>  Here is how it looks in work. <br><div style="text-align:center;"><img src="http://habrastorage.org/storage2/88b/145/4c3/88b1454c3bb6bde8f96944211053c8a8.png"></div><br><br>  That's all.  From these sources it is quite possible to make any functional decisions.  In such a way, the hot key support systems work with honor in my extensions, users do not complain.  The only thing that the option I proposed is not able to do is to invoke a popup window.  I did not find the appropriate API methods, but my extensions are not one of those where a combination of keys to display a pop-up window is absolutely necessary, and the proposed arsenal fully covers the functionality of the extension. </div><p>Source: <a href="https://habr.com/ru/post/171565/">https://habr.com/ru/post/171565/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../171551/index.html">Hackathon for mobile developers in Moscow</a></li>
<li><a href="../171555/index.html">Windows Azure VMs: Data Disk, Virtual Networks, and Availability Set</a></li>
<li><a href="../171557/index.html">Using XSLT to Prevent XSS by Filtering Custom Content</a></li>
<li><a href="../171559/index.html">Design Pattern "Specification"</a></li>
<li><a href="../171561/index.html">Frequently asked questions about asm.js</a></li>
<li><a href="../171569/index.html">My Adventures at MWC 2013 or Barcelona, ‚Äã‚ÄãThere and Back</a></li>
<li><a href="../171571/index.html">Ability to use the idea: how new products appear</a></li>
<li><a href="../171577/index.html">Spend the entire salary for the month?</a></li>
<li><a href="../171579/index.html">[Updated] Curiosity Problems: Causes and Current Situation</a></li>
<li><a href="../171581/index.html">North Korea listened to Eric Schmidt and as the first step became hoster of The Pirate Bay</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>