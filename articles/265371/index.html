<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nhibernate: Mapping Options, Query Options</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I decided to put together all the information to which I regularly turn, rummaging through the Internet or in code. These are mapping...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nhibernate: Mapping Options, Query Options</h1><div class="post__text post__text-html js-mediator-article">  In this article, I decided to put together all the information to which I regularly turn, rummaging through the Internet or in code.  These are mappings and links in NHibernate.  A sort of article-memo will be.  I decided not to overload it too much (for example, I wrote very little about the NHibernate Queries), and therefore in each headline there will be a link to the article (in English), which I relied on when creating the memo article.  I hope it will be useful to you. <br><a name="habracut"></a><br><br>  I will give examples for ASP.NET MVC 4 and SQL Server 2008 (by the way, we will rarely refer to the latter, just to check how our data was stored there, and the connection string we mention).  I will try to write specifically and capaciously, and if there are strange moments, I ask for the article <a href="http://habrahabr.ru/post/264907/">Tutorials on FluentNHibernate c ASP.NET MVC and SQL Server.</a>  <a href="http://habrahabr.ru/post/264907/">Part 1</a> where everything is described in more detail.  So let's get started, for starters, start Visual Studio and: <br><ol><li>  Create a new project <i>File-&gt; New-&gt; Project</i> . </li><li>  Choose ASP.NET MVC 4 (.Net Framework 4) and call it <i>NHibernateMVC</i> . </li><li>  Create an NHibernate folder in the <i>Models</i> folder. </li><li>  In the <i>Package Manager Console, we</i> specify the <b>install-package nhibernate</b> (the examples below work in FluentNhibernate, (checked!): Install-package Fluentnhibernate). </li></ol><br><br>  After Nhibernate is installed, the question arises as to which way we will associate (map) the classes from the application with the tables from the database.  NHibernate has three types of mapping available for us, such as: <br><ul><li>  XML.  Create a * .hbm.xml mapping file </li><li>  Attributes.  It is an add-in for xml-mapping.  Mapping looks like .NET attributes </li><li>  Mapping by code.  - instead of xml-files are used * .cs ConfORM mapping classes </li><li>  Fluent.  Create * .cs fluent mapping classes </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Variants of mappings.</b> <br>  <b>1.xml files</b> <br><br>  The very first developed mapping. <br>  Pros: <br>  + There are many examples on the Internet. <br>  + All other methods (Attributes and Fluent) are reduced to obtaining these xml files. <br>  Minuses: <br>  - Completely missing intellisense (!). <br>  - There is no validation at compile time. <br><br>  Well, let's consider it. <br>  After installing NHibernate, add the Nhibernate.cfg.xml file to the Models-&gt; NHibernate folder <br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hibernate-configuration</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:nhibernate-configuration-2.2"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">session-factory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"connection.provider"</span></span></span><span class="hljs-tag">&gt;</span></span> NHibernate.Connection.DriverConnectionProvider <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"connection.driver_class"</span></span></span><span class="hljs-tag">&gt;</span></span> NHibernate.Driver.SqlClientDriver <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"connection.connection_string"</span></span></span><span class="hljs-tag">&gt;</span></span> Server=...\SQLENTERPRISE; database=NhibernateTutor; Integrated Security=SSPI; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dialect"</span></span></span><span class="hljs-tag">&gt;</span></span> NHibernate.Dialect.MsSql2008Dialect <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">session-factory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hibernate-configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  I work with SQL Server, so I chose SqlClientDriver.  If you are working with another database, then the list of NHibernate.Drivers can be viewed here <a href="http://www.nudoq.org/">NHibernate.Driver</a> <br>  Since I have SQL Server 2008 installed, I chose MsSql2008Dialect, all dialects can be found here <a href="http://nhibernate.info/doc/nh/en/index.html">SQL Dialects</a> <br>  Create the NhibernateTutor database in SQL Server and add the connection string.  In this article I will not create tables, they will be generated by NHibernate themselves. <br><br>  Next, add the Book.cs class to the Models folder. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Book</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  (PS All its fields must be virtual - this requirement is necessary for lazy load (lazy loading) and for NHibnerate to track all changes in objects.) <br><br>  After creating a class, it's time to create a mapping for it.  To do this, create an xml file in the Models-&gt; NHibernate folder - ‚ÄúBook.hbm.xml‚Äù.  ( <b>Attention!</b> <br><ol><li>  All mapping files must have the extension * .hbm.xml. </li><li>  Go to the properties of this file (right-click on Book.hbm.xml -&gt; Properties), and in the Advanced list, change the <i>Build Action</i> property to <i>Embedded Resource</i> .  The same will need to be done again for other * .hbm.xml-files.  If you do not specify it, then in the configuration.AddAssembly (typeof (Book) .Assembly);  the NhibernateHelper class (which will be created later) will be an error, which is impossible for the Book class to find its mapping file.) </li></ol><br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hibernate-mapping</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"urn:nhibernate-mapping-2.2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">auto-import</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">assembly</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NhibernateMVC"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">namespace</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"NhibernateMVC.Models"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Book"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dynamic-update</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cache</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">usage</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"read-write"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"int"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">generator</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"native"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Name"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Description"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hibernate-mapping</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  What is there to pay attention to.  First, the assembly and namespace should be the same as the Book class.  Id I did &lt;generator class = "native" /&gt; because I don‚Äôt like guid, and he himself determines which type (identity, sequence or hilo) to use, depending on the capabilities of the database (Sql Server is an identity). <br><ul><li>  The complete list of generators is here <a href="http://nhibernate.info/doc/nh/en/index.html">IdGenerator</a> . </li><li>  A list of class properties. </li><li>  A list of Id properties can be read here. </li><li>  Property List <a href="http://nhibernate.info/doc/nh/en/index.html">Property</a> . </li></ul><br><br>  Once the xml mapping has been created, create the NHibernateHelper.cs class in the root directory. <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NHibernateHelper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ISession </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenSession</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> configurePath = HttpContext.Current.Server.MapPath(<span class="hljs-string"><span class="hljs-string">@"~\Models\Nhibernate\nhibernate.cfg.xml"</span></span>); configuration.Configure(configurePath); <span class="hljs-comment"><span class="hljs-comment">//    Book.hbm.xml Embedded Resource,          configuration.AddAssembly(typeof(Book).Assembly); ISessionFactory sessionFactory = configuration.BuildSessionFactory(); // Nhibernate         . new SchemaUpdate(configuration).Execute(true, true); return sessionFactory.OpenSession(); } }</span></span></code> </pre><br>  More information about configuring ISessionConfiguration here <a href="http://nhibernate.info/doc/nh/en/index.html">ISessionFactory Configuration</a> <br><br>  At the end of all these operations, the following files should have been created. <br><img src="https://habrastorage.org/files/b1b/642/5dc/b1b6425dcafa4322a2a41c484a0e4cd3.jpg"><br><br>  Let's now see how NHibernate creates a Book table in the database.  Create a HomeController class in the Controllers folder and write the following code. <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> session = NHibernateHelper.OpenSession(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(); }</code> </pre><br>  What the View will look like does not interest us now, let it be empty.  We start applications, we come into a SQL Server DB and (voila!) We see the Book table in NhibernateTutor DB.  There you can change the data types at your discretion (nvarchar (255) make nvarchar (MAX), but not int!).  Until we fill it with data, let's first set up the links (when the one-to-one link appears, an error will occur that the Mind table does not match the Book table) or fill in the data and then delete. <br><br><img src="https://habrastorage.org/files/7f3/c61/67b/7f3c6167bb2a418483b7f104df386a10.jpg"><br><br>  We now turn to setting up the relationship between the tables. <br><br>  <b>1.1 Relationships</b> <br>  <b>Many-to-many</b> <br><table border="1"><tbody><tr><th>  Book.cs </th><th>  Author.cs </th></tr><tr><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ISet&lt;Author&gt; _authors; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ISet&lt;Author&gt; Authors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _authors ?? (_authors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;Author&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _author = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ISet&lt;Book&gt; _books; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ISet&lt;Book&gt; Books{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _books?? (_books= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;Book&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _books= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td></tr><tr><th>  Book.hbm.xml </th><th>  Author.hbm.xml </th></tr><tr><td><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> ~~~/&gt;</span></span> ........................................... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">set</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Authors"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">table</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Book_Author"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cascade</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"save-update"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BookId"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">many-to-many</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Author"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AuthorId"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">set</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></td><td><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> ~~~/&gt;</span></span> ........................................... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">set</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Books"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">table</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Book_Author"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">inverse</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cascade</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"save-update"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AuthorId"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">many-to-many</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Book"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BookId"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">set</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></td></tr></tbody></table><br>  Let's take a look at the xml mappings of these classes.  Let's start with the set tag, it is used for .NET ISet.  For more information, what are the tags for collections, you can read here the <a href="http://nhibernate.info/doc/nh/en/index.html">Collection of Values</a> , and I will provide a table of collections below and what tags apply to them. <br><table border="1"><tbody><tr><th>  .Net Collection </th><th>  Mapping </th></tr><tr><td>  IEnumerable / ICollection / IList </td><td>  bag </td></tr><tr><td>  IList with order </td><td>  list </td></tr><tr><td>  ISet </td><td>  set </td></tr><tr><td>  IDictionary </td><td>  map </td></tr></tbody></table><br><br><ul><li>  table = "Book_Author" - an attribute that creates an intermediate Book_Author table, necessary for a many-to-many relationship. </li><li>  name = "Books / Authors" - indicates the name of the collection </li><li>  cascade = "save-update" - indicates that when saving and updating, the tables associated with it are also saved and updated.  Types cascade = "all | none | save-update | delete | all-delete-orphan", in more detail here <a href="http://nhibernate.info/doc/nh/en/index.html">LifeCycles and object graphs</a> </li><li>  inverse = "true" means that the opposite Book table is the parent (responsible for the relationship) and will be updated.  <a href="http://www.mkyong.com/hibernate/inverse-true-example-and-explanation/">Inverse true example</a> can be found here. </li><li>  key column = "BookId" - indicates that the Book table will be associated with the Book_Author table by the BookId key </li><li>  many-to-many class = "Author" column = "AuthorId" - indicates that the Book table will be associated with the Author table by the "AuthorId" key </li></ul><br><br>  <b>Many-to-one (one-to-many)</b> <br><table border="1"><tbody><tr><th>  Book.cs </th><th>  Series.cs </th></tr><tr><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Series Series { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br></td><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IList&lt;Book&gt; _books; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> IList&lt;Book&gt; Books { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _books ?? (_books = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Book&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _books = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td></tr><tr><th>  Book.hbm.xml <br></th><th>  Series.hbm.xml <br></th></tr><tr><td><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">many-to-one</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Series"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Series"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Series_id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cascade</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"save-update"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br></td><td><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Books"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">inverse</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">column</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Series_id"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">one-to-many</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Book"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bag</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></td></tr></tbody></table><br>  So, what can I say?  We used the tag "bag" because we have IList, column = "Series_id" creates in the Book table a column Series_Id, the rest was said above. <br><br>  <b>One to one</b> <br><table border="1"><tbody><tr><th>  Book.cs </th><th>  Mind.cs </th></tr><tr><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Mind _mind; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Mind Mind { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _mind ?? (_mind = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mind()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _mind = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre></td><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Book Book { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre></td></tr><tr><th>  Book.hbm.xml </th><th>  Mind.hbm.xml </th></tr><tr><td><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">one-to-one</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Mind"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Mind"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">constrained</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cascade</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"All"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre></td><td><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">one-to-one</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Book"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Book"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre></td></tr></tbody></table><br><br>  And here it is already interesting!  constrained = "true" means that for each entry in the Book table there must be an entry in the Mind table, that is, the Id of the Book table must be equal to the Id of the Mind table.  If you try to save the Book object, forgetting about the Mind table, then Nhibernate will throw an exception that it cannot save data.  That is, you must first create a Mind object for Book.  Constantly creating a Mind object is very tiring, so when I create a Book object while saving, I initialize the Mind object with the code below, and I always have time to fill the Mind table. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Mind _mind; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Mind Mind { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _mind ?? (_mind = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mind()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _mind = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br>  Cascade = "All" When saving, changing, deleting the table, the Book is also saved, modified, and the Mind table is deleted.  So, we created all the links, it's time to check them, saving, editing or deleting data.  Detailed information under the spoiler below. <br><br><div class="spoiler">  <b class="spoiler_title">Verifying Mapping Operation: CRUD Operations</b> <div class="spoiler_text">  Let's create a test application that will save data to the database, update and delete it by changing the HomeController as follows (Comment on the unnecessary parts of the code): <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (ISession session = NHibernateHelper.OpenSession()) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (ITransaction transaction = session.BeginTransaction()) { <span class="hljs-comment"><span class="hljs-comment">//,  var createBook = new Book(); createBook.Name = "Metro2033"; createBook.Description = " "; createBook.Authors.Add(new Author { Name = "" }); createBook.Series = new Series { Name = "" }; createBook.Mind = new Mind { MyMind = " " }; session.SaveOrUpdate(createBook); // ( ) var updateBook = session.Get&lt;Book&gt;(1); updateBook.Name = "Metro2033"; updateBook.Description = " "; updateBook.Authors.ElementAt(0).Name = ""; updateBook.Series.Name = ""; updateBook.Mind.MyMind = "11111"; session.SaveOrUpdate(updateBook); // ( ) var deleteBook = session.Get&lt;Book&gt;(1); session.Delete(deleteBook); transaction.Commit(); } var criteria = session.CreateCriteria&lt;Book&gt;(); criteria.CreateAlias("Series", "series", JoinType.LeftOuterJoin); criteria.CreateAlias("Authors", "author", JoinType.LeftOuterJoin); criteria.CreateAlias("Mind", "mind", JoinType.LeftOuterJoin); criteria.SetResultTransformer(new DistinctRootEntityResultTransformer()); var books = criteria.List&lt;Book&gt;(); return View(books); } }</span></span></code> </pre><br>  and change the view as follows: <br><pre> <code class="html hljs xml">@model IEnumerable<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NhibernateMVC.Models.Book</span></span></span><span class="hljs-tag">&gt;</span></span> @{ Layout = null; } <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width=device-width"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Index<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">th</span></span></span><span class="css">, </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">td</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">1px</span></span></span><span class="css"> solid; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink("Create New", "Create")<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayNameFor(model =&gt; model.Name)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayNameFor(model =&gt; model.Mind)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayNameFor(model =&gt; model.Series)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayNameFor(model =&gt; model.Authors)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in Model) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayFor(modelItem =&gt; item.Name)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayFor(modelItem =&gt; item.Mind.MyMind)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @{string strSeries = item.Series != null ? item.Series.Name : null;} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayFor(modelItem =&gt; strSeries)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var author in item.Authors) { string strAuthor = author != null ? author.Name : null; @Html.DisplayFor(modelItem =&gt; strAuthor) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.ActionLink("Edit", "Edit", new { id = item.Id }) | @Html.ActionLink("Details", "Details", new { id = item.Id }) | @Html.ActionLink("Delete", "Delete", new { id = item.Id }) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  I think you can do it yourself by creating the appropriate fields for Author, Mind and Series.  After checking all the operations one by one, we note that: <br><ul><li>  During the Create and Update operations, all data associated with the Book table is updated (remove Cascade = "save-update" or cascade = "all" and the associated data will not be saved) </li><li>  When deleting, data is deleted from the tables Book, Mind, Book_Author, and the rest of the data is not deleted, because they have Cascade = "save-update" </li><li>  When deleting, data is deleted from the tables Book, Mind, Book_Author, and the rest of the data is not deleted, because they have Cascade = "save-update" </li></ul><br>  Next, you can use this code to check connections in other mapping options, because <i>Criteria</i> works in both Attributes and Fluent.  And do not forget to check the keys in the database, you never know what mistake you made, which you will learn later.  For example, the Book table is referenced by the AuthorId of the Book_Author table, instead of the BookId key. <br></div></div><br><br>  <b>Detailed information can be found here.</b> <br>  <a href="http://nhibernate.info/doc/nh/en/index.html">NHibernate Reference Documentation</a> <br><br>  <b>2. ATTRIBUTES</b> <br>  It is an add-in to Nhibernate. <br>  Pros: <br>  + No need to create separate files (* .hbm.xml), write the attributes immediately above the class fields, that is, entities and mappings are nearby. <br>  + Support for Intellisense 50/50 (!).  There are hints for writing attributes (such as Name), but not for its properties, which are represented as strings. <br>  + Easily upgrade from xml files to Attributes. <br>  Minuses: <br>  - The readability of a code worsens. <br>  - Lack of validation at compile time. <br>  - For properties consisting of more than 1 attribute, indexes should be specified. <br><br>  There are few materials on NHibernate.Mapping.Attributes on the Internet, even on the <a href="http://nhibernate.info/">nhibernate.info</a> website, he has only ONE head (!) <a href="http://nhibernate.info/doc/nhibernate-reference/mapping-attributes.html">Of NHibernate.Mapping.Attributes</a> and there is a simple explanation for this: it is an add-on to NHibernate, and therefore, in fact has the same settings as the Nhibernate * .hbm.xml files.  So you use Attributes instead of <s>nasty</s> * .hbm.xml files.  Therefore, if you use Attributes and you have problems, feel free to apply solutions that are applicable for * .hbm.xml-files, since the syntax is the same for them, it will not be difficult to figure out. <br><ol><li>  Before using attributes, first delete all mapping (* .hbm.xml) files, we will not need them anymore.  ( <b>Nhibernate.cfg.xml</b> leave!) </li><li>  To work with the attributes, we need NHibernate.Mapping.Attribute.dll, install it via the <i>Package Manager Console</i> , where we will install <b>Install-Package NHibernate.Mapping.Attributes</b> . </li><li>  Change the NHibernateHelper class as follows </li></ol><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NHibernateHelper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ISession </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenSession</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> configuration = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> configurePath = HttpContext.Current.Server.MapPath(<span class="hljs-string"><span class="hljs-string">@"~\Models\Nhibernate\nhibernate.cfg.xml"</span></span>); configuration.Configure(configurePath); <span class="hljs-comment"><span class="hljs-comment">//configuration.AddAssembly(typeof(Book).Assembly);     \\ HbmSerializer.Default.Validate = true; var stream = HbmSerializer.Default.Serialize(Assembly.GetAssembly(typeof(Book))); configuration.AddInputStream(stream); //*****************************************************************************************************\\ ISessionFactory sessionFactory = configuration.BuildSessionFactory(); // Nhibernate         . new SchemaUpdate(configuration).Execute(true, true); return sessionFactory.OpenSession(); } }</span></span></code> </pre><br><ul><li>  configurePath - Indicates the path to the configuration of the file Nhibernate </li><li>  HbmSerializer.Default.Validate - enables or disables checking generated xml streams </li><li>  HbmSerializer.Default.Serialize - serializes classes to xml files </li></ul><br>  Now it's time to prescribe Attributes.  Modify the Book class by adding attributes there as follows <br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Class</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Book</span></span> { [Id(<span class="hljs-number"><span class="hljs-number">0</span></span>, Name = <span class="hljs-string"><span class="hljs-string">"Id"</span></span>)] [Generator(<span class="hljs-number"><span class="hljs-number">1</span></span>, Class = <span class="hljs-string"><span class="hljs-string">"native"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Property] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [Property] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  What should be noticed?  First, there must be attributes above each property that you want to mute.  Second, did you notice the Id (0 ...) and Generator (1 ...) indices?  Indexes need to be applied to properties that consist of more than one attribute.  This is due to the fact that NHMA generates * .hbm.xml files on the fly from attributes, and it must know in which order to write out xml elements.  (Unfortunately, the attribute order is not supported by reflection). <br>  Let's delete the Book table from the database (it is possible and not to delete it for verification.) We will launch the project, and if there was no Book table in the database, it will be created. <br>  I will not write about the relationship, since the syntax is the same as for the * .hbm.xml files, the only difference is that you need to prescribe indexes for collections. <br><br>  <b>2.1 Relationships (In Tables)</b> <br>  <b>Many-to-many</b> <br><table border="1"><tbody><tr><th>  Book.cs </th><th>  Author.cs </th></tr><tr><td><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Set(0, Table = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Book_Author"</span></span></span><span class="hljs-meta">, Cascade = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"save-update"</span></span></span><span class="hljs-meta">)</span></span>] [Key(<span class="hljs-number"><span class="hljs-number">1</span></span>, Column = <span class="hljs-string"><span class="hljs-string">"BookId"</span></span>)] [ManyToMany(<span class="hljs-number"><span class="hljs-number">2</span></span>, ClassType = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Author), Column = <span class="hljs-string"><span class="hljs-string">"AuthorId"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ISet&lt;Author&gt; _authors; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ISet&lt;Author&gt; Authors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _authors ?? (_authors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;Author&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _author = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td><td><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Set(0, Table = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Book_Author"</span></span></span><span class="hljs-meta">, Inverse = true, Cascade = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"save-update"</span></span></span><span class="hljs-meta">)</span></span>] [Key(<span class="hljs-number"><span class="hljs-number">1</span></span>, Column = <span class="hljs-string"><span class="hljs-string">"AuthorId"</span></span>)] [ManyToMany(<span class="hljs-number"><span class="hljs-number">2</span></span>, ClassType = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Book), Column = <span class="hljs-string"><span class="hljs-string">"BookId"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ISet&lt;Book&gt; _books; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ISet&lt;Book&gt; Books{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _books?? (_books= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;Book&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _books= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td></tr></tbody></table><br>  <b>Many-to-one, one-to-many</b> <br><table border="1"><tbody><tr><th>  Book.cs </th><th>  Series.cs </th></tr><tr><td><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ManyToOne(Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Series"</span></span></span><span class="hljs-meta">, Column = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SeriesId"</span></span></span><span class="hljs-meta">, ClassType = typeof(Series), Cascade = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"save-update"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Series Series { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br></td><td><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Bag(0, Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Books"</span></span></span><span class="hljs-meta">, Inverse = true)</span></span>] [Key(<span class="hljs-number"><span class="hljs-number">1</span></span>, Column = <span class="hljs-string"><span class="hljs-string">"SeriesId"</span></span>)] [OneToMany(<span class="hljs-number"><span class="hljs-number">2</span></span>, ClassType = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Book))] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IList&lt;Book&gt; _books; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> IList&lt;Book&gt; Books{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _books?? (_books= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Book&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _books= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td></tr></tbody></table><br>  <b>One to one</b> <br><table border="1"><tbody><tr><th>  Book.cs </th><th>  Mind.cs </th></tr><tr><td><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">OneToOne(Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Mind"</span></span></span><span class="hljs-meta">, ClassType = typeof(Mind), Constrained = true, Cascade = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"All"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Mind _mind; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Mind Mind { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _mind ?? (_mind = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mind()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _mind = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td><td><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">OneToOne(Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Book"</span></span></span><span class="hljs-meta">, ClassType = typeof(Book))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Book Book { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br></td></tr></tbody></table><br><br>  <b>3. Mapping ByCode</b> <br>  Pros: <br>  + No additional libraries required (as is the case with attributes) <br>  + Support for Intellisense 100 (!). <br>  + No .hbm.xml files and Nhibernate.cfg.xml are required. <br>  + We took the best from Fluent-Nhibernate (lambda expressions) and made the syntax for * .hbm.xml files. <br>  Minuses: <br>  - Removed cascade Save-Update property (you can use Cascade.Persist, but still). <br>  - The structure (in particular the relations between the classes) does not exactly correspond to the elements of * .hbm.xml files. <br><br>  <i>Will be updated ...</i> <br><ol><li>  Remove the nhibernate.cfg.xml file </li><li>  Change the NHibernateHelper class as follows </li></ol><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NHibernateHelper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ISession </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenSession</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cfg = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Configuration() .DataBaseIntegration(db =&gt; { db.ConnectionString = <span class="hljs-string"><span class="hljs-string">@"Server=..\SQLENTERPRISE;initial catalog=NhibernateTutor;Integrated Security=SSPI;"</span></span>; db.Dialect&lt;MsSql2008Dialect&gt;(); }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mapper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ModelMapper(); mapper.AddMappings(Assembly.GetExecutingAssembly().GetExportedTypes()); HbmMapping mapping = mapper.CompileMappingForAllExplicitlyAddedEntities(); cfg.AddMapping(mapping); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaUpdate(cfg).Execute(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); ISessionFactory sessionFactory = cfg.BuildSessionFactory(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sessionFactory.OpenSession(); } }</code> </pre><br><br>  Noticed the trend?  Each way removes one of the files for Nhibernate.  The xml files had * .hbm.xml files and nhibernate.cfg.xml file, Attributes did not need * .hbm.xml files, and in Mapping byCode, nhibernate.cfg.xml was no longer needed.  I wonder what will be removed in the new way (and will it be at all?). <br><br>  The Book class and its mapping should look like this. <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Book</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BookMap</span></span> : <span class="hljs-title"><span class="hljs-title">ClassMapping</span></span>&lt;<span class="hljs-title"><span class="hljs-title">Book</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BookMap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Id(x =&gt; x.Id, map =&gt; map.Generator(Generators.Native)); Property(x=&gt;x.Name); Property(x=&gt;x.Description); }</code> </pre><br><br>  <b>3.1 Relationships (In Tables)</b> <br>  <b>Many-to-many</b> <br><table border="1"><tbody><tr><th>  Book.cs </th><th>  Author.cs </th></tr><tr><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ISet&lt;Author&gt; _authors; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ISet&lt;Author&gt; Authors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _authors ?? (_authors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;Author&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _author = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ISet&lt;Book&gt; _books; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ISet&lt;Book&gt; Books{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _books?? (_books= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;Book&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _books= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td></tr><tr><th>  BookMap.cs </th><th>  AuthorMap.cs </th></tr><tr><td><pre> <code class="cs hljs">Set(a =&gt; a.Authors, c =&gt; { c.Cascade(Cascade.Persist); c.Key(k =&gt; k.Column(<span class="hljs-string"><span class="hljs-string">"BookId"</span></span>)); c.Table(<span class="hljs-string"><span class="hljs-string">"Book_Author"</span></span>);}, r=&gt;r.ManyToMany(m=&gt;m.Column(<span class="hljs-string"><span class="hljs-string">"AuthorId"</span></span>)));</code> </pre><br></td><td><pre> <code class="cs hljs">Set(a =&gt; a.Books, c =&gt; { c.Cascade(Cascade.All); c.Key(k =&gt; k.Column(<span class="hljs-string"><span class="hljs-string">"AuthorId"</span></span>)); c.Table(<span class="hljs-string"><span class="hljs-string">"Book_Author"</span></span>); c.Inverse(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }, r =&gt; r.ManyToMany(m =&gt; m.Column(<span class="hljs-string"><span class="hljs-string">"BookId"</span></span>)));</code> </pre><br></td></tr></tbody></table><br>  <b>Many-to-one, one-to-many</b> <br><table border="1"><tbody><tr><th>  Book.cs </th><th>  Series.cs </th></tr><tr><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Series Series { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br></td><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IList&lt;Book&gt; _books; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> IList&lt;Book&gt; Books{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _books?? (_books= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Book&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _books= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td></tr><tr><th>  BookMap.cs </th><th>  SeriesMap.cs </th></tr><tr><td><pre> <code class="cs hljs">ManyToOne(x =&gt; x.Series, c =&gt; { c.Cascade(Cascade.Persist); c.Column(<span class="hljs-string"><span class="hljs-string">"Series_Id"</span></span>); });</code> </pre><br></td><td><pre> <code class="cs hljs">Bag(x =&gt; x.Books, c =&gt; { c.Key(k =&gt; k.Column(<span class="hljs-string"><span class="hljs-string">"Series_Id"</span></span>)); c.Inverse(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }, r =&gt; r.OneToMany());</code> </pre><br></td></tr></tbody></table><br><br>  <b>One to one</b> <br><table border="1"><tbody><tr><th>  Book.cs </th><th>  Mind.cs </th></tr><tr><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Mind _mind; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Mind Mind { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _mind ?? (_mind = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mind()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _mind = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Book Book { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br></td></tr><tr><th>  BookMap.cs </th><th>  MindMap.cs </th></tr><tr><td><pre> <code class="cs hljs">OneToOne(x=&gt;x.Mind, c=&gt;{c.Cascade(Cascade.All); c.Constrained(<span class="hljs-literal"><span class="hljs-literal">true</span></span>);});</code> </pre><br></td><td><pre> <code class="cs hljs">OneToOne(x=&gt;x.Book, c=&gt;c.Cascade(Cascade.None));</code> </pre><br></td></tr></tbody></table><br><br>  Detailed information here <a href="http://stackoverflow.com/questions/5777898/docs-examples-for-nhibernate-3-2-mapping-by-code">StackOverflow Mapping-by-Code</a> <br><br>  <b>4. FLUENT</b> <br>  It offers an alternative to the standard mapping of NHibernate XML files.  Instead of writing XML files, you write mappings in strongly typed C # code (via lambda expressions).  Due to this, there is a refactoring, improved readability and ease of writing code. <br>  Pros: <br>  + 100% intellisense support! <br>  + <a href="https://github.com/jagregory/fluent-nhibernate/wiki">Fluent-Nhibernate</a> Excellent Documentation <br>  + Validation at compile time <br>  + No need to create a file Nhibernate.cfg.xml, all settings, including the connection string, can be written in the NhibernateHelper. <br>  Minuses: <br>  ‚ÄúCompared to other versions of NHibernate, there is a slightly unusual mapping syntax. <br><br>  Since FluentNhibernate and Nhibernate are a bit different, let me write as if I were re-creating the application?  So let's start, create a new application. <br><ol><li>  In the <i>Package Manager Console, we</i> specify install-package fluentnhibernate </li><li>  In the folder "Models" create a class "Book.cs" (Models-&gt; Book.cs) </li><li>  Add the NHibernate folder to Models and create the NHibernateHelper.cs class (Models-&gt; NHibernate-&gt; NHibernateHelper.cs) </li></ol><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NHibernateHelper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ISession </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenSession</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ISessionFactory sessionFactory = Fluently.Configure() .Database(MsSqlConfiguration.MsSql2008.ConnectionString(<span class="hljs-string"><span class="hljs-string">@"Server=..\SQLENTERPRISE; initial catalog= Biblioteca; Integrated Security=SSPI;"</span></span>).ShowSql() ) .Mappings(m =&gt;m.FluentMappings.AddFromAssemblyOf&lt;Book&gt;()) .ExposeConfiguration(cfg =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaUpdate(cfg).Execute(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) .BuildSessionFactory(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sessionFactory.OpenSession(); } }</code> </pre><br><br>  In this NhibernateHelper.cs it should be noted that now we write the connection string to the database here.  And yes, there are lambda expressions. <br><br>  Fill the class Book.cs <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Book</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  and create a mapping class for it <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BookMap</span></span> : <span class="hljs-title"><span class="hljs-title">ClassMap</span></span>&lt;<span class="hljs-title"><span class="hljs-title">Book</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BookMap</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Id(x =&gt; x.Id); Map(x =&gt; x.Name); Map(x =&gt; x.Description); } }</code> </pre><br>  Next, create a HomeController class in the Controllers folder and write the following code. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> session = NHibernateHelper.OpenSession(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(); }</code> </pre><br>  Create any View, and after running the application in SQL Server, the Book table will be created. <br><br>  <b>4.1 Relationships (In Tables)</b> <br>  <b>Many-to-many</b> <br><table border="1"><tbody><tr><th>  Book.cs </th><th>  Author.cs </th></tr><tr><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ISet&lt;Author&gt; _authors; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ISet&lt;Author&gt; Authors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _authors ?? (_authors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;Author&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _author = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ISet&lt;Book&gt; _books; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ISet&lt;Book&gt; Books{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _books?? (_books= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;Book&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _books= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td></tr><tr><th>  BookMap.cs </th><th>  AuthorMap.cs </th></tr><tr><td><pre> <code class="cs hljs">HasManyToMany(x =&gt; x.Authors) .Cascade.SaveUpdate() .Table(<span class="hljs-string"><span class="hljs-string">"Book_Author"</span></span>);</code> </pre><br></td><td><pre> <code class="cs hljs">HasManyToMany(x =&gt; x.Books) .Cascade.All() .Inverse().Table(<span class="hljs-string"><span class="hljs-string">"Book_Author"</span></span>);</code> </pre><br></td></tr></tbody></table><br>  <b>Many-to-one, one-to-many</b> <br><table border="1"><tbody><tr><th>  Book.cs </th><th>  Series.cs </th></tr><tr><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Series Series { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br></td><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IList&lt;Book&gt; _books; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> IList&lt;Book&gt; Books{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _books?? (_books= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Book&gt;()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _books= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td></tr><tr><th>  BookMap.cs </th><th>  SeriesMap.cs </th></tr><tr><td><pre> <code class="cs hljs">References(x =&gt; x.Series).Cascade.SaveUpdate();</code> </pre><br></td><td><pre> <code class="cs hljs">HasMany(x =&gt; x.Books) .Inverse();</code> </pre><br></td></tr></tbody></table><br>  The References method is applied on the many-to-one side, on the other side, the one-to-many method is HasMany. <br><br>  <b>One to one</b> <br><table border="1"><tbody><tr><th>  Book.cs </th><th>  Mind.cs </th></tr><tr><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Mind _mind; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Mind Mind { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _mind ?? (_mind = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mind()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _mind = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br></td><td><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Book Book { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br></td></tr><tr><th>  BookMap.cs </th><th>  MindMap.cs </th></tr><tr><td><pre> <code class="cs hljs">HasOne(x =&gt; x.Mind).Cascade.All().Constrained();</code> </pre><br></td><td><pre> <code class="cs hljs">HasOne(x =&gt; x.Book);</code> </pre><br></td></tr></tbody></table><br>  The .Constrained () method tells NHibernate that a record from the Mind table must match the record from the Book table (the Mind table id must be equal to the Book table id) <br><br>  <b>Query Options (NHibernate Queries)</b> <br><br>  NHibernate has powerful query creation tools such as. <br><ul><li>  The session.Get and session.Load methods.  Obtaining (list) of object (s) by primary key. </li><li>  SQL (CreateSQLQuery method) - mainly used to convert a SQL script to a specific class </li><li>  HQL is a SQL-like language, well suited for static queries. </li><li>  LINQ to NHibernate - In NHibernate 2x, linq queries were set by the ISession.Linq &lt;T&gt; interface, which worked well for simple queries.  With the release of Nhibernate 3 (the interface has changed to ISession.Query &lt;T&gt;), it gained more opportunities, although it was not widely used among programmers </li><li> Criteria ( ) ‚Äî      ,     . </li><li> QueryOver ( ) ‚Äî     NHibernate 3.       ,  intellisense </li></ul><br><br> <b>  </b> <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   , ( Get  Load) var book = session.Get&lt;Book&gt;(1);</span></span></code> </pre><br> <b> SQLCreateQuery</b> <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//SQl- var queryBook = string.Format(@"select Id, Name, Description from Book"); //    var books = session.CreateSQLQuery(queryBook) //SQl-    .SetResultTransformer(Transformers.AliasToBean(typeof(Book))) .List&lt;Book&gt;().ToList();</span></span></code> </pre><br> <b>Lists with restrictions</b> <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//hql var hqlQuery = session.CreateQuery("from Book b where b.Series.Id = ? order by p.Id") // 0   int=2 .SetInt32(0,2); var books = hqlQuery.List&lt;Book&gt;(); //NHibernate.Linq (session.Linq in NH 2/session.Query in NH3) var linq = (from book in session.Query&lt;Book&gt;() where book.Series.Id == 2 orderby book.Id select book); var books = linq.ToList(); return View(books); //criteria var criteria = session.CreateCriteria&lt;Book&gt;() //"Restrictions"   "Expression" .Add(Restrictions.Eq("Series.Id", 3)) //Order .AddOrder(Order.Asc("Id")); var books = criteria.List&lt;Book&gt;(); //query over var queryOver = session.QueryOver&lt;Book&gt;() .Where(x =&gt; x.Series.Id == 2) .OrderBy(x =&gt; x.Id).Asc; var books = queryOver.List(); return View(books);</span></span></code> </pre><br><br>       NHibernate Query,   Join, Projecting  ,  ,        <a href="http://www.martinwilley.com/net/code/nhibernate/query.html">NHibernate Queries</a>  <a href="http://www.martinwilley.com/net/code/nhibernate/query2.html">NHibernate More Queries</a> <br><br>    QueryOver,        <a href="http://nhibernate.info/blog/2009/12/17/queryover-in-nh-3-0.html">QueryOver in NH3</a> <br><br>    ,       . <br><br> <b>Lazy  eager-loading (¬´¬ª  ¬´¬ª )</b> <br> Lazy loading  eager loading ‚Äî  ,   NHibernate      navigation properties  <br> -&gt; <b>Lazyloading ‚Äî  </b> .      (Book),     . ,     navigation property (Book.Genres),    .       :           . <br><br><pre> <code class="hljs pgsql">//   (<span class="hljs-keyword"><span class="hljs-keyword">View</span></span>) @<span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (var item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Model) { //     Book @<span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (var genre <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> item.Genres) { //   Genres,    Book @Html.DisplayFor(modelItem =&gt; genre.Name) &lt;br /&gt; } }</code> </pre><br> -&gt; <b>Eagerloading ‚Äî  </b> .      .     join,    . <br><pre> <code class="hljs pgsql">//   (<span class="hljs-keyword"><span class="hljs-keyword">View</span></span>) @<span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (var item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Model) { //    Book     . @<span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (var genre <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> item.Genres) { @Html.DisplayFor(modelItem =&gt; genre.Name) &lt;br /&gt; } }</code> </pre><br><br>  ¬´¬ª  NHibernate  Fetch strategies. <br><br>   EagerLoading  LazyLoading ,   Query Over. <br> ---Query Over ‚Äî  Lazyloading --- <br><pre> <code class="hljs javascript"> using (ISession session = NHibernateHelper.OpenSession()) { Genre genreAl = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Author authorAl = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; Series seriesAl = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> books = session.QueryOver&lt;Book&gt;<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> //</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Left</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Join</span></span></span><span class="hljs-function">   </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Genres</span></span></span><span class="hljs-function"> .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">JoinAlias</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p =&gt; p.Authors, (</span></span></span><span class="hljs-function">) =&gt;</span></span> authorAl, JoinType.LeftOuterJoin) .JoinAlias(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p</span></span></span><span class="hljs-function"> =&gt;</span></span> p.Series, () =&gt; seriesAl, JoinType.LeftOuterJoin) <span class="hljs-comment"><span class="hljs-comment">//  id   Book. .TransformUsing(Transformers.DistinctRootEntity).List(); return View(books); }</span></span></code> </pre><br> ---Query Over ‚Äî  EagerLoading --- <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (ISession <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> = NHibernateHelper.OpenSession()) { var books = <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.QueryOver&lt;Book&gt;() .<span class="hljs-keyword"><span class="hljs-keyword">Fetch</span></span>(a =&gt; a.Authors).Eager.<span class="hljs-keyword"><span class="hljs-keyword">Fetch</span></span>(s =&gt; s.Series).Eager .TransformUsing(Transformers.DistinctRootEntity).List(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">View</span></span>(books);</code> </pre><br>   ,    LeftJoin    ,   Fetch     Book  . <br><br>  Fecth ‚Äî      <a href="http://blog.raffaeu.com/archive/2014/07/04/nhibernate-fetch-strategies.aspx">Nhibernate Fetch strategy</a>      lazy  eager loading ‚Äî  <a href="http://ser4ik.livejournal.com/2505.html"> lazy, fetch  batch-size</a> .     <a href="http://nhibernate.info/doc/howto/various/lazy-loading-eager-loading.html">NhibernateInfo ‚Äî lazy-eager loading</a> <br><br>    ,   . </div><p>Source: <a href="https://habr.com/ru/post/265371/">https://habr.com/ru/post/265371/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265355/index.html">Intervals in C ++, part 4: to infinity and beyond</a></li>
<li><a href="../265357/index.html">Minimalistic Mobile Layout</a></li>
<li><a href="../265361/index.html">The evolution of marketing: from a small online store to a hypermarket</a></li>
<li><a href="../265365/index.html">Tinkoff Bank compromised customer account statements?</a></li>
<li><a href="../265367/index.html">Wikipedia is no longer blocked</a></li>
<li><a href="../265373/index.html">Look at the root: java.lang.Object</a></li>
<li><a href="../265375/index.html">Excel Lemmatization, or "Robot Recognizer 3.0"</a></li>
<li><a href="../265377/index.html">The digest of interesting materials from the world of Drupal # 12</a></li>
<li><a href="../265381/index.html">Webix + databoom = rapid application prototyping. Part 2</a></li>
<li><a href="../265383/index.html">To help the analyst: we write our automatic download of Yandex.Metrica reports using AWS for free</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>