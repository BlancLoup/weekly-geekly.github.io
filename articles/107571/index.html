<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing Asterisk in an OpenVZ Ubuntu 10.04.1 LTS container on a Debian GNU / Linux 5.0 host</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Initial data: 


- Asterisk 1.6.2 - from the native Ubuntu repository 
- Ubuntu 10.04.1 LTS - minimum installation container (x64bit) 
- Host system f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing Asterisk in an OpenVZ Ubuntu 10.04.1 LTS container on a Debian GNU / Linux 5.0 host</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/f6/c9/f6c9dad7e2084679d53ce3122510a598.jpg" alt="image"><br><h3>  Initial data: </h3><br><ul><li>  Asterisk 1.6.2 - from the native Ubuntu repository </li><li>  Ubuntu 10.04.1 LTS - minimum installation container (x64bit) </li><li>  Host system for OpenVZ - Debian GNU / Linux 5.0 (Lenny) 2.6.26-2-openvz-amd64 - kernel from native repository. </li></ul><br>  Install and configure OpenVZ host.  Features settings OpenVZ host here will not be considered. <br>  We believe that we have it correctly configured, including NAT for guest machines and forwarding ports necessary for the server. <br><a name="habracut"></a><br><h3>  Downloading the template for the guest OS </h3><br> <code><a href=""></a> cd /var/lib/vz/template/cache <br> wget download.openvz.org/template/precreated/contrib/ubuntu-10.04-minimal_10.04_amd64.tar.gz</code> <br> <br><h3>  Create and set up a container </h3><br> <code>sudo vzctl create 101 --ostemplate ubuntu-10.04-minimal_10.04_amd64</code> <br>  Created a container with ID = 101 from our template <br> <code>sudo vzctl set 101 --name voip --save</code> <br>  set the name of the container <br> <code>sudo vzctl set 101 --hostname voip.hurnet.ru --save</code> <br>  set the host name for the container <br> <code>sudo vzctl set 101 --nameserver 8.8.8.8 --save</code> <br>  set the DNS for the container <br> <code>sudo vzctl set 101 --description 'Asterisk VoIP server' --save</code> <br>  container description <br> <code>sudo vzctl set 101 --ipadd 192.168.xxx.xxx --save</code> <br>  Set the network interface address <br> <code>sudo vzctl set 101 --cpulimit 60 --save</code> <br>  set a limit on processor usage <br> <code>sudo vzctl set 101 --diskspace 9000000:10000000 --save</code> <br>  9GB disk space quota (temporary excess to 10GB) <br> <code>sudo vzctl set 101 --quotatime 6000 --save</code> <br>  time at which you can exceed the quota <br> <code>sudo vzctl set 101 --privvmpages 750M:768M --save</code> <br>  Available memory count <br> <code>sudo vzctl set 101 --vmguarpages 250M:256M --save</code> <br>  Guaranteed amount of memory <br> <code>sudo vzctl start 101</code> <br>  we start <br> <code>sudo vzctl enter 101</code> <br>  go in the container <br> <code>apt-get update <br> apt-get upgrade</code> <br>  updated <br> <code>sudo vzctl restart 101</code> <br>  (execute on the host machine, and go back to the container) <br> <code>sudo apt-get install asterisk</code> <br> <br><h3>  We put asterisk </h3><br>  He will pull the necessary dependencies by himself.  During the installation process will ask the phone <br>  the region code (for Russia is 7), and a couple of questions about grub (not relevant, since the kernel and the loader cannot be changed from the container) There will be attempts to put it all with a bunch of errors - do not pay attention, wait patiently for the installation to finish. <br><br>  We download Russian sound phrases from here <a title="http://ivrvoice.ru/downloader" href="http://ivrvoice.ru/downloader">http://ivrvoice.ru/downloader</a> <br>  We take the most recent archive.  In my case, this is asterisk- sounds- rugsm- 2010-04-28. Tar. Gz <br> <code><a href="http://ivrvoice.ru/downloader/download/file/11"></a> cd /usr/share/asterisk/sounds/ <br> wget ivrvoice.ru/downloader/download/file/11 <br> tar xvfz 11 <br> rm 11</code> <br> <br><h3>  Getting started asterisk setup </h3><br>  Go to /etc/asterisk/sip.conf, find, uncomment and fix the option <br> <code>language=ru</code> <br>  In the [general] section, uncomment the option <code>allowguest=no</code> <br>  At the end of the file create a new section. <br> <code>[200] ; Test user <br> type=friend <br> host=dynamic <br> username=200 <br> secret=123 <br> nat=no <br> canreinvite=no <br> context=office <br> callerid=‚Äùtestuser‚Ä≥ &lt;200&gt; <br> allow=gsm <br> allow=ulaw <br> allow=alaw</code> <br>  With this we created one test user.  the detailed syntax and description must be read in the documentation. <br><br>  Then we create extensions at the end of the /etc/asterisk/extensions.conf file. <br> <code>[office] <br> exten =&gt; 200,1, Macro(stdexten,200,SIP/200) <br> exten =&gt; testuser, 1, Goto(200|1) <br> include =&gt; demo <br> <br> [macro-stdexten] <br> exten =&gt; s, 1, Dial (${ARG2},20,t [4] ) <br> exten =&gt; s, 2, Goto(s-$(DIALSTATUS),1) <br> exten =&gt; s-NOANSWER, 1, Voicemail(u${ARG1}) <br> exten =&gt; s-NOANSWER, 2, (Goto(default,s,1)) <br> exten =&gt; s-BUSY, 1, Voicemail(b,${ARG1}) <br> exten =&gt; s-BUSY, 2, (Goto(default,s,1)) <br> exten =&gt; _s-., 1, Goto(s-NOANSWER) <br> exten =&gt; a, 1, VoiceMailMain(${ARG1})</code> <br> <br><h3>  Configure human integration into the asterisk system </h3><br>  Create a group and user from which the asterisk will work in the system: <br> <code>addgroup --gid 109 asterisk <br> adduser --home /var/lib/asterisk --shel /bin/false --uid 104 --gid 109 --disabled-login asterisk <br> adduser asterisk dialout <br> adduser asterisk audio</code> <br>  It should turn out like this: <br> <code># cat /etc/group |grep asterisk <br> dialout:x:20:asterisk <br> audio:x:29:asterisk <br> asterisk:x:109: <br> # cat /etc/passwd |grep asterisk <br> asterisk:x:104:109:Asterisk PBX daemon,,,:/var/lib/asterisk:/bin/false</code> <br> <br>  We set the necessary file permissions <br> <code>chown -R asterisk. /etc/asterisk <br> chown -R asterisk. /var/{lib,log,spool}/asterisk <br> chown -R asterisk. /usr/share/asterisk/ <br> mkdir /var/run/asterisk <br> chown -R asterisk. /var/run/asterisk/</code> <br> <br>  Create a startup script: <br>  <code>nano /etc/init.d/asterisk</code> with the following content: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote>  <font color="#666666">#!</font>  <font color="#666666">/ bin / sh</font> <br>  <font color="#666666">#</font> <br>  <font color="#666666"># asterisk start the asterisk PBX</font> <br>  <font color="#666666"># ¬© Mark Purcell &lt;msp@debian.org&gt;</font> <br>  <font color="#666666"># ¬© Tzafrir Cohen &lt;tzafrir.cohen@xorcom.com&gt;</font> <br>  <font color="#666666"># ¬© Faidon Liambotis &lt;paravoid@debian.org&gt;</font> <br><br>  <font color="#666666"># This package is free software;</font>  <font color="#666666">you can redistribute it and / or modify</font> <br>  <font color="#666666"># it under the GNU General Public License as published by</font> <br>  <font color="#666666"># the Free Software Foundation;</font>  <font color="#666666">either version 2 of the License, or</font> <br>  <font color="#666666"># (at your option) any later version.</font> <br>  <font color="#666666">#</font> <br>  <font color="#666666"># Based on:</font> <br>  <font color="#666666">#</font> <br>  <font color="#666666"># skeleton example file to build /etc/init.d/ scripts.</font> <br>  <font color="#666666"># This file should be used to construct scripts for /etc/init.d.</font> <br>  <font color="#666666">#</font> <br>  <font color="#666666"># Written by Miquel van Smoorenburg &lt;miquels@cistron.nl&gt;.</font> <br>  <font color="#666666"># Modified for Debian GNU / Linux</font> <br>  <font color="#666666"># by Ian Murdock &lt;imurdock@gnu.ai.mit.edu&gt;.</font> <br>  <font color="#666666">#</font> <br>  <font color="#666666"># Version: @ (#) skeleton 1.9 26-Feb-2001 miquels@cistron.nl</font> <br>  <font color="#666666">#</font> <br><br>  <font color="#666666">### BEGIN INIT INFO</font> <br>  <font color="#666666"># Provides: asterisk</font> <br>  <font color="#666666"># Required-Start: $ local_fs zaptel</font> <br>  <font color="#666666"># Required-Stop: $ local_fs</font> <br>  <font color="#666666"># Should-start:</font> <br>  <font color="#666666"># Should-Stop:</font> <br>  <font color="#666666"># Default-Start: 2 3 4 5</font> <br>  <font color="#666666"># Default-Stop: 0 1 6</font> <br>  <font color="#666666"># Short-Description: Asterisk PBX</font> <br>  <font color="#666666"># Description: Controls the Asterisk PBX</font> <br>  <font color="#666666">### END INIT INFO</font> <br><br>  <font color="#007800">PATH</font> = <font color="#000000">/</font> usr <font color="#000000">/</font> local <font color="#000000">/</font> sbin: <font color="#000000">/</font> usr <font color="#000000">/</font> local <font color="#000000">/</font> bin: <font color="#000000">/</font> sbin: <font color="#000000">/</font> bin: <font color="#000000">/</font> usr <font color="#000000">/</font> sbin: <font color="#000000">/</font> usr <font color="#000000">/</font> bin <br>  <font color="#007800">NAME</font> = asterisk <br>  <font color="#007800">USER</font> = <font color="#007800">$ NAME</font> <br>  <font color="#007800">GROUP</font> = <font color="#007800">$ USER</font> <br>  <font color="#007800">DAEMON</font> = <font color="#000000">/</font> usr <font color="#000000">/</font> sbin <font color="#000000">/</font> <font color="#007800">$ NAME</font> <br>  <font color="#007800">DESC</font> = <font color="#ff0000">"Asterisk PBX"</font> <br>  <font color="#007800">PIDFILE</font> = <font color="#ff0000">"/var/run/asterisk/asterisk.pid"</font> <br>  <font color="#007800">ASTSAFE_PIDFILE</font> = <font color="#ff0000">"/var/run/asterisk/asterisk_safe.pid"</font> <br>  <font color="#007800">PIDFILE_DIR</font> = <font color="#000000">`</font> <font color="#c20cb9">dirname</font> <font color="#007800">$ PIDFILE`</font> <br>  <font color="#007800">UMASK</font> = 007 <font color="#666666"># by default</font> <br>  <font color="#666666"># MAXFILES = 1024 # (the system default)</font> <br><br>  <font color="#666666"># by default: use real-time priority</font> <br>  <font color="#007800">PARAMS</font> = <font color="#ff0000">""</font> <br>  <font color="#007800">CHDIR_PARM</font> = <font color="#ff0000">""</font> <br>  <font color="#007800">AST_REALTIME</font> = <font color="#ff0000">"yes"</font> <br>  <font color="#007800">RUNASTERISK</font> = <font color="#ff0000">"yes"</font> <br>  <font color="#007800">AST_DUMPCORE</font> = <font color="#ff0000">"no"</font> <br>  <font color="#007800">AST_DUMPCORE_DIR</font> = <font color="#ff0000">"/ var / spool / asterisk"</font> <font color="#666666"># only used if AST_DUMPCORE! = No</font> <br>  <font color="#666666"># core_pattern.</font>  <font color="#666666">See: http://lxr.linux.no/source/Documentation/sysctl/kernel.txt</font> <br>  <font color="#666666"># CORE_PATTERN =</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#660033">-r</font> <font color="#000000">/</font> etc <font color="#000000">/</font> default <font color="#000000">/</font> <font color="#007800">$ NAME</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> .  <font color="#000000">/</font> etc <font color="#000000">/</font> default <font color="#000000">/</font> <font color="#007800">$ NAME</font> ;  <font color="#000000">fi</font> <br><br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ RUNASTERISK</font> "</font> <font color="#000000">!</font>  = <font color="#ff0000">"yes"</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">"Asterisk not yet configured. Edit / etc / default / asterisk first."</font> <br>  <font color="#7a0874">exit</font> <font color="#000000">0</font> <br>  <font color="#000000">fi</font> <br><br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ AST_REALTIME</font> "</font> <font color="#000000">!</font>  = <font color="#ff0000">"no"</font> <font color="#7a0874">]</font> <br>  <font color="#000000">then</font> <br>  <font color="#007800">PARAMS</font> = <font color="#ff0000">" <font color="#007800">$ PARAMS</font> -p"</font> <br>  <font color="#000000">fi</font> <br><br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ AST_DUMPCORE</font> "</font> <font color="#000000">!</font>  = <font color="#ff0000">"no"</font> <font color="#7a0874">]</font> <br>  <font color="#000000">then</font> <br>  <font color="#007800">PARAMS</font> = <font color="#ff0000">" <font color="#007800">$ PARAMS</font> -g"</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ CORE_PATTERN</font> "</font> <font color="#000000">!</font>  = <font color="#ff0000">''</font> <font color="#7a0874">]</font> <br>  <font color="#000000">then</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">" <font color="#007800">$ CORE_PATTERN</font> "</font> <font color="#000000">&gt; /</font> proc <font color="#000000">/</font> sys <font color="#000000">/</font> kernel <font color="#000000">/</font> core_pattern <br>  <font color="#000000">fi</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#660033">-d</font> <font color="#ff0000">" <font color="#007800">$ AST_DUMPCORE_DIR</font> "</font> <font color="#7a0874">]</font> <br>  <font color="#000000">then</font> <br>  <font color="#007800">CHDIR_PARM</font> = <font color="#ff0000">"--chdir <font color="#007800">$ AST_DUMPCORE_DIR</font> "</font> <br>  <font color="#000000">fi</font> <br>  <font color="#000000">fi</font> <br><br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">"x <font color="#007800">$ USER</font> "</font> = <font color="#ff0000">"x"</font> <font color="#7a0874">]</font> <br>  <font color="#000000">then</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">"Error: empty USER name"</font> <br>  <font color="#7a0874">exit</font> <font color="#000000">1</font> <br>  <font color="#000000">fi</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#000000">`</font> <font color="#c20cb9">id</font> <font color="#660033">-u</font> <font color="#ff0000">" <font color="#007800">$ USER</font> "</font> <font color="#000000">`</font> = <font color="#000000">0</font> <font color="#7a0874">]</font> <br>  <font color="#000000">then</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">"Starting as root not supported."</font> <br>  <font color="#7a0874">exit</font> <font color="#000000">1</font> <br>  <font color="#000000">fi</font> <br>  <font color="#007800">PARAMS</font> = <font color="#ff0000">" <font color="#007800">$ PARAMS</font> -U <font color="#007800">$ USER</font> "</font> <br><br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">"x <font color="#007800">$ AST_DEBUG_PARAMS</font> "</font> = x <font color="#7a0874">]</font> <br>  <font color="#000000">then</font> <br>  <font color="#007800">AST_DEBUG_PARAMS</font> = -cvvvvvddddd <br>  <font color="#000000">fi</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ RUNASTSAFE</font> "</font> = <font color="#ff0000">"yes"</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  <font color="#666666"># The value of WRAPPER_DAEMON in can be set in / etc / default / asterisk</font> <br>  <font color="#007800">WRAPPER_DAEMON</font> = <font color="#800000">$ {WRAPPER_DAEMON: - / usr / sbin / safe_asterisk}</font> <br>  <font color="#007800">REALDAEMON</font> = <font color="#ff0000">" <font color="#007800">$ WRAPPER_DAEMON</font> "</font> <br>  <font color="#000000">else</font> <br>  <font color="#007800">REALDAEMON</font> = <font color="#ff0000">" <font color="#007800">$ DAEMON</font> "</font> <br>  <font color="#000000">fi</font> <br><br>  <font color="#7a0874">test</font> <font color="#660033">-x</font> <font color="#007800">$ DAEMON</font> <font color="#000000">||</font>  <font color="#7a0874">exit</font> <font color="#000000">0</font> <br><br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#000000">!</font>  <font color="#660033">-d</font> <font color="#ff0000">" <font color="#007800">$ PIDFILE_DIR</font> "</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  <font color="#c20cb9">mkdir</font> <font color="#ff0000">" <font color="#007800">$ PIDFILE_DIR</font> "</font> <br>  <font color="#c20cb9">chown</font> <font color="#007800">$ USER</font> : <font color="#007800">$ GROUP</font> <font color="#ff0000">" <font color="#007800">$ PIDFILE_DIR</font> "</font> <br>  <font color="#000000">fi</font> <br><br>  <font color="#000000">set</font> <font color="#660033">-e</font> <br><br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ UMASK</font> "</font> <font color="#000000">!</font>  = <font color="#ff0000">''</font> <font color="#7a0874">]</font> <br>  <font color="#000000">then</font> <br>  <font color="#7a0874">umask</font> <font color="#007800">$ UMASK</font> <br>  <font color="#000000">fi</font> <br><br>  <font color="#666666"># allow changing the per-process open files limit:</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ MAXFILES</font> "</font> <font color="#000000">!</font>  = <font color="#ff0000">''</font> <font color="#7a0874">]</font> <br>  <font color="#000000">then</font> <br>  <font color="#7a0874">ulimit</font> <font color="#660033">-n</font> <font color="#007800">$ MAXFILES</font> <br>  <font color="#000000">fi</font> <br><br>  status <font color="#7a0874">(</font> <font color="#7a0874">)</font> <font color="#7a0874">{</font> <br>  <font color="#007800">plist</font> = <font color="#000000">`</font> <font color="#c20cb9">ps</font> ax <font color="#000000">|</font>  <font color="#c20cb9">awk</font> <font color="#ff0000">"{if (\ <font color="#000099">\ $</font> 5 == <font color="#000099">\"</font> <font color="#007800">$ DAEMON</font> <font color="#000099">\ "</font> ) print \ <font color="#000099">\ $</font> 1}"</font> <font color="#000000">`</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ plist</font> "</font> = <font color="#ff0000">""</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">" <font color="#007800">$ DESC</font> is stopped"</font> <br>  <font color="#7a0874">return</font> <font color="#000000">1</font> <br>  <font color="#000000">else</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">" <font color="#007800">$ DESC</font> is running: <font color="#007800">$ plist</font> "</font> <br>  <font color="#7a0874">return</font> <font color="#000000">0</font> <br>  <font color="#000000">fi</font> <br>  <font color="#7a0874">}</font> <br><br>  asterisk_rx <font color="#7a0874">(</font> <font color="#7a0874">)</font> <font color="#7a0874">{</font> <br>  <font color="#000000">if</font> <font color="#000000">!</font>  status <font color="#000000">&gt; /</font> dev <font color="#000000">/</font> null;  <font color="#000000">then</font> <font color="#7a0874">return</font> <font color="#000000">0</font> ;  <font color="#000000">fi</font> <br><br>  <font color="#666666"># if $ HOME is set, asterisk -rx writes a .asterisk_history there</font> <br>  <font color="#7a0874">(</font> <br>  <font color="#7a0874">unset</font> HOME <br><br>  <font color="#007800">$ DAEMON</font> <font color="#660033">-rx</font> <font color="#ff0000">"$ 1"</font> <br>  <font color="#7a0874">)</font> <br>  <font color="#7a0874">}</font> <br><br>  <font color="#000000">case</font> <font color="#ff0000">"$ 1"</font> <font color="#000000">in</font> <br>  debug <font color="#7a0874">)</font> <br>  <font color="#666666"># we add to skip</font> <br>  <font color="#666666"># accidentally.</font>  <font color="#666666">Once may cause</font> <br>  <font color="#666666"># confusing results.</font>  <font color="#666666">I also want to maintain the user's choice</font> <br>  <font color="#666666"># of -p</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">"Debugging <font color="#007800">$ DESC</font> :"</font> <br>  <font color="#007800">$ DAEMON</font> <font color="#007800">$ PARAMS</font> <font color="#007800">$ AST_DEBUG_PARAMS</font> <br>  <font color="#7a0874">exit</font> <font color="#000000">0</font> <br>  <font color="#000000">;;</font> <br>  start <font color="#7a0874">)</font> <br>  <font color="#000000">if</font> status <font color="#000000">&gt;</font> <font color="#000000">/</font> dev <font color="#000000">/</font> null;  <font color="#000000">then</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">" <font color="#007800">$ DESC</font> is already running. Use restart."</font> <br>  <font color="#7a0874">exit</font> <font color="#000000">0</font> <br>  <font color="#000000">fi</font> <br>  <font color="#7a0874">echo</font> <font color="#660033">-n</font> <font color="#ff0000">"Starting <font color="#007800">$ DESC</font> :"</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ RUNASTSAFE</font> "</font> <font color="#000000">!</font>  = <font color="#ff0000">"yes"</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  <font color="#666666"># TODO: asterisk</font> <br>  <font color="#666666"># was killed?</font>  <font color="#666666">status should check for wrapper</font> <br>  <font color="#666666"># "safe mode"</font> <br>  <font color="#000000">if</font> status <font color="#000000">&gt;</font> <font color="#000000">/</font> dev <font color="#000000">/</font> null;  <font color="#000000">then</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">" <font color="#007800">$ DESC</font> is already running. Use restart."</font> <br>  <font color="#7a0874">exit</font> <font color="#000000">0</font> <br>  <font color="#000000">fi</font> <br>  start-stop-daemon <font color="#660033">-</font> start - <font color="#660033">group</font> <font color="#007800">$ GROUP -</font> <font color="#660033">pidfile</font> <font color="#ff0000">" <font color="#007800">$ PIDFILE</font> "</font> \ <br>  <font color="#007800">$ CHDIR_PARM</font> \ <br>  <font color="#660033">--exec</font> <font color="#007800">$ REALDAEMON</font> <font color="#660033">-</font> <font color="#007800">$ PARAMS</font> <br>  <font color="#000000">else</font> <br>  start-stop-daemon <font color="#660033">-</font> start - <font color="#660033">group</font> <font color="#007800">$ GROUP</font> \ <br>  <font color="#660033">--background</font> <font color="#660033">--make-pidfile</font> \ <br>  <font color="#007800">$ CHDIR_PARM</font> <font color="#660033">--pidfile</font> <font color="#ff0000">" <font color="#007800">$ ASTSAFE_PIDFILE</font> "</font> \ <br>  <font color="#660033">--exec</font> <font color="#007800">$ REALDAEMON</font> <font color="#660033">-</font> <font color="#007800">$ PARAMS</font> <br>  <font color="#000000">fi</font> <br><br><br>  <font color="#7a0874">echo</font> <font color="#ff0000">" <font color="#007800">$ NAME</font> ."</font> <br>  <font color="#000000">;;</font> <br>  stop <font color="#7a0874">)</font> <br>  <font color="#7a0874">echo</font> <font color="#660033">-n</font> <font color="#ff0000">"Stopping <font color="#007800">$ DESC</font> : <font color="#007800">$ NAME</font> "</font> <br>  <font color="#666666"># Try gracefully.</font> <br>  <font color="#666666"># this may hang in some cases.</font>  <font color="#666666">Specifically, when the asterisk</font> <br>  <font color="#666666"># processes is stopped.</font>  <font color="#666666">No bother to worry about cleanup:</font> <br>  <font color="#666666">asterisk dies.</font> <br>  <font color="#7a0874">(</font> asterisk_rx <font color="#ff0000">'stop now'</font> <font color="#000000">&gt;</font> <font color="#000000">/</font> dev <font color="#000000">/</font> null <font color="#000000">2</font> <font color="#000000">&gt; &amp;</font> <font color="#000000">1</font> <font color="#000000">&amp;</font> <font color="#7a0874">)</font> <font color="#000000">&amp;</font> <br>  <font color="#000000">if</font> <font color="#7a0874">[</font> <font color="#ff0000">" <font color="#007800">$ RUNASTSAFE</font> "</font> = <font color="#ff0000">"yes"</font> <font color="#7a0874">]</font> ;  <font color="#000000">then</font> <br>  start-stop-daemon <font color="#660033">--stop</font> <font color="#660033">--quiet</font> <font color="#660033">--oknodo</font> \ <br>  <font color="#660033">--pidfile</font> <font color="#007800">$ ASTSAFE_PIDFILE</font> <br>  <font color="#c20cb9">rm</font> <font color="#660033">-f</font> <font color="#007800">$ ASTSAFE_PIDFILE</font> <br>  <font color="#000000">fi</font> <br>  <font color="#666666"># just making sure it's really really dead.</font> <br>  <font color="#666666"># KILL is asterisk -r in the background</font> <br>  start-stop-daemon <font color="#660033">--stop</font> <font color="#660033">--quiet</font> <font color="#660033">--oknodo</font> <font color="#660033">--retry</font> = <font color="#660033">0/2</font> <font color="#000000">/</font> TERM <font color="#000000">/</font> <font color="#000000">2</font> <font color="#000000">/</font> KILL <font color="#000000">/</font> <font color="#000000">5</font> <font color="#660033">--exec</font> <font color="#007800">$ DAEMON</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">"."</font> <br>  <font color="#000000">;;</font> <br>  reload <font color="#7a0874">)</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">"Reloading <font color="#007800">$ DESC</font> configuration files."</font> <br>  asterisk_rx <font color="#ff0000">'module reload'</font> <br>  <font color="#000000">;;</font> <br>  logger-reload <font color="#7a0874">)</font> <br>  asterisk_rx <font color="#ff0000">'logger reload'</font> <br>  <font color="#000000">;;</font> <br>  extensions-reload <font color="#000000">|</font>  dialplan-reload <font color="#7a0874">)</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">"Reloading <font color="#007800">$ DESC</font> configuration files."</font> <br>  asterisk_rx <font color="#ff0000">'dialplan reload'</font> <br>  <font color="#000000">;;</font> <br>  restart-convenient <font color="#7a0874">)</font> <br>  asterisk_rx <font color="#ff0000">'restart when convenient'</font> <br>  <font color="#000000">;;</font> <br>  restart <font color="#000000">|</font>  force-reload <font color="#7a0874">)</font> <br>  $ <font color="#000000">0</font> stop <br>  $ <font color="#000000">0</font> start <br>  <font color="#000000">;;</font> <br>  status <font color="#7a0874">)</font> <br>  status <br>  <font color="#7a0874">exit</font> <font color="#007800">$?</font> <br>  <font color="#000000">;;</font> <br>  zaptel-fix <font color="#7a0874">)</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">"Unloading and reloading loading Asterisk and Zaptel:"</font> <br>  $ <font color="#000000">0</font> stop <br>  <font color="#000000">/</font> etc <font color="#000000">/</font> init.d <font color="#000000">/</font> zaptel unload <br>  <font color="#666666"># load modules from / etc / modules.</font>  <font color="#666666">This will break if you count on</font> <br>  <font color="#666666"># discover / hotplug</font> <br>  <font color="#000000">/</font> etc <font color="#000000">/</font> init.d <font color="#000000">/</font> module-init-tools <br>  <font color="#000000">/</font> etc <font color="#000000">/</font> init.d <font color="#000000">/</font> zaptel start <br>  $ <font color="#000000">0</font> start <br>  <font color="#000000">;;</font> <br>  <font color="#000000">*</font> <font color="#7a0874">)</font> <br>  <font color="#007800">N</font> = <font color="#000000">/</font> etc <font color="#000000">/</font> init.d <font color="#000000">/</font> <font color="#007800">$ NAME</font> <br>  <font color="#7a0874">echo</font> <font color="#ff0000">"Usage: <font color="#007800">$ N</font> {start | stop | restart | reload | status | debug | logger-reload | extensions-reload | restart-convenient | force-reload}"</font> <font color="#000000">&gt; &amp;</font> <font color="#000000">2</font> <br>  <font color="#7a0874">exit</font> <font color="#000000">1</font> <br>  <font color="#000000">;;</font> <br>  <font color="#000000">esac</font> <br><br>  <font color="#7a0874">exit</font> <font color="#000000">0</font> </blockquote><br><br>  We give him the right rights <br> <code>chmod 755 /etc/init.d/asterisk</code> <br> <br>  We start at the start: <br> <code>update-rc.d asterisk defaults 90 10</code> <br> <br>  We reload the container to make sure that everything starts by itself: <br> <code>sudo vzctl restart 101</code> <br> <br>  Make sure that everything works by connecting to a VoIP client: <br> <code> 192.168.xxx.xxx <br> : 200 <br> : 123</code> <br> <br>  Making a test call, for example, to number 500 <br><br>  We are happy. </div><p>Source: <a href="https://habr.com/ru/post/107571/">https://habr.com/ru/post/107571/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../107565/index.html">Oldschool 1-bit ZX-Spectrum chiptune on the domestic RISC-microcontroller</a></li>
<li><a href="../107566/index.html">"Now if ..." or services that we lack</a></li>
<li><a href="../107567/index.html">Salute, Habr!</a></li>
<li><a href="../107569/index.html">The interaction of links and their isolation. Part 2</a></li>
<li><a href="../107570/index.html">New WPF Content Published</a></li>
<li><a href="../107572/index.html">Listen to what you want! New legal music project</a></li>
<li><a href="../107573/index.html">RE: The new phone from HTC includes a chip that protects the firmware from modification</a></li>
<li><a href="../107574/index.html">Skype 5.0 beta for Mac OS X</a></li>
<li><a href="../107575/index.html">Switching css (clearance) "on the fly"</a></li>
<li><a href="../107576/index.html">Personal Information (Short FAQ)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>