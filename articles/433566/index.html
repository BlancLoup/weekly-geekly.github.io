<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We study Adversarial Tactics, Techniques & Common Knowledge (ATT @ CK). Enterprise Tactics. Part 6</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Retrieving credentials (Credential Access) 
 Links to all parts: 
 Part 1. Getting Initial Access 
 Part 2. Execution 
 Part 3. Persistence 
 Part 4. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We study Adversarial Tactics, Techniques & Common Knowledge (ATT @ CK). Enterprise Tactics. Part 6</h1><div class="post__text post__text-html js-mediator-article"><h1>  <a href="https://attack.mitre.org/tactics/TA0006/">Retrieving credentials (Credential Access)</a> </h1><br>  <b>Links to all parts:</b> <br>  <a href="https://habr.com/post/423405/">Part 1. Getting Initial Access</a> <br>  <a href="https://habr.com/post/424027/">Part 2. Execution</a> <br>  <a href="https://habr.com/post/425177/">Part 3. Persistence</a> <br>  <a href="https://habr.com/post/428602/">Part 4. Privilege Escalation</a> <br>  <a href="https://habr.com/post/432624/">Part 5. Defense Evasion</a> <br>  <a href="https://habr.com/post/433566/">Part 6. Obtaining Credential Access</a> <br>  <a href="https://habr.com/ru/post/436350/">Part 7. Discovery</a> <br>  <a href="https://habr.com/ru/post/439026/">Part 8. Lateral Movement (Lateral Movement)</a> <br><br>  Having obtained the credentials, the attacker gains access or even control over the system, domain or service (technological) accounts.  The adversary is likely to try to get legitimate credentials of user and administrative accounts in order to identify himself in the system and get all the permissions of the captured account, thereby making it harder for the defense party to detect malicious activity.  The opponent can also, if possible, create accounts for the purpose of their subsequent use in the attacked environment. <br><a name="habracut"></a><br>  <i>The author is not responsible for the possible consequences of the application of the information contained in the article, and also apologizes for any inaccuracies in some formulations and terms.</i>  <i>The published information is a free recount of the content of <a href="https://attack.mitre.org/wiki/Main_Page">MITER ATT &amp; CK</a> .</i> <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1098">Account Manipulation (Account Manipulation)</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator <br>  <i>Description:</i> Manipulating accounts is aimed at maintaining a certain level of access rights in the attacked environment.  Manipulations involve changing permissions, account settings and how to authenticate it, adding or changing access groups.  The actions of the attacker can be aimed at undermining security policies, such as password expiration, in order to extend the life of compromised accounts.  To create or manage accounts, the adversary must already have sufficient permissions in the system or domain. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Security recommendations:</i> Use multifactor authentication.  Protect domain controllers by restricting access to these systems.  Eliminate the use of domain administrator accounts in unprivileged systems and for day-to-day operations that may contribute to their compromise. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1139">Bash history</a> </h3><br>  <i>System:</i> Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> Bash tracks user commands using the History utility.  When the user logs out, the history is saved to the file <i>~ / .bash_history</i> .  As a rule, this file contains the last 500 user commands.  Often, in the command parameters the user specifies the username and password, which will also be saved in <i>~ / .bash_history</i> when the user logs off.  Attackers can view the <i>~ / .bash_history</i> files of various system users in the hope of getting their credentials. <br><br>  <i>Security Tips:</i> There are several ways to prevent the command history from being written to the <i>~ / .bash_history</i> file: <br>  ‚Ä¢ <i>set + o history</i> - disable recording; <br>  ‚Ä¢ <i>set -o history</i> - resume recording; <br>  ‚Ä¢ <i>unset HISTFILE</i> ‚Äî add to bash_rc file; <br>  ‚Ä¢ <i>ln -s / dev / null ~ / .bash_history</i> ‚Äî write command history to <i>/ dev / null</i> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1110">Brute force or brute force (Brute Force)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description: An</i> adversary can use password recovery tools when credentials are unknown or when he cannot get a password hash.  Opponents can use systematic selection techniques, calculating the appropriate cache or using rainbow tables.  Hacking is usually done outside the attacked system.  Without knowing the password, attackers may try to log in using an empty password value or a value from the list of possible passwords.  Depending on the password policy, such actions can lead to numerous authentication errors and account lockout, so the adversary can use the so-called password sraying, the essence of which is to search for the most popular or probable passwords with different accounts.  This reduces the likelihood of blocking that occurs when searching for multiple passwords with only one account. <br><br>  <i>Security</i> Tips <i>:</i> Apply account blocking policies after a certain number of failed login attempts.  Consider using multifactor authentication.  Follow the recommendations to prevent unauthorized access to existing accounts <i>(see protection recommendations for the ‚Äú <a href="https://attack.mitre.org/wiki/Technique/T1078">Valid accounts</a> ‚Äù equipment)</i> . <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1003">Credential Dumping</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> Administrator, System, root <br>  <i>Description:</i> Dumping credentials ( <i>English dumping - "waste disposal"</i> ) - the process of obtaining usernames and passwords, usually in the form of a hash or text password from the operating system or software. Tools for dumping credentials can be used by both attackers and security testers. <br><br>  <b>Windows</b> <br>  <b>SAM (Account Manager)</b> <br>  SAM is a database of local host accounts.  As a rule, SAM stores accounts that are shown by the " <i>net user</i> " command.  Read SAM requires system level access.  There are many tools for extracting SAM data from memory: <br>  ‚Ä¢ <i>pwdumpx.exe</i> ; <br>  ‚Ä¢ <i>gsecdump</i> ; <br>  ‚Ä¢ <i>Mimikatz</i> ; <br>  ‚Ä¢ <i>secretdump.py</i> . <br><br>  The SAM file can be extracted from the registry using the REG utility: <br> <code>reg save HKLM\sam sam; <br> reg save HKLM\system system.</code> <br> <br>  Next, <i>Creddump7</i> will help extract hashes from the SAM database. <br>  <i>Note:</i> <i>Rid 500</i> is the built-in local administrator account.  <i>Rid 501</i> is a guest account.  User accounts start with <i>Rid 1000+</i> . <br><br>  <b>Cached credentials (DCC2)</b> <br>  Domain Cached Credentials v2 (DCC2) is a credential cache used in Windows Vista and later to authenticate a user when a domain controller is unavailable.  The number of cached accounts can be individually for each system.  This hash is not subject to <i>pass-the-hash</i> attacks.  To retrieve a SAM file from memory, use the following.  instruments: <br>  ‚Ä¢ <i>pwdumpx.exe</i> ; <br>  ‚Ä¢ <i>gsecdump</i> ; <br>  ‚Ä¢ <i>Mimikatz</i> ; <br>  ‚Ä¢ <i>secretdump.py</i> <br>  Alternatively, Reg or Creddump7 can also be used.  Credential caching in Windows Vista is performed using <a href="https://ru.wikipedia.org/wiki/PBKDF2"><i>PBKDF2</i></a> (the standard for generating a key from a password). <br><br>  <b>Local Security Authority (LSA) Secrets</b> <br>  LSA Secrets are cached credential repositories in which the system stores credentials, including user passwords, service accounts, InternetExpolorer passwords, SQL and other private data, such as encryption keys for cached domain passwords.  With System level permissions, you can access LSA Secrets stored in the registry: <br>  <i>HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ Secrets</i> . <br>  When services start in the context of a local or domain account, their passwords are stored in the registry.  If automatic login is enabled, private account information is also stored in the registry.  By analogy with the previous dumping methods, all the same tools are used to attack LSA Secret: <br>  ‚Ä¢ <i>pwdumpx.exe</i> ; <br>  ‚Ä¢ <i>gsecdump</i> ; <br>  ‚Ä¢ <i>Mimikatz</i> ; <br>  ‚Ä¢ <i>secretdump.py</i> <br>  The SAM file can be extracted from the registry using the REG utility, and credentials using Creddump7.  Passwords extracted from LSA Secret are encoded in UTF-16, i.e.  plain text.  In Windows 10, additional security measures LSA Secret are used. <br><br>  <b>NTDS from Domain Controller</b> <br>  For authentication and authorization, AD stores information about domain members ‚Äî devices and users.  The AD database is stored by default on a domain controller in the <i>% SystemRoot% \ NTDS \ Ntds.dit file</i> . <br>  The following methods and tools are used to extract hashes from the AD database: <br>  <i>‚Ä¢ Volume Shadow Copy (shadow copy of the volume);</i> <i><br></i>  <i>‚Ä¢ ntdsutil.exe;</i> <i><br></i>  <i>‚Ä¢ secretdump.py;</i> <i><br></i>  <i>‚Ä¢ Invoke-NinjaCopy</i> . <br><br>  <b>Group Policy Preference (GPP) Files</b> <br>  GPP or group policy preferences are XML files that describe various parameters of domain policies, such as mounting a network drive in the context of a specific account or pre-installing local accounts in domain systems.  Such files may contain credentials.  Group policies are stored in the SYSVOL domain controller, so any user can read GPP files and try to decrypt the passwords contained in them using the following.  tools: <br>  <i>‚Ä¢ Metasploit (post / windows / gather / credentials / gpp);</i> <i><br></i>  <i>‚Ä¢ Get-GPPPassword;</i> <i><br></i>  <i>‚Ä¢ gpprefdecrypt.py.</i> <br>  To identify all XML files on the SYSVOL resource, you can use the command: <br>  <code>dir /s *.xml</code> . <br><br>  <b>Service Principal Names (SPNs)</b> <br>  <i>see the <a href="https://attack.mitre.org/techniques/T1208/">Kerberoasting</a> technique</i> <br><br>  <b>Plaintext Credentials</b> <br>  After the user is logged in, many credentials are generated and stored in the local Author Authority Subsystem Service (LSASS) process.  These credentials can be collected by the administrator or System. <br><br>  SSPI (Security Support Provider Interface) provides a common interface for several Security Support Providers (SSPs).  SSP are software modules (DLLs) containing one or more authentication and cryptography schemes that are loaded into the LSASS process at system startup. <br><br>  Some SSPs can be used to obtain credentials: <br>  ‚Ä¢ Msv: interactive login to the system, login as a batch job (batch logon), for example, launch tasks of the Task Scheduler service, log in as a service through the MSV authentication package; <br>  ‚Ä¢ Wdigest: Digest Authentication Protocol is designed for network authentication using the HTTP and SASL (Simple Authentication Security Layer); <br>  ‚Ä¢ Kerberos: provides domain authentication in Windows 2000 and later versions; <br>  ‚Ä¢ CredSSP: SSO (Single Sign-On - single sign-on allows users to authenticate once and access resources without entering credentials) and Network Level Authentication (used for authentication in Remote Desktop Services). <br><br>  Credential Tools: <br>  ‚Ä¢ <i>Windows credential Editor;</i> <i><br></i>  <i>‚Ä¢ Mimikatz.</i> <br><br>  A dump of the LSASS process can be saved for later analysis in another system. <br>  The following command is executed on the target host: <br> <code>procdump -ma lsass.exe lsass_dump</code> <br> <br>  Next, on another system, Mimikatz runs: <br> <code>securlsa::Minidump lsassdump.dmp <br> sekurelsa::logonPasswords</code>  <code>securlsa::Minidump lsassdump.dmp <br> sekurelsa::logonPasswords</code> . <br><br>  <b>DCSync</b> <br>  DCSync is a form of dumping credentials from a domain controller.  By abusing the domain controller API, instead of using malicious code that can be identified, an attacker can imitate the replication process from a remote domain controller.  Members of Administrators, Domain Admins, Enterprise Admins, or computer accounts can run DCSync to retrieve password information from AD, which can include domain account hashes such as the Key Distribution Center Service Account (KRBTGT) used in Windows 2000 to run the Key Distribution Center service. and Administrator.  Then hashes can be used to create a Golden Ticket and to conduct an Pass the Ticket attack or change the password within account manipulation (Account Manipulation).  DXSync functionality is included in the lsadump module, which is part of Mimikatz.  Lsadump also supports NetSync for replication over the legacy protocol. <br><br>  <b>Linux</b> <b><br></b>  <b>Proc file system</b> <br>  Proc is a special file system in Unix-like operating systems that presents information about processes and other system information in the form of a hierarchical pseudo-file structure (files do not exist on disk, but in RAM), which acts as an interface for interacting with the space of the OS kernel.  Processes running as root can clear the memory of other running programs.  If the program stores passwords in clear-text or as hash in its memory, these values ‚Äã‚Äãcan be extracted from \ Proc for further use or an attempt to recover the password from the hash.  Gnome Keyring, sshd and Apache use memory to store such authentication "artifacts".  The above functionality is implemented in an open source tool - MimiPenguin, which unloads the process memory and then searches for passwords and hashes in text strings and regex templates. <br><br>  <i>Protection recommendations:</i> <br>  <b>Windows</b> <br>  Attempt to track access to LSASS and SAM by the tools allowed in the protected system.  Restrict account rights in various systems and network segments in order to prevent an attacker from moving through the protected network in the event of receiving passwords and hashes.  Ensure that the local administrator credentials have complex and unique passwords on all systems and network segments.  Do not place user or domain administrator accounts in local administrator groups on different systems, because  this is equivalent to the fact that all administrators have the same password.  Follow <a href="https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/securing-privileged-access-reference-material">Microsoft‚Äôs corporate network design and administration guidelines</a> .  In Windows 8.1 and Windows Server 2012 R2, enable LSA (Protected Process Light) process security. <br><br>  Identify and block potentially dangerous and malicious software that can be used to get credential dumps. <br><br>  In Windows 10, a new mechanism is used to protect LSA Secrets - Credential Guard in Windows Defender.  With its appearance, the LSA process does not store private data in memory, but interacts with a new component ‚Äî an isolated process that is responsible for storing and protecting LSA Secrets.  Data stored in an isolated process is protected by virtualization and is not accessible to the rest of the operating system.  LSA interacts with an isolated process using remote procedure call (RPC).  Credential Guard is not configured by default and has hardware and software requirements.  However, it is also not an absolute protection against all forms of dumping credentials. <br><br>  Manage Replicating Directory Changes access and other permissions related to domain controller replication.  Consider disabling or limiting NTLM traffic.  Consider the need to monitor the processes and arguments of program launch commands that may act as indicators for dumping credentials.  For example, remote access tools may contain tools such as Mimikatz or PowerShell scripts such as Invoke-Mimikatz PowerSploit. <br><br>  Monitor the replication logs of domain controllers for unscheduled replications or replication requests.  Also monitor traffic containing requests for replication from third-party IP addresses. <br><br>  <b>Linux</b> <br>  To obtain passwords and hashes from memory, the process must open the file <i>/ proc / PID / maps</i> in the system, where the <i>PID</i> is the unique pid of the process.  The AuditD monitoring tool can be used to identify hostile processes opening this file and warning about the pid, process name and other arguments of the monitored program. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1081">Credentials Files (Credentials in Files)</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> Administrator, System, root <br>  <i>Description:</i> Attackers can search files containing passwords in local file systems and remote shared folders.  These can be user-created files to store their own credentials, shared credential storage of a group of people, configuration files containing passwords for systems or services, source code files, and binary files containing passwords. <br>  Using credential dumping tools, passwords can also be extracted from backups, images and snapshots of virtual machines.  In addition, passwords may be contained in Group Policy settings (GPP) files stored on a domain controller. <br><br>  <i>Security</i> Tips <i>:</i> Use organizational measures that prohibit storing passwords in files.  Make sure that developers and system administrators are aware of the risks associated with storing passwords in clear text in software configuration files.  Periodically monitor the presence of files on your system that contain passwords and then delete them.  Restrict the sharing of files in certain directories by granting permissions only to the necessary users.  Delete GPP files containing vulnerable Group Policy settings. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1214">Credentials in Registry</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User, Administrator <br>  <i>Description:</i> Attackers can search the Windows registry for credentials and passwords that are stored there for use by programs or services, sometimes credentials are stored for automatic login.  Examples of commands for searching password information: <br> <code>reg query HKLM /f password /t REG_SZ /s <br> reg query HKCU /f password /t REG_SZ /s</code> <br> <br>  <i>Recommendations about protection:</i> Do not store credentials in the registry.  Monitor the registry for credentials.  When it is necessary to store credentials, the software should restrict their permissions in order to prevent the possibility of their abuse. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1212">Exploit for Credential Access Exploits</a> </h3><br>  <i>System:</i> Windows, Linux, macOS <br>  <i>Rights:</i> User <br>  <i>Description:</i> Errors made by the developers of authentication and authorization mechanisms may be the cause of software vulnerabilities in which an attacker can gain unauthorized access to credentials.  For example, bulletin <a href="https://support.microsoft.com/ru-kz/help/3011780/ms14-068-vulnerability-in-kerberos-could-allow-elevation-of-privilege">MS14-068</a> describes a vulnerability in the Kerberos protocol, with which an attacker can fake Kerberos tickets using domain user rights.  Exploiting vulnerabilities to obtain credentials can also be used to elevate privileges. <br><br>  <i>Security recommendations:</i> Regularly update software using centralized installation management updates for workstations and servers of the enterprise.  Develop and implement a process for identifying and analyzing cyber threats within which threats relevant to your enterprise will be determined.  Use sandboxes, virtualization tools, and microsegmentation to make it more difficult for an attacker to advance through exploitation of vulnerabilities.  In Windows, tools are available to detect activity related to the exploitation of vulnerabilities, we are talking about Windows Defender Exploit Guard (WDEG) and Enchanced Mitigation Experience Toolkit (EMET).  Another way to prevent the exploitation of vulnerabilities is to use the Control-flow integrity (CFI) tools.  CFI is a generic name for methods aimed at limiting the possible ways to execute a program within a predefined control flow graph.  However, many protection methods may not work if the malware is designed to protect against protective measures, it also depends on the architecture of the program being analyzed and its binary files. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1187">Forced Authentication</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> User <br>  <i>Description:</i> Server Message Block (SMB) is commonly used for authentication and communication between windows-based systems as part of resource sharing and network file folders.  When Windows tries to connect to a remote system via SMB, it automatically tries to authenticate the user and sends the current user credentials to the remote system, so the user does not need to enter credentials to gain access to network resources, which is typical of the corporate environment.  As a backup resource sharing protocol, in the event of a SMB infrastructure failure, the Web Distributed Authoring and Versioning (WebDAV) protocol can be used, which is an extension of the HTTP protocol and usually works through TCP ports 80 and 443. <br><br>  By invoking SMB forcible authentication, attackers can abuse the behavior of the system being attacked while connecting to a remote system and get account hashes.  With the help of phishing techniques, the enemy can send the victim a link to a controlled external resource or place a special file on the desktop or on a shared resource.  When the user system accesses an unreliable resource, it will attempt to authenticate and send the current user‚Äôs hash credentials via SMB to the remote server.  After receiving a hash, an attacker can perform offline brute-force and get the credentials in clear text or use them for Pass-the-Hash attacks. <br><br>  Consider the most popular ways to invoke forced SMB authentication: <br>  ‚Ä¢ Phishing attachment containing a document with active content, which is automatically loaded when you open the document.  The document may include a file [:] // request [remote address] /Normal.dotm/, which initiates SMB authentication. <br><br>  ‚Ä¢ A modified .lnk or .SCF file (Windows Explorer Command File) containing in its properties, instead of the path to the file's icon, an external link \ [remote address] \ pic.png.  Thus, the system will try to download the file icon and open the link. <br><br>  <i>Security Recommendations:</i> Block outgoing SMB traffic sent outside the corporate network by filtering and blocking TCP ports 139, 445 and UDP port 137. Filter and block WebDAV traffic out of the corporate network.  If access to external resources via SMB and WebDAV is necessary, then limit external connections using whitelists. <br><br><h3>  <a href="https://attack.mitre.org/wiki/Technique/T1179">Hooking</a> </h3><br>  <i>System:</i> Windows <br>  <i>Rights:</i> Administrator, System <br>  <i>Description:</i> Windows API functions are usually stored in DLLs.  The interception technique is to redirect calls to API functions by: <br><br>  ‚Ä¢ Hook procedures are built-in procedures in the OS that execute code when calling various events, such as pressing keys or moving a mouse; <br><br>  ‚Ä¢ Modifications of the address table (IAT), in which the pointers to the API functions are stored.  This will allow to ‚Äúdeceive‚Äù the attacked application by forcing it to launch the malicious function; <br><br>  ‚Ä¢ Directly changing a function (splicing), during which the first 5 bytes of the function are changed, instead of which the transition to a malicious or other function defined by the attacker is inserted. <br><br>  Like injections, attackers can use hooking to execute malicious code, disguise its execution, access the memory of the attacked process, and elevate privileges.  Attackers can capture API calls that include parameters containing authentication data. <br>  Hooking is usually used by rootkits to hide malicious activity in the system. <br><br>  <i>Protection recommendations:</i> Interception of events in the OS is part of the normal operation of the system, so any restriction of this functionality may adversely affect the stability of legitimate applications, such as antivirus software.  Efforts to prevent the use of interception techniques need to be focused on the earlier stages of the killchain chain.   hooking-       SetWindowsHookEx  SetWinEventHook,   ,    , ,   ,    .. <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1056">  (Input Capture)</a> </h3><br> <i>:</i> Windows, Linux, macOS <br> <i>:</i> , System <br> <i>:</i>              . <br>  ‚Äî       ,       ,            UAC-          (Windows Credential Providers).        ,                 . <br><br>               ,      VPN.            ,                    . <br><br> <i>  :</i>     -        AppLocker     .  ,          . <br><br>   Microsoft       (https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/securing-privileged-access-reference-material#a-nameesaebmaesae-administrative-forest-design-approach). <br><br>       .   API  SetWindowsHook, GetKeyState, GetAsyncKeyState.    API-     ,       ,              .         (Custom Credential Provider): <br> <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\Credential Providers</code> . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1141">  (Input Prompt)</a> </h3><br> <i>:</i> macOS <br> <i>:</i>  <br> <i>:</i>   ,   ,         .     ,          .           AppleScript: <br><br> <code>set thePassword to the text returned of (display dialog "AdobeUpdater needs permission to check for updates. Please authenticate." default answer "")</code> <br> <br>            , ,           . <br><br> <i>  :</i>   ,          .      AppleScript       . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1208">Kerberoasting</a> </h3><br> <i>:</i> Windows <br> <i>:</i>  <br> <i>:</i>       ‚Äî Service Principal Name (SPN),       Kerberos. SPN        ,    SPN      AD. <br><br> ,    Kerberos ticket-granting ticket (TGT)     Kerberos ticket-granting service (TGS)      (service ticket)     SPN,    .        RC4,   Kerberos 5 TGS-REP etype 23,      ,    SPN       (.  Kerberos)       .          ,    .             ,       . <br><br> <i>  :</i>      (  25+ )         .     Windows Server 2012   Group Managed Service Accounts (gMSA),        ()          .          . <br><br>        ,         Domain Admins. <br>     AES Kerboros      ,   RC4. <br><br>   Kerberos Service Ticket Operations      Kerberos TGS.    , ,  Event ID 4769 ‚Äî  ,        , ,     RC4 (Ticket Encryption Type: 0x17). <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1142">Keychain</a> </h3><br> <i>:</i> macOS <br> <i>:</i> root <br> <i>:</i> Keychain (. ¬´ ¬ª) ‚Äî    macOS          ,   WiFi, -,  ,   Kerberos.  Keychain  : <br> ‚Ä¢ <i>~/Library/Keychains; <br> ‚Ä¢ /Library/Keychains; <br> ‚Ä¢ /Network/Linrary/Keychains/.</i> <br><br>     macOS   <i>Security</i>      . <br>           ,      .         ,          ,   keychains  .  ,    Keychains         . <br><br> <i>  :</i>  Keychains       ‚Äî  ,         . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1171"> LLMNR/NBT-NS (LLMNR/NBT-NS Poisoning)</a> </h3><br> <i>:</i> Windows <br> <i>:</i>  <br> <i>:</i> Link-Local Multicast Name Resolution (LLMNR)  NetBIOS Name Service (NBT-NS) ‚Äî  ,     Windows,      . LLMNR    DNS         DNS. NBT-NS        NetBIOS-. <br><br>       ,      LLMNR (UDP5355)/NBT-NS(UDP137),       .     /,      NTLMv2   -      .  ,                       . <br>   ,           : NBNSpoof, Metasploit  Responder. <br><br> <i>  :</i>    LLMNR  NBT-NS          .    ,  LLMNR/NBT-NS-. <br> ,  LLMNR   : <br> <code>HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\DNSClient\EnableMulticast=dword:00000000</code> . <br>  LLMNR/NBT-NS   ,     UDP5355  UDP137   . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1040">  (Network Sniffing)</a> </h3><br> <i>:</i> Windows, Linux, macOS <br> <i>:</i>        promiscuos mode (¬´¬ª ),                 span- ( )     ,      . <br>                 .         LLMNR/NBT-NS            -, -   . <br><br>              ( ,  , IP-,  , VLAN ID  ..)       /   . <br><br> <i>  :</i> ,      .  ,  Kerberos, SSL   .        span-,  ARP/DNS     . <br>      - ,          . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1174">DLL-   (Password Filter DLL)</a> </h3><br> <i>:</i> Windows <br> <i>:</i> , System <br> <i>:</i>   Windows ‚Äî          .     DLL-,         . DLL               . <br><br>      Security Accounts Manager (SAM),  Local Security Authority (LSA)         .              . <br><br>              .        LSA   .            . <br><br> <i>  :</i> ,         . DLL      <i>C:\Windows\System32\</i>       : <br> <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\[Notification Packages]</code> . <br>          ,       lsass.exe <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1145">  (Private Keys)</a> </h3><br> <i>:</i> Windows, Linux, macOS <br> <i>:</i>  <br> <i>:</i>       , /   . <br>                   SSH     , ,    . <br><br>         <i>.key, .pgp, .gpg, .ppk, .P12, .pem, .pfx, .cer, p7b, .asc</i> .       ,  <i>~/.ssh</i>  *nix-  <i>C:\Users (username.ssh)\</i>  Windows. <br><br>           ,                  . <br><br> <i>  :</i>    ,     .         . ,               . <br><br>      ,   .       ,       ,       .          . <br><br>       ,      ,       ,   ,           . <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1167">    OS X (Securityd Memory)</a> </h3><br> <i>:</i> macOS <br> <i>:</i> root <br> <i>:</i>  OS X   EL Capitan    root    Keychain         .    ,     Apple     ,           . <br><br> ,    Keychain      .         ,     ,   . -,               ,     PBKDF2 ,      .  ,               -.    keychain   securityd,       -. <br><br>   root,           keychain      , WiFi, , ,   .. <br><br><h3> <a href="https://attack.mitre.org/wiki/Technique/T1111"> -  (Two-Factor Authentication Interception)</a> </h3><br> <i>:</i> Windows, Linux, macOS <br> <i>:</i> , System, root <br> <i>:</i>          ,    /,            . <br><br>         -,     ,    . <br>     (2FA)  -,    ,   -     .    -       -      ,           . <br><br>            ,   RSA SecurID.    (    )           ,          (         ). <br><br>   2FA          .         (,    ..).   \   ,       . <br><br> <i>  :</i>   -,    .    ,       .    -   ,         2FA. </div><p>Source: <a href="https://habr.com/ru/post/433566/">https://habr.com/ru/post/433566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433554/index.html">We correct typographical errors in search queries.</a></li>
<li><a href="../433556/index.html">The Economist: As private investment companies, 0.001% of the richest people in the world are changing the global finance industry</a></li>
<li><a href="../433558/index.html">TeamCity 2018.2: support for GitHub Pull Requests, secondary server, installation of plug-ins from the repository, screenshots in tests</a></li>
<li><a href="../433562/index.html">Checking the LibrePCB project with PVS-Studio inside the Docker container</a></li>
<li><a href="../433564/index.html">Predictive web interface behavior</a></li>
<li><a href="../433568/index.html">As in America, fighting thieves parcels</a></li>
<li><a href="../433570/index.html">The secret of the ritual ‚Äúwarming up‚Äù or why ‚Äúwarm‚Äù headphones sound ‚Äúbetter‚Äù</a></li>
<li><a href="../433572/index.html">Introduction to Testing in Python. Part 2</a></li>
<li><a href="../433574/index.html">Headphone Review Sony SBH90C: Wireless or USB Type-C?</a></li>
<li><a href="../433576/index.html">Guide on the St. Petersburg IT movement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>