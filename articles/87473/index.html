<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>All by post</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In today's web applications, it is often necessary to give the visitor some kind of alert. Whether ‚ÄúYour comment has been saved and is awaiting modera...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>All by post</h1><div class="post__text post__text-html js-mediator-article">  In today's web applications, it is often necessary to give the visitor some kind of alert.  Whether ‚ÄúYour comment has been saved and is awaiting moderation,‚Äù or ‚ÄúThank you for your interest, we will send you an invitation as soon as we open it‚Äù, these small messages appear here and there all the time, so it's nice to have a user-friendly interface to display them. to the user. <br><br>  The authentication and authorization application that came with Django (django.contrib.auth) always included basic functionality for displaying pop-up messages to the user, but it had some annoying flaws.  In Django 1.2, there is now a completely new framework for such messages, written primarily by Tobias McNulty. <br><br><a name="habracut"></a><br><h4>  So what was wrong with the old way? </h4><br>  Since the old messaging system is part of django.contrib.auth, you need to connect this application to take advantage of the small part responsible for notifications.  But it happens that you do not need authentication and authorization, but you need these small messages.  Or perhaps you are using your own authentication application.  Or, conversely, you use django.contrib.auth, but you do not need messages.  In Django 1.2, you finally have an opportunity for all this. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition, the old system stores messages in a database.  And although it is normal for many projects, it still means that each view of any page is accompanied by an additional query to the database.  And he is simply not needed in most cases.  Django 1.2 has the ability to store messages outside the database for a small performance boost. <br><br>  It is also worth noting that in previous versions of Django all messages were considered equal, i.e.  it was impossible to set the message type (importance level, if you wish).  This, for example, is convenient when you need to distinguish between error messages and success.  In the new framework, such an opportunity has appeared. <br><br>  Finally, the alert system in Django 1.1 binds each message tightly to a specific user, which means that you cannot show such messages to anonymous users.  In Django 1.2, the ability to show alerts regardless of whether a user is logged in or not has appeared. <br><br><br><h4>  So let's get started. </h4><br>  The new system is already connected by default if you create a project using django-admin.py startproject.  If you already have an old project, or you have created a project in some other way, it is very easy to turn on the system.  Just three steps: <ol><li>  Add 'django.contrib.messages.middleware.MessageMiddleware' to the list of MIDDLEWARE_CLASSES in the settings file. </li><li>  Add 'django.contrib.messages.context_processors.messages' to the TEMPLATE_CONTEXT_PROCESSORS list in the settings file. </li><li>  Add 'django.contrib.messages' to the INSTALLED_APPS list in the same settings file. </li></ol><br><h4>  Adding Alerts </h4><br>  Adding alerts to users in the new framework is also elementary, especially if you only need one of the five predefined message types (DEBUG, INFO, SUCCESS, WARNING, ERROR ‚Äî more on that <a href="https://habr.com/ru/post/87473/">later</a> ). <br><br>  So, what you need to do: <ol><li> <code><font color="black"><font color="#0000ff">from</font> django.contrib <font color="#0000ff">import</font> messages messages.success(request, <font color="#008000">"Skadoosh! You've updated your profile!"</font> )</font></code> </li> <li> <code><font color="black"><font color="#0000ff">from</font> django.contrib <font color="#0000ff">import</font> messages messages.success(request, <font color="#008000">"Skadoosh! You've updated your profile!"</font> )</font></code> </li> </ol>  Similarly, for other types of messages: <ol><li> <code><font color="black">messages.info(request, <font color="#008000">'Yo! There are new comments on your photo!'</font> ) messages.error(request, <font color="#008000">'Doh! Something went wrong.'</font> ) messages.debug(request, <font color="#008000">'Bam! %s objects were modified.'</font> % modified_count) messages.warning(request, <font color="#008000">'Uh-oh. Your account expires in %s days.'</font> % expiration_days)</font></code> </li> <li> <code><font color="black">messages.info(request, <font color="#008000">'Yo! There are new comments on your photo!'</font> ) messages.error(request, <font color="#008000">'Doh! Something went wrong.'</font> ) messages.debug(request, <font color="#008000">'Bam! %s objects were modified.'</font> % modified_count) messages.warning(request, <font color="#008000">'Uh-oh. Your account expires in %s days.'</font> % expiration_days)</font></code> </li> <li> <code><font color="black">messages.info(request, <font color="#008000">'Yo! There are new comments on your photo!'</font> ) messages.error(request, <font color="#008000">'Doh! Something went wrong.'</font> ) messages.debug(request, <font color="#008000">'Bam! %s objects were modified.'</font> % modified_count) messages.warning(request, <font color="#008000">'Uh-oh. Your account expires in %s days.'</font> % expiration_days)</font></code> </li> <li> <code><font color="black">messages.info(request, <font color="#008000">'Yo! There are new comments on your photo!'</font> ) messages.error(request, <font color="#008000">'Doh! Something went wrong.'</font> ) messages.debug(request, <font color="#008000">'Bam! %s objects were modified.'</font> % modified_count) messages.warning(request, <font color="#008000">'Uh-oh. Your account expires in %s days.'</font> % expiration_days)</font></code> </li> </ol>  Since messages are attached to the request object, you will need access to it, but you already have it in all views. <br><br>  If you are migrating from the old version, you will need to complete only two simple points: <ol><li>  In all views.py files, where there is an alert creation, add the following line at the beginning: <br> <code><font color="black"><font color="#0000ff">from</font> django.contrib <font color="#0000ff">import</font> messages</font></code> </li> <li>  Replace everywhere <br> <code><font color="black">request.user.message_set.create(message=message)</font></code> <br>  to call one of the new API methods, for example <br> <code><font color="black">messages.error(request, message)</font></code> </li> </ol><br><h4>  Message display </h4><br>  To display messages in a template, use something like the following lines: <ol><li> <code><font color="black">{% if messages %} &lt; <font color="#A31515">ul</font> class= <font color="#0000ff">"messages"</font> &gt; {% for message in messages %} &lt; <font color="#A31515">li</font> {% if message.tags %} class= <font color="#0000ff">"{{ message.tags }}"</font> {% endif %}&gt; {{ message }} &lt;/ <font color="#A31515">li</font> &gt; {% endfor %} &lt;/ <font color="#A31515">ul</font> &gt; {% endif %}</font></code> </li> <li> <code><font color="black">{% if messages %} &lt; <font color="#A31515">ul</font> class= <font color="#0000ff">"messages"</font> &gt; {% for message in messages %} &lt; <font color="#A31515">li</font> {% if message.tags %} class= <font color="#0000ff">"{{ message.tags }}"</font> {% endif %}&gt; {{ message }} &lt;/ <font color="#A31515">li</font> &gt; {% endfor %} &lt;/ <font color="#A31515">ul</font> &gt; {% endif %}</font></code> </li> <li> <code><font color="black">{% if messages %} &lt; <font color="#A31515">ul</font> class= <font color="#0000ff">"messages"</font> &gt; {% for message in messages %} &lt; <font color="#A31515">li</font> {% if message.tags %} class= <font color="#0000ff">"{{ message.tags }}"</font> {% endif %}&gt; {{ message }} &lt;/ <font color="#A31515">li</font> &gt; {% endfor %} &lt;/ <font color="#A31515">ul</font> &gt; {% endif %}</font></code> </li> <li> <code><font color="black">{% if messages %} &lt; <font color="#A31515">ul</font> class= <font color="#0000ff">"messages"</font> &gt; {% for message in messages %} &lt; <font color="#A31515">li</font> {% if message.tags %} class= <font color="#0000ff">"{{ message.tags }}"</font> {% endif %}&gt; {{ message }} &lt;/ <font color="#A31515">li</font> &gt; {% endfor %} &lt;/ <font color="#A31515">ul</font> &gt; {% endif %}</font></code> </li> <li> <code><font color="black">{% if messages %} &lt; <font color="#A31515">ul</font> class= <font color="#0000ff">"messages"</font> &gt; {% for message in messages %} &lt; <font color="#A31515">li</font> {% if message.tags %} class= <font color="#0000ff">"{{ message.tags }}"</font> {% endif %}&gt; {{ message }} &lt;/ <font color="#A31515">li</font> &gt; {% endfor %} &lt;/ <font color="#A31515">ul</font> &gt; {% endif %}</font></code> </li> <li> <code><font color="black">{% if messages %} &lt; <font color="#A31515">ul</font> class= <font color="#0000ff">"messages"</font> &gt; {% for message in messages %} &lt; <font color="#A31515">li</font> {% if message.tags %} class= <font color="#0000ff">"{{ message.tags }}"</font> {% endif %}&gt; {{ message }} &lt;/ <font color="#A31515">li</font> &gt; {% endfor %} &lt;/ <font color="#A31515">ul</font> &gt; {% endif %}</font></code> </li> <li> <code><font color="black">{% if messages %} &lt; <font color="#A31515">ul</font> class= <font color="#0000ff">"messages"</font> &gt; {% for message in messages %} &lt; <font color="#A31515">li</font> {% if message.tags %} class= <font color="#0000ff">"{{ message.tags }}"</font> {% endif %}&gt; {{ message }} &lt;/ <font color="#A31515">li</font> &gt; {% endfor %} &lt;/ <font color="#A31515">ul</font> &gt; {% endif %}</font></code> </li> <li> <code><font color="black">{% if messages %} &lt; <font color="#A31515">ul</font> class= <font color="#0000ff">"messages"</font> &gt; {% for message in messages %} &lt; <font color="#A31515">li</font> {% if message.tags %} class= <font color="#0000ff">"{{ message.tags }}"</font> {% endif %}&gt; {{ message }} &lt;/ <font color="#A31515">li</font> &gt; {% endfor %} &lt;/ <font color="#A31515">ul</font> &gt; {% endif %}</font></code> </li> <li> <code><font color="black">{% if messages %} &lt; <font color="#A31515">ul</font> class= <font color="#0000ff">"messages"</font> &gt; {% for message in messages %} &lt; <font color="#A31515">li</font> {% if message.tags %} class= <font color="#0000ff">"{{ message.tags }}"</font> {% endif %}&gt; {{ message }} &lt;/ <font color="#A31515">li</font> &gt; {% endfor %} &lt;/ <font color="#A31515">ul</font> &gt; {% endif %}</font></code> </li> </ol>  As a rule, it makes sense to put these strings in your base template, so that all templates that inherit it display alerts. <br><br>  The code is almost identical to what you already used in Django 1.1, but you should have noticed the new tags property.  Django 1.2 gives each alert a type with a string representation for use in templates.  In this case, we display this value as the name of the CSS class, which can be used to individually style various types of messages, for example: <ol><li> <code><font color="black"><font color="#A31515">.messages li.error</font> { <font color="#ff0000">background-color</font> : <font color="#0000ff">red</font> ; } <font color="#A31515">.messages li.success</font> { <font color="#ff0000">background-color</font> : <font color="#0000ff">green</font> ; }</font></code> </li> <li> <code><font color="black"><font color="#A31515">.messages li.error</font> { <font color="#ff0000">background-color</font> : <font color="#0000ff">red</font> ; } <font color="#A31515">.messages li.success</font> { <font color="#ff0000">background-color</font> : <font color="#0000ff">green</font> ; }</font></code> </li> </ol>  If you just want to show messages to the user, you can stop reading.  In fact, nothing more is needed.  Everything is easy and simple. <br><br><br><h4>  Message Storage Mechanisms </h4><br>  Django provides several backends for storing messages, and you can create your own very easily.  LegacyFallbackStorage is used by default and is suitable for most projects, however, there are several reasons why you want to change the backend: <ul><li>  django.contrib.messages.storage.session.SessionStorage.  This backend stores all messages in a session.  Thus, it is required to connect the django.contrib.sessions application (most likely it is already activated in your project, since it is used by default).  Since sessions are stored by default in the database, using this backend still requires a query to the database when accessing messages (for example, when calling {% if messages%} in a template). </li><li>  django.contrib.messages.storage.cookie.CookieStorage stores messages in cookies.  Thus, the database query is not required, which leads to greater performance.  However, there is one drawback: the maximum cookie length is 4096 bytes, so messages that are longer than 4 KB will not be delivered. </li><li>  django.contrib.messages.storage.fallback.FallbackStorage: this mechanism first uses CookieStorage, but in the case where the text does not fit in the cookie, refers to SessionStorage. </li><li>  django.contrib.messages.storage.user_messages.LegacyFallbackStorage.  Provided for backward compatibility with Django 1.1 and earlier versions.  It works exactly the same as FallbackStorage, but also receives messages from the old alert system - django.contrib.auth.  However, like the system itself from django.contrib.auth, this mechanism has been declared obsolete and will be removed from Django 1.4.  While this mechanism is used by default, but as soon as it is removed, FallbackStorage will be in its place. </li></ul><br><h4>  Types of messages and tags </h4><br>  As mentioned earlier, Django provides 5 built-in message types.  Each type is an integer.  You can easily extend or change existing types.  By default we have: <ul><li>  DEBUG: 10 </li><li>  INFO: 20 </li><li>  SUCCESS: 25 </li><li>  WARNING: 30 </li><li>  ERROR: 40 </li></ul>  To add your own type, declare a constant and call the add_message () method to create a new message type: <ol><li> <code><font color="black">CRITICAL = <font color="#008000">50</font> messages.add_message(request, CRITICAL, <font color="#008000">'OH NOES! A critical error occured.'</font> )</font></code> </li> <li> <code><font color="black">CRITICAL = <font color="#008000">50</font> messages.add_message(request, CRITICAL, <font color="#008000">'OH NOES! A critical error occured.'</font> )</font></code> </li> </ol>  Of course, you will want to use this information in HTML and CSS, so you need to add the MESSAGE_TAGS setting to your settings.py file to set a string representation for your new message type: <ol><li> <code><font color="black">MESSAGE_TAGS = { <font color="#008000">50</font> : <font color="#008000">'critical'</font> }</font></code> </li> </ol><br><h4>  Finally </h4><br>  The new messaging system included in Django 1.2 is not a very difficult part of the framework, but it provides functionality without which a modern web application cannot be imagined, and makes it very elegant and simple.  In addition, it is fully compatible with previous versions, so you don‚Äôt need to worry that the old code or third-party applications will break after switching to 1.2.  But do not forget that the compatibility layer will be removed in 1.4, planned somewhere in the second half of 2027. <br><br>  Joke.  Enjoy Django 1.2!  This is a really cool update of our favorite framework. <font color="#999"><br><br></font>  <font color="#999">-</font> <font color="#999"><br></font>  <font color="#999">Translation prepared in <a href="http://www.vim.org/">Vim</a> .</font> </div><p>Source: <a href="https://habr.com/ru/post/87473/">https://habr.com/ru/post/87473/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../87462/index.html">Comparing video quality via HTML5 and Flash using YouTube as an example using Chrome 5.0.342.3 dev and Win 7 browser</a></li>
<li><a href="../87464/index.html">Extension authors, browser hackers, meet js-ctypes</a></li>
<li><a href="../87467/index.html">HabrTree - minimizing script</a></li>
<li><a href="../87471/index.html">Improving notify-send. Adding a new message to the previous one</a></li>
<li><a href="../87472/index.html">network testing in Linux</a></li>
<li><a href="../87474/index.html">Yii 1.1.1 and 1.0.12</a></li>
<li><a href="../87477/index.html">Installing linux on an ancient laptop</a></li>
<li><a href="../87478/index.html">Android in Ukraine</a></li>
<li><a href="../87480/index.html">Nonsense in the exam</a></li>
<li><a href="../87488/index.html">Interview with a Japanese researcher who calculated Pi with an accuracy of 2.5 trillion characters</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>