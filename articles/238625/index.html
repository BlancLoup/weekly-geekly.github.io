<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A universal method of circumventing the ban Yota to distribute the Internet from the phone or collect the Android kernel module</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Old methods and their disadvantages 
 I think no one is interested in reading the second time (and maybe the third ), about how Yota determines whethe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A universal method of circumventing the ban Yota to distribute the Internet from the phone or collect the Android kernel module</h1><div class="post__text post__text-html js-mediator-article"><h4>  Old methods and their disadvantages </h4><br>  I think no one is interested in reading the <a href="http://habrahabr.ru/post/238351/">second time</a> (and maybe the <a href="http://4pda.ru/forum/index.php%3Fshowtopic%3D596728%26st%3D60">third</a> ), about how Yota determines whether a person uses the phone in modem mode or an access point.  ‚ÄúWhy do we need another article?‚Äù - you ask. <br><br>  The point is that the workaround methods listed on the links do not allow you to customize the phone so that later when you connect <u>any</u> devices you do not need to configure anything again.  In addition, the user will experience serious inconvenience if he connects multiple devices with different TTL.  It is necessary to change at least TTL on one of them. <br><br>  It was these reasons that motivated me to dig further in search of the answer to the eternal question "How is it possible to distribute Internet to the whole office free of charge?"  And it was possible to find such an answer (only for android, I do not have an apple). <br><a name="habracut"></a><br><h4>  Ready program </h4><br>  When I found out that Yota was monitoring TTL, I assumed that there must be providers in other countries that do the same.  We are trying to enter the TTL in the search for the Play Market. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I was right: the <a href="https://play.google.com/store/apps/details%3Fid%3Dorg.segin.ttleditor">TTLEditor</a> program was immediately found.  Very pleased that it is not only free, but also <a href="https://github.com/segin/TTLEditor">open source</a> . <br>  It is very simple to use: select the interface (it is best to choose the interface through which the phone is connected to the provider, mine is <b>rmnet0</b> ) and press the OK button.  You can also put the program to trigger when the phone boots. <br><br><img src="https://habrastorage.org/files/711/4e3/e5a/7114e3e5a16c4d0bb5270019b50bdeec.png"><br><br>  Only one problem arose: the program gave the error " <b>TTL update failed</b> ".  Before scolding the author in the comments and minus on the Play Market, I decided to read the source code. <br><br>  <i>Note.</i>  Perhaps, on your phone model, the program will work immediately.  So you are very lucky, close this article and enjoy life. <br><br><h4>  Error reason </h4><br>  The main action of the program is to launch the following command as root: <br>  <b>iptables -t mangle -A POSTROUTING -o</b> <i>&lt;interface&gt;</i> <b>-j TTL --ttl-set</b> <i>&lt;TTL value&gt;</i> <br>  Many brains do not need to understand what this command does (besides, the program says about it): it sets the TTL value to all packets passing through a certain interface (that is, what we need). <br><br>  I tried to execute the command manually and saw the following error: <b>iptables: No chain / target / match by that name</b> .  A couple of minutes of googling showed that this <b>iptables</b> error is ready to give out almost any incorrect parameters.  We google in relation to the TTL and still find <a href="http://kb.sp.parallels.com/en/115410">something</a> .  We look, as far as we found the appropriate information. <br><br>  The <b><code>cat /proc/net/ip_tables_matches</code></b> list with <b>ttl</b> , that is, the kernel knows how to check the TTL.  But there is no <b>TTL</b> in the list issued by the <b><code>cat /proc/net/ip_tables_targets</code></b> , so <u>our kernel is not able to modify the TTL</u> .  We will not surrender to such impudent collusion of mobile providers and manufacturers, so we are going to assemble a kernel module, which is not enough. <br><br>  I think that at this stage, users of CyanogenMod already maliciously snicker, but I didn‚Äôt want to simply give up the standard system, but wanted to add new features to it (even without replacing the core). <br><br><h4>  Retreat </h4><br>  Further, I assume that the reader knows how to use Linux, understands what the kernel and kernel modules are, and also knows how to transfer files (adb push / pull) with adb and how to open a phone terminal on the computer (adb shell).  If not - urgently in Google!  If yes, do not forget to enable USB debugging. <br><br><h4>  What to collect and what </h4><br>  <u>This is the most difficult step</u> : you need to find a suitable cross-compiler and kernel sources.  Try to search for your phone, because otherwise, most likely, it will not work (and this will be known only at the last step).  I made several unsuccessful attempts at making a mistake at this stage. <br><br>  The model of my phone is Sony Xperia Z1 Compact, the operating system of my computer is Ubuntu 14.04.  Below on their example, I will show how you can act. <br><br><ul><li>  The <b><code>cat /proc/version</code></b> can tell which version of <b>gcc was</b> used to build the kernel on the phone (mine: <b>4.7</b> ). <br><img src="https://habrastorage.org/files/f09/4a1/4ee/f094a14ee8c346fea0aa8cb820c46829.png"></li></ul><br><ul><li>  Download the suitable cross-compiler (toolchain).  I found it <a href="https://android.googlesource.com/platform/prebuilts/gcc/linux-x86/arm/arm-eabi-4.7/">here</a> .  I execute the command on the computer: <br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://android.googlesource.com/platform/prebuilts/gcc/linux-x86/arm/arm-eabi-4.7</code> </pre>  and it is in my folder <b>arm-eabi-4.7</b> (to clone a git repository, do not forget to install git). </li></ul><br><ul><li>  The firmware build number can be viewed in the phone settings "About phone".  I have: <b>14.4.A.0.108</b> . <br>  It was succeeded to find the necessary source codes of a kernel in the corresponding archive <a href="http://developer.sonymobile.com/downloads/xperia-open-source-archives/">here</a> and in a repository <a href="">here</a> .  I took from the archive, because I found it earlier. <br>  If I understand at least something in the world of licenses, then the manufacturer is obliged to provide the source code of the kernel running on the androidphone. </li></ul><br><br><h4>  Setup and build </h4><br>  Those who are faced with the process of building the kernel for the first time, do not panic, with Google we are always <a href="http://bash.im/quote/416108">god-like</a> . <br><br><ul><li>  To begin with, open the console in the source folder of the kernel and set up the environment so that the kernel is collected by the extracted cross-compiler: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ARCH=arm <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> CROSS_COMPILE=///arm-eabi-4.7/bin/arm-eabi-</code> </pre>  At the end of the <code>CROSS_COMPILE</code> environment variable, <code>CROSS_COMPILE</code> should be a common prefix of most (or all) executable files in the <b>bin</b> folder. </li></ul><br><ul><li>  Then you need to create a default kernel configuration (a <code>.config</code> file) for your phone model.  The command needed for this is usually written in some README nearby.  In my case, the <code>README_Xperia</code> file was in the kernel source <code>README_Xperia</code> . <br><pre> <code class="bash hljs">make rhine_amami_row_defconfig <span class="hljs-comment"><span class="hljs-comment">#      Sony Xperia Z1 Compact</span></span></code> </pre> </li></ul><br><ul><li>  And now you need to take a step, which is usually not given in the descriptions of the kernel assembly for Android. <br><pre> <code class="bash hljs">make menuconfig</code> </pre>  The kernel configurator opens. <br><br>  Click ‚Äú <b>/</b> ‚Äù and enter ‚Äú <b>TARGET_TTL</b> ‚Äù into the search. <br><br><img src="https://habrastorage.org/files/28d/7fe/031/28d7fe0312a248e4b77e8601901797ab.png"><br><br>  Aha, it has now become clear where the core capability we need is located.  Go to it in the configurator and press the " <b>M</b> " button.  This means that we want to compile this feature as a kernel module. <br><br><img src="https://habrastorage.org/files/a29/df9/4d0/a29df94d0c6a4926ba0343422717d2d9.png"><br><br>  We leave from the configurator, saving the changes. </li></ul><br><ul><li>  We assemble the kernel and modules: <br><pre> <code class="bash hljs">make -j8 make modules</code> </pre>  If any errors have occurred, it means that you most likely have found inappropriate kernel sources or a cross-compiler. </li></ul><br><ul><li>  The module we need is located here: <b><code>net/netfilter/xt_HL.ko</code></b> </li></ul><br><br><h4>  Using the module on the phone </h4><br>  We drop the xt_HL.ko module <b><code>xt_HL.ko</code></b> the phone and try to connect it to the kernel with the <code>insmod</code> command. <br>  If this command gives an error, then the details can be found in the output of the <code>dmesg</code> (most likely it will be a conflict between the kernel version and the module or something similar - this means that the wrong kernel sources or the cross compiler were taken). <br><br>  If the <code>insmod</code> command succeeds, then the module was able to connect to the kernel (you can check it with the <code>lsmod</code> command). <br>  After that we will try to start the command that TTLEditor tried unsuccessfully to use.  Does not give an error?  So the rule is added to the list.  You can check with the command <code>iptables -t mangle -L</code> : <br><br><img src="https://habrastorage.org/files/1bd/19b/462/1bd19b46241145d78d071b2989f82337.png"><br><br>  We try to distribute the Internet to any devices and enjoy. <br><br><h4>  Setup autoload </h4><br>  The last step remains: to do so, to be able to distribute the Internet whenever you want. <br><br>  Create a <code>setup_ttl_editing.sh</code> file with the following contents: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/system/bin/sh insmod /storage/sdcard0/xt_HL.ko iptables -t mangle -A POSTROUTING -o rmnet+ -j TTL --ttl-set 64</span></span></code> </pre> <br>  We drop it on the phone, install the <a href="https://play.google.com/store/apps/details%3Fid%3Dos.tools.scriptmanager">Script Manager</a> program and configure it in it so that the script runs when the system boots and from the root user. <br><br><img src="https://habrastorage.org/files/515/7d9/79e/5157d979eab84cc688c56fc1a4b9b6a1.png"><br><br>  <b>Everything is set up, you can forget about the problem of distributing the Internet from your phone!</b> <br><br>  <i>Note.</i>  We don‚Äôt need TTLEditor.  Everything you need is already written in the script. <br><br><h4>  Conclusion </h4><br>  I will not write " <s>iota, do not be greedy,</s> " because compared to many other mobile providers, they are still quite generous.  I'd rather say: iota, stay the same as you are. <br><br>  Download the <a href="">file <b><code>xt_HL.ko</code></b></a> , which I got for the Xperia Z1 Compact, you can follow <a href="">this link</a> . <br>  Perhaps it is suitable for similar phone models. <br><br>  <b>UPD on 03/13/2015.</b>  Thanks to the user <a href="https://habrahabr.ru/users/cte6ejib/" class="user_link">CTE6EJIb</a> for the <a href="">file <b><code>xt_HL.ko</code></b></a> for Xperia V Android 4.3, firmware version 9.2.A.2.5. <br>  <b>UPD from 08/01/2015.</b>  Compile for Xperia Z1 Compact for Android 5, firmware version 14.5.A.0.270.  <a href="">Download</a> . </div><p>Source: <a href="https://habr.com/ru/post/238625/">https://habr.com/ru/post/238625/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238611/index.html">Android developers: all out of the twilight?</a></li>
<li><a href="../238615/index.html">Your audio guide. The story of a startup</a></li>
<li><a href="../238619/index.html">Interception of calls of functions of native libraries in Android applications</a></li>
<li><a href="../238621/index.html">Ubuntu 14.04 on Asus X200MA</a></li>
<li><a href="../238623/index.html">The social network "Anti-Facebook" has a "viral" growth</a></li>
<li><a href="../238627/index.html">It turns out that modern C ++ compilers support unicode identifiers.</a></li>
<li><a href="../238629/index.html">What will happen if you mix nuts, Arduino, OpenCV and Delphi. Part 1</a></li>
<li><a href="../238631/index.html">3D printing will form the basis of future data centers.</a></li>
<li><a href="../238635/index.html">Fundraising for the purchase of a Flir Lepton thermal imaging module.</a></li>
<li><a href="../238639/index.html">How tactile interfaces will change our gadgets</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>