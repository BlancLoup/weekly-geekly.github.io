<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Proper definition of the user's language</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now I am working on a site that claims to be global, naturally and with multilingualism it should be all right. 

 About how to display information in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Proper definition of the user's language</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage2/f2d/f51/e4a/f2df51e4aff8bc2ff7183ffbba2e9bb2.jpg">  Now I am working on a site that claims to be global, naturally and with multilingualism it should be all right. <br><br>  About how to display information in different languages, there will be no talk here.  The conversation will be about how to determine the user's language, and choose the most appropriate language version available on the site. <a name="habracut"></a><br><br>  For those who are too lazy to read - see the <a href="http://la2ha.ru/dev/web/php/codeigniter/libraries_helpers/lang_detect">screencast,</a> it really didn‚Äôt really work out, so I don‚Äôt post it here. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And so what we have: <br><ul><li>  Php </li><li>  The CodeIgniter framework (the class was written for this framework, but it can be used anywhere with minor changes) </li></ul><br>  Task: <br>  Determine the user's language and if the user is Russian-speaking (Russian, Belarus, Ukrainian full list <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BF%25D0%25B8%25D1%2581%25D0%25BE%25D0%25BA_%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D0%25BD_%25D0%25B8_%25D1%2582%25D0%25B5%25D1%2580%25D1%2580%25D0%25B8%25D1%2582%25D0%25BE%25D1%2580%25D0%25B8%25D0%25B9,_%25D0%25B3%25D0%25B4%25D0%25B5_%25D1%2580%25D1%2583%25D1%2581%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D1%258F%25D0%25B2%25D0%25BB%25D1%258F%25D0%25B5%25D1%2582%25D1%2581%25D1%258F_%25D0%25BE%25D1%2584%25D0%25B8%25D1%2586%25D0%25B8%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D1%258B%25D0%25BC_%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA%25D0%25BE%25D0%25BC">here</a> ) we show him the information in Russian.  If not then in English. <br>  All this needs to be arranged in the form of a class or function with the ability to quickly set something like links from the user's language to the best language for understanding on the site. <br><br>  Decision: <br>  To determine the user's language, we use the $ _SERVER superglobal array, or rather, its element $ _SERVER ['HTTP_ACCEPT_LANGUAGE'] in it describes the client's preferences regarding the language.  This information is extracted from the Accept-Language HTTP header, which is sent by the client to the server. <br>  In my case it was a string. <br><pre><code class="bash hljs">ru-ru,ru;q=0.8,en-us;q=0.6,en;q=0.4</code> </pre> <br>  This line contains the user's languages ‚Äã‚Äãthat he prefers, and their priorities are expressed in q, if q is not specified for the language, it is assumed that it will be 1. If you try to display it in a less readable form, it looks like this: <br><pre> <code class="bash hljs">Array ( [ru-ru] =&gt; 1 [ru] =&gt; 0.8 [en-us] =&gt; 0.6 [en] =&gt; 0.4 )</code> </pre><br>  This shows that I prefer Russian, and in second place I have English. <br>  Languages ‚Äã‚Äãare written in two formats. The <u>main language code</u> is ‚Äúru‚Äù and ‚Äúen‚Äù in my case, which is related to the language standards of <a href="http://ru.wiktionary.org/wiki/%25D0%2592%25D0%25B8%25D0%25BA%25D0%25B8%25D1%2581%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2580%25D1%258C:ISO_639">ISO 639</a> <br>  And the <u>main language code - the extended language code</u> in my case is ‚Äúru-ru‚Äù and ‚Äúen-us‚Äù; here the extended language code indicates the region where the language is used in my country is United States. <br>  At times, there is a misunderstanding with how to mark languages ‚Äã‚Äãwhen the ISO code lists contain both two-letter and three-letter codes (sometimes several three-letter codes).  Now all valid codes are listed in one <a href="http://www.iana.org/assignments/language-subtag-registry">IANA registry</a> , which for a language takes only one value from the ISO lists.  If an ISO two-letter code is available, it will be one in the registry.  Otherwise, the registry will contain one three-letter code.  It will simplify things. <br><br>  With theory figured out go to the practice: <br>  Let's write the constructor of the class controller: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($list = strtolower($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_ACCEPT_LANGUAGE'</span></span>]))) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preg_match_all(<span class="hljs-string"><span class="hljs-string">'/([az]{1,8}(?:-[az]{1,8})?)(?:;q=([0-9.]+))?/'</span></span>, $list, $list)) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;language = array_combine($list[<span class="hljs-number"><span class="hljs-number">1</span></span>], $list[<span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;language <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $n =&gt; $v) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;language[$n] = $v ? $v : <span class="hljs-number"><span class="hljs-number">1</span></span>; arsort(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;language, SORT_NUMERIC); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;language = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); }</code> </pre><br>  Here we process the string returned by $ _SERVER ['HTTP_ACCEPT_LANGUAGE'] so that it turns out an array of the form <br><pre> <code class="bash hljs">Array ( [ru-ru] =&gt; 1 [ru] =&gt; 0.8 [en-us] =&gt; 0.6 [en] =&gt; 0.4 )</code> </pre><br>  Sorted in descending order of priority of the language (q value) <br><br>  Next, create a method that finds the most appropriate language. <br>  The first default language is the default language, the second array of which will be the languages ‚Äã‚Äãthat are on the site, and the values ‚Äã‚Äãof the link to it from other languages ‚Äã‚Äãlook like this: <br><pre> <code class="php hljs">$langs=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'ru'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'ru'</span></span>,<span class="hljs-string"><span class="hljs-string">'be'</span></span>,<span class="hljs-string"><span class="hljs-string">'uk'</span></span>,<span class="hljs-string"><span class="hljs-string">'ky'</span></span>,<span class="hljs-string"><span class="hljs-string">'ab'</span></span>,<span class="hljs-string"><span class="hljs-string">'mo'</span></span>,<span class="hljs-string"><span class="hljs-string">'et'</span></span>,<span class="hljs-string"><span class="hljs-string">'lv'</span></span>), <span class="hljs-string"><span class="hljs-string">'de'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'de'</span></span> );</code> </pre><br>  Method code: <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBestMatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($default, $langs)</span></span></span><span class="hljs-function"> </span></span>{ $languages=<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($langs <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $lang =&gt; $alias) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($alias)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($alias <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $alias_lang) { $languages[strtolower($alias_lang)] = strtolower($lang); } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $languages[strtolower($alias)]=strtolower($lang); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;language <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $l =&gt; $v) { $s = strtok($l, <span class="hljs-string"><span class="hljs-string">'-'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//          "en-us, ru-ru" if (isset($languages[$s])) return $languages[$s]; } return $default; }</span></span></code> </pre><br>  The function truncates the format languages ‚Äã‚Äãthe <u>main language code is the extended language code</u> to the format the <u>main language code</u> since  The need for the English and American versions of the language is unlikely to arise, and if you like, you can always finish writing. <br>  The result of its execution will be the most suitable language of the user, in the <a href="http://ru.wiktionary.org/wiki/%25D0%2592%25D0%25B8%25D0%25BA%25D0%25B8%25D1%2581%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2580%25D1%258C:ISO_639">ISO 639</a> format I transferred English as the default language, and for all languages ‚Äã‚Äãthat are not in the $ langs array, <u>en</u> will be returned. <br><br>  Download the library <a href="http://la2ha.ru/dev/web/php/codeigniter/libraries_helpers/lang_detect">here.</a> </div><p>Source: <a href="https://habr.com/ru/post/159129/">https://habr.com/ru/post/159129/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../159113/index.html">Hibernation on PROXMOX2</a></li>
<li><a href="../159115/index.html">We improve labor productivity. Objective-c macros and literals</a></li>
<li><a href="../159121/index.html">We solder a ‚Äúsmart‚Äù car PSU on 5v with USB charging and automatic on / off</a></li>
<li><a href="../159123/index.html">We turn on FCoE on the Cisco Nexus 5000 switch</a></li>
<li><a href="../159127/index.html">Two simple tasks on Haskell (for beginners)</a></li>
<li><a href="../159131/index.html">Mysql PARTITION BY YEAR (date) / MONTH (date) / DAYOFWEEK (date)</a></li>
<li><a href="../159133/index.html">Configuring Asus RT-N56U Router to Access Pandora, Hulu and Other Resources</a></li>
<li><a href="../159135/index.html">Android 4.2 calendar is missing December</a></li>
<li><a href="../159137/index.html">Vkontakte has its own advertising network for partner sites</a></li>
<li><a href="../159139/index.html">IBM SOM: external object system with support for inheritance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>