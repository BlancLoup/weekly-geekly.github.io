<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make the site fly and save dozens of hours of system administration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The speed of your site, its stability and fault tolerance always depend on three components: 

 1. Platform (CMS) and its settings that affect perform...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make the site fly and save dozens of hours of system administration</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/ed7/6bf/c94/ed76bfc944f87d223289598a7e305e17.jpg" align="left">  The speed of your site, its stability and fault tolerance always depend on three components: <br><br>  1. Platform (CMS) and its settings that affect performance (caching parameters, etc.) <br>  2. Server configuration (real physical or virtual) and system software settings (web server, database, etc.) <br>  3. Quality of development, code, integration with the platform. <br><br>  Often, a web developer can write good quality code, but at the same time, little is understood in system administration and server configuration.  A good sysadmin is rarely concurrently also a cool programmer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, this is perfectly normal; everyone should do their work.  But, unfortunately, in small web studios, which are the majority, there are rarely admins in the state.  Hosting settings receive little attention.  At best, they rely on the hosting support and default settings. <br><br>  As a result, the site may be ‚Äúlimp‚Äù due to problems and ‚Äúnarrow‚Äù places in any of the components: CMS, hosting, development.  The client does not go into the details and is not satisfied with the project as a whole.  His negative is transferred to all: ‚ÄúBrake hosting!  Awful system!  Developers can't do anything! ‚Äù <br><br>  Such a picture, of course, never suited us.  And we decided to do something ... <br><a name="habracut"></a><br>  The capabilities of the 1C-Bitrix platform itself, relating to performance, are truly enormous (this is <a href="http://www.1c-bitrix.ru/products/cms/features/perfmon.php">a performance monitor</a> , debugging tools, several caching options, <a href="http://www.1c-bitrix.ru/products/cms/features/webcluster.php">support for web-based cluster systems</a> , and much more) and require a separate article.  We have already written about many things, we will tell you about something in the near future. <br><br>  Today's post is about hosting, servers, VPS and their administration. <br><br><img src="https://habrastorage.org/storage2/e7f/580/055/e7f5800553ac66ac4116389161f00f6c.jpg" align="left">  The simplest and, seemingly, the most obvious solution is to write a good detailed guide on configuring web systems and give it to everyone.  And all will be well. <br><br>  And we started just with this - we wrote detailed documentation (it was, it seems, 6 or 7 years ago).  Then, based on it, several free training courses were released, which were constantly improved and adapted.  As a result, they are now summarized in a general <a href="http://dev.1c-bitrix.ru/learning/course/index.php%3FCOURSE_ID%3D32">"Course for hosters</a> . <a href="http://dev.1c-bitrix.ru/learning/course/index.php%3FCOURSE_ID%3D32">"</a> <br><br>  Despite the name and the fact that it was released by 1C-Bitrix, the course is relevant and extremely useful for all hosters in general and for administrators serving a particular fleet of web servers.  After reviewing it and - all the more - having answered the control questions at the end, one can hope that there will be no more serious mistakes in configuring the web server. <br><br>  But, unfortunately, even the presence of the most complete documentation and practical recommendations for setting up servers does not solve the performance problem for most projects!  Good - right!  - configurations are still very small. <br><br>  There are many reasons for this ... <br><ul><li>  Many administrators simply do not have time to fine-tune the system.  Set, basic configuration performed - already good ... </li><li>  Low qualification of technical specialists - even in order to do everything ‚Äúaccording to the manual‚Äù, we need some technical background and understanding of the processes taking place. </li><li>  ‚ÄúHistorical heritage‚Äù - the use of configurations of 3-5-‚Ä¶ -years old, at best - software upgrade.  Strict adherence to the principle of "work - do not touch."  Which, as it turns out, is not always applicable. </li><li>  Template configurations for all projects. </li><li>  Etc. </li></ul><br>  As a result, as our practice shows, there are many typical problems that almost always reduce the speed of the site. <br><br>  I will step back a bit from the initial topic of the post and try to describe the most typical problems that we have encountered over the years.  I hope that even if somewhere you recognize your own web server, a little understanding of the essence will help you ... <br><br>  <b>PHP as CGI</b> <br><br>  Fortunately, this PHP mode of operation is already becoming rare.  Nevertheless, about a year ago there were quite a few such configurations. <br><br>  What's wrong with CGI?  That on each appeal to a script separate process PHP is started.  It is long and resource intensive. <br><br>  <b>open_basedir</b> <br><br>  This parameter in PHP is responsible for restricting the access of scripts to certain directories.  Very useful for configurations in which sites of different clients can work on the same server.  The good goal is security, but the solution is implemented, to put it mildly, ‚Äúnot very‚Äù ... <br><br>  First, there are quite a few options to ‚Äúget around‚Äù the limitations set in <a href="http://ru.php.net/manual/ru/ini.core.php">open_basedir</a> . <br><br>  Secondly, setting this parameter (even to an ‚Äúempty‚Äù value) has a very negative effect on the speed of PHP (file operations, for example, include).  On an empty unloaded server, the speed of page generation can be reduced by 20-30%, and with a high load - by 2-3 times. <br><br>  There are many alternatives to open_basedir.  Starting with a separate copy of the web server for each client, ending with the use of chroot. <br><br>  <b>PHP precompiler not installed</b> <br><br>  <a href="http://pecl.php.net/package/APC">APC</a> , <a href="http://sourceforge.net/projects/eaccelerator/">eAccelerator</a> , <a href="httpd.net/">XCache</a> ... I hope these words are familiar to you. <br><br>  The precompiler is used to optimize and speed up the execution of PHP scripts (precompiles the interpreted code, caches the result and then executes the already precompiled code). <br><br>  The difference in performance on different projects can reach several times. <br><br>  <b>Not enough precompiler memory</b> <br><br>  The precompiler can be installed, but, for example, all settings are left ‚Äúby default‚Äù.  What could this mean?  For example, by allocating too little memory for cached scripts, accessing new scripts will crowd out old data, and all the work of the precompiler will be inefficient. <br><br>  <b>Missing FrontEnd (nginx)</b> <br><br>  The two-tier architecture ‚ÄúBackend - Frontend‚Äù is a practically obligatory requirement for the stable operation of any more or less loaded web project. <br><br>  This scheme of work solves several problems: <br><ul><li>  all static is quickly given away by ‚Äúlight‚Äù (with minimal memory consumption) processes; </li><li>  backend is busy processing only "heavy" requests to scripts; </li><li>  on slow channels on clients, backend is not busy delivering content to the end client - it gives it to the frontend and is free to process subsequent requests. </li></ul><br>  <b>The value of MaxClients in Apache is not adjusted.</b> <br><br>  On non-threaded servers, this parameter is responsible for the maximum number of processes that can be run for parallel processing of client requests. <br><br>  Many people think that the more - the better.  In many configurations, you can see the values ‚Äã‚Äãof both 50, and 150, and 256. <br><br>  What does this mean in practice?  Suppose a single Apache process can consume 40 MB of RAM.  If MaxClients is set to 150, then at peak load (DDoS, habraeffect, errors in development, etc.), all processes require approximately 6 GB of RAM.  Only under Apache. <br><br>  If this amount of memory is not available, a swap will be used.  And the general degradation of the whole system will begin.  And even those requests that could be processed quickly will be processed for a very long time. <br><br>  It is much better to limit MaxClients to a reasonable value.  If the number of requests is greater, they will simply ‚Äúqueue up‚Äù and will be processed when busy processes become free.  The system will be stable. <br><br>  * * * <br><br>  The list of such typical mistakes can be continued for a very long time ... <br><br>  In our practice we came across them very often. <br><br>  As a result, in 2009 we performed in a role that was quite atypical for us - not developers, but system administrators.  And released a free product <a href="http://www.1c-bitrix.ru/products/vmbitrix/">"1C-Bitrix: Virtual Machine</a> . <a href="http://www.1c-bitrix.ru/products/vmbitrix/">"</a> <br><br>  <b>What it is?</b> <br><br>  VMBitrix (as we briefly call a virtual machine) is a ready-made VMWare Virtual Appliance image that can be run on a wide variety of VMware products (VMWare Server, VMWare ESX and ESXi, VMWare Workstation, VMWare Player, VMWare Fusion). <br><br>  <b>To be implemented in this image?</b> <br><ul><li>  Of course, the operating system has already been installed (the first images were on Ubuntu, later on - CentOS). </li><li>  Configured two-tier web server configuration (Apache + Nginx). </li><li>  Zend Optimizer + precompiler included in Zend Server CE package is installed.  According to the <a href="http://www.1c-bitrix.ru/products/cms/performance/">results of load tests,</a> he showed the best performance. </li><li>  MySQL is installed and configured. </li></ul><br>  Initially, we did not plan to widely distribute this image.  The very first versions were not even public, but were used only for internal purposes. <br><br>  VMbitrix essentially served as a reference environment to which you could navigate, deploying your own system. <br><br>  Nevertheless, ‚Äú1C-Bitrix: Virtual Machine‚Äù proved to be very popular.  Hosters who could provide tariffs on the basis of VMware, <a href="http://www.1c-bitrix.ru/products/vmbitrix/rent.php">began to use our image for new tariffs</a> focused on placing projects on the 1C-Bitrix platform. <br><br>  Gradually, requests began to appear "and make the same image under Hyper-V", "and make a template for Virtuozzo" ... <br><br>  Gradually, we began to support almost all common virtualization environments. <br><br>  Support for all current versions eventually began to require quite noticeable efforts, and as a result, about a year later, another free product appeared - <a href="http://www.1c-bitrix.ru/products/env/">‚Äú1C-Bitrix: Web Environment‚Äù (Linux)</a> . <br><br>  In essence, this is an RPM package that can be automatically deployed on CentOS (5, 6), Fedora (12-16), Red Hat Enterprise Linux (5, 6).  Both 32-bit and 64-bit architecture are supported. <br><br>  Thus, it does not matter at all whether it is a real physical server, or you rented a virtual machine (from <a href="http://aws.amazon.com/ec2/">Amazon</a> , <a href="http://www.scalaxy.ru/">Scalaxy</a> , <a href="http://www.clodo.ru/bitrix-server/bitrix-hosting/">Clodo.Ru</a> or someone else), or bought a <a href="http://www.1c-bitrix.ru/partners/hosting.php">regular VPS</a> . <br><br>  On the "bare" system, just run: <br><br> <code><a href=""></a> # wget repos.1c-bitrix.ru/yum/bitrix-env.sh <br> # chmod +x bitrix-env.sh <br> # ./bitrix-env.sh</code> <br> <br>  ... and answer ‚Äúyes‚Äù several times during the installation process.  :) <br><br>  (By the way, modern versions of the virtual machine, which continues to be supported, are assembled in this way - from the 1C-Bitrix: Web Environment package). <br><br>  Actually, everything!  After such a simple installation, you get a "Web environment" - now version 3.1. <br><br>  How the product has evolved and what it can do now (it can do it right away, out of the box).  I will describe some of the most interesting, in my opinion, "chips." <br><br>  <b>Convenient installer of any products "1C-Bitrix"</b> <br><br>  After installing the web environment, when you log into the server via HTTP, you are greeted by a very simple wizard that allows you to deploy an existing website from a backup copy or install a new one using any product, be it Site Management, Corporate Portal or this or other print solution. <br><br><img src="https://habrastorage.org/storage2/b37/414/dfb/b37414dfbf34ae529a33d15336cb9e5d.png"><br><br><img src="https://habrastorage.org/storage2/be9/f37/52c/be9f3752ca529e90720a9ed8657bb95a.png"><br><br>  Master is available in three languages ‚Äã‚Äã- Russian, English and German. <br><br>  At the same time, the connection to the MySQL database is fully configured (in the /home/bitrix/www/bitrix/php_interface/dbconn.php file), so installation of any product follows the ‚Äúshortcut‚Äù procedure: the system parameters are not checked (we know in advance that it is meets the technical requirements), the database connection parameters are not requested (everything is already configured). <br><br>  <b>Startup Menu</b> <br><br>  You will see this menu if you log into your machine via SSH: <br><br><img src="https://habrastorage.org/storage2/845/726/58e/84572658ef98089d4edc4d8c0ef8e5d5.png"><br><br>  Of course, it looks somewhat ascetic in comparison with modern beautiful web interfaces.  :) Probably, someday we will make them for the web environment and the virtual machine - and we will end up with a full-fledged hosting control panel √† la ISPmanager, cPanel or Plesk.  :) <br><br>  But even in this version it is a very powerful and convenient tool. <br><br>  <b>Web cluster</b> <br><br>  For about a year, the <a href="http://www.1c-bitrix.ru/products/cms/features/webcluster.php">Web Cluster module</a> has been actively developed in the 1C-Bitrix platform, which allows you to deploy any project not on one, but on several servers, thereby ensuring its scaling with increasing load and fault tolerance when one or several servers. <br><br>  We have a detailed <a href="http://www.1c-bitrix.ru/download/manuals/ru/web-cluster_guide.pdf">guide to setting up a web cluster</a> , everyone can get acquainted with it. <br><br>  But in order to save your time, you can use the wizard, which is part of the web environment: <br><ul><li>  it will configure and start MySQL replication; </li><li>  configures nginx as a balancer for several nodes; </li><li>  configure a memcached server pool for a distributed data cache; </li><li>  will configure and start synchronization of these web servers using the csync2 utility. </li></ul><br>  The configuration process is approximately as follows: <br><ul><li>  Start a virtual machine or deploy a web environment. </li><li>  Install through the wizard in the browser "1C-Bitrix: Site Management" one of the two senior editions (which includes the module "web cluster"). </li><li>  Run the master node setting via the menu. </li><li>  We start one more virtual machine (or we expand a web environment on the second server). </li><li>  Through the menu of the first machine, add the slave node. </li></ul><br>  Further, all settings will be made automatically. <br><br>  At a recent partner conference, Denis Sharomov, head of technical support, demonstrated the entire process of deploying a small test cluster in just 10-15 minutes. <br><br>  In the same place, he demonstrated another great opportunity - switching any slave to master mode in the event of an accident at the master node. <br><br>  You have a great opportunity to watch it all practically ‚Äúlive‚Äù - <a href="http://conf.1c-bitrix.ru/winter2012/about/media/">video recordings of the reports are posted</a> on the conference website, including the report ‚ÄúVirtual Machine 3.0: How to launch a web cluster in 15 minutes with practical examples‚Äù. <br><br>  <a href="http://www.1c-bitrix.ru/products/intranet/"><b>Corporate Portal</b></a> <br><br>  ‚Äú1C-Bitrix: Web Environment‚Äù is maximally adapted for any projects developed on the 1C-Bitrix platform (at the same time, any sites that use PHP and MySQL will work great on it). <br><br>  But at the same time there are a number of individual "chips", specifically designed to work with the <a href="http://www.1c-bitrix.ru/products/intranet/">"Corporate Portal"</a> . <br><br>  For example, catdoc and xpdf utilities are automatically installed and configured in the product, which allow indexing and rendering documents of the most popular formats (MS Word, Excel, PowerPoint, Adobe Acrobat) on the fly on the portal. <br><br>  The web server is immediately configured to work both over HTTP and over https.  You can simply replace the self signed certificate with your purchased one - and work in a protected environment. <br><br>  Further ... Immediately "out of the box" WebDAV is supported for connecting network drives. <br><br>  Separately, we can mention the NTLM authorization setup wizard: <br><br><img src="https://habrastorage.org/storage2/c7e/b93/49b/c7eb9349b651e07dda8cf0f6593868c4.png"><br><br>  If the company uses Active Directory, and AD users are allowed to authenticate on the portal, then in addition to the actual settings of the portal it often takes a lot of ‚Äúdancing with a tambourine‚Äù around the Apache and Nginx config files for NTLM authentication to work correctly. <br><br>  Now it is not required, the whole process is automated! <br><br>  (The entire setup process is described in detail in the <a href="http://dev.1c-bitrix.ru/community/blogs/rns/bitrixvm31-s-podderzhkoy-ntlm-avtorizatsii.php">blog of Nikolai Ryzhonin</a> .) <br><br>  <b>Automatic configuration based on available resources</b> <br><br>  The web environment has a tricky /etc/init.d/bvat script. <br><br>  Starting at system startup, it determines the amount of available resources (RAM) and, depending on them, automatically optimally adjusts: <br><ul><li>  MySQL (buffer sizes, number of connections, temporary tables, etc.); </li><li>  MaxClients and related parameters in Apache; </li><li>  amount of available memory for Zend Optimizer +. </li></ul><br>  If after installing a virtual machine or a web environment you want to perform fine-tuning specifically for your tasks, disable this script so that it does not work every time the server is rebooted. <br><br>  * * * <br><br>  We somehow tried to calculate, and how much time it would take in ‚Äúman-hours‚Äù :) to fully configure all software, deploy a cluster, configure NTLM authorization ... It turned out at least 200 hours!  :) <br><br>  Of course, this is the top estimate.  However, even if you, for example, need to configure a VPS for stable operation of a regular site, it will take 1-2 days to install, configure and test everything. <br><br>  With the ‚ÄúWeb environment‚Äù or ‚ÄúVirtual Machine‚Äù ‚Äú1C-Bitrix‚Äù this time can be saved and spent on something else.  :) <br><br>  PS We are often asked to lay out a detailed description of the web environment: with examples of scripts, configs, etc. <br><br>  Such a ‚Äúdescription‚Äù is the <a href="http://www.1c-bitrix.ru/products/env/">web environment itself</a> .  It is absolutely free.  Put it on any machine or download our <a href="http://www.1c-bitrix.ru/products/vmbitrix/">virtual machine</a> .  Log in on ssh - and study!  All configs, all scripts - everything is completely open and accessible.  :) </div><p>Source: <a href="https://habr.com/ru/post/137927/">https://habr.com/ru/post/137927/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137922/index.html">A global video tracking system will be created in Moscow</a></li>
<li><a href="../137923/index.html">Chamber Toastmasters Club Meeting at EPAM</a></li>
<li><a href="../137924/index.html">HTTP - Application Level Protocol</a></li>
<li><a href="../137925/index.html">Google is close to launching its Google Drive file storage cloud service.</a></li>
<li><a href="../137926/index.html">Another popularity rating of programming languages</a></li>
<li><a href="../137928/index.html">HomeLisp two years later</a></li>
<li><a href="../137929/index.html">The contents of The Pirate Bay fit in 90 megabytes</a></li>
<li><a href="../137930/index.html">Economic evaluation of the project (situational example to part number 1)</a></li>
<li><a href="../137931/index.html">Freezing Eclipse 3.7 for Mac</a></li>
<li><a href="../137932/index.html">Failure of the master in the PostgreSQL-cluster: how to be?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>