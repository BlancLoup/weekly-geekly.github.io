<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dagger 2 for novice Android developers. Dagger 2. Advanced. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is the sixth part of a series of articles that, according to the author, are intended for those who cannot understand the implementation ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dagger 2 for novice Android developers. Dagger 2. Advanced. Part 1</h1><div class="post__text post__text-html js-mediator-article">  <i>This article is the <b>sixth</b> part of a series of articles that, according to the author, are intended for those who cannot understand the <a href="https://en.wikipedia.org/wiki/Dependency_injection">implementation of dependencies</a> and the <a href="https://google.github.io/dagger/users-guide.html">Dagger 2</a> framework, or are only going to do it.</i>  <i>The original was written on December 23, 2017.</i>  <i>Free translation.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c44/553/241/c44553241dc10ea53a0f232724eeb3e0.jpg" alt="Dagger 2 advanced part 1 image"><br><a name="habracut"></a><br>  This is the sixth article in the series <i>"Dagger 2 for novice Android developers."</i> .  If you have not read the previous, then you <a href="https://habrahabr.ru/post/343248/">here</a> . <br><br><h4>  Article series </h4><br><ul><li>  <a href="https://habrahabr.ru/post/343248/">Dagger 2 for novice Android developers.</a>  <a href="https://habrahabr.ru/post/343248/">Introduction</a> </li><li>  <a href="https://habrahabr.ru/post/343250/">Dagger 2 for novice Android developers.</a>  <a href="https://habrahabr.ru/post/343250/">The introduction of dependencies.</a>  <a href="https://habrahabr.ru/post/343250/">Part 1</a> . </li><li>  <a href="https://habrahabr.ru/post/343658/">Dagger 2 for novice Android developers.</a>  <a href="https://habrahabr.ru/post/343658/">The introduction of dependencies.</a>  <a href="https://habrahabr.ru/post/343658/">Part 2</a> . </li><li>  <a href="https://habrahabr.ru/post/344314/">Dagger 2 for novice Android developers.</a>  <a href="https://habrahabr.ru/post/344314/">Dagger 2. Part 1</a> . </li><li>  <a href="https://habrahabr.ru/post/344886/">Dagger 2 for novice Android developers.</a>  <a href="https://habrahabr.ru/post/344886/">Dagger 2. Part 2</a> . </li><li>  <a href="https://habrahabr.ru/post/345372/">Dagger 2 for novice Android developers.</a>  <a href="https://habrahabr.ru/post/345372/">Dagger 2. Advanced.</a> <a href="https://habrahabr.ru/post/345372/"><br></a>  <a href="https://habrahabr.ru/post/345372/">Part 1 (you are here)</a> . </li><li>  <a href="https://habrahabr.ru/post/345898/">Dagger 2 for novice Android developers.</a>  <a href="https://habrahabr.ru/post/345898/">Dagger 2. Advanced.</a> <a href="https://habrahabr.ru/post/345898/"><br></a>  <a href="https://habrahabr.ru/post/345898/">Part 2.</a> </li></ul><br><h4>  Earlier in the series of articles </h4><br>  We analyzed the class generated by Dagger 2 and looked at how Dagger 2 uses the Builder pattern to provide the necessary dependencies. <br>  After we have analyzed a simple example of using annotations <code>@Module</code> and <code>@Provides</code> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Foreword </h2><br>  This article may seem a little big.  Usually my articles do not exceed 800 characters.  I wanted to break it up into smaller parts, but the reason why the article is so big is because if you solve the problem of strong connections <i>(hard dependencies)</i> for a long time in the middle, there is a chance to get lost. <br><br>  But I included checkpoints in the article.  In these places you can take a short break and get distracted.  I think this will be useful for newbies in Dagger 2 and dependency injection (DI). <br><br><h2>  Android House </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/f89/4d4/f93/f894d4f934c05f16a3562f69ee915dde.jpg" alt="House Android image"><br><br>  So far, we have considered the usual Java projects in the examples.  I hope that most of you now have an idea about DI and how Dagger 2 allows you to implement DI.  Now let's dive into the real example of the Android application and try using Dagger 2 in this project. <br><br>  To collect everything in one place, as in Google code labs, I created <a href="https://github.com/Hariofspades/Dagger-2-Advanced/tree/kickstart">a kickstart branch</a> .  Our goal will be to eliminate the strong links in this project.  Parts of the solution will be located in separate branches of this project. <br><br><h2>  Project Description </h2><br>  This is a very simple project.  In it, we will receive random users using the <a href="https://randomuser.me/">Random Users API</a> and display them in <code>RecyclerView</code> .  I will not spend much time explaining the project, I will explain in the abstract.  But please disassemble the code carefully, so that the implementation of Dagger 2 in the project will be as clear and simple for you as possible. <br><br><h3>  # Classes and packages </h3><br><ul><li>  <code>MainActivity.java</code> - Makes requests to the API and shows the items received in <code>RecyclerView</code> . </li><li>  Package <code>Model</code> - POJO for the response from the API, created using <a href="http://www.jsonschema2pojo.org/">JSON Schema to POJO</a> </li><li>  <code>RandomUsersAdapter.java</code> - <code>Adapter</code> for <code>RecyclerView</code> </li></ul><br><h2>  Dependencies </h2><br>  To implement the project functions, the following libraries will be used: <br><br><ul><li>  <code>Retrofit</code> - for API calls </li><li>  <code>GsonBuilder</code> and <code>Gson</code> - for working with JSON </li><li>  <code>HttpLoggingInterceptor</code> - for logging network operations </li><li>  <code>OkHttpClient</code> - client for <code>Retrofit</code> </li><li>  <code>Picasso</code> - working with images in the <code>Adapter</code> </li></ul><br>  As we saw in the previous examples, there are dependencies in <code>MainActivity</code> .  And each time you create a <code>MainActivity</code> , dependency instances will be created again and again. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ Retrofit retrofit; RecyclerView recyclerView; RandomUserAdapter mAdapter; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); initViews(); GsonBuilder gsonBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GsonBuilder(); Gson gson = gsonBuilder.create(); Timber.plant(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timber.DebugTree()); HttpLoggingInterceptor httpLoggingInterceptor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpLoggingInterceptor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpLoggingInterceptor.Logger() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NonNull String message)</span></span></span><span class="hljs-function"> </span></span>{ Timber.i(message); } }); httpLoggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY); OkHttpClient okHttpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkHttpClient() .newBuilder() .addInterceptor(httpLoggingInterceptor) .build(); retrofit = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Retrofit.Builder() .client(okHttpClient) .baseUrl(<span class="hljs-string"><span class="hljs-string">"https://randomuser.me/"</span></span>) .addConverterFactory(GsonConverterFactory.create(gson)) .build(); populateUsers(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initViews</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ recyclerView = findViewById(R.id.recyclerView); recyclerView.setLayoutManager(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinearLayoutManager(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">populateUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Call&lt;RandomUsers&gt; randomUsersCall = getRandomUserService().getRandomUsers(<span class="hljs-number"><span class="hljs-number">10</span></span>); randomUsersCall.enqueue(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Callback&lt;RandomUsers&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResponse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Call&lt;RandomUsers&gt; call, @NonNull Response&lt;RandomUsers&gt; response)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(response.isSuccessful()) { mAdapter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RandomUserAdapter(); mAdapter.setItems(response.body().getResults()); recyclerView.setAdapter(mAdapter); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Call&lt;RandomUsers&gt; call, Throwable t)</span></span></span><span class="hljs-function"> </span></span>{ Timber.i(t.getMessage()); } }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RandomUsersApi </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRandomUserService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> retrofit.create(RandomUsersApi.class); } }</code> </pre><br>  <b>(Checkpoint)</b> <br>  <b>...</b> <br><br><h2>  Existing problems </h2><br>  If you look at the <code>MainActivity</code> , you will notice the following problems: <br><br><h4>  # Awkward object initialization </h4><br>  When you look at the <code>onCreate()</code> method, you may find awkward initialization inside it.  Of course, we can continue to initialize objects in this way in this way, but it is better to find the right way to solve the problem. <br><br><h4>  # Testability </h4><br>  You also need to find a way to test our code.  And <code>Picasso</code> inside the <code>Adapter</code> also interferes with testing capabilities.  It would be nice to pass this dependency through the constructor. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RandomUserAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Adapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RandomUserAdapter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RandomUserViewHolder</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Result&gt; resultList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RandomUserAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RandomUserViewHolder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewGroup parent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> viewType)</span></span></span><span class="hljs-function"> </span></span>{ View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.list_item_random_user, parent, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RandomUserViewHolder(view); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RandomUserViewHolder holder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position)</span></span></span><span class="hljs-function"> </span></span>{ Result result = resultList.get(position); holder.textView.setText(String.format(<span class="hljs-string"><span class="hljs-string">"%s %s"</span></span>, result.getName().getFirst(), result.getName().getLast())); Picasso.with(holder.imageView.getContext()) .load(result.getPicture().getLarge()) .into(holder.imageView); } ......</code> </pre><br><h2>  Let's make an example a little more complicated. </h2><br>  The dependencies presented above in the <code>MainActivity</code> class were needed only for you to get a little insight into the project and feel comfortable.  If you go deeper, then as in any real project dependencies will be more.  Let's add some more. <br><br>  In addition to the previously considered dependencies, add the following: <br><br><ul><li>  <code>File</code> - to store the cache </li><li>  <code>Cache</code> - for network cache </li><li>  <code>OkHttp3Downloader</code> - downloader using <code>OkHttpClient</code> to upload images </li><li>  <code>Picasso</code> - for processing images from the network </li></ul><br>  The code will look like this (you can view the full example <a href="https://github.com/Hariofspades/Dagger-2-Advanced/tree/Dagger2Prequel">in a separate thread</a> ): <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ Retrofit retrofit; RecyclerView recyclerView; RandomUserAdapter mAdapter; Picasso picasso; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); initViews(); GsonBuilder gsonBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GsonBuilder(); Gson gson = gsonBuilder.create(); Timber.plant(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timber.DebugTree()); File cacheFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getCacheDir(), <span class="hljs-string"><span class="hljs-string">"HttpCache"</span></span>); cacheFile.mkdirs(); Cache cache = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cache(cacheFile, <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-comment"><span class="hljs-comment">//10 MB HttpLoggingInterceptor httpLoggingInterceptor = new HttpLoggingInterceptor(new HttpLoggingInterceptor.Logger() { @Override public void log(@NonNull String message) { Timber.i(message); } }); httpLoggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY); OkHttpClient okHttpClient = new OkHttpClient() .newBuilder() .cache(cache) .addInterceptor(httpLoggingInterceptor) .build(); OkHttp3Downloader okHttpDownloader = new OkHttp3Downloader(okHttpClient); picasso = new Picasso.Builder(this).downloader(okHttpDownloader).build(); retrofit = new Retrofit.Builder() .client(okHttpClient) .baseUrl("https://randomuser.me/") .addConverterFactory(GsonConverterFactory.create(gson)) .build(); populateUsers(); } private void initViews() { recyclerView = findViewById(R.id.recyclerView); recyclerView.setLayoutManager(new LinearLayoutManager(this)); } private void populateUsers() { Call&lt;RandomUsers&gt; randomUsersCall = getRandomUserService().getRandomUsers(10); randomUsersCall.enqueue(new Callback&lt;RandomUsers&gt;() { @Override public void onResponse(Call&lt;RandomUsers&gt; call, @NonNull Response&lt;RandomUsers&gt; response) { if(response.isSuccessful()) { mAdapter = new RandomUserAdapter(picasso); mAdapter.setItems(response.body().getResults()); recyclerView.setAdapter(mAdapter); } } @Override public void onFailure(Call&lt;RandomUsers&gt; call, Throwable t) { Timber.i(t.getMessage()); } }); } public RandomUsersApi getRandomUserService(){ return retrofit.create(RandomUsersApi.class); } }</span></span></code> </pre><br>  <b>(Checkpoint)</b> <br>  <b>...</b> <br><br><h2>  Dependency graph </h2><br>  A dependency graph is nothing more than a diagram explaining the dependencies between classes.  The formation of such a graph makes the implementation more understandable (you will see this closer to the end).  Look at the dependency graph for our project. <br><img src="https://habrastorage.org/getpro/habr/post_images/a8b/d19/97d/a8bd1997d7af7c0ee8388f3e2ce556b3.jpg" alt="DI graph image"><br>  Green indicates high-level dependencies, which means that they are not needed by any other dependencies, but they need some of the dependencies. <br><br>  How to read this chart?  For example, <code>Picasso</code> two dependencies - <code>OkHttp3Downloader</code> and <code>Context</code> . <br><br>  To get random users using the API, you need <code>Retrofit</code> .  He, in turn, needs two dependencies - <code>GsonConvertFactory</code> and <code>OkHttpClient</code> and so on. <br><br>  <i>Take time to look at the code in <code>MainActivity</code> and compare it with the diagram for a better understanding.</i> <br>  <b>(Checkpoint)</b> <br>  <b>...</b> <br><br><h2>  Implementing dependencies with Dagger 2 </h2><br>  The full code can be found <a href="https://github.com/Hariofspades/Dagger-2-Advanced/tree/Dagger2">in a separate branch of the project</a> . <br><br><h4>  The note: </h4><br><ul><li>  <code>RandomUsersAPI</code> and <code>RandomUsersApi</code> are the same.  Just a typo in the chart. </li><li>  <code>RandomUsersComponent</code> will differ in the branch above and in the examples below.  I suggest you use a <a href="https://github.com/Hariofspades/Dagger-2-Advanced/tree/Dagger2Prequel">new thread</a> for full compliance with the examples below, and leave the above for reference. </li><li>  Please remember to bookmark the project on GitHub <i>(Star)</i> if it really helped you in your training. </li></ul><br><h4>  Step 1. Installing the Dagger 2 </h4><br>  Just add a few lines to the <code>build.gradle</code> file. <br><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">dependencies</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">implementation</span></span> <span class="hljs-string"><span class="hljs-string">'com.google.dagger:dagger:2.13'</span></span> annotationProcessor <span class="hljs-string"><span class="hljs-string">'com.google.dagger:dagger-compiler:2.13'</span></span> }</code> </pre><br><h4>  Step 2. Create Component </h4><br>  The component will be the interface for the entire dependency graph.  The best practice for using Component is to declare only top-level dependencies in it and to hide other dependencies. <br><br>  This means that only those dependencies that are marked in the dependency graph in green, that is, <code>RandomUsersAPI</code> and <code>Picasso</code> will be present in the Component. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RandomUserComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">RandomUsersApi </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRandomUserService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">Picasso </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPicasso</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  How does Component itself understand where to get the dependencies of <code>RandomUsersAPI</code> and <code>Picasso</code> ?  We use the modules. <br><br><h4>  Step 3. Creating modules </h4><br>  Now we need to move the code from <code>MainActivity</code> to different modules.  Looking at the dependency graph, you can decide which modules are needed. <br><br>  The first is the <code>RandomUsersModule</code> , it will provide the dependencies <code>RandomUsersApi</code> , <code>GsonConverterFactory</code> , <code>Gson</code> and <code>Retrofit</code> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RandomUsersModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> RandomUsersApi </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randomUsersApi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Retrofit retrofit)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> retrofit.create(RandomUsersApi.class); } <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Retrofit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">retrofit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OkHttpClient okHttpClient, GsonConverterFactory gsonConverterFactory, Gson gson)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Retrofit.Builder() .client(okHttpClient) .baseUrl(<span class="hljs-string"><span class="hljs-string">"https://randomuser.me/"</span></span>) .addConverterFactory(gsonConverterFactory) .build(); } <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Gson </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ GsonBuilder gsonBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GsonBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> gsonBuilder.create(); } <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GsonConverterFactory </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gsonConverterFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Gson gson)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GsonConverterFactory.create(gson); } }</code> </pre><br>  The second is the <code>PicassoModule</code> , which will provide the <code>Picasso</code> and <code>OkHttp3Downloader</code> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PicassoModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Picasso </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">picasso</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, OkHttp3Downloader okHttp3Downloader)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Picasso.Builder(context). downloader(okHttp3Downloader). build(); } <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> OkHttp3Downloader </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">okHttp3Downloader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OkHttpClient okHttpClient)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkHttp3Downloader(okHttpClient); } }</code> </pre><br>  In the <code>RandomUsersModule</code> module for <code>Retrofit</code> need <code>OkHttpClient</code> .  Which, in turn, needs other dependencies.  Why not make a separate module for this? <br><br>  Create an <code>OkHttpClientModule</code> that provides the <code>OkHttpCkient</code> , <code>Cache</code> , <code>HttpLoggingInterceptor</code> and <code>File</code> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OkHttpClientModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> OkHttpClient </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">okHttpClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Cache cache, HttpLoggingInterceptor httpLoggingInterceptor)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OkHttpClient() .newBuilder() .cache(cache) .addInterceptor(httpLoggingInterceptor) .build(); } <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cache </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File cacheFile)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cache(cacheFile, <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-comment"><span class="hljs-comment">//10 MB } @Provides public File file(Context context){ File file = new File(context.getCacheDir(), "HttpCache"); file.mkdirs(); return file; } @Provides public HttpLoggingInterceptor httpLoggingInterceptor(){ HttpLoggingInterceptor httpLoggingInterceptor = new HttpLoggingInterceptor(new HttpLoggingInterceptor.Logger() { @Override public void log(String message) { Timber.d(message); } }); httpLoggingInterceptor.setLevel(HttpLoggingInterceptor.Level.BODY); return httpLoggingInterceptor; } }</span></span></code> </pre><br>  The modules are almost ready, but the <code>PicassoModule</code> and <code>OkHttpClientModule</code> require a <code>Context</code> and maybe it will be useful to us in other places.  We will make a module for this purpose. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextModule</span></span></span><span class="hljs-class"> </span></span>{ Context context; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ContextModule</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context = context; } <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Context </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getApplicationContext(); } }</code> </pre><br><h4>  Step 4. We connect modules </h4><br>  Now we have all the modules and components, as in the picture below.  But how to transfer <code>Context</code> to other modules?  We need to link modules that depend on each other. <br><img src="https://habrastorage.org/getpro/habr/post_images/e4f/b65/e03/e4fb65e0300893e5c15721da0f2b1d4c.jpg" alt="modules and component image"><br>  To implement communication between modules, the <code>includes</code> attribute is required.  This attribute includes in the current module dependencies of the modules that are referenced. <br><br>  What modules need to be connected? <br><br><ul><li>  <code>RandomUsersModule</code> needs <code>OkHttpClientModule</code> </li><li>  <code>OkHttpClientModule</code> needs a <code>ContextModule</code> </li><li>  <code>PicassoModule</code> needs <code>OkHttpClientModule</code> and <code>ContextModule</code> .  Since <code>OkHttpClientModule</code> already connected to <code>ContextModule</code> , only <code>OkHttpClientModule</code> can be dispensed with <code>OkHttpClientModule</code> </li></ul><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  RandomUsersModule.java @Module(includes = OkHttpClientModule.class) public class RandomUsersModule { ... } //  OkHttpClientModule.java @Module(includes = ContextModule.class) public class OkHttpClientModule { ... } //  PicassoModule.java @Module(includes = OkHttpClientModule.class) public class PicassoModule { ... }</span></span></code> </pre><br>  So we connected all the modules. <br><img src="https://habrastorage.org/getpro/habr/post_images/b69/954/f23/b69954f237cd736fe5688f3cab8b827a.jpg" alt="linjed modules image"><br><h4>  Step 5. Linking Component and Modules </h4><br>  At the moment, all modules are connected and communicate with each other.  Now is the time to tell the Component or train it to access modules that provide it with the required dependencies. <br><br>  As we connected the modules to each other using the <code>includes</code> attribute, in a similar way, we can link the component and modules using the <code>modules</code> attribute. <br><br>  Considering the needs of the created component (the <code>getRandomUserService()</code> and <code>getPicasso()</code> methods), we include in the component links to the <code>RandomUsersModule</code> and <code>PicassoModule</code> <code>modules</code> using the <code>modules</code> attribute. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span>(modules = {RandomUsersModule.class, PicassoModule.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RandomUserComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">RandomUsersApi </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRandomUserService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">Picasso </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPicasso</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/739/ee3/bf5/739ee3bf5de226d3984017ff656a961f.jpg" alt="component and modules are connectes image"><br><h4>  Step 6. Build the project </h4><br>  If you did everything right, Dagger 2 will generate a class based on the component we have created that provides the necessary dependencies. <br><br>  Now in <code>MainActivity</code> you can conveniently retrieve the dependencies <code>Picasso</code> and <code>RandomUsersApi</code> using the <code>RandomUserComponent</code> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ RandomUsersApi randomUsersApi; Picasso picasso; .... <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); ... RandomUserComponent daggerRandomUserComponent = DaggerRandomUserComponent.builder() .contextModule(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContextModule(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) .build(); picasso = daggerRandomUserComponent.getPicasso(); randomUsersApi = daggerRandomUserComponent.getRandomUserService(); populateUsers(); ... } ... }</code> </pre><br><br><h4>  Step 7. Congratulate yourself! </h4><br>  You did it!  You used Dagger 2 in an Android application.  Congratulate yourself and take a break. <br>  <b>(Checkpoint)</b> <br>  <b>...</b> <br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/c46/79b/9ed/c4679b9ede47559eaeffb4f0835a3e45.gif" alt="image"><br></div></div><br><h2>  But there is a problem </h2><br>  What?  What is the problem? <br><br>  Each time you call <code>DaggerComponent.build()</code> , new instances of all the objects or dependencies you have configured are created.  In this case, why doesn't Dagger 2 know that I only need one copy of <code>Picasso</code> ?  In other words, how can we tell Dagger 2 to provide us with a dependency like singleton? <br><br><h4>  Abstract <code>@Scope</code> </h4><br>  The <code>@Scope</code> tells Dagger 2 to create only a single instance, even if <code>DaggerComponent.build()</code> is called multiple times.  This makes the dependency work like singleton.  To customize the desired area <i>(Scope)</i> you need to create your own annotation. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Scope</span></span> <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.CLASS) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> RandomUserApplicationScope { }</code> </pre><br>  <code>@Retention</code> is an annotation to indicate the point of deviation of the use of annotation.  She talks about when annotation can be used.  For example, with the SOURCE mark the annotation will be available only in the source code and will be discarded during compilation, with the CLASS mark the annotation will be available at compile time, but not during program operation, with the RUNTIME mark the annotation will be available during program execution. <br><br><h4>  <i>Scope</i> Usage </h4><br>  To use the created region, you need to start with the component, marking the annotation you created, and then tick each method that we need as a singleton. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RandomUserApplicationScope</span></span> <span class="hljs-meta"><span class="hljs-meta">@Component</span></span>(modules = {RandomUsersModule.class, PicassoModule.class}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RandomUserComponent</span></span></span><span class="hljs-class"> </span></span>{ ...} <span class="hljs-meta"><span class="hljs-meta">@Module</span></span>(includes = OkHttpClientModule.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PicassoModule</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@RandomUserApplicationScope</span></span> <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Picasso </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">picasso</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, OkHttp3Downloader okHttp3Downloader)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Picasso.Builder(context). downloader(okHttp3Downloader). build(); } ... } <span class="hljs-meta"><span class="hljs-meta">@Module</span></span>(includes = OkHttpClientModule.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RandomUsersModule</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@RandomUserApplicationScope</span></span> <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Retrofit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">retrofit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OkHttpClient okHttpClient, GsonConverterFactory gsonConverterFactory, Gson gson)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Retrofit.Builder() .client(okHttpClient) .baseUrl(<span class="hljs-string"><span class="hljs-string">"https://randomuser.me/"</span></span>) .addConverterFactory(gsonConverterFactory) .build(); } ... }</code> </pre><br>  This is how we create a single instance. <br><br><h4>  One more problem! </h4><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/970/abc/b89/970abcb89d89a1f3ce61486a135aa7bd.gif" alt="image"><br></div></div><br>  As a rule, in each application we use two kinds of context - <code>ApplicationContext</code> and <code>Activity</code> context.  How to provide them?  You can use <code>ContextModule</code> to provide an <code>ApplicationContext</code> .  Let's create another module. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActivityModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Context context; ActivityModule(Activity context){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context = context; } <span class="hljs-meta"><span class="hljs-meta">@RandomUserApplicationScope</span></span> <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Context </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context; } }</code> </pre><br>  But the class created does not solve the problem.  Now we provide two dependencies with the <code>Context</code> type and Dagger 2 will not be able to figure out how to use, an error will occur. <br><br><h2>  Abstract <code>@Named</code> </h2><br>  This summary will help us to distinguish the context.  Just add this annotation to the methods, not forgetting the attribute. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActivityModule</span></span></span><span class="hljs-class"> </span></span>{ .... <span class="hljs-meta"><span class="hljs-meta">@Named</span></span>(<span class="hljs-string"><span class="hljs-string">"activity_context"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@RandomUserApplicationScope</span></span> <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Context </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context; } } <span class="hljs-meta"><span class="hljs-meta">@Module</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextModule</span></span></span><span class="hljs-class"> </span></span>{ .... <span class="hljs-meta"><span class="hljs-meta">@Named</span></span>(<span class="hljs-string"><span class="hljs-string">"application_context"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@RandomUserApplicationScope</span></span> <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Context </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getApplicationContext(); } }</code> </pre><br>  Next, let Dagger 2 use the appropriate context in the right places. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span>(includes = ContextModule.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OkHttpClientModule</span></span></span><span class="hljs-class"> </span></span>{ .... <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-meta"><span class="hljs-meta">@RandomUserApplicationScope</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> File </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Named(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"application_context"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Context context)</span></span>{ File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(context.getCacheDir(), <span class="hljs-string"><span class="hljs-string">"HttpCache"</span></span>); file.mkdirs(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> file; } .... } <span class="hljs-meta"><span class="hljs-meta">@Module</span></span>(includes = OkHttpClientModule.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PicassoModule</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@RandomUserApplicationScope</span></span> <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Picasso </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">picasso</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Named(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"application_context"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">Context context, OkHttp3Downloader okHttp3Downloader)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Picasso.Builder(context). downloader(okHttp3Downloader). build(); ... }</code> </pre><br><h2>  Alternative annotations <code>@Named</code> - <code>@Qualifier</code> </h2><br>  To replace the <code>@Named</code> annotation with <code>@Qualifier</code> you need to create a separate annotation and use it where necessary. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Qualifier</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> ApplicationContext {}</code> </pre><br>  Then we annotate the method that provides the corresponding dependency. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextModule</span></span></span><span class="hljs-class"> </span></span>{ .... <span class="hljs-meta"><span class="hljs-meta">@ApplicationContext</span></span> <span class="hljs-meta"><span class="hljs-meta">@RandomUserApplicationScope</span></span> <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Context </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> context.getApplicationContext(); } }</code> </pre><br>  Next, we note the parameters of all methods where we need the <code>ApplicationContext</code> created by the annotation. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span>(includes = ContextModule.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OkHttpClientModule</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-meta"><span class="hljs-meta">@RandomUserApplicationScope</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> File </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@ApplicationContext Context context)</span></span></span></span>{ File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(context.getCacheDir(), <span class="hljs-string"><span class="hljs-string">"HttpCache"</span></span>); file.mkdirs(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> file; } .... } <span class="hljs-meta"><span class="hljs-meta">@Module</span></span>(includes = OkHttpClientModule.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PicassoModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@RandomUserApplicationScope</span></span> <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Picasso </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">picasso</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@ApplicationContext Context context, OkHttp3Downloader okHttp3Downloader)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Picasso.Builder(context). downloader(okHttp3Downloader). build(); } .... }</code> </pre><br>  <a href="https://github.com/Hariofspades/Dagger-2-Advanced/commit/b01c226ee7ca625cb11906672e0dac4fed47429b">Take a look at the corresponding commit</a> to see how you can replace the <code>@Named</code> annotation with <code>@Qualifier</code> . <br><br><h2>  Summary </h2><br>  At the moment, we have taken a simple project and implemented dependencies in it using Dagger 2 and annotations. <br><br>  We also studied 3 new annotations.  The first is <code>@Scope</code> , to get the dependencies in a single copy.  The second is <code>@Named</code> , to separate methods that provide dependencies of the same type.  The third is <code>@Qualifier</code> , as an alternative to <code>@Named</code> . <br><br><h2>  What's next? </h2><br>  At the moment we have considered only dependencies of the application level.  In the next article, we will look at the dependencies of the <code>Activity</code> level, create several components and learn how to work with them.  The next article will be released in a week. </div><p>Source: <a href="https://habr.com/ru/post/345372/">https://habr.com/ru/post/345372/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345362/index.html">Monte Carlo option premium calculation vs Black-Scholes formula</a></li>
<li><a href="../345364/index.html">We include support for TLS v1.3 in Nginx using the example of Debian 9</a></li>
<li><a href="../345366/index.html">Richard Hamming: "There are thoughts you can't think about"</a></li>
<li><a href="../345368/index.html">A selection of tutorials on AR / VR</a></li>
<li><a href="../345370/index.html">POWA-like PostgreSQL Monitoring with Prometheus</a></li>
<li><a href="../345374/index.html">Mikrotik RoS 6.41: Big Changes in Bridging and VLAN</a></li>
<li><a href="../345376/index.html">Study Tuples in C # 7</a></li>
<li><a href="../345380/index.html">The complete guide to Splash Screen on Android</a></li>
<li><a href="../345382/index.html">Symfony Flex Private Recipes: Creating, Customizing, and Using</a></li>
<li><a href="../345384/index.html">The market for cryptocurrency caught up in terms of trading volume with the New York Stock Exchange</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>