<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Noise reduction by combining images in java</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! I want to share the code of a simple program that I use to reduce noise from digital photographs. 

 About eight years ago, when looking ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Noise reduction by combining images in java</h1><div class="post__text post__text-html js-mediator-article">  Hello, Habr!  I want to share the code of a simple program that I use to reduce noise from digital photographs. <br><br>  About eight years ago, when looking at photos taken on my first digital camera, I found that some pictures with dim lighting have some kind of strange turbidity, colored spots, not sharpness.  At that time I didn‚Äôt know what noise is, how it depends on the ISO parameter and was very disappointed that the camera was so ‚Äúpoor quality‚Äù.  However, I noticed that in identical pictures these colored spots look somewhat differently, vary from frame to frame.  As time went on, I learned to shoot on the manual settings, I learned what noise is, how to set light sensitivity properly, etc. <br><br>  A few years later, when I started programming, I again noticed that the noise in the images is not static.  An idea arose in my head: what if you take, take several absolutely identical images, and then somehow merge them, eliminating the difference between the pictures, i.e.  noise? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, below are 4 images showing some photos of the same object, with random noise in each shot.  Red circles are represented as objects, and white are shown as noise. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/733/dd4/20e/733dd420e2db010fe85f62d3aa3aa348.jpg" alt="sample snapshots"><br><a name="habracut"></a><br>  First of all, I decided to try a banal way to combine these images in Photoshop, setting transparency of each image = 50%.  Of course, nothing good came of it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/38e/5c9/f74/38e5c9f7484b9e704ce5d91731548022.jpg" alt="processing result in adobe photoshop"><br><br>  This result is quite logical - the pixels are not averaged, but are simply added one to the other, and each subsequent layer also has a greater ‚Äúweight‚Äù above the lower layers. <br><br>  A little search on the Internet found that programs of this type already exist and are actively used among astrophotographers.  The shutter speeds on which the stars are shot are huge (and therefore noise), and the subject itself is static (when shooting with guiding), which makes it possible to eliminate noise by combining identical shots.  However, one thing remained: all the programs of this type that I found were very difficult to use, sharpened specifically for astrophoto and almost all cost a lot of money.  I did not need such functionality, and I continued the search. <br><br>  After some time, I found a site known in the circles of panoramic photographers of the German mathematician Helmut Dersch.  At the moment, almost all software for gluing panoramic images is based on its algorithms.  In addition to the software for processing panoramas on its website, I came across a program that eliminates noise from images - <a href="http://www.panotools.org/dersch/average/average.html">PTAverage</a> .  The program was incredibly simple - just drag the photos onto the label - and you get the result.  Just what I was looking for.  However, after playing a bit with PTAverage, I realized that this is not at all what I would like. <br><br>  Result of image processing by PTAverage: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/19a/352/b04/19a352b0478ac8bd0428cc8523840019.jpg" alt="processing result in PTAverage"><br><br>  As you can see, the program works in the simplest way: it gets the color of the pixel of each image, adds them together, and then divides them by the total number of all images.  However, I wanted some kind of selectivity: for example, if a pixel is black in two images and white in the third image, it is logical to assume that the pixel in the third image is noise.  In the end, I did not find anything suitable, and in the end I decided to write this software myself, since everything looked very easy. <br><br>  The program itself was written in java, because  studied it by that time for about a year.  The only catch was loading images in tiff format, but later I figured out the JAI library.  The disadvantage of the program is a huge memory consumption - JAI does not know how (or maybe I just did not find it) to read the image pixel-by-pixel without loading the entire image into memory. <br><br><div class="spoiler">  <b class="spoiler_title">Program code</b> <div class="spoiler_text">  To make the code clearer, remove all checks (such as image resolution, bits per channel, etc.): <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Denoise</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> inputFiles      * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> outputFile ,      * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> difference     (0-255) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> IOException */</span></span> Denoise(File[] inputFiles, File outputFile, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> difference) <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> IOException { <span class="hljs-comment"><span class="hljs-comment">//     Raster[] rasters = new Raster[inputFiles.length]; //     for(int i = 0; i&lt;inputFiles.length; i++) { try (ImageInputStream is = ImageIO.createImageInputStream(inputFiles[i])) { Iterator&lt;ImageReader&gt; imageReaders = ImageIO.getImageReaders(is) ; ImageReader imageReader = imageReaders.next(); imageReader.setInput(is); if(imageReader.canReadRaster()) { rasters[i] = imageReader.readRaster(0, null); } else { rasters[i] = imageReader.readAsRenderedImage(0, null).getData(); } } } //     ,       int width = rasters[0].getWidth(); int height = rasters[0].getHeight(); //     ,     WritableRaster outputRaster = rasters[0].createCompatibleWritableRaster(); //      ,      for(int x = 0; x&lt;width; x++){ for(int y = 0; y&lt;height; y++){ //,     int[] color = new int[3]; for(int band = 0; band&lt;3; band++){ //,      int data[] = new int[rasters.length]; for (int imageNum = 0; imageNum&lt;rasters.length; imageNum++) { data[imageNum] = rasters[imageNum].getSample(x, y, band); } //    color[band] = average(data, difference); } //     outputRaster.setPixel(x, y, color); } } //  BufferedImage output = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB); output.setData(outputRaster); ImageIO.write(output, "tiff", outputFile); } /** * * @param data          * @param difference     * @return    */ private int average(int[] data, int difference){ /** */ int imagesCount = data.length; /**   */ int median; // ,        Arrays.sort(data); //    ,      //      if(imagesCount % 2 == 0) { median = (data[imagesCount / 2 - 1] + data[imagesCount / 2]) / 2; } else { median = data[(int)Math.floor(imagesCount / 2)]; } //         int min = median - difference; int max = median + difference; //     int sumBands = 0; //  ,     min  max int counter = 0; //        for(int i = 0; i&lt;imagesCount; i++){ //      -      if(data[i]&gt;=min &amp;&amp; data[i]&lt;= max){ sumBands = sumBands+data[i]; counter++; } } //          (  ) //  -     , //   -   ,      if(counter &lt;= 1){ sumBands = 0; for(int i = 0; i&lt;imagesCount; i++){ sumBands = sumBands + data[i]; } sumBands = sumBands/imagesCount; } else { sumBands = sumBands / counter; } return sumBands; } }</span></span></code> </pre> <br></div></div><br><br>  We throw four original frames into the program and get an image without noise. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/767/b3e/d4e/767b3ed4e744b5b266e362c99228052b.jpg" alt="processing result"><br><br>  Practical application of the algorithm is difficult to find - the object for shooting must be static, the lighting of the object should not change, well, nothing will happen without a very stable tripod. <br><br>  By the way, the program has a certain ‚Äúside effect‚Äù - not only noise is removed, but any non-static object.  For example, having made a large number of frames from a lively area, it is theoretically possible to ‚Äúremove‚Äù all people.  Below is a small example. <br><br>  Pictures before processing;  As you can see from the pictures, the banana moves in a mysterious way. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/874/a21/020/874a21020837cfab5d216cdc76e6bf1e.jpg"><br><br>  But the result of processing - as you can see, the banana is not completely gone.  However, having made a larger number of frames, provided that the banana would continue to move, one could completely get rid of it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b80/e99/7e4/b80e997e48ebb032dda6e57c8f7b75d6.jpg" alt="processing result"><br><br>  What about noise?  Here, too, everything is fine, only three frames were enough to significantly reduce it (astrophotographers, for example, use, as far as I know, 15+ frames). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf9/723/cd2/cf9723cd23b7ad2f4e3588abf79386c9.jpg" alt="noise comparison"><br><br>  Of course, the algorithm I described is incredibly simple, and it is of little use in real practice, but I hope that someone will probably use it, or get something useful from the article. </div><p>Source: <a href="https://habr.com/ru/post/237423/">https://habr.com/ru/post/237423/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../237413/index.html">What is Kenevin and a little about the conference Lean Kanban Russia</a></li>
<li><a href="../237415/index.html">Identify search engine ranking algorithms</a></li>
<li><a href="../237417/index.html">Ranking Factor # 1: User Satisfaction</a></li>
<li><a href="../237419/index.html">Translation App Store Review Guidelines</a></li>
<li><a href="../237421/index.html">Web components in the implementation of Polymer from Google</a></li>
<li><a href="../237425/index.html">Inkjet printer diagnoses diabetes</a></li>
<li><a href="../237427/index.html">On the intricacies of the "encrypted pipeline" in the process of developing an IMAP client on Scala + Akka + Spray</a></li>
<li><a href="../237439/index.html">How to unlock iPad 3G locked in iCloud</a></li>
<li><a href="../237441/index.html">History: QuakeLive native Linux downloader</a></li>
<li><a href="../237443/index.html">The keyboard of the new generation - "10th"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>