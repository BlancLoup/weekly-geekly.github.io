<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vibration of the XboxOne gamepad for Unity3d</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unity3d has universal controller support via the Input class. After pre-setting the axes and buttons, you can achieve a tolerable work of any controll...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vibration of the XboxOne gamepad for Unity3d</h1><div class="post__text post__text-html js-mediator-article"><img src="http://litehtmlconv.azurewebsites.net/api/pics/exde_m6idcfxrjblzi21z3ml" align="left">  Unity3d has universal controller support via the Input class.  After pre-setting the axes and buttons, you can achieve a tolerable work of any controller.  Unfortunately, there will be no support for vibration for the Xbox 360 and Xbox One gamepads.  You can correct this situation by using, for example, the <a href="https://github.com/speps/XInputDotNet">XInputDotNet</a> plugin, but as it turned out, this plugin is not ready for use in Windows Store applications.  Therefore, a small XInput wrapper was made which works in this version. <br><a name="habracut"></a><br>  Creating plugins for Unity3d is quite a simple process.  To do this, you need to create a Class Library project in Visual Studio 2013, and do not forget to switch to .NET Framework 3.5 use mode. <br><img src="https://habrastorage.org/getpro/habr/post_images/282/2c2/67d/2822c267d3e65836e560d2cba0394640.png"><br><br>  Next, the resulting assembly must be transferred to the Assets directory, and all the classes that you have implemented will be available from Unity.  It is also convenient to place the Solution of your plugin directly in the directory in which the Unity project is located, and specify Output in the Assets directory: <br><img src="http://litehtmlconv.azurewebsites.net/api/pics/u81kk8qkwknvibachdogua4i"><br><br>  In order for the same plugin to work in the Windows Store application mode, in the same Solution for our plugin we create the Store Apps / Class Library project: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/705/912/1be/7059121bea92b1e72c2cabf3807d3891.png"><br><br>  The code of the plug-in can be used the same, in our case you don‚Äôt even have to do some conditional compilation conditions, the source files for both assemblies will be the same and you can simply link them: <br><img src="http://litehtmlconv.azurewebsites.net/api/pics/l6ie-f1-rkp3ah2xw4z5e8af"><br>  The build option for the Windows Store should be located in the <b>Assets</b> <b>/</b> <b>Plugins</b> <b>/</b> <b>Metro</b> directory: <br><img src="http://litehtmlconv.azurewebsites.net/api/pics/66jo1plyf6cpz_kzdtlixiv7"><br><br>  Needless to say, the file name of the plug-in for Windows Store should match the option for Desktop: <br><img src="https://habrastorage.org/getpro/habr/post_images/a69/bd7/09b/a69bd709bfde5cb9048ae0255d141eeb.png"><br><br>  If everything is done correctly, then Unity, when creating a version of the application for the Windows Store, ‚Äúpicks up‚Äù the replacement and the final build of the application in Visual Studio 2013 will take place correctly. <br><br>  The plugin itself is simple, and in fact is a wrapper over XInput functions: <br><br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DllImport(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"xinput1_4.dll"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">XInputGetState</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dwUserIndex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> XInputState pState </span></span></span><span class="hljs-function">)</span></span>; [DllImport(<span class="hljs-string"><span class="hljs-string">"xinput1_4.dll"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">XInputSetState</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dwUserIndex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> XInputVibration pVibration </span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br>  All necessary structures are prepared in accompanying classes. <br><br><h4>  Using the plugin to work with the gamepad </h4><br>  As already mentioned, it is now sufficient to place the assembly of the plug-in in the appropriate directories <b>/</b> <b>Assets</b> and <b>/</b> <b>Assets</b> <b>/</b> <b>Metro</b> , after which the functions will be available when developing the Unity application: <br><img src="https://habrastorage.org/getpro/habr/post_images/9c2/f51/ddf/9c2f51ddfbce9676c52d2b55cab0debd.png"><br>  Usually, work with gamepads is carried out in query mode (polling) before drawing each frame.  In Unity, each object has a void Update () method in which it will be possible to interrogate the state of buttons and axes and, depending on them, make changes to the behavior of game objects. <br>  As an example, you can look at the finished Unity project, which works both in desktop mode and can create an application for the Windows Store.  This is a <a href="http://tf3dm.com/3d-model/uh60-helicopter-47194.html">helicopter</a> that flies among the mountains.  Rather, of course, it does not fly, but ‚Äúfloats‚Äù since the full realization of helicopter physics is beyond the scope of this article. <br><img src="https://habrastorage.org/getpro/habr/post_images/b89/5f5/37c/b895f537c0edd6851f2b4d6d52639a44.png"><br>  At the same time, it reacts to input from the gamepad from all axes, DPAD and by pressing the right trigger ‚Äúmoves‚Äù accelerating forward and unwinding the main and tail screws: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { XInputWrapper.XInputState st=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XInputWrapper.XInputState(); XInputWrapper.XInput.XInputGetState(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> st); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mathf.Abs(st.Gamepad.sThumbLY) &gt; XInputWrapper.XInputConstants.XINPUT_GAMEPAD_RIGHT_THUMB_DEADZONE) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rotX_norm = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)st.Gamepad.sThumbLY / <span class="hljs-number"><span class="hljs-number">32767.0f</span></span>); transform.RotateAround(transform.position, transform.right, rotX_norm * <span class="hljs-number"><span class="hljs-number">20.0f</span></span>*<span class="hljs-number"><span class="hljs-number">-1.0f</span></span> * Time.deltaTime); } }</code> </pre><br><br>  Box Collider and RigidBody are associated with the helicopter object.  This makes it possible to receive notifications about collisions with other objects, and the vibration is actually implemented here.  As the helicopter hits the mountain, the gamepad vibrates a third of a second: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTriggerEnter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Collider other</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!vibrating) { XInputWrapper.XInputVibration vibr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XInputWrapper.XInputVibration(); vibr.LeftMotorSpeed = <span class="hljs-number"><span class="hljs-number">65535</span></span> / <span class="hljs-number"><span class="hljs-number">3</span></span>; vibr.RightMotorSpeed = <span class="hljs-number"><span class="hljs-number">65535</span></span> / <span class="hljs-number"><span class="hljs-number">3</span></span>; XInputWrapper.XInput.XInputSetState(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> vibr); vibrationStartTime = Time.time; vibrating = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre><br><br>  You can download the finished project for Unity and the source codes of the XInput wrapper at <a href="http://aka.ms/unitygmsmpl">http://aka.ms/unitygmsmpl;</a> if you only need a wrapper, you can download the archive only with assemblies at <a href="http://aka.ms/xinputwrapper">http://aka.ms/xinputwrapper</a> .  By the way, they can be used not only in Unity projects, but also for desktop applications and Windows store applications, including those written in HTML5 / Javascript. <br><br><h3>  useful links </h3><br><ul><li>  <a href="http://l.techdays.ru/go/azuretrial">Try Azure</a> for free for 30 days! <br><ul><li>  <a href="http://www.azurehub.ru/">Microsoft Azure Development Center (azurehub.ru)</a> - scripts, tutorials, examples, design recommendations </li><li>  <a href="http://www.twitter.com/windowsazure_ru">Twitter.com/windowsazure_ru</a> - the latest Microsoft Azure news </li><li>  <a href="http://www.facebook.com/groups/azurerus/">Microsoft Azure Community on Facebook</a> - experts, questions </li></ul></li><li>  <a href="http://l.techdays.ru/go/mva">Explore</a> Microsoft Virtual Academy <a href="http://l.techdays.ru/go/mva">courses</a> on cloud and other technologies <br><ul><li>  <a href="http://www.microsoftvirtualacademy.com/training-courses/building-domain-network-fundamentals-part2-rus">Basics of building a domain network.</a>  <a href="http://www.microsoftvirtualacademy.com/training-courses/building-domain-network-fundamentals-part2-rus">Part 2</a> </li><li>  <a href="http://www.microsoftvirtualacademy.com/training-courses/introduction-to-games-programming-on-unity-rus">Unity Game Programming Introduction</a> </li><li>  <a href="http://www.microsoftvirtualacademy.com/training-courses/business-and-cloud-best-practices-solutions-rus">Business and the cloud: best practices solutions</a> </li><li>  <a href="http://www.microsoftvirtualacademy.com/training-courses/the-microsoft-hybrid-cloud-best-practices-guidance-rus">Microsoft Hybrid Cloud: Typical Solutions Guide</a> </li><li>  <a href="http://www.microsoftvirtualacademy.com/training-courses/introduction-to-the-graphics-library-win2d-rus">Introduction to the Win2D Graphic Library</a> </li></ul></li><li>  <a href="http://l.techdays.ru/go/getvs">Download</a> free or trial Visual Studio </li><li>  <a href="http://l.techdays.ru/go/winstart">Become a</a> universal Windows application <a href="http://l.techdays.ru/go/winstart">developer</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/243021/">https://habr.com/ru/post/243021/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243009/index.html">Developer vulnerability in Raindrop.io</a></li>
<li><a href="../243011/index.html">Software renderer - 1: materiel</a></li>
<li><a href="../243013/index.html">Enthusiast designed a homemade 8-bit processor in Minecraft</a></li>
<li><a href="../243015/index.html">At any given time about the third part of Internet users are on-line.</a></li>
<li><a href="../243017/index.html">10 lessons on how to increase productivity, which I learned by working 90 hours a week for a month</a></li>
<li><a href="../243023/index.html">Why Spritz has become so popular over the past few weeks.</a></li>
<li><a href="../243025/index.html">New on VPS Search: Notepad Domains and Notepad Servers</a></li>
<li><a href="../243027/index.html">Wargaming Developers Contest: Winners Announcement</a></li>
<li><a href="../243033/index.html">How and why does Yandex disable its own data centers</a></li>
<li><a href="../243035/index.html">We catch snmp mac-notification traps from Cisco devices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>