<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New Year's check .NET Core Libraries (CoreFX)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About a year ago, Microsoft released open source source code for projects such as CoreCLR and CoreFX. Until recently, the last project was not interes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New Year's check .NET Core Libraries (CoreFX)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/9ec/b4a/5fd/9ecb4a5fd8fd0853a178c7090e0d1225.png" align="left">  About a year ago, Microsoft released open source source code for projects such as CoreCLR and CoreFX.  Until recently, the last project was not interesting to us, because it was written in C #, not C ++.  But with the release of the new version of PVS-Studio 6.00, which supports projects in the C # programming language, I decided to go back to CoreFX and write an article. <br><br><h2>  Introduction </h2><br>  The .NET Core is a modular implementation of libraries and a runtime environment that includes a subset of the .NET Framework.  The .NET Core consists of a set of libraries called ‚ÄúCoreFX‚Äù and a small optimized working environment ‚ÄúCoreCLR‚Äù. <br><br>  .NET Core is distributed open source, which is available on GitHub: <ul><li>  <a href="https://github.com/dotnet/corefx">.NET Core Libraries (CoreFX)</a> </li><li>  <a href="https://github.com/dotnet/coreCLR">.NET Core Common Language Runtime (CoreCLR)</a> </li></ul><br>  These are large Microsoft products that contain high-quality source code, but you can still find suspicious parts of the code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      You can read about CoreCLR verification in the article " <a href="http://habrahabr.ru/company/pvs-studio/blog/253280/">PVS-Studio: 25 Suspicious Fragments of Code from CoreCLR</a> ". <br><br>  The CoreFX project, which will be discussed in the article, was tested using the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> 6.00 static analyzer, which now supports C #! <br><a name="habracut"></a><br><h2>  Test results </h2><br>  Preparing an article about checking an <a href="http://www.viva64.com/ru/a/0084/">open project</a> , we provide in it information far from all warnings issued by the static analyzer.  Therefore, we recommend that the authors of the project independently perform an analysis and study all the messages issued by the analyzer. <br><br><h3>  The most dangerous places found </h3><br>  <a href="http://www.viva64.com/ru/d/0414/">V3027</a> The variable "start.BaseMapping" was used in the same logical expression.  Mappings.cs 598 <br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetSequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TypeDesc.IsRoot) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; StructMapping start = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-comment"><span class="hljs-comment">// find first mapping that does not have the sequence set while (!start.BaseMapping.IsSequence &amp;&amp; //&lt;== start.BaseMapping != null &amp;&amp; //&lt;==??? !start.BaseMapping.TypeDesc.IsRoot) start = start.BaseMapping; .... }</span></span></code> </pre> <br>  There is a serious logical error in the code!  In the body of the loop, an object named 'start' is changed at each iteration, and the loop is executed while the object is in a certain state.  BUT, the verification of the condition ‚Äústart.BaseMapping! = Null‚Äù is performed after referring to ‚Äústart.BaseMapping.IsSequence‚Äù, and this may lead to dereference of the zero reference. <br><br>  <a href="http://www.viva64.com/ru/d/0388/">V3019</a> Possibly incorrectly variable conversion compared to null after type conversion using 'as' keyword.  Check variables 'comparand', 'comparedCredentialKey'.  CredentialCache.cs 4007 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object comparand)</span></span></span><span class="hljs-function"> </span></span>{ CredentialHostKey comparedCredentialKey = comparand as CredentialHostKey; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (comparand == null) { <span class="hljs-comment"><span class="hljs-comment">// This covers also the compared == null case return false; } bool equals = string.Equals(AuthenticationType, comparedCredentialKey.AuthenticationType, .... .... }</span></span></code> </pre> <br>  An object can come in a function of any type or null.  If null comes, this case will be processed correctly.  If this is an object of this type that cannot be converted to the ‚ÄúCredentialHostKey‚Äù type, then an error will occur when accessing ‚ÄúcomparedCredentialKey.AuthenticationType‚Äù, since  The "comparedCredentialKey" variable can be null. <br><br>  Most likely, they wanted to write this: <br><pre> <code class="cpp hljs">CredentialHostKey comparedCredentialKey = comparand as CredentialHostKey; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (comparedCredentialKey == null) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Similar place in the code: <ul><li>  V3019 Possibly incorrectly variable conversion compared to null after type conversion using 'as' keyword.  Check variables 'comparand', 'comparedCredentialKey'.  CredentialCache.cs 497 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'HResult' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 169, 166. WebSocketException.cs 169 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetErrorCodeOnError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nativeError)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Succeeded(nativeError)) { HResult = nativeError; } HResult = nativeError; <span class="hljs-comment"><span class="hljs-comment">//&lt;==??? }</span></span></code> </pre> <br>  For some reason, regardless of the condition, the variable ‚ÄúHResult‚Äù always takes the same value.  Most likely the function should be implemented in another way. <br><br>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'ResPrec' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 1735, 1731. SQLDecimal.cs 1735 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> SqlDecimal <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> /(SqlDecimal x, SqlDecimal y) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ResPrec; .... ResPrec = ResScale + x.m_bPrec + y.m_bPrec + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//&lt;== MinScale = Math.Min(ResScale, s_cNumeDivScaleMin); ResInteger = Math.Min(ResInteger, s_NUMERIC_MAX_PRECISION); ResPrec = ResInteger + ResScale; //&lt;== if (ResPrec &gt; s_NUMERIC_MAX_PRECISION) ResPrec = s_NUMERIC_MAX_PRECISION; .... }</span></span></code> </pre> <br>  It is very suspicious that the value of the variable ‚ÄúResPrec‚Äù is calculated using a certain formula, but then it is simply triturated by another value. <br><br>  <a href="http://www.viva64.com/ru/d/0410/">V3020</a> An unconditional 'return' within a loop.  Enumerable.cs 517 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MoveNext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (state) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: _enumerator = _source.GetEnumerator(); state = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (_enumerator.MoveNext()) { current = _selector(_enumerator.Current); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } Dispose(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Strangely, in the body of the ‚Äúwhile‚Äù loop, the function exits without any condition.  Perhaps there is an error in the code. <br><br>  Another similar cycle: <ul><li>  V3020 An unconditional 'return' within a loop.  JsonDataContract.cs 128 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0395/">V3008</a> The 'prefix' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 953, 952. XmlSerializationWriter.cs 953 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteAttribute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> localName, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ns, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> prefix = localName.Substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, colon); prefix = _w.LookupPrefix(ns); _w.WriteStartAttribute(prefix, localName.Substring(colon + <span class="hljs-number"><span class="hljs-number">1</span></span>), ns); .... }</code> </pre> <br>  In the 'prefix' variable, the substring from the 'localName' is stored with a long ‚Äúcolon‚Äù, then this value is ground to another.  Further along the code, you can see that the remaining substring from 'localName' is used, and the first part was lost.  Very doubtful code. <br><br>  <a href="http://www.viva64.com/ru/d/0415/">V3030</a> Recurring check.  The 'baseTableRowCounts == null' condition was already verified in line 68. MetadataAggregator.cs 70 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MetadataAggregator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (baseTableRowCounts == null) <span class="hljs-comment"><span class="hljs-comment">//&lt;== { if (baseReader == null) { throw new ArgumentNullException("deltaReaders"); } if (baseReader.GetTableRowCount(TableIndex.EncMap) != 0) { throw new ArgumentException("....", "baseReader"); } CalculateBaseCounts(baseReader, out baseTableRowCounts, //&lt;== out baseHeapSizes); } else { if (baseTableRowCounts == null) //&lt;==??? { throw new ArgumentNullException("baseTableRowCounts"); } .... } .... }</span></span></code> </pre> <br>  The analyzer detected a condition that has already been tested.  If you look at the code snippet, then the last check in the 'else' - ‚ÄúbaseTableRowCounts == null‚Äù does not make sense.  But above the code you can see that if the variable ‚ÄúbaseTableRowCounts‚Äù is null, then its value is attempted to be changed by calling the function CalculateBaseCounts ().  After this function, most likely, there is not enough additional checking ‚ÄúbaseTableRowCounts == null‚Äù.  Those.  Most likely the code should look like this: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MetadataAggregator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (baseTableRowCounts == null) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (baseReader == null) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"deltaReaders"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (baseReader.GetTableRowCount(TableIndex.EncMap) != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"...."</span></span>, <span class="hljs-string"><span class="hljs-string">"baseReader"</span></span>); } CalculateBaseCounts(baseReader, out baseTableRowCounts, out baseHeapSizes); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (baseTableRowCounts == null) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"baseTableRowCounts"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .... } .... }</code> </pre> <br><h3>  The remaining warnings </h3><br>  <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'readercount&gt; = 0' is always true.  Unsigned type value is always&gt; = 0. ReaderWriterLockSlim.cs 977 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExitAndWakeUpAppropriateWaitersPreferringWriters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... uint readercount = GetNumReaders(); .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readercount == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; _numWriteUpgradeWaiters &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readercount == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; _numWriteWaiters &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { ExitMyLock(); _writeEvent.Set(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readercount &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ExitMyLock(); .... }</code> </pre> <br>  The ‚Äúreadercount‚Äù variable is of unsigned type, so the condition ‚Äúreadercount&gt; = 0‚Äù does not make sense.  Most likely, before it was a sign type, but then for the ExitMyLOck () function in the last 'else' there was at least some chance of being executed.  Now this code never gets control.  It is necessary to rewrite this place. <br><br>  <a href="http://www.viva64.com/ru/d/0384/">V3014</a> It is likely that a variable is being incremented inside the 'for' operator.  Consider reviewing 'i'.  RegexCharClass.cs 1094 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Canonicalize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">1</span></span>, j = <span class="hljs-number"><span class="hljs-number">0</span></span>; ; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (last = _rangelist[j]._last; ; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == _rangelist.Count || last == LastChar) { done = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((CurrentRange = _rangelist[i])._first &gt; last + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (last &lt; CurrentRange._last) last = CurrentRange._last; } _rangelist[j] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SingleRange(_rangelist[j]._first, last); j++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (done) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j &lt; i) _rangelist[j] = _rangelist[i]; } _rangelist.RemoveRange(j, _rangelist.Count - j); .... }</code> </pre> <br>  The analyzer detected a change in the counter of one cycle in another.  It is difficult to say whether there is an error in this function, but it is not written very clearly.  It is possible somewhere to make a mistake in the index when accessing an array, since  in such a code it is difficult to follow the change of one counter in several cycles. <br><br>  <a href="http://www.viva64.com/ru/d/0402/">V3004</a> The 'then' statement is equivalent to the 'else' statement.  XmlSerializationWriterILGen.cs 1213 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteMember</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., TypeDesc memberTypeDesc, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (memberTypeDesc.IsArray) { LocalBuilder localI = ilg.DeclareOrGetLocal(typeof(Int32), iVar); ilg.For(localI, <span class="hljs-number"><span class="hljs-number">0</span></span>, ilg.GetLocal(aVar)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { LocalBuilder localI = ilg.DeclareOrGetLocal(typeof(Int32), iVar); ilg.For(localI, <span class="hljs-number"><span class="hljs-number">0</span></span>, ilg.GetLocal(aVar)); } .... }</code> </pre> <br>  A condition that does not affect anything, because  one code will always be executed.  Classic copy-paste. <br><br>  <a href="http://www.viva64.com/ru/d/0402/">V3004</a> The 'then' statement is equivalent to the 'else' statement.  SqlUtil.cs 93 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ContinueTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (connectionToDoom != null || connectionToAbort != null) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { onSuccess(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { completion.SetException(e); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// no connection to doom - reliability section not required try { onSuccess(); } catch (Exception e) { completion.SetException(e); } } .... }</span></span></code> </pre> <br><br>  Here, too, there is something a lot of the same code in the condition, although the commentary says that the situations are different. <br><br><h2>  Conclusion </h2><br>  Here is another project from Microsoft.  For such a volume, the project has a fairly high-quality code, but programmers can still make mistakes.  The article is an overview and contains far from all analyzer warnings that were received in the report. <br><br>  Two very important circumstances contribute to quality code: <ol><li>  Regular static analysis of the project, not a one-time; </li><li>  Viewing analyzer warnings by corresponding code snippets. </li></ol><br>  We hope you enjoyed this article.  We promise to continue to delight our readers with checks of interesting open projects in C / C ++ and C #. <br><br>  Thanks for attention.  And bezbezhnogo you code in the New Year! <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0365/"><img src="https://habrastorage.org/getpro/habr/post_images/35e/064/ddf/35e064ddf91f5d99b620384893909ff7.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Svyatoslav Razmyslov.  <a href="http://www.viva64.com/en/b/0365/">Christmas Analysis of .NET Core Libraries (CoreFX)</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/274191/">https://habr.com/ru/post/274191/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274181/index.html">Unit Tests in ABAP. Part Three Every kind of fuss</a></li>
<li><a href="../274183/index.html">How I searched (and found) the difference in two byte-identical files.</a></li>
<li><a href="../274185/index.html">Diagnosing and fixing memory leaks in TypeScript applications</a></li>
<li><a href="../274187/index.html">Development Environment: Redmine + Git + ownCloud</a></li>
<li><a href="../274189/index.html">Does your site have problems with Google?</a></li>
<li><a href="../274193/index.html">Draw together. Portrait of user IE 8 full face</a></li>
<li><a href="../274195/index.html">Direct disk access from python</a></li>
<li><a href="../274197/index.html">Computational chemistry is a modern way to obtain the necessary chemical compounds from IBM</a></li>
<li><a href="../274203/index.html">The quickest start with Angular 2 (beta) and Dart</a></li>
<li><a href="../274205/index.html">Data Festival at the Moscow Museum, as it were</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>