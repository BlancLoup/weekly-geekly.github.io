<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Poor PPPoE providers and Ethernet flood</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entry, retreat or just a complaint about the fate of the villain and the provider 
 I am writing this habrapost in the hope of making life for Moscow ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Poor PPPoE providers and Ethernet flood</h1><div class="post__text post__text-html js-mediator-article"><h4>  Entry, retreat or just a complaint about the fate of the villain and the provider </h4><br>  I am writing this habrapost in the hope of making life for Moscow subscribers of Akado, who are sitting through routers at expensive tariffs, a little clearer and maybe easier ... <br>  (I‚Äôll make a reservation right away - for the time being, I‚Äôm enikeyschik or advanced user, so the post does not pretend to be professional, but it may be accessible, understandable and relevant) <br>  Approximate chronology of events is as follows: <br>  Spring 2012 - purchase of a MikroTik RB751G-2HnD router in order to get full stable Internet speed (50Mbit / s in both directions) <br>  Summer somehow works, but for some reason, Wi-Fi periodically gives out pings 200ms to the router, and the CPU load with usual web surfing is ~ 40% <br>  The beginning of November - the situation is getting worse, the capacity in the evening drops to 20 mbps at best (usually no more than 5), I notice that at night the problem disappears by itself, there are vague suspicions ... <br>  The second half of November - the call of the emergency services, calls to all the bells and the universal Achtung. <br>  November 28 solution to the problem. <br><a name="habracut"></a><br><h4>  Beginning of the End </h4><br>  So, I lived somehow with the Internet Akado until November of this year, enjoyed life, secretly gave myself priority on traffic over my neighbors, when suddenly the Internet became completely bad, so that I was thinking about switching to browsers that have P2P YouTube plug-in, so that you can watch at least 720p on a beautiful FHD screen (for some reason, torrents could still be pumped out at an average of 15Mbit / s) ... <br>  As a result, the opera, under which this plugin was found, categorically refused to download it: it simply produced a network error in the middle of the download.  I decided ‚ÄúEnough to endure IT!‚Äù, Began to terrorize the support service, and later called the emergency services (well, at least they didn‚Äôt impute a false call) - to no purpose, ‚ÄúDirectly there is speed‚Äù was the answer to me from the very beginning ... I started to sin on the microtic and play with the firmware, and to the call of specialists, I also replaced the router (with the same model) - just in case.  In general, none of the acadas could even help me understand ‚Äúwhere the pig is buried‚Äù ... It is worth saying that before the last appeals to the TP I still noticed that the physical interface of the traffic comes in the evenings a lot more than it goes to the local network through PPPoE connection.  In general, I didn‚Äôt feel the support from zero support, even moral and that from the provider. <br><br><h5>  Emergency workers </h5><br>  About these nice guys in overalls and with a netbook on the edge, well, how can I not tell about these? <br>  In general, the application was compiled, it noted separately (as I was assured in the TP) that I should call on my cell phone, that I did not use my home (although it was turned on), but no, we don‚Äôt usually look for easy ways! <br>  It wakes me up by a home phone call (and the devil pulled my phone off the hook?) At about 3 o'clock in the afternoon (thanks to Habra, it was delicious at night) - "Is this from Akado, will you be home in an hour?" just yesterday? <br>  Two specialists come (sensei and trainee, common practice, staff turnover, as I understand, there are worse than McDonald's (sensei, by the way, they just called me for a new job offer)), they look, they show that speed is ( they show from my laptop, the netbook did not want to be friends with speedtest) and that, they say, I want from them ... I explain 3 minutes that the reserve in the TP said that I needed to be helped to understand what kind of flood the interface goes even with PPPoE turned off ... it turned out that in the field they work quite adequately for themselves and my ‚Äúmessage‚Äù reached them, seniors  , realizing that I, in general, also do not have an extra chromosome, plaintively asked, ‚ÄúCan you connect to the corbin?‚Äù, I reply that I already had the good fortune to sit on the corbin and don‚Äôt even want to get involved with them, but I‚Äôll definitely switch to on-line when he Zhulebino gets to, and now be so kind ... <br>  In general, the emergency services telephoned with the administrator, quite so self-explanatoryly explained the situation, politely increased the number of routers I replaced from the 1st to the 5th and in general it is clear that I wanted to help and understood that the request was crooked, that he didn‚Äôt need anything here, it's time to leave ... in general, okay, they quarreled with the admin, the administrator noticed some completely inexplicable packet loss for me, started digging ... <br>  In general, the emergency workers left me, and after a couple of hours I lost the link ... well, I think everything, the switch burned, I had a trouble in it, but no: I called the TP, they say that the rest of the house is in touch and that they will send a specialist tomorrow .  I don‚Äôt mind, everything seems to be right, but the next day (literally half an hour ago, a neighbor (I signed a contract) called), it turned out that we were banned, we were such a bad DHCP server that was raised on the WAN interface ... Then I‚Äôll probably start to resent : what the hell is a dhcp server?  Yes, I raised DHCP on the WAN, but it was the Client, so that it was possible to ping the gate from the router during the visit of the emergency services ... as a result, today we had a normal Internet again, only I still have the router with the same DHCP settings.  but today, for some reason, we are not banned ... In general, the deeper into the forest, the thicker n ... artists. <br><br><h4>  Kind people </h4><br>  My luck with me is simply wonderful, in all respects, my father, and, to put it mildly, ‚Äúin the subject line‚Äù (so much so that I have optics before an apartment in Izhevsk, but I learned about any restrictions on traffic and tariffs exactly because I was always interested in what my dad was doing at work ...), so I quickly responded to my pleas for help and got into the situation right away: he said that it was normal for PPPoE to break the sausage and it was necessary to drive the provider either to give a local network service?  OK.  And why do I then have PPPoE requests from the entire segment for the incoming interface, and then let's do the opposite with the local network, but without this garbage? ‚Äù(Of course, it was easier said that this provider is just very lazy and greedy, but I really right now, emotions are over the edge, so I‚Äôm asking you to ‚ÄúUnderstand and forgive‚Äù), well, or set up access lists on the router and not let the router suffer from any garbage. <br>  In general, that evening, after the departure of the emergency services and the inclusion of a 3g router on the phone (well, at least a mobile phone is decent and anlim is not expensive (oh, I would have gotten to grandmas without anlim, 1.5 GB for the night with my neighbors dragged I'm at war with the provider does not mean that the neighbors must suffer))), I sat down to look for where I could twist something in the router (it‚Äôs difficult to call an optimist, I didn‚Äôt have a particular faith provider) and here begins the witch and the payload of this post. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Bubnim and shaman </h4><br>  Immediately, I‚Äôll make a reservation that even the microtic has a terminal mode and a terminal in the configuration utility, but, as I wrote, in this regard, I‚Äôm only an advanced user, in a word, it was more convenient for me to press buttons. <br>  As it turned out, even finding references to ACL and access sheets in the manual to RouterOS is problematic, and I really don‚Äôt know, but ‚Äúthis is it so called‚Äù or something else, in general, to cut off extra traffic in Mac before processing by the main processor in the section Switch &gt;&gt; Rule: <br><img src="https://habrastorage.org/storage2/13a/aeb/222/13aaeb2224ff3e67ad0c6d7b7a535634.jpg"><br>  the options window of the rule being created looks like this, the required fields are switches (from the list, in our case, the switch is only 1) and ports (physical interfaces of the switch): <br><img src="https://habrastorage.org/storage2/1ff/bd1/ccd/1ffbd1ccdaf494028a2410eecd33a59e.jpg"><br>  and the action window looks like this, it is worth noting that there is no such action as Drop, but you can simply not transfer the packet to the CPU processing: <br><img src="https://habrastorage.org/storage2/31d/a31/eaf/31da31eaf181b352ab74016b6dcaeace.jpg"><br>  Separately, it should be noted that the switch rules do not have a sequence - they are all executed, so the sequence of creating rules does not matter. <br>  Now we need to know, and from which poppy we need to process packets?  To do this, we have a wonderful tool in the configurator itself (in the web admin area too) PPP &gt;&gt; PPPoE Scan: <br><img src="https://habrastorage.org/storage2/536/faf/aa3/536fafaa3b567779a709ebb92d5bfe0a.jpg"><br>  - from here we take the Src MAC Address, the presence of the Dst address in my rule is rather overkill, it can be viewed in the window of the expected input interface, but this is not necessarily Interfaces &gt;&gt; Interface &gt;&gt; Port of interest: <br><img src="https://habrastorage.org/storage2/3c6/36a/340/3c636a34021895a411e41bc25e0d8543.jpg"><br>  Next, we simply create an ‚Äúempty‚Äù rule without the redirect option and copying to the CPU (the mac protocol, in this case, is just overkill): <br><img src="https://habrastorage.org/storage2/97b/1c7/b69/97b1c7b69765e5de743a772e6104eb7c.jpg"><br>  Everything, now it will work, but we can only feel it - the WAN will still show excess traffic (well, the switch received it). <br><br><h4>  Curtain, titles, postscript </h4><br>  There will only be further developments with the provider (if the events will be), you will not find anything technically curious here (although I initially warned that the article would be rather curious to Akado users, who are imbued with Akado's attitude to the client and realize that there prevails in the general mess ). <br>  Actually, everything: I‚Äôm sitting with my megabits, and Akado is going to thoughtfully study my claim for 2 months about the fact that it‚Äôs extremely difficult to even extract critical data for setting up, and it‚Äôs ugly for the client ... By the way, they cannot even now place my instructions for resolving a problem on the site in the question and answer section (at least) and the problems themselves for many of their users for a long time are likely to remain inexplicable bugs with which they don‚Äôt by  Can neither technical support nor the incoming driver.  Approximately from such considerations I wrote this post and a link to it (if he ever sees the light of an open article) will appear on the microtic forum, where they could not help me at once, and on the forum of my favorite provider, where I haven‚Äôt seen in 3 days one answer. <br><br>  Small PS: people (including Habra), be kinder and easier <s>and do not, please spoil my karma even more</s> ... </div><p>Source: <a href="https://habr.com/ru/post/160643/">https://habr.com/ru/post/160643/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../160631/index.html">Almost real transformer in scale 1:12</a></li>
<li><a href="../160633/index.html">Service of search for components for copters and not only</a></li>
<li><a href="../160635/index.html">State final certification in schools - not all like the exam</a></li>
<li><a href="../160637/index.html">Apple fired cardholder in iOS 6</a></li>
<li><a href="../160641/index.html">Microsoft says Gmail users are switching to Outlook.com, and launched an Android application</a></li>
<li><a href="../160647/index.html">Configuring your first VDS server as a web server</a></li>
<li><a href="../160649/index.html">Some additional thoughts about the future of IT for 2012-17</a></li>
<li><a href="../160651/index.html">Pagination for Backbone.js</a></li>
<li><a href="../160653/index.html">Amazon Redshift: New Petabyte Data Warehouse</a></li>
<li><a href="../160655/index.html">Installing Window7 (64Bit) on a GPT disk, on motherboards with EFI, without USB / DVD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>