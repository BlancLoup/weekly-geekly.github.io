<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Privoxy + opera get rid of ads</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the acquisition of unlimited and the inclusion of images (yes, the small joys of a provincial student), the question of choosing an advertisemen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Privoxy + opera get rid of ads</h1><div class="post__text post__text-html js-mediator-article"> After the acquisition of unlimited and the inclusion of images (yes, the small joys of a provincial student), the question of choosing an advertisement re-cutter arose.  Here is a small digression: I hate advertising.  No, everyone on the Internet hates advertising, but I have at least 3 compelling reasons to hate it: <br>  1) Bright, checkered, often interferes with surfing <br>  2) My old comp computer hardly turns colorful flushes.  Father's computer and even more so. <br>  3) It hurts unpleasantly, showing the mother a book on the vareznik, contemplating jumping bare ass and stuff. <br>  Both I and my father used the opera and were not going to change it for anything, so the problem of choosing a cutter was quite acute.  For some reason, I didn‚Äôt want to use Block CSS in the opera, but now I don‚Äôt want to. <a name="habracut"></a>  After a short googling, my choice fell on privoxy.  This is a powerful advertiser that works on the side of the router (in my case, because I have a home local router on the slak, my computer and my father) as a proxy server.  This approach in filtering ads suited me, because it was easy to prescribe a proxy, if you want to disable it, and so on. <br>  In this article I will describe my steps for installing and configuring privoxy on my home server under skackware 13. <br>  To begin with, we had to create a user and a group privoxy.  I leave the creation method of your choice. <br>  I decided to install the program using <a href="http://ir0n.habrahabr.ru/blog/91073/">src2pkg</a> .  And then it turned out that without a few gestures can not do. <br>  An example installation looks like this: <br> <code>mkdir /tmp/privoxy <br> cd /tmp/privoxy <br> wget 'http://heanet.dl.sourceforge.net/project/ijbswa/Sources/3.0.16%20(stable)/privoxy-3.0.16-stable-src.tar.gz'</code> <br>  Next, create two scripts in the same folder: <br>  privoxy.src2pkg: <br> <code>#!/bin/bash <br> ## src2pkg script for: privoxy <br> ## Auto-generated by src2pkg-2.2 <br> ## src2pkg - Copyright 2005-2009 Gilbert Ashley &lt;amigo@ibilio.org&gt; <br> <br> SOURCE_NAME='privoxy-3.0.16-stable-src.tar.gz' <br> NAME='privoxy' # Use ALT_NAME to override guessed value <br> VERSION='3.0.16' # Use ALT_VERSION to override guessed value <br> # ARCH='' <br> # BUILD='1' <br> # PRE_FIX='usr' <br> <br> # from the privoxy.SlackBuild: <br> PRIVOXY_USER=${PRIVOXY_USER:-privoxy} <br> PRIVOXY_GROUP=${PRIVOXY_GROUP:-privoxy} <br> if ! grep -q ^$PRIVOXY_GROUP: /etc/group 2&gt;/dev/null ; then <br> echo " Error: PRIVOXY group ($PRIVOXY_GROUP) doesn't exist." <br> echo " Try creating one with: groupadd -g 206 $PRIVOXY_GROUP" <br> exit 1 <br> fi <br> if ! grep -q ^$PRIVOXY_USER: /etc/passwd 2&gt;/dev/null ; then <br> echo " Error: PRIVOXY user ($PRIVOXY_USER) doesn't exist." <br> echo " Try creating one with: useradd -u 206 -g $PRIVOXY_GROUP -d /dev/null -s /bin/false $PRIVOXY_USER" <br> exit 1 <br> fi <br> <br> # Any extra options go here: <br> EXTRA_CONFIGS="--sysconfdir=/etc/$NAME \ <br> --localstatedir=/var \ <br> --docdir=$docdir/$NAME-$VERSION \ <br> --with-docbook=no \ <br> --with-user=$PRIVOXY_USER \ <br> --with-group=$PRIVOXY_GROUP" <br> <br> # Optional function replaces configure_source, compile_source, fake_install <br> # To use, uncomment and write/paste CODE between the {} brackets. <br> # build() { CODE } <br> <br> # Get the functions and configs <br> . /usr/libexec/src2pkg/FUNCTIONS ; <br> <br> # Execute the named packaging steps: <br> pre_process <br> find_source <br> make_dirs <br> unpack_source <br> fix_source_perms <br> <br> #cd $SRC_DIR <br> #autoheader <br> #autoconf <br> <br> configure_source # <br> compile_source # If used, the 'build' function replaces these 3 <br> fake_install # <br> <br> mkdir -p $PKG_DIR/etc/$NAME/templates <br> cp $SRC_DIR/templates/* $PKG_DIR/etc/$NAME/templates <br> <br> #Adapted from the privoxy.SlackBuild: <br> rm -rf $PKG_DIR/etc/rc.d <br> mkdir -p $PKG_DIR/etc/rc.d <br> cat $SRC_DIR/slackware/rc.privoxy.orig &gt; $PKG/etc/rc.d/rc.$NAME.new <br> sed -i " s/%PROGRAM%/$NAME/ <br> s,%SBIN_DEST%,/usr/bin, <br> s,%CONF_DEST%,/etc/$NAME, <br> s/%USER%/$NAME/ <br> s/%GROUP%/$NAME/ <br> " $PKG_DIR/etc/rc.d/rc.$NAME.new <br> <br> # Fix Path within the configuration files (thanks to h4kteur) <br> sed -i "s#$PKG_DIR##g" $PKG_DIR/etc/$NAME/config <br> # Fix Path with the config file to point to right usermanual (thanks to BP{k}) <br> sed -i \ <br> "s#user-manual /usr/doc/$NAME#user-manual /$docdir/$NAME-$VERSION#" \ <br> $PKG_DIR/etc/privoxy/config <br> <br> # Make .new files so we dont clobber existing configuration <br> find $PKG_DIR/etc/privoxy -type f -exec mv {} {}.new \; <br> # Don't clobber the logfile either <br> mv $PKG_DIR/var/log/privoxy/logfile $PKG_DIR/var/log/privoxy/logfile.new <br> # Remove this directory since it's empty and part of Slackware base <br> rmdir $PKG_DIR/var/run &amp;&gt; /dev/null <br> <br> fix_pkg_perms <br> strip_bins <br> create_docs <br> compress_man_pages <br> make_description <br> make_doinst <br> make_package <br> post_process</code> <br> <br>  doinst.prepend: <br> <code># Keep same perms on rc.privoxy.new: <br> if [ -e etc/rc.d/rc.privoxy ]; then <br> cp -a etc/rc.d/rc.privoxy etc/rc.d/rc.privoxy.new.incoming <br> cat etc/rc.d/rc.privoxy.new &gt; etc/rc.d/rc.privoxy.new.incoming <br> mv etc/rc.d/rc.privoxy.new.incoming etc/rc.d/rc.privoxy.new <br> fi <br> <br> # If there's no existing log file, move this one over; <br> # otherwise, kill the new one <br> if [ ! -e var/log/privoxy/logfile ]; then <br> mv var/log/privoxy/logfile.new var/log/privoxy/logfile <br> else <br> rm -f var/log/privoxy/logfile.new <br> fi <br> <br> if ! grep -q ^privoxy: /etc/group 2&gt;/dev/null ; then <br> echo " Error: PRIVOXY group 'privoxy' doesn't exist." <br> echo " Creating one with: groupadd -g 206 privoxy" <br> groupadd -g 206 @PRIVOXY_GROU@ <br> fi <br> <br> if ! grep -q ^privoxy: /etc/passwd 2&gt;/dev/null ; then <br> echo " Error: PRIVOXY user 'privoxy' doesn't exist." <br> echo " Try creating one with: useradd -u 206 -g privoxy -d /dev/null -s /bin/false privoxy" <br> exit 1 <br> fi <br> <br> if ! [ -x etc/rc.d/rc.privoxy ]; then <br> echo " etc/rc.d/rc.privoxy must be set executable to enable privoxy at boot-time:" <br> echo " chmod 755 /etc/rc.d/rc.privoxy" <br> fi <br></code> <br>  For the scripts, we say thanks to the developer src2pkg Gilbert Ashley. <br>  We put the right to perform.  After that, we collect the package and put the privoxy team <br>  src2pkg -X -C -I <br>  The program was installed successfully.  It took me a minimal config change: <br>  1. commented listen-address 127.0.0.1:8118 <br>  2. listen-address 192.168.0.1:8118 <br>  3. permit-access 192.168.0.0/24 <br>  Next, you need to change the /etc/rc.d/rc.privoxy file <br><br> <code>PRIVOXY_USER="privoxy" <br> PRIVOXY_GROUP="privoxy"</code> <br> <br>  Now you can start privoxy for the first time: <br> <code>root@ironnet:/tmp/privoxy# /etc/rc.d/rc.privoxy start <br> Starting privoxy: OK</code> <br> <br>  Now all I have to do is register in the proxy browser 192.168.0.1:8118 <br><br>  Unfortunately, after some time, it turned out that the built-in filter does not cope with filtering.  After a brief googling, a python script was borrowed from here to automatically generate rules based on the blocklist from the marine. <br>  I changed it a little bit by adding another blocklist for parsing.  Total left this: <br> <code><a href="http://arsengine.org.ru/"></a> #!/usr/bin/perl <br> <br> # Updated: 2010/03/17 12:58:26 <br> <br> ############################################################################### <br> # adblock2privoxy.pl <br> ############################################################################### <br> # Copyright 2010 Arcady N. Shpak (Greignar) arsengine.org.ru <br> # <br> # This program is free software; you can redistribute it and/or modify <br> # it under the terms of the GNU General Public License as published by <br> # the Free Software Foundation; either version 2 of the License, or <br> # (at your option) any later version. <br> # <br> # This program is distributed in the hope that it will be useful, <br> # but WITHOUT ANY WARRANTY; without even the implied warranty of <br> # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the <br> # GNU General Public License for more details. <br> # <br> # You should have received a copy of the GNU General Public License <br> # along with this program; if not, write to the Free Software <br> # Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, <br> # MA 02110-1301, USA. <br> ################################################################################ <br> <br> # codepage utf8 <br> <br> use strict; <br> <br> #     (   '/') <br> my $cfg = '/etc/privoxy'; <br> #   (   '/') <br> my $tmp = '/tmp'; <br> <br> my $file = '/adblock.tmp'; <br> <br> &amp;WriteFile("&gt;$cfg/adblock.action", ''); <br> <br> #      <br> &amp;process('http://ruadlist.googlecode.com/svn/trunk/adblock.txt', 'ru-adlist-list'); <br> &amp;process('http://ruadlist.googlecode.com/svn/trunk/antinuha.txt', 'ru-adult-list'); <br> &amp;process('http://ruadlist.googlecode.com/svn/trunk/adblockeh.txt', 'ru-adult-list'); <br> #    ,     : <br> # &amp;process(' ', ' -  '); <br> <br> exit; <br> <br> sub process <br> { <br> my ($url, $name) = @_; <br> my (@adblock, @white, @black); <br> &amp;WriteFile("&gt;$tmp$file", ''); <br> system("wget $url -O $tmp$file"); <br> return unless(-e "$tmp$file" ); <br> @adblock = &amp;ReadFile("&lt;$tmp$file"); <br> foreach(@adblock) { <br> #   <br> $_ = &amp;clean($_); <br> #    <br> next if($_ =~ /^$/); <br> #   <br> next if($_ =~ s/^[\[\!]+.*//); <br> #    <br> next if($_ =~ s/\#.*//); <br> #     <br> next if($_ =~ s/\$.+//); <br> #  ,      <br> next if($_ =~ s/^.*[\[\(\\]+.*//); <br> #      <br> if($_ =~ /^\@.*/) { unshift(@white, &amp;mask($_)); next; } <br> #      <br> if($_ =~ /^(\*|\||).*/) { unshift(@black, &amp;mask($_)); next; } <br> } <br> @black = sort(@black); <br> @white = sort(@white); <br> #     <br> &amp;WriteFile("&gt;&gt;$cfg/adblock.action", "{+block{$name}}\n@black\n"); <br> &amp;WriteFile("&gt;&gt;$cfg/adblock.action", "{-block}\n@white\n"); <br> #    <br> system("chmod a+rw $cfg/adblock.action"); <br> } <br> <br> sub mask <br> { <br> my $url = shift; <br> my($host, $path); <br> #  URL    <br> $url =~ s/^[\@\|\.]+//g; <br> $url =~ s/^.*?:\/\/+//g; <br> $url =~ s/\$.*$//g; <br> $url =~ s/[|]+$//g; <br> $url =~ s/\*$//g; <br> $url =~ s/\^/\//g; <br> $url =~ s/^\*/\/*/; <br> $url =~ s/^([-_]+)/\/*$1/; <br> $url =~ s/\/+/\//; <br> #     <br> $url =~ s/(\/.*)$//; $path = $1; <br> $url =~ s/^([^\/]*)//; $host = $1; <br> #    www <br> $host =~ s/^www\.//ig; <br> #      ( ) <br> if($path =~ /[\*\?]/) { <br> $path =~ s/([\\\?\&amp;\.\,])/\\\1/g; <br> $path =~ s/\*/.*/g; <br> } <br> #      <br> $host = '.' . $host if($host ne ''); <br> return "$host$path\n"; <br> } <br> <br> sub clean() <br> { <br> my ($str) = @_; <br> chomp $str; <br> #      <br> $str =~ s/^\s+|\s+$//g; <br> $str =~ s/[\r\n]+//g; <br> return $str; <br> } <br> <br> sub ReadFile <br> { <br> my($file, @body); <br> $file = $_[0]; <br> open(local *F, $file) || die("Can't open data-file $file\n",$!); <br> binmode F; <br> @body = ; <br> close(F); <br> return @body; <br> } <br> <br> sub WriteFile <br> { <br> my($file, $body, $mode, $access); <br> $file = $_[0]; <br> $body = $_[1]; <br> open(local *F, $file) || die("Can't create data-file $file\n",$!); <br> binmode F; <br> flock(F, 2); <br> print F $body; <br> close(F); <br> return 1; <br> } <br> <br> 1; <br></code> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We save this miracle under the name adblock2privoxy.pl in the / etc / privoxy directory, issue the execution rights.  Further extract from the readme to this script: <br><br> <code> adblock2privoxy.pl   Perl      AdBlock  Privoxy. <br> <br>  (Linux): <br> <br> 1.      . <br> 2.      ($cfg, $tmp) <br> 3.   . <br> 4.     Privoxy   "actionsfile": <br>  : actionsfile user.action <br>  : actionsfile adblock.action <br> 5.    (  sudo)    cron' <br> 6.     Privoxy</code> <br> <br>  What we are doing. <br><br>  Well, for complete happiness we add crowns: <br><br> <code>40 4 * * * /etc/privoxy/adblock2privoxy.pl <br> 42 4 * * * /etc/rc.d/rc.privoxy restart</code> <br> <br>  Total: we get a very smart, easily customizable, regularly updated and most importantly correctly and logically working advertizer for the opera.  Isn't it a beauty? <br><br>  Well, as a final touch, I will provide you with a couple of screenshots. <br>  Before privoxy: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/243/386/893/24338689399df16ef3d99bdda1e2ccb3.jpg"><br>  After: <br><img src="http://s51.radikal.ru/i132/1004/5f/51d0cbac32c4.jpg"></div><p>Source: <a href="https://habr.com/ru/post/91147/">https://habr.com/ru/post/91147/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../91132/index.html">What if the Oscars were given to the sites?</a></li>
<li><a href="../91133/index.html">Google, Twitter and iPad</a></li>
<li><a href="../91134/index.html">Windows simple?</a></li>
<li><a href="../91138/index.html">Publisher uses Creative Commons to make books for kids available</a></li>
<li><a href="../91144/index.html">Gmail Invitations</a></li>
<li><a href="../91148/index.html">Building a JS application using Maven</a></li>
<li><a href="../91149/index.html">Virtual window to the Winscape world with head position tracking using the Wiimote</a></li>
<li><a href="../91150/index.html">We collected gcc from source codes</a></li>
<li><a href="../91151/index.html">Paid habrabra and free movies: an entertaining study of the problem of copyright</a></li>
<li><a href="../91155/index.html">ExtJS and PHP in the example</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>