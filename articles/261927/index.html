<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DirectX rendering in WPF window</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Good afternoon, dear readers! Not so long ago, I was faced with the task of implementing an uncomplicated graphical editor under Window...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DirectX rendering in WPF window</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/86f/58a/abb/86f58aabb4f94427b56e496eb38c3b57.png"><br><h3>  Introduction </h3><br>  Good afternoon, dear readers!  Not so long ago, I was faced with the task of implementing an uncomplicated graphical editor under Windows, while in the long term it should support both two-dimensional and three-dimensional graphics.  The task is not easy, especially considering that along with the window of viewing the result of drawing there must be a high-quality user interface.  After some thought, two tools were highlighted: Qt and WPF.  Qt technology boasts a good API and good support for OpenGL.  However, it also has a number of shortcomings that are difficult to put up with.  First, a large Qt Widgets application will be quite expensive to maintain, and in Qt Quick it‚Äôs hard to integrate graphics.  Secondly, in OpenGL there is no developed interface for two-dimensional drawing.  So I settled on WPF.  Everything was fine with me here: powerful GUI creation tools, C # programming language and extensive experience with this technology.  In addition, it was decided to use Direct3D and Direct2D for drawing.  Only one problem remained - it was necessary to place the results of rendering performed in C ++ in the WPF window.  This article is dedicated to solving this problem.  So, here's a guide plan: <br><br><ol><li>  Development of the view rendering component in C # </li><li>  Creating a sample project using DirectX in C ++ </li><li>  Displaying the drawing result in a WPF window </li></ol><br>  Let's not waste time and get down to work immediately. <br><a name="habracut"></a><br><h3>  1. Development of the C # view rendering component </h3><br>  First, create a WPF application project in Visual Studio.  Then add a new C # class to the project.  Let his name be <u>NativeWindow</u> .  Below is the code for this class: <br><div class="spoiler">  <b class="spoiler_title">NativeWindow.cs</b> <div class="spoiler_text"><pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Runtime.InteropServices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Interop; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">app</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NativeWindow</span></span> : <span class="hljs-title"><span class="hljs-title">HwndHost</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntPtr Handle { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } Procedure procedure; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> WM_PAINT = <span class="hljs-number"><span class="hljs-number">0x000F</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> WM_SIZE = <span class="hljs-number"><span class="hljs-number">0x0005</span></span>; [StructLayout(LayoutKind.Sequential)] <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> WindowClass { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> Style; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IntPtr Callback; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ClassExtra; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> WindowExtra; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IntPtr Instance; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IntPtr Icon; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IntPtr Cursor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IntPtr Background; [MarshalAs(UnmanagedType.LPWStr)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Menu; [MarshalAs(UnmanagedType.LPWStr)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Class; } [StructLayout(LayoutKind.Sequential)] <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Rect { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Left; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Top; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Right; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Bottom; } [StructLayout(LayoutKind.Sequential)] <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Paint { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IntPtr Context; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Erase; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Rect Area; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Restore; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Update; [MarshalAs(UnmanagedType.ByValArray, SizeConst = <span class="hljs-number"><span class="hljs-number">32</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] Reserved; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">delegate</span></span></span><span class="hljs-function"> IntPtr </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Procedure</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr handle, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message, IntPtr wparam, IntPtr lparam</span></span></span><span class="hljs-function">)</span></span>; [DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> IntPtr </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateWindowEx</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> extended, [MarshalAs(UnmanagedType.LPWStr</span></span></span><span class="hljs-function">)] </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> name, [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MarshalAs</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UnmanagedType.LPWStr</span></span></span><span class="hljs-function">)] </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> caption, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">uint</span></span></span><span class="hljs-function"> style, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> x, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> y, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> width, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> height, IntPtr parent, IntPtr menu, IntPtr instance, IntPtr param)</span></span>; [DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> IntPtr </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadCursor</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr instance, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span>; [DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> IntPtr </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DefWindowProc</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr handle, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message, IntPtr wparam, IntPtr lparam</span></span></span><span class="hljs-function">)</span></span>; [DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">ushort</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterClass</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[In] </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WindowClass register</span></span></span><span class="hljs-function">)</span></span>; [DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DestroyWindow</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr handle</span></span></span><span class="hljs-function">)</span></span>; [DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> IntPtr </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeginPaint</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr handle, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Paint paint</span></span></span><span class="hljs-function">)</span></span>; [DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EndPaint</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr handle, [In] </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Paint paint</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> HandleRef </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BuildWindowCore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HandleRef parent</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> callback = Marshal.GetFunctionPointerForDelegate(procedure = WndProc); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> width = Convert.ToInt32(ActualWidth); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> height = Convert.ToInt32(ActualHeight); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cursor = LoadCursor(IntPtr.Zero, <span class="hljs-number"><span class="hljs-number">32512</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> background = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntPtr(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> zero = IntPtr.Zero; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> caption = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> style = <span class="hljs-number"><span class="hljs-number">3u</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> extra = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> extended = <span class="hljs-number"><span class="hljs-number">0u</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> window = <span class="hljs-number"><span class="hljs-number">0x50000000</span></span>u; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> point = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = <span class="hljs-string"><span class="hljs-string">"Win32"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wnd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WindowClass { Style = style, Callback = callback, ClassExtra = extra, WindowExtra = extra, Instance = zero, Icon = zero, Cursor = cursor, Background = background, Menu = menu, Class = name }; RegisterClass(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> wnd); Handle = CreateWindowEx(extended, name, caption, window, point, point, width, height, parent.Handle, zero, zero, zero); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandleRef(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Handle); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DestroyWindowCore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">HandleRef handle</span></span></span><span class="hljs-function">)</span></span> { DestroyWindow(handle.Handle); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> IntPtr </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WndProc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr handle, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message, IntPtr wparam, IntPtr lparam, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> handled</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message == WM_PAINT) { Paint paint; BeginPaint(handle, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> paint); EndPaint(handle, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> paint); handled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message == WM_SIZE) { handled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { MessageBox.Show(e.Message); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.WndProc(handle, message, wparam, lparam, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> handled); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IntPtr </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WndProc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr handle, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message, IntPtr wparam, IntPtr lparam</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DefWindowProc(handle, message, wparam, lparam); } } }</code> </pre> <br></div></div><br>  This class works very simply: in order to get access to the message queue and window descriptor, the <i>WndProc</i> method from the parent class <u>HwndHost is overridden</u> .  The <i>BuildWindowCore</i> method <i>is</i> used as the constructor of the new window.  It takes the handle of the parent window, and returns the handle of the new window.  Creating a window and its maintenance is possible only with the help of system functions, the managed analogs of which do not exist in the .NET platform.  Access to WinAPI tools is provided by <b>Platform Invocation Services (PInvoke)</b> , implemented as part of the Common Language Infrastructure (CLI).  Information about working with PInvoke can be obtained from numerous books on the .NET Framework, but here I want to draw your attention to the website <a href="http://www.pinvoke.net/">PInvoke.net</a> , where you can find the correct declarations of all functions and structures.  Working with the message queue is to handle the desired event.  Usually, it is enough to process the redrawing of the window contents and resizing it.  The most important thing that executes this code is the creation of a window handle, which can also be used as in a normal WinAPI application.  In order to be comfortable in the WPF designer, you need to place the window component on the main form of the application.  The following is the XAML markup of the main application window: <br><div class="spoiler">  <b class="spoiler_title">MainWindow.xaml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app.MainWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:i</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:app"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MainWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"350"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"525"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i:NativeWindow</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i:NativeWindow</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  In order to place a component on a form, you must specify the namespace in which it is located.  It can then be used as a placeholder to accurately represent the position of each element on the form.  Before switching from edit mode to design mode, the project needs to be rebuilt.  The figure below shows the Visual Studio window with the open designer of the main application window, in which the placeholder has a gray background: <br><br><img src="https://habrastorage.org/files/338/ad4/f0d/338ad4f0d63b4cc895e5a9adcf91f48d.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  2. Creating a sample project using DirectX in C ++ </h3><br>  As an example of using the component, we will create a simple C ++ project in which, using Direct2D, the drawing window will be filled with a certain background.  You can use C ++ / CLI bindings to link managed and unmanaged code, but in real projects it is not necessary to do this.  Add a C ++ CLR Class Library project to the Visual Studio solution.  The project will contain the default source files, you can delete them.  For the experiment, you need only one source file, its contents are shown below: <br><div class="spoiler">  <b class="spoiler_title">Renderer.cpp</b> <div class="spoiler_text"><pre> <code class="hljs rust">#include &lt;d2d1.h&gt; namespace lib { class Renderer { public: ~Renderer() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (factory) factory-&gt;Release(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (target) target-&gt;Release(); } <span class="hljs-built_in"><span class="hljs-built_in">bool</span></span> Initialize(HWND handle) { RECT rect; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!GetClientRect(handle, &amp;rect)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FAILED(D2D1CreateFactory(D2D1_FACTORY_TYPE_SINGLE_THREADED, &amp;factory))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SUCCEEDED(factory-&gt;CreateHwndRenderTarget(D2D1::RenderTargetProperties(), D2D1::HwndRenderTargetProperties(handle, D2D1::SizeU(rect.right - rect.left, rect.bottom - rect.top)), &amp;target)); } void Render() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!target) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; target-&gt;BeginDraw(); target-&gt;Clear(D2D1::ColorF(D2D1::ColorF::Orange)); target-&gt;EndDraw(); } void Resize(HWND handle) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!target) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; RECT rect; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!GetClientRect(handle, &amp;rect)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; D2D1_SIZE_U size = D2D1::SizeU(rect.right - rect.left, rect.bottom - rect.top); target-&gt;Resize(size); } private: ID2D1Factory* factory; ID2D1HwndRenderTarget* target; }; public <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> class Scene { public: Scene(System::IntPtr handle) { renderer = new Renderer; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (renderer) renderer-&gt;Initialize((HWND)handle.ToPointer()); } ~Scene() { delete renderer; } void Resize(System::IntPtr handle) { HWND hwnd = (HWND)handle.ToPointer(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (renderer) renderer-&gt;Resize(hwnd); } void Draw() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (renderer) renderer-&gt;Render(); } private: Renderer* renderer; }; }</code> </pre><br></div></div><br>  The <u>Scene</u> class binds the C # application code and the <u>Renderer</u> class.  The latter uses the Direct2D API to fill the window background in orange.  It is worth noting that, in practice, rendering is completely performed in unmanaged code, only a window handle (HWND) is needed to display the result.  It is also necessary to take into account that both projects in the solution should now have the same configuration when building, for example, ‚ÄúRelease x86‚Äù. <br><br><h3>  3. Displaying the drawing result in a WPF window </h3><br>  In order to display the result of drawing on the form, you need to add a link to the drawing library assembly in the WPF application project and call the corresponding functions from the library when processing the component's window messages.  The figure below shows the window for adding a link to the drawing library and the solution structure: <br><br><img src="https://habrastorage.org/files/a4c/6f3/b26/a4c6f3b26e0a41f9a6b3f791f24f53cf.png"><br><br>  The following is the modified code for the <u>NativeWindow</u> class: <br><div class="spoiler">  <b class="spoiler_title">NativeWindow.cs</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> lib; //       <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Runtime.InteropServices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Windows; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Windows.Interop; namespace app { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> NativeWindow : HwndHost { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> IntPtr Handle { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">Procedure</span></span> <span class="hljs-keyword"><span class="hljs-keyword">procedure</span></span>; Scene scene; //   Scene   const <span class="hljs-type"><span class="hljs-type">int</span></span> WM_PAINT = <span class="hljs-number"><span class="hljs-number">0x000F</span></span>; const <span class="hljs-type"><span class="hljs-type">int</span></span> WM_SIZE = <span class="hljs-number"><span class="hljs-number">0x0005</span></span>; [StructLayout(LayoutKind.Sequential)] struct WindowClass { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> uint Style; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> IntPtr Callback; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> ClassExtra; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> WindowExtra; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> IntPtr Instance; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> IntPtr Icon; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> IntPtr <span class="hljs-keyword"><span class="hljs-keyword">Cursor</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> IntPtr Background; [MarshalAs(UnmanagedType.LPWStr)] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string Menu; [MarshalAs(UnmanagedType.LPWStr)] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span>; } [StructLayout(LayoutKind.Sequential)] struct Rect { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Left; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Top; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Right; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> Bottom; } [StructLayout(LayoutKind.Sequential)] struct Paint { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> IntPtr Context; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> Erase; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Rect Area; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> Restore; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Update</span></span>; [MarshalAs(UnmanagedType.ByValArray, SizeConst = <span class="hljs-number"><span class="hljs-number">32</span></span>)] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> byte[] Reserved; } delegate IntPtr <span class="hljs-keyword"><span class="hljs-keyword">Procedure</span></span> (IntPtr handle, uint message, IntPtr wparam, IntPtr lparam); [DllImport("user32.dll")] static extern IntPtr CreateWindowEx (uint extended, [MarshalAs(UnmanagedType.LPWStr)] string <span class="hljs-type"><span class="hljs-type">name</span></span>, [MarshalAs(UnmanagedType.LPWStr)] string caption, uint style, <span class="hljs-type"><span class="hljs-type">int</span></span> x, <span class="hljs-type"><span class="hljs-type">int</span></span> y, <span class="hljs-type"><span class="hljs-type">int</span></span> width, <span class="hljs-type"><span class="hljs-type">int</span></span> height, IntPtr parent, IntPtr menu, IntPtr instance, IntPtr param); [DllImport("user32.dll")] static extern IntPtr LoadCursor (IntPtr instance, <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>); [DllImport("user32.dll")] static extern IntPtr DefWindowProc (IntPtr handle, uint message, IntPtr wparam, IntPtr lparam); [DllImport("user32.dll")] static extern ushort RegisterClass ([<span class="hljs-keyword"><span class="hljs-keyword">In</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> WindowClass register); [DllImport("user32.dll")] static extern <span class="hljs-type"><span class="hljs-type">bool</span></span> DestroyWindow (IntPtr handle); [DllImport("user32.dll")] static extern IntPtr BeginPaint (IntPtr handle, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Paint paint); [DllImport("user32.dll")] static extern <span class="hljs-type"><span class="hljs-type">bool</span></span> EndPaint (IntPtr handle, [<span class="hljs-keyword"><span class="hljs-keyword">In</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> Paint paint); protected override HandleRef BuildWindowCore(HandleRef parent) { var callback = Marshal.GetFunctionPointerForDelegate(procedure = WndProc); var width = Convert.ToInt32(ActualWidth); var height = Convert.ToInt32(ActualHeight); var <span class="hljs-keyword"><span class="hljs-keyword">cursor</span></span> = LoadCursor(IntPtr.Zero, <span class="hljs-number"><span class="hljs-number">32512</span></span>); var menu = string.Empty; var background = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> IntPtr(<span class="hljs-number"><span class="hljs-number">1</span></span>); var zero = IntPtr.Zero; var caption = string.Empty; var style = <span class="hljs-number"><span class="hljs-number">3</span></span>u; var extra = <span class="hljs-number"><span class="hljs-number">0</span></span>; var extended = <span class="hljs-number"><span class="hljs-number">0</span></span>u; var <span class="hljs-keyword"><span class="hljs-keyword">window</span></span> = <span class="hljs-number"><span class="hljs-number">0x50000000</span></span>u; var <span class="hljs-type"><span class="hljs-type">point</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; var <span class="hljs-type"><span class="hljs-type">name</span></span> = "Win32"; var wnd = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> WindowClass { Style = style, Callback = callback, ClassExtra = extra, WindowExtra = extra, Instance = zero, Icon = zero, <span class="hljs-keyword"><span class="hljs-keyword">Cursor</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">cursor</span></span>, Background = background, Menu = menu, <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> = <span class="hljs-type"><span class="hljs-type">name</span></span> }; RegisterClass(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> wnd); Handle = CreateWindowEx(extended, <span class="hljs-type"><span class="hljs-type">name</span></span>, caption, <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>, <span class="hljs-type"><span class="hljs-type">point</span></span>, <span class="hljs-type"><span class="hljs-type">point</span></span>, width, height, parent.Handle, zero, zero, zero); scene = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Scene(Handle); //    Scene <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HandleRef(this, Handle); } protected override <span class="hljs-type"><span class="hljs-type">void</span></span> DestroyWindowCore(HandleRef handle) { DestroyWindow(handle.Handle); } protected override IntPtr WndProc(IntPtr handle, <span class="hljs-type"><span class="hljs-type">int</span></span> message, IntPtr wparam, IntPtr lparam, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> handled) { try { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message == WM_PAINT) { Paint paint; BeginPaint(handle, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> paint); scene.Draw(); //   EndPaint(handle, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> paint); handled = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (message == WM_SIZE) { scene.Resize(handle); //    handled = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } catch (<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> e) { MessageBox.<span class="hljs-keyword"><span class="hljs-keyword">Show</span></span>(e.Message); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> base.WndProc(handle, message, wparam, lparam, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> handled); } static IntPtr WndProc(IntPtr handle, uint message, IntPtr wparam, IntPtr lparam) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DefWindowProc(handle, message, wparam, lparam); } } }</code> </pre><br></div></div><br>  When processing a window message WM_PAINT, the contents of the component are redrawn.  This message also enters the queue when the window is resized (WM_SIZE message).  The figure below shows the finished application window filled with orange: <br><br><img src="https://habrastorage.org/files/eca/b8c/1f6/ecab8c1f62a34cf2b772fc4e8eff5c35.png"><br><br><h3>  Conclusion </h3><br>  The WPF window drawing method outlined in the article is well suited for creating applications in which the user interface should be combined with the viewing window.  WPF technology is by far the most advanced GUI tool for Windows, and the ability to use system functions sometimes makes the work of a programmer easier.  To quickly test the application, I created a <a href="https://github.com/Grandbrain/NativeWPF">repository</a> on Github.  There you can always find the latest version of this solution. </div><p>Source: <a href="https://habr.com/ru/post/261927/">https://habr.com/ru/post/261927/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261911/index.html">Own JS Wrapper for Uppod Player</a></li>
<li><a href="../261913/index.html">Network security Instead of introducing</a></li>
<li><a href="../261921/index.html">PostgreSQL and btrfs - an elephant on an oily diet</a></li>
<li><a href="../261923/index.html">Cezurity's little antivirus test</a></li>
<li><a href="../261925/index.html">Automatic detection of vulnerabilities: description and statistics</a></li>
<li><a href="../261931/index.html">Lines and probability theory</a></li>
<li><a href="../261935/index.html">Qihoo 360 and Go</a></li>
<li><a href="../261937/index.html">Network media server for PS3</a></li>
<li><a href="../261939/index.html">New PhpStorm 9: constant advance. Postfix code completion for PHP, Inline Debugger, and more.</a></li>
<li><a href="../261941/index.html">Beginner site optimization guide. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>