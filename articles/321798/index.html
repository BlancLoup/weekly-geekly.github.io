<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dynamic Shadow Tactics Detection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What: Dynamic Detection in Shadow Tactics 
 In Shadow Tactics, players control a squad of characters, each of which has its own specialization (there ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dynamic Shadow Tactics Detection</h1><div class="post__text post__text-html js-mediator-article"><h2>  What: Dynamic Detection in Shadow Tactics </h2><br>  In <i>Shadow Tactics,</i> players control a squad of characters, each of which has its own specialization (there can be up to five characters in a squad).  Their task is to sneak around a huge level filled with enemies, and quietly kill the victim.  Each level is a puzzle with many solutions.  One of the most important player tools is the ability to display the enemy's field of view in the form of cones, which we call cones of visibility (Viewcones).  Cones of visibility have areas of different colors that determine the behavior of enemies. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4cf/9ec/b65/4cf9ecb657b6fc563910621b426002b6.jpg" alt="image"><br>  <i>Figure 1: Shadow Tactics visibility cone.</i> <br><br>  For those who are interested in how this is implemented technically, I will quote our lead technical engineer Frieder Mielke, the person who created the entire system: ‚ÄúThe basic principle used in calculating visibility cones is the use of shadow maps.  First we render the texture depth from the position of the eyes of the selected character.  Then, when rendering the main camera, based on the previously created depth texture, we generate a mask containing information for different scopes (for example, ‚Äúfull visibility‚Äù, ‚Äúcompletely hidden‚Äù, ‚Äúinvisible when the character crawls‚Äù and ‚Äúout of sight‚Äù).  Using this mask in the last pass, we can color the cone of visibility.  In this pass, a stencil buffer is used to exclude objects that do not need to be rendered and add information about light sources. ‚Äù 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      From a design point of view, we analyzed how these cones were used in old games, and saw a way to improve them.  This led us to revise some aspects of character detection in this genre. <br><a name="habracut"></a><br><h2>  Who: Moritz Wagner, Lead Designer, Mimimi Productions </h2><br>  My name is Moritz, I'm the lead designer at <a href="http://www.mimimi-productions.de/">Mimimi Productions</a> .  I have been working in the company since the very beginning, when our studio originated while studying game design at the Munich-based <a href="http://www.mediadesign.de/">Media Design Hochschule</a> .  In the third semester, we began to develop early prototypes of our first big game, <a href="http://www.mimimi-productions.de/game/the-last-tinker-city-of-colors/">The Last Tinker: City of Colors</a> , which was released after the foundation of Mimimi in 2011.  Besides her, we worked on several mobile games. <br><br>  Now there are 16 people working in the studio, and our last project is <i><a href="http://www.shadow-tactics.com/">Shadow Tactics: Blades of the Shogun</a></i> , a real-time tactical stealth game (RTT) tactical stealth game with an isometric view in the style of the <i>Commandos</i> and <i>Desperados</i> series. <br><br><h2>  What for? </h2><br>  Like many developers, we decided on a pair of design pillars for <i>Shadow Tactics</i> .  Both pillars are connected with the use of visibility cones. <br><br><ul><li>  <strong>Preserving the basic game cycle:</strong> Commandos gameplay today is just as interesting as it was 16 years ago.  It is critical that, regardless of the decisions made, the basic game cycle remains unchanged.  <em>Shadow Tactics</em> should deliver the same pleasure (that is, incredible torment, alternating with satisfaction) as the old games. </li><li>  <strong>Improved usability:</strong> although the gameplay of old games is still interesting, in terms of convenience, the interface is already outdated (surprise!).  Management is slow, often not enough feedback, and important information reaches the player indistinctly.  <em>Shadow Tactics</em> should be like a modern version of old RTT games. </li></ul><br><h2>  Basic principles of visibility cones </h2><br>  Since the visibility cone displays the enemy‚Äôs vision, it is used to determine the level space in which the player can move and interact.  The alignment of enemies creates the following types of space: <br><br><ul><li>  <strong>There are no visibility cones:</strong> as you might guess, in such areas, players can do almost anything.  Usually it is here that the guards meet their premature death.  Players can either create such areas themselves, distracting enemies, or lure opponents into them.  Particularly reckless guards can even pass on their own. </li><li>  <strong>Dark green cone of visibility: in</strong> order for characters not to be discovered here, they must crawl.  Any action in which characters must stand up will lead to problems.  Such areas are easily passed, but killing the guards is usually impossible without distracting other guards. </li><li>  <strong>Bright green cone of visibility:</strong> in such areas no entry.  With the low complexity of the game, players can quickly run through them, unnoticed, but they are almost impossible to perform any actions without getting into trouble. </li><li>  <strong>Dotted Cone of Visibility:</strong> Used for shrubs or tall grass.  Here, the player‚Äôs lying or crawling characters are always invisible if enemies do not enter the bushes (they always warn about this with a voice and only do this when they are lured or when they are looking for a character).  We decided that these types of shelters never revealed their full potential in old games.  Therefore, we added them to create a contrast between the sensations of security inside the hives and the risk of being in other areas. </li></ul><br>  The cone of visibility is the most important factor in creating interactions with enemies in <i>Shadow Tactics</i> .  Some guards move along patrol routes, that is, spaces constantly change their condition.  It's pretty simple, but I wanted to talk about it first. <br><br><h2>  What are the cones of visibility </h2><br>  There are no gradients or other design, the most important - contrasting edges and clearly marked areas. <br><br>  The size of the cone of visibility affects the immersion in the game, the complexity and design levels. <br><br>  By itself, this function can create situations that destroy the feeling of immersion in the game.  They are often found in stealth games, and therefore players are partially resigned to them.  But still it is important not to go too far.  Although looking at the cone of visibility and it is clear why the enemy does not notice the character crawling three meters away from him, still this situation looks unnatural and stupid.  We all met this in games. <br><br>  Partially solve the problem by increasing the cones of visibility.  The closer a player can get to the enemy imperceptibly, the more it looks like gameplay mechanics, which can prevent immersion in the gameplay.  However, too large cones of visibility strongly influence the complexity of the game, the level design and the size of the maps, so it takes time to find a compromise. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ccf/a29/515/ccfa2951500713d82bc70ed7da463c8e.jpg" alt="image"><br>  <i>Figure 2: at night levels, the cone visibility parameters change.</i>  <i>The cones become smaller, the dark green area is very large, but the lighting always creates a bright green field of view.</i> <br><br>  Integrity is also an important factor.  We decided that all enemy guards should have the same cone size, angles of movement and speed.  Visibility cones are fixed only in certain situations (for example, when guards are talking to each other).  Therefore, players can predict the behavior of cones and build their tactics on this without fear of a sudden change of behavior.  Gradually, they are better at mastering this function, which causes a feeling of satisfaction with the game.  We also decided to keep the parameters unchanged for different levels of complexity so that players who started at low complexity should not be retrained when moving to a higher one. <br><br>  Here, the attentive reader may ask: ‚ÄúBut Moritz, you did say that there is no appearance in the cones of appearance.  What is this strange pattern on the dark green part? ‚ÄùI will explain: it was added because the clear contrast between the bright and dark areas was not noticeable, so it was difficult to determine what kind of color it was.  This happens on elevations and in cases where parts of the cone of visibility overlap with large objects or shelters. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cea/4a4/d26/cea4a4d26dc0cdfbcdaa5f9aff49063c.jpg" alt="image"><br>  <i>Figure 3: in the left picture I turned off the pattern.</i>  <i>It shows how difficult it is to determine the brightness of the cone of visibility.</i>  <i>When the pattern is turned on (in the picture on the right), everything becomes obvious.</i> <br><br><h2>  One cone to rule everyone </h2><br>  We decided that it was possible to display only one cone at a time, as in the old RTT games. <br><br>  In terms of design, there are two main reasons for this: <br><br><ul><li>  <strong>Information:</strong> <em>Shadow Tactics</em> provides almost complete information.  The game has no fog of war, enemies are never created by chance and their behavior is always predictable (as long as they do not begin to actively look for a player).  Players can fully analyze the situation if they have time for it.  The restriction of one visibility cone is the only half-hidden information when solving a puzzle.  By making players memorize the field of view of the guards, we create tension and make the gameplay of avoiding the cones of visibility more intriguing. </li><li> <strong>Visibility: a</strong> single cone of visibility allows you to not get confused in the interface and increase visibility.  Although for some players huge amounts of information are familiar, for most they will be too complicated.  In addition, it looks unpleasant in the screenshots and in videos. </li></ul><br><h2>  Even ninja can be detected </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/9d2/a57/df3/9d2a57df364d3ced710351c1f2a87c3f.jpg" alt="image"><br>  <i>Figure 4: Character Hayato was discovered by one of the first guards on the first level.</i>  <i>Noob!</i> <i><br></i> <br>  Handling the moment when an enemy detects a player‚Äôs character is very important in any stealth game.  We went back to this part of the gameplay many times, I will tell you about this process and about what we came to the end.  This part is devoted not only to the cone of visibility itself, but also to the different mechanics and systems that were used ... and then they were cut out. <br><br>  First, let's see what happens when a player‚Äôs character falls into a cone of visibility and is close to detection: <br><br><ul><li>  <strong>Sound:</strong> a unique sound effect is played.  He tells the player that he was discovered. </li><li>  <strong>Focus: the</strong> cone of visibility of the enemy focuses on the character and automatically turns on, even if another cone is selected.  This immediately tells the player who discovered it. </li><li>  <strong>Slow motion: the</strong> game goes into slow motion mode to allow the player to react better.  Later I will talk about the evolution of this function.  It was an agonizing, error-full process. </li><li>  <strong>Yellow color:</strong> if the cone of visibility was green, it begins to fill with yellow, starting from the eyes of the enemy.  As soon as the yellow part touches the player‚Äôs character, the enemy actually detects him, starts shooting and turns on the alarm.  If the character enters the yellow part, the guards discover it immediately.  This is similar to the function in Desperados, where the visibility cones gradually turned yellow, but moving the yellow part to the player made it possible to create a clearer feedback on the moment the threat was detected.  This allows the player to better master the function and use it to their advantage. </li></ul><br><h2>  Slow path to slow motion </h2><br>  Samples and errors are an integral part of this genre, supported by the ability to quickly save and load at any time.  Although it is obvious that we wanted to preserve this aspect, we were wary of how modern gamers would react to it.  Of course, those who played the old games will not experience problems, but will it not frighten the new generation?  Do not critics consider it outdated? <br><br>  We thought a lot about this topic and came to the conclusion that we would leave the functions of quick save and load part of the game.  But we still need to give players more opportunities to avoid detection.  The yellow part of the cone of appearance also corresponded to this philosophy and we liked how it works. <br><br>  <i>Note: the addition of an interesting time rewind function not only became a huge technical difficulty, but also changed the aspects that we, as newcomers to the genre, were afraid to change.</i>  <i>We discussed the function, but quickly abandoned it.</i>  <i>It would take too much time and be too risky for profits.</i> <br><br>  Given these prerequisites, we began to think about different functions.  Thus began the odyssey into the world of ideas: each of them had problems and through many iterations we cut them off.  It was a painful process, especially for our programmer Philipp Wittershagen (Philipp Wittershagen), who had to implement them.  I think he still has nightmares. <br><br><h2>  Freezing mode </h2><br>  This infernal creature had to use ninja forces and prevent detection, so that players had to use fast downloads less often.  This is how it worked: as soon as the player‚Äôs character reached the yellow part of the visibility cone, the game paused and shifted the focus to the character.  This was already a big problem: stopping the game at a stressful moment kills the streaming state and feels bad.  The pause always turns on unexpectedly and confuses players.  In addition, if, after a pause, the game was waiting for the player‚Äôs commands, then he gave them away by chance, because most frantically started to click the mouse, trying to escape.  (I blame mainly Diablo and MOBA for this feverish clipping habit. Thank you so much.) <br><br>  The freezing mode had more strange features.  I will consider chronologically the main iterations and briefly tell you what did not work in them: <br><br>  Perform one action: in this iteration, the player could only perform one action after pausing the game.  This was designed so that, for example, a character could bend if he was in a dark area, or simply remove a guard with a distance attack if only one enemy saw him. <br><br>  However, problems arose.  It turned out that this possibility is too powerful for some characters (who had good distance attacks) and almost useless for the rest.  In addition, very often there were no options to save the character.  Have you been spotted in a bright area and several guards?  So, no luck, you can do one action and still then die.  When such an insurance mechanic works, the player expects that it will always be useful, but she had weaknesses.  Therefore, we abandoned it and decided to try something else ... <br><br>  Teleportation within circles: the idea arose that cool ninja characters could teleport with smoke grenades to avoid detection.  There are already questions with style: why would a samurai Mugen use smoke grenades and teleportation?  And why do all these characters use smoke grenades ONLY when detected and the player cannot use them in other cases? <br><br>  Of course, we decided to ignore these questions for a while and focus on the mechanics: <br><br>  When it detects a character around the circle appears, and the player can click anywhere in the circle to teleport to this point.  So he can either get into the dark area of ‚Äã‚Äãthe cone of visibility, where you can duck, or even move to the shelter.  And, of course, the players started using this feature to teleport directly to the guards and kill them. <br><br>  Therefore, we replaced the circle with a cone, allowing players to teleport only from the enemy.  And again there were problems.  It was useless even more often than the previous concept (there was no safe point for teleportation? Boom, headshots.), And the players thoughtlessly teleported the teleported characters to random places.  In addition, the cone mapping confused the interface. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/11f/193/cd7/11f193cd70f746ef308495e327ac26d5.jpg" alt="image"><br>  <i>Figure 5: freezing mode: when detected, the player can teleport the character to any point in the cone (screenshot taken in the pre-alpha version).</i> <br><br><h2>  Fake rewind </h2><br>  For some reason, we still thought teleportation was a good idea.  Since the movement of the character was too strange and difficult, we wanted to simplify this moment.  When found behind a character, a line appeared showing where it was before.  Players could teleport to any point on the line, as if ‚Äúrewinding time‚Äù for this character. <br><br>  And there were problems again.  Feedback did not work very well and the players did not understand what they needed to do.  But I still think that after several iterations we could improve this function.  Unfortunately, there was one huge problem: if a player chose a character that he hadn‚Äôt managed for a long time, then this function looked very ugly.  Of course, the players did not remember where the character was before, and they were surprised by what principle this strange line was created.  In addition, she could cheat on snow levels.  Here, the guards follow you, seeing your prints ... I think it is easy to imagine further.  Show your prints to the enemy, make you move behind you and teleport behind him.  All honest. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5ee/116/c0a/5ee116c0ac7347f1d6111748012984db.jpg" alt="image"><br>  <i>Figure 6: fake rewind: players can teleport to any point where the character was before (alpha version screenshot).</i> <br><br>  And I have not yet mentioned the dirty tricks that had to be applied when several characters were found, or, worse, they were at different points on the map.  I still remember with dislike this dark time for us. <br><br><h2>  New approach </h2><br>  Finally, we realized that it would not work.  When you go down in a spiral, it is best to step aside and look at what you really want to achieve.  We started with good ideas, and gradually we went down.  We are constantly based on the previous failed attempt, but did not draw conclusions from it.  This did not allow us to approach the problem with a fresh look, to come up with something simple and clear.  Do not repeat our mistakes.  Sometimes it is worth taking a step to the side.  In theory, we all knew it, but for some reason we did it not early enough, and it seems to me that this happened too often. <br><br>  Looking at the problem from a different angle, our creative director Dominik Ab√© suggested a simple slow-motion feature that turns on when a character hits the visibility cone and it starts to fill with yellow. <br><br>  Again, some problems.  First, to test the function, we simply slowed down the whole game.  This gave the players more time to react.  The problem was that they perceived the function as a punishment and a hindrance.  It seemed to them that they were being slowed down when they were trying to escape from the approaching yellow line, and that was not fair.  We tried to rectify the situation by making the player's characters faster than the rest of the game, but the problem persists.  In addition, there were problems with animations and video effects. <br><br>  Therefore, we decided to stick with the slow motion, because this type of problem could definitely be solved.  In addition, this approach seemed to us the most simple and elegant solution of all.  Another factor was the budget - the moment came when we had to stop at something. <br><br>  In the end, the solution to these problems seemed very simple.  Basically, it concerned fine-tuning the game slowdown parameters and changing the balance of filling the visibility cones with yellow so that an attempt to escape from them in slow motion would bring satisfaction.  To make it work, we didn‚Äôt even have to force the characters to move at different speeds.  Some players are still disappointed in slow motion, so I think that someday we will need to return to setting it up again. <br><br><h2>  Conclusion </h2><br>  Visibility cones are the base part of the game, so in this article we could not consider the rest in detail.  I decided to focus on the moment of detection, because this is one of the areas in which we have experienced the greatest difficulties, and it seemed to me that this particular process would help other developers who encountered similar problems. <br><br>  We tried to find a single powerful solution for Shadow Tactics that will provide instant response when a character is detected and allow it to magically escape.  As a result, instead, we created a function that slows down the detection process and gives players more time to react and solve the problem creatively.  It is wonderfully combined with the essence of the game, and in the future we want to consistently improve it. <br><br>  I am sure that the cones of visibility and the moment of detection can still be improved. <br><br>  For new games, I would love to experiment with the fact that the interval before discovery has more diverse consequences (for example, triggering an alarm), and would not consider only the moment of detection.  There are many possibilities for this, especially when studying the behavior of security guards.  Such experiments will add a new dimension to the game, allowing the player to actively interfere with the onset of catastrophic consequences. </div><p>Source: <a href="https://habr.com/ru/post/321798/">https://habr.com/ru/post/321798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321786/index.html">Minimalism in game design: examples, tips and ideas. Part one</a></li>
<li><a href="../321788/index.html">From multichannel to omnicanality</a></li>
<li><a href="../321790/index.html">Reverse engineering messages Protocol Buffers</a></li>
<li><a href="../321792/index.html">Test Pass Library</a></li>
<li><a href="../321796/index.html">Where do your ads live?</a></li>
<li><a href="../321800/index.html">Omnichannel: facilitating communication to customers and employees</a></li>
<li><a href="../321802/index.html">Dmitry Sorin, Senior Software Engineer at Atlassian, shared his impressions of five years of work at Yandex</a></li>
<li><a href="../321804/index.html">Acquaintance with Styled components</a></li>
<li><a href="../321808/index.html">Webinar: Introduction to Singularity</a></li>
<li><a href="../321810/index.html">The best architecture based on Docker and Kubernetes - myth or reality?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>