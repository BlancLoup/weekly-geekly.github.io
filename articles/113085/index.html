<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We design rating evaluation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Often it is required to realize the possibility of rating evaluation of a particular object (notes, comments, quotes, photograms, videos, etc.) by sit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We design rating evaluation</h1><div class="post__text post__text-html js-mediator-article">  Often it is required to realize the possibility of rating evaluation of a particular object (notes, comments, quotes, photograms, videos, etc.) by site visitors.  How to program it? <br><br>  First of all, we have the object of evaluation and the subject of evaluation.  The latter may be, for example, registered users, unregistered users (guests), etc. <br><br>  In order to provide a weak connection between specific entities of the subject area, to which we link the possibility of rating voting, with the module that implements our task, we select separate classes for the object ( <strong>Rating_Object</strong> ) and the subject ( <strong>Rating_Subject</strong> ).  Both of these classes are concrete and implemented as an <a href="http://ru.wikipedia.org/wiki/ActiveRecord">active record</a> .  To be able to bind all sorts of articles and photograms to Rating_Object instances, we provide the <strong>Rating_Ratable</strong> interface: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Ratable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Rating_Object */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asRatingObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br><br><a name="habracut"></a>  This interface can now be implemented in Article classes, etc., for example, like this: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Article</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveRecord</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Ratable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTableDefinition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hasReferenceColumn(<span class="hljs-string"><span class="hljs-string">"rating_object_id"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hasOne(<span class="hljs-string"><span class="hljs-string">"Rating_Object as rating_object"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"local"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"rating_object_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"foreign"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"id"</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asRatingObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;rating_object; } }</code> </pre> <br><br>  We do the same with subjects of evaluation.  It is only necessary that we store the subject identifier for each specific entity that can vote.  Since we almost always have an active record for the current site visitor (the guest can and should be <a href="http://habrahabr.ru/blogs/webdev/105773/">identified by a complex of information</a> and, accordingly, to create a record for him in the database - if you are not doing this yet, it's time to start), it‚Äôs enough to add class field rating_subject_id. <br><br>  If in the future we need to take votes for a rating from entities that are not visitors of the site (for example, to take data from third-party ratings), we can also easily link a separate instance of Rating_Subject to each instance of such entities. <br><br>  So, we have those who can evaluate, and that which can be evaluated.  We need to bind them.  To do this, we introduce the class <strong>Rating_Vote</strong> , - active record with the fields object_id, subject_id, opinion.  The last field represents a specific choice on the rating scale ‚Äî a specific assessment that this subject has placed on this object. <br><br>  It should be noted here that the spectra of possible estimates may be different.  You can limit yourself to two ratings of ‚Äúgood‚Äù and ‚Äúbad‚Äù ( <a href="http://habrahabr.ru/blogs/webdev/30324/">my personal choice</a> ), you can offer to put from one to five stars (or from one to ten), etc. Naturally, a specific rating scale is determined for a specific object: for example , quotes and comments are evaluated binary, and articles and photograms - on a scale of 1 ... 5. <br><br>  However, it is necessary to determine the method of calculating the final rating.  For example, for a binary choice of "plus or minus" you can take for the final assessment the difference between the number of pluses or the number of minuses.  But you can - the ratio of the number of pluses to the total number of votes (my personal choice).  For the scale of several options, you can take the arithmetic mean, harmonic mean, mode or median.  Again, for a specific object we set a specific method. <br><br>  The class that determines, on the one hand, the rating scale, and on the other hand, the method of calculating the final rating, we call the assessment strategy.  We introduce the <strong>Rating_Strategy</strong> interface: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Strategy</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array of float */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRatingOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Rating_Vote_Collection $votes * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> float */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAggregatedOpinion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Rating_Vote_Collection $votes)</span></span></span></span>; }</code> </pre><br><br>  Why is a float selected to reflect a specific possible estimate?  This will allow us to reflect both discrete grading scales (comparing the variants to integers, which are subsets of the real numbers) and the floating scale, if we need it.  The final score can be fractional even for an integer scale (for example, estimate on a scale from 1 to 10 and take the arithmetic average of the estimates).  Choosing float gives us the opportunity to cover almost all the options.  The opinion field in the Rating_Vote class, respectively, is also a float. <br><br>  The <strong>Rating_Vote_Collection</strong> class reflects, as you might guess, the collection of Rating_Vote objects - that is, the set of votes received for a specific object.  Why do we need this class, why not just get by with the Rating_Vote array?  There can be a lot of voices, several thousand, - to load them all from the database into RAM is consumable, and there is no need.  Almost always, to obtain a final assessment, it is necessary and sufficient to have on hand information about the aggregate number of votes for each of the options.  Therefore, in the Rating_Vote_Collection class we will make the corresponding getOpinionCounts method, which will return an array of the form: [+1 ‚Üí 100, ‚àí1 ‚Üí 50] (100 ‚Äúgood‚Äù, 50 ‚Äúbad‚Äù).  But we will also provide for a lazy-load in case we want to implement a non-trivial strategy (giving, for example, weights to voices depending on the karma of the voters). <br><br>  A few examples of assessment strategies: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Strategy_Binary</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Strategy</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GOOD = +<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BAD = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRatingOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::GOOD, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::BAD); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Strategy_Binary_Subtraction</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Strategy_Binary</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAggregatedOpinion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Rating_Vote_Collection $votes)</span></span></span><span class="hljs-function"> </span></span>{ $counts = $votes-&gt;getOpinionCounts(); $good = <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($counts[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::GOOD]) ? $counts[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::GOOD] : <span class="hljs-number"><span class="hljs-number">0</span></span>; $bad = <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($counts[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::BAD]) ? $counts[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::BAD] : <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $good - $bad; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Strategy_Binary_Rational</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Strategy_Binary</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAggregatedOpinion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Rating_Vote_Collection $votes)</span></span></span><span class="hljs-function"> </span></span>{ $counts = $votes-&gt;getOpinionCounts(); $good = <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($counts[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::GOOD]) ? $counts[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::GOOD] : <span class="hljs-number"><span class="hljs-number">0</span></span>; $bad = <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($counts[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::BAD]) ? $counts[<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::BAD] : <span class="hljs-number"><span class="hljs-number">0</span></span>; $total = $good + $bad; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($total &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ? ($good / $total) : <span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Strategy_Range</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Strategy</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $min, $max; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($min, $max)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;min = $min; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;max = $max; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRatingOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> range(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;min, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;max); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Strategy_Range_Arithmetic</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Strategy_Range</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAggregatedOpinion</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Rating_Vote_Collection $votes)</span></span></span><span class="hljs-function"> </span></span>{ $counts = $votes-&gt;getOpinionCounts(); $sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; $total_count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($counts <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $value =&gt; $count) { $sum += $value * $count; $total_count += $count; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($total_count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ? ($sum / $total_count) : <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre> <br><br>  It remains to add the getRatingStrategy method to the Rating_Ratable interface: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Ratable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Rating_Object */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asRatingObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Rating_Strategy */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRatingStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Article</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveRecord</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rating_Ratable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setTableDefinition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hasReferenceColumn(<span class="hljs-string"><span class="hljs-string">"rating_object_id"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hasOne(<span class="hljs-string"><span class="hljs-string">"Rating_Object as rating_object"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"local"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"rating_object_id"</span></span>, <span class="hljs-string"><span class="hljs-string">"foreign"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"id"</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asRatingObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;rating_object; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRatingStrategy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rating_Strategy_Range_Arithmetic(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>); } }</code> </pre> <br><br>  And in the class Rating_Object provide methods for operating the associated Rating_Vote. <br><br>  Now we can easily add voice or find out the current rating in the right places: <br><br><pre> <code class="php hljs">$article-&gt;asRatingObject()-&gt;addVote($user-&gt;asRatingSubject(), <span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $article-&gt;getRatingStrategy()-&gt;getAggregatedOpinion($article-&gt;asRatingObject()-&gt;getVotes());</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/113085/">https://habr.com/ru/post/113085/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113078/index.html">Web developer pitfalls</a></li>
<li><a href="../113079/index.html">Bluetooth controlled machine</a></li>
<li><a href="../113080/index.html">Researchers manage to fingerprint clothes</a></li>
<li><a href="../113083/index.html">Feature List: I can! (I Can-Do!)</a></li>
<li><a href="../113084/index.html">Hyper Estraier - a small search engine for the lazy</a></li>
<li><a href="../113086/index.html">Telecommunications market in Russia - what, where, how, how much</a></li>
<li><a href="../113087/index.html">Combo avatars VKontakte</a></li>
<li><a href="../113088/index.html">QIWI Visa Card as a means of payment in other EPS</a></li>
<li><a href="../113089/index.html">Completion and main functionality of Nokia E7</a></li>
<li><a href="../113094/index.html">Toy for geeks - wireless domino</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>