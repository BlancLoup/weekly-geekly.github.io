<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Weather informer from Yandex with city definition by IP (ready code)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I became interested in the topic of displaying an informer from Yandex.Waters to a site visitor in accordance with its location . The Yandex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Weather informer from Yandex with city definition by IP (ready code)</h1><div class="post__text post__text-html js-mediator-article">  Recently, I became interested in the topic of displaying an informer from <a href="http://weather.yandex.ru/">Yandex.Waters</a> to a site visitor <em>in accordance with its location</em> .  The Yandex informer itself shows the weather only in the city that has chosen the webmaster of the site.  In practice, there is little sense in such an informer ( <a href="http://valera.ws/2008.03.31~ya-weather/">described</a> in the previous article).  Therefore, it is necessary to determine the city where the visitor is located, and display the necessary informer for him.  In the process of studying the topic, I came to the conclusion that, apart from <a href="http://valera.ws/2008.04.01~ip-to-city/">GeoLite City from MaxMind</a> and CNGeoIP, there are no normal world-wide databases IP-&gt; City.  However, the GeoLite City base is <a href="http://valera.ws/2008.04.02~cngeoip/">not suitable</a> for interaction with the Yandex service. <br>  Thus, it was necessary to stop on the basis of <a href="http://valera.ws/2008.04.02~cngeoip/">CNGeoIP</a> .  A version of the database was purchased and an algorithm for obtaining a city code for the informer on the visitor‚Äôs IP was built on it.  The written script works here: <em><a href="">commontools.net/geoip/ya.w.js</a></em> .  The city is determined by the user's IP, a comparison is made with the Yandex database and the city and country id for the informer is displayed as: <em>var yaCountry = 20; var yaCity = 26850;</em>  The script naturally works on the server side and displays only the id for JS.  And on the page with the informer, the script is included in the HTML code of the page via <em>script src = "..."</em> .  Then another simple script script substitutes the variables in the call code of the informer and the picture shows the weather in the city where the site visitor is located.  Under it is a link to the settings of the informer, where the visitor will be able to select another city, and the information will be saved in cookies. <br><img src="https://habrastorage.org/getpro/geektimes/post_images/e46/49a/f5a/e4649af5aeb9c86fe5e4c47ec10f367b.gif" align="left">  So, the result of works in the form of a beta-version, which, I hope, you will help me to test.  The page for getting the code is here: <a href="http://commontools.net/geoip/ya.weather.get.html">http://commontools.net/geoip/ya.weather.get.html</a> .  This is the page to get the informer code.  It describes how to get the code and screw to the site. <br>  Although the service is still at the beta testing stage, now you can get the code and place it on your website.  <strong>The service will be open and on, free and free to be used as intended.</strong> <br>  See how the informer works, you can now <a href="http://valera.ws/">on my blog</a> . <br>  PS For the curious.  The domain commontools.net is exclusively auxiliary, it has never been and will not be any sites.  Only services for own and public consumption. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/22992/">https://habr.com/ru/post/22992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229905/index.html">Make the simplest filter by product properties using ElasticSearch on Symfony2</a></li>
<li><a href="../229909/index.html">Search Preview - Chrome extension</a></li>
<li><a href="../229911/index.html">How to create a legend</a></li>
<li><a href="../229917/index.html">We program for iPhone and iPad. 3rd ed</a></li>
<li><a href="../229919/index.html">Assessment of renewable energy potential. Regional experience</a></li>
<li><a href="../229921/index.html">Using the principles of psychology to increase the conversion of sites. Part 1: Gestalt psychology, the law of brevity</a></li>
<li><a href="../229923/index.html">Open Interconnect Consortium - the new driving force of the ‚ÄúInternet of Things‚Äù</a></li>
<li><a href="../229927/index.html">SpaceX will build a futuristic space center in Texas</a></li>
<li><a href="../229929/index.html">Why actually use micromarking. Review from Yandex</a></li>
<li><a href="../22993/index.html">The future of books. 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>