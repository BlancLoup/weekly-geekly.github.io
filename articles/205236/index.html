<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WCF RIA Services. Receiving data. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="WCF RIA Services. Start. Part 1 
 WCF RIA Services. Receiving data. Part 2 
 WCF RIA Services. Update data. Part 3 
 WCF RIA Services. Implement the M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WCF RIA Services. Receiving data. Part 2</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/post/203820/">WCF RIA Services.</a>  <a href="http://habrahabr.ru/post/203820/">Start.</a>  <a href="http://habrahabr.ru/post/203820/">Part 1</a> <br>  <a href="http://habrahabr.ru/post/205236/">WCF RIA Services.</a>  <a href="http://habrahabr.ru/post/205236/">Receiving data.</a>  <a href="http://habrahabr.ru/post/205236/">Part 2</a> <br>  <a href="http://habrahabr.ru/post/207054/">WCF RIA Services.</a>  <a href="http://habrahabr.ru/post/207054/">Update data.</a>  <a href="http://habrahabr.ru/post/207054/">Part 3</a> <br>  <a href="http://habrahabr.ru/post/215321/">WCF RIA Services.</a>  <a href="http://habrahabr.ru/post/215321/">Implement the Model-View-ViewModel (MVVM) pattern.</a>  <a href="http://habrahabr.ru/post/215321/">Part 4</a> <br><br><h4>  General information </h4><br>  In the first part, we reviewed what kind of WCF RIA Services was for the beast, and created an application that can be briefly called ‚ÄúHello world‚Äù.  Everything was very simple, beautiful, as well as drag and drop.  However, to create real, large and functional applications, there is a lot more to learn, for example, what features are available in the client side, and how to use them.  In this lesson we will dig a little deeper in the field of data acquisition on the client side.  You will also learn about conventions that are used for methods that receive data defined in the server side, how to configure them using attributes.  I will talk about some software implementations that can be used to obtain data on the client side and how to use data that uses sources other than the Entity Framework. <br><a name="habracut"></a><br>  The starting point for studying the above is a project that was created in the previous, first part. <br><br><h4>  Step 1: Add a parameterized query to the domain service </h4><br>  After we created the domain service in the previous lesson, it looked like this: <br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IQueryable&lt;Task&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTasks</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ObjectContext.Tasks; }</code> </pre> <br>  This method returns all the entries from the Tasks table as an enum type IQueryable and takes no arguments.  If there is a need to get a more specific request on the client side, then you need to add a method to the domain service, which in turn will be automatically available to the client.  It is also possible to return data of type IEnumerable, but if the main data provider (Entity Framework or LINQ to SQL) returns IQueryable, then this will need to be implemented separately. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now we are modernizing our application in such a way that we can add the ability to receive events in a given date range.  To do this, add the following code to the domain service: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IQueryable&lt;Task&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTasksByStartDate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> DateTime lowerDateTimeInclusive, DateTime upperDateTimeInclusive</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ObjectContext.Tasks.Where( t =&gt; t.StartDate &gt;= lowerDateTimeInclusive &amp;&amp; t.StartDate &lt;= upperDateTimeInclusive); }</code> </pre><br><h4>  Step 2: Change the UI to get specific data. </h4><br>  For this you need to add a few elements to our page.  Open MainPage.xaml.  Move the grid so that there is free space above it to add elements.  Using ‚ÄúDrag and drop‚Äù add two TextBox and one Button from the Toolbar.  Name the created elements accordingly: lowerDate, upperDate, searchButton. <br><br><img src="http://habrastorage.org/storage3/473/86e/f28/47386ef2811df886659338538f4e79a7.png"><br><br>  Change the Content button to ‚ÄúSearch By Date‚Äù. <br><br><img src="http://habrastorage.org/storage3/00e/f22/cb9/00ef22cb9dc139f7849d9b5ac1ab37fd.png"><br><h4>  Step 3: Get the result of the query on the client using DomainContext </h4><br>  As you remember, DomainContext is an auto-generated code that reflects the capabilities of the server side of the application.  That is, if the domain service is called TasksDomainService, then the client part of the application is called TasksDomainContext.  It provides the ability to access the server part in asynchronous mode, as well as save changes that were made on the client side. <br><br>  So, every time when entities are received from the server by executing queries through the domain context, it also stores references to these objects and some other additional information that helps track changes.  And in the case of changes in these objects, the domain context will send to the server only those entities that need to be updated.  About this in the next lesson.  Now let's focus on getting the data. <br><br>  Add a ‚ÄúClick‚Äù event to the button you just created.  And in the event handler add the following code: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">searchButton_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { DateTime lowerDateVal; DateTime upperDateVal; GetDates(<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> lowerDateVal, <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> upperDateVal); TasksDomainContext context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TasksDomainContext(); taskDataGrid.ItemsSource = context.Tasks; EntityQuery&lt;Task&gt; query = context.GetTasksByStartDateQuery(lowerDateVal, upperDateVal); LoadOperation&lt;Task&gt; loadOp = context.Load(query); }</code> </pre><br>  Attention should be paid to the last 4 lines of the code, since the first 3 are simply the receipt of the entered date from the corresponding fields, and looks like this: <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDates</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DateTime lowerDateVal, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> DateTime upperDateVal</span></span></span><span class="hljs-function">)</span></span> { lowerDateVal = DateTime.MinValue; upperDateVal = DateTime.MaxValue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(lowerDate.Text)) { lowerDateVal = DateTime.Parse(lowerDate.Text); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(upperDate.Text)) { upperDateVal = DateTime.Parse(upperDate.Text); } }</code> </pre><br>  In order to be able to call the server part, you need to create an instance of the domain context.  Most likely, you will want to create this instance in such a way that it would live as long as necessary, because it is thanks to it that all the necessary information is kept to track changes.  For example, when using the MVVM pattern, it is a good idea to create and move an instance of the domain context to the view model property.  In more detail we will talk on this subject in the fourth lesson. <br><br>  The domain context provides collections of entities, which in turn include sets of collections returned by the service domain after the processing of requests.  At this stage, the service domain provides only a collection of data from the Tasks table. <br><br>  Note that this code replaces the ItemsSource in the DataGrid with the Tasks collection before any data request is made.  This is necessary because the requests sent by the domain context are asynchronous and will replace the contents of the collection only after the response from the server arrives.  This collection implements the INotifyCollectionChanged interface and is able to trigger events directed to the DataGrid (or any associated item) to update its contents. <br><br>  Then comes the EntityQuery from the context with arguments that are passed to the corresponding method on the server.  That is, here we indicate what we would like to receive, but the call is not yet happening.  Finally, the LoadOperation is retrieved from the context by calling the Load method.  This is where the server directly accesses the shadow stream, and when the request is executed on the server and the answer comes with the necessary data, the UI will automatically update all the information to the current one. <br><br>  In principle, this is the same thing that happens under the cover of the DomainDataSource from the first lesson. <br><br><h4>  Step 4: Adding a method that returns a single object </h4><br>  So that the method does not return the collection, it is necessary to declare it as necessary.  Further, after compilation, it will also be available on the client side: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTask</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> taskId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ObjectContext.Tasks.FirstOrDefault(t =&gt; t.TaskId == taskId); }</code> </pre><br><h4>  Settings Convention </h4><br>  There is such a tendency in.  NET programming, when the amount of code required to explicitly prescribe to provide the necessary settings is reduced, but you have to follow some naming rules.  Perhaps you have not noticed this yet by skimming through the domain service code, but there it already applies.  This is not very obvious on methods that extract data, since a method with any name will work equally well.  However, for the update, delete and create operations, you need to follow certain rules, based on which WCF RIA Services searches for and executes the necessary methods, for example, such as UpdateTask, InsertTask, DeleteTask.  It is possible to indicate several options for each operation. <br><br>  And do not forget about the possibility of customization using the attributes.  For example, for the party performing queries, you can decorate methods with the [Query] attribute, which will make your code more readable and easy to understand.  It must be remembered that the type of the return value also says a lot about the purpose of the method.  For example, the method that returns IQueryable, IEnumberable, is unambiguously responsible for retrieving data.  However, the advantage of using the Query attribute is that it also supports some additional parameters, such as the maximum number of returned results, which will limit their number, even if the database returns more than necessary after the query. <br><br><h4>  Custom Domain Services </h4><br>  And what if you do not want to use the Entity Framework?  Alternatively, you can use LINQ to SQL.  I would advise using the Entity Framework with new projects.  And if possible with the old. <br><br>  LINQ to SQL is supported in WCF RIA Services via the Toolkit. <br><br>  However, many use other data access strategies, such as nHibernate and other data sources, such as Oracle, MySQL, and many others.  All this can also be used in WCF RIA Services, but you need to define data objects as simple entities and use them further in the code as you see fit.  This approach is called POCO (Plain Old CLR Objects) domain services. <br><br>  To create such a domain service, the domain class of the service must be inherited directly from the DomainService, and not from the LinqToEntitiesDomainService.  In the creation wizard, create a service domain, select ‚ÄúEmpty Domain Service Class‚Äù in the ‚ÄúAvailable Context Classes‚Äù drop-down menu.  Then define the entities, return the IEnumerable collections of these entities if your data source does not support IQueryable and do everything you need in methods based on the data source. <br><br><img src="http://habrastorage.org/storage3/f60/948/2e5/f609482e5383a757ec81d42b50714abf.png"><br><br>  Next, you must design your service according to the source data and the objects you work with.  These objects must have the properties of other objects or sets of built-in .NET supported types. <br><br>  The key with which you frame your entities determines that they must have key properties that uniquely identify them.  Usually "int" or "Guid".  Specify this property as an attribute [Key]. <br><br>  Below is the code that shows how to declare a POCO domain of a service and its entities: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Foo</span></span> { [Key] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> FooId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } [EnableClientAccess()] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyPOCODomainService</span></span> : <span class="hljs-title"><span class="hljs-title">DomainService</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IEnumerable&lt;Foo&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFoos</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Foo&gt; { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Foo { FooId = <span class="hljs-number"><span class="hljs-number">42</span></span>, Name = <span class="hljs-string"><span class="hljs-string">"Fred"</span></span> } }; } }</code> </pre><br><br>  In addition to the [Key] attribute, if you have properties that are themselves entity types (related entities or unions), then you need to add properties to this entity, for example, an ID that maps key fields.  In addition, directly at the entity property, you must specify the [Association] attribute, which shows the ID of the property that establishes connections (relations) and reports that this is the foreign key.  It is still necessary to specify the attribute [Include] for the property of the entity, so that the child entity is also always retrieved when the parent is retrieved using RIA Services. <br><br>  After launching the project, you will receive such a window where you can select by date: <br><br><img src="http://habrastorage.org/storage3/692/af5/86d/692af586df29d1f651094f9ecc69f781.png"><br><br><h4>  Video for this lesson </h4><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ys9SxzqdjzI%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253&amp;usg=ALkJrhhd3vnIT7TWjt4EonYcH2us1vZjtA" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Sources </h4><br>  On <a href="https://github.com/struggleendlessly/Silverlight_WCF_RIA/tree/Part2">github</a> </div><p>Source: <a href="https://habr.com/ru/post/205236/">https://habr.com/ru/post/205236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../205220/index.html">ShareJS hook logic</a></li>
<li><a href="../205222/index.html">Warm lamp text interface. Just about simple</a></li>
<li><a href="../205230/index.html">The best textbook on Meteor - "Discover Meteor" - one day for free</a></li>
<li><a href="../205232/index.html">Anonymous Santa Claus 2014. Post boasting Christmas gifts</a></li>
<li><a href="../205234/index.html">The largest torrent trackers hit the Kaspersky Lab's parental control database</a></li>
<li><a href="../205238/index.html">The easiest way to grab statics for free on Heroku</a></li>
<li><a href="../205240/index.html">The new prosthetic arm returns a sense of touch.</a></li>
<li><a href="../205244/index.html">The digest of news from the world of mobile development for the last week ‚Ññ33 (December 2-8, 2013)</a></li>
<li><a href="../205246/index.html">Explorer - 3 and the exhibition "Step into the Future 2013 SFD"</a></li>
<li><a href="../205248/index.html">Microsoft started hunting for ZeroAccess</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>