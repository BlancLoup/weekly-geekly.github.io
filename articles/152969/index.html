<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Percona XtraDB Cluster. Installation and Testing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I was thinking about increasing the availability of my project servers. Everything was solved relatively easily except for the MySQL dat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Percona XtraDB Cluster. Installation and Testing</h1><div class="post__text post__text-html js-mediator-article">  Some time ago I was thinking about increasing the availability of my project servers.  Everything was solved relatively easily except for the MySQL database.  Master-type replication creates problems with index synchronization, while the cluster solution NDBcluster is developing rapidly, but it is still not suitable for migrating a finished project to it due to the large list of differences and limitations. <br><br>  But there is an alternative solution called Galera Cluster, on which Percona XtraDB Cluster is based, which I will tell you about installing, configuring and testing for Ubuntu. <br><a name="habracut"></a><br><br><h4>  How is this better than NDBcluster? </h4><br>  First: fewer restrictions (list of restrictions NDBcluster: <a href="http://dev.mysql.com/doc/refman/5.5/en/mysql-cluster-limitations.html">dev.mysql.com/doc/refman/5.5/en/mysql-cluster-limitations.html</a> , list of restrictions XtraDB Cluster: <a href="http://www.percona.com/doc/percona-xtradb-cluster/limitation.html">www.percona.com/doc/percona-xtradb -cluster / limitation.html</a> ). <br>  I only had to redo a few MyISAM tables in InnoDB. <br>  Secondly: multiple patches of MySQL code engine from Perkona. <br>  Thirdly: the possibility of working in a two-year configuration (I‚Äôll just make a reservation that it is suitable only for testing). <br>  Finally, MySQL forklifts are now trendy :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  How is it better Galera Cluster screwed to the fork of MySQL? </h4><br>  The presence of the utility xtrabackup, which allows you to make backups on the fly.  This is useful because when connecting a new node to the cluster, you will not need to stop any of the working nodes to drain the base from it. <br><br><h4>  Installation </h4><br>  Installation under Ubuntu, as usual, is elementary: <br><pre><code class="hljs objectivec">gpg --keyserver hkp:<span class="hljs-comment"><span class="hljs-comment">//keys.gnupg.net --recv-keys 1C4CBDCDCD2EFD2A gpg -a --export CD2EFD2A | sudo apt-key add - sudo apt-get update sudo apt-get install percona-xtradb-cluster-server-5.5</span></span></code> </pre> <br>  Sometimes swears on unsolvable dependencies.  Then it is enough to first install the dependencies, and then the server itself. <br><br>  First, without changing anything in the settings, go to the mysql console (enough on the node that will be started first) and add the user for the backup: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">grant</span></span> RELOAD, <span class="hljs-keyword"><span class="hljs-keyword">LOCK</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLES</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">REPLICATION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CLIENT</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">FILE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> *.* <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">backup</span></span>@localhost <span class="hljs-keyword"><span class="hljs-keyword">identified</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-string"><span class="hljs-string">'password'</span></span>;</code> </pre><br><br>  Then you need one small alteration.  The fact is that in Ubunt a symlink with sh leads to dash, and the cluster startup script is sharpened for bash.  If there are no contraindications, you can settle this system-wide: <br><pre> <code class="hljs">dpkg-reconfigure dash</code> </pre><br>  Reply no. <br><br>  Since the bases after the launch of the cluster will become completely identical, then the system user password on all nodes will become the same as the first one.  Therefore, you need to copy the /etc/mysql/debian.cnf file from the server that will be launched first to the rest. <br><br>  My configs look like this: <br><pre> <code class="hljs ruby">[mysqld_safe] wsrep_urls=<span class="hljs-symbol"><span class="hljs-symbol">gcomm:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/192.168.1.1:3400,gcomm:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/192.168.1.2:3400,gcomm:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ [mysqld] port=3306 socket=/var</span></span><span class="hljs-regexp"><span class="hljs-regexp">/run/mysqld</span></span><span class="hljs-regexp"><span class="hljs-regexp">/mysqld.sock datadir=/var</span></span><span class="hljs-regexp"><span class="hljs-regexp">/lib/mysql</span></span> basedir=<span class="hljs-regexp"><span class="hljs-regexp">/usr user=mysql log_error=error.log binlog_format=ROW wsrep_provider=/usr</span></span><span class="hljs-regexp"><span class="hljs-regexp">/lib/libgalera</span></span>_smm.so wsrep_sst_receive_address=<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">3500</span></span> wsrep_node_incoming_address=<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">1.1</span></span> wsrep_slave_threads=<span class="hljs-number"><span class="hljs-number">2</span></span> wsrep_cluster_name=cluster<span class="hljs-number"><span class="hljs-number">0</span></span> wsrep_provider_options=<span class="hljs-string"><span class="hljs-string">"gmcast.listen_addr=tcp://192.168.1.1:3400;"</span></span> wsrep_sst_method=xtrabackup wsrep_sst_auth=<span class="hljs-symbol"><span class="hljs-symbol">backup:</span></span>password wsrep_node_name=node<span class="hljs-number"><span class="hljs-number">0</span></span> innodb_locks_unsafe_for_binlog=<span class="hljs-number"><span class="hljs-number">1</span></span> innodb_autoinc_lock_mode=<span class="hljs-number"><span class="hljs-number">2</span></span> innodb_buffer_pool_size=<span class="hljs-number"><span class="hljs-number">5000</span></span>M innodb_log_file_size=<span class="hljs-number"><span class="hljs-number">256</span></span>M innodb_log_buffer_size=<span class="hljs-number"><span class="hljs-number">4</span></span>M [client] port=<span class="hljs-number"><span class="hljs-number">3306</span></span> socket=<span class="hljs-regexp"><span class="hljs-regexp">/var/run</span></span><span class="hljs-regexp"><span class="hljs-regexp">/mysqld/mysqld</span></span>.sock</code> </pre><br>  Check the location of libgalera_smm.so. <br>  The value of the wsrep_slave_threads parameter is recommended to be set as the number of cores * 4 <br>  In wsrep_sst_auth user login and password for backups are specified. <br>  innodb_buffer_pool_size, innodb_log_file_size, innodb_log_buffer_size - affect performance, and are selected experimentally.  In my case, each node is 8 gig RAM. <br><br>  To add nodes, add them to the wsrep_urls line (there should be an empty entry at the end of the line). <br>  All ip addresses found in the file (except for the wsrep_urls line) indicate the address of the current node.  They need to be changed when distributing this file to other nodes.  You also need to change the name of the node in wsrep_node_name. <br><br>  In my configuration, port 3400 is used for synchronization, port 3500 - for dump filling, port 3306 (standard) - for client connection. <br><br><blockquote>  You can run multiple nodes on the same machine, giving them different ports.  If you decide to do this, then you need to create several configuration files in / etc / mysql and start the server with the following command: <br><pre> <code class="hljs pgsql">/usr/bin/mysqld_safe <span class="hljs-comment"><span class="hljs-comment">--defaults-file=/etc/mysql/my0.cnf</span></span></code> </pre><br>  Note that xtrabackup can only connect via a standard socket /var/run/mysqld/mysqld.sock (ignores parameters from the config).  So in this case you have to not use it: wsrep_sst_method = rsync <br></blockquote><br><br>  And finally, restart the daemon: <br><pre> <code class="hljs pgsql">sudo service mysql <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span></code> </pre><br>  If something went wrong, look in /var/lib/mysql/error.log. <br>  Usually you need to erase / var / lib / mysql / ib_logfile * due to the change in the size of the log in the config file. <br><br>  Sometimes it's easier to erase the whole / var / lib / mysql / (if there is nothing valuable in the databases) and re-create the default databases: <br><pre> <code class="hljs">mysql_install_db</code> </pre><br><br>  I also quoted some possible errors at the end of the article. <br><br><h4>  Number of nodes </h4><br>  The manufacturer recommends at least three, but there are differences from NDB: initially all nodes are of the same rank and have the same functionality.  Nothing prevents to make and 2 nodes. <br><br>  With the two-channel configuration, everything is simple and sad: it works until the connection between the nodes disappears.  In this case, the cluster in order to protect against split-brain does not give anything to do.  There are a couple of options for the config, under which it will work even if the connection is broken, but, understandably, there is more harm than benefit from them - when a connection appears, we will get 2 different copies of the database, which is not clear how to combine. <br><br>  The variant with three nodes in my case did not fit, since I have only 2 servers on a collocation, and the third one added to them somewhere on the office channel would spoil the performance, because the speed of the cluster is determined by the speed of the slowest node. <br><br>  But there is a solution: Galera Arbitator.  This is an inferior node that does not store databases and does not need a fast channel, but as long as the node keeps in touch with it, it will continue to work.  This node is so inferior that it does not even use the config, all parameters are passed to it via the command line. <br>  Of the parameters, you need only the address of one of the normal nodes and the name of the cluster: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">garbd</span></span> -a gcomm://192.168.1.1:3400 -g cluster0</code> </pre><br><br><h4>  Tests </h4><br>  I tested the standard utility sql-bench from the test package, first the nodes separately, and then the cluster.  The software did not change at the same time - percona-xtradb-cluster. <br><br>  Install and run the test package: <br><pre> <code class="hljs pgsql">apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install percona-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>-test<span class="hljs-number"><span class="hljs-number">-5.5</span></span> libdbd-mysql-perl cd /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>-bench/<span class="hljs-keyword"><span class="hljs-keyword">sql</span></span>-bench/ perl run-<span class="hljs-keyword"><span class="hljs-keyword">all</span></span>-tests <span class="hljs-comment"><span class="hljs-comment">--server=mysql --user=root --password=&lt;password&gt;</span></span></code> </pre><br><br>  First tested on two identical fast machines with SSD. <br>  I threw out the results of the first run, as they were much better than the next ones (write off to pure SSDs). <br><br>  This is 1 node: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">alter</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">17</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">0.04</span></span> usr <span class="hljs-number"><span class="hljs-number">0.00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">0.04</span></span> CPU) ATIS: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">2.48</span></span> usr <span class="hljs-number"><span class="hljs-number">0.16</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">2.64</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">big</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">tables</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">1.87</span></span> usr <span class="hljs-number"><span class="hljs-number">0.34</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">2.21</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">64</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">19.80</span></span> usr <span class="hljs-number"><span class="hljs-number">5.68</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">25.48</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">create</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">548</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">3.35</span></span> usr <span class="hljs-number"><span class="hljs-number">1.66</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">5.01</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">531</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">155.04</span></span> usr <span class="hljs-number"><span class="hljs-number">19.15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">174.19</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">168</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">17.93</span></span> usr <span class="hljs-number"><span class="hljs-number">1.90</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">19.83</span></span> CPU) transactions: <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> skipped because the <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> doesn<span class="hljs-string"><span class="hljs-string">'t support transactions wisconsin: Total time: 5 wallclock secs ( 1.31 usr 0.18 sys + 0.00 cusr 0.00 csys = 1.49 CPU)</span></span></code> </pre><br><br>  This is a cluster: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">alter</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">21</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">0.04</span></span> usr <span class="hljs-number"><span class="hljs-number">0.05</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">0.09</span></span> CPU) ATIS: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">21</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">2.76</span></span> usr <span class="hljs-number"><span class="hljs-number">0.30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">3.06</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">big</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">tables</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">17</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">1.98</span></span> usr <span class="hljs-number"><span class="hljs-number">0.40</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">2.38</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">67</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">21.13</span></span> usr <span class="hljs-number"><span class="hljs-number">5.59</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">26.72</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">create</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">597</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">3.55</span></span> usr <span class="hljs-number"><span class="hljs-number">1.55</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">5.10</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">1710</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">164.66</span></span> usr <span class="hljs-number"><span class="hljs-number">35.25</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">199.91</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">187</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">19.49</span></span> usr <span class="hljs-number"><span class="hljs-number">2.44</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">21.93</span></span> CPU) transactions: <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> skipped because the <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> doesn<span class="hljs-string"><span class="hljs-string">'t support transactions wisconsin: Total time: 47 wallclock secs ( 1.62 usr 0.88 sys + 0.00 cusr 0.00 csys = 2.50 CPU)</span></span></code> </pre><br>  A 3-fold drop on write operations and a serious (if not to say epic) drop on a Wisconsin test, where the idea of ‚Äã‚Äãreading and writing should be interspersed. <br>  I do not know why swears on the transaction.  In fact, they work. <br><br>  There was an assumption that everything depends on the speed of the network, so I tested it on machines (no longer identical) with the hard drives. <br><br>  First node separately: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">alter</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">0.04</span></span> usr <span class="hljs-number"><span class="hljs-number">0.02</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">0.06</span></span> CPU) ATIS: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">2.40</span></span> usr <span class="hljs-number"><span class="hljs-number">0.14</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">2.54</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">big</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">tables</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">1.23</span></span> usr <span class="hljs-number"><span class="hljs-number">0.15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">1.38</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">53</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">16.31</span></span> usr <span class="hljs-number"><span class="hljs-number">7.65</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">23.96</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">create</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">3215</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">2.58</span></span> usr <span class="hljs-number"><span class="hljs-number">0.83</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">3.41</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">541</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">142.41</span></span> usr <span class="hljs-number"><span class="hljs-number">22.53</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">164.94</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">154</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">12.66</span></span> usr <span class="hljs-number"><span class="hljs-number">1.34</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">14.00</span></span> CPU) transactions: <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> skipped because the <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> doesn<span class="hljs-string"><span class="hljs-string">'t support transactions wisconsin: Total time: 4 wallclock secs ( 1.15 usr 0.29 sys + 0.00 cusr 0.00 csys = 1.44 CPU)</span></span></code> </pre><br><br>  Second node separately: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">alter</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">59</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">0.03</span></span> usr <span class="hljs-number"><span class="hljs-number">0.03</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">0.06</span></span> CPU) ATIS: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">11</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">2.35</span></span> usr <span class="hljs-number"><span class="hljs-number">0.23</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">2.58</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">big</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">tables</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">11</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">1.92</span></span> usr <span class="hljs-number"><span class="hljs-number">0.30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">2.22</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">64</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">19.67</span></span> usr <span class="hljs-number"><span class="hljs-number">5.84</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">25.51</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">create</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">4592</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">3.90</span></span> usr <span class="hljs-number"><span class="hljs-number">1.39</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">5.29</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">581</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">148.16</span></span> usr <span class="hljs-number"><span class="hljs-number">19.80</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">167.96</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">168</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">18.45</span></span> usr <span class="hljs-number"><span class="hljs-number">2.07</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">20.52</span></span> CPU) transactions: <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> skipped because the <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> doesn<span class="hljs-string"><span class="hljs-string">'t support transactions wisconsin: Total time: 5 wallclock secs ( 1.18 usr 0.25 sys + 0.00 cusr 0.00 csys = 1.43 CPU)</span></span></code> </pre><br><br>  Cluster: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">alter</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">110</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">0.04</span></span> usr <span class="hljs-number"><span class="hljs-number">0.02</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">0.06</span></span> CPU) ATIS: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">496</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">1.61</span></span> usr <span class="hljs-number"><span class="hljs-number">0.17</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">1.78</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">big</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">tables</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">116</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">1.02</span></span> usr <span class="hljs-number"><span class="hljs-number">0.16</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">1.18</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">34</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">10.98</span></span> usr <span class="hljs-number"><span class="hljs-number">2.49</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">13.47</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">create</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">4638</span></span> wallclock secs ( <span class="hljs-number"><span class="hljs-number">2.42</span></span> usr <span class="hljs-number"><span class="hljs-number">0.91</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">3.33</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span>: Estimated total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">43470.8</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">106.50</span></span> usr <span class="hljs-number"><span class="hljs-number">15.34</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">121.84</span></span> CPU) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>: Total <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">631</span></span> wallclock secs (<span class="hljs-number"><span class="hljs-number">11.02</span></span> usr <span class="hljs-number"><span class="hljs-number">1.02</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sys</span></span> + <span class="hljs-number"><span class="hljs-number">0.00</span></span> cusr <span class="hljs-number"><span class="hljs-number">0.00</span></span> csys = <span class="hljs-number"><span class="hljs-number">12.04</span></span> CPU) transactions: <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> skipped because the <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> doesn<span class="hljs-string"><span class="hljs-string">'t support transactions wisconsin: Total time: 1576 wallclock secs ( 1.37 usr 0.44 sys + 0.00 cusr 0.00 csys = 1.81 CPU)</span></span></code> </pre><br><br>  However, the assumption was not confirmed: the write operation on the hard disk computers in the cluster slowed down by as much as 10 times.  How to explain this - I do not know. <br><br>  As for using it in real production, everyone chooses for himself.  To me, this relative decline in performance is uncritical due to the small absolute numbers. <br><br><h4>  Possible problems and solutions </h4><br>  one. <br><pre> <code class="hljs 1c">WSREP: Process completed with error: wsrep_sst_xtrabackup 'donor' '192.168.1.1:<span class="hljs-number"><span class="hljs-number">6000</span></span>/xtrabackup_sst' 'backup:password' '/var/lib/mysql2/' '/etc/mysql/my2.cnf' '9bdd<span class="hljs-number"><span class="hljs-number">7773</span></span>-0cb4-11e2-<span class="hljs-number"><span class="hljs-number">0800</span></span>-8e876ebc6b70' '0' '0': <span class="hljs-number"><span class="hljs-number">22</span></span> (Invalid argument)</code> </pre><br>  xtrabackup could not connect to the database.  You are definitely not trying to make multiple nodes on the same machine?  See the details in innobackup.backup.log. <br><br>  2 <br><pre> <code class="hljs sql">121002 15:19:54 mysqld_safe Starting mysqld daemon <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">databases</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/mysql0 /usr/<span class="hljs-keyword"><span class="hljs-keyword">bin</span></span>/mysqld_safe: <span class="hljs-number"><span class="hljs-number">172</span></span>: [: gcomm://: unexpected <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span></code> </pre><br>  Instead of bash, a different interpreter is used.  Either in mysqld_safe change the first line, or edit the symlinks. <br><br>  3. If MyISAM tables are created but not populated from the dump, then it should be this way: only InnoDB is supported. <br><br>  4. If for all commands that write or read data, the MySQL client issues the ‚ÄúUnknown command‚Äù: this is protection against the split-brain if the connection between the nodes is broken. </div><p>Source: <a href="https://habr.com/ru/post/152969/">https://habr.com/ru/post/152969/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152957/index.html">Autumn School on software-configured networks and home-based implementation</a></li>
<li><a href="../152959/index.html">s02.e05. How to google name day</a></li>
<li><a href="../152961/index.html">Setting up the WAAM inventory system: Inventory of the state institution's property for work in 1C 8.2</a></li>
<li><a href="../152965/index.html">Android web development environment</a></li>
<li><a href="../152967/index.html">Have the courage to do not like everything. 12 obsolete interface and technology solutions</a></li>
<li><a href="../152971/index.html">What is Selenium WebDriver?</a></li>
<li><a href="../152975/index.html">Raspberry Pi from Newark (USA)</a></li>
<li><a href="../152977/index.html">In Japan, you can now get 2 years in prison for downloading "pirated" files</a></li>
<li><a href="../152979/index.html">Will you allow Google Site Search or Yandex Search for a site to take data directly from your database?</a></li>
<li><a href="../152981/index.html">Xi3 Corporation introduced two new models of mini-desktops</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>