<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing Archlinux on an Android phone in the second section of SD or just a subfolder of the system memory card</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello to all. There was already an article on the topic of Botbrew, where in general it is described what it is and what it gives. In short: 
 The Bot...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing Archlinux on an Android phone in the second section of SD or just a subfolder of the system memory card</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/fbc/b6c/2af/fbcb6c2af37f61457195b8e27a03d3d8.jpg" alt="image"><br><br>  Hello to all.  There was already an <a href="http://habrahabr.ru/company/xakep/blog/208518/">article</a> on the topic of Botbrew, where in general it is described what it is and what it gives.  In short: <br><blockquote>  The BotBrew project is designed to solve many problems with installing Linux software that a user may encounter, and prepare the Android system for accepting applications that are foreign to it. </blockquote><br>  The usual, classic Botbrew has its own repository, but there are few packages in it, which is sad.  Those who really want to go crazy like Borbrew-Basil, which uses the emdebian debian repository.  However, with him now, too, everything is sad, because <br><blockquote>  As of July 2014, updates to the Emdebian distributions ceased.  There is no further updates. </blockquote><br>  It turns out that even those who once set themselves emdebian, now in the span.  This post will be about how to put on a ruled <a href="http://archlinuxarm.org/">Archlinux</a> phone, but not as usual in a loop image, but on the native Android file system or the second SD partition.  It is assumed that there is a rooted phone with installed busybox, USB debugging enabled and adb utility on the main computer. <br><a name="habracut"></a><br><h1>  Cooking device </h1><br>  The first thing we need is to create a folder where we will put our linux.  Option two - a folder on the / data section or a separate ext4 section of the memory card.  In the second case, the partition will need to somehow be mounted into the main FS of the phone.  You can do this for example using <a href="http://forum.xda-developers.com/showthread.php%3Ft%3D919326">Link2SD</a> .  Further, I will proceed from the fact that the second section of the SD, mounted in / data / sdext2, is used, we will put in the folder / data / sdext2 / arch. <br>  You also need to understand the repository for which processor architecture we will use.  I have a Qumo Quest 454 with an armv7l processor and it was <a href="http://mirror.archlinuxarm.org/arm/">http://mirror.archlinuxarm.org/arm/</a> . <br><br>  We connect the phone via USB, go to it via adb and rush. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  We collect the minimum starting option </h1><br>  For a minimal installation, you will need the following packages (we run from root, versions of packages may eventually become newer): <br><br><pre><code class="bash hljs">mkdir -p /data/sdext2/arch/packages <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /data/sdext2/arch/packages wget http://mirror.archlinuxarm.org/arm/core/acl-2.2.52-2-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/attr-2.4.47-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/bash-4.3.030-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/bzip2-1.0.6-5-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/curl-7.39.0-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/e2fsprogs-1.42.12-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/expat-2.1.0-4-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/filesystem-2014.10-3-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/gcc-libs-4.9.2-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/glibc-2.20-4-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/gpgme-1.5.2-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/keyutils-1.5.9-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/krb5-1.13-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/libarchive-3.1.2-8-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/libassuan-2.1.3-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/libgpg-error-1.17-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/libidn-1.29-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/libssh2-1.4.3-2-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/lzo-2.08-3.1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/ncurses-5.9-6.1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/openssl-1.0.1.j-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/pacman-4.1.2-7-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/pacman-mirrorlist-20141208-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/readline-6.3.006-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/util-linux-2.25.2-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/xz-5.0.7-1-arm.pkg.tar.xz wget http://mirror.archlinuxarm.org/arm/core/zlib-1.2.8-3-arm.pkg.tar.xz</code> </pre> <br><br>  Once everything is downloaded, unpack: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /data/sdext2/arch tar xvf packages/*.pkg.xz</code> </pre><br><br>  We got something like the Archlinux minimal install.  Now let's try to chroot into it by pre-mounting the system folders (): <br><br><pre> <code class="bash hljs">busybox mount -t proc none ./proc busybox mount -o rbind /dev ./dev busybox mount -t sysfs none ./sys busybox mount -t tmpfs none ./tmp busybox mount -o size=10%,mode=0755 -t tmpfs none ./run chroot . /bin/bash</code> </pre><br><br>  If everything went well, bash will start from our minimal environment and pacman will be available.  When I started any process, the system cursed that it could not find libsuc.so, described in LD_PRELOAD.  In this case, simply clean the LD_PRELOAD: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> LD_PRELOAD=</code> </pre><br><br><h1>  Tidy up the packages </h1><br>  So, we are in chroot, pacman and bash work for us.  First of all, let's put in order what is.  Register the DNS and load the repositories: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"nameserver 8.8.8.8"</span></span> &gt; /etc/resolv.conf pacman -Sy</code> </pre><br><br>  Now let's officially put what we just unpacked and add the rest of the minimally necessary packages for life and return the dns that the installation of the filesystem broke for us: <br><pre> <code class="bash hljs">pacman -S base --force --noconfirm <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"nameserver 8.8.8.8"</span></span> &gt; /etc/resolv.conf</code> </pre><br><br>  If everything went well, then we have a full-fledged minus systemd and Archlinux cores.  Exit the chroot and unmount everything we have mounted: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> umount ./dev/pts umount ./dev/cpuctl umount ./proc umount ./sys umount ./tmp umount ./run</code> </pre><br><br><h1>  We add automounting and other buns </h1><br>  To use what we got easily and easily, we will fix init from botbrew-basil.  This is a utility that checks whether everything is mounted and chroot into our environment.  I could not find how to download it from the botbrew repository, so for now I just put it on Yandex.Disk, <a href="https://yadi.sk/d/CD6PEWxedK6qx">link</a> .  Copy init to / data / sdext2 / arch and add the attribute for execution. <br><br>  Go to the adb shell and type: <br><pre> <code class="bash hljs">/data/sdext2/init /bin/bash</code> </pre><br><br>  As a result, all that is needed is itself one time mounted and we will find ourselves in the newly established Arch.  As a bonus, init will create the / storage, / mnt and / android folders at the root of chroot, where it will mount pieces of the original file system. <br><br>  In order to enjoy linux not via USB wire, but directly from the phone, you can write / data / sdext2 / init / bin / bash as a shela in your favorite terminal.  Then you can create users to taste, raise sshd, etc.  But any archaver already knows how to do this, so I‚Äôm not going to write about it here. <br><br>  Thank you for your attention, additions and corrections are welcome. <br><br>  <b>UPDATE: a</b> small script that I run once after a reboot <br><div class="spoiler">  <b class="spoiler_title">Initialization script</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash if [[ `whoami` != "root" ]] then sudo bash $0 $@ exit $? fi chmod 777 /tmp c=`ps afx | grep /usr/sbin/sshd | grep -cv grep` if [[ "$c" != "1" ]] then echo Strating sshd /usr/sbin/sshd else echo sshd already started fi if [[ ! -e /dev/fd ]] then echo Creating /dev/fd links ln -s /proc/self/fd /dev/fd ln -s /proc/self/fd/0 /dev/stdin ln -s /proc/self/fd/1 /dev/stdout ln -s /proc/self/fd/2 /dev/stderr fi if [[ ! -e /dev/net/tun ]] then echo Creating /dev/net/tun mkdir /dev/net ln -s /dev/tun /dev/net/tun else echo /dev/net/tun already exists fi</span></span></code> </pre></div></div></div><p>Source: <a href="https://habr.com/ru/post/221543/">https://habr.com/ru/post/221543/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../221525/index.html">One approach to debugging solutions for SharePoint</a></li>
<li><a href="../221527/index.html">Is fundamental education in CS important and a view from Yandex on professions in the world of information technology?</a></li>
<li><a href="../221529/index.html">The seventh issue of TsODY.RF magazine</a></li>
<li><a href="../221531/index.html">Linux for professionals: video editing (and a bit of compositing)</a></li>
<li><a href="../221539/index.html">FZ-229 - hands off the main mobile account</a></li>
<li><a href="../221545/index.html">Unity3d Lessons from Unity 3D Student (B21-B24)</a></li>
<li><a href="../221549/index.html">Parse.com reduces prices</a></li>
<li><a href="../221551/index.html">How to set up integration between Bugzilla and 3SL Cradle</a></li>
<li><a href="../221553/index.html">How to create and earn SaaS (Part 6 / Quickme story for partners or 7 reasons to do things together)</a></li>
<li><a href="../221555/index.html">"How much does Google Glass actually cost?"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>