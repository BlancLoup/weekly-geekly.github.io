<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search InterSystems documentation using iKnow and iFind technologies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="InterSystems Cach√© has built-in technology for working with iKnow unstructured data, as well as iFind full-text search technology. We decided to deal ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search InterSystems documentation using iKnow and iFind technologies</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/853/513/428/853513428f7b44e18a38cb5aea100fb6.png" alt="image"><br><br>  InterSystems Cach√© has built-in technology for working with iKnow unstructured data, as well as iFind full-text search technology.  We decided to deal with the technology and at the same time do something useful.  The result was DocSearch - Web application for searching <a href="http://docs.intersystems.com/">InterSystems documentation</a> using iKnow and iFind technologies. <br><a name="habracut"></a><br><h2>  How is the documentation in Cach√© </h2><br>  Cach√© documentation is based on <a href="http://docbook.org/">Docbook</a> technology.  A <a href="">web interface is</a> supplied for access to the documentation (including a search that does not use either iFind or iKnow).  Actually, the data of the documentation articles are in the Cach√© classes, which opens up the possibility to independently carry out queries to this data, and, accordingly, the opportunity to write your own search utility. <br><br><h2>  What is iKnow and iFind: </h2><br><p>  Intersystems iKnow is an unstructured data analysis tool that provides access to data by indexing the sentences and entities contained in the text.  To begin the analysis, it is necessary to create a domain - storage of unstructured data, and load text into it.  The process of creating a domain is well described <a href="https://habrahabr.ru/company/intersystems/blog/244697">here</a> and <a href="https://habrahabr.ru/company/intersystems/blog/246719/">here</a> .  About the main ways of using iKnow is written <a href="https://habrahabr.ru/company/intersystems/blog/308940/">here</a> , I would also recommend <a href="https://habrahabr.ru/company/intersystems/blog/243217/">this article</a> to you. </p><br><p>  The iFind technology is a Cach√© DBMS module for performing full-text search operations using data from Cach√© classes.  iFind uses many of the features of iKnow to provide intelligent text search.  To use iFind in queries, you need to define a special iFind index in the Cach√© class. </p><br><p>  There are three types of iFind indexes, each type of index provides all the functions of the previous type, plus additional functions: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </p><ul><li>  The main index (% iFind.Index.Basic): supports the search for words and phrases. </li><li>  Semantic index (% iFind.Index.Semantic): supports searching for iKnow objects. </li><li>  Analytical Index (% iFind.Index.Analytic): supports all functions of iKnow in the semantic index, as well as information about the path and proximity of words. </li></ul><br>  Since documentation classes are stored in a separate area, in order to make classes available in our area, the installer performs <a href="">mapping of</a> packages and globals. <br><br><div class="spoiler">  <b class="spoiler_title">Code for mapping in installer</b> <div class="spoiler_text"><pre><code class="xml hljs">XData Install [ XMLNamespace = INSTALLER ] { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Manifest</span></span></span><span class="hljs-tag">&gt;</span></span> //    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IfNotDef</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Var</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Namespace"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Var</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Namespace"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DOCSEARCH"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Log</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Set namespace to ${Namespace}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">IfNotDef</span></span></span><span class="hljs-tag">&gt;</span></span> //      <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">If</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'(##class(Config.Namespaces).Exists("${Namespace}")=1)'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Log</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Namespace ${Namespace} already exists"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">If</span></span></span><span class="hljs-tag">&gt;</span></span> //   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">If</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'(##class(Config.Namespaces).Exists("${Namespace}")=0)'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Log</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Creating namespace ${Namespace}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">/&gt;</span></span> //    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Namespace</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${Namespace}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Create</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"yes"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Code</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${Namespace}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Ensemble</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Data</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${Namespace}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Log</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Creating database ${Namespace}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">/&gt;</span></span> //         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Database</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${Namespace}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Dir</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${MGRDIR}/${Namespace}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Create</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"yes"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">MountRequired</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Resource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"%DB_${Namespace}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">PublicPermissions</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"RW"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">MountAtStartup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Log</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Mapping DOCBOOK to ${Namespace}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GlobalMapping</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Global</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Cache*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">From</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DOCBOOK"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Collation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GlobalMapping</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Global</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"D*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">From</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DOCBOOK"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Collation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">GlobalMapping</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Global</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"XML*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">From</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DOCBOOK"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Collation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ClassMapping</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DocBook"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">From</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DOCBOOK"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ClassMapping</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DocBook.UI"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">From</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DOCBOOK"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ClassMapping</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"csp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">From</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"DOCBOOK"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Log</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"End creating database ${Namespace}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Namespace</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Log</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"End creating namespace ${Namespace}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Level</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">If</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Manifest</span></span></span><span class="hljs-tag">&gt;</span></span> }</code> </pre> <br></div></div><br><p>  The domain that we need to work iKnow, built on the table containing the documentation.  Since the data source is a table, we will use SQL.Lister.  The content field contains the text of the documentation, so we specify it as a data field.  The remaining fields will be indicated in the metadata. </p><br><div class="spoiler">  <b class="spoiler_title">Installer Domain Creation Code</b> <div class="spoiler_text"><pre> <code class="hljs smalltalk"><span class="hljs-type"><span class="hljs-type">ClassMethod</span></span> <span class="hljs-type"><span class="hljs-type">Domain</span></span>(<span class="hljs-type"><span class="hljs-type">ByRef</span></span> pVars, pLogLevel <span class="hljs-type"><span class="hljs-type">As</span></span> %<span class="hljs-type"><span class="hljs-type">String</span></span>, tInstaller <span class="hljs-type"><span class="hljs-type">As</span></span> %<span class="hljs-type"><span class="hljs-type">Installer</span></span>.<span class="hljs-type"><span class="hljs-type">Installer</span></span>) <span class="hljs-type"><span class="hljs-type">As</span></span> %<span class="hljs-type"><span class="hljs-type">Status</span></span> { <span class="hljs-symbol"><span class="hljs-symbol">#Include</span></span> %<span class="hljs-type"><span class="hljs-type">IKInclude</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#Include</span></span> %<span class="hljs-type"><span class="hljs-type">IKPublic</span></span> set ns = <span class="hljs-string"><span class="hljs-string">$N</span></span>amespace znspace <span class="hljs-comment"><span class="hljs-comment">"DOCSEARCH"</span></span> //        set dname=<span class="hljs-comment"><span class="hljs-comment">"DocSearch"</span></span> if (#<span class="hljs-symbol"><span class="hljs-symbol">#class</span></span>(%iKnow.<span class="hljs-type"><span class="hljs-type">Domain</span></span>).<span class="hljs-type"><span class="hljs-type">Exists</span></span>(dname)=<span class="hljs-number"><span class="hljs-number">1</span></span>){ write <span class="hljs-comment"><span class="hljs-comment">"The "</span></span>,dname,<span class="hljs-comment"><span class="hljs-comment">" domain already exists"</span></span>,! zn ns quit } else { write <span class="hljs-comment"><span class="hljs-comment">"The "</span></span>,dname,<span class="hljs-comment"><span class="hljs-comment">" domain does not exist"</span></span>,! set domoref=#<span class="hljs-symbol"><span class="hljs-symbol">#class</span></span>(%iKnow.<span class="hljs-type"><span class="hljs-type">Domain</span></span>).%<span class="hljs-type"><span class="hljs-type">New</span></span>(dname) do domoref.%<span class="hljs-type"><span class="hljs-type">Save</span></span>() } set domId=domoref.<span class="hljs-type"><span class="hljs-type">Id</span></span> // <span class="hljs-type"><span class="hljs-type">Lister</span></span>    ,      set flister=#<span class="hljs-symbol"><span class="hljs-symbol">#class</span></span>(%iKnow.<span class="hljs-type"><span class="hljs-type">Source</span></span>.<span class="hljs-type"><span class="hljs-type">SQL</span></span>.<span class="hljs-type"><span class="hljs-type">Lister</span></span>).%<span class="hljs-type"><span class="hljs-type">New</span></span>(domId) set myloader=#<span class="hljs-symbol"><span class="hljs-symbol">#class</span></span>(%iKnow.<span class="hljs-type"><span class="hljs-type">Source</span></span>.<span class="hljs-type"><span class="hljs-type">Loader</span></span>).%<span class="hljs-type"><span class="hljs-type">New</span></span>(domId) //   set myquery=<span class="hljs-comment"><span class="hljs-comment">"SELECT id, docKey, title, bookKey, bookTitle, content, textKey FROM SQLUser.DocBook"</span></span> set idfld=<span class="hljs-comment"><span class="hljs-comment">"id"</span></span> set grpfld=<span class="hljs-comment"><span class="hljs-comment">"id"</span></span> //      set dataflds=<span class="hljs-string"><span class="hljs-string">$L</span></span>B(<span class="hljs-comment"><span class="hljs-comment">"content"</span></span>) set metaflds=<span class="hljs-string"><span class="hljs-string">$L</span></span>B(<span class="hljs-comment"><span class="hljs-comment">"docKey"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"title"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bookKey"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"bookTitle"</span></span>, <span class="hljs-comment"><span class="hljs-comment">"textKey"</span></span>) //    <span class="hljs-type"><span class="hljs-type">Lister</span></span> set stat=flister.<span class="hljs-type"><span class="hljs-type">AddListToBatch</span></span>(myquery,idfld,grpfld,dataflds,metaflds) if stat <span class="hljs-string"><span class="hljs-string">'= 1 {write "The lister failed: ",$System.Status.DisplayError(stat) quit } //   set stat=myloader.ProcessBatch() if stat '</span></span>= <span class="hljs-number"><span class="hljs-number">1</span></span> { quit } set numSrcD=#<span class="hljs-symbol"><span class="hljs-symbol">#class</span></span>(%iKnow.<span class="hljs-type"><span class="hljs-type">Queries</span></span>.<span class="hljs-type"><span class="hljs-type">SourceQAPI</span></span>).<span class="hljs-type"><span class="hljs-type">GetCountByDomain</span></span>(domId) write <span class="hljs-comment"><span class="hljs-comment">"Done"</span></span>,! write <span class="hljs-comment"><span class="hljs-comment">"Domain cointains "</span></span>,numSrcD,<span class="hljs-comment"><span class="hljs-comment">" source(s)"</span></span>,! zn ns quit }</code> </pre><br></div></div><br><p>  To search the documentation we use the index% iFind.Index.Analytic: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Index</span></span> contentInd <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> (content) <span class="hljs-keyword"><span class="hljs-keyword">As</span></span> %iFind.<span class="hljs-keyword"><span class="hljs-keyword">Index</span></span>.Analytic(<span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span> = "en", LOWER = <span class="hljs-number"><span class="hljs-number">1</span></span>, RANKERCLASS = "%iFind.Rank.Analytic");</code> </pre> <br>  Where contentInd is the index name, content is the name of the field for which we are creating the index. <br>  The LANGUAGE = "en" parameter specifies the language in which the text is written. <br>  LOWER = 1, sets case insensitivity <br>  The parameter RANKERCLASS = "% iFind.Rank.Analytic", allows you to use the algorithm for ranking the results of <a href="https://ru.wikipedia.org/wiki/TF-IDF">TF-IDF</a> <br><br><p>  After adding and building such an index, it can be used, for example, in SQL queries.  The general syntax for using iFind in SQL is: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> %<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> %FIND search_index(indexname,<span class="hljs-string"><span class="hljs-string">'search_items'</span></span>,search_option)</code> </pre> <br><p>  After creating the index% iFind.Index.Analytic with such parameters, several SQL procedures are generated - [Table name] _ [Index name] Procedure name </p><br>  In our project we use two of them: <br><br><ul><li>  DocBook_contentIndRank - Returns the result of the <a href="https://ru.wikipedia.org/wiki/TF-IDF">TF-IDF</a> ranking algorithm for the query. <br>  The syntax is: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> DocBook_contentIndRank(%<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>, <span class="hljs-string"><span class="hljs-string">'SearchString'</span></span>, <span class="hljs-string"><span class="hljs-string">'SearchOption'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> DocBook <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> %<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> %FIND search_index(contentInd,<span class="hljs-string"><span class="hljs-string">'SearchString'</span></span>, <span class="hljs-string"><span class="hljs-string">'SearchOption'</span></span>)</code> </pre> </li><li>  DocBook_contentIndHighlight - returns search results, where the search words are framed in the specified tag: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> DocBook_contentIndHighlight(%<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>, <span class="hljs-string"><span class="hljs-string">'SearchString'</span></span>, <span class="hljs-string"><span class="hljs-string">'SearchOption'</span></span>,<span class="hljs-string"><span class="hljs-string">'Tags'</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> DocBook <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> %<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> %FIND search_index(contentInd,<span class="hljs-string"><span class="hljs-string">'SearchString'</span></span>, <span class="hljs-string"><span class="hljs-string">'SearchOption'</span></span>)</code> </pre> </li></ul><br>  About the use of these procedures, I will tell you below. <br><br><h2>  What eventually happened: </h2><br><ol><li><h3>  Autocomplete in the search bar </h3><br><p>  When you enter text in the search bar, possible queries are suggested to help you quickly find the information you need.  These prompts are created based on the word (or the initial part of the word, if the word input is not completed) that you entered and the ten most similar words or phrases are displayed to the user. <br><br>  This process occurs using iKnow,% iKnow.Queries.Entity.GetSimilar method </p><br><img src="https://habrastorage.org/web/b7f/cb0/85a/b7fcb085ae814b56bacd01e1fda95a0a.JPG" alt="image"><br><br></li><li><h3>  Fuzzy search </h3><br><p>  Technology iFind supports fuzzy search, to find words that almost match the search string.  Implemented by comparing the <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D1%2581%25D1%2581%25D1%2582%25D0%25BE%25D1%258F%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%259B%25D0%25B5%25D0%25B2%25D0%25B5%25D0%25BD%25D1%2588%25D1%2582%25D0%25B5%25D0%25B9%25D0%25BD%25D0%25B0">Levenshtein distance</a> between two words.  The Levenshtein distance is the minimum number of one-character changes (insert, delete, or replace) needed to change one word to another.  It can be used to correct typos, small variations in writing, various grammatical forms (singular and plural). </p><br><p>  In iFind SQL queries, the search_option parameter is responsible for using fuzzy search. <br>  The value search_option = 3 means Levenshtein distances equal to two. <br><br>  To set the Levenshtein distance equal to n, you must specify the value search_option = '3: n' <br>  In the search for documentation, Levenshtein distance equal to one is used, we will demonstrate how it works: <br><br>  Type in the search word ifind: </p><br><img src="https://habrastorage.org/web/0f2/74c/63b/0f274c63b9394fdd845f8c1f68e9aacf.JPG" alt="image"><br><br><p>  Let's try to make a fuzzy search, for example, a word with a typo - ifindd.  As we can see, the search corrected a typo and found the necessary articles. </p><br><img src="https://habrastorage.org/web/7b4/4dc/a4d/7b44dca4ddf64c92b1aafb1ea280b814.JPG" alt="image"><br><br></li><li><h3>  Complex queries </h3><br><p>  Due to the fact that iFind supports complex queries using brackets and AND OR NOT operators, we implemented an advanced search.  In the search you can specify: a word, phrases, any of several words, or not containing some words.  Fields can be filled as one or several, and all at once. </p><br><p>  For example, find articles containing the word iknow, the phrase rest api and containing any of the words domain or UI. </p><br><img src="https://habrastorage.org/web/63e/763/9e3/63e7639e381d487e9f14caf89dd8a1d9.png" alt="image"><br><br><p>  We see that there are two such articles: </p><br><img src="https://habrastorage.org/web/e56/096/f21/e56096f21a9a47ada48ad56bd96686b0.png" alt="image"><br><br><p>  Note that the second article mentions Swagger UI, you can add to the query, search for articles that do not contain the word Swagger </p><br><img src="https://habrastorage.org/web/be4/277/000/be4277000fe34ea2a32b48c40c76dbaa.png" alt="image"><br><br><p>  As a result, only one article was found: </p><br><img src="https://habrastorage.org/web/a85/baa/69b/a85baa69b22845d0971378c801ec976e.png" alt="image"><br><br></li><li><h3>  Highlight Search Results </h3><br><p>  As mentioned above, using the iFind index creates the DocBook_contentIndHighlight procedure.  Using: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> DocBook_contentIndHighlight(%<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>, <span class="hljs-string"><span class="hljs-string">'search_items'</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;span class=""Illumination""&gt;'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> DocBook</code> </pre> <br><p>  We get the search text framed in a tag </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Illumination"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  This allows you to visually highlight search results on the frontend. </p><br><img src="https://habrastorage.org/web/52e/2c0/787/52e2c07871094ea792a49ecf15e530e1.JPG" alt="image"><br><br></li><li><h3>  Results Ranking Algorithm </h3><br><p>  iFind supports the ability to rank the results by the <a href="https://ru.wikipedia.org/wiki/TF-IDF">TF-IDF</a> algorithm.  The TF-IDF measure is often used in text analysis and information retrieval tasks, for example, as one of the criteria for the relevance of a document to a search query. </p><br><p>  As a result of the SQL query, the Rank field will contain the weight of the word, which is proportional to the number of words used in the article, and inversely proportional to the frequency of the use of the word in other articles. </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> DocBook_contentIndRank(%<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>, <span class="hljs-string"><span class="hljs-string">'SearchString'</span></span>, <span class="hljs-string"><span class="hljs-string">'SearchOption'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> DocBook <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> %<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> %FIND search_index(contentInd,<span class="hljs-string"><span class="hljs-string">'SearchString'</span></span>, <span class="hljs-string"><span class="hljs-string">'SearchOption'</span></span>)</code> </pre> <br></li><li><h3>  Integration with official documentation search </h3><br><p>  After installation, the button ‚ÄúSearch using iFind‚Äù is added to the official documentation search. </p><br><img src="https://habrastorage.org/web/08d/854/d39/08d854d392bc47c2a3f93fa92c8ff1f7.png" alt="image"><br><br><p>  If the Search words field is filled in, then after clicking on ‚ÄúSearch using iFind‚Äù, the system will go to the search results page for the entered query. </p><br>  If the field is empty, the new search page will be taken to the start page. <br></li></ol><br><h2>  Installation </h2><br><ol><li>  Download the installer.xml file from the latest release from the release page. </li><li>  Import the downloaded Installer.xml file into the% SYS area, compile. </li><li>  In the terminal in the% SYS area, enter the following command: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">do</span></span> #<span class="hljs-selector-id"><span class="hljs-selector-id">#class</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">Docsearch</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Installer</span></span>)<span class="hljs-selector-class"><span class="hljs-selector-class">.setup</span></span>(<span class="hljs-selector-class"><span class="hljs-selector-class">.pVars</span></span>)</code> </pre> <br>  The process takes about 15-30 minutes due to the process of building a domain. </li></ol><br>  After that, the search is available at <a href="http://localhost/">localhost</a> : [port] /csp/docsearch/index.html <br><br><h2>  Demo </h2><br>  An online search demo is available <a href="http://212.19.15.154:57773/csp/docsearch/index.html">here</a> . <br><br><h2>  Conclusion </h2><br>  This project demonstrates the interesting and useful features of iFind and iKnow technologies, thanks to which the search becomes more relevant. <br>  Criticism, comments, suggestions - are welcome. <br>  All source code with the installer and installation instructions posted on the <a href="https://github.com/intersystems-ru/iKnowDoc">github</a> </div><p>Source: <a href="https://habr.com/ru/post/333582/">https://habr.com/ru/post/333582/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333568/index.html">Selenium: simpler than steamed turnip ...</a></li>
<li><a href="../333572/index.html">MEGA is looking for ideas: a new season</a></li>
<li><a href="../333576/index.html">Blockchain: a revolution for which we are not ready</a></li>
<li><a href="../333578/index.html">When the trees were big: how a small data center experienced a hurricane</a></li>
<li><a href="../333580/index.html">npm link on steroids</a></li>
<li><a href="../333584/index.html">A collection of developer tools</a></li>
<li><a href="../333586/index.html">Bot for Telegram for 48 hours on Perl or how to buy cat food without leaving the chat</a></li>
<li><a href="../333588/index.html">Debugging the Android application using a browser</a></li>
<li><a href="../333590/index.html">Configuring the Apache CloudStack Failover Management Server using MariaDB Galera Replication</a></li>
<li><a href="../333592/index.html">Application of the principle of poka-yoke in programming using the example of PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>