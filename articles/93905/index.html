<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MODx and parser tags from another site</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably any programmer slash site administrator is faced with the problem of importing data from foreign sites. This task is very trivial, and does n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MODx and parser tags from another site</h1><div class="post__text post__text-html js-mediator-article">  Probably any programmer slash site administrator is faced with the problem of importing data from foreign sites.  This task is very trivial, and does not require any special knowledge ... the only question is in the wrapper.  To supplement the collection of articles on MODx I am writing this article, perhaps someone will come in handy. <br>  <u><b>Attention!</b></u>  <u>This record does not carry any practical value, only a theoretical load a la "A simple example of working with the back-end of MODx".</u> <br>  And the task was: <i>parse the table from the <a href="http://example.com/">example.com</a> page, re-register it and stick it onto the site.</i> <a name="habracut"></a><br><br><h4>  Five kopecks </h4><br>  Actually, we will use cURL, since for this purpose we will not find a better tool.  First of all, we will create two templates, <b>parserTplOuter</b> and <b>parserTplInner</b> - the wrapper and its ‚Äúinsides‚Äù, respectively.  Personally, I made a table, so in the example we will be guided by this, but no one forbids making divas with the given styles. <br><br>  <b>parserTplOuter</b> <br><blockquote><pre> <code class="hljs pgsql">&lt;<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>&gt; [+content+] &lt;/<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>&gt;</code> </pre></blockquote><br>  The wrapper was taken out separately specially so that it was possible to prescribe the appearance, the location of the elements or some other versatile pieces without coding the code.  Adhere to the MVC model is holy! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>parserTplInner</b> <br><blockquote><pre> &lt;tr&gt;
      &lt;td&gt; [+ 0 +] &lt;/ td&gt; &lt;td&gt; [+ 1 +] &lt;/ td&gt; &lt;td&gt; [+ 2 +] &lt;/ td&gt; &lt;td&gt; [+ 3 +] &lt;/ td&gt;
 &lt;/ tr&gt;
</pre></blockquote><br>  Here I would like to explain why I made numeric identifiers: first, the development simply did not require associative arrays :) and second, although there is a chance to get confused, it turns out that there is some standardization when it is very simple to add one more element to the ‚Äúrow‚Äù . <br><br>  Well, got the banks, let's fill them with juice and create a snippet, which we call <b>parser</b> : <br><br><blockquote><pre> &lt;? php

 if (empty ($ url)) return false;  // if the snippet does not give the address - complete the execution
 // here we need to do another bunch of checks on the validity of the URL, but we know that we will not write evil here 
 // And we will not give dunce to access;)

 $ tplInner = (empty ($ tplInner))?  'parserTplInner': $ tplInner;  // Set the default
 $ tplOuter = (empty ($ tplOuter))?  'parserTplOuter': $ tplOuter;  // chunks for snippet

 $ c = (empty ($ count) || (! is_numeric ($ count)))?  6: $ count;  // Make a certain restriction on the number of records
 $ c = ($ c&gt; 100)?  100: $ c;  // maximum number
 $ c = ($ c &lt;1)?  1: $ c;  // minimum number

 // initialization of the curl session
 $ ch = curl_init ();

 // set the URL and other required parameters
 curl_setopt ($ ch, CURLOPT_URL, $ url);
 curl_setopt ($ ch, CURLOPT_HEADER, 0);
 curl_setopt ($ ch, CURLOPT_TIMEOUT, 5);
 curl_setopt ($ ch, CURLOPT_RETURNTRANSFER, 1);

 // load the page and output it to a variable
 $ html = curl_exec ($ ch);

 // end session and release resources
 curl_close ($ ch);

 if (mb_strlen ($ html) &lt;100) {return '';} // if the answer is too short we exit the processing.
 // here you have to be careful, because the most diverse code can come back, but standard HTML frames add up to about 100 characters in total.

 $ pattern = "/ &lt;table (?: [^&gt;] +)&gt; ([\ s \ S] +) &lt;\ / table&gt; / i";  // this part will cut us all the tables from the site. 
 // theoretically, this template can be stuffed into a chunk and changed there, but as practice shows, all the same, the parsing will be more or less unique for each case, and it is easier to write your own based on the code than to adjust the parameters so that the result is correct ...

 preg_match ($ pattern, $ html, $ matches);
 unset ($ matches [0]);  // who does not remember - the entire found string is written to 0 element and we do not need it

 $ array = explode ('&lt;/ tr&gt;', $ matches [1]);  // here I went in a very tricky way and converted all the rows into array elements 

 $ separator = '| == |';  $ table = array ();  // prepared and ...

 foreach ($ array as &amp; $ value) {
   // (bydlokod in action) 
     $ value = str_replace ('&lt;/ td&gt; &lt;td', '&lt;/ td&gt;'. $ separator. '&lt;td', $ value);  // ... made a feint with ears :) 
     $ value = strip_tags ($ value);  // it was lazy to remove table tags regularly; it‚Äôs easier to separate cells with a service character set and ..
     $ table [] = explode ($ separator, $ value);  // ... split the remainder of strip_tags by this separator
 }

 $ i = 0;  // here it is worth noting that the 0th element is the table headings.  if they are not needed, then 1 and unset ($ table [0]) should be set;  prescribe
 $ rows = '';

 foreach ($ table as $ row) {  
 // well, now we run through each row 
   if ($ i ++&gt; $ c) break;  // check the record count
   $ rows. = $ modx-&gt; parseChunk ($ tplRow, $ row, '[+', '+]');  // write the series

 }

 echo $ modx-&gt; parseChunk ($ tplTable, array ('content' =&gt; $ rows), '[+', '+]');  // insert the series and display the result
 ?&gt;
</pre></blockquote><br>  Actually this is all that was required, now we insert it in the right place on the site: <br><pre> <code class="hljs lua"> <span class="hljs-string"><span class="hljs-string">[[parser?tplInner=`parserTplInner` &amp;tplOuter=`parserTplOuter` &amp;url=`http://example.com` &amp;count=`10`]]</span></span></code> </pre> <br>  and see the neat plate formed. <br><br>  Absolutely <i>THIS</i> script is not needed by anyone, but with a head and gray matter in it, it is very easy to adapt this snippet to your needs.  It is quite simple to change the template or the processing mechanism, instead of processing the table, to prescribe a diva cut - anyway, any parsing will understand that the target site has some kind of static structure.  And already guided by it, we get data for processing, and how to display them to solve the problem is a completely different headache. </div><p>Source: <a href="https://habr.com/ru/post/93905/">https://habr.com/ru/post/93905/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../93898/index.html">Amazon Web Services Offers Failover DBMS</a></li>
<li><a href="../93901/index.html">McHost moved to Holland</a></li>
<li><a href="../93902/index.html">The physics of the impossible: A scientific explanation of phasers, force fields, teleportation, and time travel</a></li>
<li><a href="../93903/index.html">Google is preparing to acquire the company Global IP Solutions</a></li>
<li><a href="../93904/index.html">Competition for developers on the bada platform</a></li>
<li><a href="../93909/index.html">Why does Google buy GIPS VoIP engine?</a></li>
<li><a href="../93911/index.html">Google Calendar update</a></li>
<li><a href="../93913/index.html">The secret life of the director ChronoPay</a></li>
<li><a href="../93915/index.html">The first beta version of the Lightspark flash player is presented.</a></li>
<li><a href="../93916/index.html">speedtest.net via C ++</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>