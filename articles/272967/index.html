<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Objective-C integration testing on the example of part of the RSS reader</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In previous articles I considered unit-tests, this time we will talk about integration tests. 
 So that the example did not come out too large, but al...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Objective-C integration testing on the example of part of the RSS reader</h1><div class="post__text post__text-html js-mediator-article">  In previous articles I considered unit-tests, this time we will talk about integration tests. <br>  So that the example did not come out too large, but also contained material, I decided to use the example of the <a href="https://ru.wikipedia.org/wiki/RSS">RSS</a> Reader part. <br>  A counterfeit response from the server will be considered to check the options for operation. <br>  Testing with CoreData will be considered. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/641/d82/f57/641d82f5758146f9b3ba355001ffe38e.jpg"></div><br><a name="habracut"></a><br><h3>  A few words of theory: </h3><br>  Unit tests - testing the operation of a single element in the system in isolation. <br>  Integration tests - test the work of the system together. <br><br>  If you are not familiar with XCT, then I wrote about it <a href="http://habrahabr.ru/post/258953/">here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will use <a href="http://habrahabr.ru/company/redmadrobot/blog/246551/">SOA (Service Oriented Architecture)</a> , where the main interaction logic will be concluded.  Actually services are the primary goals for testing. <br><br>  Also, a change was made in main.m to run tests regardless of the operation of the main target. <br><pre><code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> argc, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * argv[]) { <span class="hljs-keyword"><span class="hljs-keyword">@autoreleasepool</span></span> { Class appDelegateClass = (<span class="hljs-built_in"><span class="hljs-built_in">NSClassFromString</span></span>(<span class="hljs-string"><span class="hljs-string">@"XCTestCase"</span></span>) ? [RSTestingAppDelegate <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>] : [RSAppDelegate <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UIApplicationMain</span></span>(argc, argv, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">NSStringFromClass</span></span>(appDelegateClass)); } }</code> </pre> <br>  And the RSTestCase base class has been created for testing by including a convenient way to test asynchronous code. <br><div class="spoiler">  <b class="spoiler_title">How?</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^RSTestCaseAsync)(<span class="hljs-built_in"><span class="hljs-built_in">XCTestExpectation</span></span> *expectation); ... ... ... - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)asyncTest:(RSTestCaseAsync)async { [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> asyncTest:async timeout:<span class="hljs-number"><span class="hljs-number">5.0</span></span>]; } - (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)asyncTest:(RSTestCaseAsync)async timeout:(<span class="hljs-built_in"><span class="hljs-built_in">NSTimeInterval</span></span>)timeout { <span class="hljs-built_in"><span class="hljs-built_in">XCTestExpectation</span></span> *expectation = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> expectationWithDescription:<span class="hljs-string"><span class="hljs-string">@"block not call"</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">XCTAssertNotNil</span></span>(async, <span class="hljs-string"><span class="hljs-string">@"don't send async block!"</span></span>); async(expectation); [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> waitForExpectationsWithTimeout:timeout handler:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }</code> </pre></div></div><div class="spoiler">  <b class="spoiler_title">Unhandled exception in the setUp method</b> <div class="spoiler_text">  The main purpose of this class is to provide information about a fall inside the setUp method.  After all, this method is called before the execution of any test and the fall here means the failure of the subsequent test.  However, the method itself is not a test and the fall in it will not write an error in the table of tests.  Therefore, in this class there is a test testInitAfterSetUp.  This test will succeed and will be called (in random order) for each child class upon successful execution of the setUp method.  The failure of this test signals a fall inside the setUp method. <br></div></div><br>  Integration tests I store in the IT group, and classes with the end of IT. <br>  I store the unit tests in the Unit group, and the classes with the Test end. <br><br><h2>  Now take up the practice </h2><br>  Let's start with <a href="https://cocoapods.org/">CocoaPods</a> dependency <a href="https://cocoapods.org/">manager</a> <br><div class="spoiler">  <b class="spoiler_title">Podfile</b> <div class="spoiler_text">  platform: ios, '8.0' <br>  use_frameworks! <br><br>  pod 'AFNetworking', '~&gt; 2.5.4' <br>  pod 'XMLDictionary', '~&gt; 1.4' <br>  pod 'ReactiveCocoa', '~&gt; 2.5' <br>  pod 'BlocksKit', '~&gt; 2.2.5' <br>  pod 'MagicalRecord', '~&gt; 2.3.0' <br><br>  pod 'MWFeedParser / NSDate + InternetDateTime' <br><br>  target 'RSReaderTests' do <br>  pod 'OHHTTPStubs', '~&gt; 4.6.0' <br>  pod 'OCMock', '~&gt; 3.2' <br>  end <br></div></div><br>  Create an RSFeedServiceIT.m file and RSFeedServiceIT class to test the news feed service. <br><div class="spoiler">  <b class="spoiler_title">RSFeedServiceIT.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RSTestCase.h"</span></span></span><span class="hljs-meta"> @interface RSFeedServiceIT : RSTestCaseIT @end @implementation RSFeedServiceIT - (void)setUp { [super setUp]; // Put setup code here. This method is called before the invocation of each test method in the class. } - (void)tearDown { // Put teardown code here. This method is called after the invocation of each test method in the class. [super tearDown]; } @end</span></span></code> </pre><br></div></div><br>  We are interested in the following cases <br>  1) Get RSS <br>  2) Connection error <br>  3) Server not found <br><br>  And that 3 integration test. <br><div class="spoiler">  <b class="spoiler_title">And if you have your own server and all requests go to him?</b> <div class="spoiler_text">  If it is written for your server, then you can write 1 test for receiving RSS from the server and exclude from the testing list (but do you have to run with your hands - is everything fine after another feature on you or on the server?).  To do this, simply find the test in the list of tests and turn it off. <br><img src="https://habrastorage.org/files/cd0/44c/294/cd044c294a09492a80b458fa2578e20e.png"><br></div></div><br>  For our test class, we need 2 fields.  Tested service and url.  We will ask this before each test. <br><div class="spoiler">  <b class="spoiler_title">RSFeedServiceIT.m</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RSFeedServiceIT</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RSTestCaseIT</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RSFeedService</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">service</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> ... ... ... - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setUp</span></span></span><span class="hljs-class"> </span></span>{ [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> setUp]; <span class="hljs-comment"><span class="hljs-comment">// Put setup code here. This method is called before the invocation of each test method in the class. self.service = [RSFeedService sharedInstance]; self.url = @"http://images.apple.com/main/rss/hotnews/hotnews.rss"; }</span></span></code> </pre><br></div></div><br><h4>  Test1: Get RSS </h4><br>  OHHTTPStubs - allows you to fake a response to the request.  We say that for any request you need to output data from the rss_news.xml file, the Content-Type will be application / xml, and the response code is 200 (OK). <br>  When receiving the answer in the test, we check that the data came, and the service successfully processed the answer and issued 20 news items. <br>  Calling the failure block should result in a test error. <br><div class="spoiler">  <b class="spoiler_title">testFeedFromURL</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#pragma mark test - (void)testFeedFromURL { [self stubXmlFeed]; [self asyncTest:^(XCTestExpectation *expectation) { @weakify(self); [self.service feedFromStringUrl:self.url success:^(NSArray *itemNews) { @strongify(self); [expectation fulfill]; XCTAssertNotNil(itemNews); XCTAssertEqual([itemNews count], 20); } failure:^(NSError *error) { @strongify(self); [expectation fulfill]; XCTFail(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%@"</span></span></span><span class="hljs-meta">, error); }]; }]; } - (void)stubXmlFeed { [OHHTTPStubs stubRequestsPassingTest:^BOOL(NSURLRequest *request) { return YES; } withStubResponse:^OHHTTPStubsResponse*(NSURLRequest *request) { NSString *xmlFeed = OHPathForFile(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"rss_news.xml"</span></span></span><span class="hljs-meta">, [self class]); NSDictionary *headers = @{ @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Content-Type"</span></span></span><span class="hljs-meta"> : @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"application/xml"</span></span></span><span class="hljs-meta"> }; return [OHHTTPStubsResponse responseWithFileAtPath:xmlFeed statusCode:200 headers:headers]; }]; }</span></span></code> </pre><br></div></div><br>  Add to the parent class RSTestCaseIT (derived from RSTestCase) a method for resetting the stub installation to the request after each test. <br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)tearDown { [OHHTTPStubs removeAllStubs]; <span class="hljs-comment"><span class="hljs-comment">// Put teardown code here. This method is called after the invocation of each test method in the class. [super tearDown]; }</span></span></code> </pre><br>  Also add to RSTestCaseIT a method for generating an error on a network request. <br><div class="spoiler">  <b class="spoiler_title">stubHttpErrorDomain: code: userInfo</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)stubHttpErrorDomain:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)domain code:(<span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span>)code userInfo:(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *)userInfo { [OHHTTPStubs stubRequestsPassingTest:^<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">NSURLRequest</span></span> *request) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">YES</span></span>; } withStubResponse:^OHHTTPStubsResponse*(<span class="hljs-built_in"><span class="hljs-built_in">NSURLRequest</span></span> *request) { <span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> *error = [<span class="hljs-built_in"><span class="hljs-built_in">NSError</span></span> errorWithDomain:domain code:code userInfo:userInfo]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [OHHTTPStubsResponse responseWithError:error]; }]; }</code> </pre><br></div></div><br><h4>  Test2: Connection Error </h4><br>  The service should call the failure block, pass an error with the code NSURLErrorNotConnectedToInternet and the domain NSURLErrorDomain.  Calling the success block should result in a test error. <br><div class="spoiler">  <b class="spoiler_title">testFeedFromURLErrorInternet</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#pragma mark test - (void)testFeedFromURLErrorInternet { [self stubHttpErrorDomain:NSURLErrorDomain code:NSURLErrorNotConnectedToInternet userInfo:nil]; [self asyncTest:^(XCTestExpectation *expectation) { @weakify(self); [self.service feedFromStringUrl:self.url success:^(NSArray *itemNews) { @strongify(self); [expectation fulfill]; XCTFail(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"this is error"</span></span></span><span class="hljs-meta">); } failure:^(NSError *error) { @strongify(self); [expectation fulfill]; XCTAssertEqualObjects([error domain], NSURLErrorDomain); XCTAssertEqual([error code], NSURLErrorNotConnectedToInternet); }]; }]; }</span></span></code> </pre><br></div></div><br><h4>  Test3: Server not found </h4><br><div class="spoiler">  <b class="spoiler_title">testFeedFromURLErrorServerNotFound</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#pragma mark test - (void)testFeedFromURLErrorServerNotFound { [self stubHttpErrorDomain:NSURLErrorDomain code:NSURLErrorCannotFindHost userInfo:nil]; [self asyncTest:^(XCTestExpectation *expectation) { @weakify(self); [self.service feedFromStringUrl:self.url success:^(NSArray *itemNews) { @strongify(self); [expectation fulfill]; XCTFail(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"this is error"</span></span></span><span class="hljs-meta">); } failure:^(NSError *error) { @strongify(self); [expectation fulfill]; XCTAssertEqualObjects([error domain], NSURLErrorDomain); XCTAssertEqual([error code], NSURLErrorCannotFindHost); }]; }]; }</span></span></code> </pre><br></div></div><br>  As you can see, cases are not considered here when ulr is not passed when the method is called, or the block is not transferred, it looks exactly part of the system requirements. <br><br>  And now some code.  The code is simplified, namely - there is no dedicated transport level in order not to inflate the code. <br><div class="spoiler">  <b class="spoiler_title">RSFeedService</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface RSFeedService : NSObject + (instancetype)sharedInstance; - (void)feedFromStringUrl:(NSString *)url success:(RSItemsBlock)success failure:(RSErrorBlock)failure; @end</span></span></code> </pre><br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RSFeedService.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RSFeedParser.h"</span></span></span><span class="hljs-meta"> @interface RSFeedService () @property (strong, nonatomic) RSFeedParser *parser; @property (strong, nonatomic) AFHTTPRequestOperationManager *transportLayer; @end @implementation RSFeedService + (instancetype)sharedInstance { static dispatch_once_t onceToken; static RSFeedService *instance; dispatch_once(&amp;onceToken, ^{ instance = [[self alloc] init]; instance.parser = [RSFeedParser sharedInstance]; instance.transportLayer = [self createSimpleOperationManager]; }); return instance; } + (AFHTTPRequestOperationManager *)createSimpleOperationManager { AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager]; manager.responseSerializer = [[AFXMLParserResponseSerializer alloc] init]; manager.responseSerializer.acceptableContentTypes = [NSSet setWithArray:@[@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"application/xml"</span></span></span><span class="hljs-meta">, @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"text/xml"</span></span></span><span class="hljs-meta">,@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"application/rss+xml"</span></span></span><span class="hljs-meta">]]; return manager; } - (void)feedFromStringUrl:(NSString *)url success:(RSItemsBlock)success failure:(RSErrorBlock)failure { @weakify(self); [self.transportLayer GET:url parameters:nil success:^(AFHTTPRequestOperation *operation, id responseObject) { @strongify(self); NSDictionary *dom = [NSDictionary dictionaryWithXMLParser:responseObject]; NSArray *items = [self.parser itemFeed:dom]; success(items); } failure:^(AFHTTPRequestOperation *operation, NSError *error) { failure(error); }]; } @end</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">RSFeedParser</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface RSFeedParser : NSObject + (instancetype)sharedInstance; - (NSArray *)itemFeed:(NSDictionary *)dom; @end</span></span></code> </pre><br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RSFeedParser.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;MWFeedParser/NSDate+InternetDateTime.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RSFeedItem.h"</span></span></span><span class="hljs-meta"> NSString * const RSFeedParserChannel = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"channel"</span></span></span><span class="hljs-meta">; NSString * const RSFeedParserItem = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"item"</span></span></span><span class="hljs-meta">; NSString * const RSFeedParserTitle = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"title"</span></span></span><span class="hljs-meta">; NSString * const RSFeedParserPubDate = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"pubDate"</span></span></span><span class="hljs-meta">; NSString * const RSFeedParserDescription = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"description"</span></span></span><span class="hljs-meta">; NSString * const RSFeedParserLink = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"link"</span></span></span><span class="hljs-meta">; @implementation RSFeedParser + (instancetype)sharedInstance { static dispatch_once_t onceToken; static RSFeedParser *instance; dispatch_once(&amp;onceToken, ^{ instance = [[self alloc] init]; }); return instance; } - (NSArray *)itemFeed:(NSDictionary *)dom { NSDictionary *channel = dom[RSFeedParserChannel]; NSArray *items = channel[RSFeedParserItem]; return [items bk_map:^id(NSDictionary *item) { NSString *title = item[RSFeedParserTitle]; NSString *description = item[RSFeedParserDescription]; NSString *pubDateString = item[RSFeedParserPubDate]; NSString *linkString = item[RSFeedParserLink]; NSDate *pubDate = [NSDate dateFromInternetDateTimeString:pubDateString formatHint:DateFormatHintRFC822]; NSURL *link = [NSURL URLWithString:linkString]; return [RSFeedItem initWithTitle:title descriptionNews:description pubDate:pubDate link:link]; }]; } @end</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">RSFeedItem</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RSFeedItem</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">copy</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">readonly</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">copy</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">readonly</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">descriptionNews</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">readonly</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSDate</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pubDate</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">readonly</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSURL</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">link</span></span></span><span class="hljs-class">; + (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instancetype</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initWithTitle</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">descriptionNews</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">descriptionNews</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pubDate</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSDate</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pubDate</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">link</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSURL</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">link</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instancetype</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initWithTitle</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">descriptionNews</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">descriptionNews</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pubDate</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSDate</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pubDate</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">link</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSURL</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">link</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RSFeedItem.h"</span></span></span><span class="hljs-meta"> @interface RSFeedItem () @property (copy, nonatomic, readwrite) NSString *title; @property (copy, nonatomic, readwrite) NSString *descriptionNews; @property (strong, nonatomic, readwrite) NSDate *pubDate; @property (strong, nonatomic, readwrite) NSURL *link; @end @implementation RSFeedItem + (instancetype)initWithTitle:(NSString *)title descriptionNews:(NSString *)descriptionNews pubDate:(NSDate *)pubDate link:(NSURL *)link { return [[self alloc] initWithTitle:title descriptionNews:descriptionNews pubDate:pubDate link:link]; } - (instancetype)initWithTitle:(NSString *)title descriptionNews:(NSString *)descriptionNews pubDate:(NSDate *)pubDate link:(NSURL *)link { self = [super init]; if (self != nil) { self.title = title; self.descriptionNews = descriptionNews; self.pubDate = pubDate; self.link = link; } return self; } @end</span></span></code> </pre><br></div></div><br><br><h2>  And where is CoreData? </h2><br>  Now consider another part of the system - working with the list of RSS. <br>  1) Get a list of RSS <br>  2) Add RSS <br>  3) Delete RSS <br>  4) When you first start the application there are 2 RSS source. <br><br>  How do you like the last item?  And you need to test ... In fact, this is absolutely not difficult at all (thanks to <a href="http://ocmock.org/">OCMock</a> ). <br>  The remaining 3 points are much more interesting, here <a href="http://habrahabr.ru/post/215033/">ReactiveCocoa</a> will help us very well <br><br>  In the setUp method, we set the mode for MagicalRecord to 'in-memory', so we don‚Äôt have to worry about corrupting working data. <br>  We also do partial mocking for the 4th point. <br>  In the tearDown method, clean the MagicalRecord, and clean the partial mocking. <br><br><div class="spoiler">  <b class="spoiler_title">RSLinkServiceIT.m setUp / tearDown</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RSLinkServiceIT</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RSTestCaseIT</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RSLinkService</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">service</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mockUserDefaults</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RSLinkServiceIT</span></span></span><span class="hljs-class"> - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">setUp</span></span></span><span class="hljs-class"> </span></span>{ [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> setUp]; <span class="hljs-comment"><span class="hljs-comment">// Put setup code here. This method is called before the invocation of each test method in the class. [MagicalRecord setupCoreDataStackWithInMemoryStore]; self.service = [RSLinkService sharedInstance]; id userDefaults = [NSUserDefaults standardUserDefaults]; [userDefaults setBool:YES forKey:RSHasBeenAddStandardLink]; self.mockUserDefaults = OCMPartialMock(userDefaults); } - (void)tearDown { [MagicalRecord cleanUp]; [self.mockUserDefaults stopMocking]; // Put teardown code here. This method is called after the invocation of each test method in the class. [super tearDown]; }</span></span></code> </pre><br></div></div><br><h4>  Test to check item 4 </h4><br><div class="spoiler">  <b class="spoiler_title">testOnFirstRunHave2Link</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#pragma mark test - (void)testOnFirstRunHave2Link { OCMStub([self.mockUserDefaults boolForKey:RSHasBeenAddStandardLink]).andReturn(NO); [self asyncTest:^(XCTestExpectation *expectation) { @weakify(self); [self.service list:^(NSArray *items) { @strongify(self); [expectation fulfill]; XCTAssertEqual([items count], 2); } failure:^{ @strongify(self); [expectation fulfill]; XCTFail(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"error"</span></span></span><span class="hljs-meta">); }]; } timeout:0.1]; }</span></span></code> </pre><br></div></div><br>  And now the most interesting thing is checking add / delete / get RSS links. <br>  Check out how it all works together.  Add a couple of links, remove one and request a list of those that we have.  The service has an asynchronous interface (which makes it easier to connect the server if necessary), and the operations depend on each other.  Therefore, we will use ReactiveCocoa to work with such code. <br><div class="spoiler">  <b class="spoiler_title">testList</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#pragma mark test - (void)testList { [self asyncTest:^(XCTestExpectation *expectation) { [self asyncTestList:expectation]; } timeout:0.1]; } - (void)asyncTestList:(XCTestExpectation *)expectation { NSString *rss1 = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"http://news.rambler.ru/rss/scitech1/"</span></span></span><span class="hljs-meta">; NSString *rss2 = @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"http://news.rambler.ru/rss/scitech2/"</span></span></span><span class="hljs-meta">; RACSignal *signalAdd1 = [self createSignalAddRSS:rss1]; RACSignal *signalAdd2 = [self createSignalAddRSS:rss2]; RACSignal *signalRemove = [self createSignalRemove:rss1]; RACSignal *signalList = [self createSignalList]; [[[[signalAdd1 flattenMap:^RACStream *(id _) { return signalAdd2; }] flattenMap:^RACStream *(id _) { return signalRemove; }] flattenMap:^RACStream *(id _) { return signalList; }] subscribeNext:^(NSArray *items) { [expectation fulfill]; XCTAssertEqual([items count], 1); XCTAssertEqualObjects(items[0], rss2); } error:^(NSError *error) { [expectation fulfill]; XCTFail(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%@"</span></span></span><span class="hljs-meta">, error); }]; } - (RACSignal *)createSignalAddRSS:(NSString *)rss { @weakify(self); return [RACSignal createSignal:^RACDisposable *(id</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;RACSubscriber&gt;</span></span></span><span class="hljs-meta"> subscriber) { @strongify(self); [self.service add:rss success:^{ [subscriber sendNext:nil]; [subscriber sendCompleted]; } failure:^(NSError *error) { @strongify(self); XCTFail(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%@"</span></span></span><span class="hljs-meta">, error); }]; return nil; }]; } - (RACSignal *)createSignalRemove:(NSString *)rss { @weakify(self); return [RACSignal createSignal:^RACDisposable *(id</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;RACSubscriber&gt;</span></span></span><span class="hljs-meta"> subscriber) { @strongify(self); [self.service remove:rss success:^{ [subscriber sendNext:nil]; [subscriber sendCompleted]; } failure:^(NSError *error) { @strongify(self); XCTFail(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%@"</span></span></span><span class="hljs-meta">, error); }]; return nil; }]; } - (RACSignal *)createSignalList { @weakify(self); return [RACSignal createSignal:^RACDisposable *(id</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;RACSubscriber&gt;</span></span></span><span class="hljs-meta"> subscriber) { @strongify(self); [self.service list:^(NSArray *items) { [subscriber sendNext:items]; [subscriber sendCompleted]; } failure:^{ [subscriber sendError:nil]; [subscriber sendCompleted]; }]; return nil; }]; }</span></span></code> </pre><br></div></div><br><h4>  The rest of the code </h4><br><div class="spoiler">  <b class="spoiler_title">RSLinkService</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface RSLinkService : NSObject + (instancetype)sharedInstance; - (void)add:(NSString *)link success:(RSEmptyBlock)success failure:(RSErrorBlock)failure; - (void)list:(RSItemsBlock)callback failure:(RSEmptyBlock)failure; - (void)remove:(NSString *)link success:(RSEmptyBlock)success failure:(RSErrorBlock)failure; @end</span></span></code> </pre><br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RSLinkService.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RSLinkDAO.h"</span></span></span><span class="hljs-meta"> @interface RSLinkService () @property (strong, nonatomic) RSLinkDAO *dao; @end @implementation RSLinkService + (instancetype)sharedInstance { static dispatch_once_t onceToken; static RSLinkService *instance; dispatch_once(&amp;onceToken, ^{ instance = [[self alloc] init]; instance.dao = [RSLinkDAO sharedInstance]; }); return instance; } - (void)add:(NSString *)link success:(RSEmptyBlock)success failure:(RSErrorBlock)failure { [self.dao add:link]; success(); } - (void)list:(RSItemsBlock)callback failure:(RSEmptyBlock)failure { NSArray *list = [self.dao list]; callback(list); } - (void)remove:(NSString *)link success:(RSEmptyBlock)success failure:(RSErrorBlock)failure { [self.dao remove:link]; success(); } @end</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">RSLinkDAO</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface RSLinkDAO : NSObject + (instancetype)sharedInstance; - (void)add:(NSString *)link; - (NSArray *)list; - (void)remove:(NSString *)link; @end</span></span></code> </pre><br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RSLinkDAO.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RSLinkEntity.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;MagicalRecord/MagicalRecord.h&gt;</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"NSString+RS_RSS.h"</span></span></span><span class="hljs-meta"> @interface RSLinkDAO () @end @implementation RSLinkDAO + (instancetype)sharedInstance { static dispatch_once_t onceToken; static RSLinkDAO *instance; dispatch_once(&amp;onceToken, ^{ instance = [[self alloc] init]; }); return instance; } - (void)add:(NSString *)link { NSString *url = [link convertToBaseHttp]; RSLinkEntity *entity = [self linkToLinkEntity:url]; [entity.managedObjectContext MR_saveToPersistentStoreAndWait]; } - (NSArray *)list { NSUserDefaults *standardUserDefaults = [NSUserDefaults standardUserDefaults]; if (![standardUserDefaults boolForKey:RSHasBeenAddStandardLink]) { [self addStandartLink]; [standardUserDefaults setBool:YES forKey:RSHasBeenAddStandardLink]; [standardUserDefaults synchronize]; } NSArray *all = [RSLinkEntity MR_findAll]; return [self linkEntityToLink:all]; } - (void)addStandartLink { RSLinkEntity *entity = [self linkToLinkEntity:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"http://developer.apple.com/news/rss/news.rss"</span></span></span><span class="hljs-meta">]; [entity.managedObjectContext MR_saveToPersistentStoreAndWait]; RSLinkEntity *entity1 = [self linkToLinkEntity:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"http://news.rambler.ru/rss/world"</span></span></span><span class="hljs-meta">]; [entity1.managedObjectContext MR_saveToPersistentStoreAndWait]; } - (void)remove:(NSString *)link { RSLinkEntity *entity = [self entityWithLink:link]; [entity MR_deleteEntity]; [entity.managedObjectContext MR_saveToPersistentStoreAndWait]; } #pragma mark - convert - (NSArray *)linkEntityToLink:(NSArray *)entitys { return [entitys bk_map:^id(RSLinkEntity *entity) { return entity.link; }]; } - (RSLinkEntity *)linkToLinkEntity:(NSString *)link { RSLinkEntity *entity = [RSLinkEntity MR_createEntity]; entity.link = link; return entity; } - (RSLinkEntity *)entityWithLink:(NSString *)link { return [RSLinkEntity MR_findFirstByAttribute:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"link"</span></span></span><span class="hljs-meta"> withValue:link]; } @end</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">NSString + RS_RSS</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface NSString (RS_RSS) - (instancetype)convertToBaseHttp; @end</span></span></code> </pre><br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"NSString+RS_RSS.h"</span></span></span><span class="hljs-meta"> @implementation NSString (RS_RSS) - (instancetype)convertToBaseHttp { NSRange rangeHttp = [self rangeOfString:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"http://"</span></span></span><span class="hljs-meta">]; NSRange rangeHttps = [self rangeOfString:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"https://"</span></span></span><span class="hljs-meta">]; if (rangeHttp.location != NSNotFound || rangeHttps.location != NSNotFound) { return self; } return [NSString stringWithFormat:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"http://%@"</span></span></span><span class="hljs-meta">, self]; } @end</span></span></code> </pre><br></div></div><br><br>  As already mentioned, I tried to remove the extra code in order to focus on the tests. <br>  Integration tests will verify that your system parts are correctly linked. <br>  Sources <a href="https://bitbucket.org/ajjnix/integrationtests">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/272967/">https://habr.com/ru/post/272967/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272943/index.html">December 12 at 12:00 (MSK), see Community DevCamp online</a></li>
<li><a href="../272945/index.html">Little Secrets of a Large Call Center: Predictive Calling</a></li>
<li><a href="../272947/index.html">We test p2p video for overload</a></li>
<li><a href="../272963/index.html">Web Standards Days live from 10:00 today</a></li>
<li><a href="../272965/index.html">About open data, projects based on them, and what happens with open government data in Russia</a></li>
<li><a href="../272969/index.html">Persuasive web design</a></li>
<li><a href="../272971/index.html">Why do we need plain-text letters, and how they should be done: 6 tips</a></li>
<li><a href="../272983/index.html">Writing code for Node.js in the state machine style</a></li>
<li><a href="../272987/index.html">Conflict-Free Replication: CRDT in Theory and Practice</a></li>
<li><a href="../272989/index.html">Screenshot game - the hard way</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>