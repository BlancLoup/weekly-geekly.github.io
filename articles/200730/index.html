<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SDL 2.0 Lesson Cycle: Lesson 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: the continuation of the Twinklebear tutorials series, originally available here . Previous lesson can be found here . 

 Today we...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SDL 2.0 Lesson Cycle: Lesson 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f5d/0d7/06a/f5d0d706a7ba63af9b903584ea96e187.png"><br>  <i>From the translator: the continuation of the Twinklebear tutorials series, originally available <a href="http://twinklebeardev.blogspot.ru/p/sdl-20-tutorial-index.html">here</a> .</i>  <i>Previous lesson can be found <a href="http://habrahabr.ru/post/198600/">here</a> .</i> <br><br>  Today we will start refactoring the code from the last lesson, adding some very useful functions, and also analyze how the images are positioned and scaled in SDL_Window. <a name="habracut"></a><br><br>  As usual, we will start the program with the inclusion of SDL.  Also in this lesson we will use the class string, so we will connect it as well. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SDL.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;string&gt; const int SCREEN_WIDTH = 640; const int SCREEN_HEIGHT = 480; SDL_Window *window = nullptr; SDL_Renderer *renderer = nullptr;</span></span></span></span></code> </pre> <br>  We will also declare a couple of constant values ‚Äã‚Äãfor the width and height of the screen, together with the global window and renderer declarations, so that they are accessible from our functions.  Again we initialize the pointers as nullptr for security.  If you are not using C ++ 11, initialize them as NULL. <br><br>  <i>Note: You should try to avoid using non-constant global values, or global values ‚Äã‚Äãin general, that is, you should never declare a global SDL_Window or SDL_Renderer.</i>  <i>However, for this simple lesson we will still use them.</i>  <i>We will cover the application of global objects through several lessons.</i> <br><br>  Remember how we in the first lesson loaded texture?  It‚Äôs not so bad to load one texture into main, but imagine if there were a couple of hundred?  We would have to print the same piece of code every time!  It is much better to declare a function for loading textures by file name: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">SDL_Texture* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> file)</span></span></span></span>{ SDL_Surface *loadedImage = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; SDL_Texture *texture = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; loadedImage = SDL_LoadBMP(file.c_str()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (loadedImage != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>){ texture = SDL_CreateTextureFromSurface(renderer, loadedImage); SDL_FreeSurface(loadedImage); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; SDL_GetError() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> texture; }</code> </pre><br>  This function should look very familiar, because this is the same code that we wrote in the first lesson, but now it is combined into a good function.  With its help, we can pass the file name as a line and get a pointer to the loaded texture.  Note that the pointer will be nullptr if the download fails. <br><br>  Next, we want to write a function to simplify drawing.  Also, this function will allow you to specify the position of the image on the screen.  It will take x and y coordinates, texture pointers and renderer and draw a texture at the specified point. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ApplySurface</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, SDL_Texture *tex, SDL_Renderer *rend)</span></span></span></span>{ SDL_Rect pos; pos.x = x; pos.y = y; SDL_QueryTexture(tex, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, &amp;pos.w, &amp;pos.h); SDL_RenderCopy(rend, tex, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, &amp;pos); }</code> </pre><br>  To indicate where the texture will be drawn, we need to create an SDL_Rect, the address of which we will pass to SDL_RenderCopy as a parameter of the target rectangle. <br><br>  In order to create our rectangle, we take the x and y that were passed, and assign the corresponding values ‚Äã‚Äãto the corresponding rectangle values.  However, we also need to specify the width and height, because SDL 2.0 allows us to scale the texture.  Try playing around with the width and height values ‚Äã‚Äãand see what happens! <br><br>  Now we just pass the width and height of the texture to draw it on a 1: 1 scale.  We can get these values ‚Äã‚Äãusing the SDL_QueryTexture function.  It takes a pointer to the texture, the next two parameters we specify as NULL (these parameters are responsible for the format and level of access that we do not need).  Finally, we need to pass the addresses of the variables that the function will fill with the width and height of the texture. <br><br>  Now that we have received the initialized SDL_Rect, we can transfer it to SDL_RenderCopy so that the texture is drawn at the point we need with the original height and width.  The remaining NULL parameter passed to this function is responsible for cutting out a fragment of the original texture.  We will analyze its use later. <br><br>  Let's see our functions in action.  First of all, run the SDL and create a window and renderer like last time.  But we have something new here, namely SDL_WINDOWPOS_CENTERED.  This option allows when creating a window to center it on a specific axis, in this case we use centering the window on both x and y. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">** argv)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (SDL_Init(SDL_INIT_EVERYTHING) == <span class="hljs-number"><span class="hljs-number">-1</span></span>){ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; SDL_GetError() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } window = SDL_CreateWindow(<span class="hljs-string"><span class="hljs-string">"Lesson 2"</span></span>, SDL_WINDOWPOS_CENTERED, SDL_WINDOWPOS_CENTERED, SCREEN_WIDTH, SCREEN_HEIGHT, SDL_WINDOW_SHOWN); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (window == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>){ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; SDL_GetError() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; } renderer = SDL_CreateRenderer(window, <span class="hljs-number"><span class="hljs-number">-1</span></span>, SDL_RENDERER_ACCELERATED | SDL_RENDERER_PRESENTVSYNC); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (renderer == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>){ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; SDL_GetError() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>; }</code> </pre><br>  Let's upload our pictures.  For this tutorial, we will draw a background image, tiled, and a second image centered over the background. <br>  Here is our background: <br><img src="https://github.com/Twinklebear/TwinklebearDev-Lessons/raw/master/res/Lesson2/background.bmp" alt="image"><br><br>  And this will be on top of the background: <br><img src="https://github.com/Twinklebear/TwinklebearDev-Lessons/raw/master/res/Lesson2/image.bmp" alt="image"><br><br>  Let's load them using the LoadImage function we just wrote. <br><br><pre> <code class="cpp hljs"> SDL_Texture *background = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>, *image = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; background = LoadImage(<span class="hljs-string"><span class="hljs-string">"Lesson2res/background.bmp"</span></span>); image = LoadImage(<span class="hljs-string"><span class="hljs-string">"Lesson2res/image.bmp"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (background == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span> || image == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>;</code> </pre><br>  Note that you need to change the paths to the images so that they match the paths on your system. <br><br>  Before we draw pictures, we need to know where we want to place them.  To begin with, it is necessary to understand how the SDL coordinate system works, since it differs slightly from the standard 2D Cartesian coordinate system.  The SDL coordinate system looks like this: <br><img src="http://habrastorage.org/storage3/21c/e56/7c2/21ce567c2de2367c78fe6bc1ff4cb928.png" alt="image"><br><br>  Point (0,0) is located in the upper left corner of the screen.  Y values ‚Äã‚Äãincrease as the screen moves down, and X values ‚Äã‚Äãto the right.  It should also be noted that the point we transmit when drawing the image indicates the upper left corner of the image, unlike the center, as in some other libraries. <br><br>  Before we draw: remember that what we draw will be located under the subsequent images.  Thus, the picture drawn in the first place will be under all, and in the last - over all. <br><br>  Probably, you have already noticed that our background image has a resolution of 320x240, which means we have to draw it four times to tile the entire screen. <br><br>  Before we draw anything, we will clear the screen, then we will position the elements.  In order to get the width and height of the texture, we again use the QueryTexture function.  Of course, you can use a loop to draw the background, but in this case we will use the blunt method and just write the same text 4 times. <br><br><pre> <code class="cpp hljs"> SDL_RenderClear(renderer); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bW, bH; SDL_QueryTexture(background, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, &amp;bW, &amp;bH); ApplySurface(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, background, renderer); ApplySurface(bW, <span class="hljs-number"><span class="hljs-number">0</span></span>, background, renderer); ApplySurface(<span class="hljs-number"><span class="hljs-number">0</span></span>, bH, background, renderer); ApplySurface(bW, bH, background, renderer);</code> </pre><br>  Now we will draw an image that will be placed on top of the background and in the center of the screen.  Calculate the center point is extremely simple, because the point that we pass to the ApplySurface function is the coordinate of the upper left corner of the image.  Therefore, we need to add an offset so that the center of the image coincides with the center of the screen. <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iW, iH; SDL_QueryTexture(image, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, &amp;iW, &amp;iH); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = SCREEN_WIDTH / <span class="hljs-number"><span class="hljs-number">2</span></span> - iW / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = SCREEN_HEIGHT / <span class="hljs-number"><span class="hljs-number">2</span></span> - iH / <span class="hljs-number"><span class="hljs-number">2</span></span>; ApplySurface(x, y, image, renderer);</code> </pre><br>  In order to see the drawn, we need to show the renderer, and then wait a few seconds to see the result. <br><br><pre> <code class="cpp hljs"> SDL_RenderPresent(renderer); SDL_Delay(<span class="hljs-number"><span class="hljs-number">2000</span></span>);</code> </pre><br>  Finally, we will complete the program by freeing the occupied memory, exiting the SDL and returning 0. <br><br><pre> <code class="cpp hljs"> SDL_DestroyTexture(background); SDL_DestroyTexture(image); SDL_DestroyRenderer(renderer); SDL_DestroyWindow(window); SDL_Quit(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br>  When you compile and run the program, the window should look like this: <br><img src="http://habrastorage.org/storage3/d52/2d0/8c6/d522d08c65ada402ce44d402e2fe24bd.png" alt="image"><br><br><h5>  End of the lesson </h5><br>  Today's lesson has come to its end.  See you in lesson 3: external SDL libraries for everyone. </div><p>Source: <a href="https://habr.com/ru/post/200730/">https://habr.com/ru/post/200730/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200710/index.html">Wrestlers against ‚Äúpiracy‚Äù RIAA and BPI violated the copyright of the creators of popular jQuery scripts</a></li>
<li><a href="../200718/index.html">Content Extractor from Web Documents</a></li>
<li><a href="../200720/index.html">We write single-page web application framework in 60 lines of code</a></li>
<li><a href="../200726/index.html">Education Passport instead of a higher education diploma. Prototype from MyEducationPath.com</a></li>
<li><a href="../200728/index.html">How I made friends with the Quickbooks and PHP site using the Web Connector</a></li>
<li><a href="../200734/index.html">Growth Hacking: how to "crack" the problem of growth?</a></li>
<li><a href="../200736/index.html">Compaq LTE Lite</a></li>
<li><a href="../200740/index.html">What is "project efficiency" for IT person</a></li>
<li><a href="../200744/index.html">Caching in Windows Azure</a></li>
<li><a href="../200746/index.html">Designer, Architect and Developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>