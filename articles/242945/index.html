<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Contract Interfaces & Inheritance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Let's talk about the dark side of the force, namely, the problems in using contracts. About those cute little things that are carefully managed by lib...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Contract Interfaces & Inheritance</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/8c1/f5a/8bb/8c1f5a8bbe814e8bb06036b6753bb78c.jpg"><br><br>  Let's talk about the dark side of the force, namely, the problems in using contracts.  About those cute little things that are carefully managed by library developers and bring such a rather big barrel of tar into a tiny honey pot. <br><br><a name="habracut"></a><br>  <b>Introduction.</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We assume that we have read the classic document on MS Contracts, so we will immediately move on to such a handy thing as the specification of interfaces for contract programming. <br><br>  <a href="http://research.microsoft.com/en-us/projects/contracts/">http://research.microsoft.com/en-us/projects/contracts/</a> <br>  <a href="http://download.microsoft.com/download/C/2/7/C2715F76-F56C-4D37-9231-EF8076B7EC13/userdoc.pdf">http://download.microsoft.com/download/C/2/7/C2715F76-F56C-4D37-9231-EF8076B7EC13/userdoc.pdf</a> <br><br>  If we have several public fields or methods, then once having set the specification for these parameters within the interface, we will be able to use a similar contract for real classes without additional scribbling.  Having described the contract, you can then use it as a convenient magic wand. <br><br>  For example, we create a representative of the other side: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TheDarkLord</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SoName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TheDarkLord</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> soName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SoName = soName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ModifyBaseName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> updatedName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name = updatedName; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name; } }</code> </pre> <br><br>  It is possible that for the sake of future dark padovanov you will need to use the described class as a base class.  And, in order not to burden ourselves with unnecessary checks, we will set the specification for the public section, and also complement the check and private at the same time. <br><br>  a) describe the interface <br>  b) let's not forget to create an abstract implementation for it, which will incorporate the contract specification <br>  c) and expand the main class with support for checking the private section <br><br>  Implementation: <br><br>  a) interface and reference to contract implementation <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">ContractClass(typeof(ITheDarkLordContract))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ITheDarkLord</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ModifyBaseName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> updatedName</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre><br><br>  b) contract specification <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">ContractClassFor(typeof(ITheDarkLord))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ITheDarkLordContract</span></span> : <span class="hljs-title"><span class="hljs-title">ITheDarkLord</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { Contract.Ensures(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(Contract.Result&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;()), <span class="hljs-string"><span class="hljs-string">"[ITheDarkLordContract] Name of Dark Lord is null or empty."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { Contract.Requires&lt;ArgumentNullException&gt;(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>), <span class="hljs-string"><span class="hljs-string">"[ITheDarkLordContract] Name of Dark Lord is null or empty."</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ModifyBaseName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> updatedName</span></span></span><span class="hljs-function">)</span></span> { Contract.Requires&lt;ArgumentNullException&gt;(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(updatedName), <span class="hljs-string"><span class="hljs-string">"[ITheDarkLordContract.ModifyBaseName] The new name of Dark Lord is null or empty."</span></span>); Contract.Ensures(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(Contract.Result&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;()), <span class="hljs-string"><span class="hljs-string">"[ITheDarkLordContract.ModifyBaseName] The updated name of Dark Lord is null or empty."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>); } }</code> </pre><br><br>  c) a modified key class to which we hooked the interface and check private <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TheDarkLord</span></span> : <span class="hljs-title"><span class="hljs-title">ITheDarkLord</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SoName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [ContractInvariantMethod] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DarkLordVerification</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Contract.Invariant(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(SoName)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TheDarkLord</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> soName</span></span></span><span class="hljs-function">)</span></span> { Contract.Requires&lt;ArgumentException&gt;(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(name)); Contract.Requires&lt;ArgumentException&gt;(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(soName)); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SoName = soName; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ModifyBaseName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> updatedName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name = updatedName; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name; } }</code> </pre><br><br>  <b>The plot intrigue</b> , which is the most unexpected ... <br><br>  Everything we had was good up to this point.  And then we did step number two - we used the described class as a derivative for: <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">ContractClass(typeof(ITheWhiteLordContract))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ITheWhiteLord</span></span> : <span class="hljs-title"><span class="hljs-title">ITheDarkLord</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateAllNames</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> soName</span></span></span><span class="hljs-function">)</span></span>; } [ContractClassFor(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ITheWhiteLord))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ITheWhiteLordContract</span></span> : <span class="hljs-title"><span class="hljs-title">ITheDarkLordContract</span></span>, <span class="hljs-title"><span class="hljs-title">ITheWhiteLord</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateAllNames</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> soName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>); } }</code> </pre><br><br>  It seems everything is beautiful - created a successor for the interface, refined a new abstract class and tried to compile.  After that, quite unexpectedly, they stepped on the limitation of the number of times for the library of contracts: we cannot inherit contract classes from anyone other than Object ... Clap - and the concept of inheritance for contract interfaces collapsed ... <br><br>  Well, what do the developers recommend us?  And they do it in a fantastic way: ‚Äútake an abstract class, write in it the specification of the ancestor's methods‚Äù ... <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">ContractClass(typeof(ITheWhiteLordContract))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ITheWhiteLord</span></span> : <span class="hljs-title"><span class="hljs-title">ITheDarkLord</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateAllNames</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> soName</span></span></span><span class="hljs-function">)</span></span>; } [ContractClassFor(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ITheWhiteLord))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ITheWhiteLordContract</span></span> : <span class="hljs-title"><span class="hljs-title">ITheWhiteLord</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ModifyBaseName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> updatedName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateAllNames</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> soName</span></span></span><span class="hljs-function">)</span></span> { Contract.Requires&lt;ArgumentNullException&gt;(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(name), <span class="hljs-string"><span class="hljs-string">"[ITheWhiteLordContract.UpdateAllNames] The new name of White Lord is null or empty."</span></span>); Contract.Requires&lt;ArgumentNullException&gt;(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(name), <span class="hljs-string"><span class="hljs-string">"[ITheWhiteLordContract.UpdateAllNames] The new soname of White Lord is null or empty."</span></span>); Contract.Ensures(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(Contract.Result&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;()), <span class="hljs-string"><span class="hljs-string">"[ITheWhiteLordContract.UpdateAllNames] The updated name of White Lord is null or empty."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>); } }</code> </pre><br><br>  Now imagine that in the base class we have 10-20 fields, which will have to be ‚Äúdragged‚Äù up.  A hierarchy may not be from one layer, but be inherited through a group of classes.  And after that, the proposed recommendation is akin to mockery. <br><br>  What did you get? <br><br>  Options using interfaces, like points for future Injections, already work poorly.  We'll have to remove inheritance in the contract interfaces and describe the calls of the objects we need as real classes. <br><br>  a) we specify the contract for the descendant <br><br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">ContractClass(typeof(ITheWhiteLordContract))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ITheWhiteLord</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateAllNames</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> soName</span></span></span><span class="hljs-function">)</span></span>; } [ContractClassFor(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ITheWhiteLord))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ITheWhiteLordContract</span></span> : <span class="hljs-title"><span class="hljs-title">ITheWhiteLord</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateAllNames</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> soName</span></span></span><span class="hljs-function">)</span></span> { Contract.Requires&lt;ArgumentNullException&gt;(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(name), <span class="hljs-string"><span class="hljs-string">"[ITheWhiteLordContract.UpdateAllNames] The new name of White Lord is null or empty."</span></span>); Contract.Requires&lt;ArgumentNullException&gt;(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(name), <span class="hljs-string"><span class="hljs-string">"[ITheWhiteLordContract.UpdateAllNames] The new soname of White Lord is null or empty."</span></span>); Contract.Ensures(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(Contract.Result&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;()), <span class="hljs-string"><span class="hljs-string">"[ITheWhiteLordContract.UpdateAllNames] The updated name of White Lord is null or empty."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>); } }</code> </pre><br><br>  b) change the inheritance for the real class <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TheWhiteLord</span></span> : <span class="hljs-title"><span class="hljs-title">TheDarkLord</span></span>, <span class="hljs-title"><span class="hljs-title">ITheWhiteLord</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateAllNames</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> soName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Name; } }</code> </pre><br><br>  And now instead of using interfaces, we will use access to the specification of classes: <br><br>  It was <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SpaceSheep</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ITheDarkLord AbstractLord { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br><br>  implementation as a class <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SpaceSheep</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TheDarkLord AbstractLord { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br><br>  In terms of system performance, we have not lost anything.  If we have a TheWhiteLord class, then it is easy to inherit from the dark side, gaining access to the necessary properties.  At the same time, the performance of the used frameworks operating on IOC will not change.  In fact, to specify dependencies, we can operate with any implementation ‚Äî interfaces, abstract classes, or real ones. <br><br>  But the sediment remained.  Who prevented the creators of Contracts.Library to give us the opportunity to operate with interfaces not only to test acceptable public properties, but also to build a holistic inheritance architecture.  Alas‚Ä¶ <br><br>  <b>For a snack.</b> <br><br>  Another minor inconvenience, which is desirable to remember.  Specialization of private properties through ContractInvariantMethod imposes a small limitation.  Fields that are analyzed in invariant methods must be specified in the constructor.  Here is our class: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TheDarkLord</span></span> : <span class="hljs-title"><span class="hljs-title">ITheDarkLord</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> SoName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [ContractInvariantMethod] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DarkLordVerification</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Contract.Invariant(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(SoName)); } ... }</code> </pre><br><br>  Here is a sample of its creation: <br><br><pre> <code class="cs hljs"> TheDarkLord lord = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TheDarkLord(<span class="hljs-string"><span class="hljs-string">"James"</span></span>, <span class="hljs-string"><span class="hljs-string">"Bond"</span></span>);</code> </pre><br><br>  If we add an empty default constructor, we get a warning.  Because the invariant method after exiting the constructor will check the conditions and return Exception: <br><br><pre> <code class="cs hljs"> CodeContracts: invariant <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>: !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(SoName)</code> </pre><br><br>  And a fairly convenient way to initialize class properties through a ‚Äúdeferred‚Äù assignment will not work: <br><br><pre> <code class="cs hljs"> TheDarkLord secondLord = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TheDarkLord() { Name = <span class="hljs-string"><span class="hljs-string">"James"</span></span> };</code> </pre><br><br>  You can rewrite the private property through an additional variable and validation using contracts, discarding invariants, but this will increase the amount of code and make it impossible to use the powerful enough convenient post-condition verification tool ... <br><br>  <b>Ps</b> .  About the messages displayed by contracts I do not even stutter.  It would Seem - who prevents to add the processor of dismantling of a call stack and name generation automatically.  But - the creators are allowed to use only static strings, making it impossible for us to replace this kind of code. <br><br><pre> <code class="cs hljs"> Contract.Requires&lt;ArgumentNullException&gt;(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(name), <span class="hljs-string"><span class="hljs-string">"[ITheWhiteLordContract.UpdateAllNames] The new name of White Lord is null or empty."</span></span>);</code> </pre><br><br>  on something similar to <br><br><pre> <code class="cs hljs"> Contract.Requires&lt;ArgumentNullException&gt;(!<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(name), <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"{0} The new name of White Lord is null or empty."</span></span>,GetCurrentMethod()));</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/242945/">https://habr.com/ru/post/242945/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242931/index.html">Alternative bug classification</a></li>
<li><a href="../242933/index.html">CERN plans to increase its computing capacity to 150,000 cores</a></li>
<li><a href="../242937/index.html">Windows Forms & Invoke from parallel threads</a></li>
<li><a href="../242939/index.html">Liskov Substitution Principle & Contracts</a></li>
<li><a href="../242943/index.html">Meteor. Developing a TODO List</a></li>
<li><a href="../242947/index.html">Arachnidium self-made framework for testing web and mobile applications. Get started!</a></li>
<li><a href="../242949/index.html">We broadcast sound over the network using Java</a></li>
<li><a href="../242951/index.html">Who subscribed to Habrahabr?</a></li>
<li><a href="../242953/index.html">How and why "break" online shopping</a></li>
<li><a href="../242955/index.html">Dino Esposito to speak at .NEXT in Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>