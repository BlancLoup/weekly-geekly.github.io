<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Features of uploading files to HTML5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After some experience, I decided to write a small article-cheat sheet on uploading files using HTML5 features, namely File API. 

 Read on: 


1. Brow...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Features of uploading files to HTML5</h1><div class="post__text post__text-html js-mediator-article">  After some experience, I decided to write a small article-cheat sheet on uploading files using HTML5 features, namely File API. <br><br>  Read on: <br><ol><li>  Browser support. </li><li>  Download via Form Data. </li><li>  Download via File Reader. </li></ol><br><a name="habracut"></a><br><h4>  1. Browser support </h4><br>  Of course, not all browsers currently fully support this feature.  We safely forget about IE, as it will only support File API in version 10.  With the other, more advanced browsers, and this is just Chrome, Firefox, Opera and Safari, everything is not so smooth either.  Of course, they are trying to be "first", but not everyone is able to do it yet. <br><br>  In HTML 5, there are 2 ways to read and asynchronously send a file to the server: via File Reader and Form Data objects.  In principle, it is precisely for downloading files that there is no difference in which way to send files to the server.  Speaking exactly, sending the files is responsible for the XMLHttpRequest object, and File Reader and Form Data only allow you to read the file and feed it to XHR.  These objects are designed for different tasks.  File Reader is designed to work with files on the browser side.  That is, before uploading a file to the server, you can find out its parameters, such as weight, type, creation date, etc. Pictures, for example, can be immediately shown to the user without uploading them to the server.  Form Data is designed to create forms and manage form data before uploading to the server.  And as we know, input forms = ‚Äúfile‚Äù is present in the forms, through which up to this point we sent the files.  Thus, you can create a form, attach a file to it and send it to the server via XHR. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      From the lyrics to the case.  Consider both boot examples.  But before that, a small note that it would be nice to determine the browser's capabilities for downloading via the File API.  To do this, it is enough to check for the presence of File Reader or Form Data objects.  But!  Safari has not yet done File Reader support and you will not be able to work with this object.  Yablofagi are indignant, and we love all users equally.  Therefore, at the moment, Form Data will be considered the most correct check: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.FormData === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   ,    :-)    . }</span></span></code> </pre> <br><br><h4>  2. Download via Form Data </h4><br>  First, we describe all the events: dragging and dropping files, ‚Äúthrowing‚Äù them into a block for downloading, etc. <br><br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">"#drop-block"</span></span>).bind( <span class="hljs-comment"><span class="hljs-comment">// #drop-block        'dragenter', function(e) { //        . }) .bind( 'dragover', function(e) { //        . }).bind( 'dragleave', function(e) { //         . }).bind( 'drop', function(e) { //   ¬´¬ª   . if (e.originalEvent.dataTransfer.files.length) { //    -   . e.preventDefault(); e.stopPropagation(); // e.originalEvent.dataTransfer.files ‚Äî     . // e.originalEvent.dataTransfer.files[i].size ‚Äî     . // e.originalEvent.dataTransfer.files[i].name ‚Äî   . //    :-) upload(e.originalEvent.dataTransfer.files); //   . } });</span></span></code> </pre><br>  Well, the code directly reading and downloading files: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">upload</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">files</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       . //    ,   Safari   //  . $.get('/blank.html'); var http = new XMLHttpRequest(); //   XHR,       . //   if (http.upload &amp;&amp; http.upload.addEventListener) { http.upload.addEventListener( //      . 'progress', function(e) { if (e.lengthComputable) { // e.loaded ‚Äî   . // e.total ‚Äî     . //    ‚Äî   - :-) } }, false ); http.onreadystatechange = function () { //     if (this.readyState == 4) { //   4 ,    4        if(this.status == 200) { //     //    . // ,  // var result = $.parseJSON(this.response); //       . } else { //       . } } }; http.upload.addEventListener( 'load', function(e) { //         . //       . //  . }); http.upload.addEventListener( 'error', function(e) { // ,   ! }); } var form = new FormData(); //   . form.append('path', '/'); //   . for (var i = 0; i &lt; files.length; i++) { form.append('file[]', files[i]); //      . } http.open('POST', '/upload.php'); //    . http.send(form); //   ,    .  XHR. }</span></span></code> </pre><br><br><h4>  3. Download via File Reader </h4><br>  File Reader itself is designed to work with files on the browser side.  Let's try to upload files using this object.  We remind you that in Safari there is no File Reader object! <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.FileReader === <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//      //   ‚Äî ! } //        . //        ,  . //  ... var dropbox = $('#file-drag'); dropbox[0].ondragover = function() { return false; }; dropbox[0].ondragleave = function() { return false; }; dropbox[0].ondrop = function(e) { var files = e.dataTransfer.files; uploadFile(files[i]); e.preventDefault(); e.stopPropagation(); return false; }; //     . // -,    0   . // -,       . //     function uploadFile(file) { var reader = new FileReader(); reader.onload = function() { var xhr = new XMLHttpRequest(); xhr.upload.addEventListener("progress-bar", function(e) { if (e.lengthComputable) { // -,  ;-) } }, false); //    load  error xhr.onreadystatechange = function () { if (this.readyState == 4) { if(this.status == 200) { } else { //  :-( } } }; xhr.open("POST", "upload.php"); //       ,     . var boundary = "xxxxxxxxx"; //  . xhr.setRequestHeader('Content-type', 'multipart/form-data; boundary="' + boundary + '"'); xhr.setRequestHeader('Cache-Control', 'no-cache'); //   . var body = "--" + boundary + "\r\n"; body += "Content-Disposition: form-data; name='superfile'; filename='" + unescape( encodeURIComponent(file.name)) + "'\r\n"; // unescape        . body += "Content-Type: application/octet-stream\r\n\r\n"; body += reader.result + "\r\n"; body += "--" + boundary + "--"; //     Chrome,       . if (!XMLHttpRequest.prototype.sendAsBinary) { XMLHttpRequest.prototype.sendAsBinary = function(datastr) { function byteValue(x) { return x.charCodeAt(0) &amp; 0xff; } var ords = Array.prototype.map.call(datastr, byteValue); var ui8a = new Uint8Array(ords); this.send(ui8a.buffer); } } //  . if(xhr.sendAsBinary) { //   Firefox xhr.sendAsBinary(body); } else { //   (    W3C) xhr.send(body); } }; //   reader.readAsBinaryString(file); };</span></span></code> </pre><br><br>  This article is not a guide to use, but only a tool for exploring the possibilities of HTML 5. The code does not claim to be ideal.  I would be glad if someone complements or corrects. </div><p>Source: <a href="https://habr.com/ru/post/154097/">https://habr.com/ru/post/154097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../154081/index.html">Paradigm programming processors in MODx Revolution</a></li>
<li><a href="../154083/index.html">Web series: do they have a future?</a></li>
<li><a href="../154087/index.html">Mathematical approach to creating websites</a></li>
<li><a href="../154089/index.html">Systematization of garbage collectors in HotSpot, IBM J9, JRockit JVMs</a></li>
<li><a href="../154091/index.html">Optimization of lead collection for the site accompanying the project</a></li>
<li><a href="../154099/index.html">New for web designer in October 2012</a></li>
<li><a href="../154101/index.html">Apple, Facebook, Google, Microsoft Launch WebPlatform</a></li>
<li><a href="../154103/index.html">Jpg, transparency, canvas, animation</a></li>
<li><a href="../154105/index.html">Functional Javascript Programming</a></li>
<li><a href="../154107/index.html">The new user authentication system uses the unique characteristics of video cards.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>