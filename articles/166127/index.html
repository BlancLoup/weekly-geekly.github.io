<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>John Resig on the internationalization of JavaScript applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I had to deal with the internationalization of a web application on Node.js + Express, which I am currently working on, and I think it turne...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>John Resig on the internationalization of JavaScript applications</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/2f4/12f/dca/2f412fdcad0f10de441f647125c6608c.jpg" align="left">  Recently, I had to deal with the internationalization of a web application on Node.js + Express, which I am currently working on, and I think it turned out pretty good (foreign users are very satisfied, and I see a noticeable influx of traffic from non-English speaking countries).  The internationalization strategy, which I will describe, is not too tightly tied to Node and can suit any web application. <br><br>  I often had to use multilingual sites or visit English-speaking sites from around the world, so I was well aware of the requirements that internationalization should meet: <br><a name="habracut"></a><br><ul><li>  <b>Full equality between languages.</b>  The same content should be available to everyone. </li><li>  <b>Different language versions must be contained in subdomains.</b>  Using separate top-level domains for different languages ‚Äã‚Äãis too expensive, and not necessary.  In addition, it is more convenient to switch between languages ‚Äã‚Äãby editing the address bar. </li><li>  <b>No automatic translation.</b>  There is nothing worse than to stumble upon an unreadable version of the site due to the fact that the server has substituted a machine translation curve, guided by your IP or computer language settings.  The same URL should always point to the same language version. </li><li>  <b>No automatic redirects to the national version of the site.</b>  Approximately for the same reasons as in the previous paragraph - if I go to foo.com, do not send me to es.foo.com just because the server decided that I am from Spain.  Instead, it‚Äôs better to show the notification in (presumably) my native language and suggest manually switching to the national version. </li></ul><br>  In the end, you should get something like this: <br><br><ul><li>  domain.com - the main (English) version; </li><li>  ja.domain.com - Japanese version; </li><li>  XX.domain.com - other languages. </li></ul><br>  Equality between languages ‚Äã‚Äãand the use of subdomains make it possible to switch between the languages ‚Äã‚Äãof any page simply by adding a national subdomain: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  domain.com/search?q=mountain </li><li>  ja.domain.com/search?q=mountain </li></ul><br>  Both pages should work and look the same, except that the second one will be in Japanese. <br><br>  In the header of the page I can easily put a link to the same page in another language: <br><br><img src="https://habrastorage.org/storage2/7d6/fc5/26a/7d6fc526a78bd4f5eb91a749a1ed373b.png"><img src="https://habrastorage.org/storage2/6b3/dc8/3dc/6b3dc83dc0a389b35aff05e61a6276f6.png"><br><br>  In addition, you can use the technique <a href="http://support.google.com/webmasters/bin/answer.py%3Fhl%3Den%26answer%3D189077">rel = "alternate" hreflang = "x"</a> to help Google search engines better understand the structure of my site.  If I put this line in the page title, Google will show the localized version in the search results. <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alternate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hreflang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ja"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://ja.domain.com/"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br><h4>  Server part </h4><br>  It is very important to help the user find the content he needs, especially if you do not want an automatic translation or redirect.  Links to alternative languages ‚Äã‚Äãin the header of the site are already good, but it is even better to display a notification at the top inviting the user to switch to his native language (and here the attempt to automatically guess the language is quite appropriate): <br><br><img src="https://habrastorage.org/storage2/5fb/dfa/f1d/5fbdfaf1d2b1c200d22c97f29261d0c6.png"><br><br>  As it turned out, this is not so easy to implement.  The easiest way is to look in the <a href="http://www.w3.org/International/questions/qa-accept-lang-locales">Accepted Language</a> field of the request header, but this only works if your page is completely dynamic and never cached. <br><br>  If not, then you need to consider how and where the cache is connected. <br><br>  In my case, I used Nginx in front of several Node / Express servers.  So, everything that was issued by the application server on Node was cached, including notifications with the suggestion to switch the language. <br><br>  As a result, you have to manage this notification on the client side.  And here we are waiting for another obstacle: on the client using DOM / JavaScript, it is impossible to reliably determine the desired language. <br><br>  Therefore, we need the server to additionally inform the application about the desired language. <br><br>  For this, I used the Nginx <a href="http://wiki.nginx.org/AcceptLanguageModule">AcceptedLanguage</a> module.  I set a cookie indicating the desired language and passed it to the client.  Here is what the Nginx configuration looked like: <br><br><pre> <code class="bash hljs">set_from_accept_language <span class="hljs-variable"><span class="hljs-variable">$lang</span></span> en ja; add_header Set-Cookie lang=<span class="hljs-variable"><span class="hljs-variable">$lang</span></span>;</code> </pre><br>  Now all I had to do in the client part was to read the cookie and display a notification if the desired language did not match the page language. <br><br>  Thus, Nginx continues to aggressively cache all content, and the client correctly displays a message offering to visit the localized version of the page. <br><br><h4>  The logic of internationalization </h4><br>  I wrote my <a href="http://ejohn.org/blog/i18n-module-for-node-and-express-js/">Node.js module</a> for internationalization.  He uses the following strategy: <br><br><ul><li>  All translations are stored in JSON files; </li><li>  These files are used for translation on the fly at the time of use; </li><li>  Translation is carried out in the standard way, through a call <code>__("Some string")</code> .  If the translation exists, the string <code>"Some string"</code> is replaced with the translation; if not, it is used directly. </li></ul><br>  Since a limited set of servers processes multiple requests at the same time, the internationalization logic cannot be shared, it should work separately for each request.  I met solutions, for example <a href="https://github.com/mashpie/i18n-node">i18n-node</a> , which assume that the server will simultaneously issue pages in only one language.  In practice, this does not work, especially in the asynchronous world of Node.js. <br><br>  If the incoming request sets the preferred language for a common internationalization object, this may result in the server issuing an incorrect language version in response to another request: <br><br><img src="https://habrastorage.org/storage2/3c9/964/777/3c9964777ce1ee10728a8ad90ca56b0c.png"><br><br>  At a minimum, you need to make sure that the information about the preferred language is not lost during the execution of the current request (this is implemented in my module). <br><br>  In practice, this means that it is necessary to add the <code>i18n</code> property to the <code>request</code> object, just as middleware is usually added to Express: <br><br><pre> <code class="javascript hljs">app.use(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) </span></span>{ req.i18n = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> i18n(<span class="hljs-comment"><span class="hljs-comment">/* options... */</span></span>); next(); });</code> </pre><br><h4>  Work organization </h4><br>  The logic of internationalization behaves differently in development mode and production. <br><br>  In development mode: <br><br><ul><li>  Translation files are loaded at every request; </li><li>  Translation files are updated dynamically after any changes; </li><li>  Warning and debug messages are displayed. </li></ul><br>  In production: <br><br><ul><li>  All translation files are cached; </li><li>  Files are never updated dynamically; </li><li>  Warnings and debug messages are not displayed. </li></ul><br>  Two key differences are dynamic loading and updating translations.  During development, it is useful to update them with each change in order to see the result of your actions, and not to forget to translate a single line.  In production, it‚Äôs worthwhile to consider them as static files - it‚Äôs stupid to jerk the disk on every request. <br><br><h4>  Code organization </h4><br>  Strings that need translation can be anywhere: in the application code, templates, and even (God forbid!) In styles. <br><br>  In my application, I immediately made sure that there were no text lines in JavaScript and CSS.  If I needed to dynamically generate some text in an application, I would do it through templates using something like <a href="http://ejohn.org/blog/javascript-micro-templating/">my micro template</a> . <br><br>  I consider it very important to avoid getting any strings to be translated into CSS or JavaScript files, since these files should be cashed or even placed on a CDN.  Naturally, you can create several language versions of all the JavaScript and CSS files during project build, but I prefer not to complicate the build process. <br><br>  The only exception to my application when the code contains translatable strings is the code of Express views, where I use the <code>i18n</code> object attached to the query: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">index</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ req.render(<span class="hljs-string"><span class="hljs-string">"index"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: req.i18n.__(<span class="hljs-string"><span class="hljs-string">"My Site Title"</span></span>), <span class="hljs-attr"><span class="hljs-attr">desc</span></span>: req.i18n.__(<span class="hljs-string"><span class="hljs-string">"My Site Description"</span></span>) }); } };</code> </pre><br>  I use the <a href="http://paularmstrong.github.com/swig/">swig</a> template engine, but the translation technique will be about the same for any template engine: <br><br><pre> <code class="html hljs xml">{% extends "page.swig" %} {% block content %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>{{ __("Welcome to:") }} {{ title }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>{{ desc }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {% endblock %}</code> </pre><br>  The string wrapped in a call to <code>__(...)</code> is replaced with a translation. <br><br><h4>  Actually translation </h4><br>  So far, I myself have been translating my application, without resorting to the help of third-party translators.  The application is still very small, there are only a few dozen lines for translation. <br><br>  I can share a few tricks that can help you hold out longer without bringing in a professional translator: <br><br><ul><li>  <b>Use ready-made translations from open source projects.</b>  There are many open source projects and frameworks containing professional translations of interface elements.  For example, the <a href="http://localize.drupal.org/translate/languages">Drupal</a> framework <a href="http://localize.drupal.org/translate/languages">contains</a> many such translations in a convenient format.  I found several ready-made phrases there. </li><li>  <b>Look for similar multilingual projects.</b>  If there are qualitative examples of multilingual sites that implement similar to your functionality, you can take a translation from there.  My current application is a search engine, so many lines from Google pages exactly matched mine. </li><li>  <b>Google translate.</b>  Yes, yes, I know what you are thinking now, but I am very impressed with the progress of Google Translate lately, especially when translating individual words and expressions.  Now there even appeared different versions of the translation indicating their likelihood, which is very good. </li></ul><br><img src="https://habrastorage.org/storage2/726/380/fde/726380fde723d27032edb418b58f520d.png"><br><br><h4>  findings </h4><br>  I have been working on the internationalization of the site just a couple of weeks, so for sure a lot will change when the site grows.  Nevertheless, the translation has already yielded tangible results, the number of visits has increased noticeably, largely due to the fact that Google has indexed localized pages.  My internationalization module is a good support for me, and I hope that I can facilitate the work on translation and others. <br><br></div><p>Source: <a href="https://habr.com/ru/post/166127/">https://habr.com/ru/post/166127/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../166109/index.html">What we should build DOM</a></li>
<li><a href="../166113/index.html">The exceptional beauty of Doom 3 source code</a></li>
<li><a href="../166119/index.html">How to withdraw money from the App Store to Payoneer card</a></li>
<li><a href="../166121/index.html">What is more advantageous to contests than direct advertising, or how we came up with a contest for diafan.CMS</a></li>
<li><a href="../166125/index.html">Phosphors. A bit of theory and practice</a></li>
<li><a href="../166131/index.html">Site vulnerability yota.ru fixed</a></li>
<li><a href="../166133/index.html">Today, Yandex People service has been attached to Yandex Disk, let's see what happened.</a></li>
<li><a href="../166135/index.html">Introduction to NikaFramework (NKF). Part 2</a></li>
<li><a href="../166137/index.html">Rating of 50 companies that received the largest number of patents in 2012</a></li>
<li><a href="../166139/index.html">Boost.Asio Pinger and Unit Testing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>