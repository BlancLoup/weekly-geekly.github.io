<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>NetBIOS in the hands of a hacker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, a brief narration will go about what such a familiar-looking thing like NetBIOS can tell us. What information can it provide to a pot...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>NetBIOS in the hands of a hacker</h1><div class="post__text post__text-html js-mediator-article">  In this article, a brief narration will go about what such a familiar-looking thing like <i>NetBIOS</i> can tell us.  What information can it provide to a potential intruder / pentester. <a name="habracut"></a><br><br>  The demonstrated field of application of reconnaissance techniques relates to internal, that is, isolated and externally inaccessible networks.  Such networks usually have any even the smallest company. <br><br>  <i>NetBIOS</i> itself is usually used to obtain a network name.  And this will be enough to do at least 4 things. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Host Discovery </h4><br>  Because NetBIOS can use UDP as a transport, its speed allows it to detect hosts on very large networks.  So, for example, the <i>nbtscan</i> tool, included in the same-named packet, can in just 2 seconds (can lay the network) resolve the network addresses of the form 192.168.0.0/16, while the traditional TCP scan will take tens of minutes.  This feature can be used as a host sweep on very large networks, about which nothing is known, before running nmap.  Although the result does not guarantee 100% detection, since the windows-hosts and not all of them will mostly respond, it will nevertheless allow you to determine in what ranges approximately the live hosts are. <br><br><h4>  Host Identification </h4><br>  Using the results of getting names from ip-addresses: <br><br><img src="https://habrastorage.org/webt/t7/pa/hv/t7pahvwb67vd6ee85boatugvgwg.png" alt="image"><br><br>  you can see: besides the fact that the name reveals the owner of the workstation (although this is by the way not always the case), one of the addresses clearly stands out from the others.  We can see that the name <i>KALI</i> was obtained.  This behavior is typical, as a rule, for the <i>unix</i> implementation of <i>SMB / NetBIOS</i> as part of the <i>samba</i> software package or very old <i>Windows 2000</i> . <br><br>  Getting the name <i>KALI</i> , while on other hosts, this &lt; <i>unknown</i> &gt; indicates the presence of a so-called <i>null-session</i> .  With default settings, the <i>SMB</i> server on <i>linux is</i> prone to it.  <i>Null-session</i> only allows you to completely anonymously (and we did not enter any passwords, as you can see on the screen) to get a lot of additional information, such as a local password policy, a list of local users, groups and a list of shared resources (ball): <br><br><img src="https://habrastorage.org/webt/yr/v9/qs/yrv9qsux-chofihfntozw8i3xki.png" alt="image"><br><br>  Often on <i>linux SMB</i> -servers there are publicly available balls, not just reading, but even writing.  The presence of both of them carries various threats, the use of which is beyond the scope of this article. <br><br>  <i>NetBIOS</i> also allows you to get the names of all types that the workstation stores: <br><br><img src="https://habrastorage.org/webt/oo/mw/te/oomwtezmse069cd8umqv1s_x3k8.png" alt="image"><br><br>  in this case, it lets you know that the host is also the <i>ARRIVA</i> domain <i>controller</i> . <br><br>  It is also worthwhile to additionally note that <i>NetBIOS</i> allows you to get <i>mac-</i> address.  Moreover, unlike arp requests, NetBIOS requests can go beyond the limits of a subnet.  This can be useful if, for example, you need to find a laptop or specific hardware on the network, knowing its manufacturer.  Since the first three octets of the <i>mac</i> address identify the manufacturer, you can send similar <i>NetBIOS</i> requests to all known subnets to try to find the device you need (http://standards-oui.ieee.org/oui.txt). <br><br><h4>  Determining Domain Membership </h4><br>  Often, when moving across internal corporate networks, it is necessary to attack the workstation included in the domain (for example, to raise privileges to the domain administrator level) or vice versa.  In this case, <i>NetBIOS</i> can help again: <br><br><img src="https://habrastorage.org/webt/ad/y0/rf/ady0rfad1qrtpy1l36xvreapkbo.png" alt="image"><br><br>  In this case, using <i>NetBIOS</i> all names of all types were obtained.  Among them, you can see, in addition to the name of the PC (what has already been received before), and the name of the working group.  By default for <i>windows,</i> it is usually something like <i>WORKGROUP</i> or <i>IVAN-PC</i> , but if the workstation is in the domain, then its working group is the domain name. <br><br>  Thus, using <i>NetBIOS,</i> you can find out whether the workstation is in the domain and, if so, in which. <br><br>  If you want to get a list of domain hosts within a subnet, then one broadcast request with the name of the required domain will suffice: <br><br><img src="https://habrastorage.org/webt/_6/ya/e8/_6yae8vq5zo4jy6h2lnuyhybakq.png" alt="image"><br><br>  as a result, all hosts in this domain will respond. <br><br><h4>  Multihomed host detection </h4><br>  And finally, another probably very little known technique that is simply indispensable for <i>finding ways</i> to secure, perhaps even physically isolated, networks.  It can be shop networks of enterprises, stuffed with controllers.  Access to this network for the attacker means the ability to influence the process, and for the enterprise the risk of incurring huge losses. <br><br>  So, the point is that even if the network is isolated from the corporate network, then often some administrators, whether by their laziness, or even like that, like to put up another network card on their PCs to access this same network.  At the same time, all this happens, of course, bypassing all the rules of corporate firewalls.  Convenient, yes, but not very safe, if you are hacked, then you will become a bridge to this network and be responsible. <br>  However, for the attacker, there is one problem - to find the administrator who joined the secure network in such an illegal way.  Moreover, it is a difficult problem for the network security personnel themselves.  In large enterprises, it is truly a difficult task, like finding a needle in a haystack. <br><br>  In this situation, the obvious options for the attacker would be two: <br><br><ol><li>  Try to use each PC in the corporate subnet as a gateway to the desired network.  It would be very convenient, but this is rare, since on <i>windows</i> hosts <i>ip forwarding is</i> almost always disabled.  Moreover, such verification is possible only within its own subnet, and it also requires the attacker to know the target address from an isolated network. </li><li>  try to remotely login to each host and execute the banal <i>ipconfig / ifconfig</i> command.  And here is not so smooth.  Even if the attacker has secured the rights of the domain administrator, the firewalls and local firewalls have not been canceled.  So this task is not 100% automated.  As a result, it remains painful to go to each host, overcoming firewalls (often blocking exactly 445 / tcp port), hoping to finally see the desired network interface. </li></ol><br>  However, everything is much simpler.  There is one extremely simple technique that allows you to get a list of network interfaces from a particular host.  Suppose we have a certain host: <br><br><img src="https://habrastorage.org/webt/p2/1l/hh/p21lhhx8qdnfvpte4hrwblhsfvg.png" alt="image"><br><br>  This is a reverse IP address ‚Üí network name.  If we now try to make a direct resolv network name ‚Üí ip-address: <br><br><img src="https://habrastorage.org/webt/zr/2z/k9/zr2zk9waoscntarqir8zya9_dg0.png" alt="image"><br><br>  then we learn that this host is also a gateway (apparently) on some other network.  It is worth noting that in this case the request was broadcast.  In other words, it will be heard by hosts only from the attacker's subnet. <br><br>  If the target host is outside the subnet, then you can send a targeted request: <br><br><img src="https://habrastorage.org/webt/-x/sx/7j/-xsx7j64cjly0xlhdqqglonc2fi.png" alt="image"><br><br>  In this case, it is clear that the target is outside the attacker's subnet.  Using the ‚ÄìB switch, it was stated that the request should be sent to a specific address, and not to a broadcast address. <br><br>  Now it only remains to quickly gather information from the entire subnet of interest, and not from a single address.  You can use a small <i>python</i> script for this: <br><br><img src="https://habrastorage.org/webt/lo/z3/th/loz3thmdajppwq2oqtqibp95qze.png" alt="image"><br><br>  And after a few seconds: <br><br><img src="https://habrastorage.org/webt/lz/e8/i4/lze8i4lom7sgz4zwnwz9_foc0na.png" alt="image"><br><br>  It is a dedicated host, in this improvised case, would be the first target of the attacker, if he pursued the network 172.16.1 / 24. <br><br><img src="https://habrastorage.org/webt/1q/ug/ma/1qugmatd6jlto6wh8rznegqhako.png" alt="image"><br><br>  Duplicate names on different ip indicate that the host also has two network cards, but on the same subnet.  It is worth noting that <i>NetBIOS</i> does not disclose <i>alias</i> (which can easily be calculated via arp requests as ip with the same <i>mac</i> ).  In this case, ip-addresses have different <i>mac</i> . <br><br>  Another example of using this technique is public Wi-Fi.  Sometimes you can come across a situation where among the guest devices, personnel working in a closed corporate segment are connected to the public network.  Then, with the help of this intelligence technique, an attacker will very quickly be able to chart his way to a closed network: <br><br><img src="https://habrastorage.org/webt/zx/x6/0l/zxx60lshqqv9ojgin72nusco_x4.jpeg" alt="image"><br><br>  In this case, among the 65 public Wi-Fi clients were two workstations that have an additional interface, probably related to the corporate network. <br><br>  If sometimes filtering traffic to the 445 / tcp port is observed between the network segments or directly at the workstations, preventing remote logging into the system (remote code execution), in this case, the 137 / udp port is used to resolve names using <i>NetBIOS;</i> is encountered, since the convenience of working in the network will suffer from this, for example, the network environment may disappear, etc. <br><br>  As the saying goes, <i>enumeration is the key</i> <br>  Is there any protection against this?  It is not, because this is not a vulnerability in all.  This is just the regular functionality of the little <i>windows</i> default (the behavior is slightly different in <i>linux</i> ).  And if you suddenly inconsistently, bypassing the rules of network routing, are included in the closed segment, then the attacker will find you and do it very quickly. </div><p>Source: <a href="https://habr.com/ru/post/445212/">https://habr.com/ru/post/445212/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445200/index.html">Internet providers ask the Ministry of Communications and Mass Media to let them into homes without an agreement</a></li>
<li><a href="../445204/index.html">Stream Firebird 2.5 bases conversion to ODS12 format (Firebird 3.0)</a></li>
<li><a href="../445206/index.html">Reduce downtime when updating Zimbra</a></li>
<li><a href="../445208/index.html">Maturity Levels of Enterprise IT Infrastructure</a></li>
<li><a href="../445210/index.html">Cryptocurrency colony</a></li>
<li><a href="../445214/index.html">We pump React hooks using FRP</a></li>
<li><a href="../445220/index.html">AMD Radeon VII: High-End Dash (Part 3)</a></li>
<li><a href="../445222/index.html">Get an offer in 1 day in the backend team on Cosmonautics Day</a></li>
<li><a href="../445226/index.html">Development of a rocket capable of reaching the moon will cost the Russian Federation 740 billion rubles</a></li>
<li><a href="../445228/index.html">Cryptography in Java. Mac class</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>