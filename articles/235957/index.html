<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another library to work with 433 MHz devices</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 I want to share the JAVA library for working with home automation radio devices (usually 433.92 MHz) that I have been working on recently. I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another library to work with 433 MHz devices</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  I want to share the JAVA library for working with home automation radio devices (usually 433.92 MHz) that I have been working on recently.  It is still raw enough for serious use, but for home crafts it is just right. <br>  Address on github - <a href="https://github.com/eschava/rf-protocols-java">github.com/eschava/rf-protocols-java</a> <br><br><h3>  Prerequisites to create </h3><br>  After buying Cubietruck decided to transfer to it all the tasks of the smart home, which were performed on the Arduino.  This is mainly the reception and transmission of radio messages to home automation devices (sockets, sensors, heating) <br>  Everything that was found on the network was either done only for the Raspberry Pi, or too sharpened for some specific functionality.  Therefore, I decided to implement everything myself, using the familiar development language (Java) and make it as flexible and expandable as possible (the register of factories and all that, as is customary in Java) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To work with RF devices via GPIO ports, I chose a rather obscure but promising library <a href="http://libbulldog.org/bulldog/">libbulldog</a> which allows you to abstract from the platform on which everything is running.  Currently supported (theoretically) Raspberry Pi, BeagleBoard, Cubieboard, but it was tested only on Cubieboard3 (aka Cubietruck) which I have available. <br>  Also supported (again theoretically) is the popular library for the Raspberry PI <a href="http://pi4j.com/">Pi4j</a> , but, unfortunately, it was not possible to try it out in practice <br><br><a name="habracut"></a><br><br><h3>  Main ideas </h3><br><ul><li>  Platform independence </li><li>  Autonomy of all components (for the implementation of any tasks) </li><li>  Easy extensibility (support for new devices and platforms) </li><li>  Decoded messages support two interfaces: the usual method call (getTemperature ()) and property references by name </li><li>  The maximum removal of settings beyond the code for more precise adjustment to the device without changing the code </li></ul><br><br><h3>  What is implemented </h3><br>  The following protocols are currently implemented. <br>  - Oregon V2 (temperature and humidity sensors such as THN132N, THR238NF, THWR800, THGN132N, etc.) <br>  - Oregon V3 (temperature, humidity sensors) <br>  - Oregon SL109 (temperature, humidity sensors) <br>  - Owl (Owl Micro + current consumption sensors) <br>  - PT2262 / PT2272 (Chinese radio relay, the corresponding Arduino library is called RC-switch) <br>  - RemoteSwitch (Chinese radio relay, the name is similar to the well-known Arduino library) <br>  a plus <br>  - several utilities for research and diagnostics of protocols (see below) <br>  - MQTT client for seamless integration with smart home systems (see below) <br>  Plans to add support for as many popular radio protocols as possible (first I would like Noolite and La Cross) <br><br><h3>  Architecture </h3><br>  Work with radio protocols is divided into three levels: <br>  - directly signals from the receiver to the GPIO port (signal level) <br>  - signals are transformed into packets.  Typically, this is a sequence of bits (packet level) <br>  - packets are analyzed and become messages.  Messages already have specific user properties (temperature, command, etc.) (message level) <br><br>  Each level is independent of its neighbors and can be reused (for example, conversion from signals to packets is often the same for many devices, but the formation of messages from packets is unique) <br><br>  All protocols can be configured as much as possible using .properties files, since many constants (for example, the duration of pulses) can vary for different devices. <br><br><h3>  Protocol Research Utilities </h3><br>  There are two of them at the moment.  I will show you how to use both of them to deal with the protocol from radio trinkets with the PT2262 chip (most popular on aliexpress) <br><br>  - breakdown: used to study the length of the pulses from the receiver.  As a rule, when a device does not send data to the air, noise with various pulse lengths arrives at the GPIO port from the receiver, but if you press a button on the transmitter or wait for a signal, it is noticeable that the received pulses fall into certain groups.  For example, for the power button, the program will display the following data (pulse duration in microseconds): <br><pre> cubie @ Cubian: ~ / gpio $ sudo java -cp bulldog.cubieboard.jar: rf-protocols-0.1-SNAPSHOT.jar -DpropertiesFile = breakdown.properties -Dlistener.groupCount = 20 -Dlistener.maxLength = 2000 rf.protocols.analysis .breakdown.BreakdownMain
 &lt;100 &lt;200 &lt;300 &lt;400 &lt;500 &lt;600 &lt;700 &lt;800 &lt;900 &lt;1000 &lt;1100 &lt;1200 &lt;1300 &lt;1400 &lt;1500 &lt;1600 &lt;1700 &lt;1800 &lt;1900 &lt;2000&gt; = 2000
 2054 1099 573 223 137 92 45 48 13 12 9 8 5 3 5 6 1 0 2 1 30
 2399 1417 686 317 155 111 52 30 6 2 7 0 3 2 1 0 0 1 1 1 7
 2479 1396 675 319 189 103 59 28 5 6 4 0 1 0 1 2 3 0 0 1 5
 2333 1351 751 316 199 91 34 26 9 7 2 2 2 2 1 3 2 0 1 1 7
 2307 1254 712 297 175 108 106 20 6 5 1 3 1 0 0 1 2 2 0 1 9
 1249 714 368 164 182 158 33 12 3 6 0 4 10 110 63 2 2 0 1 0 12
 1 0 1 0 171 232 0 0 0 0 0 1 0 252 127 3 0 0 0 0 22
 0 0 0 0 173 226 0 0 0 0 0 0 1 247 131 2 0 0 0 0 21
 1 0 1 0 201 196 0 0 0 0 0 0 1 217 156 4 0 0 0 0 20
 0 0 0 0 216 188 0 0 1 0 0 0 0 218 159 4 0 0 0 0 22
 0 0 0 1 195 205 0 0 0 0 0 1 0 227 152 2 0 0 0 0 21
</pre><br>  The first half of the lines is noise, the second is a button on the key fob <br>  From the utility output, it becomes clear that the pulses fall into the following groups: (400, 600) and (1300, 1600) (if you experiment a little more with the groups, you can find out that there are more pulses from the group (15000, 16000)) <br>  Now let us try to understand how the pulses from these groups alternate.  For this we need the following utility <br><br>  - intervals: allows you to give pulse intervals names and see their sequence.  Let's call the first group ‚Äú0‚Äù, the second ‚Äú1‚Äù, and the last, the longest, ‚ÄúS‚Äù.  And we will only output groups in which at least 20 pulses in a row fall into these intervals: <br><pre> cubie @ Cubian: ~ / gpio $ sudo java -cp bulldog.cubieboard.jar: rf-protocols-0.1-SNAPSHOT.jar -DpropertiesFile = pt2262.properties rf.protocols.analysis.intervals.IntervalsMain
 [678] 10010101100110101001010 [1296] (23)
 [-1] 01011001010101011001010110011010100101010101010S0101011001010101011001010110011010100101010101010S0101011001010101011001010110011010100101010101010S0101011001010101011001010110011010100101010101010 [150716] (197)
 [770] 100101011001101010010101010 [1281] (27)
 [3418] S0101011001010101011001010110011010100101010101010S0101011001010101011001010110011010100101010101010S0101011001010101011001010110011010100101010101010S010101100101010101100101011001 [934] (181)
</pre><br>  (Explanation - the numbers in square brackets are the duration of the pulses before and after the sequence. Sometimes it helps to understand why the sequence was interrupted in the middle, the number in parentheses is the number of signals in the sequence) <br><br>  It can be seen that the sequence between pulses called S is always the same for one button and looks like <br>  0101011001010101011001010110011010100101010101010 <br>  If you study the sequences received from different buttons, you can see that these are always groups of characters. <br>  0101 <br>  1010 <br>  0110 <br>  plus always zero at the end (synchronization) <br><br>  It looks like a ternary number system.  Give them the names 0,1 2 and get the sequence <br>  020020221000 for the power button and <br>  020020220100 for the off button <br><br>  We can assume that the job is done. <br><br><h3>  MQTT client </h3><br>  The library also includes the MQTT client, which can be launched as a separate application for seamless integration with ready-made smart home systems (planned with <a href="http://www.openhab.org/">openHAB</a> ) <br>  Customer: <br>  - automatically sends MQTT messages for all received data.  For example, the temperature received from the Oregon device will be published on topic <br>  rf / OregonV2 / Temperature <br>  - listens to rf / send / PROTOCOL topics and sends radio commands with data received from the topic.  For example, in order to simulate a command from the keyfob from the previous paragraph, you need to send the command 020020221000 on the topic rf / send / pt2262 <br>  Run: <br> <code>sudo java -cp bulldog.cubieboard.jar:mqtt-client-0.4.0.jar:ST4-4.0.8.jar:rf-protocols-0.1-SNAPSHOT.jar:antlr-runtime-3.5.2.jar -DpropertiesFile=mqtt.properties rf.protocols.external.paho.MqttMain <br></code> <br><br><h3>  How to run stand-alone applications in the library </h3><br>  At the moment, all independent applications in the library are launched as regular Java applications with the main () method <br>  Also, all have the -DpropertiesFile parameter for setting the settings file (pins, a library for working with pins, etc.).  Examples of .properties files are on github'e ( <a href="https://github.com/eschava/rf-protocols-java/tree/master/examples">github.com/eschava/rf-protocols-java/tree/master/examples</a> ) <br><br>  In addition to the applications described earlier, there are also the following: <br><br>  Display all received messages on the console <br> <code>sudo java -cp bulldog.cubieboard.jar:rf-protocols-0.1-SNAPSHOT.jar -DpropertiesFile=protocols.properties rf.protocols.analysis.PrintAllMessages</code> <br> <br>  Output of all received packets (lower-level data than messages, usually this is a hexadecimal dump of packets) <br> <code>sudo java -cp bulldog.cubieboard.jar:rf-protocols-0.1-SNAPSHOT.jar -DpropertiesFile=protocols.properties rf.protocols.analysis.PrintAllPackets</code> <br> <br>  Sending a message by protocol <br> <code>sudo java -cp bulldog.cubieboard.jar:rf-protocols-0.1-SNAPSHOT.jar -DpropertiesFile=sendmessage.properties -Dprotocol=RemoteSwitch -Dmessage=111110222220 rf.protocols.analysis.SendStringMessage <br></code> <br><br>  It seems to be all <br>  Waiting for reviews, bug reports, feature requests and other scary words </div><p>Source: <a href="https://habr.com/ru/post/235957/">https://habr.com/ru/post/235957/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../235943/index.html">How I created the open source page scroll plugin One Page Scroll</a></li>
<li><a href="../235945/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ124 (September 1 - 7, 2014)</a></li>
<li><a href="../235947/index.html">Happy Tester Day</a></li>
<li><a href="../235951/index.html">Google Glass Explorer Edition now sold via Google Play</a></li>
<li><a href="../235953/index.html">What is marketing, and why these people try to deceive you in most cases - educational program</a></li>
<li><a href="../235961/index.html">Return in good hands: tactile feedback displays are becoming a reality</a></li>
<li><a href="../235963/index.html">The digest of interesting news and materials from the world of PHP No. 47 (August 24 - September 7, 2014)</a></li>
<li><a href="../235969/index.html">As we worked for 4 years without an office and brutally broke off</a></li>
<li><a href="../235971/index.html">Its business for 4300 rubles</a></li>
<li><a href="../235973/index.html">Simple export to Excel XML</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>