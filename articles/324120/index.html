<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search for ski slopes from space</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you like skiing or snowboarding on non-rolled slopes, or you are just tired of the boring ironed slopes of Sorochan and Volena with their crazy pri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search for ski slopes from space</h1><div class="post__text post__text-html js-mediator-article">  If you like skiing or snowboarding on non-rolled slopes, or you are just tired of the boring ironed slopes of Sorochan and Volena with their crazy prices for lifts - then this article is for you. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e9c/d26/c42/e9cd26c425c74b572d602bbd8f446bed.jpg" alt="image"></div><br>  In February 2000, the Endeavor shuttle for 11 days filmed a topology of the earth using Spaceborne Imaging Radar-C / X-band Synthetic Aperture Radar.  See details <a href="https://en.wikipedia.org/wiki/Shuttle_Radar_Topography_Mission">here.</a> <br><br>  The result of this project was a publicly available database with data on the topology of the earth with the exception of its polar regions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The full data array is huge in size and operating with it within the PC is rather problematic.  Fortunately, on the <a href="http://srtm.csi.cgiar.org/SELECTION/inputCoord.asp">Consortium for Spatial Information</a> project site you can download a topological file for the area you are interested in. <br><br>  The data is available in ESRI GRID (ARC ASCII) format, which is a simple height matrix.  Each cell of the matrix has the same latitude and longitude.  The file consists of meta-information and a matrix of heights in 6001 rows and 6001 columns. <br><a name="habracut"></a><br>  Most likely the most suitable tool for solving this problem is Mathlab, but for lack of it - I used the improvised tools: MSSQL, Dapper, and the console application on .Net <br><br>  As a result, the task is divided into the following steps: <br><br><ol><li>  We upload data from a file into a table containing the height, the row and column number in the original matrix and the height. </li><li>  We start the SQL query for the selection of neighboring fragments, for which the height difference fits into the search criteria we are interested in. </li><li>  We launch the query on the search for chains from the fragments obtained in paragraph 2. </li><li>  We export chains of the necessary length in KML. </li></ol><br>  That data loading did not take the whole day - I used the package loader - SqlClient.SqlBulkCopy. <br><br>  Step 2 turned out to be the most resource-intensive. The first idea was to zadzhoynit the table on itself, approximately as follows: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Points p1 <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> Points p2 <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p1.row&lt;&gt;p2.row <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> p1.[<span class="hljs-keyword"><span class="hljs-keyword">Column</span></span>]&lt;&gt;p2.[<span class="hljs-keyword"><span class="hljs-keyword">Column</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> p2.row <span class="hljs-keyword"><span class="hljs-keyword">between</span></span> p1.row<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> p1.Row+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> p2.[<span class="hljs-keyword"><span class="hljs-keyword">Column</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">between</span></span> p1.[<span class="hljs-keyword"><span class="hljs-keyword">Column</span></span>]<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> p1.[<span class="hljs-keyword"><span class="hljs-keyword">Column</span></span>]+<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  However, on a table of 36,000,000 records, such a query is unbearably slow ‚Äî many, many hours.  Various experiments with indices did not give a significant increase in productivity. <br><br>  As always it happens - the simplest solution turned out to be the most effective: if you add a field with a counter to the table with dots - and then, knowing the number of columns in each row, you can write a label to search for neighboring IDs: <br><table><tbody><tr><td>  ID-6002 </td><td>  ID-6001 </td><td>  ID-6000 </td></tr><tr><td>  ID-1 </td><td>  <b>ID</b> </td><td>  ID + 1 </td></tr><tr><td>  ID + 6000 </td><td>  ID + 6001 </td><td>  ID + 6002 </td></tr></tbody></table><br>  Which allows to significantly simplify the JOIN: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Points p1 <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> Points p2 <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> (p2.id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (p1.id<span class="hljs-number"><span class="hljs-number">-6000</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>,p1.id<span class="hljs-number"><span class="hljs-number">-6000</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>,p1.id<span class="hljs-number"><span class="hljs-number">-6000</span></span>,p1.id<span class="hljs-number"><span class="hljs-number">-1</span></span>,p1.id+<span class="hljs-number"><span class="hljs-number">1</span></span>,p1.id+<span class="hljs-number"><span class="hljs-number">6000</span></span> ,p1.id+<span class="hljs-number"><span class="hljs-number">6000</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>,p1.id+<span class="hljs-number"><span class="hljs-number">6000</span></span>+<span class="hljs-number"><span class="hljs-number">2</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> p1.Elevation-p2.Elevation&gt;X</code> </pre> <br>  If there is an index on the ID field, such a query is quite effective and is processed in less than 15 minutes. <br><br>  For building chains of the fragments found earlier, a recursive CTE query of the following form turned out to be the most effective: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> chains (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>,id1,id2,<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>,parentID,alt) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> c1.id,c1.id1,c1.id2,<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>,c1.id <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parentID, c1.alt1 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> alt <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> candidates c1 <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> candidates c2 <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> c2.id2=c1.id1) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> candidates c2 <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> c2.id1=c1.id2) <span class="hljs-keyword"><span class="hljs-keyword">UNION</span></span> ALL <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> c1.id,c1.id1,c1.id2, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>,c2.id <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parentID,c1.alt2 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> alt <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> candidates c1 <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> chains c2 <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> c1.id1=c2.id2 ) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">distinct</span></span> p.*,<span class="hljs-keyword"><span class="hljs-keyword">level</span></span>,ParentID <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> chains c1 <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> candidates c2 <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> c1.id=c2.id <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> Points p <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> p.ID=c2.id1 <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> p.id=c2.id2</code> </pre><br>  Exporting to KML using the SharpKml library is extremely simple.  A Placemark object is created, which contains a LineString object containing previously calculated coordinates and height. <br><br><h3>  Search terms </h3><br>  To ski or board somewhere to go, and not just stuck in the snow, the slope should be at least 10-12 degrees, and that was at least some interest the length of the slope should be at least 200-300 meters. <br><br>  On the other hand - a slope of more than 35 degrees does not imply a relaxed skiing anymore - let's leave such cool to professionals. <br><br>  As an example, the characteristics of the same Sorochan <a href="http://turizm.ngs.ru/sorochany/skiing/">site</a> . <br><br><ul><li>  The length of the tracks: from 500 to 1000 meters. </li><li>  The width of the tracks: from 30 to 70 meters. </li><li>  Height difference: from 70 to 90 meters. </li><li>  Height above sea level: 230 meters. </li><li>  Average bias: 10-12 degrees. </li><li>  Maximum bias: 25 degrees. </li></ul><br><h3>  results </h3><br>  The highest point in the Moscow region is 317 meters, located in the station area of ‚Äã‚Äã147 km.  Mozhaiskogo direction ( <a href="https://www.google.com/maps/place/55%25C2%25B030%2740.5%2522N%2B35%25C2%25B028%2740.5%2522E/%4055.5112536,35.407879,12z/data%3D!4m5!3m4!1s0x0:0x0!8m2!3d55.5112506!4d35.4779168">map</a> ).  The lowest point is 75 meters ( <a href="https://www.google.com/maps/place/58%25C2%25B002%2737.5%2522N%2B38%25C2%25B053%2722.5%2522E/%4058.0492043,38.8260688,13z/data%3D!4m5!3m4!1s0x0:0x0!8m2!3d58.0437506!4d38.8895835">map</a> ), located within the boundaries of Rybinsk along the Volga. <br><br>  The slope with the largest drop in the 60 m and a length of 250 m is again on the banks of the Volga near the village of Chukavino, Tver region ( <a href="https://www.google.com/maps/place/56%25C2%25B034%2728.5%2522N%2B35%25C2%25B001%2731.7%2522E/%4056.5745919,34.9904601,13z/data%3D!4m5!3m4!1s0x0:0x0!8m2!3d56.574589!4d35.025479">map</a> ). <br><br>  Unfortunately, this slope, like most of the others with a good drop and a slope, is located along the river bank and is covered with forest, however I managed to find several theoretically suitable catable options: <br><table><tbody><tr><th>  Delta </th><th>  Slope length </th><th>  Coordinates </th><th>  Comment </th></tr><tr><td>  51 </td><td>  300 </td><td>  56 ¬∞ 16'4.70'';  38 ¬∞ 20'34.20'' </td><td>  Waterfall "Gremyachy" very beautiful place </td></tr><tr><td>  43 </td><td>  200 </td><td>  56 ¬∞ 26'22.08''C;  37 ¬∞ 50'37.35'' </td><td>  Village Starovo, Dmitrovsky district </td></tr><tr><td>  51 </td><td>  200 </td><td>  55 ¬∞ 38'21.04''C;  37 ¬∞ 51'37.99'' </td><td>  Dzerzhinsky quarry </td></tr><tr><td>  42 </td><td>  200 </td><td>  56 ¬∞ 28'55.13'';  38 ¬∞ 11'55.16'' </td><td>  Opposite Zagorskaya PSP.  D. Vypuklovo </td></tr><tr><td>  59 </td><td>  250 </td><td>  55 ¬∞ 17'28.08''C;  38 ¬∞ 43'5.33''B </td><td>  White Mountain.  Voskresensk </td></tr></tbody></table><br>  It goes without saying that the famous ski resorts were in the sample: <br><table><tbody><tr><th>  Resort </th><th>  Height, m </th><th>  Slope length, m </th></tr><tr><td>  Free </td><td>  42 </td><td>  200 </td></tr><tr><td>  Soros </td><td>  40 </td><td>  200 </td></tr><tr><td>  Chulkovo </td><td>  46 </td><td>  200 </td></tr><tr><td>  Vine </td><td>  42 </td><td>  200 </td></tr><tr><td>  Paramonovo </td><td>  50 </td><td>  250 </td></tr></tbody></table><br>  It should be taken into account that the indicated figures are inaccurate due to the specificity of the data: each ‚Äúsquare‚Äù in the height matrix has a side of 92.7 m. <br><br>  As a POC, I chose a slope in the vicinity of the village of Starovo, Dmitrovsky District. <br>  Local grandmothers said that here, during the time of the king of peas, the ski lift worked.  The slope is gently sloping, but rather long, overgrown with shrubs in the lower reaches.  Here, in the village, if you believe wikimapia has a base of hang gliders. <br><br>  Video testing of this slope can be found <a href="https://www.youtube.com/watch%3Fv%3Dw_KVbD4zoII%26t%3D6s">here</a> . <br><br>  ‚Üí <a href="https://github.com/ikanel/SlopesExplorer">Project address on githaba</a> <br>  ‚Üí <a href="https://drive.google.com/open%3Fid%3D0B-0gJ3Dj4T_iS0N3VWZkSmJrMjQ">Examples of generated KML files</a> <br>  ‚Üí <a href="https://drive.google.com/open%3Fid%3D0B-0gJ3Dj4T_iOXpVNFZ4RjhmaDA">Installer</a> </div><p>Source: <a href="https://habr.com/ru/post/324120/">https://habr.com/ru/post/324120/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324110/index.html">Liquid cooling of servers as an upward trend in equipment for data centers</a></li>
<li><a href="../324112/index.html">HPE Aruba and Cisco Controller Interfaces</a></li>
<li><a href="../324114/index.html">PVS-Studio: search for security defects</a></li>
<li><a href="../324116/index.html">FSE coding</a></li>
<li><a href="../324118/index.html">Difficulties in creating an isometric game in Unity</a></li>
<li><a href="../324122/index.html">Dark path</a></li>
<li><a href="../324124/index.html">Using the ArcGIS API for Python in Jupyter Notebook</a></li>
<li><a href="../324126/index.html">Logo is clothing</a></li>
<li><a href="../324128/index.html">Configure SSL VPN on the Cisco Router</a></li>
<li><a href="../324130/index.html">Criminal Code of the developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>