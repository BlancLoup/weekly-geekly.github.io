<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We type in LilyPond using midi-keyboard</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I already wrote a couple of times about lilypond, and now I bought a midi-keyboard. 

 Many music editors, including Finale and Sibelius, have the abi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We type in LilyPond using midi-keyboard</h1><div class="post__text post__text-html js-mediator-article">  I already wrote a <a href="http://habrahabr.ru/post/127238/">couple of</a> <a href="http://habrahabr.ru/post/145328/">times</a> about lilypond, and now I bought a midi-keyboard. <br><br>  Many music editors, including Finale and Sibelius, have the ability to type notes from the midi-keyboard as many as two ways: either you can play something under the metronome, and this will be immediately recorded with notes, or you can enter only notes, and rhythm and everything else is introduced in the usual way. <br><br>  I decided that a similar opportunity would not hurt for my preferred lilypond.  Since the ability to record a midi-file and then convert it with midi2ly does not suit me - too much information of exactly the type of information in the midi-file cannot be reflected (we already <a href="http://habrahabr.ru/post/145328/">discussed this</a> ) - I decided to write a program so that the keys and chords are immediately converted to the required format. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>UPD: Notebook is needed for about half of the following</b> <br><a name="habracut"></a><br>  The set in lilypond using the \ relative command allows you not to specify an octave for <i>each</i> note, but to indicate only the direction of the octave change.  Without such instructions, each next note (in the case of a chord, the sound indicated first) turns out to be no further than a quarter.  That is, the <i>fa</i> after d will be scored higher, even if the fa is sharp, and the d - flat (twice enlarged, but a quart, yes). <br><br>  Writing the program set before me the difficulty of two kinds: the actual work with the midi-keyboard and the conversion of the received signals into the desired form. <br><br><h4>  midi-dot-net: working with MIDI </h4><br>  First of all, I downloaded the <a href="http://code.google.com/p/midi-dot-net/">midi-dot-net</a> library.  It provides the possibility of both input and output, but we are now interested in input. <br><br><h5>  List of devices, opening and closing </h5><br>  The list of available input devices, I shoved it into the combo box. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Midi; <span class="hljs-comment"><span class="hljs-comment">// ....... private void LoadMidiDevices() { foreach (InputDevice d in InputDevice.InstalledDevices) { DeviceList.Items.Add(d.Name); } DeviceList.SelectedIndex = 0; UpdateDevice(); }</span></span></code> </pre> <br><br>  In addition to the device name, you can also find out the ManufacturerId, ProductId and all this together in one field Spec. <br><br>  The methods Open () and Close () open and close the device, the state can be obtained from the fields IsOpen, StartReceiving (), StopReceiving (), IsReceiving, respectively, are responsible for receiving information.  The library provides a convenient binding of events in the style of C #. <br><br>  The StartReceiving () method optionally accepts an object of type Clock, intended primarily for deferred MIDI output.  If you pass null, the timestamps in the events will be counted from the moment you call StartReceiving (). <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateDevice</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d.IsReceiving) d.StopReceiving(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d.IsOpen) d.Close(); } d = InputDevice.InstalledDevices[DeviceList.SelectedIndex]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!d.IsOpen) d.Open(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d.IsReceiving) d.StopReceiving(); d.StartReceiving(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { d.NoteOn += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputDevice.NoteOnHandler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.NoteOn); d.NoteOff += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputDevice.NoteOffHandler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.NoteOff); d.ControlChange += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputDevice.ControlChangeHandler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ControlChange); } }</code> </pre><br><br>  Do not forget to close the device upon exit. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SettingsWindow_FormClosing</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, FormClosingEventArgs e</span></span></span><span class="hljs-function">)</span></span> { d.StopReceiving(); d.Close(); }</code> </pre><br><br><h5>  Click processing </h5><br>  I chose the operation algorithm as such: when all the keys are released, those that were pressed for longer than 50 ms are transmitted to the converter in an entire ensemble and sent to the active window using SendKeys.  This makes it possible to score individual notes and chords. <br><br>  The implementation is simple to ugliness: <br><div class="spoiler">  <b class="spoiler_title">NoteOn // NoteOff</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Pitch&gt; notes; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Dictionary&lt;Pitch, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; events; <span class="hljs-comment"><span class="hljs-comment">//.... public void NoteOn(NoteOnMessage msg) { lock (this) { events[msg.Pitch] = msg.Time; } } public void NoteOff(NoteOffMessage msg) { lock (this) { if (events.ContainsKey(msg.Pitch)) { if (msg.Time - events[msg.Pitch] &gt; 0.05) { notes.Add(msg.Pitch); } events.Remove(msg.Pitch); if ((events.Count == 0) &amp;&amp; (notes.Count &gt; 0)) { SendKeys.SendWait(" " + cons.Convert(notes)); notes.Clear(); } } } }</span></span></code> </pre></div></div><br><br>  I also added the ability to set leagues (parentheses in the lilypond syntax) using the pedal (and in my case the buttons) sustain.  Since my keyboard is sending ControlChange two pieces each, I added an extra check. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> sustain; <span class="hljs-comment"><span class="hljs-comment">// ....... public void ControlChange(ControlChangeMessage msg) { if (msg.Control == Midi.Control.SustainPedal) { if ((msg.Value &gt; 64) &amp;&amp; !sustain) { sustain = true; SendKeys.SendWait("{(}"); } if ((msg.Value &lt; 64) &amp;&amp; sustain) { sustain = false; SendKeys.SendWait("{)}"); } } return; }</span></span></code> </pre><br><br>  The library also allows you to handle ProgramChange and PitchBend events. <br><br><h4>  We gnaw nuts of the elementary theory of music </h4><br>  The second task was more difficult than the first.  I added a counter to the window to indicate the number of characters and the switch in major minor and began to think. <br><br>  First of all, I created an intermediate link between the Midi.Pitch value and the output - the class of the gamma stage (lazy to look in the dictionary, I first named it Grade, but I had to Degree).  Depending on the key, we will convert Midi.Pitch to Degree. <br>  Arrays store the number conversion settings in the chromatic (12-step) scale to the 7-step scale and its alteration (increase or decrease). <br><div class="spoiler">  <b class="spoiler_title">PitchToGrade ()</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] majorScale = { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] majorAcc = { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] minorScale = { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] minorAcc = { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Degree </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PitchToGrade</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Pitch p</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//      int keybase = (keys * 7) % 12 - (isMajor?0:3); //          int offset = ((int)p - keybase) % 12; //     7-  int octave = (((int)p - keybase) / 12) * 7; int num, acc; if (offset &lt; 0) offset += 12; if (isMajor) { num = majorScale[offset] + octave; acc = majorAcc[offset]; } else { num = minorScale[offset] + octave; acc = minorAcc[offset]; } return new Degree(num, acc); }</span></span></code> </pre></div></div><br><br>  After that, the most unpleasant begins: to find out which note and with what sign it will denote the stage with this number and this alteration in the given key. <br><br>  The Degree class method works like this.  The fs variable contains the <i>minimum required number of characters in the key</i> , which is necessary so that this step in this key in the non-altered form has an alternation sign.  The Number variable stores the step number with respect to the octave, numMod without the count. <br><br>  In a magical way (adding the number of key signs multiplied by four and taking two in the case of a minor), the step number turns into a note number in the white-tone scale, and, if the variable fs says it is necessary, add a ‚Äúnative‚Äù alteration of the tonality. <br><div class="spoiler">  <b class="spoiler_title">resolveIn ()</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] Naturals = { <span class="hljs-string"><span class="hljs-string">"c"</span></span>, <span class="hljs-string"><span class="hljs-string">"d"</span></span>, <span class="hljs-string"><span class="hljs-string">"e"</span></span>, <span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"g"</span></span>, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-string"><span class="hljs-string">"h"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] Sharps = { <span class="hljs-string"><span class="hljs-string">"cis"</span></span>, <span class="hljs-string"><span class="hljs-string">"dis"</span></span>, <span class="hljs-string"><span class="hljs-string">"eis"</span></span>, <span class="hljs-string"><span class="hljs-string">"fis"</span></span>, <span class="hljs-string"><span class="hljs-string">"gis"</span></span>, <span class="hljs-string"><span class="hljs-string">"ais"</span></span>, <span class="hljs-string"><span class="hljs-string">"his"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] Flats = { <span class="hljs-string"><span class="hljs-string">"ces"</span></span>, <span class="hljs-string"><span class="hljs-string">"des"</span></span>, <span class="hljs-string"><span class="hljs-string">"es"</span></span>, <span class="hljs-string"><span class="hljs-string">"fes"</span></span>, <span class="hljs-string"><span class="hljs-string">"ges"</span></span>, <span class="hljs-string"><span class="hljs-string">"as"</span></span>, <span class="hljs-string"><span class="hljs-string">"b"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] DoubleSharps = { <span class="hljs-string"><span class="hljs-string">"cisis"</span></span>, <span class="hljs-string"><span class="hljs-string">"disis"</span></span>, <span class="hljs-string"><span class="hljs-string">"eisis"</span></span>, <span class="hljs-string"><span class="hljs-string">"fisis"</span></span>, <span class="hljs-string"><span class="hljs-string">"gisis"</span></span>, <span class="hljs-string"><span class="hljs-string">"aisis"</span></span>, <span class="hljs-string"><span class="hljs-string">"bisis"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] DoubleFlats = { <span class="hljs-string"><span class="hljs-string">"ceses"</span></span>, <span class="hljs-string"><span class="hljs-string">"deses"</span></span>, <span class="hljs-string"><span class="hljs-string">"eses"</span></span>, <span class="hljs-string"><span class="hljs-string">"feses"</span></span>, <span class="hljs-string"><span class="hljs-string">"geses"</span></span>, <span class="hljs-string"><span class="hljs-string">"ases"</span></span>, <span class="hljs-string"><span class="hljs-string">"beses"</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolveIn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> keys, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isMajor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fAcc = Acc; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fs; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fNum; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> numMod = Number % <span class="hljs-number"><span class="hljs-number">7</span></span>; fs = isMajor ? <span class="hljs-number"><span class="hljs-number">6</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>; fs = (fs - <span class="hljs-number"><span class="hljs-number">2</span></span>*numMod) % <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fs &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) fs += <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (keys &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) fs = <span class="hljs-number"><span class="hljs-number">8</span></span> - fs; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fs &lt;= Math.Abs(keys)) fAcc += keys / Math.Abs(keys); fNum = (numMod + keys*<span class="hljs-number"><span class="hljs-number">4</span></span> - (isMajor ? <span class="hljs-number"><span class="hljs-number">0</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>)) % <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fNum &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) fNum += <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (fAcc) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">-2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DoubleFlats[fNum]; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Flats[fNum]; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Naturals[fNum]; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Sharps[fNum]; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DoubleSharps[fNum]; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; } }</code> </pre></div></div><br><br>  The rest is simple: the need to add pitch-change characters is calculated by the step subtraction operator, and the last height is stored in the lastPitch field: <div class="spoiler">  <b class="spoiler_title">Convert () and everything else</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// class Degree public static String operator -(Degree a, Degree g) { int o; o = a.Number - g.Number; o = (int)Math.Round((double)o / 7.0); if (o &gt; 0) return new String('\'', o); if (o &lt; 0) return new String(',', -o); return ""; } // class PitchConsumer public String Convert(List&lt;Pitch&gt; pitches) { Pitch localLast = lastPitch; String accum; if ((int)lastPitch == 0) lastPitch = pitches[0]; pitches.Sort(); if (pitches.Count == 1) { accum = PitchToString(pitches[0], lastPitch); lastPitch = pitches[0]; } else { lastPitch = pitches[0]; accum = "&lt;"; foreach (Pitch p in pitches) { if (accum.Length &gt; 1) accum += " "; accum += PitchToString(p, localLast); localLast = p; } accum += "&gt;"; } return accum; } private String PitchToString(Pitch p, Pitch last) { Degree g, glast; String note; g = PitchToGrade(p); glast = PitchToGrade(last); note = g.resolveIn(keys, isMajor); return note + (g - glast); }</span></span></code> </pre><br></div></div><br><br><h4>  findings </h4><br>  The difficulty lay in wait for me not in the area where I was not sure, but in what is the subject of my specialty.  But now I understand better how difficult it is for children in a music school :-).  And it became really faster to type notes. <br><br>  <a href="https://github.com/m0003r/LilyInput">https://github.com/m0003r/LilyInput</a> </div><p>Source: <a href="https://habr.com/ru/post/149075/">https://habr.com/ru/post/149075/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149063/index.html">Custom jUnit processing of tests in TeamCity</a></li>
<li><a href="../149066/index.html">Parameterized queries and django orm performance</a></li>
<li><a href="../149068/index.html">Siemens SGold: Hacking Through Java</a></li>
<li><a href="../149071/index.html">Create a game on SFML</a></li>
<li><a href="../149074/index.html">How it's made for programmers. Series number 2</a></li>
<li><a href="../149076/index.html">Parse the consequences of hacking MS-CHAPv2 for Wi-Fi (WPA / WPA2-Enterprise)</a></li>
<li><a href="../149077/index.html">Python Sockets for Beginners</a></li>
<li><a href="../149080/index.html">Facebook admitted that 83 million user accounts are fake</a></li>
<li><a href="../149081/index.html">Unusual XSS vulnerabilities</a></li>
<li><a href="../149082/index.html">Free JavaScript Books</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>