<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to run unsigned code on Xbox 360</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every game console trying to break. Enthusiasts who want to run self-written code on it in all the most secure modes try to break. Enthusiasts who wan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to run unsigned code on Xbox 360</h1><div class="post__text post__text-html js-mediator-article">  Every game console trying to break.  Enthusiasts who want to run self-written code on it in all the most secure modes try to break.  Enthusiasts who want to ‚Äúrun backups of games on it‚Äù (or, in Russian, engage in piracy) are trying to break.  Enthusiasts who want to install Linux and, besides an end in themselves, try to use more widely than the console manufacturer would like (since money is earned primarily from games, the console itself is sold with a minimum markup, or even minus to the manufacturer). <br>  Overwhelmingly, enthusiasts succeed. <br><br>  This is how the most interesting part of the Xbox 360 hacking was done - running code that was not signed by MS. <br><br><a name="habracut"></a><br><h4>  Hacking for piracy </h4><br>  Two years ago, Xbox360 broke for piracy, that is, they learned how to run copies of licensed games recorded on discs.  I wrote <a href="http://sim0nsays.livejournal.com/1070.html">about the</a> details <a href="http://sim0nsays.livejournal.com/1070.html">here</a> .  In short, the licensing of the disk was entirely determined by the DVD-ROM firmware and the xbox itself transmitted only one digit ‚Äî a good disk or not.  If the firmware is altered so that it always returns the figure corresponding to the license disk - voila.  In those versions, the firmware chip could simply be pulled out and altered. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since then, much has changed at the same time and not much - MS had a great engineering solution to fill in a chip with black epoxy firmware (we still need to know whose solution was very Russian), but it turned out that you can change the firmware by hooking up the DVD-ROM from the xbox to PC.  In each update, the firmware was rewritten, but it was enough to re-upload.  And it continues to work with Live. <br><br>  On the other hand, they began to ban for pirated firmware, in partisan ways.  That is, in the new updates there is some code that indirectly determines the firmware and sends this information to the server.  At one point, accumulated consoles are banned from Xbox Live (namely, consoles, not accounts).  With this software, MS managed to turn the game into cat and mouse - you can install the latest version of the firmware, but this does not guarantee that MS will not find indirect signs of its detection and in the end will not ban the console.  Both hacking tools are being improved, that is, they give less indirect effects, and software detection tools. <br><br>  Nevertheless, the vulnerability is very serious, as such could leave - I do not understand.  My only version - was in a hurry to bring the console to the market. <br>  <b>Nevertheless, from the release to the launch of the pirated game - 4 months.</b> <br><br>  All this was already two years ago, but this hack did not give an opportunity to run its code on the box, only an exact copy of the game code.  But we understand that a certain part of humanity does not agree to consider any piece of hardware worth living until Linux is running on it, and is ready to work on it.  And for this you must inevitably be able to run your code. <br><br><h4>  Let's take a quick look at how the security model is arranged on the xbox360 to describe roughly why this is difficult. </h4><br>  First, the binary on the hellish disk is encrypted, the public key is stitched somewhere in the silicone of the console, and the private key is stored deep in the depths of the home office.  All the binaries of all games are encrypted with a super secret key in the super-sector lab before release.  Get the key is unrealistic. <br><br>  The code that decrypts and checks the binary sits deep in the ROM console and is encrypted / checked and double-checked with iron.  Each update is able to register a new code there, because it was originally prepared in the same super-secret laboratory.  To replace this code is unreal. <br><br>  The game itself always starts in unprivileged mode, with read-only access on memory pages with code and the lack of an execute-flag on data and stack, that is, it is impossible to either write code in the data and transfer control there (the classic buffer overflow case) or replace the downloaded code is yours (because read-only).  Moreover, the entire executable code is also constantly hanging in the memory of an encrypted key, which is randomly generated by each launch (hardware feature of the processor) in order to protect against memory scratching by physical methods (roughly speaking, with a soldering iron). <br><br>  Everything related to encryption and decryption is performed in the hypervisor mode, in which there is never a game code, but only the firmware code.  As I understand it, he is just engaged in decoding the binary and other security stuff.  It has no such restrictions, but of course the code of the game in this mode will never break through and nothing will be written there. <br><br>  It would seem that all backed up.  The code of the game cannot be faked, even if something is cool to screw up the data, neither buffer overrun nor code modification will help.  Even from a physical attack - and they were saved. <br><br><h4>  How in this situation could all profkapit? </h4><br>  The main document describing the vulnerability is <a href="http://www.securityfocus.com/archive/1/461489/30/0/threaded">here</a> . <br>  In short, in one of the firmware versions there was an incorrect check in the most important syscall command - the system function call from the game code.  This command is given the number of the function and its arguments, and it pulls out its address from a protected sign, and transfers control to it in all authorities.  The problem was that when checking the function number for validity, the 32-bit command was used, and in the offset calculation, the 64-bit command was used.  And then you can pass the number of the function, which has some non-zero upper bits, the number will go to the offset calculation, and thus will point to memory, which is interpreted as data and is not encrypted with hardware protection.  The address of the function will be taken from this memory, and called up in hypervisor mode, even if this address is in the data.  If in the right place of memory there will be a pointer to your own code - voila. <br><br>  This is not a vulnerability, it is necessary to figure out how to put this data there.  This is not so trivial - the code cannot be modified, but the game data can be changed on the disk so that it writes the necessary bytes with the necessary addresses and calls syscall - a very long and complicated analysis at random. <br><br>  Do you know how they did it?  This most fascinates me in this whole story. <br>  Made shaders. <br><br>  All shaders - of course, the resources on the disk and, like all resources, are not encrypted, but they remain shaders, that is, the microcode of the video card.  And on the xbox360 is a smart GPU, it can read and write to the memory from the shader.  Moreover, the memory of the CPU and the GPU is shared, which means that the CPU memory can also be assigned from the shader to the correct address.  Knowing where the code is often happens, you can also stack the stack so that it ret ret already on syscall with the correct arguments taken from the same stack. <br>  This happened to be done in practice with King Kong Demo ( <a href="http://www.xbox-scene.com/xbox1data/sep/EEZklEuAkAzUotmeVt.php">http://www.xbox-scene.com/xbox1data/sep/EEZklEuAkAzUotmeVt.php</a> ) <br>  I note that this requires knowing very deep details about the code of the game, i.e.  to know what place to stack the stack is hardly possible without access to the game code and the devkit. <br><br>  At first, this all worked only on strictly defined versions of the firmware, where there was a bug with syscall (no longer current), but six months later, the possibility of console downgrade to the original firmware version was <a href="http://www.xbox-scene.com/xbox1data/sep/EEApuFVAEZoyUVvULE.php">discovered</a> , from where you can upgrade to a version with a vulnerability. <br><br>  As a result, the exploit works by replacing the shader in King Kong, which writes the executable code into memory, and the stack in a strictly defined place to call the system function, which, because of a bug in the firmware, will transfer control to that code with the system's permissions.  Fuck up  Lived, the hacker from the shader.  We've been behind the GPU. <br><br><h4>  Total </h4><br>  And so it turned out to make the first hello world with its code, and after that, even before <a href="http://www.xbox-scene.com/xbox1data/sep/EEZulZpFEFhdsRTZhB.php">working Ubuntu was close</a> , and to collect the community technology business ( <a href="http://www.free60.org/">http://www.free60.org</a> ). <br><br>  Actually, everything.  For even counting - let him hold out for a year and a half before launching a third-party code.  And after all, damn it, everything was correctly and sanctioned, and they were propped up everywhere.  One most important command for the entire system - and in it a critical bug. <br>  What the fuck is that, huh? .. <br></div><p>Source: <a href="https://habr.com/ru/post/43285/">https://habr.com/ru/post/43285/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432840/index.html">How to improve the efficiency of learning English and start writing better: choose an online assistant</a></li>
<li><a href="../432842/index.html">Some notes on the design of information systems</a></li>
<li><a href="../432844/index.html">Pre-project survey in the development of an information system</a></li>
<li><a href="../432846/index.html">Noam Chomsky: where did artificial intelligence go wrong?</a></li>
<li><a href="../432848/index.html">Gocritic's journey into the past</a></li>
<li><a href="../432852/index.html">Development of technical specifications according to GOST 34 is easy and simple</a></li>
<li><a href="../432858/index.html">Very corporate post 2: opening report in Moscow</a></li>
<li><a href="../43286/index.html">To whom to register a domain, if two partners are equal?</a></li>
<li><a href="../432860/index.html">PlayStation Classic hacked, now games can be run from a flash drive</a></li>
<li><a href="../432862/index.html">The prototype of the citizen‚Äôs digital profile platform will be launched in Russia by the end of 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>