<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Give me the iron! Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1 

 So, we bought all the necessary. It is time to deploy an experimental laboratory! 

 We put the software that comes with the programmer: PIC...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Give me the iron! Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/ba/d5/bad53bdb13e974e4c0c798c300ab18bf.png" alt="Give me the iron!"><br><br>  <a href="http://habrahabr.ru/blogs/controllers/112414/">Part 1</a> <br><br>  So, we bought all the necessary.  It is time to deploy an experimental laboratory! <br><a name="habracut"></a><br>  We put the software that comes with the programmer: PICKit2 Utility and MPLAB IDE.  The first is the utility for working with the programmer, the second is the development environment.  PICKit2 Utility, in principle, we do not need, but there is one point that I will mention later.  For now, let's move our attention to MPLAB IDE. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  MPLAB IDE </h4><br>  Open the development environment and create a new project.  One of the drawbacks of this IDE is the lack of sticky panels; instead, we have a jumble of windows.  To be able to live on, I arranged everything in the usual way (the window was reduced so that the picture would fit): <br><br><img src="https://habrastorage.org/storage/habraeffect/dc/e6/dce673473dd4e64cf1b1271fda389d64.png" alt="MPLAB IDE"><br><br>  <b>upd:</b> everything sticks perfectly!  We click on the icon in the upper left corner of the window, select Dockable in the menu, then drag it to the border.  Thank you <a href="https://habrahabr.ru/users/lunatik42/" class="user_link">lunatik42</a> for the info! <br><br>  <i>File&gt; New</i> ;  <i>File&gt; Save as ...</i> , select the Assembly type, set the Add to project checkbox.  Yes, we will code in assembler. <br><br>  You also need to specify the IDE that we use the assembler. <br><br>  We go to <i>Project&gt; Select Language Toolsuite ...</i> and select Microchip MPASM Toolsuite: <br><br><img src="https://habrastorage.org/storage/habraeffect/f5/f7/f5f77a5cef0825fc0b5eedc300836183.png" alt="Microchip MPASM Toolsuite"><br><br>  Now go to <i>Project&gt; Build options ...&gt; Project</i> , there we have compilation settings.  On the ‚ÄúMPASM / C17 / C18 Suite‚Äù tab, select the absolute code generation: <br><br><img src="https://habrastorage.org/storage/habraeffect/11/6b/116b18bf8efe36a6ca7fa19d645a85f7.png" alt="Absolute code"><br><br>  When writing absolute code, we can specify for ourselves which addresses our code and data are located at.  When writing portable code, the compiler steers memory itself, but for this it is necessary to bathe with sections, so far we don‚Äôt need it. <br><br>  On the MPLAB Assembler tab, you can disable case-sensitive variables.  I decided not to disconnect. <br><br>  Well, to make life easier, we go to <i>Edit&gt; Properties ...</i> There we set the display of line numbers and change the font to taste.  I put Lucida Console 8 pins to fit more code into the window. <br><br><h4>  Again materiel </h4><br>  Our current task is to write the minimum amount of code that will be compiled to try to flash the controller.  As a result, we will get several lines of code, but to write them you will have to read a lot of documentation.  We need two sources: the <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/41236E.pdf">datasheet</a> and the built-in IDE manuals ( <i>Help&gt; Topics ...&gt; MPLAB Assembler</i> ), which open in a separate window and do not interfere with the process.  There is a table with a set of commands and a description of all directives;  If you find an incomprehensible word in the code, then after interpretation it is necessary to climb there. <br><br>  In the ‚Äú8.0 Instruction Set Summary‚Äù section of the datasheet, a detailed description of the command system is given, I recommend to carefully read this section. <br><br><h4>  Minimum code </h4><br>  Okay, you can finally do a little bit - we can do it! <br><br>  Let's start from the end and write a single line: <br><br><blockquote><pre>  end </pre></blockquote><br>  We compile on F10, we get a successful build and an error, saying that it‚Äôs impossible to load something there.  We also get the Vorning from the compiler, which does not like the directives at the beginning of the line - this is not a problem, we shift our end by one tab.  As for the error, its reason is in the absence of the configuration of the stone.  The config is essentially a 12-bit word that is written into the stone during the firmware; in AVR stones, this is called fuse-bits.  The meaning of each bit is described in the datasheet, section "7.1 Configuration Bits". <br><br>  And now the quest for attention!  What did we forget to do?  We forgot to specify under which stone our code should be collected.  To do this, go to <i>Configure&gt; Select Device ...</i> and select our stone - PIC12F509.  The IDE boasts a bunch of possibilities that it provides for this stone: <br><br><img src="https://habrastorage.org/storage/habraeffect/58/3d/583dfc61005ff0804d107022fe732b56.png" alt="Target Device Selection"><br><br>  But what if we suddenly want to use a different development environment?  To do this, we can specify the type of stone directly in the code, this is done using the list directive.  After reading the manuals for this directive, it becomes clear that you need to write the following (do not forget about the tab at the beginning): <br><br><blockquote><pre>  list p = 12f509 </pre></blockquote><br>  <sub>The type of stone specified in the settings is transmitted to the compiler via the command line, and it has higher priority over the list directive.</sub>  <sub>Therefore, if you specify one stone in the settings, and write another in the directive, the code will be compiled under the stone specified in the settings, while the compiler will issue the ‚ÄúProcessor superseded by command line.‚Äù</sub>  <sub>Verify processor symbol ".</sub> <br><br>  Stone, we have indicated.  Now we recall that in the section ‚Äú4.3 Data Memory Organization‚Äù it is written that the registers of our stone lie in the address space of the data memory.  To access them by name, not by address, we include the header file: <br><br><blockquote><pre>  #include p12f509.inc </pre></blockquote><br>  In addition to the addresses of registers, the numbers of configuration bits are written there - what we need right now.  You can also add this file to the project in order to see all the constants defined by it in the symbol list. <br><br>  Now we can set the configuration.  It can be specified in <i>Configure&gt; Configuration bits ...</i> , but for better portability and easier access, it is better to do it right in the code, for which the __config directive will help us.  Open our incloud and look at the section "Configuration bits".  Bits are named according to datasheet. <br><br>  We need the following configuration: MCLR is disabled (works like a normal pin), code protection is disabled, the watchdog timer is disabled, an internal generator is used for clocking.  Thus, our config will take the following form: <br><br><blockquote><pre>  __config _IntRC_OSC &amp; _CP_OFF ‚Äã‚Äã&amp; _WDT_OFF &amp; _MCLRE_OFF </pre></blockquote><br>  <sub>Note that the values ‚Äã‚Äãare combined with an ‚ÄúAND‚Äù.</sub>  <sub>At first, out of habit, I wrote everything through ‚ÄúOR‚Äù, and then I wondered for a long time why nothing worked.</sub> <br><br>  So, this is what we ended up with: <br><br><blockquote><pre>  list p = 12f509
	
	 #include p12f509.inc

	 __config _IntRC_OSC &amp; _CP_OFF ‚Äã‚Äã&amp; _WDT_OFF &amp; _MCLRE_OFF
	
	 end </pre></blockquote><br>  Compile ... successfully!  As I promised, a few lines and a lot of documentation. <br><br><h4>  Take the iron </h4><br>  That is the moment you have been waiting for!  If you scroll the page in search of the place where the story finally reaches iron, then it's time to stop and start reading :) <br><br>  So, we have a programmer, a microcontroller, a program and unhealthy enthusiasm to combine it all.  And now we are tormented by only one question: what to connect with? <br><br>  We climb to the datasheet, section 7.12 ‚ÄúIn-Circuit Serial Programming‚Äù and see the following image: <br><br><img src="https://habrastorage.org/storage/habraeffect/4e/07/4e07aebc6b42bc6069c1e4f0ce48dad1.png" alt="Connecting a programmer with a microcontroller"><br><br>  We don't have Normal Connections yet, so we only look at the connection of the legs of the programmer with the feet of the stone.  Okay, what with the connection we realized, now we need to find where these pins grow from on the stone and on the programmer. <br><br>  From the <a href="http://pickit2.ru/doku.php/%25D1%2580%25D1%2583%25D0%25BA%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B4%25D1%2581%25D1%2582%25D0%25B2%25D0%25BE.%25D0%25BF%25D0%25BE%25D0%25BB%25D1%258C%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2582%25D0%25B5%25D0%25BB%25D1%258F.pickit2">manuals</a> to the programmer, we learn the purpose of his conclusions: <br><br><img src="https://habrastorage.org/storage/habraeffect/ab/10/ab1087a935cb1eb2f62ba91ac4fd0a4e.png" alt="Conclusions PICKit2"><br><br>  In the datasheet (section ‚ÄúPin Diagrams‚Äù) we see the microcontroller outputs: <br><br><img src="https://habrastorage.org/storage/habraeffect/b3/4b/b34b337d93848792f94fa9a1442934d7.png" alt="Conclusions of PIC12F509"><br><br>  Now we look at the stone. <br><br><img src="https://habrastorage.org/storage/habraeffect/2f/a5/2fa58aad50de4d9e22d1aa76e88ec625.png" alt="PIC12F509"><br><br>  We are perplexed.  Well, at what corner does he have the first conclusion?  Where is the top and where is the bottom?  To understand this, we climb into Wikipedia and read about the <a href="http://ru.wikipedia.org/wiki/DIP">DIP-package</a> .  From there we learn that the pins are numbered counterclockwise from the semicircular serif: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/558/174/421/558174421fe00d0c3fc33568ae94b621.png" alt="Pin Numbering of DIP Chips"><br><br>  It turns out that the caring guys from Microchip even put a dot for us near the first output. <br><br>  We finally get a breadboard!  I connected everything as follows: <br><br><img src="https://habrastorage.org/storage/habraeffect/1d/b5/1db5a5d7062d637f0736d5cce631c5ff.png" alt="The scheme of connecting the stone with the programmer"><br><br>  The same is true in augmented reality, as <a href="https://habrahabr.ru/users/rule/" class="user_link">rule has</a> quite accurately put it: <br><br><img src="https://habrastorage.org/storage/habraeffect/aa/c1/aac142dbecd1ccb01a6f36a701720c7b.png" alt="Scheme with explanations"><br><br><h4>  Stitching </h4><br>  We are just a few clicks from the long-awaited result!  So, we connect our programmer, if it is not yet connected, then in MPLAB we climb in the Programmer menu and select our programmer - PICKit2.  A programmer's messages tab will open in the output window, where he will cheerfully report on his readiness.  And we will have this panel to control the programmer: <br><br><img src="https://habrastorage.org/storage/habraeffect/9d/72/9d7268f6bfc146921df301e4b68447d6.png" alt="PICKit2 control panel"><br><br>  We need the leftmost button - ‚ÄúProgram the target device‚Äù.  Click! <br><br>  If we did everything right, a progress bar will run down below, and messages on the mashing and writing of program memory will appear in the output window.  My congratulations, the stone is stitched!  :) <br><br>  In the next part, we will write HelloWorld, and I will also tell you why we might still need the PICKit2 Utility.  See you! <br><br>  <sub>The end of the second part.</sub> <br><br>  <a href="http://habrahabr.ru/blogs/controllers/112414/">Part 1</a> </div><p>Source: <a href="https://habr.com/ru/post/112467/">https://habr.com/ru/post/112467/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112461/index.html">ArchBang Release 2011.01 - Symbiosis</a></li>
<li><a href="../112462/index.html">How do you feel about team building training for IT teams (extreme, rope courses)?</a></li>
<li><a href="../112463/index.html">Google Voice in Gmail</a></li>
<li><a href="../112464/index.html">Linq To Tasks and the continuation monad</a></li>
<li><a href="../112466/index.html">AspectJ, Spring, Maven</a></li>
<li><a href="../112468/index.html">Clean SEO. rest in peace</a></li>
<li><a href="../112469/index.html">Hosting 3D Viewpot Models</a></li>
<li><a href="../112470/index.html">British providers are going to make pay for warnings of users about copyright infringement</a></li>
<li><a href="../112472/index.html">Meet FIDOSlax Linux - an operating system with integrated hypertext Fidonet support</a></li>
<li><a href="../112474/index.html">Collection of tips and facts on optimizing PHP scripts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>