<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>continuation and stateful web programming (Updated!)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The idea is not new at all. The idea is ancient. 
 However, most observables around web frameworks persistently ignore this idea. 

 It is to use cont...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>continuation and stateful web programming (Updated!)</h1><div class="post__text post__text-html js-mediator-article"> The idea is not new at all.  The idea is ancient. <br>  However, most observables around web frameworks persistently ignore this idea. <br><br>  It is to use continuations to magically transform RESTful (stateless) web applications into a more convenient and familiar stateful format. <br><a name="habracut"></a><br>  In essence, the ‚Äúsession‚Äù was designed to store the execution status of the web application. <br>  And its use is stupid as a data set - solely due to the lack of full-featured sequels in the language. <br><br>  Continuation is the state of application execution at the language level. <br>  In the scheme, it is supported as first-class objects ‚Äî they can be returned from functions, passed as function parameters, and finally called as functions. <br>  When calling a continuation, the application returns to the place where the continuation was created, and continues to run from there. <br>  And this can be done more than once. <br>  In a way - these are exceptions, but acting in reverse. <br>  An exception occurs at some point in the program and passes control somewhere outside - where the handler is installed. <br>  Continuation occurs at some point in the program and allows you to transfer control back to this point.  The program in this place will take it as it was. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For example, in python, this is implemented by the yield statement. <br>  The function containing yield is considered an ‚Äúiterator generator‚Äù, its execution is terminated at the first operator, yield, and the function returns an object of type iterator to which you can use next () to call the next iteration, and send (values) to return the value to the transition point by yield . <br>  An iterator call with the next () and send () methods returns the next, next, value. <br>  Iterators can be used to iterate numbers (and it can be incredibly fun, if the numbers are, say, fibonacci, and there is an infinite number of them), you can do a tree walk, you can <a href="http://habrahabr.ru/blogs/python/50026/">iterate everything</a> . <br>  Likewise, an iterator can generate not numbers or nodes of a tree, but web pages. <br><br>  For example, functions for viewing resources and putting them in the shopping cart might look like this: <br><pre> <code class="hljs lua">browse_stuff(): #             criteria = <span class="hljs-built_in"><span class="hljs-built_in">yield</span></span>(ask_criteria()) #     results = find_stuff(criteria) #     ,     -   <span class="hljs-built_in"><span class="hljs-built_in">yield</span></span> (list_stuff(results)) #     raise StopIteration() def buy_stuff(continuation, item) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> user.authentificated: #     ,  ,  user = <span class="hljs-built_in"><span class="hljs-built_in">yield</span></span>(login_form(user)) #   ,   ,    # ,  quantity = <span class="hljs-built_in"><span class="hljs-built_in">yield</span></span>(ask_quantity()) # ,   delivery = <span class="hljs-built_in"><span class="hljs-built_in">yield</span></span>(ask_delivery()) #   money = <span class="hljs-built_in"><span class="hljs-built_in">yield</span></span>(ask_payment()) #   <span class="hljs-built_in"><span class="hljs-built_in">status</span></span> = launch_order(item,quantity,delivery,money) #     <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-built_in"><span class="hljs-built_in">yield</span></span>(message(<span class="hljs-string"><span class="hljs-string">"  .  ."</span></span>)) #  ,     (  browse_stuff) continuation.<span class="hljs-built_in"><span class="hljs-built_in">next</span></span>() # ,     <span class="hljs-string"><span class="hljs-string">" "</span></span> ?</code> </pre><br>  The parameter continuation is the state of the application (execution of another function) in the place where the transition to the link ‚Äúbuy crap‚Äù was made. <br><br>  The main application in this situation looks like an iterator. <br>  cont = browse_stuff_iter () <br>  The cont object is saved in a session, or somewhere else, and is restored every time a client accesses it. <br>  Or, several objects are saved, and their identifiers are encoded in URLs, stuck in hidden form fields, so that when the ‚Äúback‚Äù button is pressed, the user does not just see the previous page, but actually returns to the previous state of the application. <br><br>  On a GET request, cont.next () is called. <br>  On a POST request, cont.send is called (form data) <br>  The results of these calls are displayed as pages. <br>  This method allows you to generate a chain of forms as in buy_stuff () <br>  When clicking on a new link, this is regarded as an interrupt and the current state is passed to the handler: buy_stuff (cont, item) <br><br><blockquote>  Upd: <br>  It is worth noting that neither in python, nor tembolee in pkhp, nor in Zhaveh, there is no <u>full</u> support for sequels, at the level of first-class objects. <br>  Python's yield behaves very similarly and was used to illustrate an idea. <br>  How it will work in reality is not entirely clear. <br><br>  Full support for continuations is available in <a href="http://en.wikipedia.org/wiki/Continuations">various exotic languages</a> , but also in Ruby as well. <br>  There are <a href="http://en.wikipedia.org/wiki/Continuations">several servers with continuation support</a> for the scheme, lisp, smalltalk, OCaml and JavaScript. <br>  Somewhere in the comments a link to a simple PHP emulator was lost. </blockquote><br><br>  <b>The future of the web is unequivocally behind the language, supporting full-fledged continuations!</b> <br><br>  Especially if we recall that in a language that supports continuations as first-class objects, no other constructions, by and large, are generally needed (including even data structuring, encapsulation and inheritance constructions) - they are all implemented through continuations (and as a special case - functional closure)) <br><br>  Well, as is usually the case, such thoughts have already been expressed in a more structured and consistent manner :) <br><br>  List of unused literature: <br><ul><li>  <a href="http://www.ibm.com/developerworks/ru/library/j-cb03216/index.html%3Fca%3Ddrs-ru">Crossing Borders: Continuation, Web Development, and Java Programming</a> </li><li>  <a href="http://www.double.co.nz/pdf/inverting-back-the-inversion.pdf">Continuing versus page-centric programming.</a> </li></ul><br><br><blockquote>  mega-UPD: illustration of the scheme <br>  I can not vouch for the correctness of the code.  but the brackets are balanced :) <br><pre> ;;  server code
 (define (uri-&gt; cont uri) "get from where the continuation by its URI")
 (define (cont-&gt; uri cont) "saves a continuation somewhere and forms URIs for it)<font></font>
<font></font>
 (define (insert-uri tmpl uri) "inserts a link into a template")
 (define (render-page tmpl args) "renders the page in html")<font></font>
<font></font>
 (define (handle-request request) "causes a continuation, passing request to it"
   (if (eqv? (get-uri request) init-uri));  if the request is a starting URI
       (start);  cause start
       ((uri-&gt; cont (get-uri request)) request)));  otherwise - continued<font></font>
<font></font>
 (define (make-response cont template) "template: a page with links or a form.
   (render-page (insert-uri template (cont-&gt; uri cont))))
 ;;  end of server code<font></font>
<font></font>
 ;;  application code
 (define (quest room)
   (define (parse-request request) "parses the form data or chonit and returns the choice")
   (define (walk-on choice) "selects a new room for the current and choice")
   (define (get-page) "returns the html template for the current room")
   (define (response cc) (make-response cc (get-page)) "stupid parameter karring")
   (quest (walk-on (parse-request (call / cc response))))))<font></font>
<font></font>
 ;;  initialization code
 (define init-uri "/ mytextquest")
 (define (start) (quest 'start-room))
</pre><br>  What is going on here (should be happening): <br>  0. quest is called with a parameter identifying the room. <br>  0.5 the only call is the last, the most extreme parameter - the expression (call / cc (response)) <br>  <b>1. call / cc (this is a special construct that) calls a function (response continuation)</b> <br>  2. that in turn calls (make-response continuation template) <br>  3. make-response inserts into the template (for example, in the action field, or in the navigation links) a URI identifying this continuation. <br>  4. page rendered <br>  5. The user clicks on one of the links on the page or submits the form. <br>  6. handle-request by clicking on the link continued <br>  7. and calls it with the request parameter <br>  <b>8. execution continues from the point where call / cc stands.</b>  <b>the request value is substituted as the result of the call / cc call</b> <br>  9. request is parsed and we get the logic of what the user there has poked <br>  10. walk-on calculates which room the user is in now <br>  11. quest recursively called with a parameter that identifies the next room. <br><br>  If, besides the room, the karma of the user influences the choice of path  the contents of the pockets.  and the state of the surrounding ecology - all this is encapsulated in a 'room'. <br>  If the user pressed 'back' and switched to the previous URI, the previous state is pulled out and it really falls into the previous room, all the affected animals come alive, and so on. <br></blockquote></div><p>Source: <a href="https://habr.com/ru/post/50204/">https://habr.com/ru/post/50204/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../50196/index.html">Calculating the value of an expression</a></li>
<li><a href="../50197/index.html">little bit about the SPARQL access point</a></li>
<li><a href="../50198/index.html">Cable Management</a></li>
<li><a href="../50199/index.html">Aptana - creating plugins</a></li>
<li><a href="../50202/index.html">The Internet is the first billion users.</a></li>
<li><a href="../50206/index.html">Student's day</a></li>
<li><a href="../50210/index.html">YASS Architecture Part 3: the problem of choice</a></li>
<li><a href="../50212/index.html">Tag Cloud Tagging</a></li>
<li><a href="../50215/index.html">NetWorm.Win32.Kido Network Worm Epidemic & Disinfection Utility</a></li>
<li><a href="../50216/index.html">PHP + Twitter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>