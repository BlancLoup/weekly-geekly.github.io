<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Embedded Languages: Why Lua?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This material continues a series of publications based on the reports that we made at the Games Gathering 2017 conference last December. One of the re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Embedded Languages: Why Lua?</h1><div class="post__text post__text-html js-mediator-article">  This material continues a series of publications based on the reports that we made at the Games Gathering 2017 conference last December.  One of the <a href="https://www.youtube.com/watch%3Fv%3D6jfzKSDnf6Q">reports</a> touched upon the topic of choosing an embedded scripting language. <br><br> <a href="https://habr.com/company/socialquantum/blog/428253/"><img src="https://habrastorage.org/webt/ww/60/rx/ww60rxe5pnzr9nwbvd00owsydby.png"></a> <br><a name="habracut"></a><br><h2>  What are scripting languages ‚Äã‚Äãand why? </h2><br>  As mentioned in the <a href="https://habr.com/company/socialquantum/blog/423175/">previous post of our blog</a> , our company has its own engine.  Today we will talk about how we were guided when choosing a scripting language for this engine. <br><br>  Why is there a need for scripting languages ‚Äã‚Äãat all?  As the saying goes, <a href="http://blog.gamedeff.com/%3Fp%3D64">"there are no difficult problems in the gaming industry, there is no need to demand complex solutions</a> . <a href="http://blog.gamedeff.com/%3Fp%3D64">"</a>  In addition to experienced (and expensive!) Programmers who solve complex problems, we need people (many people!) Who will deal with, say, quests.  And honestly, we would like these programmers to be not so expensive, and ideally not programmers at all, but game designers and scriptwriters themselves. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thus, there is a need for a tool for describing simple, but nevertheless logic, without attracting heavy artillery of programmers.  We conclude - what is a scripting language for us?  This is a tool that will make game development faster and cheaper. <br>  The question immediately arises, why don't we just use something like XML?  The fact is that for our purposes, we often need control constructs ‚Äî branching and loops, while XML is a declarative description. <br><br>  Another advantage of scripting languages ‚Äã‚Äãis that scripts in a project can be both code and resource.  And, accordingly, it is possible to update the script part of the game not only with the code, that is, during normal updates via the app store mechanisms.  But along with resources - that is, along with graphic and other materials, using CDN. <br><br><h2>  Requirements for an ideal scripting language </h2><br>  We formulate the requirements for an ideal scripting language. <br><br><ul><li>  Dynamic.  In our understanding, the ideal scripting language should be dynamic. </li><li>  Popularity.  By language's popularity, we mean that it has a large enough community ready to answer questions on specialized resources like StackOverflow. </li><li>  A sloping learning curve.  We want to take, relatively speaking, practically anyone, and quickly train him to a level that will allow this person to work productively on our tasks. </li><li>  Ample opportunities.  The language should be powerful and have sufficient capabilities, should support different programming paradigms.  A professional programmer who will be offered to write in such a language will be able to do it with comfort and pleasure. </li><li>  High performance.  Performance is one of the cornerstones of the gaming industry. </li><li>  A large number of libraries.  Very often we, in the course of solving the tasks before us, do not create a fundamentally new code, but use what has already been written by someone.  The more stable, well-supported libraries we can use, using a certain language, the better. </li><li>  Easy embedding  We are talking about embedded languages, so when choosing a scripting language, the possibility of embedding it plays an important role. </li></ul><br>  Let us analyze some popular programming languages ‚Äã‚Äãthat are used as scripting languages ‚Äã‚Äãto meet these requirements. <br><br><h2>  Python </h2><br>  Python is a dynamic language that is quite popular.  It is characterized by a fairly flat learning curve, which is fairly easy to learn.  However, it is not so easy to study it properly.  As a result, good Python programmers are rare and expensive.  This is contrary to our desire to speed up and cheapen the development of game logic. <br><br>  Python has great features, good performance.  His problem is inconsistent library system.  Another of his problems, which plays an important role for us, is that it is, in fact, not an embedded language.  This is the language from which it is convenient to call libraries written in C or C ++. <br><br>  Regarding the possibilities of embedding Python, we can say that, for example, there is Maya, where Python is used.  But the one who saw inside the Maya plugins written in Python would agree with us that they don't look very good. <br><br>  As a result, we can say that Python, with all its strengths, does not suit us.  Now consider JavaScript. <br><br><h2>  Javascript </h2><br>  JavaScript is, without exaggeration, a great language that literally captured the world. <br><br>  JavaScript is a popular dynamic language, featuring a gentle learning curve, with extensive capabilities, good performance, and an extensive set of libraries. <br><br>  If we need a language interpreter to build the game engine, we can find a lot of such interpreters.  In reality, you have to choose from two similar projects - V8 and WebKit.  Both are large enough.  As a result, if we are talking about board games, one could take a risk and include the whole interpreter in the game, but in the case of mobile games, this option does not suit us. <br><br>  SocialQuantum has its own JavaScript interpreter, which passes 98% of the tests, we plan to transfer this project to the category of open source. <br><br>  As a result, it turns out that JavaScript looks like a strong candidate for the role of an embedded language, but it does not suit us either. <br><br><h2>  Haxe </h2><br>  Here it should be noted that when the conversation about JavaScript comes, the following is usually remembered by Haxe.  But, in fact, there is no point in talking about the possibility of using this language as an embedded one, since Haxe, in fact, is not so much a language as a trans compiler into other languages.  And this is not what we need. <br><br>  Maybe we will be satisfied with ActionScript or some other scripting language? <br><br><h2>  ActionScript </h2><br>  If we formally analyze ActionScript for compliance with the above requirements, it would seem that the ideal scripting language has been found.  On its side is the dynamic nature, popularity, ease of learning, good features, performance, availability of libraries, ease of embedding.  This language is loved and remembered in the gaming industry; a huge number of wonderful Flash games are written on it.  The main problem of ActionScript is that this language is almost dead.  Therefore, he does not like us either. <br><br><h2>  AngelScript, Squirrel and others </h2><br>  In addition to ActionScript, there are many scripting languages, such as AngelScript, Squirrel, and others.  Among them you can find those that, formally, almost completely satisfy our requirements, but usually these are languages ‚Äã‚Äãthat are tied to their developer, they have some kind of long-standing problems that have not been fixed for years.  Most likely, they are not too popular, they are not well documented, there are few educational materials for them, they have not very large communities.  One of the consequences of this state of affairs is the fact that they are difficult to study - if only because it is not completely clear what they are and how they work. <br><br>  As you can see, we have not yet found the perfect embedded language.  What if you create your own language? <br><br><h2>  Creating your own language </h2><br>  It is possible that the language developed within the company will ideally meet its needs and will be easy to learn.  But, most likely, such a language will not become popular.  Such a language will either have a minimum number of libraries, or they will not exist at all.  In addition, it is hard to believe that in modern conditions it is possible to create something that will work better, that it will have greater productivity and will be easier to integrate than something that is already on the market. <br><br>  There are companies that develop and use their own languages, among them there are successful players in the gaming market, but, most likely, this is not a good idea. <br><br>  Having considered the existing programming languages ‚Äã‚Äãthat claim to be embedded and discuss the idea of ‚Äã‚Äãdeveloping your own language, we turn to Lua. <br><br><h2>  Lua is the embedded language we have chosen. </h2><br>  Lua is a dynamic language.  It is quite popular, there is a large community around it, especially in the field of game development.  It has a very gentle learning curve.  For example, in our company scripts for autotests are written on Lua.  The standard introductory course for autotesters takes about two hours, after which a person is able to use this language.  At the same time, Lua is a multi-paradigm language.  It supports functional programming style and OOP.  As a result, it is suitable not only for solving some simple tasks, but also for more serious tasks that professional programmers are engaged in. <br><br>  Lua has good performance and has quite a few libraries.  Not as much as JavaScript does, but, nevertheless, on the <a href="http://luaforge.net/projects/">LuaForge</a> website <a href="http://luaforge.net/projects/">you</a> can find almost everything you need.  And finally, Lua is very easy to integrate; moreover, it was created to be used as an embeddable language. <br><br>  For example, this is how our working environment based on JetBrains IDE <a href="https://www.jetbrains.com/clion/">CLion</a> looks like.  Here you can see the auto-completion mechanism we created for Lua, which is planned to be made open-source.  Open source and we are going to make a debugger. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/935/259/db5/935259db52b1de7fa0908bc1b3482307.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a5b/efe/60f/a5befe60fb4f15c55c9d84e1f3380d07.png"></div><br>  <font color="#999999"><i>Workspace</i></font> <br><br>  We chose Lua, but when it comes to using it as an embedded scripting language, you usually have to deal with roughly the same objections that we are about to consider. <br><br><h2>  Objections to using Lua </h2><br><h3>  Lua is for C and not for C ++. </h3><br>  Nobody argues with the fact that Lua is a great embedded language.  The main thing that they consider it a minus is that it was created for use with the C language, not C ++.  Because of this, trying to apply something in Lua that is in C ++ and not in C, we run into problems.  However, here we must understand that these problems were solved by many pretty smart people.  Luabind, Luabridge, toLua ++, SQLuaHost are among the tools that solve the problems of embedding Lua in C ++ projects.  This is not a complete list.  They have different advantages and disadvantages, but, nevertheless, most likely, all that you may need is already implemented in one of these solutions. <br><br>  Consider, for example, SQLuaHost.  This is a binding that is made inside the company SocialQuantum, and which is planned to be made open-source.  This decision represents our vision of how Lua should be bind.  Therefore, it is quite possible that if you did not find what you need in existing binders, you will find it in SQLuaHost. <br><br><h3>  Lua is slow </h3><br>  We often have to deal with the opinion that Lua is a very slow language.  Firstly, it is not.  Lua is a stack machine, and there, in fact, there is simply nothing to slow down.  In addition, we must understand that in the scripting language, we usually give the game logic, business logic, and not some really heavy things.  As a result, if Lua scripts make the game slow down, then the problem may lie in the non-optimal binding or irrational use of some sort of language function.  We, for example, conducted synthetic tests on which LuaJIT runs faster than Mono.  At the same time, no one bothers to write about such a sub-optimal code: <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> myGame:onUpdate()    <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> tex = Texture::<span class="hljs-built_in"><span class="hljs-built_in">new</span></span>(<span class="hljs-type"><span class="hljs-type">name</span></span>)    self.background:setTexture(tex) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  Here, in each game tick, a new texture is created and set as a background.  Of course, such a construction will not work very quickly, but no one bothers to write such things here. <br><br><h3>  Lua is only suitable for small projects. </h3><br>  The next objection is that Lua is made in order to write some small things and something big in this language is impossible to write.  On the one hand, this is true.  But this language has high modularity.  And from a variety of small blocks, you can make quite large and complex systems.  And if you recall what has already been said about multi-paradigm and OOP, then it turns out that OOP pushes the developer to create small modules that can be used to create large and complex structures. <br><br>  At the same time, some small modules are often written quickly on Lua, and in the gaming industry ‚Äúfaster‚Äù means ‚Äúcheaper‚Äù. <br><br><h3>  Other arguments against Lua </h3><br>  Criticizing Lua, they say that the language is ancient, that it is called out of the box, does not support the PLO, that the numbering of the elements in its tables does not begin with 0, as you would expect from any decent language, but with one. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d88/426/da8/d88426da8a2d198afcad259c6d584e51.png"></div><br>  They say that its disadvantage is that there is no ternary operator in it.  In fact, there are quite a few such arguments against Lua, but we will not discuss them, since we believe that they, for the most part, belong to the habits and personal preferences of the developers. <br><br><h2>  Results </h2><br>  Let's sum up.  If your task is to acquire embedded language with minimal effort, take Lua.  At the same time, if you have the time and resources to develop your own language or your own bindings - again - pay attention to Lua.  Why do we recommend Lua in both the first and second cases? <br><br>  In the first case, choosing Lua, you will select a language that is very easy to build and use.  There is exactly one <a href="https://www.lua.org/pil/">educational book</a> on this language written by its author.  There are no other books simply because the first one tells absolutely everything you need to know about Lua, and there's nothing more to talk about it.  Lua is not an ideal and not the most common language in the world, but, by the sum of the criteria, it is definitely one of the best languages ‚Äã‚Äãto embed.  He is the best we have right now.  In addition, there are many standard tools for Lua, which greatly facilitate the lives of those who use it. <br><br>  In the second case, if you have the resources to develop the tools, you will be able to really spend these resources by choosing Lua, since Lua, despite its popularity in the game development environment, is a very undervalued language.  As a result, you will have the opportunity, taking Lua as a basis, to take into account your needs and get exactly what you need. </div><p>Source: <a href="https://habr.com/ru/post/428253/">https://habr.com/ru/post/428253/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428237/index.html">Board game scrum mitap: welcome to the Scrum Values ‚Äã‚ÄãGame</a></li>
<li><a href="../428239/index.html">Flash drives on the eve of 2019 - a relic of the past or is it still a necessity?</a></li>
<li><a href="../428243/index.html">GeekBrains teach C programming language</a></li>
<li><a href="../428249/index.html">WDM Technologies: Integrating Data Centers into Resilient Clusters</a></li>
<li><a href="../428251/index.html">Stupid vulnerability in the application "My Beeline"</a></li>
<li><a href="../428255/index.html">Transfer Learning: how to quickly train a neural network on your data</a></li>
<li><a href="../428257/index.html">Study: 95% of children's apps have ads</a></li>
<li><a href="../428259/index.html">The book "Why we are wrong. Traps thinking in action. " Excerpts part 2</a></li>
<li><a href="../428261/index.html">Japanese weeks in the asteroid belt</a></li>
<li><a href="../428263/index.html">"I had really skinny hands": professional gamers go to the gyms</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>