<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multi torrent rocking on the transmission</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to talk about how to implement a torrent daemon divided by users. A transmission-daemon will be used as a torrent client. 
 A torrent daemon is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multi torrent rocking on the transmission</h1><div class="post__text post__text-html js-mediator-article">  I want to talk about how to implement a torrent daemon divided by users.  A transmission-daemon will be used as a torrent client. <br>  A torrent daemon is a program (service) that acts as a torrent client (rocking chair) and is usually used on all sorts of HTPC, NAS, routers, etc.  To download / distribute torrents not on the main PC / laptop, but on a device that is always on / online. <br><a name="habracut"></a><br><h4>  Introduction, for those who are not familiar with what a transmission-daemon is </h4><br>  One of the common torrent demons is the transmission-daemon.  For him, there are many GUI-clients for different platforms that work on http and can connect to the rocking chair remotely, which is very convenient.  The use of such a client for a user will not be different from regular torrent clients, and if the client is closed, the download / distribution does not stop, but continues on a remote server machine.  Also, the transmission-daemon has its own ‚Äústandard‚Äù web-interface. <br><br><h4>  Problem: </h4><br>  And everything would be fine, but the transmission-daemon, though it provides for authorization, but only for one user.  Therefore, if you want to use someone else besides you, you will have to share one account - you can both view and manage each other's downloads, which is not very convenient. <br><br><h4>  Solution </h4><br>  The most obvious simple and elegant, in my opinion, solution is to launch transnmission simultaneously from different users.  In this case, Ubuntu Server 12.10 is used as the OS, so you can create a separate Upstart User Job for each user.  For other distributions, you can simply create init.d scripts instead. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Decision </h4><br><h5>  Prepare the system: </h5><br>  install the transmission-daemon: <br> <code>sudo apt-get install transmission-daemon</code> <br>  Let us execute user daemons or User Jobs, for this you need to replace the file <i>"/etc/dbus-1/system.d/Upstart.conf"</i> , after making backup of the old one. <br> <code>sudo mv /etc/dbus-1/system.d/Upstart.conf /etc/dbus-1/system.d/Upstart.conf.save</code> <br>  new <i>/etc/dbus-1/system.d/Upstart.conf</i> file: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE busconfig PUBLIC "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN" "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">busconfig</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Only the root user can own the Upstart name --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">policy</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">user</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"root"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">allow</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">own</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.ubuntu.Upstart"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">policy</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Allow any user to invoke all of the methods on Upstart, its jobs or their instances, and to get and set properties - since Upstart isolates commands by user. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">policy</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">allow</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">send_destination</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.ubuntu.Upstart"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">send_interface</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.freedesktop.DBus.Introspectable"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">allow</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">send_destination</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.ubuntu.Upstart"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">send_interface</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"org.freedesktop.DBus.Properties"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">allow</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">send_destination</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.ubuntu.Upstart"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">send_interface</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.ubuntu.Upstart0_6"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">allow</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">send_destination</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.ubuntu.Upstart"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">send_interface</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.ubuntu.Upstart0_6.Job"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">allow</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">send_destination</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.ubuntu.Upstart"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">send_interface</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.ubuntu.Upstart0_6.Instance"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">policy</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">busconfig</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Next is to turn off the standard demon, which starts from the root when the system starts: <br><br><pre> <code class="bash hljs">sudo sh -c <span class="hljs-string"><span class="hljs-string">'echo "manual" &gt; /etc/init/transmission-daemon.override'</span></span> sudo service transmission-daemon stop</code> </pre><br><br><h5>  Configuring a specific user: </h5><br><h6>  create an upstart user job </h6><br>  Login as another user who will use the transmission-daemon and execute the script: <br><pre> <code class="bash hljs">mkdir <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.init cat &lt;&lt;End-of-list &gt; <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.init/transmissiond-<span class="hljs-variable"><span class="hljs-variable">$USER</span></span>.conf start on <span class="hljs-variable"><span class="hljs-variable">$USER</span></span>-logged-in stop on runlevel [!2345] <span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> timeout 30 respawn setuid <span class="hljs-variable"><span class="hljs-variable">$USER</span></span> env HOME=<span class="hljs-variable"><span class="hljs-variable">$HOME</span></span> pre-start script <span class="hljs-comment"><span class="hljs-comment"># stop job from continuing if no config file found for daemon [ ! -f \$HOME/.transmissiond/transmission-daemon ] &amp;&amp; { stop; exit 0; } # source the config file . \$HOME/.transmissiond/transmission-daemon # stop job from continuing if admin has not enabled service in # config file. [ "\$ENABLE_DAEMON" != 0 ] || { stop; exit 0; } end script script . \$HOME/.transmissiond/transmission-daemon exec /usr/bin/transmission-daemon -f \$OPTIONS end script End-of-list</span></span></code> </pre><br>  The script will create a file <code>~/.init/transmissiond-$USER.conf</code> with the necessary settings for the user daemon. <br>  The field you should pay attention to is " <i>start</i> ".  In this case, Job will start only if the user has logged into the system, which is not at all necessary.  However, if encryption of the home directory is set, it is necessary, otherwise there will be no place to save the downloaded one.  If the download directory is available before the user login, then <code>"start on $USER-logged-in"</code> can be replaced by <code>"start on runlevel [2345]"</code> .  In this case, however, Job does not need to be made custom, but can be placed in / etc / init / <br><br>  Configure the env user-demona: <br><pre> <code class="bash hljs">cat &lt;&lt;End-of-text &gt; <span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.transmissiond/transmission-daemon ENABLE_DAEMON=1 CONFIG_DIR=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOME</span></span></span><span class="hljs-string">/.transmissiond"</span></span> OPTIONS=<span class="hljs-string"><span class="hljs-string">"--config-dir \$CONFIG_DIR"</span></span> End-of-text</code> </pre><br><br><h6>  Create a torrent client settings file </h6><br>  Do not forget to replace <code>pass="*****"</code> with your password.  After the first launch, the transmission itself will hide the password with a hash - it does not store it in the clear. <br><pre> <code class="bash hljs">uid=`id -u` pass=<span class="hljs-string"><span class="hljs-string">"*****"</span></span> <span class="hljs-comment"><span class="hljs-comment">#    cat &lt;&lt;End-of-list &gt; $HOME/.transmissiond/settings.json { "alt-speed-down": 100, "alt-speed-enabled": false, "alt-speed-time-begin": 540, "alt-speed-time-day": 127, "alt-speed-time-enabled": false, "alt-speed-time-end": 1020, "alt-speed-up": 100, "bind-address-ipv4": "0.0.0.0", "bind-address-ipv6": "::", "blocklist-enabled": false, "blocklist-url": "http://www.example.com/blocklist", "cache-size-mb": 32, "dht-enabled": true, "download-limit": 100, "download-limit-enabled": 0, "download-queue-enabled": true, "download-queue-size": 5, "encryption": 1, "idle-seeding-limit": 30, "idle-seeding-limit-enabled": false, "incomplete-dir-enabled": true, "lpd-enabled": false, "max-peers-global": 200, "message-level": 2, "peer-congestion-algorithm": "", "peer-limit-global": 240, "peer-limit-per-torrent": 60, "peer-port-random-high": 65535, "peer-port-random-low": 49152, "peer-port-random-on-start": false, "peer-socket-tos": "default", "pex-enabled": true, "port-forwarding-enabled": true, "preallocation": 1, "prefetch-enabled": 1, "queue-stalled-enabled": true, "queue-stalled-minutes": 30, "ratio-limit": 2, "ratio-limit-enabled": false, "rename-partial-files": true, "rpc-authentication-required": true, "rpc-bind-address": "0.0.0.0", "rpc-enabled": true, "rpc-url": "/transmission/", "rpc-whitelist": "127.0.0.1", "rpc-whitelist-enabled": false, "scrape-paused-torrents-enabled": true, "script-torrent-done-enabled": false, "script-torrent-done-filename": "", "seed-queue-enabled": false, "seed-queue-size": 10, "speed-limit-down": 256, "speed-limit-down-enabled": false, "speed-limit-up": 256, "speed-limit-up-enabled": false, "start-added-torrents": true, "trash-original-torrent-files": false, "umask": 18, "upload-limit": 100, "upload-limit-enabled": 0, "upload-slots-per-torrent": 14, "utp-enabled": true, "download-dir": "$HOME/downloads", "incomplete-dir": "$HOME/downloads/incomplete", "peer-port": $((51413 + $uid - 1000)), "rpc-username": "$USER", "rpc-password": "$pass", "rpc-port": $((9091 + $uid - 1000)) } End-of-list</span></span></code> </pre><br>  Each torrent daemon will hang on its own separate port, both for incoming torrent connections and for the management interface.  The port number (web interface) of a particular user is calculated using the formula <code>rpc-port = 9091 + $uid - 1000</code> Thus, a user with uid 1000 can access the web interface via <code><a href="http://server/"></a> server:9091</code>  <code><a href="http://server/"></a> server:9091</code> , and the user with uid 1010 - by <code><a href="http://server/"></a> server:9101</code>  <code><a href="http://server/"></a> server:9101</code> .  peer-port is calculated similarly. <br>  All under-downloaded torrents will be in ~ / downloads / incomplete, and ready torrents will be in ~ / downloads. <br><br>  In that case, if used, encrypt the user's home directory, it is necessary that the daemon starts only when the user is logged in, so we add a corresponding event at the end of the .bashrc, so that Upstart knows that it is time to start the transmission: <br><pre> <code class="bash hljs"> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"# start user specific daemons"</span></span> &gt;&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOME</span></span></span><span class="hljs-string">/.bashrc"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"initctl emit </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$USER</span></span></span><span class="hljs-string">-logged-in"</span></span> &gt;&gt; <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOME</span></span></span><span class="hljs-string">/.bashrc"</span></span></code> </pre><br>  and, probably, it would be desirable that if the user made a logout - the demon continued to spin: <br> <code>mv "$HOME/.ecryptfs/auto-umount" "$HOME/.ecryptfs/_auto-umount"</code> <br> <br>  Optionally, you can also do proxying via nginx / apache so that different users can access the interface through different domains, for example. <br><br><h4>  Conclusion </h4><br>  Each user, with whom the manipulations from the ‚ÄúSetting up a specific user‚Äù have been done, can use his own transmission-daemon, without interfering with others and without mixing up the downloaded ones.  If you combine this with ftp / samba / ..., then users will be able to pick up the downloaded files. <br>  Manipulations can be thrust into the script and then it will be enough for each new user to execute one command and that‚Äôs all - you can use. </div><p>Source: <a href="https://habr.com/ru/post/168767/">https://habr.com/ru/post/168767/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../168753/index.html">Groundwork - interesting CSS / HTML5 UI framework</a></li>
<li><a href="../168755/index.html">Measy U2C: mini PC with camera and docking station</a></li>
<li><a href="../168759/index.html">Server in extravagant package - Use Server 2012 as a Workstation</a></li>
<li><a href="../168763/index.html">Google Code-In 2012 - how was it?</a></li>
<li><a href="../168765/index.html">Video review ultrabook (tablet) Asus Taichi 21</a></li>
<li><a href="../168769/index.html">Software development for Nexus 7</a></li>
<li><a href="../168771/index.html">Porting Android apps to BlackBerry 10</a></li>
<li><a href="../168773/index.html">Manage Windows services using PowerShell. Part 4. Changing services using WMI</a></li>
<li><a href="../168783/index.html">Simple power monitoring device</a></li>
<li><a href="../168785/index.html">Nokia and the Elop effect: continued</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>