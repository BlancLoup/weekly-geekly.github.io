<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making cool Single Page Application on basis.js - part 3. Client for VKontakte</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all. 
 I continue the most interesting series of articles about the creation of advanced Single Page Application on basis.js . 
 Last time...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making cool Single Page Application on basis.js - part 3. Client for VKontakte</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/dbc/f72/e87/dbcf72e87382a87dbbb7afa53d4e291f.png" align="left"><br>  Good day to all. <br>  I continue the <a href="http://basisjs.com/">most</a> interesting series of articles about the creation of advanced Single Page Application on <a href="http://basisjs.com/">basis.js</a> . <br>  <a href="https://habrahabr.ru/post/304608/">Last time</a> we learned how to work with collections and implemented a full interactive list. <br>  This time we will start creating a full-fledged client for VKontakte. <br>  Namely: we implement authorization, download news, friends and music. <br><a name="habracut"></a><br><h4>  Menu and navigation </h4><br>  To begin with, we will implement a simple page with a title and a menu. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/ea8/5e7/f9a/ea85e7f9a0554993b9bcc545337b57a8.png" width="50%"></div><br>  When you click on menu items (tabs), you navigate to different url and highlight the active menu item. <br>  Let's look at the code of the main file of our future application: <br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Node = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.ui'</span></span>).Node; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Header = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.ui.header.component'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Menu = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.ui.menu.component'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.app'</span></span>).create({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'VK Client by Basis.JS'</span></span>, <span class="hljs-attr"><span class="hljs-attr">element</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Node({ <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./template.tmpl'</span></span>), <span class="hljs-attr"><span class="hljs-attr">binding</span></span>: { <span class="hljs-attr"><span class="hljs-attr">header</span></span>: <span class="hljs-string"><span class="hljs-string">'satellite:'</span></span>, <span class="hljs-attr"><span class="hljs-attr">menu</span></span>: <span class="hljs-string"><span class="hljs-string">'satellite:'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">satellite</span></span>: { <span class="hljs-attr"><span class="hljs-attr">header</span></span>: Header, <span class="hljs-attr"><span class="hljs-attr">menu</span></span>: Menu } }) });</code> </pre> <br>  We connect the necessary modules: <b>Node</b> , as well as the components of the title and menu (which will be discussed below). <br>  Next, an application is created using the <b>basis.app.create ()</b> method.  You can, of course, do without it and do as we did before - create a new <b>Node</b> and place it in some element on the page. <br>  But in basis.js there is a helper <b>basis.app</b> that encapsulates some logic related to the page title and the placement of the application root component on the page. <br>  Also, look at the pattern of our application: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--{header}--&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--{menu}--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The title and menu are <a href="">satellites of the</a> root component of our application. <br>  At the moment, the header component is very simple: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Node = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.ui'</span></span>).Node; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = Node.subclass({ <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./template.tmpl'</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;h1&gt; !&lt;/h1&gt; });</span></span></code> </pre><br>  His task is to display a greeting.  Later we will improve it. <br>  But the menu component is of particular interest to us: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Node = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.ui'</span></span>).Node; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Value = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).Value; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> router = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.router'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> currentPage = Value.from(router.route(<span class="hljs-string"><span class="hljs-string">':page'</span></span>).param(<span class="hljs-string"><span class="hljs-string">'page'</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = Node.subclass({ <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./template.tmpl'</span></span>), <span class="hljs-comment"><span class="hljs-comment">// &lt;div class="btn-group btn-group-lg"/&gt; childClass: { template: resource('./item.tmpl'), selected: currentPage.compute((node, page) =&gt; node.url == page), binding: { title: 'title' }, action: { click() { router.navigate(this.url); } } }, childNodes: [ {title: '', url: 'news'}, {title: '', url: 'friends'}, {title: '', url: 'audio'} ] });</span></span></code> </pre><br>  Let's immediately notice the contents of the <b>currentPage</b> variable. <br>  The current route will always be stored here, the changes of which we can track. <br>  We use this value in the <b>selected</b> property of menu items. <br>  That is, the activity of a particular menu item depends on the current route. <br>  If the url of the current menu item coincides with the current route, then this menu item has the property <b>selected = true</b> . <br>  Thus, only one menu item will be selected at a time. <br>  When you click on a specific item, it navigates to the specified url. <br>  You can read more about the router embedded in basis.js <a href="">in the corresponding section of the documentation</a> . <br><br>  Now look at the menu item template: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b:define</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"active"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">from</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"selected"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bool"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-default {active}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">event-click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"click"</span></span></span><span class="hljs-tag">&gt;</span></span> {title} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Each menu item is a button.  If the <b>selected</b> item is <b>true</b> , then we add the class <b>active</b> to the button, otherwise we remove. <br><br>  That's all.  Navigation menu is done. <br>  Now, when you click on the menu items, it will go to the corresponding url. <br>  There is a small detail - the default route. <br>  If you simply open our application without specifying a route, then no menu item will be selected. <br>  Let's fix this so that the default route is <b>News</b> . <br>  We modify the main file of our application: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ... let router = require('basis.router'); let defaultRoute = 'news'; require('basis.app').create({ title: 'VK Client by Basis.JS', element: new Node({ // ... }) }).ready(() =&gt; { router.route('*page').param('page').as(page =&gt; page || router.navigate(defaultRoute, true)); });</span></span></code> </pre><br>  As soon as the application is initialized, we begin to track the change in the route. <br>  If the route is not specified, then we transfer the user to the default route. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Authorization </h4><br>  Now we use <a href="https://new.vk.com/dev/openapi">VKontakte API</a> and implement authorization with it. <br>  Look at the <a href="">wrapper</a> over the VK API (hereinafter simply the API).  We will not consider it completely, and look only at key points. <br>  Please note that the API itself is derived from <a href="">basis.data.Value</a> . <br>  This means that it, like any data source, has states: <br><ul><li>  <b>UNDEFINED</b> when the user is not authorized </li><li>  <b>PROCESSING</b> during authorization </li><li>  <b>READY</b> after successful login </li><li>  <b>ERROR</b> in case of error </li></ul><br>  Let's look at how the change of states of the model is implemented.  To do this, refer to the <b>login ()</b> and <b>logout ()</b> methods: <br><pre> <code class="javascript hljs">login() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState(STATE.PROCESSING); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isLoggedIn().then( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState(STATE.READY), () =&gt; { global.VK.Auth.login(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState(response.session ? STATE.READY : STATE.UNDEFINED); }, config.perms); } ); }, logout() { global.VK.Auth.logout(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState(STATE.UNDEFINED); }</code> </pre><br>  By calling <b>login ()</b> , the API will be moved to the <b>PROCESSING</b> state. <br>  Next comes the check - if the user is already authorized, then we immediately translate the API into the <b>READY</b> state.  If not, then log in using the <a href="https://new.vk.com/dev/openapi%3Ff%3D3.1.%2520VK.Auth.login">VK.Auth.login ()</a> method from the VK API.  The authorization process through VK API is reduced to the fact that you are shown a window with a proposal to enter a login and password. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/ebd/5a4/8ae/ebd5a48ae2c040c79a66b25e40384853.png" width="75%"></div><br>  When the window is closed (the authorization was successful or was canceled), the transferred <b>callback</b> will be called, which will set the final state of our model: <b>READY</b> , in case of successful authorization and <b>UNDEFINED</b> , in case of cancellation of authorization. <br>  By calling <b>logout ()</b> , we destroy the session using the <a href="https://new.vk.com/dev/openapi%3Ff%3D3.2.%2520VK.Auth.logout">VK.Auth.logout ()</a> method and set the API to the <b>UNDEFINED</b> state. <br>  Now let's look at another important method - <b>callApi ()</b> : <br><pre> <code class="javascript hljs">callApi(method, params = {}) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isLoggedIn() .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.reject(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">' !'</span></span>))) .then( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { basis.object.complete(params, {<span class="hljs-attr"><span class="hljs-attr">v</span></span>: config.version}); global.VK.api(method, params, response =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.error) { reject(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(response.error.error_msg)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { resolve(response.response); } }); }); }, e =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState(STATE.ERROR, e.message); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } ); }</code> </pre><br>  The essence of this method is to send a request through the VK API.  Before each request, we check the availability of authorization.  If there is no authorization (for example, we opened our application in two browser tabs and clicked <b>exit</b> in one of them), then we throw out the error and translate the API into the <b>ERROR</b> state.  If the authorization is good, then we execute the request.  If the server, in response to a request, notifies us about an error, we throw an error and translate the API into the <b>ERROR</b> state.  Otherwise, we return the result. <br><br>  Due to this, we can abstract away from the nuances of working with the VK API and operate only on the model states: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> STATE = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).STATE; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Value = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).Value; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Node = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.ui'</span></span>).Node; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> router = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.router'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Header = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.ui.header.component'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Menu = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.ui.menu.component'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> vkApi = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.vkApi'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> apiState = Value.state(vkApi); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> defaultRoute = <span class="hljs-string"><span class="hljs-string">'news'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.app'</span></span>).create({ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'VK Client by Basis.JS'</span></span>, <span class="hljs-attr"><span class="hljs-attr">element</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Node({ <span class="hljs-comment"><span class="hljs-comment">//   ,    active: apiState.as(state =&gt; state == STATE.READY), //       disabled: apiState.as(state =&gt; state == STATE.PROCESSING), template: resource('./template.tmpl'), binding: { header: 'satellite:', menu: 'satellite:', //    ,     error: apiState.as(state =&gt; state == STATE.ERROR &amp;&amp; state.data) }, satellite: { header: Header, menu: Menu }, action: { //   "" login() { vkApi.login(); } } }) }).ready(() =&gt; { router.route('*page').param('page').as(page =&gt; page || router.navigate(defaultRoute, true)); //       vkApi.login(); });</span></span></code> </pre><br>  Now apply these properties in the template: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">b:show</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{active}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--{header}--&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--{menu}--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jumbotron text-center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">b:hide</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{active}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> VK Client <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag">&gt;</span></span> powered by basis.js<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">small</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert alert-danger"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">b:show</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{error}"</span></span></span><span class="hljs-tag">&gt;</span></span> {error} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-primary btn-lg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">event-click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"login"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{disabled}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  We show the welcome screen while the user is not authorized, otherwise we show the menu and title. <br>  The <b>Authorization</b> button will be locked during the authorization process. <br>  Also, add a button <b>to exit</b> to the main menu: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div{childNodesElement}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn-group btn-group-lg"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-primary btn-lg pull-right"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">event-click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"logout"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And, in the menu component, we will process the click on this button: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> vkApi = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.vkApi'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ... module.exports = Node.subclass({ // ... action: { logout() { vkApi.logout(); } } // ... });</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d80/42f/a38/d8042fa3831340e880465584f9633a2f.png"></div><br>  Fine!  Now we have an application that can log in to VKontakte, as well as a convenient mechanism for tracking model states.  Moving on. <br><br><h4>  Pages </h4><br>  In this article, we are implementing three pages: news, friends and audio recordings. <br>  When switching between menu items, the corresponding page should be displayed. <br><div style="text-align:center;"><img src="https://habrastorage.org/files/a8b/5cb/669/a8b5cb6691494703ba30fbfb24c832fd.png"></div><br>  To begin with, we will create a common page, from which we will inherit all the rest: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Value = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).Value; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Expression = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data.value'</span></span>).Expression; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> STATE = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).STATE; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Node = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.ui'</span></span>).Node; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = Node.subclass({ <span class="hljs-attr"><span class="hljs-attr">active</span></span>: basis.PROXY, <span class="hljs-attr"><span class="hljs-attr">binding</span></span>: { <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: Value.query(<span class="hljs-string"><span class="hljs-string">'childNodesState'</span></span>).as(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> state == STATE.PROCESSING), <span class="hljs-attr"><span class="hljs-attr">error</span></span>: Value.query(<span class="hljs-string"><span class="hljs-string">'childNodesState'</span></span>).as(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> state == STATE.ERROR &amp;&amp; state.data), <span class="hljs-attr"><span class="hljs-attr">empty</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Expression( Value.query(node, <span class="hljs-string"><span class="hljs-string">'childNodesState'</span></span>), Value.query(node, <span class="hljs-string"><span class="hljs-string">'childNodes.length'</span></span>), (state, itemCount) =&gt; !itemCount &amp;&amp; state == STATE.READY ) }, <span class="hljs-attr"><span class="hljs-attr">handler</span></span>: { activeChanged() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.active) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataSource.deprecate(); } } } });</code> </pre><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert alert-info"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">b:show</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{loading}"</span></span></span><span class="hljs-tag">&gt;</span></span>...<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert alert-warning"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">b:show</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{empty}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert alert-danger"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">b:show</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{error}"</span></span></span><span class="hljs-tag">&gt;</span></span>{error}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div{page}</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">b:hide</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{loading}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  It so happens that all three pages have a common logic of work: <br><ul><li>  upload a list of something </li><li>  when loading to show the inscription is <b>loading</b> </li><li>  in case of an error, display the text of the error </li><li>  if an empty list has been loaded, then show <b>list is empty</b> </li></ul><br>  Something similar we already did last time. <br>  In order not to duplicate the code in the components of all three pages, we place it in a separate file. <br>  Let's take a closer look at what is happening there: <br>  Our abstract page is just a <b>Node</b> with specific binders and a couple more details. <br>  I will not now dwell on these binders, as they were thoroughly discussed <a href="https://habrahabr.ru/post/304608/">last time</a> . <br>  Now we are more interested in another. <br>  What is <b>active: basis.PROXY</b> ? <br>  Last time, we found that the data set starts synchronization only when its state is <b>UNDEFINED</b> or <b>DEPRECATED</b> and it has an active consumer.  These two conditions must be met in order to start the dialing synchronization process.  Now we are more interested in the part about " <i>when there is an active consumer</i> ." <br>  <b>The consumer</b> is an entity (heir of <a href="">basis.data.AbstractData</a> ), which needs data (and, <a href="">moreover</a> , relevant), represented in another data object. <br>  <b>An active consumer</b> is a consumer with the property <b>active = true</b> . <br><br>  By default, when a <b>dataSource</b> is assigned to a <b>Node</b> , the <b>Node</b> automatically becomes a consumer of this set. <br>  Great, the consumer is.  But is he active? <br>  Again, by default, <b>Node is</b> not an active consumer ( <b>active</b> property <b>= false</b> ). <br>  " <i>And let's just add active: true to the description of Node and the problem will be solved,</i> " you can suggest. <br>  Not so simple.  After all, we are making a smart application?  So, the set should not just be synchronized once when the application is started, but also update its data as needed. <br>  We have three pages and three sets for each of them (news, friends and audio recordings).  We will start synchronization of a set only when we switch to a tab that needs this set.  Thus, we not only implement the data update mechanism, but also add a ‚Äú <b>lazy</b> ‚Äù data synchronization.  That is, synchronization only when necessary. <br>  Based on this, when switching to a tab, we must transfer the state of the corresponding set to <b>DEPRECATED</b> . <br>  But how do you know that we have switched to any tab? <br>  Most likely, you have already begun to think that we are moving further and further away from the initial question. <br>  But it is not.  A little bit more and you will see how all the plot lines merge together, clarifying the big picture. <br>  So, how do you know that we have switched to any tab? <br>  As in the case of the <b>dataSource</b> , <b>Node</b> automatically becomes the consumer of all its satellites, as well as their owner.  We will make it so that when switching between tabs, the corresponding page will become a satellite of the root <b>Node of</b> our application. <br>  So you can force the page to react at the moment when it becomes a satellite and at this moment to transfer the state of its set to <b>DEPRECATED</b> : <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ... module.exports = Node.subclass({ // ... handler: { ownerChanged() { if (this.owner) { this.dataSource.deprecate(); } } } });</span></span></code> </pre><br>  Fine!  At that moment, when the page becomes a satellite of the root component of our application, the data set will transition to the <b>DEPRECATED</b> state. <br><br>  But let's say it again: " <i>The data set starts synchronization only when its state is UNDEFINED or DEPRECATED and it has an active consumer.</i> " <br>  With the switch state of the set and the presence of the consumer, we figured out.  But what about the activity?  If you simply add to the page <b>active: true</b> , then it will always be active and its data source will try to synchronize data immediately upon creation, regardless of whether we need this data now or not. <br>  It does not quite suit us, because there are cases when synchronization is simply impossible.  For example, when we have not yet passed the authorization procedure or the Internet is disabled. <br>  In order not to stop processing these cases in the page itself, we will add the <b>active: basis.PROXY</b> property to <b>it</b> , which will translate <b>Node</b> into a special mode in which the <b>Node</b> will be active only when it has an active consumer. <br>  Knowing this, there is no need to track <b>ownerChanged</b> , but rather subscribe to <b>activeChanged</b> .  Thus, we will set the set to synchronize data only at the moment of the appearance of the active consumer. <br>  Take another look at the final code of the page component: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Value = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).Value; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Expression = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data.value'</span></span>).Expression; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> STATE = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).STATE; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Node = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.ui'</span></span>).Node; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = Node.subclass({ <span class="hljs-attr"><span class="hljs-attr">active</span></span>: basis.PROXY, <span class="hljs-attr"><span class="hljs-attr">binding</span></span>: { <span class="hljs-attr"><span class="hljs-attr">loading</span></span>: Value.query(<span class="hljs-string"><span class="hljs-string">'childNodesState'</span></span>).as(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> state == STATE.PROCESSING), <span class="hljs-attr"><span class="hljs-attr">error</span></span>: Value.query(<span class="hljs-string"><span class="hljs-string">'childNodesState'</span></span>).as(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> state == STATE.ERROR &amp;&amp; state.data), <span class="hljs-attr"><span class="hljs-attr">empty</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Expression( Value.query(node, <span class="hljs-string"><span class="hljs-string">'childNodesState'</span></span>), Value.query(node, <span class="hljs-string"><span class="hljs-string">'childNodes.length'</span></span>), (state, itemCount) =&gt; !itemCount &amp;&amp; state == STATE.READY ) }, <span class="hljs-attr"><span class="hljs-attr">handler</span></span>: { activeChanged() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.active) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataSource.deprecate(); } } } });</code> </pre><br>  Thus, the page will be active only when it has an active consumer. <br>  As mentioned above, the page user will be a component of our application, and, if you remember, it is active only when the user is authorized. <br>  At the time of activation of the page, the status of its data source goes to <b>DEPRECATED</b> . <br>  So we delegated responsibilities for handling various cases to the main application. <br><br>  Now the picture should clear up: <br><ul><li>  there are three pages (news, friends, audio) </li><li>  Each page has its own set of data that can receive data using the VK API </li><li>  when switching between tabs, the satellite of the main component of the application will become the corresponding tab page </li><li>  page is active only when it has an active consumer </li></ul><br><br>  We now turn to the creation of the heirs of the considered component of the page. <br>  Let's start with the news: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Page = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../Page'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Page({ <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./list.tmpl'</span></span>), <span class="hljs-attr"><span class="hljs-attr">childClass</span></span>: { <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./item.tmpl'</span></span>), <span class="hljs-attr"><span class="hljs-attr">binding</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'data:'</span></span>, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: Value.query(<span class="hljs-string"><span class="hljs-string">'data.date'</span></span>).as(format(<span class="hljs-string"><span class="hljs-string">'%D.%M.%Y %H:%I:%S'</span></span>)) } } });</code> </pre><br>  Template leave at your discretion. <br>  The code for the remaining two pages is similar. <br>  The page still has no data source.  We will return to this question, but for now let's take a look at how to display the page that corresponds to the open tab. <br>  We modify the main file of our application: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ... let pageByName = { news: resource('./ui/pages/news/component.js'), friends: resource('./ui/pages/friends/component.js'), audio: resource('./ui/pages/audio/component.js') }; require('basis.app').create({ title: 'VK Client by Basis.JS', element: new Node({ // ... binding: { // ... page: 'satellite:' }, satellite: { // ... page: router.route(':page').param('page').as(page =&gt; pageByName[page]) } }) }) // ...</span></span></code> </pre><br>  A satellite named page will be a component that corresponds to the current route based on the map in the <b>pageByName</b> variable.  Now you need to add the use of this satellite to the template: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">b:show</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{active}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--{header}--&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--{menu}--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--{page}--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Now, if the pages had a data source, then our application would start working. <br><br><h4>  Data source </h4><br>  Above was shown a wrapper over the VK API.  Among other things, there are methods for getting a list of news, friends and audio recordings.  As a data source, we will use <a href="">basis.entity</a> - typed entities. <br>  We describe the type for the news: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> STATE = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).STATE; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> entity = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.entity'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> vkApi = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.vkApi'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> News = entity.createType(<span class="hljs-string"><span class="hljs-string">'News'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> }); News.extendReader(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> =&gt;</span></span> data.date *= <span class="hljs-number"><span class="hljs-number">1000</span></span>); News.all.setSyncAction(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> vkApi.news().then(News.all.set)); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = News;</code> </pre><br>  Each news item consists of two fields - text and date. <br>  Notice that we are expanding the <b>reader</b> .  This feature is used in cases where it is necessary to modify the data before they become an instance of the type. <br>  Also, each type has an <b>all</b> property, which is a set of all created objects of this type. <br>  Wherever we create an instance of the <b>News</b> type, it will be placed in the <b>News.all</b> set. <br>  For this set, we define <b>syncAction</b> , that is, the method that will be called when synchronization is needed. <br>  All we need to do is get the data from VKontakte and transfer it to the <b>News.all.set ()</b> method, which will replace existing instances of the <b>News</b> type with new ones. <br>  Note that there is no need to explicitly specify the method context as follows: <b>News.all.set.bind (News.all)</b> . <br>  This method is already linked to the context of <b>News.all</b> for ease of use. <br>  Also note that if the method specified in <b>syncAction</b> returns a promise, then the state of the data set will be determined automatically, depending on the state of the promise. <br><br>  Now <b>News.all</b> can be transferred as a data source for a news page.  Accordingly, when the page is activated, the <b>News.all</b> state will be transferred to <b>DEPRECATED</b> and the synchronization process described in the <b>syncAction</b> set will <b>start</b> . <br><br>  <b>News.all</b> . <br>  Similarly, we describe the remaining two types: <br><h5>  Friends entity </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> entity = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.entity'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> vkApi = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.vkApi'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Friends = entity.createType(<span class="hljs-string"><span class="hljs-string">'Friends'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">photo</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">first_name</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">last_name</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> }); Friends.extendReader(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> =&gt;</span></span> data.photo = data.photo_100); Friends.all.setSyncAction(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> vkApi.friends().then(Friends.all.set)); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = Friends;</code> </pre><br><h5>  Audio entity </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> entity = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.entity'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> vkApi = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.vkApi'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Audio = entity.createType(<span class="hljs-string"><span class="hljs-string">'Audio'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">artist</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, <span class="hljs-attr"><span class="hljs-attr">duration</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> }); Audio.extendReader(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> =&gt;</span></span> data.duration *= <span class="hljs-number"><span class="hljs-number">1000</span></span>); Audio.all.setSyncAction(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> vkApi.audio().then(Audio.all.set)); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = Audio;</code> </pre><br>  Now <b>select News.all</b> as the data source for the page: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Value = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).Value; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Page = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../Page'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> News = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.type.news'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> format = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.date'</span></span>).format; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dataSource = News.all; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Page({ <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./list.tmpl'</span></span>), <span class="hljs-attr"><span class="hljs-attr">dataSource</span></span>: dataSource, <span class="hljs-attr"><span class="hljs-attr">childClass</span></span>: { <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./item.tmpl'</span></span>), <span class="hljs-attr"><span class="hljs-attr">binding</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'data:'</span></span>, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: Value.query(<span class="hljs-string"><span class="hljs-string">'data.date'</span></span>).as(format(<span class="hljs-string"><span class="hljs-string">'%D.%M.%Y %H:%I:%S'</span></span>)) } } });</code> </pre><br>  Similarly, we will point out the corresponding sets to other pages. <br><br><h5>  Friends page </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Page = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../Page'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Friends = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.type.friends'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dataSource = Friends.all; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Page({ <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./list.tmpl'</span></span>), <span class="hljs-attr"><span class="hljs-attr">dataSource</span></span>: dataSource, <span class="hljs-attr"><span class="hljs-attr">childClass</span></span>: { <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./item.tmpl'</span></span>), <span class="hljs-attr"><span class="hljs-attr">binding</span></span>: { <span class="hljs-attr"><span class="hljs-attr">photo</span></span>: <span class="hljs-string"><span class="hljs-string">'data:'</span></span>, <span class="hljs-attr"><span class="hljs-attr">first_name</span></span>: <span class="hljs-string"><span class="hljs-string">'data:'</span></span>, <span class="hljs-attr"><span class="hljs-attr">last_name</span></span>: <span class="hljs-string"><span class="hljs-string">'data:'</span></span> } } });</code> </pre><br><h5>  Audio page </h5><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Value = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).Value; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Page = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../Page'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Audio = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.type.audio'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> format = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.date'</span></span>).format; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dataSource = Audio.all; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Page({ <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./list.tmpl'</span></span>), <span class="hljs-attr"><span class="hljs-attr">dataSource</span></span>: dataSource, <span class="hljs-attr"><span class="hljs-attr">childClass</span></span>: { <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./item.tmpl'</span></span>), <span class="hljs-attr"><span class="hljs-attr">binding</span></span>: { <span class="hljs-attr"><span class="hljs-attr">artist</span></span>: <span class="hljs-string"><span class="hljs-string">'data:'</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'data:'</span></span>, <span class="hljs-attr"><span class="hljs-attr">duration</span></span>: Value.query(<span class="hljs-string"><span class="hljs-string">'data.duration'</span></span>).as(format(<span class="hljs-string"><span class="hljs-string">'%I:%S'</span></span>)) } } });</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The markup is either at your discretion, or by reference to the repository at the end of the article. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notice that the type of markup is not important for the presentation, it can be any. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything is ready, but let's add some more improvements. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add page 404. To do this, modify our main file:</font></font><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ... let pageByName = { news: resource('./ui/pages/news/component.js'), friends: resource('./ui/pages/friends/component.js'), audio: resource('./ui/pages/audio/component.js'), notFound: resource('./ui/pages/404/component.js') }; require('basis.app').create({ title: 'VK Client by Basis.JS', element: new Node({ satellite: { header: Header, menu: Menu, page: router.route(':page').param('page').as(page =&gt; pageByName[page] || pageByName.notFound) } // ... }) }) // ...</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All we did was add a new route to the route map and modify the tracking of the route change. </font><font style="vertical-align: inherit;">If the required route is not found in the route map, then use the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notFound</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> route </font><font style="vertical-align: inherit;">.</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fc8/cb9/767/fc8cb976760949c48d6c268b8de1f2e0.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, did you notice that the components are connected through a resource and not through require? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resource allows you to implement lazy initialization of components. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That is, the component will not be initialized immediately, but only at the moment when it is needed for the first time. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">More information about resources can be read </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the relevant section of the documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br>  And one moment.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The fact is that on your VKontakte wall you can come across not only text news, but also video / photos without text. </font><font style="vertical-align: inherit;">We will deal with the processing of these cases another time, but for now let's just filter the news so that only the news that has the text is displayed. </font><font style="vertical-align: inherit;">To do this, we modify the news component:</font></font><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Page = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../Page'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Value = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).Value; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> News = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.type.news'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> format = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.date'</span></span>).format; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Filter = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data.dataset'</span></span>).Filter; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> textOnlyNews = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Filter({ <span class="hljs-attr"><span class="hljs-attr">source</span></span>: News.all, <span class="hljs-attr"><span class="hljs-attr">state</span></span>: Value.query(<span class="hljs-string"><span class="hljs-string">'source.state'</span></span>), <span class="hljs-attr"><span class="hljs-attr">rule</span></span>: <span class="hljs-string"><span class="hljs-string">'data.text'</span></span>, deprecate() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.source.deprecate(); } }); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Page({ <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./list.tmpl'</span></span>), <span class="hljs-attr"><span class="hljs-attr">dataSource</span></span>: textOnlyNews, <span class="hljs-attr"><span class="hljs-attr">childClass</span></span>: { <span class="hljs-attr"><span class="hljs-attr">template</span></span>: resource(<span class="hljs-string"><span class="hljs-string">'./item.tmpl'</span></span>), <span class="hljs-attr"><span class="hljs-attr">binding</span></span>: { <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'data:'</span></span>, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: Value.query(<span class="hljs-string"><span class="hljs-string">'data.date'</span></span>).as(format(<span class="hljs-string"><span class="hljs-string">'%D.%M.%Y %H:%I:%S'</span></span>)) } } });</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All that we have done is to replace the data source of the news page with a filter that will drop all news without text. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And finally ... revive the header component:</font></font><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Node = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.ui'</span></span>).Node; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> STATE = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).STATE; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> DataObject = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'basis.data'</span></span>).Object; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> vkApi = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'app.vkApi'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dataSource = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataObject({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">firstName</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">lastName</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }, syncAction() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vkApi.me().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">me</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.update({ <span class="hljs-attr"><span class="hljs-attr">firstName</span></span>: me.first_name, <span class="hljs-attr"><span class="hljs-attr">lastName</span></span>: me.last_name }); }); } }); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = Node.subclass({ <span class="hljs-attr"><span class="hljs-attr">active</span></span>: basis.PROXY, <span class="hljs-attr"><span class="hljs-attr">delegate</span></span>: dataSource, <span class="hljs-attr"><span class="hljs-attr">template</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;h1&gt;  {firstName} {lastName}!&lt;/h1&gt;'</span></span>, <span class="hljs-attr"><span class="hljs-attr">binding</span></span>: { <span class="hljs-attr"><span class="hljs-attr">firstName</span></span>: <span class="hljs-string"><span class="hljs-string">'data:'</span></span>, <span class="hljs-attr"><span class="hljs-attr">lastName</span></span>: <span class="hljs-string"><span class="hljs-string">'data:'</span></span> } });</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Thus, the title component learned to receive and display the name and surname of the account holder. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Conclusion, but not the end </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, today we have created a full-fledged client for VKontakte on basis.js. The application can log in and synchronize data with the server. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Please note that, like last time, we follow the </font></font><a href="https://en.wikipedia.org/wiki/Functional_reactive_programming"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FRP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> path </font><font style="vertical-align: inherit;">and focus on working with data. In other words: we build the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data flow in</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> such a way that the application performs its tasks. At the same time, the specificity of basis.js is such that the client code turns out to be rather linear due to the absence of loops and a large number of branches. At least the indicated tasks can be solved without them. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the following articles we will improve our client and increase its functionality. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thank you for your interest in basis.js! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Great thanks to </font></font><a href="https://habrahabr.ru/users/lahmatiy/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lahmatiy</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for invaluable advice;) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Some useful links:</font></font><br><ul><li> <a href="https://github.com/smelukov/habrBasis3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repository with code from the article</font></font></a> </li><li> <a href="https://github.com/basisjs/articles"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Documentation basis.js</font></font></a> </li><li> <a href="https://github.com/basisjs/basisjs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source code basis.js</font></font></a> </li><li> <a href="https://gitter.im/basisjs/basisjs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gitter-chat</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> where you can ask questions both to me and the author basis.js</font></font></li></ul><br></div><p>Source: <a href="https://habr.com/ru/post/305292/">https://habr.com/ru/post/305292/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305282/index.html">Introduction to JavaFx and working with the layout in the examples</a></li>
<li><a href="../305284/index.html">How to create your own VPS hosting from scratch and start making money on it? Simple billing with Virtuemart</a></li>
<li><a href="../305286/index.html">In the fight against cancer: a multidisciplinary approach</a></li>
<li><a href="../305288/index.html">Replacing Android system files with adb</a></li>
<li><a href="../305290/index.html">Security Week 27: Android encryption bypass, medical Conficker resurrection, IoT botnet</a></li>
<li><a href="../305294/index.html">Summer Homework: Top 10 Microsoft Virtual Academy Courses</a></li>
<li><a href="../305296/index.html">MIPT launched an online magistracy in modern combinatorics</a></li>
<li><a href="../305298/index.html">Pass a technical interview (Level 2)</a></li>
<li><a href="../305300/index.html">Improving user interaction paths through page transitions</a></li>
<li><a href="../305304/index.html">Accidents on server farms</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>