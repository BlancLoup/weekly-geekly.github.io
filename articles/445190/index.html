<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Buy back / not buy back: our ML-pilot in the "Platypus"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post we will talk about the pilot ML-study for the online hypermarket "Platypus", where we predicted the redemption of perishable goods. At th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Buy back / not buy back: our ML-pilot in the "Platypus"</h1><div class="post__text post__text-html js-mediator-article"><p>  In this post we will talk about the pilot ML-study for the online hypermarket "Platypus", where we predicted the redemption of perishable goods.  At the same time, we took into account the data not only on the stock balance, but also the production calendar with weekends and holidays, and even the weather (heat, snow, rain and hail, only for ‚ÄúThree Weather Taft‚Äù, but not for buyers).  Now we know, for example, that the ‚Äúmysterious Russian soul‚Äù especially longs for meat on Saturdays, and values ‚Äã‚Äãwhite eggs above brown ones.  But first things first. </p><br><p><img src="https://habrastorage.org/webt/p7/lv/c-/p7lvc-ixcwawnhig5rqcqu5psx4.jpeg"></p><a name="habracut"></a><br><h1 id="pilot-v-riteyle-bolshe-chem-pilot">  The pilot in retail is more than a pilot </h1><br><p>  In retail, machine learning is in a dual position.  On the one hand, retailers have accumulated impressive amounts of data for quite impressive periods of time: individual purchase checks, data from loyalty cards ... On the other, retail has existed so long that demand forecasting began to be solved long before the appearance of data science was in fashion necessary BI tools. <br>  It turns out that retail is one of the most promising fields for datasentists' experiments and introducing machine learning, but business looks at all this with skepticism: is it really good for me?  After all, there are already working solutions proven by many years of experience. <br>  And here is the time to agree on a pilot study! <br>  Pilots themselves have clear limitations and specifics compared to a full-fledged ML project. </p><br><ul><li>  Time for a pilot study is spent enough to show customers the possibilities of machine learning on their data, but not so much to go into losses. </li><li>  In addition, the second shot at dasasyntistov, as a rule, will not be: if the first results of the business do not seem interesting, then it will retain skepticism and loyalty to the old methods of forecasting.  So you need to aim aptly. </li><li>  During the pilot project between the customer and datsayntist no trust relationship can appear.  And the units and specialists who possess important data for interpretation are most likely not available at the time of the pilot, as well as commercially important insights. </li></ul><br><p>  Of course, these features are not manifested in every pilot project, but they constitute an important part of its risks. </p><br><h1 id="nemnogo-o-zadache">  A little bit about the task </h1><br><p>  Long before the introduction to machine learning, Utkonos already used its own analytical system, which predicted the purchase of goods for a week with very high accuracy.  Nevertheless, the retailer is interested in the possibility of improving the efficiency of planning.  First of all, this concerned perishable products, many of which are also very expensive.  Traditional fork: buy a lot - there will be losses, buy enough - the buyer will leave behind his beloved calf tenderloin, harvested under the full moon and slightly drizzling rain, to a competitor.  For a reasonably accurate prediction for the day after tomorrow, machine-based solutions are better suited to allow for a larger number of factors to be taken into account than classical BI tools.  ‚ÄúUtkonos‚Äù agreed to be our partner for an experiment aimed at testing the applicability hypothesis of Machine Learning for e-commerce. </p><br><p>  To show the possibilities of machine learning for solving this problem, in agreement with the business, several product names were chosen: </p><br><ul><li>  two products from the category ‚ÄúChilled Meat‚Äù - as perishable products, the data on which it is most important to update promptly; </li><li>  and two products from the category "Chicken Egg" - as goods with specific seasonal demand, which cannot be predicted simply as "everyone buys X on Thursday, and multiply X by a factor on Friday".  Although chicken eggs are not difficult to predict foreclosures and the weekly planning horizon is quite acceptable for them, it was on these products that they had to show that machine learning really sees complex relationships and builds a non-trivial forecast. </li></ul><br><p>  We have already chosen specific goods to our taste, relying on the fullness in historical data.  Some goods were introduced into the line rather recently, some - on the contrary, were sold once, but at the moment they were already taken out of the range, so the value of the data on them was only historical. </p><br><p>  The data provided by Utkonos contained information on the sales of four product names for the previous 2 years and on the availability of these products in stock during the relevant periods.  We immediately ‚Äúcut off‚Äù the last six months from the general data set, from the beginning of November to the end of April - this will be our test set.  It includes both relatively quiet autumn months, and a series of winter holidays and spring holidays. </p><br><p>  We were expecting a short but fascinating adventure. </p><br><h1 id="dannye-so-skladov-zagadochnye-i-neobhodimye">  Data from warehouses: mysterious and necessary </h1><br><p>  When working with historical data, the first question that arose before us was how to separate real sales from ‚Äúmaximum available sales‚Äù (i.e., cases when the goods that ended up in the warehouse were purchased by 100%, but if available, the sales volume could to be higher)?  Such unfulfilled customer desires are not displayed in the data. <br>  Availability of goods in stock.  By the way, from the experience of previous projects in retail, we expected that these would be balances expressed in units of measurement.  However, in this case we were dealing with a relative indicator of ‚Äúaccessibility‚Äù, which was measured as a percentage during the day.  As for the presence of goods in stock, this indicator is very relative: the fact that there was no product at some point did not mean that they wanted to buy it. <br>  Having experimented with different variants (reconstruction of ‚Äúactual demand‚Äù on the basis of differently calculated coefficients and filtering data sales with different availability thresholds), we finally picked up the optimal threshold, which did not make the data set too narrow.  The ideal - the availability of goods throughout the day - significantly reduced the data even for the best-selling goods. </p><br><h1 id="tovar-1-ohlazhdennoe-myaso-neobychnoy-pticy">  Item 1: Chilled Meat (Unusual Poultry) </h1><br><p>  We began to work with chilled meat, as there was no doubt that the model had a predictive ability as soon as it was ready in draft form.  (Spoiler: here and in vain - an interesting surprise awaited us in the sale of eggs, but more on that later). </p><br><p>  In order to save time out of the box, we got a ready-made library that works well with time series, <a href="https://facebook.github.io/prophet/">Prophet from Facebook</a> . </p><br><p><img src="https://habrastorage.org/webt/7r/rx/gw/7rrxgwqk6atrdqu1oeu8sk6p5cq.jpeg"></p><br><p>  The results of the model on the training data immediately show the advantages and disadvantages.  The model well captures the "seasonality" of demand, but poorly - peaks of purchases.  Also holidays, wired in Prophet by default.  The relative deviation is 31.36%, we will continue to use it as a baseline result. </p><br><p>  The built-in seasonal visualization tool that Prophet sees allows you to immediately get a little insight on how the purchases of one of the goods have changed in two years, what are their characteristics during the year and during the week: </p><br><p><img src="https://habrastorage.org/webt/db/jf/yc/dbjfycthb0j-fll7ohhsnpj7hkw.jpeg"></p><br><p>  Our chilled meat has a clear upward trend in the total number of purchases, the number of purchases grows from Monday to Saturday and falls on Sunday, in the summer purchases noticeably subside.  It is bad that summer does not fall into our test period;  on the other hand, let us remember that the period of holidays and vacations is important for the level of sales, because summer holidays are not the only ones in Russia. <br>  The logical question is: is it possible to use this model immediately for a forecast for the next six months? </p><br><p>  Intuitively, it seems not.  The experiment showed that it is.  The overall pattern of seasonality during the week is correct.  But it immediately became obvious that from the general pattern of seasonality there are a million deviations both up and down, and the average deviation of 45.71% greatly exceeds the results on the training data.  It is clear that this is no good. </p><br><p>  To begin with, we will try to train the model every day, imagining that every day after the store finishes, datasets are complemented with sales for "today."  We already know that in sales there is an uptrend as a whole - it is possible that the turnover on our test data is growing with greater intensity due to more active marketing activity than it was on the training set. <br>  Relative success: with daily additional training of the model, the relative deviation is 33.79%.  We supplemented the model parameters with information on postponed weekends, religious posts and holidays traditional for Russia (such as the New Year, Easter and a number of others).  Also, sharp weather changes were added: days when the temperature jumped up or down by 10+ degrees or was just noticeably higher or lower than the other days of this month.  Now, on average for six months, our forecast deviated from real sales by 28.48%, and on the whole, the model began to take better account of bursts of consumer activity.  We improved the average deviation by five percent!  Despite the fact that Prophet, in principle, does not work well with emissions, and it is recommended to clear the data from them - this was a noticeable movement forward. </p><br><p><img src="https://habrastorage.org/webt/re/ro/-q/rero-qdm1shf0vzdpvzwsnpxt-a.jpeg"></p><br><p><img src="https://habrastorage.org/webt/yx/ti/eb/yxtiebgsxrshllenrvxecrjtpt8.jpeg"></p><br><p>  Before showing preliminary results, the question arose: can we improve the forecast a little more?  If you look at the correlation of sales of goods and its average price per day - it is clear that these are related signs, and the price is not taken into account when building a model.  But judging by the data set, we could only take a certain ‚Äúaverage price per unit‚Äù: in orders it often varied during the same day, i.e.  It was recorded with the personal discount of the buyer, and the ‚Äúshop-window‚Äù prices were not included in the data set. </p><br><p><img src="https://habrastorage.org/webt/bu/wa/n2/buwan2m07cdlgqcd6cbcxotp7rs.jpeg"></p><br><p>  The correlation coefficient between the average price per unit per day and the number of sold volume of this type of chilled meat was ¬¨ ‚Äì0.61 with p &lt;0.01.  It is clear that the "average price per unit" is not an ideal indicator: if there were a lot of purchases from, say, partners with a constant big discount during the day, dangerous noises will creep into the data.  We wanted to single out the days when there were marketing influences: general discounts for a group of products, discounts for everyone who introduces freely distributed promotional code, etc. </p><br><p>  Nevertheless, even after the allocation of days with the average price in the 5% quantile as promotional, no increase in the accuracy of the model did not work out.  Increased accuracy in the days of extreme sales, and the average relative deviation for six months remained the same. </p><br><p>  But the idea of ‚Äã‚Äãa pronounced statistical relationship with the price saved for the future. </p><br><p><img src="https://habrastorage.org/webt/_e/3l/h_/_e3lh_1xiuyvlb_akisaspsf2fy.jpeg"></p><br><p> We were completely satisfied with the preliminary result, it was time to switch to other products before the time allotted for the pilot project ends. </p><br><h1 id="tovar-2-yayco-kurinoe">  Item 2: chicken egg </h1><br><p>  We were immediately warned that eggs are one of the most significant product categories in terms of the influence of external events.  First of all, the volume of purchases grows on Easter: eggs are painted and are prepared with eggs.  But more, of course, color.  This is easy to understand by comparing sales of white and brown eggs. </p><br><p><img src="https://habrastorage.org/webt/2w/uh/7n/2wuh7n_bynltspaaep_ep32cwhm.jpeg"></p><br><p>  In general, our model expects that there will be some increase in demand on Easter, but its forecast is almost 2 times lower than the real indicator (and this deviation of ~ 100% during Easter week makes the average deviation for half a year incredibly large).  Why?  After all, Easter week happens every year - there must be a pattern in these previous 2 years! </p><br><p>  Research analysis showed that there is no pattern.  In 2018 (this is our test data), the peak of purchases falls on the whole week before Easter until April 7.  At Easter itself (April 8, 2018), purchases of eggs always fall, which is perfectly correct for the model.  But in 2017, Easter falls on April 16, and the peak of purchases in historical data is April 8, and this year the peak is one day.  In 2016, Easter falls on May 1st.  The peak of purchases is April 29, with rises on the day before and the day after.  In 2015, Easter falls on April 12, the peak of shopping again one day, April 9. </p><br><p><img src="https://habrastorage.org/webt/9l/0z/lt/9l0zltkzwuhy1cximqdu92vsdt8.jpeg"></p><br><p>  Our first version was the influence of the days of the week (and the imagination painted the parents, who need to paint a dozen eggs by tomorrow, because it was a thematic lesson, and the child said this today).  Alas, it is not.  Probably, during Easter there are some factors that we have not yet found (and have not taken into account) - both external and related to the marketing of the company itself. </p><br><h1 id="smozhem-luchshe">  We can do better! </h1><br><p>  This story is about working with the retailer's data in a limited time, and not about secret machine learning techniques.  But in working with data there is an opportunity to improve the result. </p><br><p>  After working with products from the ‚ÄúChicken Egg‚Äù category, it became clear that the model could be improved by adding factors that we did not use in the pilot project.  Therefore, it was decided to conduct a small experiment with a random forest and data that we can collect from open sources.  Plus, we will be able to see how the model behaves, where the days of sale will have a versatile set of features, and not just a set of ‚Äúspecial days‚Äù allocated for various reasons. </p><br><p>  The following information was collected in the ‚Äúoutside world‚Äù data set: </p><br><ul><li>  full production calendar for each year; </li><li>  religious posts and holidays, secular holidays; </li><li>  weather conditions and their deviations from the average values ‚Äã‚Äãfor the month in the region, as well as fluctuations during the last month, day and week; </li><li>  dollar and euro exchange rates for the Central Bank and their fluctuations as indicators of the overall economic condition. </li></ul><br><p>  Separately added were signs of individual marketing campaigns and a unit price. </p><br><p>  On the extended data set, we again built a model that daily trained on new data, now using RandomForestRegressor.  Relative deviation improved slightly: up to 27.29%.  The graph shows that the new model better predicts the impact of marketing campaigns, but worse - weekly seasonality. </p><br><p><img src="https://habrastorage.org/webt/-t/e3/kn/-te3knyyeh3w1qfc8xkpzh6c9es.jpeg"></p><br><p>  Looking at the top-5 of the most important signs from the point of view of the used RandomForestRegressor, one can make sure that there are already two signs related to the cost of the goods ‚Äî the current price and its changes from the previous month.  Obviously, the fact that the price range could not be well placed in the FB Prophet, affected its accuracy. </p><br><p><img src="https://habrastorage.org/webt/de/27/_c/de27_cc35p7-evtdfjkyeahyz2u.jpeg"></p><br><p>  On checking whether we can think a little more and improve the result, the pilot study was completed.  The main goals were achieved: we showed that machine learning is in principle applicable for the retailer's data and shows good results even in the ‚Äúquick start‚Äù mode. </p><br><p>  <em>Alexandra Tsareva, Jet Intelligence Intelligent Analytics Specialist</em> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/445190/">https://habr.com/ru/post/445190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445180/index.html">Join Google Play Webinar March 29</a></li>
<li><a href="../445182/index.html">What can you personally get from 54-FZ, username, or DIY-automation of cost accounting</a></li>
<li><a href="../445184/index.html">New cybersecurity threats: everything is much bigger than you thought</a></li>
<li><a href="../445186/index.html">Creating a RPG fighting system</a></li>
<li><a href="../445188/index.html">What will be the gaming neural interfaces?</a></li>
<li><a href="../445192/index.html">4K: evolution or marketing?</a></li>
<li><a href="../445194/index.html">10 concepts for the designer in 2019</a></li>
<li><a href="../445196/index.html">Kubernetes 1.14: a review of major innovations</a></li>
<li><a href="../445198/index.html">Console Player cmus for Linux</a></li>
<li><a href="../445200/index.html">Internet providers ask the Ministry of Communications and Mass Media to let them into homes without an agreement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>