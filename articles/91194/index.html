<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tips & Tricks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In almost all programming languages, the same problem can be solved in several ways. However, some of them are better, some worse. For some, you need ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tips & Tricks</h1><div class="post__text post__text-html js-mediator-article">  In almost all programming languages, the same problem can be solved in several ways.  However, some of them are better, some worse.  For some, you need to write 10 lines of code, for others you can do without one. <br><br>  Improving the code and optimizing it sometimes takes more time than it took to write the first version.  You often met a new code for you or an interesting implementation, and said to yourself: ‚ÄúIt turns out that this can be done by standard means, and I invented the bicycle‚Äù?  Personally, I - yes.  Therefore, in this article I collected my collection of ‚Äúbikes‚Äù and told how to get rid of them. <br><br><h3>  Array Methods </h3><br>  A simple example - let's say you have an array of objects of the class User.  They have an activated property, which is set to 1 if the user has activated his account.  You need to check whether all users from the array are activated.  I do not take into account ActiveRecord (there you can do it differently), my goal is to show the work with arrays. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first method is the most primitive: <br><blockquote><ol><li> <code><font color="black"><font color="#0066ff"><b>@users</b></font> = User. <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>:all</b></font> <font color="#006600"><b>)</b></font> activated_users = 0 foreach user <font color="#9966CC"><b>in</b></font> <font color="#0066ff"><b>@users</b></font> activated_users <font color="#006600"><b>+</b></font> = <font color="#006666">1</font> <font color="#9966CC"><b>if</b></font> user. <font color="#9900CC">activated</font> == <font color="#006666">1</font> <font color="#9966CC"><b>end</b></font> <font color="#008000"><i>#   ,    </i></font> activated_users == <font color="#0066ff"><b>@users</b></font> . <font color="#5A0A0A"><b>size</b></font></font></code> </li> <li> <code><font color="black"><font color="#0066ff"><b>@users</b></font> = User. <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>:all</b></font> <font color="#006600"><b>)</b></font> activated_users = 0 foreach user <font color="#9966CC"><b>in</b></font> <font color="#0066ff"><b>@users</b></font> activated_users <font color="#006600"><b>+</b></font> = <font color="#006666">1</font> <font color="#9966CC"><b>if</b></font> user. <font color="#9900CC">activated</font> == <font color="#006666">1</font> <font color="#9966CC"><b>end</b></font> <font color="#008000"><i>#   ,    </i></font> activated_users == <font color="#0066ff"><b>@users</b></font> . <font color="#5A0A0A"><b>size</b></font></font></code> </li> <li> <code><font color="black"><font color="#0066ff"><b>@users</b></font> = User. <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>:all</b></font> <font color="#006600"><b>)</b></font> activated_users = 0 foreach user <font color="#9966CC"><b>in</b></font> <font color="#0066ff"><b>@users</b></font> activated_users <font color="#006600"><b>+</b></font> = <font color="#006666">1</font> <font color="#9966CC"><b>if</b></font> user. <font color="#9900CC">activated</font> == <font color="#006666">1</font> <font color="#9966CC"><b>end</b></font> <font color="#008000"><i>#   ,    </i></font> activated_users == <font color="#0066ff"><b>@users</b></font> . <font color="#5A0A0A"><b>size</b></font></font></code> </li> <li> <code><font color="black"><font color="#0066ff"><b>@users</b></font> = User. <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>:all</b></font> <font color="#006600"><b>)</b></font> activated_users = 0 foreach user <font color="#9966CC"><b>in</b></font> <font color="#0066ff"><b>@users</b></font> activated_users <font color="#006600"><b>+</b></font> = <font color="#006666">1</font> <font color="#9966CC"><b>if</b></font> user. <font color="#9900CC">activated</font> == <font color="#006666">1</font> <font color="#9966CC"><b>end</b></font> <font color="#008000"><i>#   ,    </i></font> activated_users == <font color="#0066ff"><b>@users</b></font> . <font color="#5A0A0A"><b>size</b></font></font></code> </li> <li> <code><font color="black"><font color="#9966CC"><b><font color="#0066ff"><b>@users</b></font> = User. <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>:all</b></font> <font color="#006600"><b>)</b></font> activated_users = 0 foreach user <font color="#9966CC"><b>in</b></font> <font color="#0066ff"><b>@users</b></font> activated_users <font color="#006600"><b>+</b></font> = <font color="#006666">1</font> <font color="#9966CC"><b>if</b></font> user. <font color="#9900CC">activated</font> == <font color="#006666">1</font> end <font color="#008000"><i>#   ,    </i></font> activated_users == <font color="#0066ff"><b>@users</b></font> . <font color="#5A0A0A"><b>size</b></font></b></font></font></code> </li> <li></li><li> <code><font color="black"><font color="#008000"><i><font color="#0066ff"><b>@users</b></font> = User. <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>:all</b></font> <font color="#006600"><b>)</b></font> activated_users = 0 foreach user <font color="#9966CC"><b>in</b></font> <font color="#0066ff"><b>@users</b></font> activated_users <font color="#006600"><b>+</b></font> = <font color="#006666">1</font> <font color="#9966CC"><b>if</b></font> user. <font color="#9900CC">activated</font> == <font color="#006666">1</font> <font color="#9966CC"><b>end</b></font> #   ,     activated_users == <font color="#0066ff"><b>@users</b></font> . <font color="#5A0A0A"><b>size</b></font></i></font></font></code> </li> <li> <code><font color="black"><font color="#0066ff"><b>@users</b></font> = User. <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>:all</b></font> <font color="#006600"><b>)</b></font> activated_users = 0 foreach user <font color="#9966CC"><b>in</b></font> <font color="#0066ff"><b>@users</b></font> activated_users <font color="#006600"><b>+</b></font> = <font color="#006666">1</font> <font color="#9966CC"><b>if</b></font> user. <font color="#9900CC">activated</font> == <font color="#006666">1</font> <font color="#9966CC"><b>end</b></font> <font color="#008000"><i>#   ,    </i></font> activated_users == <font color="#0066ff"><b>@users</b></font> . <font color="#5A0A0A"><b>size</b></font></font></code> </li> </ol></blockquote><a name="habracut"></a><br>  The first thing I did here was to use the each method of the array instead of a loop: <br><blockquote><ol><li>  <font color="#0066ff"><b>@users</b></font> = User.  <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>: all</b></font> <font color="#006600"><b>)</b></font> </li><li>  activated_users = 0 </li><li></li><li>  <font color="#008000"><i>I personally like this way of recording more</i></font> </li><li>  <font color="#008000"><i># than standard for many languages ‚Äã‚Äãforeach cycle</i></font> </li><li>  <font color="#0066ff"><b>@users</b></font> .  <font color="#5A0A0A"><b>each</b></font> <font color="#9966CC"><b>do</b></font> <font color="#006600"><b>|</b></font>  user <font color="#006600"><b>|</b></font> </li><li>  activated_users <font color="#006600"><b>+</b></font> = <font color="#006666">1</font> <font color="#9966CC"><b>if</b></font> user.  <font color="#9900CC">activated</font> == <font color="#006666">1</font> </li><li>  <font color="#9966CC"><b>end</b></font> </li><li></li><li>  <font color="#008000"><i># or in one line:</i></font> </li><li>  <font color="#0066ff"><b>@users</b></font> .  <font color="#5A0A0A"><b>each</b></font> <font color="#006600"><b>{</b></font> <font color="#006600"><b>|</b></font>  user <font color="#006600"><b>|</b></font>  activated_users <font color="#006600"><b>+</b></font> = <font color="#006666">1</font> <font color="#9966CC"><b>if</b></font> user.  <font color="#9900CC">activated</font> == <font color="#006666">1</font> <font color="#006600"><b>}</b></font> </li></ol></blockquote>  But even this record did not suit me afterwards.  I found a more rational option: <br><blockquote><ol><li>  <font color="#008000"><i># The select method allows you to pull out the elements of the array for a given condition</i></font> </li><li>  <font color="#008000"><i># And then we compare the sizes of both arrays</i></font> </li><li>  <font color="#0066ff"><b>@users</b></font> = User.  <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>: all</b></font> <font color="#006600"><b>)</b></font> </li><li>  <font color="#0066ff"><b>@users</b></font> .  <font color="#CC0066"><b>select</b></font> <font color="#006600"><b>{</b></font> <font color="#006600"><b>|</b></font>  user <font color="#006600"><b>|</b></font>  user.  <font color="#9900CC">activated</font> == <font color="#006666">1</font> <font color="#006600"><b>}</b></font> .  <font color="#5A0A0A"><b>size</b></font> == <font color="#0066ff"><b>@users</b></font> .  <font color="#5A0A0A"><b>size</b></font> </li></ol></blockquote>  However, all good things have already been invented for us, you just need to read the documentation.  Arrays have a wonderful all method ?, which checks whether all elements satisfy the condition.  By the way, there is still the any? Method that returns true if at least one element meets the condition. <br><br>  All our code can be written in just one line: <br><blockquote><ol><li>  <font color="#0066ff"><b>@users</b></font> .  <font color="#9900CC">all</font> ?  <font color="#006600"><b>{</b></font> <font color="#006600"><b>|</b></font>  user <font color="#006600"><b>|</b></font>  user.  <font color="#9900CC">activated</font> == <font color="#006666">1</font> <font color="#006600"><b>}</b></font> </li><li>  <font color="#008000"><i># or even like this:</i></font> </li><li>  <font color="#0066ff"><b>@users</b></font> .  <font color="#9900CC">all</font> ?  <font color="#006600"><b>(</b></font> <font color="#006600"><b>&amp;</b></font> activated <font color="#006600"><b>)</b></font> <font color="#008000"><i># provided that activated takes the value true / false, because</i></font>  <font color="#008000"><i>0 in ruby ‚Äã‚Äãis considered true</i></font> </li></ol></blockquote><br>  In addition, there are several little-known, but useful methods: <br><blockquote><ol><li>  <font color="#008000"><i># Take the first 5 items</i></font> </li><li>  <font color="#0066ff"><b>@array</b></font> .  <font color="#9900CC">take</font> <font color="#006600"><b>(</b></font> <font color="#006666">5</font> <font color="#006600"><b>)</b></font> </li><li></li><li>  <font color="#008000"><i># Select random item</i></font> </li><li>  <font color="#0066ff"><b>@array</b></font> .  <font color="#9900CC">choice</font> </li><li></li><li>  <font color="#008000"><i># Scatter items in random order</i></font> </li><li>  <font color="#0066ff"><b>@array</b></font> .  <font color="#9900CC">shuffle</font> ! </li><li></li><li>  <font color="#008000"><i># Get array element by its number</i></font> </li><li>  <font color="#008000"><i># And this method is faster than @array [1]</i></font> </li><li>  <font color="#0066ff"><b>@array</b></font> .  <font color="#9900CC">at</font> <font color="#006600"><b>(</b></font> <font color="#006666">1</font> <font color="#006600"><b>)</b></font> </li></ol></blockquote><br><h5>  What is the best way to count the number of elements in an array? </h5><br><br>  <strong>The count</strong> is the most functional.  You can set parameters in brackets: <br><blockquote><ol><li>  array = <font color="#006600"><b>[</b></font> <font color="#006666">1</font> , <font color="#006666">1</font> , <font color="#006666">2</font> , <font color="#006666">2</font> , <font color="#006666">3</font> , <font color="#006666">4</font> , <font color="#006666">5</font> <font color="#006600"><b>]</b></font> </li><li>  array.  <font color="#5A0A0A"><b>count</b></font> <font color="#008000"><i># =&gt; 7</i></font> </li><li>  array.  <font color="#5A0A0A"><b>count</b></font> <font color="#006600"><b>(</b></font> <font color="#006666">1</font> <font color="#006600"><b>)</b></font> <font color="#008000"><i># counts the number of elements "1" =&gt; 2</i></font> </li><li>  array.  <font color="#5A0A0A"><b>count</b></font> <font color="#006600"><b>{</b></font> <font color="#006600"><b>|</b></font>  p <font color="#006600"><b>|</b></font>  <font color="#CC0066"><b>p</b></font> <font color="#006600"><b>&gt;</b></font> <font color="#006666">2</font> <font color="#006600"><b>}</b></font> <font color="#008000"><i># count elements by condition =&gt; 3</i></font> </li></ol></blockquote><br><br>  <strong>Size</strong> or <strong>length</strong> (for arrays they are identical) is the fastest way, because its only purpose is to simply count the number of all elements. <br><br><h3>  Frequently Used ActiveRecord Requests </h3><br>  Another ‚Äúbicycle‚Äù that I met with is its own implementation of the <strong>named scope</strong> .  For example, you have a table Cars.  You need to frequently refer to the base and pull out cars of a certain color.  You can write your method in the model: <br><blockquote><ol><li>  <font color="#9966CC"><b>class</b></font> Car <font color="#006600"><b>&lt;</b></font> <font color="#6666ff"><b>ActiveRecord :: Base</b></font> </li><li>  <font color="#9966CC"><b>def</b></font> <font color="#0000FF"><b>self</b></font> .  <font color="#9900CC">only_red</font> </li><li>  <font color="#0000FF"><b>self</b></font> .  <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>: all</b></font> <font color="#ff3333"><b>,: conditions</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"color = 'red'"</font> <font color="#006600"><b>)</b></font> </li><li>  <font color="#9966CC"><b>end</b></font> </li><li>  <font color="#9966CC"><b>end</b></font> </li></ol></blockquote>  He just searches for all the cars in red.  It is easy to contact him - Car.only_red.  But the main drawback is that if you want to sort it all out (or add something like: limit =&gt; 5), you will have to either modify the method in the model, or use the standard find. <br><br>  Very convenient and easy to use named_scope comes to the rescue. <br><blockquote><ol><li>  <font color="#9966CC"><b>class</b></font> Car <font color="#006600"><b>&lt;</b></font> <font color="#6666ff"><b>ActiveRecord :: Base</b></font> </li><li>  named_scope <font color="#ff3333"><b>: red</b></font> ,: <font color="#ff3333"><b>conditions</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'color = "red"'</font> </li><li>  <font color="#9966CC"><b>end</b></font> </li></ol></blockquote><br>  Use it almost as well - Car.red.  But besides this, you can use it with the find method, for example: <blockquote><ol><li>  Car.  <font color="#9900CC">red</font> .  <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>: all</b></font> <font color="#ff3333"><b>,: limit</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#006666">10</font> <font color="#ff3333"><b>,: order</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"id DESC"</font> <font color="#006600"><b>)</b></font> </li></ol></blockquote>  And they can be combined.  First, add a new scope that will allow users who own the machines to be included in the request: <br><blockquote><ol><li>  named_scope <font color="#ff3333"><b>: with_users</b></font> , <font color="#ff3333"><b>include</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#ff3333"><b>: users</b></font> </li></ol></blockquote><br>  Now Car.red.with_users will create <em>you-know-what</em> query.  Conveniently?  Sure. <br><br><h3>  Link_to and his friends </h3><br>  Some more interesting analogs are at the most usual link link_to. <br><br>  The first is link_to_if, which will display the link only if it matches the condition.  If it does not match, there will be no link; instead, only text will remain. <br>  For example, we have the link ‚ÄúRaise Karma‚Äù.  If the user has already voted, it should not be available.  Some make a separate style for this purpose, and display the link as plain text.  But you can write: <br><blockquote><ol><li>  <font color="#5A0A0A"><b>link_to_if</b></font> <font color="#006600"><b>(</b></font> user. <font color="#9900CC">voted_for_karma</font> ? == <font color="#0000FF"><b>false</b></font> <font color="#006600"><b>)</b></font> , <font color="#996600">"Raise Karma</font> <font color="#996600">",:</font> <font color="#ff3333"><b>action</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"add_karma"</font> </li></ol></blockquote>  What can I change?  Of course, (user.voted_for_karma? == false) looks incomprehensible, because you can simply remove the comparison with false using link_to_unless: <br><blockquote><ol><li>  <font color="#5A0A0A"><b>link_to_unless</b></font> user.  <font color="#9900CC">voted_for_karma</font> ?, <font color="#996600">"Raise Karma</font> <font color="#996600">",:</font> <font color="#ff3333"><b>action</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"add_karma"</font> </li></ol></blockquote>  You can make it even cooler - let us inform you that the user has already voted. <br><blockquote><ol><li>  <font color="#008000"><i># link_name is here (not) used as the name of the original link</i></font> </li><li>  <font color="#5A0A0A"><b>link_to_unless</b></font> <font color="#006600"><b>(</b></font> user. <font color="#9900CC">voted_for_karma</font> ?, <font color="#996600">"Raise Karma</font> <font color="#996600">",:</font> <font color="#ff3333"><b>action</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"add_karma"</font> <font color="#006600"><b>)</b></font> <font color="#006600"><b>{</b></font> <font color="#006600"><b>|</b></font>  link_name <font color="#006600"><b>|</b></font>  <font color="#996600">"You have already voted"</font> <font color="#006600"><b>}</b></font> </li></ol></blockquote>  And you can also give another link if the user is not logged in, for example, redirect to registration: <br><blockquote><ol><li>  <font color="#5A0A0A"><b>link_to_if</b></font> <font color="#006600"><b>(</b></font> user. <font color="#9900CC">logged_in</font> ?, <font color="#996600">"Create topic</font> <font color="#996600">",:</font> <font color="#ff3333"><b>action</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"add_post"</font> <font color="#006600"><b>)</b></font> <font color="#9966CC"><b>do</b></font> <font color="#006600"><b>|</b></font>  link_name <font color="#006600"><b>|</b></font> </li><li>  <font color="#008000"><i># if a logged-in user will click on the link, he will go to the login page</i></font> </li><li>  <font color="#5A0A0A"><b>link_to</b></font> <font color="#006600"><b>(</b></font> link_name,: <font color="#ff3333"><b>controller</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"users"</font> ,: <font color="#ff3333"><b>action</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"login"</font> <font color="#006600"><b>)</b></font> </li><li>  <font color="#9966CC"><b>end</b></font> </li></ol></blockquote><br>  Quite often you can find the replacement of the link text, if the browser is on the current page.  This is done using link_to_unless_current: <br><blockquote><ol><li>  <font color="#808080"><i>&lt;! - index.html.erb -&gt;</i></font> </li><li>  <font color="#0000ff">&lt; <font color="#800000"><b>ul</b></font> <font color="#ff0000">id</font> <font color="#0000ff">=</font> <font color="#0000ff">"navbar"</font> &gt;</font> </li><li>  <font color="#0000ff">&lt; <font color="#800000"><b>li</b></font> &gt; &lt;% <font color="#0000ff">=</font> link_to_unless_current <font color="#0000ff">(</font> <font color="#0000ff">"Home"</font> , <font color="#0000ff">{</font> : <font color="#ff0000">action</font> <font color="#0000ff">=</font> &gt;</font> "index"})%&gt; <font color="#0000ff">&lt; <font color="#0000ff">/</font> <font color="#800000"><b>li</b></font> &gt;</font> </li><li>  <font color="#0000ff">&lt; <font color="#800000"><b>li</b></font> &gt; &lt;% <font color="#0000ff">=</font> link_to_unless_current <font color="#0000ff">(</font> <font color="#0000ff">"About Us"</font> , <font color="#0000ff">{</font> : <font color="#ff0000">action</font> <font color="#0000ff">=</font> &gt;</font> "about"})%&gt; <font color="#0000ff">&lt; <font color="#0000ff">/</font> <font color="#800000"><b>li</b></font> &gt;</font> </li><li>  <font color="#0000ff">&lt; <font color="#0000ff">/</font> <font color="#800000"><b>ul</b></font> &gt;</font> </li><li>  <font color="#808080"><i>&lt;! - if we go to the About Us page, then in the html code we will see the following: -&gt;</i></font> </li><li>  <font color="#0000ff">&lt; <font color="#800000"><b>ul</b></font> <font color="#ff0000">id</font> <font color="#0000ff">=</font> <font color="#0000ff">"navbar"</font> &gt;</font> </li><li>  <font color="#0000ff">&lt; <font color="#800000"><b>li</b></font> &gt; <font color="#ff0000">&lt;a href</font> <font color="#0000ff">=</font> <font color="#0000ff">"/ controller / index"&gt;</font></font> Home <font color="#0000ff">&lt; <font color="#0000ff">/</font> <font color="#800000"><b>a</b></font> &gt; &lt; <font color="#0000ff">/</font> <font color="#800000"><b>li</b></font> &gt;</font> </li><li>  <font color="#0000ff">&lt; <font color="#800000"><b>li</b></font> &gt;</font> About Us <font color="#0000ff">&lt; <font color="#0000ff">/</font> <font color="#800000"><b>li</b></font> &gt;</font> </li><li>  <font color="#0000ff">&lt; <font color="#0000ff">/</font> <font color="#800000"><b>ul</b></font> &gt;</font> </li></ol></blockquote><br><br><h3>  Russification Validation </h3><br>  Another problem that I once encountered was validation and errors.  My application was in Russian (of course), and by default, errors were issued in this format: ‚ÄúTitle cannot be empty.‚Äù <br><br>  First of all, you need to <a href="http://github.com/yaroslav/russian">install the Russian gem</a> , I really hope that you already know about it.  This will allow you to localize most standard messages. <br>  Then in the config / locales folder, open (or create, if not) the file ru.yml.  Here is an example from my file: <br><blockquote><ol><li>  ru: </li><li>  activerecord: </li><li>  <font color="#5A0A0A"><b>errors</b></font> : </li><li>  full_messages: </li><li>  rate: </li><li>  exists: <font color="#996600">"It is impossible to evaluate the same user twice"</font> </li><li>  number_limit: <font color="#996600">"The score may take values ‚Äã‚Äãfrom -2 to 2"</font> </li><li>  attributes: </li><li>  news: </li><li>  title: <font color="#996600">"Title"</font> </li><li>  body: <font color="#996600">"text"</font> </li><li>  article: <font color="#996600">"Article"</font> </li></ol></blockquote>  As you can see, to localize the title field in the news table, it‚Äôs enough to add the above entry to the localization file. <br><br>  The full_messages field is used for full error messages.  Here is how they are written in the model: <br><blockquote><ol><li>  <font color="#9966CC"><b>class</b></font> Rate <font color="#006600"><b>&lt;</b></font> <font color="#6666ff"><b>ActiveRecord :: Base</b></font> </li><li>  <font color="#5A0A0A"><b>validates_uniqueness_of</b></font> <font color="#ff3333"><b>: rate_owner_id,:</b></font> <font color="#ff3333"><b>message</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"rate.exists"</font> </li><li>  validates_inclusion_of <font color="#ff3333"><b>: value</b></font> ,: <font color="#ff3333"><b>in</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#006600"><b>[</b></font> <font color="#006600"><b>-</b></font> <font color="#006666">2</font> , <font color="#006600"><b>-</b></font> <font color="#006666">1</font> , <font color="#006666">1</font> , <font color="#006666">2</font> <font color="#006600"><b>]</b></font> <font color="#996600">,:</font> <font color="#ff3333"><b>message</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"rate.number_limit"</font> </li><li>  <font color="#9966CC"><b>end</b></font> </li></ol></blockquote>  The message parameter takes the localization file, goes to the address activerecord.errors.full_messages, then at the specified in the model, and returns the localized string.  Everything is quite simple.  If you do not specify message, then the output will be a standard error phrase, but in my case, I replaced it with mine. <br><br><h3>  Methods for the controller </h3><br>  If you need to give data in an action and as an Ajax, and ‚Äúin the old-fashioned way‚Äù, then a check for it can be done using request.xhr?, For example: <br><blockquote><ol><li>  <font color="#9966CC"><b>def</b></font> search </li><li>  <font color="#0066ff"><b>@users</b></font> = User.  <font color="#9900CC">find</font> <font color="#006600"><b>(</b></font> <font color="#ff3333"><b>: all</b></font> <font color="#ff3333"><b>,: conditions</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#996600">"login LIKE '# {params [: q]}'"</font> <font color="#ff3333"><b>,: limit</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#006666">30</font> <font color="#006600"><b>)</b></font> </li><li>  <font color="#5A0A0A"><b>render</b></font> <font color="#ff3333"><b>: json</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#0066ff"><b>@users</b></font> <font color="#9966CC"><b>if</b></font> request.  <font color="#9900CC">xhr</font> ? </li><li>  <font color="#9966CC"><b>end</b></font> </li></ol></blockquote>  Another useful method is verify.  Judging by the name, it serves to ensure that the correct request has arrived at the controller.  This is mainly for protection, and I strongly recommend using it for some methods. <br><blockquote><ol><li>  <font color="#9966CC"><b>class</b></font> UsersController <font color="#006600"><b>&lt;</b></font> ApplicationController </li><li>  <font color="#008000"><i># We check the create method - it should only accept post requests and the specified parameters.</i></font> </li><li>  <font color="#008000"><i># If something is wrong, then we redirect the user to the beginning, and add a flash error message.</i></font> </li><li>  verify <font color="#ff3333"><b>: only</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#ff3333"><b>: create</b></font> ,: <font color="#ff3333"><b>method</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#ff3333"><b>: post</b></font> <font color="#ff3333"><b>,: params</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#006600"><b>[</b></font> <font color="#ff3333"><b>: login</b></font> <font color="#ff3333"><b>,: email,:</b></font> <font color="#ff3333"><b>name</b></font> <font color="#006600"><b>]</b></font> <font color="#ff3333"><b>,:</b></font> <font color="#ff3333"><b>redirect_to</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#ff3333"><b>: index</b></font> <font color="#ff3333"><b>,: add_flash</b></font> <font color="#006600"><b>=&gt;</b></font> <font color="#006600"><b>{</b></font> : error <font color="#006600"><b>=&gt;</b></font> <font color="#996600">'Invalid request.</font>  <font color="#996600">Are you all right? "</font>  <font color="#006600"><b>}</b></font> </li><li>  <font color="#9966CC"><b>end</b></font> </li></ol></blockquote>  By the way, you should not paint the error in as much detail as possible - the main validation should take place in the model.  Immediately we check the parameters, and swear if something is wrong. <br><br><h3>  Debugging </h3><br>  I use logger and ruby-debug gems for debugging applications.  Logger is a simple and fast way to find out ‚Äúwhy the hell is it nil instead of users returns‚Äù.  It is done simply: <br><blockquote><ol><li>  <font color="#008000"><i># inspect I call to conveniently display objects in the console</i></font> </li><li>  logger.  <font color="#9900CC">debug</font> <font color="#996600">"users = # {users.inspect}"</font> </li></ol></blockquote>  By the way, you can use not only logger.debug, but also logger.info, logger.warn or even logger.fatal.  In your own classes, you can write RAILS_DEFAULT_LOGGER.debug, because it will not respond to the phrase logger.debug. <br><br>  If you need to see or change the state of variables, you can use the debugger.  To do this, put a debugger entry, for example: <br><blockquote><ol><li>  <font color="#9966CC"><b>class</b></font> UsersController <font color="#006600"><b>&lt;</b></font> ApplicationController </li><li></li><li>  <font color="#9966CC"><b>def</b></font> index </li><li>  <font color="#0066ff"><b>@user</b></font> = User.  <font color="#9900CC">find_by_id</font> <font color="#006600"><b>(</b></font> params <font color="#006600"><b>[</b></font> <font color="#ff3333"><b>: id</b></font> <font color="#006600"><b>]</b></font> <font color="#006600"><b>)</b></font> </li><li>  role = <font color="#0066ff"><b>@user</b></font> .  <font color="#9900CC">role</font> </li><li>  debugger </li><li>  <font color="#9966CC"><b>end</b></font> </li><li>  <font color="#9966CC"><b>end</b></font> </li></ol></blockquote>  After that, we need to either start the server with the - debugger parameter, or add <blockquote><ol><li>  <font color="#CC0066"><b>require</b></font> <font color="#996600">'ruby-debug'</font> </li></ol></blockquote>  in environment.rb.  After that we update the index page in the browser - but it will stop and will not be loaded.  It's time to look into the console, there is a debugger waiting for us. <br><blockquote><ol><li>  (rdb: 1) irb </li><li>  irb (# &lt;UsersController: 0x1039edd20&gt;): 001: 0&gt; @user </li><li>  =&gt; # &lt;User id: 1, login: "Vizakenjack"&gt; </li><li>  irb (# &lt;UsersController: 0x1039edd20&gt;): 001: 0&gt; @ user.login = 'Admin' </li><li>  =&gt; "Admin"&gt; </li></ol></blockquote><br>  First go to irb, and then we look at our variables.  In addition to viewing, they can be changed and then later let them into the application. <br><br>  According to the debugger, you can write a whole book, here I gave examples of basic use only.  For those who want "everything at once" - read the links in the paragraph below. <br><h3>  Conclusion </h3><br><br>  Here I will provide some useful links that have helped me, and, I hope, will be useful to you too. <br><ul><li>  <a href="http://guides.rubyonrails.org/">Guides on rails</a> .  In English.  Very useful collection of articles. </li><li>  <a href="http://ruby-toolbox.com/">Ruby Toolbox</a> - a collection of plugins, gems and extensions.  For all occasions. </li><li>  <a href="http://apidock.com/rails/">Rails API</a> and <a href="http://apidock.com/ruby/">Ruby API</a> .  Documentation of language and framework.  Although there are a lot of analogues, I liked this site. </li><li>  <a href="http://ru.wikibooks.org/wiki/Ruby">Wikibooks for Ruby</a> , in Russian.  It is read very easily.  For interest, you can go to the "Networks" section - there is even a description of the Trojan! </li><li>  <a href="http://rubular.com/">Rubular</a> is a website for creating and testing regular expressions. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/91194/">https://habr.com/ru/post/91194/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../91178/index.html">Are there people on Habr√© with their opinions?</a></li>
<li><a href="../91181/index.html">Created the first in Russia rating of popular blog entries on music</a></li>
<li><a href="../91188/index.html">Implementing a SAMBA Resilient File Service</a></li>
<li><a href="../91190/index.html">Using Snapshots in Hyper-V</a></li>
<li><a href="../91193/index.html">Canobuvosti, 35th edition</a></li>
<li><a href="../91201/index.html">I didn‚Äôt expect it myself</a></li>
<li><a href="../91203/index.html">The serial number</a></li>
<li><a href="../91205/index.html">The harsh realities of the game</a></li>
<li><a href="../91206/index.html">You can carry a mobile phone in your pocket!</a></li>
<li><a href="../91208/index.html">MacBook Pro 15 "Unibody Core i5 inside</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>