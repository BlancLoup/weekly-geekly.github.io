<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Solving the problem of finding the angles of installation of a video camera over the road using different methods in Wolfram Mathematica. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Formulation of the problem 
 There is a system located above the roadway, which includes a video camera. Known camcorder resolution and viewing angles...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Solving the problem of finding the angles of installation of a video camera over the road using different methods in Wolfram Mathematica. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/4c9/945/4f2/4c99454f24a7ad25c03d02f6839026b6.png"><br><br><h4>  Formulation of the problem </h4><br>  There is a system located above the roadway, which includes a video camera.  Known camcorder resolution and viewing angles.  Regarding the roadway, the video camera is installed as follows: from above above any of the lanes, to the side of the roadway no more than 3 meters from the edge of the nearest controlled lane.  The number of simultaneously controlled traffic lanes is no more than 4. The video camera takes photographs of the control zone with a certain frame rate.  All the frames taken are input to the license plate recognition system.  The result of the passage of the vehicle (hereinafter referred to as TC) is a track with the coordinates of the center of the frame of the vehicle license plate in the form: <br><a name="habracut"></a><br> <code>x11 y11 x12 y12 ‚Ä¶ x1i y1i ‚Ä¶ x1n y1n</code> <br> <br>  The result of the passage of several vehicles is a file of tracks in the form: <br><br> <code>x11 y11 x12 y12 ‚Ä¶ x1i y1i ‚Ä¶ x1n y1n</code> <br> <code>x21 y21 x22 y22 ‚Ä¶ x2i y2i ‚Ä¶ x2n y2n</code> <br> <code>...</code> <br> <code>xi1 yi1 xi2 yi2 ‚Ä¶ xii yii ‚Ä¶ xin yin</code> <br> <code>...</code> <br> <code>xn1 yn1 xn2 yn2 ‚Ä¶ xni yni ‚Ä¶ xnn ynn</code> <br> <br>  Sample track file: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>1420 23 1399 44 1377 62 1351 82</code> <br> <code>417 327 368 359 313 392 119 500 48 540</code> <br> <code>2300 62 2291 91 2275 125 2267 159 2254 197</code> <br> <code>2298 114 2263 223 2199 413 2180 470 2158 532</code> <br> <br>  It is necessary, having a file with the structure described above, to determine the angle of inclination of the video camera relative to the trajectories of vehicles and rotation of the video camera relative to the edge of the shoulder. <br><br><h4>  Data import </h4><br>  We import data with which we will work. <br><br>  Our file is located in the directory from which the laptop is launched (Mathematica document), called recdat.txt file.  For import, enter: <br><br> <code>file = Import[NotebookDirectory[] &lt;&gt; "recdat.txt", "Table"];</code> <br> <br>  <code>file</code> - the variable into which the file is imported <br>  <code>NotebookDirectory[]</code> - returns the directory where the laptop is located as a string <br>  <code>&lt;&gt;</code> - abbreviated notation of a function connecting strings <br>  <code>"recdat.txt"</code> is a string indicating the name of the file with the tracks. <br>  <code>"Table"</code> is an option of the Import [] function indicating that this file must be imported as a table, respectively, the file variable will have the type of a table (list) <br>  Symbol <code>;</code>  at the end of the line says that Mathematica will not display the result of the execution of the described function after its execution. <br>  Pressing Shift + Enter will import our file. <br><br>  To see how the data was imported, you must enter file and press Shift + Enter, but for a more visual display of information, we will use the following function: <br><br> <code>TableForm[file]</code> <br> <br> <code>1420 23 1399 44 1377 62 1351 82</code> <br> <code>417 327 368 359 313 392 119 500 48 540</code> <br> <code>2300 62 2291 91 2275 125 2267 159 2254 197</code> <br> <code>2298 114 2263 223 2199 413 2180 470 2158 532</code> <br> <br>  <code>TableForm[list]</code> - performs output with list elements located in an array of rectangular elements <br><br>  We determine the constants that define the resolution of the video camera and the viewing angles: <br><br> <code>Xlen = 2360; (*  *)</code> <br> <code>Ylen = 1776; (*   *)</code> <br> <code>Xang = 14; (*   *)</code> <br> <code>Yang = Xang*3/4; (*   *)</code> <br> <br>  Determine the number of tracks in the file: <br><br> <code>length = Length[file];</code> <br> <br>  <code>Length[list]</code> - returns the number of elements of a one-dimensional list or the number of dimensions in the case of a multi-dimensional list <br><br><h4>  Expanding imported data into structure </h4><br>  The imported data is a structure that is inconvenient to work in Mathematica.  It will be much more convenient to work with them if you decompose them into a structure in the form of a three-dimensional list, where the element with index i, j consists of two elements - the x- and y-coordinates of the center of the plate, while i is the serial number of the plate, and j - the sequence number of the track point for the i-th license plate. <br><br><h5>  A small digression from the topic: </h5><br><blockquote>  In Mathematica, the same action can be done in different ways, because  Wednesday includes a huge set of different functions;  one and the same action can be done with the help of a cycle, and it is possible using the special function Mathematica.  As a rule, the execution time of an action aimed at one and the same functionality is less when it is performed using the standard Wolfram function, rather than when it is performed using a handwritten loop.  <code>Timing[]</code> function helps determine the execution time of a function or set of functions. </blockquote><br><br>  To create a list in which we decompose the structure, first declare the variable as a list: <br><br> <code>num = {};</code> <br> <br>  To lay out our data structure, we write a loop: <br><br> <code>Do[num = Append[num,</code> <br> <code>Partition[file[[i]], 2]],</code> <br> <code>{i, length}]</code> <br> <br>  <code>Do</code> [action, {loop condition}] <br>  <code>Append[list,element]</code> - appends the element to the end of the list <br>  <code>Partition[list,n]</code> - splits the list into non-overlapping parts with length n.  If the number of elements in the list is not completely divided by n, then the last k (k &lt;n) elements are deleted. <br>  <code>file[[i]]</code> - returns i list item <br><br>  Now let us turn to the function already familiar to us, and see what the structure looks like that is convenient for further processing: <br><br> <code>TableForm[num, TableSpacing -&gt; {3, 4}]</code> <br> <br><img src="https://habrastorage.org/storage2/3c0/622/cac/3c0622cac0bb7925e43eecd0cefc1603.png"><br><br>  <code>TableSpacing -&gt; {3, 4}</code> - sets indents between list items when displaying <br><br><h4>  Getting track equations </h4><br>  In the particular case of the track point must be linearized.  ‚ÄúIn private‚Äù because the data considered above was obtained on a straight road where vehicles move at high speeds and during the passage of the control zone, physically at such speed they cannot move along paths that are very different from straight lines. <br><br>  Equations of motion of the vehicle we will write in the list.  To do this, we first declare it: <br><br> <code>numeq = {};</code> <br> <br>  And write a function to determine the equations of motion of the vehicle through the control zone.  Here it is necessary to say that the origin of coordinates in the frame is the upper left corner of the frame, so: <br><br> <code>Do[numeq = Append[numeq,</code> <br> <code>Fit[num[[i]], {1, x}, x]],</code> <br> <code>{i, length}]</code> <br> <br>  Fit [data, funs, vars] - for the data list, data searches for the least squares approximation in the form of a linear combination of funs functions of vars variables.  Data data can have the form {{x1, y1, ..., f1}, {x2, y2, ..., f2}, ...}, where the number of coordinates x, y, ... is equal to the number of variables in the vars list .  Also, data data can be represented in the form {f1, f2, ...} with one coordinate, which takes values ‚Äã‚Äã1,2, ... Argument funs can be any list of functions that depend only on vars objects. <br><br>  In our case, for each i-th element of the multidimensional num list containing a two-dimensional array of points ‚Äî the TS license plate centers ‚Äî we determine, using the least squares method, the function of the form kx + b closest to the existing set of points. <br><br>  The result of the execution of this cycle is a list, which roughly consists of the following: <br><br> <code>{1167.11 - 0.803101 x, 568.193 - 0.571513 x, 6110.1 - 2.62293 x, 6471.36 - 2.75496 x, 1199.09 - 0.812067 x, 2491.96 - 1.29425 x, 1121.33 - 0.787616 x, 2933.43 - 1.75218 x, 625.959 - 0.609492 x, 2512.3 - 1.30408 x, 7805.9 - 3.3897 x, 881.413 - 0.698268 x, 2651.99 - 1.3463 x, 6140.19 - 2.61239 x, 2594.17 - 1.27645 x, 557.83 - 0.587095 x, 1195.29 - 0.82697 x, 6346.13 - 2.73884 x, 6887.01 - 2.92561 x, 2377.62 - 1.26743 x, 3241.53 - 1.72441 x, 1424.49 - 0.846298 x, 1218.75 - 0.83174 x, 7203.35 - 3.089 x, 5420.94 - 2.28441 x, 2500.74 - 1.29295 x, 2402.61 - 1.25934 x, 6760. - 2.89566 x, 1175.7 - 0.794353 x, 1117.2 - 0.77705 x, 7066.9 - 3.00537 x, 2346.99 - 1.24765 x, 2698.98 - 1.39178 x, 1277.43 - 0.849703 x, 633.372 - 0.61772 x, 2578.56 - 1.3082 x, 2952.21 - 1.47007 x, 1107.8 - 0.7861 x, 2352.46 - 1.24075 x, 2326.56 - 1.23348 x...}</code> <br> <br><h4>  Graphic representation of data and lines according to the list of equations </h4><br>  After getting the equations, we can display on the chart all points we have and the corresponding equations. <br>  To display a list of points on the graph in Mathematica, there is a <code>ListPlot[]</code> function, and to display functions, there is a <code>Plot[]</code> function.  In order to display a graph with points and function graphs on one graph, or to override graph parameters, there is a <code>Show[]</code> function.  Let's write these functions for our case: <br><br> <code>eqlineplot = Plot[numeq[[Range[length]]], {x, 0, Xlen}];</code> <br> <code>numplot = ListPlot[num[[Range[length]]]];</code> <br> <code>Show[</code> <br> <code>eqlineplot,</code> <br> <code>numplot,</code> <br> <code>AspectRatio -&gt; 3/4, Frame -&gt; False,</code> <br> <code>PlotRange -&gt; {{0, Xlen}, {0, Ylen}}]</code> <br> <br>  And the result of its implementation: <br><br><img src="https://habrastorage.org/storage2/6c7/384/cd8/6c7384cd8f21686fb7c20d2b646111b9.png"><br><br>  This graph is reversible relative to the axis OX, since  his point of origin is in the lower left edge, and not like the camera - in the upper left.  But this does not prevent us from understanding that the lines intersect somewhere in the vicinity of a single point - a point from which we will continue to measure angles.  Below is a graph with slightly modified drawing areas, which shows the intersection of lines in the vicinity of one point: <br><br><img src="https://habrastorage.org/storage2/4c9/945/4f2/4c99454f24a7ad25c03d02f6839026b6.png"><br><br>  Let's take a closer look at the function entries: <br><br>  eqlineplot = Plot [numeq [[Range [length]]], {x, 0, Xlen}]; <br><br>  Plot [list of features that appear on the graph, <br>  {variable whose functions are built, <br>  its minimum value <br>  its maximum value}] <br><br>  Range [imax] - generates a list of numeric elements {1, 2, ..., imax} <br><br>  Show [ <br>  eqlineplot <br>  numplot <br>  AspectRatio -&gt; 3/4, Frame -&gt; False, <br>  PlotRange -&gt; {{0, Xlen}, {0, Ylen}}] <br><br>  AspectRatio -&gt; 3/4 - Set Aspect Ratios <br>  PlotRange -&gt; {{0, Xlen}, {0, Ylen}} set the range of drawing graphs in the X and Y coordinates <br>  Frame -&gt; False - we inform Mathematica that around the graph it is not necessary to draw a frame. <br><br><h4>  What's next? </h4><br>  In the sequel, if you find it interesting and necessary, I will talk about several techniques for finding the points of intersection of graphs, introduce you to statistical data processing and data analysis using the example of the problem in question. </div><p>Source: <a href="https://habr.com/ru/post/175047/">https://habr.com/ru/post/175047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../175035/index.html">How I searched implemented or typical problems of introducing PDM systems in post-Soviet production</a></li>
<li><a href="../175037/index.html">Using Photon Cloud in Unity3D</a></li>
<li><a href="../175039/index.html">Don Jones "Creating a unified IT monitoring system in your environment." Chapter 5. Turning problems into solutions</a></li>
<li><a href="../175041/index.html">CDNvideo - 3 years!</a></li>
<li><a href="../175045/index.html">50 awesome jQuery plugins</a></li>
<li><a href="../175049/index.html">We optimize, optimize and optimize again</a></li>
<li><a href="../175051/index.html">Use dynamic to quickly create xml</a></li>
<li><a href="../175053/index.html">Manage images and other binary content of your web project</a></li>
<li><a href="../175055/index.html">As we did SaaS: the practice of building a cloud product on the example of EZ-Login. Part 1. On analytics</a></li>
<li><a href="../175057/index.html">Humble Bundle with Android Games</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>