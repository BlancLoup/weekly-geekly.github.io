<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We analyze the protocol of new sensors Noolite</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 Last week, the company Notechnika released the first two sensors - movement and temperature and humidity for its Noolite light remote contro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We analyze the protocol of new sensors Noolite</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/5bb/86e/88f/5bb86e88f6a1b6901f373331b326910d.jpg" alt="image"><br><br>  Hello! <br><br>  Last week, the company Notechnika <a href="http://habrahabr.ru/post/228343/">released the first two sensors - movement and temperature and humidity</a> for its Noolite light remote control line. <br>  Unfortunately, working with a temperature and humidity sensor using a native USB receiver from Nootechnika is not supported, only through their Ethernet gateway. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In our controller for home automation, <a href="http://habrahabr.ru/company/contactless/blog/213243/">Wiren Board Smart Home</a> has a built-in universal transceiver at a frequency of 433MHz, with which you can work with many devices.  This means that WB Smart Home can work with Noolite devices directly, without the use of Noote USB receivers and transmitters. <br><br>  However, in order to work with third-party devices, it is usually necessary to start with reverse engineering (ie hacking) of the radio exchange protocol. <br>  The Noolite protocol, used in the lighting control units, we uncovered and disassembled <a href="http://habrahabr.ru/company/contactless/blog/216023/">in one of the previous articles</a> . <br><br>  In this article, we will describe the reverse engineering of the PT111 sensor protocol, updated information about the Noolite protocol device in general, and also show how the work with the sensors looks in WB Smart Home. <br><br><a name="habracut"></a><br><br><h4>  Sensors </h4><br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc6/199/f04/dc6199f04d47038bd4da536005303eb9.jpg" alt="image"><br>  (as always, thanks to <a href="https://habrahabr.ru/users/dima117/" class="user_link">dima117</a> and <a href="http://thinking-home.ru/">thinking-home.ru</a> for very promptly provided devices for experiments.) <br><br>  As already mentioned, Notehnika has released two sensors: motion PM111 and temperature / humidity PT111.  According to rumors, another temperature sensor is preparing for the exit. <br><br><h5>  PM111 </h5><br><br>  The PM111 motion sensor has a PIR sensor and a light sensor.  The sensor works similarly to Noolite consoles. <br>  After detecting motion, the sensor sends a command to turn on, after a certain time after no movement, a command to turn off. <br>  The sensitivity of the sensor, the duration of the activation and the illumination threshold are adjustable. <br><br>  Motion sensor with rear cover and protective cap removed (pictures are clickable): <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/970/04a/8f2/97004a8f2fb381efba3c1126bfad4e33.jpg"></a> <br><br>  By the way, an interesting trace of the board. <br><br><h5>  Temperature and humidity sensor PT111 </h5><br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f63/593/4de/f635934dea01bbd434cc75018c54bb38.jpg"></a> <br><br>  Inside the sensor is used <a href="http://www.sensirion.com/en/products/humidity-temperature/humidity-sensor-sht10/">Sensirion SHT10</a> . <br>  The SHT10 sensor is quite expensive: the wholesale price in Russia is <a href="http://www.efind.ru/icsearch/%3Fsearch%3DSHT10">more than 400 rubles</a> , the Chinese sell them for $ 6.  Apparently this partly determines the rather high price of the final product. <br><br>  PT111 is able to work in three modes: actually in the mode of transfer of indications, and also in the modes of the thermostat and a hygrostat. <br>  In the last two modes, the PT111 emulates a conventional Noolite remote control, sending on and off commands when the temperature or humidity passes through a predetermined threshold. <br><br>  In the thermostat and hygrostat modes, the sending of readings is disabled for some reason. <br><br>  Unlike the common Oregon Scientific weather sensors, the PT111 sends a data packet only when the temperature or humidity changes, but no more than once per minute. <br><br>  A button is located on the rear panel of the sensor. When clicked, the PT111 sends bind or unlink commands.  When you press a button in sensor mode, the PT111 also immediately sends a data packet if it has changed since the last time. <br><br><h4>  PT111 protocol </h4><br><br>  The reverse engineering of the protocol, as always, begins with the collection of package dumps. <br>  As mentioned above, the PT111 has an undocumented feature that is very useful for debugging - the sensor sends readings when you click on the snap button. <br><br>  The task was somewhat complicated by the fact that we did not have an official Noolite receiver (ethernet gateway) on hand.  This means that there was no correct exact temperature and humidity for each data package. <br><br>  In the process of collecting data, we sent the sensor to the freezer, heated it, etc., to collect as much data as possible. <br><br>  This is how the data coming from the sensor looks as it is received by the daemon of the Wiren Board Smart Home radio module: <br><br><pre><code class="hljs ruby">$ mosquitto_sub -v -t /events/wb-homa-rcd/protocols/+ <span class="hljs-regexp"><span class="hljs-regexp">/events/wb</span></span>-homa-rcd/protocols/raw raw=aaaaaaaaaaaaaaa85559aaa5569a66a6aaa6a960aab3554aad34cd4d554d52c055555555555555555550aaaaad34cd55554cb4a155555a699aaaaa99 /events/wb-homa-rcd/protocols/noo raw=<span class="hljs-number"><span class="hljs-number">1111110100000011111001001010001000000010000110</span></span> fmt=<span class="hljs-number"><span class="hljs-number">1</span></span> cmd=<span class="hljs-number"><span class="hljs-number">15</span></span> flip=<span class="hljs-number"><span class="hljs-number">1</span></span> addr=<span class="hljs-number"><span class="hljs-number">149</span></span>f</code> </pre> <br><br>  The package presented here is a remote binding package sent by pressing a button on the sensor. <br><br>  The data packet looks like this (the decoding is already shown here): <br><br><pre> <code class="hljs pgsql">/events/wb-homa-rcd/protocols/raw raw=aaaaaaaaaaaaaaa1999aaa9a9aa6a6569555555a699a95aa9a6a4333355535354d4cad2aaaaab4d3352b5534d480000000000000000000000101ffff /events/wb-homa-rcd/protocols/noo addr=<span class="hljs-number"><span class="hljs-number">149</span></span>f <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>=<span class="hljs-number"><span class="hljs-number">27.2</span></span> lowbat=<span class="hljs-number"><span class="hljs-number">0</span></span> fmt=<span class="hljs-number"><span class="hljs-number">7</span></span> cmd=<span class="hljs-number"><span class="hljs-number">21</span></span> flip=<span class="hljs-number"><span class="hljs-number">0</span></span> humidity=<span class="hljs-number"><span class="hljs-number">58</span></span> raw=<span class="hljs-number"><span class="hljs-number">10101010000000100010000100010111001111111111111001001010001110000010010001</span></span></code> </pre><br><br>  Source package <br><pre> <code class="hljs">aaaaaaaaaaaaaaa1999aaa9a9aa6a6569555555a699a95aa9a6a4333355535354d4cad2aaaaab4d3352b5534d480000000000000000000000101ffff</code> </pre><br>  after cutting off the tail and pre-bubble and converting from the <a href="http://en.wikipedia.org/wiki/Manchester_code">Manchester code,</a> it looks like this: <br><br><pre> <code class="hljs">10101010000000100010000100010111001111111111111001001010001110000010010001</code> </pre><br><br><h5>  ‚ÄúExtended‚Äù package format </h5><br><br>  We divide the message into octets, starting from the end ‚Äî in Noolite packets, the format and size of the packet are encoded at the end of the packet. <br><br><pre> <code class="hljs lisp"><span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10101000</span></span> <span class="hljs-number"><span class="hljs-number">00001000</span></span> <span class="hljs-number"><span class="hljs-number">10000100</span></span> <span class="hljs-number"><span class="hljs-number">01011100</span></span> <span class="hljs-number"><span class="hljs-number">11111111</span></span> ( , <span class="hljs-number"><span class="hljs-number">16</span></span> bit ) <span class="hljs-number"><span class="hljs-number">11111001</span></span> <span class="hljs-number"><span class="hljs-number">00101000</span></span> () <span class="hljs-number"><span class="hljs-number">11100000</span></span> () <span class="hljs-number"><span class="hljs-number">10010001</span></span></code> </pre><br><br>  We know the values ‚Äã‚Äãof the last 4 bytes: these are 2 bytes of the block address, a format code byte and a checksum byte. <br>  Unlike previously known packages, this one has a fmt = 7 format code. <br><br>  There is another difference from packets with commands of ordinary remote controls: the number of first bits. <br><br>  Here is the package with the usual shutdown command: <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta">#ch:2 off_ch 110000 10011111 10100100 00000000 10000100 # fmt=0</span></span></code> </pre><br><br>  Here before the bytes is a block of 6 bits.  The first bit is always one, the next bit (flip) is inverted every transmission (to distinguish duplicates of a command from a new command), then 4 bits go that specify the command code. <br><br>  In the ‚Äúextended‚Äù format, the first block has 10 bits.  The value of the first bit is not clear, for the PT111 sensor it is always equal to one.  The next bit is the flip bit.  The command in this format has already been allocated 8 bits, not 4. The packet format (extended or normal) is determined by the format code of the last but one byte.  The ‚Äúextended‚Äù format, in addition to the PT111 sensor itself (fmt = 7), is also seen in the ‚Äúswitch mode‚Äù and ‚Äúswitch color‚Äù commands of the Noolite USB transmitter with the fmt = 4 format code. <br>  In the "extended" format, command codes from the normal format are not used, i.e.  0-15 - enters 4 bits;  Command codes start at 16. <br><br>  Depending on the packet format, the checksum (last byte) is also considered differently.  The counting function - crc8_maxim - remains the same in both cases, but the first block is processed differently, not a multiple of eight bits: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cmd &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>: data = chr(((cmd &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) | flip_bit) &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: data = chr(flip_bit &lt;&lt; <span class="hljs-number"><span class="hljs-number">7</span></span>) + chr(cmd)</code> </pre><br><br>  The final package parser looks like this (all the code is in the <a href="https://github.com/contactless/rfm69-linux/blob/master/noolite.py">repository</a> ): <br><div class="spoiler">  <b class="spoiler_title">package parser</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parsePacket</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, packet)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(packet) &lt; <span class="hljs-number"><span class="hljs-number">38</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> remainder = (len(packet) - <span class="hljs-number"><span class="hljs-number">6</span></span> ) % <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> remainder != <span class="hljs-number"><span class="hljs-number">0</span></span>: packet += <span class="hljs-string"><span class="hljs-string">'0'</span></span>*(<span class="hljs-number"><span class="hljs-number">4</span></span>-remainder) crc = int(packet[<span class="hljs-number"><span class="hljs-number">-8</span></span>:][::<span class="hljs-number"><span class="hljs-number">-1</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) fmt = int(packet[<span class="hljs-number"><span class="hljs-number">-16</span></span>:<span class="hljs-number"><span class="hljs-number">-8</span></span>][::<span class="hljs-number"><span class="hljs-number">-1</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) addr_lo = int(packet[<span class="hljs-number"><span class="hljs-number">-32</span></span>:<span class="hljs-number"><span class="hljs-number">-24</span></span>][::<span class="hljs-number"><span class="hljs-number">-1</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) addr_hi = int(packet[<span class="hljs-number"><span class="hljs-number">-24</span></span>:<span class="hljs-number"><span class="hljs-number">-16</span></span>][::<span class="hljs-number"><span class="hljs-number">-1</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) addr = (addr_hi &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) + addr_lo <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> fmt &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>: sextet_1 = packet[:<span class="hljs-number"><span class="hljs-number">6</span></span>] flip_bit = int(sextet_1[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) cmd = int(sextet_1[<span class="hljs-number"><span class="hljs-number">2</span></span>:][::<span class="hljs-number"><span class="hljs-number">-1</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) args_data = packet[<span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-number"><span class="hljs-number">-32</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: dectet_1 = packet[:<span class="hljs-number"><span class="hljs-number">10</span></span>] flip_bit = int(dectet_1[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) cmd = int(dectet_1[<span class="hljs-number"><span class="hljs-number">2</span></span>:][::<span class="hljs-number"><span class="hljs-number">-1</span></span>], <span class="hljs-number"><span class="hljs-number">2</span></span>) args_data = packet[<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">-32</span></span>] <span class="hljs-comment"><span class="hljs-comment">#~ print "fmt=", fmt, len(args_data) #~ print args_data if fmt == 0: if len(args_data) != 0: return elif fmt == 1: if len(args_data) != 8: return elif fmt == 3: if len(args_data) != 32: return elif fmt == 4: if len(args_data) != 0: return elif fmt == 7: if len(args_data) != 32: return else: return if args_data: args = [int(x[::-1], 2) for x in utils.batch_gen(args_data, 8, align_right=True)] else: args = [] return flip_bit, cmd, addr, fmt, crc, args</span></span></code> </pre><br></div></div><br><br><h5>  We retrieve data </h5><br><br><pre> <code class="hljs lisp">(-,  ) <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10101000</span></span> () <span class="hljs-number"><span class="hljs-number">00001000</span></span> <span class="hljs-number"><span class="hljs-number">10000100</span></span> <span class="hljs-number"><span class="hljs-number">01011100</span></span> <span class="hljs-number"><span class="hljs-number">11111111</span></span> ( , <span class="hljs-number"><span class="hljs-number">16</span></span> bit ) <span class="hljs-number"><span class="hljs-number">11111001</span></span> <span class="hljs-number"><span class="hljs-number">00101000</span></span> () <span class="hljs-number"><span class="hljs-number">11100000</span></span> () <span class="hljs-number"><span class="hljs-number">10010001</span></span></code> </pre><br><br>  As you can see above, 4 bytes are allocated for the data in the PT111 packet. <br>  Let's see how this data changes from sending to sending (4 bytes of data are allocated): <br><br><pre> <code class="hljs">10 10101000 { 00101000 10000100 01010100 11111111 } 11111001 00101000 11100000 10000000 10 10101000 { 00001000 10000100 01001100 11111111 } 11111001 00101000 11100000 11101101 11 10101000 { 11000100 10000100 10000010 11111111 } 11111001 00101000 11100000 01010110 10 10101000 { 01011000 10000100 10111100 11111111 } 11111001 00101000 11100000 11001010 11 10101000 { 00011000 10000100 01011100 11111111 } 11111001 00101000 11100000 10101011 11 10101000 { 01101000 10000100 11110100 11111111 } 11111001 00101000 11100000 00100000</code> </pre><br><br>  We see that the fourth byte of data in all parcels is 0xFF (0b11111111).  Apparently he is reserved. <br><br>  What is the third data byte?  It is likely that this is a whole 8-bit moisture value: the values ‚Äã‚Äãdecoded in this way are adequate.  Moreover, the value of this byte never exceeds 100 (0x64), which can be checked by setting the maximum humidity on the sensor (for example, breathing into the sensor for a couple of minutes). <br>  With a strong local heating of the air with a soldering iron, the value of the byte drops to 5-10, which seems to be true. <br><br>  The first byte is constantly changing with various manipulations with the sensor - apparently it is somehow responsible for the temperature. <br><br>  The second byte does not seem to change.  We will check if the status of a discharged battery is encoded here (judging by the description, the sensor broadcasts a warning about this by radio). <br><br>  Close the contacts of one battery with a thin wire to reduce the voltage: <br><br><pre> <code class="hljs">(  ) 10 10101000 11000000 { 10000100 } 00111100 11111111 11111001 00101000 11100000 10010101 (  ) 10 10101000 11100000 { 10000101 } 00100110 11111111 11111001 00101000 11100000 00111000</code> </pre><br><br>  We see that the low bit of this byte has changed.  It encodes the battery charge status. <br><br>  What could be the remaining bits of the second byte?  For example, there may be separately stored temperature sign, as in the sensors Oregon Scientific. <br><br>  Cool the sensor: <br><br><pre> <code class="hljs 1c"><span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">10101000</span></span> <span class="hljs-number"><span class="hljs-number">00110000</span></span> { <span class="hljs-number"><span class="hljs-number">10000100</span></span> } <span class="hljs-number"><span class="hljs-number">00001100</span></span> <span class="hljs-number"><span class="hljs-number">11111111</span></span> <span class="hljs-number"><span class="hljs-number">11111001</span></span> <span class="hljs-number"><span class="hljs-number">00101000</span></span> <span class="hljs-number"><span class="hljs-number">11100000</span></span> <span class="hljs-number"><span class="hljs-number">1110011</span></span> <span class="hljs-meta"><span class="hljs-meta"># 12, 33 (  ) 10 10101000 10011000 { 00000100 } 01101100 11111111 11111001 00101000 11100000 1100101 (25) 10 10101000 00111000 { 00000100 } 11011100 11111111 11111001 00101000 11100000 0110111 (28) 11 10101000 10111000 { 00000100 } 11110100 11111111 11111001 00101000 11100000 10100001 (   -18C,     1111) 11 10101000 01111010 { 11110100 } 11000010 11111111 11111001 00101000 11100000 1000100 (3934 = -16.2C) ( </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta"> ,  ) 10 10101000 00101010 { 11110100 } 11011100 11111111 11111001 00101000 11100000 00100110 (-17.2C) 10 10101000 10110001 { 11110100 } 01111100 11111111 11111001 00101000 11100000 10001011 (-11.5C) 10 10101000 01000011 { 11110100 } 11100010 11111111 11111001 00101000 11100000 01010011 (-6.2C) 10 10101000 11000111 { 11110100 } 00101010 11111111 11111001 00101000 11100000 01010100 (-2.9C) 11 10101000 00001111 { 11110100 } 11011010 11111111 11111001 00101000 11100000 00101010 (-1.6C) (  ? 1111 =&gt; 0000) 11 10101000 11100100 { 00000100 } 01111010 11111111 11111001 00101000 11100000 01011101 (3.9C) 10 10101000 11000010 { 00000100 } 10000110 11111111 11111001 00101000 11100000 00000100</span></span></code> </pre><br><br>  Additionally, we warm the sensor: <br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10101000</span></span> <span class="hljs-number"><span class="hljs-number">11000101</span></span> { <span class="hljs-number"><span class="hljs-number">01000100</span></span> } <span class="hljs-number"><span class="hljs-number">11000000</span></span> <span class="hljs-number"><span class="hljs-number">11111111</span></span> <span class="hljs-number"><span class="hljs-number">11111001</span></span> <span class="hljs-number"><span class="hljs-number">00101000</span></span> <span class="hljs-number"><span class="hljs-number">11100000</span></span> <span class="hljs-number"><span class="hljs-number">1100011</span></span> <span class="hljs-meta"><span class="hljs-meta"># 67.5 10 10101000 00100110 { 01000100 } 01000000 11111111 11111001 00101000 11100000 1011001 #</span></span></code> </pre><br><br>  We see that the first 4 bits of the second byte behave as follows: <br><br><ul><li>  When the temperature decreases, the value first changes from 0b0001 to 0b0000 (the order of bits is the reverse) </li><li>  After freezing to -18, the value becomes 0b1111 </li><li>  When heated at some point, the value changes from 0b1111 to 0b0000 </li><li>  When strongly heated above room temperature, the value changes from 0b0001 to 0b0002 </li></ul><br><br>  So the simplest explanation that comes to mind is that a piece of signed temperature value is stored in the first four bits. <br><br>  We glue these four bits with 8 bits from the first byte and get the 12-bit signed value.  Decoding results make it possible to understand that this is a 12-bit signed value of the temperature in tens of degrees Celsius. <br><br>  Decoding example: <br><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">1</span></span>) bytes <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span> = <span class="hljs-number"><span class="hljs-number">11100100</span></span> <span class="hljs-number"><span class="hljs-number">00000100</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">00100111</span></span> (bin) = <span class="hljs-number"><span class="hljs-number">39</span></span> (<span class="hljs-type"><span class="hljs-type">dec</span></span>) = <span class="hljs-number"><span class="hljs-number">3.9</span></span>C <span class="hljs-number"><span class="hljs-number">2</span></span>) bytes <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span> = <span class="hljs-number"><span class="hljs-number">00101010</span></span> <span class="hljs-number"><span class="hljs-number">11110100</span></span> <span class="hljs-number"><span class="hljs-number">1111</span></span> <span class="hljs-number"><span class="hljs-number">01010100</span></span> (bin) = <span class="hljs-number"><span class="hljs-number">3924</span></span> (<span class="hljs-type"><span class="hljs-type">dec</span></span>). <span class="hljs-number"><span class="hljs-number">3924</span></span> - <span class="hljs-number"><span class="hljs-number">0x1000</span></span> = <span class="hljs-number"><span class="hljs-number">-172</span></span> = <span class="hljs-number"><span class="hljs-number">-17.2</span></span>C</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Total decoding temperature code:</b> <div class="spoiler_text"><pre> <code class="python hljs">temp = ((args[<span class="hljs-number"><span class="hljs-number">1</span></span>] &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) + args[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> temp &gt; <span class="hljs-number"><span class="hljs-number">0x7ff</span></span>: temp = temp - <span class="hljs-number"><span class="hljs-number">0x1000</span></span> temp = temp * <span class="hljs-number"><span class="hljs-number">0.1</span></span></code> </pre><br></div></div><br><br><h5>  Total data format is PT111 </h5><br><pre> <code class="hljs ruby"> temp/<span class="hljs-symbol"><span class="hljs-symbol">hum:</span></span> flip, <span class="hljs-number"><span class="hljs-number">2</span></span> bit --&gt; <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">10101000</span></span> <span class="hljs-number"><span class="hljs-number">11100000</span></span> <span class="hljs-number"><span class="hljs-number">10000101</span></span> <span class="hljs-number"><span class="hljs-number">00100110</span></span> <span class="hljs-number"><span class="hljs-number">11111111</span></span> <span class="hljs-number"><span class="hljs-number">11111001</span></span> <span class="hljs-number"><span class="hljs-number">00101000</span></span> <span class="hljs-number"><span class="hljs-number">11100000</span></span> <span class="hljs-number"><span class="hljs-number">00111000</span></span> cmd <span class="hljs-number"><span class="hljs-number">8</span></span> bit ---^ <span class="hljs-params"><span class="hljs-params">| |</span></span> ^ ^ ^ ^ addr_lo addr_hi fmt crc temperature, signed, <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">1</span></span>C --&gt; <span class="hljs-params"><span class="hljs-params">|-- 12 bit -|</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| |</span></span> unknown, <span class="hljs-number"><span class="hljs-number">3</span></span>bit, 0b01<span class="hljs-number"><span class="hljs-number">0</span></span> -------&gt;---------------- <span class="hljs-params"><span class="hljs-params">| |</span></span> <span class="hljs-params"><span class="hljs-params">| bat low, 1bit -------------&gt;------------------ |</span></span> <span class="hljs-params"><span class="hljs-params">| humidity, 8 bit -------------&gt;----------------------- |</span></span> unknown, <span class="hljs-number"><span class="hljs-number">8</span></span> bit, always <span class="hljs-number"><span class="hljs-number">0xFF</span></span> so far --------&gt;------------------</code> </pre><br><br><h4>  WB Smart Home </h4><br><br>  In the native <a href="http://habrahabr.ru/company/contactless/blog/213243/">WB Smart Home</a> web interface, the sensors look something like this: <br><br><img src="//habrastorage.org/files/5ed/064/8e7/5ed0648e78f84438b2fa15c4b35c0a4e.png"><br><br>  The final code to work with Noolite <a href="https://github.com/contactless/rfm69-linux/blob/master/noolite.py">in our repository</a> . <br><br><h5>  Advertising </h5><br>  WB Smart Home controller is available for sale <a href="http://contactless.ru/store/">on our website</a> . <br><br><div class="spoiler">  <b class="spoiler_title">We are also looking for C / C ++ / Python programmers (Linux)</b> <div class="spoiler_text">  (better all from the list at once), develop software for our hardware for home and industrial automation. <br>  The work includes including the addition of support in WB Smart Home for new external wired and wireless devices, such as those described in this article. <br><br>  Geography: Moscow - Dolgoprudny, distant work and part-time employment are also considered. <br>  You can write to info+hr3@contactless.ru. <br><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/229469/">https://habr.com/ru/post/229469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229455/index.html">TinyBanker banking trojan source leaked to network</a></li>
<li><a href="../229459/index.html">Do-it-yourself visitor</a></li>
<li><a href="../229461/index.html">Check the validity of in-game purchases through the Google API</a></li>
<li><a href="../229465/index.html">Automatic code alignment</a></li>
<li><a href="../229467/index.html">Android last.fm scrobbler WAIL Beta is now open source</a></li>
<li><a href="../229471/index.html">We charge Lumia with the power of sound</a></li>
<li><a href="../229473/index.html">Innovative entropy production method</a></li>
<li><a href="../229475/index.html">Wargaming Public API</a></li>
<li><a href="../229477/index.html">Interview with Maxim Korobtsev about gamification for team management (audio)</a></li>
<li><a href="../229479/index.html">Analysis of tasks of the competition WAF Bypass on PHDays IV</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>