<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Secure login with PHPixie 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today the most awaited component of PHPixie 3 - Auth for authorization of users has been released. Authorization is the most critical part of any appl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Secure login with PHPixie 3</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/7cd/47c/66c/7cd47c66c5df9f4b83f7886240a1cba2.png" alt="image" align="right"><br>  Today the most awaited component of <a href="http://phpixie.com/">PHPixie</a> 3 - Auth for authorization of users has been released.  Authorization is the most critical part of any application, making it right is difficult, and mistakes can compromise many users, especially when it comes to the open-source.  The use of outdated hash functions, cryptographically unsafe random number generators, and incorrect work with cookies are found too often.  I once wrote about the <a href="http://habrahabr.ru/post/219475/">old vulnerability in Laravel</a> , which by the way was not completely fixed.  Therefore, in PHPixie Auth, I was very careful about authentication, especially for long sessions and cookies. <br><br>  By the way, at the end of the article I have very good news for you (spoiler: PHPixie is now a member of PHP-FIG) <br><a name="habracut"></a><br>  What makes PHPixie Auth safe: <br><ul><li>  using <i>password_hash ()</i> from PHP 5, and compatibility package for older versions </li><li>  similarly to cryptographically secure <i>random_bytes ()</i> from PHP 7 </li><li>  following the secure cookie management method from <a href="http://jaspan.com/improved_persistent_login_cookie_best_practice">jaspan.com/improved_persistent_login_cookie_best_practice</a> </li></ul><br><br>  The last point is the most interesting and among PHP frameworks it has no analogues out of the box.  The bottom line is a separate table for storing login tokens. <br><ol><li>  When you login, a pair of random strings is created: a series identifier and a password, which are given to the user in the form of a cookie </li><li>  A hash of a series with a password is created and recorded in the database along with the user ID and expiration date. </li><li>  When you re-access the site, the cookie hash is compared with the hash in the database, and if they match, the login occurs, the old token is deleted and the user creates a new one, but with the same series </li><li>  If the hash does not match, it means someone stole cookies or trying to pick.  In this case, all tokens with the same series are deleted. </li></ol><br>  This approach allows the user to be simultaneously logged on to multiple devices (one device - one series).  For example, Laravel simply saves the token in the user table, and as a result, the user can have only one token for all devices. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Configuration </h5><br>  Like other components of PHPixie, Auth can be used without the framework, but for simplicity, I will describe just this case. <br><br>  Firstly, you will need a repository of users, each bundle can provide its own repositories, from which we will select the necessary ones in the config file.  If you use ORM to work with users, then Auth comes with a ready wrapper: <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">ORMWrappers</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   class Repository extends \PHPixie\AuthORM\Repositories\Type\Login { //      //      protected function loginFields() { return array('username', 'email'); } }</span></span></code> </pre> <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">ORMWrappers</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   class Entity extends \PHPixie\AuthORM\Repositories\Type\Login\User { //      protected function passwordHash() { return $this-&gt;password; } }</span></span></code> </pre><br><br>  Do not forget to register them in ORMWrappers.php <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ORMWrappers</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPixie</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ORM</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Wrappers</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Implementation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $databaseEntities = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'user'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $databaseRepositories = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'user'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($entity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ORMWrappers\User\Entity($entity); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userRepisitory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($repository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ORMWrappers\User\Repository($repository); } }</code> </pre><br><br>  Now we will register this repository in the bundle: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthRepositories</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPixie</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Auth</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repositories</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Registry</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $builder; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($builder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;builder = $builder; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildUserRepository</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $orm = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;builder-&gt;components()-&gt;orm(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $orm-&gt;repository(<span class="hljs-string"><span class="hljs-string">'user'</span></span>); } }</code> </pre><br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPixie</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultBundle</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildAuthRepositories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AuthRepositories(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>); } }</code> </pre><br><br>  You also need to create a table for storing tokens (when using MongoDB, everything will work immediately) <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`tokens`</span></span> ( <span class="hljs-string"><span class="hljs-string">`series`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`userId`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`challenge`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`expires`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bigint</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`series`</span></span>) )</code> </pre><br><br>  Now the config file itself.  The most popular approach would look like this: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /assets/auth.php return array( 'domains' =&gt; array( 'default' =&gt; array( //  user   app 'repository' =&gt; 'app.user', 'providers' =&gt; array( //    'session' =&gt; array( 'type' =&gt; 'http.session' ), //   ( "remember me") 'cookie' =&gt; array( 'type' =&gt; 'http.cookie', //     session //     'persistProviders' =&gt; array('session'), //    'tokens' =&gt; array( 'storage' =&gt; array( 'type' =&gt; 'database', 'table' =&gt; 'tokens', 'defaultLifetime' =&gt; 3600*24*14 //   ) ) ), //    'password' =&gt; array( 'type' =&gt; 'login.password', //    . //       'cookies' //     "remember me"  //  ,       'persistProviders' =&gt; array('session') ) ) ) );</span></span></code> </pre><br><br>  All providers are independent of one another, which makes it easy to change functionality.  For example, if you want to use only cookies, without sessions, and at the same time disable the token update on each request, you can do this: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// /assets/auth.php return array( 'domains' =&gt; array( 'default' =&gt; array( 'cookie' =&gt; array( 'type' =&gt; 'http.cookie', //    'tokens' =&gt; array( 'storage' =&gt; array( 'type' =&gt; 'database', 'table' =&gt; 'tokens', 'defaultLifetime' =&gt; 3600*24*14, 'refresh' =&gt; false ) ) ), 'password' =&gt; array( 'type' =&gt; 'login.password', 'persistProviders' =&gt; array('cookie') ) ) ) );</span></span></code> </pre><br><br><h5>  Using </h5><br>  Let's create a simple processor to try how it all works together: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Project</span></span>\<span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">HTTPProcessors</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Auth</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPixie</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DefaultBundle</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processor</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HTTP</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Actions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $builder; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($builder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;builder = $builder; } <span class="hljs-comment"><span class="hljs-comment">//       public function defaultAction($request) { $user = $this-&gt;domain()-&gt;user(); return $user ? $user-&gt;username : 'not logged'; } //       public function addAction($request) { $query = $request-&gt;query(); $username = $query-&gt;get('username'); $password = $query-&gt;get('password'); $orm = $this-&gt;builder-&gt;components()-&gt;orm(); $provider = $this-&gt;domain()-&gt;provider('password'); $user = $orm-&gt;createEntity('user'); $user-&gt;username = $username; //     $user-&gt;passwordHash = $provider-&gt;hash($password); $user-&gt;save(); return 'added'; } //     public function loginAction($request) { $query = $request-&gt;query(); $username = $query-&gt;get('username'); $password = $query-&gt;get('password'); $provider = $this-&gt;domain()-&gt;provider('password'); $user = $provider-&gt;login($username, $password); if($user) { // generate persistent cookie $provider = $this-&gt;domain()-&gt;provider('cookie'); $provider-&gt;persist(); } return $user ? 'success' : 'wrong password'; } //  public function logoutAction($request) { $this-&gt;domain()-&gt;forgetUser(); return 'logged out'; } protected function domain() { $auth = $this-&gt;builder-&gt;components()-&gt;auth(); return $auth-&gt;domain(); } }</span></span></code> </pre><br><br>  Now we go to the urls and see the result: <br><br><ol><li>  / auth - user is not logged in </li><li>  / auth / add? username = jigpuzzled &amp; password = 5 - create user </li><li>  / auth / login? username = jigpuzzled &amp; password = 5 - log in </li><li>  / auth - check login </li><li>  / auth / logout - logout </li></ol><br><br>  You have already noticed that, like in the config file, the concept of a domain is also found in the processor.  Domain is a separate authentication instance with its own repository and providers.  In most cases, you will have only one domain.  Several domains will be needed when you have separate sections of the site with different logins, for example, the front-end allows users to log in via the Facebook login, but the backend is only through the login and password. <br><br><h5>  Its providers </h5><br>  Over time, you will probably need to add your login provider, for example, for authorization via social networks.  To do this, you will need to make your own provider builder (for example, by analogy with <a href="https://github.com/PHPixie/Auth-Login/blob/master/src/PHPixie/AuthLogin/Providers.php">Login</a> ) and register it <a href="https://github.com/PHPixie/Framework/blob/master/src/PHPixie/Framework/Extensions.php">as an extension</a> .  For a detailed description, I will write a separate article, but these two links should be enough to start. <br><br><h4>  PHPixie is now a member in PHP-FIG </h4><br>  Thanks <a href="http://habrahabr.ru/users/samdark/" class="user_link">SamDark</a> PHPixie will already be a member of PHP-FIG from tomorrow!  Full thread vote can be seen <a href="https://groups.google.com/forum/">here</a> .  And many thanks to all users of the framework, since it is the popularity and number of downloads that is one of the main selection criteria ^ __ ^ </div><p>Source: <a href="https://habr.com/ru/post/267177/">https://habr.com/ru/post/267177/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267163/index.html">Hacker, cryptographer or psychic. Ordinary magic</a></li>
<li><a href="../267165/index.html">ES6 in detail: proxy</a></li>
<li><a href="../267167/index.html">New attack on Microsoft Exchange mail server allows you to steal passwords</a></li>
<li><a href="../267173/index.html">Algorithm for schoolchildren: from beginner to Olympic medalist</a></li>
<li><a href="../267175/index.html">As we did ABC analysis for retail, or ‚Äúwithout half a liter you will not understand‚Äù</a></li>
<li><a href="../267179/index.html">Game for Railways: complete story</a></li>
<li><a href="../267181/index.html">Using CSS4 features today with cssnext</a></li>
<li><a href="../267183/index.html">Ethernet + PCIe + FPGA = LOVE</a></li>
<li><a href="../267185/index.html">The course "Basics of effective work with Wolfram technologies". Lesson 2.2: Defining Functions, Working with Lists, Template Expressions, and Associations</a></li>
<li><a href="../267187/index.html">How I became a programmer. The path from St. Petersburg homeless to Senior Developer for 6 years</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>