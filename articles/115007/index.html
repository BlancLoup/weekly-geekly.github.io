<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mercurial + Nginx configuration for managing a large number of repositories</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An example of the configuration of the bundle mercurial + nginx is described under the cat and the automation script for all of the above is given.  T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mercurial + Nginx configuration for managing a large number of repositories</h1><div class="post__text post__text-html js-mediator-article">  An example of the configuration of the bundle mercurial + nginx is described under the cat and the automation script for all of the above is given. <a name="habracut"></a><h4>  Tasks: </h4>  Creating a repository repository based on the Mercurial version control system with the ability to securely transfer data and separate access levels. <br>  Automate the above actions. <h4>  Decision: </h4>  Proxy built-in http server (hg serve) with proxy level access sharing. <br>  To avoid data interception, the transmission is carried out via the HTTPS protocol. <br>  To minimize the resources consumed, Nginx acts as a proxy. <br>  Access control is made at the location directive level. <br><h4>  Agreements: </h4>  Linux distribution in which everything will happen - Gentoo <br>  <b>https://hg.expample.com/reponame</b> - link to access the repository <br>  <b>hg.example.com</b> - domain name of the repository repository server <br>  <b>reponame</b> - the name of the required repository <br>  <b>/ home / repos</b> - root folder for repositories <br>  <b>/ etc / hg</b> - root folder for configuration files <br>  This reader has minimal Linux administration skills. <br><h4>  Install the necessary packages: </h4><blockquote><code><font color="red">hg</font> <font color="blue">~ #</font> <font color="black">emerge mercurial</font> &lt;br&gt; <font color="red">hg</font> <font color="blue">~ #</font> <font color="black">emerge nginx</font></code> </blockquote>  The built-in <b>http</b> server will be launched with the command <blockquote> <code><font color="red">hg</font> <font color="blue">~ #</font> <font color="black">/usr/bin/hg serve -d -A /var/log/hg_access.log -p 8080 -a 127.0.0.1 --pid-file /var/run/hgserver.pid --encoding utf8 --webdir-conf /etc/hg/web.config</font></code> </blockquote>  Launch directives: <br>  <b>-d</b> - start the server as a daemon <br>  <b>-A /var/log/hg_access.log</b> - server access log <br>  <b>-p 8080</b> - the port number on which the server is waiting for requests <br>  <b>-a 127.0.0.1</b> - ip address where the server is started <br>  <b>--pid-file /var/run/hgserver.pid</b> - file with server process ID <br>  <b>--encoding utf8</b> - encoding <br>  <b>--webdir-conf /etc/hg/web.config</b> - server configuration file <blockquote> <code><font color="red">hg</font> <font color="blue">~ #</font> <font color="black">cat /etc/hg/web.config</font> &lt;br&gt; <font color="black">[web]</font> <font color="grey">//   </font> &lt;br&gt; <font color="black">allow_push = *</font> <font color="grey">//  ‚Äú‚Äù  (     )</font> &lt;br&gt; <font color="black">push_ssl = false</font> <font color="grey">//  ssl (    )</font> &lt;br&gt; <font color="black">[paths]</font> <font color="grey">// ‚Äú‚Äù</font> &lt;br&gt; <font color="black">rep1=/home/repos/rep1</font> <font color="grey">// :  -    rep1</font> &lt;br&gt; <font color="black">rep2=/home/repos/rep2</font> <font color="grey">// :  -    rep2</font> &lt;br&gt;</code> </blockquote>  Writing the Include directive to the main <b>Nginx</b> configuration file <blockquote> <code><font color="red">hg</font> <font color="blue">~ #</font> <font color="black">cat /etc/nginx/nginx.conf |grep -i include</font> &lt;br&gt; <font color="black">include "/etc/hg/nginx.conf";</font></code> </blockquote>  Example configuration file <b>/etc/hg/nginx.conf</b> <blockquote> <code><font color="red">hg</font> <font color="blue">~ #</font> <font color="black">cat /etc/hg/nginx.conf</font> &lt;br&gt; <font color="black">server &lt;br&gt; {&lt;br&gt; listen 443;&lt;br&gt; server_name hg.example.com;&lt;br&gt; client_max_body_size 128M;&lt;br&gt; ssl on;&lt;br&gt; ssl_certificate /etc/ssl/nginx/nginx.pem;&lt;br&gt; ssl_certificate_key /etc/ssl/nginx/nginx.key;&lt;br&gt;location /repo1&lt;br&gt; {&lt;br&gt; proxy_pass http://127.0.0.1:8080;&lt;br&gt; auth_basic "Restricted";&lt;br&gt; auth_basic_user_file /etc/hg/nginx/repo1.pass;&lt;br&gt; access_log /var/log/nginx/repo1.hg.example.com.ssl_access_log main;&lt;br&gt; error_log /var/log/nginx/repo1.hg.example.com.ssl_error_log info;&lt;br&gt; }&lt;br&gt;location /repo2&lt;br&gt; {&lt;br&gt; proxy_pass http://127.0.0.1:8080;&lt;br&gt; auth_basic "Restricted";&lt;br&gt; auth_basic_user_file /etc/hg/nginx/repo2.pass;&lt;br&gt; access_log /var/log/nginx/repo2.hg.example.com.ssl_access_log main;&lt;br&gt; error_log /var/log/nginx/repo2.hg.example.com.ssl_error_log info;&lt;br&gt; }&lt;br&gt;}&lt;br&gt;</font></code> </blockquote>  Consider the section: <b>location / repo1</b> <br>  <b>proxy_pass</b> - specify where to send requests with successful authorization <br>  <b>auth_basic</b> - use HTTP Basic Authentication <br>  <b>auth_basic_user_file</b> - specify in which file the password database is located <br>  <b>access_log and error_log</b> - repository access logging directives <br>  Create authorization files for each of the repositories with the <b>htpasswd</b> command <br>  (The <b>htpasswd</b> program is included in the <b>apache</b> package, so you'll have to install it with the <b>emerge apache</b> command <br><blockquote> <code><font color="red">hg</font> <font color="blue">~ #</font> <font color="black">htpasswd -bc /etc/hg/nginx/repo2.pass test2 testpass2</font> &lt;br&gt; <font color="red">hg</font> <font color="blue">~ #</font> <font color="black">htpasswd -bc /etc/hg/nginx/repo1.pass test1 testpass1</font></code> </blockquote>  <b>-b</b> - use the password specified on the command line. <br>  <b>-c</b> - create a new password database file <br>  <b>/etc/hg/nginx/repo1.pass</b> - the name of the password database file <br>  <b>test1</b> - user login added <br>  <b>testpass1</b> - user password added <br>  It remains to initialize the repositories with the hg init command. <br><blockquote> <code><font color="red">hg</font> <font color="blue">~ #</font> <font color="black">hg init /home/repos/repo1</font> &lt;br&gt; <font color="red">hg</font> <font color="blue">~ #</font> <font color="black">hg init /home/repos/repo2</font></code> </blockquote>  We start <b>Nginx</b> team <blockquote> <code><font color="red">hg</font> <font color="blue">~ #</font> <font color="black">/etc/init.d/nginx start</font></code> </blockquote>  Now <b>repo1</b> and <b>repo2 repositories</b> <br>  available at <br>  <b>https://hg.example.com/repo1</b> and <b>https://hg.example.com/repo2</b> respectively. <br>  With configured separation of access levels. <br>  This was the end of the article, for a simple configuration that is updated every 3-5 months is enough.  But what to do when the configuration has to be changed often?  The correct system administrator will immediately begin to look for a way to make life easier for you. <br><h4>  At least three solutions to the problem: </h4>  1. Use the finished product management repositories. <br>  2. Delegate an honorary duty to his subordinate. <br>  3. Create a management system yourself. <br>  Unfortunately, neither the first nor the second option suited me <s>, so I had to overcome my laziness and do it myself.</s> <br>  The result was a script that fully automates the process of managing the repository server. <br><h4>  In which it was implemented: </h4>  1. Create (if necessary) and provide access to repositories. <br>  2. Prohibition of access to inactive repositories. (When removed from the configuration file, the repository is not physically deleted). <br>  3. Regeneration of user passwords for authorization of Nginx. <br>  4. Distribution of access to repositories at the user level. <br><h4>  The syntax of the configuration file allows: </h4>  1. use blank lines to visually separate sections <br>  2. use the ‚Äú#‚Äù symbol to highlight comments <br><h4>  The configuration file consists of three sections. </h4><blockquote> <code><b>[users]</b> -   : -.   ‚Äú=‚Äù&lt;br&gt;user1=pass1&lt;br&gt;user2=pass2&lt;br&gt;user3=pass3&lt;br&gt; <b>[repos]</b> -    &lt;br&gt;repo1&lt;br&gt;repo2&lt;br&gt;repo3&lt;br&gt; <b>[access]</b> -      ,    ‚Äú,‚Äù&lt;br&gt;repo1 = user1 , user2,user3 -     user1,user2,user3&lt;br&gt;repo2 = user1,user2 -      user1  user2&lt;br&gt;repo3 = user3 -       user3&lt;br&gt;</code> </blockquote>  Listing script <b>/usr/local/sbin/hgmkrep.sh</b> <blockquote><ol><li>  <font color="#666666">#! / bin / bash</font> </li><li>  <font color="#007800">tmphtpass</font> = <font color="#ff0000">"/ var / tmp / htpass"</font> <font color="#666666"># define a temporary password database file</font> </li><li>  <font color="#007800">repohome</font> = <font color="#ff0000">"/ home / repos /"</font> <font color="#666666"># define the root folder for repositories</font> </li><li>  <font color="#007800">hgservepid</font> = <font color="#ff0000">"/var/run/hgserver.pid"</font> <font color="#666666">#pid hg serve</font> </li><li>  <font color="#007800">hgaccesslog</font> = <font color="#ff0000">"/var/log/hg_access.log"</font> <font color="#666666">#access log file for hg server</font> </li><li>  <font color="#007800">domain</font> = <font color="#ff0000">"exapmple.com"</font> <font color="#666666">#tld server name</font> </li><li>  <font color="#007800">confdir</font> = <font color="#ff0000">"/ etc / hg /"</font> <font color="#666666"># define the root folder for configs</font> </li><li>  <font color="#007800">confile</font> = <font color="#800000">$ {confdir}</font> <font color="#ff0000">"repo.cfg"</font> <font color="#666666"># main config file /etc/hg/repo.cfg</font> </li><li>  <font color="#007800">webconfig</font> = <font color="#800000">$ {confdir}</font> <font color="#ff0000">"web.config"</font> <font color="#666666"># config for hg server /etc/hg/web.config</font> </li><li>  <font color="#007800">nginxconfig</font> = <font color="#800000">$ {confdir}</font> <font color="#ff0000">"nginx.conf"</font> <font color="#666666"># config for nginx /etc/hg/nginx.conf</font> </li><li>  <font color="#007800">nginxauthdir</font> = <font color="#800000">$ {confdir}</font> <font color="#ff0000">"nginx /"</font> <font color="#666666"># folder for password bases for access to repositories</font> </li><li>  <font color="#7a0874">[</font> <font color="#660033">-s</font> <font color="#800000">$ {confile}</font> <font color="#7a0874">]</font> <font color="#000000">||</font>  <font color="#7a0874">echo</font> <font color="#ff0000">"where is config file?"</font>  <font color="#666666"># check the presence of the main config</font> </li><li>  <font color="#7a0874">[</font> <font color="#660033">-s</font> <font color="#800000">$ {confile}</font> <font color="#7a0874">]</font> <font color="#000000">||</font>  <font color="#7a0874">exit</font> <font color="#000000">0</font> <font color="#666666"># grieve if there is no main config</font> </li><li>  <font color="#666666"># parsim section [repos] for repositories</font> </li><li>  <font color="#007800">repos</font> = <font color="#000000">`</font> <font color="#c20cb9">cat</font> <font color="#800000">$ {confile}</font> <font color="#000000">|</font>  <font color="#c20cb9">sed</font> <font color="#ff0000">'/ ^ $ / d'</font> <font color="#000000">|</font>  <font color="#c20cb9">sed</font> <font color="#ff0000">'/ ^ # / d'</font> <font color="#000000">|</font>  <font color="#c20cb9">sed</font> <font color="#ff0000">'s / \ // g'</font> <font color="#000000">|</font>  <font color="#c20cb9">awk</font> <font color="#ff0000">'/ \ [repos \] / {</font> </li><li>  <font color="#ff0000">is_repos = 1;</font> </li><li>  <font color="#ff0000">while (is_repos == 1)</font> </li><li>  <font color="#ff0000">{if (getline &lt;= 0 || index ($ 0, "[") == 1)</font> </li><li>  <font color="#ff0000">{is_repos = 0;}</font> </li><li>  <font color="#ff0000">else</font> </li><li>  <font color="#ff0000">{print $ 0;}}} '</font> <font color="#000000">`</font> </li><li>  <font color="#666666"># Check the availability of folders with repositories and, if necessary, create</font> </li><li>  <font color="#000000">for</font> i <font color="#000000">in</font> <font color="#800000">$ {repos}</font> </li><li>  <font color="#000000">do</font> ;  <font color="#7a0874">[</font> <font color="#660033">-d</font> <font color="#800000">$ {repohome}</font> <font color="#800000">$ {i}</font> <font color="#7a0874">]</font> <font color="#000000">||</font>  <font color="#000000">/</font> usr <font color="#000000">/</font> bin <font color="#000000">/</font> hg init <font color="#800000">$ {repohome}</font> <font color="#800000">$ {i}</font> ;  <font color="#000000">done</font> </li><li>  <font color="#666666"># generate config for hg server</font> </li><li>  <font color="#7a0874">echo</font> <font color="#ff0000">"[web]</font> </li><li>  <font color="#ff0000">allow_push = *</font> </li><li>  <font color="#ff0000">push_ssl = false</font> </li><li>  <font color="#ff0000">[paths] "</font> <font color="#000000">&gt;</font> <font color="#800000">$ {webconfig}</font> </li><li>  <font color="#666666"># allow access only to active repositories</font> </li><li>  <font color="#000000">for</font> i <font color="#000000">in</font> <font color="#800000">$ {repos}</font> </li><li>  <font color="#000000">do</font> ;  <font color="#7a0874">echo</font> <font color="#800000">$ {i}</font> = <font color="#800000">$ {repohome}</font> <font color="#800000">$ {i}</font> <font color="#000000">&gt;&gt;</font> <font color="#800000">$ {webconfig}</font> ;  <font color="#000000">done</font> </li><li>  <font color="#666666"># reboot hg serve</font> </li><li>  <font color="#7a0874">[</font> <font color="#660033">-a</font> <font color="#800000">$ {hgservepid}</font> <font color="#7a0874">]</font> <font color="#000000">&amp;&amp;</font> <font color="#000000">/</font> bin <font color="#000000">/</font> <font color="#c20cb9">kill</font> <font color="#000000">`/</font> bin <font color="#000000">/</font> <font color="#c20cb9">cat</font> <font color="#800000">$ {hgservepid}</font> <font color="#000000">`</font> <font color="#000000">&amp;&amp;</font> <font color="#c20cb9">rm</font> <font color="#800000">$ {hgservepid}</font> </li><li>  <font color="#000000">/</font> usr <font color="#000000">/</font> bin <font color="#000000">/</font> hg serve <font color="#660033">-d</font> <font color="#660033">-A</font> <font color="#800000">$ {hgaccesslog}</font> <font color="#660033">-p</font> <font color="#000000">8080</font> <font color="#660033">-a</font> 127.0.0.1 <font color="#660033">--pid-file</font> <font color="#800000">$ {hgservepid}</font> <font color="#660033">--encoding</font> utf8 <font color="#660033">--webdir-conf</font> <font color="#800000">$ {webconfig}</font> </li><li>  <font color="#666666"># create config for nginx</font> </li><li>  <font color="#7a0874">echo</font> <font color="#ff0000">"server</font> </li><li>  <font color="#ff0000">{</font> </li><li>  <font color="#ff0000">listen 443;</font> </li><li>  <font color="#ff0000">server_name hg. "</font> <font color="#800000">$ {domain}</font> <font color="#ff0000">";</font> </li><li>  <font color="#ff0000">client_max_body_size 128M;</font> </li><li>  <font color="#ff0000">ssl on;</font> </li><li>  <font color="#ff0000">ssl_certificate /etc/ssl/nginx/nginx.pem;</font> </li><li>  <font color="#ff0000">ssl_certificate_key /etc/ssl/nginx/nginx.key; "</font> <font color="#000000">&gt;</font> <font color="#800000">$ {nginxconfig}</font> </li><li>  <font color="#666666"># create lacation for active repositories</font> </li><li>  <font color="#000000">for</font> i <font color="#000000">in</font> <font color="#800000">$ {repos}</font> </li><li>  <font color="#000000">do</font> </li><li>  <font color="#7a0874">echo</font> <font color="#ff0000">"location /"</font> <font color="#800000">$ {i}</font> <font color="#ff0000">"</font> </li><li>  <font color="#ff0000">{</font> </li><li>  <font color="#ff0000">proxy_pass http://127.0.0.1:8080;</font> </li><li>  <font color="#ff0000">auth_basic <font color="#000099">\ "</font> Restricted <font color="#000099">\"</font> ;</font> </li><li>  <font color="#ff0000">auth_basic_user_file "</font> <font color="#800000">$ {nginxauthdir}</font> <font color="#800000">$ {i}</font> <font color="#ff0000">" .pass;</font> </li><li>  <font color="#ff0000">access_log / var / log / nginx / "</font> <font color="#800000">$ {i}</font> <font color="#ff0000">" .hg. "</font> <font color="#800000">$ {domain}</font> <font color="#ff0000">" .ssl_access_log main;</font> </li><li>  <font color="#ff0000">error_log / var / log / nginx / "</font> <font color="#800000">$ {i}</font> <font color="#ff0000">" .hg. "</font> <font color="#800000">$ {domain}</font> <font color="#ff0000">" .ssl_error_log info;</font> </li><li>  <font color="#ff0000">} "</font> <font color="#000000">&gt;&gt;</font> <font color="#800000">$ {nginxconfig}</font> </li><li>  <font color="#000000">done</font> </li><li>  <font color="#7a0874">echo</font> <font color="#ff0000">"}"</font> <font color="#000000">&gt;&gt;</font> <font color="#800000">$ {nginxconfig}</font> </li><li>  <font color="#666666"># create (reset, just in case) temporary password database</font> </li><li>  <font color="#c20cb9">cat</font> <font color="#000000">/</font> dev <font color="#000000">/</font> null <font color="#000000">&gt;</font> <font color="#800000">$ {tmphtpass}</font> </li><li>  <font color="#666666"># parsim section of the main config [users]</font> </li><li>  <font color="#666666"># generate passwords for all active users</font> </li><li>  <font color="#c20cb9">cat</font> <font color="#800000">$ {confile}</font> <font color="#000000">|</font>  <font color="#c20cb9">sed</font> <font color="#ff0000">'/ ^ $ / d'</font> <font color="#000000">|</font>  <font color="#c20cb9">sed</font> <font color="#ff0000">'/ ^ # / d'</font> <font color="#000000">|</font>  <font color="#c20cb9">sed</font> <font color="#ff0000">'s / \ // g'</font> <font color="#000000">|</font>  <font color="#c20cb9">awk</font> <font color="#660033">-v</font> <font color="#007800">passfile</font> = <font color="#007800">$ tmphtpass</font> <font color="#ff0000">' / \ [users \] / {</font> </li><li>  <font color="#ff0000">is_users = 1;</font> </li><li>  <font color="#ff0000">while (is_users == 1)</font> </li><li>  <font color="#ff0000">{if (getline &lt;= 0 || index ($ 0, "[") == 1)</font> </li><li>  <font color="#ff0000">{is_users = 0;}</font> </li><li>  <font color="#ff0000">else</font> </li><li>  <font color="#ff0000">{split ($ 0, userpass, "="); system ("htpasswd -b" passfile "" userpass [1] "" userpass [2]);}}} '</font> </li><li>  <font color="#666666"># parsim section [access] of the main config</font> </li><li>  <font color="#666666"># and get the list of privileges of the form repo = user1, user2</font> </li><li>  <font color="#007800">access</font> = <font color="#000000">`</font> <font color="#c20cb9">cat</font> <font color="#800000">$ {confile}</font> <font color="#000000">|</font>  <font color="#c20cb9">sed</font> <font color="#ff0000">'/ ^ $ / d'</font> <font color="#000000">|</font>  <font color="#c20cb9">sed</font> <font color="#ff0000">'/ ^ # / d'</font> <font color="#000000">|</font>  <font color="#c20cb9">sed</font> <font color="#ff0000">'s / \ // g'</font> <font color="#000000">|</font>  <font color="#c20cb9">awk</font> <font color="#ff0000">'/ \ [access \] / {</font> </li><li>  <font color="#ff0000">is_access = 1; while (is_access == 1)</font> </li><li>  <font color="#ff0000">{if (getline &lt;= 0 || index ($ 0, "[") == 1)</font> </li><li>  <font color="#ff0000">{is_access = 0;}</font> </li><li>  <font color="#ff0000">else</font> </li><li>  <font color="#ff0000">{print $ 0;}}} '</font> <font color="#000000">`</font> </li><li>  <font color="#666666"># check if there is a folder for storing password databases</font> </li><li>  <font color="#7a0874">[</font> <font color="#660033">-d</font> <font color="#800000">$ {nginxauthdir}</font> <font color="#7a0874">]</font> <font color="#000000">||</font>  <font color="#c20cb9">mkdir</font> <font color="#660033">-p</font> <font color="#800000">$ {nginxauthdir}</font> </li><li>  <font color="#666666"># delete old password database files</font> </li><li>  <font color="#c20cb9">find</font> <font color="#800000">$ {nginxauthdir}</font> <font color="#660033">-type</font> f <font color="#660033">-name</font> <font color="#000000">*</font> .pass <font color="#660033">-delete</font> </li><li>  <font color="#666666"># for each repository from the [access] section we generate a personal password database</font> </li><li>  <font color="#000000">for</font> i <font color="#000000">in</font> <font color="#800000">$ {access}</font> </li><li>  <font color="#000000">do</font> ;  <font color="#7a0874">echo</font> <font color="#800000">$ {i}</font> <font color="#000000">|</font>  <font color="#c20cb9">sed</font> <font color="#ff0000">'s /, / \ | / g'</font> <font color="#000000">|</font>  <font color="#c20cb9">awk</font> <font color="#660033">-v</font> <font color="#007800">tmphtpass</font> = <font color="#800000">$ {tmphtpass}</font> <font color="#660033">-v</font> <font color="#007800">nginxauthdir</font> = <font color="#800000">$ {nginxauthdir}</font> \ </li><li>  <font color="#ff0000">'BEGIN {FS = "="} {system ("cat" tmphtpass "| egrep \" "$ 2" \ "&gt;" nginxauthdir "" $ 1 ".pass")}'</font> <font color="#000000">done</font> </li><li>  <font color="#666666"># restart nginx</font> </li><li>  <font color="#000000">/</font> etc <font color="#000000">/</font> init.d <font color="#000000">/</font> nginx restart </li><li>  <font color="#666666"># delete temporary password database file</font> </li><li>  <font color="#c20cb9">rm</font> <font color="#800000">$ {tmphtpass}</font> </li></ol></blockquote>  I also post a link to the working script and the <a href="">config</a> example: <a href="">hgmkrep.tar.gz</a> <h4>  Existing disadvantages: </h4>  1. There is no distinction for reading and writing; each user allowed to <s>the</s> repository <s>body</s> has rw rights by default. <br>  2. Not implemented using groups to restrict access <br>  3. Configuration rollback is not implemented with incorrect syntax of the config (the system will collapse) <br>  4. With an increase in the number of users and repositories, the config abundantly loses its visibility <br></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/115007/">https://habr.com/ru/post/115007/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../115000/index.html">Dynamic pricing concept</a></li>
<li><a href="../115001/index.html">Acer Aspire One Happy or a netbook with android</a></li>
<li><a href="../115002/index.html">Control start tasks using Twitter</a></li>
<li><a href="../115004/index.html">Run Chaco and Mayavi on PySide</a></li>
<li><a href="../115006/index.html">A new official site symfony has opened</a></li>
<li><a href="../115008/index.html">Legal review of Creative Commons licenses made in Kyrgyzstan</a></li>
<li><a href="../115009/index.html">Kohana 3.0 - simplify your life</a></li>
<li><a href="../115011/index.html">The Wikimedia Foundation published a financial report for the second half of 2010</a></li>
<li><a href="../115012/index.html">Habra Literacy for all</a></li>
<li><a href="../115014/index.html">Tablet and keyboard: the battle for a place in the sun</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>