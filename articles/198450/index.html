<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Active Record vs. Data Mapper to save data</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="These 2 design patterns are described in the Martin Fowler book "Corporate Application Templates" and are ways to work with data storage in object-ori...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Active Record vs. Data Mapper to save data</h1><div class="post__text post__text-html js-mediator-article">  These 2 design patterns are described in the Martin Fowler book "Corporate Application Templates" and are ways to work with data storage in object-oriented programming. <br><br><h2>  Sample Active Record Template </h2><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $db; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $bar; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PDO $db)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db = $db; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_something</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;bar .= uniqid(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id) { $sql = <span class="hljs-string"><span class="hljs-string">"UPDATE foo SET bar = :bar WHERE id = :id"</span></span>; $statement = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;prepare($sql); $statement-&gt;bindParam(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;bar); $statement-&gt;bindParam(<span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id); $statement-&gt;execute(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $sql = <span class="hljs-string"><span class="hljs-string">"INSERT INTO foo (bar) VALUES (:bar)"</span></span>; $statement = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;prepare($sql); $statement-&gt;bindParam(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;bar); $statement-&gt;execute(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;lastInsertId(); } } } <span class="hljs-comment"><span class="hljs-comment">//Insert $foo = new Foo($db); $foo-&gt;bar = 'baz'; $foo-&gt;save();</span></span></code> </pre> <br>  In this simplified example, a database descriptor is entered in the constructor of Foo (Using dependency injection here allows you to test an object without using a real database), and Foo uses it to save its data.  Do_something is just a stub method that replaces business logic. <a name="habracut"></a><br><br><h3>  Benefits of Active Record </h3><br><ul><li>  Writing code with Active Record is quick and easy, in the case when the properties of the object correspond directly to the columns in the database. </li><li>  Saving happens in one place, which makes it easy to learn how it works. </li></ul><br><h3>  Disadvantages of Active Record </h3><br><ul><li>  Active Record models violate the principles of <abbr title="Single responsibility, Open-closed, Liskov substitution, Interface segregation and Dependency inversion">SOLID</abbr> .  In particular, the principle of common responsibility ( <abbr title="Single responsibility principle">SRP</abbr> - ‚ÄúS‚Äù in the principles of <abbr title="Single responsibility, Open-closed, Liskov substitution, Interface segregation and Dependency inversion">SOLID</abbr> ).  According to the principle, a domain object should have only one area of ‚Äã‚Äãresponsibility, that is, only its own business logic.  Calling him to save data, you add to it an additional area of ‚Äã‚Äãresponsibility, increasing the complexity of the object, which complicates its support and testing. </li><li>  Implementing data storage is closely related to business logic, which means that if you later want to use another abstraction to save data (for example, to store data in an XML file and not in a database), then you will have to refactor the code. </li></ul><br><h2>  Data Mapper Example </h2><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $bar; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_something</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;bar .= uniqid(); } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FooMapper</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $db; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PDO $db)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db = $db; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveFoo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Foo &amp;$foo)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($foo-&gt;id) { $sql = <span class="hljs-string"><span class="hljs-string">"UPDATE foo SET bar = :bar WHERE id = :id"</span></span>; $statement = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;prepare($sql); $statement-&gt;bindParam(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>, $foo-&gt;bar); $statement-&gt;bindParam(<span class="hljs-string"><span class="hljs-string">"id"</span></span>, $foo-&gt;id); $statement-&gt;execute(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $sql = <span class="hljs-string"><span class="hljs-string">"INSERT INTO foo (bar) VALUES (:bar)"</span></span>; $statement = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;prepare($sql); $statement-&gt;bindParam(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>, $foo-&gt;bar); $statement-&gt;execute(); $foo-&gt;id = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;db-&gt;lastInsertId(); } } } <span class="hljs-comment"><span class="hljs-comment">//Insert $foo = new Foo(); $foo-&gt;bar = 'baz'; $mapper = new FooMapper($db); $mapper-&gt;saveFoo($foo);</span></span></code> </pre><br>  In this case, the Foo class is much simpler and should only worry about its business logic.  Not only does he not have to save his own data, he does not even know and does not care about whether all his data has been saved. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Advantages of Data Mapper </h3><br><ul><li>  Each object has its own area of ‚Äã‚Äãresponsibility, thus following the principles of <abbr title="Single responsibility, Open-closed, Liskov substitution, Interface segregation and Dependency inversion">SOLID</abbr> and keeping each object simple and to the point. </li><li>  Business logic and data storage are loosely coupled, and if you want to save data to an XML file or some other format, you can simply write a new Mapper, without touching the domain object. </li></ul><br><h3>  Disadvantages Data Mapper </h3><br><ul><li>  You will have to think much more before writing the code. </li><li>  As a result, you have more objects to manage, which complicates the code and its debugging a little. </li></ul><br><h2>  Service Objects </h2><br>  When using the Data Mapper design pattern, the calling code must select the Mapper and the business object and link them together.  If this is the call code in the controller, then ultimately your model ‚Äúleaks‚Äù into the controller, which can cause major problems with support and unit testing.  This problem can be solved by introducing a service object.  The service is the gateway between the controller and the model and connects the domain object with the Mapper as needed. <br><br>  It should be remembered that M in MVC is a model abstraction layer, not a model object.  So there can be several types of objects in one model (in the example above, you can have a service object, a domain object, and a Mapper object acting as a single model).  On the other hand, if you use Active Record models, your model can be represented by only one object. <br><br><h2>  Use cases </h2><br>  Active Record objects have historically been very popular due to the fact that they are simpler, easier to understand and faster to write, so many frameworks and ORM use Active Record by default. <br><br>  If you are sure that you will never need to change the data retention layer (if you are dealing with an object that is an INI file, for example), or you are dealing with very simple objects that do not have much business logic, or just prefer to keep everything in a small number of classes, then the Active Record template is what you need. <br><br>  Using the Data Mapper, although it leads to cleaner code, easier to test and maintain, and provides more flexibility ‚Äî the price to it ‚Äî increases complexity.  If you have not tried it yet, then give it a chance - you should like it. <br><br>  <i>This is a translation of the article by <a href="http://russellscottwalker.blogspot.co.uk/2013/10/active-record-vs-data-mapper.html">Russell Volcker</a> .</i> </div><p>Source: <a href="https://habr.com/ru/post/198450/">https://habr.com/ru/post/198450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198436/index.html">Secret Buyers. Need a restructuring?</a></li>
<li><a href="../198438/index.html">How to configure COLT + IntelliJ IDEA integration</a></li>
<li><a href="../198444/index.html">Changing the keyboard layout of the Apple mb110, when using it under Windows</a></li>
<li><a href="../198446/index.html">How to choose a business idea for an IT startup</a></li>
<li><a href="../198448/index.html">HAPRoxy for Percona or Galera on CentOS. Its configuration and monitoring in Zabbix</a></li>
<li><a href="../198452/index.html">Problem solving web server settings when publishing web applications</a></li>
<li><a href="../198454/index.html">Gadgets Inspired by Doctor Who</a></li>
<li><a href="../198456/index.html">Multifunctional Robot for washing windows of skyscrapers</a></li>
<li><a href="../198458/index.html">Switch to Selenium 2 + PhantomJS</a></li>
<li><a href="../198464/index.html">Algorithm to find the smallest common ancestor in the tree</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>