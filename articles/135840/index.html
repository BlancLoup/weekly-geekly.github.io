<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PyS60: Tale of how to write a notepad for Symbian</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 Good day, habrayuzyra! 
 It so happens that most of the time I am away from my PC, so most of its functions are assigned to the device, whi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PyS60: Tale of how to write a notepad for Symbian</h1><div class="post__text post__text-html js-mediator-article"><h4>  Foreword </h4><br>  Good day, habrayuzyra! <br>  It so happens that most of the time I am away from my PC, so most of its functions are assigned to the device, which is always with me - on a Symbian 9.4-based smartphone.  Along with multimedia functions, it is very often necessary for me to make text notes, outline articles for a blog, and it happens that I have to work with (x) html and CSS.  And if Nokia 5530XM copes with multimedia functions with a bang, then working with text is complicated by the lack of convenient software for me - my picky temper does not recognize those software products that I had the opportunity to find on the Internet and test it on my device.  I needed the simplest notebook, while I met text editors, burdened with unnecessary functions for me.  And when I remembered that the rescue of the drowning was the work of the drowning themselves, then I realized that I would have to satisfy my own needs. <br><a name="habracut"></a><br><br><h4>  Lifebuoy </h4><br>  To be honest, I don‚Äôt have a direct relationship to programming, because my hobby is design for mobile sites, but at the same time programming is not alien to me - during my studies at the university I had a chance to get acquainted (quite successfully) with classics - with Pascal, with C / C ++ and with Delphi, therefore, having passed the stage of sad sighs of hopelessness, I began to choose a language for development. <br>  There was no particular choice: <br><ul><li>  Qt / C ++ </li><li>  mShell </li><li>  Python </li></ul><br>  In order to write comfortably in Qt / C ++, you need a lot of things to download and install, which was too lazy for me. <br>  mShell is a paskalep-like undisclosed language.  After installing the interpreter, it is necessary to carry out a free registration procedure via SMS, which I did not want. <br>  But Python interested me - I had never come across it before and it was interesting for me to get acquainted with something new in the field of programming. <br><br><h4>  Getting ready to work </h4><br>  So, the choice fell on Python.  Now, in order to start writing our first program, we need to make a smartphone friend with this very Python, for which I downloaded and installed Python 1.4.5, and in addition to it a set of modules megaPyModulePack 2.0.1 and PythonScriptShell. <br>  For writing programs, a text editor is required - gritting my teeth had to install the LightText software that I hated to my smartphone. <br>  Well, to move written scripts to the Python folder, I chose the good old X-plore file manager. <br>  All downloaded, all installed, everything works - Python meets us with its console: <br><img src="https://habrastorage.org/getpro/habr/post_images/63f/b23/682/63fb23682520ebc7d6269904b62a0902.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  What do we want? </h4><br>  What do we want from the program?  The smallest is the ability to create and save the text entered in UTF-8.  From here we draw conclusions about the type of program - a large input field, a menu of a couple of items (New document, Save, Info) and an exit button.  Everything. <br><br><h4>  Knowledge is power </h4><br>  And without this power, we would have nothing to do here.  I drew strength from four sources: <br>  - <a href="http://www.developer.nokia.com/Community/Wiki/Python_on_Symbian">Book Pankaj Nathani and Bogdan Galiceanu ‚ÄúPython on Symbian‚Äù</a> <br>  - Articles by Albert Gazetdinov on the website mobi.ru <br>  - <a href="">Python 2.6 tutorial on wikibuks</a> <br>  - Forum allnokia.ru <br><br><h4>  Right off the bat </h4><br>  I will not write about how I read background information and what emotions this process has caused in me - yet this is not a novel, so I will immediately turn to the process of creation. <br>  To begin with, we will help the program to make friends with the great and powerful Russian language: <br><br><pre><code class="python hljs">ru=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)</code> </pre> <br><br>  Now, in order for the program not to upset us with unknown characters, it will be enough to use the ru () function, an example of which you will see very soon. <br>  The next step is to connect the modules we need: <br><ul><li>  appuifw (from the application user interface framework) - with the help of this module we will create a simple interface of our program. </li><li>  os - work with files, folders and their paths. </li><li>  e32 - working with Symbian service functions </li></ul><br>  So, we connect: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> appuifw, os, e32</code> </pre> <br><br>  Now it would be quite logical to call our future program somehow.  Since it does not differ by mega-functional, we will give the corresponding name to it - P (rimitive) Pad. <br>  Let the program name it: <br><br><pre> <code class="python hljs">appuifw.app.title = <span class="hljs-string"><span class="hljs-string">u"PPad"</span></span></code> </pre> <br><br>  Since then, the program has found its name.  It is displayed at the top of the window instead of the words ‚ÄúPython‚Äù.  But we will not see it and now I will explain why: I have already said that in this notebook I want to see a large input field.  The appuifw module allows us to choose the program body size from three possible: <br><ul><li>  normal - the program body will take place between the bottom Functions / Exit buttons and the top of the screen, in which the Program name and signal and battery level indicators are displayed. </li><li>  large - only the program body and the Options / Exit buttons will be displayed on the screen. </li><li>  full - the program body will occupy the entire screen. </li></ul><br>  I thought that the most suitable option for us is the size of large: <br><br><pre> <code class="python hljs">appuifw.app.screen = <span class="hljs-string"><span class="hljs-string">"large"</span></span></code> </pre> <br><br>  When we have decided on the screen size, I propose to take another step towards creating a notepad - to define the body of the document as a Text object, so that we can enter / output / edit text: <br><br><pre> <code class="python hljs">appuifw.app.body = t = appuifw.Text()</code> </pre> <br><br>  Through the variable t we will be able to refer to this object for the entered text and some other requests, for example, with a request to change the text color.  By default, the text color is green, which does not satisfy me - with this color I am not very comfortable working with text, so I would prefer green to classic black: <br><br><pre> <code class="python hljs">t.color = <span class="hljs-number"><span class="hljs-number">0x000000</span></span></code> </pre> <br><br>  When you start the program, we will be greeted with an empty text field.  Let's make a little greeting there: <br><br><pre> <code class="python hljs">t.add(ru(<span class="hljs-string"><span class="hljs-string">"  PPad -          ."</span></span>))</code> </pre> <br><br>  In this example, you can see what the ru () function was created for in the very first line of the program and how it is used. <br><br>  Now, perhaps, it remains to bring to mind the program menu.  In the screenshot you can see two keys: ‚ÄúFunctions‚Äù (appuifw.app.menu) and ‚ÄúExit‚Äù (appuifw.app.exit_key_handler).  When you click on "Exit", the program will instantly close, which is not entirely correct, because with a random press, we can lose all entered data, which cannot be allowed.  So let's start fine-tuning with it - let's assign a function to it (let's call it quit), which would ask the user permission: <br><br><pre> <code class="python hljs">appuifw.app.exit_key_handler = quit</code> </pre> <br><br>  Well, let's write the function itself: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> appuifw.query(ru(<span class="hljs-string"><span class="hljs-string">" ?"</span></span>), <span class="hljs-string"><span class="hljs-string">"query"</span></span>) == <span class="hljs-number"><span class="hljs-number">1</span></span>: appuifw.app.set_exit()</code> </pre> <br><br>  appuifw.query (‚ÄúQuestion to user‚Äù, ‚Äútype‚Äù) is a window for entering data.  There are 7 types - text (for entering text), code (for entering a password), number (for entering a number), float (for entering a real number), date (for entering a date), time (for entering a time), and query ( to display a question with ‚ÄúOk‚Äù or ‚ÄúCancel‚Äù answer options).  In our case, we ask if the user wants to exit and if the user really wants, then he clicks ‚ÄúOk‚Äù, to which the function returns 1 and we strongly ask the program to leave us. <br><br>  After we solved the issue with the exit from the program, it‚Äôs time to ‚Äúbrush‚Äù the ‚ÄúFunctions‚Äù key, to which we will assign a menu.  Our menu will consist of three points - New / Clear, Save to UTF-8 and Info.  Each item is set as a tuple (‚ÄúItem name‚Äù, function performed).  Let's create our menu: <br><br><pre> <code class="python hljs">appuifw.app.menu = [(ru(<span class="hljs-string"><span class="hljs-string">"/"</span></span>), ClearDoc), (ru(<span class="hljs-string"><span class="hljs-string">"  UTF-8"</span></span>), SaveDoc), (ru(<span class="hljs-string"><span class="hljs-string">""</span></span>), AboutSoft)]</code> </pre> <br><br>  Now we have to write three functions - ClearDoc, SaveDoc and AboutSoft.  Let's go from simple to complex, which means we start with the AboutSoft function: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AboutSoft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> appuifw.note(ru(<span class="hljs-string"><span class="hljs-string">" :\nEvil_Penguin  \nJOIN_ME    "</span></span>), <span class="hljs-string"><span class="hljs-string">"info"</span></span>)</code> </pre> <br><br>  The appuifw.note function displays a window with text for a few seconds, which we wanted to see in this function. <br><br>  The function of creating a new document is too simple to ugliness - all that is required is to clear the screen.  This will help us the very variable t: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClearDoc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> appuifw.query(ru(<span class="hljs-string"><span class="hljs-string">"  ?"</span></span>), <span class="hljs-string"><span class="hljs-string">"query"</span></span>) == <span class="hljs-number"><span class="hljs-number">1</span></span>: t.clear() t.set_pos(<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><br>  We have already met with the appuifw.query function - with its help we again ask the user if he has the will to create a new document, and if there is one, we clear the field (t.clear ()) and set the cursor to the initial position ( t.set_pos (0)). <br><br>  The last function remains - the function of saving the document.  The function is not complicated, but we will season it with several conditions to make it more interesting. <br>  So, what is the function algorithm? <br>  1. We request the user name for the saved file <br>  2. Check if the file is in the memory of the smartphone <br>  3. If there is no such file, then we boldly write everything to the file. <br>  4. If the file exists, then we ask the user whether to replace the file or not.  If the user chooses to replace the file, then, accordingly, we write everything into the file, otherwise we notify that the file has not been saved. <br>  5. If at the request (p.1) the user did not enter a name, but clicked "Cancel", then we notify the user that the file was not saved. <br><br>  Here is how the function looks live: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveDoc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> filename = appuifw.query(ru(<span class="hljs-string"><span class="hljs-string">"  "</span></span>), <span class="hljs-string"><span class="hljs-string">"text"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> filename: fullpath = str(filename) + <span class="hljs-string"><span class="hljs-string">".txt"</span></span> fullpath = <span class="hljs-string"><span class="hljs-string">"c:\\"</span></span> + fullpath <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.exists(fullpath) == <span class="hljs-number"><span class="hljs-number">0</span></span>: filewrite = open(fullpath, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) content = t.get().replace(<span class="hljs-string"><span class="hljs-string">u"\u2029"</span></span>, <span class="hljs-string"><span class="hljs-string">u"\r\n"</span></span>) encontent = content.encode(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>) filewrite.writelines(encontent) filewrite.close() appuifw.note(ru(<span class="hljs-string"><span class="hljs-string">" "</span></span> + fullpath + <span class="hljs-string"><span class="hljs-string">" !"</span></span>), <span class="hljs-string"><span class="hljs-string">"conf"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> os.path.exists(fullpath) == <span class="hljs-number"><span class="hljs-number">1</span></span>: rewritefile = appuifw.query(ru(<span class="hljs-string"><span class="hljs-string">"  ! ?"</span></span>), <span class="hljs-string"><span class="hljs-string">"query"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> rewritefile == <span class="hljs-number"><span class="hljs-number">1</span></span>: filewrite = open(fullpath, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) content = t.get().replace(<span class="hljs-string"><span class="hljs-string">u"\u2029"</span></span>, <span class="hljs-string"><span class="hljs-string">u"\r\n"</span></span>) encontent = content.encode(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>) filewrite.writelines(encontent) filewrite.close() appuifw.note(ru(<span class="hljs-string"><span class="hljs-string">" "</span></span> + fullpath + <span class="hljs-string"><span class="hljs-string">" !"</span></span>), <span class="hljs-string"><span class="hljs-string">"conf"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: appuifw.note(ru(<span class="hljs-string"><span class="hljs-string">"  !"</span></span>), <span class="hljs-string"><span class="hljs-string">"error"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: appuifw.note(ru(<span class="hljs-string"><span class="hljs-string">"  !"</span></span>), <span class="hljs-string"><span class="hljs-string">"error"</span></span>)</code> </pre> <br><br>  When writing the function of saving text to a file, I had one problem - the contents were written in one line, and in those places where there should have been a line break, there was a small square.  I connected all my hopes in solving this problem with the replacement in the text \ n by \ r \ n before recording, but my hopes were not justified.  And I don‚Äôt know what I would do if a good person from the forum dimonvideo.ru with the name JOIN_ME didn‚Äôt send me a solution to the troubles, which was to replace u "\ u2029" with u "\ r \ n". <br><br>  Remained the final touch: <br><br><pre> <code class="python hljs">lock = e32.Ao_lock() os.abort = lock.signal lock.wait()</code> </pre><br><br>  This design will help us to ensure that the application does not close immediately after launch. <br>  Well, and perhaps all at the moment. <br><br><h4>  Summing up </h4><br>  What does our program look like in the long run? <br>  <a href="http://pastie.org/3148079">Like this</a> <br><br>  And what does our program look like on a smartphone? <br>  Like this: <br><img src="https://habrastorage.org/storage2/64d/99f/3b5/64d99f3b5f4a2b0f608d4345eb975803.gif" alt="image"><br><br><h4>  Goals </h4><br>  What I wanted: write a simple notebook directly from your smartphone. <br>  What are the goals of this article: to help the newcomers, like me, to get to know some moments in practice? <br><br><h4>  At last </h4><br>  What next?  It would seem that the mission is complete.  But no!  ‚ÄúAppetite comes with eating,‚Äù as we all know.  The feeling that you have created something you really need is indescribable.  Even if it is something insignificant.  Appetite is kindled, there are ideas - it means to be a continuation of this article, because the humble PPad.py will have to become PPad.sis <s>with whistles and perfections</s> with preference and harlots.  And I hope that my optimism from today's bright expectations tomorrow will turn into a fact. <br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/135840/">https://habr.com/ru/post/135840/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135832/index.html">Strings up to 23 characters in Ruby are processed 1.92 times faster</a></li>
<li><a href="../135833/index.html">Playing Tic-Tac-Toe with Python and GTK</a></li>
<li><a href="../135835/index.html">Audio mixer from two or more sound cards on realtime Linux and Reaper</a></li>
<li><a href="../135837/index.html">Micro ORM do-it-yourself (part one)</a></li>
<li><a href="../135838/index.html">Let's play snowballs?</a></li>
<li><a href="../135844/index.html">Who teaches whom: student teacher or student teacher?</a></li>
<li><a href="../135845/index.html">Budget option of virtual PBX with non-budget features</a></li>
<li><a href="../135846/index.html">Recipe cooking 1U server at home</a></li>
<li><a href="../135848/index.html">CRACKL @ B Contest 2010. Analysis of the first task</a></li>
<li><a href="../135849/index.html">Mindbloom Life Game - interactive tree of self-improvement</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>