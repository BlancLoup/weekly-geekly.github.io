<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another C ++ plugin framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 Who did not visit, using the open-source libraries, the thought: ‚ÄúThanks to these guys for this cool liba! Someday I will write somet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another C ++ plugin framework</h1><div class="post__text post__text-html js-mediator-article"><h2 id="vstuplenie">  Introduction </h2><br><p>  Who did not visit, using the open-source libraries, the thought: <em>‚ÄúThanks to these guys for this cool liba!</em>  <em>Someday I will write something worthwhile and put it in public so that others can use it! ‚Äù</em> </p><br><p>  Yes, everyone!  Or no ?.. </p><a name="habracut"></a><br><p> With the advent of the standard C ++ 17, our <code></code> solved much faster and more elegant, you just need to want to realize the conceived idea, and be able to apply in practice the sweets that we are spoiled by the guys from <strong>WG21</strong> . <br> <code>    ? : #,     )) ...</code> </p> <br><h2 id="predystoriya">  Prehistory </h2><br><p>  The theme of plug-ins is quite interesting because it allows you to add new functionality to the Software (software) without making changes to the program's core, but the interface for interaction should be thought out and written: <strong>Software</strong> &lt;-&gt; <strong>Plug-in</strong> <strong>Manager</strong> &lt;-&gt; <strong>Plug-ins</strong> . </p><br><p>  I have an experience (unsuccessful) of an interview with a company that has its own plugin system for embedded systems, because of the complexity of the architecture of which I filled up a test task.  There are a lot of macros inside the base classes from which it is inherited, and many other things that make the programmer‚Äôs everyday life gray when using such solutions ... </p><br><p>  At one of the moments of self-education, and reading articles on C ++ 17, it was decided to consolidate the knowledge gained when writing a plugin system that would be understandable and easy to use. </p><br><p>  How bad or good it turned out for me is to judge you, dear habrovchane ... </p><br><h2 id="obzor">  Overview </h2><br><h3 id="vozmozhnosti-biblioteki">  Library features </h3><br><ul><li>  Plugins as services (run in separate trades) </li><li>  Automatic unloading of unused plugins </li></ul><br><h3 id="plyusy">  pros </h3><br><ul><li>  Ease of use </li><li>  Asynchronous task execution </li><li>  Header-only design </li></ul><br><h3 id="minusy">  Minuses </h3><br><ul><li>  If a new plugin is added to the system, then it must be compiled with the same version of the compiler as its loading manager (as well as libstdc ++) for ABI compatibility </li><li>  Permanent caches from std :: any to the types used? </li><li>  Check futures for validity? </li></ul><br><h3 id="sozdanie-plagina">  Creating a plugin </h3><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">myplugin</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> micro::iplugin { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: myplugin(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ver, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&amp; nm):micro::iplugin(ver, nm) { <span class="hljs-comment"><span class="hljs-comment">//     subscribe&lt;2&gt;("sum2", [](std::any a, std::any b)-&gt; std::any { return std::any_cast&lt;int&gt;(a) + std::any_cast&lt;int&gt;(b); }, "  " ); } };</span></span></code> </pre> <br><h3 id="zagruzka-plagina">  Plugin loading </h3><br><pre> <code class="hljs cpp"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;micro::plugins&gt; manager = micro::plugins::get(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;micro::iplugin&gt; myplugin = manager-&gt;get_plugin(<span class="hljs-string"><span class="hljs-string">"myplugin"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myplugin &amp;&amp; myplugin-&gt;has&lt;<span class="hljs-number"><span class="hljs-number">2</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"sum2"</span></span>)) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::shared_future&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::any&gt; result = myplugin-&gt;run&lt;<span class="hljs-number"><span class="hljs-number">2</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"sum2"</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>); result.wait(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::any_cast&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(result.get()) &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; }</code> </pre> <br><p>  See more detailed examples <a href="http://github.com/dmxvlx/microplugins">on the project page.</a> </p><br><h2 id="vmesto-zaklyucheniya">  Instead of conclusion </h2><br><p>  I am very pleased to read informative articles on Habr√© in C ++ (and not only in C ++), <br>  I hope this article will be interesting to you and at least somewhat informative. </p><br><p>  In my humble opinion, you can use it in prode, let the more authoritative C ++ 's take a look and say their word, the sources are well documented and there are not many of them - about 1000 lines. </p><br><h2 id="ssylka-na-proekt">  Link to the project </h2><br><p>  <a href="http://github.com/dmxvlx/microplugins">microplugins</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/422401/">https://habr.com/ru/post/422401/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../422385/index.html">Virtual memory in ARMv7</a></li>
<li><a href="../422389/index.html">The forgotten art of bending: as in other cultures cherish the spine</a></li>
<li><a href="../422395/index.html">Well forgotten new: years later, the successor to MikroTik RB2011 comes out</a></li>
<li><a href="../422397/index.html">"The main thing - passed": what and how to teach the future IT people in Berlin</a></li>
<li><a href="../422399/index.html">Process code review in hh.ru</a></li>
<li><a href="../422403/index.html">September 20, Moscow - a meeting for analysts</a></li>
<li><a href="../422407/index.html">How to find similar texts and sort</a></li>
<li><a href="../422409/index.html">Python: metaprogramming in production. Part one</a></li>
<li><a href="../422411/index.html">New roles in companies in the era of servitization</a></li>
<li><a href="../422413/index.html">Application Arm Mbed OS. Fine tuning</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>