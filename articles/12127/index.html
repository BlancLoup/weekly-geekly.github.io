<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We program startup Web 2.0 for PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, you are inspired by the idea of ‚Äã‚Äãa Web 2.0 startup. You think that you have come up with something original and fresh. You see an effective imple...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We program startup Web 2.0 for PHP</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/olpictures/687/f64/21e/687f6421e704d64a2df09c3e8e83ef71.gif" width="151" height="162" alt="We program startup Web 2.0 for PHP" hspace="10" vspace="10" align="left"><br>  So, you are inspired by the idea of ‚Äã‚Äãa Web 2.0 startup.  You think that you have come up with something original and fresh.  You see an effective implementation of your idea.  You believe that your project will revolutionize the market.  If it is such thoughts that occupy you, it's time to do a business plan.  Business planning is a separate discipline and you can find a lot of literature about it.  However, if you do not have experience in drawing up business plans, it is better to resort to the help of professionals.  The worse the business is predicted, the higher the risks of its collapse. <br><br>  However, let us assume that you have an attractive business plan, you expect the project to be self-sustaining within 2 years from the moment it starts, and anticipate an annual 50% increase in its advertising potential.  In MS-Visio prepared promising schemes of the user interface of the project.  And even more, your designer, armed with <a href="http://pavlik.livejournal.com/36870.html">fashionable leadership</a> , in a record time, marked the graphic look of the project.  So, typical user interface pages, created in the best traditions of non-cash layout, wait for their high point in your local project folder. <br><a name="habracut"></a><br><h1>  Project outline </h1><br>  I can not know what the essence of your startup, what is its feature.  But in order to build on a practical example, let's consider a simplified version of the beloved collective blog habrahabr.ru.  Obviously, you hardly plan on repeating a famous project.  You can follow a proven path and develop a photo blog in the style of flicr.com, social network a-la facebook.com, social bookmarks in the manner of <a href="http://ma.gnolia.com/">ma.gnolia.com</a> or social news in the traditions of digg.com.  Perhaps you choose your own winding path to commercial success.  In any case, you will encounter approaches common for Web 2.0 projects, such as commenting, rating, tagging, pop-up contextual tooltips, etc.  As for the tape articles or, say, the user panel - these solutions are valid for virtually any project. <br><br><img src="https://habrastorage.org/getpro/habr/olpictures/6cb/7a0/310/6cb7a0310f3328c6a3d8bd36c57776c3.gif" width="450" height="493" alt="Scheme" hspace="10" vspace="10">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, in our example there are only a few informational pages (‚ÄúAbout the Site‚Äù, ‚ÄúHelp‚Äù), an article feed, a user panel (‚ÄúRegistration‚Äù, ‚ÄúAuthorization‚Äù), a tag cloud associated with an article feed, and a feed of recent comments. <br><br>  Suppose we would like the iterations with the forms (registration, authorization, adding a comment), if possible, not to overload the web page.  System messages appeared in a given design and supported the principle of ‚Äúdragged and left‚Äù (Drag &amp; Drop).  When executing processes, the system should report on what and how long it is busy. <br><br>  I think now the task is clear, it remains to think about its implementation. <br><br><h1>  Platform selection </h1><br>  Just take and start programming - the idea is not the best.  We need guarantees that at a certain stage we don‚Äôt have to start everything from the beginning, that increasing attendance will not be a problem, that ‚Äúendless beta‚Äù will not turn into ‚Äúendless alpha‚Äù and that user requests for new widgets or the need for ‚Äúopen API‚Äù will not you stumbling block.  It would be good to rely on someone else's experience, on a proven approach.  The solution here can be the use of one of the popular frameworks: <a href="http://framework.zend.com/">Zend Framework</a> , <a href="http://www.xisc.com/">Prado</a> , <a href="http://www.cakephp.org/">CakePHP</a> , <a href="http://www.symfony-project.com/">Symphony Project</a> , <a href="http://seagull.phpkitchen.com/">Seagull Framework</a> , <a href="http://www.phpwact.org/">WACT</a> , <a href="http://phpontrax.com/">PHP on TRAX</a> , <a href="http://zoopframework.com/">ZooP Framework</a> , <a href="http://ez.no/products/ez_components">eZ Components</a> or <a href="http://www.codeigniter.com/">CodeIgniter</a> . <br><br>  Each has its strengths.  For example, the performance of the Zend Framework is a completely logical advantage for a solution from PHP developers.  Prado - distinguishes a XAML-like model for declaring user interfaces.  Apparently, CakePHP is famous for its greatest flexibility and scalability.  However, all frameworks have common properties.  <a href="http://www.phpit.net/article/ten-different-php-frameworks/">All frameworks allow you to use different DBMS, without requiring a code change</a> .  All of them support PHP5 (but not all are capable of working on PHP4).  All of them contain data validation components.  And almost all are built on the model of MVC (Model-View-Controller).  If you already have experience with one of these frameworks, I will not prevent you from using your favorite platform.  However, if you are considering this list now, not knowing where to start, I rush to remind you that any universal solution (and all these frameworks are quite universal) cannot compare in performance with a well-executed partial solution designed to solve only one given task. .  Well, let's try to create our own software platform for solving problems of our startup.  So, we find a hosting plan with PHP 5.2 and MySQL 4/5.  Do not forget to make sure that this plan includes the PHP PDO ( <a href="http://www.php.net/manual/en/ref.pdo.php">PHP Data Objects</a> ) extension.  Using this library of abstract database access will allow you to easily switch to another DBMS if necessary. <br><br><h1>  Component model </h1><br>  Now is the time to decide on the component model (the principle of placing project scripts).  With a successful component model, you will always quickly find the required scripts, it will be easy to navigate the system during debugging, you will not have problems with the development of the project. <br><br>  So, in the root folder of the project will be located <b>index.</b>  <b>php</b> , which must accept all project requests, connect the required libraries and transfer control to the appropriate scripts.  The <b>app</b> folder will contain scripts that ensure the performance of various project web pages.  The scripts will be distributed in folders <b>controllers</b> , <b>models</b> , <b>views</b> .  This is the same MVC model.  For any web page, the system will find the corresponding model script and take in it all the data necessary for this interface.  Then the corresponding web page of the view script will be called up, which will process this data for output.  If data were sent to the web page in POST or GET, before the model and view scripts, the controller script will be called up, which will perform the required actions with the data that has become dull.  In addition to the MVC folders, I suggest also to get the <b>ajax_</b> <b>controllers</b> folder, where the controllers for asynchronous Java Script requests (AJAX) will be located. <br><br><img src="https://habrastorage.org/getpro/habr/olpictures/e0e/b2c/84a/e0eb2c84af7f7da56928345b8df62a36.gif" width="319" height="355" alt="Component model" hspace="10" vspace="10"><br><br>  Go back to the root folder and create a classic set of folders for the design of the project and JS scripts ( <b>css /</b> <b>images /</b> <b>js</b> ).  Create a <b>config</b> pack where the <b>config</b> file will be stored <b>.</b>  <b>inc.</b>  <b>php</b> .  In it, we define the interface and data for access to the database, the HTTP_PATH and ROOT_PATH project constants, constants with the names of the database tables and other configuration data.  The <b>libs</b> folder will contain software libraries.  Files uploaded by users will be sent to the usercontent folder.  Third-party libraries and solutions such as <a href="http://www.fckeditor.net/">FCKEditor</a> , <a href="http://lastrss.webdot.cz/">LastRSS</a> , <a href="http://www.jeroenwijering.com/">MediaPlayers</a> , <a href="http://developer.yahoo.com/yui/">YUI</a> will be placed in the vendors folder. <br><br>  How does this scheme work in practice?  Let's take an example.  The user has requested the web page <a href="http://xn--80aa1anvi2b/blog/">nashayt / blog</a> . <br><br>  The .htaccess file in the root folder forwarded the request to index.php <br><br>  <b>.htaccess</b> <br><img src="https://habrastorage.org/getpro/habr/olpictures/dea/4d1/c27/dea4d1c2769d67b02341c530c87e9ea9.gif" width="600" height="1" hspace="10" vspace="10"><br><pre>  DirectoryIndex index.php
 ErrorDocument 404/404 /
 Options + Followsymlinks<font></font>
<font></font>
 &lt;IfModule mod_rewrite.c&gt;
	 RewriteEngine on
	 RewriteCond% {REQUEST_FILENAME}! -F 
	 RewriteCond% {REQUEST_FILENAME}! -D
	 RewriteRule ^ (. *) $ Index.php?% {QUERY_STRING} [L]
 &lt;/ IfModule&gt; </pre><br><br>  Index.php reads the configuration from config.php, includes a small set of commonly used functions, such as the <a href="http://blog.redgraphic.ru/sheiko/27-02-07_336/">debugging function toLog ()</a> .  Then the pattern set ( <b>patterns.</b> <b>Inc.</b> <b>Php</b> ) is turned on and the environment is initialized ( <b>init.</b> <b>Inc.</b> <b>Php</b> ).  In the simplest case, during the initialization, the query string $ _SERVER ['REQUEST_URI'] is analyzed and the variables $ CTRLPATH, $ RECORD_ID, and $ APPPATH are assigned based on its content.  How?  In the case of a request, our <a href="http://xn--80aa1anvi2b/controller/%25D0%25B0%25D0%25B4%25D1%2580%25D0%25B5%25D1%2581">site / controller / address</a> - $ CTRLPATH takes the value "address".  In the case of a query, our <a href="http://xn--80aa1anvi2b/%25D0%25B0%25D0%25B4%25D1%2580%25D0%25B5%25D1%2581/000023/">site / address / 000023</a> (regular expression mask / \ d {7} /) - $ RECORD_ID takes the value 23. $ APPPATH - always takes the value ‚Äúaddress‚Äù. <br><br>  <b>index.php</b> <br><img src="https://habrastorage.org/getpro/habr/olpictures/dea/4d1/c27/dea4d1c2769d67b02341c530c87e9ea9.gif" width="600" height="1" hspace="10" vspace="10"><br><pre>  &lt;?
 if (preg_match ("/ \. (gif | jpg | bmp | js | css) \ /? $ / is", $ _SERVER ['REQUEST_URI'])) exit;
 include (ROOT_PATH. "config / config.inc.php");
 include (ROOT_PATH. "app / basics.inc.php");
 include (ROOT_PATH. "app / patterns.inc.php");
 include (ROOT_PATH. "app / init.inc.php");<font></font>
<font></font>
 $ db = Lib :: factory ('db');
 $ db-&gt; applyAuthorization ();<font></font>
<font></font>
 // Get the controller
 if ($ CTRLPATH) {
	 // If there is a cache image of the answer
	 if (file_exists (ROOT_PATH. "cache /". md5 ("ajax_controllers {$ CTRLPATH}"). ". tmp")) 
		 $ OUT = file_get_contents (ROOT_PATH. "Cache /". 
		 md5 ("ajax_controllers {$ CTRLPATH}"). ". tmp"); 
	 else { 
		 $ ctrl = Lib :: factory ('controller');
		 include (ROOT_PATH. "app / ajax_controllers {$ CTRLPATH} index.inc.php");
	 }
 } else {
	 // If there is a cache image of the page, show it 
	 if (file_exists (ROOT_PATH. "cache /". md5 ($ APPPATH). ". tmp")) 
	 $ OUT = file_get_contents (ROOT_PATH. "Cache /". Md5 ($ APPPATH). ". Tmp"); 
 else {
	 // Get the webpage
	 $ InterfaceScript = ($ RECORD_ID? "Record": "index"). ". Inc.php";
	 include (ROOT_PATH. "app / controllers / common.inc.php");
	 if (file_exists (ROOT_PATH. "app / controllers {$ APPPATH}". $ InterfaceScript)) 
		 include (ROOT_PATH. "app / controllers {$ APPPATH}". $ InterfaceScript);
	 include (ROOT_PATH. "app / models / common.inc.php");
	 if (file_exists (ROOT_PATH. "app / models {$ APPPATH}". $ InterfaceScript)) 
		 include (ROOT_PATH. "app / models {$ APPPATH}". $ InterfaceScript);
	 if (file_exists (ROOT_PATH. "app / views {$ APPPATH}". $ InterfaceScript)) 
		 include (ROOT_PATH. "app / views {$ APPPATH}". $ InterfaceScript);
	 else 
		 include (ROOT_PATH. "app / views / _404 / index.inc.php");
 }
 }<font></font>
<font></font>
 header ("Content-type: text / html; charset = UTF-8");
 print $ OUT;
 if (isset ($ _ GET ["createcache"]))
	 file_put_contents (ROOT_PATH. "cache /". md5 ($ APPPATH). ". tmp", $ OUT);
 ?&gt; </pre><br><br>  <b>app / patterns.inc.php</b> <br><img src="https://habrastorage.org/getpro/habr/olpictures/dea/4d1/c27/dea4d1c2769d67b02341c530c87e9ea9.gif" width="600" height="1" hspace="10" vspace="10"><br><pre>  &lt;?
 class lib {
	 // The parameterized factory method
	 public static function factory ($ type) {
		 if (include_once ROOT_PATH.'libs / '. $ type.' .lib.php ') {
			 $ classname = $ type;
			 return new $ classname;
		 } else {
			 throw new Exception ('Driver not found');
		 }
	 }
 }
 ?&gt; </pre><br><br>  Next, the system establishes a connection to the database and checks whether the user is authorized.  Since the webpage was requested, the list entry will not be sequentially polled. <br><br>  app / controllers / blog / index.inc.php <br>  app / models / blog / index.inc.php <br>  app / views / blog / index.inc.php <br><br>  POST and GET do not contain data and, accordingly, the controller script will be skipped.  In the app / models / blog / index.inc.php model script, the data for the list of articles will be accepted, and in the app / views / blog / index.inc.php script, this data will be displayed for output. <br><br>  <b>app / models / blog / index.inc.php</b> <br><img src="https://habrastorage.org/getpro/habr/olpictures/dea/4d1/c27/dea4d1c2769d67b02341c530c87e9ea9.gif" width="600" height="1" hspace="10" vspace="10"><br><pre>  &lt;?
 $ CONTENT ["WINDOW_TITLE"] = "Startup: Blogs";
 $ NAVIGATION ["limit"] = 5;
 $ get = Lib :: factory ('get');
	 $ DATA ["MEDIALIST"] = $ get-&gt; articleList ();
	 $ DATA ["PAGINATION"] = $ get-&gt; pagination ();
 ?&gt; </pre><br><br>  <b>app / views / blog / index.inc.php</b> <br><img src="https://habrastorage.org/getpro/habr/olpictures/dea/4d1/c27/dea4d1c2769d67b02341c530c87e9ea9.gif" width="600" height="1" hspace="10" vspace="10"><br><pre>  &lt;?
 $ CONTENT ["BODY"] = '';
	 foreach ($ DATA ["MEDIALIST"] as $ row) {
	 $ rec_url = HTTP_PATH. $ MEDIATYPES [$ row ["media_type"]] ["var"].
	  '/'.getIDUrl($rowrow""__"") ).'/';
	 $ CONTENT ["BODY"]. = '
	 &lt;div class = "media_line"&gt;
	 &lt;div class = "info"&gt; Added (a) '. $ row ["fullname"].', viewed '.
		 (int) $ row ["visited"]. '  times &lt;/ div&gt;
	 &lt;div class = "text"&gt; '. $ row ["description"].' &lt;/ div&gt;
	 &lt;div class = "footer"&gt; '. ($ row ["cache_commentnumber"]?' &lt;a href = "'.
		 $ rec_url. '"&gt;'. $ row [" cache_commentnumber "].
		 'comments &lt;/a&gt;': '&lt;a href = "'.
		 $ rec_url. '"&gt; Add a comment &lt;/a&gt;'). '
	 &lt;/ div&gt;
	 &lt;/ div&gt; ';
 }<font></font>
<font></font>
 include (INCLUDEPATH. "header.inc.php");
 $ OUT. = '
	 &lt;div class = ‚Äùleft_col‚Äù&gt;
	 '.  $ CONTENT ["BODY"]. $ CONTENT ["PAGINATION"]. '
	 &lt;/ div&gt;
	 &lt;div class = ‚Äùright_col‚Äù&gt;
	 &lt;div id = ‚ÄùUserPanel‚Äù&gt; &lt;/ div&gt;
	 &lt;div id = ‚ÄùTagCloud‚Äù&gt; &lt;/ div&gt;
	 &lt;div id = ‚ÄùLastestComments‚Äù&gt; &lt;/ div&gt;
	 &lt;script type = "text / javascript"&gt;
	 showBlock ("UserPanel");
	 showBlock ("TagCloud");
	 showBlock ("LastestComments");
	 &lt;/ script&gt;
	 &lt;/ div&gt;
 ';
 include (INCLUDEPATH. "footer.inc.php");
 ?&gt; </pre><br><br>  Perhaps you noticed a call to the get class to get a list of articles.  Thanks to the factory pattern, we can load into memory only those libraries that we use in actual tasks.  But I propose to go further and design the libraries so that for the most frequently requested web pages we are limited to minimal memory consumption.  Let's put all the data query methods that will be required in each interface in the get class.  Other methods can be divided into classes in accordance with the logic of our project.  They will be received by the factory only as needed.  For example, when you want to save the content of a user comment. <br><br>  As can be seen from the view script, in this case a page will be displayed containing a <b>list of articles</b> in the left column.  In the right column are expected custom panel, tag cloud, recent comments.  In the view script, while we can only see the containers of these panels.  However, calls to the showBlock function will accept and insert the contents of the panels into these containers. <br><br>  So we got a list of articles.  Now you need to consider the case of a user request a separate article from this list.  In this case, during the initialization of the environment, the variable $ RECORD_ID will be defined.  The system will poll the universal model for any of the entries in the blog list.  The model will be found at app / models / blog / record.inc.php.  $ RECORD_ID will serve as a parameter to query the article data. <br><br><pre>  $ get-&gt; article ($ RECORD_ID); </pre><br><br>  The system will look for the view script at app / views / blog / record.inc.php. <br><br>  By analogy with the web page of the list of articles, when the user requests an <b>information page</b> (for example, our <a href="http://xn--80aa1anvi2b/about/">site / about</a> ) in the model script, the page data will be received (app / models / about / index.inc.php), in the view script (app / views / about / index.inc.php) will be defined design. <br><br><h1>  We enrich the user interface </h1><br>  Under the terms of the task, the system should, if necessary, display messages in stylized floating windows, report on the status of processes.  The easiest way is to use the panel component from the user interface library from Yahoo ( <a href="http://developer.yahoo.com/yui/container/panel/">http://developer.yahoo.com/yui/container/panel/</a> ).  However, if you want to save users of your project from having to wait for the download of an additional JS script of about 100Kb in size, you can try to make your own library.  For system messages, you need the two functions showSystemMessage () and hideSystemMessage ().  The first will show the hidden layer of the message box (document.getElementById ("window_id"). Style.display = "block") and place the message passed to the function (document.getElementById ("window_content_is"). InnerHTML = message).  The second function will hide the message (document.getElementById ("window_id"). Style.display = "none").  It is also desirable to programmatically position the layer in the center of the browser window before showing the layer. <br><br>  Great, now we can show the system message window and hide it.  But how to enable Drag &amp; Drop for it?  It is enough just to specify event dispatchers for mouse operations on the window layer: <br><br>  &lt;div id = "window_id" onmousedown = "windowMouseDown ('window_id', event)" onmouseup = "windowMouseUp ('window_id')"&gt; ... &lt;/ div&gt; <br><br>  and add to the project JS-scripts handling of these events. <br><br>  <b>js / panels.js</b> <br><img src="https://habrastorage.org/getpro/habr/olpictures/dea/4d1/c27/dea4d1c2769d67b02341c530c87e9ea9.gif" width="600" height="1" hspace="10" vspace="10"><br><pre> // Quick access to the object
 function $ (divName) {return document.getElementById (divName);  }<font></font>
<font></font>
 // Determine the type of browser
 if (document.implementation &amp;&amp; document.implementation.createDocument) var isMozilla = true;
 else var isMozilla = false;<font></font>
<font></font>
 // Capture the object to move and its coordinates
 function windowMouseDown (divNamePref, ev) { 
	 if (isMozilla) {event = ev;  }
	 currentWindowDivNamePref = divNamePref; 
	 // Save offset
	 currentWindow [divNamePref] = {
	 "x": event.clientX + document.body.scrollLeft - 
		 $ (divNamePref) .style.left.replace ("px", ""),
	 "y": event.clientY + document.body.scrollTop - 
		 $ (divNamePref) .style.top.replace ("px", "")
	 };
 }
 // Move the object
 function windowMouseMove (ev) {
	 if (! currentWindowDivNamePref) return false;
	 if (! currentWindow [currentWindowDivNamePref]) return false;
	 if (isMozilla) {event = ev;  }
	 $ (currentWindowDivNamePref) .style.left = (event.clientX + 
		 document.body.scrollLeft - currentWindow [currentWindowDivNamePref] .x) + "px";
	 $ (currentWindowDivNamePref) .style.top = (event.clientY + 
		 document.body.scrollTop - currentWindow [currentWindowDivNamePref] .y) + "px";
	 return false;
 }<font></font>
<font></font>
 // Release Object
 function windowMouseUp (divNamePref) { 
	 currentWindow [divNamePref] = null; 
	 currentWindowDivNamePref = false; 
 } <font></font>
<font></font>
 if (isMozilla) {document.captureEvents (Event.MOUSEMOVE);  }
 document.onmousemove = windowMouseMove; </pre><br><br>  In the case of the process status window, below the window layer, a semitransparent layer is added, which is filled with gray and covers the content of the entire browser window.  Thus we get the effect of a temporary "freezing" of the user interface.  In the message window, you can add a dynamic image that visualizes the process.  As a rule, the Close button is located in the layer code of the system message window.  In the case of a process status window, this is not required. <br><br>  Now we will consider a practical task that will require the described functions of managing the system windows.  We need to implement a custom panel in the project.  This is a component that allows project visitors to either register or log in.  Those.  when the user has filled out the registration form, the system should send his data to the server, analyze them and either report a filling error (say, if the Captcha confirmation code was entered incorrectly), or register the user and, again, report the result.  We can now report something using the system message window.  As you must already remember, in order for the system to simply display the user panel, we will need a JS request to the server (the showBlock () function).  In order to verify the user input without overloading the web page, again, can not do without AJAX.  Thus, we need a set of JS functions for sending asynchronous requests to the controller on the server and receiving controller responses.  In this case, again, you can use your own solution, and you can rely on the experience of popular open source libraries.  Let's take a look at using the Connection Manager component from YUI ( <a href="http://developer.yahoo.com/yui/connection/">http://developer.yahoo.com/yui/connection/</a> ).  To use it, you will have to call two scripts yahoo-min.js and connection-min.js in the code of the project pages. <br><br>  Let's take a look at how the showBlock function works, displaying the supporting components of a web page. <br><br>  <b>js /</b> <b>common.</b>  <b>js</b> <br><img src="https://habrastorage.org/getpro/habr/olpictures/dea/4d1/c27/dea4d1c2769d67b02341c530c87e9ea9.gif" width="600" height="1" hspace="10" vspace="10"><br><pre>  // AJAX functions<font></font>
<font></font>
 // Quick access to the object
 function $ (divName) {return document.getElementById (divName);  }<font></font>
<font></font>
 // Send request to controller
 function showBlock (BlockID) {
	 YAHOO.util.Connect.asyncRequest ('POST', "http: // our site / controller /" + 
		 BlockID.toLowerCase () + "/", 
	 callback, "ctrl_action = getComponent");
 }<font></font>
<font></font>
 // Define the behavior of the system when receiving a response 
 var callback =
 {
	 success: CtrlRespond,
	 failure: commonHandleFailure,
	 argument: ['foo', 'bar']
 };<font></font>
<font></font>
 // Failed reply
 var commonHandleFailure = function (o) { 
	 if (o.responseText! == undefined) {
	 showSystemMessage ("Connection Error");
 }
 };<font></font>
<font></font>
 // Analysis of the controller response
 var CtrlRespond = function (obj) {
 if (obj.responseText == undefined) return false;
 if (obj.responseText.substr (0,1) == "{") {
	 var respondStructure = eval ('(' + obj.responseText + ')'); 
	 // The controller asks for an error
	 if (respondStructure.ErrorMsg) return showSystemMessage ("ERROR:" + 
		 respondStructure.ErrorMsg); 
	 // The controller asks to perform the corresponding code action
	 if (respondStructure.ActionCode == 1) {$ (respondStructure.ID) .innerHTML = 
	 respondStructure.Body;  return true; 
	 }
	 // The controller asks to show the message
	 if (respondStructure.Body) showSystemMessage (respondStructure.Body); 
	 } else alert (obj.responseText);  // debug in case of response 
	 // with structure incorrect for JSON
	 };
</pre><br><br>  <b>app / ajax_controllers / userpanel / index.inc.php</b> <br><img src="https://habrastorage.org/getpro/habr/olpictures/dea/4d1/c27/dea4d1c2769d67b02341c530c87e9ea9.gif" width="600" height="1" hspace="10" vspace="10"><br><br><pre>  &lt;?
 // Controller for user panel
 class RD extends controller {
	 private $ user;<font></font>
	<font></font>
	 function __construct () {
	 $ this-&gt; user = Lib :: factory ('user');
	 }<font></font>
<font></font>
	 function getComponent () {
		 $ this-&gt; ID = "UserPanel";
		 $ this-&gt; ActionCode = 1;
		 $ this-&gt; Body = "..Content panel ..";
	 }
 }<font></font>
<font></font>
 $ rd = new RD ();<font></font>
<font></font>
 if (isset ($ _ POST ["ctrl_action"])) {
	 call_user_method ($ _ POST ["ctrl_action"], $ rd);
 }
 $ rd-&gt; respond ();
 ?&gt; </pre><br><br>  <b>libs / controller.lib.php</b> <br><img src="https://habrastorage.org/getpro/habr/olpictures/dea/4d1/c27/dea4d1c2769d67b02341c530c87e9ea9.gif" width="600" height="1" hspace="10" vspace="10"><br><br><pre>  &lt;?
 // Initial controller class
 class controller {
 public $ ActionCode = 1;
 public $ ErrorMsg = "";
 public $ Body = "";
 public $ ID = "";<font></font>
<font></font>
<font></font>
 function respond ($ message = "", $ errormsg = "") {
	 if ($ message) $ this-&gt; Body = $ message;
	 if ($ errormsg) $ this-&gt; ErrorMsg = $ errormsg;
		 $ out = '{
		 "ActionCode": "'. $ This-&gt; ActionCode.'",
		 "ID": "'. $ This-&gt; ID.'",
		 "ErrorMsg": "'. ($ This-&gt; ErrorMsg? Addslashes (preg_replace (" / [\ r \ n] / ",
		 	 "", $ this-&gt; ErrorMsg)): ""). '",
		 "Body": "'. ($ This-&gt; Body? Addslashes (preg_replace (" / [\ r \ n] / ", 
			 "", $ this-&gt; Body)): ""). '"
		 } ';
	 header ("Content-type: text / html; charset = UTF-8");
	 print $ out; 
	 exit;
	 }
 } 
 ?&gt; </pre><br><br>  When the instruction in the showBlock HTML web page (‚ÄúUserPanel‚Äù) has completed, a request is sent to the app / ajax_controllers / userpanel / index.inc.php controller.  The request parameter is specified in the ctrl_action request parameter.  The controller returns a JSON structure with the variables ID, ActionCode, Body to the Java Script.  The JS CtrlRespond () function analyzes the resulting variables.  For ActionCode == 1, as in our case, it inserts the content obtained in BODY into the layer with the ID ID. <br><br>  As soon as we get a custom panel, we can write a function to send data to the controller when registering a project visitor. <br><br>  <b>js / common.js</b> <br><img src="https://habrastorage.org/getpro/habr/olpictures/dea/4d1/c27/dea4d1c2769d67b02341c530c87e9ea9.gif" width="600" height="1" hspace="10" vspace="10"><br><br><pre>  // Send data to the controller
 function registerUser (obj) {
	 if (obj.login.value == '' || obj.password.value == '' || 
	 obj.email.value == '' ||  obj.fullname.value == '' ||  obj.gencode.value == ''
	 ) showSystemMessage ('It is necessary to fill in all fields of the form');
	 else YAHOO.util.Connect.asyncRequest ('POST', "http: // our site / controller / userpanel /", 
		 callback, "ctrl_action = createUser &amp; login =" +
		 obj.login.value + "&amp; password =" + obj.password.value +
		 "&amp; email =" + obj.email.value + "&amp; fullname =" +
		 obj.fullname.value + "&amp; gencode =" + obj.gencode.value);
 }<font></font>
<font></font>
 ...<font></font>
<font></font>
 // Analysis of the controller response
 var CtrlRespond = function (obj) {
 ...
	 if (respondStructure.ActionCode == 2) return showSystemMessage (respondStructure.Body); 
 ...
 }; </pre><br><br>  <b>app / ajax_controllers / userpanel / index.inc.php</b> <br><img src="https://habrastorage.org/getpro/habr/olpictures/dea/4d1/c27/dea4d1c2769d67b02341c530c87e9ea9.gif" width="600" height="1" hspace="10" vspace="10"><br><br><pre>  &lt;?
 // Controller for user panel
 class RD extends controller {
 ...
	 function createUser () {
	 if (! $ _ POST) {$ this-&gt; ErrorMsg = "Required fields are not filled in";  return false;  }
	 if (! $ this-&gt; user-&gt; add ($ data)) {$ this-&gt; ErrorMsg = 
		 "Error adding user";  return false;  }
	 $ this-&gt; ActionCode = 2;
	 $ this-&gt; Body = "User created successfully";
	 }
 ...
 }
 ?&gt; </pre><br><br>  The user registration form contains the &lt;input type = "button" value = "Join" button onclick = "registerUser (this)" /&gt;.  When you click on it, the app / ajax_controllers / userpanel / index.inc.php controller is passed data from the form and the createUser () method is requested for processing.  During the execution of the method, the ErrorMsg error message, the request command code on the client side of the ActionCode, or the body message text can be sent to the controller's response structure.  In this case, if you successfully create a user, a corresponding message will appear, and in case of an error, a message about it will appear. <br><br>  Similarly, we can write functions for requests to check the presence of the entered login or email in the database.  They will request the methods of the controller class app / ajax_controllers / userpanel / index.inc.php checkLogin and checkEmail, respectively.  The methods themselves can check and report the result in the BODY variable.  By a similar principle, you can organize the display of the authorization form and the reaction to events in it.  However, this applies to any components of the project user interface that require AJAX. <br><br>  When displaying a tag cloud, you might need the following function. <br><br>  <b>Tag Cloud</b> <br><img src="https://habrastorage.org/getpro/habr/olpictures/dea/4d1/c27/dea4d1c2769d67b02341c530c87e9ea9.gif" width="600" height="1" hspace="10" vspace="10"><br><pre>  &lt;?
 function cmp_tag ($ a, $ b) {
	 if ($ a ["tag"] == $ b ["tag"]) return 0;
	 return strcmp ($ a ["tag"], $ b ["tag"]);
 }
 function getClouds () {
	 global $ db;
	 $ lines = array ();
	 $ sizes = array ("x-small", "small", "medium", "large", "x-large");
	 $ sql = "SELECT * FROM" .TAGCLOUDINDEXTABLE. "LIMIT 0.20";
	 $ sth = $ db-&gt; prepare ($ sql);
	 $ sth-&gt; execute ();
	 $ result = $ sth-&gt; fetchAll (PDO :: FETCH_ASSOC);
	 if (! $ result) return false;
	 $ indexes = array ();
	 $ tags = array ();
	 foreach ($ result as $ line) {
		 $ tags [trim ($ line ["tag"])] = $ line ["tag_index"];
		 $ indexes [] = $ line ["tag_index"];
	 } 
	 $ min = min ($ indexes);
	 $ max = max ($ indexes);
	 $ range = ($ max- $ min);
	 foreach ($ tags as $ tag =&gt; $ index) {
		 $ lines [$ tag] ["tag"] = $ tag;
		 $ lines [$ tag] ["tag_index"] = $ index;
		 $ lines [$ tag] ["size"] = $ sizes [sprintf ("% d", ($ index- $ min) / $ range * 4)];
		 $ lines [$ tag] ["title"] = "Tag". $ tag. "found". $ index. '  times';
	 }
	 usort ($ lines, "cmp_tag");
	 return $ lines;
 } <font></font>
<font></font>
 ?&gt; </pre><br><br>  To implement pop-up contextual prompts, you can use the same principle on which the system message windows were created, with the only difference that the prompts should be positioned directly at the position of the mouse cursor at the time of the click.  The functions of positioning, displaying and caching prompts can be found in my library Thesaurus ( <a href="http://www.phpclasses.org/browse/package/3505.html">http://www.phpclasses.org/browse/package/3505.html</a> ) <br><br><img src="https://habrastorage.org/getpro/habr/olpictures/86c/aca/b89/86cacab89235f602b0269d63107826e6.gif" width="444" height="288" alt="Sample tooltip" hspace="10" vspace="10"><br><br><h1>  Optimization </h1><br>  I am sure that you are counting on high attendance of the project under development.  It means that it will not be superfluous to reduce the load on the server as much as possible. <br><br>  Tell your server's scheduler (CRONTAB) ‚Äúonce every 30 minutes‚Äù to run the index.php script with the GET createcache parameter (/ usr / bin / php -f / fulladdress / index.php "&amp; createcache = on").  The system will create a cache image for the main page every half hour.  The highest frequency of hits usually falls on the main page.  In our case, the project will return the previously prepared HTML, skipping relatively resource-intensive operations, accessing the database, etc.  However, when the page loads in the user's browser, the Java Script will query the auxiliary components (the user panel and others).  Controller responses can also be cached.  It should be added to the controller analysis of GET variables: <br><br><pre>  if (isset ($ _ GET ["ctrl_action"])) {
	 call_user_method ($ _ GET ["ctrl_action"], $ rd);
 } </pre><br><br>  Add a condition to create a cache image of the response to the method of the source class: <br><br><pre>  print $ out; 
 if (isset ($ _ GET ["createcache"]))
	 file_put_contents (ROOT_PATH. "cache /". md5 ("ajax_controllers {$ CTRLPATH}"). ". tmp", $ OUT);
 exit; </pre><br><br>  Now, with a direct access to the controller, our <a href="http://xn--80aa1anvi2b/controller/tagcloud/">site / controller / tagcloud</a> ?  ctrl_action = getComponent &amp; createcache = on will create a cache for its response. <br>  It remains to assign the task scheduler to run the specified scripts with parameters (/ usr / bin / php -f / fulladdress / index.php "&amp; ctrl_action = getComponent &amp; createcache = on &amp; request_uri = / controller / tagcloud /") at specified intervals (say, update the tag cloud every 2 hours).  Just do not forget to make sure that the GET request_uri parameter in the environment initialization script app / init.inc.php is checked.  If there is one, the system should use it instead of $ _SERVER ['REQUEST_URI']. <br><br><h1>  Conclusion </h1><br>  At this crazy time, <a href="http://www.kommersant.ru/doc.aspx%3FDocsID%3D780978">when Web 2.0 projects are valued at millions of dollars, even in Russia</a> , the desire to try yourself in this market is understandable.  The launch of the project to the market, its capitalization are business issues, not programming.  However, to do this business, you need a product.  This article is not a Web 2.0 project programming guide.  The article contains material that can guide you if you are looking for a suitable way to develop a project.  I also wanted to show here that, having gotten one can ‚Äúrevive‚Äù a typical Web 2.0 startup in a relatively short time.  If you have an interesting original idea, then let the difficulties of its implementation do not stop you.  Dare and, who knows, maybe your idea will really be in demand, maybe it will bring you more than you dare to hope.  There are enough stories on the Internet for the startling success of Web 2.0 startups made by people who dare.  Perhaps in time there will appear your success story.  Successes! .. <br><br>  <a href="http://cmsdevelopment.com/dcontent/how_create_web20_startup_with_php.pdf">Original article in PDF</a> </div><p>Source: <a href="https://habr.com/ru/post/12127/">https://habr.com/ru/post/12127/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121262/index.html">Traffic Signs Alert in Navigator</a></li>
<li><a href="../121264/index.html">Security and problems with it in MODx Revolution</a></li>
<li><a href="../121265/index.html">Versioned migration of database structure: main approaches</a></li>
<li><a href="../121266/index.html">Do you have all the moves recorded? Pro GPS Logger</a></li>
<li><a href="../121268/index.html">EP is an easy and fast way to access public services</a></li>
<li><a href="../121270/index.html">Hacker group Lulz Security reached the sites of Bethesda Softworks and the US Senate</a></li>
<li><a href="../121272/index.html">Game section on the 27th Point in Moscow in conjunction with Alawar Entertainment</a></li>
<li><a href="../121273/index.html">Let me go out!</a></li>
<li><a href="../121274/index.html">Solar Impulse aircraft will fly from Brussels to Paris</a></li>
<li><a href="../121275/index.html">Tips for reading</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>