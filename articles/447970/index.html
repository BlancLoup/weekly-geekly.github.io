<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Javascript logging is super simple - two decorators and ready</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Are you not bothered to write logger.info('ServiceName.methodName.') And logger.info('ServiceName.methodName -> done.') For each? Maybe you, like me, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Javascript logging is super simple - two decorators and ready</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/ew/1v/cd/ew1vcdon5l1qxt8dhjrickcyzlo.jpeg"></p><br><p> Are you not bothered to write <code>logger.info('ServiceName.methodName.')</code> And <code>logger.info('ServiceName.methodName -&gt; done.')</code> For each?  Maybe you, like me, have repeatedly thought about automating this business?  In this article, the story will focus on <a href="https://github.com/keenondrums/class-logger">class-logger</a> , as one of the solutions to the problem with just two decorators. </p><a name="habracut"></a><br><h2 id="zachem-ono-voobsche-nado">  Why is it even necessary? </h2><br><p>  Not all perfectionists are engineers, but all engineers are perfectionists (well, almost).  We like beautiful laconic abstractions.  We see beauty in a set of cracks that a person unprepared and cannot read.  We like to feel like gods, creating micro-universes that live by our rules.  Presumably, all these qualities originate from our immense laziness.  No, the engineer is not afraid of work as a class, but he hates the routine repetitive actions that the hands are trying to automate. </p><br><p>  Having written several thousand lines of code intended only for logging, we usually arrive at the creation of some of our own patterns and standards for writing messages.  Unfortunately, we still have to apply these patterns manually.  The most important "why" <a href="https://github.com/keenondrums/class-logger">class-logger</a> is to provide a declarative, configurable way to easily log template messages when creating a class and calling its methods. </p><br><h2 id="shashki-nagolo">  Checkers bald! </h2><br><p>  Without wandering around the bush, let's go straight to the code. </p><br><pre> <code class="plaintext hljs">import { LogClass, Log } from 'class-logger' @LogClass() class ServiceCats { @Log() eat(food: string) { return 'purr' } }</code> </pre> <br><p>  This service will create three entries in the log: </p><br><ul><li>  Before creating it with a list of arguments passed to the constructor. </li><li>  Before calling <code>eat</code> with a list of arguments. </li><li>  After a call, <code>eat</code> with the list of arguments and the result of the execution. </li></ul><br><p>  In words of code: </p><br><pre> <code class="plaintext hljs">//    ServiceCats // `ServiceCats.construct. Args: [].` const serviceCats = new ServiceCats() //    `eat` // `ServiceCats.eat. Args: [milk].` serviceCats.eat('milk') //    `eat` // `ServiceCats.eat -&gt; done. Args: [milk]. Res: purr.`</code> </pre> <br><p>  <a href="https://stackblitz.com/edit/class-logger-demo-cats-quick-start">Poke "live"</a> . </p><br><p>  A complete list of events that can be logged: </p><br><ul><li>  Before creating a class. </li><li>  Before calling synchronous and asynchronous methods and functional properties, both static and non-static. </li><li>  After calling synchronous and asynchronous methods and functional properties, both static and non-static. </li><li>  Errors calling synchronous and asynchronous methods and functional properties, both static and non-static. </li></ul><br><blockquote>  A functional property is a switch function assigned to a property ( <code>class ServiceCats { private meow = () =&gt; null }</code> ).  Most often used to save the execution context ( <code>this</code> ). </blockquote><br><h2 id="nam-obeschali-konfiguriruemyy-sposob-loggirovaniya">  We were promised a "configurable" logging method </h2><br><p>  <a href="https://github.com/keenondrums/class-logger">class-logger</a> three levels of configuration hierarchy: </p><br><ul><li>  Global </li><li>  Class </li><li>  Method </li></ul><br><p>  When calling each method, all three levels merge together.  The library provides a sensible global config by default, so it can be used without any prior configuration. </p><br><h3 id="globalnyy-konfig">  Global config </h3><br><p>  It is created for the entire application.  You can override it with <code>setConfig</code> . </p><br><pre> <code class="plaintext hljs">import { setConfig } from 'class-logger' setConfig({ log: console.info, })</code> </pre> <br><h3 id="konfig-klassa">  Class config </h3><br><p>  It is its own for each class and is used for all methods of this class.  Can redefine global config. </p><br><pre> <code class="plaintext hljs">import { LogClass } from 'class-logger' setConfig({ log: console.info, }) @LogClass({ //       log: console.debug, }) class ServiceCats {}</code> </pre> <br><h3 id="konfig-metoda">  Method config </h3><br><p>  It works only for the method itself.  It takes precedence over the class config and the global config. </p><br><pre> <code class="plaintext hljs">import { LogClass } from 'class-logger' setConfig({ log: console.info, }) @LogClass({ //       log: console.debug, }) class ServiceCats { private energy = 100 @Log({ //        log: console.warn, }) eat(food: string) { return 'purr' } //    `console.debug`    sleep() { this.energy += 100 } }</code> </pre> <br><p>  <a href="https://stackblitz.com/edit/class-logger-demo-hierarchical-config">Poke "live"</a> </p><br><h3 id="chto-mozhno-konfigurirovat">  What can be configured? </h3><br><p>  We considered how to change the config, but still have not figured out exactly what can be changed in it. </p><br><blockquote>  <a href="https://github.com/keenondrums/class-logger">Here you can find many examples of configuration objects for different cases</a> . <br><br>  <a href="https://github.com/keenondrums/class-logger">An interface reference if you understand TypeScript better.</a>  <a href="https://github.com/keenondrums/class-logger">than russian :)</a> </blockquote><p>  The configuration object has the following properties: </p><br><h4 id="log">  log </h4><br><p>  This is a function that deals, in fact, with logging.  She comes to the input formatted messages as strings.  Used to log the following events: </p><br><ul><li>  Before creating a class. </li><li>  Before calling synchronous and asynchronous methods and functional properties, both static and non-static. </li><li>  After calling synchronous and asynchronous methods and functional properties, both static and non-static. </li></ul><br><p>  The default is <code>console.log</code> . </p><br><h4 id="logerror">  logError </h4><br><p>  This is a function that also deals with logging, but only error messages.  She also comes to the input formatted messages as strings.  Used to log the following events: </p><br><ul><li>  Errors calling synchronous and asynchronous methods and functional properties, both static and non-static. </li></ul><br><p>  The default is <code>console.error</code> . </p><br><h4 id="formatter">  formatter </h4><br><p>  This is an object with two methods: <code>start</code> and <code>end</code> .  These methods create that very formatted message. </p><br><p>  <code>start</code> creates messages for the following events: </p><br><ul><li>  Before creating a class. </li><li>  Before calling synchronous and asynchronous methods and functional properties, both static and non-static. </li></ul><br><p>  <code>end</code> creates messages for the following events: </p><br><ul><li>  After calling synchronous and asynchronous methods and functional properties, both static and non-static. </li><li>  Errors calling synchronous and asynchronous methods and functional properties, both static and non-static. </li></ul><br><p>  The default is <code>new ClassLoggerFormatterService()</code> . </p><br><h4 id="include">  include </h4><br><p>  Config of what should be included in the final message. </p><br><h5 id="args">  args </h5><br><p>  This can be either a boolean value or an object. </p><br><p>  If it is <code>boolean</code> , then it sets whether to include a list of arguments (remember <code>Args: [milk]</code> ?) In all messages ( <code>start</code> and <code>end</code> ). </p><br><p>  If it is an object, then it should have two boolean properties: <code>start</code> and <code>end</code> .  <code>start</code> specifies whether to include the argument list for <code>start</code> messages, <code>end</code> for <code>end</code> messages. </p><br><p>  The default is <code>true</code> . </p><br><h5 id="construct">  construct </h5><br><p>  This is a <code>boolean</code> that controls whether to create a class or not. </p><br><p>  The default is <code>true</code> . </p><br><h5 id="result">  result </h5><br><p>  This is a <code>boolean</code> that controls the logged value returned from the method.  It is worth noting that the return value is not only what the method returns when it is successfully executed, but also an error that it throws in case of unsuccessful execution.  Remember <code>Res: purr</code> ?  If this flag is <code>false</code> , then there will be no <code>Res: purr</code> . </p><br><p>  The default is <code>true</code> . </p><br><h5 id="classinstance">  classInstance </h5><br><p>  This can be either a boolean value or an object.  The concept is the same as <code>include.args</code> . </p><br><p>  Adds a serialized view of your class instance to messages.  In other words, if your class has any properties, they will be serialized in JSON and added to the logs. </p><br><p>  Not all properties are serializable.  <a href="https://github.com/keenondrums/class-logger">The class-logger</a> uses the following logic: </p><br><ul><li>  We take all the intrinsic properties (those that are not in the prototype). <br><ul><li>  Why?  Very rarely does a prototype change dynamically, so there is little point in logging its contents. </li></ul></li><li>  We throw out from them all type <code>function</code> . <br><ul><li>  Why?  Most often, properties of the <code>function</code> type are simply pointer functions that are not done by conventional methods for the sake of preserving the context ( <code>this</code> ).  They rarely have a dynamic nature, so there is no sense in logging them. </li></ul></li><li>  We throw out from them all objects that are not simple objects. <br><ul><li>  What are simple objects?  <code>ClassLoggerFormatterService</code> considers an object simple if its prototype is an <code>Object.prototype</code> . </li><li>  Why?  Often, the instances of other service classes act as properties.  Our logs would swell in the most ugly way if we began to serialize from steel. </li></ul></li><li>  Serialize in JSON string all that is left. </li></ul><br><pre> <code class="plaintext hljs">class ServiceA {} @LogClass({ include: { classInstance: true, }, }) class Test { private serviceA = new ServiceA() private prop1 = 42 private prop2 = { test: 42 } private method1 = () =&gt; null @Log() public method2() { return 42 } } //    `Test` // 'Test.construct. Args: []. Class instance: {"prop1":42,"prop2":{"test":42}}.' const test = new Test() //    `method2` // 'Test.method2. Args: []. Class instance: {"prop1":42,"prop2":{"test":42}}.' test.method2() //    `method2` // 'Test.method2 -&gt; done. Args: []. Class instance: {"prop1":42,"prop2":{"test":42}}. Res: 42.'</code> </pre> <br><p>  The default is <code>false</code> . </p><br><h2 id="berem-polnyy-kontrol-nad-formatirovaniem-soobscheniy">  We take full control over the formatting of messages </h2><br><p>  What to do if you like the idea, but your idea of ‚Äã‚Äãthe beautiful insists on a different format of message lines?  You can take complete control over the formatting of messages by transferring your own formatter. </p><br><p>  You can write your own formatter from scratch.  Of course.  But this option will not be covered under this (if you are interested in this option, take a look at the <a href="https://github.com/keenondrums/class-logger">"Formatting"</a> section in the README). </p><br><p>  The quickest and easiest way to redefine formatting is to inherit your formatter from the default formatter - <code>ClassLoggerFormatterService</code> . </p><br><p>  <code>ClassLoggerFormatterService</code> has the following <code>protected</code> methods that create small blocks of final messages: </p><br><ul><li> <code>base</code> <br> <ul><li>  Returns the class name and method name.  Example: <code>ServiceCats.eat</code> . </li></ul></li><li> <code>operation</code> <br> <ul><li>  Returns <code>-&gt; done</code> or <code>-&gt; error</code> , depending on whether the method succeeds. </li></ul></li><li> <code>args</code> <br> <ul><li>  Returns the serialized list of arguments.  Example:.  <code>. Args: [milk]</code> .  It uses <a href="https://github.com/davidmarkclements/fast-safe-stringify">fast-safe-stringify</a> to serialize objects under the hood. </li></ul></li><li> <code>classInstance</code> <br> <ul><li>  Returns the serialized instance of the class.  Example:.  <code>. Class instance: {"prop1":42,"prop2":{"test":42}}</code> .  If you included <code>include.classInstance</code> in the config, but for some reason the instance itself is not available at the time of logging (for example, for static methods or before creating a class), returns <code>N/A</code> </li></ul></li><li> <code>result</code> <br> <ul><li>  Returns the serialized execution result or serialized error.  Uses <a href="https://github.com/davidmarkclements/fast-safe-stringify">fast-safe-stringify</a> for objects under the hood.  The serialized error includes the following properties: </li><li>  The name of the class (function) that was used to create the error ( <code>error.constructor.name</code> ). </li><li>  Code ( <code>error.code</code> ). </li><li>  Message ( <code>error.message</code> ). </li><li>  Name ( <code>error.name</code> ). </li><li>  Stack trace ( <code>error.stack</code> ). </li></ul></li><li> <code>final</code> <br> <ul><li>  Returns <code>.</code>  .  Just <code>.</code>  . </li></ul></li></ul><br><p>  The <code>start</code> message consists of: </p><br><ul><li> <code>base</code> </li> <li> <code>args</code> </li> <li> <code>classInstance</code> </li> <li> <code>final</code> </li> </ul><br><p>  The <code>end</code> message consists of: </p><br><ul><li> <code>base</code> </li> <li> <code>operation</code> </li> <li> <code>args</code> </li> <li> <code>classInstance</code> </li> <li> <code>result</code> </li> <li> <code>final</code> </li> </ul><br><p>  You can override only the base methods you need. </p><br><p>  Let's take a look at how you can add a timestamp to all messages. </p><br><blockquote>  I'm not saying that this should be done in real projects.  <a href="https://github.com/pinojs/pino">pino</a> , <a href="https://github.com/winstonjs/winston">winston</a> and most other loggers can do this on their own.  This example is for educational purposes only. </blockquote><br><pre> <code class="plaintext hljs">import { ClassLoggerFormatterService, IClassLoggerFormatterStartData, setConfig, } from 'class-logger' class ClassLoggerTimestampFormatterService extends ClassLoggerFormatterService { protected base(data: IClassLoggerFormatterStartData) { const baseSuper = super.base(data) const timestamp = Date.now() const baseWithTimestamp = `${timestamp}:${baseSuper}` return baseWithTimestamp } } setConfig({ formatter: new ClassLoggerTimestampFormatterService(), })</code> </pre> <br><p>  <a href="https://stackblitz.com/edit/class-logger-demo-custom-formatter-add-timestamp">Poke "live"</a> </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Remember to follow <a href="https://github.com/keenondrums/class-logger">the installation instructions</a> and review the <a href="https://github.com/keenondrums/class-logger">requirements</a> before using this library on your project. </p><br><p>  I hope you did not waste your time, and the article was just a little useful to you.  Please kick and criticize.  We will learn to code better together. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/447970/">https://habr.com/ru/post/447970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447960/index.html">Linux Backup from Veeam on OS Elbrus. Import Substitution ['?' | '.' | '!']</a></li>
<li><a href="../447962/index.html">Hackers can remotely control the Tesla Model S using the autopilot system</a></li>
<li><a href="../447964/index.html">Microcomputer testing for IoT</a></li>
<li><a href="../447966/index.html">How to connect GitLab and Pantheon and optimize Drupal and WordPress workflows</a></li>
<li><a href="../447968/index.html">We write on Rust + CUDA C</a></li>
<li><a href="../447976/index.html">Development and assembly of a photo-lamp</a></li>
<li><a href="../447982/index.html">Digest: 10 materials about home theater screens and projectors</a></li>
<li><a href="../447984/index.html">Uber filed documents for IPO</a></li>
<li><a href="../447986/index.html">A very mathematical history of the perfect combination of colors.</a></li>
<li><a href="../447990/index.html">The story of the classic game hacking on Dendy or Contra with the spreadgan in the beginning</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>