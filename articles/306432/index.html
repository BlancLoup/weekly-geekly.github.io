<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>In Brazil, an increase in the activity of malicious scripts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A year ago, ESET experts recorded the highest activity of two types of malware in Brazil - banking Trojans and their downloaders (daunloaders). Loader...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>In Brazil, an increase in the activity of malicious scripts</h1><div class="post__text post__text-html js-mediator-article">  A year ago, ESET experts recorded the highest activity of two types of malware in Brazil - banking Trojans and their downloaders (daunloaders).  Loaders are executable files of compact size that specialize in downloading the main executable file of a banker trojan to a compromised system.  Today, the situation remains the same, but with some changes, in particular, malicious Java .jar files, as well as Visual Basic Script and JavaScript scripts have been added to the list of Brazil‚Äôs most active threats. <br><br><img src="https://habrastorage.org/files/b99/e97/150/b99e97150b7a4076b1ee02c4645fc70a.jpeg"><br><br>  Thus, it is clear that malicious script files have become very popular with intruders in the region.  In this post we will look at several malicious scripts, as well as the mechanisms of their work.  Such scripts are also used by attackers as downloads, but they provide attackers with a more flexible distribution scheme, as they can be easily integrated into web pages. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  If you look at the statistics on the distribution of malware in Brazil in the first five months of 2016, we will see among them malicious obfuscated scripts with a general (generic) type of detection.  Despite the fact that the payload they load may vary, we will see that there is a connection between detections of this type and banker trojans.  Note that other malicious programs from the table of the most common threats to Brazil are written in a variety of programming languages. <br><br><img src="https://habrastorage.org/files/e23/a6e/ebc/e23a6eebc24a497698dd0e5dfe2cf3a2.png"><br><br>  Specialists from our anti-virus laboratory in Latin America have observed the use of the legitimate MEO cloud service to host malware files.  In most cases, they were banking Trojans.  Phishing emails were chosen as the propagation vector, which contained a link to download the malware. <br><br>  As an example for consideration, let's take a malicious script called Boleto_NFe_1405201421.PDF.js, which is detected by ESET anti-virus products as <b>VBS / Obfuscated.G</b> . <br><br>  Despite the fact that the script code is obfuscated, the method used for this is quite simple.  Even without decrypting, we can see that the file disguised as an image is loaded at the specified URL into the ProgramData directory called flashplayer.exe, and then executed. <br><br><img src="https://habrastorage.org/files/d25/9ec/7b1/d259ec7b1d2a4ffda52a6bbcfce4d786.jpg"><br><br>  In turn, the flashplayer.exe file is a banking trojan downloader that loads and launches a third file called Edge.exe.  This third file is detected by our AV products as <b>Win32 / Spy.KeyLogger.NDW</b> ;  despite the name of this detection, in addition to fixing keystrokes, it also contains the functions of a banking trojan.  Among its many features, it also gets the addresses of websites visited by the user and checks them with its list of online banking websites using <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms648774%2528v%3Dvs.85%2529.aspx">the</a> Dynamic Data Exchange (DDE) <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms648774%2528v%3Dvs.85%2529.aspx">mechanism</a> .  We have previously recorded the use of a similar method by Trojans in previous campaigns.  The difference between this case and the previous ones is that this time the trojan is aimed at compromising various web browsers. <br><br><img src="https://habrastorage.org/files/d18/885/26c/d1888526ca5c4646a15085f52461f3eb.jpg"><br><br>  The lines in the file are encrypted using an algorithm based on a simple XOR operation.  Some of these lines are shown below.  From them it is clear that the Trojan specializes in the theft of credentials of Brazilian online banking sites. <br><br><img src="https://habrastorage.org/files/3d1/137/8ba/3d11378ba44b473c930318648b271f74.png"><br><br>  The threat statistics above show that attackers in Brazil began to switch to new platforms and programming languages ‚Äã‚Äãin an attempt to avoid detection of their malicious code by antivirus products.  However, the attacker's goals did not become different and the theft of online banking information is still the most profitable form of attack and, therefore, the most common. <br><br>  Legitimate cloud storage services were also used by attackers to place malware on JavaScript, which is among the top ten most active threats in Brazil.  In particular, we discovered there are a lot of malicious files that are detected by ESET AV products as <b>Java / TrojanDownloader.Banload.AK</b> . <br><br>  These files are of type .jar with names like Boleto_Cobranca, Pedido_Atualizacao, or Imprimir_Debitos.  After decompiling the code, we get it in obfuscated form with very long names of variables and methods. <br><br><img src="https://habrastorage.org/files/1e1/acd/5f8/1e1acd5f87b74aa581ac7ac776dd3533.jpg"><br><br>  Despite the obfuscation, we can see several names of imported functions in the file.  The last five imported classes are related to encryption operations, as they use the symmetric DES algorithm.  Thus, if we can identify the decryption methods used there, and also replace the names of the methods and variables with more understandable ones, we will get the following code as in the figure below. <br><br><img src="https://habrastorage.org/files/7a4/0f6/a2d/7a40f6a2da5a4d6b9113544c4af03817.jpg"><br><br>  The key used to decrypt strings is the name of a Java class.  Therefore, if we adapt for ourselves the code of the <i>main</i> method of the malicious program, we will be able to decipher the lines in its body.  We can parse the main class to search for these strings and then pass them on to our modified code to perform the decryption process.  Below are the decrypted lines and their encrypted counterparts. <br><br><img src="https://habrastorage.org/files/193/44a/60f/19344a60f84a42b2960ac2dfbf63d0c6.jpg"><br><br>  In the screenshot above, we highlighted the IP address of the server where the malware is associated with it.  Please note that the address of the remote C &amp; C server varies in different samples of the malware that we analyzed.  Next, a file is created on Visual Basic Script, which is executed by the cscript.exe interpreter. <br><br>  It is worth noting that the malware files we analyzed contained more features that could be identified by the names of the imported classes.  One of the most interesting features of a malware is the ability to detect a virtualized environment.  If such an environment is detected, the execution of the malicious code stops.  Some other imported functions specialize in downloading files from the Internet, which can also be seen in the rest of the imports. <br><br><img src="https://habrastorage.org/files/008/a33/b1d/008a33b1de2c4e6fad6ecc12f83322ec.jpg"><br><br>  As we noted above, despite the fact that attackers use different programming languages, their goals have not been changed.  The two loaders we analyzed were placed on a Portuguese data storage service.  However, we discovered another bootloader that was placed on another cloud service.  This last bootloader was written in Visual Basic Script. <br><br>  All these threats use the same method of distribution - fraudulent emails that disguise as legitimate emails sent by banks.  After receiving at our disposal this .vbs file, we see that it is subjected to obfuscation. <br><br><img src="https://habrastorage.org/files/f8c/7fa/7ce/f8c7fa7ce7dc45d7abf27a9c39c9a693.jpg"><br><br>  The main function of the script is presented in hexadecimal format and is encrypted using the XOR operation.  We restored the original look of this Visual Basic Script code.  He specializes in downloading the archive, which is supplied with a password.  This archive is unpacked by another downloadable script application called 7za.exe.  This application is not malicious, but is simply used to extract the executable file from the downloaded .zip archive.  After extracting the executable file, it is launched for execution. <br><br><img src="https://habrastorage.org/files/d9e/0bf/b8a/d9e0bfb8a6434c79a572d8861640f362.jpg"><br><br>  The comment in Portuguese ‚Äúlink do seu do modulo‚Äù in the source code snippet can be translated as ‚Äúlink to your module‚Äù.  This comment leads us to believe that the script was created using a special script generator or that the code was copied from another source. <br><br>  A file extracted and executed by a malicious script is detected by ESET AV products as <b>Win32 / Packed.Autoit.R</b> .  Thus, we can see a variety of programming languages ‚Äã‚Äãthat are used by attackers.  This Autoit script loads the banker trojan code into memory.  The Trojan itself starts up in suspend mode and its image is replaced in memory with a malicious program, after which the execution of the code continues (this technique is known as RunPE). <br><br>  The executable file implemented in the process memory is detected by ESET AV products as <b>Win32 / Spy.Banker.ACSJ</b> and is a banking Trojan written in Delphi (this is what we usually see in Brazil).  In its body, there are also encrypted strings, for which a proprietary decryption algorithm is used, as in the case of the previously specified Trojan, which is installed by the JavaScript loader. <br><br>  We will not discuss the details of the implementation of this banking Trojan, however, we point out that it does not use the above DDE method, as does the Trojan, which is installed by the JavaScript daunloader.  Instead, it imports functions from the oleaut32.dll library, which allows automatic execution of malicious tasks when it detects a victim visiting certain banking websites using the Internet Explorer web browser.  When a victim views one of these websites, the banking trojan downloads a fake form with images that are very similar to legitimate websites used on the web pages in order to obtain online banking account credentials. <br><br><img src="https://habrastorage.org/files/528/5e9/949/5285e994975e4f7ab021fc5d93604a80.png"><br><br>  We were able to associate the above threats, developed in several programming languages ‚Äã‚Äãor platforms, with the same campaign.  One can only wonder how many different methods and resources cybercriminals use to spread their threats in Brazil.  Despite the fact that the last stage of these attacks is the installation of a banking trojan written in Delphi, we also see an update of the code of this trojan.  This update allows cybercriminals to quickly overcome new security features of Brazilian banks. <br><br>  <b>Compromise Indicators (IoC)</b> <br><br>  SHA-1: 8ceaae91d20c9d1aa1fbd579fcfda6ecfdef8070 <br>  File name: Boleto_NFe_1405201421.PDF.js <br>  Discovery name: VBS / Obfuscated.G <br><br>  SHA-1: 016bd00717c69f85f003cbffb4ebc240189893ad <br>  File name: flashplayer.exe <br>  Detection name: Win32 / TrojanDownloader.Banload.XGT <br><br>  SHA-1: c4c4f2a12ed69b95520e5d824854d12c8c4f80ab <br>  File name: Edge.exe <br>  Discovery name: Win32 / Spy.KeyLogger.NDW <br><br>  SHA-1: 2c8385fbe7c4a57345bf72205a7c963f9f781900 <br>  File name: Imprimir_Debitos9874414541555.jar <br>  Discovery name: Java / TrojanDownloader.Banload.AK <br><br>  SHA-1: 363f04edd57087f9916bdbf502a2e8f1874f292c <br>  File name: Atualizacao_de_Boleto_Vencido_10155455096293504.jar <br>  Discovery name: Java / TrojanDownloader.Banload.AK <br><br>  SHA-1: 8b50c2b5bb4fad5a0049610efc980296af43ddcd <br>  File name: LU 1.jar <br>  Discovery name: Java / TrojanDownloader.Banload.AK <br><br>  SHA-1: d588a69a231aeb695bbc8ebc4285ca0490963685 <br>  File name: Comprovante Deposito-Acordo N7656576l (3) (4) (4) .vbs <br>  Discovery name: VBS / TrojanDownloader.Agent.OGG <br><br>  SHA-1: dde2af50498d30844f151b76cb6e39fc936534a7 <br>  File name: 7b0gct262q.exe <br>  Discovery name: Win32 / Packed.Autoit.R <br><br>  SHA-1: 256ad491d9d011c7d51105da77bf57e55c47f977 <br>  Discovery name: Win32 / Spy.Banker.ACSJ </div><p>Source: <a href="https://habr.com/ru/post/306432/">https://habr.com/ru/post/306432/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306416/index.html">10 tips on creating email newsletters</a></li>
<li><a href="../306418/index.html">Recent Trends in Online Payments</a></li>
<li><a href="../306420/index.html">Dates among the digits of Pi: some thoughts from the perspective of statistics and numerology</a></li>
<li><a href="../306424/index.html">Bot revolution is in full swing</a></li>
<li><a href="../306426/index.html">Automation of work with servers using Hewlett Packard Enterprise Server Automation</a></li>
<li><a href="../306434/index.html">Automation of laboratory measurements</a></li>
<li><a href="../306436/index.html">Simple, versatile and reliable IDOL printer control language</a></li>
<li><a href="../306440/index.html">Mobile App Reputation Management</a></li>
<li><a href="../306442/index.html">Choosing the best online CSS compression service</a></li>
<li><a href="../306446/index.html">Drupal Critical Vulnerabilities: Details and Exploits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>