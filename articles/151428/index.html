<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Convenient file sharing from scratch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 Today I want to tell you how to create a convenient http / ftp file storage. I'll say right away - it's pretty simple. What is required o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Convenient file sharing from scratch</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  Today I want to tell you how to create a convenient http / ftp file storage.  I'll say right away - it's pretty simple.  What is required of the reader?  Basic skills in the linux console, the ability to use the editor nano and, of course, the desire to create your own small file corner in the network. <br>  I believe the following makes sense for people with a white IP address and fast internet connection.  My version of the system involves the authorization of ftp / http and the ability to create hidden sections, while it remains possible to give direct links to files.  Also, I provided for the use of http muzzle from mobile devices, so the script interface is nothing superfluous.  For fans of fancy-look and wanting beauty and not functionality, this option is most likely not suitable.  But this does not mean at all that your favorite file technician, my favorite technogic, will look ugly.  See what comes out of this can be on the <a href="http://autoindex.sourceforge.net/index.php%3Fid%3Ddemo">link</a> . <br>  First, let's define the initial configuration: debian 6, apache2, php5, proftpd and good mood.  Everyone's favorite ubunt also fit. <br><a name="habracut"></a><br>  <b>Attention!</b>  The following actions must be performed as <u>root</u> .  Just type su (or sudo su) and then the root password (or current user, in the case of sudo).  Also, after any changes to the configuration files, the server must be restarted for the changes to take effect.  This is done by teams <br><blockquote><code>invoke-rc.d apache2 restart</code> </blockquote> <br>  and <br><blockquote> <code>invoke-rc.d proftpd restart</code> </blockquote> <br>  respectively. <br><br>  So, all in order: <br>  First we install the necessary software.  Open the terminal, enter: <br><blockquote> <code>apt-get install apache2 php5 proftpd</code> </blockquote> <br>  Install it all, then enter: <br><blockquote> <code>nano /etc/apache2/sites-enabled/000-default</code> </blockquote> <br>  Here we will add a directive to disable the directory index and set the standard encoding. <br>  At the beginning of the file will be a description of the directories with the contents.  We are looking for the necessary lines: <br><blockquote><pre>  DocumentRoot / var / www
         &lt;Directory /&gt;
                 Options FollowSymLinks
                 AllowOverride None
         &lt;/ Directory&gt; </pre></blockquote><br>  We need to disable indexes and set the default encoding.  You should have the following: <br><blockquote><pre>  DocumentRoot / var / www
         &lt;Directory /&gt;
                 Options FollowSymLinks ‚ÄìIndexes
                 AddDefaultCharset utf-8
                 AllowOverride None
         &lt;/ Directory&gt; </pre></blockquote><br>  With the apache setup, we are done.  Save the config.  In nano, this is done with the Ctrl + O combination, followed by Enter. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The next step is to create a user for the ftp login and define it in the same group as the apache.  For example, <i>sosnickiy</i> . <br>  <b>Attention!</b>  These username and password will need to be entered at the entrance to your ftp. <br>  We write to the console: <br><blockquote> <code>adduser sosnickiy --ingroup www-data --shell /bin/false</code> </blockquote> <br>  Enter the password, the rest can not be filled, just click on Enter.  The script will create a user, define it in a group and copy standard files.  Create an ftp directory in its home directory: <br><blockquote> <code>mkdir -m 775 /home/sosnickiy/ftp</code> </blockquote> <br>  On this, perhaps, dealt with the user. <br><br>  The next step is to set up an ftp server.  So, we enter: <br><blockquote> <code>nano /etc/proftpd/proftpd.conf</code> </blockquote> <br>  We are looking for a parameter: <br><blockquote> <code># DefaultRoot ~</code> </blockquote> <br>  A # (#) at the beginning of a line means that the parameter is commented out and ignored by the server.  We remove this sieve. <br>  We are looking for a parameter: <br><blockquote> <code>RequireValidShell on</code> </blockquote> <br>  Change it to: <br><blockquote> <code>RequireValidShell off</code> </blockquote> <br>  Add the following to the end of the configuration file: <br><blockquote><pre>  &lt;Directory / home / sosnickiy / ftp&gt;
        	 Umask 002 002
               &lt;Limit ALL&gt;
        		 AllowUser sosnickiy
        		 Denyall
               &lt;/ Limit&gt;
 &lt;/ Directory&gt;

 &lt;Directory / home / sosnickiy / ftp / *&gt;
	 Umask 002 002
               &lt;Limit ALL&gt;
              	 AllowUser sosnickiy
      	 	 Denyall
               &lt;/ Limit&gt;
 &lt;/ Directory&gt; </pre></blockquote><br>  This completes the ftp server setup.  We save, restart it and can already use it.  However, do not rush to upload files there.  That's not all. <br>  Now we will create an ftp directory in the http directory of the server and make it one with the ftp directory in the home folder of the user sosnickiy.  This is where files will be uploaded via an ftp server. <br>  Create a directory: <br><blockquote> <code>mkdir -m 775 /var/www/ftp</code> </blockquote> <br>  Execute the command: <br><blockquote> <code>mount --bind /home/sosnickiy/ftp /var/www/ftp</code> </blockquote> <br>  Now the directories are one. <br>  We perpetuate change: <br><blockquote> <code>echo "/home/sosnickiy/ftp /var/www/ftp none bind 0 0" &gt;&gt; /etc/fstab</code> </blockquote> <br>  Now the directories will be one even after a reboot. <br><br>  At this point, I would like to stop and make one important note: via http, the AutoIndex 2.2.4 script ( <a href="http://autoindex.sourceforge.net/">official site</a> ) will be used to list files, upload them to the server, and manage directories, files and users.  But its standard equipment does not allow starting and working right away as there is a bug with the Russian language file, a bug with the user / password storage file and there are some nuances with the rights created by the script files and directories.  I have made minor changes, I will describe them below.  If you don‚Äôt want to bother with his handset - I suggest downloading the script that is already fully ready for work: ( <a href="http://ompldr.org/vZmg1bA">click here</a> ).  If you do not believe me, consider that I am in a conspiracy with the world government or just a bad person and added a bad change to the code of the Trojan / backdoor / other - manually do it yourself.  At least, I advise you to take at least a file <u>ru.txt</u> from my archive.  I note that in the case of downloading a ready-made script, you only need to upload it to the server, unpack it in / var / www and show your friends a working file sharing service (hehe, irony).  I will not describe the script settings as everything is very obvious there. <br>  So, if you are an incredulous person, you will have to do the following: <br>  We download the archive from the official site, unpack it on the working computer, in the classes directory we find the <u>Admin.php</u> file, open it, look for line 68: <br><blockquote><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> @mkdir($path, <span class="hljs-number"><span class="hljs-number">0755</span></span>);</code> </pre> </blockquote><br>  Change the number 755 to 775. <br>  In the same directory, open the <u>Upload.php</u> file, look for line 73: <br><blockquote><pre> <code class="php hljs">@chmod($fullpathname, <span class="hljs-number"><span class="hljs-number">0644</span></span>);</code> </pre> </blockquote><br>  Change the number 644 to 664. <br>  In the file <u>Tar.php</u> in line 78: <br><blockquote><pre> <code class="php hljs">. str_pad(<span class="hljs-string"><span class="hljs-string">'755'</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>, STR_PAD_LEFT) . <span class="hljs-string"><span class="hljs-string">"\0"</span></span> <span class="hljs-comment"><span class="hljs-comment">//permissions</span></span></code> </pre> </blockquote><br>  Instead of 755, we put 775. <br>  This will fix the data access conflict. <br>  Next, you need to open the file ru.txt in the languages ‚Äã‚Äãdirectory, delete its contents and insert corrected data into it: <br><div class="spoiler">  <b class="spoiler_title">ru.txt</b> <div class="spoiler_text"><pre> index of index
 parent directory Parent directory
 thumbnail of icon
 continue continue

 file
 files Files
 folder folder
 folders Folders
 size Size
 total size overall size
 total downloads total downloaded
 total total
 date Modified
 description Description
 downloads download
 type Type
 sort by Sort by

 search Search
 both Both
 search results for Search results for
 and its subdirectories and subdirectories

 account Account
 login login
 logout logout
 username Username
 password Password
 select user to remove Select user to remove
 Are you sure you want to remove this user?
 delete this user Delete this user
 add user Add user

 guest guest
 user user
 mod moderator
 admin admin
 level level

 rename rename
 renaming Rename
 new filename New file name
 you can also move the file by specifying a path. You can also move the file by specifying the path.
 delete delete
 are you sure you want to delete this file
 edit description Edit description
 yes, delete Yes, delete

 upload Download
 files to this folder Files in this folder
 uploaded files Upload files
 failed files not downloaded files
 none No
 file already exists File already exists
 The file is marked as hidden.
 reconfigure script Reconfigure script
 create new directory in this folder Create a new directory in this
 edit list of hidden files Edit list of hidden files
 add new user Add new user
 delete user Delete user
 copy url Copy a remote file (to this folder)
 upload to ftp upload file to FTP server

 enter the new description for the file Enter the new file description
 change Change
 enter the new name Enter new name
 create Create

 add Add
 remove remove
 remove a hidden file Remove hidden file
 add a new hidden file Add new hidden file

 edit ban list Edit ban list
 remove a ban ban ban
 add a new ban Add to banned list
 your administrator has your IP address or hostname Sorry, the administrator has blocked your IP address or hostname

 view entries from log file View log file
 view statistics from log file View statistics from the log file
 How many entries would you like to view How many entries do you want to view
 view View
 page page
 of of

 calculate md5sum Calculate md5sum
 download directory as tar.gz archive Download the directory as a tar.gz archive </pre></div></div><br>  Format: value [tab] translation to the desired language [line feed] <br>  In the original file, the format is somewhat broken.  Therefore, file sharing will not work. <br>  Then, create in the root directory (next to the <u>index.php</u> file) file <u>.htpasswd.autoindex</u> .  Mandatory with a dot at the beginning.  Open, paste into it the following: <br><blockquote><pre>  admin 7c4a8d09ca3762af61e59520943dc26494f8941b 3
 user 12dea96fec20593566ab75692c9949596833adc9 1 </pre></blockquote><br>  In this case, the administrator password is <u>123456</u> <br>  User Password: <u>user</u> <br><br>  We save everything, we pack the directory with the corrected script in a <b>zip</b> archive, restart the ftp server, go in, upload the archive with the corrected script to the ftp directory. <br>  For Windows, I recommend the Filezilla client.  Or simply enter ‚ÄúExplorer‚Äù into the address bar: <pre>  ftp: // ip_address_server / ftp / </pre>  and hit enter.  Also, you can save a password and add to Favorites.  Conveniently. <br><br>  So, the script is packed into the archive and lies in the ftp folder.  Expand the console, write (better copy and paste): <br><blockquote> <code>cd /home/sosnickiy/ftp/ &amp;&amp; unzip AutoIndex-2.2.4.zip &amp;&amp; cp ./AutoIndex-2.2.4/* /var/www &amp;&amp; rm -rf AutoIndex-2.2.4.zip AutoIndex-2.2.4</code> </blockquote> <br>  Now we execute a simple command: <br><blockquote> <code>chown -R www-data:www-data /var/www &amp;&amp; chmod -R 775 /var/www</code> </blockquote> <br>  Now everything is ready!  Use for health. <br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/151428/">https://habr.com/ru/post/151428/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../151422/index.html">Fujifilm stops film production</a></li>
<li><a href="../151423/index.html">Eviterra.com - smart booking form and pleasant things.</a></li>
<li><a href="../151424/index.html">Hybrid "solar" system for producing hydrogen for fuel cells</a></li>
<li><a href="../151425/index.html">What will people say if you give an iPhone 4S and say that it is the 5th</a></li>
<li><a href="../151426/index.html">Review of 7 TechCrunch Disrupt SF 2012 finalists</a></li>
<li><a href="../151429/index.html">Podcast news "On the wave of knowledge and trends" - the two hundredth edition</a></li>
<li><a href="../151430/index.html">Wi-Fi in the metro: look at the cable in the wall of the tunnel</a></li>
<li><a href="../151431/index.html">Google Pluto Switch</a></li>
<li><a href="../151432/index.html">Installing Kernel Tube Video Sharing 2.4.3 on Ubuntu 12.04</a></li>
<li><a href="../151433/index.html">‚ÄúAndroid for programmers: create applications‚Äù - a new book from Daytelov</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>