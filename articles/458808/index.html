<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Habr postmortem report: fell on the newspaper</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The end of the first and the beginning of the second month of the summer of 2019 were not easy and were marked by several major falls in world IT serv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Habr postmortem report: fell on the newspaper</h1><div class="post__text post__text-html js-mediator-article">  The end of the first and the beginning of the second month of the summer of 2019 were not easy and were marked by several major falls in world IT services.  Of the notable ones: two serious incidents in the CloudFlare infrastructure (the first with crooked hands and negligent attitude towards BGP by some ISPs from the US; the second with the curve deployments of the CFs themselves, influenced everyone using CF, and these are many notable services) and Unstable Facebook CDN infrastructure (affected all FB products, including Instagram and WhatsApp).  We also had to get under the hand, although our outage was far less noticeable on a world background.  Someone has already begun to drag in black helicopters and "sovereign" conspiracies, therefore we release the public post mortem of our incident. <br><br> <a href="https://habr.com/ru/company/habr/blog/458808/"><img src="https://habrastorage.org/webt/nk/sh/6g/nksh6gyac2qxtj6yittv67ash_8.jpeg"></a> <br><a name="habracut"></a><br>  <b>07.03.2019, 16:05</b> <br>  Began to fix problems with resources similar to the violation of internal network connectivity.  Having not fully verified everything, they began to sin on the performance of the external channel in the direction of DataLine, since it became clear that the problem was with the access of the internal network to the Internet (NAT), to the extent that they put the BGP session in the direction of DataLine. <br><br>  <b>07/03/2019 16:35</b> <br>  It became obvious that the equipment performing the translation of network addresses and access from the local area network to the Internet (NAT) failed.  Attempts to reboot the equipment did not lead to anything, the search for alternative options for organizing connectivity began before receiving a response from technical support, as from experience, this would most likely not help. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The problem was somewhat aggravated by the fact that this equipment also terminated the incoming connections of client VPN employees, and it became more difficult to carry out remote restoration work. <br><br>  <b>07.03.2019, 16:40</b> <br>  We tried to reanimate the previously existing backup NAT scheme, which had worked hard before.  But it became clear that a number of network retrofits made this scheme almost completely inoperative, since its restoration could at best not work, at worst break the already working one. <br><br>  We began to work on a couple of ideas to transfer traffic to the complex of new routers serving the backbone, but they seemed inoperative due to the peculiarities of the distribution of routes in the core network. <br><br>  <b>07.03.2019, 17:05</b> <br>  At the same time, a problem emerged in the name resolution mechanism on name-servers, which led to errors in endolving applications in applications, and began to promptly fill the hosts files with records of critical services. <br><br>  <b>07.03.2019, 17:27</b> <br>  The limited working capacity of Habr has been restored. <br><br>  <b>07.03.2019, 17:43</b> <br>  But in the end, a relatively secure solution was found to organize traffic transmission through one of the border routers, which was quickly done.  Connectivity to the Internet has been restored. <br><br>  Within the next few minutes, the mass of notifications about the recovery of the performance of the monitoring agents came from the monitoring systems, however, some services turned out to be inoperable, as the name resolution mechanism on name-servers (dns) was violated. <br><br><img src="https://habrastorage.org/webt/cq/6c/gw/cq6cgwgmue0obthuyddjmtgauii.png"><br><br>  <b>07.03.2019, 17:52</b> <br>  NS have been restarted, the cache has been reset.  Resolving recovered. <br><br>  <b>07.03.2019, 17:55</b> <br>  All services except MK, Freelancim and Toaster have earned. <br><br>  <b>07.03.2019, 18:02</b> <br>  Earned MK and Freelance. <br><br>  <b>07.03.2019, 18:07</b> <br>  Brought back an innocent BGP session with a DataLine. <br><br>  <b>07.03.2019, 18:25</b> <br>  They began to fix the flops on the resources, it was connected with the change of the external address of the NAT pool and its absence in the acl of a number of services, quickly corrected.  Immediately earned and toaster. <br><br>  <b>07.03.2019, 20:30</b> <br>  Noticed errors related to Telegram bots.  It turned out that they forgot to register the external address in a pair of acl (proxy servers), quickly corrected it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fe/6b/xz/fe6bxztvh1ob0pcjnfxnewsfe2i.gif"></div><br><h3>  findings </h3><br><ul><li>  The equipment, which had previously raised doubts about its suitability, failed.  There were plans to exclude him from work, as it hindered the development of the network and had compatibility problems, but at the same time performed a critical function, which is why any replacement was not technically easy without interrupting services.  Now you can move on. </li><li>  Problems with DNS can be avoided by moving them closer to the new backbone network beyond the NAT network and at the same time with full connectivity with the gray network without translation (as planned before the incident). </li><li>  It is not necessary to use domain names when assembling RDBMS clusters, since the convenience of transparently changing the IP address is not particularly necessary, since such manipulations still require rebuilding of the cluster.  This decision is dictated by historical reasons and, above all, by the obvious endpoints by name in RDBMS configurations.  In general, the classic trap. </li><li>  In principle, exercises are conducted that are comparable to the ‚Äúsovereignization of the RuNet,‚Äù there is something to think about in terms of increasing the possibilities of autonomous survival. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/458808/">https://habr.com/ru/post/458808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458798/index.html">NutritionBot or how I want to take away the bread from fitness trainers</a></li>
<li><a href="../4588/index.html">Zune in action</a></li>
<li><a href="../45880/index.html">Problem solved. But is the code good?</a></li>
<li><a href="../458800/index.html">Deep learning. Federated learning</a></li>
<li><a href="../458804/index.html">Digest of machine learning and artificial intelligence articles</a></li>
<li><a href="../458810/index.html">Corel and Parallels sold to US investment group KKR</a></li>
<li><a href="../458812/index.html">JVM TI: how to make a plugin for a virtual machine</a></li>
<li><a href="../458814/index.html">Launching a site for a product with unformed demand</a></li>
<li><a href="../45882/index.html">Grand Theft Auto IV PC Edition</a></li>
<li><a href="../458820/index.html">On the implementation of the famous genre on the Minecraft platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>