<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>LibCanvas: On the way to the stars</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Six months ago, I decided to write an online application "Star Map". I think many of us have ever seen this very map of the starry sky, and it probabl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>LibCanvas: On the way to the stars</h1><div class="post__text post__text-html js-mediator-article">  Six months ago, I decided to write an online application "Star Map".  I think many of us have ever seen this very map of the starry sky, and it probably attracted our attention. <br>  I thought it would be interesting to do something like this on JS.  It was decided to use in part the ready-made library LibCanvas because of its thoughtful syntax, which was important when writing bulk applications. <br><img src="https://habrastorage.org/getpro/habr/post_images/dc1/b5a/26a/dc1b5a26a827662bf29c197943ae4c31.jpg" alt="image"><br><br><a name="habracut"></a><br>  The first problem I encountered is quite a large number of stars that need to be displayed with high precision - there are about 6,000. Here I decided to generate an array for js from a text file of the stars catalog. <br><br><h5>  When to use LibCanvas? </h5><br>  Actually there was a question;  Should I always use LibCanvas?  The fact is that in the project besides the map itself, a collage of the visible dimensions of the planets should be drawn, which involved writing a separate library and for this task I decided not to use LibCanvas. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Library of Mathematical and Astronomical Functions </h5><br>  The project required repeated use of different mathematical functions, so it was decided to write a library of these same functions. <br>  Actually, here is the <a href="https://gist.github.com/Kirilliann/5689926">result</a> . <br>  There respectively: <br><ul><li>  Trigonometric functions with a degree argument </li><li>  Functions to convert the Julian day to the Gregorian date </li><li>  Translation functions of horizontal / equatorial coordinates </li><li>  Atmospheric refraction calculation </li><li>  Others (names of months, getting current time, etc.) </li></ul><br><br><h5>  Data catalogs </h5><br>  Object database is mainly located <a href="">here.</a> <br>  Also here are the elements of the orbits of the planets and comets. <br><br><h5>  Star Display </h5><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (stars.length); i++){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> decr=stars[i][<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// var tr=sr-stars[i][0]; //  var zl=atmospheric_refraction(equatorial_to_horizontal(decr, tr, phi)[1]);//  var mag=Math.round(stars[i][2]/100); // if (zl&lt;90 &amp;&amp; mag&lt;magmax){// ,    var r_star=k1*1+k2*(magmax-mag); var Az=equatorial_to_horizontal(decr, tr, phi)[0]; // var cor1=to_xy(zl,Az);     var x=(cor1[0]*1).toFixed(0); //  var y=(cor1[1]*1).toFixed(0); // /*      */ if (mag&lt;1.5){ var circl3 = new LC.Circle( x,y,r_star*2); ct.fill(circl3, ct .createRadialGradient( new LC.Circle(x, y, 1), new LC.Circle(x, y, r_star*2)) .addColorStop({ '0.0': 'rgba(200,200,200,0.4)', '1.0': 'rgba(200,200,200,0)' })); var circl = new LC.Circle( x,y,r_star*0.8); //  ct.fill(circl, '#FFF');//  }else{ /*       */ var circl = new LC.Circle( x,y,r_star); //  ct.fill(circl, '#FFF');//  } m++; } }</span></span></code> </pre> <br><br><h5>  Planets </h5><br><br><h6>  Map views </h6><br>  I decided to highlight the planets in yellow (adapt to reality).  To calculate the positions of the planets and wrote the <a href="https://gist.github.com/Kirilliann/5689952">library</a> <br><br><h6>  Collage mappings </h6><br>  Here I also had to work a little, and as a result I wrote a couple of functions for displaying a collage. <br>  Also below was a table with the coordinates of the planets. <br>  Code display planets in the head file: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//============================================================================================================ for (var i = 0; i &lt; (planets.length); i++){ var tyu=planetposition(planets[i][0], planets[i][1], jdn, planets[i][3], planets[i][4], planets[i][5], planets[i][6], planets[i][7], planets[i][8],planets[i][9],planets[i][10]) if (i==0){ sundelta=tyu[1] } if (planetinfo1==1){ //  "  " res+="&lt;tr&gt;&lt;td&gt;"+planets[i][8]+"&lt;/td&gt;&lt;td&gt;"+deltafloor(tyu[1])+"&lt;/td&gt;&lt;td&gt;"+alphafloor(tyu[0])+"&lt;/td&gt;&lt;td&gt;"+(tyu[3]).toFixed(3)+"&lt;/td&gt;&lt;td&gt;"+(tyu[2]).toFixed(1)+"&lt;/td&gt;&lt;td&gt;"+(2*tyu[4]).toFixed(1)+"&lt;/td&gt;&lt;/tr&gt;"; } var zl=atmospheric_refraction(equatorial_to_horizontal(tyu[1], sr-15*tyu[0], phi)[1]);//  if (i==0){ sunz=zl } //alert(tyu) if (i&gt;0){ draw(ctx, tyu[4], i,tyu[3],planets[i][8], date); } if (zl&lt;90){ var Az=equatorial_to_horizontal(tyu[1], sr-15*tyu[0], phi)[0]; // var cor1=to_xy(zl,Az); var x=(cor1[0]*1).toFixed(0);//  var y=(cor1[1]*1).toFixed(0);// var R=Math.round((9-1*tyu[2])*kp2); if (R&gt;10){ R=10 var R1=20*R if (planets[i][8]==''){ //     R=7 sunx=x suny=y } }else{ var R1=kp1*R } var circl = new LC.Circle( x,y,R); //   var circl2 = new LC.Circle( x,y,R1); //   ct.fill(circl, 'rgba('+planets[i][11][0]+','+planets[i][11][1]+','+planets[i][11][2]+',1)'); //   //   ct.text({ text: planets[i][8], padding: [ 1*y, 1*x], size:15, color:'rgba('+planets[i][11][0]+','+planets[i][11][1]+','+planets[i][11][2]+',1)' }); //alert(planets[i][11][0]) //  ----- ct.fill(circl2, ct .createRadialGradient( new LC.Circle(x, y, 1), new LC.Circle(x, y, R1)) .addColorStop({ '0.0': 'rgba('+planets[i][11][0]+','+planets[i][11][1]+','+planets[i][11][2]+',0.85)', '1.0': 'rgba('+planets[i][11][0]+','+planets[i][11][1]+','+planets[i][11][2]+',0)' }));/**/ //---------- } }</span></span></code> </pre><br><br><h5>  Moon </h5><br>  I decided not to suffer, and did not draw the moon along with the phase, because the load is already high. <br>  To display the position of the Moon, I took the ready-made algorithm of Jan Meeus, who found it on the outskirts of the Internet, so I decided to change it a bit and repost to: <a href="https://gist.github.com/Kirilliann/5689968">github</a> <br><br><h5>  Comets and asteroids </h5><br>  Here I still stand at a crossroads, because it is difficult to say how much this function is needed: as a rule, comets and asteroids are too weak to be observed.  Therefore, I made only a section for the brightest comets.  Actually the library was written to calculate the position of the comet in a parabolic orbit: <a href="https://gist.github.com/Kirilliann/5690018">github</a> <br><br><h5>  Problems and solutions </h5><br>  The main problem is the slowness of the program, especially with fast scrolling.  It‚Äôs hard to do something here, it‚Äôs probably worth cutting back on algorithms, but this is my opinion ... In fact, I rarely use magnification, so I rarely feel this bug. <br><br>  The program is located here: <a href="http://astrokot.ru/planetarium/dev/planetarium.html">http://astrokot.ru/planetarium/dev/planetarium.html</a> <br></div><p>Source: <a href="https://habr.com/ru/post/181554/">https://habr.com/ru/post/181554/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../181544/index.html">New rules of the official game</a></li>
<li><a href="../181546/index.html">Trends in the mobile development market in 2013</a></li>
<li><a href="../181548/index.html">Simple site on D</a></li>
<li><a href="../181550/index.html">The Eighth All-Russian Meeting of the System Administrators of the ACD 2013</a></li>
<li><a href="../181552/index.html">Digest of upcoming IT events for June 2013</a></li>
<li><a href="../181556/index.html">A simple blog with comments on Django: development and deployment for the smallest</a></li>
<li><a href="../181558/index.html">Automated testing of a web application (MS Unit Testing Framework + Selenium WebDriver C #). Part 4: Finally writing tests</a></li>
<li><a href="../181560/index.html">Robot for aftermarket equipment repair</a></li>
<li><a href="../181562/index.html">Overview of Windows Workflow Foundation on the example of building an electronic document management system [Part 1]</a></li>
<li><a href="../181564/index.html">Is it dead PC? 20 years of controversy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>