<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What's new in Rails 4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The fourth version of the Ruby on Rails framework is just around the corner. Although there is no official release date yet, many expect a release can...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What's new in Rails 4</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/020/b15/8e6/020b158e68a3c4f2f0a39b3f5004b8b5.jpeg" align="right">  The fourth version of the Ruby on Rails framework is just around the corner.  Although there is no official release date yet, many expect a release candidate at the beginning of this year. <br>  This version of the framework has been under development for a year now and represents many changes in the internal architecture.  The framework has evolved and acquired a more modular format, most of the innovations are scattered across individual jamms, in order to keep the main code clean.  Thus, the outdated functionality can not be officially supported, but used if such a need arises. <br><br>  While writing these lines, Engine Yard does not yet officially support Rails 4 in our cloud products.  However, if you want to try them out, you can of course.  However, be careful - some features, especially live streaming, most likely will not work. <br><br>  If you encounter difficulties when trying to deploy applications on Rails 4, then you need to register them as <a href="https://support.cloud.engineyard.com/forums/30086-feature-requests">feature requests</a> , not as a bug, since we have not finished integrating Rails 4 into our products. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Notable changes in Rails 4 </h4><br>  Many things have changed or been reworked in Rails 4, and several new features have been added.  Although this article is not exhaustive, we will try to explain some of the most recent and significant innovations. <br><br><h5>  Ruby 1.9.3 Minimum </h5><br>  One of the most notable changes in Rails 4 that all developers should pay attention to is that Ruby 1.9.3 is now the minimum requirement.  Support for 1.8.7 has been completely discontinued, but given that most of us use 1.9.3, there is no reason to worry about support for 1.9.2.  In fact, <a href="https://github.com/rails/rails/commit/4fa615a8661eb13d4bd8a7de4d839e9883ef26ec">this commit</a> from Jose Valim bluntly tells the user that Rails 4 requires Ruby 1.9.3+ and interrupts work immediately if RUBY_VERSION &lt;1.9.3. <br>  What does this mean to you?  First, if you are using 1.8.7 or Ruby Enterprise Edition (which is actually 1.8.7 with little performance tuning options), you would need to upgrade anyway.  Upgrading from 1.8.7 to 1.9.3 can be both painless and quite complicated - it all depends on the program, its dependencies, and what could become outdated between these two releases.  Make sure you have good code coverage, switch the interpreter in development mode to 1.9.3 (this is extremely simple with <a href="https://rvm.io/">RVM</a> ), and run the tests.  If you are interested in additional tips on how to go from 1.8 to 1.9, read <a href="https://blog.engineyard.com/2012/prepare-your-app-for-rails-4-and-ruby-1-9/">this article by</a> my colleague from Engine Yard, Anthony Accomazzo. <br>  In any case, I highly recommend everyone to use only the latest stable versions of the interpreter with the latest updates available to achieve the best performance and security level. <br><br><h5>  No more vendor / plugins </h5><br>  The vendor / plugins folder is not in Rails 4. Instead, you need to use a Bundler with the desired path or Git dependency. <br>  Many obsolete items have moved into separate jams. <br><br><h5>  Hash-based and dynamic finder methods </h5><br>  You may remember that in recent versions of Rails, warnings against the ‚Äúold‚Äù ActiveRecord query syntax were constantly issued.  For example: <br><br><pre><code class="ruby hljs">User.find(<span class="hljs-symbol"><span class="hljs-symbol">:first</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:conditions</span></span> =&gt; { ‚Ä¶ })</code> </pre> <br>  This syntax is no longer supported in Rails 4.  To add this functionality to your program, you will have to install the following activerecord-deprecated_finders gem jam: <a href="https://github.com/rails/activerecord-deprecated_finders">github.com/rails/activerecord-deprecated_finders</a> <br><br><h5>  ActiveRecord :: SessionStore </h5><br>  Storing sessions in a database is an interesting feature of many useful programs, especially for confidential information, but, in most cases, it is not as efficient as using a simple cookie.  So, ActiveRecord :: SessionStore is not in Rails 4. Use the activerecord-session_store jam to return this functionality: <a href="https://github.com/rails/activerecord-session_store">github.com/rails/activerecord-session_store</a> . <br>  If to be meticulous, storing confidential information in a cookie is a bad idea for many reasons.  Lack of encryption (or weak encryption) is just one of them.  The best solution for storing such information would be to use the database (protected by the network access level and the application itself), and then simply refer to the ID in the session object.  I mean, instead of installing a whole object in a session or even meta information about an object, you can save the object in the database and simply refer to its ID within the user's session (and put its meta information in memcached or PostgreSQL hstore). <br><br><h5>  ActiveResource </h5><br>  ActiveResource is an ORM (Object-Relational Mapping) for REST-based services.  It has been removed from Rails 4 and will no longer go out with it.  <a href="https://twitter.com/guilleiguaran">Guillermo Iguaran</a> told the Yeti Media blog that the <a href="http://yetimedia.tumblr.com/post/35233051627/activeresource-is-dead-long-live-activeresource">motivation for this was that his support did not highlight the necessary amount of love and attention of the core development team that it deserves</a> .  After the ActiveResource was separated, they were taken up by a separate development team led by <a href="https://github.com/jeremy">Jeremy Kemper</a> .  Since the separation, many new features have been added, so for all ActiveResource fans, this should have been more good news.  It also became useful for those who would like to use the ActiveResource functionality without having to use all of the Rails for this.  To use ActiveResource, simply enable the 'activeresource' jam: <a href="https://github.com/rails/activeresource">github.com/rails/activeresource</a> . <br><br><h5>  Rails Observers, Caching Pages and Actions </h5><br>  The ability to cache pages and actions has been removed from Rails 4 in favor of caching codenamed ‚ÄúMatryoshka‚Äù (Russian Doll).  DHH (David Heinemeier Hansson) has a jam that explains how such caching works (see <a href="https://github.com/rails/cache_digests">github.com/rails/cache_digests</a> for more information). <br>  Given the lack of caching pages and actions, the need for browsers is almost absent.  In many cases, these browsers are used to expire the cache, which, due to the caching scheme in Rails4, is not so necessary.  Also, observers are often abused, using them as a dump for persistent operations (persistence operations), where callback would be much more appropriate.  So Rails 4 will come out without caching pages, actions, and browsers. <br>  To include them in the program, take a look at: <br><br>  <a href="https://github.com/rails/actionpack-action_caching">github.com/rails/actionpack-action_caching</a> <br>  <a href="https://github.com/rails/actionpack-page_caching">github.com/rails/actionpack-page_caching</a> <br>  <a href="https://github.com/rails/rails-observers">github.com/rails/rails-observers</a> <br><br><h5>  Dalli instead of memcache-client </h5><br>  Dalli is now used with memcached instead of memcache client.  This innovation will be approved by many developers, as Dalli is much quicker than the memcache client, and allows the use of parallelism (multithreading) - a topic that is of great concern in the ruby ‚Äã‚Äãcommunity.  To use this functionality, you need to add the ‚Äúdalli‚Äù jam to your Gemfile if it is still missing there and specify mem_cache_store as your cache store. <br><br><h5>  New Default Test Locations </h5><br>  Newcomers to Rails and <a href="http://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25B7%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25BA%25D0%25B0_%25D1%2587%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B7_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">TDD</a> (development through testing) are often confused by the default settings and names.  ‚ÄúModels‚Äù correspond to ‚Äúunits‚Äù, to tests of ‚Äúcontrollers‚Äù - ‚Äúfunctional‚Äù tests, etc.  In Rails 4, this will change for more clarity.  The default test location names will be more similar to the rspec convention names for Rails tests: <br><br>  app / models -&gt; test / models (was test / units) <br>  app / helpers -&gt; test / helpers (was test / units / helpers) <br>  app / controllers -&gt; test / controllers (was test / functional) <br>  app / mailers -&gt; test / mailers (was test / functional) <br><br>  If you have the mood, and you want to read about the names of the tests and their purpose, then you definitely need to read or participate in <a href="https://github.com/rails/rails/pull/7878">this discussion</a> .  At the beginning, the commit was intended to rename the ‚Äúintegration‚Äù test (test / integration) into the ‚Äúacceptance‚Äù test.  Although the rest of this request was accepted positively, it was this change that caused a lot of discussion about what is the ‚Äúacceptance‚Äù test and what isn't.  In the end, the author of the <a href="https://github.com/blowmage">blowmage</a> commit decided to leave the name as it is, so as not to delay the approval of the commit, which led to the approval of several key Rails developers. <br><br><h5>  Verb PATCH </h5><br>  Rails used the ‚ÄúPUT‚Äù HTTP method to modify existing resources for a long time.  However, the specification of HTTP semantics implies a complete resource descriptor under PUT.  In other words, PUT, semantically speaking, must contain a complete presentation of the object that needs to be changed.  Consequently, on the technical side, we did this ‚Äúwrong‚Äù for quite a long time, sending pieces of the object that needs to be changed when we made RESTful updates using PUT. <br>  That is why this functionality has been changed in Rails 4, and the verb PATCH must be used.  As the name itself tells us, PATCH is intended to send pieces of information about an object on a server without its full description.  This more closely matches the HTTP semantics, as described in <a href="http://tools.ietf.org/html/rfc5789">RFC 5789</a> . <br>  As with all RESTful forms in Rails, a hidden ‚Äú_method‚Äù field will be generated indicating that the ‚ÄúPATCH‚Äù method will be used instead of ‚ÄúPUT‚Äù.  And as expected, the routing will associate the PATCH method with the ‚Äúupdate‚Äù action in the controller. <br>  In order to maintain backward compatibility, the former PUT method will also be directed to ‚Äúupdate‚Äù in Rails 4.0 so that existing APIs can continue their normal work. <br>  On the <a href="http-method-for-updates/">Rails</a> blog, <a href="http-method-for-updates/">you can learn more about the PATCH method</a> .  This is a great change, and what was thought of backward compatibility will make it easier for developers to update. <br><br><h5>  Threadsafe default </h5><br>  Ruby developers have long sought to achieve true multi-threading without using <a href="http://en.wikipedia.org/wiki/Global_Interpreter_Lock">GIL</a> , and the authors of Rails understand that <a href="http://en.wikipedia.org/wiki/Ruby_MRI">MRI</a> is not the only way to launch applications into production.  Multithreading servers and applications can significantly increase performance by using shared memory segments and allows simultaneous execution of code. <br>  However, the standard interpretations of Ruby, known as ‚ÄúMRI‚Äù, are not truly multi-threaded.  It can execute code at the same time if one thread is waiting for input / output, which can allow the main C libraries to execute code at the same time, but the ruby ‚Äã‚Äãcode itself is still executed sequentially due to the presence of GIL. <br>  In Rails, it has long been possible to run code in a multi-threaded manner, but this functionality was not enabled by default and this will be changed in Rails4.  This is not such a big change, considering that you can turn on multithreading in most Rails applications right now by changing the settings and restarting the threadsafe server.  However, it is worth highlighting for the reason that the Ruby community is becoming more and more aware of the need to simultaneously execute code. <br>  Aaron Patterson discusses config.threadsafe!  in more detail in the following article: <br>  <a href="http://tenderlovemaking.com/2012/06/18/removing-config-threadsafe.html">tenderlovemaking.com/2012/06/18/removing-config-threadsafe.html</a> <br><br><h5>  Postgres H-Store </h5><br>  ActiveRecord in Rails 4 will support the PostgreSQL hstore extension.  This database extension allows you to create a new data type in the PostgreSQL columns, which will be called 'hstore', which is a string-only hash.  For most intents and purposes, this is similar to the serialization of data in a text column, but the fact that it is now a native data type gives us a solid performance boost and the ability to send direct requests to this data type.  This means that your application will have a partially non-schematic database without having to use MongoDB, CouchDB, Riak, or another non-schematic datastore. <br>  The hstore extension, although not a full-scale non-schematic solution, its integration into Rails will be an excellent complement for many applications.  There are situations where most of your data is normalized for a specific model, but some information needs to be referenced on the fly.  This is where the hstore can truly manifest itself. <br><br>  Let's give a simple example.  Let's say your application needs to define new key / value pairs on the fly ‚Äî define an object scheme that will be different for different users.  Maybe it will be a certain type of form in the CMS.  The doctor's reception may want to find out information about the patient, and the event manager needs completely different information.  In the past, this was solved by serialization, but thanks to hstore, we have a native way for this, which makes it easier to create a query. <br>  You can start using hstore in PostgreSQL using <a href="https://github.com/softa/activerecord-postgres-hstore">activerecord-postgres-hstore</a> jam.  Ryan Bates created a <a href="http://railscasts.com/episodes/345-hstore">podcast</a> on this topic, where he explains very well how it works and shows many examples of using and creating queries.  You can also learn more about hstore by reading the official <a href="http://www.postgresql.org/docs/9.1/static/hstore.html">PostgreSQL documentation</a> .  I would like to note that you can use hstore on Engine Yard using PostgreSQL 9.1+ as your database environment.  To do this, you can use the created Chef scripts in the <a href="https://github.com/engineyard/ey-cloud-recipes/tree/master/cookbooks/postgresql9_extensions">postgresql9-extensions</a> section on GitHub. <br><br><h5>  Array, MACADDR, INET, CIDR </h5><br>  Since we are talking about new data types supported by PostgreSQL and Rails, it is worth noting that ActiveRecord along with Rails 4 will support the following data types in PostgreSQL: <a href="http://reefpoints.dockyard.com/ruby/2012/05/18/rails-4-sneak-peek-expanded-activerecord-support-for-postgresql-datatype.html">Array, MACADDR, INET and CIDR</a> .  Although they are usually stored as strings in most databases, PostgreSQL provides support for native data types for each of them, and ActiveRecord can use this. <br>  The INET and CIDR data types will be converted to <a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/ipaddr/rdoc/index.html">IPAddr</a> instances, the arrays will be arrays, and the MAC addresses of the requests will be returned in rows. <br><br><h5>  Live streaming </h5><br>  <a href="http://tenderlovemaking.com/2012/07/30/is-it-live.html">Aaron Patterson introduced new functionality in Rails 4, called Live Streaming</a> .  This actually allows you to broadcast content to the browser of connected users directly from the server using Server-Sent Events.  And the fact that the browser is crucial for this process should hint to you about an obvious problem: Internet Explorer does not yet support this.  This can be fixed in future versions of IE, but at the moment live streaming does not work in Microsoft's browser. <br>  Live Streaming in Rails 4 also opens up many interesting possibilities for your application.  This will be most useful for applications that use real-time information: stock reports and financial applications, games, etc. <br>  Engine Yard does not yet support live streaming for a number of reasons.  We have two web servers to choose from: Unicorn and Passenger.  None of them support this yet.  <a href="http://blog.phusion.nl/2012/08/03/why-rails-4-live-streaming-is-a-big-deal/">Passenger 4 Enterprise, currently being developed by Phusion</a> , will support live streaming in Rails, and we will integrate Passenger 4 into our stack as soon as it reaches release status. <br>  By this we do not want to say that Live Streaming is not available from Engine Yard, it just will not work out-of-the-box, and requires additional configuration.  We plan to change this by adding the ability to use other application servers.  For example, <a href="http://puma.io/">Puma is</a> already available as Early Access, just like Rubinius. <br><br><h5>  Cache Digests (aka Russian Doll Caching) </h5><br>  ache digest jam automatically adds a digital signature to each fragment cached in your application. <br>  For example, your application caches Authors and Posts: <br><pre> <code class="ruby hljs">&lt;b id=<span class="hljs-string"><span class="hljs-string">"internal-source-marker_0.9843547998461872"</span></span>&gt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Author</span></span></span><span class="hljs-class"> &lt; ActiveRecord::Base </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">has_many</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">posts</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> &lt; ActiveRecord::Base </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">belongs_to</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">author</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">touch</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br>  (I want to note that adding touch: true to the belongs_to association is extremely important, as it also forces the updated_at from Author to change when any author's posts are updated) <br>  Normally you would fragment the cache like this: <br><pre> <code class="ruby hljs">&lt;!-- app/views/authors/show.html.erb --&gt; &lt;% cache [<span class="hljs-string"><span class="hljs-string">'v1'</span></span>, @author] <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> %&gt; &lt;h1&gt;&lt;%= @author.name %&gt;<span class="hljs-string"><span class="hljs-string">'s posts:&lt;/h1&gt; &lt;%= render @author.posts %&gt; &lt;% end %&gt; &lt;!-- app/views/posts/_post.html.erb --&gt; &lt;% cache ['</span></span>v1<span class="hljs-string"><span class="hljs-string">', post] do %&gt; &lt;div&gt;&lt;%= link_to post.title, post %&gt;&lt;/div&gt; &lt;% end %&gt;</span></span></code> </pre><br>  The problem is that you need to update the keys inside the array every time you want to change the cache fragment.  Thanks to the ‚Äúcache digest‚Äù in Rails 4, you can simply simply omit the array and Rails will automatically generate an MD5 checksum for the cache.  When a file changes, the checksum changes at the same time, resulting in a new ‚Äúcache digest‚Äù. <br>  All of the above can be demonstrated as follows: <br><pre> <code class="ruby hljs">&lt;!-- app/views/authors/show.html.erb --&gt; &lt;% cache @author <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> %&gt; &lt;h1&gt;&lt;%= @author.name %&gt;<span class="hljs-string"><span class="hljs-string">'s posts:&lt;/h1&gt; &lt;%= render @author.posts %&gt; &lt;% end %&gt; &lt;!-- app/views/posts/_post.html.erb --&gt; &lt;% cache post do %&gt; &lt;div&gt;&lt;%= link_to post.title, post %&gt;&lt;/div&gt; &lt;% end %&gt;</span></span></code> </pre><br>  Ryan Bates explains this in more detail in his (free) <a href="http://railscasts.com/episodes/387-cache-digests">screencast</a> , and you can already use this functionality in a Rails 3.2 application using jams <a href="https://github.com/rails/cache_digests">cache_digests</a> . <br><br><h4>  Security </h4><br>  Rails has always tried to follow the security market news and this release is no exception.  However, in order to take advantage of the latest security enhancements and protect yourself and your application, especially when the next vulnerability was discovered, fixed and disclosed, you need to constantly ensure that your Rails application is updated in a timely manner. <br>  We advise you to subscribe to the <a href="https://groups.google.com/forum/%3Ffromgroups">Rails Security</a> newsletter (which comes in extremely rarely) and monitor vulnerabilities, update yourself and test your deployment in the debugging environment every time after publishing a new vulnerability.  Otherwise, you make yourself an excellent target for another script kiddie or bot, walking around the network with a database of known vulnerabilities. <br><br><h5>  Mass Assignment Protection in Controller </h5><br>  Personally, I am glad that mass assignment protection has been transferred to the controller.  This can be done simply by adding object attributes to the black or white list inside the controller.  Take a look at a simple example. <br>  Let's say you create a small web application to accept recipes (culinary).  Anyone who creates a recipe becomes known as ‚Äúchef‚Äù and the recipe has a name, ingredients, and description.  For the sake of efficiency, we will assume that the issues of authorization and authentication have already been resolved. <br><pre> <code class="ruby hljs">&lt;b id=<span class="hljs-string"><span class="hljs-string">"internal-source-marker_0.9843547998461872"</span></span>&gt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecipesController</span></span></span><span class="hljs-class"> &lt; ApplicationController </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">recipe</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Recipe</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">recipe_params</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">recipe</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chef</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">current_user</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># explicitly assign it to the right user if </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@recipe</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.valid? and </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@recipe</span></span></span></span><span class="hljs-class"><span class="hljs-comment">.save redirect_to </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@recipe</span></span></span></span><span class="hljs-class"><span class="hljs-comment">, :flash =&gt; { :notice =&gt; ‚ÄúYour recipe was added to the cookbook. Mmmm, tasty!‚Äù } else render :action =&gt; :new end end private def recipe_params params.require(:recipe).permit(:name, :ingredients, :directions) end&lt;/b&gt;</span></span></span></span></code> </pre><br>  Using this new way of protecting mass assignment, we tell Recipe.new to accept the hash, which the recipe_params method has returned to us, which is the controller's private method.  This method separates all unnecessary, which is not allowed by ‚Äúrecipe‚Äù parameters.  If I wanted to send the following to this controller (represented by the hash): <br>  {name: ‚ÄúTexas Chili‚Äù, ingredients: ‚Äúhot stuff‚Äù, chef_id: ‚Äú123‚Äù} <br>  The ‚Äúchef_id‚Äù parameter would be removed by the recipe_params method, because it is not allowed, and then the ‚Äúsanitized‚Äù hash would be passed to Recipe.new.  This would prevent the arbitrary assignment of a Recipe object to any ‚Äúchef‚Äù (author) that the attacker would select. <br>  This is a solid change compared to how mass assignment was processed in previous versions of Rails.  Instead of pushing these problems into the model, they are now solved inside the controller.  This can be somewhat controversial for a number of reasons. <br>  I remember that I spoke with one of the participants on <a href="http://www.refreshaustin.org/bash/">Austin Web Bash</a> about the differences, where the responsibility of the object‚Äôs behavior lies.  According to the theory of purism, it might be possible to send any information to an object and believe that the object itself knows what to do with it.  This is how mass assignment protection worked in previous versions of Rails with its attr_accessible / attr_protected.  You could transfer any information to the object (tests, live production data via HTTP, etc.) and the object was responsible for its processing. <br>  However, it is a double-edged sword.  Rails is a framework for web applications.  This means that, in fact, information is fed from two channels: the user and the developer.  The developer would be worth believing, but not the user.  Since the only place of attack from the user is the controller, this would be a logical place to protect the information, instead of doing it within the model itself.  In most projects, you will encounter situations that require access through the console or manipulation of information (the same migration).  A set of 'object.method = "foo" hands for different specific properties each time it is needed is a waste of time, turns you into a zombie and kills productivity.  With mass assignment protection in the model, this is what awaits you.  Even in the case of software migrations and tests, there is still a chance of unforeseen problems in the development of testing due to mass assignment of protection at the model level, even if you manipulate information in the backend in a safe way.  By moving these tasks to the controller, we get rid of this problem and at the same time keep the user input clean. <br>  In essence, this is a choice: either more flexible operations with data, monitoring the purity of input using a controller, or less flexible, but with preserving the desired design of the object.  If you still want to use attr_protected / accessible, use the <a href="https://github.com/rails/protected_attributes">protected_attributes</a> jam in your Rails 4 application. <br>  If you want to start using protection at the controller level, take a look at the <a href="https://github.com/rails/strong_parameters">strong_parameters</a> jam, compatible with Rails 3.2.x. <br><br><h5>  Default headers </h5><br>  In Rails 4, an option will be included with which you can specify default headers that will be returned with each response from your application.  If the browser at the other end supports such headers, this will increase the level of security for the end user to work with your application. <br>  In Rails 4, the following headers will be set by default on every response: <br><pre> <code class="ruby hljs">config.action_dispatch.default_headers = { <span class="hljs-string"><span class="hljs-string">'X-Frame-Options'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'SAMEORIGIN'</span></span>, <span class="hljs-string"><span class="hljs-string">'X-XSS-Protection'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1; mode=block'</span></span>, <span class="hljs-string"><span class="hljs-string">'X-Content-Type-Options'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'nosniff'</span></span> }</code> </pre><br>      .        ‚Äî <a href="http://edgeguides.rubyonrails.org/security.html">edge guide on security</a> . <br>        .    -     ,      ,     -.            ,          . <br><br><h5> Encrypted Cookies </h5><br> <a href="https://github.com/rails/rails/pull/8112"></a>     cookies  Rails 4.  ,      session_store    'encrypted_cookie_store'.  session store  cookies   ,  ,      .               . <br>     ,            cookies.    /     SHA,  ,   GPU     <a href="http://www.nvidia.com/object/cuda_home_new.html">CUDA</a> ,     cookie       ,      SHA       , ,   bcrypt.   ,         .        ,       . <br>   ,    cookies     ,  <a href="">   cookies/  Rails 4   </a> . <br><br><h4>      Rails 4? </h4><br>     , ,   ,     Rails 4.0.     4.1. <br><br><h5>   </h5><br> Rails 4       API,  Sidekiq / Resque       .  <a href="https://github.com/rails/rails/commit/f9da785d0b1b22317cfca25c15fb555e9016accb"> </a>        ,   ,      ‚Äú‚Äù. Rafael Franca ,         Rails 4,     ,     . <br><br><h5>  ActionMailer </h5><br>   API c     ,   ActionMailer   ,       ,     API. <br><br><h5> where.like  where.not_like </h5><br>      'not_like'   , , Book.where.not_like(title: ‚Äú%Java%‚Äù),  <a href="https://github.com/rails/rails/commit/8d02afeaee8993bd0fde69687fdd9bf30921e805"> </a>      ActiveRecord. <a href="https://github.com/rails/rails/commit/8d02afeaee8993bd0fde69687fdd9bf30921e805">DHH  </a> ,   , , ,     .  ,       ,  ,     ActiveRecord.         DSL     ‚Äúgreater_than_or_equal‚Äù,            Ruby,   LIKE   -  . <br><br><h4>   </h4><br>  Rails 4     ,      ,     .           Rails 4,    ,      . <br> ,     Rails 2.x,          Rails 2.3.15 (    ),    Rails 3.2.      ,       , ,    ,    3.2         . ,                ,           ( <a href="https://support.cloud.engineyard.com/entries/21009907-clone-an-environment"> </a> )    . <br>   ,    3.2    ,     Rails 4       .    cookie store     mass assignment,       (              ). <br>  , Rails 4       ,     .     , , ,   . <br>   : <br><br> <a href="http://blog.remarkablelabs.com/2012/11/rails-4-countdown-to-2013">blog.remarkablelabs.com/2012/11/rails-4-countdown-to-2013</a> <br> <a href="http://blog.wyeworks.com/2012/11/13/rails-4-compilation-links/">blog.wyeworks.com/2012/11/13/rails-4-compilation-links</a> <br> <a href="http://weblog.rubyonrails.org/2012/11/21/the-people-behind-rails-4/">weblog.rubyonrails.org/2012/11/21/the-people-behind-rails-4</a> <br> <a href="http://edgeguides.rubyonrails.org/4_0_release_notes.html">edgeguides.rubyonrails.org/4_0_release_notes.html</a> <br> <a href="http://rubyrogues.com/081-rr-rails-4-with-aaron-patterson/">rubyrogues.com/081-rr-rails-4-with-aaron-patterson</a> <br> Rails 4 Whirlwind Tour: <a href="http://vimeo.com/51181496">vimeo.com/51181496</a> <br><br>         . <br> <a href="https://blog.engineyard.com/2013/rails-4-changes"> 1</a> , <a href="https://blog.engineyard.com/2013/new-in-rails-4"> 2</a> . <br>  ‚Äî <a href="https://github.com/jaustinhughey">J. Austin Hughey</a> <br>  ‚Äî  <br><br> <i>           ,   <a href="https://blog.engineyard.com/"> </a> .        . <br>      .       ‚Äî    e. !</i> </div><p>Source: <a href="https://habr.com/ru/post/170473/">https://habr.com/ru/post/170473/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../170461/index.html">Introducing OpenGL Interoperability</a></li>
<li><a href="../170463/index.html">Logic - the most interesting news gaming and IT-industry ‚Ññ15</a></li>
<li><a href="../170465/index.html">Course lectures "Startup". Peter Thiel. Stanford 2012. Session 10</a></li>
<li><a href="../170469/index.html">Rainbow Cube - cube with RGB diodes</a></li>
<li><a href="../170471/index.html">AWS: Route53, DNS Failover, Active-Passive</a></li>
<li><a href="../170475/index.html">Rules that the project must meet to publish on Kickstarter</a></li>
<li><a href="../170477/index.html">Are hell customers or hell are we?</a></li>
<li><a href="../170479/index.html">The ‚Äúconsumer‚Äù version of Google Glass will be available later this year.</a></li>
<li><a href="../170483/index.html">Developed a technology to achieve a stable thermonuclear reaction</a></li>
<li><a href="../170485/index.html">Recognition of corridors in the text</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>