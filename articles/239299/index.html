<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RTMFP protocol overview</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day 
 Today I will talk about the wonderful RTMFP broadcast protocol. It implements many interesting approaches and there are a lot of prejudices...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RTMFP protocol overview</h1><div class="post__text post__text-html js-mediator-article"><h4>  Good day </h4><br>  Today I will talk about the wonderful <b>RTMFP</b> broadcast protocol.  It implements many interesting approaches and there are a lot of prejudices about its capabilities.  I want to stir up interest in this topic and dispel existing illusions.  I didn‚Äôt find anything better for broadcasting in real time, and decided to write this post. <br><a name="habracut"></a><br><h4>  Prehistory </h4><br>  <s>Once upon a time in a distant galaxy ...</s> <br>  In 2004, there was <b>Amicima, Inc.</b>  in which the GPL implementation of the <b>MFP</b> - <b>MFPNet</b> protocol was <b>developed</b> .  Then they released <b>amiciPhone</b> - one of Skype‚Äôs competitors, but due to positioning problems, things didn‚Äôt go very well.  In 2007, they were acquired by Adobe because they needed a good real-time broadcast protocol. <br><br><h5>  What's wrong with RTMP? </h5><br>  <b>RTMP is</b> not a real-time broadcast protocol: <br><ul><li>  the problem of minimizing delays is not solved; </li><li>  the broadcast stops when the device address is changed; </li><li>  TCP significantly increases latency and inflates messages with unnecessary delivery checks; </li><li>  no window size control. </li></ul><br>  Given the speed of development of mobile networks, buying Amicima was a rather logical and promising decision. <br><br><h5>  RTMFP Prejudice </h5><br><ol><li><h5>  This is a proprietary protocol. </h5><br>  Adobe decided to publish it in the form of <b><a href="http://tools.ietf.org/html/rfc7016">RFC7016</a></b> in order to warm public attention, but somehow it did.  Oddly enough, this is not like the RTMP specification <s>curve</s> and is more like MFP. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The protocol itself is modular: the exchange of certificates, encryption, synchronization of streams are implemented as a separate profile.  What happens in Flash remains in Flash.  For third-party developers, such as <b><a href="https://github.com/OpenRTMFP/Cumulus">Cumulus</a></b> , Flash remained a black box;  somehow, quietly and unnoticed in April 2014, <b><a href="http://tools.ietf.org/html/draft-thornburgh-rtmfp-flash-06">Adobe's RTMFP Profile for Flash Communication</a></b> came out. <br><br></li><li><h5>  This is UDP - no delivery guarantee. </h5><br>  Quite a lot of real-time protocols use UDP, add network <a href="http://tools.ietf.org/html/rfc1071">checksum</a> and selective delivery checks to guarantee delivery.  They check only what must come, not everything in a row.  For audio / video control of packet delivery does not make more sense.  The window size (MTU) is usually maximum and static, which increases the likelihood of a situation of playing voids and then receiving outdated data when a packet is lost. <br><br></li><li><h5>  We don‚Äôt need RTMFP - we have WebRTC </h5><br>  <b>WebRTC</b> is not a protocol; it is a browser technology ‚Äî an attempt to integrate SIP with an RTP stack into a browser.  If you cross into a bunch of RTP, SRTP, SCTP, RTCP, ZRTP, RTSP - you get RTMFP.  But in some cases, such bundles have redundancy and addressing problems that are not in the RTMFP. <br><br>  RTMFP has both forwarding through NAT, window size control, metadata for the application-controlled flow of redundancy, forwarding / redirect sessions, and its DHT. <br><br>  How many RTP-like protocols do you need to encapsulate in order to implement it all? .. I think there are about 4-5 pieces. <br><br>  The current implementation of broadcasting protocols is reminiscent of the situation: <br><blockquote>  "There are 6 protocols, but they all have a fatal flaw, and we will develop another one ..." <br>  It takes a year. <br>  "There are 7 protocols, and they all have a fatal flaw ..." </blockquote><br>  RTMFP is not an attempt to replace existing solutions.  This is an attempt to generalize them, get rid of redundancy and make it available to users. <br></li></ol><br><h4>  RTMFP and OSI model </h4><br>  So, let's consider what levels of the OSI model the RTMFP protocol covers. <br><br><ul><li><h5>  Physical and channel </h5>  There are no ephemeral energy fluctuations from fluttering butterflies, and I would like to see redundancy through data transmission in warp subspaces. <br><br></li><li><h5>  Network and transport </h5>  These are IP and UDP multicast. <br>  Here and Path MTU discovery and Congestion Control, already in the box, for each stream.  There is a data transfer mode with a selective frequency of delivery check - we check it once in N packets.  All packages have time stamps to measure delivery delays.  Built-in ring hash addressing of DHT type endpoints. <br><br></li><li><h5>  Presentation level </h5>  For Flash, this is, of course, AMF3 and encapsulated RTMP, but you can transfer any other data. <br><br></li><li><h5>  Application layer </h5>  There is support for URIs, netgroups and pub / sub by stream IDs.  Read more in the <a href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/net/NetStream.html">NetStream</a> and <a href="http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/net/NetGroup.html">NetGroup</a> API documentation. <br><br></li></ul><h4>  Security in RTMFP </h4><br><ul><li>  Classic Diffie-Hellman key exchange with static and ephemeral keys. </li><li>  Cookies and certificates in sessions, with the ability to digitally sign packages.  True, by default unsigned packages are considered valid. </li><li>  AES128 is used for encryption, but any other block algorithm can be used. </li><li>  HMAC-SHA256 or network checksums. </li></ul><br>  User authentication and authorization can be implemented by the application.  The issue of filtering malware remains open. <br><br><h4>  Where is the killer function? </h4><br>  I think everyone remembers the <a href="http://habrahabr.ru/post/236905/">failure of the broadcast of the</a> latest presentation of the new <s>pop phone</s> IPhone 6 Plus? <br><br>  So imagine that one client receives an incoming stream and transmits it to two more or more (if possible), and so - as long as the maximum possible delay allows.  At the same time, real-time permutations and sorting occur in the client tree in order to minimize delays and optimize the package window.  As a result, you can achieve a multiple decrease in the outgoing traffic of the broadcast server. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/51b/879/d2a/51b879d2ae6b45a68c713fd8cf45d63b.png"></div><br><br>  And everyone will see him ... <br><br><h4>  Use cases </h4><br><ol><li><h5>  Real-time content broadcast </h5>  Actually, this is the purpose of the protocol itself, and it copes very well with this task. <br>  It can be used not only to transmit audio / video, but also as the main transport in Flash games. <br><br></li><li><h5>  CDN </h5>  This is P2P and to download a file you only need to know its name, hash and size. <br>  You can implement the http2rtmfp gateway ‚Äî the possibilities are quite entertaining. <br><br></li><li><h5>  Video conferences and chats </h5>  In the post-Snowden era, RTMFP is an affordable and secure P2P transport.  Also, the main advantage is the ability to continue broadcasting when changing the network address of the device.  WebRTC may fall off when changing cells in 3G / 4G.  RTP Stack is poorly suited for broadcasting in such an environment. <br><br></li><li><h5>  Transfer of real-time data within private networks </h5>  The main advantage for this use case is the possibility of a flexible routing policy, minimizing delays, optional packet delivery checks, and built-in traffic prioritization tools.  All this can be configured individually for each specific application. <br><br></li></ol><br><h4>  How are things with existing RTMFP solutions? </h4><br>  In short, things are very bad.  To date, of open implementations, there is perhaps Cumulus.  It develops very sluggishly.  It is not based on the RFC, but on the first reverse RTMFP Cirrus 1, so compatibility with the current Flash Profile Cirrus 2 is rather doubtful.  It implements most of the utilities, including the organization of redundancy in P2P and broadcast between devices.  There is FMS, but it works like FMS ... <br><br>  I will be glad to constructive comments. <br><br>  In the comments, please indicate RTMFP analogues, if you know them. </div><p>Source: <a href="https://habr.com/ru/post/239299/">https://habr.com/ru/post/239299/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../239287/index.html">Schneier's Law</a></li>
<li><a href="../239291/index.html">‚ÄúBleed the mind. Inexpensive. Is there any sense of a mask for lucid dreams?</a></li>
<li><a href="../239293/index.html">New free courses virtual academy Microsoft Virtual Academy, October 2014</a></li>
<li><a href="../239295/index.html">The history of the development of Xenonauts - an independent remake of X-COM</a></li>
<li><a href="../239297/index.html">Hey iCloud, where are my notes?</a></li>
<li><a href="../239303/index.html">How not to calculate the matrix exponent</a></li>
<li><a href="../239305/index.html">Exploit source code for ‚Äúunrecoverable‚Äù vulnerability in USB devices published on GitHub</a></li>
<li><a href="../239307/index.html">Festival 404: first impressions</a></li>
<li><a href="../239311/index.html">Linux internal device or how Linux works</a></li>
<li><a href="../239313/index.html">Request to extend the free version of SaaS is a bad sign</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>