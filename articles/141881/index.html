<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Drawing grid graphs of three-dimensional functions and contour lines to them</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article is something like a ‚Äúpractical guide‚Äù for building very interesting three-dimensional graphs of functions of the form z = f (x, y), with a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Drawing grid graphs of three-dimensional functions and contour lines to them</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/77c/fbf/cf0/77cfbfcf091cadb0af9d43ccf225ea81.png"><br>  The article is something like a ‚Äúpractical guide‚Äù for building very interesting three-dimensional graphs of functions of the form z = f (x, y), with an example implementation in C #. <br><a name="habracut"></a><br>  We will draw in the <a href="http://msdn.microsoft.com/en-us/library/system.windows.forms.datavisualization.charting.chart.aspx">Chart</a> component, of course, you can use any canvas-like element.  With a large number of points, there will be delays in drawing, but this component is easy to use and will fit perfectly for demonstration. <br><br><h4>  We build the schedule </h4><br>  To do this, we need a grid or field, each node of which will have x, y coordinates and contain the value of z.  This grid can be filled in any way; once we plot the function, we will fill it with the values ‚Äã‚Äãof this function (z = f (x, y)).  The step between two consecutive x or y values ‚Äã‚Äãis chosen equal to one, for a simpler and more illustrative demonstration, the dimension of the grid is N x N. The values ‚Äã‚Äãin the grid nodes are enough to be read once.  To convert three-dimensional coordinates into two-dimensional ones and to rotate the graph, we will use <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D1%2582%25D1%2580%25D0%25B8%25D1%2586%25D0%25B0_%25D0%25BF%25D0%25BE%25D0%25B2%25D0%25BE%25D1%2580%25D0%25BE%25D1%2582%25D0%25B0">the rotation matrix</a> and <a href="http://ru.wikipedia.org/wiki/%25D0%25A3%25D0%25B3%25D0%25BB%25D1%258B_%25D0%25AD%25D0%25B9%25D0%25BB%25D0%25B5%25D1%2580%25D0%25B0">Euler angles</a> . <br><img src="https://habrastorage.org/getpro/habr/post_images/fa7/e55/3d5/fa7e553d535c8cc3f28e6a4c2301209c.png" alt="image"><br>  Denote the angles Œ±, Œ≤ and Œ≥ by the angles a, b, and c, respectively, and use their values ‚Äã‚Äãin degrees.  We write the matrix in terms of the coefficients: <br><pre>    |  l1, l2, l3 |	
  M = |  m1, m2, m3 |
    |  n1, n2, n3 |
 l1 = cos (a) * cos (c) - cos (b) * sin (a) * sin (c)      
 m1 = sin (a) * cos (c) + cos (b) * cos (a) * sin (c)       
 n1 = sin (b) * sin (c)       
 l2 = -cos (a) * sin (c) + cos (b) * sin (a) * cos (c)        
 m2 = -sin (a) * sin (c) + cos (b) * cos (a) * cos (c)      
 n2 = sin (b) * cos (c)
 l3 = sin (b) * sin (a)
 m3 = -sin (b) * cos (a)       
 n3 = cos (b)
</pre><br>  We write the final transformation from three-dimensional coordinates into two-dimensional: <br>  X = l <sub>1</sub> x + l <sub>2</sub> y + l <sub>3</sub> z <br>  Y = m <sub>1</sub> x + m <sub>2</sub> y + m <sub>3</sub> z <br>  x, y, z are the ‚Äúinternal‚Äù coordinates for the graph, X, Y are the final screen coordinates.  We will not need the coefficients n1, n2 and n3 for this task. <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[,] a; <span class="hljs-comment"><span class="hljs-comment">//  N x N ‚Ä¶ double X, Y; //      x for (int x = 0; x &lt; N; x++) { for (int y = 0; y &lt; N; y++) { X = l1() * (x - N / 2.0) + l2() * (y - N / 2.0) + l3() * a[x, y]; Y = m1() * (x - N / 2.0) + m2() * (y - N / 2.0) + m3() * a[x, y]; chart1.Series[n].Points.AddXY(X, Y); } n++; } //      y for (int y = 0; y &lt; N; y++) { for (int x = 0; x &lt; N; x++) { X = l1() * (x - N / 2.0) + l2() * (y - N / 2.0) + l3() * a[x, y]; Y = m1() * (x - N / 2.0) + m2() * (y - N / 2.0) + m3() * a[x, y]; chart1.Series[n].Points.AddXY(X, Y); } n++; }</span></span></code> </pre> <br>  Add events at which the angles will change and the graph will rotate.  For example, it will move the cursor while holding the left mouse button and change the angles b and c: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> onmove = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; Point startpos; ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chart1_MouseDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, MouseEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Button == MouseButtons.Left) { onmove = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; startpos = e.Location; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chart1_MouseMove</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, MouseEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (onmove) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((startpos.Y - eY) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) b--; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((startpos.Y - eY) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) b++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((startpos.X - eX) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) c--; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((startpos.X - eX) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) c++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b &gt; <span class="hljs-number"><span class="hljs-number">359</span></span>) b = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &gt; <span class="hljs-number"><span class="hljs-number">359</span></span>) c = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) b = <span class="hljs-number"><span class="hljs-number">359</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) c = <span class="hljs-number"><span class="hljs-number">359</span></span>; drawscene(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chart1_MouseUp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, MouseEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.Button == MouseButtons.Left) onmove = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  Check on the test function z = x <sup>2</sup> + y <sup>2</sup> : <br><img src="http://habrastorage.org/storage2/4d4/9fe/fea/4d49fefeae956077f66776994ec44a2a.png"><br>  <i>A top view of the function where you can see that same grid and show the values ‚Äã‚Äãin the nodes.</i> <br><img src="http://habrastorage.org/storage2/a7b/4dc/d5d/a7b4dcd5ddfb13d3234b944726985d37.png"><br>  <i>View of the function at an angle.</i> <br>  It may be worthwhile to change the angles in a different way, while rotating using all 3 angles and using the grid in increments of less than 1, but we have simplified the situation. <br><br><h4>  Building isolines </h4><br>  We use the <a href="http://ru.wikipedia.org/wiki/Marching_squares">Moving Squares</a> algorithm (‚ÄúMarching squares‚Äù), a fairly detailed description is given on Wikipedia.  Google also gives a <a href="http://devblog.phillipspiess.com/2010/02/23/better-know-an-algorithm-1-marching-squares/">very good article</a> , which describes this algorithm and is implemented in C #. <br>  The essence briefly: <br>  1. It is required to find the initial position - where the isoline will go. <br>  2. Then compare the values ‚Äã‚Äãin the adjacent grid nodes that form a square with the vertices: (x <sub>i</sub> , y <sub>j</sub> ), (x <sub>i-1</sub> , y <sub>j</sub> ), (x <sub>i</sub> , y <sub>j-1</sub> ), (x <sub>i-1</sub> , y <sub>j-1</sub> ). <br><img src="http://habrastorage.org/storage2/c2e/e55/d74/c2ee55d74a2f0dd7b46ad4fb718c402e.png"><br>  3. Select the further direction of the bypass, depending on the value obtained in step 2, and proceed to the next point, in which again do step 2. <br>  4. Perform until we get back to the starting position or reach the edge of the grid. <br>  There can be a total of 16 options: <br><img src="http://devblog.phillipspiess.com/wp-content/uploads/2010/02/MarchingStates.png" alt="image"><br>  Let's not write all the code again, take a part of the code from <a href="http://devblog.phillipspiess.com/2010/02/23/better-know-an-algorithm-1-marching-squares/">that article</a> and change it for our task: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> dir { None, Up, Left, Down, Right } dir prevStep; dir nextStep; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> border; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> startx, starty; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findstartpos</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; N; y++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; N; x++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arr[x, y] &lt; Z) { startx = x; starty = y; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x == N - <span class="hljs-number"><span class="hljs-number">1</span></span> || y == N - <span class="hljs-number"><span class="hljs-number">1</span></span> || x == <span class="hljs-number"><span class="hljs-number">0</span></span> || y == <span class="hljs-number"><span class="hljs-number">0</span></span>) border = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || x &gt;= N || y &gt;= N) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arr[x, y] &lt; Z) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ul = check(x - <span class="hljs-number"><span class="hljs-number">1</span></span>, y - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ur = check(x, y - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> dl = check(x - <span class="hljs-number"><span class="hljs-number">1</span></span>, y); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> dr = check(x, y); prevStep = nextStep; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> state = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ul) state |= <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ur) state |= <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dl) state |= <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dr) state |= <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (state) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: nextStep = dir.Down; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: nextStep = dir.Right; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: nextStep = dir.Right; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: nextStep = dir.Left; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>: nextStep = dir.Down; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevStep == dir.Down) { nextStep = dir.Left; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { nextStep = dir.Right; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>: nextStep = dir.Right; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>: nextStep = dir.Up; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevStep == dir.Right) { nextStep = dir.Down; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { nextStep = dir.Up; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>: nextStep = dir.Up; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>: nextStep = dir.Up; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span>: nextStep = dir.Left; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>: nextStep = dir.Down; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>: nextStep = dir.Left; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: nextStep = dir.None; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br>  Let us try again on our test function z = x <sup>2</sup> + y <sup>2</sup> : <br><img src="http://habrastorage.org/storage2/5ac/5eb/294/5ac5eb2941c42c267d3974762a678438.png"><br>  As can be seen in the picture, the algorithm quite successfully coped and separated the points where the value of the function is higher than 5, but slightly to the right and higher.  The isoline is angular, so we interpolate.  The meaning of interpolation is that, based on the values ‚Äã‚Äãof z in the adjacent grid nodes, we compute a closer value of x, or y, to the real contour, which makes the contour more plausible. <br>  We will use the linear interpolation formula: <br>  x = (Zf (x <sub>i-1</sub> , y <sub>j</sub> ) / (f (x <sub>i</sub> , y <sub>j</sub> ) -f (x <sub>i-1</sub> , y <sub>j</sub> )) + x <sub>i-1</sub> , <br>  y = (Zf (x <sub>i</sub> , y <sub>j-1</sub> ) / (f (x <sub>i</sub> , y <sub>j</sub> ) -f (x <sub>i</sub> , y <sub>j-1</sub> )) + y <sub>j-1</sub> , <br>  where Z is the value on which you want to isoline. <br>  Interpolation on the x coordinate, or on the y coordinate, is selected depending on the direction of motion for the previous and next steps. <br>  Let's write for this such not very good code: <br><pre> <code class="cs hljs">... List&lt;PointF&gt; res; ... <span class="hljs-comment"><span class="hljs-comment">//  x  y int dx = 0, dy = 0; switch (prevStep) { case dir.Down: dy = 1; break; case dir.Left: dx = 1;break; case dir.Up: dy = -1; break; case dir.Right: dx = -1; break; default: break; } ... double X = x0 + x; double Y = y0 + y; if (ip) //ip - interpolation { //    if (dx != 0 &amp;&amp; prevStep == nextStep) Y = y0 + y + (Z - a[x, y - 1]) / (a[x, y] - a[x, y - 1]) - 1; if (dy != 0 &amp;&amp; prevStep == nextStep) X = x0 + x + (Z - a[x - 1, y]) / (a[x, y] - a[x - 1, y]) - 1; //    if (nextStep == dir.Down &amp;&amp; prevStep == dir.Left) Y = y0 + y + (Z - a[x, y - 1]) / (a[x, y] - a[x, y - 1]) - 1; if (nextStep == dir.Left &amp;&amp; prevStep == dir.Down) X = x0 + x + (Z - a[x - 1, y]) / (a[x, y] - a[x - 1, y]) - 1; if (nextStep == dir.Up &amp;&amp; prevStep == dir.Right) X = x0 + x + (Z - a[x - 1, y]) / (a[x, y] - a[x - 1, y]) - 1; if (nextStep == dir.Up &amp;&amp; prevStep == dir.Left) X = x0 + x + (Z - a[x - 1, y]) / (a[x, y] - a[x - 1, y]) - 1; if (nextStep == dir.Right &amp;&amp; prevStep == dir.Up) Y = y0 + y + (Z - a[x, y - 1]) / (a[x, y] - a[x, y - 1]) - 1; if (nextStep == dir.Right &amp;&amp; prevStep == dir.Down) X = x0 + x + (Z - a[x - 1, y]) / (a[x, y] - a[x - 1, y]) - 1; // ""  if (!(nextStep == dir.Down &amp;&amp; prevStep == dir.Right) &amp;&amp; !(nextStep == dir.Left &amp;&amp; prevStep == dir.Up)) res.Add(new PointF((float)X, (float)Y)); } ...</span></span></code> </pre><br>  And we get a result that suits us more: <br><img src="http://habrastorage.org/storage2/c40/1d7/abf/c401d7abffac8241446d8e68b5141c20.png"><br><img src="http://habrastorage.org/storage2/6cb/b8b/3f2/6cbb8b3f25acb3a00feb1775e38bc0ee.png"><br>  <i>An example of "unnecessary points" that we have excluded.</i> <br>  Of the possible improvements, it should be noted that our implementation will build all isolines only for monotonically increasing (for decreasing ones, the sign should be changed to ‚Äú&gt;‚Äù) functions.  For functions that periodically increase and decrease, it is necessary to change, for example, the function of finding the initial position and perform it several times. <br><img src="http://habrastorage.org/storage2/ba9/ce3/301/ba9ce3301ce9f7567a2e978ee9068183.png"><br>  <i>An example of the final program.</i> <br>  In practice, this can be used to analyze maps, or to search for the contour in the image. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The source code of the program can be downloaded <a href="http://narod.ru/disk/45760351001.6ac3b489e8c920a3091f7610505ed0b8/masq-demo.zip.html">here</a> or <a href="http://rghost.ru/37520611">here</a> . <br>  Once again the links that were used: <br>  <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D1%2582%25D1%2580%25D0%25B8%25D1%2586%25D0%25B0_%25D0%25BF%25D0%25BE%25D0%25B2%25D0%25BE%25D1%2580%25D0%25BE%25D1%2582%25D0%25B0">ru.wikipedia.org/wiki/Matrix_turn</a> <br>  <a href="http://ru.wikipedia.org/wiki/%25D0%25A3%25D0%25B3%25D0%25BB%25D1%258B_%25D0%25AD%25D0%25B9%25D0%25BB%25D0%25B5%25D1%2580%25D0%25B0">ru.wikipedia.org/wiki/Ugly_Eyler</a> <br>  <a href="http://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BF%25D0%25BE%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F">ru.wikipedia.org/wiki/ Interpolation</a> <br>  <a href="http://ru.wikipedia.org/wiki/Marching_squares">ru.wikipedia.org/wiki/Marching_squares</a> <br>  <a href="http://devblog.phillipspiess.com/2010/02/23/better-know-an-algorithm-1-marching-squares/">devblog.phillipspiess.com/2010/02/23/better-know-an-algorithm-1-marching-squares</a> </div><p>Source: <a href="https://habr.com/ru/post/141881/">https://habr.com/ru/post/141881/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141876/index.html">OpenStreetMap: Three New Governing Licensing Agreements</a></li>
<li><a href="../141877/index.html">Information technology and dissertation system reform</a></li>
<li><a href="../141878/index.html">Moscow.com - the most expensive non-Latin domain</a></li>
<li><a href="../141879/index.html">Russian-German student school JASS-2012. Impressions</a></li>
<li><a href="../141880/index.html">Without knowing the ford, do not go into the water. Part three</a></li>
<li><a href="../141882/index.html">Car open source</a></li>
<li><a href="../141883/index.html">Github has included the DCPU-16 assembler in the list of officially supported languages.</a></li>
<li><a href="../141884/index.html">Pomatrosil and quit: Google sells Motorola</a></li>
<li><a href="../141885/index.html">The perfect Android player for non-music</a></li>
<li><a href="../141886/index.html">TOP-3 Hi-tech: Fashionable Gadgets for Pets</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>