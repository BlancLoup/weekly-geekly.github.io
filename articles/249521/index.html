<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>T4 to help with the example of MVVM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The purpose of the article: to give a couple of ideas for automation, and maybe even a working tool for creating T4-pigs for solving typical problems ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>T4 to help with the example of MVVM</h1><div class="post__text post__text-html js-mediator-article">  The purpose of the article: to give a couple of ideas for automation, and maybe even a working tool for creating T4-pigs for solving typical problems produced with classes / interfaces in work. <a name="habracut"></a><br>  It‚Äôs a little concrete: there are some very simple, well-algorithmized, everyday tasks - from the DTO-class to write Model, from Model - ViewModel, sample Tests or object transformation to Json.  Tasks that fall perfectly on the mechanisms of T4, but which are long or inconvenient to use.  The developer usually stands at a crossroads: complete the task or write a script, which, <i>perhaps</i> , will help to accomplish it. <br>  Sometimes the script seems too complicated, sometimes the person is stopped by the idea that the script is in fact not a functional part of the project, but a script one-time.  And comparing the complexity of the linear problem with the unexplained - the developer often refuses the second way.  But the more experience he has, the less he likes linear work.  And the question arises - how to convey the possibilities of T4 for the whole team, not <b>forcing</b> it to penetrate, but <i>providing an</i> opportunity to penetrate.  At the same time, support should be minimal.  Regular T4 scripts need support (to be used again, it should be dragged along with the developer for the projects, at some point should be ‚Äúfiled‚Äù for a specific task).  And this one wants to avoid. <br><br>  Ideally, I suppose, the process should consist of pressing a magic button that generates the necessary blank automatically, depending on the required scenario.  And its developer can quickly modify it to practical applicability in the context of a specific situation.  Those.  in fact, I propose to work on the disadvantages of using code generation scripts.  Quality and time as the main criteria, because all the <i>"magic"</i> can be divided into 3 components: <br><br><ul><li>  Template generation of a separate script. </li><li>  Easy integration into the development process. </li><li>  Validation of the result. </li></ul><br>  Now in order: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Part 1. T4 dream generation. </h4><br><br>  The easiest way is to show the whole process on a specific task.  MVVM, the journey of an entity from a service object to a top level object. <br><br>  Often this happens, most of the DTO object falls into the model with minimally simple changes.  The object of the transport layer does not carry any logic, only data - and the model in the minimum version must at least copy some of its properties, imposing access rights to them.  If we apply this to the MVVM layers, this is expressed in the transformation: <br><br><img src="https://habrastorage.org/files/754/47a/bca/75447abca5a84249b10b92a00dd32de1.png" alt="image"><br><br>  Total 2 transformations.  At the output of the first transformation, the decision must be refined by man, introducing logic.  Then another transformation, creating a higher step. <br>  I think <b>CopyType *</b> + <b>AutoMapper</b> can provide similar functionality.  Aspects can help (for the implementation of standard reactions).  And in simple cases it is better to use them.  But, my personal opinion, if mapping ceases to be trivial, or debugging turns into Code Hell - it is necessary to simplify objects, working primarily on improving the readability of the code and the mechanisms that hide important functionality under the hood here are bad helpers.  Again, this is IMHO. <br><br>  For such simple transformations, you need the help of the <a href="https://visualstudiogallery.msdn.microsoft.com/791817a4-eb9a-4000-9c85-972cc60fd5aa">T4 toolbox</a> (thanks to <b>Oleg V. Sych</b> ) and the script, which in the primitive is the following: <br><br><img src="https://habrastorage.org/files/3b2/e48/11f/3b2e4811fe47417992647eb50aa416d7.png"><br><br>  Simple, but there are a few " <i>bad</i> " moments to use. <br><br>  1. To use the CodeElement / CodeClass / CodeProperty type, you should leave a reference to the EnvDTE library at the place of use, which is not combined with the project's needs (the library belongs to the VisualStudio environment, it will be very strange to add and clean up the links). <br>  2. The source for conversion by this script must be specified explicitly. <br>  3. In general, the issue with the availability of fields in the generated code is not solved.  But, to tell the truth, I never decided this question, having given it to the developers, judging that it was easier to erase setters than to make an accessibility scheme for each type.  This saves a lot of time, simplifies the script, but reduces the quality of the output. <br><br>  We can fix the first two shortcomings by going to the second part: <br><br><h4>  Part 2. Integration into the development process. </h4><br><br>  You can integrate into the development process painlessly with the help of several tools.  It would be very nice to use something like the Resharper context menu, which on a specific class gives a drop-down list of possible scripts, but I have not found a way to create such a plugin, I will be glad if someone tells.  However, the plug-in to the studio itself is quite realistic. <br><br>  To do this, you will need to install the Visual Studio SDK and a little time in order to figure out how to integrate into the IDE from Microsoft. <br>  The Wizard does most of the work, so I‚Äôll not cover this process, but I‚Äôll focus on 2 important files: .vsct and MenuCommandsPackage. <br><br>  In the first one, it is necessary to describe the flat menu building structure in xml format, where each button is represented as: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">guid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"guidMenuAndCommandsCmdSet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"cmdCommand9"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">priority</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0x309"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Button"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Parent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">guid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"guidMenuAndCommandsCmdSet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MyMenuGroup"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CommandFlag</span></span></span><span class="hljs-tag">&gt;</span></span>DynamicVisibility<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CommandFlag</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CommandFlag</span></span></span><span class="hljs-tag">&gt;</span></span>DefaultInvisible<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CommandFlag</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CommandFlag</span></span></span><span class="hljs-tag">&gt;</span></span>TextChanges<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CommandFlag</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Strings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ButtonText</span></span></span><span class="hljs-tag">&gt;</span></span>T4 Command<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ButtonText</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Strings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Those.  In .vsct, we describe the maximum number of possible menu items (hereinafter referred to as <i>slots</i> ) into which we will ‚Äúinsert‚Äù the transformation files.  Since  At the stage of installing the plug-in, we do not know how many scripts we actually need, take them N and make them invisible.  And now in the MenuCommandsPackage by the number of scripts we form teams, assign slots to them and display: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; index &lt; files.Length; index++) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> file = files[index]; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CommandID(GuidList.guidMenuAndCommandsCmdSet, _slots[index]); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> command = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DynamicScriptCommand(id, file, GetCurrentClassFileName, OutputCommandString) { Visible = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; mcs.AddCommand(command); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception exception) { OutputCommandString(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Can't add t4 file {0}. Exception: {1}"</span></span>, file, exception.GetType())); } }</code> </pre><br><br>  Thus, in the Menu, at each launch, the number of scripts is inserted, which is in the Package Environment.ScriptDirectoryFullPath folder (up to N) and the button that opens this folder. <br>  The scripts are read in realTime so they can be edited and immediately applied. <br><div class="spoiler">  <b class="spoiler_title">on practice...</b> <div class="spoiler_text">  ... it is better to have in addition to the constantly used scripts one template in txt format and one .tt, which can be freely edited at any time and run with any content. <br></div></div><br>  Template is: <br><br><img src="//habrastorage.org/files/308/c39/b79/308c39b799ac4dc390a7a6f68722a569.png"><br>  a stub in which all supported parameters that a plugin in the studio can find on the current open file and provide them as input parameters to the script (for partial classes) are set in advance. <br>  The entire output from the transformation (warnings and errors) is redirected to the studio output, and the result of the transformation itself is transferred to the clipboard.  In fact, the possibilities make it possible to add them to the project, but for an abstract conversion task this may not be appropriate, although it is probably worth throwing into separate files.  Well, the buffer, my personal opinion, is just a neutral territory. <br><br>  Thus, we got rid of the direct referense on EnvDTE inside the project, hooking up scripted scripts to the IDE and provided a minimally convenient interaction interface. <br><br><h4>  Part 3. Validation of the result. </h4><br><br>  It should be understood that the meaning of this extension is to do not work, but a blank for work.  The quality of this disc can vary greatly depending on the task and the script. <br>  Scripts, over time, will stitch to the task, improving the output, up to the code compiled with the move.  But the minimum condition of use is at least time savings.  Those.  costs to write yourself without T4, should be more than applied and applied.  Well, the plugin is only a small assistant in this business, which slightly reduces the <i>‚Äúprice‚Äù of</i> T4. <br><br>  Sources on Github: <br>  <a href="http://github.com/ArheusLis/CodeGenerationExtention">CodeGenerationExtention</a> <br>  Useful links: <br>  <a href="http://www.codeproject.com/Articles/184031/Declarative-Codesnippet-Automation-with-T-Templat">Declarative Codesnippet Automation with T4 Templates</a> <br>  <a href="http://www.codeproject.com/Articles/42036/Project-Metadata-Generation-using-T">Project Metadata Generation using T4</a> <br><br>  <b>CopyType *</b> is a ReSharper feature. It simply creates a duplicate of the type. </div><p>Source: <a href="https://habr.com/ru/post/249521/">https://habr.com/ru/post/249521/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249509/index.html">GPS control for personal use (Conclusion)</a></li>
<li><a href="../249511/index.html">Acronis True Image (for Windows) usage example for Mac computers</a></li>
<li><a href="../249513/index.html">Vulnerability on the site Dom.ru, allowing to obtain personal customer data</a></li>
<li><a href="../249515/index.html">ssh: We pull out a foreign port for ourselves because of NAT</a></li>
<li><a href="../249517/index.html">How my cat stopped being afraid and fell in love with Arduino</a></li>
<li><a href="../249523/index.html">Continuous Delivery: Continued</a></li>
<li><a href="../249525/index.html">Javascript errors and how to fix them</a></li>
<li><a href="../249527/index.html">[mind map] 462 useful questions for all occasions</a></li>
<li><a href="../249529/index.html">Free SSL certificates for 2 years with support for up to 100 domains</a></li>
<li><a href="../249531/index.html">Tracker emotional stress Emvio. Video of the working prototype</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>