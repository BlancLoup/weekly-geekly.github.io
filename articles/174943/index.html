<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating an interactive office map, part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last summer, we talked about our attempt to facilitate the orientation process in the office, which resulted in the creation of a map where you can se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating an interactive office map, part 2</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/pt/blog/174943/"><img src="https://habrastorage.org/storage2/82d/dd2/a0f/82ddd2a0f91388691c657fd581f8d82c.png" align="left"></a>  Last summer, we <a href="http://habrahabr.ru/company/pt/blog/149481/">talked</a> about our attempt to facilitate the orientation process in the office, which resulted in the creation of a map where you can see the location of all the company's employees.  Since then, we moved to a new office, so (well, because I wanted to do everything even better), it was decided to redesign the map taking into account the accumulated experience. <br><br>  We briefly recall why we even needed to create a map of our office.  Our company has been developing quite rapidly in recent years, and the number of employees is constantly increasing (now we have more than 300 people).  Accordingly, finding a colleague you need among so many people is not easy, and using a map you can easily find out exactly where he is sitting in the office.  Often it is necessary to solve the inverse problem: it happens that visually a person is familiar, and the location of his workplace is known, but neither the name nor the email address can be remembered.  This data can be obtained by clicking on the desired table on the map. <a name="habracut"></a><br><br><h4>  It was -&gt; became </h4><br>  In general, the map was redone a little more than completely.  This was facilitated not only by the desire of developers to improve those moments that have long been an improvement, but also some technical and legal aspects, which will be discussed below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  New engine </h5><br>  The old version of the map was well scaled and, in principle, nothing prevented us from using it after the move.  However, in the comments to the previous article, we were <a href="http://habrahabr.ru/company/pt/blog/149481/">told</a> that the Yandex.Maps API user agreement, on the basis of which the previous version worked, cannot be used as we did.  Yandex support confirmed this fact, and - since we are law-abiding people - it was decided to ‚Äúmove‚Äù from Yandex maps to the open source <a href="http://leafletjs.com/">Leaflet</a> map display engine. <br><br>  By the way, in the actual at that time version of Leaflet 0.4.3 there was no flat projection we needed, and we had to implement it on our own.  In the current version 0.5, this functionality is present, but the coordinates are calculated a little differently from ours.  Therefore, our map is still working on an older version of the engine. <br><br>  In the comments to the previous post, we were also advised to pay attention to several other graphics engine options (right up to Planner 5D), but nevertheless won Leaflet, with a small margin ahead of <a href="http://openlayers.org/">OpenLayers</a> . <br><br>  The main difficulty in developing a new map was the export of tables (that is, the data that represent them) from AutoCAD to the database.  On the one hand, it was not mandatory, because you can simply arrange the tables immediately on the map.  But on the other hand, since the tables do not stand smoothly, but who turned where, they would have had to manually ‚Äútwirl‚Äù a bunch of tables, which I didn‚Äôt want to do. <br><br>  As a result, a scheme was implemented that works as follows: <br><br><ol><li>  In AutoCAD, tables moved to a separate layer. </li><li>  This layer was processed by a special Lisp script (we found it on the Internet; just in case, <a href="">here it is</a> ), which exported the data in its own format. </li><li>  Further, these data came in as input to a python script (it was easier to deal with it), which translated them into an SQL insert script into the database.  At the same stage, there was a recalculation of the table correspondence coordinates from AutoCAD terms, to Leaflet terms. </li></ol><br>  If it was necessary to "finish" some objects that were not originally (negotiation, etc.), then the scheme was repeated: creating an object in an autocade ‚Üí moving it to a separate layer ‚Üí exporting data using a lispovy script ‚Üí converting to SQL ‚Üí inserting into a database . <br><br>  As a result, the appearance of the map has changed. <br><br>  It was: <br><br><img src="https://habrastorage.org/storage2/049/9d3/e55/0499d3e556d9a159a50bf94fc074fc31.png"><br><br>  It became: <br><img src="https://habrastorage.org/storage2/20a/78e/0f8/20a78e0f8b9034abdbc6b5c2b7ab822f.png"><br><br>  The map is located on the intranet portal of the company with which its data is synchronized according to the schedule. <br><br><h5>  Relocation of employees </h5><br>  In the previous version of the card, in order to ‚Äútransplant‚Äù an employee, it was necessary to physically move the tables on the map with the mouse, and there was no possibility of reassigning the employee to a specific table.  In other words, it was impossible the situation when the table remains in place, and only the employee who sits behind him changes.  At that stage, it was only important for us to find out the most important thing: whether people need a card, whether they will use it, so we made everything as simple as possible. <br><br>  In principle, there is nothing wrong with that, but only the developer could perform the copying of the table.  Considering that the mission of maintaining the relevance of the card was planned to be entrusted to the personnel department, it was necessary to simplify the process of working with the card as much as possible: the company employs 300 people who periodically move from place to place and track all these movements without that easy. <br><br>  As a result, now the personnel department employees need only click on the table on the map and select from the drop-down list the employee who will sit behind him. <br><br><img src="https://habrastorage.org/storage2/37b/6e4/433/37b6e4433b50b47982a249a56ec107ed.png"><br><br><h5>  Introducing Custom Roles </h5><br>  Another innovation - login when working with the card.  The previous version was static, which made the use of authentication impossible.  The current version of the card is an MVC application that allows you to implement functions specific to the server application (access rights, ‚Äútransplanting‚Äù, ‚Äúfinding my desk‚Äù, etc.). <br><br>  For authentication, we use the NTLM mechanism built into ASP.NET and an uncomplicated samopisnuyu role system that allows you to specify groups directly in the application configuration. <br><br><img src="https://habrastorage.org/storage2/ba5/13b/fbd/ba513bfbd6a7ca1b411b62cb6aac64c1.png"><br><br>  Now, by the way, there is no possibility of drawing new tables on the map.  Due to the fact that there are more tables in the new office than employees and the organization of new jobs is not planned for a while, this function will not be required for some time.  Although the thing, of course, necessary, and we are going to implement it in the future. <br><br><h4>  Plans </h4><br>  Most recently, we conducted a survey among colleagues, as a result of which we managed to collect a large number of ideas.  Among them were original proposals, for example, to photograph the entire office and make a panorama of it (like Google Street View), so that you can make virtual walks around the office, but so far the expediency of this innovation is put into question by map developers :). <br><br>  In addition, the plans include: <br><br><ul><li>  Realization of the possibility of booking a table by the staff of the personnel department for a new employee in advance, while he has not yet come to work and has not yet opened an account in Active Directory. </li><li>  Implementation of the possibility of drawing tables on the map (can be done using <a href="">https://github.com/Leaflet/Leaflet.draw</a> ). </li><li>  Add printers, first aid kits and other potentially necessary objects.  The first steps in this direction have already been taken: meeting rooms, telephone booths, a library, and a wall for drawing with a marker appeared on the map. </li></ul><br>  There are other ideas of varying degrees of elaboration and necessity: layers on the map (for example, with the same printers and other office equipment) or integration with MS Exchange (when clicking on a conversation, show when and by whom it is busy and when it is free, when clicking on employee to display scheduled meetings from the calendar).  In the future, perhaps we will implement some of this. <br><br><h4>  Demo </h4><br>  In the comments to the last article we were asked to show, in fact, the map itself.  We managed to make a <a href="http://ptmapdemo.azurewebsites.net/">demo</a> , but considering that this is still an internal project of the company, located on the intranet and not accessible from the outside, the functionality of the public version is limited. <br><br>  <b>UPD</b> : Laid out the <a href="https://github.com/mikeozornin/positive-office-map">source</a> . <br><br>  We will be happy to answer questions in the comments.  Always yours, <a href="http://habrahabr.ru/users/mikeozornin/" class="user_link">MikeOzornin</a> and <a href="http://habrahabr.ru/users/evgekon/" class="user_link">evgekon</a> map developers </div><p>Source: <a href="https://habr.com/ru/post/174943/">https://habr.com/ru/post/174943/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../174929/index.html">The most powerful supercomputer in 2009 gives way to a new generation</a></li>
<li><a href="../174935/index.html">April Fool's CSS Snippets</a></li>
<li><a href="../174937/index.html">AT & T banned obscene passwords</a></li>
<li><a href="../174939/index.html">Technological Singularity Party</a></li>
<li><a href="../174941/index.html">The fourth round of the voting contest Windows Phone Next App Star</a></li>
<li><a href="../174945/index.html">Towards a seamless (HA) open cloud: an introduction to using OpenStack in commercial installations</a></li>
<li><a href="../174957/index.html">What is being a good developer?</a></li>
<li><a href="../174961/index.html">Russian version of "Developer Economics 2013"</a></li>
<li><a href="../174963/index.html">How would I like to see my first symfony project</a></li>
<li><a href="../174965/index.html">25-dollar Raspberry Pi went on sale in the USA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>