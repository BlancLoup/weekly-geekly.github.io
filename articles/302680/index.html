<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Combining 3CX Phone System with Asterisk (FreePBX)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we will explain how to combine the 3CX Phone System v14 and Asterisk FreePBX v13 systems. We will proceed from the fact that both sys...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Combining 3CX Phone System with Asterisk (FreePBX)</h1><div class="post__text post__text-html js-mediator-article">  In this article, we will explain how to combine the 3CX Phone System v14 and Asterisk FreePBX v13 systems.  We will proceed from the fact that both systems are in the same local area network.  If you have any questions or suggestions for improving integration, you can ask them in a <a href="http://www.3cx.com/forums/bridging-3cx-with-an-asterisk-pbx-44726.html">special section of our forum</a> . <a name="habracut"></a><br><br><h2>  Configure 3CX Phone System </h2><br>  In the 3CX Management Console, add a new 3CX trunk in the <b>Bridges</b> section <b>-</b> <b>Add Bridge</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0d1/2bd/107/0d12bd1077b09dc5721b5fa03404150a.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  3CX trunk options </h3><br><ul><li>  <strong>Virtual extension number</strong> - leave the value assigned by the system, or specify another 5-digit <b>Bridge ID</b> .  Fix the <strong>Bridge ID</strong> and do not change it, because  It is used further. </li><li>  <strong>Name of Bridge</strong> - name the trunk as you like.  Typically, the name displays the direction of calls, for example, <strong>To-Asterisk</strong> . </li><li>  <strong>Type of 3CX Bridge -</strong> set the type of trunk to <strong>Master</strong> . </li><li>  <strong>Outbound rule prefix to reach remote 3CX PBX</strong> - if you want to use the prefix for calls to the Asterisk system, specify it.  However, we recommend to pre-define the numbering plan so that users make a direct dial, i.e.  without prefixes.  In this case, the prefix should not be specified (and typed). </li><li>  <strong>Authentication Password</strong> - the system automatically generates a complex 8-character <b>Bridge Password Password</b> .  Fix the <strong>Bridge Password</strong> and do not change it, because  It is used further. </li><li>  <strong>Assigned Codecs</strong> - voice codecs used for this trunk.  The default is the GSM-FR codec, however you can add other codecs and determine their priority.  Please note that the codecs you added must be supported by Asterisk.  We recommend using the G722 broadband codec and assign it the highest priority so that the system tries to use it before others. </li></ul><br>  The remaining parameters: <strong>Allow tuned connection</strong> , <strong>Publish information</strong> , <strong>Receive information</strong> , <strong>Supports Re-Invite</strong> , <strong>Support Replaces</strong> , <strong>PBX Delivers Audio,</strong> leave the default. <br>  After clicking the <strong>Next</strong> button, the interface for creating an outgoing rule on Asterisk will appear.  Setting outgoing rules is detailed <a href="http://www.3cx.ru/docs/trunk-management/">here</a> . <br><br><h2>  Configure Asterisk </h2><br>  On the Asterisk system, create an outgoing trunk with the following parameters: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/573/eb9/d89/573eb9d8967179b77ac32f158f8b028a.png"><br><br>  <strong>Outgoing - Trunk name</strong> : 3CX Bridge Outgoing <br><br>  <strong>Outgoing - PEER Details:</strong> <br><br>  host = [3CX IP] <br><br>  port = [3CX SIP Port] <br><br>  username = [3CX Bridge ID] <br><br>  fromuser = [3CX Bridge ID] <br><br>  secret = [3CX Bridge Password] <br><br>  sendrpid = yes <br><br>  qualify = yes <br><br>  type = peer <br><br>  And the incoming trunk: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca2/ee9/04f/ca2ee904f5d6b5b96f4eebbba16a4c64.png"><br><br>  <strong>Incoming - USER Details:</strong> <br><br>  host = [3CX IP] <br><br>  port = [3CX SIP Port] <br><br>  type = peer <br><br>  trustrpid = yes <br><br>  context = from-trunk <br><br>  <strong>Incoming - Register String:</strong> <br><br>  [3CX Bridge ID]: [3CX Bridge Password] @ [3CX IP]: [3CX SIP Port] / [3CX Bridge ID] <br><br><h3>  Trunk Parameters </h3><br><ul><li>  <strong>3CX Bridge ID</strong> - Virtual extension number that was installed when creating the 3CX trunk. </li><li>  <strong>3CX Bridge Password</strong> - The virtual extension password that was set when creating the 3CX trunk. </li><li>  <strong>3CX IP</strong> is the IP address or FQDN of the 3CX server to which Asterisk is connected. </li><li>  <strong>3CX SIP Port</strong> - SIP port of the 3CX server.  If you have a regular (ie, non-cloud) installation of 3CX, the default SIP port is 5060. You can change the SIP port in the 3CX management interface in the <strong>Settings - Network - Ports</strong> section. </li></ul><br>  In Asterisk, you also need to create an inbound and outbound route that determines the routing of calls from / to 3CX Phone System.  To do this, refer to the <a href="http://wiki.freepbx.org/display/FPG/Outbound%2BRoutes%2BModule%2BUser%2BGuide">FreePBX documentation</a> . <br><br><h2>  Integration testing </h2><br>  If trunk configuration is done correctly, the 3CX trunk on Asterisk should have <strong>Registered</strong> status in the management console in the <strong>System Status - Ports / Trunks section</strong> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f9/11d/ae3/8f911dae325735dfef40b083edfe26a9.png"><br><br>  If you use Wireshark to capture traffic, the INVITE SIP request should look something like this. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d5f/1ef/abe/d5f1efabe639e117e7f9931fb73e93f8.png"><br><br><h3>  Request parameters </h3><br><ul><li>  101 - dialed from Asterisk to 3CX </li><li>  <strong>10003</strong> ‚Äî Virtual Trunk Extension Number </li><li>  <b>John Smith</b> and <strong>100</strong> - Display Name and Caller User ID Asterisk </li><li>  10.172.1.25:5061 - Asterisk IP address and SIP port </li><li>  192.168.9.206:5060 - IP address and SIP port 3CX Phone System </li></ul><br><h2>  Additional Information </h2><br><ul><li>  <a href="http://www.3cx.ru/docs/trunk-management/">Trunk Management</a> in 3CX </li><li>  <a href="http://www.3cx.ru/docs/connecting-offices-bridges/">Merge multiple 3CX Phone System (3CX Trunk)</a> </li><li>  <a href="http://www.3cx.ru/docs/monitoring-3cx-phone-system/">Monitoring 3CX Phone System</a> </li><li>  <a href="http://www.3cx.ru/docs/configure-webrtc/">Setting up the WebRTC gateway</a> </li><li>  <a href="http://www.3cx.com/docs/failover/%26amp%3Bsa%3DD%26amp%3Bust%3D1465180722339000%26amp%3Busg%3DAFQjCNFu8gj7prLvnQ2Xbz2XB7Br_QnguQ">Fault tolerance setup</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/302680/">https://habr.com/ru/post/302680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302670/index.html">Data Warehouse Testing</a></li>
<li><a href="../302672/index.html">Analysis of the tasks of the third qualifying round of the RCC 2016</a></li>
<li><a href="../302674/index.html">Machine Learning Boot Camp - how it was and how it will be</a></li>
<li><a href="../302676/index.html">Docker meetup in badoo</a></li>
<li><a href="../302678/index.html">RegionSoft CRM: a business that works for business</a></li>
<li><a href="../302682/index.html">iOS Localization: XLIFF</a></li>
<li><a href="../302684/index.html">The igrodel approach to creating modern web applications</a></li>
<li><a href="../302686/index.html">Consulting IT projects in the style of Agile?</a></li>
<li><a href="../302688/index.html">We write the channel bot for Telegram as at Habr on Python</a></li>
<li><a href="../302690/index.html">We have great bonuses! But don't ask what we do.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>