<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Patch update FFCMS 2.0.4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear reader and man in the street habrahabr! Over the past 2 weeks since my first publication here and on other thematic resources, we have ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Patch update FFCMS 2.0.4</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/392/053/b57/392053b576c24d52a7236cf9804999da.png" align="left">  Good day, dear reader and man in the street habrahabr!  Over the past 2 weeks since my first publication here and on other thematic resources, we have managed to collect a fairly decent report about the system related to the messages about the need to improve both the system interfaces, the functionality and the quality of its code. <br>  And today I am ready to present you with an update (patch) of FFCMS with version <b>2.0.4</b> , which includes corrections and developments related to your wishes. <br>  I would like to thank all those who paid attention to FFCMS and contributed to the development of the free product - I am grateful to everyone for your feedback and pull-requests on github'e - you can set the direction of development and improve the system for your own and collective use. <br><a name="habracut"></a><br><h2>  1. Summary of the update </h2><br>  In total, quite a lot of rekvestov associated with improvements in the "friendliness" of the interfaces was taken - where the use of the interface was not convenient, and where it was not sufficiently functional.  There were a lot of messages about the code, its style and quality - however, at the moment, only minor changes have been made, which do not significantly change the syntax of the API for invoking various methods and interaction models. <br>  There were also quite a lot of requests related to the expansion of the system capabilities, with which I mostly agreed - the management of the site menu, user profiles and karma and other functionalities. <br>  Many of the presentations in the admin panel of the system also needed processing, since  their compactness and availability were rather low.  There was also a need to manage the rules of the system modules on certain URIs using the graphical interface of the admin panel and not directly in the database. <br>  The user interface of the system needed to be improved - in some places the user-site interaction interfaces were rather inconvenient and not very informative - the system for notifying users about changes on the site was significantly improved. <br>  Not without the detection of XSS vulnerabilities (2pcs), for which I am grateful to the users - upon the detection of un-filtered incoming data, a full inspection of the entire code was carried out, but first things first! <br><br><h2>  2. Administrative Interface Improvements </h2><br>  The first thing that the administrator of a web resource falls to (webmaster or developer) is naturally the administrative control panel for the site and its content.  I tried to make it as rational as possible - there are only 4 sections in the interaction area - whether it be system interactions or interactions with extensions (3 types). <br>  I will briefly tell you about some changes in the administration panel using before and after images.  I am grateful to <a href="https://habrahabr.ru/users/dobriykot/" class="user_link">dobriykot</a> for messages <a href="http://habrahabr.ru/company/ffcms/blog/240637/">about common visual flaws</a> : <br><div style="text-align:center;"><img src="https://habrastorage.org/files/b41/74e/de3/b4174ede39484ed983238011eecb2d97.jpg"></div><br>  The inconvenience of the administrative interface was also completed by the user <a href="https://habrahabr.ru/users/hermit931/" class="user_link">hermit931</a> associated with the checkbox, select and other elements, as a result of which selectize.js and switchable checkbox were added to the system: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/76d/433/6e9/76d4336e95e843a6b064d2b7640b8904.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b9a/555/274/b9a55527468f4d2c97c45cc37cc49a88.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/0fd/654/8a2/0fd6548a214148249172978dcd51ce6b.jpg"></div><br>  Also, users reported a number of flaws and inconveniences on the FFCMS forum and in the feedback form, some of the changes are listed below (module routing management, system antivirus, additional fields in user profiles, news category management): <br><div style="text-align:center;"><img src="https://habrastorage.org/files/70d/804/f8f/70d804f8fd634e169dbe579aef54912c.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e84/8d9/c11/e848d9c112de4264a903127d03344b90.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/afd/aaf/5e1/afdaaf5e183f4b609e6decef3f948777.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a9b/cd2/8a8/a9bcd28a881649119832071d339a4d7f.jpg"></div><br><br>  Other interfaces were also subject to changes to a greater or lesser extent. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  3. XSS recognizability </h2><br>  More experienced users first of all undertook to check the interfaces for the possibility of carrying out XSS-attacks and users found this possibility, unfortunately or joy.  As they say, a secure system is not the one in which the vulnerability was not found, but the one in which it was diligently searched for and not found. <br>  The first vulnerability found is the lack of filtering in the text box of the response to userwall.post (user wall of messages -&gt; responses).  Actually the fact of detecting this vulnerability pushed me to check the filtering of all incoming user data, as a result I found 2 more vulnerable fields - one of them is the user's bookmarks (the header was not filtered) and one of the save options for the bookmark. <br>  Later, users discovered another 1 vulnerability - a search form.  However, this vulnerability was more dangerous than the above described.  The fact is that the search parameters are passed to the pathway: <br><pre><code class="bash hljs">/ru/search/hello%20guys</code> </pre> <br>  and the system has a standard template variable <code>{{ system.uri }}</code> , which takes the value of the current URI without regard to the language, NC, and other possible parameters for constructing URLs on the site.  In the future, this variable is commonly used, including in the standard template for generating, for example, language switches: <br><pre> <code class="html hljs xml"> {% for langitem in system.languages %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{ system.nolang_url }}/{{ langitem }}/{{ system.uri }}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flag flag-{{ langitem }}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{ system.script_url }}/resource/flags/blank.gif"</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> {% endfor %}</code> </pre><br>  As you may have guessed, by substituting the contents in the javascript URI, you could get the result of cross-scripting on the site: <br><pre> <code class="html hljs xml">URL: /ru/test/"&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript">alert(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"Hello, ffcms.ru!"</span></span></span><span class="actionscript">);</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> Result: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/ru/test/"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript">alert(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"Hello, ffcms.ru!"</span></span></span><span class="actionscript">);</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>"&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  This vulnerability was eliminated due to the fact that the active user turned his attention to the vulnerability of the search form on the site, which was significantly more dangerous. <br><br><h2>  4. Small code style improvements. </h2><br>  Many users offered to significantly improve both the style of the code and its architecture in the direction of a particular paradigm.  Indeed, in the future update (branch 2.1.xx) I plan to introduce the PSR-1 standard for the entire system code, but now I did not take this decision in view of the fact that the names of the system classes and methods can change significantly, which can make it difficult to develop extensions for systems for users who have just begun to study the system and its capabilities. <br>  However, I did make some small changes that were recommended by users or I found it myself.  So I tried to remove the repetition of the code (for example, the news component and the news module on the main one - now the second calls the first method without meaningless copying the code). <br>  The same user <a href="https://habrahabr.ru/users/claustrofob/" class="user_link">claustrofob</a> <a href="http://habrahabr.ru/company/ffcms/blog/240829/">advised to implement</a> the logic itself in the abstract singleton class using late static binding, so as not to drag and copy it in each of the heirs of this class pattern (why didn‚Äôt I do it right away, even though I remembered it many times ?!) .  Now there is no need to pull the next implementation everywhere: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $instance = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(is_null(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$instance)) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$instance; }</code> </pre><br>  all you need to do is inherit \ engine \ singleton: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">engine</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">singleton</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br>  The initiation of system classes was also subject to significant changes.  Previously, their initiation took place in different ways - it happened up to the introduction of logic into singleton, but it was decided to change the dynamic initiation of classes to a single standard method - init () for all classes.  Now, it is much easier to monitor the system load logic than before, an example of unloading a configuration class: <br><pre> <code class="php hljs">\engine\property::getInstance()-&gt;init();</code> </pre><br>  In some places, I refused to use static variables and self :: in favor of the usual dynamics and $ this-&gt;.  All static variables were named CONST in the class headers. <br><br><h2>  5. Other changes </h2><br>  As I noted earlier, the changes affected the user interface as well as some functional additions were introduced for the FFCMS system. <br>  The changes affected the user notification algorithm for personal messages and friend requests (the User Identification component) as well as the opportunity to write a message to the user if they are not friends: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/efb/501/f55/efb501f55f274b31bd34017ec328e871.png"></div><br>  It also became possible to search for users by name, display user rating by the number of karma, and improve the performance of the ‚Äúrating‚Äù system (karma) - it became possible to use it remotely by other extensions (which I have already successfully implemented in the forum component): <br><div style="text-align:center;"><img src="https://habrastorage.org/files/72f/288/608/72f288608fa74b8ba3e24475a5fa68a1.png"></div><br>  The system also introduced the ability to "disable" the site for users - the so-called "maintenance mod".  The logic of the system router and the assignment of template variable paths for the work of the site in the subdirectories of the domain as well as a number of other useful system improvements have been redesigned. <br><br><h2>  6. References </h2><br>  Project website: <a href="https://ffcms.ru/">ffcms.ru</a> <br>  Github'e release: <a href="">ffcms 2.0.4</a> <br>  Release Information Online: <a href="https://ffcms.ru/ru/news/updates/update-204.html">Update 2.0.4</a> <br>  FFCMS extensions: FFCMS <a href="https://ffcms.ru/ru/extension/">extensions catalog</a> (everyone can register and add their extensions to our catalog) <br>  Our wonderful forum: <a href="http://ffcms.ru/ru/forum/">CMS Forum</a> <br><br><h2>  7. Afterword </h2><br>  I am grateful to all those who report on the shortcomings and shortcomings of the project and are always glad to your feedback.  I accept absolutely all constructive recommendations and advice on the development of this project. <br>  Let me remind you that FFCMS is a free, open source project distributed under the GNU GPL v3 license.  In my next post I will tell you how to write an extension for the FFCMS system. </div><p>Source: <a href="https://habr.com/ru/post/242101/">https://habr.com/ru/post/242101/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242089/index.html">Layout of business cards in LaTeX</a></li>
<li><a href="../242091/index.html">Using the MVC approach in WinForms for the smallest</a></li>
<li><a href="../242095/index.html">The path of the developer: stories about my fabulous failures, part 1</a></li>
<li><a href="../242097/index.html">Traffic lights in the garage. Present</a></li>
<li><a href="../242099/index.html">Orb. DIY news server</a></li>
<li><a href="../242103/index.html">JetBrains took another step towards education by releasing the PyCharm Educational Edition.</a></li>
<li><a href="../242105/index.html">Intel INDE 2015 - a new useful tool for developing cross-platform applications</a></li>
<li><a href="../242109/index.html">Speech recognition in FreePBX using Yandex Speechkit</a></li>
<li><a href="../242113/index.html">About Meteor in detail: why is the future of web development</a></li>
<li><a href="../242115/index.html">Changing time zones on MS Exchange and dealing with its consequences for Android and IOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>