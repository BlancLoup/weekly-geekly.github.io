<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monitoring system of active network equipment of the federal network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the time of writing, I came to the conclusion that it is almost impossible to explain the whole technical part on this topic in one post, and maybe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monitoring system of active network equipment of the federal network</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/73c/b4c/deb/73cb4cdebfd841cbbfdeb8dc1953e6d9.JPG"><br><br>  At the time of writing, I came to the conclusion that it is almost impossible to explain the whole technical part on this topic in one post, and maybe nobody needs it.  Therefore, I decided to make this post an overview of my work.  The purpose of the post is to show how not using additional funding from the company and by drawing a couple of virtual servers you can build an effective monitoring environment for the active equipment of a large network in a large company. <br><br>  If you are interested in the topic of network monitoring or have a desire to compare my work with what you have, I invite you under cat. <br><a name="habracut"></a><br>  In a small ‚Äúhome‚Äù network, the task of monitoring the network can be solved using any of the available free monitoring platforms.  However, when it comes to a large enterprise with a large number of nodes, everything is not so transparent.  And the main problem is the lack of physical resources and the lack of a system adapted to your requirements.  The situation is slightly better with paid products, but paid systems rarely enter into business expenses for monitoring of <b>some kind</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Control system </h3><br>  The skeleton of the entire monitoring system will be a control system that allows the mouse to make changes, remove or add new nodes or connections. <br><br>  When developing the whole system, the following requirements were taken into account: <br><ul><li>  Minimal tuning / reconfiguration on active equipment; </li><li>  Processing a large amount of traffic on netflow; </li><li>  The ability to explore in detail any network activity; </li><li>  Immediate update on incidents.  Whether it is a channel drop or a large channel load; </li><li>  Ability to modify modules or reports for all possible selections; </li><li>  Enable the minimum amount of infrastructure; </li><li>  As little as possible, write the functionality yourself. </li></ul><br><br>  The infrastructure was tried differently until the current configuration was reached.  I will not describe all the tested options, so as not to stretch the post. <br><br>  The bottom line is: Two virtual servers running CentOS 6. <br>  One for control and display system.  2 processors, 4GB of RAM, 250GB disk. <br>  The second one performing the functions of a netflow collector.  2 processors, 4GB of RAM 150GB disk. <br>  Server configuration is quite standard, apache <a href="http://www.apache.org/">web server</a> with <a href="http://php.net/">php</a> + <a href="http://www.mysql.com/">mysql</a> . <br><br><h4>  Cactus </h4><br>  For the control system was selected <a href="http://cacti.net/">Cactus</a> .  What attracted the cactus: <br><ul><li>  The lack of complex code in the WEB display (no flash, aciveX and other active components, which gives the advantage of using on mobile devices); </li><li>  Simple and clear structure of the database, to which you can easily bind your functionality; </li><li>  Many plug-ins specifically for monitoring active equipment; </li><li>  Built-in SNMP support; </li><li>  <a href="http://oss.oetiker.ch/rrdtool/">RRDTool</a> as a source for charts (hello zabbiksu); </li><li>  there is no client part. </li></ul><br>  Installing a Cactus does not pose any difficulty.  There is a lot of information on this topic on the Internet, and of course, official <a href="http://docs.cacti.net/manual:088:1_installation.1_install_unix">documentation</a> is the best one. <br><br>  Setup also does not require deep IT knowledge.  The Devices page adds devices, specifies the type of SNMP and authorization.  Bind standard templates. <br><div class="spoiler">  <b class="spoiler_title">Devices</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ccf/adb/958/ccfadb9582f44a528a9fea4fae3e98d8.JPG"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">SNMP configuration</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/fef/ea8/a98/fefea8a984344dd6b9d8a006c46e9057.JPG"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Templates</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/da2/080/2af/da20802afadb41a58584106bd3e62cdf.JPG"><br></div></div><br>  After the device is polled by the cactus, it is possible to create a graph based on data from the SNMP from a specific network interface or another sensor, whether it is the mains voltage at the PBI or the processor load at the switch. <br><div class="spoiler">  <b class="spoiler_title">Graph selection</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/af4/7d1/f7b/af47d1f7b7c447d981a3b954c8389841.JPG"><br></div></div><br><img src="https://habrastorage.org/files/74f/ab3/c2e/74fab3c2eaa84007a3cd3322bfbc9f3d.jpg"><br><br><h4>  Plug-ins to cactus to work with active equipment </h4><br><img src="https://habrastorage.org/files/30a/a60/12d/30aa6012dc7e42d793c00e39e48cc4ba.JPG"><br><br><h5>  Netflow </h5><br>  The main ideas are reports based on netflow flows.  So, the first flowview plugin we need.  A very simple plugin allows you to configure sources of flow in a graphical mode. <br><div class="spoiler">  <b class="spoiler_title">flowview config</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/df3/e1b/ee6/df3e1bee61aa45e5aae93f0549a3700b.JPG"><br></div></div><br>  As well as make samples based on flow of flows and build automatic reports on a schedule. <br><div class="spoiler">  <b class="spoiler_title">flowview schedules</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/4c5/e86/6e2/4c5e866e22f348129c75878175c06b81.JPG"><br></div></div><br><h5>  Syslog and traps </h5><br><img src="https://habrastorage.org/files/300/2a7/8a7/3002a78a79fb4671b4b8c7e5850b7be7.JPG"><br>  I used two plugins to collect and analyze traps and syslog from Cisco. <br>  This is camm and syslog. <br><div class="spoiler">  <b class="spoiler_title">camm</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/611/806/302/61180630284f4d1088f400c3e0b97c1d.JPG"><br></div></div><br>  The first one impressed me with filters and the ability to create rules for events (for example, I received messages on corporate events in the corporate jabber). <br><div class="spoiler">  <b class="spoiler_title">camm rule</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/b75/43e/ed1/b7543eed1b83437c8eb65b7a7302b197.JPG"><br></div></div><br>  It is also very convenient grouping based on the MIB and the database of the cactus itself. <br><div class="spoiler">  <b class="spoiler_title">camm group</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/bf0/179/318/bf0179318d5f4100898dae18894db182.JPG"><br></div></div><br>  The second creates an autonomous database with a very transparent structure, to which I tied a functional written independently, but more on that later. <br><br><h5>  Network maps </h5><br>  Weathermap is the last plugin I use to monitor networks.  He is beautiful and simple.  Data is taken from the RRD database of the cactus itself, and the editor is similar to Paint. <br><div class="spoiler">  <b class="spoiler_title">Channels</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/7b0/c5a/7fe/7b0c5a7fe3594dc6840cb6843306f0af.jpg"><br></div></div><br>  Allows you to graphically display the load of communication channels.  So and possible problems with the channel. <br>  A piece of weathermap configuration file. <br><div class="spoiler">  <b class="spoiler_title">Weathermap config example</b> <div class="spoiler_text"><pre><code class="bash hljs">NODE C7606.1 LABEL C7606.1 LABELOFFSET N INFOURL /cacti/graph.php?rra_id=all&amp;local_graph_id=3691 OVERLIBGRAPH /cacti/graph_image.php?rra_id=0&amp;graph_nolegend=<span class="hljs-literal"><span class="hljs-literal">true</span></span>&amp;graph_height=100&amp;graph_width=300&amp;local_graph_id=3691 ICON images/Router_PU2.png POSITION 1132 180 NODE C7609<span class="hljs-comment"><span class="hljs-comment">#1 LABEL C7609#1 LABELOFFSET N INFOURL /cacti/graph.php?rra_id=all&amp;local_graph_id=3366 OVERLIBGRAPH /cacti/graph_image.php?rra_id=0&amp;graph_nolegend=true&amp;graph_height=100&amp;graph_width=300&amp;local_graph_id=3366 ICON images/Router_PU2.png POSITION 795 180 # regular LINKs: LINK C7606.1-C7609#1 INFOURL /cacti/graph.php?rra_id=all&amp;local_graph_id=347 OVERLIBGRAPH /cacti/graph_image.php?local_graph_id=347&amp;rra_id=0&amp;graph_nolegend=true&amp;graph_height=100&amp;graph_width=300 TARGET /var/www/cacti/rra/c7606_1_traffic_in_403.rrd NODES C7606.1:N20 C7609#1:N50 BANDWIDTH 40M LINK C7606.2-C7609#2 INFOURL /cacti/graph.php?rra_id=all&amp;local_graph_id=340 OVERLIBGRAPH /cacti/graph_image.php?local_graph_id=340&amp;rra_id=0&amp;graph_nolegend=true&amp;graph_height=100&amp;graph_width=300 TARGET /var/www/cacti/rra/c7606_1_traffic_in_396.rrd NODES C7606.1:N10 C7609#1:N50 BANDWIDTH 40M</span></span></code> </pre> <br></div></div><br><br><h4>  NetFlow setup </h4><br>  As our software collector, <a href="http://www.splintered.net/sw/flow-tools/">flow-tools</a> will be used.  This software can not only capture traffic, but also analyze it.  Also, on the basis of this package, quite a few GUIs are written to display the collected information in a human form. <br><br>  I was going to manage the <i>flow-capture</i> component from the <i>flowview</i> cactus <i>plugin</i> , so after installing the <i>flow-tools</i> , you need to copy the service launch script from the plugin folder to our <i>init.d</i> on the server. <br>  Why all this fuss with the control system?  Is it easier to fix the config manually and score?  But it was not there.  The number of devices of the order of 500 pieces with a very large amount of traffic.  If you put all the flow in one folder, retrieving data for one hour of traffic will take more than 2 hours, this is unacceptable. <br><br>  It was decided to separate the streams from each device into a separate folder so that the selection took place in a specific folder with the necessary traffic.  Means <i>flow-capture</i> is done by exploding streams from devices on ports.  Which means each device needs to be configured with a unique flow return port? <br><br>  This is also unacceptable, so a simple little <a href="http://code.google.com/p/samplicator/">samplicator</a> program comes to the rescue of solving this problem.  The essence of the work is as follows: it accepts incoming UDP packets, sorts them according to the source address and transmits them to the selected port.  And this means that we set up the equipment configuration on one port, and already on the server itself we distribute the flows on the ports. <br><br>  Config syntax: Source / Mask: Destination1 / Port [Destination2 / Port] and example: <br><div class="spoiler">  <b class="spoiler_title">samplicate.conf</b> <div class="spoiler_text">  10.20.0.0/255.255.0.0 <br>  10.20.30.252/255.255.255.252:10.20.0.108/2057 0/2057 <br>  10.20.30.4/255.255.255.252:10.20.0.108/2058 0/2058 <br>  10.20.30.160/255.255.255.255:10.20.0.108/2059 0/2059 <br></div></div><br>  Flow collected, with horror we watch the speed of filling our disks.  How can I see all this now? <br>  There are many ways you can generate reports manually through the same <i>flow-tools</i> package.  But not all users of the system can do this, and even those who can, must sweat to write a human report. <br><br>  I turned to another great project <a href="http://sourceforge.net/projects/flowviewer/">FlowViewer</a> . <br><br>  When I dug it up and started using it, there was version 3.3 or something like that, 2006.  While I figured out the 3rd version, the project suddenly came to life and began to develop, the 4th version was just brilliant, compared to the 3rd.  At the time of this writing, the current version is 4.4 (I use 4.1). <br><br>  At its core, it almost completely duplicates the <i>flowview Cactus</i> plug-in, but I liked the plug-in only with the existing schedule, its work on sampling is unstable, the filters are not complete, and there is no necessary aggregation.  And architecturally the entire flow is stored on the second server, which means <i>FlowViever is</i> happy to be placed on the second server and provides beautiful graphics and samples with traffic. <br><div class="spoiler">  <b class="spoiler_title">flowviewer</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/5ff/71c/bdc/5ff71cbdc66c4ae69221dac34d770492.JPG"><br></div></div><br><br><h5>  SNMP Traps </h5><br>  Flows with a flow are very good and tempting, but it is impossible to use them to alert about problems.  Only for analysis after the problem has been fixed. <br><br>  Well, the most accessible notification method is SNMP traps.  Receiving SNMP traps from 500 devices in one list is not a very pleasant task, you will lose important information at the moment.  It is clear that you need to do some kind of filter.  There was no ready-made solution to satisfy my requirements.  But it does not matter, remembering the craving for programming at the institute decided to write the trap analyzer itself. <br><br>  The technology for obtaining a filtered list is as follows: when receiving a <a href="http://www.net-snmp.org/">trap, the</a> monitoring server receives ( <a href="http://www.net-snmp.org/">snmptrapd</a> ) it, analyzes ( <a href="http://snmptt.sourceforge.net/">snmptt</a> ) in accordance with the loaded MIB specifications and immediately puts it into the database. <br><br><div class="spoiler">  <b class="spoiler_title">snmptt.conf</b> <div class="spoiler_text">  mysql_dbi_enable = 1 <br>  mysql_dbi_host = localhost <br>  mysql_dbi_port = 3306 <br>  mysql_dbi_database = cacti <br>  mysql_dbi_table = plugin_camm_snmptt <br>  mysql_dbi_table_unknown = plugin_camm_snmptt_unk <br>  mysql_dbi_table_statistics = plugin_camm_snmptt_stat <br>  mysql_dbi_username = cacti <br>  mysql_dbi_password = cacti <br>  mysql_ping_on_insert = 1 <br>  mysql_ping_interval = 300 <br><br></div></div><br>  There is no sense in intercepting this processing, because you have to somehow start your own stack of events.  This is of no use to us, especially the database to which the ladders fall into ours is filled with information about the devices (names, ports, links), which <i>Cactus</i> collects by means of the SNMP survey. <br><br>  An attractive option is to take events from the base, link them with the existing base for informativeness.  Armed with a notebook, I began to invent logic.  There were no special problems with it, problems arose when sampling data from the database.  Which began to take 30 seconds.  About any efficiency here it is not shala.  The theory of database optimization, query optimization, indexes, plans, and smart advice from my companion (a specialist in super-large databases) did their job. <br><br><img src="https://habrastorage.org/files/2b7/012/dcd/2b7012dcd3a442f9bc8a6df37588a9f9.jpg"><br><br>  The main idea is to filter Up / Down traps, in the description of which there are interface names (Eth, Serial, Gi, E), by identifiers and source we look for data in the table with SNMP.  At the output we get a beautiful line, <b>when</b> , <b>where</b> and <b>where the</b> link fell. <br><br><div class="spoiler">  <b class="spoiler_title">MySQL Select: Channel Status</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(sd.id), sd.id_channel, sd.<span class="hljs-string"><span class="hljs-string">`status`</span></span>, sd.diff, <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(sd.date) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">'date'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">MIN</span></span>(sd.date2) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">'date2'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">SUM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">UNIX_TIMESTAMP</span></span>(sd.date)-<span class="hljs-keyword"><span class="hljs-keyword">UNIX_TIMESTAMP</span></span>(sd.date2)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">'time'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(sd.id_trap) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">'id_trap'</span></span>, <span class="hljs-string"><span class="hljs-string">`host`</span></span>.description, channel_list.ch_name <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> a.id, a.id_channel, a.<span class="hljs-string"><span class="hljs-string">`status`</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">UNIX_TIMESTAMP</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>())-<span class="hljs-keyword"><span class="hljs-keyword">UNIX_TIMESTAMP</span></span>(a.date) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">'diff'</span></span>, a.date, (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> cs2.<span class="hljs-string"><span class="hljs-string">`status`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> a.<span class="hljs-string"><span class="hljs-string">`status`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> cs2.<span class="hljs-string"><span class="hljs-string">`date`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> custom_status <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> cs2 <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> cs2.id_channel = a.id_channel <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> cs2.date = (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(cs.date) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> custom_status cs <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> cs.date &lt; a.date <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> cs.id_channel = a.id_channel ) <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">'date2'</span></span>, a.id_trap <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> custom_status <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> t.id_channel, <span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(t.date) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> max_date <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> custom_status t <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> t.id_channel) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> b.id_channel= a.id_channel) sd <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> channel_list <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> channel_list.id = sd.id_channel <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> <span class="hljs-string"><span class="hljs-string">`host`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> channel_list.hostname = <span class="hljs-string"><span class="hljs-string">`host`</span></span>.hostname <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> sd.<span class="hljs-string"><span class="hljs-string">`status`</span></span> = <span class="hljs-string"><span class="hljs-string">'linkUp'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> sd.date <span class="hljs-keyword"><span class="hljs-keyword">between</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATE_SUB</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CURDATE</span></span>(),<span class="hljs-built_in"><span class="hljs-built_in">INTERVAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MOD</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DAYOFWEEK</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CURDATE</span></span>())<span class="hljs-number"><span class="hljs-number">-2</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>)+<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DAY</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATE_ADD</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CURDATE</span></span>(), <span class="hljs-built_in"><span class="hljs-built_in">INTERVAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MOD</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> - (<span class="hljs-keyword"><span class="hljs-keyword">DAYOFWEEK</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CURDATE</span></span>()) - <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">7</span></span>)<span class="hljs-number"><span class="hljs-number">-6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DAY</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> sd.id_channel,sd.<span class="hljs-string"><span class="hljs-string">`status`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-built_in"><span class="hljs-built_in">date</span></span> <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span><span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre><br></div></div><br>  All data from the database are made in a readable form in the form of html pages. <br><br><div class="spoiler">  <b class="spoiler_title">Info from traps</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/071/c7e/16c/071c7e16c7d24b79964b29991b693abd.JPG"><br></div></div><br><br>  Samples from the database receiving different conditions, form different plates of reports. <br><br><div class="spoiler">  <b class="spoiler_title">Detail info</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/0ea/0be/feb/0ea0befeb5d24c81ab514138503ff83d.JPG"><br></div></div><br><br>  I thank the reader who mastered all my confused narration.  Partly due to the fact that the system has been working for more than a year without me.  Much has been forgotten, something has lost its meaning.  But monitoring is still working, collecting data and providing samples already without my support. <br><br>  All data, screenshots and configs are depersonalized.  Any matches are random. </div><p>Source: <a href="https://habr.com/ru/post/235459/">https://habr.com/ru/post/235459/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../235449/index.html">Hackers used Google to debug malicious software.</a></li>
<li><a href="../235451/index.html">The University of Tokyo has developed a fast two-legged robot runner with a new balancing system</a></li>
<li><a href="../235453/index.html">Overview of updates to the Microsoft Azure platform in August</a></li>
<li><a href="../235455/index.html">PHP Version Switching Module for ISPmanager</a></li>
<li><a href="../235457/index.html">Google and Bungie created the interactive world of Destiny using Street View</a></li>
<li><a href="../235461/index.html">How to cross the designer "Expert" and Arduino do it yourself</a></li>
<li><a href="../235463/index.html">Place under the ... antenna</a></li>
<li><a href="../235465/index.html">Oracle vs Teradata vs Hadoop</a></li>
<li><a href="../235467/index.html">The Skip. How the ‚ÄúSkip Track‚Äù button influenced music consumption patterns</a></li>
<li><a href="../235473/index.html">Cach√© Native Access - working with native libraries in Cach√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>