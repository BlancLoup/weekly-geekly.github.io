<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Loss of accuracy from Double to Float or "Where are the pennies missing?"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Conversion of numbers from one type to another is usually conducted in such a way as not to lose unnecessary numbers, i.e. from smaller type to more c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Loss of accuracy from Double to Float or "Where are the pennies missing?"</h1><div class="post__text post__text-html js-mediator-article">  Conversion of numbers from one type to another is usually conducted in such a way as not to lose unnecessary numbers, i.e.  from smaller type to more capacious.  But what if the previous developer used the conversion from Double to Float and the pennies began to disappear in the reports? <br>  The article provides an overview of converting floating numbers to Java: <br><pre><code class="java hljs"><span class="hljs-number"><span class="hljs-number">99999999.33333333</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">100000000.0000000</span></span> <span class="hljs-number"><span class="hljs-number">98888888.33333333</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">98888888.0000000</span></span> <span class="hljs-number"><span class="hljs-number">2974815.78000000</span></span> -&gt; <span class="hljs-number"><span class="hljs-number">2974815.7500000</span></span></code> </pre> <br>  Let's see what this transformation leads to and why it happens that way.  After all, it would seem that once the numbers used in the project are far from the maximum values ‚Äã‚Äãof the float and double types, then converting it from the first to the second should not entail negative consequences in most cases. <br><a name="habracut"></a><br>  It is better to back up any thoughts with concrete examples, so immediately the code that was born first on the leaps and bounds of real numbers, but then, influenced by the <a href="http://stackoverflow.com/questions/916081/convert-float-to-double-without-losing-precision">discussion on stackoverflow about such a conversion</a> , it turned into something more intriguing. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testDoubleToFloat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> d)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> f = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) d; System.out.println(); System.out.println(String.format(<span class="hljs-string"><span class="hljs-string">"double %.10f\t%s"</span></span>, d, Long.toBinaryString(Double.doubleToRawLongBits(d)))); System.out.println(String.format(<span class="hljs-string"><span class="hljs-string">"float %.10f\t %s"</span></span>, f, Integer.toBinaryString(Float.floatToRawIntBits(f)))); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(String.format(<span class="hljs-string"><span class="hljs-string">"double: %.10f / %.10f"</span></span>, Double.MIN_VALUE, Double.MAX_VALUE)); System.out.println(String.format(<span class="hljs-string"><span class="hljs-string">"float: %.10f / %.10f"</span></span>, Float.MIN_VALUE, Float.MAX_VALUE)); <span class="hljs-comment"><span class="hljs-comment">/*  ,        double. */</span></span> testDoubleToFloat(<span class="hljs-number"><span class="hljs-number">99999999.0</span></span> + <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-number"><span class="hljs-number">3.0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   testDoubleToFloat(98888888.0 + 1.0 / 3.0); //     testDoubleToFloat(2974815.78); testDoubleToFloat(-2974815.78); } }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Execution result</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">double</span></span>: <span class="hljs-number"><span class="hljs-number">0.0000000000</span></span> / <span class="hljs-number"><span class="hljs-number">179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0000000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>: <span class="hljs-number"><span class="hljs-number">0.0000000000</span></span> / <span class="hljs-number"><span class="hljs-number">340282346638528860000000000000000000000.0000000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> <span class="hljs-number"><span class="hljs-number">99999999.3333333300</span></span> <span class="hljs-number"><span class="hljs-number">100000110010111110101111000001111111101010101010101010101010101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">100000000.0000000000</span></span> <span class="hljs-number"><span class="hljs-number">1001100101111101011110000100000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> <span class="hljs-number"><span class="hljs-number">98888888.3333333300</span></span> <span class="hljs-number"><span class="hljs-number">100000110010111100100111011001011100001010101010101010101010101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">98888888.0000000000</span></span> <span class="hljs-number"><span class="hljs-number">1001100101111001001110110010111</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> <span class="hljs-number"><span class="hljs-number">2974815.7800000000</span></span> <span class="hljs-number"><span class="hljs-number">100000101000110101100100010111111100011110101110000101000111101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">2974815.7500000000</span></span> <span class="hljs-number"><span class="hljs-number">1001010001101011001000101111111</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> -<span class="hljs-number"><span class="hljs-number">2974815.7800000000</span></span> <span class="hljs-number"><span class="hljs-number">1100000101000110101100100010111111100011110101110000101000111101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> -<span class="hljs-number"><span class="hljs-number">2974815.7500000000</span></span> <span class="hljs-number"><span class="hljs-number">11001010001101011001000101111111</span></span></code> </pre><br>  Same for <br><pre> <code class="java hljs">/opt/jdk1.7/bin/java -version java version <span class="hljs-string"><span class="hljs-string">"1.7.0_25"</span></span> Java(TM) <span class="hljs-function"><span class="hljs-function">SE Runtime </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Environment</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(build </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.7</span></span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">_25-b15)</span></span></span><span class="hljs-function"> Java </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HotSpot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TM)</span></span></span><span class="hljs-function"> 64-Bit Server </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VM</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(build </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">23.25</span></span></span></span><span class="hljs-function"><span class="hljs-params">-b01, mixed mode)</span></span></span></span></code> </pre><br>  And for <br><pre> <code class="java hljs">java -version java version <span class="hljs-string"><span class="hljs-string">"1.7.0_25"</span></span> <span class="hljs-function"><span class="hljs-function">OpenJDK Runtime </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Environment</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IcedTea </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.3</span></span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">.12</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">7</span></span></span></span><span class="hljs-function"><span class="hljs-params">u25</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-2.3</span></span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">.12</span></span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-4</span></span></span></span><span class="hljs-function"><span class="hljs-params">ubuntu3)</span></span></span><span class="hljs-function"> OpenJDK 64-Bit Server </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VM</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(build </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">23.7</span></span></span></span><span class="hljs-function"><span class="hljs-params">-b01, mixed mode)</span></span></span></span></code> </pre><br></div></div><br><h4>  Conversion method </h4><br>  To demonstrate that various constructions convert double to float in the same way, we add various methods and compare the results: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Main</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testDoubleToFloat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> d)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> f = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) d; Float f2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Float(d); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> f3 = Float.parseFloat(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Double(d).toString()); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> f4 = Float.parseFloat(String.format(<span class="hljs-string"><span class="hljs-string">"%.10f"</span></span>, d)); System.out.println(); System.out.println(String.format(<span class="hljs-string"><span class="hljs-string">"double %.10f\t%s"</span></span>, d, Long.toBinaryString(Double.doubleToRawLongBits(d)))); System.out.println(String.format(<span class="hljs-string"><span class="hljs-string">"float %.10f\t %s"</span></span>, f, Integer.toBinaryString(Float.floatToRawIntBits(f)))); System.out.println(String.format(<span class="hljs-string"><span class="hljs-string">"Float %.10f\t %s"</span></span>, f2, Integer.toBinaryString(Float.floatToRawIntBits(f2)))); System.out.println(String.format(<span class="hljs-string"><span class="hljs-string">"float %.10f\t %s"</span></span>, f3, Integer.toBinaryString(Float.floatToRawIntBits(f3)))); System.out.println(String.format(<span class="hljs-string"><span class="hljs-string">"float %.10f\t %s"</span></span>, f4, Integer.toBinaryString(Float.floatToRawIntBits(f4)))); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(String.format(<span class="hljs-string"><span class="hljs-string">"double: %.10f / %.10f"</span></span>, Double.MIN_VALUE, Double.MAX_VALUE)); System.out.println(String.format(<span class="hljs-string"><span class="hljs-string">"float: %.10f / %.10f"</span></span>, Float.MIN_VALUE, Float.MAX_VALUE)); testDoubleToFloat(<span class="hljs-number"><span class="hljs-number">99999999.0</span></span> + <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-number"><span class="hljs-number">3.0</span></span>); testDoubleToFloat(<span class="hljs-number"><span class="hljs-number">98888888.0</span></span> + <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-number"><span class="hljs-number">3.0</span></span>); testDoubleToFloat(<span class="hljs-number"><span class="hljs-number">2974815.78</span></span>); testDoubleToFloat(-<span class="hljs-number"><span class="hljs-number">2974815.78</span></span>); } }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Execution result</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>: <span class="hljs-number"><span class="hljs-number">0.0000000000</span></span> / <span class="hljs-number"><span class="hljs-number">179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000.0000000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>: <span class="hljs-number"><span class="hljs-number">0.0000000000</span></span> / <span class="hljs-number"><span class="hljs-number">340282346638528860000000000000000000000.0000000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> <span class="hljs-number"><span class="hljs-number">99999999.3333333300</span></span> <span class="hljs-number"><span class="hljs-number">100000110010111110101111000001111111101010101010101010101010101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">100000000.0000000000</span></span> <span class="hljs-number"><span class="hljs-number">1001100101111101011110000100000</span></span> Float <span class="hljs-number"><span class="hljs-number">100000000.0000000000</span></span> <span class="hljs-number"><span class="hljs-number">1001100101111101011110000100000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">100000000.0000000000</span></span> <span class="hljs-number"><span class="hljs-number">1001100101111101011110000100000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">100000000.0000000000</span></span> <span class="hljs-number"><span class="hljs-number">1001100101111101011110000100000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> <span class="hljs-number"><span class="hljs-number">98888888.3333333300</span></span> <span class="hljs-number"><span class="hljs-number">100000110010111100100111011001011100001010101010101010101010101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">98888888.0000000000</span></span> <span class="hljs-number"><span class="hljs-number">1001100101111001001110110010111</span></span> Float <span class="hljs-number"><span class="hljs-number">98888888.0000000000</span></span> <span class="hljs-number"><span class="hljs-number">1001100101111001001110110010111</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">98888888.0000000000</span></span> <span class="hljs-number"><span class="hljs-number">1001100101111001001110110010111</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">98888888.0000000000</span></span> <span class="hljs-number"><span class="hljs-number">1001100101111001001110110010111</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> <span class="hljs-number"><span class="hljs-number">2974815.7800000000</span></span> <span class="hljs-number"><span class="hljs-number">100000101000110101100100010111111100011110101110000101000111101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">2974815.7500000000</span></span> <span class="hljs-number"><span class="hljs-number">1001010001101011001000101111111</span></span> Float <span class="hljs-number"><span class="hljs-number">2974815.7500000000</span></span> <span class="hljs-number"><span class="hljs-number">1001010001101011001000101111111</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">2974815.7500000000</span></span> <span class="hljs-number"><span class="hljs-number">1001010001101011001000101111111</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">2974815.7500000000</span></span> <span class="hljs-number"><span class="hljs-number">1001010001101011001000101111111</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> -<span class="hljs-number"><span class="hljs-number">2974815.7800000000</span></span> <span class="hljs-number"><span class="hljs-number">1100000101000110101100100010111111100011110101110000101000111101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> -<span class="hljs-number"><span class="hljs-number">2974815.7500000000</span></span> <span class="hljs-number"><span class="hljs-number">11001010001101011001000101111111</span></span> Float -<span class="hljs-number"><span class="hljs-number">2974815.7500000000</span></span> <span class="hljs-number"><span class="hljs-number">11001010001101011001000101111111</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> -<span class="hljs-number"><span class="hljs-number">2974815.7500000000</span></span> <span class="hljs-number"><span class="hljs-number">11001010001101011001000101111111</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> -<span class="hljs-number"><span class="hljs-number">2974815.7500000000</span></span> <span class="hljs-number"><span class="hljs-number">11001010001101011001000101111111</span></span></code> </pre><br></div></div><br>  As you can see, the expressions "new Float (d)" and "(float) d" give the same result, since  the first uses the second: <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Copyright (c) 1994, 2010, Oracle and/or its affiliates. All rights reserved. * ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms. */</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Float</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Number</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Comparable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Float</span></span></span><span class="hljs-class">&gt; </span></span>{ ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Float</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)value; } ... }</code> </pre><br>  If you deal with the function Float.parseFloat, then it sends us through several other functions to the next line: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)Double.longBitsToDouble( lbits );</code> </pre><br>  Which in the same way converts a double-variable to float. <br>  Thus, we have seen that, at least in openjdk, the most obvious ways of converting double to float are reduced to one construction: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> f = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) d;</code> </pre><br><h4>  Float and double storage formats </h4><br>  In each example, we called the Long.toBinaryString functions for Double and Integer.toBinaryString for Float to demonstrate the low-level storage formats for the created variables.  A wonderful article about this has already been written ( <a href="http://habrahabr.ru/post/112953/">What you need to know about floating-point arithmetic</a> , which has become an excellent translation of the <a href="https://en.wikipedia.org/wiki/Single-precision_floating-point_format">English wiki</a> , where it is well described and <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">about double precision</a> ), so here we will look only at what concerns rounding. <br>  The above programs returned the following results: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> <span class="hljs-number"><span class="hljs-number">2974815.7800000000</span></span> <span class="hljs-number"><span class="hljs-number">100000101000110101100100010111111100011110101110000101000111101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">2974815.7500000000</span></span> <span class="hljs-number"><span class="hljs-number">1001010001101011001000101111111</span></span></code> </pre><br>  The double type is 64 bits, and the float type is 32, but we see 63 and 31 characters - this is the cost of implementing the output, which ends when only zeros are left.  Therefore, these numbers should look like this: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> <span class="hljs-number"><span class="hljs-number">2974815.7800000000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">10000010100</span></span> <span class="hljs-number"><span class="hljs-number">0110101100100010111111100011110101110000101000111101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> <span class="hljs-number"><span class="hljs-number">2974815.7500000000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">10010100</span></span> <span class="hljs-number"><span class="hljs-number">01101011001000101111111</span></span></code> </pre><br>  The first bit is the sign of the number.  Further 11 (for double) or 8 bits (for float) - an exponent.  After - the mantissa, which plays the most interesting role.  First impression: all numbers after the 23rd bit are simply lost when converting from double to float.  But let's first try to restore these numbers in order to sort things out in order: <br><ul><li>  1st bits 0 =&gt; positive signs </li><li>  Further exhibitors: 010000010100 <sub>2</sub> -1023 <sub>10</sub> = 21 <br><br>  and 10010100 <sub>2</sub> -127 <sub>10</sub> = 21 <br></li><li>  Mantissas: 1.0110101100100010111111100011110101110000101000111101 <sub>2</sub> * 2 <sup>21 - 52</sup> = 2974815.779999749 <br><br>  and 1.01101011001000101111111 <sub>2</sub> * 2 <sup>21 - 23</sup> = 2974815.75 <br></li></ul><br>  Thus, cutting from the binary 0110 1011 0010 0010 1111 1110 0011 1101 0111 0000 1010 0011 1101 from the double last 29 digits, we get 011 0101 1001 0001 0111 1111 in the float, which gives us a slightly different number. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Conclusion </h4><br>  Thus, converting from a higher accuracy format can lead to nontrivial loss of reliability of the numbers used.  As for Java itself, it‚Äôs better to use the Double type, since  working with Float is fraught with conversions from Double with losses.  And for storing money use BigDecimal, so as not to lose a penny. <br><br><h4>  PS </h4><br>  In the error tracking system of the project OpenJDK found tightly related to this topic: <br><ul><li>  <a href="https://bugs.openjdk.java.net/browse/JDK-7192954">Fix Float.parseFloat to correct monotonicity.</a>  - we have already figured out with you why this is happening </li><li>  <a href="">Direct String-to-float conversion is not preserve monotonicity</a> - the same </li></ul><br>  In the traversal for these tasks it is written: <br><blockquote>  CUSTOMER SUBMITTED WORKAROUND: <br>  Avoiding direct String-to-float conversion by using intermediate doubles. <br></blockquote><br><br><h4>  Proposed solutions </h4><br><ol><li>  Store money in BigDecimal <s>banks</s> : <br><pre> <code class="java hljs"> BigDecimal bg = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BigDecimal(<span class="hljs-string"><span class="hljs-string">"2974815.78"</span></span>); System.out.println(bg);</code> </pre><br></li><li>  Currency class by type: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Currency</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">asDouble</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> / <span class="hljs-number"><span class="hljs-number">100.0</span></span>; } ... &lt;   ,  ..   , ,  StringTokenizer&gt; ... }</code> </pre><br>  I think the decision will entail other errors / features, although it has the right to life. <br></li></ol></div><p>Source: <a href="https://habr.com/ru/post/201066/">https://habr.com/ru/post/201066/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201048/index.html">Filtering by the registry of prohibited sites for Internet providers</a></li>
<li><a href="../201054/index.html">Attempt to transition from Entity Framework 5 to 6 or DataBase-First = Code-First + chart browser</a></li>
<li><a href="../201058/index.html">Security certification and personal data</a></li>
<li><a href="../201062/index.html">Furious bulls: how Wall Street became dependent on "high-speed" trades. Part 1</a></li>
<li><a href="../201064/index.html">Redmine. How to write plugins</a></li>
<li><a href="../201068/index.html">Nokia Lumia 525 & Lumia 720 Dual Sim. We wait?</a></li>
<li><a href="../201070/index.html">Neurocam: iPhone as an analog of Google Glass?</a></li>
<li><a href="../201072/index.html">BitTorrent Sync: speed up to 90 megabytes / s and open API</a></li>
<li><a href="../201074/index.html">Log in to VK with OAuth 2.0 under Windows 8</a></li>
<li><a href="../201076/index.html">Behavioral advertising ‚â† government surveillance. Time to clear up</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>