<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What hung the system: a bug or flare at the sun?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Source data: three Oracle database systems that actively exchange data with each other through the Oracle distributed transaction mechanism. At one po...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What hung the system: a bug or flare at the sun?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/js/oo/td/jsootddshcthnyjka9a_qmkqgbg.png"><br><br>  Source data: three Oracle database systems that actively exchange data with each other through the Oracle distributed transaction mechanism.  At one point, all servers admins began to observe the occurrence of queues when an application tries to insert / update data.  Immediately sent signals for the immediate completion of processes that blocked the work of users.  After half an hour of proceedings, it was decided to restart all three systems.  Then we started the procedures for clearing the hung up distributed transactions, which were in the COLLECTING and PREPEARED statuses.  Details on what to do in this case can be read in the document: How To Resolve Stranded DBA_2PC_PENDING Entries [ID 401302.1].  After the systems were brought into working condition, the analysis began. <br><a name="habracut"></a><br>  The main question is what caused the system crash?  Yes, during the incident, a system was detected (one of the three), which at the initial diagnostics stage worked with anomalies (let's call it system X).  Login to the OS passed, but it was impossible to connect to the database.  Moreover, these health check notification systems recorded that with system X, full order and during hangup, they didn‚Äôt pay attention to it.  The problems were initially fixed in two other systems (let's call them Y and Z), so all attention was paid to them. <br><br>  Began collecting diagnostics.  Something has already been done before and during the hang.  Looking ahead, I will say that the screenshots of the profiles of the processes being deleted from the monitoring system really helped, just before they were deleted. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  On systems Y and Z from the history of active sessions, the statistics of processes deleted in the first place were unloaded.  The processes before their deletion appeared in the history of active sessions, each of them was expecting SQL * Net message from dblink from remote system X. And then the first anomaly appeared.  After the 12:32:08 time stamp, the active session history lines in the statistics columns of the consumed CPU, DB time (TM_DELTA_CPU_TIME, TM_DELTA_DB_TIME) showed empty data. </li><li>  Analysis of database trace files and system X listener. In the alert.log database, the last timestamp before system restart is Time: 06-SEP-2017 12:27:18.  In the listener magazine - Wed Sep 06 12:27:18 2017. In the directory with trace files, the latest change in the NMON file was at 12:26. </li><li>  The history of active sessions on system X showed that the last entry from the range 12:20 - 14:00 was made by background processes at 12.27.33.  In our case, the Oracle server has stopped saving history data since 12:27:33. <br><br><img src="https://habrastorage.org/webt/fu/h-/sw/fuh-swrkpqinodmu08koyufhhsy.png"></li><li>  Obviously, something happened with the database on the system side X. We decided to look in detail at the statistics of the OS (CPU, I / O, etc.) of server X. <br><br><img src="https://habrastorage.org/webt/lv/74/uy/lv74uydcw7zbhcsj4rzwldd0mgm.png"><br><br>  There were significant expectations. Wait% - when user processes were expecting the ability to write / read data from the disk (there was also a complete lack of kernel write / read system calls, network I / O and a drop in RunQueue).  The waiting time is also 12:28. </li><li>  With a DB and OS understood.  We decided to look at the underlying level - the file system and storage.  No data was found on the storage system, but on Veritas, the output of the errpt team showed the following picture (too much was removed): <br><blockquote>  BC3BE5A3 0906140317 PS SRC SOFTWARE PROGRAM ERROR <br>  A6DF45AA 0906140317 IO RMCdaemon The daemon is started. <br>  BC3BE5A3 0906140217 PS SRC SOFTWARE PROGRAM ERROR <br>  D221BD55 0906140217 IO perftune RESTRICTED TUNABLES MODIFIED AT REBOOT <br>  B258EF25 0906140117 TS VxDRV: vxdmp vxdmp driver <br>  B258EF25 0906140117 TS VxDRV: vxdmp vxdmp driver <br>  B258EF25 0906140117 TS VxDRV: vxdmp vxdmp driver <br>  ... deleted ... &lt; <br>  B258EF25 0906122817 TS VxDRV: vxdmp vxdmp driver <br>  B258EF25 0906122817 TS VxDRV: vxdmp vxdmp driver </blockquote></li></ol><br><h2>  Subtotal </h2><br>  The main cause of the problems was the denial of service to the system X in the area of ‚Äã‚Äã12:27 (28) local server time.  This can be clearly seen from the database logs, the listener, trace files, data of the history of active sessions and Veritas FS logs.  It is also confirmed by the absence of activity after the mark of 12:32 on systems Y and Z with network expectations of processes during data insertion and committing of distributed transactions.  These processes blocked other sessions, which led to the formation of large queues of processes on server Y. Blocking sessions were subsequently terminated abnormally. <br><br>  The difference in the timestamps of service stopping on Y, Z and X is due to the server X delaying by ~ 4 minutes from other systems.  If we subtract this delta from the time of the end of activity of processes on Y and Z (see paragraph 1 above), we get 12:27 (28) - the numbers of the last activity, which are shown by the DB logs, the listener and the history of active sessions on system X. <br><br>  If you restore the sequence of events, the chain is as follows: inaccessibility of the system X-&gt; appearance of queues on Y and Z -&gt; then - removal by administrators of blocking processes and further avalanche-like development with the hang of distributed transactions of the remaining system components. <br><br>  So, it looks like the file is in the VxFS file system from Veritas (FS) on which the database files, the database trace files and the listener were located.  The FS hibernated and the rest of the processes waited until the I / O operation was completed.  We decided to reproduce the problem using the fsfreeze command on test systems - a very similar picture.  A search on the Veritas vendor site found a description of a bug with similar symptoms: Doc Id: 3898129 with symptoms: IO's hung in DRL. <br><br><h2>  Unexpected </h2><br>  The next day I open the news feed - and there are reports of flares on the Sun on September 6.  On September 7, news headlines were full of reports about how this anomaly affected communications systems, people, etc. <br><br><blockquote>  September 6, 2017 14:05, rg.ru, ‚ÄúScientists: A powerful flare on the Sun will impact the Earth‚Äù <br>  September 6, 2017 14:44, rbc.ru, ‚ÄúAstronomers have registered the most powerful flare in the Sun in 12 years‚Äù <br>  September 6, 2017 15:34, rg.ru, ‚ÄúVideo: Due to a powerful flash on the Sun, Moscow will see aurora‚Äù <br>  September 6, 2017 23:54, rg.ru, ‚ÄúScientists have told about the consequences of a powerful flare on the Sun‚Äù </blockquote><br>  Some people thought that it was necessary, along with the bug in Veritas FS, to consider this version as working.  Then I did not attach much importance to this. <br><br>  The other day I decided to tightly deal with this issue.  On the Internet, he went to the website of the Laboratory for the X-ray Astronomy of the Sun (FIAN), which publishes statistics on solar activity from the GOES-15 satellite.  I open the page with data for September 6 - and so what?  At KDPV, the surge of activity on the C2.7 flash just falls at the start of problems with the operation of server X, and very close to the maximum flash - 12:34.  I checked the time again - isn't it UTC?  No, the time is local.  Well, this can not be.  Coincidence? <br><br>  However, an additional search brought to the article on Geektimes: <a href="https://geektimes.ru/post/286102/">Cosmic radiation can affect systems</a> . <br><br>  It turns out that this is rare, but it happens.  Such events are called ‚Äúsingle-event upset (SEU)‚Äù.  Most often occur at high altitude or near-earth orbit, but they also occur on Earth.  Quote: <br><br><blockquote>  Although there are quite vivid examples of equipment failures, SEUs remain an extremely rare phenomenon.  But experts note that electronic chips are increasingly used in various household appliances.  The density of transistors on chips increases, as well as their number.  Because of this, the likelihood of meeting with the "space crash" is growing every year.  Electrical manufacturers are exploring the problem. </blockquote><br>  It seems that solar activity may well affect the stability and sustainability of information systems.  What will be their reliability with the further miniaturization of technical processes and more dense packing of chips?  Question. <br><br>  That's all. <br>  Take care of yourself! <br><br>  <i>Alexander Kardapolov, service engineer of Jet Infosystems</i> </div><p>Source: <a href="https://habr.com/ru/post/346502/">https://habr.com/ru/post/346502/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346492/index.html">A story about how I live via meltdown on your phones using npm</a></li>
<li><a href="../346494/index.html">Expectations and reality - our experience in creating and promoting mobile games</a></li>
<li><a href="../346496/index.html">A new ‚Äúpassword‚Äù vulnerability has been discovered on Mac OS High Sierra.</a></li>
<li><a href="../346498/index.html">Tutorial on the Unreal Engine. Part 9: Artificial Intelligence</a></li>
<li><a href="../346500/index.html">JavaScript features that I didn't know existed</a></li>
<li><a href="../346504/index.html">AB-DOC beta testing</a></li>
<li><a href="../346506/index.html">How I searched for dependencies through include files in java</a></li>
<li><a href="../346508/index.html">Perhaps the most unusual puzzle on Google Play</a></li>
<li><a href="../346512/index.html">Terabit death. Potential cyber attacks on virtual servers. US Department of Defense under threat</a></li>
<li><a href="../346514/index.html">Nigerian stories of the Russian developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>