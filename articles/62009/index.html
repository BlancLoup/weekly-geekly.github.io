<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up and using Web Optimizer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="While the release of version 0.5 of a web application that automates client optimization for PHP sites is postponed for some indefinite time, we decid...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up and using Web Optimizer</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://code.google.com/p/web-optimizator/"><img src="https://habrastorage.org/getpro/habr/post_images/4e2/237/d1f/4e2237d1f53b2814869fb2e6c65555d3.png" alt="Download Web Optimizer" align="right"></a>  While the release of version 0.5 of a web application that automates client optimization for PHP sites is postponed for some indefinite time, we decided to prepare a small overview of the current settings and capabilities of the application. <br><br><h3>  Features of work </h3><br>  Web Optimizer intercepts the output HTML document and converts it to its optimal form.  In particular, the entire <code>head</code> section is analyzed for CSS and JavaScript files, and when static hosts exist, images are distributed over them (the addresses of images change), and blocks with ads and counters are transferred before <code>&lt;/body&gt;</code> (again, only enable the corresponding setting).  Also, HTML is minimized (unnecessary line breaks and indents are removed, comments can be deleted, and in general all unnecessary characters, but these are resource-intensive operations, and by default they are turned off). <br><br>  Download application <br>  <a href="http://code.google.com/p/web-optimizator/downloads/list">code.google.com/p/web-optimizator/downloads/list</a> <br><a name="habracut"></a><br><h3>  Configuring Web Optimizer </h3><br>  Below are the settings available in Web Optimizer version 0.4.9.7 (they will be included in 0.5 without any changes): <br><ul><li>  <strong>Caching directories</strong>  Here you can set the paths to the caching directories (on the file system) in which the saved reduced CSS, JavaScript and HTML files will be written.  Also here you can determine the root directory of the site (necessary for the correct calculation of all relative paths).  By default, all caching directories are assigned to the <code>cache</code> folder in the Web Optimizer itself. </li><li>  <strong>Compression Settings</strong>  This group of settings is responsible for combining and minimizing JavaScript and CSS files.  By default, JavaScript files are combined and minimized using JSMin (or YUI Compressor, if <code>java</code> is available).  You can also compress JavaScript using the Dean Edwards Packer (it is the best choice in the absence of <code>gzip</code> compression).  Here you can also configure how to minimize the output HTML-code (simple deletion of extra line breaks and spaces, ‚Äústretching‚Äù in one line and (li) deleting comments).  Conditional comments for IE are not affected in any way. </li><li>  <strong>Include external javascript files</strong> .  Web Optimizer can load external JavaScript files (called from other domains), as well as internal code (enclosed directly in <code>&lt;script&gt;</code> ).  Here you can customize and ‚Äúglue‚Äù the CSS code located in <code>&lt;style&gt;</code> (enabled by default).  You can also specify (separated by a space) file names (names, not full paths) that should be excluded from the merge logic.  During the testing phase, it was discovered that it was impossible to combine the source libraries of the Tiny MCE and the FCE Editor, so they are excluded by default. </li><li>  <strong>Unobtrusive JavaScript</strong> .  This group contains settings that are responsible for non-blocking downloading of various JavaScript options.  In particular, you can put the combined JavaScript file before <code>&lt;body&gt;</code> (or even cause it to load on the <code>DomContentLoaded</code> event), you can put the download of some counters, ads and informers to the bottom of the document (after the JavaScript code, the resulting HTML code is inserted into the original place on the page, ensuring the gradual appearance of additional ad units after the main content has been loaded). </li><li>  <strong>Do not check the time change</strong> .  This setting allows you not to check when loading every page the time and the content of all files, only the existence of cached versions.  Due to this, we get a significant increase in server performance (by default, the setting is enabled).  In the case of debugging or very frequent changes to the original JavaScript-or CSS-files, it is better to disable the setting. </li><li>  <strong>Gzip compression (archiving)</strong> .  This group of settings controls whether JavaScript, CSS- or HTML-files are sent to the browser as archives.  Gzip-compression saves 70-85% of traffic when transferring text files, but it may be (especially in the case of compression through PHP and high-loaded projects) that is not very optimal for the server.  In any case, whenever possible, all compression settings are placed in <code>.htaccess</code> (for CSS- and JavaScript- in a static form).  When it is impossible to change <code>.htaccess</code> gzip-versions of JavaScript and CSS-code are saved in caching directories, which also reduces the load on the processor (via PHP) to a minimum. </li><li>  <strong>"Eternal" caching</strong> .  The settings of this group are responsible for setting caching headers for JavaScript-, CSS-, HTML- or static files (images and animations).  For images and animations, the corresponding rules are placed only in <code>.htaccess</code> ; for other files, they are duplicated as needed via PHP.  By default, static files are set to a caching period of 10 years (when files change, new versions have a different name, based on the md5 hash of the total file contents).  For HTML files, it is possible to manually set the appropriate expiration date of the client cache.  The difference between this setting and the following group (server-side caching of HTML files) is that the HTML output is not saved on the server in any way, we only indicate to browsers that they may not re-request HTML documents for a certain time.  Whether browsers will follow this directive or not remains entirely in their conscience. </li><li>  <strong>Caching HTML files</strong> .  To substantially speed up the server side, in almost all cases, server caching is required.  And almost all CMS support it (at one level or another).  Web Optimizer offers an alternative option (for those cases when the current system is not able to do this, or a more ‚Äútough‚Äù solution is needed): simple caching of HTML documents.  When this setting is enabled, HTML files are saved in the caching directory and are sent the first time Web Optimizer is called, without processing the internal logic of the system.  Naturally, the cache expiration date is taken into account.  It is also possible to issue not the entire document at once, but the first 1-2 Kb (by resetting the document), and then calculate the rest.  This can help visually speed up page loading on some environments.  To configure caching, there is a list of parts of the site URL that need to be excluded (it is possible to set regular expressions) and a list of robots (USER AGENTS) for which you need to force the output of the caching file. </li><li>  <strong>CSS Sprites</strong> .  Perhaps the most technologically powerful and most controversial part of Web Optimizer.  Proper use of sprites allows an order of magnitude (!) To reduce the number of requests to the server when loading a page with a large number of background images (from 20-100 to 3-10).  However, there are some problems with the display of combined images for IE6 (images are created by default in the 32-bit palette, and IE6 cannot correctly handle transparency for such PNGs), problems are eliminated by excluding IE6 from creating sprites (with the appropriate settings) or using opaque images.  Also available are settings for using JPEG instead of PNG for full-color images, ‚Äúaggressive‚Äù mode ( <code>repeat-x</code> and <code>repeat-y</code> will be combined without taking into account the actual size of the containers), adding free space (avoiding rudiments when scaling such images in modern browsers). <br>  To improve the stability of the work, the ‚Äúlimited‚Äù memory mode is added: if the PHP process has less than 64 MB of memory (this is enough to create a sprite of about 3000 by 3000 pixels, which is quite enough for most sites), then images with an area of ‚Äã‚Äãmore than 4000 pixels will have excluded.  There is also a setting for excluding large images by their linear dimensions (in pixels, the default is 900) and direct exclusion of files (again, file names are specified, not the full path to them) from the process of creating CSS Sprites. </li><li>  <strong>data: URI</strong> .  The <code>data:URI</code> technology allows you to include background images directly in the CSS file.  Supported by all modern browsers and IE8.  It has an image size limit of 24 KB (32 KB <code>data:URI</code> code is derived from 24,576 bytes of the binary code).  When creating a <code>data:URI</code> for IE7, hacks are inserted into the CSS file, which makes the site design unchanged for these browsers.  Also, when creating a <code>data:URI</code> it is highly desirable to optimize images.  This is done using the <a href="http://smush.it/" rel="nofollow">smush.it</a> API.  To correctly optimize images, you need write access for the web server to the images themselves.  This setting is disabled by default, because it makes sense to optimize images only once, and use the ready-made result on subsequent builds of CSS files. </li><li>  <strong>Multiple hosts</strong> .  This setting allows you to enable the distribution of images on static hosts.  Each image will always correspond to one host (to avoid clogging the cache with the same images from all available hosts).  To use this download acceleration mechanism, you must register all alternative hosts in the DNS for the IP address that will serve them (usually the current site) and add aliases to the main site in the form of these hosts in the server configuration.  For example: <blockquote><pre>  ServerAlias ‚Äã‚Äãi1.site.ru
 ServerAlias ‚Äã‚Äãi2.site.ru </pre></blockquote>  After that, you can add <code>i1 i2</code> to the list of hosts for Web Optimizer and make sure that the images are scattered across these hosts.  When installing Web Optimizer, a number of hosts are automatically checked for the possibility of their use as alternative (with the same site root), and all manually specified hosts are checked for availability (test images are loaded from them).  It should be borne in mind that if you turn on the ‚Äúsafe‚Äù installation (about it below), the host check becomes inaccessible and you will need to register it manually without restarting the Web Optimizer setting. </li><li>  <strong>Using <code>.htaccess</code></strong> .  Most of the gzip-compression and caching settings can be recorded in your server's configuration file to avoid additional work on the server-side scripts.  This can be done using the <code>.htaccess</code> file (if necessary, you can later transfer all the settings yourself to the <code>httpd.cond</code> file).  Web Optimizer automatically checks available modules and configures the entry to <code>. htaccess</code>  <code>. htaccess</code> (of course, for this, the latter must be available for writing).  <code>mod_gzip</code> , <code>mod_deflate</code> and <code>mod_filter</code> are responsible for on-the-fly file compression, <code>mod_rewrite</code> and <code>mod_mime</code> are for static archiving.  <code>mod_headers</code> and <code>mod_setenvif</code> - for ensuring correct processing of compressed files on proxying servers and in old browsers.  <code>mod_expires</code> - for exhibiting cache eagolovkov.  It is also possible to locate <code>.htaccess</code> either in the site directory (this is useful if there are several sites on different directories on the same host) or at the very root of the site.  By default, both locations are the same.  It is also possible to protect a Web Optimizer installation with <code>.htpasswd</code> .  In this case, to access the settings, you will need to enter your login and password through the HTTP Basic Authorization window in the browser (this allows Web Optimizer to be placed in an arbitrary directory within the site, after placing the caching directories outside the protected area). </li><li>  <strong>Logo Web Optimizer</strong> .  At the moment, this group of settings is not used at all.  Maybe in the future, a small print ‚ÄúAccelerated with the Web Optimizer‚Äù will be added to each site with a link to the project.  But so far no decisions have been made on this topic. </li><li>  <strong>Automatic change <code>/index.php</code></strong> .  Web Optimizer supports automatic change of files required for correct operation for several dozen CMS (in the case of an unknown system, its name is displayed as CMS 42, and the root <code>index.php</code> always changed).  Before the file is automatically modified, chain site optimization is launched to create all caching files and to avoid long loading of the main page of the site for the first time. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Examples of using </h3><br>  Web Optimizer is quite a powerful and flexible tool for client optimization of an arbitrary site.  But correct setting it requires care and understanding of the desired result.  Let's look at some of the most characteristic changes in the default configuration. <br><ul><li>  <strong>Connection of common (or) JavaScript or CSS file (s) on all pages</strong> .  Quite often we can insert on all pages some kind of common JavaScript library or style sheet, which is necessary for the entire site.  In order for Web Optimizer not to try to merge this common file with all others, you can exclude it in the configuration: <blockquote><pre>  Include external JavaScript files and embedded code -&gt; Exclude files from a union -&gt; comma-separated list of files </pre></blockquote></li><li>  <strong>Disable CSS Sprites</strong> .  There are cases when, due to a number of reasons (lack of proper support for GDLib on hosting, memory limitations, etc.) an attempt to create CSS Sprites results in a ‚Äúwhite screen‚Äù in the browser (and the site stops opening).  In such cases, the complete disabling of the CSS Sprites usually helps: <blockquote><pre>  CSS Sprites -&gt; Apply CSS Sprites -&gt; No </pre></blockquote>  If desired, CSS Sprites can be created manually via <a href="http://sprites.in/">Auto Sprites</a> , specifying a minimized CSS file (or a combined source file). </li><li>  <strong>Incorrect display of the site in IE6</strong> .  In this case, simply turning off sprites for IE6 can help: <blockquote><pre>  CSS Sprites -&gt; Exclude IE6 (via hacks) from creating CSS Sprites -&gt; yes </pre></blockquote>  It is also possible that IE6 incorrectly handles the merging of styles (and the background overlay along with a number of other hacks).  Then disabling <code>data:URI</code> can help <blockquote><pre>  Data: URI -&gt; Apply data: URI -&gt; no </pre></blockquote>  or generally combining CSS files: <blockquote><pre>  Compression settings -&gt; Minimize and merge CSS files -&gt; no </pre></blockquote></li><li>  <strong>Secure installation</strong> .  Web Optimizer can be installed in an arbitrary directory (inside the site) and protected with a password via <code>htpasswd</code> .  To do this, enable: <blockquote><pre>  Using .htaccess -&gt; Protect Web Optimizer installation with htpasswd -&gt; yes </pre></blockquote>  At the same time, you need to make sure that the <code> </code> are located outside the folder with the Web Optimizer itself (otherwise everything will fall apart for all site visitors except yourself). </li><li>  <strong>Connection for static site</strong> .  Web Optimizer can be used for any site for which PHP is available.  If you already have a static site, then you can enable the Web Optimizer call at the very top of each page (or <code>index.php</code> ): <blockquote><pre>  &lt;? php
 require (/path/k/Web/Optimizer/web.optimizer.php);
 ?&gt; </pre></blockquote>  and then at the very bottom of the page: <blockquote><pre>  &lt;? php
 $ web_optimizer-&gt; finish ();
 ?&gt; </pre></blockquote>  Since in the planned mode (after creating all the caching files), Web Optimizer logic execution takes 5-10ms, this will not affect the server side of the download, but the client side will be significantly accelerated.  You just have to make sure that the pages to which you add Web Optimizer calls will be processed through the PHP interpreter (they will have the extension <code>.php</code> or some other one defined by the server settings). </li><li>  <strong>Schedule optimization</strong> .  Already, Web Optimizer can be built into the scheme for publishing an arbitrary site in ‚Äústatic‚Äù mode.  To do this, you need to open all the pages of the site with the installed Web Optimizer, and then just copy the output HTML and caching directories.  Suppose that Web Optimizer is installed on <code>dev.site.ru</code>  By running, for example, <code>wget</code> <blockquote><pre>  wget -d -r -c http://dev.site.ru/ </pre></blockquote>  we get an optimized "cast" of the site, which can be downloaded already in the working system. </li><li>  <strong>Gluing HTML in one line</strong> .  As already described above, Web Optimizer can ‚Äútrace‚Äù all the output HTML in one line.  To do this, enable <blockquote><pre>  Compression Settings -&gt; Compress HTML to 1 line -&gt; yes
 Compression Settings -&gt; Delete HTML Comments -&gt; Yes </pre></blockquote>  It should be immediately noted that these settings add additional load on the server (correct regular expression is quite resource-intensive) and can lead to cutting out some JavaScript-code (which is inserted through comments).  Also, the code inside the <code>script</code> , <code>textarea</code> , <code>pre</code> will not change (in accordance with the specification).  Therefore, you need to use these settings with great care. </li><li>  <strong>Image optimization through <a href="http://smush.it/" rel="nofollow">smush.it</a></strong> .  The smush.it service is developed by Yahoo!  and Google and allows you to optimize the size of background images automatically.  It is possible to connect image optimization through the CSS Sprites library (this example in version 0.4.9.7 does not work yet, but is already available in SVN and will be included in 0.5): <blockquote><pre>  &lt;? php
 require ('/ full / path / to / css.sprites.php');
 $ smushit = new css_sprites ();
 $ smushit-&gt; smushit ('/ full / path / to / image');
 ?&gt; </pre></blockquote>  as a result, instead of an image (if you have rights to change it), we will get an optimized copy of it.  It is better to carry out not on a group of working images, but on their copies, so that you can roll back the changes. </li></ul><br>  Download application <br>  <a href="http://code.google.com/p/web-optimizator/downloads/list">code.google.com/p/web-optimizator/downloads/list</a> </div><p>Source: <a href="https://habr.com/ru/post/62009/">https://habr.com/ru/post/62009/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../62000/index.html">Eat this delicious juicy CPU (solution to the problem with the CPU)</a></li>
<li><a href="../62002/index.html">Expanded collection of CSS hacks</a></li>
<li><a href="../62003/index.html">The idea of ‚Äã‚Äãa social network of amateur athletes</a></li>
<li><a href="../62005/index.html">Original bug with iframe and DOM in IE</a></li>
<li><a href="../62008/index.html">Where can I get VPS / VDS?</a></li>
<li><a href="../62011/index.html">Funny Facebook Names</a></li>
<li><a href="../62012/index.html">ServStory.ru - new service? No, "History Pro Service"</a></li>
<li><a href="../62013/index.html">Internet projects at the idea stage</a></li>
<li><a href="../62014/index.html">Add Sphinx to Denver</a></li>
<li><a href="../62015/index.html">Think about links</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>