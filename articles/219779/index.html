<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sharing code between WP, Win8. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last article we looked at the basics of sharing code. This article can be supplemented with the possibility of sharing between W8.1 and WP8.1 d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sharing code between WP, Win8. Part 2</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="http://habrahabr.ru/company/mailru/blog/217691/">last article</a> we looked at the basics of sharing code.  This article can be supplemented with the possibility of sharing between W8.1 and WP8.1 demonstrated at the Build conference.  This approach is very well described <a href="http://habrahabr.ru/company/microsoft/blog/218441/">here</a> , so now we will not dwell on Universal Apps in detail. <br><img src="https://habrastorage.org/getpro/habr/post_images/2b4/7f7/134/2b47f7134b60dd8c6328067489349e43.png"><br>  In general, Microsoft is pleased with the steps to unify the code for both platforms, but still we still have a legacy in the form of Windows Phone 7. In addition, you may have to fumble the code on the desktop, Android, etc. <br><br>  In this article, we will look at one of the most commonly used practical solutions for Sharing code. <br><a name="habracut"></a><br><h1>  Preparing for the sharing code </h1><br>  The following ‚Äútools‚Äù significantly simplify the writing of cross-platform applications, but since there are quite a few articles / books written about these approaches and patterns, we will not dwell on these points in detail. <br><br>  <a href="http://ru.wikipedia.org/wiki/Model-View-ViewModel">The MVVM pattern has</a> actually become almost an obligatory quality standard when developing applications for WP, W8, WPF, Silverlight;  and in spite of the fact that it is not necessary to use it at all, yet this approach often saves a lot of time and code when creating complex applications. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      One of the main misconceptions that I often come across is the opinion that you can just take and use MVVM, and the quality will come by itself.  Or that this pattern will replace, for example, the classic three-link.  In fact, MVVM does not completely deny the selection of application logic and data storage logic.  In fact, everything is exactly the opposite: if you write all the application logic and data storage logic directly in the VM, then, in fact, we get the same Code-Behind, only in the VM, and the application becomes clogged very quickly and becomes difficult to maintain. <br><br>  The most popular framework for WP and WinRT is, perhaps, <a href="https://mvvmlight.codeplex.com/">MVVM Light</a> , but in my applications, I most often prefer to use my own lightweight self-written framework. <br><br>  <a href="http://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D0%25B2%25D0%25B5%25D1%2580%25D1%2581%25D0%25B8%25D1%258F_%25D1%2583%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F">Inversion Of Control</a> - if we can do without MVVM when writing cross-platform applications, then, perhaps, inversion of control is a must-have tool.  Even in the case of applications for a single platform, IoC greatly simplifies the development of flexible, extensible and, accordingly, convenient for further maintenance of applications. <br><br>  The main idea of ‚Äã‚Äãusing IoC in developing cross-platform applications is a generalization of features for each platform using an interface and a specific implementation for each platform. <br><br>  There are many ready-made IoC containers, but in my applications I use either a self-service Service Locator (which many people believe is anti-pattern), and in some projects I use the lightweight framework SimpleIoC (which, by the way, comes bundled with MVVM Light). <br><br>  Consider an example of the preservation of the text from the <a href="http://habrahabr.ru/company/mailru/blog/217691/">previous article</a> , where we shared the features of preserving text with the help of the directive "#if WP7".  It was possible to implement this example a little differently.  For example, if this method is in a certain class with DataLayer, then our code could look like this: <br><br>  In a project with a common code (for example, the Portable Library, which we will discuss below), we can identify a common interface for saving text: <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IDataLayer</span></span> { <span class="hljs-function"><span class="hljs-function">Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br>  We can use this interface in our logic layer.  For example: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LogicLayer</span></span> : <span class="hljs-title"><span class="hljs-title">ILogicLayer</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IDataLayer dataLayer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogicLayer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IDataLayer dataLayer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dataLayer = dataLayer; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SomeAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { dataLayer.SaveText(<span class="hljs-string"><span class="hljs-string">"myText"</span></span>); } }</code> </pre> <br>  As you can see, the layer of logic does not know anything about how and where the text will be saved. <br>  Accordingly, the text saving implementation for WP7 / WP8 might look like this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DataLayerWP</span></span> : <span class="hljs-title"><span class="hljs-title">IDataLayer</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> local = IsolatedStorageFile.GetUserStoreForApplication()) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = local.CreateFile(<span class="hljs-string"><span class="hljs-string">"DataFile.txt"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> streamWriter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamWriter(stream)) { streamWriter.Write(text); } } } } }</code> </pre> <br>  And, accordingly, for WP8 / W8 there may be the following code: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DataLayerWinRT</span></span> : <span class="hljs-title"><span class="hljs-title">IDataLayer</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SaveText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fileBytes = Encoding.UTF8.GetBytes(text); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> local = ApplicationData.Current.LocalFolder; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> file = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> local.CreateFileAsync(<span class="hljs-string"><span class="hljs-string">"DataFile.txt"</span></span>, CreationCollisionOption.ReplaceExisting); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> file.OpenStreamForWriteAsync()) { s.Write(fileBytes, <span class="hljs-number"><span class="hljs-number">0</span></span>, fileBytes.Length); } } }</code> </pre> <br>  Of course, the names of the classes may coincide, since these classes are specific implementations and each of them will be in a project with a specific platform. <br><br>  All that is now left is to register in each of the projects a specific implementation.  If we take the example of SimpleIoC, then the registration might look like this (in our case for WP7): <br><br> <code>SimpleIoc.Default.Register&lt;IDataLayer,DataLayerWP&gt;();</code> <br>  and in a project with WP8: <br> <code>SimpleIoc.Default.Register&lt;IDataLayer,DataLayerWinRT&gt;();</code> <br> <br>  Thus, we can share almost everything: page-by-page navigation, receiving data from sensors, opening an html page on a client, etc.  etc. <br><br>  For those who plan to actively use Xamarin, I can recommend <a href="https://xamarin.com/mobileapi">Xamarin mobile api</a> , which is a set of specific implementations for solving a wide variety of tasks, such as storing data, getting a user's location, taking a picture from a camera, etc. <br><br>  Portable Library.  Starting from VS2012, we were able to use a new type of project, the Portable Library (PL).  Strictly speaking, we got this opportunity also with VS2010, but as a separately installed extension.  PL allows you to create applications with common code, and the main ‚Äútrick‚Äù of this type of project is that PL automatically uses only those language features that are common to selected types of projects.  This imposes its own limitations and peculiarities of using this tool.  For example, you cannot use XAML in PL.  However, for applications with complex logic, PL will bring tremendous time and effort savings. <br>  Perhaps it‚Äôs worth mentioning separately the problem of using the CallerMember attribute, which is not supported by PL and which allows BaseViewModel to highlight the following common for all VM method: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">BaseViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">INotifyPropertyChanged</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> PropertyChangedEventHandler PropertyChanged; [NotifyPropertyChangedInvocator] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPropertyChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[CallerMemberName]</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> propertyName=</span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = PropertyChanged; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handler != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) handler(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertyChangedEventArgs(propertyName)); } }</code> </pre> <br>  What allows you to write instead: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { name = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(<span class="hljs-string"><span class="hljs-string">"Name"</span></span>); } }</code> </pre> <br>  Alternative entry without specifying a field: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { name = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } }</code> </pre> <br>  That, respectively, significantly simplifies the maintenance of the application. <br><br>  To add support for this attribute in PL, it is enough to manually declare it: <br>  CallerMemberNameAttribute.cs <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">System.Runtime.CompilerServices</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Summary: // Allows you to obtain the method or property name of the caller to the method. [AttributeUsage(AttributeTargets.Parameter, Inherited = false)] sealed class CallerMemberNameAttribute : Attribute { } // Summary: // Allows you to obtain the line number in the source file at which the method // is called. [AttributeUsage(AttributeTargets.Parameter, Inherited = false)] public sealed class CallerLineNumberAttribute : Attribute { } // Summary: // Allows you to obtain the full path of the source file that contains the caller. // This is the file path at the time of compile. [AttributeUsage(AttributeTargets.Parameter, Inherited = false)] public sealed class CallerFilePathAttribute : Attribute { } }</span></span></code> </pre> <br><br><h1>  Setup and connection </h1><br>  There were a lot of examples of using MVVM and IoC even on Habr√©, here are some links instead of inflating the article: <br>  <a href="http://habrahabr.ru/post/182354/">Xamarin + PCL + MVVM ‚Äî How to make it easier to write mobile applications for different platforms.</a>  - excellent article on the use of Xamarin and MVVM <br><br>  <a href="http://habrahabr.ru/post/137541/">Using the MVVM pattern when creating applications for Windows Phone</a> .  More details on MVVM and usage in WP can be found in this article. <br><br>  <a href="http://habrahabr.ru/post/145583/">Windows Phone + Caliburn.micro + Autofac</a> .  Another article about how to configure and use the popular MVVM framework Caliburn.Micro, and the equally popular IOC container Autofac when building web and desktop applications. <br><br>  Of course, this is not a definitive list, and in the vastness of Habr and the Internet you can find equally interesting articles on this topic. <br><br>  Next, we can consider the features of writing cross-platform applications using these tools. <br><br><h1>  Shared VM </h1><br>  The first obvious solution that comes to mind is to use a shared VM for each type of project.  In fairly simple projects, we can do just that. <br><br>  For example, a VM with a calculator that adds two numbers might look like this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainViewModel</span></span> : <span class="hljs-title"><span class="hljs-title">BaseViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> valueA; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ValueA { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> valueA; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { valueA = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> valueB; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ValueB { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> valueB; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { valueB = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ICommand CalculateCommand { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActionCommand(CalculateResult); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Result = ValueA + ValueB; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Result { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { result = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); } } }</code> </pre> <br>  And we can use this VM without changes in each of the platforms. <br><br>  In our simple case, we can have the same simple XAML code for both platforms for this VM. <br><pre> <code class="cs hljs">&lt;StackPanel&gt; &lt;TextBlock Text=<span class="hljs-string"><span class="hljs-string">"A:"</span></span>&gt;&lt;/TextBlock&gt; &lt;TextBox Text=<span class="hljs-string"><span class="hljs-string">"{Binding ValueA, Mode=TwoWay}"</span></span>&gt;&lt;/TextBox&gt; &lt;TextBlock Text=<span class="hljs-string"><span class="hljs-string">"B:"</span></span>&gt;&lt;/TextBlock&gt; &lt;TextBox Text=<span class="hljs-string"><span class="hljs-string">"{Binding ValueB, Mode=TwoWay}"</span></span>&gt;&lt;/TextBox&gt; &lt;Button Command=<span class="hljs-string"><span class="hljs-string">"{Binding CalculateCommand}"</span></span> Content=<span class="hljs-string"><span class="hljs-string">""</span></span>&gt;&lt;/Button&gt; &lt;TextBlock Text=<span class="hljs-string"><span class="hljs-string">"{Binding Result}"</span></span>&gt;&lt;/TextBlock&gt; &lt;/StackPanel&gt;</code> </pre><br><h1>  VM detailing for each platform </h1><br>  Often it is necessary to take into account the features of each platform.  For example, for Win8, where we have a big screen, the task arose of outputting the result in words as well, but for WP it was decided to output only the result less than 100 in words. <br><br>  The first and usually the wrong decision, which you immediately want to use, may look like this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Result { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { result = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); OnPropertyChanged(<span class="hljs-string"><span class="hljs-string">"ResultTextWP"</span></span>); OnPropertyChanged(<span class="hljs-string"><span class="hljs-string">"ResultTextWinRT"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ResultTextWP { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result.ToString(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NumberUtil.ToText(Result); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ResultTextWinRT { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NumberUtil.ToText(Result); } }</code> </pre> <br>  Where we can use each of the fields for a specific platform.  Instead, we can use inheritance as a VM customization, i.e.  in PL in the MainViewModel class, we can declare one virtual field ResultText: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Result { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { result = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; OnPropertyChanged(); OnPropertyChanged(<span class="hljs-string"><span class="hljs-string">"ResultText"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ResultText { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } }</code> </pre> <br>  Where we can replace the throw new NotImplementedException (), for example, with the return NumberUtil.ToText (Result), if we don‚Äôt want to force each heir to explicitly override this field for use <br><br>  Now we can inherit the MainViewModel in each project and override its property: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainViewModelWinRT</span></span> : <span class="hljs-title"><span class="hljs-title">MainViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ResultText { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NumberUtil.ToText(Result); } } }</code> </pre><br>  And for WP: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainViewModelWP</span></span> : <span class="hljs-title"><span class="hljs-title">MainViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ResultText { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (result &lt; <span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Result.ToString(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NumberUtil.ToText(Result); } } }</code> </pre> <br>  Of course, in the IoC container we have to register instead of the general MainViewModel a specific implementation for each platform. <br><br>  If we need ONLY one property of a VM on one platform, - by itself, there is no need to define it in the base class, then we can specify this property only for a specific platform.  For example, suddenly it took to show the date in the UI only for W8: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainViewModelWinRT</span></span> : <span class="hljs-title"><span class="hljs-title">MainViewModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ResultText { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NumberUtil.ToText(Result); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Date { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DateTime.Now.ToString(<span class="hljs-string"><span class="hljs-string">"yy-mm-dd"</span></span>); } } }</code> </pre> <br><br><h1>  Summary </h1><br>  At first glance, compared with the previous article, we get a huge amount of unnecessary headache with MVVM, IoC, etc., while we can simply link files and share features with #if directives. <br><br>  Unfortunately, the calculator example does not show the advantages, but only the receipt of a significantly larger amount of code for such a simple application. <br><br>  In practice, you can get much more advantages when building medium and large applications with complex logic, due to the fact that our code occupies a significantly larger part of the "service" code.  In addition, the application code becomes less connected and application maintenance is greatly facilitated. <br><br>  Unfortunately, there are still many items ‚Äúoverboard‚Äù that I did not include in this article, so as not to clutter up the main points of sharing code.  If you tell in the comments which problems / topics / solutions you are most interested in, then I can add this article with one more article. </div><p>Source: <a href="https://habr.com/ru/post/219779/">https://habr.com/ru/post/219779/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../219767/index.html">New image recognition algorithm from Google is able to recognize CAPTCHA with an accuracy of 99.8%</a></li>
<li><a href="../219769/index.html">Crank English with LinguaLeo: create thematic dictionaries, train your memory and train in a group!</a></li>
<li><a href="../219771/index.html">Service capable of rating your employees and business</a></li>
<li><a href="../219773/index.html">Smart watch do it yourself for 1500 rubles. Part 3 - the program on MK</a></li>
<li><a href="../219777/index.html">Facebook Web Injection for delivering Android mobile bot</a></li>
<li><a href="../219781/index.html">Google received a patent for contact lenses with a video camera.</a></li>
<li><a href="../219783/index.html">Chrome Remote Desktop - now connect to PC and from Android smartphone</a></li>
<li><a href="../219787/index.html">A graduate student from Berkeley restored the look of a plant that lived 375 million years ago.</a></li>
<li><a href="../219789/index.html">Migration of MSSQL database versions</a></li>
<li><a href="../219793/index.html">Bootstrapping or how we ran an IT project without funding and programmers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>