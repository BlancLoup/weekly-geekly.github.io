<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Blue screen of death when copying via Remote Desktop is now available on the server platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Windows Server 2016 was released on September 30, 2016. Unfortunately, along with positive innovations came negative ones. On Windows Server, an error...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Blue screen of death when copying via Remote Desktop is now available on the server platform</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/bfa/31d/ebc/bfa31debc9d54a02b41da89327289415.png"></div><br>  Windows Server 2016 was released on September 30, 2016. Unfortunately, along with positive innovations came negative ones.  On Windows Server, an error was successfully transferred from Windows 10 Anniversary Update, causing the remote server to crash when accessing the local path \\ tsclient via FAR Manager from it. <br><br>  From the very first manifestation of this problem, I tried to draw attention to this from Microsoft, but without success.  There is no solution so far. <br>  <b>UPDATE</b> .  The error was fixed as part of the update on 03/14/2017 in both Windows 10 and Windows Server 2016. The version of the rdbss.sys driver is 10.0.14393.953 (03/04/2017). <br><a name="habracut"></a><br><h2>  Problem </h2><br>  In the process of work, I often have to access remote computers via Remote Desktop.  Sometimes you have to copy files there / back;  in this case, it is quite useful to access the disks of my computer from the RDP client on the \\ tsclient \ d type path.  Also it is necessary to mention that I got used to use FAR Manager. <br><br>  After the Windows Anniversary Update update, released in August 2016, in which I hoped Microsoft would correct a number of its errors, the opposite happened.  When accessing the \\ tsclient \ d path through FAR, the remote machine began to fall into the blue screen.  Specifically, the rdbss.sys driver was guilty. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The problem was repeated once or twice or three, and further tests were perfectly performed on virtual machines with the operating system installed from scratch.  The culprit was clearly visible when viewing the core dump. <br><br><pre><code class="hljs erlang-repl">BugCheck <span class="hljs-number"><span class="hljs-number">27</span></span>, {fcb0027c, ffffd5073f279eb8, ffffd5073f279af0, <span class="hljs-number"><span class="hljs-number">0</span></span>} Page c920 not present in the dump file. Type <span class="hljs-string"><span class="hljs-string">".hh dbgerr004"</span></span> for details Probably caused by : rdbss.sys ( rdbss! ?? ::FNODOBFM::`string'+<span class="hljs-number"><span class="hljs-number">1</span></span>f09 ) nt!KeBugCheckEx rdbss! ?? ::FNODOBFM::`string'+<span class="hljs-number"><span class="hljs-number">0</span></span>x1f09 (  RxSelectAndSwitchPagingFileObject) rdbss!RxCommonClose+<span class="hljs-number"><span class="hljs-number">0</span></span>x126 rdbss!RxFsdCommonDispatch+<span class="hljs-number"><span class="hljs-number">0</span></span>x55b rdbss!RxFsdDispatch+<span class="hljs-number"><span class="hljs-number">0</span></span>x86 rdpdr!DrPeekDispatch+<span class="hljs-number"><span class="hljs-number">0</span></span>x203 mup!MupStateMachine+<span class="hljs-number"><span class="hljs-number">0</span></span>x1dc mup!MupClose+<span class="hljs-number"><span class="hljs-number">0</span></span>x8c FLTMGR!FltpLegacyProcessingAfterPreCallbacksCompleted+<span class="hljs-number"><span class="hljs-number">0</span></span>x1a6 FLTMGR!FltpDispatch+<span class="hljs-number"><span class="hljs-number">0</span></span>xb6 nt!IopDeleteFile+<span class="hljs-number"><span class="hljs-number">0</span></span>x12d nt!ObpRemoveObjectRoutine+<span class="hljs-number"><span class="hljs-number">0</span></span>x78 nt!ObfDereferenceObjectWithTag+<span class="hljs-number"><span class="hljs-number">0</span></span>xc6 nt!ObCloseHandleTableEntry+<span class="hljs-number"><span class="hljs-number">0</span></span>x28f nt!NtClose+<span class="hljs-number"><span class="hljs-number">0</span></span>xcb nt!KiSystemServiceCopyEnd+<span class="hljs-number"><span class="hljs-number">0</span></span>x13 <span class="hljs-number"><span class="hljs-number">0</span></span>x00007ffa`<span class="hljs-number"><span class="hljs-number">8</span></span>c925034</code> </pre> <br><h2>  Correspondence </h2><br>  Well, I thought, let's go to Microsoft.  Since I did not find the forms for sending messages on similar occasions (and somehow I didn‚Äôt want to get paid support request), a topic was created in the <a href="https://social.technet.microsoft.com/Forums/windows/en-US/26691ffa-7b9c-4691-9639-03156a0c6215">technet forum</a> .  In the message, I described the sequence in which the problem was reproduced and attached Windows dump analysis from WinDBG. <br><br>  As a result, I received a response from the moderator: <br><blockquote>  According to your analysis, the problem is with ‚Äúrdbss.sys‚Äù.  This is the driver of the buffering subsystem of the redirected disk.  Since the problem is observed on any machine, I suspect the driver is incompatible with the functionality of Windows 10 RDP.  You'd better confirm this with the developer of this software. </blockquote><br>  Attempting to indicate that the developer of the rdbss.sys module in Windows 10 is Microsoft did not lead to success.  ‚ÄúContact the developer company;  I do not have the opportunity to check it, ‚Äùwrites a moderator, a Microsoft employee. <br><br>  Here I thought that the problem recurs for an unprivileged user (indeed), and decided to write in the Microsoft Security Report.  Microsoft takes seriously the sending of such a message - you need to send an encrypted email (S-MIME or OpenPGP with a Microsoft key) by e-mail, which will be answered within 24 hours. <br><br>  Indeed, the answer was given: <br><blockquote>  Apparently, this problem is FAR Manager, not Windows 10. However, this cannot be considered a security problem, since you already have access to the system and the ability to execute code on the machine. </blockquote><br>  To the question whether it is normal, if an unprivileged user can call a BSOD, there was no answer. <br><br>  When the release assemblies of Window Server 2016 appeared in which this problem was repeated, I sent another letter, paying attention to the inadmissibility of this for the server platform.  The answer was similar: <br><blockquote>  Thanks for the additional information.  Unfortunately, it still looks like a problem in FAR Manager.  It could also be a DOS attack by a locally authenticated user, but we do not find it sufficient to provide support for security tasks. </blockquote><br><h2>  Analysis </h2><br>  For the sake of interest, I looked at whether this problem manifests itself in other versions of Windows - it turns out, no.  Neither in Windows 10 1511, nor in Windows Server 2016 TP5 it was observed. <br><br>  A brief review of the code in WinDBG revealed a very interesting thing.  The RxSelectAndSwitchPagingFileObject function, which, in fact, caused Bugcheck 0x27, did not change much compared to Windows 10 1511. But in the previous version, when errors were detected, they were simply ignored, and the call to KeBugCheckEx was explicitly added.  Apparently, the developers could not fix any of their bugs and decided to work "according to the Brazilian system" - if anything, the system will simply fall, and then we will be able to find the causes of some internal (and possibly not fatal) errors. <br><br>  However, the reality is a strange situation - users find this error and describe the sequence of its reproduction, and technical support is a barrier - ‚Äúthis is not our problem‚Äù.  Developers, I suspect, the information does not reach. <br><br>  In Windows Server 2016 TP5, by the way, this feature did not exist at all.  However, it appeared in the release version and absolutely also causes a blue screen, as in Windows 10 Anniversary.  It is worth noting that since the release of Windows Anniversary Update there have been several updates to the rdbss.sys module, but they have not solved this problem. <br><br>  On the FAR Manager side, the situation is such that it actively uses the Native API, and for operations with directories it uses not the classic functions of the kernel32 module (FindFirstFile / FindNextFile), but the functions of the ntdll module (NtQueryDirectoryFile).  Perhaps there is some unexpected combination of parameters / calls that the developers of rdbss.sys did not take into account (the system crashes on NtClose when the open file object is being cleared). <br><br>  I hope this article will warn system administrators about the new scourge and will allow you to avoid unexpected crashes of remote servers.  I also cherish the pitiful hope that Microsoft representatives present at Harbahabr will convey the necessary information to rdbss.sys developers through the ‚Äútechnical support‚Äù wall. </div><p>Source: <a href="https://habr.com/ru/post/314882/">https://habr.com/ru/post/314882/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314872/index.html">Deep learning for newbies: recognizing images using convolutional networks</a></li>
<li><a href="../314874/index.html">Decompiling Java methods on a productive application under load - myth or reality?</a></li>
<li><a href="../314876/index.html">While the Chinese IT labor market is still adopting American practice, in the US they hire programmers "effortlessly"</a></li>
<li><a href="../314878/index.html">Six issues for cloud security that organizations need to address</a></li>
<li><a href="../314880/index.html">How we implement ITSM. Four defects of service</a></li>
<li><a href="../314884/index.html">The protagonists of the modern online project</a></li>
<li><a href="../314886/index.html">Development based on the COREmanager framework. How our partners created a solution for outsourcing technical support</a></li>
<li><a href="../314888/index.html">Desktop virtualization: what's new, what are the trends and where are we going?</a></li>
<li><a href="../314892/index.html">You can download materials from the Nanometer ASIC workshop (RUSNANO / MISiS / Imagination Technologies) - educational program for all chips</a></li>
<li><a href="../314894/index.html">Many JS packages in one repository</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>