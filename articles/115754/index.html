<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Our experience with Django, or 10 useful modules that make life easier</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the past 15 weeks, we have been actively working on the Stillion project, our first mainstream project written in Django. An interesting experienc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Our experience with Django, or 10 useful modules that make life easier</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/bc/34/bc34fc77ef2051b9db9146de39fa8bf3.gif" alt="Priceless experience with Django, or Django for blondes, brunettes and all-all-all" align="left">  For the past 15 weeks, <a href="http://futurecolors.ru/">we have</a> been actively working on the <a href="http://stillion.ru/">Stillion</a> project, our first mainstream project written in Django.  An interesting experience was gained that we would like to share with the community. <br>  The article, above all, will be interesting for newcomers to Django. <a name="habracut"></a><br><br><br><h2>  Django Modules </h2><br><h4>  <a href="http://south.aeracode.org/">south</a> </h4>  South is a mechanism for migrating schemas and data to the database for django, then without which it is impossible to live with joint development.  Unfortunately, in Jang there is no regular migration mechanism for tracking changes in the project database schema.  To fill this gap, we used the south, which showed itself from the good side, the main thing is to understand how it works, everything is perfectly described <a href="http://south.aeracode.org/docs/">in the documentation</a> .  Rake: migration can roll without fixtures, this should be used.  Data migrations must be written by hand.  If you use abnormal fields (for example, a WYSIWYG field) and then abandon them, the old migrations will not work (but you can rewrite them manually). <br><br><h4>  <a href="https://github.com/django-mptt/django-mptt/">django-mptt</a> </h4>  Implementation of nested sets for django models.  Adds the appropriate fields, as well as methods of working with the tree.  An indispensable thing for the implementation of hierarchical structures in a relational database.  Fein-cms was used in the admin panel to represent the trees. <br><div style="text-align:center;"><img src="https://habrastorage.org/storage/habraeffect/41/1f/411f4be921ac285fd5a6040b6de98814.png" title="django-mptt" alt="django-mptt"></div><br><h4>  <a href="https://bitbucket.org/offline/django-annoying/wiki/Home">django-annoying</a> </h4>  A set of useful utilities, such as the decorators of the types render_to and ajax_request or HttpResponseReload.  Recommended to enhance the elegance of the code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <a href="https://github.com/robhudson/django-debug-toolbar/commits/master/">django-debug-toolbar</a> </h4>  A module that displays a panel with debug information.  We were primarily interested in the SQL query log, which is supplemented with information about the source of the query, time, etc. <br><br><h4>  <a href="http://packages.python.org/pymorphy/">pymorphy</a> </h4>  Morphological analyzer integrated with Django.  Used to induce words that are stored in normal form (that is, it saves us from storing various forms of a single word).  He also knows how to put words in the plural: <pre><code class="python hljs">morph.pluralize_inflected_ru(<span class="hljs-string"><span class="hljs-string">u''</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>) &gt;&gt;&gt; </code> </pre>  Disadvantages - slow sqlite as backend (there are faster alternatives to Shelve, CDB and Tokyo Cabinet, but we don‚Äôt like them), not all words are correctly processed, but this happens rarely. <br><br><h4>  <a href="https://github.com/j2a/pytils">pytils</a> </h4>  In order not to suffer from "March 18, 2011" we use pytils to work with Russian dates.  The module, by the way, is able to transliterate the Russian text and choose the correct case depending on the number, just like pymorphy (although without a dictionary, you will have to store 3 forms of the word in the template). <br><br><h4>  <a href="http://thumbnail.sorl.net/">sorl-thumbnail</a> </h4>  An application for automatically creating thumbnail images.  It works on the basis of the key-value of the repository (of course, the <a href="http://redis.io/">redis</a> available from the box is used as a <a href="http://redis.io/">backend</a> ).  Not the miniatures themselves (they are stored in files) are stored in the backend, but only meta-information (a <a href="https://docs.google.com/drawings/edit%3Fid%3D1wlE4LkQpzXd2a2Nxfjt6_j5NG7889dzMyf0V-xPAJSE%26hl%3Den%26pli%3D1">schematic diagram of the module operation</a> ). <pre> <code class="html hljs xml">{% thumbnail image "100x100" crop="top" as im %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{ im.url }}"</span></span></span><span class="hljs-tag">&gt;</span></span> {% endthumbnail %}</code> </pre><br><div style="text-align:center;"> <a href="http://stillion.ru/"><img src="https://habrastorage.org/storage/habraeffect/ea/aa/eaaaa87743c4012161e0178831a0f345.png" title="sorl-thumbnail" alt="sorl-thumbnail"></a> </div><br><h4>  <a href="http://code.google.com/p/django-compress/">django-compress</a> </h4>  Gluing and minifying CSS and JS.  In the configuration file sets are stored for gluing, in the template we indicate the name of the assembly and compress generates a minified version (filters YUI and CSSMin).  You can extend the functionality with your own filters.  It supports the versioned file name, which is very convenient when setting the Expires header for a long time to come (manage.py syncompress will update the names and contents of the minified files itself when laying out production). <br><br><h4>  <a href="https://github.com/dcramer/django-sentry">django-sentry</a> </h4>  A very useful application from the creators of DISQUS, allowing you to conveniently log errors into the database.  Sentry intercepts exceptions (for example, Http404), saves them and provides a beautiful interface that shows the frequency of the error (including graphically).  Possible to collect errors from multiple servers.  <a href="http://habrahabr.ru/blogs/django/111283/">Sentry Review on Habr√©</a> <br><div style="text-align:center;"><img src="https://habrastorage.org/storage/habraeffect/f7/e3/f7e324be2b8a47d76e1852f3f2aa5b99.png" title="django-sentry" alt="django-sentry"></div><br><h4>  <a href="https://bitbucket.org/izi/django-admin-tools/wiki/Home">django-admin-tools</a> </h4>  The application helps to make admin dashboards useful.  There is a built-in set of widgets, but it is not difficult to write your own.  You can also create a menu for your tasks, which will be available on all admin pages.  <a href="http://habrahabr.ru/blogs/django/98539/">Overview of Admin Tools on Habr√©</a> <br><div style="text-align:center;"><img src="https://habrastorage.org/storage/habraeffect/a2/ea/a2ea8e5bb7b543e738f60200e4b078fe.png" title="django-admin-tools" alt="django-admin-tools"></div><br><br><br><h2>  Comments </h2><br>  When we made comments, we decided that authorization through third-party services (vkontakte, facebook, openid and others like them) would be the best option.  This is very convenient for the user, because he does not need to invent and remember a lot of passwords from different resources.  In order to do this quickly and easily, there is a <a href="http://loginza.ru/">Loginza</a> service.  We didn‚Äôt like the interface very much and we implemented the integration with the main services ourselves. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage/habraeffect/20/43/20439a4815a619461692605689ba3133.png" title="Comments" alt=""></div><br>  The <a href="https://bitbucket.org/offline/django-publicauth">publicauth</a> module was taken as a <a href="https://bitbucket.org/offline/django-publicauth">basis</a> , but it had to be thoroughly finished.  The matter was not limited to adding integration with mail.ru and other Russian services.  We added the ‚Äúcorrect‚Äù signature verification of the openId providers and made a rather friendly widget in ‚Äútwo clicks‚Äù. <br><br><br><br><h2>  Performance Optimization </h2><br>  In practice, one of the weaknesses of django was the ORM.  He, like all ORM, contributes to the production of a large number of requests and consumes a lot of memory when extracting data.  Without caching, the generation of the <a href="http://stillion.ru/">main page</a> took a few seconds.  Of the possible optimization strategies, caching turned out to be the cheapest and most efficient since the database schema did not allow the use of standard tools such as select_related. <br><br><h4>  Caching </h4>  Caching blocks by timeout, available out of the box, did not suit us, since it did not provide a convenient way to reset the cache.  Therefore, the following strategy was chosen: the cache lives indefinitely (TIMEOUT = 0), and one of the parts of the cache entry key is the date of the last update of the main object.  Dependent objects update the main using post_save signals.  Thus, when the object is changed, the name of the key for caching is automatically changed, which allows you to see the most relevant data on the site.  Redis with the allkeys-lru test algorithm is used as the cache backend (the cache keys that have not been used for a long time will be deleted when the maxmemory limit is reached).  In the radish, by the way, we also store user sessions to unload the database a little more. <br><br><h4>  Order by RAND () </h4>  In order not to load the database with a sample of random values ‚Äã‚Äãvia .order_by ('?'), The following approach is used: the data that needs to be mixed is retrieved and put into the cache (especially if the logic of sampling this data is not trivial and requires a large number of queries) list of identifiers, and when issuing to this list applies random.shuffle (). <br>  Summary: cache wisely :-)) <br><br><br><h2>  As a conclusion </h2><br>  Django is a great framework with lots of nice additions;  when you use it, you understand that it was created for our convenience.  Enjoy your coding! <h6>  <i>Shl.</i>  <i>Do you have any familiar designers / front-end developers looking for work (permanent, in the office, Moscow)?</i> </h6></div><p>Source: <a href="https://habr.com/ru/post/115754/">https://habr.com/ru/post/115754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../115746/index.html">Intel Science Talent Search winner is 17 year old</a></li>
<li><a href="../115748/index.html">Canobuvosti, 83rd edition</a></li>
<li><a href="../115749/index.html">Digital signature and e-procurement</a></li>
<li><a href="../115752/index.html">Floppy Notebook</a></li>
<li><a href="../115753/index.html">Dream tablet. How long to wait?</a></li>
<li><a href="../115755/index.html">SiteStatus.ru - check the status of the site</a></li>
<li><a href="../115756/index.html">Super Mario Brothers 3D</a></li>
<li><a href="../115757/index.html">Did you write plugins for your IDE?</a></li>
<li><a href="../115758/index.html">Windows: remote backup using snapshots (VShadow)</a></li>
<li><a href="../115759/index.html">On the car Tesla Model S you can install your software</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>